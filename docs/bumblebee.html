<!DOCTYPE html><html><head><title>Help for package bumblebee</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {bumblebee}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#bumblebee-package'><p>Bumblebee: Quantify Disease Transmission Within and Between Population Groups</p></a></li>
<li><a href='#counts_hiv_transmission_pairs'><p>Observed HIV transmission pairs</p></a></li>
<li><a href='#estimate_c_hat'><p><code>estimate_c_hat</code> Estimates probability of clustering</p></a></li>
<li><a href='#estimate_multinom_ci'><p><code>estimate_multinom_ci</code> Estimates confidence intervals for transmission flows</p></a></li>
<li><a href='#estimate_p_hat'><p><code>estimate_p_hat</code> Estimates probability of linkage between two individuals</p></a></li>
<li><a href='#estimate_prob_group_pairing_and_linked'><p><code>estimate_prob_group_pairing_and_linked</code> Estimates joint probability of linkage</p></a></li>
<li><a href='#estimate_theta_hat'><p><code>estimate_theta_hat</code> Estimates conditional probability of linkage (transmission flows)</p></a></li>
<li><a href='#estimate_transmission_flows_and_ci'><p><code>estimate_transmission_flows_and_ci</code> Estimates transmission flows and corresponding confidence intervals</p></a></li>
<li><a href='#estimated_hiv_transmission_flows'><p>Estimated HIV transmission flows</p></a></li>
<li><a href='#prep_p_hat'><p><code>prep_p_hat</code> Prepares input data to estimate <code>p_hat</code></p></a></li>
<li><a href='#sampling_frequency'><p>Sampling fequency</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Quantify Disease Transmission Within and Between Population
Groups</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Description:</td>
<td>A simple tool to quantify the amount of transmission
   of an infectious disease of interest occurring within and between 
   population groups. 'bumblebee' uses counts of observed directed 
   transmission pairs, identified phylogenetically from deep-sequence data or 
   from epidemiological contacts, to quantify transmission flows within and 
   between population groups accounting for sampling heterogeneity. Population 
   groups might include: geographical areas (e.g. communities, regions), 
   demographic groups (e.g. age, gender) or arms of a randomized clinical 
   trial. See the 'bumblebee' website for statistical theory, documentation 
   and examples <a href="https://magosil86.github.io/bumblebee/">https://magosil86.github.io/bumblebee/</a>.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://magosil86.github.io/bumblebee/">https://magosil86.github.io/bumblebee/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/magosil86/bumblebee/issues">https://github.com/magosil86/bumblebee/issues</a></td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr (&ge; 1.0.2), gtools (&ge; 3.8.2), Hmisc (&ge; 4.4-2),
magrittr (&ge; 2.0.1), rmarkdown (&ge; 2.6)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>covr (&ge; 3.5.1), knitr (&ge; 1.30), markdown (&ge; 1.1), testthat
(&ge; 3.0.1)</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-05-10 11:16:58 UTC; lmagosi</td>
</tr>
<tr>
<td>Author:</td>
<td>Lerato E Magosi <a href="https://orcid.org/0000-0002-3388-9892"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Marc Lipsitch [aut],
  Lerato E Magosi [cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Lerato E Magosi &lt;magosil86@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-05-11 09:42:19 UTC</td>
</tr>
</table>
<hr>
<h2 id='bumblebee-package'>Bumblebee: Quantify Disease Transmission Within and Between Population Groups</h2><span id='topic+bumblebee-package'></span><span id='topic+_PACKAGE'></span><span id='topic+bumblebee'></span>

<h3>Description</h3>

<p>Bumblebee uses counts of directed transmission pairs identified between samples
from population groups of interest to estimate the flow of transmissions within
and between those population groups accounting for sampling heterogeneity.
</p>
<p>Population groups might include: communities, geographical regions, age-gender
groupings or arms of a randomized-clinical trial.
</p>
<p>Counts of observed directed transmission pairs can be obtained from deep-sequence
phylogenetic data (via phyloscanner) or known epidemiological contacts. Note:
Deep-sequence data is also commonly referred to as high-throughput or
next-generation sequence data. See references to learn more about phyloscanner.
</p>


<h3>The <code>estimate_transmission_flows()</code> function</h3>

<p>To estimate transmission flows, that is, the relative probability of transmission
within and between population groups accounting for variable sampling the among
the population groups the function: <code>estimate_transmission_flows_and_ci()</code>
computes the conditional probability, <code>theta_hat</code> that a pair of pathogen
sequences is from a specific population group pairing given that the pair is
linked.
</p>
<p>For two population groups of interest <code class="reqn">(u,v)</code> <code>theta_hat</code> is denoted by
</p>
<p style="text-align: center;"><code class="reqn">\hat{\theta_{ij}} = Pr(pair from groups (i,j) | pair is linked), where i = u,v and j = u,v .</code>
</p>

<p>To learn more and try some examples, see documentation of the
<code>estimate_transmission_flows()</code> function and the bumblebee package
website <a href="https://magosil86.github.io/bumblebee/">https://magosil86.github.io/bumblebee/</a>.
</p>


<h3>Cite the package</h3>

<p>Please cite the package using the following reference:
Lerato E. Magosi, Marc Lipsitch (2021). Bumblebee: Quantify Disease
Transmission Within and Between Population Groups. R package version
0.1.0 <a href="https://magosil86.github.io/bumblebee/">https://magosil86.github.io/bumblebee/</a>
</p>


<h3>Author(s)</h3>

<p>Lerato E. Magosi <a href="mailto:lmagosi@hsph.harvard.edu">lmagosi@hsph.harvard.edu</a> or
<a href="mailto:magosil86@gmail.com">magosil86@gmail.com</a>
</p>


<h3>References</h3>


<ol>
<li><p> Magosi LE, et al., Deep-sequence phylogenetics to quantify patterns of
HIV transmission in the context of a universal testing and treatment
trial – BCPP/ Ya Tsie trial. To submit for publication, 2021.
</p>
</li>
<li><p> Carnegie, N.B., et al., Linkage of viral sequences among HIV-infected
village residents in Botswana: estimation of linkage rates in the
presence of missing data. PLoS Computational Biology, 2014. 10(1):
p. e1003430.
</p>
</li>
<li><p> Goodman, L. A. On Simultaneous Confidence Intervals for Multinomial Proportions
Technometrics, 1965. 7, 247-254.
</p>
</li>
<li><p> Glaz, J., Sison, C.P. Simultaneous confidence intervals for multinomial proportions.
Journal of Statistical Planning and Inference, 1999. 82:251-262.
</p>
</li>
<li><p> May, W.L., Johnson, W.D. Constructing two-sided simultaneous confidence intervals for
multinomial proportions for small counts in a large number of cells.
Journal of Statistical Software, 2000. 5(6).
Paper and code available at https://www.jstatsoft.org/v05/i06.
</p>
</li>
<li><p> Ratmann, O., et al., Inferring HIV-1 transmission networks and sources of
epidemic spread in Africa with deep-sequence phylogenetic analysis.
Nature Communications, 2019. 10(1): p. 1411.
</p>
</li>
<li><p> Sison, C.P and Glaz, J. Simultaneous confidence intervals and sample size determination
for multinomial proportions. Journal of the American Statistical Association,
1995. 90:366-369.
</p>
</li>
<li><p> Wymant, C., et al., PHYLOSCANNER: Inferring Transmission from Within- and
Between-Host Pathogen Genetic Diversity. Molecular Biology and Evolution,
2017. 35(3): p. 719-733.
</p>
</li></ol>



<h3>See Also</h3>

<p>See the following functions for details on estimating transmission flows
and corresponding confidence intervals: <code>estimate_transmission_flows_and_ci</code>,
<code>estimate_theta_hat</code> and <code>estimate_multinom_ci</code>.
</p>

<hr>
<h2 id='counts_hiv_transmission_pairs'>Observed HIV transmission pairs</h2><span id='topic+counts_hiv_transmission_pairs'></span>

<h3>Description</h3>

<p>Counts of directed HIV transmission pairs observed within and between
intervention and control communities in the 30-community BCPP/Ya Tsie
HIV prevention trial in Botswana (2013-2018). The Botswana -Ya Tsie
trial was a pair-matched community randomized trial that evaluated
the effect of a universal HIV test and treat intervention in reducing
population-level incidence. For further details see references and:
<a href="https://magosil86.github.io/bumblebee/">https://magosil86.github.io/bumblebee/</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>counts_hiv_transmission_pairs
</code></pre>


<h3>Format</h3>

<p>A data frame:
</p>

<dl>
<dt>H1_group</dt><dd><p>Name of population group 1</p>
</dd>
<dt>H2_group</dt><dd><p>Name of population group 1</p>
</dd>
<dt>num_linked_pairs_observed</dt><dd><p>Number of observed directed transmission pairs between samples from population groups 1 and 2</p>
</dd></dl>



<h3>Source</h3>

<p><a href="https://magosil86.github.io/bumblebee/">https://magosil86.github.io/bumblebee/</a>
</p>


<h3>References</h3>

<p>Magosi LE, et al., Deep-sequence phylogenetics to quantify patterns of
HIV transmission in the context of a universal testing and treatment
trial – BCPP/ Ya Tsie trial. To submit for publication, 2021.
</p>

<hr>
<h2 id='estimate_c_hat'><code>estimate_c_hat</code> Estimates probability of clustering</h2><span id='topic+estimate_c_hat'></span><span id='topic+c_hat'></span><span id='topic+est_c_hat'></span><span id='topic+estim_c_hat'></span><span id='topic+estimate_c_hat.default'></span>

<h3>Description</h3>

<p>This function estimates <code>c_hat</code>, the probability that a randomly
selected pathogen sequence in one population group links to at least
one pathogen sequence in another population group.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_c_hat(df_counts_and_p_hat, ...)

## Default S3 method:
estimate_c_hat(df_counts_and_p_hat, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estimate_c_hat_+3A_df_counts_and_p_hat">df_counts_and_p_hat</code></td>
<td>
<p>A data.frame returned by the function: <code><a href="#topic+estimate_p_hat">estimate_p_hat()</a></code></p>
</td></tr>
<tr><td><code id="estimate_c_hat_+3A_...">...</code></td>
<td>
<p>Further arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a data.frame containing:
</p>

<ul>
<li><p> H1_group, Name of population group 1
</p>
</li>
<li><p> H2_group, Name of population group 2
</p>
</li>
<li><p> number_hosts_sampled_group_1, Number of individuals sampled from population group 1
</p>
</li>
<li><p> number_hosts_sampled_group_2, Number of individuals sampled from population group 2
</p>
</li>
<li><p> number_hosts_population_group_1, Estimated number of individuals in population group 1
</p>
</li>
<li><p> number_hosts_population_group_2, Estimated number of individuals in population group 2
</p>
</li>
<li><p> max_possible_pairs_in_sample, Number of distinct possible transmission pairs between individuals sampled from population groups 1 and 2
</p>
</li>
<li><p> max_possible_pairs_in_population, Number of distinct possible transmission pairs between individuals in population groups 1 and 2
</p>
</li>
<li><p> num_linked_pairs_observed, Number of observed directed transmission pairs between samples from population groups 1 and 2
</p>
</li>
<li><p> p_hat, Probability that pathogen sequences from two individuals randomly sampled from their respective population groups are linked
</p>
</li>
<li><p> c_hat, Probability that a randomly selected pathogen sequence in one population group links to at least
one pathogen sequence in another population group i.e. probability of clustering
</p>
</li></ul>



<h3>Methods (by class)</h3>


<ul>
<li> <p><code>default</code>: Estimates probability of clustering
</p>
</li></ul>


<h3>References</h3>


<ol>
<li><p> Magosi LE, et al., Deep-sequence phylogenetics to quantify patterns of
HIV transmission in the context of a universal testing and treatment
trial – BCPP/ Ya Tsie trial. To submit for publication, 2021.
</p>
</li>
<li><p> Carnegie, N.B., et al., Linkage of viral sequences among HIV-infected
village residents in Botswana: estimation of linkage rates in the
presence of missing data. PLoS Computational Biology, 2014. 10(1):
p. e1003430.
</p>
</li></ol>



<h3>See Also</h3>

<p>See <code><a href="#topic+estimate_p_hat">estimate_p_hat</a></code> to prepare input data to estimate <code>c_hat</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(bumblebee)
library(dplyr)

# Estimate the probability of clustering between individuals from two population groups of interest

# We shall use the data of HIV transmissions within and between intervention and control
# communities in the BCPP/Ya Tsie HIV prevention trial. To learn more about the data 
# ?counts_hiv_transmission_pairs, ?sampling_frequency and ?estimated_hiv_transmission_flows


# Load and view data
#
# The input data comprises counts of observed directed HIV transmission pairs within and
# between intervention and control communities in the BCPP/Ya Tsie trial, sampling 
# information and the probability of linkage between individuals sampled from
# intervention and control communities (i.e. \code{p_hat})
#
# See ?estimate_p_hat() for details on estimating p_hat
results_estimate_p_hat &lt;- estimated_hiv_transmission_flows[, c(1:10)]

results_estimate_p_hat

# Estimate c_hat
results_estimate_c_hat &lt;- estimate_c_hat(df_counts_and_p_hat = results_estimate_p_hat)

# View results
results_estimate_c_hat

</code></pre>

<hr>
<h2 id='estimate_multinom_ci'><code>estimate_multinom_ci</code> Estimates confidence intervals for transmission flows</h2><span id='topic+estimate_multinom_ci'></span><span id='topic+estim_multinom_ci'></span><span id='topic+est_multinom_ci'></span><span id='topic+estimate_multinom_ci.default'></span>

<h3>Description</h3>

<p>This function computes simultaneous confidence intervals at the
5% significance level for estimated transmission flows. Available
methods for computing confidence intervals are: Goodman, Goodman
with a continuity correction, Sison-Glaz and Queensbury-Hurst.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_multinom_ci(df_theta_hat, ...)

## Default S3 method:
estimate_multinom_ci(df_theta_hat, detailed_report = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estimate_multinom_ci_+3A_df_theta_hat">df_theta_hat</code></td>
<td>
<p>A data.frame returned by the function: <code><a href="#topic+estimate_theta_hat">estimate_theta_hat()</a></code></p>
</td></tr>
<tr><td><code id="estimate_multinom_ci_+3A_...">...</code></td>
<td>
<p>Further arguments.</p>
</td></tr>
<tr><td><code id="estimate_multinom_ci_+3A_detailed_report">detailed_report</code></td>
<td>
<p>A boolean value to produce detailed output of the analysis. (Default is <code>FALSE</code>)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a data.frame containing:
</p>

<ul>
<li><p> H1_group, Name of population group 1
</p>
</li>
<li><p> H2_group, Name of population group 2
</p>
</li>
<li><p> number_hosts_sampled_group_1, Number of individuals sampled from population group 1
</p>
</li>
<li><p> number_hosts_sampled_group_2, Number of individuals sampled from population group 2
</p>
</li>
<li><p> number_hosts_population_group_1, Estimated number of individuals in population group 1
</p>
</li>
<li><p> number_hosts_population_group_2, Estimated number of individuals in population group 2
</p>
</li>
<li><p> max_possible_pairs_in_sample, Number of distinct possible transmission pairs between individuals sampled from population groups 1 and 2
</p>
</li>
<li><p> max_possible_pairs_in_population, Number of distinct possible transmission pairs between individuals in population groups 1 and 2
</p>
</li>
<li><p> num_linked_pairs_observed, Number of observed directed transmission pairs between samples from population groups 1 and 2
</p>
</li>
<li><p> p_hat, Probability that pathogen sequences from two individuals randomly sampled from their respective population groups are linked
</p>
</li>
<li><p> est_linkedpairs_in_population, Estimated transmission pairs between population groups 1 and 2
</p>
</li>
<li><p> theta_hat, Estimated transmission flows or relative probability of transmission within and between population groups 1 and 2 adjusted
for sampling heterogeneity. More precisely, the conditional probability that a pair of pathogen sequences is from a specific population
group pairing given that the pair is linked.
</p>
</li>
<li><p> obs_trm_pairs_est_goodman, Point estimate, Goodman method Confidence intervals for observed transmission pairs
</p>
</li>
<li><p> obs_trm_pairs_lwr_ci_goodman, Lower bound of Goodman confidence interval
</p>
</li>
<li><p> obs_trm_pairs_upr_ci_goodman, Upper bound of Goodman confidence interval
</p>
</li>
<li><p> est_goodman, Point estimate, Goodman method Confidence intervals for estimated transmission flows
</p>
</li>
<li><p> lwr_ci_goodman, Lower bound of Goodman confidence interval
</p>
</li>
<li><p> upr_ci_goodman, Upper bound of Goodman confidence interval
</p>
</li></ul>

<p>The following additional fields are returned if the detailed_report flag is set
</p>

<ul>
<li><p> est_goodman_cc, Point estimate, Goodman method Confidence intervals with continuity correction
</p>
</li>
<li><p> lwr_ci_goodman_cc, Lower bound of Goodman confidence interval
</p>
</li>
<li><p> upr_ci_goodman_cc, Upper bound of Goodman confidence interval
</p>
</li>
<li><p> est_sisonglaz, Point estimate, Sison-Glaz method Confidence intervals
</p>
</li>
<li><p> lwr_ci_sisonglaz, Lower bound of Sison-Glaz confidence interval
</p>
</li>
<li><p> upr_ci_sisonglaz, Upper bound of Sison-Glaz confidence interval
</p>
</li>
<li><p> est_qhurst_acswr, Point estimate, Queensbury-Hurst method Confidence intervals via ACSWR r package
</p>
</li>
<li><p> lwr_ci_qhurst_acswr, Lower bound of Queensbury-Hurst confidence interval
</p>
</li>
<li><p> upr_ci_qhurst_acswr, Upper bound of Queensbury-Hurst confidence interval
</p>
</li>
<li><p> est_qhurst_coinmind, Point estimate, Queensbury-Hurst method Confidence intervals via CoinMinD r package
</p>
</li>
<li><p> lwr_ci_qhurst_coinmind, Lower bound of Queensbury-Hurst confidence interval
</p>
</li>
<li><p> upr_ci_qhurst_coinmind, Upper bound of Queensbury-Hurst confidence interval
</p>
</li>
<li><p> lwr_ci_qhurst_adj_coinmind, Lower bound of Queensbury-Hurst confidence interval adjusted
</p>
</li>
<li><p> upr_ci_qhurst_adj_coinmind, Upper bound of Queensbury-Hurst confidence interval adjusted
</p>
</li></ul>



<h3>Methods (by class)</h3>


<ul>
<li> <p><code>default</code>: Estimates confidence intervals for transmission flows
</p>
</li></ul>


<h3>References</h3>


<ol>
<li><p> Magosi LE, et al., Deep-sequence phylogenetics to quantify patterns of
HIV transmission in the context of a universal testing and treatment
trial – BCPP/ Ya Tsie trial. To submit for publication, 2021.
</p>
</li>
<li><p> Goodman, L. A. On Simultaneous Confidence Intervals for Multinomial Proportions
Technometrics, 1965. 7, 247-254.
</p>
</li>
<li><p> Cherry, S., A Comparison of Confidence Interval Methods for Habitat
Use-Availability Studies. The Journal of Wildlife Management, 1996.
60(3): p. 653-658.
</p>
</li>
<li><p> Sison, C.P and Glaz, J. Simultaneous confidence intervals and sample size determination
for multinomial proportions. Journal of the American Statistical Association,
1995. 90:366-369.
</p>
</li>
<li><p> Glaz, J., Sison, C.P. Simultaneous confidence intervals for multinomial proportions.
Journal of Statistical Planning and Inference, 1999. 82:251-262.
</p>
</li>
<li><p> May, W.L., Johnson, W.D. Constructing two-sided simultaneous confidence intervals for
multinomial proportions for small counts in a large number of cells.
Journal of Statistical Software, 2000. 5(6).
Paper and code available at https://www.jstatsoft.org/v05/i06.
</p>
</li>
<li><p> Carnegie, N.B., et al., Linkage of viral sequences among HIV-infected
village residents in Botswana: estimation of linkage rates in the
presence of missing data. PLoS Computational Biology, 2014. 10(1):
p. e1003430.
</p>
</li>
<li><p> Ratmann, O., et al., Inferring HIV-1 transmission networks and sources of
epidemic spread in Africa with deep-sequence phylogenetic analysis.
Nature Communications, 2019. 10(1): p. 1411.
</p>
</li>
<li><p> Wymant, C., et al., PHYLOSCANNER: Inferring Transmission from Within- and
Between-Host Pathogen Genetic Diversity. Molecular Biology and Evolution,
2017. 35(3): p. 719-733.
</p>
</li></ol>



<h3>See Also</h3>

<p>See <code><a href="#topic+estimate_theta_hat">estimate_theta_hat</a></code> to prepare input data to estimate confidence intervals.</p>
<pre>     To learn more about the Goodman and Sison-Glaz confidence interval methods 
     see \code{\link[DescTools]{MultinomCI}}. For Queensbury-Hurst confidence
     intervals see \code{\link[ACSWR]{QH_CI}} and \code{\link[CoinMinD]{QH}}
</pre>


<h3>Examples</h3>

<pre><code class='language-R'>library(bumblebee)
library(dplyr)

# Compute confidence intervals for estimated transmission flows

# We shall use the data of HIV transmissions within and between intervention and control
# communities in the BCPP/Ya Tsie HIV prevention trial. To learn more about the data 
# ?counts_hiv_transmission_pairs and ?sampling_frequency


# Load and view data
#
# The data comprises counts of observed directed HIV transmission pairs between individuals 
# sampled from intervention and control communities (i.e. num_linked_pairs_observed); 
# and the estimated HIV transmissions within and between intervention and control 
# communities in the BCPP/Ya Tsie trial population adjusted for sampling heterogneity
# (i.e. \code{est_linkedpairs_in_population}). See ?estimate_theta_hat() for details on 
# computing \code{est_linkedpairs_in_population} and \code{theta_hat}.

results_estimate_theta_hat &lt;- estimated_hiv_transmission_flows[, c(1:13)]
 
results_estimate_theta_hat
 
# Compute Goodman confidence intervals (Default)
results_estimate_multinom_ci &lt;- estimate_multinom_ci(
    df_theta_hat = results_estimate_theta_hat, 
    detailed_report = FALSE)

# View results
results_estimate_multinom_ci

# Compute Goodman, Sison-Glaz and Queensbury-Hurst confidence intervals
results_estimate_multinom_ci_detailed &lt;- estimate_multinom_ci(
    df_theta_hat = results_estimate_theta_hat, 
    detailed_report = TRUE)

# View results
results_estimate_multinom_ci_detailed

</code></pre>

<hr>
<h2 id='estimate_p_hat'><code>estimate_p_hat</code> Estimates probability of linkage between two individuals</h2><span id='topic+estimate_p_hat'></span><span id='topic+p_hat'></span><span id='topic+phat'></span><span id='topic+est_p_hat'></span><span id='topic+estim_p_hat'></span><span id='topic+estimate_p_hat.default'></span>

<h3>Description</h3>

<p>This function computes the probability that pathogen sequences from
two individuals randomly sampled from their respective population groups
(e.g. communities) are linked.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_p_hat(df_counts, ...)

## Default S3 method:
estimate_p_hat(df_counts, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estimate_p_hat_+3A_df_counts">df_counts</code></td>
<td>
<p>A data.frame returned by the function: <code><a href="#topic+prep_p_hat">prep_p_hat()</a></code></p>
</td></tr>
<tr><td><code id="estimate_p_hat_+3A_...">...</code></td>
<td>
<p>Further arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For a population group pairing <code class="reqn">(u,v)</code>, <code>p_hat</code> is computed as the
fraction of distinct possible pairs between samples from groups <code class="reqn">u</code> and
<code class="reqn">v</code> that are linked. Note: The number of distinct possible <code class="reqn">(u,v)</code>
pairs in the sample is the product of sampled individuals in groups <code class="reqn">u</code>
and <code class="reqn">u</code>. If <code class="reqn">u = v</code>, then the distinct possible pairs is the number
of individuals sampled in population group <code class="reqn">u</code> choose 2. See bumblebee
website for more details <a href="https://magosil86.github.io/bumblebee/">https://magosil86.github.io/bumblebee/</a>.
</p>


<h3>Value</h3>

<p>Returns a data.frame containing:
</p>

<ul>
<li><p> H1_group, Name of population group 1
</p>
</li>
<li><p> H2_group, Name of population group 2
</p>
</li>
<li><p> number_hosts_sampled_group_1, Number of individuals sampled from population group 1
</p>
</li>
<li><p> number_hosts_sampled_group_2, Number of individuals sampled from population group 2
</p>
</li>
<li><p> number_hosts_population_group_1, Estimated number of individuals in population group 1
</p>
</li>
<li><p> number_hosts_population_group_2, Estimated number of individuals in population group 2
</p>
</li>
<li><p> max_possible_pairs_in_sample, Number of distinct possible transmission pairs between individuals sampled from population groups 1 and 2
</p>
</li>
<li><p> max_possible_pairs_in_population, Number of distinct possible transmission pairs between individuals in population groups 1 and 2
</p>
</li>
<li><p> num_linked_pairs_observed, Number of observed directed transmission pairs between samples from population groups 1 and 2
</p>
</li>
<li><p> p_hat, Probability that pathogen sequences from two individuals randomly sampled from their respective population groups are linked
</p>
</li></ul>



<h3>Methods (by class)</h3>


<ul>
<li> <p><code>default</code>: Estimates probability of linkage between two individuals
</p>
</li></ul>


<h3>References</h3>


<ol>
<li><p> Magosi LE, et al., Deep-sequence phylogenetics to quantify patterns of
HIV transmission in the context of a universal testing and treatment
trial – BCPP/ Ya Tsie trial. To submit for publication, 2021.
</p>
</li>
<li><p> Carnegie, N.B., et al., Linkage of viral sequences among HIV-infected
village residents in Botswana: estimation of linkage rates in the
presence of missing data. PLoS Computational Biology, 2014. 10(1):
p. e1003430.
</p>
</li></ol>



<h3>See Also</h3>

<p>See <code><a href="#topic+prep_p_hat">prep_p_hat</a></code> to prepare input data to estimate <code>p_hat</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(bumblebee)
library(dplyr)

# Estimate the probability of linkage between two individuals randomly sampled from
# two population groups of interest.

# We shall use the data of HIV transmissions within and between intervention and control
# communities in the BCPP/Ya Tsie HIV prevention trial. To learn more about the data 
# ?counts_hiv_transmission_pairs and ?sampling_frequency

# Prepare input to estimate p_hat

# View counts of observed directed HIV transmissions within and between intervention 
# and control communities
counts_hiv_transmission_pairs

# View the estimated number of individuals with HIV in intervention and control 
# communities and the number of individuals sampled from each
sampling_frequency

results_prep_p_hat &lt;- prep_p_hat(group_in = sampling_frequency$population_group, 
                                 individuals_sampled_in = sampling_frequency$number_sampled, 
                                 individuals_population_in = sampling_frequency$number_population, 
                                 linkage_counts_in = counts_hiv_transmission_pairs, 
                                 verbose_output = FALSE)

# View results
results_prep_p_hat

# Estimate p_hat
results_estimate_p_hat &lt;- estimate_p_hat(df_counts = results_prep_p_hat)

# View results 
results_estimate_p_hat


</code></pre>

<hr>
<h2 id='estimate_prob_group_pairing_and_linked'><code>estimate_prob_group_pairing_and_linked</code> Estimates joint probability of linkage</h2><span id='topic+estimate_prob_group_pairing_and_linked'></span><span id='topic+prob_group_pairing_and_linked'></span><span id='topic+estimate_prob_group_pairing_and_linked.default'></span>

<h3>Description</h3>

<p>This function computes the joint probability that a pair
of pathogen sequences is from a specific population group
pairing and linked.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_prob_group_pairing_and_linked(
  df_counts_and_p_hat,
  individuals_population_in,
  ...
)

## Default S3 method:
estimate_prob_group_pairing_and_linked(
  df_counts_and_p_hat,
  individuals_population_in,
  verbose_output = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estimate_prob_group_pairing_and_linked_+3A_df_counts_and_p_hat">df_counts_and_p_hat</code></td>
<td>
<p>A data.frame returned by function: <code><a href="#topic+estimate_p_hat">estimate_p_hat()</a></code></p>
</td></tr>
<tr><td><code id="estimate_prob_group_pairing_and_linked_+3A_individuals_population_in">individuals_population_in</code></td>
<td>
<p>A numeric vector of the estimated number of individuals per population group</p>
</td></tr>
<tr><td><code id="estimate_prob_group_pairing_and_linked_+3A_...">...</code></td>
<td>
<p>Further arguments.</p>
</td></tr>
<tr><td><code id="estimate_prob_group_pairing_and_linked_+3A_verbose_output">verbose_output</code></td>
<td>
<p>A boolean value to display intermediate output.
(Default is <code>FALSE</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For a population group pairing <code class="reqn">(u,v)</code>, the joint probability that a pair
is from groups <code class="reqn">(u,v)</code> and is linked is computed as
</p>
<p style="text-align: center;"><code class="reqn">(N_uv / N_choose_2) * p_hat_uv ,</code>
</p>

<p>where,
</p>

<ul>
<li><p> N_uv = N_u * N_v: maximum distinct possible <code class="reqn">(u,v)</code> pairs in population
</p>
</li>
<li><p> p_hat_uv: probability of linkage between two individuals randomly sampled
from groups <code class="reqn">u</code> and <code class="reqn">v</code>
</p>
</li>
<li><p> N choose 2 or (N * (N - 1))/2 : all distinct possible pairs in population.
</p>
</li></ul>

<p>See bumblebee website for more details <a href="https://magosil86.github.io/bumblebee/">https://magosil86.github.io/bumblebee/</a>.
</p>


<h3>Value</h3>

<p>Returns a data.frame containing:
</p>

<ul>
<li><p> H1_group, Name of population group 1
</p>
</li>
<li><p> H2_group, Name of population group 2
</p>
</li>
<li><p> number_hosts_sampled_group_1, Number of individuals sampled from population group 1
</p>
</li>
<li><p> number_hosts_sampled_group_2, Number of individuals sampled from population group 2
</p>
</li>
<li><p> number_hosts_population_group_1, Estimated number of individuals in population group 1
</p>
</li>
<li><p> number_hosts_population_group_2, Estimated number of individuals in population group 2
</p>
</li>
<li><p> max_possible_pairs_in_sample, Number of distinct possible transmission pairs between individuals sampled from population groups 1 and 2
</p>
</li>
<li><p> max_possible_pairs_in_population, Number of distinct possible transmission pairs between individuals in population groups 1 and 2
</p>
</li>
<li><p> num_linked_pairs_observed, Number of observed directed transmission pairs between samples from population groups 1 and 2
</p>
</li>
<li><p> p_hat, Probability that pathogen sequences from two individuals randomly sampled from their respective population groups are linked
</p>
</li>
<li><p> prob_group_pairing_and_linked, Probability that a pair of pathogen sequences is from a specific population group pairing and is linked
</p>
</li></ul>



<h3>Methods (by class)</h3>


<ul>
<li> <p><code>default</code>: Estimates joint probability of linkage
</p>
</li></ul>


<h3>References</h3>


<ol>
<li><p> Magosi LE, et al., Deep-sequence phylogenetics to quantify patterns of
HIV transmission in the context of a universal testing and treatment
trial – BCPP/ Ya Tsie trial. To submit for publication, 2021.
</p>
</li>
<li><p> Carnegie, N.B., et al., Linkage of viral sequences among HIV-infected
village residents in Botswana: estimation of linkage rates in the
presence of missing data. PLoS Computational Biology, 2014. 10(1):
p. e1003430.
</p>
</li></ol>



<h3>See Also</h3>

<p>See <code><a href="#topic+estimate_p_hat">estimate_p_hat</a></code> to prepare input data to estimate <code>prob_group_pairing_and_linked</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(bumblebee)
library(dplyr)

# Estimate joint probability that a pair is from a specific group pairing and linked

# We shall use the data of HIV transmissions within and between intervention and control
# communities in the BCPP/Ya Tsie HIV prevention trial. To learn more about the data 
# ?counts_hiv_transmission_pairs and ?sampling_frequency


# Load and view data
#
# The input data comprises counts of observed directed HIV transmission pairs 
# within and between intervention and control communities in the BCPP/Ya Tsie 
# trial, sampling information and the probability of linkage between individuals
# sampled from intervention and control communities (i.e. \code{p_hat})
#
# See ?estimate_p_hat() for details on estimating p_hat
results_estimate_p_hat &lt;- estimated_hiv_transmission_flows[, c(1:10)]

results_estimate_p_hat

# Estimate prob_group_pairing_and_linked
results_prob_group_pairing_and_linked &lt;- estimate_prob_group_pairing_and_linked(
    df_counts_and_p_hat = results_estimate_p_hat, 
    individuals_population_in = sampling_frequency$number_population)

# View results
results_prob_group_pairing_and_linked

</code></pre>

<hr>
<h2 id='estimate_theta_hat'><code>estimate_theta_hat</code> Estimates conditional probability of linkage (transmission flows)</h2><span id='topic+estimate_theta_hat'></span><span id='topic+theta_hat'></span><span id='topic+est_theta_hat'></span><span id='topic+estim_theta_hat'></span><span id='topic+estimate_theta_hat.default'></span>

<h3>Description</h3>

<p>This function estimates <code>theta_hat</code>, the relative probability of
transmission within and between population groups accounting for variable
sampling rates among population groups. This relative probability is also
refferred to as transmission flows.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_theta_hat(df_counts_and_p_hat, ...)

## Default S3 method:
estimate_theta_hat(df_counts_and_p_hat, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estimate_theta_hat_+3A_df_counts_and_p_hat">df_counts_and_p_hat</code></td>
<td>
<p>A data.frame returned by the function: <code><a href="#topic+estimate_p_hat">estimate_p_hat()</a></code></p>
</td></tr>
<tr><td><code id="estimate_theta_hat_+3A_...">...</code></td>
<td>
<p>Further arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For a population group pairing <code class="reqn">(u,v)</code>, the estimated transmission flows
within and between population groups <code class="reqn">u</code> and <code class="reqn">v</code>, are represented by
the vector theta_hat,
</p>
<p style="text-align: center;"><code class="reqn">\hat{\theta} = ( \hat{\theta}_{uu}, \hat{\theta}_{uv}, \hat{\theta}_{vu}, \hat{\theta}_{vv} ) ,</code>
</p>

<p>and are computed as </p>
<p style="text-align: center;"><code class="reqn">\hat{\theta_{ij}} = Pr(pair from groups (i,j) | pair is linked), where i = u,v and j = u,v ,</code>
</p>

<p style="text-align: center;"><code class="reqn">\hat{\theta_{ij}} = \frac{N_{ij}p_{ij}}{ \sum_m \sum_{n \ge m}N_{mn}p_{mn}}, where i = u,v and j = u,v ,</code>
</p>

<p>See bumblebee website for more details <a href="https://magosil86.github.io/bumblebee/">https://magosil86.github.io/bumblebee/</a>.
</p>


<h3>Value</h3>

<p>Returns a data.frame containing:
</p>

<ul>
<li><p> H1_group, Name of population group 1
</p>
</li>
<li><p> H2_group, Name of population group 2
</p>
</li>
<li><p> number_hosts_sampled_group_1, Number of individuals sampled from population group 1
</p>
</li>
<li><p> number_hosts_sampled_group_2, Number of individuals sampled from population group 2
</p>
</li>
<li><p> number_hosts_population_group_1, Estimated number of individuals in population group 1
</p>
</li>
<li><p> number_hosts_population_group_2, Estimated number of individuals in population group 2
</p>
</li>
<li><p> max_possible_pairs_in_sample, Number of distinct possible transmission pairs between individuals sampled from population groups 1 and 2
</p>
</li>
<li><p> max_possible_pairs_in_population, Number of distinct possible transmission pairs between individuals in population groups 1 and 2
</p>
</li>
<li><p> num_linked_pairs_observed, Number of observed directed transmission pairs between samples from population groups 1 and 2
</p>
</li>
<li><p> p_hat, Probability that pathogen sequences from two individuals randomly sampled from their respective population groups are linked
</p>
</li>
<li><p> est_linkedpairs_in_population, Estimated transmission pairs between population groups 1 and 2
</p>
</li>
<li><p> theta_hat, Estimated transmission flows or relative probability of transmission within and between population groups 1 and 2 adjusted
for sampling heterogeneity. More precisely, the conditional probability that a pair of pathogen sequences is from a specific population
group pairing given that the pair is linked.</p>
</li></ul>



<h3>Methods (by class)</h3>


<ul>
<li> <p><code>default</code>: Estimates conditional probability of linkage (transmission flows)
</p>
</li></ul>


<h3>References</h3>


<ol>
<li><p> Magosi LE, et al., Deep-sequence phylogenetics to quantify patterns of
HIV transmission in the context of a universal testing and treatment
trial – BCPP/ Ya Tsie trial. To submit for publication, 2021.
</p>
</li>
<li><p> Carnegie, N.B., et al., Linkage of viral sequences among HIV-infected
village residents in Botswana: estimation of linkage rates in the
presence of missing data. PLoS Computational Biology, 2014. 10(1):
p. e1003430.
</p>
</li></ol>



<h3>See Also</h3>

<p>See <code><a href="#topic+estimate_p_hat">estimate_p_hat</a></code> to prepare input data to estimate <code>theta_hat</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(bumblebee)
library(dplyr)

# Estimate transmission flows within and between population groups accounting for variable
# sampling among population groups

# We shall use the data of HIV transmissions within and between intervention and control
# communities in the BCPP/Ya Tsie HIV prevention trial. To learn more about the data 
# ?counts_hiv_transmission_pairs and ?sampling_frequency


# Load and view data
#
# The input data comprises counts of observed directed HIV transmission pairs within 
# and between intervention and control communities in the BCPP/Ya Tsie trial,
# sampling information and the probability of linkage between individuals sampled
# from intervention and control communities (i.e. \code{p_hat})
#
# See ?estimate_p_hat() for details on estimating p_hat
results_estimate_p_hat &lt;- estimated_hiv_transmission_flows[, c(1:10)]

results_estimate_p_hat

# Estimate theta_hat
results_estimate_theta_hat &lt;- estimate_theta_hat(df_counts_and_p_hat = results_estimate_p_hat)

# View results
results_estimate_theta_hat

</code></pre>

<hr>
<h2 id='estimate_transmission_flows_and_ci'><code>estimate_transmission_flows_and_ci</code> Estimates transmission flows and corresponding confidence intervals</h2><span id='topic+estimate_transmission_flows_and_ci'></span><span id='topic+flows_and_ci'></span><span id='topic+estimate_transmission_flows_and_ci.default'></span>

<h3>Description</h3>

<p>This function estimates transmission flows or the relative probability
of transmission within and between population groups accounting for
variable sampling among population groups.
</p>
<p>Corresponding confidence intervals are provided with the following methods: Goodman,
Goodman with a continuity correction, Sison-Glaz and Queensbury-Hurst.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_transmission_flows_and_ci(
  group_in,
  individuals_sampled_in,
  individuals_population_in,
  linkage_counts_in,
  ...
)

## Default S3 method:
estimate_transmission_flows_and_ci(
  group_in,
  individuals_sampled_in,
  individuals_population_in,
  linkage_counts_in,
  detailed_report = FALSE,
  verbose_output = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estimate_transmission_flows_and_ci_+3A_group_in">group_in</code></td>
<td>
<p>A character vector indicating population groups/strata (e.g. communities, age-groups, genders or trial arms) between which transmission flows will be evaluated,</p>
</td></tr>
<tr><td><code id="estimate_transmission_flows_and_ci_+3A_individuals_sampled_in">individuals_sampled_in</code></td>
<td>
<p>A numeric vector indicating the number of individuals sampled per population group,</p>
</td></tr>
<tr><td><code id="estimate_transmission_flows_and_ci_+3A_individuals_population_in">individuals_population_in</code></td>
<td>
<p>A numeric vector of the estimated number of individuals per population group,</p>
</td></tr>
<tr><td><code id="estimate_transmission_flows_and_ci_+3A_linkage_counts_in">linkage_counts_in</code></td>
<td>
<p>A data.frame of counts of linked pairs identified between samples of each population
group pairing of interest. <br />
The data.frame should contain the following three fields:
</p>

<ul>
<li><p> H1_group (character) Name of population group 1
</p>
</li>
<li><p> H2_group (character) Name of population group 2
</p>
</li>
<li><p> number_linked_pairs_observed (numeric) Number of
observed directed transmission pairs between samples
from population groups 1 and 2</p>
</li></ul>
</td></tr>
<tr><td><code id="estimate_transmission_flows_and_ci_+3A_...">...</code></td>
<td>
<p>Further arguments.</p>
</td></tr>
<tr><td><code id="estimate_transmission_flows_and_ci_+3A_detailed_report">detailed_report</code></td>
<td>
<p>A boolean value to produce detailed output of the analysis</p>
</td></tr>
<tr><td><code id="estimate_transmission_flows_and_ci_+3A_verbose_output">verbose_output</code></td>
<td>
<p>A boolean value to display intermediate output (Default is <code>FALSE</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Counts of observed directed transmission pairs can be obtained from
deep-sequence phylogenetic data (via phyloscanner) or from known
epidemiological contacts. Note: Deep-sequence data is also commonly
referred to as high-throughput or next-generation sequence data. See
references to learn more about phyloscanner.
</p>
<p>The <code>estimate_transmission_flows_and_ci()</code> function is a
wrapper function that calls the following functions:
</p>

<ol>
<li><p> The <code>prep_p_hat()</code> function to determine all possible
combinations of the population groups/strata provided by
the user. Type <code>?prep_p_hat()</code> at R prompt to learn
more.
</p>
</li>
<li><p> The <code>estimate_p_hat()</code> function to compute the
probability of linkage between pathogen sequences from
two individuals randomly sampled from their respective
population groups. Type <code>?estimate_p_hat()</code> at R
prompt to learn more.
</p>
</li>
<li><p> The <code>estimate_theta_hat()</code> function that uses
<code>p_hat</code> estimates to compute the conditional
probability of linkage that a pair of pathogen sequences
is from a specific population group pairing given that
the pair is linked. The conditional  probability,
<code>theta_hat</code> represents transmission flows or
the relative probability of transmission within and between
population groups adjusted for variable sampling among
population groups. Type <code>?estimate_theta_hat()</code> at R
prompt to learn more.
</p>
</li>
<li><p> The <code>estimate_multinom_ci()</code> function to estimate
corresponding confidence intervals for the computed
transmission flows.
</p>
</li></ol>

<p>Further to estimating transmission flows and corresponding confidence
intervals the <code>estimate_transmission_flows_and_ci()</code> function provides
estimates for:
</p>

<ol>
<li> <p><code>prob_group_pairing_and_linked</code>, the joint probability that a
pair of pathogen sequences is from a specific population group
pairing and linked. Type <code>?estimate_prob_group_pairing_and_linked()</code>
at R prompt to learn more.
</p>
</li>
<li> <p><code>c_hat</code>, the probability of clustering that a pathogen sequence
from a population group of interest is linked to one or more
pathogen sequences in another population group of interest. Type
<code>?estimate_c_hat()</code> at R prompt to learn more.
</p>
</li></ol>



<h3>Value</h3>

<p>Returns a data.frame containing:
</p>

<ul>
<li><p> H1_group, Name of population group 1
</p>
</li>
<li><p> H2_group, Name of population group 2
</p>
</li>
<li><p> number_hosts_sampled_group_1, Number of individuals sampled from population group 1
</p>
</li>
<li><p> number_hosts_sampled_group_2, Number of individuals sampled from population group 2
</p>
</li>
<li><p> number_hosts_population_group_1, Estimated number of individuals in population group 1
</p>
</li>
<li><p> number_hosts_population_group_2, Estimated number of individuals in population group 2
</p>
</li>
<li><p> max_possible_pairs_in_sample, Number of distinct possible transmission pairs between individuals sampled from population groups 1 and 2
</p>
</li>
<li><p> max_possible_pairs_in_population, Number of distinct possible transmission pairs between individuals in population groups 1 and 2
</p>
</li>
<li><p> num_linked_pairs_observed, Number of observed directed transmission pairs between samples from population groups 1 and 2
</p>
</li>
<li><p> p_hat, Probability that pathogen sequences from two individuals randomly sampled from their respective population groups are linked
</p>
</li>
<li><p> est_linkedpairs_in_population, Estimated transmission pairs between population groups 1 and 2
</p>
</li>
<li><p> theta_hat, Estimated transmission flows or relative probability of transmission within and between population groups 1 and 2 adjusted
for sampling heterogeneity. More precisely, the conditional probability that a pair of pathogen sequences is from a specific population
group pairing given that the pair is linked.
</p>
</li>
<li><p> obs_trm_pairs_est_goodman, Point estimate, Goodman method Confidence intervals for observed transmission pairs
</p>
</li>
<li><p> obs_trm_pairs_lwr_ci_goodman, Lower bound of Goodman confidence interval
</p>
</li>
<li><p> obs_trm_pairs_upr_ci_goodman, Upper bound of Goodman confidence interval
</p>
</li>
<li><p> est_goodman, Point estimate, Goodman method Confidence intervals for estimated transmission flows
</p>
</li>
<li><p> lwr_ci_goodman, Lower bound of Goodman confidence interval
</p>
</li>
<li><p> upr_ci_goodman, Upper bound of Goodman confidence interval
</p>
</li></ul>

<p>The following additional fields are returned if the detailed_report flag is set
</p>

<ul>
<li><p> prob_group_pairing_and_linked, Probability that a pair of pathogen sequences is from a specific population group pairing and is linked
</p>
</li>
<li><p> c_hat, Probability that a randomly selected pathogen sequence in one population group links to at least
one pathogen sequence in another population group i.e. probability of clustering
</p>
</li>
<li><p> est_goodman_cc, Point estimate, Goodman method Confidence intervals with continuity correction
</p>
</li>
<li><p> lwr_ci_goodman_cc, Lower bound of Goodman confidence interval
</p>
</li>
<li><p> upr_ci_goodman_cc, Upper bound of Goodman confidence interval
</p>
</li>
<li><p> est_sisonglaz, Point estimate, Sison-Glaz method Confidence intervals
</p>
</li>
<li><p> lwr_ci_sisonglaz, Lower bound of Sison-Glaz confidence interval
</p>
</li>
<li><p> upr_ci_sisonglaz, Upper bound of Sison-Glaz confidence interval
</p>
</li>
<li><p> est_qhurst_acswr, Point estimate, Queensbury-Hurst method Confidence intervals via ACSWR r package
</p>
</li>
<li><p> lwr_ci_qhurst_acswr, Lower bound of Queensbury-Hurst confidence interval
</p>
</li>
<li><p> upr_ci_qhurst_acswr, Upper bound of Queensbury-Hurst confidence interval
</p>
</li>
<li><p> est_qhurst_coinmind, Point estimate, Queensbury-Hurst method Confidence intervals via CoinMinD r package
</p>
</li>
<li><p> lwr_ci_qhurst_coinmind, Lower bound of Queensbury-Hurst confidence interval
</p>
</li>
<li><p> upr_ci_qhurst_coinmind, Upper bound of Queensbury-Hurst confidence interval
</p>
</li>
<li><p> lwr_ci_qhurst_adj_coinmind, Lower bound of Queensbury-Hurst confidence interval adjusted
</p>
</li>
<li><p> upr_ci_qhurst_adj_coinmind, Upper bound of Queensbury-Hurst confidence interval adjusted
</p>
</li></ul>



<h3>Methods (by class)</h3>


<ul>
<li> <p><code>default</code>: Estimates transmission flows and accompanying confidence intervals
</p>
</li></ul>


<h3>References</h3>


<ol>
<li><p> Magosi LE, et al., Deep-sequence phylogenetics to quantify patterns of
HIV transmission in the context of a universal testing and treatment
trial – BCPP/ Ya Tsie trial. To submit for publication, 2021.
</p>
</li>
<li><p> Carnegie, N.B., et al., Linkage of viral sequences among HIV-infected
village residents in Botswana: estimation of linkage rates in the
presence of missing data. PLoS Computational Biology, 2014. 10(1):
p. e1003430.
</p>
</li>
<li><p> Cherry, S., A Comparison of Confidence Interval Methods for Habitat
Use-Availability Studies. The Journal of Wildlife Management, 1996.
60(3): p. 653-658.
</p>
</li>
<li><p> Ratmann, O., et al., Inferring HIV-1 transmission networks and sources of
epidemic spread in Africa with deep-sequence phylogenetic analysis.
Nature Communications, 2019. 10(1): p. 1411.
</p>
</li>
<li><p> Wymant, C., et al., PHYLOSCANNER: Inferring Transmission from Within- and
Between-Host Pathogen Genetic Diversity. Molecular Biology and Evolution,
2017. 35(3): p. 719-733.
</p>
</li>
<li><p> Goodman, L. A. On Simultaneous Confidence Intervals for Multinomial Proportions
Technometrics, 1965. 7, 247-254.
</p>
</li>
<li><p> Sison, C.P and Glaz, J. Simultaneous confidence intervals and sample size determination
for multinomial proportions. Journal of the American Statistical Association,
1995. 90:366-369.
</p>
</li>
<li><p> Glaz, J., Sison, C.P. Simultaneous confidence intervals for multinomial proportions.
Journal of Statistical Planning and Inference, 1999. 82:251-262.
</p>
</li>
<li><p> May, W.L., Johnson, W.D. Constructing two-sided simultaneous confidence intervals for
multinomial proportions for small counts in a large number of cells.
Journal of Statistical Software, 2000. 5(6).
Paper and code available at https://www.jstatsoft.org/v05/i06.
</p>
</li></ol>



<h3>See Also</h3>

<p><code><a href="#topic+estimate_theta_hat">estimate_theta_hat</a></code> and <code><a href="#topic+estimate_multinom_ci">estimate_multinom_ci</a></code> to learn
more about estimation of transmission flows and confidence intervals.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(bumblebee)
library(dplyr)

# Estimate transmission flows and confidence intervals

# We shall use the data of HIV transmissions within and between intervention and control
# communities in the BCPP/Ya Tsie HIV prevention trial. To learn more about the data 
# ?counts_hiv_transmission_pairs and ?sampling_frequency 

# View counts of observed directed HIV transmissions within and between intervention 
# and control communities
counts_hiv_transmission_pairs

# View the estimated number of individuals with HIV in intervention and control 
# communities and the number of individuals sampled from each
sampling_frequency

# Estimate transmission flows within and between intervention and control communities
# accounting for variable sampling among population groups. 

# Basic output
results_estimate_transmission_flows_and_ci &lt;- estimate_transmission_flows_and_ci(
    group_in = sampling_frequency$population_group, 
    individuals_sampled_in = sampling_frequency$number_sampled, 
    individuals_population_in = sampling_frequency$number_population, 
    linkage_counts_in = counts_hiv_transmission_pairs)

# View results
results_estimate_transmission_flows_and_ci

# Retrieve dataset of estimated transmission flows 
dframe &lt;- results_estimate_transmission_flows_and_ci$flows_dataset

# Detailed output
results_estimate_transmission_flows_and_ci_detailed &lt;- estimate_transmission_flows_and_ci(
    group_in = sampling_frequency$population_group, 
	   individuals_sampled_in = sampling_frequency$number_sampled, 
	   individuals_population_in = sampling_frequency$number_population, 
	   linkage_counts_in = counts_hiv_transmission_pairs, 
	   detailed_report = TRUE)

# View results
results_estimate_transmission_flows_and_ci_detailed

# Retrieve dataset of estimated transmission flows 
dframe &lt;- results_estimate_transmission_flows_and_ci_detailed$flows_dataset 

# Options:
# To show intermediate output set verbose_output = TRUE

# Basic output
results_estimate_transmission_flows_and_ci &lt;- estimate_transmission_flows_and_ci(
    group_in = sampling_frequency$population_group, 
	   individuals_sampled_in = sampling_frequency$number_sampled, 
	   individuals_population_in = sampling_frequency$number_population, 
	   linkage_counts_in = counts_hiv_transmission_pairs, 
	   verbose_output = TRUE)

# View results
results_estimate_transmission_flows_and_ci

# Detailed output
results_estimate_transmission_flows_and_ci_detailed &lt;- estimate_transmission_flows_and_ci(
    group_in = sampling_frequency$population_group, 
	   individuals_sampled_in = sampling_frequency$number_sampled, 
	   individuals_population_in = sampling_frequency$number_population, 
	   linkage_counts_in = counts_hiv_transmission_pairs, 
	   detailed_report = TRUE, 
	   verbose_output = TRUE)

# View results
results_estimate_transmission_flows_and_ci_detailed

</code></pre>

<hr>
<h2 id='estimated_hiv_transmission_flows'>Estimated HIV transmission flows</h2><span id='topic+estimated_hiv_transmission_flows'></span>

<h3>Description</h3>

<p>Estimated HIV transmissions within and betweeen intervention and control communities
in the BCPP/Ya Tsie trial population adjusted for variability in sampling.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimated_hiv_transmission_flows
</code></pre>


<h3>Format</h3>

<p>A data frame:
</p>

<dl>
<dt>H1_group</dt><dd><p>Name of population group 1</p>
</dd>
<dt>H2_group</dt><dd><p>Name of population group 2</p>
</dd>
<dt>number_hosts_sampled_group_1</dt><dd><p>Number of individuals sampled from population group 1</p>
</dd>
<dt>number_hosts_sampled_group_2</dt><dd><p>Number of individuals sampled from population group 2</p>
</dd>
<dt>number_hosts_population_group_1</dt><dd><p>Estimated number of individuals in population group 1</p>
</dd>
<dt>number_hosts_population_group_2</dt><dd><p>Estimated number of individuals in population group 2</p>
</dd>
<dt>max_possible_pairs_in_sample</dt><dd><p>Number of distinct possible transmission pairs between individuals sampled from population groups 1 and 2</p>
</dd>
<dt>max_possible_pairs_in_population</dt><dd><p>Number of distinct possible transmission pairs between individuals in population groups 1 and 2</p>
</dd>
<dt>num_linked_pairs_observed</dt><dd><p>Number of observed directed transmission pairs between samples from population groups 1 and 2</p>
</dd>
<dt>p_hat</dt><dd><p>Probability that pathogen sequences from two individuals randomly sampled from their respective population groups are linked</p>
</dd>
<dt>est_linkedpairs_in_population</dt><dd><p>Estimated transmission pairs between population groups 1 and 2</p>
</dd>
<dt>theta_hat</dt><dd><p>Estimated transmission flows or relative probability of transmission within and between population groups 1 and 2 adjusted
for sampling heterogeneity. More precisely, the conditional probability that a pair of pathogen sequences is from a specific population
group pairing given that the pair is linked.</p>
</dd>
<dt>obs_trm_pairs_est_goodman</dt><dd><p>Point estimate, Goodman method Confidence intervals for observed transmission pairs</p>
</dd>
<dt>obs_trm_pairs_lwr_ci_goodman</dt><dd><p>Lower bound of Goodman confidence interval</p>
</dd>
<dt>obs_trm_pairs_upr_ci_goodman</dt><dd><p>Upper bound of Goodman confidence interval</p>
</dd>
<dt>est_goodman</dt><dd><p>Point estimate, Goodman method Confidence intervals for estimated transmission flows</p>
</dd>
<dt>lwr_ci_goodman</dt><dd><p>Lower bound of Goodman confidence interval</p>
</dd>
<dt>upr_ci_goodman</dt><dd><p>Upper bound of Goodman confidence interval</p>
</dd>
<dt>prob_group_pairing_and_linked</dt><dd><p>Probability that a pair of pathogen sequences is from a specific population group pairing and is linked</p>
</dd>
<dt>c_hat</dt><dd><p>Probability that a randomly selected pathogen sequence in one population group links to at least
one pathogen sequence in another population group i.e. probability of clustering</p>
</dd>
<dt>est_goodman_cc</dt><dd><p>Point estimate, Goodman method Confidence intervals with continuity correction</p>
</dd>
<dt>lwr_ci_goodman_cc</dt><dd><p>Lower bound of Goodman confidence interval</p>
</dd>
<dt>upr_ci_goodman_cc</dt><dd><p>Upper bound of Goodman confidence interval</p>
</dd>
<dt>est_sisonglaz</dt><dd><p>Point estimate, Sison-Glaz method Confidence intervals</p>
</dd>
<dt>lwr_ci_sisonglaz</dt><dd><p>Lower bound of Sison-Glaz confidence interval</p>
</dd>
<dt>upr_ci_sisonglaz</dt><dd><p>Upper bound of Sison-Glaz confidence interval</p>
</dd>
<dt>est_qhurst_acswr</dt><dd><p>Point estimate, Queensbury-Hurst method Confidence intervals via ACSWR r package</p>
</dd>
<dt>lwr_ci_qhurst_acswr</dt><dd><p>Lower bound of Queensbury-Hurst confidence interval</p>
</dd>
<dt>upr_ci_qhurst_acswr</dt><dd><p>Upper bound of Queensbury-Hurst confidence interval</p>
</dd>
<dt>est_qhurst_coinmind</dt><dd><p>Point estimate, Queensbury-Hurst method Confidence intervals via CoinMinD r package</p>
</dd>
<dt>lwr_ci_qhurst_coinmind</dt><dd><p>Lower bound of Queensbury-Hurst confidence interval</p>
</dd>
<dt>upr_ci_qhurst_coinmind</dt><dd><p>Upper bound of Queensbury-Hurst confidence interval</p>
</dd>
<dt>lwr_ci_qhurst_adj_coinmind</dt><dd><p>Lower bound of Queensbury-Hurst confidence interval adjusted</p>
</dd>
<dt>upr_ci_qhurst_adj_coinmind</dt><dd><p>Upper bound of Queensbury-Hurst confidence interval adjusted</p>
</dd>
</dl>



<h3>Source</h3>

<p><a href="https://magosil86.github.io/bumblebee/">https://magosil86.github.io/bumblebee/</a>
</p>


<h3>References</h3>

<p>Magosi LE, et al., Deep-sequence phylogenetics to quantify patterns of
HIV transmission in the context of a universal testing and treatment
trial – BCPP/ Ya Tsie trial. To submit for publication, 2021.
</p>

<hr>
<h2 id='prep_p_hat'><code>prep_p_hat</code> Prepares input data to estimate <code>p_hat</code></h2><span id='topic+prep_p_hat'></span><span id='topic+pp'></span><span id='topic+prep_phat'></span><span id='topic+prep_p_hat.default'></span>

<h3>Description</h3>

<p>This function generates variables required for estimating
<code>p_hat</code>, the probability that pathogen sequences from
two individuals randomly sampled from their respective
population groups are linked. For a population group
pairing <code class="reqn">(u,v)</code>, <code>prep_p_hat</code> determines all possible
group pairings i.e. <code class="reqn">(uu, uv, vu, vv)</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prep_p_hat(
  group_in,
  individuals_sampled_in,
  individuals_population_in,
  linkage_counts_in,
  ...
)

## Default S3 method:
prep_p_hat(
  group_in,
  individuals_sampled_in,
  individuals_population_in,
  linkage_counts_in,
  verbose_output = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="prep_p_hat_+3A_group_in">group_in</code></td>
<td>
<p>A character vector indicating population groups/strata
(e.g. communities, age-groups, genders or trial arms) between which
transmission flows will be evaluated,</p>
</td></tr>
<tr><td><code id="prep_p_hat_+3A_individuals_sampled_in">individuals_sampled_in</code></td>
<td>
<p>A numeric vector indicating the number of
individuals sampled per population group,</p>
</td></tr>
<tr><td><code id="prep_p_hat_+3A_individuals_population_in">individuals_population_in</code></td>
<td>
<p>A numeric vector of the estimated number
of individuals per population group,</p>
</td></tr>
<tr><td><code id="prep_p_hat_+3A_linkage_counts_in">linkage_counts_in</code></td>
<td>
<p>A data.frame of counts of linked pairs identified
between samples of each population group pairing of interest. <br />
The data.frame should contain the following three fields:
</p>

<ul>
<li><p> H1_group (character) Name of population group 1
</p>
</li>
<li><p> H2_group (character) Name of population group 2
</p>
</li>
<li><p> number_linked_pairs_observed (numeric) Number of
observed directed transmission pairs between samples
from population groups 1 and 2
</p>
</li></ul>
</td></tr>
<tr><td><code id="prep_p_hat_+3A_...">...</code></td>
<td>
<p>Further arguments.</p>
</td></tr>
<tr><td><code id="prep_p_hat_+3A_verbose_output">verbose_output</code></td>
<td>
<p>A boolean value to display intermediate output.
(Default is <code>FALSE</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Counts of observed directed transmission pairs can be obtained from
deep-sequence phylogenetic data (via phyloscanner) or from known
epidemiological contacts. Note: Deep-sequence data is also commonly
referred to as high-throughput or next-generation sequence data. See
references to learn more about phyloscanner.
</p>


<h3>Value</h3>

<p>Returns a data.frame containing:
</p>

<ul>
<li><p> H1_group, Name of population group 1
</p>
</li>
<li><p> H2_group, Name of population group 2
</p>
</li>
<li><p> number_hosts_sampled_group_1, Number of individuals sampled
from population group 1
</p>
</li>
<li><p> number_hosts_sampled_group_2, Number of individuals sampled
from population group 2
</p>
</li>
<li><p> number_hosts_population_group_1, Estimated number of individuals
in population group 1
</p>
</li>
<li><p> number_hosts_population_group_2, Estimated number of individuals
in population group 2
</p>
</li>
<li><p> max_possible_pairs_in_sample, Number of distinct possible transmission
pairs between individuals sampled from population groups 1 and 2
</p>
</li>
<li><p> max_possible_pairs_in_population, Number of distinct possible
transmission pairs between individuals in population groups 1 and 2
</p>
</li>
<li><p> num_linked_pairs_observed, Number of observed directed transmission
pairs between samples from population groups 1 and 2
</p>
</li></ul>



<h3>Methods (by class)</h3>


<ul>
<li> <p><code>default</code>: Prepares input data to estimate <code>p_hat</code>
</p>
</li></ul>


<h3>References</h3>


<ol>
<li><p> Magosi LE, et al., Deep-sequence phylogenetics to quantify patterns of
HIV transmission in the context of a universal testing and treatment
trial – BCPP/ Ya Tsie trial. To submit for publication, 2021.
</p>
</li>
<li><p> Ratmann, O., et al., Inferring HIV-1 transmission networks and
sources of epidemic spread in Africa with deep-sequence phylogenetic
analysis. Nature Communications, 2019. 10(1): p. 1411.
</p>
</li>
<li><p> Wymant, C., et al., PHYLOSCANNER: Inferring Transmission from Within
and Between-Host Pathogen Genetic Diversity. Molecular Biology and
Evolution, 2017. 35(3): p. 719-733.
</p>
</li></ol>



<h3>See Also</h3>

<p><code><a href="#topic+estimate_p_hat">estimate_p_hat</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(bumblebee)
library(dplyr)

# Prepare input to estimate p_hat

# We shall use the data of HIV transmissions within and between intervention and control
# communities in the BCPP/Ya Tsie HIV prevention trial. To learn more about the data 
# ?counts_hiv_transmission_pairs and ?sampling_frequency 

# View counts of observed directed HIV transmissions within and between intervention 
# and control communities
counts_hiv_transmission_pairs

# View the estimated number of individuals with HIV in intervention and control 
# communities and the number of individuals sampled from each
sampling_frequency

results_prep_p_hat &lt;- prep_p_hat(group_in = sampling_frequency$population_group, 
                                 individuals_sampled_in = sampling_frequency$number_sampled, 
                                 individuals_population_in = sampling_frequency$number_population, 
                                 linkage_counts_in = counts_hiv_transmission_pairs, 
                                 verbose_output = TRUE)

# View results
results_prep_p_hat

</code></pre>

<hr>
<h2 id='sampling_frequency'>Sampling fequency</h2><span id='topic+sampling_frequency'></span>

<h3>Description</h3>

<p>Estimated number of individuals with HIV in intervention and control communities
of the BCPP/Ya Tsie trial, and the number of individuals sampled from each for
HIV viral phylogenetic analysis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sampling_frequency
</code></pre>


<h3>Format</h3>

<p>A data frame:
</p>

<dl>
<dt>population_group</dt><dd><p>Population group</p>
</dd>
<dt>number_sampled</dt><dd><p>Number of individuals sampled per population group</p>
</dd>
<dt>number_population</dt><dd><p>Estimated number of individuals in each population group</p>
</dd>
</dl>



<h3>Source</h3>

<p><a href="https://magosil86.github.io/bumblebee/">https://magosil86.github.io/bumblebee/</a>
</p>


<h3>References</h3>

<p>Magosi LE, et al., Deep-sequence phylogenetics to quantify patterns of
HIV transmission in the context of a universal testing and treatment
trial – BCPP/ Ya Tsie trial. To submit for publication, 2021.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
