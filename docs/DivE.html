<!DOCTYPE html><html lang="en"><head><title>Help for package DivE</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {DivE}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#DivE-package'>
<p>Diversity Estimator</p></a></li>
<li><a href='#Bact1'>
<p>Count of Medically Important Bacteria Species in a Sample</p></a></li>
<li><a href='#CombDM'>
<p>CombDM</p></a></li>
<li><a href='#Curvature'>
<p>Curvature</p></a></li>
<li><a href='#DiveMaster'>
<p>DiveMaster</p></a></li>
<li><a href='#DivSampleNum'>
<p>DivSampleNum</p></a></li>
<li><a href='#DivSubsamples'>
<p>DivSubsamples</p></a></li>
<li><a href='#FitSingleMod'>
<p>FitSingleMod</p></a></li>
<li><a href='#ModelSet'>
<p>List of 58 candidate models to fit to data</p></a></li>
<li><a href='#ParamRanges'>
<p>List of 58 sets of upper and lower bounds for models evaluated by DivE</p></a></li>
<li><a href='#ParamSeeds'>
<p>List of 58 matrices of model seeding parameters.</p></a></li>
<li><a href='#PopDiversity'>
<p>PopDiversity</p></a></li>
<li><a href='#ScoreSingleMod'>
<p>ScoreSingleMod</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Diversity Estimator</td>
</tr>
<tr>
<td>Version:</td>
<td>1.3</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-10-13</td>
</tr>
<tr>
<td>Author:</td>
<td>Daniel J. Laydon, Aaron Sim, Charles R.M. Bangham, Becca Asquith</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Daniel Laydon &lt;d.laydon@imperial.ac.uk&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>deSolve, FME, sp, R (&ge; 2.15.3)</td>
</tr>
<tr>
<td>Description:</td>
<td>Contains functions for the 'DivE' estimator &lt;<a href="https://doi.org/10.1371%2Fjournal.pcbi.1003646">doi:10.1371/journal.pcbi.1003646</a>&gt;. The 'DivE' estimator is a heuristic approach to estimate the number of classes or the number of species (species richness) in a population. </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>LazyData:</td>
<td>TRUE</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-10-13 15:09:23 UTC; dlaydon</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-10-14 13:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='DivE-package'>
Diversity Estimator
</h2><span id='topic+DivE-package'></span><span id='topic+DivE'></span>

<h3>Description</h3>

<p>R-package <em>DivE</em> contains functions for the DivE estimator (Laydon, D.J. <em>et al.</em>, Quantification of HTLV-1 clonality and TCR diversity, PLOS Comput. Biol. 2014). The <em>DivE</em> estimator is a heuristic approach to estimate the number of classes or the number of species (species richness) in a population. 
</p>
<p><em>DivE</em> fits many mathematical models to multiple nested subsamples of individual-based rarefaction curves. These curves depict the expected number of species as a function of the number of individuals (e.g. T cells, virions, microbes). Each model is fitted to all nested subsamples, producing multiple model fits. Novel criteria are used to score each model in how consistently its fits reproduce the full observed rarefaction curve from the nested subsamples, i.e. from only incomplete data. The best performing models are extrapolated to a desired population size, and their estimates are aggregated to estimate the number of classes in the population. 
</p>
<p>The package contains: 
</p>
<p>1. functions to generate individual-based rarefaction (species-accumulation) data, and evaluate their curvature
</p>
<p>2. functions to fit mathematical models to rarefaction data and nested subsamples thereof. These functions make extensive use of the R-package <em>FME</em> (http://cran.r-project.org/web/packages/FME/index.html)
</p>
<p>3. functions to evaluate novel criteria for each model
</p>
<p>4. functions to score competing models
</p>
<p>5. a function to produce final estimates of the number of classes (diversity)
</p>
<p>6. example candidate models, fitted parameters, parameter ranges, and an example data set
</p>
<p>7. an example script. We have attempted to make the code flexible to users who require varying levels of detail and control. The simplest way to use the package is the DiveMaster function. This function is a wrapper around other functions provided with the <em>DivE</em> package and will create subsamples (function <code>DivSubsamples</code>), fit models (function <code>FitSingleMod</code>), score models (function <code>ScoreSingleMod</code>) and produce final diversity/species richness estimates (function <code>PopDiversity</code>). 
</p>
<p>The novel criteria against which each model fit is scored are:
</p>
<p><b>Discrepancy</b> &ndash; the mean percentage error between data points and model prediction.
</p>
<p><b>Accuracy</b> &ndash; the percentage error between the full sample species richness, and the estimate of full sample species richness from a given subsample. 
</p>
<p><b>Similarity</b> &ndash; the area between the curve fitted to a subsample and the curve fitted to the full sample, normalized to the area under the curve from the full data, on the interval [0, <em>Nobs</em>], where <em>Nobs</em> is the size of the full data.
</p>
<p><b>Plausibility</b> &ndash; the predicted number of species must either increase monotonically or plateau and the predicted rate of species accumulation must either decrease or plateau (i.e. for <code class="reqn">S(x)</code> and <code class="reqn">x \ge 1</code>, where <code class="reqn">x</code> is the number of individuals, <code class="reqn">S'(x) \ge 0</code>, and <code class="reqn">S''(x) \le 0</code>).  
</p>
<p>The rationale behind each criterion is as follows:
</p>
<p><em>Discrepancy</em> &ndash; the model must describe the data to which it was fitted. 
</p>
<p><em>Accuracy</em> &ndash; from a subsample, the model should predict the full sample species richness. 
</p>
<p><em>Similarity</em> &ndash; an ideal model will produce identical fits from all subsamples. The smaller the area between the model fits, the better the model. 
</p>
<p><em>Plausibility</em> &ndash;  this criterion requires that, as the observed number of individuals increases, the observed number of species does not decrease and the rate of species-accumulation does not increase; the former is impossible and the latter is implausible.
</p>
<p><b>Population Size</b>
</p>
<p><em>DivE</em> requires an estimate of population size, i.e. the number of individuals in the population for which the number of species is desired. Population size is a necessary input for species richness estimation when it is not appropriate to assume a saturating relationship between population size and species richness. 
</p>
<p>In spatially homogeneous populations with equiprobable detection of individuals, population size can be estimated through scaling by area or volume e.g. scaling from cells in 50ml of blood to cells in the total blood volume. When population size estimates are unavailable, it is still usually possible to provide meaningful diversity estimates, e.g. the number of species per gram of tissue.
</p>
<p><b>Requirements</b>
</p>
<p>Many deep sequencing data consist of relative abundance of classes or species. We caution that <em>DivE</em> requires data detailing the absolute counts of each class or species: relative abundances are insufficient. Rarefaction curves are highly sensitive to the scaling factor applied to relative abundances. Scaling factors that are too high greatly overestimate the degree of repetition of species in the sample, falsely implying that the sample contains a more comprehensive census, and ultimately affecting the resulting estimates of species richness. Absolute counts can usually be obtained when data are being collected (for further details, please see Laydon, D. <em>et al.</em>).
</p>
<p><em>DivE</em> requires data where each individual has been sampled randomly, independently and with an equal probability of detection, and where the underlying distribution of individuals is spatially homogeneous. Reliable extrapolation of rarefaction curves is only possible where these conditions are met. DivE is a heuristic estimator designed for use in immunological and microbiological populations, but can be used in any system where the above conditions are satisfied, and for which an estimate of population size is available (for further details, please see Laydon, D. <em>et al.</em>). 
</p>
<p>We have attempted to identify conditions under which DivE is prone to error and should not be applied. When the observed rarefaction curve is linear, the data imply a constant rate of species accumulation, and so provide little information on how quickly the rate of species accumulation will decrease. This is usually indicative of severe under-sampling. We quantified the deviation from linearity of the observed rarefaction curve using the curvature parameter Cp. This parameter can take values between 0 and 1, where 1 reflects perfect saturation and 0 reflects a constant rate of species accumulation. We recommend, based on our simulations, that DivE should not be applied when Cp &lt; 0.1. Low curvatures suggest severe under-sampling and researchers should exercise caution when using any diversity estimator with such data. We have included a function <code>Curvature</code> to evaluate the approximate curvature of the rarefaction curve. 
</p>
<p><b>Model Fitting Process</b>
</p>
<p>The pseudo-random model fitting algorithm included with <em>DivE</em> (from R package <em>FME</em>) requires that parameter ranges and parameter seeding values be inputted. The runtime incurred in model fitting increases with the size of the parameter space. The need for parameter ranges small enough to yield precise parameter estimates in relatively short runtimes must be balanced against the need for parameter ranges that adequately encompass appropriate parameter values for data of different scales. We have included parameter ranges and seeding values that have performed well in our analyses, which the user can use or amend as required. 
</p>
<p>The performance of <code>modFit</code> (package <em>FME</em>) with the pseudorandom parameter search algorithm (package <em>FME</em>, <code>pseudoOptim</code>) used to estimated model parameter values, is sensitive to the choice of initial seeding values. We have provided the fitted parameters returned from our simulations to be used as initial seeding parameters. For each model, each initial parameter guess (i.e. each row of the model matrix in ModelSeeds) is evaluated by to <code>modCost</code>. The parameter guess returning the lowest cost is used as the seeding value in <em>modFit</em>.
</p>
<p>To obtain better parameter fits, the fitting process can be repeated. Fitted parameters from a single subsample may provide a better seeding guess for a fit to a subsequent subsample than the initial parameter seeds originally inputted, and thus better final model fits will be produced. In our analyses, two attempts of the fitting process (argument <code>fitloops</code> in <code>DiveMaster</code>) were usually sufficient.
</p>
<p><b>Contact</b>
</p>
<p>Daniel J. Laydon, Section of Immunology, Division of Infectious Diseases, Department of Medicine, Imperial College London, Wright-Fleming Institute, Norfolk Place, W2 1PG
</p>
<p>d.laydon@imperial.ac.uk
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> DivE</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.1</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2019-08-17</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL (&gt;= 2) </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>The main function is DiveMaster, which combines the four functions DivSampleNum, DivSubsamples, FitSingleMod, and ScoreSingleMod. An example script using both DiveMaster and the four component functions can be found in the <em>demo</em> folder in the source.
</p>


<h3>Author(s)</h3>

<p>Daniel J. Laydon, Aaron Sim, Charles R.M. Bangham, Becca Asquith
</p>


<h3>References</h3>

<p>Laydon, D. J., Melamed, A., Sim, A., Gillet, N. A., Sim, K., Darko, S., Kroll, S., Douek, D. C., Price, D., Bangham, C. R. M., Asquith, B., Quantification of HTLV-1 clonality and TCR diversity, PLOS Comput. Biol. 2014
</p>

<hr>
<h2 id='Bact1'>
Count of Medically Important Bacteria Species in a Sample
</h2><span id='topic+Bact1'></span><span id='topic+Bact2'></span>

<h3>Description</h3>

<p>This gives a fictitious example of a sample of 7814 bacteria comprising of 144 unique species. Designed as a test dataset for the DivE diversity estimation algorithm.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(Bact1)</code></pre>


<h3>Format</h3>

<p>A data frame with 144 observations on the following 2 variables.
</p>

<dl>
<dt><code>Bacteria</code></dt><dd><p>a factor with levels <code>Acetobacter_aurantius</code> <code>Acinetobacter_baumannii</code> <code>Actinomyces_israelii</code> <code>Agrobacterium_radiobacter</code> <code>Agrobacterium_tumefaciens</code> <code>Anaplasma</code> <code>Azorhizobium_caulinodans</code> <code>Azotobacter_vinelandii</code> <code>Bacillus_anthracis</code> <code>Bacillus_brevis</code> <code>Bacillus_cereus</code> <code>Bacillus_fusiformis</code> <code>Bacillus_licheniformis</code> <code>Bacillus_megaterium</code> <code>Bacillus_mycoides</code> <code>Bacillus_stearothermophilus</code> <code>Bacillus_subtilis</code> <code>Bacteroides_fragilis</code> <code>Bacteroides_gingivalis</code> <code>Bacteroides_melaninogenicus</code> <code>Bartonella_henselae</code> <code>Bartonella_quintana</code> <code>Bordetella_bronchiseptica</code> <code>Bordetella_pertussis</code> <code>Borrelia_burgdorferi</code> <code>Brucella_abortus</code> <code>Brucella_melitensis</code> <code>Brucella_suis</code> <code>Burkholderia_cepacia</code> <code>Burkholderia_mallei</code> <code>Burkholderia_pseudomallei</code> <code>Calymmatobacterium_granulomatis</code> <code>Campylobacter_coli</code> <code>Campylobacter_fetus</code> <code>Campylobacter_jejuni</code> <code>Campylobacter_pylori</code> <code>Chlamydia_trachomatis</code> <code>Chlamydophila_pneumoniae</code> <code>Chlamydophila_psittaci</code> <code>Clostridium_botulinum</code> <code>Clostridium_difficile</code> <code>Clostridium_perfringens</code> <code>Clostridium_tetani</code> <code>Corynebacterium_diphtheriae</code> <code>Corynebacterium_fusiforme</code> <code>Coxiella_burnetii</code> <code>Ehrlichia_chaffeensis</code> <code>Enterobacter_cloacae</code> <code>Enterococcus_avium</code> <code>Enterococcus_durans</code> <code>Enterococcus_faecalis</code> <code>Enterococcus_faecium</code> <code>Enterococcus_galllinarum</code> <code>Enterococcus_maloratus</code> <code>Escherichia coli</code> <code>Francisella tularensis</code> <code>Fusobacterium_nucleatum</code> <code>Gardnerella_vaginalis</code> <code>Haemophilus_ducreyi</code> <code>Haemophilus_influenzae</code> <code>Haemophilus_parainfluenzae</code> <code>Haemophilus_pertussis</code> <code>Haemophilus_vaginalis</code> <code>Helicobacter_pylori</code> <code>Klebsiella_pneumoniae</code> <code>Lactobacillus_Bulgaricus</code> <code>Lactobacillus_acidophilus</code> <code>Lactobacillus_casei</code> <code>Lactococcus_lactis</code> <code>Legionella_pneumophila</code> <code>Listeria_monocytogenes</code> <code>Methanobacterium_extroquens</code> <code>Microbacterium_multiforme</code> <code>Micrococcus_luteus</code> <code>Moraxella_catarrhalis</code> <code>Mycobacterium</code> <code>Mycobacterium_avium</code> <code>Mycobacterium_bovis</code> <code>Mycobacterium_diphtheriae</code> <code>Mycobacterium_intracellulare</code> <code>Mycobacterium_leprae</code> <code>Mycobacterium_lepraemurium</code> <code>Mycobacterium_phlei</code> <code>Mycobacterium_smegmatis</code> <code>Mycobacterium_tuberculosis</code> <code>Mycoplasma_fermentans</code> <code>Mycoplasma_genitalium</code> <code>Mycoplasma_hominis</code> <code>Mycoplasma_penetrans</code> <code>Mycoplasma_pneumoniae</code> <code>Neisseria_gonorrhoeae</code> <code>Neisseria_meningitidis</code> <code>Pasteurella_multocida</code> <code>Pasteurella_tularensis</code> <code>Peptostreptococcus</code> <code>Porphyromonas_gingivalis</code> <code>Pseudomonas_aeruginosa</code> <code>Rhizobium_radiobacter</code> <code>Rickettsia_prowazekii</code> <code>Rickettsia_psittaci</code> <code>Rickettsia_quintana</code> <code>Rickettsia_rickettsii</code> <code>Rickettsia_trachomae</code> <code>Rochalimaea</code> <code>Rochalimaea_henselae</code> <code>Rochalimaea_quintana</code> <code>Rothia_dentocariosa</code> <code>Salmonella_enteritidis</code> <code>Salmonella_typhi</code> <code>Salmonella_typhimurium</code> <code>Serratia_marcescens</code> <code>Shigella_dysenteriae</code> <code>Staphylococcus_aureus</code> <code>Staphylococcus_epidermidis</code> <code>Stenotrophomonas_maltophilia</code> <code>Streptococcus_agalactiae</code> <code>Streptococcus_avium</code> <code>Streptococcus_bovis</code> <code>Streptococcus_cricetus</code> <code>Streptococcus_faceium</code> <code>Streptococcus_faecalis</code> <code>Streptococcus_ferus</code> <code>Streptococcus_gallinarum</code> <code>Streptococcus_lactis</code> <code>Streptococcus_mitior</code> <code>Streptococcus_mitis</code> <code>Streptococcus_mutans</code> <code>Streptococcus_oralis</code> <code>Streptococcus_pneumoniae</code> <code>Streptococcus_pyogenes</code> <code>Streptococcus_rattus</code> <code>Streptococcus_salivarius</code> <code>Streptococcus_sanguis</code> <code>Streptococcus_sobrinus</code> <code>Treponema_denticola</code> <code>Treponema_pallidum</code> <code>Vibrio_cholerae</code> <code>Vibrio_comma</code> <code>Vibrio_parahaemolyticus</code> <code>Vibrio_vulnificus</code> <code>Wolbachia</code> <code>Yersinia_enterocolitica</code> <code>Yersinia_pestis</code> <code>Yersinia_pseudotuberculosis</code></p>
</dd>
<dt><code>Count</code></dt><dd><p>a numeric vector</p>
</dd>
</dl>



<h3>References</h3>

<p>Laydon, D. J., Melamed, A., Sim, A., Gillet, N. A., Sim, K., Darko, S., Kroll, S., Douek, D. C., Price, D., Bangham, C. R. M., Asquith, B., Quantification of HTLV-1 clonality and TCR diversity, PLOS Comput. Biol. 2014
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Bact1)

hist(Bact1[,2], breaks=20, main="Bacterial diversity of a sample",
xlab="Number of bacteria of a given species", ylab="Number of bacterial species")
</code></pre>

<hr>
<h2 id='CombDM'>
CombDM
</h2><span id='topic+CombDM'></span>

<h3>Description</h3>

<p>Implements the DivE diversity estimator. Combines multiple objects of class <em>DiveMaster</em>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CombDM(dmlist)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="CombDM_+3A_dmlist">dmlist</code></td>
<td>

<p>list of objects of class <em>DiveMaster</em>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><em>CombDM</em> combines multiple objects of class <em>DiveMaster</em>. Function used if <em>DivE</em> estimation has been split into multiple, separate calls to <code>DiveMaster</code>.
</p>


<h3>Value</h3>

<p>An object of class <em>DiveMaster</em>, i.e. a list of objects
</p>
<table role = "presentation">
<tr><td><code>model.score</code></td>
<td>
<p>a matrix of aggregated model scores</p>
</td></tr>
<tr><td><code>fmm</code></td>
<td>
<p>a list of <em>fitsingMod</em> objects corresponding to the list of fitted models</p>
</td></tr>
<tr><td><code>ssm</code></td>
<td>
<p>a matrix of scores of the fit of the models corresponding to the list of fitted models</p>
</td></tr>
<tr><td><code>estimate</code></td>
<td>
<p>the estimate of species richness (number of species/classes or diversity) at population size <code>tot.pop</code>. This is the geometric average of the models corresponding to the top-five model scores. This is recalculated based on the combined list of models</p>
</td></tr>
<tr><td><code>lower_estimate</code></td>
<td>
<p>as per estimate value, but the lowest prediction amongst the models having the top-five scores. This is recalculated based on the combined list of models</p>
</td></tr>
<tr><td><code>upper_estimate</code></td>
<td>
<p>as per estimate value, but the highest prediction amongst the models having the top-five scores. This is recalculated based on the combined list of models</p>
</td></tr>
<tr><td><code>models</code></td>
<td>
<p>list of original input models</p>
</td></tr>
<tr><td><code>m</code></td>
<td>
<p>number of topscoring models used for diversity estimate. This is set as the smallest <code>m</code> value of each of the <em>DiveMaster</em> objects in the list</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Daniel J. Laydon, Aaron Sim, Charles R.M. Bangham, Becca Asquith
</p>


<h3>References</h3>

<p>Laydon, D. J., Melamed, A., Sim, A., Gillet, N. A., Sim, K., Darko, S., Kroll, S., Douek, D. C., Price, D., Bangham, C. R. M., Asquith, B., Quantification of HTLV-1 clonality and TCR diversity, PLOS Comput. Biol. 2014
</p>


<h3>See Also</h3>

<p><code><a href="#topic+DiveMaster">DiveMaster</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># See DiveMaster documentation for examples.
</code></pre>

<hr>
<h2 id='Curvature'>
Curvature
</h2><span id='topic+Curvature'></span>

<h3>Description</h3>

<p>Calculates the curvature of the rarefaction curve of the full observed data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Curvature(dss)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Curvature_+3A_dss">dss</code></td>
<td>

<p>list of objects of class <em>DivSubsamples</em>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>Curvature</code> calculates the curvature of the full observed data. If <code>dss</code> contains more than one subsample (i.e. if length(<code>dss</code>)&gt;1), the curvature of the largest subsample is calculated. If the curvature value is <code class="reqn">&lt; 0.1</code>, researchers should exercise caution as this is indicative of severe under-sampling, in which case DivE is prone to error. 
</p>


<h3>Value</h3>

<p><em>numeric</em>, between 0 and 1
</p>


<h3>Author(s)</h3>

<p>Daniel J. Laydon, Aaron Sim, Charles R.M. Bangham, Becca Asquith
</p>


<h3>References</h3>

<p>Laydon, D. J., Melamed, A., Sim, A., Gillet, N. A., Sim, K., Darko, S., Kroll, S., Douek, D. C., Price, D., Bangham, C. R. M., Asquith, B., Quantification of HTLV-1 clonality and TCR diversity, PLOS Comput. Biol. 2014
</p>


<h3>See Also</h3>

<p><code><a href="#topic+DivSubsamples">DivSubsamples</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># See DivSubsamples documentation for examples.
</code></pre>

<hr>
<h2 id='DiveMaster'>
DiveMaster
</h2><span id='topic+DiveMaster'></span><span id='topic+print.DiveMaster'></span><span id='topic+summary.DiveMaster'></span><span id='topic+print.summary.DiveMaster'></span>

<h3>Description</h3>

<p>Implements the DivE diversity estimator.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>DiveMaster(models, init.params, param.ranges, main.samp,
           tot.pop=(100*(DivSampleNum(main.samp,2)[1])), numit=10^5,
           varleft=1e-8, subsizes=6, dssamps=list(), nrf=1, minrarefac=1,
           NResamples=1000, minplaus=10,
           precision.lv=c(0.0001, 0.005, 0.005), plaus.pen=500,
           crit.wts=c(1.0, 1.0, 1.0, 1.0), fitloops=2, numpred=5)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="DiveMaster_+3A_models">models</code></td>
<td>

<p>list of models; each model is written as a function: function(x, params) { with(as.list(params), &lt;<em>function of params</em>&gt;)}. Examples are given in the ModelSet data file as part of the DivE package.
</p>
</td></tr>
<tr><td><code id="DiveMaster_+3A_init.params">init.params</code></td>
<td>

<p>list of matrices of initial seed model parameters. For each matrix, each row represents a given parameter set; each column represents a parameter value. Column names must match parameter names (params) in the corresponding model in the list <code>models</code>. Examples are given in the ParamSeeds data file as part of the DivE package.
</p>
</td></tr>
<tr><td><code id="DiveMaster_+3A_param.ranges">param.ranges</code></td>
<td>

<p>list of matrices of lower and upper model parameters bounds. Used for the modFit function. The first and second row corresponds to the lower and upper bounds respectively; each column represents a parameter value. Column names must match parameter names (params) in the corresponding model in the list <code>models</code>. Examples are given in the param.ranges data file as part of the DivE package.
</p>
</td></tr>
<tr><td><code id="DiveMaster_+3A_main.samp">main.samp</code></td>
<td>

<p>the main sample, either as a 2-column data.frame (species ID, count of species), or a vector of species IDs.
</p>
</td></tr>
<tr><td><code id="DiveMaster_+3A_tot.pop">tot.pop</code></td>
<td>

<p>total population (integer); default set to 100x the <code>main.samp</code> size.
</p>
</td></tr>
<tr><td><code id="DiveMaster_+3A_numit">numit</code></td>
<td>

<p>control argument passed to optimisation routine; the maximum number of iterations that modFit will perform. See <code><a href="FME.html#topic+modFit">modFit</a></code> for details.
</p>
</td></tr>
<tr><td><code id="DiveMaster_+3A_varleft">varleft</code></td>
<td>

<p>control argument passed to optimisation routine; see <code><a href="FME.html#topic+modFit">modFit</a></code> for details.
</p>
</td></tr>
<tr><td><code id="DiveMaster_+3A_subsizes">subsizes</code></td>
<td>

<p>either number of nested subsamples (integer, must be 2 or greater), or a vector of nested sample lengths. If the former, then the vector of sample lengths will be created using the <em>DivSampleNum</em> function.
</p>
</td></tr>
<tr><td><code id="DiveMaster_+3A_dssamps">dssamps</code></td>
<td>

<p>list of user specified rarefaction data <em>DivSubsamples</em> objects. The length of each component vector of each object in the list must correspond to the vector of nested sample lengths (as defined by the user in <code>subsizes</code>).
</p>
</td></tr>
<tr><td><code id="DiveMaster_+3A_nrf">nrf</code></td>
<td>

<p>difference between lengths of successive rarefaction datapoints.
</p>
</td></tr>
<tr><td><code id="DiveMaster_+3A_minrarefac">minrarefac</code></td>
<td>

<p>minimum rarefaction x-axis value. This argument is not used if list of <em>DivSubsamples</em> object is specified in <code>dssamps</code>.
</p>
</td></tr>
<tr><td><code id="DiveMaster_+3A_nresamples">NResamples</code></td>
<td>

<p>number of resamples used to calculate the rarefaction data. This parameter is not used if list of <em>DivSubsamples</em> object is specified in <code>dssamps</code>.
</p>
</td></tr>
<tr><td><code id="DiveMaster_+3A_minplaus">minplaus</code></td>
<td>

<p>lower x-axis bound for plausibility check.
</p>
</td></tr>
<tr><td><code id="DiveMaster_+3A_precision.lv">precision.lv</code></td>
<td>

<p>vector of precision level values for each criterion: 1. discrepancy &ndash; mean percentage error between rarefaction data points and model predicion, 2. Sample accuracy &ndash; percentage error between observed diversity of full rarefaction data and estimated diversity of full data from subsample, 3. local similarity. The scores for each criteria are defined as 1 + (multiples of bin sizes)
</p>
</td></tr>
<tr><td><code id="DiveMaster_+3A_plaus.pen">plaus.pen</code></td>
<td>

<p>penalty score for breaking the plausibility criterion: a model fit should be monotonically increasing and should have a slowing rate of species accumulation.
</p>
</td></tr>
<tr><td><code id="DiveMaster_+3A_crit.wts">crit.wts</code></td>
<td>

<p>vector of weights of each of the four scoring criteria &ndash; fit, accuracy, similarity, plausibility. Default is c(1,1,1,1).
</p>
</td></tr>
<tr><td><code id="DiveMaster_+3A_fitloops">fitloops</code></td>
<td>

<p>number of fitting rounds performed for each model. In each round of fitting, the initial seed parameter values for each model will be the fitted parameters of the previous fitting run. This parameter has a significant impact on the computational time. The &lsquo;sweet spot&rsquo; is 2.
</p>
</td></tr>
<tr><td><code id="DiveMaster_+3A_numpred">numpred</code></td>
<td>

<p>number of topscoring models used for diversity prediction. Default is 5.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is the master function of the DivE estimator. The default operation is a combination of four steps. 1. Generate a list of nested samples lengths from the main sample. 2. For each nested subsample, generate a vector of rarefaction data and their associated mean species diversity. 3. Fit to the generated data a set of models. 4. Evaluate the fits according to the DivE diversity estimation methodology and compare the scores across models and fitting criteria.
</p>
<p>A list of DiveMaster objects, each representing the fits to different sets of models, can combined into a single DiveMaster object using the <code>CombDM</code> function. This is useful when running the DivE estimator with the full set of 58 models in a single run is not possible.
</p>
<p>One can estimate the diversity for a given population using the <code>PopDiversity</code> function where the arguments are the Divemaster object and the population size respectively.
</p>


<h3>Value</h3>

<p>A list of objects:
</p>
<table role = "presentation">
<tr><td><code>model.score</code></td>
<td>
<p>a matrix of aggregated model scores</p>
</td></tr>
<tr><td><code>fmm</code></td>
<td>
<p>a list of <em>fitsingMod</em> objects corresponding to the list of fitted models</p>
</td></tr>
<tr><td><code>ssm</code></td>
<td>
<p>a matrix of scores of the fit of the models corresponding to the list of fitted models</p>
</td></tr>
<tr><td><code>estimate</code></td>
<td>
<p>the estimate of species richness (number of species/classes or diversity) at population size <code>tot.pop</code>. This is the geometric average of the models corresponding to the top-five model scores</p>
</td></tr>
<tr><td><code>lower_estimate</code></td>
<td>
<p>as per estimate value, but the lowest prediction amongst the models having the top-five scores</p>
</td></tr>
<tr><td><code>upper_estimate</code></td>
<td>
<p>as per estimate value, but the highest prediction amongst the models having the top-five scores</p>
</td></tr>
<tr><td><code>models</code></td>
<td>
<p>list of original input models</p>
</td></tr>
<tr><td><code>m</code></td>
<td>
<p>number of topscoring models used for diversity estimate</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Daniel J. Laydon, Aaron Sim, Charles R.M. Bangham, Becca Asquith
</p>


<h3>References</h3>

<p>Laydon, D. J., Melamed, A., Sim, A., Gillet, N. A., Sim, K., Darko, S., Kroll, S., Douek, D. C., Price, D., Bangham, C. R. M., Asquith, B., Quantification of HTLV-1 clonality and TCR diversity, PLOS Comput. Biol. 2014
</p>


<h3>See Also</h3>

<p><code><a href="#topic+FitSingleMod">FitSingleMod</a></code>, <code><a href="#topic+ScoreSingleMod">ScoreSingleMod</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>require(DivE)
data(Bact1)
data(ModelSet)
data(ParamSeeds)
data(ParamRanges)

testmodels &lt;- list()
testmeta &lt;- list()
paramranges &lt;- list()

# Choose a single model 
testmodels &lt;- c(testmodels, ModelSet[1])
#testmeta[[1]] &lt;- (ParamSeeds[[1]]) # Commented out for sake of brevity)
testmeta[[1]] &lt;- matrix(c(0.9451638, 0.007428265, 0.9938149, 1.0147441, 0.009543598, 0.9870419),
                        nrow=2, byrow=TRUE, dimnames=list(c(), c("a1", "a2", "a3"))) # Example seeds
paramranges[[1]] &lt;- ParamRanges[[1]]


# Create DivSubsamples object (NB: For quick illustration only -- not default parameters)
dss_1 &lt;- DivSubsamples(Bact1, nrf=2, minrarefac=1, maxrarefac=40, NResamples=5)
dss_2 &lt;- DivSubsamples(Bact1, nrf=2, minrarefac=1, maxrarefac=65, NResamples=5)
dss &lt;- list(dss_2, dss_1)

# Implement the function (NB: For quick illustration only -- not default parameters)
out &lt;- DiveMaster(models=testmodels, init.params=testmeta, param.ranges=paramranges,
                  main.samp=Bact1, subsizes=c(65, 40), NResamples=5, fitloops=1,
                  dssamp=dss, numit=2, varleft=10)

# DiveMaster Outputs
out
out$estimate

out$fmm$logistic

out$fmm$logistic$global

out$ssm

summary(out)

## Combining two DiveMaster objects (assuming a second object 'out2'):
# out3 &lt;- CombDM(list(out, out2))

## To calculate the diversity for a different population size
# PopDiversity(dm=out, popsize=10^5, TopX=1)

</code></pre>

<hr>
<h2 id='DivSampleNum'>
DivSampleNum
</h2><span id='topic+DivSampleNum'></span>

<h3>Description</h3>

<p>Function to generate an integer sequence representing the lengths of nested samples of sample
</p>


<h3>Usage</h3>

<pre><code class='language-R'>DivSampleNum(ms, n)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="DivSampleNum_+3A_ms">ms</code></td>
<td>

<p>the main sample, either as a 2-column data.frame (species ID, count of species), or a vector of species IDs.
</p>
</td></tr>
<tr><td><code id="DivSampleNum_+3A_n">n</code></td>
<td>

<p>desired number of nested samples (integer)
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function produces the default list of nested sample lengths for the DivE algorithm. For the vector representation of the main sample (<em>ms</em>) it is equivalent to <em>sort(round(seq(from=length(ms)/n, to=length(ms), by=length(ms)/n)), decreasing=TRUE)</em>.
</p>


<h3>Value</h3>

<p>A decreasing sequence of nested sample lengths.
</p>


<h3>Author(s)</h3>

<p>Daniel J. Laydon, Aaron Sim, Charles R.M. Bangham, Becca Asquith
</p>


<h3>References</h3>

<p>Laydon, D. J., Melamed, A., Sim, A., Gillet, N. A., Sim, K., Darko, S., Kroll, S., Douek, D. C., Price, D., Bangham, C. R. M., Asquith, B., Quantification of HTLV-1 clonality and TCR diversity, PLOS Comput. Biol. 2014
</p>


<h3>Examples</h3>

<pre><code class='language-R'>require(DivE)
data(Bact1)

DivSampleNum(Bact1, 3)
DivSampleNum(Bact1, 6)

</code></pre>

<hr>
<h2 id='DivSubsamples'>
DivSubsamples
</h2><span id='topic+DivSubsamples'></span><span id='topic+print.DivSubsamples'></span><span id='topic+summary.DivSubsamples'></span><span id='topic+print.summary.DivSubsamples'></span>

<h3>Description</h3>

<p>Function to generate the rarefaction data from a given sample
</p>


<h3>Usage</h3>

<pre><code class='language-R'>DivSubsamples(mainsamp, nrf, minrarefac=1,
maxrarefac=length(FormatInput(mainsamp)), NResamples=1000)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="DivSubsamples_+3A_mainsamp">mainsamp</code></td>
<td>

<p>the main sample, either as a 2-column data.frame (species ID, count of species), or a vector of species IDs.
</p>
</td></tr>
<tr><td><code id="DivSubsamples_+3A_nrf">nrf</code></td>
<td>

<p>difference between lengths of successive rarefaction datapoints.
</p>
</td></tr>
<tr><td><code id="DivSubsamples_+3A_minrarefac">minrarefac</code></td>
<td>

<p>minimum rarefaction data x-axis value. Default is 1.
</p>
</td></tr>
<tr><td><code id="DivSubsamples_+3A_maxrarefac">maxrarefac</code></td>
<td>

<p>maximum rarefaction data x-axis value. Default is length of the sample <code>mainsamp</code>.
</p>
</td></tr>
<tr><td><code id="DivSubsamples_+3A_nresamples">NResamples</code></td>
<td>

<p>number of resamples used to calculate the rarefaction data.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function produces a vector of subsamples diversity values with subsample lengths evenly distributed between a specified minimum and maximum number. The curvature of the rarefaction curve can be obtained with the function <code>Curvature</code>.
</p>


<h3>Value</h3>

<p>a list of class <em>DivSubsamples</em> containing resampling results (i.e. the diversity data). This includes the following:
</p>
<table role = "presentation">
<tr><td><code>RarefacXAxis</code></td>
<td>
<p>vector of x-axis rarefaction data</p>
</td></tr>
<tr><td><code>RarefacYAxis</code></td>
<td>
<p>vector of y-axis rarefaction data</p>
</td></tr>
<tr><td><code>div_sd</code></td>
<td>
<p>vector of y-axis rarefaction data standard deviations</p>
</td></tr>
<tr><td><code>NResamples</code></td>
<td>
<p>number of sampling iterations used to calculate sample means of each subsample diversity</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Daniel J. Laydon, Aaron Sim, Charles R.M. Bangham, Becca Asquith
</p>


<h3>References</h3>

<p>Laydon, D. J., Melamed, A., Sim, A., Gillet, N. A., Sim, K., Darko, S., Kroll, S., Douek, D. C., Price, D., Bangham, C. R. M., Asquith, B., Quantification of HTLV-1 clonality and TCR diversity, PLOS Comput. Biol. 2014
</p>


<h3>Examples</h3>

<pre><code class='language-R'>require(DivE)
data(Bact1)

dss_1 &lt;- DivSubsamples(Bact1, nrf=2, minrarefac=1, maxrarefac=100,
                        NResamples=10) 
dss_2 &lt;- DivSubsamples(Bact1, nrf=20, minrarefac=1, maxrarefac=100,
                        NResamples=10)
# Default NResamples=1000; low value of NResamples=10 is a set for quick evaluation

dss_1
dss_2

summary(dss_1)
dss_1$div_sd
dss_1$NResamples

Curvature(dss_1)
</code></pre>

<hr>
<h2 id='FitSingleMod'>
FitSingleMod
</h2><span id='topic+FitSingleMod'></span><span id='topic+print.FitSingleMod'></span><span id='topic+summary.FitSingleMod'></span><span id='topic+print.summary.FitSingleMod'></span><span id='topic+plot.FitSingleMod'></span>

<h3>Description</h3>

<p>Function to fit a model to the diversity values of subsamples of a given sample and its nested samples.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>FitSingleMod(model.list, init.param, param.range,
             main.samp, tot.pop=(100*(DivSampleNum(main.samp,2)[1])),
             numit=10^5, varleft=1e-8, data.default=TRUE,
             subsizes = 6, dssamps = list(), nrf = 1,
             minrarefac=1, NResamples=1000, minplaus=10,
             fitloops=2)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="FitSingleMod_+3A_model.list">model.list</code></td>
<td>

<p>model; written as a function: function(x, params) with(as.list(params), FunctionOfParams). Examples are given in the ModelSet data file as part of the DivE package. Used in the modFit function.
</p>
</td></tr>
<tr><td><code id="FitSingleMod_+3A_init.param">init.param</code></td>
<td>

<p>matrix of of initial seed model parameters. For each matrix, each row represents a given parameter set; each column represents a parameter value. Column names must match parameter names (params) in the corresponding model in the list <code>models</code>. Examples are given in the ParamSeeds data file as part of the DivE package.
</p>
</td></tr>
<tr><td><code id="FitSingleMod_+3A_param.range">param.range</code></td>
<td>

<p>matrix of lower and upper model parameters bounds. Used for the modFit function. The first and second row corresponds to the lower and upper bounds respectively; each column represents a parameter value. Column names must match parameter names (params) in the corresponding model in the list <code>models</code>. Examples are given in the ParamRanges data file as part of the DivE package.
</p>
</td></tr>
<tr><td><code id="FitSingleMod_+3A_main.samp">main.samp</code></td>
<td>

<p>the main sample, either as a 2-column data.frame (species ID, count of species), or a vector of species IDs.
</p>
</td></tr>
<tr><td><code id="FitSingleMod_+3A_tot.pop">tot.pop</code></td>
<td>

<p>total population (integer); default set to 100x the <code>main.samp</code> size.
</p>
</td></tr>
<tr><td><code id="FitSingleMod_+3A_numit">numit</code></td>
<td>

<p>control argument passed to optimisation routine; the maximum number of iterations that modFit will perform. See <code><a href="FME.html#topic+modFit">modFit</a></code> for details.
</p>
</td></tr>
<tr><td><code id="FitSingleMod_+3A_varleft">varleft</code></td>
<td>

<p>control argument passed to optimisation routine; see <code><a href="FME.html#topic+modFit">modFit</a></code> for details.
</p>
</td></tr>
<tr><td><code id="FitSingleMod_+3A_data.default">data.default</code></td>
<td>

<p>if <code>True</code>, then the list of vectors of nested rarefaction data (divsubsample objects) generated by the <em>DivSampleNum</em> and <em>divsubsample</em> functions; if <code>False</code>, then the function uses the user-specified list of nested rarefaction data, <em>dssamps</em>
</p>
</td></tr>
<tr><td><code id="FitSingleMod_+3A_subsizes">subsizes</code></td>
<td>

<p>either number of subsamples of main.samp (integer), or a vector of subsample lengths. If the former, then the vector of sample lengths will be created using the <em>DivSampleNum</em> function.
</p>
</td></tr>
<tr><td><code id="FitSingleMod_+3A_dssamps">dssamps</code></td>
<td>

<p>list of user specified rarefaction data <em>DivSubsamples</em> objects. The length of each component vector of each object in the list must correspond to the vector of subsample lengths (as defined by the user in <code>subsizes</code>).
</p>
</td></tr>
<tr><td><code id="FitSingleMod_+3A_nrf">nrf</code></td>
<td>

<p>difference between lengths of successive rarefaction datapoints.
</p>
</td></tr>
<tr><td><code id="FitSingleMod_+3A_minrarefac">minrarefac</code></td>
<td>

<p>minimum rarefaction x-axis value. This argument is not used if list of <em>DivSubsamples</em> object is specified in <em>dssamps</em>.
</p>
</td></tr>
<tr><td><code id="FitSingleMod_+3A_nresamples">NResamples</code></td>
<td>

<p>number of resamples used to calculate the rarefaction data. This parameter is not used if list of <em>DivSubsamples</em> object is specified in <code>dssamps</code>. NB: different from <code>numit</code> parameter, which is specific to the fitting process.
</p>
</td></tr>
<tr><td><code id="FitSingleMod_+3A_minplaus">minplaus</code></td>
<td>

<p>lower x-axis bound for plausibility check.
</p>
</td></tr>
<tr><td><code id="FitSingleMod_+3A_fitloops">fitloops</code></td>
<td>

<p>number of fitting rounds performed for each model. In each round of fitting, the initial seed parameter values for each model will be the fitted parameters of the previous fitting run. This parameter has a significant impact on the computational time. The &lsquo;sweet spot&rsquo; is 2.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function fits a single specified model to the diversity values of the subsamples of a set of nested samples. The output is a list of raw fitting results (pre-scoring). The user should use this function if he or she is interested in fitting a specific parametric rarefraction curve to a sample (rather than selecting the most appropriate model) and examining its performance.
</p>


<h3>Value</h3>

<p>A list of class <em>FitSingleMod</em> containing the results of the fit of the model to the diversity samples. This includes the following:
</p>
<table role = "presentation">
<tr><td><code>param</code></td>
<td>
<p>matrix of fitted parameters for each nested sample</p>
</td></tr>
<tr><td><code>ssr</code></td>
<td>
<p>sum-of-squared residuals for the fits for each nested sample</p>
</td></tr>
<tr><td><code>ms</code></td>
<td>
<p>mean sum-of-squared residuals for the fits for each nested sample</p>
</td></tr>
<tr><td><code>discrep</code></td>
<td>
<p>goodness-of-fit values for the fits for each nested sample; this expressed as the average across the subsamples in each nested sample of all the percentage residuals</p>
</td></tr>
<tr><td><code>local</code></td>
<td>
<p>prediction of main sample sizes according to fitted curves for each of the nested samples</p>
</td></tr>
<tr><td><code>global</code></td>
<td>
<p>prediction of population diversity at <code>popsize</code> according to fitted curves for each of the nested subsamples</p>
</td></tr>
<tr><td><code>AccuracyToObserved</code></td>
<td>
<p>vector of percentage errors between the observed diversity of full sample data and the estimated diversity of full sample data from subsamples</p>
</td></tr>
<tr><td><code>subsamplesizes</code></td>
<td>
<p>vector of nested subsample sizes</p>
</td></tr>
<tr><td><code>datapoints</code></td>
<td>
<p>the list of <em>divsubsample</em> objects used in the fitting. The length of the list is equal to number of samples</p>
</td></tr>
<tr><td><code>modelname</code></td>
<td>
<p>name of the model used</p>
</td></tr>
<tr><td><code>numparam</code></td>
<td>
<p>number of parameters in the model</p>
</td></tr>
<tr><td><code>sampvar</code></td>
<td>
<p>the mean squared distances between subsample curves, local and global</p>
</td></tr>
<tr><td><code>mono.local</code></td>
<td>
<p>matrix of logical values: is the curve monotonically increasing, up to the main sample size?</p>
</td></tr>
<tr><td><code>mono.global</code></td>
<td>
<p>matrix of logical values: is the curve monotonically increasing, up to the population size?</p>
</td></tr>
<tr><td><code>slowing.local</code></td>
<td>
<p>matrix of logical values: is the rate of increase in the curve slowing (decreasing second derivative), up to the main sample size?</p>
</td></tr>
<tr><td><code>slowing.global</code></td>
<td>
<p>matrix of logical values: is the rate of increase in the curve slowing (decreasing second derivative), from <code>minplaus</code> to the population size (<code>popsize</code>?</p>
</td></tr>
<tr><td><code>plausibility</code></td>
<td>
<p>matrix of logical values: is the curve plausible (i.e. monotonically increasing and with decreasing second derivative)?</p>
</td></tr>
<tr><td><code>dist.local</code></td>
<td>
<p>matrix of distances between curves fitted to the nested samples. Distances are calculated as areas between curves bounded by 0 and the main sample size</p>
</td></tr>
<tr><td><code>dist.global</code></td>
<td>
<p>similar to <em>dist.local</em>, but with curve upper bound the population size</p>
</td></tr>
<tr><td><code>local.ref.dist</code></td>
<td>
<p>distances of nested curves to the curve fitted to the whole sample, with the curves bounded by 0 and the main sample size</p>
</td></tr>
<tr><td><code>global.ref.dist</code></td>
<td>
<p>similar to <em>local.ref.dist</em> but with curve upper bound the population size</p>
</td></tr>
<tr><td><code>popsize</code></td>
<td>
<p>user defined population size</p>
</td></tr>
<tr><td><code>the model</code></td>
<td>
<p>the function corresponding to the user-selected <code>modelname</code></p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Daniel J. Laydon, Aaron Sim, Charles R.M. Bangham, Becca Asquith
</p>


<h3>References</h3>

<p>Laydon, D. J., Melamed, A., Sim, A., Gillet, N. A., Sim, K., Darko, S., Kroll, S., Douek, D. C., Price, D., Bangham, C. R. M., Asquith, B., Quantification of HTLV-1 clonality and TCR diversity, PLOS Comput. Biol. 2014
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ScoreSingleMod">ScoreSingleMod</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># See documentation of \code{ScoreSingleMod} for examples
</code></pre>

<hr>
<h2 id='ModelSet'>
List of 58 candidate models to fit to data
</h2><span id='topic+ModelSet'></span>

<h3>Description</h3>

<p><em>ModelSet</em> is an example list of candidate models used in the reference below to calculate the <em>DivE</em> estimate
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(ModelSet)</code></pre>


<h3>Format</h3>

<p>A list of 58 named functions (with named parameters). Each model in the list must be provided as a function, and must be of the following form: function(x, params) with(as.list(params), FunctionOfParams). The parameter names are a1, a2, a3, etc. These must match the names of the parameter values given in <em>ParamSeeds</em> and <em>ParamRanges</em>. 
</p>


<h3>Details</h3>

<p>Each model is written as a function: function(x, params) with(as.list(params), FunctionOfParams). Examples are given in the <em>ModelSet</em> data file as part of the <em>DivE</em> package. The user can amend <em>ModelSet</em> and input additional models as required. The analytical form of all the models provided in <em>ModelSet</em> can be found in the reference below, in Text S1: List of <em>DivE</em> candidate models. All models were obtained from <em>zunzun.org</em>, an online curve fitting repository
</p>


<h3>References</h3>

<p>Laydon, D. J., Melamed, A., Sim, A., Gillet, N. A., Sim, K., Darko, S., Kroll, S., Douek, D. C., Price, D., Bangham, C. R. M., Asquith, B., Quantification of HTLV-1 clonality and TCR diversity, PLOS Comput. Biol. 2014
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(ModelSet)
</code></pre>

<hr>
<h2 id='ParamRanges'>
List of 58 sets of upper and lower bounds for models evaluated by DivE
</h2><span id='topic+ParamRanges'></span>

<h3>Description</h3>

<p>A list of 58 matrices. Each matrix corresponds to a model in <code>ModelSet</code>, for which it contains suggested upper and lower bounds for each parameter. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(ParamRanges)</code></pre>


<h3>Format</h3>

<p>A list of 58 matrices. Each matrix has 2 rows (lower bounds, upper bounds) and columns corresponding to the parameters of the matching model in <code>ModelSet</code>.</p>


<h3>Details</h3>

<p>There is a trade-off between specifying parameter ranges that are large enough to encompass likely fitted values for a variety of data sets, and specifying parameter ranges that are suitably small so that parameter estimation is sufficiently precise and runtime is managable. We have aimed to balance these competing concerns.  The parameter ranges provided performed well in our simulations. The user can amend if required. 
</p>


<h3>References</h3>

<p>Laydon, D. J., Melamed, A., Sim, A., Gillet, N. A., Sim, K., Darko, S., Kroll, S., Douek, D. C., Price, D., Bangham, C. R. M., Asquith, B., Quantification of HTLV-1 clonality and TCR diversity, PLOS Comput. Biol. 2014
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(ParamRanges)
</code></pre>

<hr>
<h2 id='ParamSeeds'>
List of 58 matrices of model seeding parameters.
</h2><span id='topic+ParamSeeds'></span>

<h3>Description</h3>

<p>The performance of <em>modFit</em> (package <em>FME</em>) with the pseudorandom parameter search algorithm (package <em>FME</em>, <code>pseudoOptim</code>) used to estimated model parameter values, is sensitive to the choice of initial seeding values. We have provided the fitted parameters returned from our simulations to be used as initial seeding parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(ParamSeeds)</code></pre>


<h3>Format</h3>

<p>A list of 58 matrices. Each matrix has columns corresponding to the parameters of the matching model in <em>ModelSet</em>. Each row is set of potential seeding parameters 
</p>


<h3>Details</h3>

<p>For each model, each initial parameter guess (i.e. each row of the model matrix in <em>ParamRanges</em>) is evaluated by to <em>modCost</em>. The parameter guess returning the lowest cost is used as the seeding value in <em>modFit</em>.
If the user wishes to input alternative initial seeding parameter values, then for each model and parameter, all values must be finite (not <code>NA</code> or <code>NaN</code>), and within the upper and lower bounds set in <em>ParamRanges</em>. Column names must match parameter names (params) in the corresponding model in ModelSet (i.e. <code>models</code> argument in DivEMaster).
</p>


<h3>References</h3>

<p>Laydon, D. J., Melamed, A., Sim, A., Gillet, N. A., Sim, K., Darko, S., Kroll, S., Douek, D. C., Price, D., Bangham, C. R. M., Asquith, B., Quantification of HTLV-1 clonality and TCR diversity, PLOS Comput. Biol. 2014
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(ParamSeeds)
</code></pre>

<hr>
<h2 id='PopDiversity'>
PopDiversity
</h2><span id='topic+PopDiversity'></span>

<h3>Description</h3>

<p>Calculates the species richness at a specified population size, taking an object of class <em>DiveMaster</em> as an input.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PopDiversity(dm, popsize, TopX=NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PopDiversity_+3A_dm">dm</code></td>
<td>

<p>list of objects of class <em>DiveMaster</em>.
</p>
</td></tr>
<tr><td><code id="PopDiversity_+3A_popsize">popsize</code></td>
<td>

<p>positive real number. Population size.
</p>
</td></tr>
<tr><td><code id="PopDiversity_+3A_topx">TopX</code></td>
<td>

<p>a positive integer, less than the number of models contained in <code>dm</code>, representing the number of best-performing models used for the aggregated estimate of the population diversity. If <code>NULL</code> (default), then <code>dm$m</code> models are aggregated. If <code>TopX</code> is larger than the the number of models fitted, then min(5, length(dm$fmm)) models are aggregated.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><em>CombDM</em> combines multiple objects of class <em>DiveMaster</em>. Function used if <em>DivE</em> estimation has been split into multiple, separate calls to <code>DiveMaster</code>.
</p>


<h3>Value</h3>

<p>A list of objects:
</p>
<table role = "presentation">
<tr><td><code>estimate</code></td>
<td>
<p>point estimate of diversity (species richness)</p>
</td></tr>
<tr><td><code>upper_estimate</code></td>
<td>
<p>estimate upper bound</p>
</td></tr>
<tr><td><code>lower_estimate</code></td>
<td>
<p>estimate lower bound</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Daniel J. Laydon, Aaron Sim, Charles R.M. Bangham, Becca Asquith
</p>


<h3>References</h3>

<p>Laydon, D. J., Melamed, A., Sim, A., Gillet, N. A., Sim, K., Darko, S., Kroll, S., Douek, D. C., Price, D., Bangham, C. R. M., Asquith, B., Quantification of HTLV-1 clonality and TCR diversity, PLOS Comput. Biol. 2014
</p>


<h3>See Also</h3>

<p><code><a href="#topic+DiveMaster">DiveMaster</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># See DiveMaster documentation for examples.
</code></pre>

<hr>
<h2 id='ScoreSingleMod'>
ScoreSingleMod
</h2><span id='topic+ScoreSingleMod'></span><span id='topic+print.ScoreSingleMod'></span><span id='topic+summary.ScoreSingleMod'></span><span id='topic+print.summary.ScoreSingleMod'></span>

<h3>Description</h3>

<p>Determines the set of scores corresponding to a single model fit to a diversity values of subsamples of a given sample and its nested samples.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ScoreSingleMod(fsm, precision.lv=c(0.0001, 0.005, 0.005), plaus.pen=500)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ScoreSingleMod_+3A_fsm">fsm</code></td>
<td>

<p><em>FitSingleMod</em> object
</p>
</td></tr>
<tr><td><code id="ScoreSingleMod_+3A_precision.lv">precision.lv</code></td>
<td>

<p>vector of precision level values for each criterion: 1. discrepancy &ndash; mean percentage error between rarefaction data points and model predicion, 2. Sample accuracy &ndash; percentage error between observed diversity of full rarefaction data and estimated diversity of full data from subsample, 3. local similarity. The scores for each criteria are defined as 1 + (multiples of bin sizes)
</p>
</td></tr>
<tr><td><code id="ScoreSingleMod_+3A_plaus.pen">plaus.pen</code></td>
<td>

<p>penalty score for breaking the plausibility criterion: a model fit should be monotonically increasing and should have a slowing rate of species accumulation.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The score for a given model is only meaningful when compared with scores of other models. Lower score = better for predicting the population diversity. To assess the performance of a single model, it is more informative to use <code><a href="#topic+FitSingleMod">FitSingleMod</a></code> function.
</p>


<h3>Value</h3>

<p>A list of class <em>ScoreSingleMod</em> containing the scores of the fit of the model to the diversity samples. This includes the following:
</p>
<table role = "presentation">
<tr><td><code>discrepancy</code></td>
<td>
<p>score for discrepancy, aggregated across all nested subsamples</p>
</td></tr>
<tr><td><code>accuracy</code></td>
<td>
<p>score for accuracy of full sample prediction, aggregated across all nested subsamples</p>
</td></tr>
<tr><td><code>similarity</code></td>
<td>
<p>score for similarity of curves for different samples</p>
</td></tr>
<tr><td><code>plausibility</code></td>
<td>
<p>score for plausibility criterion</p>
</td></tr>
<tr><td><code>binsize</code></td>
<td>
<p>vector of user-specified precision values used to translate values associated with each criterion into scores </p>
</td></tr>
<tr><td><code>plausibility.penalty</code></td>
<td>
<p>penalty score for implausible diversity curve</p>
</td></tr>
<tr><td><code>modname</code></td>
<td>
<p>model name</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Daniel J. Laydon, Aaron Sim, Charles R.M. Bangham, Becca Asquith
</p>


<h3>References</h3>

<p>Laydon, D. J., Melamed, A., Sim, A., Gillet, N. A., Sim, K., Darko, S., Kroll, S., Douek, D. C., Price, D., Bangham, C. R. M., Asquith, B., Quantification of HTLV-1 clonality and TCR diversity, PLOS Comput. Biol. 2014
</p>


<h3>See Also</h3>

<p><code><a href="#topic+FitSingleMod">FitSingleMod</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>require(DivE)
data(Bact1)
data(ModelSet)
data(ParamSeeds)
data(ParamRanges)

testmodels &lt;- list()
testmeta &lt;- list()
paramranges &lt;- list()   

# Choose a single model

testmodels &lt;- c(testmodels, ModelSet[1])
# testmeta &lt;- (ParamSeeds[[1]]) # Commented out for sake of brevity)
testmeta &lt;- matrix(c(0.9451638, 0.007428265, 0.9938149, 1.0147441, 0.009543598, 0.9870419),
                        nrow=2, byrow=TRUE, dimnames=list(c(), c("a1", "a2", "a3"))) # Example seeds
paramranges &lt;- ParamRanges[[1]]

# Create DivSubsamples object (NB: For quick illustration only -- not default parameters)
dss_1 &lt;- DivSubsamples(Bact1, nrf=2, minrarefac=1, maxrarefac=40, NResamples=5)
dss_2 &lt;- DivSubsamples(Bact1, nrf=2, minrarefac=1, maxrarefac=65, NResamples=5)
dss &lt;- list(dss_2, dss_1)

# Fit the model (NB: For quick illustration only -- not default parameters)
fsm &lt;- FitSingleMod(model.list=testmodels, init.param=testmeta, param.range=paramranges,
                    main.samp=Bact1, dssamps=dss, fitloops=1, data.default=FALSE,
                    subsizes=c(65, 40), 
                    numit=2) # numit chosen to be extremely small to speed up example


# Score the model
ssm &lt;- ScoreSingleMod(fsm)

ssm
summary(ssm)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
