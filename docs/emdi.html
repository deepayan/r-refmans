<!DOCTYPE html><html><head><title>Help for package emdi</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {emdi}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#benchmark'><p>Benchmark Function</p></a></li>
<li><a href='#combine_data'><p>Combines Sample and Population Data</p></a></li>
<li><a href='#compare'><p>Compare Function</p></a></li>
<li><a href='#compare_plot'><p>Shows Plots for the Comparison of Estimates</p></a></li>
<li><a href='#compare_pred'><p>Compare Predictions of Model Objects</p></a></li>
<li><a href='#data_transformation'><p>Tranforms Dependent Variables</p></a></li>
<li><a href='#direct'><p>Direct Estimation of Disaggregated Indicators</p></a></li>
<li><a href='#ebp'><p>Empirical Best Prediction for Disaggregated Indicators</p></a></li>
<li><a href='#emdi'><p>A package for estimating and mapping disaggregated indicators</p></a></li>
<li><a href='#emdi_summaries'><p>Summarizes an emdiObject</p></a></li>
<li><a href='#emdiObject'><p>Fitted emdiObject</p></a></li>
<li><a href='#estimators'><p>Presents Point, MSE and CV Estimates</p></a></li>
<li><a href='#eusilcA_pop'><p>Simulated eusilc data - population data</p></a></li>
<li><a href='#eusilcA_popAgg'><p>Simulated eusilc data - aggregated population data</p></a></li>
<li><a href='#eusilcA_prox'><p>Proximity matrix for spatial area-level models</p></a></li>
<li><a href='#eusilcA_smp'><p>Simulated eusilc data - sample data</p></a></li>
<li><a href='#eusilcA_smpAgg'><p>Simulated eusilc data - aggregated sample data</p></a></li>
<li><a href='#fh'><p>Standard and Extended Fay-Herriot Models for Disaggregated Indicators</p></a></li>
<li><a href='#fixef'><p>Extract Fixed Effects from an emdi Object</p></a></li>
<li><a href='#getData'><p>Extract emdi Object Data</p></a></li>
<li><a href='#getGroups'><p>Extract Grouping Factors from an emdi Object</p></a></li>
<li><a href='#getGroupsFormula'><p>Extract Grouping Formula from an emdi Object</p></a></li>
<li><a href='#getResponse'><p>Extract Response Variable from an emdi Object</p></a></li>
<li><a href='#getVarCov'><p>Extract Variance-covariance Matrix from an emdi Object</p></a></li>
<li><a href='#intervals'><p>Confidence Intervals on Coefficients of an emdi Object</p></a></li>
<li><a href='#load_shapeaustria'><p>Loading the Shape File for Austrian Districts</p></a></li>
<li><a href='#map_plot'><p>Visualizes regional disaggregated estimates on a map</p></a></li>
<li><a href='#plot.emdi'><p>Plots for an emdi Object</p></a></li>
<li><a href='#predict.emdi'><p>Predictions from emdi Objects</p></a></li>
<li><a href='#qqnorm.emdi'><p>Quantile-quantile Plots for an emdi Object</p></a></li>
<li><a href='#ranef'><p>Extract Random Effects of emdi Objects</p></a></li>
<li><a href='#spatialcor.tests'><p>Spatial Autocorrelation Tests</p></a></li>
<li><a href='#step'><p>Step Function</p></a></li>
<li><a href='#write.excel'><p>Exports an emdiObject to an Excel File or OpenDocument Spreadsheet</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Estimating and Mapping Disaggregated Indicators</td>
</tr>
<tr>
<td>Version:</td>
<td>2.2.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-10-30</td>
</tr>
<tr>
<td>Description:</td>
<td>Functions that support estimating, assessing and mapping regional
    disaggregated indicators. So far, estimation methods comprise direct estimation,
    the model-based unit-level approach Empirical Best Prediction (see "Small area
    estimation of poverty indicators" by Molina and Rao (2010) &lt;<a href="https://doi.org/10.1002%2Fcjs.10051">doi:10.1002/cjs.10051</a>&gt;), 
    the area-level model (see "Estimates of income for small places: An 
    application of James-Stein procedures to Census Data" by Fay and Herriot (1979) 
    &lt;<a href="https://doi.org/10.1080%2F01621459.1979.10482505">doi:10.1080/01621459.1979.10482505</a>&gt;) and various extensions of it (adjusted variance 
    estimation methods, log and arcsin transformation, spatial, robust and measurement 
    error models), as well as their precision estimates. The assessment of the used model
    is supported by a summary and diagnostic plots. For a suitable presentation of
    estimates, map plots can be easily created. Furthermore, results can easily be
    exported to excel. For a detailed description of the package and the methods used
    see "The R Package emdi for Estimating and Mapping Regionally Disaggregated Indicators" 
    by Kreutzmann et al. (2019) &lt;<a href="https://doi.org/10.18637%2Fjss.v091.i07">doi:10.18637/jss.v091.i07</a>&gt; and the second package vignette 
    "A Framework for Producing Small Area Estimates Based on Area-Level Models in R".</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.2.0)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/SoerenPannier/emdi">https://github.com/SoerenPannier/emdi</a></td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Copyright:</td>
<td>inst/COPYRIGHTS</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Imports:</td>
<td>nlme, moments, ggplot2, MuMIn, gridExtra, openxlsx, reshape2,
stats, stringr, parallelMap, HLMdiag, parallel, boot, MASS,
readODS, formula.tools, saeRobust, rlang, spdep</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat, R.rsp, simFrame, laeken, sf, graphics</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>R.rsp</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-10-30 09:59:09 UTC; span</td>
</tr>
<tr>
<td>Author:</td>
<td>Sylvia Harmening [aut],
  Ann-Kristin Kreutzmann [aut],
  Soeren Pannier [aut, cre],
  Felix Skarke [aut],
  Natalia Rojas-Perilla [aut],
  Nicola Salvati [aut],
  Timo Schmid [aut],
  Matthias Templ [aut],
  Nikos Tzavidis [aut],
  Nora Würz [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Soeren Pannier &lt;soeren.pannier@fu-berlin.de&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-11-05 12:40:07 UTC</td>
</tr>
</table>
<hr>
<h2 id='benchmark'>Benchmark Function</h2><span id='topic+benchmark'></span>

<h3>Description</h3>

<p>This function benchmarks the EBLUP estimates of an area-level model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>benchmark(object, benchmark, share, type = "raking", overwrite = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="benchmark_+3A_object">object</code></td>
<td>
<p>an object of type &quot;fh&quot;.</p>
</td></tr>
<tr><td><code id="benchmark_+3A_benchmark">benchmark</code></td>
<td>
<p>a number determining the benchmark value.</p>
</td></tr>
<tr><td><code id="benchmark_+3A_share">share</code></td>
<td>
<p>a vector containing the shares of the population size per area
and the total population size (N_d/N).Values must be sorted like the domains
in the fh object.</p>
</td></tr>
<tr><td><code id="benchmark_+3A_type">type</code></td>
<td>
<p>Character indicating the type of benchmarking. Types that can be
chosen (i) Raking (&quot;<code>raking</code>&quot;), (ii) Ratio adjustment (&quot;<code>ratio</code>&quot;),
(iii) MSE adjustment (&quot;<code>MSE_adj</code>&quot;). Defaults to &quot;<code>raking</code>&quot;.</p>
</td></tr>
<tr><td><code id="benchmark_+3A_overwrite">overwrite</code></td>
<td>
<p>if <code>TRUE</code>, the benchmarked FH estimates are added to
the ind object of the emdi object and the MSE estimates are set to
NULL since these are not benchmarked. Defaults to <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The benchmarking algorithm only works, if FH estimates are available.
The type &quot;<code>MSE_adj</code>&quot; only works, if MSE estimates are available.
If overwrite is set to TRUE, the emdi object is returned, but the
benchmarked FH estimates are added to the ind object of the emdi
object and the MSE estimates are set to NULL since these are not
benchmarked.
</p>


<h3>Value</h3>

<p>A data frame containing a domain indicator (Domain), direct estimates
(Direct), point predictions (FH), benchmarked point predictions (FH_Bench)
and a variable indicating out-of-sample domains Out (1 for out-of-sample, 0
for in-sample) . If overwrite is set to TRUE, the fh object is returned, but
the point predictions of the ind data frame are complemented by the
benchmarked results.
</p>


<h3>References</h3>

<p>Datta,G. S., Ghosh, M., Steorts, R. and Maples, J. (2010) Bayesian
benchmarking with applications to small area estimation. Test, 20, 574–588.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Loading data - population and sample data
data("eusilcA_popAgg")
data("eusilcA_smpAgg")

# Combine sample and population data
combined_data &lt;- combine_data(
  pop_data = eusilcA_popAgg,
  pop_domains = "Domain",
  smp_data = eusilcA_smpAgg,
  smp_domains = "Domain"
)

# Estimate Fay-Herriot model
fh_std &lt;- fh(
  fixed = Mean ~ cash + self_empl, vardir = "Var_Mean",
  combined_data = combined_data, domains = "Domain", method = "ml",
  MSE = TRUE
)

# Benchmark the point estimates

# Example 1: Receive data frame with point estimates and their benchmarked
# results
fh_bench &lt;- benchmark(fh_std,
  benchmark = 20140.09,
  share = eusilcA_popAgg$ratio_n, type = "ratio"
)

# Example 2: Add benchmarked results to fh object
fh_bench &lt;- benchmark(fh_std,
  benchmark = 20140.09,
  share = eusilcA_popAgg$ratio_n, type = "ratio", overwrite = TRUE
)
</code></pre>

<hr>
<h2 id='combine_data'>Combines Sample and Population Data</h2><span id='topic+combine_data'></span>

<h3>Description</h3>

<p>This function combines the aggregated population information with the
aggregated sample data. The merge is based on the domains. Out-of-sample
domains will have NA values for the variables from the sample data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>combine_data(pop_data, pop_domains, smp_data, smp_domains)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="combine_data_+3A_pop_data">pop_data</code></td>
<td>
<p>a data frame with population data.</p>
</td></tr>
<tr><td><code id="combine_data_+3A_pop_domains">pop_domains</code></td>
<td>
<p>a character string indicating the domain variable that is
included in <code>pop_data</code>.</p>
</td></tr>
<tr><td><code id="combine_data_+3A_smp_data">smp_data</code></td>
<td>
<p>a data frame with sample data.</p>
</td></tr>
<tr><td><code id="combine_data_+3A_smp_domains">smp_domains</code></td>
<td>
<p>a character string indicating the domain variable that is
included in <code>smp_data</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a combined data set.
</p>

<hr>
<h2 id='compare'>Compare Function</h2><span id='topic+compare'></span><span id='topic+compare.fh'></span>

<h3>Description</h3>

<p>Function <code>compare</code> is a generic function used to assess the quality of
the model-based estimates by comparing them with the direct estimates.
</p>
<p>Method <code>compare.fh</code> assesses the quality of the model-based estimates
of the Fay-Herriot model by comparing them with the direct estimates based
on a goodness-of-fit test proposed by <cite>Brown et al. (2001)</cite> and by
computing the correlation between the regression-synthetic part of the
Fay-Herriot model and the direct estimates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compare(object, ...)

## S3 method for class 'fh'
compare(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="compare_+3A_object">object</code></td>
<td>
<p>an object of type &quot;fh&quot;.</p>
</td></tr>
<tr><td><code id="compare_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The return of <code>compare</code> depends on the class of its argument.
The documentation of particular methods gives detailed information about the
return of that method.
</p>
<p>For the method for class &quot;fh&quot;, the null hypothesis, the value W of
the test statistic, the degrees of freedom and the p value of the Brown test;
and the correlation coefficient of the synthetic part and the direct
estimator <cite>(Chandra et al. 2015)</cite> are returned.
</p>


<h3>References</h3>

<p>Brown, G., R. Chambers, P. Heady, and D. Heasman (2001). Evaluation of small
area estimation methods: An application to unemployment estimates from the UK
LFS. Symposium 2001 - Achieving Data Quality in a Statistical Agency: A
Methodological Perspective, Statistics Canada. <br /> <br />
Chandra, H., Salvati, N. and Chambers, R. (2015), A Spatially
Nonstationary Fay-Herriot Model for Small Area Estimation, Journal
of the Survey Statistics and Methodology, 3, 109-135.
</p>

<hr>
<h2 id='compare_plot'>Shows Plots for the Comparison of Estimates</h2><span id='topic+compare_plot'></span><span id='topic+compare_plots_emdi'></span><span id='topic+compare_plot.direct'></span><span id='topic+compare_plot.ebp'></span><span id='topic+compare_plot.fh'></span>

<h3>Description</h3>

<p>Function <code>compare_plot</code> is a generic function used to produce plots
comparing point and existing MSE/CV estimates of direct and model-based
estimation for all indicators or a selection of indicators.
</p>
<p>Methods <code>compare_plot.direct</code>, <code>compare_plot.ebp</code> and
<code>compare_plot.fh</code> produce plots comparing point and existing
MSE/CV estimates of direct and model-based estimation for all indicators or a
selection of indicators for objects of type &quot;emdi&quot;. The direct and
model-based point estimates are compared by a scatter plot and a line plot
for each selected indicator. If the input arguments MSE and CV are set to
TRUE, two extra plots are created, respectively: the MSE/CV estimates of the
direct and model-based estimates are compared by boxplots and scatter plots.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compare_plot(
  model,
  direct,
  indicator = "all",
  MSE = FALSE,
  CV = FALSE,
  label = "orig",
  color = c("blue", "lightblue3"),
  shape = c(16, 16),
  line_type = c("solid", "solid"),
  gg_theme = NULL,
  ...
)

## S3 method for class 'direct'
compare_plot(
  model = NULL,
  direct = NULL,
  indicator = "all",
  MSE = FALSE,
  CV = FALSE,
  label = "orig",
  color = c("blue", "lightblue3"),
  shape = c(16, 16),
  line_type = c("solid", "solid"),
  gg_theme = NULL,
  ...
)

## S3 method for class 'ebp'
compare_plot(
  model = NULL,
  direct = NULL,
  indicator = "all",
  MSE = FALSE,
  CV = FALSE,
  label = "orig",
  color = c("blue", "lightblue3"),
  shape = c(16, 16),
  line_type = c("solid", "solid"),
  gg_theme = NULL,
  ...
)

## S3 method for class 'fh'
compare_plot(
  model = NULL,
  direct = NULL,
  indicator = "all",
  MSE = FALSE,
  CV = FALSE,
  label = "orig",
  color = c("blue", "lightblue3"),
  shape = c(16, 16),
  line_type = c("solid", "solid"),
  gg_theme = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="compare_plot_+3A_model">model</code></td>
<td>
<p>a model object of type &quot;emdi&quot;, either &quot;ebp&quot; or &quot;fh&quot;,
representing point and MSE estimates.</p>
</td></tr>
<tr><td><code id="compare_plot_+3A_direct">direct</code></td>
<td>
<p>an object of type &quot;direct&quot;,&quot;emdi&quot;, representing point
and MSE estimates. If the input argument <code>model</code> is of type &quot;ebp&quot;,
<code>direct</code> is required. If the input argument <code>model</code> is of type
&quot;fh&quot;, the <code>direct</code> component is already included in the input
argument <code>model</code>.</p>
</td></tr>
<tr><td><code id="compare_plot_+3A_indicator">indicator</code></td>
<td>
<p>optional character vector that selects which indicators
shall be returned: (i) all calculated indicators (&quot;all&quot;);
(ii) each indicator name: &quot;Mean&quot;, &quot;Quantile_10&quot;, &quot;Quantile_25&quot;, &quot;Median&quot;,
&quot;Quantile_75&quot;, &quot;Quantile_90&quot;, &quot;Head_Count&quot;,
&quot;Poverty_Gap&quot;, &quot;Gini&quot;, &quot;Quintile_Share&quot; or the function name/s of
&quot;custom_indicator/s&quot;; (iii) groups of indicators: &quot;Quantiles&quot;, &quot;Poverty&quot;,
&quot;Inequality&quot; or &quot;Custom&quot;. If two of these groups are selected, only the first
one is returned. Note, additional custom indicators can be defined as
argument for the EBP approaches (see also <code><a href="#topic+ebp">ebp</a></code>) and do not
appear in groups of indicators even though these might belong to one of the
groups. If the <code>model</code> argument is of type &quot;fh&quot;, indicator can be set
to &quot;all&quot;, &quot;Direct&quot;, FH&quot;, or &quot;FH_Bench&quot; (if emdi object is overwritten by
function <code><a href="#topic+benchmark">benchmark</a></code>). Defaults to &quot;all&quot;.</p>
</td></tr>
<tr><td><code id="compare_plot_+3A_mse">MSE</code></td>
<td>
<p>optional logical. If <code>TRUE</code>, the MSE estimates of the direct
and model-based estimates are compared via boxplots and scatter plots.</p>
</td></tr>
<tr><td><code id="compare_plot_+3A_cv">CV</code></td>
<td>
<p>optional logical. If <code>TRUE</code>, the coefficient of variation
estimates of the direct and model-based estimates are compared via boxplots
and scatter plots.</p>
</td></tr>
<tr><td><code id="compare_plot_+3A_label">label</code></td>
<td>
<p>argument that enables to customize title and axis labels. There
are three options to label the evaluation plots: (i) original labels
(&quot;orig&quot;), (ii) axis labels but no title (&quot;no_title&quot;), (iii) neither axis
labels nor title (&quot;blank&quot;).</p>
</td></tr>
<tr><td><code id="compare_plot_+3A_color">color</code></td>
<td>
<p>a vector with two elements. The first color determines
the color for the regression line in the scatter plot and the color for
the direct estimates in the remaining plots. The second color specifies the
color of the intersection line in the scatter plot and the color for the
model-based estimates in the remaining plots. Defaults to
c(&quot;blue&quot;, &quot;lightblue3&quot;).</p>
</td></tr>
<tr><td><code id="compare_plot_+3A_shape">shape</code></td>
<td>
<p>a numeric vector with two elements. The first shape determines
the shape of the points in the scatterplot and the shape of the points for
the direct estimates in the remaining plots. The second shape determines
the shape for the points for the model-based estimates. The options
are numbered from 0 to 25. Defaults to c(16, 16).</p>
</td></tr>
<tr><td><code id="compare_plot_+3A_line_type">line_type</code></td>
<td>
<p>a character vector with two elements. The first line type
determines the line type for the regression line in the scatter plot and the
line type for the direct estimates in the remaining plots. The second line
type specifies the line type of the intersection line in the scatter plot and
the line type for the model-based estimates in the remaining plots. The
options are: &quot;twodash&quot;, &quot;solid&quot;, &quot;longdash&quot;, &quot;dotted&quot;, &quot;dotdash&quot;, &quot;dashed&quot;
and &quot;blank&quot;. Defaults to  c(&quot;solid&quot;, &quot;solid&quot;).</p>
</td></tr>
<tr><td><code id="compare_plot_+3A_gg_theme">gg_theme</code></td>
<td>
<p><code><a href="ggplot2.html#topic+theme">theme</a></code> list from package <span class="pkg">ggplot2</span>.
For using this argument, package <span class="pkg">ggplot2</span> must be loaded via
<code>library(ggplot2)</code>. See also Example 2.</p>
</td></tr>
<tr><td><code id="compare_plot_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Since all of the comparisons need a direct estimator, the plots are
only created for in-sample domains.
</p>


<h3>Value</h3>

<p>Plots comparing direct and model-based estimators for each selected
indicator obtained by <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code>.
</p>
<p>A scatter plot and a line plot comparing direct and model-based
estimators for each selected indicator obtained by
<code><a href="ggplot2.html#topic+ggplot">ggplot</a></code>. If the input arguments MSE and CV are set to
TRUE two extra plots are created, respectively: the MSE/CV estimates of the
direct and model-based estimates are compared by boxplots and scatter plots.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+emdiObject">emdiObject</a></code>, <code><a href="#topic+direct">direct</a></code>, <code><a href="#topic+ebp">ebp</a></code>,
<code><a href="#topic+fh">fh</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Examples for comparisons of direct estimates and models of type ebp

# Loading data - population and sample data
data("eusilcA_pop")
data("eusilcA_smp")

# Generation of two emdi objects
emdi_model &lt;- ebp(
  fixed = eqIncome ~ gender + eqsize + cash +
    self_empl + unempl_ben + age_ben + surv_ben + sick_ben + dis_ben + rent +
    fam_allow + house_allow + cap_inv + tax_adj, pop_data = eusilcA_pop,
  pop_domains = "district", smp_data = eusilcA_smp, smp_domains = "district",
  threshold = function(y) {
    0.6 * median(y)
  }, L = 50, MSE = TRUE,
  na.rm = TRUE, cpus = 1
)

emdi_direct &lt;- direct(
  y = "eqIncome", smp_data = eusilcA_smp,
  smp_domains = "district", weights = "weight", threshold = 11161.44,
  var = TRUE, boot_type = "naive", B = 50, seed = 123, na.rm = TRUE
)

# Example 1: Receive first overview
compare_plot(model = emdi_model, direct = emdi_direct)

# Example 2: Change plot theme
library(ggplot2)
compare_plot(emdi_model, emdi_direct,
  indicator = "Median",
  gg_theme = theme(
    axis.line = element_line(size = 3, colour = "grey80"),
    plot.background = element_rect(fill = "lightblue3"),
    legend.position = "none"
  )
)

# Example for comparison of direct estimates and models of type fh

# Loading data - population and sample data
data("eusilcA_popAgg")
data("eusilcA_smpAgg")

# Combine sample and population data
combined_data &lt;- combine_data(
  pop_data = eusilcA_popAgg,
  pop_domains = "Domain",
  smp_data = eusilcA_smpAgg,
  smp_domains = "Domain"
)

# Generation of the emdi object
fh_std &lt;- fh(
  fixed = Mean ~ cash + self_empl, vardir = "Var_Mean",
  combined_data = combined_data, domains = "Domain",
  method = "ml", MSE = TRUE
)
# Example 3: Receive first overview
compare_plot(fh_std)

# Example 4: Compare also MSE and CV estimates
compare_plot(fh_std, MSE = TRUE, CV = TRUE)

</code></pre>

<hr>
<h2 id='compare_pred'>Compare Predictions of Model Objects</h2><span id='topic+compare_pred'></span><span id='topic+compare_pred.emdi'></span>

<h3>Description</h3>

<p>Function <code>compare_pred</code> is a generic function used to compare
predictions of two model objects.
</p>
<p>Method <code>compare_pred.emdi</code> compares predictions of two emdi objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compare_pred(object1, object2, MSE = FALSE, ...)

## S3 method for class 'emdi'
compare_pred(object1, object2, MSE = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="compare_pred_+3A_object1">object1</code></td>
<td>
<p>an object of type &quot;emdi&quot;.</p>
</td></tr>
<tr><td><code id="compare_pred_+3A_object2">object2</code></td>
<td>
<p>an object of type &quot;emdi&quot;.</p>
</td></tr>
<tr><td><code id="compare_pred_+3A_mse">MSE</code></td>
<td>
<p>if <code>TRUE</code>, MSE estimates are also returned. Defaults to
<code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="compare_pred_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Data frame containing the point estimates of both emdi objects. If
column names are duplicated, the suffixes &quot;_1&quot; and &quot;_2&quot; are added to their
names. &quot;_1&quot; and &quot;_2&quot; standing for object1 and object2, respectively. If
<code>MSE</code> is set to <code>TRUE</code>, the data frame also contains the MSE
estimates of the emdi objects.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+direct">direct</a></code>, <code><a href="#topic+ebp">ebp</a></code>, <code><a href="#topic+fh">fh</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Example for class ebp
emdi_model_1 &lt;- ebp(
  fixed = eqIncome ~ gender + eqsize + cash + self_empl +
    unempl_ben + age_ben + surv_ben + sick_ben + dis_ben + rent + fam_allow +
    house_allow + cap_inv + tax_adj, pop_data = eusilcA_pop,
  pop_domains = "district", smp_data = eusilcA_smp, smp_domains = "district",
  na.rm = TRUE
)

emdi_model_2 &lt;- ebp(
  fixed = eqIncome ~ gender + eqsize + cash + self_empl +
    unempl_ben + age_ben + surv_ben, pop_data = eusilcA_pop,
  pop_domains = "district", smp_data = eusilcA_smp, smp_domains = "district",
  na.rm = TRUE
)

compare_pred(emdi_model_1, emdi_model_2)

</code></pre>

<hr>
<h2 id='data_transformation'>Tranforms Dependent Variables</h2><span id='topic+data_transformation'></span>

<h3>Description</h3>

<p>Function <code>data_transformation</code> transforms the dependent variable from
the formula object <code>fixed</code> in the given sample data set. Thus, it
returns the original sample data set with transformed dependent variable.
For the transformation five types can be chosen, particularly no, natural
log, Box-Cox, Dual and Log-Shift transformation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data_transformation(fixed, smp_data, transformation, lambda)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="data_transformation_+3A_fixed">fixed</code></td>
<td>
<p>a two-sided linear formula object describing the
fixed-effects part of the nested error linear regression model with the
dependent variable on the left of a ~ operator and the explanatory
variables on the right, separated by + operators. The argument corresponds
to the argument <code>fixed</code> in function <code><a href="nlme.html#topic+lme">lme</a></code>.</p>
</td></tr>
<tr><td><code id="data_transformation_+3A_smp_data">smp_data</code></td>
<td>
<p>a data frame that needs to comprise all variables named in
<code>fixed</code>. If transformed data is further used to fit a nested error
linear regression model, <code>smp_data</code> also needs to comprise the variable
named in <code>smp_domains</code> (see <code><a href="#topic+ebp">ebp</a></code>).</p>
</td></tr>
<tr><td><code id="data_transformation_+3A_transformation">transformation</code></td>
<td>
<p>a character string. Five different transformation
methods for the dependent variable can be chosen (i) no transformation
(&quot;no&quot;); (ii) natural log transformation (&quot;log&quot;); (iii) Box-Cox transformation
(&quot;box.cox&quot;); (iv) Dual transformation (&quot;dual&quot;); (v) Log-Shift transformation
(&quot;log.shift&quot;)..</p>
</td></tr>
<tr><td><code id="data_transformation_+3A_lambda">lambda</code></td>
<td>
<p>a scalar parameter that determines the transformations with
transformation parameter. In case of no and natural log transformation
<code>lambda</code> can be set to NULL.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For the natural log, Box-Cox and Dual transformation, the dependent
variable is shifted such that all values are greater than zero since the
transformations are not applicable for values equal to or smaller than zero.
The shift is calculated as follows:
</p>
<p style="text-align: center;"><code class="reqn">shift = |min(y)| + 1 \qquad if \qquad min(y) &lt;= 0</code>
</p>

<p>Function <code>data_transformation</code> works as a wrapper function. This means
that the function manages the selection of the three different transformation
functions <code>no_transform</code>, <code>log_transform</code> and <code>box_cox</code>.
</p>


<h3>Value</h3>

<p>a named list with two elements, a data frame containing the data set
with transformed dependent variable (<code>transformed_data</code>) and a shift
parameter <code>shift</code> if present. In case of no transformation, the original
data frame is returned and the shift parameter is NULL.
</p>


<h3>See Also</h3>

<p><code><a href="nlme.html#topic+lme">lme</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Loading data - sample data
data("eusilcA_smp")

# Transform dependent variable in sample data with Box-Cox transformation
transform_data &lt;- data_transformation(eqIncome ~ gender + eqsize + cash +
  self_empl + unempl_ben + age_ben + surv_ben + sick_ben + dis_ben + rent +
  fam_allow + house_allow + cap_inv + tax_adj, eusilcA_smp, "box.cox", 0.7)
</code></pre>

<hr>
<h2 id='direct'>Direct Estimation of Disaggregated Indicators</h2><span id='topic+direct'></span>

<h3>Description</h3>

<p>Function <code>direct</code> estimates indicators only based on sample information.
The variance is estimated via a naive or calibrated bootstrap. The estimation
is adapted from the estimation of direct indicators in package
<span class="pkg">laeken</span>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>direct(
  y,
  smp_data,
  smp_domains,
  weights = NULL,
  design = NULL,
  threshold = NULL,
  var = FALSE,
  boot_type = "naive",
  B = 50,
  seed = 123,
  X_calib = NULL,
  totals = NULL,
  custom_indicator = NULL,
  na.rm = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="direct_+3A_y">y</code></td>
<td>
<p>a character string indicating the variable that is used for
estimating the indicators. The variable must be contained in the sample data.</p>
</td></tr>
<tr><td><code id="direct_+3A_smp_data">smp_data</code></td>
<td>
<p>survey data containing variable y as well as sampling
domains, and weights if selected.</p>
</td></tr>
<tr><td><code id="direct_+3A_smp_domains">smp_domains</code></td>
<td>
<p>a character containing the name of a variable
that indicates domains in the sample data. The variable must be numeric or a
factor.</p>
</td></tr>
<tr><td><code id="direct_+3A_weights">weights</code></td>
<td>
<p>a character string containing the name of a variable for
the sampling weights in the sample data. This argument is optional and
defaults to <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="direct_+3A_design">design</code></td>
<td>
<p>a character string containing the name of a variable for
different strata for stratified sampling designs. This argument is optional
and defaults to <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="direct_+3A_threshold">threshold</code></td>
<td>
<p>a number defining a threshold. Alternatively, a threshold
may be defined as a <code>function</code> of <code>y</code> and <code>weights</code> returning
a numeric value. Such a function will be evaluated once for the point
estimation and in each iteration of the parametric bootstrap. See Example 2
for using a function as threshold.  A threshold is needed for calculation
e.g. of head count ratios and poverty gaps. The argument defaults to
<code>NULL</code>. In this case, the threshold is set to 60% of the median of the
variable that is selected as <code>y</code> similarly to the at-risk-of-poverty
rate used in the EU (see also <cite>Social Protection Committee 2001</cite>).
However, any desired threshold can be chosen.</p>
</td></tr>
<tr><td><code id="direct_+3A_var">var</code></td>
<td>
<p>if <code>TRUE</code>, estimates for the variance are calculated using a
naive or calibrated bootstrap. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="direct_+3A_boot_type">boot_type</code></td>
<td>
<p>a character string containing the name of the bootstrap
specification. Either a <code>"naive"</code> or a <code>"calibrate"</code> bootstrap can
be used. See also <code><a href="laeken.html#topic+bootVar">bootVar</a></code>. Defaults to <code>naive</code>.</p>
</td></tr>
<tr><td><code id="direct_+3A_b">B</code></td>
<td>
<p>a number determining the number of bootstrap populations for the
bootstrap variance. Defaults to <code>50</code>.</p>
</td></tr>
<tr><td><code id="direct_+3A_seed">seed</code></td>
<td>
<p>an integer to set the seed for the random number generator.
Random number generation is used in the bootstrap approach. If seed is set to
<code>NULL</code>, seed is chosen randomly. Defaults to <code>123</code>.</p>
</td></tr>
<tr><td><code id="direct_+3A_x_calib">X_calib</code></td>
<td>
<p>a numeric matrix including calibration variables if the
calibrated bootstrap is chosen. Defaults to NULL.</p>
</td></tr>
<tr><td><code id="direct_+3A_totals">totals</code></td>
<td>
<p>a numeric vector providing the population totals if the
calibrated bootstrap is chosen. If a vector is chosen, the length of the
vector needs to equal the number of columns in X_calib. Defaults to
<code>NULL</code>. In this case, the sampling weights are used to calculate the
totals.</p>
</td></tr>
<tr><td><code id="direct_+3A_custom_indicator">custom_indicator</code></td>
<td>
<p>a list of functions containing the indicators to be
calculated additionally. Such functions must and must only depend on the
target variable <code>y</code> and optional can depend on <code>weights</code> and the
<code>threshold</code> (numeric value) (see Example 3). Defaults to <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="direct_+3A_na.rm">na.rm</code></td>
<td>
<p>if <code>TRUE</code>, observations with <code>NA</code> values are deleted
from the sample data. Defaults to <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The set of predefined indicators includes the mean, median, four
further quantiles (10%, 25%, 75% and 90%), head count ratio, poverty gap,
Gini coefficient and the quintile share ratio.
</p>


<h3>Value</h3>

<p>An object of class &quot;direct&quot;, &quot;emdi&quot; that provides direct estimators
for regional disaggregated indicators and optionally corresponding variance
estimates. Several generic functions have methods for the
returned object. For a full list and descriptions of the components of
objects of class &quot;emdi&quot;, see <code><a href="#topic+emdiObject">emdiObject</a></code>.
</p>


<h3>References</h3>

<p>Alfons, A. and Templ, M. (2013). Estimation of Social Exclusion Indicators
from Complex Surveys: The <span class="rlang"><b>R</b></span> Package <span class="pkg">laeken</span>. Journal of
Statistical Software, 54(15), 1-25.  <br /> <br />
Social Protection Committee (2001). Report on Indicators in the Field of
Poverty and Social Exclusions, Technical Report, European Union.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+emdiObject">emdiObject</a></code>, <code><a href="nlme.html#topic+lme">lme</a></code>,
<code><a href="#topic+estimators.emdi">estimators.emdi</a></code>, <code><a href="#topic+emdi_summaries">emdi_summaries</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading sample data
data("eusilcA_smp")

# Example 1: With weights and naive bootstrap
emdi_direct &lt;- direct(
  y = "eqIncome", smp_data = eusilcA_smp,
  smp_domains = "district", weights = "weight", threshold = 11064.82,
  var = TRUE, boot_type = "naive", B = 50, seed = 123, X_calib = NULL,
  totals = NULL, na.rm = TRUE
)

# Example 2: With function as threshold
emdi_direct &lt;- direct(
  y = "eqIncome", smp_data = eusilcA_smp,
  smp_domains = "district", weights = "weight", threshold =
    function(y, weights) {
      0.6 * laeken::weightedMedian(y, weights)
    }, na.rm = TRUE
)

# Example 3: With custom indicators
emdi_direct &lt;- direct(
  y = "eqIncome", smp_data = eusilcA_smp,
  smp_domains = "district", weights = "weight", threshold = 10859.24,
  var = TRUE, boot_type = "naive", B = 50, seed = 123, X_calib = NULL,
  totals = NULL, custom_indicator = list(my_max = function(y) {
    max(y)
  }, my_min = function(y) {
    min(y)
  }),
  na.rm = TRUE
)

</code></pre>

<hr>
<h2 id='ebp'>Empirical Best Prediction for Disaggregated Indicators</h2><span id='topic+ebp'></span>

<h3>Description</h3>

<p>Function <code>ebp</code> estimates indicators using the Empirical Best Prediction
approach by <cite>Molina and Rao (2010)</cite>. Point predictions of indicators
are obtained by Monte-Carlo approximations. Additionally, mean squared error
(MSE) estimation can be conducted by using a parametric bootstrap approach
(see also <cite>Gonzalez-Manteiga et al. (2008)</cite>). The unit-level model of
<cite>Battese, Harter and Fuller (1988)</cite> is fitted by the restricted maximum
likelihood (REML) method and one of
five different transformation types for the dependent variable can be chosen.
This approach can be extended to data under informative sampling using
weights and is based on <cite>Guadarrama et al. (2018)</cite>. Model  estimation
combines the uni-level model of <cite>Battese, Harter and Fuller (1988)</cite> and
the approach of <cite>You and Rao (2002)</cite> using survey weights. At the
moment, only the log-transformation is supported for this method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ebp(
  fixed,
  pop_data,
  pop_domains,
  smp_data,
  smp_domains,
  L = 50,
  threshold = NULL,
  transformation = "box.cox",
  interval = "default",
  MSE = FALSE,
  B = 50,
  seed = 123,
  boot_type = "parametric",
  parallel_mode = ifelse(grepl("windows", .Platform$OS.type), "socket", "multicore"),
  cpus = 1,
  custom_indicator = NULL,
  na.rm = FALSE,
  weights = NULL,
  pop_weights = NULL,
  aggregate_to = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ebp_+3A_fixed">fixed</code></td>
<td>
<p>a two-sided linear formula object describing the
fixed-effects part of the nested error linear regression model with the
dependent variable on the left of a ~ operator and the explanatory
variables on the right, separated by + operators. The argument corresponds
to the argument <code>fixed</code> in function <code><a href="nlme.html#topic+lme">lme</a></code>.</p>
</td></tr>
<tr><td><code id="ebp_+3A_pop_data">pop_data</code></td>
<td>
<p>a data frame that needs to comprise the variables
named on the right of the ~ operator in <code>fixed</code>, i.e. the explanatory
variables, and <code>pop_domains</code>.</p>
</td></tr>
<tr><td><code id="ebp_+3A_pop_domains">pop_domains</code></td>
<td>
<p>a character string containing the name of a variable that
indicates domains in the population data. The variable can be numeric or
a factor but needs to be of the same class as the variable named in
<code>smp_domains</code>.</p>
</td></tr>
<tr><td><code id="ebp_+3A_smp_data">smp_data</code></td>
<td>
<p>a data frame that needs to comprise all variables named in
<code>fixed</code> and <code>smp_domains</code>.</p>
</td></tr>
<tr><td><code id="ebp_+3A_smp_domains">smp_domains</code></td>
<td>
<p>a character string containing the name of a variable
that indicates domains in the sample data. The variable can be numeric or a
factor but needs to be of the same class as the variable named in
<code>pop_domains</code>.</p>
</td></tr>
<tr><td><code id="ebp_+3A_l">L</code></td>
<td>
<p>a number determining the number of Monte-Carlo simulations that
must be at least 1. Defaults to 50. For practical applications, values
larger than 200 are recommended (see also
<cite>Molina, I. and Rao, J.N.K. (2010)</cite>).</p>
</td></tr>
<tr><td><code id="ebp_+3A_threshold">threshold</code></td>
<td>
<p>a number defining a threshold. Alternatively, a threshold
may be defined as a <code>function</code> of <code>y</code> returning a numeric value.
Such a function will be evaluated once for the point estimation and in each
iteration of the parametric bootstrap. A threshold is needed for calculation
e.g. of head count ratios and poverty gaps. The  argument defaults to
<code>NULL</code>. In this case, the threshold is set to 60% of the median of the
variable that is selected as dependent variable similary to the
at-risk-of-poverty rate used in the EU (see also
<cite>Social Protection  Committee 2001</cite>). However, any desired threshold can
be chosen.</p>
</td></tr>
<tr><td><code id="ebp_+3A_transformation">transformation</code></td>
<td>
<p>a character string. Five different transformation
types for the dependent variable can be chosen (i) no transformation (&quot;no&quot;);
(ii) log transformation (&quot;log&quot;); (iii) Box-Cox transformation (&quot;box.cox&quot;);
(iv) Dual transformation (&quot;dual&quot;); (v) Log-Shift transformation
(&quot;log.shift&quot;). Defaults to <code>"box.cox"</code>.</p>
</td></tr>
<tr><td><code id="ebp_+3A_interval">interval</code></td>
<td>
<p>a string equal to 'default' or a numeric vector containing a
lower and upper limit determining an interval for the estimation of the
optimal parameter. The interval is passed to function
<code><a href="stats.html#topic+optimize">optimize</a></code> for the optimization. Defaults to 'default'
which equals c(-1,2) for Box-Cox, c(0,2) for Dual and an interval based on
the range of y for Log-Shift transformation. If the convergence fails, it is
often advisable to choose a smaller more suitable interval. For right skewed
distributions, the negative values may be excluded, also values larger than
1 are seldom observed.</p>
</td></tr>
<tr><td><code id="ebp_+3A_mse">MSE</code></td>
<td>
<p>if <code>TRUE</code>, MSE estimates using a parametric bootstrap
approach are calculated (see also <cite>Gonzalez-Manteiga et al. (2008)</cite>).
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="ebp_+3A_b">B</code></td>
<td>
<p>a number determining the number of bootstrap populations in the
parametric bootstrap approach (see also
<cite>Gonzalez-Manteiga et al. (2008)</cite>) used in the MSE estimation. The
number must be greater than 1. Defaults to 50. For practical applications,
values larger than 200 are recommended (see also
<cite>Molina, I. and Rao, J.N.K. (2010)</cite>).</p>
</td></tr>
<tr><td><code id="ebp_+3A_seed">seed</code></td>
<td>
<p>an integer to set the seed for the random number generator. For
the usage of random number generation, see Details. If seed is set to
<code>NULL</code>, seed is chosen randomly. Defaults to <code>123</code>.</p>
</td></tr>
<tr><td><code id="ebp_+3A_boot_type">boot_type</code></td>
<td>
<p>character string to choose between different MSE estimation
procedures,currently a <code>"parametric"</code> and a semi-parametric
<code>"wild"</code> bootstrap are possible. Defaults to <code>"parametric"</code>.</p>
</td></tr>
<tr><td><code id="ebp_+3A_parallel_mode">parallel_mode</code></td>
<td>
<p>modus of parallelization, defaults to an automatic
selection of a suitable mode, depending on the operating system, if the
number of <code>cpus</code> is chosen higher than 1. For details, see
<code><a href="parallelMap.html#topic+parallelStart">parallelStart</a></code>.</p>
</td></tr>
<tr><td><code id="ebp_+3A_cpus">cpus</code></td>
<td>
<p>number determining the kernels that are used for the
parallelization. Defaults to 1. For details, see
<code><a href="parallelMap.html#topic+parallelStart">parallelStart</a></code>.</p>
</td></tr>
<tr><td><code id="ebp_+3A_custom_indicator">custom_indicator</code></td>
<td>
<p>a list of functions containing the indicators to be
calculated additionally. Such functions must depend on the target variable
<code>y</code>, and optional can depend on <code>pop_weights</code> and the
<code>threshold</code>. Defaults to <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="ebp_+3A_na.rm">na.rm</code></td>
<td>
<p>if <code>TRUE</code>, observations with <code>NA</code> values are deleted
from the population and sample data. For the EBP procedure complete
observations are required. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="ebp_+3A_weights">weights</code></td>
<td>
<p>a character string containing the name of a variable that
indicates weights in the sample data. If a character string is provided
a weighted version of the ebp will be used. The variable has to be numeric.
Defaults to <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="ebp_+3A_pop_weights">pop_weights</code></td>
<td>
<p>a character string containing the name of a variable that
indicates population weights in the populatation data. If a character string
is provided weighted indicators are estimated using population weights.
The variable has to be numeric. Defaults to <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="ebp_+3A_aggregate_to">aggregate_to</code></td>
<td>
<p>a character string containing the name of a variable from
population data that indicates the target domain level for which the
results are to be displayed. The variable can be numeric or a factor.
Defaults to <code>NULL</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For Monte-Carlo approximations and in the parametric bootstrap
approach random number generation is used. Thus, a seed is set by the
argument <code>seed</code>. <br /> <br />
The set of predefined indicators includes the mean, median, four further
quantiles (10%, 25%, 75% and 90%), head count ratio, poverty gap, Gini
coefficient and the quintile share ratio. <br /> <br />
Since the sample observations often cannot be identified in practical
applications, a modified approach by Guadarrama et al. (2016) called census
EBP is implemented for the point estimation. For the MSE estimation, the
bootstrap sample is not extracted from the superpopulation, but generated by
the estimated model parameters. The lower the ratio between the sample and
the population size, the closer are the results to the proposed approach by
Molina and Rao (2010).
</p>


<h3>Value</h3>

<p>An object of class &quot;ebp&quot;, &quot;emdi&quot; that provides estimators for
regional disaggregated indicators and optionally corresponding MSE estimates.
Several generic functions have methods for the returned object. For a full
list and descriptions of the components of objects of class &quot;emdi&quot;,
see <code><a href="#topic+emdiObject">emdiObject</a></code>.
</p>


<h3>References</h3>

<p>Battese, G.E., Harter, R.M. and Fuller, W.A. (1988). An Error-Components
Model for Predictions of County Crop Areas Using Survey and Satellite Data.
Journal of the American Statistical Association, Vol.83, No. 401,
28-36.<br /> <br />
Gonzalez-Manteiga, W. et al. (2008). Bootstrap mean squared error of
a small-area EBLUP. Journal of Statistical Computation and Simulation,
78:5, 443-462. <br /> <br />
Guadarrama, M., Molina, I. and Rao, J.N.K. (2016). A comparison of small area
estimation methods for poverty mapping. Joint Issue: Statistics in Transition
New Series Survey Methodology, Vol.17, No. 1, 41–66. <br /> <br />
Guadarrama, M., Molina, I. and Rao, J.N.K. (2018). Small area estimation of
general parameters under complex sampling designs. Computational Statistics &amp;
Data Analysis, Vol. 121, 20-40. <br /> <br />
Kreutzmann, A., Pannier, S., Rojas-Perilla, N., Schmid, T., Templ, M.
and Tzavidis, N. (2019). The R Package emdi for Estimating and
Mapping Regionally Disaggregated Indicators, Journal of Statistical Software,
Vol. 91, No. 7, 1&ndash;33, &lt;doi:10.18637/jss.v091.i07&gt; <br /> <br />
Molina, I. and Rao, J.N.K. (2010). Small area estimation of poverty
indicators. The Canadian Journal of Statistics, Vol. 38, No.3,
369-385. <br /> <br />
Social Protection Committee (2001). Report on indicators in the field of
poverty and social exclusions, Technical Report, European Union.
You, Y., Rao, J.N.K. (2002).  A pseudo-empirical best linear unbiased
prediction approach to small area estimation using survey weights. The
Canadian Journal of Statistics. Vol. 30, No. 3, 431–439.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+emdiObject">emdiObject</a></code>, <code><a href="nlme.html#topic+lme">lme</a></code>,
<code><a href="#topic+estimators.emdi">estimators.emdi</a></code>,  <code><a href="#topic+plot.emdi">plot.emdi</a></code>,
<code><a href="#topic+emdi_summaries">emdi_summaries</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading data - population and sample data
data("eusilcA_pop")
data("eusilcA_smp")

# Example 1: With default setting but na.rm=TRUE
emdi_model &lt;- ebp(
  fixed = eqIncome ~ gender + eqsize + cash + self_empl +
    unempl_ben + age_ben + surv_ben + sick_ben + dis_ben + rent + fam_allow +
    house_allow + cap_inv + tax_adj, pop_data = eusilcA_pop,
  pop_domains = "district", smp_data = eusilcA_smp, smp_domains = "district",
  na.rm = TRUE
)


# Example 2: With MSE, two additional indicators and function as threshold -
# Please note that the example runs for several minutes. For a short check
# change L and B to lower values.
emdi_model &lt;- ebp(
  fixed = eqIncome ~ gender + eqsize + cash +
    self_empl + unempl_ben + age_ben + surv_ben + sick_ben + dis_ben + rent +
    fam_allow + house_allow + cap_inv + tax_adj, pop_data = eusilcA_pop,
  pop_domains = "district", smp_data = eusilcA_smp, smp_domains = "district",
  threshold = function(y) {
    0.6 * median(y)
  }, transformation = "log",
  L = 50, MSE = TRUE, boot_type = "wild", B = 50, custom_indicator =
    list(
      my_max = function(y) {
        max(y)
      },
      my_min = function(y) {
        min(y)
      }
    ), na.rm = TRUE, cpus = 1
)

# Example 3: With default setting but na.rm=TRUE under informative sampling.
emdi_model &lt;- ebp(
  fixed = eqIncome ~ gender + eqsize + cash + self_empl +
    unempl_ben + age_ben + surv_ben + sick_ben + dis_ben + rent + fam_allow +
    house_allow + cap_inv + tax_adj, pop_data = eusilcA_pop,
  pop_domains = "district", smp_data = eusilcA_smp, smp_domains = "district",
  weights = "weight", transformation = "log", na.rm = TRUE
)

# Example 4: With default setting and random effect on the district level
# while the output is at state level
emdi_model &lt;- ebp(
  fixed = eqIncome ~ gender + eqsize + cash + self_empl +
    unempl_ben + age_ben + surv_ben + sick_ben + dis_ben + rent + fam_allow +
    house_allow + cap_inv + tax_adj, pop_data = eusilcA_pop,
  pop_domains = "district", smp_data = eusilcA_smp, smp_domains = "district",
  na.rm = TRUE, aggregate_to = "state"
)

# Example 5: With default setting using pop_weights to get weighted
# indicators according to equivalized household size and an using an
# custom_indicator using pop_weights
emdi_model &lt;- ebp(
  fixed = eqIncome ~ gender + eqsize + cash + self_empl +
    unempl_ben + age_ben + surv_ben + sick_ben + dis_ben + rent + fam_allow +
    house_allow + cap_inv + tax_adj, pop_data = eusilcA_pop,
  pop_domains = "district", smp_data = eusilcA_smp, smp_domains = "district",
  custom_indicator =
    list(HCR_singleHH = function(y, pop_weights, threshold) {
                              mean(y[pop_weights == 1] &lt; threshold)
                        }
    ), na.rm = TRUE, pop_weights = "eqsize"
)

</code></pre>

<hr>
<h2 id='emdi'>A package for estimating and mapping disaggregated indicators</h2><span id='topic+emdi'></span>

<h3>Description</h3>

<p>The package <span class="pkg">emdi</span> supports estimating and mapping regional
disaggregated indicators. For estimating these indicators, direct estimation,
the unit-level Empirical Best Prediction approach by
<cite>Molina and Rao (2010)</cite>, the extension for data under informative
selection by <cite>Guadarrama et al. (2018)</cite>, the area-level model by
<cite>Fay and Herriot (1979)</cite> and various extensions of it (adjusted variance
estimation methods, log and arcsin transformation, spatial, robust and
measurement error models) are provided. Depending on the particular method,
analytical, bootstrap and jackknife MSE estimation approaches are
implemented. The assessment of the used model is supported by a summary and
diagnostic plots. For a suitable presentation of estimates, map plots can be
easily created. Furthermore, results can easily be exported to Excel.
Additionally, for the area-level models a stepwise variable selection
function, benchmarking options and spatial correlation tests are provided.
</p>


<h3>Details</h3>

<p>The three estimation functions are called <code><a href="#topic+direct">direct</a></code>,
<code><a href="#topic+ebp">ebp</a></code> and <code><a href="#topic+fh">fh</a></code>. For all functions, several methods
are available as <code><a href="#topic+estimators.emdi">estimators.emdi</a></code> and
<code><a href="#topic+emdi_summaries">emdi_summaries</a></code>. For a full list, please see
<code><a href="#topic+emdiObject">emdiObject</a></code>. Furthermore, functions <code><a href="#topic+map_plot">map_plot</a></code> and
<code><a href="#topic+write.excel">write.excel</a></code> help to visualize and export results. An overview
of all currently provided functions can be requested by
<code>library(help=emdi)</code>.
</p>


<h3>References</h3>

<p>Battese, G.E., Harter, R.M. and Fuller, W.A. (1988). An Error-Components
Model for Predictions of County Crop Areas Using Survey and Satellite Data.
Journal of the American Statistical Association, Vol.83, No. 401,
28-36. <br /> <br />
Fay, R. E. and Herriot, R. A. (1979), Estimates of income for small places:
An application of James-Stein procedures to census data, Journal of the
American Statistical Association 74(366), 269-277. <br /> <br />
Kreutzmann, A., Pannier, S., Rojas-Perilla, N., Schmid, T., Templ, M.
and Tzavidis, N. (2019). The R Package emdi for Estimating and
Mapping Regionally Disaggregated Indicators, Journal of Statistical Software,
Vol. 91, No. 7, 1&ndash;33, &lt;doi:10.18637/jss.v091.i07&gt; <br /> <br />
Molina, I. and Rao, J.N.K. (2010). Small area estimation of poverty
indicators. The Canadian Journal of Statistics, Vol. 38, No.3, 369-385.
Guadarrama, M., Molina, I. and Rao, J.N.K. (2018). Small area estimation of
general parameters under complex sampling designs. Computational Statistics &amp;
Data Analysis, Vol. 121, 20-40.
</p>

<hr>
<h2 id='emdi_summaries'>Summarizes an emdiObject</h2><span id='topic+emdi_summaries'></span><span id='topic+summary.direct'></span><span id='topic+summary.ebp'></span><span id='topic+summary.fh'></span>

<h3>Description</h3>

<p>Additional information about the data and model in small area estimation
methods and components of an emdi object are extracted. The generic function
summary has methods for classes &quot;direct&quot;, &quot;ebp&quot; and &quot;fh&quot; and the returned
object is suitable for printing  with the <code>print</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'direct'
summary(object, ...)

## S3 method for class 'ebp'
summary(object, ...)

## S3 method for class 'fh'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="emdi_summaries_+3A_object">object</code></td>
<td>
<p>an object of type &quot;direct&quot;, &quot;ebp&quot; or &quot;fh&quot;, representing point
and MSE estimates. Objects differ depending on the estimation method.</p>
</td></tr>
<tr><td><code id="emdi_summaries_+3A_...">...</code></td>
<td>
<p>additional arguments that are not used in this method.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an object of type &quot;summary.direct&quot;, &quot;summary.ebp&quot; or &quot;summary.fh&quot;
with information about the sample and population data, the usage of
transformation, normality tests and information of the model fit.
</p>


<h3>References</h3>

<p>Lahiri, P. and Suntornchost, J. (2015), Variable selection for linear mixed
models with applications in small area estimation, The Indian Journal of
Statistics 77-B(2), 312-320. <br /> <br />
Marhuenda, Y., Morales, D. and Pardo, M.C. (2014). Information criteria for
Fay-Herriot model selection. Computational Statistics and Data Analysis 70,
268-280. <br /> <br />
Nakagawa S, Schielzeth H (2013). A general and simple method for obtaining
R2 from generalized linear mixed-effects models. Methods in Ecology and
Evolution, 4(2), 133-142.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+emdiObject">emdiObject</a></code>, <code><a href="#topic+direct">direct</a></code>, <code><a href="#topic+ebp">ebp</a></code>,
<code><a href="#topic+fh">fh</a></code>, <code><a href="MuMIn.html#topic+r.squaredGLMM">r.squaredGLMM</a></code>,
<code><a href="moments.html#topic+skewness">skewness</a></code>,
<code><a href="moments.html#topic+kurtosis">kurtosis</a></code>, <code><a href="stats.html#topic+shapiro.test">shapiro.test</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Example for models of type ebp

# Loading data - population and sample data
data("eusilcA_pop")
data("eusilcA_smp")

# Example with two additional indicators
emdi_model &lt;- ebp(
  fixed = eqIncome ~ gender + eqsize + cash +
    self_empl + unempl_ben + age_ben + surv_ben + sick_ben + dis_ben + rent +
    fam_allow + house_allow + cap_inv + tax_adj, pop_data = eusilcA_pop,
  pop_domains = "district", smp_data = eusilcA_smp, smp_domains = "district",
  threshold = function(y) {
    0.6 * median(y)
  }, L = 50, MSE = TRUE, B = 50,
  custom_indicator = list(
    my_max = function(y) {
      max(y)
    },
    my_min = function(y) {
      min(y)
    }
  ), na.rm = TRUE, cpus = 1
)

# Example 1: Receive first overview
summary(emdi_model)


# Example for models of type fh

# Loading data - population and sample data
data("eusilcA_popAgg")
data("eusilcA_smpAgg")

# Combine sample and population data
combined_data &lt;- combine_data(
  pop_data = eusilcA_popAgg,
  pop_domains = "Domain",
  smp_data = eusilcA_smpAgg,
  smp_domains = "Domain"
)

# Generation of the emdi object
fh_std &lt;- fh(
  fixed = Mean ~ cash + self_empl, vardir = "Var_Mean",
  combined_data = combined_data, domains = "Domain",
  method = "ml", MSE = TRUE
)

# Example 2: Receive first overview
summary(fh_std)

</code></pre>

<hr>
<h2 id='emdiObject'>Fitted emdiObject</h2><span id='topic+emdiObject'></span>

<h3>Description</h3>

<p>An object of class emdi that represents point predictions of regional
disaggregated indicators. Optionally, it also contains corresponding MSE
estimates. Three different estimation approaches are implemented:
direct estimation (class 'direct), the Fay-Herriot model (class &quot;fh&quot;), and
the empirical best prediction (class &quot;ebp&quot;). Objects of these classes have
methods for various generic functions. See Details for more information.
</p>


<h3>Details</h3>

<p>Objects of class &quot;emdi&quot; have following methods:
<code><a href="#topic+compare_pred">compare_pred</a></code>, <code><a href="#topic+estimators">estimators</a></code>,
<code><a href="#topic+plot.emdi">plot.emdi</a></code>, <code><a href="#topic+predict.emdi">predict.emdi</a></code>,
<code><a href="#topic+qqnorm.emdi">qqnorm.emdi</a></code><br /> <br />
Objects of class &quot;direct&quot;, &quot;ebp&quot; and &quot;fh&quot; have methods for following generic
functions: <code><a href="#topic+compare_plot">compare_plot</a></code>, <code><a href="#topic+getData">getData</a></code>,
<code><a href="#topic+getGroups">getGroups</a></code>, <code><a href="#topic+getGroupsFormula">getGroupsFormula</a></code>,
<code><a href="#topic+getResponse">getResponse</a></code>,
<code>plot</code> (for documentation, see <code><a href="#topic+plot.emdi">plot.emdi</a></code>),
<code>print</code>, <code>qqnorm</code> (for documentation, see
<code><a href="#topic+qqnorm.emdi">qqnorm.emdi</a></code>) and <code>summary</code> (for documentation,
see <code><a href="#topic+emdi_summaries">emdi_summaries</a></code>).<br /> <br />
Objects of class &quot;ebp&quot; and &quot;fh&quot; additionally have methods for following
generic functions: <code>coef</code> (for default documentation,
see <code><a href="stats.html#topic+coef">coef</a></code>), <code>confint</code> (for default documentation,
see <code><a href="stats.html#topic+confint">confint</a></code>), <code>family</code> (for default
documentation, see <code><a href="stats.html#topic+family">family</a></code>), <code>fitted</code> (for default
documentation, see <code><a href="stats.html#topic+fitted.values">fitted.values</a></code>),
<code><a href="#topic+fixef">fixef</a></code>, <code>formula</code> (for default documentation, see
<code><a href="stats.html#topic+formula">formula</a></code>), <code><a href="#topic+getVarCov">getVarCov</a></code>,
<code><a href="#topic+intervals">intervals</a></code>, <code>logLik</code> (for default documentation,
see <code><a href="stats.html#topic+logLik">logLik</a></code>), <code>nobs</code> (for default documentation,
see <code><a href="stats.html#topic+nobs">nobs</a></code>), <code><a href="#topic+ranef">ranef</a></code>, <code>residuals</code>
(for default documentation, see <code><a href="stats.html#topic+residuals">residuals</a></code>), <code>terms</code>
(for default documentation, see <code><a href="stats.html#topic+terms">terms</a></code>), <code>vcov</code> (for
default documentation, see <code><a href="stats.html#topic+vcov">vcov</a></code>) <br /> <br />
Objects of class &quot;ebp&quot; have additionally methods for following generic
functions: <code>sigma</code> (for default documentation, see
<code><a href="stats.html#topic+sigma">sigma</a></code>)<br /> <br />
Objects of class &quot;fh&quot; have additionally methods for following generic
functions: <code><a href="#topic+compare">compare</a></code>, <code>extractAIC</code> (for default
documentation, see <code><a href="stats.html#topic+extractAIC">extractAIC</a></code>) and
<code><a href="#topic+step">step</a></code>.
</p>


<h3>Value</h3>

<p>The following components are always included in an emdi object but not
always filled and with different components depending on the estimation
approach:
</p>
<table>
<tr><td><code>call</code></td>
<td>
<p>the function call that produced the object.</p>
</td></tr>
<tr><td><code>fixed</code></td>
<td>
<p>for details, see <code>fixed</code> in <code><a href="#topic+fh">fh</a></code> and
<code><a href="#topic+ebp">ebp</a></code>. Not filled for class &quot;direct&quot;.</p>
</td></tr>
<tr><td><code>framework</code></td>
<td>
<p>a list with components that describe the data
setup, e.g., number of domains in the sample.</p>
</td></tr>
<tr><td><code>ind</code></td>
<td>
<p>data frame containing estimates for indicators per
domain.</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p>character returning the method for the estimation
approach used to fit the linear mixed model and for the the optimal lambda
(for class &quot;ebp&quot;), here &quot;reml&quot;, or a list returning method for the estimation
of the variance of the random effect and the applied MSE estimation (for
class &quot;fh&quot;). Not filled for class &quot;direct&quot;.</p>
</td></tr>
<tr><td><code>model</code></td>
<td>
<p>list containing a  selection of model components.
Not filled for class &quot;direct&quot;.</p>
</td></tr>
<tr><td><code>MSE</code></td>
<td>
<p>data frame containing MSE estimates corresponding to the
point predictions in <code>ind</code> per indicator per domain if MSE is selected
in function call. If <code>FALSE</code>, <code>MSE</code> is <code>NULL</code>.</p>
</td></tr>
<tr><td><code>transformation</code></td>
<td>
<p>character or list containing information about
applied transformation and, if appropriate, backtransformation. Not filled
for class &quot;direct&quot;.</p>
</td></tr>
<tr><td><code>transform_param</code></td>
<td>
<p>a list with two elements, <code>optimal_lambda</code>
and <code>shift_par</code>, where the first contains the optimal parameter for a
transformation with transformation parameter or NULL for no and log
transformation and the second the potential shift parameter in the log or
Box-Cox transformation and NULL for no transformation. Not filled for
class &quot;fh&quot; and &quot;direct&quot;.</p>
</td></tr>
<tr><td><code>successful_bootstraps</code></td>
<td>
<p>for class &quot;direct&quot;, a matrix with domains
as rows and indicators as columns. The cells contain the number of successful
bootstraps for each combination. For non-robust spatial Fay-Herriot, string
with number of successful bootstraps. Not filled for other models.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Alfons, A. and Templ, M. (2013). Estimation of Social Exclusion Indicators
from Complex Surveys: The <span class="rlang"><b>R</b></span> Package <span class="pkg">laeken</span>. Journal of
Statistical Software, 54(15), 1-25.  <br /> <br />
Fay R.E., Herriot R.A. (1979) Estimates of income for small places: An
application of James–Stein procedures to census data. Journal of the
American Statistical Association, Vol. 74, 269–277.  <br /> <br />
Molina, I. and Rao, J.N.K. (2010). Small area estimation of poverty
indicators. The Canadian Journal of Statistics, Vol. 38, No.3, 369-385.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+direct">direct</a></code>, <code><a href="#topic+ebp">ebp</a></code>, <code><a href="#topic+fh">fh</a></code>,
<code> <a href="nlme.html#topic+lme">lme</a></code>, <code> <a href="nlme.html#topic+lmeObject">lmeObject</a></code>
</p>

<hr>
<h2 id='estimators'>Presents Point, MSE and CV Estimates</h2><span id='topic+estimators'></span><span id='topic+estimators.emdi'></span>

<h3>Description</h3>

<p>Function <code>estimators</code> is a generic function used to present point and
mean squared error (MSE) estimates and calculated coefficients of variation
(CV).
</p>
<p>Method <code>estimators.emdi</code> presents point and MSE estimates for regional
disaggregated indicators. Coefficients of variation are calculated
using these estimators. This method enables to select for which indicators
the estimates shall be returned. The returned object is suitable for
printing with the <code>print.estimators.emdi</code> method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimators(object, indicator, MSE, CV, ...)

## S3 method for class 'emdi'
estimators(object, indicator = "all", MSE = FALSE, CV = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estimators_+3A_object">object</code></td>
<td>
<p>an object of type &quot;emdi&quot;, representing point and,
if chosen, MSE estimates.</p>
</td></tr>
<tr><td><code id="estimators_+3A_indicator">indicator</code></td>
<td>
<p>optional character vector that selects which indicators
shall be returned: (i) all calculated indicators (&quot;all&quot;);
(ii) each indicator name: &quot;Mean&quot;, &quot;Quantile_10&quot;, &quot;Quantile_25&quot;, &quot;Median&quot;,
&quot;Quantile_75&quot;, &quot;Quantile_90&quot;, &quot;Head_Count&quot;,
&quot;Poverty_Gap&quot;, &quot;Gini&quot;, &quot;Quintile_Share&quot; or the function name/s of
&quot;custom_indicator/s&quot;; (iii) groups of indicators: &quot;Quantiles&quot;, &quot;Poverty&quot;,
&quot;Inequality&quot; or &quot;Custom&quot;. If two of these groups are selected, only the first
one is returned. Note, additional custom indicators can be
defined as argument for model-based approaches (see also <code><a href="#topic+ebp">ebp</a></code>)
and do not appear in groups of indicators even though these might belong to
one of the groups. If the <code>model</code> argument is of type &quot;fh&quot;,
indicator can be set to &quot;all&quot;, &quot;Direct&quot;, FH&quot;, or &quot;FH_Bench&quot; (if emdi
object is overwritten by function benchmark). Defaults to &quot;all&quot;.</p>
</td></tr>
<tr><td><code id="estimators_+3A_mse">MSE</code></td>
<td>
<p>optional logical. If <code>TRUE</code>, MSE estimates for selected
indicators per domain are added to the data frame of point estimates.
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="estimators_+3A_cv">CV</code></td>
<td>
<p>optional logical. If <code>TRUE</code>, coefficients of variation for
selected indicators per domain are added to the data frame of point
estimates. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="estimators_+3A_...">...</code></td>
<td>
<p>other parameters that can be passed to function <code>estimators</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Objects of class &quot;estimators.emdi&quot; have methods for following
generic functions: <code>head</code> and <code>tail</code> (for default documentation,
see <code><a href="utils.html#topic+head">head</a></code>),  <code>as.matrix</code> (for default documentation,
see <code><a href="base.html#topic+matrix">matrix</a></code>), <code>as.data.frame</code> (for default
documentation, see <code><a href="base.html#topic+as.data.frame">as.data.frame</a></code>), <code>subset</code> (for
default documentation, see <code><a href="base.html#topic+subset">subset</a></code>).
</p>


<h3>Value</h3>

<p>The return of <code>estimators</code> depends on the class of its argument. The
documentation of particular methods gives detailed information about the
return of that method.
</p>
<p>The return of <code>estimators.emdi</code> is an object of type &quot;estimators.emdi&quot;
with point and/or MSE estimates and/or calculated CV's per domain obtained
from <code>emdiObject$ind</code> and, if chosen, <code>emdiObject$MSE</code>. These
objects contain two elements, one data frame <code>ind</code> and a character
naming the indicator or indicator group <code>ind_name</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+emdiObject">emdiObject</a></code>, <code><a href="#topic+direct">direct</a></code>, <code><a href="#topic+ebp">ebp</a></code>,
<code><a href="#topic+fh">fh</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading data - population and sample data
data("eusilcA_pop")
data("eusilcA_smp")

# Generate emdi object with additional indicators; here via function ebp()
emdi_model &lt;- ebp(
  fixed = eqIncome ~ gender + eqsize + cash +
    self_empl + unempl_ben + age_ben + surv_ben + sick_ben + dis_ben + rent +
    fam_allow + house_allow + cap_inv + tax_adj, pop_data = eusilcA_pop,
  pop_domains = "district", smp_data = eusilcA_smp, smp_domains = "district",
  threshold = 11064.82, transformation = "box.cox",
  L = 50, MSE = TRUE, B = 50, custom_indicator =
    list(
      my_max = function(y) {
        max(y)
      },
      my_min = function(y) {
        min(y)
      }
    ), na.rm = TRUE, cpus = 1
)

# Example 1: Choose Gini coefficient, MSE and CV
gini &lt;- estimators(emdi_model, indicator = "Gini", MSE = TRUE, CV = TRUE)
head(gini)
tail(gini)
as.data.frame(gini)
as.matrix(gini)
subset(gini, Domain = "Wien")

# Example 2: Choose custom indicators without MSE and CV
estimators(emdi_model, indicator = "Custom")

</code></pre>

<hr>
<h2 id='eusilcA_pop'>Simulated eusilc data - population data</h2><span id='topic+eusilcA_pop'></span>

<h3>Description</h3>

<p>The data set is synthetic EU-SILC data based on the data set
<code><a href="simFrame.html#topic+eusilcP">eusilcP</a></code> from package <span class="pkg">simFrame</span>. The data set is
reduced to 17 variables containing three regional variables for the states
and districts.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>eusilcA_pop
</code></pre>


<h3>Format</h3>

<p>A data frame with 25000 observations and 17 variables:
</p>

<dl>
<dt>eqIncome</dt><dd><p>numeric; a simplified version of the equivalized household
income.</p>
</dd>
<dt>eqsize</dt><dd><p>numeric; the equivalized household size according to the
modified OECD scale.</p>
</dd>
<dt>gender</dt><dd><p>factor; the person's gender (levels: male and female).</p>
</dd>
<dt>cash</dt><dd><p>numeric; employee cash or near cash income (net).</p>
</dd>
<dt>self_empl</dt><dd><p>numeric; cash benefits or losses from self-employment
(net).</p>
</dd>
<dt>unempl_ben</dt><dd><p>numeric; unemployment benefits (net).</p>
</dd>
<dt>age_ben</dt><dd><p>numeric; old-age benefits (net).</p>
</dd>
<dt>surv_ben</dt><dd><p>numeric; survivor's benefits (net).</p>
</dd>
<dt>sick_ben</dt><dd><p>numeric; sickness benefits (net).</p>
</dd>
<dt>dis_ben</dt><dd><p>numeric; disability benefits (net).</p>
</dd>
<dt>rent</dt><dd><p>numeric; income from rental of a property or land (net).</p>
</dd>
<dt>fam_allow</dt><dd><p>numeric; family/children related allowances (net).</p>
</dd>
<dt>house_allow</dt><dd><p>numeric; housing allowances (net).</p>
</dd>
<dt>cap_inv</dt><dd><p>numeric; interest, dividends, profit from capital investments
in unincorporated business (net).</p>
</dd>
<dt>tax_adj</dt><dd><p>numeric; repayments/receipts for tax adjustment (net).</p>
</dd>
<dt>state</dt><dd><p>factor; state (nine levels).</p>
</dd>
<dt>district</dt><dd><p>factor; districts (94 levels).</p>
</dd>
</dl>


<hr>
<h2 id='eusilcA_popAgg'>Simulated eusilc data - aggregated population data</h2><span id='topic+eusilcA_popAgg'></span>

<h3>Description</h3>

<p>The data set is synthetic EU-SILC data based on the data set
<code><a href="simFrame.html#topic+eusilcP">eusilcP</a></code> from package <span class="pkg">simFrame</span>. The data set is
reduced to 15 variables including a regional variable for the districts and
contains the household level data that is aggregated on the district level.
Therefore, except for the variables <code>ratio_n</code> and <code>Domain</code>,
the variables are the mean values per district.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>eusilcA_popAgg
</code></pre>


<h3>Format</h3>

<p>A data frame with 94 observations and 15 variables:
</p>

<dl>
<dt>eqsize</dt><dd><p>numeric; the equivalized household size according to the
modified OECD scale.</p>
</dd>
<dt>cash</dt><dd><p>numeric; employee cash or near cash income (net).</p>
</dd>
<dt>self_empl</dt><dd><p>numeric; cash benefits or losses from self-employment
(net).</p>
</dd>
<dt>unempl_ben</dt><dd><p>numeric; unemployment benefits (net).</p>
</dd>
<dt>age_ben</dt><dd><p>numeric; old-age benefits (net).</p>
</dd>
<dt>surv_ben</dt><dd><p>numeric; survivor's benefits (net).</p>
</dd>
<dt>sick_ben</dt><dd><p>numeric; sickness benefits (net).</p>
</dd>
<dt>dis_ben</dt><dd><p>numeric; disability benefits (net).</p>
</dd>
<dt>rent</dt><dd><p>numeric; income from rental of a property or land (net).</p>
</dd>
<dt>fam_allow</dt><dd><p>numeric; family/children related allowances (net).</p>
</dd>
<dt>house_allow</dt><dd><p>numeric; housing allowances (net).</p>
</dd>
<dt>cap_inv</dt><dd><p>numeric; interest, dividends, profit from capital investments
in unincorporated business (net).</p>
</dd>
<dt>tax_adj</dt><dd><p>numeric; repayments/receipts for tax adjustment (net).</p>
</dd>
<dt>ratio_n</dt><dd><p>numeric; ratios of the population size per area and the total
population size.</p>
</dd>
<dt>Domain</dt><dd><p>factor; Austrian districts (94 levels).</p>
</dd>
</dl>


<hr>
<h2 id='eusilcA_prox'>Proximity matrix for spatial area-level models</h2><span id='topic+eusilcA_prox'></span>

<h3>Description</h3>

<p>A data set comprising the row-standardized proximities between the
domains of the <code><a href="#topic+eusilcA_smpAgg">eusilcA_smpAgg</a></code> data set.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>eusilcA_prox
</code></pre>


<h3>Format</h3>

<p>A data set with dimensions number of areas (94) times
number of areas (94). Values lie between <code>0</code> and <code>1</code>. The
respective row sums amount to 1.
</p>


<h3>Details</h3>

<p>For a description of how to create the proximity matrix,
see the package vignette &quot;A Framework for Producing Small Area Estimates
Based on Area-Level Models in R&quot;.
</p>

<hr>
<h2 id='eusilcA_smp'>Simulated eusilc data - sample data</h2><span id='topic+eusilcA_smp'></span>

<h3>Description</h3>

<p>The data set is a simple random sample of data set <code><a href="#topic+eusilcA_pop">eusilcA_pop</a></code>
which is based on <code><a href="simFrame.html#topic+eusilcP">eusilcP</a></code> from package
<span class="pkg">simFrame</span>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>eusilcA_smp
</code></pre>


<h3>Format</h3>

<p>A data frame with 1000 observations and 18 variables:
</p>

<dl>
<dt>eqIncome</dt><dd><p>numeric; a simplified version of the equivalized household
income.</p>
</dd>
<dt>eqsize</dt><dd><p>numeric; the equivalized household size according to the
modified OECD scale.</p>
</dd>
<dt>gender</dt><dd><p>factor; the person's gender (levels: male and female).</p>
</dd>
<dt>cash</dt><dd><p>numeric; employee cash or near cash income (net).</p>
</dd>
<dt>self_empl</dt><dd><p>numeric; cash benefits or losses from self-employment
(net).</p>
</dd>
<dt>unempl_ben</dt><dd><p>numeric; unemployment benefits (net).</p>
</dd>
<dt>age_ben</dt><dd><p>numeric; old-age benefits (net).</p>
</dd>
<dt>surv_ben</dt><dd><p>numeric; survivor's benefits (net).</p>
</dd>
<dt>sick_ben</dt><dd><p>numeric; sickness benefits (net).</p>
</dd>
<dt>dis_ben</dt><dd><p>numeric; disability benefits (net).</p>
</dd>
<dt>rent</dt><dd><p>numeric; income from rental of a property or land (net).</p>
</dd>
<dt>fam_allow</dt><dd><p>numeric; family/children related allowances (net).</p>
</dd>
<dt>house_allow</dt><dd><p>numeric; housing allowances (net).</p>
</dd>
<dt>cap_inv</dt><dd><p>numeric; interest, dividends, profit from capital investments
in unincorporated business (net).</p>
</dd>
<dt>tax_adj</dt><dd><p>numeric; repayments/receipts for tax adjustment (net).</p>
</dd>
<dt>state</dt><dd><p>factor; state (nine levels).</p>
</dd>
<dt>district</dt><dd><p>factor; districts (94 levels).</p>
</dd>
<dt>weight</dt><dd><p>numeric; constant weight.</p>
</dd>
</dl>


<hr>
<h2 id='eusilcA_smpAgg'>Simulated eusilc data - aggregated sample data</h2><span id='topic+eusilcA_smpAgg'></span>

<h3>Description</h3>

<p>The data set is a simple random sample of data set <code><a href="#topic+eusilcA_pop">eusilcA_pop</a></code>
which is based on <code><a href="simFrame.html#topic+eusilcP">eusilcP</a></code> from package
<span class="pkg">simFrame</span>. The data set is aggregated on the district level and contains
different variables that are related to income and a regional variable for
the districts.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>eusilcA_smpAgg
</code></pre>


<h3>Format</h3>

<p>A data frame with 94 observations and 8 variables:
</p>

<dl>
<dt>Mean</dt><dd><p>numeric; mean of a simplified version of the equivalized
household income.</p>
</dd>
<dt>MTMED</dt><dd><p>numeric; share of households who earn more than the national
median income.</p>
</dd>
<dt>Cash</dt><dd><p>numeric; mean of employee cash or near cash income.</p>
</dd>
<dt>Var_Mean</dt><dd><p>numeric; variance of a simplified version of the equivalized
household income.</p>
</dd>
<dt>Var_MTMED</dt><dd><p>numeric; variance of the share of households who earn more
than the national median income.</p>
</dd>
<dt>Var_Cash</dt><dd><p>numeric; variance of the employee cash or near cash income.</p>
</dd>
<dt>n</dt><dd><p>numeric; effective sample sizes.</p>
</dd>
<dt>Domain</dt><dd><p>factor; Austrian districts (94 levels).</p>
</dd>
</dl>


<hr>
<h2 id='fh'>Standard and Extended Fay-Herriot Models for Disaggregated Indicators</h2><span id='topic+fh'></span>

<h3>Description</h3>

<p>Function <code>fh</code> estimates indicators using the Fay-Herriot approach by
<cite>Fay and Herriot (1979)</cite>. Empirical best linear unbiased predictors
(EBLUPs) and mean squared error (MSE) estimates are provided. Additionally,
different extensions of the standard Fay-Herriot model are available: <br />
Adjusted estimation methods for the variance of the random effects (see
<cite>Li and Lahiri (2010)</cite> and <cite>Yoshimori and Lahiri (2014)</cite>) are
offered. Log and arcsin transformation for the dependent variable and two
types of backtransformation can be chosen - a crude version and the one
introduced by <cite>Slud and Maiti (2006)</cite> for log transformed  variables
and a naive and bias-corrected version following <cite>Hadam et al. (2020)</cite>
for arcsin transformed variables. A spatial extension to the Fay-Herriot
model following <cite>Petrucci and Salvati (2006)</cite> is also included. In
addition, it is possible to estimate a robust version of the standard and of
the spatial model (see <cite>Warnholz (2016)</cite>). Finally, a Fay-Herriot model
can be estimated when the auxiliary information is measured with error
following <cite>Ybarra and Lohr (2008)</cite>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fh(
  fixed,
  vardir,
  combined_data,
  domains = NULL,
  method = "reml",
  interval = NULL,
  k = 1.345,
  mult_constant = 1,
  transformation = "no",
  backtransformation = NULL,
  eff_smpsize = NULL,
  correlation = "no",
  corMatrix = NULL,
  Ci = NULL,
  tol = 1e-04,
  maxit = 100,
  MSE = FALSE,
  mse_type = "analytical",
  B = c(50, 0),
  seed = 123
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fh_+3A_fixed">fixed</code></td>
<td>
<p>a two-sided linear formula object describing the
fixed-effects part of the linear mixed regression model with the
dependent variable on the left of a ~ operator and the explanatory
variables on the right, separated by + operators.</p>
</td></tr>
<tr><td><code id="fh_+3A_vardir">vardir</code></td>
<td>
<p>a character string indicating the name of the variable
containing the domain-specific sampling variances of the direct estimates
that are included in <br /> <code>combined_data</code>.</p>
</td></tr>
<tr><td><code id="fh_+3A_combined_data">combined_data</code></td>
<td>
<p>a data set containing all the input variables that are
needed for the estimation of the Fay-Herriot model: the direct estimates,
the sampling variances, the explanatory variables and the domains. In
addition, the effective sample size needs to be included, if the arcsin
transformation is chosen.</p>
</td></tr>
<tr><td><code id="fh_+3A_domains">domains</code></td>
<td>
<p>a character string indicating the domain variable that is
included in <code>combined_data</code>. If <code>NULL</code>, the domains are numbered
consecutively.</p>
</td></tr>
<tr><td><code id="fh_+3A_method">method</code></td>
<td>
<p>a character string describing the method for the estimation of
the variance of the random effects. Methods that can be chosen
(i) restricted maximum likelihood (REML) method (&quot;<code>reml</code>&quot;),
(ii) maximum likelihood method (&quot;<code>ml</code>&quot;),
(iii) adjusted REML following <cite>Li and Lahiri (2010)</cite> (&quot;<code>amrl</code>&quot;),
(iv) adjusted ML following <cite>Li and Lahiri (2010)</cite> (&quot;<code>ampl</code>&quot;),
(v) adjusted REML following <cite>Yoshimori and Lahiri (2014)</cite>
(&quot;<code>amrl_yl</code>&quot;), (vi) adjusted ML following
<cite>Yoshimori and Lahiri (2014)</cite> (&quot;<code>ampl_yl</code>&quot;), (vii) robustified
maximum likelihood with robust EBLUP prediction following
<cite>Warnholz (2017)</cite> (&quot;<code>reblup</code>&quot;), (viii) robustified maximum
likelihood with robust and bias-corrected EBLUP prediction following
<cite>Warnholz (2017)</cite> (&quot;<code>reblupbc</code>&quot;), (ix) estimation of the
measurement error model of <cite>Ybarra and Lohr (2008)</cite> (&quot;<code>me</code>&quot;).
Defaults to &quot;<code>reml</code>&quot;.</p>
</td></tr>
<tr><td><code id="fh_+3A_interval">interval</code></td>
<td>
<p>optional argument, if method &quot;<code>reml</code>&quot; and
&quot;<code>ml</code>&quot; in combination with <code>correlation</code> equals &quot;<code>no</code>&quot;
is chosen or for the adjusted variance estimation methods &quot;<code>amrl</code>&quot;,
&quot;<code>amrl_yl</code>&quot;, &quot;<code>ampl</code>&quot; and &quot;<code>ampl_yl</code>&quot;. Is internally
set to <code>c(0, var(direct estimates))</code>. If a transformation is
applied, the interval is internally set to
<code>c(0, var(transformed(direct estimates)))</code>. If desired, <code>interval</code>
can be specified to a numeric vector containing a lower and upper limit for
the estimation of the variance of the random effects. Defaults to
<code>NULL</code>.</p>
</td></tr>
<tr><td><code id="fh_+3A_k">k</code></td>
<td>
<p>numeric tuning constant. Required argument when the robust version
of the standard or spatial Fay-Herriot model is chosen. Defaults to
<code>1.345</code>. For detailed information, please refer to
<cite>Warnholz (2016)</cite>.</p>
</td></tr>
<tr><td><code id="fh_+3A_mult_constant">mult_constant</code></td>
<td>
<p>numeric multiplier constant used in the bias corrected
version of the robust estimation methods. Required argument when the robust
version of the standard or spatial Fay-Herriot model is chosen. Default is to
make no correction for realizations of direct estimator within
<code>mult_constant = 1</code> times the standard deviation of direct estimator.
For detailed information, please refer to <cite>Warnholz (2016)</cite>.</p>
</td></tr>
<tr><td><code id="fh_+3A_transformation">transformation</code></td>
<td>
<p>a character that determines the type of transformation
of the dependent variable and of the sampling variances. Methods that can be
chosen (i) no transformation (&quot;<code>no</code>&quot;), (ii) log transformation
(&quot;<code>log</code>&quot;) of the dependent variable and of the sampling variances,
(iii) arcsin transformation (&quot;<code>arcsin</code>&quot;) of the dependent variable and
of the sampling variances following. Defaults to &quot;<code>no</code>&quot;. For more
information, how the direct estimate and its variance are transformed, please
see the package vignette &quot;A Framework for Producing Small Area Estimates
Based on Area-Level Models in R&quot;.</p>
</td></tr>
<tr><td><code id="fh_+3A_backtransformation">backtransformation</code></td>
<td>
<p>a character that determines the type of
backtransformation of the EBLUPs and MSE estimates. Required argument when a
transformation is chosen. Available methods are (i) crude bias-correction
following <cite>Rao (2015)</cite> when the log transformation is chosen
(&quot;<code>bc_crude</code>&quot;), (ii) bias-correction following
<cite>Slud and Maiti (2006)</cite> when the log transformations is chosen
(&quot;<code>bc_sm</code>&quot;), (iii) naive back transformation when the arcsin
transformation is chosen (&quot;<code>naive</code>&quot;), (iii) bias-corrected back
transformation following <cite>Hadam et al. (2020)</cite> when the arcsin
transformation is chosen (&quot;<code>bc</code>&quot;). Defaults to <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="fh_+3A_eff_smpsize">eff_smpsize</code></td>
<td>
<p>a character string indicating the name of the variable
containing the effective sample sizes that are included in
<code>combined_data</code>. Required argument when the arcsin transformation is
chosen. Defaults to <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="fh_+3A_correlation">correlation</code></td>
<td>
<p>a character determining the correlation structure of the
random effects. Possible correlations are
(i) no correlation (&quot;<code>no</code>&quot;),
(ii) incorporation of a spatial correlation in the random effects
(&quot;<code>spatial</code>&quot;). Defaults to &quot;<code>no</code>&quot;.</p>
</td></tr>
<tr><td><code id="fh_+3A_cormatrix">corMatrix</code></td>
<td>
<p>matrix or data frame with dimensions number of areas times
number of areas containing the row-standardized proximities between the
domains. Values must lie between <code>0</code> and <code>1</code>. The columns and rows
must be sorted like the domains in <code>fixed</code>. For an example how to
create the proximity matrix, please refer to the vignette. Required argument
when the correlation is set to &quot;<code>spatial</code>&quot;. Defaults to <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="fh_+3A_ci">Ci</code></td>
<td>
<p>array with dimension number of estimated regression coefficients
times number of estimated regression coefficients times number of areas
containing the variance-covariance matrix of the explanatory variables for
each area. For an example of how to create the array, please refer to the
vignette. Required argument within the Ybarra-Lohr model
(<code>method = me</code>). Defaults to <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="fh_+3A_tol">tol</code></td>
<td>
<p>a number determining the tolerance value for the estimation of the
variance of the random effects. Required argument when method &quot;<code>reml</code>&quot;
and &quot;<code>ml</code>&quot; in combination with <code>correlation =</code>&quot;<code>spatial</code>&quot; are
chosen or for the variance estimation methods &quot;<code>reblup</code>&quot;,
&quot;<code>reblupbc</code>&quot; and &quot;<code>me</code>&quot;. Defaults to 0.0001.</p>
</td></tr>
<tr><td><code id="fh_+3A_maxit">maxit</code></td>
<td>
<p>a number determining the maximum number of iterations for the
estimation of the variance of the random effects. Required argument when
method &quot;<code>reml</code>&quot; and  &quot;<code>ml</code>&quot; in combination with <code>correlation</code>
equals &quot;<code>spatial</code>&quot; is chosen or for the variance estimation methods
&quot;<code>reblup</code>&quot;, &quot;<code>reblupbc</code>&quot; and &quot;<code>me</code>&quot;. Defaults to 100.</p>
</td></tr>
<tr><td><code id="fh_+3A_mse">MSE</code></td>
<td>
<p>if <code>TRUE</code>, MSE estimates are calculated. Defaults
to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="fh_+3A_mse_type">mse_type</code></td>
<td>
<p>a character string determining the estimation method of the
MSE. Methods that can be chosen
(i) analytical MSE depending on the estimation method of the variance of the
random effect (&quot;<code>analytical</code>&quot;),
(ii) a jackknife MSE (&quot;<code>jackknife</code>&quot;),
(iii) a weighted jackknife MSE (&quot;<code>weighted_jackknife</code>&quot;),
(iv) bootstrap (&quot;<code>boot</code>&quot;),
(v)  approximation of the MSE based on a pseudo linearisation
(&quot;<code>pseudo</code>&quot;),
(vi) naive parametric bootstrap for the spatial Fay-Herriot model
(&quot;<code>spatialparboot</code>&quot;),
(vii) bias corrected parametric bootstrap for the spatial Fay-Herriot model
(&quot;<code>spatialparbootbc</code>&quot;),
(viii) naive nonparametric bootstrap for the spatial Fay-Herriot model
(&quot;<code>spatialnonparboot</code>&quot;),
(ix) bias corrected nonparametric bootstrap for the spatial Fay-Herriot model
(&quot;<code>spatialnonparbootbc</code>&quot;).
Options (ii)-(iv) are of interest when the arcsin transformation is selected.
Option (ii) must be chosen when an Ybarra-Lohr model is selected
(<code>method = me</code>). Options (iv) and (v) are the MSE options for the
robust extensions of the Fay-Herriot model. For an extensive overview of the
possible MSE options, please refer to the vignette. Required argument when
<code>MSE = TRUE</code>. Defaults to &quot;<code>analytical</code>&quot;.</p>
</td></tr>
<tr><td><code id="fh_+3A_b">B</code></td>
<td>
<p>either a single number or a numeric vector with two elements. The
single number or the first element defines the number of bootstrap iterations
when a bootstrap MSE estimator is chosen. When the standard FH
model is applied and the information criteria by Marhuenda et al. (2014)
should be computed, the second element of <code>B</code> is needed and must be
greater than 1. Defaults to c(50,0). For practical applications, values
larger than 200 are recommended.</p>
</td></tr>
<tr><td><code id="fh_+3A_seed">seed</code></td>
<td>
<p>an integer to set the seed for the random number generator. For
the usage of random number generation see details. If seed is set to
<code>NULL</code>, seed is chosen randomly. Defaults to <code>123</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In the bootstrap approaches, random number generation is used. Thus,
a seed is set by the argument <code>seed</code>. <br /> <br />
Out-of-sample EBLUPs are available for all area-level models except for the
<code>bc_sm</code> backtransformation and for the robust models. <br />
Out-of-sample MSEs are available for the analytical MSE estimator of the
standard Fay-Herriot model with reml and ml variance estimation, the crude
backtransformation in case of log transformation and the bootstrap MSE
estimator for the arcsin transformation. <br /> <br />
For a description of how to create the proximity matrix for the
spatial Fay-Herriot model, see the package vignette. If the presence
of out-of-sample domains, the proximity matrix needs to be
subsetted to the in-sample domains.
</p>


<h3>Value</h3>

<p>An object of class &quot;fh&quot;, &quot;emdi&quot; that provides estimators
for regional disaggregated indicators like means and ratios and optionally
corresponding MSE estimates. Several generic functions have methods for the
returned object. For a full list and descriptions of the components of
objects of class &quot;emdi&quot;, see <code><a href="#topic+emdiObject">emdiObject</a></code>.
</p>


<h3>References</h3>

<p>Chen S., Lahiri P. (2002), A weighted jackknife MSPE estimator in small-area
estimation, &quot;Proceeding of the Section on Survey Research Methods&quot;, American
Statistical Association, 473 - 477. <br /> <br />
Datta, G. S. and Lahiri, P. (2000), A unified measure of uncertainty of
Statistica Sinica 10(2), 613-627. <br /> <br />
Fay, R. E. and Herriot, R. A. (1979), Estimates of income for small places:
An application of James-Stein procedures to census data, Journal of the
American Statistical Association 74(366), 269-277. <br /> <br />
González-Manteiga, W., Lombardía, M. J., Molina, I., Morales, D. and
Santamaría, L. (2008) Analytic and bootstrap approximations of prediction
errors under a multivariate Fay-Herriot model. Computational Statistics &amp;
Data Analysis, 52, 5242–5252. <br /> <br />
Hadam, S., Wuerz, N. and Kreutzmann, A.-K. (2020), Estimating
regional unemployment with mobile network data for Functional Urban Areas in
Germany, Refubium - Freie Universitaet Berlin Repository, 1-28. <br /> <br />
Jiang, J., Lahiri, P., Wan, S.-M. and Wu, C.-H. (2001), Jackknifing in the
Fay–Herriot model with an example. In Proc. Sem. Funding Opportunity in
Survey Research, Washington DC: Bureau of Labor Statistics, 75–97. <br /> <br />
Jiang, J., Lahiri, P.,Wan, S.-M. (2002), A unified jackknife theory for
empirical best prediction with M-estimation, Ann. Statist., 30,
1782-810. <br /> <br />
Li, H. and Lahiri, P. (2010), An adjusted maximum likelihood method for
solving small area estimation problems, Journal of Multivariate Analyis 101,
882-902. <br /> <br />
Marhuenda, Y., Morales, D. and Pardo, M.C. (2014). Information criteria for
Fay-Herriot model selection. Computational Statistics and Data Analysis 70,
268-280. <br /> <br />
Neves, A., Silva, D. and Correa, S. (2013), Small domain estimation for the
Brazilian service sector survey, ESTADISTICA 65(185), 13-37. <br /> <br />
Prasad, N. and Rao, J. (1990), The estimation of the mean squared error of
small-area estimation, Journal of the American Statistical
Association 85(409), 163-171. <br /> <br />
Petrucci, A., Salvati, N. (2006), Small Area Estimation for Spatial
Correlation in Watershed Erosion Assessment, Journal of Agricultural,
Biological and Environmental Statistics, 11(2), 169–182. <br /> <br />
Rao, J. N. K. (2003), Small Area Estimation, New York: Wiley. <br /> <br />
Rao, J. N. K. and Molina, I. (2015), Small area estimation,
New York: Wiley. <br /> <br />
Slud, E. and Maiti, T. (2006), Mean-squared error estimation in transformed
Fay-Herriot models, Journal of the Royal Statistical Society:Series B 68(2),
239-257.<br /> <br />
Warnholz, S. (2016), saeRobust: Robust small area estimation.
R package. <br /> <br />
Warnholz, S. (2016b). Small area estimation using robust extensions to area
level models. Ph.D. thesis, Freie Universitaet Berlin. <br /> <br />
Ybarra, L. and Lohr, S. (2008), Small area estimation when auxiliary
information is measured with error, Biometrika, 95(4), 919-931.<br /> <br />
Yoshimori, M. and Lahiri, P. (2014), A new adjusted maximum likelihood method
for the Fay-Herriot small area model, Journal of Multivariate Analysis 124,
281-294.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading data - population and sample data
data("eusilcA_popAgg")
data("eusilcA_smpAgg")

# Combine sample and population data
combined_data &lt;- combine_data(
  pop_data = eusilcA_popAgg,
  pop_domains = "Domain",
  smp_data = eusilcA_smpAgg,
  smp_domains = "Domain"
)

# Example 1: Standard Fay-Herriot model and analytical MSE
fh_std &lt;- fh(
  fixed = Mean ~ cash + self_empl, vardir = "Var_Mean",
  combined_data = combined_data, domains = "Domain", method = "ml",
  MSE = TRUE
)

# Example 2: arcsin transformation of the dependent variable
fh_arcsin &lt;- fh(
  fixed = MTMED ~ cash + age_ben + rent + house_allow,
  vardir = "Var_MTMED", combined_data = combined_data, domains = "Domain",
  method = "ml", transformation = "arcsin", backtransformation = "bc",
  eff_smpsize = "n", MSE = TRUE, mse_type = "boot", B = c(50, 0)
)

# Example 3: Spatial Fay-Herriot model
# Load proximity matrix
data("eusilcA_prox")
fh_spatial &lt;- fh(
  fixed = Mean ~ cash + self_empl, vardir = "Var_Mean",
  combined_data = combined_data, domains = "Domain", method = "reml",
  correlation = "spatial", corMatrix = eusilcA_prox, MSE = TRUE,
  mse_type = "analytical"
)

# Example 4: Robust Fay-Herriot model
fh_robust &lt;- fh(
  fixed = Mean ~ cash + self_empl, vardir = "Var_Mean",
  combined_data = combined_data, domains = "Domain", method = "reblupbc",
  k = 1.345, mult_constant = 1, MSE = TRUE, mse_type = "pseudo"
)

# Example 5: Ybarra-Lohr model
# Create MSE array
P &lt;- 1
M &lt;- length(eusilcA_smpAgg$Mean)
Ci_array &lt;- array(data = 0, dim = c(P + 1, P + 1, M))
for (i in 1:M) {
  Ci_array[2, 2, i] &lt;- eusilcA_smpAgg$Var_Cash[i]
}
fh_yl &lt;- fh(
  fixed = Mean ~ Cash, vardir = "Var_Mean",
  combined_data = eusilcA_smpAgg, domains = "Domain", method = "me",
  Ci = Ci_array, MSE = TRUE, mse_type = "jackknife"
)

</code></pre>

<hr>
<h2 id='fixef'>Extract Fixed Effects from an emdi Object</h2><span id='topic+fixef'></span><span id='topic+fixed.effects'></span><span id='topic+fixef.ebp'></span><span id='topic+fixed.effects.ebp'></span><span id='topic+fixef.fh'></span><span id='topic+fixed.effects.fh'></span>

<h3>Description</h3>

<p>Methods <code>fixef.ebp</code> and <code>fixef.fh</code> extract the
fixed effects from an emdi object of class &quot;ebp&quot; or &quot;fh&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ebp'
fixef(object, ...)

## S3 method for class 'ebp'
fixed.effects(object, ...)

## S3 method for class 'fh'
fixef(object, ...)

## S3 method for class 'fh'
fixed.effects(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fixef_+3A_object">object</code></td>
<td>
<p>an object of type &quot;emdi&quot;, depending on the used method either
&quot;ebp&quot; or &quot;fh&quot;.</p>
</td></tr>
<tr><td><code id="fixef_+3A_...">...</code></td>
<td>
<p>additional arguments that are not used in this method.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The alias <code>fixed.effects</code> can also be used instead of
<code>fixef</code>. The generic function <code>fixef</code> is imported from package
nlme and re-exported to make the S3-methods available, even though the nlme
package itself is not loaded or attached. For default documentation,
see <code><a href="nlme.html#topic+fixed.effects">fixed.effects</a></code>.
</p>


<h3>Value</h3>

<p>For classes &quot;ebp&quot; and &quot;fh&quot; a vector containing the fixed effects is
returned.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ebp">ebp</a></code>, <code><a href="#topic+fh">fh</a></code>,
<code><a href="nlme.html#topic+fixed.effects">fixed.effects</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Example for class ebp
emdi_model &lt;- ebp(
  fixed = eqIncome ~ gender + eqsize + cash + self_empl +
    unempl_ben + age_ben + surv_ben + sick_ben + dis_ben + rent + fam_allow +
    house_allow + cap_inv + tax_adj, pop_data = eusilcA_pop,
  pop_domains = "district", smp_data = eusilcA_smp, smp_domains = "district",
  na.rm = TRUE
)

fixef(emdi_model)

</code></pre>

<hr>
<h2 id='getData'>Extract emdi Object Data</h2><span id='topic+getData'></span><span id='topic+getData.direct'></span><span id='topic+getData.ebp'></span><span id='topic+getData.fh'></span>

<h3>Description</h3>

<p>Methods <code>getData.direct</code>, <code>getData.ebp</code> and <code>getData.fh</code>
extract the data frame used to fit the model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'direct'
getData(object, ...)

## S3 method for class 'ebp'
getData(object, ...)

## S3 method for class 'fh'
getData(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getData_+3A_object">object</code></td>
<td>
<p>an object of type &quot;emdi&quot;, depending on the method either
&quot;direct&quot;, &quot;ebp&quot; or &quot;fh&quot;.</p>
</td></tr>
<tr><td><code id="getData_+3A_...">...</code></td>
<td>
<p>additional arguments that are not used in this method.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The generic function <code>getData</code> is imported from package nlme
and re-exported to make the S3-methods available, even though the nlme
package itself is not loaded or attached. For default documentation,
see <code><a href="nlme.html#topic+getData">getData</a></code>.
</p>


<h3>Value</h3>

<p>Data frame used to fit the model. For classes &quot;direct&quot; and &quot;ebp&quot; the
(untransformed) sample data is returned. For class &quot;fh&quot; the combined data
set is returned.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+direct">direct</a></code>, <code><a href="#topic+ebp">ebp</a></code>,
<code><a href="#topic+fh">fh</a></code>, <code><a href="nlme.html#topic+getData">getData</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Example for class direct
emdi_direct &lt;- direct(
  y = "eqIncome", smp_data = eusilcA_smp,
  smp_domains = "district", weights = "weight", threshold = 11064.82,
  var = TRUE, boot_type = "naive", B = 50, seed = 123, X_calib = NULL,
  totals = NULL, na.rm = TRUE
)

getData(emdi_direct)

</code></pre>

<hr>
<h2 id='getGroups'>Extract Grouping Factors from an emdi Object</h2><span id='topic+getGroups'></span><span id='topic+getGroups.direct'></span><span id='topic+getGroups.ebp'></span><span id='topic+getGroups.fh'></span>

<h3>Description</h3>

<p>Methods <code>getGroups.direct</code>, <code>getGroups.ebp</code> and
<code>getGroups.fh</code> extract grouping factors from an emdi object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'direct'
getGroups(object, ...)

## S3 method for class 'ebp'
getGroups(object, ...)

## S3 method for class 'fh'
getGroups(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getGroups_+3A_object">object</code></td>
<td>
<p>an object of type &quot;emdi&quot;, depending on the method either
&quot;direct&quot;, &quot;ebp&quot; or &quot;fh&quot;.</p>
</td></tr>
<tr><td><code id="getGroups_+3A_...">...</code></td>
<td>
<p>additional arguments that are not used in this method.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The generic function <code>getGroups</code> is imported from package nlme
and re-exported to make the S3-methods available, even though the nlme
package itself is not loaded or attached. For default documentation,
see <code><a href="nlme.html#topic+getGroups">getGroups</a></code>.
</p>


<h3>Value</h3>

<p>A vector containing the grouping factors.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+direct">direct</a></code>, <code><a href="#topic+ebp">ebp</a></code>,
<code><a href="#topic+fh">fh</a></code>, <code><a href="nlme.html#topic+getGroups">getGroups</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Example for class direct
emdi_direct &lt;- direct(
  y = "eqIncome", smp_data = eusilcA_smp,
  smp_domains = "district", weights = "weight", threshold = 11064.82,
  var = TRUE, boot_type = "naive", B = 50, seed = 123, X_calib = NULL,
  totals = NULL, na.rm = TRUE
)

getGroups(emdi_direct)

</code></pre>

<hr>
<h2 id='getGroupsFormula'>Extract Grouping Formula from an emdi Object</h2><span id='topic+getGroupsFormula'></span><span id='topic+getGroupsFormula.direct'></span><span id='topic+getGroupsFormula.ebp'></span><span id='topic+getGroupsFormula.fh'></span>

<h3>Description</h3>

<p>Methods <code>getGroupsFormula.direct</code>, <code>getGroupsFormula.ebp</code> and
<code>getGroupsFormula.fh</code> extract the grouping formula from an
emdi object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'direct'
getGroupsFormula(object, ...)

## S3 method for class 'ebp'
getGroupsFormula(object, ...)

## S3 method for class 'fh'
getGroupsFormula(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getGroupsFormula_+3A_object">object</code></td>
<td>
<p>an object of type &quot;emdi&quot;, depending on the method either
&quot;direct&quot;, &quot;ebp&quot; or &quot;fh&quot;.</p>
</td></tr>
<tr><td><code id="getGroupsFormula_+3A_...">...</code></td>
<td>
<p>additional arguments that are not used in this method.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The generic function <code>getGroupsFormula</code> is imported from
package nlme and re-exported to make the S3-methods available, even though
the nlme package itself is not loaded or attached. For default documentation,
see <code><a href="nlme.html#topic+getGroupsFormula">getGroupsFormula</a></code>.
</p>


<h3>Value</h3>

<p>A one-sided formula.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+direct">direct</a></code>, <code><a href="#topic+ebp">ebp</a></code>,
<code><a href="#topic+fh">fh</a></code>, <code><a href="nlme.html#topic+getGroupsFormula">getGroupsFormula</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Example for class ebp
emdi_model &lt;- ebp(
  fixed = eqIncome ~ gender + eqsize + cash + self_empl +
    unempl_ben + age_ben + surv_ben + sick_ben + dis_ben + rent + fam_allow +
    house_allow + cap_inv + tax_adj, pop_data = eusilcA_pop,
  pop_domains = "district", smp_data = eusilcA_smp, smp_domains = "district",
  na.rm = TRUE
)

getGroupsFormula(emdi_model)

</code></pre>

<hr>
<h2 id='getResponse'>Extract Response Variable from an emdi Object</h2><span id='topic+getResponse'></span><span id='topic+getResponse.direct'></span><span id='topic+getResponse.ebp'></span><span id='topic+getResponse.fh'></span>

<h3>Description</h3>

<p>Methods <code>getResponse.direct</code>, <code>getResponse.ebp</code> and
<code>getResponse.fh</code> extract the response variable from an emdi object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'direct'
getResponse(object, ...)

## S3 method for class 'ebp'
getResponse(object, ...)

## S3 method for class 'fh'
getResponse(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getResponse_+3A_object">object</code></td>
<td>
<p>an object of type &quot;emdi&quot;, depending on the method either
&quot;direct&quot;, &quot;ebp&quot; or &quot;fh&quot;.</p>
</td></tr>
<tr><td><code id="getResponse_+3A_...">...</code></td>
<td>
<p>additional arguments that are not used in this method.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The generic function <code>getResponse</code> is imported from package
nlme and re-exported to make the S3-methods available, even though the nlme
package itself is not loaded or attached. For default documentation,
see <code><a href="nlme.html#topic+getResponse">getResponse</a></code>.
</p>


<h3>Value</h3>

<p>Vector containing the response variable.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+direct">direct</a></code>, <code><a href="#topic+ebp">ebp</a></code>, <code><a href="#topic+fh">fh</a></code>,
<code><a href="nlme.html#topic+getResponse">getResponse</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Example for class ebp
emdi_model &lt;- ebp(
  fixed = eqIncome ~ gender + eqsize + cash + self_empl +
    unempl_ben + age_ben + surv_ben + sick_ben + dis_ben + rent + fam_allow +
    house_allow + cap_inv + tax_adj, pop_data = eusilcA_pop,
  pop_domains = "district", smp_data = eusilcA_smp, smp_domains = "district",
  na.rm = TRUE
)

getResponse(emdi_model)

</code></pre>

<hr>
<h2 id='getVarCov'>Extract Variance-covariance Matrix from an emdi Object</h2><span id='topic+getVarCov'></span><span id='topic+getVarCov.ebp'></span><span id='topic+getVarCov.fh'></span>

<h3>Description</h3>

<p>Methods <code>getVarCov.ebp</code> and <code>getVarCov.fh</code> extract the
variance-covariance matrix from a fitted model of class &quot;ebp&quot; or &quot;fh&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ebp'
getVarCov(obj, individuals = 1, type = "random.effects", ...)

## S3 method for class 'fh'
getVarCov(obj, individuals = 1, type = "random.effects", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getVarCov_+3A_obj">obj</code></td>
<td>
<p>an object of type &quot;emdi&quot;, either &quot;ebp&quot; or &quot;fh&quot;.</p>
</td></tr>
<tr><td><code id="getVarCov_+3A_individuals">individuals</code></td>
<td>
<p>vector of levels of the in-sample domains can be
specified for the types &quot;<code>conditional</code>&quot; or &quot;<code>marginal</code>&quot;.</p>
</td></tr>
<tr><td><code id="getVarCov_+3A_type">type</code></td>
<td>
<p>a character that determines the type of variance-covariance
matrix. Types that can be chosen
(i) random-effects variance-covariance matrix (&quot;<code>random.effects</code>&quot;),
(ii) conditional variance-covariance matrix (&quot;<code>conditional</code>&quot;),
(iii) marginal variance-covariance matrix (&quot;<code>marginal</code>&quot;). Defaults to
&quot;<code>random.effects</code>&quot;.</p>
</td></tr>
<tr><td><code id="getVarCov_+3A_...">...</code></td>
<td>
<p>additional arguments that are not used in this method.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The generic function <code>getVarCov</code> is imported from package nlme
and re-exported to make the S3-methods available, even though the nlme
package itself is not loaded or attached. For default documentation,
see <code><a href="nlme.html#topic+getVarCov">getVarCov</a></code>.
</p>


<h3>Value</h3>

<p>A variance-covariance matrix or a list of variance-covariance
matrices, if more than one individual is selected. For method
<code>getVarCov.ebp</code>, the dimensions of the matrices are 1 x 1 for type
&quot;<code>random.effects</code>&quot; and number of in-sample domains x number of
in-sample domains for types &quot;<code>conditional</code>&quot; and &quot;<code>marginal</code>&quot;. For
method <code>getVarCov.fh</code>, for all types the dimensions of the matrices are
1 x 1. For type &quot;<code>marginal</code>&quot; the diagonal elements of the variance
covariances matrices are returned for the chosen individual. Please note, if
the correlation argument of the &quot;fh&quot; object is set to spatial, the variance
covariance matrix has non-zero off-diagonal elements, because the assumption
of independence of the error terms does not hold. For the non-spatial models,
the off-diagonal elements are zero.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ebp">ebp</a></code>, <code><a href="#topic+fh">fh</a></code>, <code><a href="nlme.html#topic+getVarCov">getVarCov</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Example for class fh
combined_data &lt;- combine_data(
  pop_data = eusilcA_popAgg,
  pop_domains = "Domain",
  smp_data = eusilcA_smpAgg,
  smp_domains = "Domain"
)

fh_std &lt;- fh(
  fixed = Mean ~ cash + self_empl, vardir = "Var_Mean",
  combined_data = combined_data, domains = "Domain",
  method = "ml", MSE = TRUE
)

getVarCov(fh_std)

</code></pre>

<hr>
<h2 id='intervals'>Confidence Intervals on Coefficients of an emdi Object</h2><span id='topic+intervals'></span><span id='topic+intervals.ebp'></span><span id='topic+intervals.fh'></span>

<h3>Description</h3>

<p>Methods <code>intervals.ebp</code> and <code>intervals.fh</code> provide the approximate
confidence intervals on the coefficients (fixed effects) of an emdi object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ebp'
intervals(object, level = 0.95, parm = NULL, ...)

## S3 method for class 'fh'
intervals(object, level = 0.95, parm = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="intervals_+3A_object">object</code></td>
<td>
<p>an object of type &quot;emdi&quot;, depending on the method either &quot;ebp&quot;
or &quot;fh&quot;.</p>
</td></tr>
<tr><td><code id="intervals_+3A_level">level</code></td>
<td>
<p>an optional numeric value with the confidence level for the
intervals. Defaults to 0.95.</p>
</td></tr>
<tr><td><code id="intervals_+3A_parm">parm</code></td>
<td>
<p>vector of names to specify which parameters are to be given
confidence intervals. If <code>NULL</code>, all parameters are taken into account.
Defaults to <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="intervals_+3A_...">...</code></td>
<td>
<p>additional arguments that are not used in this method.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The generic function <code>intervals</code> is imported from package nlme
and re-exported to make the S3-methods available, even though the nlme
package itself is not loaded or attached. For default documentation,
see <code><a href="nlme.html#topic+intervals">intervals</a></code>.
</p>


<h3>Value</h3>

<p>A matrix with rows corresponding to the parameters and columns
containing the lower confidence limits (lower), the
estimated values (est.), and upper confidence limits (upper).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+direct">direct</a></code>, <code><a href="#topic+ebp">ebp</a></code>, <code><a href="#topic+fh">fh</a></code>,
<code><a href="nlme.html#topic+intervals">intervals</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Example for class ebp
emdi_model &lt;- ebp(
  fixed = eqIncome ~ gender + eqsize + cash + self_empl +
    unempl_ben + age_ben + surv_ben + sick_ben + dis_ben + rent + fam_allow +
    house_allow + cap_inv + tax_adj, pop_data = eusilcA_pop,
  pop_domains = "district", smp_data = eusilcA_smp, smp_domains = "district",
  na.rm = TRUE
)

intervals(emdi_model)

</code></pre>

<hr>
<h2 id='load_shapeaustria'>Loading the Shape File for Austrian Districts</h2><span id='topic+load_shapeaustria'></span>

<h3>Description</h3>

<p>The function simplifies to load the shape file for Austrian districts.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>load_shapeaustria()
</code></pre>


<h3>Details</h3>

<p>The shape file contains the borders of Austrian districts. Thus, it
can be used for the visualization of estimation results for Austrian
districts.
</p>


<h3>Value</h3>

<p>A shape file of class <code>"sf", "data.frame"</code>.
</p>

<hr>
<h2 id='map_plot'>Visualizes regional disaggregated estimates on a map</h2><span id='topic+map_plot'></span>

<h3>Description</h3>

<p>Function <code>map_plot</code> creates spatial visualizations of the estimates
obtained by small area estimation methods.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>map_plot(
  object,
  indicator = "all",
  MSE = FALSE,
  CV = FALSE,
  map_obj = NULL,
  map_dom_id = NULL,
  map_tab = NULL,
  color = c("white", "red4"),
  scale_points = NULL,
  guide = "colourbar",
  return_data = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="map_plot_+3A_object">object</code></td>
<td>
<p>an object of type emdi, containing the estimates to be
visualized.</p>
</td></tr>
<tr><td><code id="map_plot_+3A_indicator">indicator</code></td>
<td>
<p>optional character vector that selects which indicators
shall be returned: (i) all calculated indicators (&quot;all&quot;);
(ii) each indicator name: &quot;Mean&quot;, &quot;Quantile_10&quot;, &quot;Quantile_25&quot;, &quot;Median&quot;,
&quot;Quantile_75&quot;, &quot;Quantile_90&quot;, &quot;Head_Count&quot;, &quot;Poverty_Gap&quot;, &quot;Gini&quot;,
&quot;Quintile_Share&quot; or the function name/s of &quot;custom_indicator/s&quot;;
(iii) groups of indicators: &quot;Quantiles&quot;, &quot;Poverty&quot; or
&quot;Inequality&quot;. Note, additional custom indicators can be
defined as argument for model-based approaches (see also <code><a href="#topic+ebp">ebp</a></code>)
and do not appear in groups of indicators even though these might belong to
one of the groups. If the <code>model</code> argument is of type &quot;fh&quot;,
indicator can be set to &quot;all&quot;, &quot;Direct&quot;, FH&quot;, or &quot;FH_Bench&quot; (if emdi
object is overwritten by function benchmark). Defaults to &quot;all&quot;.</p>
</td></tr>
<tr><td><code id="map_plot_+3A_mse">MSE</code></td>
<td>
<p>optional logical. If <code>TRUE</code>, the MSE is also visualized.
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="map_plot_+3A_cv">CV</code></td>
<td>
<p>optional logical. If <code>TRUE</code>, the CV is also visualized.
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="map_plot_+3A_map_obj">map_obj</code></td>
<td>
<p>an <code>"sf", "data.frame"</code> object as defined by the
<span class="pkg">sf</span> package on which the data should be visualized.</p>
</td></tr>
<tr><td><code id="map_plot_+3A_map_dom_id">map_dom_id</code></td>
<td>
<p>a character string containing the name of a variable in
<code>map_obj</code> that indicates the domains.</p>
</td></tr>
<tr><td><code id="map_plot_+3A_map_tab">map_tab</code></td>
<td>
<p>a <code>data.frame</code> object with two columns that match the
domain variable from the census data set (first column) with the domain
variable in the map_obj (second column). This should only be used if the IDs
in both objects differ.</p>
</td></tr>
<tr><td><code id="map_plot_+3A_color">color</code></td>
<td>
<p>a <code>vector</code> of length 2 defining the lowest and highest
color in the plots.</p>
</td></tr>
<tr><td><code id="map_plot_+3A_scale_points">scale_points</code></td>
<td>
<p>a structure defining the lowest and the highest
value of the colorscale. If a numeric vector of length two is given, this
scale will be used for every plot.</p>
</td></tr>
<tr><td><code id="map_plot_+3A_guide">guide</code></td>
<td>
<p>character passed to
<code>scale_colour_gradient</code> from <span class="pkg">ggplot2</span>.
Possible values are &quot;none&quot;, &quot;colourbar&quot;, and &quot;legend&quot;.</p>
</td></tr>
<tr><td><code id="map_plot_+3A_return_data">return_data</code></td>
<td>
<p>if set to <code>TRUE</code>, a fortified data frame including
the map data as well as the chosen indicators is returned. Customized maps
can easily be obtained from this data frame via the package <span class="pkg">ggplot2</span>.
Defaults to <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Creates the plots demanded, and, if selected, a fortified data.frame
containing the mapdata and chosen indicators.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+direct">direct</a></code>, <code><a href="#topic+ebp">ebp</a></code>, <code><a href="#topic+fh">fh</a></code>,
<code><a href="#topic+emdiObject">emdiObject</a></code>, <code><a href="sf.html#topic+sf">sf</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data("eusilcA_pop")
data("eusilcA_smp")

# Generate emdi object with additional indicators; here via function ebp()
emdi_model &lt;- ebp(
  fixed = eqIncome ~ gender + eqsize + cash +
    self_empl + unempl_ben + age_ben + surv_ben + sick_ben +
    dis_ben + rent + fam_allow + house_allow + cap_inv +
    tax_adj, pop_data = eusilcA_pop,
  pop_domains = "district", smp_data = eusilcA_smp,
  smp_domains = "district", threshold = 11064.82,
  transformation = "box.cox", L = 50, MSE = TRUE, B = 50
)

# Load shape file
load_shapeaustria()

# Create map plot for mean indicator - point and MSE estimates but no CV
map_plot(
  object = emdi_model, MSE = TRUE, CV = FALSE,
  map_obj = shape_austria_dis, indicator = c("Mean"),
  map_dom_id = "PB"
)

# Create a suitable mapping table to use numerical identifiers of the shape
# file

# First find the right order
dom_ord &lt;- match(shape_austria_dis$PB, emdi_model$ind$Domain)

#Create the mapping table based on the order obtained above
map_tab &lt;- data.frame(pop_data_id = emdi_model$ind$Domain[dom_ord],
                      shape_id = shape_austria_dis$BKZ)

# Create map plot for mean indicator - point and CV estimates but no MSE
# using the numerical domain identifiers of the shape file

map_plot(
  object = emdi_model, MSE = FALSE, CV = TRUE,
  map_obj = shape_austria_dis, indicator = c("Mean"),
  map_dom_id = "BKZ", map_tab = map_tab
)

</code></pre>

<hr>
<h2 id='plot.emdi'>Plots for an emdi Object</h2><span id='topic+plot.emdi'></span><span id='topic+plot.ebp'></span><span id='topic+plot.direct'></span><span id='topic+plot.fh'></span>

<h3>Description</h3>

<p>Diagnostic plots of the underlying model in the EBP (see also
<code><a href="#topic+ebp">ebp</a></code>) or Fay-Herriot (see also <code><a href="#topic+fh">fh</a></code>) approaches are
obtained. These include Q-Q plots and density plots of residuals and random
effects from the nested error linear regression model/
the Fay-Herriot model, a Cook's distance plot for detecting outliers and the
log-likelihood of the estimation of the optimal parameter in Box-Cox
transformations (the latter two only for ebp). The return depends on the
transformation such that a plot for the optimal parameter is
only returned in case a transformation with transformation parameter is
chosen. The range of the x-axis is optional but necessary to change if there
are convergence problems. All plots are obtained by
<code><a href="ggplot2.html#topic+ggplot">ggplot</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'emdi'
plot(
  x,
  label = "orig",
  color = c("blue", "lightblue3"),
  gg_theme = NULL,
  cooks = TRUE,
  range = NULL,
  ...
)

## S3 method for class 'ebp'
plot(
  x,
  label = "orig",
  color = c("blue", "lightblue3"),
  gg_theme = NULL,
  cooks = TRUE,
  range = NULL,
  ...
)

## S3 method for class 'direct'
plot(x, ...)

## S3 method for class 'fh'
plot(
  x,
  label = "orig",
  color = c("blue", "lightblue3"),
  gg_theme = NULL,
  cooks = TRUE,
  range = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.emdi_+3A_x">x</code></td>
<td>
<p>an object of type &quot;emdi&quot;, either &quot;ebp&quot; or &quot;fh&quot;, representing point
and, if chosen, MSE estimates obtained by the EBP or Fay-Herriot approach
(see also <code><a href="#topic+ebp">ebp</a></code> and <code><a href="#topic+fh">fh</a></code>).</p>
</td></tr>
<tr><td><code id="plot.emdi_+3A_label">label</code></td>
<td>
<p>argument that enables to customize title and axis labels. There
are three instant options to label the diagnostic plot: (i) original labels
(&quot;orig&quot;), (ii) axis labels but no title (&quot;no_title&quot;), (iii) neither axis
labels nor title (&quot;blank&quot;).
(iv) individual labels by a list that needs to
have below structure. Six elements can be defined called
<code>qq_res, qq_ran, d_res, d_ran, cooks</code> and <code>opt_lambda</code> for the six
different plots and these list elements need to have three elements each
called <code>title, y_lab and x_lab</code>. Only the labels for the plots that
should be different to the original need to be specified. Please see the
details section for an example with the default labels.</p>
</td></tr>
<tr><td><code id="plot.emdi_+3A_color">color</code></td>
<td>
<p>a character vector with two elements. The first element defines
the color for the line in the QQ-plots, for the Cook's Distance plot and for
the Box-Cox plot. The second element defines the color for the densities.</p>
</td></tr>
<tr><td><code id="plot.emdi_+3A_gg_theme">gg_theme</code></td>
<td>
<p><code><a href="ggplot2.html#topic+theme">theme</a></code> list from package <span class="pkg">ggplot2</span>.
For using this argument, package <span class="pkg">ggplot2</span> must be loaded via
<code>library(ggplot2)</code>. See also Example 4.</p>
</td></tr>
<tr><td><code id="plot.emdi_+3A_cooks">cooks</code></td>
<td>
<p>if <code>TRUE</code>, a Cook's distance plot is returned when the ebp
function is used. The used method <code>mdffits.default</code> from the package
<span class="pkg">HLMdiag</span> struggles when data sets get large. In these cases,
<code>cooks</code> should be set to <code>FALSE</code>. It defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot.emdi_+3A_range">range</code></td>
<td>
<p>optional sequence determining the range of the x-axis for plots
of the optimal transformation parameter that defaults to <code>NULL</code>. In
that case a range of the default interval is used for the plots of the
optimal parameter. This leads in some cases to convergence problems such
that it should be changed to e.g. the selected <code>interval</code>. The default
value depends on the chosen data driven transformation and equals the
default interval for the estimation of the optimal parameter.</p>
</td></tr>
<tr><td><code id="plot.emdi_+3A_...">...</code></td>
<td>
<p>optional arguments passed to generic function.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The default settings of the <code>label</code> argument are as follows
(please note that the title for opt_lambda depends on the chosen
transformation, for the example Box-Cox is shown):<br />
</p>

<dl>
<dt>list(</dt><dd></dd>
<dt>qq_res =</dt><dd><p>c(title=&quot;Error term&quot;,
y_lab=&quot;Quantiles of pearson residuals&quot;,
x_lab=&quot;Theoretical quantiles&quot;),</p>
</dd>
<dt>qq_ran =</dt><dd><p>c(title=&quot;Random effect&quot;,
y_lab=&quot;Quantiles of random effects&quot;,
x_lab=&quot;Theoretical quantiles&quot;),</p>
</dd>
<dt>d_res =</dt><dd><p>c(title=&quot;Density - Pearson residuals&quot;,
y_lab=&quot;Density&quot;,
x_lab=&quot;Pearson residuals&quot;),</p>
</dd>
<dt>d_ran =</dt><dd><p>c(title=&quot;Density - Standardized random effects&quot;,
y_lab=&quot;Density&quot;,
x_lab=&quot;Standardized random effects&quot;),</p>
</dd>
<dt>cooks =</dt><dd><p>c(title=&quot;Cook's Distance Plot&quot;,
y_lab=&quot;Cook's Distance&quot;,
x_lab=&quot;Index&quot;),</p>
</dd>
<dt>opt_lambda =</dt><dd><p>c(title=&quot;Box-Cox - REML&quot;,
y_lab=&quot;Log-Likelihood&quot;,
x_lab=&quot;expression(lambda)&quot;))</p>
</dd>
</dl>



<h3>Value</h3>

<p>Two Q-Q plots in one grid, two density plots, a Cook's distance plot
and a likelihood plot for the optimal parameter of transformations with
transformation parameter obtained by <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code>. The
latter two plots are only provided for ebp object.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+emdiObject">emdiObject</a></code>, <code><a href="#topic+ebp">ebp</a></code>, <code><a href="#topic+fh">fh</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Examples for models of type ebp
# Loading data - population and sample data
data("eusilcA_pop")
data("eusilcA_smp")

# With default setting but na.rm = TRUE; with Box-Cox transformation
emdi_model &lt;- ebp(
  fixed = eqIncome ~ gender + eqsize + cash + self_empl +
    unempl_ben + age_ben + surv_ben + sick_ben + dis_ben + rent + fam_allow +
    house_allow + cap_inv + tax_adj, pop_data = eusilcA_pop,
  pop_domains = "district", smp_data = eusilcA_smp, smp_domains = "district",
  na.rm = TRUE
)

# Example 1: Creation of default diagnostic plots
plot(emdi_model)

# Example 2: Creation of diagnostic plots without labels and titles,
# different colors and without Cook's distance plot.
plot(emdi_model,
  label = "no_title", color = c("red", "yellow"),
  cooks = FALSE
)

# Example 3: Creation of diagnostic plots where labels and title differs for
# residual plot
plot(emdi_model,
  label = list(qq_res = c(
    title = "Pearson resid.",
    y_lab = "Quant.", x_lab = "Theo. Quant."
  )), color = c("red", "yellow"),
  cooks = FALSE
)

# Example 4: Usage of theme from ggplot2 within plot.emdi
library(ggplot2)
plot(emdi_model, gg_theme = theme(
  panel.background =
    element_rect(fill = "white", colour = "white"),
  plot.title = element_text(face = "bold"),
  title = element_text(color = "navy")
))

# Example for models of type fh

# Loading data - population and sample data
data("eusilcA_popAgg")
data("eusilcA_smpAgg")

# Combine sample and population data
combined_data &lt;- combine_data(
  pop_data = eusilcA_popAgg,
  pop_domains = "Domain",
  smp_data = eusilcA_smpAgg,
  smp_domains = "Domain"
)

# Generation of the emdi object
fh_std &lt;- fh(
  fixed = Mean ~ cash + self_empl, vardir = "Var_Mean",
  combined_data = combined_data, domains = "Domain",
  method = "ml", MSE = TRUE
)

# Example 5: Creation of default diagnostic plots for Fay-Herriot model
plot(fh_std)

</code></pre>

<hr>
<h2 id='predict.emdi'>Predictions from emdi Objects</h2><span id='topic+predict.emdi'></span>

<h3>Description</h3>

<p>Method <code>predict.emdi</code> extracts the direct estimates, the empirical
best linear unbiased or empirical best predictors for all domains from an
emdi object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'emdi'
predict(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict.emdi_+3A_object">object</code></td>
<td>
<p>an object of type &quot;emdi&quot;.</p>
</td></tr>
<tr><td><code id="predict.emdi_+3A_...">...</code></td>
<td>
<p>additional arguments that are not used in this method.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For a better selection of prediction results, it is referred to use
the generic function <code><a href="#topic+estimators">estimators</a></code>. The methods for object of
class &quot;emdi&quot; allows to select among the indicators of interest.
</p>


<h3>Value</h3>

<p>Data frame with domain predictors.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+direct">direct</a></code>, <code><a href="#topic+ebp">ebp</a></code>, <code><a href="#topic+fh">fh</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Example for class ebp
emdi_model &lt;- ebp(
  fixed = eqIncome ~ gender + eqsize + cash + self_empl +
    unempl_ben + age_ben + surv_ben + sick_ben + dis_ben + rent + fam_allow +
    house_allow + cap_inv + tax_adj, pop_data = eusilcA_pop,
  pop_domains = "district", smp_data = eusilcA_smp, smp_domains = "district",
  na.rm = TRUE
)

predict(emdi_model)

</code></pre>

<hr>
<h2 id='qqnorm.emdi'>Quantile-quantile Plots for an emdi Object</h2><span id='topic+qqnorm.emdi'></span><span id='topic+qqnorm.ebp'></span><span id='topic+qqnorm.fh'></span><span id='topic+qqnorm.direct'></span>

<h3>Description</h3>

<p>Normal quantile-quantile plots of the underlying model in the EBP (see also
<code><a href="#topic+ebp">ebp</a></code>) or Fay-Herriot (see also <code><a href="#topic+fh">fh</a></code>) approaches are
obtained. The plots are obtained by <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'emdi'
qqnorm(y, color = c("blue", "lightblue3"), gg_theme = NULL, ...)

## S3 method for class 'ebp'
qqnorm(y, color = c("blue", "lightblue3"), gg_theme = NULL, ...)

## S3 method for class 'fh'
qqnorm(y, color = c("blue", "lightblue3"), gg_theme = NULL, ...)

## S3 method for class 'direct'
qqnorm(y, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="qqnorm.emdi_+3A_y">y</code></td>
<td>
<p>a model object of type &quot;emdi&quot;, either &quot;ebp&quot; or &quot;fh&quot;, representing
point and, if chosen, MSE estimates obtained by the EBP or Fay-Herriot
approach (see also <code><a href="#topic+ebp">ebp</a></code> and <code><a href="#topic+fh">fh</a></code>).</p>
</td></tr>
<tr><td><code id="qqnorm.emdi_+3A_color">color</code></td>
<td>
<p>a character vector with two elements. The first element defines
the color for the line in the QQ-plots, for the Cook's Distance plot and for
the Box-Cox plot. The second element defines the color for the densities.</p>
</td></tr>
<tr><td><code id="qqnorm.emdi_+3A_gg_theme">gg_theme</code></td>
<td>
<p><code><a href="ggplot2.html#topic+theme">theme</a></code> list from package <span class="pkg">ggplot2</span>.
For using this argument, package <span class="pkg">ggplot2</span> must be loaded via
<code>library(ggplot2)</code>. See also Example 4.</p>
</td></tr>
<tr><td><code id="qqnorm.emdi_+3A_...">...</code></td>
<td>
<p>optional arguments passed to generic function.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Two Q-Q plots in one grid obtained by <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+emdiObject">emdiObject</a></code>, <code><a href="#topic+ebp">ebp</a></code>, <code><a href="#topic+fh">fh</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Examples for models of type ebp
# Loading data - population and sample data
data("eusilcA_pop")
data("eusilcA_smp")

# With default setting but na.rm = TRUE; with Box-Cox transformation
emdi_model &lt;- ebp(
  fixed = eqIncome ~ gender + eqsize + cash + self_empl +
    unempl_ben + age_ben + surv_ben + sick_ben + dis_ben + rent + fam_allow +
    house_allow + cap_inv + tax_adj, pop_data = eusilcA_pop,
  pop_domains = "district", smp_data = eusilcA_smp, smp_domains = "district",
  na.rm = TRUE
)

# Example 1: Creation of default diagnostic plots
qqnorm(emdi_model)

# Example for models of type fh

# Loading data - population and sample data
data("eusilcA_popAgg")
data("eusilcA_smpAgg")

# Combine sample and population data
combined_data &lt;- combine_data(
  pop_data = eusilcA_popAgg,
  pop_domains = "Domain",
  smp_data = eusilcA_smpAgg,
  smp_domains = "Domain"
)

# Generation of the emdi object
fh_std &lt;- fh(
  fixed = Mean ~ cash + self_empl, vardir = "Var_Mean",
  combined_data = combined_data, domains = "Domain",
  method = "ml", MSE = TRUE
)

# Example 5: Creation of default diagnostic plots for Fay-Herriot model
qqnorm(fh_std)

</code></pre>

<hr>
<h2 id='ranef'>Extract Random Effects of emdi Objects</h2><span id='topic+ranef'></span><span id='topic+random.effects'></span><span id='topic+ranef.ebp'></span><span id='topic+random.effects.ebp'></span><span id='topic+ranef.fh'></span><span id='topic+random.effects.fh'></span>

<h3>Description</h3>

<p>Methods <code>ranef.ebp</code> and <code>ranef.fh</code> extract the
fixed effects from an emdi object of class &quot;ebp&quot; or &quot;fh&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ebp'
ranef(object, ...)

## S3 method for class 'ebp'
random.effects(object, ...)

## S3 method for class 'fh'
ranef(object, ...)

## S3 method for class 'fh'
random.effects(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ranef_+3A_object">object</code></td>
<td>
<p>an object of type &quot;emdi&quot;, depending on the used method either
&quot;ebp&quot; or &quot;fh&quot;.</p>
</td></tr>
<tr><td><code id="ranef_+3A_...">...</code></td>
<td>
<p>additional arguments that are not used in this method.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The alias <code>random.effects</code> can also be used instead of
<code>ranef</code>. The generic function <code>ranef</code> is imported from package
nlme and re-exported to make the S3-methods available, even though the nlme
package itself is not loaded or attached. For default documentation,
see <code><a href="nlme.html#topic+random.effects">random.effects</a></code>.
</p>


<h3>Value</h3>

<p>A vector containing the estimated random effects at domain level is
returned.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ebp">ebp</a></code>, <code><a href="#topic+fh">fh</a></code>,
<code><a href="nlme.html#topic+random.effects">random.effects</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Example for class ebp
emdi_model &lt;- ebp(
  fixed = eqIncome ~ gender + eqsize + cash + self_empl +
    unempl_ben + age_ben + surv_ben + sick_ben + dis_ben + rent + fam_allow +
    house_allow + cap_inv + tax_adj, pop_data = eusilcA_pop,
  pop_domains = "district", smp_data = eusilcA_smp, smp_domains = "district",
  na.rm = TRUE
)

ranef(emdi_model)

</code></pre>

<hr>
<h2 id='spatialcor.tests'>Spatial Autocorrelation Tests</h2><span id='topic+spatialcor.tests'></span>

<h3>Description</h3>

<p>This function computes two spatial autocorrelation tests: Moran's I and
Geary's C.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spatialcor.tests(direct, corMatrix)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="spatialcor.tests_+3A_direct">direct</code></td>
<td>
<p>a vector containing direct estimates. The elements of
<code>direct</code> must be sorted like the elements in <code>corMatrix</code>.</p>
</td></tr>
<tr><td><code id="spatialcor.tests_+3A_cormatrix">corMatrix</code></td>
<td>
<p>matrix or data frame with dimensions number of areas times
number of areas containing the row-standardized proximities between the
domains. Values must lie between <code>0</code> and <code>1</code>. The columns and rows
must be sorted like the domains in <code>direct</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When creating the proximity matrix <code>corMatrix</code>, please make
sure that the elements of <code>direct</code> and <code>corMatrix</code> are sorted
equally and that <code>direct</code> and <code>corMatrix</code> do not contain any
<code>NA</code>s. For a description of how to create the proximity matrix,
see the package vignette &quot;A Framework for Producing Small Area Estimates
Based on Area-Level Models in R&quot;. If direct estimates do not exist for every
area contained in the proximity matrix, the proximity matrix needs to be
subsetted to the areas contained in the direct vector.
</p>


<h3>Value</h3>

<p>The values of the test statistics and their corresponding p values.
</p>


<h3>References</h3>

<p>Bivand, R. (2019), spdep: Spatial Dependence: Weighting Schemes,
Statistics. R package.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Loading data - sample data and proximity matrix
data("eusilcA_smpAgg")
data("eusilcA_prox")

# Compute spatial correlation tests
spatialcor.tests(
  direct = eusilcA_smpAgg$Mean,
  corMatrix = eusilcA_prox
)
</code></pre>

<hr>
<h2 id='step'>Step Function</h2><span id='topic+step'></span><span id='topic+step.default'></span><span id='topic+step.fh'></span>

<h3>Description</h3>

<p>This generic function selects a model by different criteria in a stepwise
algorithm.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>step(object, scope, criteria, direction, trace, steps, ...)

## Default S3 method:
step(object, ...)

## S3 method for class 'fh'
step(
  object,
  scope = NULL,
  criteria = "AIC",
  direction = "both",
  trace = TRUE,
  steps = 1000,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="step_+3A_object">object</code></td>
<td>
<p>an object of type &quot;fh&quot; that contains the chosen
information criterion or of type &quot;lm&quot; for the default method.</p>
</td></tr>
<tr><td><code id="step_+3A_scope">scope</code></td>
<td>
<p>formula or a list including two formulas (<code>lower</code> and
<code>upper</code>) specifying the models considered in the step function.
Defaults to <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="step_+3A_criteria">criteria</code></td>
<td>
<p>a character string describing the model selection criterion.
Criteria that can be chosen are &quot;<code>AIC</code>&quot;, &quot;<code>AICc</code>&quot;, &quot;<code>AICb1</code>&quot;,
&quot;<code>AICb2</code>&quot;, &quot;<code>BIC</code>&quot;, &quot;<code>KIC</code>&quot;, &quot;<code>KICc</code>&quot;, &quot;<code>KICb1</code>&quot;,
or &quot;<code>KICb2</code>&quot;. Defaults to &quot;<code>AIC</code>&quot;.</p>
</td></tr>
<tr><td><code id="step_+3A_direction">direction</code></td>
<td>
<p>a character string describing the direction of stepwise
algorithm. Directions that can be chosen are &quot;<code>both</code>&quot;,
&quot;<code>backward</code>&quot; or &quot;<code>forward</code>&quot;. Defaults to &quot;<code>both</code>&quot;. If no
<code>scope</code> argument is provided, the default is &quot;<code>backward</code>&quot;.</p>
</td></tr>
<tr><td><code id="step_+3A_trace">trace</code></td>
<td>
<p>if <code>TRUE</code>, information about the single steps is
provided during the stepwise procedure. Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="step_+3A_steps">steps</code></td>
<td>
<p>a number determining the maximum number of steps. Defaults to
1000.</p>
</td></tr>
<tr><td><code id="step_+3A_...">...</code></td>
<td>
<p>additional arguments that are not used in this method.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The default method of the generic function <code>step</code>
applies the <code><a href="stats.html#topic+step">step</a></code> function for <code>lm</code> models of the
stats package. Please refer to the documentation of the <code>step</code> function
of the stats package for details.
</p>
<p>The information criteria &quot;<code>AICc</code>&quot;, &quot;<code>AICb1</code>&quot;,
&quot;<code>AICb2</code>&quot;, &quot;<code>KIC</code>&quot;, &quot;<code>KICc</code>&quot;, &quot;<code>KICb1</code>&quot; and
&quot;<code>KICb2</code>&quot; are especially developed for Fay-Herriot models by
<cite>Marhuenda et al. (2014)</cite>. They are based on a bootstrap
algorithm. If one of the criteria is chosen, make sure that the
bootstrap iterations (<code>B</code>) of the &quot;fh&quot; object are set to a positive
number. For some model extensions of the Fay-Herriot model only the
&quot;<code>AIC</code>&quot; and the &quot;<code>BIC</code>&quot; information criteria are provided and for
some none of the information criteria are defined. Check the model_select
component of the &quot;fh&quot; object (objectname$model$model_select). If no
criteria are provided, it is not possible to apply the stepwise
variable selection algorithm.
</p>


<h3>Value</h3>

<p>The return of <code>step</code> depends on the class of its argument.
Please refer to the documentation of the <code><a href="stats.html#topic+step">step</a></code> function
of the stats package for details of the default method.
</p>
<p>For the fh method information about the resulting &quot;best&quot; model due
to the chosen information criterion is provided:
</p>
<table>
<tr><td><code>call</code></td>
<td>
<p>the function call that produced the object.</p>
</td></tr>
<tr><td><code>coefficients</code></td>
<td>
<p>data frame containing the estimated regression
coefficients, the standard errors and the <code>t</code>- and <code>p</code>-values of
the explanatory variables.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Marhuenda, Y., Morales, D. and Pardo, M.C. (2014). Information criteria for
Fay-Herriot model selection. Computational Statistics and Data Analysis 70,
268-280.
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+step">step</a></code>
</p>
<p><code><a href="#topic+emdiObject">emdiObject</a></code>, <code><a href="#topic+fh">fh</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Loading data - population and sample data
data("eusilcA_popAgg")
data("eusilcA_smpAgg")

# Combine sample and population data
combined_data &lt;- combine_data(
  pop_data = eusilcA_popAgg,
  pop_domains = "Domain",
  smp_data = eusilcA_smpAgg,
  smp_domains = "Domain"
)

# Estimate FH model that contains all variables that should be considered
fh_std &lt;- fh(
  fixed = Mean ~ cash + self_empl + unempl_ben,
  vardir = "Var_Mean", combined_data = combined_data,
  domains = "Domain", method = "ml", B = c(0, 50)
)

# Example 1: Use default settings
step(fh_std)

# Example 2: Choose "KICb2" information criterion
step(fh_std, criteria = "KICb2")

</code></pre>

<hr>
<h2 id='write.excel'>Exports an emdiObject to an Excel File or OpenDocument Spreadsheet</h2><span id='topic+write.excel'></span><span id='topic+write.ods'></span>

<h3>Description</h3>

<p>Function <code>write.excel</code> enables the user to export point and MSE
estimates as well as diagnostics from the <code>summary</code> to an Excel file.
The user can choose if the results should be reported in one or several Excel
sheets. Furthermore, a selection of indicators can be specified.
Respectively the function <code>write.ods</code> enables the export to OpenDocument
Spreadsheets. Note that while <code>write.exel</code> will create a single document
<code>write.ods</code> will create a group of files.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write.excel(
  object,
  file = "excel_output.xlsx",
  indicator = "all",
  MSE = FALSE,
  CV = FALSE,
  split = FALSE
)

write.ods(
  object,
  file = "ods_output.ods",
  indicator = "all",
  MSE = FALSE,
  CV = FALSE,
  split = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="write.excel_+3A_object">object</code></td>
<td>
<p>an object of type &quot;emdi&quot;, representing point and
MSE estimates.</p>
</td></tr>
<tr><td><code id="write.excel_+3A_file">file</code></td>
<td>
<p>path and filename of the spreadsheet to create. It should end on
.xlsx or .ods respectively.</p>
</td></tr>
<tr><td><code id="write.excel_+3A_indicator">indicator</code></td>
<td>
<p>optional character vector that selects which indicators
shall be returned: (i) all calculated indicators (&quot;all&quot;);
(ii) each indicator name: &quot;Mean&quot;, &quot;Quantile_10&quot;, &quot;Quantile_25&quot;, &quot;Median&quot;,
&quot;Quantile_75&quot;, &quot;Quantile_90&quot;, &quot;Head_Count&quot;,
&quot;Poverty_Gap&quot;, &quot;Gini&quot;, &quot;Quintile_Share&quot; or the function name/s of
&quot;custom_indicator/s&quot;; (iii) groups of indicators: &quot;Quantiles&quot;, &quot;Poverty&quot; or
&quot;Inequality&quot;. Note, additional custom indicators can be
defined as argument for model-based approaches (see also <code><a href="#topic+ebp">ebp</a></code>)
and do not appear in groups of indicators even though these might belong to
one of the groups. If the <code>model</code> argument is of type &quot;fh&quot;,
indicator can be set to &quot;all&quot;, &quot;Direct&quot;, FH&quot;, or &quot;FH_Bench&quot; (if emdi
object is overwritten by function benchmark). Defaults to &quot;all&quot;.</p>
</td></tr>
<tr><td><code id="write.excel_+3A_mse">MSE</code></td>
<td>
<p>logical. If <code>TRUE</code>, the MSE of the emdiObject is exported.
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="write.excel_+3A_cv">CV</code></td>
<td>
<p>logical. If <code>TRUE</code>, the CV of the emdiObject is exported.
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="write.excel_+3A_split">split</code></td>
<td>
<p>logical. If <code>TRUE</code>, point estimates, MSE and CV are written
to different sheets in the Excel file. In <code>write.ods</code> <code>TRUE</code> will
result in different files for point estimates and their precisions.
Defaults to <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>These functions create an Excel file via the package
<span class="pkg"><a href="openxlsx.html#topic+openxlsx">openxlsx</a></span> and ODS files via the package
<span class="pkg">readODS</span>.
Both packages require a zip application to be available to <span class="rlang"><b>R</b></span>. If this is not
the case the authors of <span class="pkg"><a href="openxlsx.html#topic+openxlsx">openxlsx</a></span> suggest the first of the
following two ways.
</p>

<ul>
<li><p> Install Rtools from: http://cran.r-project.org/bin/windows/Rtools/ and
modify the system PATH during installation.
</p>
</li>
<li><p> If Rtools is installed, but no system path variable is set. One can
set such a variable temporarily to <span class="rlang"><b>R</b></span> by a command like:
<code>Sys.setenv("R_ZIPCMD" = "PathToTheRToolsFolder/bin/zip.exe")</code>.
</p>
</li></ul>

<p>To check if a zip application is available they recommend the command
<code>shell("zip")</code>.
</p>


<h3>Value</h3>

<p>An Excel file is created in your working directory, or at the given
path. Alternatively multiple ODS files are created at the given path.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+direct">direct</a></code>, <code><a href="#topic+emdiObject">emdiObject</a></code>, <code><a href="#topic+ebp">ebp</a></code>,
<code><a href="#topic+fh">fh</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Loading data - population and sample data
data("eusilcA_pop")
data("eusilcA_smp")

# Generate emdi object with two additional indicators; here via function
# ebp()
emdi_model &lt;- ebp(
  fixed = eqIncome ~ gender + eqsize + cash +
    self_empl + unempl_ben + age_ben + surv_ben + sick_ben + dis_ben + rent +
    fam_allow + house_allow + cap_inv + tax_adj, pop_data = eusilcA_pop,
  pop_domains = "district", smp_data = eusilcA_smp, smp_domains = "district",
  threshold = function(y) {
    0.6 * median(y)
  }, L = 50, MSE = TRUE, B = 50,
  custom_indicator = list(
    my_max = function(y) {
      max(y)
    },
    my_min = function(y) {
      min(y)
    }
  ), na.rm = TRUE, cpus = 1
)

# Example 1: Export estimates for all indicators and uncertainty measures
# and diagnostics to Excel
write.excel(emdi_model,
  file = "excel_output_all.xlsx", indicator = "all",
  MSE = TRUE, CV = TRUE
)

# Example 2: Single Excel sheets for point, MSE and CV estimates
write.excel(emdi_model,
  file = "excel_output_all_split.xlsx",
  indicator = "all", MSE = TRUE, CV = TRUE, split = TRUE
)

# Example 3: Same as example 1 but for an ODS output
write.ods(emdi_model,
  file = "ods_output_all.ods", indicator = "all",
  MSE = TRUE, CV = TRUE
)

## End(Not run)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
