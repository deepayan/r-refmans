<!DOCTYPE html><html><head><title>Help for package visualFields</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {visualFields}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#visualFields-package'><p>visualFields: statistical methods for visual fields</p></a></li>
<li><a href='#cart2jpolar'><p>The Jansonius map for average path of nerve fiber bundles</p></a></li>
<li><a href='#drasdolut'><p>Precomputed X and Y displacement of ganglion cell bodies for any given X and Y location on the retina</p></a></li>
<li><a href='#getage'><p>Calculates age</p></a></li>
<li><a href='#glr'><p>Global and pointwise linear regression analyses</p></a></li>
<li><a href='#gpars'><p>List of graphical parameters</p></a></li>
<li><a href='#loadhfaxml'><p>Loaders from perimeters</p></a></li>
<li><a href='#locmaps'><p>Location maps</p></a></li>
<li><a href='#locread'><p>Locmap management</p></a></li>
<li><a href='#normvals'><p>List of normative values that can be used for statistical analysis and</p>
visualization</a></li>
<li><a href='#nvgenerate'><p>Normative values generation and management</p></a></li>
<li><a href='#setdefaults'><p>Settings in the visualField environment</p></a></li>
<li><a href='#vfaggregate'><p>Statistical analyses for visual fields data</p></a></li>
<li><a href='#vfctrIowaPC26'><p>Central visual field</p></a></li>
<li><a href='#vfctrIowaPeri'><p>Peripheral visual field</p></a></li>
<li><a href='#vfctrSunyiu10d2'><p>SUNY-IU dataset of healthy eyes for 10-2 static automated perimetry</p></a></li>
<li><a href='#vfctrSunyiu24d2'><p>SUNY-IU dataset of healthy eyes for 24-2 static automated perimetry</p></a></li>
<li><a href='#vfdesc'><p>Visual field dataset</p></a></li>
<li><a href='#vfgpar'><p>Plots for visual fields data</p></a></li>
<li><a href='#vfpwgRetest24d2'><p>Short-term retest static automated perimetry data</p></a></li>
<li><a href='#vfpwgSunyiu24d2'><p>Series of 24-2 static automated perimetry data for a patient with glaucoma</p></a></li>
<li><a href='#vfsfa'><p>Single Field Reporting</p></a></li>
<li><a href='#vfspa'><p>Series Progession Analysis</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Statistical Methods for Visual Fields</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-02-15</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Ivan Marin-Franch &lt;imarinfr@optocom.es&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>A collection of tools for analyzing the field of vision. It
    provides a framework for development and use of innovative methods for
    visualization, statistical analysis, and clinical interpretation of
    visual-field loss and its change over time. It is intended to be a tool for
    collaborative research. The package is described in Marin-Franch and Swanson
    (2013) &lt;<a href="https://doi.org/10.1167%2F13.4.10">doi:10.1167/13.4.10</a>&gt; and is part of the Open Perimetry Initiative
    (OPI) [Turpin, Artes, and McKendrick (2012) &lt;<a href="https://doi.org/10.1167%2F12.11.22">doi:10.1167/12.11.22</a>&gt;].</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://www.optocom.es">https://www.optocom.es</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R(&ge; 3.5)</td>
</tr>
<tr>
<td>Imports:</td>
<td>Hmisc, dplyr, polyclip, deldir, plotrix, gtools, combinat,
XML, oro.dicom, rlang, shiny, shinyjs, DT, htmlTable, boot,
pracma</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>LazyDataCompression:</td>
<td>xz</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-02-26 17:06:05 UTC; imarinfr</td>
</tr>
<tr>
<td>Author:</td>
<td>Ivan Marin-Franch [cre, aut, rev, cph],
  William H Swanson [fnd, dtc],
  Michael Wall [fnd, dtc],
  Andrew Turpin [ctb],
  Paul H Artes [ctb, dtc],
  Cord Huchzermeyer [ctb],
  Giovanni Montesano [ctb],
  Mitchell W Dul [dtc]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-02-26 17:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='visualFields-package'>visualFields: statistical methods for visual fields</h2><span id='topic+visualFields'></span><span id='topic+visualFields-package'></span>

<h3>Description</h3>

<p>visualFields is a collection of tools for analyzing the field of vision.
It provides a framework for development and use of innovative methods
for visualization, statistical analysis, and clinical interpretation
of visual-field loss and its change over time. It is intended to be a
tool for collaborative research.
</p>


<h3>Details</h3>

<p>The development version of visualFields 1.x, can be found in
<a href="https://github.com/imarinfr/vf1">https://github.com/imarinfr/vf1</a>. For developers who want to collaborate
extending, updating, and patching visualFields, all necessary imports are to
be added to the source file <code>visualFields.R</code>. visualField developers can
use the source codes here as examples on how to craft new source code and keep
documentation that is consistent with the rest of the package, roxygen2, and CRAN.
</p>
<p>The previous version of visualFields, 0.6, is still available for use in
<a href="https://github.com/imarinfr/vf0">https://github.com/imarinfr/vf0</a>, but is no longer maintained.
</p>
<p>This work was supported by the NIH grant number <b>R01EY007716</b> and 
the Veterans Administration grant number <b>I01 RX-001821-01A1</b>.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Ivan Marin-Franch <a href="mailto:imarinfr@optocom.es">imarinfr@optocom.es</a> [reviewer, copyright holder]
</p>
<p>Other contributors:
</p>

<ul>
<li><p> William H Swanson [funder, data contributor]
</p>
</li>
<li><p> Michael Wall [funder, data contributor]
</p>
</li>
<li><p> Andrew Turpin [contributor]
</p>
</li>
<li><p> Paul H Artes [contributor, data contributor]
</p>
</li>
<li><p> Cord Huchzermeyer [contributor]
</p>
</li>
<li><p> Giovanni Montesano [contributor]
</p>
</li>
<li><p> Mitchell W Dul [data contributor]
</p>
</li></ul>



<h3>References</h3>

<p>Marín-Franch I &amp; Swanson WH. <em>The visualFields package: A tool for
analysis and visualization of visual fields</em>. Journal of Vision, 2013,
13(4):10, 1-12
</p>
<p>Turpin A, Artes PH, &amp; McKendrick AM. <em>The Open Perimetry Interface:
An enabling tool for clinical visual psychophysics</em>. Journal of Vision,
2012, 12(11):22, 21–25
</p>


<h3>See Also</h3>

<p><code>OPI</code>: the Open Perimetry Initiative
<a href="https://people.eng.unimelb.edu.au/aturpin/opi/index.html">https://people.eng.unimelb.edu.au/aturpin/opi/index.html</a>
</p>

<hr>
<h2 id='cart2jpolar'>The Jansonius map for average path of nerve fiber bundles</h2><span id='topic+cart2jpolar'></span><span id='topic+jpolar2cart'></span><span id='topic+bundlePath'></span><span id='topic+loc2psi'></span><span id='topic+psi2oct'></span><span id='topic+vf2gc'></span>

<h3>Description</h3>

<p>Generates a function that renders the average path of
a nerve fiber bundle that exits through the optic nerve head (ONH)
with a particular angle
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cart2jpolar(coord)

jpolar2cart(rpsi)

bundlePath(psi0, r0 = 4)

loc2psi(coord, r0 = 4)

psi2oct(psi0, diam = 12)

vf2gc(coord, angle = 0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cart2jpolar_+3A_coord">coord</code></td>
<td>
<p>coordinates of locations in the visual field</p>
</td></tr>
<tr><td><code id="cart2jpolar_+3A_rpsi">rpsi</code></td>
<td>
<p>visual field locations in polar coordinates of the
distorted space of the Jansonius map</p>
</td></tr>
<tr><td><code id="cart2jpolar_+3A_psi0">psi0</code></td>
<td>
<p>angle of incidence at the ONH</p>
</td></tr>
<tr><td><code id="cart2jpolar_+3A_r0">r0</code></td>
<td>
<p>radius of the ONH. Its default value is <code>4</code>.
Changing it changes the calculated average bundle paths.</p>
</td></tr>
<tr><td><code id="cart2jpolar_+3A_diam">diam</code></td>
<td>
<p>diamater in degrees of visual angle of the OCT circular
scan centered at the center of the ONH</p>
</td></tr>
<tr><td><code id="cart2jpolar_+3A_angle">angle</code></td>
<td>
<p>fovea-disc angle in degrees</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li><p><code>cart2jpolar</code> converts the cartesian coordinates to the polar
coordinates in the distorted space used in the Jansonius map
</p>
</li>
<li><p><code>jpolar2cart</code> converts back from the Jansonius polar
coordinates to cartesian coordinates
</p>
</li>
<li><p><code>bundlePath</code> returns a function describing the expected fiber
path given an angle of incidence on the ONH
</p>
</li>
<li><p><code>loc2psi</code> returns the angle of incidence of the average bundle path
that passes through specific locations of the visual field
</p>
</li>
<li><p><code>psi2oct</code> returns the angle of OCT circular scans corresponding
to average bundle paths with specific angle of incidence at the ONH
</p>
</li>
<li><p><code>vf2gc</code> calculates ganglion-cell soma locations
</p>
</li></ul>



<h3>Value</h3>

<p><code>cart2jpolar</code>: returns the Jansonius modified polar coordinates
</p>
<p><code>jpolar2cart</code>: returns Cartesian coordinates
</p>
<p><code>bundlePath</code>: returns a function describing a retinal ganglion cell bundle path
</p>
<p><code>loc2psi</code>: returns the angle of incidence on the ONH
</p>
<p><code>psi2oct</code>: returns the corresponding angle in the OCT circular scan
</p>
<p><code>vf2gc</code>: returns the ganglion cell soma corresponding to the photoreceptors
of a visual field location
</p>


<h3>References</h3>

<p>N. M. Jansonius, J. Nevalainen, B. Selig, L. M. Zangwill,
P. A. Sample, W. M. Budde, J. B. Jonas, W. A. Lagreze,
P. J. Airaksinen, R. Vonthein, L. A. Levin, J. Paetzold,
and U. Schiefer. <em>A mathematical description of nerve
fiber bundle trajectories and their variability in the human
retina</em>. Vision Research, 49(17):2157-2163, 2009
</p>
<p>N. M. Jansonius, J. Nevalainen, B. Selig, L. M. Zangwill,
P. A. Sample, W. M. Budde, J. B. Jonas, W. A. Lagreze,
P. J. Airaksinen, R. Vonthein, L. A. Levin, J. Paetzold,
and U. Schiefer. <em>Erratum to &quot;A mathematical description
of nerve fiber bundle trajectories and their variability in
the human retina&quot;</em>. Vision Research, 50:1501, 2010
</p>
<p>N. M. Jansonius, J. Schiefer, J. Nevalainen, J. Paetzold,
and U. Schiefer. <em>A mathematical model for describing
the retinal nerve fiber bundle trajectories in the human eye:
Average course, variability, and influence of refraction, optic
disc size and optic disc position</em>. Experimental Eye Research,
105:70-78, 2012
</p>
<p>N. Drasdo, C. L. Millican, C. R. Katholi, and C. A. Curcio. <em>The
length of Henle fibers in the human retina and a model of ganglion
receptive field density in the visual field</em>. Vision Research,
47:2901–2911, 2007
</p>
<p>D. C. Hood, A. S. Raza, D. M. C. G. V., J. G. Odel, V. C. Greenstein,
J. M. Liebmann, and R. Ritch. <em>Initial arcuate defects within the
central 10  degrees in glaucoma</em>. Investigative Ophthalmology and Visual
Science, 52(2):940-946, 2011
</p>
<p>A. S. Raza, J. Cho, D. M. C. G. V., H. Wang, X. Zhang, R. H. Kardon,
J. M. Liebmann, R. Ritch, and D. C. Hood. <em>Retinal ganglion cell
layer thickness and local visual field sensitivity in glaucoma</em>.
Archives of Ophthalmology, 129(12):1529-1536, 2011
</p>
<p>G. Montesano, G. Ometto, R. E. Hogg, L. M. Rossetti, D. F. Garway-Heath,
and D. P. Crabb. <em>Revisiting the Drasdo Model: Implications for 
Structure-Function Analysis of the Macular Region</em>. 
Translational Vision Science and Technology,
9(10):15, 2020
</p>


<h3>Examples</h3>

<pre><code class='language-R'># get ganglion-cell soma locations from visual field locations
vf2gc(locmaps$p10d2$coord)
# convert to polar of the distorted space used by Jansonius map and back
coord &lt;- data.frame(x = c(3, 0, -3), y = c(0, 0, 0))
(rpsi &lt;- cart2jpolar(coord))
jpolar2cart(rpsi)

# get an average bundle path from a specific angle of incidence in the ONH
# The object returned is a function that returns polar angles of the
# distorted space of the Jansonius map for distances from the ONH center
pathFun &lt;- bundlePath(-125)
jpolar2cart(data.frame(10:20, pathFun(10:20)))

# get angle of incidence in the ONH from locations of the visual field
loc2psi(coord)

# get the OCT circular scan angles from the angle of incidence in the ONH
# for the 10-2 map of locations, ...
psi2oct(loc2psi(locmaps$p10d2$coord))
# the previous operation was actually fundamentally wrong! We need to
# obtain first the 
psi2oct(loc2psi(vf2gc(locmaps$p10d2$coord)))
</code></pre>

<hr>
<h2 id='drasdolut'>Precomputed X and Y displacement of ganglion cell bodies for any given X and Y location on the retina</h2><span id='topic+drasdolut'></span>

<h3>Description</h3>

<p>It contains a first list with two LUTs for the X and Y displacement of ganglion cell bodies
for arbitrary locations in the retina (in mm assuming 24 mm axial length). The other two elements of the list
contain precomputed vectors of degrees and mm on the retina for the same schematic eye, used for conversions.
These are used by the function vf2gc().
</p>


<h3>Usage</h3>

<pre><code class='language-R'>drasdolut
</code></pre>


<h3>Format</h3>

<p>A large list containing
</p>

<dl>
<dt>Drasdo_LUT</dt><dd><p>a list of four elements: xlut and ylut are 2d matrices 
containing X and Y ganglion cell positions for any given location. 
Xv and Yv are vectors defining the corresponding locations for the matrices along the X and Y axis.</p>
</dd>
<dt>Degs</dt><dd><p>A vector of degrees from the fovea, using a schematic eye. Corresponds to distances on the retina stored in MM</p>
</dd>
<dt>MM</dt><dd><p>A vector of MM distance from the fovea, using a schematic eye. Corresponds to distances in degrees stored in Degs</p>
</dd>
</dl>



<h3>References</h3>

<p>G. Montesano, G. Ometto, R. E. Hogg, L. M. Rossetti, D. F. Garway-Heath,
and D. P. Crabb. <em>Revisiting the Drasdo Model: Implications for 
Structure-Function Analysis of the Macular Region</em>. 
Translational Vision Science and Technology,
9(10):15, 2020
</p>
<p>N. Drasdo, C. L. Millican, C. R. Katholi, and C. A. Curcio. <em>The
length of Henle fibers in the human retina and a model of ganglion
receptive field density in the visual field</em>. Vision Research,
47:2901–2911, 2007
</p>

<hr>
<h2 id='getage'>Calculates age</h2><span id='topic+getage'></span>

<h3>Description</h3>

<p>Computes ages at specific dates
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getage(dob, date)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getage_+3A_dob">dob</code></td>
<td>
<p>date(s) of birth</p>
</td></tr>
<tr><td><code id="getage_+3A_date">date</code></td>
<td>
<p>date(s) for which to calculate age</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>getage</code> returns the age from the date of birth and a certain date
</p>


<h3>Examples</h3>

<pre><code class='language-R'>getage("1977-01-31", "2014-01-30")
</code></pre>

<hr>
<h2 id='glr'>Global and pointwise linear regression analyses</h2><span id='topic+glr'></span><span id='topic+plr'></span><span id='topic+poplr'></span>

<h3>Description</h3>

<p>Functions that compute global and pointwise linear regression analyses:
</p>

<ul>
<li><p><code>glr</code> performs global linear regression analysis
</p>
</li>
<li><p><code>plr</code> performs pointwise linear regression (PLR) analysis
</p>
</li>
<li><p><code>poplr</code> performs PoPLR analysis as in O'Leary et al (see reference)
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>glr(g, type = "md", testSlope = 0)

plr(vf, type = "td", testSlope = 0)

poplr(vf, type = "td", testSlope = 0, nperm = factorial(7), trunc = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="glr_+3A_g">g</code></td>
<td>
<p>global indices</p>
</td></tr>
<tr><td><code id="glr_+3A_type">type</code></td>
<td>
<p>type of analysis. For <code>glr</code>, it can be '<code>ms</code>', '<code>ss</code>',
'<code>md</code>', '<code>sd</code>', '<code>pmd</code>', '<code>psd</code>', '<code>vfi</code>', or '<code>gh</code>'
for mean sensitivity, standard deviation of sensitivities, mean deviation,
standard deviation of total deviation values, pattern mean deviation, pattern
standard deviation, VFI, and general height, respectively. For <code>plr</code> and
<code>poplr</code>, it can be '<code>s</code>', '<code>td</code>', or '<code>pd</code>' for sensitivities,
total deviation values, or pattern deviation values, respectively</p>
</td></tr>
<tr><td><code id="glr_+3A_testslope">testSlope</code></td>
<td>
<p>slope, or slopes, to test as null hypothesis. Default is 0.
if a single value, then the same null hypothesis is used for all locations.
If a vector of values, then (for <code>plr</code> and <code>poplr</code>) each
location of the visual field will have a different null hypothesis. The length of
testSlope must be 1 or equal to the number of locations to be used in the PLR or
PoPLR analysis</p>
</td></tr>
<tr><td><code id="glr_+3A_vf">vf</code></td>
<td>
<p>visual fields sensitivity data</p>
</td></tr>
<tr><td><code id="glr_+3A_nperm">nperm</code></td>
<td>
<p>number of permutations. If the number of visits is 7 or less, then
<code>nperm = factorial(nrow(vf))</code>. For series greater than 8 visits, default is
factorial(7). For series up to 7 visits, it is the factorial of the number of visits
(with less than 7 visits, the number of possible permutations is small and results
can be unreliable. For instance, for 5 visits, the number of possible permutations is
only 120.)</p>
</td></tr>
<tr><td><code id="glr_+3A_trunc">trunc</code></td>
<td>
<p>truncation value for the Truncated Product Method (see reference)</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li><p><code>poplr</code> there is a small difference between this implementation of
PoPLR and that proposed by O'Leary et al. The combined S statistic in the
paper used a natural logarithm. Here we not only use a logarithm of base 10
but we also divide by the number of locations. This way the S statistic has
a more direct interpretation as the average number of leading zeros in the
p-values for pointwise (simple) linear regression. That is, if S = 2, then
the p-values have on average 2 leading zeros, if S = 3, then 3 leading zeros,
and so on
</p>
</li></ul>



<h3>Value</h3>


<ul>
<li><p><code>glr</code> and <code>plr</code> return a list with the following
</p>

<ul>
<li><p><code>id</code> patient ID
</p>
</li>
<li><p><code>eye</code> patient eye
</p>
</li>
<li><p><code>type</code> type of data analysis. . For <code>glr</code>, it can be
'<code>ms</code>', '<code>ss</code>', '<code>md</code>', '<code>sd</code>', '<code>pmd</code>',
'<code>psd</code>', '<code>vfi</code>', or '<code>gh</code>' for mean sensitivity,
standard deviation of sensitivities, mean deviation, standard
deviation of total deviation values, pattern mean deviation, pattern
standard deviation, VFI, and general height, respectively. For <code>plr</code>
and <code>poplr</code>, it can be '<code>s</code>', '<code>td</code>', or '<code>pd</code>' for
sensitivities, total deviation values, or pattern deviation values,
respectively
</p>
</li>
<li><p><code>testSlope</code> slope for <code>glr</code> or list of slopes for <code>plr</code>
to test as null hypotheses
</p>
</li>
<li><p><code>nvisits</code> number of visits
</p>
</li>
<li><p><code>years</code> years from baseline. Used for the pointwise linear
regression analysis
</p>
</li>
<li><p><code>data</code> data analyzed. For <code>glr</code>, it is the values of the
global indes analyzed. For <code>plr</code>, each column is a location of the
visual field used for the analysis. Each row is a visit (as many as years)
</p>
</li>
<li><p><code>pred</code> predicted values. Each column is a location of the visual
field used for the analysis. Each row is a visit (as many as years)
</p>
</li>
<li><p><code>sl</code> slopes estimated at each location for pointwise (simple)
linear regression
</p>
</li>
<li><p><code>int</code> intercept estimated at each location for pointwise (simple)
linear regression
</p>
</li>
<li><p><code>tval</code> t-values obtained for the left-tailed-t-tests for the slopes
obtained in the pointwise (simple) linear regression at each location
</p>
</li>
<li><p><code>pval</code> p-values obtained for the left-tailed t-tests for the slopes
obtained
</p>
</li></ul>


</li>
<li><p><code>poplr</code> returns a list with the following additional fields
</p>

<ul>
<li><p><code>csl</code> the modifed Fisher's S-statistic for the left-tailed permutation test
</p>
</li>
<li><p><code>cslp</code> the p-value for the left-tailed permutation test
</p>
</li>
<li><p><code>csr</code> the modifed Fisher's S-statistic for the right-tailed permutation test
</p>
</li>
<li><p><code>csrp</code> the p-value for the right-tailed permutation test
</p>
</li>
<li><p><code>pstats</code> a list with the poinwise slopes ('<code>sl</code>'), intercepts
('<code>int</code>'), standard errors ('<code>se</code>'), and p-values ('<code>pval</code>') obtained
for the series at each location analyzed and for all <code>nperm</code> permutations
(in '<code>permutations</code>')
</p>
</li>
<li><p><code>cstats</code> a list with all combined stats:
</p>

<ul>
<li><p><code>csl, csr</code> the combined Fisher S-statistics for the left- and right-tailed
permutation tests respectively
</p>
</li>
<li><p><code>cslp, csrp</code> the corresponding p-values for the permutation tests
</p>
</li>
<li><p><code>cslall, csrall</code> the combined Fisher S-statistics for all permutations
</p>
</li></ul>

</li></ul>


</li></ul>



<h3>References</h3>

<p>N. O'Leary, B. C. Chauhan, and P. H. Artes. <em>Visual field progression in
glaucoma: estimating the overall significance of deterioration with permutation
analyses of pointwise linear regression (PoPLR)</em>. Investigative Ophthalmology
and Visual Science, 53, 2012
</p>


<h3>Examples</h3>

<pre><code class='language-R'>vf &lt;- vffilter(vfpwgRetest24d2, id == 1) # select one patient
res &lt;- glr(getgl(vf)) # linear regression with global indices
res &lt;- plr(vf)   # pointwise linear regression (PLR) with TD values
res &lt;- poplr(vf) # Permutation of PLR with TD values
</code></pre>

<hr>
<h2 id='gpars'>List of graphical parameters</h2><span id='topic+gpars'></span>

<h3>Description</h3>

<p>It contains a list of normative values, including pointwise and
smoothed SUNY-IU normative reference values for 24-2 static automated perimetry
(<code>sunyiu_24d2_pw</code> and <code>sunyiu_24d2</code>) obtained with the dataset
<code><a href="#topic+vfctrSunyiu24d2">vfctrSunyiu24d2</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gpars
</code></pre>


<h3>Format</h3>

<p>See section <code>Structure of graphical parameters</code> in <code><a href="#topic+vfplot">vfplot</a></code>
</p>

<hr>
<h2 id='loadhfaxml'>Loaders from perimeters</h2><span id='topic+loadhfaxml'></span><span id='topic+loadhfadicom'></span><span id='topic+loadoctopus'></span><span id='topic+loadhfaxmlbatch'></span><span id='topic+loadhfadicombatch'></span>

<h3>Description</h3>

<p>Functions to load from commercial perimeters
</p>


<h3>Usage</h3>

<pre><code class='language-R'>loadhfaxml(file, type = "pwg", repeated = mean)

loadhfadicom(file, type = "pwg", repeated = mean)

loadoctopus(file, type = "pwg", repeated = mean, dateFormat = "%d.%m.%Y")

loadhfaxmlbatch(file, repeated = mean)

loadhfadicombatch(file, repeated = mean)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="loadhfaxml_+3A_file">file</code></td>
<td>
<p>name of the csv file exported by the eyesuite software</p>
</td></tr>
<tr><td><code id="loadhfaxml_+3A_type">type</code></td>
<td>
<p>type of patient. It can be '<code>ctr</code>' (for control or healthy
subject-eye) or '<code>pwg</code>' (for patient with glaucoma) or other</p>
</td></tr>
<tr><td><code id="loadhfaxml_+3A_repeated">repeated</code></td>
<td>
<p>function to apply if there are repeated values in a particular location</p>
</td></tr>
<tr><td><code id="loadhfaxml_+3A_dateformat">dateFormat</code></td>
<td>
<p>format to be used for date. Its default value is %d.%m.%Y</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The XML loader for the Humphrery Field Analyser (HFA) by Carl Zeiss Meditec
is essentially a XML parser that reads in the XML generated with the scientific
export license. The DICOMM loader is also a parser to read HFA data generated in a
DICOMM file. The loader for the Octopus perimeter by Haag-Streit is a csv reader
from files generated with the Eyesuite software. The parser also extracts information
on visual field pattern deviation values and normative values. The list that is returned
with the <code>loadoctopus</code> loader contains data frames which are structured with keys so that
redundancy is minimized (similar to a relational database). Detailed examples for
<code>loadoctopus</code>: <a href="https://rpubs.com/huchzi/645357">https://rpubs.com/huchzi/645357</a>
</p>


<h3>Value</h3>

<p>Visual field data
</p>

<hr>
<h2 id='locmaps'>Location maps</h2><span id='topic+locmaps'></span>

<h3>Description</h3>

<p>List of common and some custom location maps, including the
24-2, 10-2, 30-2, 60-4, etc used the the HFA and Octopus, the 24-2 used
by the Matrix (FDT), and others used in Swanson's and Wall's labs
</p>


<h3>Usage</h3>

<pre><code class='language-R'>locmaps
</code></pre>


<h3>Format</h3>

<p>See section <code>Structure of location maps</code> in <code><a href="#topic+setlocmap">setlocmap</a></code>
</p>

<hr>
<h2 id='locread'>Locmap management</h2><span id='topic+locread'></span><span id='topic+locwrite'></span>

<h3>Description</h3>

<p>Functions to handle location maps, which are lists with x and y
coordinates and other importan information about the visual field test
locations. Check section <code>Structure of location maps</code> below for details
</p>


<h3>Usage</h3>

<pre><code class='language-R'>locread(file, name = "", desc = "", bs = numeric(), ...)

locwrite(locmap, file, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="locread_+3A_file">file</code></td>
<td>
<p>the name of the file which the data are to be read from</p>
</td></tr>
<tr><td><code id="locread_+3A_name">name</code></td>
<td>
<p>to give the location map</p>
</td></tr>
<tr><td><code id="locread_+3A_desc">desc</code></td>
<td>
<p>brief description for the location map</p>
</td></tr>
<tr><td><code id="locread_+3A_bs">bs</code></td>
<td>
<p>locations that should be excluded from statistical analysis because
of their proximity to the blind spot</p>
</td></tr>
<tr><td><code id="locread_+3A_...">...</code></td>
<td>
<p>arguments to be passed to or from methods</p>
</td></tr>
<tr><td><code id="locread_+3A_locmap">locmap</code></td>
<td>
<p>location map from which to get coordinates to export as csv file</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li><p><code>locread</code> reads a csv file with location map data
</p>
</li>
<li><p><code>locwrite</code> writes a csv file with location map data
</p>
</li></ul>



<h3>Value</h3>

<p><code>locread</code> a list with information about a location map
</p>
<p><code>locwrite</code> No return value
</p>


<h3>Structure of location maps</h3>

<p>Each element in the list <code>locmaps</code> is a location map that
contains the following fields
</p>

<ul>
<li><p><code>name</code> descriptive name
</p>
</li>
<li><p><code>desc</code> brief description
</p>
</li>
<li><p><code>coord</code> coordinates of the visual field locations
</p>
</li>
<li><p><code>bs</code> if not empty, the locations that ought to be removed
for statistical analysis due to their proximity to the blind spot
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># write and read location map
tf &lt;- tempfile("locmap")
locwrite(getlocmap(), file = tf) # save current locmap in a temp file
print(locread(tf, name = "name", desc = "desc", bs = c(1, 2))) # read the temp file
</code></pre>

<hr>
<h2 id='normvals'>List of normative values that can be used for statistical analysis and
visualization</h2><span id='topic+normvals'></span>

<h3>Description</h3>

<p>It contains a list of normative values, including pointwise and
smoothed SUNY-IU normative reference values for 24-2 static automated perimetry
(<code>sunyiu_24d2_pw</code> and <code>sunyiu_24d2</code>) obtained with the dataset
<code><a href="#topic+vfctrSunyiu24d2">vfctrSunyiu24d2</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>normvals
</code></pre>


<h3>Format</h3>

<p>See section <code>Structure of normative values</code> in <code><a href="#topic+setnv">setnv</a></code>
</p>


<h3>References</h3>

<p>H. J. Wyatt, M. W. Dul, and W. H. Swanson. <em>Variability of visual
field measurements is correlated with the gradient of visual
sensitivity</em>. Vision Research, 47, 2007.
</p>
<p>A. Shafi, W. H. Swanson, and M. W. Dul. <em>Structure and Function
in Patients with Glaucomatous Defects Near Fixation</em>. Optometry and
Vision Science, 88, 2011.
</p>

<hr>
<h2 id='nvgenerate'>Normative values generation and management</h2><span id='topic+nvgenerate'></span><span id='topic+agelm'></span><span id='topic+tddef'></span><span id='topic+ghdef'></span><span id='topic+pddef'></span><span id='topic+lutdef'></span><span id='topic+gdef'></span><span id='topic+lutgdef'></span>

<h3>Description</h3>

<p>Functions to generate and handle normative values. Check section
<code>Structure of normative values</code> below for details about how to generate
functioning normative values
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nvgenerate(
  vf,
  method = "pointwise",
  probs = c(0, 0.005, 0.01, 0.02, 0.05, 0.95, 0.98, 0.99, 0.995, 1),
  name = "",
  perimetry = "static automated perimetry",
  strategy = "",
  size = ""
)

agelm(vf)

tddef(agem)

ghdef(perc = 0.85)

pddef(ghfun = ghdef(0.85))

lutdef(vf, probs, type = "quantile", ...)

gdef(agem, sdtd, sdpd)

lutgdef(g, probs, type = "quantile", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nvgenerate_+3A_vf">vf</code></td>
<td>
<p>visual field data with sensitivity values</p>
</td></tr>
<tr><td><code id="nvgenerate_+3A_method">method</code></td>
<td>
<p>method to generate normative values, pointwise ('<code>pointwise</code>')
or smoothed with 2-dimensional quadratic functions ('<code>smooth</code>')</p>
</td></tr>
<tr><td><code id="nvgenerate_+3A_probs">probs</code></td>
<td>
<p>numeric vector of probabilities with values in <code>[0,1]</code>.
The values 0 and 1 must be included</p>
</td></tr>
<tr><td><code id="nvgenerate_+3A_name">name</code></td>
<td>
<p>name for the normative values, e.g., &quot;SUNY-IU pointwise NVs&quot;.
Default is blank</p>
</td></tr>
<tr><td><code id="nvgenerate_+3A_perimetry">perimetry</code></td>
<td>
<p>perimetry used to obtain normative data, e.g.,
&quot;static automated perimetry&quot; (default)</p>
</td></tr>
<tr><td><code id="nvgenerate_+3A_strategy">strategy</code></td>
<td>
<p>psychophysical strategy used to obtain threshold values, e.g.,
&quot;SITA standard&quot;. Default is blank</p>
</td></tr>
<tr><td><code id="nvgenerate_+3A_size">size</code></td>
<td>
<p>stimulus size, if the same size was used for all visual field
locations or empty (default)</p>
</td></tr>
<tr><td><code id="nvgenerate_+3A_agem">agem</code></td>
<td>
<p>age model to construct the function to obtain TD values</p>
</td></tr>
<tr><td><code id="nvgenerate_+3A_perc">perc</code></td>
<td>
<p>the percentile to obtain the ranked TD value as
reference for the general height (GH) of the visual field.
Default is the 85th percentile, thus <code>0.85</code></p>
</td></tr>
<tr><td><code id="nvgenerate_+3A_ghfun">ghfun</code></td>
<td>
<p>function used for determination of the GH and PD values</p>
</td></tr>
<tr><td><code id="nvgenerate_+3A_type">type</code></td>
<td>
<p>type of estimation for the weighted quantile values. See
<code><a href="Hmisc.html#topic+wtd.quantile">wtd.quantile</a></code> for details. Default is '<code>quantile</code>'</p>
</td></tr>
<tr><td><code id="nvgenerate_+3A_...">...</code></td>
<td>
<p>arguments to be passed to or from methods</p>
</td></tr>
<tr><td><code id="nvgenerate_+3A_sdtd">sdtd</code></td>
<td>
<p>standard deviations obtained for TD values</p>
</td></tr>
<tr><td><code id="nvgenerate_+3A_sdpd">sdpd</code></td>
<td>
<p>standard deviations obtained for PD values</p>
</td></tr>
<tr><td><code id="nvgenerate_+3A_g">g</code></td>
<td>
<p>a table with global indices</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>nvgenerate</code> returns a list with normative values
</p>
<p><code>agelm</code> returns a list with coefficients and a function defining
a linear age model
</p>
<p><code>tddef</code> returns a function for the computation of TD values
</p>
<p><code>ghdef</code> returns a function for the computation of the general height
</p>
<p><code>pddef</code> returns a function for the computation of PD values
</p>
<p><code>lutdef</code> returns a look up table and a function for the
computation of the probability values for TD and PD
</p>
<p><code>gdef</code> returns a function to compute global indices
</p>
<p><code>lutgdef</code> returns a look up table and a function for the
computation of the probability values for global indices
</p>


<h3>Structure of normative values</h3>

<p>This is one of the most complex structures in visualFields. It is necessary
to be able to run statistical analyses of visual fields obtained from
perimetry and it requires data from healthy eyes for its generation. The
normative values are only as good as the data they are generated from. Two
common ways to generate full normative values from a dataset of healthy eyes,
are provided in the package, depending on the <code>method</code> selected. The first
one, <code>method="pointwise"</code>, generates normative values directly from
pointwise statistics. The second one, <code>method="smooth"</code>, uses a 2D
quadratic functions to smooth out those pointwise statistics. Variations
or improvements can be regenerated by copying the code in those functions and
editing it.
</p>

<ul>
<li><p><code>info</code> information regarding normative values. Info is not necessary
to carry out statistics, but is useful for the generation of reports. The
fields need not be the same as the ones listed here, although these are used
in the reports in <code><a href="#topic+vfsfa">vfsfa</a></code> for single field analysis and
<code><a href="#topic+vfspa">vfspa</a></code> for series progression analysis.
</p>

<ul>
<li><p><code>name</code> name of the normative values
</p>
</li>
<li><p><code>perimetry</code> perimetry device for which normative values are intended
</p>
</li>
<li><p><code>strategy</code> psychophysical strategy
</p>
</li>
<li><p><code>size</code> stimulus size, e.g. Goldmann size III, size V
</p>
</li></ul>

</li>
<li><p><code>agem</code> The normative values' age model. The default methods' generate
age linear models with coefficients for each location in <code>locmap</code> in
<code>coeff</code> and the function definining the model in <code>model</code>
</p>
</li>
<li><p><code>sd</code> standard deviations of the sensitivities, <code>s</code>, total
deviation (TD) values, <code>td</code>, and pattern deviation (PD) values, <code>pd</code>
</p>
</li>
<li><p><code>luts</code> Lookup tables to obtain probability levels for TD and PD values.
</p>

<ul>
<li><p><code>probs</code> probability levels
</p>
</li>
<li><p><code>td</code>, <code>pd</code> lookup tables for TD and PD values at each location
in <code>locmaps</code>
</p>
</li>
<li><p><code>global</code> lookup table for the following global visual field indices
</p>

<ul>
<li><p><code>ms</code> mean sensitivity (MS) calculated as the unweithed average
over locations' values
</p>
</li>
<li><p><code>ss</code> standard deviation of sensitivity calculated as the
unweithed standard deviation over locations' values
</p>
</li>
<li><p><code>md</code> mean deviation (MD) calculated as the weithed average
over locations' values. Weights are the inverse of the standard
deviation in <code>sd</code> for TD at each location.
</p>
</li>
<li><p><code>sd</code> standard deviation of total deviation calculated as the
weithed standard deviation over locations' values. Weights are the inverse of the standard
deviation in <code>sd</code> for TD at each location.
</p>
</li>
<li><p><code>pmd</code> pattern mean deviation calculated as the weithed average
over locations' values. Weights are the inverse of the standard
deviation in <code>sd</code> for PD at each location.
</p>
</li>
<li><p><code>psd</code> pattern standard deviation calculated as the weithed
standard deviation over locations' values. Weights are the inverse
of the standard deviation in <code>sd</code> for PD at each location.
</p>
</li>
<li><p><code>gh</code> general height. This is defined traditionally for the 24-2
and the 30-2 as the approximatelly the 85th percentile of TD values
</p>
</li>
<li><p><code>vfi</code> the oddly defined visual field index
</p>
</li></ul>

</li></ul>

</li>
<li><p><code>tdfun</code> a function defining how to obtain the TD values. Typically, it
is a function of age and sensitivity values and it is defined as sensitivity
values minus the age-corrected mean normal obtained as defined in <code>agem</code>.
Thus, TD values are negative is visual field sensitivity values are below
mean normal and positive if they are above mean normal
</p>
</li>
<li><p><code>ghfun</code> a function defining how to obtain the general height
</p>
</li>
<li><p><code>pdfun</code> a function defining how to obtain the PD values. Tipically, they
are obtaines as the TD values minus the general height
</p>
</li>
<li><p><code>glfun</code> a function defining how to obtain different global indices
</p>
</li>
<li><p><code>tdpfun</code>, <code>pdpfun</code>, <code>glpfun</code> mapping functions to get
the probability levels corresponding to TD, PD and global indices values and
based on the lookup tables defined in <code>luts</code>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># generate normative values from SUNY-IU dataset of healthy eyes
# pointwise
sunyiu_24d2_pw &lt;- nvgenerate(vfctrSunyiu24d2, method = "pointwise",
                             name      = "SUNY-IU pointwise NVs",
                             perimetry = "static automated perimetry",
                             strategy  = "SITA standard",
                             size      = "Size III")
# smooth
sunyiu_24d2 &lt;- nvgenerate(vfctrSunyiu24d2, method = "smooth",
                          name      = "SUNY-IU smoothed NVs",
                          perimetry = "static automated perimetry",
                          strategy  = "SITA standard",
                          size      = "Size III")
</code></pre>

<hr>
<h2 id='setdefaults'>Settings in the visualField environment</h2><span id='topic+setdefaults'></span><span id='topic+getnv'></span><span id='topic+setnv'></span><span id='topic+getgpar'></span><span id='topic+setgpar'></span><span id='topic+getlocmap'></span><span id='topic+setlocmap'></span><span id='topic+getlocini'></span><span id='topic+setlocini'></span><span id='topic+getvfcols'></span>

<h3>Description</h3>

<p>Functions to set and get settings in the visualField environment
</p>


<h3>Usage</h3>

<pre><code class='language-R'>setdefaults()

getnv()

setnv(nv)

getgpar()

setgpar(gpar)

getlocmap()

setlocmap(locmap)

getlocini()

setlocini(locini = 11)

getvfcols()
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="setdefaults_+3A_nv">nv</code></td>
<td>
<p>normative values to to set in the visualFields environment</p>
</td></tr>
<tr><td><code id="setdefaults_+3A_gpar">gpar</code></td>
<td>
<p>structure with all graphical parameters</p>
</td></tr>
<tr><td><code id="setdefaults_+3A_locmap">locmap</code></td>
<td>
<p>location map to to set in the visualFields environment</p>
</td></tr>
<tr><td><code id="setdefaults_+3A_locini">locini</code></td>
<td>
<p>column from where to start reading the visual field data</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li><p><code>setdefaults</code> sets the default location map, normative value and
graphical parameters visualFields environment
</p>
</li>
<li><p><code>setnv</code> sets normative values in the visualFields environment
</p>
</li>
<li><p><code>getnv</code> gets current normative values from the visualFields
environment
</p>
</li>
<li><p><code>setlocmap</code> sets a location map in the visualFields environment
</p>
</li>
<li><p><code>getlocmap</code> gets the current location map from the visualFields
environment
</p>
</li>
<li><p><code>setgpar</code> sets graphical parameters in the visualFields environment
</p>
</li>
<li><p><code>getgpar</code> gets current graphical parameters from the visualFields
environment
</p>
</li>
<li><p><code>setlocini</code> sets the column where visual field data start in the
visualFields environment
</p>
</li>
<li><p><code>getlocini</code> gets the column where visual field data starts from
the visualFields environment
</p>
</li>
<li><p><code>getlocini</code> gets the column where visual field data starts from
the visualFields environment
</p>
</li>
<li><p><code>getvfcols</code> gets all the columns with visual field data
</p>
</li></ul>



<h3>Value</h3>

<p><code>setdefaults</code>: No return value
</p>
<p><code>getnv</code>: Returns the normative value currently in used by visualFields
</p>
<p><code>setnv</code>: No return value
</p>
<p><code>getgpar</code>: Returns the graphical parameters currently in used by visualFields
</p>
<p><code>setgpar</code>: No return value
</p>
<p><code>getlocmap</code>: Returns the location map currently in used by visualFields
</p>
<p><code>setlocmap</code>: No return value
</p>
<p><code>getlocini</code>: Returns the column where visual field data starts
</p>
<p><code>setlocini</code>: No return value
</p>
<p><code>getvfcols</code>: Returns the columns with visual field data
</p>


<h3>Examples</h3>

<pre><code class='language-R'># get and set normative values
getnv()$info$name                # print name of set normative values
setnv(normvals$iowa_PC26_pw_cps) # set pointwise normative values
getnv()$info$name                # print name of set normative values
setdefaults()                    # return back to defaults
# get and set a location map
getlocmap()$name         # name of set normative values
setlocmap(locmaps$p30d2) # set the 30-2 location map
getlocmap()$name         # name of set normative values
setdefaults()            # return back to defaults
# get and set a graphical parameters
getgpar()$tess$xlim  # limits of x axis
setgpar(gpars$pPeri) # set graphical parameters for the Peripheral test
getgpar()$tess$xlim  # limits of x axis
setdefaults()        # return back to defaults
# get and set initial column for visual field data
getlocini()
getvfcols() # get columns with visual fields data
setlocini(15)
getvfcols() # get columns with visual fields data
setdefaults() # return back to defaults
</code></pre>

<hr>
<h2 id='vfaggregate'>Statistical analyses for visual fields data</h2><span id='topic+vfaggregate'></span><span id='topic+vfmean'></span><span id='topic+vfretestdist'></span>

<h3>Description</h3>


<ul>
<li><p><code>vfaggregate</code> computes summary statistics of visual field data
</p>
</li>
<li><p><code>vfmean</code> computes the mean statistics of visual field data. It is
a wrapper for vfaggregate but only to compute means
</p>
</li>
<li><p><code>vfretestdist</code> computes the conditional distribution from test-retest data
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>vfaggregate(vf, by = "date", fun = mean, ...)

vfmean(vf, by = "date", ...)

vfretestdist(vf, nbase = 1, nfollow = 1, alpha = 0.1, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vfaggregate_+3A_vf">vf</code></td>
<td>
<p>a table with visual fields data. Data is rounded, which leaves
sensitivity data unchanged, but it is necessary for the nature of the
algorithm if the data passed are TD or PD values or summary stats such as
averages. Beware of the locations in the blind spot, which very likely need
to be removed</p>
</td></tr>
<tr><td><code id="vfaggregate_+3A_by">by</code></td>
<td>
<p>aggregate by <code>date</code>, that is by id, eye, and date (default) or by
<code>eye</code>, that is by id and eye</p>
</td></tr>
<tr><td><code id="vfaggregate_+3A_fun">fun</code></td>
<td>
<p>a function to compute the summary statistics which can be applied to
all data subsets. The default is '<code>mean</code>'</p>
</td></tr>
<tr><td><code id="vfaggregate_+3A_...">...</code></td>
<td>
<p>arguments to be passed to or from methods. A useful one to try
is type of quantile calculation '<code>type</code>' use in <code><a href="stats.html#topic+quantile">quantile</a></code></p>
</td></tr>
<tr><td><code id="vfaggregate_+3A_nbase">nbase</code></td>
<td>
<p>number of visual fields to be used as baseline</p>
</td></tr>
<tr><td><code id="vfaggregate_+3A_nfollow">nfollow</code></td>
<td>
<p>number of visual fields to be used as follow up</p>
</td></tr>
<tr><td><code id="vfaggregate_+3A_alpha">alpha</code></td>
<td>
<p>significance level to derive the conditional retest intervals.
Default value is <code>0.1</code></p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li><p><code>vfaggregate</code> this is a restricted version of <code><a href="stats.html#topic+aggregate">aggregate</a></code>
that only allows to use part of the key hierarchically, and operates on all
data frames of the <code>VisualField</code> object. The restriction is that only
aggregates that are allowed are '<code>newkey = c("id", "eye")</code>' and
'<code>newkey = c("id", "eye", "date")</code>'. It returns the aggregated value for all
numeric columns grouped and ordered by the new key (id and eye, or id, eye,
and date). If the aggregate grouping is by <code>eye</code> and the function, then
the <code>date</code> returned is the average.
</p>
</li></ul>



<h3>Value</h3>

<p><code>vfaggregate</code> and <code>vfmean</code> return a vf data frame with aggregate values
</p>
<p><code>vfretestdist</code> returns a list with the following elements:
</p>

<ul>
<li><p><code>x</code> with all the test values (x-axis)
</p>
</li>
<li><p><code>y</code> the distribution of retest dB values conditional to each
test value in <code>x</code>. It is a list with as many entries as <code>x</code>
</p>
</li>
<li><p><code>n</code> number of retest values conditional to each value in <code>x</code>.
It is a list with as many entries as <code>x</code>
</p>
</li>
<li><p><code>ymed</code> median for each value in <code>x</code>. It is a list with as
many entries as <code>x</code>
</p>
</li>
<li><p><code>ylow</code> quantile value for significance <code>1 - alpha / 2</code>
for each value in <code>x</code>. It is a list with as many entries as <code>x</code>
</p>
</li>
<li><p><code>yup</code> quantile value for significance <code>alpha / 2</code>
for each value in <code>x</code>. It is a list with as many entries as <code>x</code>
</p>
</li></ul>

<p>Together <code>ylow</code> and <code>yup</code> represent the lower and upper limit of the
<code>(1 - alpha)%</code> confidence intervals at each value <code>x</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># aggregate by date
vfaggregate(vfpwgRetest24d2, by = "date")           # compute the mean
vfaggregate(vfpwgRetest24d2, by = "date", fun = sd) # compute standard deviation
# aggregate by eye
vfaggregate(vfpwgRetest24d2, by = "eye")           # compute the mean
vfaggregate(vfpwgRetest24d2, by = "eye", fun = sd) # compute standard deviation
# mean by date
vfmean(vfpwgRetest24d2, by = "date")
# mean by eye
vfmean(vfpwgRetest24d2, by = "eye")
# get the retest sensitivity data after removing the blind spot
retest &lt;- vfretestdist(vfpwgRetest24d2, nbase = 1, nfollow = 1)

plot(0, 0, typ = "n", xlim = c(0, 40), ylim = c(0,40),
     xlab = "test in dB", ylab = "retest in dB", asp = 1)
for(i in 1:length(retest$x)) {
  points(rep(retest$x[i], length(retest$y[[i]])), retest$y[[i]],
         pch = 20, col = "lightgray", cex = 0.75)
}
lines(c(0,40), c(0,40), col = "black")
lines(retest$x, retest$ymed, col = "red")
lines(retest$x, retest$ylow, col = "red", lty = 2)
lines(retest$x, retest$yup, col = "red", lty = 2)
</code></pre>

<hr>
<h2 id='vfctrIowaPC26'>Central visual field</h2><span id='topic+vfctrIowaPC26'></span>

<h3>Description</h3>

<p>Locations of the visual field tested have eccentricities up to 26
degrees and were obtained with a custom static automated perimetry.
Data are from 98 eyes of 98 ocular healthy subjects. Each subject underwent two
visual field tests, one of the central visual field (64 locations within 26 degrees
of fixation) and one of the peripheral visual field (64 locations with eccentricity
from 26 to up to 81 degrees)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vfctrIowaPC26
</code></pre>


<h3>Format</h3>

<p>See section <code>Structure of visual fields data</code> in <code><a href="#topic+vfdesc">vfdesc</a></code>
</p>


<h3>Details</h3>

<p>Data are for locations within the central 26 degrees. The data for locations
with eccentricity from 26 to up to 81 degrees are in <code><a href="#topic+vfctrIowaPeri">vfctrIowaPeri</a></code>.
This dataset of healthy eyes was used to generate the normative values
<code>iowa_PC26_pw</code>, and <code>iowa_PC26_pw_cps</code> included in <code><a href="#topic+normvals">normvals</a></code>.
</p>


<h3>References</h3>

<p>I. Marin-Franch, P. H. Artes, L. X. Chong, A. Turpin, and M. Wall.
<em>Data obtained with an open-source static automated perimetry test
of the full visual field in healthy adults</em>. Data in Brief, 21:75–82, 2018.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+vfpwgSunyiu24d2">vfpwgSunyiu24d2</a></code>, <code><a href="#topic+vfctrIowaPeri">vfctrIowaPeri</a></code>,
<code><a href="#topic+vfctrSunyiu10d2">vfctrSunyiu10d2</a></code>, <code><a href="#topic+vfctrSunyiu24d2">vfctrSunyiu24d2</a></code>,
<code><a href="#topic+vfpwgRetest24d2">vfpwgRetest24d2</a></code>
</p>

<hr>
<h2 id='vfctrIowaPeri'>Peripheral visual field</h2><span id='topic+vfctrIowaPeri'></span>

<h3>Description</h3>

<p>Locations of the visual field tested have eccentricities from 26
to up to 81 degrees and were obtained with a custom static automated perimetry.
Data are from 98 eyes of 98 ocular healthy subjects. Each subject underwent two
visual field tests, one of the central visual field (64 locations within 26 degrees
of fixation) and one of the peripheral visual field (64 locations with eccentricity
from 26 to up to 81 degrees)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vfctrIowaPeri
</code></pre>


<h3>Format</h3>

<p>See section <code>Structure of visual fields data</code> in <code><a href="#topic+vfdesc">vfdesc</a></code>
</p>


<h3>Details</h3>

<p>Data are for locations with eccentricity from 26 to up to 81 degrees.
The dataset for locations within the central 26 degrees are in <code><a href="#topic+vfctrIowaPC26">vfctrIowaPC26</a></code>.
This dataset of healthy eyes was used to generate the normative values
<code>iowa_Peri_pw</code>, and <code>iowa_Peri_pw_cps</code> included in <code><a href="#topic+normvals">normvals</a></code>.
</p>


<h3>References</h3>

<p>I. Marin-Franch, P. H. Artes, L. X. Chong, A. Turpin, and M. Wall.
<em>Data obtained with an open-source static automated perimetry test
of the full visual field in healthy adults</em>. Data in Brief, 21:75–82, 2018.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+vfpwgSunyiu24d2">vfpwgSunyiu24d2</a></code>, <code><a href="#topic+vfctrIowaPC26">vfctrIowaPC26</a></code>,
<code><a href="#topic+vfctrSunyiu10d2">vfctrSunyiu10d2</a></code>, <code><a href="#topic+vfctrSunyiu24d2">vfctrSunyiu24d2</a></code>,
<code><a href="#topic+vfpwgRetest24d2">vfpwgRetest24d2</a></code>
</p>

<hr>
<h2 id='vfctrSunyiu10d2'>SUNY-IU dataset of healthy eyes for 10-2 static automated perimetry</h2><span id='topic+vfctrSunyiu10d2'></span>

<h3>Description</h3>

<p>SUNY-IU dataset of healthy eyes for 10-2 static automated perimetry.
Courtesy of William H Swanson.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vfctrSunyiu10d2
</code></pre>


<h3>Format</h3>

<p>See section <code>Structure of visual fields data</code> in <code><a href="#topic+vfdesc">vfdesc</a></code>
</p>


<h3>References</h3>

<p>H. J. Wyatt, M. W. Dul, and W. H. Swanson. <em>Variability of visual
field measurements is correlated with the gradient of visual
sensitivity</em>. Vision Research, 47, 2007.
</p>
<p>A. Shafi, W. H. Swanson, and M. W. Dul. <em>Structure and Function
in Patients with Glaucomatous Defects Near Fixation</em>. Optometry and
Vision Science, 88, 2011.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+vfpwgSunyiu24d2">vfpwgSunyiu24d2</a></code>, <code><a href="#topic+vfctrIowaPC26">vfctrIowaPC26</a></code>,
<code><a href="#topic+vfctrIowaPeri">vfctrIowaPeri</a></code>, <code><a href="#topic+vfctrSunyiu24d2">vfctrSunyiu24d2</a></code>,
<code><a href="#topic+vfpwgRetest24d2">vfpwgRetest24d2</a></code>
</p>

<hr>
<h2 id='vfctrSunyiu24d2'>SUNY-IU dataset of healthy eyes for 24-2 static automated perimetry</h2><span id='topic+vfctrSunyiu24d2'></span>

<h3>Description</h3>

<p>This dataset of healthy eyes was used to generate the normative values
<code>sunyiu_24d2</code>, <code>sunyiu_24d2_pw</code>, <code>sunyiu_24d2</code>, and
<code>sunyiu_24d2_pw_cps</code> included in <code><a href="#topic+normvals">normvals</a></code>.
Courtesy of William H Swanson and Mitch W Dul
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vfctrSunyiu24d2
</code></pre>


<h3>Format</h3>

<p>See section <code>Structure of visual fields data</code> in <code><a href="#topic+vfdesc">vfdesc</a></code>
</p>


<h3>References</h3>

<p>H. J. Wyatt, M. W. Dul, and W. H. Swanson. <em>Variability of visual
field measurements is correlated with the gradient of visual
sensitivity</em>. Vision Research, 47, 2007.
</p>
<p>A. Shafi, W. H. Swanson, and M. W. Dul. <em>Structure and Function
in Patients with Glaucomatous Defects Near Fixation</em>. Optometry and
Vision Science, 88, 2011.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+vfpwgSunyiu24d2">vfpwgSunyiu24d2</a></code>, <code><a href="#topic+vfctrIowaPC26">vfctrIowaPC26</a></code>,
<code><a href="#topic+vfctrIowaPeri">vfctrIowaPeri</a></code>, <code><a href="#topic+vfctrSunyiu10d2">vfctrSunyiu10d2</a></code>,
<code><a href="#topic+vfpwgRetest24d2">vfpwgRetest24d2</a></code>
</p>

<hr>
<h2 id='vfdesc'>Visual field dataset</h2><span id='topic+vfdesc'></span><span id='topic+vfsort'></span><span id='topic+vfisvalid'></span><span id='topic+vfread'></span><span id='topic+vfwrite'></span><span id='topic+vfjoin'></span><span id='topic+vffilter'></span><span id='topic+vfselect'></span><span id='topic+gettd'></span><span id='topic+gettdp'></span><span id='topic+getpd'></span><span id='topic+getpdp'></span><span id='topic+getgh'></span><span id='topic+getgl'></span><span id='topic+getglp'></span>

<h3>Description</h3>

<p>The main object of the visualFields package is a table with 
a specific format and fields that are mandatory for their management and
processing (mainly statistical analysis). Each record (row) in the table
contains data for a single visual field test. The mandatory fields specify
subject (by its ID code), eye, and test date and time. There are required
fields statistical and reliability analyses (e.g., age for the determination
of total-deviation and pattern-deviation values, and for global indices and
fpr, fnr, fl for the proportion of false positives, false negative, and
fixation losses). The rest of mandatory fields are sensitivity or deviation
data for each visual field test location. (The number of fields for
tested locations varies with the location map, 54 for the 24-2, 76 for the
30-2, 68 for the 10-2, etc.). Check section <code>Structure of visual fields data</code>
below for details about the required  structure of the table contatining the
visual fields datasets.
</p>
<p>The following functions carry out analysis on visual fields data:
</p>

<ul>
<li><p><code>vfdesc</code> descriptive summary of a visual field dataset
</p>
</li>
<li><p><code>vfsort</code> sort visual field data
</p>
</li>
<li><p><code>vfisvalid</code> check if a table with visual field data is properly
formatted and valid for analysis
</p>
</li>
<li><p><code>vfread</code> read a csv file with visual field data
</p>
</li>
<li><p><code>vfwrite</code> write a csv file with visual field data
</p>
</li>
<li><p><code>vfjoin</code> joins two visual field datasets
</p>
</li>
<li><p><code>vffilter</code> filters elements from a visual field dataset with
matching conditions. This function is just a wrapper for <code>dplyr</code>'s
function <code><a href="stats.html#topic+filter">filter</a></code>
</p>
</li>
<li><p><code>vfselect</code> select visual field data by index or the first or last
<code>n</code> visits per subject and eye
</p>
</li>
<li><p><code>gettd</code> computes total-deviation (TD) values and probability values
</p>
</li>
<li><p><code>gettdp</code> computes total-deviation (TD) probability values
</p>
</li>
<li><p><code>getpd</code> computes pattern-deviation (PD) values
</p>
</li>
<li><p><code>getpdp</code> computes pattern-deviation (PD) probability values
</p>
</li>
<li><p><code>getgh</code> computes the general height (GH) from the TD tables
</p>
</li>
<li><p><code>getgl</code> computes visual fields global indices
</p>
</li>
<li><p><code>getglp</code> computes computes visual fields global indices probability values
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>vfdesc(vf)

vfsort(vf, decreasing = FALSE)

vfisvalid(vf)

vfread(file, dateformat = "%Y-%m-%d", eyecodes = c("OD", "OS", "OU"), ...)

vfwrite(
  vf,
  file,
  dateformat = "%Y-%m-%d",
  eyecodes = c("OD", "OS", "OU"),
  ...
)

vfjoin(vf1, vf2)

vffilter(vf, ...)

vfselect(vf, sel = "last", n = 1)

gettd(vf)

gettdp(td)

getpd(td)

getpdp(pd)

getgh(td)

getgl(vf)

getglp(g)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vfdesc_+3A_vf">vf</code></td>
<td>
<p>visual field data</p>
</td></tr>
<tr><td><code id="vfdesc_+3A_decreasing">decreasing</code></td>
<td>
<p>sort decreasing or increasing?
Default is increasing, that is <code>decreasing = FALSE</code></p>
</td></tr>
<tr><td><code id="vfdesc_+3A_file">file</code></td>
<td>
<p>the name of the csv file where to write the data</p>
</td></tr>
<tr><td><code id="vfdesc_+3A_dateformat">dateformat</code></td>
<td>
<p>format to be used for date. Its default value
is <code>%Y-%m-%d</code></p>
</td></tr>
<tr><td><code id="vfdesc_+3A_eyecodes">eyecodes</code></td>
<td>
<p>codification for right and left eye, respectively.
By default in visualField uses '<code>OD</code>' and '<code>OS</code>' for
right and left eye respectively, but it is common to receive csv
files with the codes '<code>R</code>' and '<code>L</code>'. The code '<code>OU</code>'
for both eyes is also allowed
<code>eyecodes</code> should be equal to '<code>c("OD", "OS")</code>' or '<code>c("R", "L")</code>'.
By default it is '<code>eyecodes = c("OD", "OS", "OU")</code>'</p>
</td></tr>
<tr><td><code id="vfdesc_+3A_...">...</code></td>
<td>
<p>arguments to be passed to or from methods</p>
</td></tr>
<tr><td><code id="vfdesc_+3A_vf1">vf1</code>, <code id="vfdesc_+3A_vf2">vf2</code></td>
<td>
<p>the two visual field data objects to join or merge</p>
</td></tr>
<tr><td><code id="vfdesc_+3A_sel">sel</code></td>
<td>
<p>it can be two things, an array of indices to select from visual field data
or a string with the values '<code>first</code>' or '<code>last</code>' indicating that only the
first  few n visits per subject '<code>id</code>' and '<code>eye</code>' are to be  selected.
Default is '<code>last</code>'.</p>
</td></tr>
<tr><td><code id="vfdesc_+3A_n">n</code></td>
<td>
<p>number of visits to select. Default value is 1, but it is ignored if
<code>sel</code> is an index array</p>
</td></tr>
<tr><td><code id="vfdesc_+3A_td">td</code></td>
<td>
<p>total-deviation (TD) values</p>
</td></tr>
<tr><td><code id="vfdesc_+3A_pd">pd</code></td>
<td>
<p>pattern-deviation (PD) values</p>
</td></tr>
<tr><td><code id="vfdesc_+3A_g">g</code></td>
<td>
<p>global indices</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li><p><code>vfselect</code> when selecting the last or first few visual fields per
subject and eye, if that subject and eye has fewer than <code>n</code> visits,
then all visits are returned
</p>
</li></ul>



<h3>Value</h3>

<p><code>vfdesc</code> returns descriptive statistics of a visual field dataset
</p>
<p><code>vfsort</code> returns a sorted visual field dataset
</p>
<p><code>vfisvalid</code> returns <code>TRUE</code> or <code>FALSE</code>
</p>
<p><code>vfread</code> returns a visual field dataset
</p>
<p><code>vfwrite</code> No return value
</p>
<p><code>vfjoin</code> returns a visual field dataset
</p>
<p><code>vffilter</code> returns a visual field dataset
</p>
<p><code>vfselect</code> returns a visual field dataset
</p>
<p><code>gettd</code> returns a visual field dataset with total deviation values
</p>
<p><code>gettdp</code> returns a visual field dataset with total deviation probability values
</p>
<p><code>getpd</code> returns a visual field dataset with pattern deviation values
</p>
<p><code>getpdp</code> returns a visual field dataset with pattern deviation probability values
</p>
<p><code>getgh</code> returns the general height of visual fields tests
</p>
<p><code>getgl</code> returns visual fields global indices
</p>
<p><code>getglp</code> returns probability values of visual fields global indices
</p>


<h3>Structure of visual fields data</h3>

<p>Visual fields data is the central object used in visualFields. It is a table of
visual field data collected with the same perimeter, background and stimulus
paradigm (e.g., static automated perimetry or frequency-doubling  perimetry),
stimulus size (e.g., Goldmann size III), grid of visual field test locations
(e.g., 24-2), and psychophysical testing strategy (e.g., SITA standard).
Normative values can be obtained from appropriate datasets with data for healthy
eyes and these normative values can then be used to generate statistical analyses
and visualizations of data for patients with retinal or visual anomalies.
</p>
<p>Each record correspond to a specific test for an eye of a subject taken on a
specific date at a specific time. Visual field data must have the following
columns
</p>

<ul>
<li><p><code>id</code> an id uniquely identifying a subject. This field is mandatory
</p>
</li>
<li><p><code>eye</code> should be &quot;OD&quot; for right eye or &quot;OS&quot; for left eye. This field is
mandatory
</p>
</li>
<li><p><code>date</code> test date. This field is mandatory
</p>
</li>
<li><p><code>time</code> test time. This field is mandatory
</p>
</li>
<li><p><code>age</code> age of the patient on the test date. This field is required to
obtain total-deviation, pattern-deviation values, and other age-dependent
local and global indices
</p>
</li>
<li><p><code>type</code> type of subject, Could be a healthy subject (ctr for control)
or a patient with glaucoma (pwg) or a patient with idiopatic intraocular
hypertension (iih) or other. This field is no required for management or
statistical analysis.
</p>
</li>
<li><p><code>fpr</code> false positive rate. This field is no required for management or
statistical analysis.
</p>
</li>
<li><p><code>fnr</code> false negative rate. This field is no required for management or
statistical analysis.
</p>
</li>
<li><p><code>fl</code> fixation losses. This field is no required for management or
statistical analysis.
</p>
</li>
<li><p><code>l1..ln</code> sensitivity, total-deviation, or pattern-deviation values for
each location. For analysis with visualFields there should be as many columns
as coordinates in the location map set in the visualFields environment. These
fields are mandatory.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># get dataset description from visual field table
vfdesc(vfctrSunyiu24d2)
# sort dataset
vfsort(vfctrSunyiu24d2[c(5, 4, 10, 50, 30),])
# check if a visualField is valid
vf &lt;- vfctrSunyiu24d2
vfisvalid(vf) # valid visual field data
vf$id[5] &lt;- NA
vfisvalid(vf) # invalid visual field data
# write and read visual field data
vf &lt;- vfctrSunyiu24d2
tf &lt;- tempfile("vf")
vfwrite(vf, file = tf) # save current locmap in a temp file
head(vfread(tf)) # read the temp file
# join visual fields datasets
vfjoin(vfctrSunyiu24d2, vfpwgRetest24d2)
# visual field subselection
vffilter(vf, id == 1) # fields corresponding to a single subject
vffilter(vf, id == 1 &amp; eye == "OD") # fields for a single subject's right eye
unique(vffilter(vf, eye == "OS")$eye) # only left eyes
vffilter(vfjoin(vfctrSunyiu24d2, vfpwgRetest24d2), type == "ctr") # get only controls
vffilter(vfjoin(vfctrSunyiu24d2, vfpwgRetest24d2), type == "pwg") # get only patients
# select visual fields by index
vfselect(vfctrSunyiu24d2, sel = c(1:4, 150))
# select last few visual fields per subject and eye
vfselect(vfpwgRetest24d2, sel = "last")
# select first few visual fields per subject and eye
vfselect(vfpwgRetest24d2, sel = "first")
vfselect(vfpwgRetest24d2, sel = "first", n = 5) # get the last 5 visits
# compute visual field statistics
vf  &lt;- vfpwgSunyiu24d2
td  &lt;- gettd(vf)  # get TD values
tdp &lt;- gettdp(td) # get TD probability values
pd  &lt;- getpd(td)  # get PD values
pdp &lt;- getpdp(pd) # get PD probability values
gh  &lt;- getgh(td)  # get the general height
g   &lt;- getgl(vf)  # get global indices
gp  &lt;- getglp(g)  # get global indices probability values
</code></pre>

<hr>
<h2 id='vfgpar'>Plots for visual fields data</h2><span id='topic+vfgpar'></span><span id='topic+vftess'></span><span id='topic+vfcolscheme'></span><span id='topic+vfprogcolscheme'></span><span id='topic+vfplot'></span><span id='topic+vfplotsens'></span><span id='topic+vfplotdev'></span><span id='topic+vfplotsdev'></span><span id='topic+vfplotplr'></span><span id='topic+vflegoplot'></span><span id='topic+vflegoplotsens'></span><span id='topic+vflegoplotdev'></span><span id='topic+vfsparklines'></span>

<h3>Description</h3>

<p>Graphical tools for visualization and statistical analysis of
visual fields.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vfgpar(
  coord,
  tess = vftess(coord),
  probs = c(0, 0.005, 0.01, 0.02, 0.05, 0.95, 0.98, 0.99, 0.995, 1),
  cols = c("#000000", colorRampPalette(c("#FF0000", "#FFFF00"))(4), "#F7F0EB",
    colorRampPalette(c("#00FF00", "#008000"))(4)),
  floor = 0,
  ltprobs = c(0, 0.005, 0.01, 0.02, 0.05, 0.95, 1),
  ltcols = c("#000000", colorRampPalette(c("#FF0000", "#FFFF00"))(4), "#F7F0EB",
    "#008000"),
  gtprobs = c(0, 0.05, 0.95, 0.98, 0.99, 0.995, 1),
  gtcols = c("#000000", "#FF0000", "#F7F0EB", colorRampPalette(c("#00FF00",
    "#008000"))(4)),
  neprobs = c(0, 0.0025, 0.005, 0.01, 0.25, 0.975, 0.99, 0.995, 0.9975, 1),
  necols = c("#000000", colorRampPalette(c("#FF0000", "#FFFF00"))(4), "#F7F0EB",
    colorRampPalette(c("#FFFF00", "#FF0000"))(4)),
  bprobs = c(0, 0.005, 0.01, 0.02, 0.05, 0.95, 0.98, 0.99, 0.995, 1),
  bcols = c("#000000", colorRampPalette(c("#FF0000", "#FFFF00"))(4), "#F7F0EB",
    colorRampPalette(c("#00FF00", "#008000"))(4))
)

vftess(coord, floor = 0, delta = 3)

vfcolscheme(
  probs = c(0, 0.005, 0.01, 0.02, 0.05, 0.95, 0.98, 0.99, 0.995, 1),
  cols = c("#000000", colorRampPalette(c("#FF0000", "#FFFF00"))(4), "#F7F0EB",
    colorRampPalette(c("#00FF00", "#008000"))(4)),
  floor = 0
)

vfprogcolscheme(
  probs = c(0, 0.005, 0.01, 0.02, 0.05, 0.95, 1),
  cols = c("#000000", colorRampPalette(c("#FF0000", "#FFFF00"))(4), "#F7F0EB",
    "#008000")
)

vfplot(vf, type = "td", ...)

vfplotsens(gpar, vf, maxval, digits = 0, ...)

vfplotdev(gpar, vf, dev, devp, digits = 0, ...)

vfplotsdev(gpar, vf, maxval, dev, devp, digits = 0, ...)

vfplotplr(
  vf,
  type = "td",
  alternative = "LT",
  xoffs = 0,
  yoffs = 0,
  addSpark = FALSE,
  thr = 2,
  width = 4,
  height = 2,
  ...
)

vflegoplot(vf, type = "td", grp = 3, ...)

vflegoplotsens(gpar, vfb, vfl, maxb, maxl, crad = 2, digits = 1, ...)

vflegoplotdev(
  gpar,
  vfb,
  devb,
  devpb,
  vfl,
  devl,
  devpl,
  crad = 2,
  digits = 1,
  ...
)

vfsparklines(vf, type = "td", thr = 2, width = 4, height = 2, add = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vfgpar_+3A_coord">coord</code></td>
<td>
<p>print x and y coordinates. Check section
<code>Structure of graphical parameters</code> for details</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_tess">tess</code></td>
<td>
<p>tesselation for the visual field maps. Check section
<code>Tesselation in visualFields</code> for details</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_probs">probs</code></td>
<td>
<p>probability scale to use for TD and PD values. It is a numeric vector
of probabilities with values in [0,1]. The values 0 and 1 must be included.
Although not technically necessary, it would be best if it is the same as for
the normative values used</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_cols">cols</code></td>
<td>
<p>corresponding colors for each of the probability levels</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_floor">floor</code></td>
<td>
<p>Flooring value, typically in dB. Default is 0</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_ltprobs">ltprobs</code>, <code id="vfgpar_+3A_ltcols">ltcols</code></td>
<td>
<p>color map for progression with the alternative hypothesis
lower than (LT)</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_gtprobs">gtprobs</code>, <code id="vfgpar_+3A_gtcols">gtcols</code></td>
<td>
<p>color map for progression with the alternative hypothesis
lower than (GT)</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_neprobs">neprobs</code>, <code id="vfgpar_+3A_necols">necols</code></td>
<td>
<p>color map for progression with the alternative hypothesis
not equal (NE)</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_bprobs">bprobs</code>, <code id="vfgpar_+3A_bcols">bcols</code></td>
<td>
<p>color map for progression with blth alternative
hypotheses LT and GT (B for both)</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_delta">delta</code></td>
<td>
<p>Distance over which the boundary should be shifted. See for <code><a href="polyclip.html#topic+polyclip">polyclip</a></code></p>
</td></tr>
<tr><td><code id="vfgpar_+3A_vf">vf</code></td>
<td>
<p>the visual fields data to plot</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_type">type</code></td>
<td>
<p>the type of data to plot: sensitivities ('<code>s</code>'),
total deviation values ('<code>td</code>'), pattern deviation values ('<code>pd</code>'),
a hybrid plot that shows sensitivity grayscale with TD values and corresponding
probability levels ('<code>tds</code>'), or PD values and corresponding probability
levels ('<code>pds</code>'). Default is '<code>td</code>'.</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_...">...</code></td>
<td>
<p>other graphical arguments. See <code><a href="graphics.html#topic+plot">plot</a></code></p>
</td></tr>
<tr><td><code id="vfgpar_+3A_gpar">gpar</code></td>
<td>
<p>graphical parameters</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_maxval">maxval</code></td>
<td>
<p>maximum value, typically in dB, for the generation of a grayscale</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_digits">digits</code></td>
<td>
<p>digits to round values to plot. Default is 0</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_dev">dev</code></td>
<td>
<p>deviation (TD or PD) values</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_devp">devp</code></td>
<td>
<p>deviation (TD or PD) probability values</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_alternative">alternative</code></td>
<td>
<p>alternative hypothesis used in progression analyses.
Allowed values are '<code>LT</code>' (as in &quot;lower than&quot;, default),
'<code>GT</code>' (as in &quot;greater than&quot;), '<code>NE</code>' (as in &quot;not equal&quot;),
and '<code>both</code>' (both '<code>LT</code>' and '<code>GT</code>')</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_xoffs">xoffs</code>, <code id="vfgpar_+3A_yoffs">yoffs</code></td>
<td>
<p>offset x and y where to print the slope values. That is,
the distance from the center of each Voronoy polygons in degrees of visual angle</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_addspark">addSpark</code></td>
<td>
<p>whether to overlay a sparkline graph in each visual field location.
The parameters <code>thr</code>, <code>width</code>, and <code>height</code> are used only if
<code>addSpark</code> is <code>TRUE</code>. Default value is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_thr">thr</code></td>
<td>
<p>threshold used for the median absolute deviation of residuals
from simple linear regression. If greater than the threshold, the
sparkline for that location is plotted in red and with a thicker line.
Default is '<code>2</code>' (dB)</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_width">width</code></td>
<td>
<p>the width of each pointwise sparkline plot. Default is
'<code>4</code>' (degrees of visual angle)</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_height">height</code></td>
<td>
<p>the height of each pointwise sparkline plot. Default is
'<code>2</code>' (degrees of visual angle)</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_grp">grp</code></td>
<td>
<p>number of baseline (first) and last visual fields to group.
Default is '<code>3</code>'</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_vfb">vfb</code></td>
<td>
<p>baseline visual field data</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_vfl">vfl</code></td>
<td>
<p>last visual field data</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_maxb">maxb</code></td>
<td>
<p>maximum value for the grayscale at baseline visual field data</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_maxl">maxl</code></td>
<td>
<p>maximum value for the grayscale for last visual field data</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_crad">crad</code></td>
<td>
<p>radius of the circle in the legoplot</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_devb">devb</code></td>
<td>
<p>baseline visual field (TD or PD) deviation values</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_devpb">devpb</code></td>
<td>
<p>baseline visual field (TD or PD) deviation probability values</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_devl">devl</code></td>
<td>
<p>last visual field (TD or PD) deviation values</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_devpl">devpl</code></td>
<td>
<p>last visual field (TD or PD) deviation probability values</p>
</td></tr>
<tr><td><code id="vfgpar_+3A_add">add</code></td>
<td>
<p>whether to generate a new plot ('<code>FALSE</code>', as default)
or to add to an existing figure ('<code>TRUE</code>')</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The following functions generate plots using visual fields data
</p>

<ul>
<li><p><code>vfgpar</code> generates simple graphical parameters
</p>
</li>
<li><p><code>vftess</code> generates a structure to handle the visual field tessellation.
Check section <code>Tesselation in visualFields</code> below for further details
</p>
</li>
<li><p><code>vfcolscheme</code> generates the structures to handle the color scheme
Check section <code>Color schemes in visualFields</code> below for further details
</p>
</li>
<li><p><code>vfprogcolscheme</code> generates the structures to handle the color scheme
for progression analysis. Check section <code>Color schemes in visualFields</code>
below for further details
</p>
</li>
<li><p><code>vfplot</code> plots a single test for visual field data
</p>
</li>
<li><p><code>vfplotsens</code> plots a single test for visual field sensitivity data
with a grayscale where darker means greater sensitivity loss
</p>
</li>
<li><p><code>vfplotdev</code> plots a single test for visual field total or pattern
deviation data with probability scales represented in color
</p>
</li>
<li><p><code>vfplotplr</code> plots the results of pointwise linear regression for
a series of visual fields for an eye from a subject
</p>
</li>
<li><p><code>vflegoplot</code> the legoplot shows the differences between the average
values of visual field tests taken as baseline and those at the end of
follow up
</p>
</li>
<li><p><code>vflegoplotsens</code> the legoplot for visual field sensitivity data with
a grayscale where darker means greater sensitivity loss
</p>
</li>
<li><p><code>vflegoplotdev</code> the legoplot for visual field total or pattern
deviation data with probability scales represented in color
</p>
</li>
<li><p><code>vfsparklines</code> the sparklines graph shows spark lines for the series
of visual field sensitivities, or total or pattern deviation data for each
location
</p>
</li></ul>



<h3>Value</h3>

<p><code>vfgpar</code> returns a list with graphical parameters to be used for vfplots
</p>
<p><code>vftess</code> returns a list with the <code>xlim</code>, <code>ylim</code>, tessellation tiles and an outer hull
to be used for vfplots
</p>
<p><code>vfcolscheme</code> returns a list with a lookup table and a function that define the color scheme
to be used for vfplots
</p>
<p><code>vfprogcolscheme</code> returns the default <code>vfcolscheme</code> to be used for vfplots
</p>
<p><code>vfplot</code> No return value
</p>
<p><code>vfplotsens</code> No return value
</p>
<p><code>vfplotdev</code> No return value
</p>
<p><code>vfplotsdev</code> No return value
</p>
<p><code>vfplotplr</code> No return value
</p>
<p><code>vflegoplot</code> No return value
</p>
<p><code>vflegoplotsens</code> No return value
</p>
<p><code>vflegoplotdev</code> No return value
</p>
<p><code>vfsparklines</code> No return value
</p>


<h3>Structure of graphical parameters</h3>

<p>Graphical parameters for visualFields must be a list containing
</p>

<ul>
<li><p><code>coord</code> print x and y coordinates. They could be different from the
the real visual field location testing coordinates in complex visual field
grids to help readability and improve visualization of statistical results
</p>
</li>
<li><p><code>tess</code> tesselation for the visual field maps. Check section
<code>Tesselation in visualFields</code>
</p>
</li>
<li><p><code>colmap</code> color map representing the probability scale. Check section
<code>Color schemes in visualFields</code>
</p>
</li></ul>

<p>A default graphical parameters can be generated with <code>generategpar</code>
</p>


<h3>Tesselation in visualFields</h3>

<p>A tesselation in visualFields must be defined with a list containing
</p>

<ul>
<li><p><code>xlim</code>, </p>
</li>
<li><p><code>ylim</code> 2-dimensional vectors containing the minimum
and maximum x and y values
</p>
</li>
<li><p><code>floor</code> the value to be assinged to any sensitivity value lower than
<code>floor</code>
</p>
</li>
<li><p><code>tiles</code> a list of as many tiles defining the tesselation as visual field
test locations. Each element of the list is a table with x and y coordinates defining
a polygon containing the corresponding test location. Each polygon is thus the tile
for each visual field test location
</p>
</li>
<li><p><code>hull</code> a table with x and y coordinates defining the outer hull of the
tessellation
</p>
</li></ul>

<p>A default tessellation can be generated with <code>vftess</code>
</p>


<h3>Color schemes in visualFields</h3>

<p>A color scheme in visualFields must be defined with a list containing
</p>

<ul>
<li><p><code>map</code> a table mapping probabilities levels with colors defined
in hexadecimal base
</p>
</li>
<li><p><code>fun</code> a function that takes sensitivity values and deviation
probability levels and returns the corresponding color code.
</p>
</li></ul>

<p>A default color scheme can be generated with <code>vfcolscheme</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># generate a structure with default graphical parameters for the 30-2 map
vfgpar(locmaps$p30d2$coord)
# generate a structure with default tesselation for the 30-2 map
vftess(locmaps$p30d2$coord)
# default color scheme
vfcolscheme()
# default color scheme for progression
vfprogcolscheme()
# plot visual field values for the last field in the series for the first
# subject in the dataset vfpwgSunyiu24d2
# grayscale with sensitivity values
vfplot(vfselect(vffilter(vfpwgRetest24d2, id == 1), n = 1), type = "s")
# TD values
vfplot(vfselect(vffilter(vfpwgRetest24d2, id == 1), n = 1), type = "td")
# PD values
vfplot(vfselect(vffilter(vfpwgRetest24d2, id == 1), n = 1), type = "pd")
# hybrid sensitivities and TD values
vfplot(vfselect(vffilter(vfpwgRetest24d2, id == 1), n = 1), type = "tds")
# hybrid sensitivities and PD values
vfplot(vfselect(vffilter(vfpwgRetest24d2, id == 1), n = 1), type = "pds")
# plot results from pointwise linear regression for the series of
# visual fields for the right eye in the dataset vfpwgSunyiu24d2
# with sensitivity values
vfplotplr(vffilter(vfpwgSunyiu24d2, eye == "OD"), type = "s")
# TD values
vfplotplr(vffilter(vfpwgSunyiu24d2, eye == "OD"), type = "td")
# PD values
vfplotplr(vffilter(vfpwgSunyiu24d2, eye == "OD"), type = "pd")
# legoplot for the series of visual fields for the right eye
# of the subject in the dataset vfpwgSunyiu24d2
# with sensitivity values
vflegoplot(vffilter(vfpwgSunyiu24d2, eye == "OD"), type = "s")
# TD values
vflegoplot(vffilter(vfpwgSunyiu24d2, eye == "OD"), type = "td")
# PD values
vflegoplot(vffilter(vfpwgSunyiu24d2, eye == "OD"), type = "pd")
# sparklines for the series of visual fields for the right eye of
# the subject in the dataset vfpwgSunyiu24d2
# with sensitivity values
vfsparklines(vffilter(vfpwgSunyiu24d2, eye == "OD"), type = "s")
# TD values
vfsparklines(vffilter(vfpwgSunyiu24d2, eye == "OD"), type = "td")
# PD values
vfsparklines(vffilter(vfpwgSunyiu24d2, eye == "OD"), type = "pd")
</code></pre>

<hr>
<h2 id='vfpwgRetest24d2'>Short-term retest static automated perimetry data</h2><span id='topic+vfpwgRetest24d2'></span>

<h3>Description</h3>

<p>Thirty patients recruited from the glaucoma clinics at the
Queen Elizabeth Health Sciences Centre in Halifax, Nova Scotia. Each
patient underwent 12 visual fields in 12 consecutive weekly sessions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vfpwgRetest24d2
</code></pre>


<h3>Format</h3>

<p>See section <code>Structure of visual fields data</code> in <code><a href="#topic+vfdesc">vfdesc</a></code>
</p>


<h3>References</h3>

<p>P. H. Artes, N. O'Leary, M. T. Nicolela, B. C. Chauhan, and D. P. Crabb.
<em>Visual field progression in glaucoma: What is the specificity of the
guided progression analysis?</em> American Academy of Ophthalmology,
121(10):2023-2027, 2014.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+vfpwgSunyiu24d2">vfpwgSunyiu24d2</a></code>, <code><a href="#topic+vfctrIowaPC26">vfctrIowaPC26</a></code>,
<code><a href="#topic+vfctrIowaPeri">vfctrIowaPeri</a></code>, <code><a href="#topic+vfctrSunyiu10d2">vfctrSunyiu10d2</a></code>,
<code><a href="#topic+vfctrSunyiu24d2">vfctrSunyiu24d2</a></code>
</p>

<hr>
<h2 id='vfpwgSunyiu24d2'>Series of 24-2 static automated perimetry data for a patient with glaucoma</h2><span id='topic+vfpwgSunyiu24d2'></span>

<h3>Description</h3>

<p>This is real data for the right and left eyes, but the age has been changed
to protect anonymity of the subject. Courtesy of William H Swanson and Mitch W Dul
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vfpwgSunyiu24d2
</code></pre>


<h3>Format</h3>

<p>See section <code>Structure of visual fields data</code> in <code><a href="#topic+vfdesc">vfdesc</a></code>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+vfctrIowaPC26">vfctrIowaPC26</a></code>, <code><a href="#topic+vfctrIowaPeri">vfctrIowaPeri</a></code>,
<code><a href="#topic+vfctrSunyiu10d2">vfctrSunyiu10d2</a></code>, <code><a href="#topic+vfctrSunyiu24d2">vfctrSunyiu24d2</a></code>,
<code><a href="#topic+vfpwgRetest24d2">vfpwgRetest24d2</a></code>
</p>

<hr>
<h2 id='vfsfa'>Single Field Reporting</h2><span id='topic+vfsfa'></span><span id='topic+vfsfashiny'></span>

<h3>Description</h3>

<p>Generates of one-page reports of single field analyses
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vfsfa(vf, file, ...)

vfsfashiny(vf, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vfsfa_+3A_vf">vf</code></td>
<td>
<p>visual field data</p>
</td></tr>
<tr><td><code id="vfsfa_+3A_file">file</code></td>
<td>
<p>The pdf file name where to save the one-page reports of single field analysis</p>
</td></tr>
<tr><td><code id="vfsfa_+3A_...">...</code></td>
<td>
<p>other graphical arguments</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li><p><code>vfsfa</code> saves a pdf with one-page reports of single field analyses
</p>
</li>
<li><p><code>vfsfashiny</code> generates interactive one-page reports of single field
analyses based on Shiny
</p>
</li></ul>



<h3>Value</h3>

<p>No return value
</p>

<hr>
<h2 id='vfspa'>Series Progession Analysis</h2><span id='topic+vfspa'></span><span id='topic+vfspashiny'></span>

<h3>Description</h3>

<p>Generation of one-page reports of series progression analyses
</p>

<ul>
<li><p><code>vfspa</code> saves a pdf with one-page reports of series progression analyses
</p>
</li>
<li><p><code>vfspashiny</code> generates interactive one-page reports of series progression
analyses based on Shiny
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>vfspa(
  vf,
  file,
  type = "td",
  nperm = factorial(7),
  trunc = 1,
  testSlope = 0,
  ...
)

vfspashiny(
  vf,
  type = "td",
  nperm = factorial(7),
  trunc = 1,
  testSlope = 0,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vfspa_+3A_vf">vf</code></td>
<td>
<p>visual field data</p>
</td></tr>
<tr><td><code id="vfspa_+3A_file">file</code></td>
<td>
<p>The pdf file name where to save the one-page reports of single field analysis</p>
</td></tr>
<tr><td><code id="vfspa_+3A_type">type</code></td>
<td>
<p>Type of data to use. It can be '<code>s</code>', '<code>td</code>', or
'<code>pd</code>'.</p>
</td></tr>
<tr><td><code id="vfspa_+3A_nperm">nperm</code></td>
<td>
<p>Number of permutations. Default is 7!</p>
</td></tr>
<tr><td><code id="vfspa_+3A_trunc">trunc</code></td>
<td>
<p>value for the Truncated Product Method (see reference).
Default is 1</p>
</td></tr>
<tr><td><code id="vfspa_+3A_testslope">testSlope</code></td>
<td>
<p>slope, or slopes, to test as null hypothesis. Default is 0.
if a single value, then the same null hypothesis is used for all locations.
If a vector of values, then (for <code>plr</code> and <code>poplr</code>) each
location of the visual field will have a different null hypothesis. The length
of testSlope must be 1 or equal to the number of locations to be used in the PLR
or PoPLR analysis</p>
</td></tr>
<tr><td><code id="vfspa_+3A_...">...</code></td>
<td>
<p>other graphical arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value
</p>


<h3>References</h3>

<p>N. O'Leary, B. C. Chauhan, and P. H. Artes. <em>Visual field progression in
glaucoma: estimating the overall significance of deterioration with permutation
analyses of pointwise linear regression (PoPLR)</em>. Investigative Ophthalmology
and Visual Science, 53, 2012
</p>
<p>N. O'Leary, B. C. Chauhan, and P. H. Artes. <em>Visual field progression in
glaucoma: estimating the overall significance of deterioration with permutation
analyses of pointwise linear regression (PoPLR)</em>. Investigative Ophthalmology
and Visual Science, 53, 2012
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
