<!DOCTYPE html><html lang="en-US"><head><title>Help for package serocalculator</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {serocalculator}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#serocalculator'><p>Estimating Infection Rates from Serological Data</p></a></li>
<li><a href='#.nll'><p>Calculate negative log-likelihood</p></a></li>
<li><a href='#+5B.seroincidence.by'><p>Extract or replace parts of a <code>seroincidence.by</code> object</p></a></li>
<li><a href='#ab'><p>kinetics of the antibody (ab) response (power function decay)</p></a></li>
<li><a href='#as_curve_params'><p>Load antibody decay curve parameter</p></a></li>
<li><a href='#as_noise_params'><p>Load noise parameters</p></a></li>
<li><a href='#as_pop_data'><p>Load a cross-sectional antibody survey data set</p></a></li>
<li><a href='#autoplot.curve_params'><p>graph antibody decay curves by antigen isotype</p></a></li>
<li><a href='#autoplot.pop_data'><p>Plot distribution of antibodies</p></a></li>
<li><a href='#autoplot.seroincidence'><p>Plot the log-likelihood curve for the incidence rate estimate</p></a></li>
<li><a href='#autoplot.seroincidence.by'><p>Plot <code>seroincidence.by</code> log-likelihoods</p></a></li>
<li><a href='#autoplot.summary.seroincidence.by'><p>Plot method for <code>summary.seroincidence.by</code> objects</p></a></li>
<li><a href='#check_pop_data'><p>Check the formatting of a cross-sectional antibody survey dataset.</p></a></li>
<li><a href='#df.to.array'><p>Convert a data.frame (or tibble) into a multidimensional array</p></a></li>
<li><a href='#est.incidence'><p>Find the maximum likelihood estimate of the incidence rate parameter</p></a></li>
<li><a href='#est.incidence.by'><p>Estimate Seroincidence</p></a></li>
<li><a href='#example_noise_params_pk'><p>Small example of noise parameters for typhoid</p></a></li>
<li><a href='#f_dev'><p>Calculate negative log-likelihood (deviance) for one antigen:isotype pair and several values of incidence</p></a></li>
<li><a href='#f_dev0'><p>Calculate negative log-likelihood (deviance) for one antigen:isotype pair and incidence rate</p></a></li>
<li><a href='#fdev'><p>Calculate negative log-likelihood (deviance)</p></a></li>
<li><a href='#graph_loglik'><p>Graph log-likelihood of data</p></a></li>
<li><a href='#graph.curve.params'><p>Graph estimated antibody decay curve</p></a></li>
<li><a href='#ldpar'><p>extract a row from longitudinal parameter set</p></a></li>
<li><a href='#llik'><p>Calculate log-likelihood</p></a></li>
<li><a href='#load_curve_params'><p>Load antibody decay curve parameter samples</p></a></li>
<li><a href='#load_noise_params'><p>Load noise parameters</p></a></li>
<li><a href='#load_pop_data'><p>Load a cross-sectional antibody survey data set</p></a></li>
<li><a href='#log_likelihood'><p>Calculate log-likelihood</p></a></li>
<li><a href='#mk_baseline'><p>generate random sample from baseline distribution</p></a></li>
<li><a href='#mkbaseline'><p>generate random sample from baseline distribution</p></a></li>
<li><a href='#plot_curve_params_one_ab'><p>Graph an antibody decay curve model</p></a></li>
<li><a href='#print.seroincidence'><p>Print Method for <code>seroincidence</code> Object</p></a></li>
<li><a href='#print.seroincidence.by'><p>Print Method for <code>seroincidence.by</code> Object</p></a></li>
<li><a href='#print.summary.seroincidence.by'><p>Print Method for Seroincidence Summary Object</p></a></li>
<li><a href='#reexports'><p>Objects exported from other packages</p></a></li>
<li><a href='#row_longitudinal_parameter'><p>extract a row from longitudinal parameter set</p></a></li>
<li><a href='#sees_pop_data_pk_100'><p>Small example cross-sectional data set</p></a></li>
<li><a href='#sees_pop_data_pk_100_old_names'><p>Small example cross-sectional data set</p></a></li>
<li><a href='#serocalculator_example'><p>Get path to an example file</p></a></li>
<li><a href='#sim.cs'><p>Simulate a cross-sectional serosurvey with noise</p></a></li>
<li><a href='#sim.cs.multi'><p>Simulate multiple data sets</p></a></li>
<li><a href='#simcs.tinf'><p>collect cross-sectional data</p></a></li>
<li><a href='#simresp.tinf'><p>simulate antibody kinetics of y over a time interval</p></a></li>
<li><a href='#strata'><p>Extract strata from an object</p></a></li>
<li><a href='#strata.seroincidence.by'><p>Extract the <code>Strata</code> attribute from an object, if present</p></a></li>
<li><a href='#stratify_data'><p>Split data by stratum</p></a></li>
<li><a href='#summary.pop_data'><p>Summarize cross-sectional antibody survey data</p></a></li>
<li><a href='#summary.seroincidence'><p>Summarizing fitted seroincidence models</p></a></li>
<li><a href='#summary.seroincidence.by'><p>Summary Method for <code>"seroincidence.by"</code> Objects</p></a></li>
<li><a href='#typhoid_curves_nostrat_100'><p>Small example of antibody response curve parameters for typhoid</p></a></li>
<li><a href='#warn.missing.strata'><p>Warn about missing stratifying variables in a dataset</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Estimating Infection Rates from Serological Data</td>
</tr>
<tr>
<td>Version:</td>
<td>1.3.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Translates antibody levels measured in cross-sectional
    population samples into estimates of the frequency with which
    seroconversions (infections) occur in the sampled populations.
    Replaces the previous 'seroincidence' package.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/UCD-SERG/serocalculator">https://github.com/UCD-SERG/serocalculator</a>,
<a href="https://ucd-serg.github.io/serocalculator/">https://ucd-serg.github.io/serocalculator/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/UCD-SERG/serocalculator/issues">https://github.com/UCD-SERG/serocalculator/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.1.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>cli, doParallel, dplyr (&ge; 1.1.1), foreach, ggplot2, ggpubr,
lifecycle, magrittr, mixtools, Rcpp, rlang, rngtools, scales,
stats, tibble, tidyr, tidyselect, utils, purrr, and, glue,
stringr</td>
</tr>
<tr>
<td>Suggests:</td>
<td>bookdown, DT, fs, ggbeeswarm, knitr, pak, parallel, readr,
quarto, rmarkdown, spelling, ssdtools (&ge; 1.0.6.9016), testthat
(&ge; 3.0.0), tidyverse, qrcode, svglite, vdiffr</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Config/Needs/build:</td>
<td>moodymudskipper/devtag</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-01-25 00:42:28 UTC; kwlai</td>
</tr>
<tr>
<td>Author:</td>
<td>Peter Teunis [aut, cph] (Author of the method and original code.),
  Kristina Lai [aut, cre],
  Chris Orwa [aut],
  Kristen Aiemjoy [aut],
  Douglas Ezra Morrison [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Kristina Lai &lt;kwlai@ucdavis.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-01-25 07:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='serocalculator'>Estimating Infection Rates from Serological Data</h2><span id='topic+serocalculator'></span><span id='topic+serocalculator-package'></span>

<h3>Description</h3>

<p>This package translates antibody levels measured in a
(cross-sectional) population sample into an
estimate of the frequency with which seroconversions (infections)
occur in the sampled population.
</p>


<h3>Details</h3>

<p>_PACKAGE
</p>


<h3>Author(s)</h3>


<ul>
<li><p> Peter Teunis <a href="mailto:p.teunis@emory.edu">p.teunis@emory.edu</a>
</p>
</li>
<li><p> Doug Ezra Morrison <a href="mailto:demorrison@ucdavis.edu">demorrison@ucdavis.edu</a>
</p>
</li>
<li><p> Kristen Aiemjoy <a href="mailto:kaiemjoy@ucdavis.edu">kaiemjoy@ucdavis.edu</a>
</p>
</li>
<li><p> Kristina Lai <a href="mailto:kwlai@ucdavis.edu">kwlai@ucdavis.edu</a>
</p>
</li></ul>



<h3>References</h3>

<p><em><strong>Methods for estimating seroincidence</strong></em>
</p>

<ul>
<li><p> Teunis, P. F. M., and J. C. H. van Eijkeren.
&quot;Estimation of seroconversion rates for infectious diseases:
Effects of age and noise.&quot;
Statistics in Medicine 39, no. 21 (2020): 2799-2814.
</p>
</li>
<li><p> Teunis, P. F. M., J. C. H. van Eijkeren, W. F. de Graaf,
A. Bonačić Marinović, and M. E. E. Kretzschmar.
&quot;Linking the seroresponse to infection to within-host heterogeneity
in antibody production.&quot; Epidemics 16 (2016): 33-39.
</p>
</li></ul>

<p><em><strong>Applications</strong></em>
</p>

<ul>
<li><p> Aiemjoy, Kristen, Jessica C. Seidman, Senjuti Saha,
Sira Jam Munira, Mohammad Saiful Islam Sajib,
Syed Muktadir Al Sium, Anik Sarkar et al.
&quot;Estimating typhoid incidence from community-based serosurveys:
a multicohort study.&quot; The Lancet Microbe 3, no. 8 (2022): e578-e587.
</p>
</li>
<li><p> Aiemjoy, Kristen, John Rumunu, Juma John Hassen,
Kirsten E. Wiens, Denise Garrett, Polina Kamenskaya,
Jason B. Harris et al. &quot;Seroincidence of enteric fever, Juba,
South Sudan.&quot; Emerging infectious diseases 28, no. 11 (2022): 2316.
</p>
</li>
<li><p> Monge, S., Teunis, P. F., Friesema, I., Franz, E., Ang, W.,
van Pelt, W., Mughini-Gras, L.
&quot;Immune response-eliciting exposure to Campylobacter vastly exceeds
the incidence of clinically
overt campylobacteriosis but is associated with similar
risk factors: A nationwide serosurvey in the Netherlands&quot;
Journal of Infection, 2018, 1&ndash;7, doi:10.1016/j.jinf.2018.04.016
</p>
</li>
<li><p> Kretzschmar, M., Teunis, P. F., Pebody, R. G.
&quot;Incidence and reproduction numbers of pertussis: estimates from
serological and social contact data in five European countries&quot;
PLoS Medicine 7, no. 6 (June 1, 2010):e1000291.
doi:10.1371/journal.pmed.1000291.
</p>
</li>
<li><p> Simonsen, J., Strid, M. A., Molbak, K., Krogfelt, K. A.,
Linneberg, A., Teunis, P.
&quot;Sero-epidemiology as a tool to study the incidence of
Salmonella infections in humans&quot;
Epidemiology and Infection 136, no. 7 (July 1, 2008): 895&ndash;902.
doi:10.1017/S0950268807009314
</p>
</li>
<li><p> Simonsen, J., Teunis, P. F., van Pelt, W., van Duynhoven, Y.,
Krogfelt, K. A., Sadkowska-Todys, M., Molbak K.
&quot;Usefulness of seroconversion rates for comparing infection
pressures between countries&quot;
Epidemiology and Infection, April 12, 2010, 1&ndash;8.
doi:10.1017/S0950268810000750.
</p>
</li>
<li><p> Falkenhorst, G., Simonsen, J., Ceper, T. H., van Pelt, W.,
de Valk, H., Sadkowska-Todys, M., Zota, L., Kuusi, M.,
Jernberg, C., Rota, M. C., van Duynhoven, Y. T., Teunis, P. F.,
Krogfelt, K. A., Molbak, K.
&quot;Serological cross-sectional studies on salmonella incidence in
eight European countries: no correlation with incidence of
reported cases&quot;
BMC Public Health 12, no. 1 (July 15, 2012): 523&ndash;23.
doi:10.1186/1471-2458-12-523.
</p>
</li>
<li><p> Teunis, P. F., Falkenhorst, G., Ang, C. W., Strid, M. A.,
De Valk, H., Sadkowska-Todys, M., Zota, L., Kuusi, M., Rota, M. C., Simonsen, J. B., Molbak, K., Van Duynhoven, Y. T., van Pelt, W.
&quot;Campylobacter seroconversion rates in selected countries in the European Union&quot;
Epidemiology and Infection 141, no. 10 (2013): 2051&ndash;57.
doi:10.1017/S0950268812002774.
</p>
</li>
<li><p> de Melker, H. E., Versteegh, F. G., Schellekens, J. F.,
Teunis, P. F., Kretzschmar, M.
&quot;The incidence of Bordetella pertussis infections estimated in the
population from a combination of serological surveys&quot;
The Journal of Infection 53, no. 2 (August 1, 2006): 106&ndash;13. doi:10.1016/j.jinf.2005.10.020
</p>
</li></ul>

<p><em><strong>Quantification of seroresponse</strong></em>
</p>

<ul>
<li><p> de Graaf, W. F., Kretzschmar, M. E., Teunis, P. F., Diekmann, O.
&quot;A two-phase within-host model for immune response and its
application to serological profiles of pertussis&quot;
Epidemics 9 (2014):1&ndash;7. doi:10.1016/j.epidem.2014.08.002.
</p>
</li>
<li><p> Berbers, G. A., van de Wetering, M. S., van Gageldonk, P. G.,
Schellekens, J. F., Versteegh, F. G., Teunis, P.F.
&quot;A novel method for evaluating natural and vaccine induced
serological responses to Bordetella pertussis antigens&quot;
Vaccine 31, no. 36 (August 12, 2013): 3732&ndash;38.
doi:10.1016/j.vaccine.2013.05.073.
</p>
</li>
<li><p> Versteegh, F. G., Mertens, P. L., de Melker, H. E., Roord, J. J.,
Schellekens, J. F., Teunis, P. F.
&quot;Age-specific long-term course of IgG antibodies to pertussis toxin
after symptomatic infection with Bordetella pertussis&quot;
Epidemiology and Infection 133, no. 4 (August 1, 2005): 737&ndash;48.
</p>
</li>
<li><p> Teunis, P. F., van der Heijden, O. G., de Melker, H. E., Schellekens, J. F., Versteegh, F. G., Kretzschmar, M. E.
&quot;Kinetics of the IgG antibody response to pertussis toxin after infection with B. pertussis&quot;
Epidemiology and Infection 129, no. 3 (December 10, 2002):479. doi:10.1017/S0950268802007896.
</p>
</li></ul>


<hr>
<h2 id='.nll'>Calculate negative log-likelihood</h2><span id='topic+.nll'></span>

<h3>Description</h3>

<p>Same as <code><a href="#topic+log_likelihood">log_likelihood()</a></code>, except negated and requiring lambda on log scale (used in combination with <code>nlm()</code>, to ensure that the optimization search doesn't stray into negative values of <code>lambda</code>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.nll(log.lambda, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id=".nll_+3A_log.lambda">log.lambda</code></td>
<td>
<p>natural logarithm of incidence rate</p>
</td></tr>
<tr><td><code id=".nll_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="#topic+log_likelihood">log_likelihood</a></code>
</p>

<dl>
<dt><code>pop_data</code></dt><dd><p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> with cross-sectional serology data
by antibody and age, and additional columns</p>
</dd>
<dt><code>antigen_isos</code></dt><dd><p>Character vector listing one or more antigen isotypes.
Values must match <code>pop_data</code>.</p>
</dd>
<dt><code>curve_params</code></dt><dd><p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> containing MCMC samples of parameters
from the Bayesian posterior distribution of a longitudinal decay curve model.
The parameter columns must be named:
</p>

<ul>
<li> <p><code>antigen_iso</code>: a <code><a href="base.html#topic+character">character()</a></code> vector indicating antigen-isotype
combinations
</p>
</li>
<li> <p><code>iter</code>: an <code><a href="base.html#topic+integer">integer()</a></code> vector indicating MCMC sampling iterations
</p>
</li>
<li> <p><code>y0</code>: baseline antibody level at $t=0$ ($y(t=0)$)
</p>
</li>
<li> <p><code>y1</code>: antibody peak level (ELISA units)
</p>
</li>
<li> <p><code>t1</code>: duration of infection
</p>
</li>
<li> <p><code>alpha</code>: antibody decay rate
(1/days for the current longitudinal parameter sets)
</p>
</li>
<li> <p><code>r</code>: shape factor of antibody decay
</p>
</li></ul>
</dd>
<dt><code>noise_params</code></dt><dd><p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> (or <code><a href="tibble.html#topic+tibble">tibble::tibble()</a></code>)
containing the following variables,
specifying noise parameters for each antigen isotype:
</p>

<ul>
<li> <p><code>antigen_iso</code>: antigen isotype whose noise parameters are being specified
on each row
</p>
</li>
<li> <p><code>nu</code>: biological noise
</p>
</li>
<li> <p><code>eps</code>: measurement noise
</p>
</li>
<li> <p><code>y.low</code>: lower limit of detection for the current antigen isotype
</p>
</li>
<li> <p><code>y.high</code>: upper limit of detection for the current antigen isotype
</p>
</li></ul>
</dd>
<dt><code>verbose</code></dt><dd><p>logical: if TRUE, print verbose log information to console</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>the negative log-likelihood of the data with the current parameter values
</p>

<hr>
<h2 id='+5B.seroincidence.by'>Extract or replace parts of a <code>seroincidence.by</code> object</h2><span id='topic++5B.seroincidence.by'></span>

<h3>Description</h3>

<p>Extract or replace parts of a <code>seroincidence.by</code> object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'seroincidence.by'
x[i, ...]
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="+2B5B.seroincidence.by_+3A_x">x</code></td>
<td>
<p>the object to subset/replace elements of</p>
</td></tr>
<tr><td><code id="+2B5B.seroincidence.by_+3A_i">i</code></td>
<td>
<p>the indices to subset/replace</p>
</td></tr>
<tr><td><code id="+2B5B.seroincidence.by_+3A_...">...</code></td>
<td>
<p>passed to <code style="white-space: pre;">&#8288;[.list&#8288;</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>the subset specified
</p>

<hr>
<h2 id='ab'>kinetics of the antibody (ab) response (power function decay)</h2><span id='topic+ab'></span>

<h3>Description</h3>

<p>kinetics of the antibody (ab) response (power function decay)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ab(t, par, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ab_+3A_t">t</code></td>
<td>
<p>age at infection?</p>
</td></tr>
<tr><td><code id="ab_+3A_par">par</code></td>
<td>
<p>parameters</p>
</td></tr>
<tr><td><code id="ab_+3A_...">...</code></td>
<td>
<p>arguments passed to <code>baseline()</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code><a href="base.html#topic+matrix">matrix()</a></code>
</p>

<hr>
<h2 id='as_curve_params'>Load antibody decay curve parameter</h2><span id='topic+as_curve_params'></span>

<h3>Description</h3>

<p>Load antibody decay curve parameter
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as_curve_params(data, antigen_isos = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as_curve_params_+3A_data">data</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> or <a href="tibble.html#topic+tbl_df-class">tibble::tbl_df</a></p>
</td></tr>
<tr><td><code id="as_curve_params_+3A_antigen_isos">antigen_isos</code></td>
<td>
<p>a <code><a href="base.html#topic+character">character()</a></code> vector of antigen isotypes
to be used in analyses</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>curve_data</code> object
(a <a href="tibble.html#topic+tbl_df-class">tibble::tbl_df</a> with extra attribute <code>antigen_isos</code>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(magrittr)
curve_data &lt;-
  serocalculator_example("example_curve_params.csv") %&gt;%
  read.csv() %&gt;%
  as_curve_params()

print(curve_data)
</code></pre>

<hr>
<h2 id='as_noise_params'>Load noise parameters</h2><span id='topic+as_noise_params'></span>

<h3>Description</h3>

<p>Load noise parameters
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as_noise_params(data, antigen_isos = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as_noise_params_+3A_data">data</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> or <a href="tibble.html#topic+tbl_df-class">tibble::tbl_df</a></p>
</td></tr>
<tr><td><code id="as_noise_params_+3A_antigen_isos">antigen_isos</code></td>
<td>
<p><code><a href="base.html#topic+character">character()</a></code> vector of antigen isotypes
to be used in analyses</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>noise_params</code> object (a <a href="tibble.html#topic+tbl_df-class">tibble::tbl_df</a> with
extra attribute <code>antigen_isos</code>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(magrittr)
noise_data &lt;-
  serocalculator_example("example_noise_params.csv") %&gt;%
  read.csv() %&gt;%
  as_noise_params()

print(noise_data)

</code></pre>

<hr>
<h2 id='as_pop_data'>Load a cross-sectional antibody survey data set</h2><span id='topic+as_pop_data'></span>

<h3>Description</h3>

<p>Load a cross-sectional antibody survey data set
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as_pop_data(
  data,
  antigen_isos = NULL,
  age = "Age",
  value = "result",
  id = "index_id",
  standardize = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as_pop_data_+3A_data">data</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> or <a href="tibble.html#topic+tbl_df-class">tibble::tbl_df</a></p>
</td></tr>
<tr><td><code id="as_pop_data_+3A_antigen_isos">antigen_isos</code></td>
<td>
<p><code><a href="base.html#topic+character">character()</a></code>
vector of antigen isotypes to be used in analyses</p>
</td></tr>
<tr><td><code id="as_pop_data_+3A_age">age</code></td>
<td>
<p>a <code><a href="base.html#topic+character">character()</a></code> identifying the age column</p>
</td></tr>
<tr><td><code id="as_pop_data_+3A_value">value</code></td>
<td>
<p>a <code><a href="base.html#topic+character">character()</a></code> identifying the value column</p>
</td></tr>
<tr><td><code id="as_pop_data_+3A_id">id</code></td>
<td>
<p>a <code><a href="base.html#topic+character">character()</a></code> identifying the id column</p>
</td></tr>
<tr><td><code id="as_pop_data_+3A_standardize">standardize</code></td>
<td>
<p>a <code><a href="base.html#topic+logical">logical()</a></code> to determine standardization of columns</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>pop_data</code> object (a <a href="tibble.html#topic+tbl_df-class">tibble::tbl_df</a>
with extra attribute <code>antigen_isos</code>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(magrittr)
xs_data &lt;-
  serocalculator_example("example_pop_data.csv") %&gt;%
  read.csv() %&gt;%
  as_pop_data()

print(xs_data)
</code></pre>

<hr>
<h2 id='autoplot.curve_params'>graph antibody decay curves by antigen isotype</h2><span id='topic+autoplot.curve_params'></span>

<h3>Description</h3>

<p>graph antibody decay curves by antigen isotype
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'curve_params'
autoplot(
  object,
  antigen_isos = unique(object$antigen_iso),
  ncol = min(3, length(antigen_isos)),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="autoplot.curve_params_+3A_object">object</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> of curve parameters (one or more MCMC samples)</p>
</td></tr>
<tr><td><code id="autoplot.curve_params_+3A_antigen_isos">antigen_isos</code></td>
<td>
<p>antigen isotypes to analyze (can subset <code>curve_params</code>)</p>
</td></tr>
<tr><td><code id="autoplot.curve_params_+3A_ncol">ncol</code></td>
<td>
<p>how many columns of subfigures to use in panel plot</p>
</td></tr>
<tr><td><code id="autoplot.curve_params_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="#topic+plot_curve_params_one_ab">plot_curve_params_one_ab</a></code>
</p>

<dl>
<dt><code>verbose</code></dt><dd><p>verbose output</p>
</dd>
<dt><code>xlim</code></dt><dd><p>range of x values to graph</p>
</dd>
<dt><code>n_curves</code></dt><dd><p>how many curves to plot (see details).</p>
</dd>
<dt><code>n_points</code></dt><dd><p>Number of points to interpolate along the x axis
(passed to <code><a href="ggplot2.html#topic+geom_function">ggplot2::geom_function()</a></code>)</p>
</dd>
<dt><code>rows_to_graph</code></dt><dd><p>which rows of <code>curve_params</code> to plot
(overrides <code>n_curves</code>).</p>
</dd>
<dt><code>alpha</code></dt><dd><p>(passed to <code><a href="ggplot2.html#topic+geom_function">ggplot2::geom_function()</a></code>)
how transparent the curves should be:
</p>

<ul>
<li><p> 0 = fully transparent (invisible)
</p>
</li>
<li><p> 1 = fully opaque
</p>
</li></ul>
</dd>
<dt><code>log_x</code></dt><dd><p>should the x-axis be on a logarithmic scale (<code>TRUE</code>)
or linear scale (<code>FALSE</code>, default)?</p>
</dd>
<dt><code>log_y</code></dt><dd><p>should the Y-axis be on a logarithmic scale
(default, <code>TRUE</code>) or linear scale (<code>FALSE</code>)?</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Details</h3>



<h4><code>rows_to_graph</code></h4>

<p>Note that if you directly specify <code>rows_to_graph</code> when calling this function,
the row numbers are enumerated separately for each antigen isotype;
in other words, for the purposes of this argument,
row numbers start over at 1 for each antigen isotype. There is currently
no way to specify different row numbers for different antigen isotypes;
if you want to do that, you could call <code><a href="#topic+plot_curve_params_one_ab">plot_curve_params_one_ab()</a></code>
directly for each antigen isotype and combine the resulting panels yourself.
Or you could subset <code>curve_params</code> manually, before passing it to this
function, and set the <code>n_curves</code> argument to <code>Inf</code>.
</p>



<h3>Value</h3>

<p>a <code><a href="ggplot2.html#topic+ggplot">ggplot2::ggplot()</a></code> object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(ggplot2)
library(magrittr)

curve &lt;-
  serocalculator_example("example_curve_params.csv") %&gt;%
  read.csv() %&gt;%
  as_curve_params() %&gt;%
  filter(antigen_iso %in% c("HlyE_IgA", "HlyE_IgG")) %&gt;%
  autoplot()

curve

</code></pre>

<hr>
<h2 id='autoplot.pop_data'>Plot distribution of antibodies</h2><span id='topic+autoplot.pop_data'></span>

<h3>Description</h3>

<p><code>autoplot()</code> method for <code>pop_data</code> objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'pop_data'
autoplot(object, log = FALSE, type = "density", strata = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="autoplot.pop_data_+3A_object">object</code></td>
<td>
<p>A <code>pop_data</code> object (from <code><a href="#topic+load_pop_data">load_pop_data()</a></code>)</p>
</td></tr>
<tr><td><code id="autoplot.pop_data_+3A_log">log</code></td>
<td>
<p>whether to show antibody responses on logarithmic scale</p>
</td></tr>
<tr><td><code id="autoplot.pop_data_+3A_type">type</code></td>
<td>
<p>an option to choose type of chart:
the current options are <code>"density"</code> or <code>"age-scatter"</code></p>
</td></tr>
<tr><td><code id="autoplot.pop_data_+3A_strata">strata</code></td>
<td>
<p>the name of a variable in <code>pop_data</code>
to stratify by (or <code>NULL</code> for no stratification)</p>
</td></tr>
<tr><td><code id="autoplot.pop_data_+3A_...">...</code></td>
<td>
<p>unused</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <a href="ggplot2.html#topic+ggplot">ggplot2::ggplot</a> object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(ggplot2)
library(magrittr)

xs_data &lt;-
  serocalculator_example("example_pop_data.csv") %&gt;%
  read.csv() %&gt;%
  as_pop_data()

xs_data %&gt;% autoplot(strata = "catchment", type = "density")
xs_data %&gt;% autoplot(strata = "catchment", type = "age-scatter")

</code></pre>

<hr>
<h2 id='autoplot.seroincidence'>Plot the log-likelihood curve for the incidence rate estimate</h2><span id='topic+autoplot.seroincidence'></span>

<h3>Description</h3>

<p>Plot the log-likelihood curve for the incidence rate estimate
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'seroincidence'
autoplot(object, log_x = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="autoplot.seroincidence_+3A_object">object</code></td>
<td>
<p>a <code>seroincidence</code> object (from <code><a href="#topic+est.incidence">est.incidence()</a></code>)</p>
</td></tr>
<tr><td><code id="autoplot.seroincidence_+3A_log_x">log_x</code></td>
<td>
<p>should the x-axis be on a logarithmic scale (<code>TRUE</code>) or linear scale (<code>FALSE</code>, default)?</p>
</td></tr>
<tr><td><code id="autoplot.seroincidence_+3A_...">...</code></td>
<td>
<p>unused</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code><a href="ggplot2.html#topic+ggplot">ggplot2::ggplot()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(ggplot2)

xs_data &lt;-
  sees_pop_data_pk_100

curve &lt;-
  typhoid_curves_nostrat_100 %&gt;%
  filter(antigen_iso %in% c("HlyE_IgA", "HlyE_IgG"))

noise &lt;-
  example_noise_params_pk

est1 &lt;- est.incidence(
  pop_data = xs_data,
  curve_param = curve,
  noise_param = noise,
  antigen_isos = c("HlyE_IgG", "HlyE_IgA"),
  build_graph = TRUE
)

# Plot the log-likelihood curve
autoplot(est1)

</code></pre>

<hr>
<h2 id='autoplot.seroincidence.by'>Plot <code>seroincidence.by</code> log-likelihoods</h2><span id='topic+autoplot.seroincidence.by'></span>

<h3>Description</h3>

<p>Plots log-likelihood curves by stratum, for <code>seroincidence.by</code> objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'seroincidence.by'
autoplot(object, ncol = min(3, length(object)), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="autoplot.seroincidence.by_+3A_object">object</code></td>
<td>
<p>a '&quot;seroincidence.by&quot;' object (from <code><a href="#topic+est.incidence.by">est.incidence.by()</a></code>)</p>
</td></tr>
<tr><td><code id="autoplot.seroincidence.by_+3A_ncol">ncol</code></td>
<td>
<p>number of columns to use for panel of plots</p>
</td></tr>
<tr><td><code id="autoplot.seroincidence.by_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="#topic+autoplot.seroincidence">autoplot.seroincidence</a></code>
</p>

<dl>
<dt><code>log_x</code></dt><dd><p>should the x-axis be on a logarithmic scale (<code>TRUE</code>) or linear scale (<code>FALSE</code>, default)?</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>an object of class <code>"ggarrange"</code>, which is a <code><a href="ggplot2.html#topic+ggplot">ggplot2::ggplot()</a></code> or a <code><a href="base.html#topic+list">list()</a></code> of <code><a href="ggplot2.html#topic+ggplot">ggplot2::ggplot()</a></code>s.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(ggplot2)

xs_data &lt;-
  sees_pop_data_pk_100

curve &lt;-
  typhoid_curves_nostrat_100 %&gt;%
  filter(antigen_iso %in% c("HlyE_IgA", "HlyE_IgG"))

noise &lt;-
  example_noise_params_pk

est2 &lt;- est.incidence.by(
  strata = c("catchment"),
  pop_data = xs_data,
  curve_params = curve,
  noise_params = noise,
  antigen_isos = c("HlyE_IgG", "HlyE_IgA"),
  #num_cores = 8, #Allow for parallel processing to decrease run time
  build_graph = TRUE
)

# Plot the log-likelihood curve
autoplot(est2)

</code></pre>

<hr>
<h2 id='autoplot.summary.seroincidence.by'>Plot method for <code>summary.seroincidence.by</code> objects</h2><span id='topic+autoplot.summary.seroincidence.by'></span>

<h3>Description</h3>

<p>Plot method for <code>summary.seroincidence.by</code> objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'summary.seroincidence.by'
autoplot(object, xvar, alpha = 0.7, shape = 1, width = 0.001, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="autoplot.summary.seroincidence.by_+3A_object">object</code></td>
<td>
<p>a <code>summary.seroincidence.by</code> object (generated by applying the <code>summary()</code> method to the output of <code><a href="#topic+est.incidence.by">est.incidence.by()</a></code>).</p>
</td></tr>
<tr><td><code id="autoplot.summary.seroincidence.by_+3A_xvar">xvar</code></td>
<td>
<p>the name of a stratifying variable in <code>object</code></p>
</td></tr>
<tr><td><code id="autoplot.summary.seroincidence.by_+3A_alpha">alpha</code></td>
<td>
<p>transparency for the points in the graph (1 = no transparency, 0 = fully transparent)</p>
</td></tr>
<tr><td><code id="autoplot.summary.seroincidence.by_+3A_shape">shape</code></td>
<td>
<p>shape argument for <code>geom_point()</code></p>
</td></tr>
<tr><td><code id="autoplot.summary.seroincidence.by_+3A_width">width</code></td>
<td>
<p>width for jitter</p>
</td></tr>
<tr><td><code id="autoplot.summary.seroincidence.by_+3A_...">...</code></td>
<td>
<p>unused</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code><a href="ggplot2.html#topic+ggplot">ggplot2::ggplot()</a></code> object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(ggplot2)

xs_data &lt;-
  sees_pop_data_pk_100

curve &lt;-
  typhoid_curves_nostrat_100 %&gt;%
  filter(antigen_iso %in% c("HlyE_IgA", "HlyE_IgG"))

noise &lt;-
  example_noise_params_pk

est2 &lt;- est.incidence.by(
  strata = c("catchment"),
  pop_data = xs_data,
  curve_params = curve,
  noise_params = noise,
  antigen_isos = c("HlyE_IgG", "HlyE_IgA"),
  #num_cores = 8 #Allow for parallel processing to decrease run time
)

est2sum &lt;- summary(est2)

autoplot(est2sum, "catchment")

</code></pre>

<hr>
<h2 id='check_pop_data'>Check the formatting of a cross-sectional antibody survey dataset.</h2><span id='topic+check_pop_data'></span>

<h3>Description</h3>

<p>Check the formatting of a cross-sectional antibody survey dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_pop_data(pop_data, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_pop_data_+3A_pop_data">pop_data</code></td>
<td>
<p>dataset to check</p>
</td></tr>
<tr><td><code id="check_pop_data_+3A_verbose">verbose</code></td>
<td>
<p>whether to print an &quot;OK&quot; message when all checks pass</p>
</td></tr>
</table>


<h3>Value</h3>

<p>NULL (invisibly)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(magrittr)

xs_data &lt;-
  serocalculator_example("example_pop_data.csv") %&gt;%
  read.csv() %&gt;%
  as_pop_data()

check_pop_data(xs_data, verbose = TRUE)

</code></pre>

<hr>
<h2 id='df.to.array'>Convert a data.frame (or tibble) into a multidimensional array</h2><span id='topic+df.to.array'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
</p>
<p><code>df.to.array()</code> was renamed to <code>df_to_array()</code> to create a more
consistent API.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>df.to.array(df, dim_var_names, value_var_name = "value")
</code></pre>

<hr>
<h2 id='est.incidence'>Find the maximum likelihood estimate of the incidence rate parameter</h2><span id='topic+est.incidence'></span>

<h3>Description</h3>

<p>This function models seroincidence using maximum likelihood estimation; that is, it finds the value of the seroincidence parameter which maximizes the likelihood (i.e., joint probability) of the data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>est.incidence(
  pop_data,
  curve_params,
  noise_params,
  antigen_isos = pop_data$antigen_iso %&gt;% unique(),
  lambda_start = 0.1,
  stepmin = 1e-08,
  stepmax = 3,
  verbose = FALSE,
  build_graph = FALSE,
  print_graph = build_graph &amp; verbose,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="est.incidence_+3A_pop_data">pop_data</code></td>
<td>
<p>a <a href="base.html#topic+data.frame">data.frame</a> with cross-sectional serology data per antibody and age, and additional columns</p>
</td></tr>
<tr><td><code id="est.incidence_+3A_curve_params">curve_params</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> containing MCMC samples of parameters
from the Bayesian posterior distribution of a longitudinal decay curve model.
The parameter columns must be named:
</p>

<ul>
<li> <p><code>antigen_iso</code>: a <code><a href="base.html#topic+character">character()</a></code> vector indicating antigen-isotype
combinations
</p>
</li>
<li> <p><code>iter</code>: an <code><a href="base.html#topic+integer">integer()</a></code> vector indicating MCMC sampling iterations
</p>
</li>
<li> <p><code>y0</code>: baseline antibody level at $t=0$ ($y(t=0)$)
</p>
</li>
<li> <p><code>y1</code>: antibody peak level (ELISA units)
</p>
</li>
<li> <p><code>t1</code>: duration of infection
</p>
</li>
<li> <p><code>alpha</code>: antibody decay rate
(1/days for the current longitudinal parameter sets)
</p>
</li>
<li> <p><code>r</code>: shape factor of antibody decay
</p>
</li></ul>
</td></tr>
<tr><td><code id="est.incidence_+3A_noise_params">noise_params</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> (or <code><a href="tibble.html#topic+tibble">tibble::tibble()</a></code>)
containing the following variables,
specifying noise parameters for each antigen isotype:
</p>

<ul>
<li> <p><code>antigen_iso</code>: antigen isotype whose noise parameters are being specified
on each row
</p>
</li>
<li> <p><code>nu</code>: biological noise
</p>
</li>
<li> <p><code>eps</code>: measurement noise
</p>
</li>
<li> <p><code>y.low</code>: lower limit of detection for the current antigen isotype
</p>
</li>
<li> <p><code>y.high</code>: upper limit of detection for the current antigen isotype
</p>
</li></ul>
</td></tr>
<tr><td><code id="est.incidence_+3A_antigen_isos">antigen_isos</code></td>
<td>
<p>Character vector with one or more antibody names. Values must match <code>pop_data</code></p>
</td></tr>
<tr><td><code id="est.incidence_+3A_lambda_start">lambda_start</code></td>
<td>
<p>starting guess for incidence rate, in years/event.</p>
</td></tr>
<tr><td><code id="est.incidence_+3A_stepmin">stepmin</code></td>
<td>
<p>A positive scalar providing the minimum allowable relative step length.</p>
</td></tr>
<tr><td><code id="est.incidence_+3A_stepmax">stepmax</code></td>
<td>
<p>a positive scalar which gives the maximum allowable
scaled step length.  <code>stepmax</code> is used to prevent steps which
would cause the optimization function to overflow, to prevent the
algorithm from leaving the area of interest in parameter space, or to
detect divergence in the algorithm. <code>stepmax</code> would be chosen
small enough to prevent the first two of these occurrences, but should
be larger than any anticipated reasonable step.</p>
</td></tr>
<tr><td><code id="est.incidence_+3A_verbose">verbose</code></td>
<td>
<p>logical: if TRUE, print verbose log information to console</p>
</td></tr>
<tr><td><code id="est.incidence_+3A_build_graph">build_graph</code></td>
<td>
<p>whether to graph the log-likelihood function across a range of incidence rates (lambda values)</p>
</td></tr>
<tr><td><code id="est.incidence_+3A_print_graph">print_graph</code></td>
<td>
<p>whether to display the log-likelihood curve graph in the course of running <code>est.incidence()</code></p>
</td></tr>
<tr><td><code id="est.incidence_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="stats.html#topic+nlm">stats::nlm</a></code>
</p>

<dl>
<dt><code>typsize</code></dt><dd><p>an estimate of the size of each parameter
at the minimum.</p>
</dd>
<dt><code>fscale</code></dt><dd><p>an estimate of the size of <code>f</code> at the minimum.</p>
</dd>
<dt><code>ndigit</code></dt><dd><p>the number of significant digits in the function <code>f</code>.</p>
</dd>
<dt><code>gradtol</code></dt><dd><p>a positive scalar giving the tolerance at which the
scaled gradient is considered close enough to zero to
terminate the algorithm.  The scaled gradient is a
measure of the relative change in <code>f</code> in each direction
<code>p[i]</code> divided by the relative change in <code>p[i]</code>.</p>
</dd>
<dt><code>iterlim</code></dt><dd><p>a positive integer specifying the maximum number of
iterations to be performed before the program is terminated.</p>
</dd>
<dt><code>check.analyticals</code></dt><dd><p>a logical scalar specifying whether the
analytic gradients and Hessians, if they are supplied, should be
checked against numerical derivatives at the initial parameter
values. This can help detect incorrectly formulated gradients or
Hessians.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>"seroincidence"</code> object, which is a <code><a href="stats.html#topic+nlm">stats::nlm()</a></code> fit object with extra meta-data attributes <code>lambda_start</code>, <code>antigen_isos</code>, and <code>ll_graph</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)

xs_data &lt;-
  sees_pop_data_pk_100

curve &lt;-
  typhoid_curves_nostrat_100 %&gt;%
  filter(antigen_iso %in% c("HlyE_IgA", "HlyE_IgG"))

noise &lt;-
  example_noise_params_pk

est1 &lt;- est.incidence(
  pop_data = xs_data,
  curve_params = curve,
  noise_params = noise,
  antigen_isos = c("HlyE_IgG", "HlyE_IgA"),
)

summary(est1)
</code></pre>

<hr>
<h2 id='est.incidence.by'>Estimate Seroincidence</h2><span id='topic+est.incidence.by'></span>

<h3>Description</h3>

<p>Function to estimate seroincidences based on cross-sectional
serology data and longitudinal
response model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>est.incidence.by(
  pop_data,
  curve_params,
  noise_params,
  strata,
  curve_strata_varnames = strata,
  noise_strata_varnames = strata,
  antigen_isos = pop_data %&gt;% pull("antigen_iso") %&gt;% unique(),
  lambda_start = 0.1,
  build_graph = FALSE,
  num_cores = 1L,
  verbose = FALSE,
  print_graph = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="est.incidence.by_+3A_pop_data">pop_data</code></td>
<td>
<p>a <a href="base.html#topic+data.frame">data.frame</a> with cross-sectional serology data per
antibody and age, and additional columns corresponding to
each element of the <code>strata</code> input</p>
</td></tr>
<tr><td><code id="est.incidence.by_+3A_curve_params">curve_params</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> containing MCMC samples of parameters
from the Bayesian posterior distribution of a longitudinal decay curve model.
The parameter columns must be named:
</p>

<ul>
<li> <p><code>antigen_iso</code>: a <code><a href="base.html#topic+character">character()</a></code> vector indicating antigen-isotype
combinations
</p>
</li>
<li> <p><code>iter</code>: an <code><a href="base.html#topic+integer">integer()</a></code> vector indicating MCMC sampling iterations
</p>
</li>
<li> <p><code>y0</code>: baseline antibody level at $t=0$ ($y(t=0)$)
</p>
</li>
<li> <p><code>y1</code>: antibody peak level (ELISA units)
</p>
</li>
<li> <p><code>t1</code>: duration of infection
</p>
</li>
<li> <p><code>alpha</code>: antibody decay rate
(1/days for the current longitudinal parameter sets)
</p>
</li>
<li> <p><code>r</code>: shape factor of antibody decay
</p>
</li></ul>
</td></tr>
<tr><td><code id="est.incidence.by_+3A_noise_params">noise_params</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> (or <code><a href="tibble.html#topic+tibble">tibble::tibble()</a></code>)
containing the following variables,
specifying noise parameters for each antigen isotype:
</p>

<ul>
<li> <p><code>antigen_iso</code>: antigen isotype whose noise parameters are being specified
on each row
</p>
</li>
<li> <p><code>nu</code>: biological noise
</p>
</li>
<li> <p><code>eps</code>: measurement noise
</p>
</li>
<li> <p><code>y.low</code>: lower limit of detection for the current antigen isotype
</p>
</li>
<li> <p><code>y.high</code>: upper limit of detection for the current antigen isotype
</p>
</li></ul>
</td></tr>
<tr><td><code id="est.incidence.by_+3A_strata">strata</code></td>
<td>
<p>a <a href="base.html#topic+character">character</a> vector of stratum-defining variables.
Values must be variable names in <code>pop_data</code>.</p>
</td></tr>
<tr><td><code id="est.incidence.by_+3A_curve_strata_varnames">curve_strata_varnames</code></td>
<td>
<p>A subset of <code>strata</code>.
Values must be variable names in <code>curve_params</code>. Default = &quot;&quot;.</p>
</td></tr>
<tr><td><code id="est.incidence.by_+3A_noise_strata_varnames">noise_strata_varnames</code></td>
<td>
<p>A subset of <code>strata</code>.
Values must be variable names in <code>noise_params</code>. Default = &quot;&quot;.</p>
</td></tr>
<tr><td><code id="est.incidence.by_+3A_antigen_isos">antigen_isos</code></td>
<td>
<p>Character vector with one or more antibody names. Values must match <code>pop_data</code></p>
</td></tr>
<tr><td><code id="est.incidence.by_+3A_lambda_start">lambda_start</code></td>
<td>
<p>starting guess for incidence rate, in years/event.</p>
</td></tr>
<tr><td><code id="est.incidence.by_+3A_build_graph">build_graph</code></td>
<td>
<p>whether to graph the log-likelihood function across a range of incidence rates (lambda values)</p>
</td></tr>
<tr><td><code id="est.incidence.by_+3A_num_cores">num_cores</code></td>
<td>
<p>Number of processor cores to use for
calculations when computing by strata. If set to
more than 1 and package <span class="pkg">parallel</span> is available,
then the computations are executed in parallel. Default = 1L.</p>
</td></tr>
<tr><td><code id="est.incidence.by_+3A_verbose">verbose</code></td>
<td>
<p>logical: if TRUE, print verbose log information to console</p>
</td></tr>
<tr><td><code id="est.incidence.by_+3A_print_graph">print_graph</code></td>
<td>
<p>whether to display the log-likelihood curve graph in the course of running <code>est.incidence()</code></p>
</td></tr>
<tr><td><code id="est.incidence.by_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="#topic+est.incidence">est.incidence</a></code>, <code><a href="stats.html#topic+nlm">stats::nlm</a></code>
</p>

<dl>
<dt><code>stepmin</code></dt><dd><p>A positive scalar providing the minimum allowable relative step length.</p>
</dd>
<dt><code>stepmax</code></dt><dd><p>a positive scalar which gives the maximum allowable
scaled step length.  <code>stepmax</code> is used to prevent steps which
would cause the optimization function to overflow, to prevent the
algorithm from leaving the area of interest in parameter space, or to
detect divergence in the algorithm. <code>stepmax</code> would be chosen
small enough to prevent the first two of these occurrences, but should
be larger than any anticipated reasonable step.</p>
</dd>
<dt><code>typsize</code></dt><dd><p>an estimate of the size of each parameter
at the minimum.</p>
</dd>
<dt><code>fscale</code></dt><dd><p>an estimate of the size of <code>f</code> at the minimum.</p>
</dd>
<dt><code>ndigit</code></dt><dd><p>the number of significant digits in the function <code>f</code>.</p>
</dd>
<dt><code>gradtol</code></dt><dd><p>a positive scalar giving the tolerance at which the
scaled gradient is considered close enough to zero to
terminate the algorithm.  The scaled gradient is a
measure of the relative change in <code>f</code> in each direction
<code>p[i]</code> divided by the relative change in <code>p[i]</code>.</p>
</dd>
<dt><code>iterlim</code></dt><dd><p>a positive integer specifying the maximum number of
iterations to be performed before the program is terminated.</p>
</dd>
<dt><code>check.analyticals</code></dt><dd><p>a logical scalar specifying whether the
analytic gradients and Hessians, if they are supplied, should be
checked against numerical derivatives at the initial parameter
values. This can help detect incorrectly formulated gradients or
Hessians.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>strata</code> is left empty, a warning will be produced,
recommending that you use <code><a href="#topic+est.incidence">est.incidence()</a></code> for unstratified analyses,
and then the data will be passed to <code><a href="#topic+est.incidence">est.incidence()</a></code>.
If for some reason you want to use <code><a href="#topic+est.incidence.by">est.incidence.by()</a></code>
with no strata instead of calling <code><a href="#topic+est.incidence">est.incidence()</a></code>,
you may use <code>NA</code>, <code>NULL</code>, or <code>""</code> as the <code>strata</code>
argument to avoid that warning.
</p>


<h3>Value</h3>


<ul>
<li><p> if <code>strata</code> has meaningful inputs:
An object of class <code>"seroincidence.by"</code>; i.e., a list of
<code>"seroincidence"</code> objects from <code><a href="#topic+est.incidence">est.incidence()</a></code>, one for each stratum,
with some meta-data attributes.
</p>
</li>
<li><p> if <code>strata</code> is missing, <code>NULL</code>, <code>NA</code>, or <code>""</code>:
An object of class <code>"seroincidence"</code>.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)

xs_data &lt;-
  sees_pop_data_pk_100

curve &lt;-
  typhoid_curves_nostrat_100 %&gt;%
  filter(antigen_iso %in% c("HlyE_IgA", "HlyE_IgG"))

noise &lt;-
  example_noise_params_pk

est2 &lt;- est.incidence.by(
  strata = c("catchment"),
  pop_data = xs_data,
  curve_params = curve,
  noise_params = noise,
  antigen_isos = c("HlyE_IgG", "HlyE_IgA"),
  # num_cores = 8 # Allow for parallel processing to decrease run time
  iterlim = 5 # limit iterations for the purpose of this example
)

summary(est2)

</code></pre>

<hr>
<h2 id='example_noise_params_pk'>Small example of noise parameters for typhoid</h2><span id='topic+example_noise_params_pk'></span>

<h3>Description</h3>

<p>A subset of noise parameter estimates from the SEES study,
for examples and testing.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>example_noise_params_pk
</code></pre>


<h3>Format</h3>



<h4><code>example_noise_params_pk</code></h4>

<p>A <code>curve_params</code> object (from <code><a href="#topic+as_curve_params">as_curve_params()</a></code>) with 4 rows and 7 columns:
</p>

<dl>
<dt>antigen_iso</dt><dd><p>which antigen and isotype are being measured
(data is in long format)</p>
</dd>
<dt>Country</dt><dd><p>Location for which the noise parameters were estimated</p>
</dd>
<dt>y.low</dt><dd><p>Lower limit of detection</p>
</dd>
<dt>eps</dt><dd><p>Measurement noise, defined by a CV (coefficient of variation)
as the ratio of the standard deviation to the mean for replicates.
Note that the CV should ideally be measured across plates
rather than within the same plate.</p>
</dd>
<dt>nu</dt><dd><p>Biological noise: error from
cross-reactivity to other antibodies.
It is defined as the 95th percentile of
the distribution of antibody responses to the antigen-isotype
in a population with no exposure.</p>
</dd>
<dt>y.high</dt><dd><p>Upper limit of detection</p>
</dd>
<dt>Lab</dt><dd><p>Lab for which noise was estimated.</p>
</dd>
</dl>




<h3>Source</h3>

<p><a href="https://osf.io/rtw5k">https://osf.io/rtw5k</a>
</p>

<hr>
<h2 id='f_dev'>Calculate negative log-likelihood (deviance) for one antigen:isotype pair and several values of incidence</h2><span id='topic+f_dev'></span>

<h3>Description</h3>

<p>Calculates negative log-likelihood (deviance) for one antigen:isotype pair and several values of incidence (<code>lambda</code>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>f_dev(lambda, csdata, lnpars, cond)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="f_dev_+3A_lambda">lambda</code></td>
<td>
<p>a <a href="base.html#topic+numeric">numeric</a> vector of incidence parameters, in events per person-year</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Vectorized version of <code><a href="#topic+f_dev0">f_dev0()</a></code>; interface with C lib <code>serocalc.so</code>
</p>


<h3>Value</h3>

<p>a <a href="base.html#topic+numeric">numeric</a> vector of negative log-likelihoods,
corresponding to the elements of input <code>lambda</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(tibble)

# load in longitudinal parameters
curve_params &lt;-
  typhoid_curves_nostrat_100 %&gt;%
  filter(antigen_iso %in% c("HlyE_IgA", "HlyE_IgG"))

# load in pop data
xs_data &lt;-
  sees_pop_data_pk_100

#Load noise params
noise_params &lt;- tibble(
  antigen_iso = c("HlyE_IgG", "HlyE_IgA"),
  nu = c(0.5, 0.5),                          # Biologic noise (nu)
  eps = c(0, 0),                             # M noise (eps)
  y.low = c(1, 1),                           # low cutoff (llod)
  y.high = c(5e6, 5e6))                      # high cutoff (y.high)

cur_antibody = "HlyE_IgA"

cur_data =
  xs_data %&gt;%
  dplyr::filter(
   .data$catchment == "aku",
   .data$antigen_iso == cur_antibody) %&gt;%
  dplyr::slice_head(n = 100)

cur_curve_params =
  curve_params %&gt;%
  dplyr::filter(.data$antigen_iso == cur_antibody) %&gt;%
  dplyr::slice_head(n = 100)

cur_noise_params =
  noise_params %&gt;%
  dplyr::filter(.data$antigen_iso == cur_antibody)

if(!is.element('d', names(cur_curve_params)))
{
  cur_curve_params =
    cur_curve_params %&gt;%
    dplyr::mutate(
      alpha = .data$alpha * 365.25,
      d = .data$r - 1)
}

lambdas = seq(.1, .2, by = .01)
f_dev(
    lambda = lambdas,
    csdata = cur_data,
    lnpars = cur_curve_params,
    cond = cur_noise_params
  )

</code></pre>

<hr>
<h2 id='f_dev0'>Calculate negative log-likelihood (deviance) for one antigen:isotype pair and incidence rate</h2><span id='topic+f_dev0'></span>

<h3>Description</h3>

<p>Calculate negative log-likelihood (deviance) for one antigen:isotype pair and incidence rate
</p>


<h3>Usage</h3>

<pre><code class='language-R'>f_dev0(lambda, csdata, lnpars, cond)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="f_dev0_+3A_lambda">lambda</code></td>
<td>
<p><code><a href="base.html#topic+numeric">numeric()</a></code> incidence parameter, in events per person-year</p>
</td></tr>
<tr><td><code id="f_dev0_+3A_csdata">csdata</code></td>
<td>
<p>cross-sectional sample data containing variables <code>value</code> and <code>age</code></p>
</td></tr>
<tr><td><code id="f_dev0_+3A_lnpars">lnpars</code></td>
<td>
<p>longitudinal antibody decay model parameters <code>alpha</code>, <code>y1</code>, and <code>d</code></p>
</td></tr>
<tr><td><code id="f_dev0_+3A_cond">cond</code></td>
<td>
<p>measurement noise parameters <code>nu</code>, <code>eps</code>, <code>y.low</code>, and <code>y.high</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>interface with C lib <code>serocalc.so</code>
</p>


<h3>Value</h3>

<p>a <code><a href="base.html#topic+numeric">numeric()</a></code> negative log-likelihood,
corresponding to input <code>lambda</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(tibble)

# load in longitudinal parameters
curve_params &lt;-
  typhoid_curves_nostrat_100 %&gt;%
  filter(antigen_iso %in% c("HlyE_IgA", "HlyE_IgG"))

# load in pop data
xs_data &lt;-
  sees_pop_data_pk_100

#Load noise params
noise_params &lt;- tibble(
  antigen_iso = c("HlyE_IgG", "HlyE_IgA"),
  nu = c(0.5, 0.5),                          # Biologic noise (nu)
  eps = c(0, 0),                             # M noise (eps)
  y.low = c(1, 1),                           # low cutoff (llod)
  y.high = c(5e6, 5e6))                      # high cutoff (y.high)

cur_antibody = "HlyE_IgA"

cur_data &lt;-
  xs_data %&gt;%
  dplyr::filter(
   .data$catchment == "dhaka",
   .data$antigen_iso == cur_antibody) %&gt;%
  dplyr::slice_head(n = 100)

cur_curve_params &lt;-
  curve_params %&gt;%
  dplyr::filter(.data$antigen_iso == cur_antibody) %&gt;%
  dplyr::slice_head(n = 100)

cur_noise_params &lt;-
  noise_params %&gt;%
  dplyr::filter(.data$antigen_iso == cur_antibody)

if(!is.element('d', names(cur_curve_params)))
{
  cur_curve_params &lt;-
    cur_curve_params %&gt;%
    dplyr::mutate(
      alpha = .data$alpha * 365.25,
      d = .data$r - 1)
}

lambda = 0.1
f_dev0(
    lambda = lambda,
    csdata = cur_data,
    lnpars = cur_curve_params,
    cond = cur_noise_params
  )

</code></pre>

<hr>
<h2 id='fdev'>Calculate negative log-likelihood (deviance)</h2><span id='topic+fdev'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
</p>
<p><code>fdev()</code> was renamed to <code><a href="#topic+f_dev">f_dev()</a></code> to create a more
consistent API.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fdev(lambda, csdata, lnpars, cond)
</code></pre>

<hr>
<h2 id='graph_loglik'>Graph log-likelihood of data</h2><span id='topic+graph_loglik'></span>

<h3>Description</h3>

<p>Graph log-likelihood of data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>graph_loglik(
  pop_data,
  curve_params,
  noise_params,
  antigen_isos = pop_data %&gt;% get_biomarker_levels(),
  x = 10^seq(-3, 0, by = 0.1),
  highlight_points = NULL,
  highlight_point_names = "highlight_points",
  log_x = FALSE,
  previous_plot = NULL,
  curve_label = paste(antigen_isos, collapse = " + "),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="graph_loglik_+3A_pop_data">pop_data</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> with cross-sectional serology data
by antibody and age, and additional columns</p>
</td></tr>
<tr><td><code id="graph_loglik_+3A_curve_params">curve_params</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> containing MCMC samples of parameters
from the Bayesian posterior distribution of a longitudinal decay curve model.
The parameter columns must be named:
</p>

<ul>
<li> <p><code>antigen_iso</code>: a <code><a href="base.html#topic+character">character()</a></code> vector indicating antigen-isotype
combinations
</p>
</li>
<li> <p><code>iter</code>: an <code><a href="base.html#topic+integer">integer()</a></code> vector indicating MCMC sampling iterations
</p>
</li>
<li> <p><code>y0</code>: baseline antibody level at $t=0$ ($y(t=0)$)
</p>
</li>
<li> <p><code>y1</code>: antibody peak level (ELISA units)
</p>
</li>
<li> <p><code>t1</code>: duration of infection
</p>
</li>
<li> <p><code>alpha</code>: antibody decay rate
(1/days for the current longitudinal parameter sets)
</p>
</li>
<li> <p><code>r</code>: shape factor of antibody decay
</p>
</li></ul>
</td></tr>
<tr><td><code id="graph_loglik_+3A_noise_params">noise_params</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> (or <code><a href="tibble.html#topic+tibble">tibble::tibble()</a></code>)
containing the following variables,
specifying noise parameters for each antigen isotype:
</p>

<ul>
<li> <p><code>antigen_iso</code>: antigen isotype whose noise parameters are being specified
on each row
</p>
</li>
<li> <p><code>nu</code>: biological noise
</p>
</li>
<li> <p><code>eps</code>: measurement noise
</p>
</li>
<li> <p><code>y.low</code>: lower limit of detection for the current antigen isotype
</p>
</li>
<li> <p><code>y.high</code>: upper limit of detection for the current antigen isotype
</p>
</li></ul>
</td></tr>
<tr><td><code id="graph_loglik_+3A_antigen_isos">antigen_isos</code></td>
<td>
<p>Character vector listing one or more antigen isotypes.
Values must match <code>pop_data</code>.</p>
</td></tr>
<tr><td><code id="graph_loglik_+3A_x">x</code></td>
<td>
<p>sequence of lambda values to graph</p>
</td></tr>
<tr><td><code id="graph_loglik_+3A_highlight_points">highlight_points</code></td>
<td>
<p>a possible highlighted value</p>
</td></tr>
<tr><td><code id="graph_loglik_+3A_highlight_point_names">highlight_point_names</code></td>
<td>
<p>labels for highlighted points</p>
</td></tr>
<tr><td><code id="graph_loglik_+3A_log_x">log_x</code></td>
<td>
<p>should the x-axis be on a logarithmic scale (<code>TRUE</code>)
or linear scale (<code>FALSE</code>, default)?</p>
</td></tr>
<tr><td><code id="graph_loglik_+3A_previous_plot">previous_plot</code></td>
<td>
<p>if not NULL, the current data is added to the
existing graph</p>
</td></tr>
<tr><td><code id="graph_loglik_+3A_curve_label">curve_label</code></td>
<td>
<p>if not NULL, add a label for the curve</p>
</td></tr>
<tr><td><code id="graph_loglik_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="#topic+log_likelihood">log_likelihood</a></code>
</p>

<dl>
<dt><code>verbose</code></dt><dd><p>logical: if TRUE, print verbose log information to console</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code><a href="ggplot2.html#topic+ggplot">ggplot2::ggplot()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(tibble)

# Load cross-sectional data
xs_data &lt;-
  sees_pop_data_pk_100

# Load curve parameters and subset for the purposes of this example
curve &lt;-
  typhoid_curves_nostrat_100 %&gt;%
  filter(antigen_iso %in% c("HlyE_IgA", "HlyE_IgG"))

# Load noise parameters
cond &lt;- tibble(
  antigen_iso = c("HlyE_IgG", "HlyE_IgA"),
  nu = c(0.5, 0.5),                          # Biologic noise (nu)
  eps = c(0, 0),                             # M noise (eps)
  y.low = c(1, 1),                           # Low cutoff (llod)
  y.high = c(5e6, 5e6))                      # High cutoff (y.high)

# Graph the log likelihood
lik_HlyE_IgA &lt;- # nolint: object_name_linter
  graph_loglik(
    pop_data = xs_data,
    curve_params = curve,
    noise_params = cond,
    antigen_isos = "HlyE_IgA",
    log_x = TRUE
)

lik_HlyE_IgA # nolint: object_name_linter

</code></pre>

<hr>
<h2 id='graph.curve.params'>Graph estimated antibody decay curve</h2><span id='topic+graph.curve.params'></span>

<h3>Description</h3>

<p>Graph estimated antibody decay curve
</p>


<h3>Usage</h3>

<pre><code class='language-R'>graph.curve.params(
  curve_params,
  antigen_isos = unique(curve_params$antigen_iso),
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="graph.curve.params_+3A_curve_params">curve_params</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> containing MCMC samples of antibody decay curve parameters</p>
</td></tr>
<tr><td><code id="graph.curve.params_+3A_antigen_isos">antigen_isos</code></td>
<td>
<p>antigen isotypes</p>
</td></tr>
<tr><td><code id="graph.curve.params_+3A_verbose">verbose</code></td>
<td>
<p>verbose output</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code><a href="ggplot2.html#topic+ggplot">ggplot2::ggplot()</a></code> object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>curve &lt;-
  typhoid_curves_nostrat_100 |&gt;
  dplyr::filter(antigen_iso %in% c("HlyE_IgA", "HlyE_IgG"))

plot1 &lt;- graph.curve.params(curve)

print(plot1)

</code></pre>

<hr>
<h2 id='ldpar'>extract a row from longitudinal parameter set</h2><span id='topic+ldpar'></span>

<h3>Description</h3>

<p>take a random sample from longitudinal parameter set
given age at infection, for a  list of antibodies
<a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
<code>ldpar()</code> was renamed to <code>row_longitudinal_parameter()</code> to create a more
consistent API.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ldpar(age, antigen_isos, nmc, npar, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ldpar_+3A_age">age</code></td>
<td>
<p>age at infection</p>
</td></tr>
<tr><td><code id="ldpar_+3A_antigen_isos">antigen_isos</code></td>
<td>
<p>antigen isotypes</p>
</td></tr>
<tr><td><code id="ldpar_+3A_nmc">nmc</code></td>
<td>
<p>mcmc sample to use</p>
</td></tr>
<tr><td><code id="ldpar_+3A_npar">npar</code></td>
<td>
<p>number of parameters</p>
</td></tr>
<tr><td><code id="ldpar_+3A_...">...</code></td>
<td>
<p>passed to <code>simpar()</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>an array of parameters:
c(y0,b0,mu0,mu1,c1,alpha,shape)
</p>

<hr>
<h2 id='llik'>Calculate log-likelihood</h2><span id='topic+llik'></span>

<h3>Description</h3>

<p>Calculates the log-likelihood of a set of cross-sectional antibody response
data, for a given incidence rate (<code>lambda</code>) value.
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
</p>
<p><code>llik()</code> was renamed to <code><a href="#topic+log_likelihood">log_likelihood()</a></code> to create a more
consistent API.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>llik(...)
</code></pre>

<hr>
<h2 id='load_curve_params'>Load antibody decay curve parameter samples</h2><span id='topic+load_curve_params'></span>

<h3>Description</h3>

<p>Load antibody decay curve parameter samples
</p>


<h3>Usage</h3>

<pre><code class='language-R'>load_curve_params(file_path, antigen_isos = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="load_curve_params_+3A_file_path">file_path</code></td>
<td>
<p>path to an RDS file containing MCMC samples of antibody decay curve parameters <code>y0</code>, <code>y1</code>, <code>t1</code>, <code>alpha</code>, and <code>r</code>, stored as a <code><a href="base.html#topic+data.frame">data.frame()</a></code> or <a href="tibble.html#topic+tbl_df-class">tibble::tbl_df</a></p>
</td></tr>
<tr><td><code id="load_curve_params_+3A_antigen_isos">antigen_isos</code></td>
<td>
<p><code><a href="base.html#topic+character">character()</a></code> vector of antigen isotypes to be used in analyses</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>curve_params</code> object (a <a href="tibble.html#topic+tbl_df-class">tibble::tbl_df</a> with extra attribute <code>antigen_isos</code>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>curve &lt;- load_curve_params(serocalculator_example("example_curve_params.rds"))

print(curve)

</code></pre>

<hr>
<h2 id='load_noise_params'>Load noise parameters</h2><span id='topic+load_noise_params'></span>

<h3>Description</h3>

<p>Load noise parameters
</p>


<h3>Usage</h3>

<pre><code class='language-R'>load_noise_params(file_path, antigen_isos = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="load_noise_params_+3A_file_path">file_path</code></td>
<td>
<p>path to an RDS file containing biologic
and measurement noise of antibody decay curve parameters
<code>y.low</code>, <code>eps</code>, <code>nu</code>, and <code>y.high</code>,
stored as a <code><a href="base.html#topic+data.frame">data.frame()</a></code> or <a href="tibble.html#topic+tbl_df-class">tibble::tbl_df</a></p>
</td></tr>
<tr><td><code id="load_noise_params_+3A_antigen_isos">antigen_isos</code></td>
<td>
<p><code><a href="base.html#topic+character">character()</a></code> vector
of antigen isotypes to be used in analyses</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>noise</code> object (a <a href="tibble.html#topic+tbl_df-class">tibble::tbl_df</a>
with extra attribute <code>antigen_isos</code>)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>noise &lt;- load_noise_params(serocalculator_example("example_noise_params.rds"))
print(noise)

</code></pre>

<hr>
<h2 id='load_pop_data'>Load a cross-sectional antibody survey data set</h2><span id='topic+load_pop_data'></span>

<h3>Description</h3>

<p>Load a cross-sectional antibody survey data set
</p>


<h3>Usage</h3>

<pre><code class='language-R'>load_pop_data(file_path, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="load_pop_data_+3A_file_path">file_path</code></td>
<td>
<p>path to an RDS file containing a cross-sectional antibody
survey data set, stored as a <code><a href="base.html#topic+data.frame">data.frame()</a></code> or <a href="tibble.html#topic+tbl_df-class">tibble::tbl_df</a></p>
</td></tr>
<tr><td><code id="load_pop_data_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="#topic+as_pop_data">as_pop_data</a></code>
</p>

<dl>
<dt><code>data</code></dt><dd><p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> or <a href="tibble.html#topic+tbl_df-class">tibble::tbl_df</a></p>
</dd>
<dt><code>antigen_isos</code></dt><dd><p><code><a href="base.html#topic+character">character()</a></code>
vector of antigen isotypes to be used in analyses</p>
</dd>
<dt><code>age</code></dt><dd><p>a <code><a href="base.html#topic+character">character()</a></code> identifying the age column</p>
</dd>
<dt><code>id</code></dt><dd><p>a <code><a href="base.html#topic+character">character()</a></code> identifying the id column</p>
</dd>
<dt><code>value</code></dt><dd><p>a <code><a href="base.html#topic+character">character()</a></code> identifying the value column</p>
</dd>
<dt><code>standardize</code></dt><dd><p>a <code><a href="base.html#topic+logical">logical()</a></code> to determine standardization of columns</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>pop_data</code> object (a <a href="tibble.html#topic+tbl_df-class">tibble::tbl_df</a> with extra attributes)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>xs_data &lt;- load_pop_data(serocalculator_example("example_pop_data.rds"))

print(xs_data)
</code></pre>

<hr>
<h2 id='log_likelihood'>Calculate log-likelihood</h2><span id='topic+log_likelihood'></span>

<h3>Description</h3>

<p>Calculates the log-likelihood of a set of cross-sectional antibody response
data, for a given incidence rate (<code>lambda</code>) value.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>log_likelihood(
  lambda,
  pop_data,
  curve_params,
  noise_params,
  antigen_isos = get_biomarker_levels(pop_data),
  verbose = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="log_likelihood_+3A_lambda">lambda</code></td>
<td>
<p>a <a href="base.html#topic+numeric">numeric</a> vector of incidence parameters, in events per person-year</p>
</td></tr>
<tr><td><code id="log_likelihood_+3A_pop_data">pop_data</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> with cross-sectional serology data
by antibody and age, and additional columns</p>
</td></tr>
<tr><td><code id="log_likelihood_+3A_curve_params">curve_params</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> containing MCMC samples of parameters
from the Bayesian posterior distribution of a longitudinal decay curve model.
The parameter columns must be named:
</p>

<ul>
<li> <p><code>antigen_iso</code>: a <code><a href="base.html#topic+character">character()</a></code> vector indicating antigen-isotype
combinations
</p>
</li>
<li> <p><code>iter</code>: an <code><a href="base.html#topic+integer">integer()</a></code> vector indicating MCMC sampling iterations
</p>
</li>
<li> <p><code>y0</code>: baseline antibody level at $t=0$ ($y(t=0)$)
</p>
</li>
<li> <p><code>y1</code>: antibody peak level (ELISA units)
</p>
</li>
<li> <p><code>t1</code>: duration of infection
</p>
</li>
<li> <p><code>alpha</code>: antibody decay rate
(1/days for the current longitudinal parameter sets)
</p>
</li>
<li> <p><code>r</code>: shape factor of antibody decay
</p>
</li></ul>
</td></tr>
<tr><td><code id="log_likelihood_+3A_noise_params">noise_params</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> (or <code><a href="tibble.html#topic+tibble">tibble::tibble()</a></code>)
containing the following variables,
specifying noise parameters for each antigen isotype:
</p>

<ul>
<li> <p><code>antigen_iso</code>: antigen isotype whose noise parameters are being specified
on each row
</p>
</li>
<li> <p><code>nu</code>: biological noise
</p>
</li>
<li> <p><code>eps</code>: measurement noise
</p>
</li>
<li> <p><code>y.low</code>: lower limit of detection for the current antigen isotype
</p>
</li>
<li> <p><code>y.high</code>: upper limit of detection for the current antigen isotype
</p>
</li></ul>
</td></tr>
<tr><td><code id="log_likelihood_+3A_antigen_isos">antigen_isos</code></td>
<td>
<p>Character vector listing one or more antigen isotypes.
Values must match <code>pop_data</code>.</p>
</td></tr>
<tr><td><code id="log_likelihood_+3A_verbose">verbose</code></td>
<td>
<p>logical: if TRUE, print verbose log information to console</p>
</td></tr>
<tr><td><code id="log_likelihood_+3A_...">...</code></td>
<td>
<p>additional arguments passed to other functions
(not currently used).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the log-likelihood of the data with the current parameter values
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
library(tibble)

# Load cross-sectional data
xs_data &lt;-
  sees_pop_data_pk_100

# Load curve parameters and subset for the purposes of this example
curve &lt;-
  typhoid_curves_nostrat_100 %&gt;%
  filter(antigen_iso %in% c("HlyE_IgA", "HlyE_IgG"))

# Load noise params
cond &lt;- tibble(
  antigen_iso = c("HlyE_IgG", "HlyE_IgA"),
  nu = c(0.5, 0.5), # Biologic noise (nu)
  eps = c(0, 0), # M noise (eps)
  y.low = c(1, 1), # low cutoff (llod)
  y.high = c(5e6, 5e6)
) # high cutoff (y.high)

# Calculate log-likelihood
ll_AG &lt;- log_likelihood(
  pop_data = xs_data,
  curve_params = curve,
  noise_params = cond,
  antigen_isos = c("HlyE_IgG", "HlyE_IgA"),
  lambda = 0.1
) %&gt;% print()

</code></pre>

<hr>
<h2 id='mk_baseline'>generate random sample from baseline distribution</h2><span id='topic+mk_baseline'></span>

<h3>Description</h3>

<p>generate random sample from baseline distribution
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mk_baseline(kab, n = 1, blims, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mk_baseline_+3A_kab">kab</code></td>
<td>
<p>index for which row of antibody baseline limits to read from <code>blims</code></p>
</td></tr>
<tr><td><code id="mk_baseline_+3A_n">n</code></td>
<td>
<p>number of observations</p>
</td></tr>
<tr><td><code id="mk_baseline_+3A_blims">blims</code></td>
<td>
<p>range of possible baseline antibody levels</p>
</td></tr>
<tr><td><code id="mk_baseline_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code><a href="base.html#topic+numeric">numeric()</a></code> vector
</p>

<hr>
<h2 id='mkbaseline'>generate random sample from baseline distribution</h2><span id='topic+mkbaseline'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
<code>mkbaseline()</code> was renamed to <code><a href="#topic+mk_baseline">mk_baseline()</a></code> to create a more
consistent API.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mkbaseline(kab, n = 1, blims, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mkbaseline_+3A_kab">kab</code></td>
<td>
<p>index for which row of antibody baseline limits to read from <code>blims</code></p>
</td></tr>
<tr><td><code id="mkbaseline_+3A_n">n</code></td>
<td>
<p>number of observations</p>
</td></tr>
<tr><td><code id="mkbaseline_+3A_blims">blims</code></td>
<td>
<p>range of possible baseline antibody levels</p>
</td></tr>
<tr><td><code id="mkbaseline_+3A_...">...</code></td>
<td>
<p>not currently used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code><a href="base.html#topic+numeric">numeric()</a></code> vector
</p>

<hr>
<h2 id='plot_curve_params_one_ab'>Graph an antibody decay curve model</h2><span id='topic+plot_curve_params_one_ab'></span>

<h3>Description</h3>

<p>Graph an antibody decay curve model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_curve_params_one_ab(
  object,
  verbose = FALSE,
  alpha = 0.4,
  n_curves = 100,
  n_points = 1000,
  log_x = FALSE,
  log_y = TRUE,
  rows_to_graph = seq_len(min(n_curves, nrow(object))),
  xlim = c(10^-1, 10^3.1),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_curve_params_one_ab_+3A_object">object</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> of curve parameters (one or more MCMC samples)</p>
</td></tr>
<tr><td><code id="plot_curve_params_one_ab_+3A_verbose">verbose</code></td>
<td>
<p>verbose output</p>
</td></tr>
<tr><td><code id="plot_curve_params_one_ab_+3A_alpha">alpha</code></td>
<td>
<p>(passed to <code><a href="ggplot2.html#topic+geom_function">ggplot2::geom_function()</a></code>)
how transparent the curves should be:
</p>

<ul>
<li><p> 0 = fully transparent (invisible)
</p>
</li>
<li><p> 1 = fully opaque
</p>
</li></ul>
</td></tr>
<tr><td><code id="plot_curve_params_one_ab_+3A_n_curves">n_curves</code></td>
<td>
<p>how many curves to plot (see details).</p>
</td></tr>
<tr><td><code id="plot_curve_params_one_ab_+3A_n_points">n_points</code></td>
<td>
<p>Number of points to interpolate along the x axis
(passed to <code><a href="ggplot2.html#topic+geom_function">ggplot2::geom_function()</a></code>)</p>
</td></tr>
<tr><td><code id="plot_curve_params_one_ab_+3A_log_x">log_x</code></td>
<td>
<p>should the x-axis be on a logarithmic scale (<code>TRUE</code>)
or linear scale (<code>FALSE</code>, default)?</p>
</td></tr>
<tr><td><code id="plot_curve_params_one_ab_+3A_log_y">log_y</code></td>
<td>
<p>should the Y-axis be on a logarithmic scale
(default, <code>TRUE</code>) or linear scale (<code>FALSE</code>)?</p>
</td></tr>
<tr><td><code id="plot_curve_params_one_ab_+3A_rows_to_graph">rows_to_graph</code></td>
<td>
<p>which rows of <code>curve_params</code> to plot
(overrides <code>n_curves</code>).</p>
</td></tr>
<tr><td><code id="plot_curve_params_one_ab_+3A_xlim">xlim</code></td>
<td>
<p>range of x values to graph</p>
</td></tr>
<tr><td><code id="plot_curve_params_one_ab_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="ggplot2.html#topic+geom_function">ggplot2::geom_function</a></code>
</p>

<dl>
<dt><code>mapping</code></dt><dd><p>Set of aesthetic mappings created by <code><a href="ggplot2.html#topic+aes">aes()</a></code>. If specified and
<code>inherit.aes = TRUE</code> (the default), it is combined with the default mapping
at the top level of the plot. You must supply <code>mapping</code> if there is no plot
mapping.</p>
</dd>
<dt><code>data</code></dt><dd><p>Ignored by <code>stat_function()</code>, do not use.</p>
</dd>
<dt><code>stat</code></dt><dd><p>The statistical transformation to use on the data for this layer.
When using a <code style="white-space: pre;">&#8288;geom_*()&#8288;</code> function to construct a layer, the <code>stat</code>
argument can be used the override the default coupling between geoms and
stats. The <code>stat</code> argument accepts the following:
</p>

<ul>
<li><p> A <code>Stat</code> ggproto subclass, for example <code>StatCount</code>.
</p>
</li>
<li><p> A string naming the stat. To give the stat as a string, strip the
function name of the <code>stat_</code> prefix. For example, to use <code>stat_count()</code>,
give the stat as <code>"count"</code>.
</p>
</li>
<li><p> For more information and other ways to specify the stat, see the
<a href="ggplot2.html#topic+layer_stats">layer stat</a> documentation.
</p>
</li></ul>
</dd>
<dt><code>position</code></dt><dd><p>A position adjustment to use on the data for this layer. This
can be used in various ways, including to prevent overplotting and
improving the display. The <code>position</code> argument accepts the following:
</p>

<ul>
<li><p> The result of calling a position function, such as <code>position_jitter()</code>.
This method allows for passing extra arguments to the position.
</p>
</li>
<li><p> A string naming the position adjustment. To give the position as a
string, strip the function name of the <code>position_</code> prefix. For example,
to use <code>position_jitter()</code>, give the position as <code>"jitter"</code>.
</p>
</li>
<li><p> For more information and other ways to specify the position, see the
<a href="ggplot2.html#topic+layer_positions">layer position</a> documentation.
</p>
</li></ul>
</dd>
<dt><code>na.rm</code></dt><dd><p>If <code>FALSE</code>, the default, missing values are removed with
a warning. If <code>TRUE</code>, missing values are silently removed.</p>
</dd>
<dt><code>show.legend</code></dt><dd><p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.
It can also be a named logical vector to finely select the aesthetics to
display.</p>
</dd>
<dt><code>inherit.aes</code></dt><dd><p>If <code>FALSE</code>, overrides the default aesthetics,
rather than combining with them. This is most useful for helper functions
that define both data and aesthetics and shouldn't inherit behaviour from
the default plot specification, e.g. <code><a href="ggplot2.html#topic+borders">borders()</a></code>.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Details</h3>



<h4><code>n_curves</code> and <code>rows_to_graph</code></h4>

<p>In most cases, <code>curve_params</code> will contain too many rows of MCMC
samples for all of these samples to be plotted at once.
</p>

<ul>
<li><p> Setting the  <code>n_curves</code> argument to a value smaller than the
number of rows in <code>curve_params</code> will cause this function to select
the first <code>n_curves</code> rows to graph.
</p>
</li>
<li><p> Setting <code>n_curves</code> larger than the number of rows in ' will
result all curves being plotted.
</p>
</li>
<li><p> If the user directly specifies the <code>rows_to_graph</code> argument,
then <code>n_curves</code> has no effect.
</p>
</li></ul>




<h3>Value</h3>

<p>a <code><a href="ggplot2.html#topic+ggplot">ggplot2::ggplot()</a></code> object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr) # loads the `%&gt;%` operator and `dplyr::filter()`

curve &lt;-
  typhoid_curves_nostrat_100 %&gt;%
  filter(antigen_iso == ("HlyE_IgG")) %&gt;%
  serocalculator:::plot_curve_params_one_ab()

  curve

</code></pre>

<hr>
<h2 id='print.seroincidence'>Print Method for <code>seroincidence</code> Object</h2><span id='topic+print.seroincidence'></span>

<h3>Description</h3>

<p>Custom <code><a href="base.html#topic+print">print()</a></code> function to show output of the seroincidence calculator <code><a href="#topic+est.incidence">est.incidence()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'seroincidence'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.seroincidence_+3A_x">x</code></td>
<td>
<p>A list containing output of function <code><a href="#topic+est.incidence.by">est.incidence.by()</a></code>.</p>
</td></tr>
<tr><td><code id="print.seroincidence_+3A_...">...</code></td>
<td>
<p>Additional arguments affecting the summary produced.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an <a href="base.html#topic+invisible">invisible</a> copy of input parameter <code>x</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Estimate seroincidence
seroincidence &lt;- est.incidence.by(...)

# Print the seroincidence object to the console
print(seroincidence)

# Or simply type (appropriate print method will be invoked automatically)
seroincidence

## End(Not run)

</code></pre>

<hr>
<h2 id='print.seroincidence.by'>Print Method for <code>seroincidence.by</code> Object</h2><span id='topic+print.seroincidence.by'></span>

<h3>Description</h3>

<p>Custom <code><a href="base.html#topic+print">print()</a></code> function to show output of the seroincidence calculator <code><a href="#topic+est.incidence.by">est.incidence.by()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'seroincidence.by'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.seroincidence.by_+3A_x">x</code></td>
<td>
<p>A list containing output of function <code><a href="#topic+est.incidence.by">est.incidence.by()</a></code>.</p>
</td></tr>
<tr><td><code id="print.seroincidence.by_+3A_...">...</code></td>
<td>
<p>Additional arguments affecting the summary produced.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an <a href="base.html#topic+invisible">invisible</a> copy of input parameter <code>x</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Estimate seroincidence
seroincidence &lt;- est.incidence.by(...)

# Print the seroincidence object to the console
print(seroincidence)

# Or simply type (appropriate print method will be invoked automatically)
seroincidence

## End(Not run)

</code></pre>

<hr>
<h2 id='print.summary.seroincidence.by'>Print Method for Seroincidence Summary Object</h2><span id='topic+print.summary.seroincidence.by'></span>

<h3>Description</h3>

<p>Custom <code><a href="base.html#topic+print">print()</a></code> function for &quot;summary.seroincidence.by&quot; objects (constructed by <code><a href="#topic+summary.seroincidence.by">summary.seroincidence.by()</a></code>)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'summary.seroincidence.by'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.summary.seroincidence.by_+3A_x">x</code></td>
<td>
<p>A &quot;summary.seroincidence.by&quot; object (constructed by <code><a href="#topic+summary.seroincidence.by">summary.seroincidence.by()</a></code>)</p>
</td></tr>
<tr><td><code id="print.summary.seroincidence.by_+3A_...">...</code></td>
<td>
<p>Additional arguments affecting the summary produced.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an <a href="base.html#topic+invisible">invisible</a> copy of input parameter <code>x</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Estimate seroincidence
seroincidence &lt;- est.incidence.by(...)

# Calculate summary statistics for the seroincidence object
seroincidenceSummary &lt;- summary(seroincidence)

# Print the summary of seroincidence object to the console
print(seroincidenceSummary)

# Or simply type (appropriate print method will be invoked automatically)
seroincidenceSummary

## End(Not run)

</code></pre>

<hr>
<h2 id='reexports'>Objects exported from other packages</h2><span id='topic+reexports'></span><span id='topic+autoplot'></span>

<h3>Description</h3>

<p>These objects are imported from other packages. Follow the links
below to see their documentation.
</p>

<dl>
<dt>ggplot2</dt><dd><p><code><a href="ggplot2.html#topic+autoplot">autoplot</a></code></p>
</dd>
</dl>

<hr>
<h2 id='row_longitudinal_parameter'>extract a row from longitudinal parameter set</h2><span id='topic+row_longitudinal_parameter'></span>

<h3>Description</h3>

<p>take a random sample from longitudinal parameter set
given age at infection, for a  list of antibodies
</p>


<h3>Usage</h3>

<pre><code class='language-R'>row_longitudinal_parameter(age, antigen_isos, nmc, npar, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="row_longitudinal_parameter_+3A_age">age</code></td>
<td>
<p>age at infection</p>
</td></tr>
<tr><td><code id="row_longitudinal_parameter_+3A_antigen_isos">antigen_isos</code></td>
<td>
<p>antigen isotypes</p>
</td></tr>
<tr><td><code id="row_longitudinal_parameter_+3A_nmc">nmc</code></td>
<td>
<p>mcmc sample to use</p>
</td></tr>
<tr><td><code id="row_longitudinal_parameter_+3A_npar">npar</code></td>
<td>
<p>number of parameters</p>
</td></tr>
<tr><td><code id="row_longitudinal_parameter_+3A_...">...</code></td>
<td>
<p>passed to <code>simpar()</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>an array of parameters:
c(y0,b0,mu0,mu1,c1,alpha,shape)
</p>

<hr>
<h2 id='sees_pop_data_pk_100'>Small example cross-sectional data set</h2><span id='topic+sees_pop_data_pk_100'></span>

<h3>Description</h3>

<p>A subset of data from the SEES data, for examples and testing.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sees_pop_data_pk_100
</code></pre>


<h3>Format</h3>



<h4><code>sees_pop_data_pk_100</code></h4>

<p>A <code>pop_data</code> object (from <code><a href="#topic+as_pop_data">as_pop_data()</a></code>) with 200 rows and 8 columns:
</p>

<dl>
<dt>id</dt><dd><p>Observation ID</p>
</dd>
<dt>Country</dt><dd><p>Country where the participant was living</p>
</dd>
<dt>cluster</dt><dd><p>survey sampling cluster</p>
</dd>
<dt>catchment</dt><dd><p>survey catchment area</p>
</dd>
<dt>age</dt><dd><p>participant's age when sampled, in years</p>
</dd>
<dt>antigen_iso</dt><dd><p>which antigen and isotype are being measured
(data is in long format)</p>
</dd>
<dt>value</dt><dd><p>concentration of antigen isotype, in ELISA units</p>
</dd>
</dl>




<h3>Source</h3>

<p><a href="https://osf.io/n6cp3">https://osf.io/n6cp3</a>
</p>

<hr>
<h2 id='sees_pop_data_pk_100_old_names'>Small example cross-sectional data set</h2><span id='topic+sees_pop_data_pk_100_old_names'></span>

<h3>Description</h3>

<p>A subset of data from the SEES data, for examples and testing.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sees_pop_data_pk_100_old_names
</code></pre>


<h3>Format</h3>



<h4><code>sees_pop_data_pk_100_old_names</code></h4>

<p>A <code>pop_data</code> object (from <code><a href="#topic+as_pop_data">as_pop_data()</a></code>) with 200 rows and 8 columns:
</p>

<dl>
<dt>index_id</dt><dd><p>Observation ID</p>
</dd>
<dt>Country</dt><dd><p>Country where the participant was living</p>
</dd>
<dt>cluster</dt><dd><p>survey sampling cluster</p>
</dd>
<dt>catchment</dt><dd><p>survey catchment area</p>
</dd>
<dt>Age</dt><dd><p>participant's age when sampled, in years</p>
</dd>
<dt>antigen_iso</dt><dd><p>which antigen and isotype are being measured
(data is in long format)</p>
</dd>
<dt>result</dt><dd><p>concentration of antigen isotype, in ELISA units</p>
</dd>
</dl>




<h3>Source</h3>

<p><a href="https://osf.io/n6cp3">https://osf.io/n6cp3</a>
</p>

<hr>
<h2 id='serocalculator_example'>Get path to an example file</h2><span id='topic+serocalculator_example'></span>

<h3>Description</h3>

<p>The <a href="#topic+serocalculator">serocalculator</a> package comes bundled with a number of sample files
in its <code>inst/extdata</code> directory.
This <code>serocalculator_example()</code> function make those sample files
easy to access.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>serocalculator_example(file = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="serocalculator_example_+3A_file">file</code></td>
<td>
<p>Name of file. If <code>NULL</code>, the example files will be listed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Adapted from <code><a href="readr.html#topic+readr_example">readr::readr_example()</a></code> following the guidance in
<a href="https://r-pkgs.org/data.html#sec-data-example-path-helper">https://r-pkgs.org/data.html#sec-data-example-path-helper</a>.
</p>


<h3>Value</h3>

<p>a <a href="base.html#topic+character">character</a> string providing
the path to the file specified by <code>file</code>,
or a vector or available files if <code>file = NULL</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>serocalculator_example()
serocalculator_example("example_pop_data.csv")
</code></pre>

<hr>
<h2 id='sim.cs'>Simulate a cross-sectional serosurvey with noise</h2><span id='topic+sim.cs'></span>

<h3>Description</h3>

<p>Makes a cross-sectional data set (age, y(t) set)
and adds noise, if desired.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim.cs(
  lambda = 0.1,
  n.smpl = 100,
  age.rng = c(0, 20),
  age.fx = NA,
  antigen_isos,
  n.mc = 0,
  renew.params = FALSE,
  add.noise = FALSE,
  curve_params,
  noise_limits,
  format = "wide",
  verbose = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sim.cs_+3A_lambda">lambda</code></td>
<td>
<p>a <code><a href="base.html#topic+numeric">numeric()</a></code> scalar indicating the incidence rate (in events per person-years)</p>
</td></tr>
<tr><td><code id="sim.cs_+3A_n.smpl">n.smpl</code></td>
<td>
<p>number of samples to simulate</p>
</td></tr>
<tr><td><code id="sim.cs_+3A_age.rng">age.rng</code></td>
<td>
<p>age range of sampled individuals, in years</p>
</td></tr>
<tr><td><code id="sim.cs_+3A_age.fx">age.fx</code></td>
<td>
<p>specify the curve parameters to use by age (does nothing at present?)</p>
</td></tr>
<tr><td><code id="sim.cs_+3A_antigen_isos">antigen_isos</code></td>
<td>
<p>Character vector with one or more antibody names. Values must match <code>curve_params</code>.</p>
</td></tr>
<tr><td><code id="sim.cs_+3A_n.mc">n.mc</code></td>
<td>
<p>how many MCMC samples to use:
</p>

<ul>
<li><p> when <code>n.mc</code> is in <code>1:4000</code> a fixed posterior sample is used
</p>
</li>
<li><p> when <code>n.mc</code> = <code>0</code>, a random sample is chosen
</p>
</li></ul>
</td></tr>
<tr><td><code id="sim.cs_+3A_renew.params">renew.params</code></td>
<td>
<p>whether to generate a new parameter set for each infection
</p>

<ul>
<li> <p><code>renew.params = TRUE</code> generates a new parameter set for each infection
</p>
</li>
<li> <p><code>renew.params = FALSE</code> keeps the one selected at birth, but updates baseline y0
</p>
</li></ul>
</td></tr>
<tr><td><code id="sim.cs_+3A_add.noise">add.noise</code></td>
<td>
<p>a <code><a href="base.html#topic+logical">logical()</a></code> indicating whether to add biological and measurement noise</p>
</td></tr>
<tr><td><code id="sim.cs_+3A_curve_params">curve_params</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> containing MCMC samples of parameters
from the Bayesian posterior distribution of a longitudinal decay curve model.
The parameter columns must be named:
</p>

<ul>
<li> <p><code>antigen_iso</code>: a <code><a href="base.html#topic+character">character()</a></code> vector indicating antigen-isotype
combinations
</p>
</li>
<li> <p><code>iter</code>: an <code><a href="base.html#topic+integer">integer()</a></code> vector indicating MCMC sampling iterations
</p>
</li>
<li> <p><code>y0</code>: baseline antibody level at $t=0$ ($y(t=0)$)
</p>
</li>
<li> <p><code>y1</code>: antibody peak level (ELISA units)
</p>
</li>
<li> <p><code>t1</code>: duration of infection
</p>
</li>
<li> <p><code>alpha</code>: antibody decay rate
(1/days for the current longitudinal parameter sets)
</p>
</li>
<li> <p><code>r</code>: shape factor of antibody decay
</p>
</li></ul>
</td></tr>
<tr><td><code id="sim.cs_+3A_noise_limits">noise_limits</code></td>
<td>
<p>biologic noise distribution parameters</p>
</td></tr>
<tr><td><code id="sim.cs_+3A_format">format</code></td>
<td>
<p>a <code><a href="base.html#topic+character">character()</a></code> variable, containing either:
</p>

<ul>
<li> <p><code>"long"</code> (one measurement per row) or
</p>
</li>
<li> <p><code>"wide"</code> (one serum sample per row)
</p>
</li></ul>
</td></tr>
<tr><td><code id="sim.cs_+3A_verbose">verbose</code></td>
<td>
<p>logical: if TRUE, print verbose log information to console</p>
</td></tr>
<tr><td><code id="sim.cs_+3A_...">...</code></td>
<td>
<p>additional arguments passed to <code>simcs.tinf()</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <a href="tibble.html#topic+tbl_df-class">tibble::tbl_df</a> containing simulated cross-sectional serosurvey data, with columns:
</p>

<ul>
<li> <p><code>age</code>: age (in days)
</p>
</li>
<li><p> one column for each element in the <code>antigen_iso</code> input argument
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Load curve parameters
curve &lt;-
  typhoid_curves_nostrat_100

# Specify the antibody-isotype responses to include in analyses
antibodies &lt;- c("HlyE_IgA", "HlyE_IgG")

# Set seed to reproduce results
set.seed(54321)

# Simulated incidence rate per person-year
lambda &lt;- 0.2;

# Range covered in simulations
lifespan &lt;- c(0, 10);

# Cross-sectional sample size
nrep &lt;- 100

# Biologic noise distribution
dlims &lt;- rbind(
  "HlyE_IgA" = c(min = 0, max = 0.5),
  "HlyE_IgG" = c(min = 0, max = 0.5)
)

# Generate cross-sectional data
csdata &lt;- sim.cs(
  curve_params = curve,
  lambda = lambda,
  n.smpl = nrep,
  age.rng = lifespan,
  antigen_isos = antibodies,
  n.mc = 0,
  renew.params = TRUE,
  add.noise = TRUE,
  noise_limits = dlims,
  format = "long"
)

</code></pre>

<hr>
<h2 id='sim.cs.multi'>Simulate multiple data sets</h2><span id='topic+sim.cs.multi'></span>

<h3>Description</h3>

<p>Simulate multiple data sets
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim.cs.multi(
  nclus = 10,
  lambdas = c(0.05, 0.1, 0.15, 0.2, 0.3),
  num_cores = max(1, parallel::detectCores() - 1),
  rng_seed = 1234,
  renew.params = TRUE,
  add.noise = TRUE,
  verbose = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sim.cs.multi_+3A_nclus">nclus</code></td>
<td>
<p>number of clusters</p>
</td></tr>
<tr><td><code id="sim.cs.multi_+3A_lambdas">lambdas</code></td>
<td>
<p>#incidence rate, in events/person*year</p>
</td></tr>
<tr><td><code id="sim.cs.multi_+3A_num_cores">num_cores</code></td>
<td>
<p>number of cores to use for parallel computations</p>
</td></tr>
<tr><td><code id="sim.cs.multi_+3A_rng_seed">rng_seed</code></td>
<td>
<p>starting seed for random number generator, passed to <code><a href="rngtools.html#topic+RNGseq">rngtools::RNGseq()</a></code></p>
</td></tr>
<tr><td><code id="sim.cs.multi_+3A_renew.params">renew.params</code></td>
<td>
<p>whether to generate a new parameter set for each infection
</p>

<ul>
<li> <p><code>renew.params = TRUE</code> generates a new parameter set for each infection
</p>
</li>
<li> <p><code>renew.params = FALSE</code> keeps the one selected at birth, but updates baseline y0
</p>
</li></ul>
</td></tr>
<tr><td><code id="sim.cs.multi_+3A_add.noise">add.noise</code></td>
<td>
<p>a <code><a href="base.html#topic+logical">logical()</a></code> indicating whether to add biological and measurement noise</p>
</td></tr>
<tr><td><code id="sim.cs.multi_+3A_verbose">verbose</code></td>
<td>
<p>whether to report verbose information</p>
</td></tr>
<tr><td><code id="sim.cs.multi_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="#topic+sim.cs">sim.cs</a></code>
</p>

<dl>
<dt><code>lambda</code></dt><dd><p>a <code><a href="base.html#topic+numeric">numeric()</a></code> scalar indicating the incidence rate (in events per person-years)</p>
</dd>
<dt><code>n.smpl</code></dt><dd><p>number of samples to simulate</p>
</dd>
<dt><code>age.rng</code></dt><dd><p>age range of sampled individuals, in years</p>
</dd>
<dt><code>age.fx</code></dt><dd><p>specify the curve parameters to use by age (does nothing at present?)</p>
</dd>
<dt><code>antigen_isos</code></dt><dd><p>Character vector with one or more antibody names. Values must match <code>curve_params</code>.</p>
</dd>
<dt><code>n.mc</code></dt><dd><p>how many MCMC samples to use:
</p>

<ul>
<li><p> when <code>n.mc</code> is in <code>1:4000</code> a fixed posterior sample is used
</p>
</li>
<li><p> when <code>n.mc</code> = <code>0</code>, a random sample is chosen
</p>
</li></ul>
</dd>
<dt><code>noise_limits</code></dt><dd><p>biologic noise distribution parameters</p>
</dd>
<dt><code>format</code></dt><dd><p>a <code><a href="base.html#topic+character">character()</a></code> variable, containing either:
</p>

<ul>
<li> <p><code>"long"</code> (one measurement per row) or
</p>
</li>
<li> <p><code>"wide"</code> (one serum sample per row)
</p>
</li></ul>
</dd>
<dt><code>curve_params</code></dt><dd><p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> containing MCMC samples of parameters
from the Bayesian posterior distribution of a longitudinal decay curve model.
The parameter columns must be named:
</p>

<ul>
<li> <p><code>antigen_iso</code>: a <code><a href="base.html#topic+character">character()</a></code> vector indicating antigen-isotype
combinations
</p>
</li>
<li> <p><code>iter</code>: an <code><a href="base.html#topic+integer">integer()</a></code> vector indicating MCMC sampling iterations
</p>
</li>
<li> <p><code>y0</code>: baseline antibody level at $t=0$ ($y(t=0)$)
</p>
</li>
<li> <p><code>y1</code>: antibody peak level (ELISA units)
</p>
</li>
<li> <p><code>t1</code>: duration of infection
</p>
</li>
<li> <p><code>alpha</code>: antibody decay rate
(1/days for the current longitudinal parameter sets)
</p>
</li>
<li> <p><code>r</code>: shape factor of antibody decay
</p>
</li></ul>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code><a href="tibble.html#topic+tibble">tibble::tibble()</a></code>
</p>

<hr>
<h2 id='simcs.tinf'>collect cross-sectional data</h2><span id='topic+simcs.tinf'></span>

<h3>Description</h3>

<p>output: (age, y(t) set)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simcs.tinf(
  lambda,
  n.smpl,
  age.rng,
  age.fx = NA,
  antigen_isos,
  n.mc = 0,
  renew.params = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="simcs.tinf_+3A_lambda">lambda</code></td>
<td>
<p>seroconversion rate (in events/person-day)</p>
</td></tr>
<tr><td><code id="simcs.tinf_+3A_n.smpl">n.smpl</code></td>
<td>
<p>number of samples n.smpl (= nr of simulated records)</p>
</td></tr>
<tr><td><code id="simcs.tinf_+3A_age.rng">age.rng</code></td>
<td>
<p>age range to use for simulating data, in days</p>
</td></tr>
<tr><td><code id="simcs.tinf_+3A_age.fx">age.fx</code></td>
<td>
<p>age.fx for parameter sample (age.fx = NA for age at infection)</p>
</td></tr>
<tr><td><code id="simcs.tinf_+3A_antigen_isos">antigen_isos</code></td>
<td>
<p>Character vector with one or more antibody names. Values must match <code>curve_params</code>.</p>
</td></tr>
<tr><td><code id="simcs.tinf_+3A_n.mc">n.mc</code></td>
<td>

<ul>
<li><p> when <code>n.mc</code> is in 1:4000 a fixed posterior sample is used
</p>
</li>
<li><p> when n.mc = 0 a random sample is chosen
</p>
</li></ul>
</td></tr>
<tr><td><code id="simcs.tinf_+3A_renew.params">renew.params</code></td>
<td>

<ul>
<li> <p><code>renew.params = TRUE</code> generates a new parameter set for each infection
</p>
</li>
<li> <p><code>renew.params = FALSE</code> keeps the one selected at birth, but updates baseline y0
</p>
</li></ul>
</td></tr>
<tr><td><code id="simcs.tinf_+3A_...">...</code></td>
<td>
<p>arguments passed to <code><a href="#topic+simresp.tinf">simresp.tinf()</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>an <code><a href="base.html#topic+array">array()</a></code>
</p>

<hr>
<h2 id='simresp.tinf'>simulate antibody kinetics of y over a time interval</h2><span id='topic+simresp.tinf'></span>

<h3>Description</h3>

<p>simulate antibody kinetics of y over a time interval
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simresp.tinf(
  lambda,
  t.end,
  age.fx,
  antigen_isos,
  n.mc = 0,
  renew.params,
  predpar,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="simresp.tinf_+3A_lambda">lambda</code></td>
<td>
<p>seroconversion rate (1/days),</p>
</td></tr>
<tr><td><code id="simresp.tinf_+3A_t.end">t.end</code></td>
<td>
<p>end of time interval (beginning is time 0) in days(?)</p>
</td></tr>
<tr><td><code id="simresp.tinf_+3A_age.fx">age.fx</code></td>
<td>
<p>parameter estimates for fixed age (age.fx in years) or not.
when age.fx = NA then age at infection is used.</p>
</td></tr>
<tr><td><code id="simresp.tinf_+3A_antigen_isos">antigen_isos</code></td>
<td>
<p>antigen isotypes</p>
</td></tr>
<tr><td><code id="simresp.tinf_+3A_n.mc">n.mc</code></td>
<td>
<p>a posterior sample may be selected (1:4000), or not
when n.mc = 0 a posterior sample is chosen at random.</p>
</td></tr>
<tr><td><code id="simresp.tinf_+3A_renew.params">renew.params</code></td>
<td>
<p>At infection, a new parameter sample may be generated (when <code>renew.params = TRUE</code>).
Otherwise (when <code>renew.params = FALSE</code>), a sample is generated at birth and kept,
but baseline y0 are carried over from prior infections.</p>
</td></tr>
<tr><td><code id="simresp.tinf_+3A_predpar">predpar</code></td>
<td>
<p>an <code><a href="base.html#topic+array">array()</a></code> with dimensions named:
</p>

<ul>
<li> <p><code>antigen_iso</code>
</p>
</li>
<li> <p><code>parameter</code>
</p>
</li>
<li> <p><code>obs</code>
</p>
</li></ul>
</td></tr>
<tr><td><code id="simresp.tinf_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="#topic+row_longitudinal_parameter">row_longitudinal_parameter</a></code>, <code><a href="#topic+ab">ab</a></code>, <code><a href="#topic+mk_baseline">mk_baseline</a></code>
</p>

<dl>
<dt><code>age</code></dt><dd><p>age at infection</p>
</dd>
<dt><code>nmc</code></dt><dd><p>mcmc sample to use</p>
</dd>
<dt><code>npar</code></dt><dd><p>number of parameters</p>
</dd>
<dt><code>t</code></dt><dd><p>age at infection?</p>
</dd>
<dt><code>par</code></dt><dd><p>parameters</p>
</dd>
<dt><code>kab</code></dt><dd><p>index for which row of antibody baseline limits to read from <code>blims</code></p>
</dd>
<dt><code>n</code></dt><dd><p>number of observations</p>
</dd>
<dt><code>blims</code></dt><dd><p>range of possible baseline antibody levels</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Value</h3>

<p>This function returns a <code><a href="base.html#topic+list">list()</a></code> with:
</p>

<ul>
<li><p> t = times (in days, birth at day 0),
</p>
</li>
<li><p> b = bacteria level, for each antibody signal (not used; probably meaningless),
</p>
</li>
<li><p> y = antibody level, for each antibody signal
</p>
</li>
<li><p> smp = whether an infection involves a big jump or a small jump
</p>
</li>
<li><p> t.inf = times when infections have occurred.
</p>
</li></ul>


<hr>
<h2 id='strata'>Extract strata from an object</h2><span id='topic+strata'></span>

<h3>Description</h3>

<p>Generic method for extracting strata from objects. See <code><a href="#topic+strata.seroincidence.by">strata.seroincidence.by()</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>strata(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="strata_+3A_x">x</code></td>
<td>
<p>an object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the strata of <code>x</code>
</p>

<hr>
<h2 id='strata.seroincidence.by'>Extract the <code>Strata</code> attribute from an object, if present</h2><span id='topic+strata.seroincidence.by'></span>

<h3>Description</h3>

<p>Extract the <code>Strata</code> attribute from an object, if present
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'seroincidence.by'
strata(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="strata.seroincidence.by_+3A_x">x</code></td>
<td>
<p>any R object</p>
</td></tr>
</table>


<h3>Value</h3>


<ul>
<li><p> a <code><a href="tibble.html#topic+tibble">tibble::tibble()</a></code> with strata in rows, or
</p>
</li>
<li> <p><code>NULL</code> if <code>x</code> does not have a <code>"strata"</code> attribute
</p>
</li></ul>


<hr>
<h2 id='stratify_data'>Split data by stratum</h2><span id='topic+stratify_data'></span>

<h3>Description</h3>

<p>Split biomarker data, decay curve parameters, and noise parameters
to prepare for stratified incidence estimation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stratify_data(
  data,
  curve_params,
  noise_params,
  strata_varnames = "",
  curve_strata_varnames = NULL,
  noise_strata_varnames = NULL,
  antigen_isos = data %&gt;% attr("antigen_isos")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="stratify_data_+3A_curve_params">curve_params</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> containing MCMC samples of parameters
from the Bayesian posterior distribution of a longitudinal decay curve model.
The parameter columns must be named:
</p>

<ul>
<li> <p><code>antigen_iso</code>: a <code><a href="base.html#topic+character">character()</a></code> vector indicating antigen-isotype
combinations
</p>
</li>
<li> <p><code>iter</code>: an <code><a href="base.html#topic+integer">integer()</a></code> vector indicating MCMC sampling iterations
</p>
</li>
<li> <p><code>y0</code>: baseline antibody level at $t=0$ ($y(t=0)$)
</p>
</li>
<li> <p><code>y1</code>: antibody peak level (ELISA units)
</p>
</li>
<li> <p><code>t1</code>: duration of infection
</p>
</li>
<li> <p><code>alpha</code>: antibody decay rate
(1/days for the current longitudinal parameter sets)
</p>
</li>
<li> <p><code>r</code>: shape factor of antibody decay
</p>
</li></ul>
</td></tr>
<tr><td><code id="stratify_data_+3A_noise_params">noise_params</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> (or <code><a href="tibble.html#topic+tibble">tibble::tibble()</a></code>)
containing the following variables,
specifying noise parameters for each antigen isotype:
</p>

<ul>
<li> <p><code>antigen_iso</code>: antigen isotype whose noise parameters are being specified
on each row
</p>
</li>
<li> <p><code>nu</code>: biological noise
</p>
</li>
<li> <p><code>eps</code>: measurement noise
</p>
</li>
<li> <p><code>y.low</code>: lower limit of detection for the current antigen isotype
</p>
</li>
<li> <p><code>y.high</code>: upper limit of detection for the current antigen isotype
</p>
</li></ul>
</td></tr>
<tr><td><code id="stratify_data_+3A_strata_varnames">strata_varnames</code></td>
<td>
<p><code><a href="base.html#topic+character">character()</a></code> vector of names of variables in <code>data</code> to stratify by</p>
</td></tr>
<tr><td><code id="stratify_data_+3A_curve_strata_varnames">curve_strata_varnames</code></td>
<td>
<p>A subset of <code>strata</code>.
Values must be variable names in <code>curve_params</code>. Default = &quot;&quot;.</p>
</td></tr>
<tr><td><code id="stratify_data_+3A_noise_strata_varnames">noise_strata_varnames</code></td>
<td>
<p>A subset of <code>strata</code>.
Values must be variable names in <code>noise_params</code>. Default = &quot;&quot;.</p>
</td></tr>
<tr><td><code id="stratify_data_+3A_antigen_isos">antigen_isos</code></td>
<td>
<p>Character vector with one or more antibody names. Values must match <code>pop_data</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>"biomarker_data_and_params.list"</code> object (a <a href="base.html#topic+list">list</a> with extra attributes <code>"strata"</code>, <code>"antigen_isos"</code>, etc)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(dplyr)

xs_data &lt;-
  sees_pop_data_pk_100

curve &lt;-
  typhoid_curves_nostrat_100 %&gt;%
  filter(antigen_iso %in% c("HlyE_IgA", "HlyE_IgG"))

noise &lt;-
  example_noise_params_pk

stratified_data =
  stratify_data(
   data = xs_data,
   curve_params = curve,
   noise_params = noise,
   strata_varnames = "catchment",
   curve_strata_varnames = NULL,
   noise_strata_varnames = NULL
   )

## End(Not run)
</code></pre>

<hr>
<h2 id='summary.pop_data'>Summarize cross-sectional antibody survey data</h2><span id='topic+summary.pop_data'></span><span id='topic+print.summary.pop_data'></span>

<h3>Description</h3>

<p><code><a href="base.html#topic+summary">summary()</a></code> method for <code>pop_data</code> objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'pop_data'
summary(object, strata = NULL, ...)

## S3 method for class 'summary.pop_data'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.pop_data_+3A_object">object</code></td>
<td>
<p>a <code>pop_data</code> object (from <code><a href="#topic+as_pop_data">as_pop_data()</a></code>)</p>
</td></tr>
<tr><td><code id="summary.pop_data_+3A_strata">strata</code></td>
<td>
<p>a <code><a href="base.html#topic+character">character()</a></code> specifying grouping column(s)</p>
</td></tr>
<tr><td><code id="summary.pop_data_+3A_...">...</code></td>
<td>
<p>unused</p>
</td></tr>
<tr><td><code id="summary.pop_data_+3A_x">x</code></td>
<td>
<p>an object of class <code>"summary.pop_data"</code>; usually, the result of a call to <code><a href="#topic+summary.pop_data">summary.pop_data()</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>summary.pop_data</code> object, which is a list containing two summary tables:
</p>

<ul>
<li> <p><code>age_summary</code> summarizing <code>age</code>
</p>
</li>
<li> <p><code>ab_summary</code> summarizing <code>value</code>, stratified by <code>antigen_iso</code>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)

xs_data &lt;-
  sees_pop_data_pk_100
summary(xs_data, strata = "catchment")

</code></pre>

<hr>
<h2 id='summary.seroincidence'>Summarizing fitted seroincidence models</h2><span id='topic+summary.seroincidence'></span>

<h3>Description</h3>

<p>This function is a <code>summary()</code> method for <code>seroincidence</code> objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'seroincidence'
summary(object, coverage = 0.95, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.seroincidence_+3A_object">object</code></td>
<td>
<p>a <code><a href="base.html#topic+list">list()</a></code>, outputted by <code><a href="stats.html#topic+nlm">stats::nlm()</a></code> or <code><a href="#topic+est.incidence">est.incidence()</a></code></p>
</td></tr>
<tr><td><code id="summary.seroincidence_+3A_coverage">coverage</code></td>
<td>
<p>desired confidence interval coverage probability</p>
</td></tr>
<tr><td><code id="summary.seroincidence_+3A_...">...</code></td>
<td>
<p>unused</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code><a href="tibble.html#topic+tibble">tibble::tibble()</a></code> containing the following:
</p>

<ul>
<li> <p><code>est.start</code>: the starting guess for incidence rate
</p>
</li>
<li> <p><code>ageCat</code>: the age category we are analyzing
</p>
</li>
<li> <p><code>incidence.rate</code>: the estimated incidence rate, per person year
</p>
</li>
<li> <p><code>CI.lwr</code>: lower limit of confidence interval for incidence rate
</p>
</li>
<li> <p><code>CI.upr</code>: upper limit of confidence interval for incidence rate
</p>
</li>
<li> <p><code>coverage</code>: coverage probability
</p>
</li>
<li> <p><code>log.lik</code>: log-likelihood of the data used in the call to <code>est.incidence()</code>, evaluated at the maximum-likelihood estimate of lambda (i.e., at <code>incidence.rate</code>)
</p>
</li>
<li> <p><code>iterations</code>: the number of iterations used
</p>
</li>
<li> <p><code>antigen_isos</code>: a list of antigen isotypes used in the analysis
</p>
</li>
<li> <p><code>nlm.convergence.code</code>: information about convergence of the likelihood maximization procedure performed by <code>nlm()</code> (see &quot;Value&quot; section of <code><a href="stats.html#topic+nlm">stats::nlm()</a></code>, component <code>code</code>); codes 3-5 indicate issues:
</p>

<ul>
<li><p> 1: relative gradient is close to zero, current iterate is probably solution.
</p>
</li>
<li><p> 2: successive iterates within tolerance, current iterate is probably solution.
</p>
</li>
<li><p> 3: Last global step failed to locate a point lower than x. Either x is an approximate local minimum of the function, the function is too non-linear for this algorithm, or <code>stepmin</code> in <code><a href="#topic+est.incidence">est.incidence()</a></code> (a.k.a., <code>steptol</code> in <code><a href="stats.html#topic+nlm">stats::nlm()</a></code>) is too large.
</p>
</li>
<li><p> 4: iteration limit exceeded; increase <code>iterlim</code>.
</p>
</li>
<li><p> 5: maximum step size <code>stepmax</code> exceeded five consecutive times. Either the function is unbounded below, becomes asymptotic to a finite value from above in some direction or <code>stepmax</code> is too small.
</p>
</li></ul>

</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)

xs_data &lt;-
  sees_pop_data_pk_100

curve &lt;-
  typhoid_curves_nostrat_100 %&gt;%
  filter(antigen_iso %in% c("HlyE_IgA", "HlyE_IgG"))

noise &lt;-
  example_noise_params_pk

est1 &lt;- est.incidence(
  pop_data = xs_data,
  curve_params = curve,
  noise_params = noise,
  antigen_isos = c("HlyE_IgG", "HlyE_IgA")
)

summary(est1)
</code></pre>

<hr>
<h2 id='summary.seroincidence.by'>Summary Method for <code>"seroincidence.by"</code> Objects</h2><span id='topic+summary.seroincidence.by'></span>

<h3>Description</h3>

<p>Calculate seroincidence from output of the seroincidence calculator
<code><a href="#topic+est.incidence.by">est.incidence.by()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'seroincidence.by'
summary(
  object,
  confidence_level = 0.95,
  showDeviance = TRUE,
  showConvergence = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.seroincidence.by_+3A_object">object</code></td>
<td>
<p>A dataframe containing output of function <code><a href="#topic+est.incidence.by">est.incidence.by()</a></code>.</p>
</td></tr>
<tr><td><code id="summary.seroincidence.by_+3A_confidence_level">confidence_level</code></td>
<td>
<p>desired confidence interval coverage probability</p>
</td></tr>
<tr><td><code id="summary.seroincidence.by_+3A_showdeviance">showDeviance</code></td>
<td>
<p>Logical flag (<code>FALSE</code>/<code>TRUE</code>) for reporting deviance
(-2*log(likelihood) at estimated seroincidence. Default = <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="summary.seroincidence.by_+3A_showconvergence">showConvergence</code></td>
<td>
<p>Logical flag (<code>FALSE</code>/<code>TRUE</code>) for reporting convergence (see
help for <code><a href="stats.html#topic+optim">optim()</a></code> for details). Default = <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="summary.seroincidence.by_+3A_...">...</code></td>
<td>
<p>Additional arguments affecting the summary produced.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>summary.seroincidence.by</code> object, which is a <a href="tibble.html#topic+tibble">tibble::tibble</a>, with the following columns:
</p>

<ul>
<li> <p><code>incidence.rate</code> maximum likelihood estimate of <code>lambda</code> (seroincidence)
</p>
</li>
<li> <p><code>CI.lwr</code> lower confidence bound for lambda
</p>
</li>
<li> <p><code>CI.upr</code> upper confidence bound for lambda
</p>
</li>
<li> <p><code>Deviance</code> (included if <code>showDeviance = TRUE</code>) Negative log likelihood (NLL) at estimated (maximum likelihood)
<code>lambda</code>)
</p>

<ul>
<li> <p><code>nlm.convergence.code</code> (included if <code>showConvergence = TRUE</code>) Convergence information returned by <code><a href="stats.html#topic+nlm">stats::nlm()</a></code>
The object also has the following metadata (accessible through <code><a href="base.html#topic+attr">base::attr()</a></code>):
</p>
</li></ul>

</li>
<li> <p><code>antigen_isos</code> Character vector with names of input antigen isotypes used in <code><a href="#topic+est.incidence.by">est.incidence.by()</a></code>
</p>
</li>
<li> <p><code>Strata</code> Character with names of strata used in <code><a href="#topic+est.incidence.by">est.incidence.by()</a></code>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)

xs_data &lt;-
  sees_pop_data_pk_100

curve &lt;-
  typhoid_curves_nostrat_100 %&gt;%
  filter(antigen_iso %in% c("HlyE_IgA", "HlyE_IgG"))

noise &lt;-
  example_noise_params_pk

# estimate seroincidence
est2 &lt;- est.incidence.by(
  strata = c("catchment"),
  pop_data = xs_data,
  curve_params = curve,
  noise_params = noise,
  antigen_isos = c("HlyE_IgG", "HlyE_IgA"),
  #num_cores = 8 # Allow for parallel processing to decrease run time
)

# calculate summary statistics for the seroincidence object
summary(est2)

</code></pre>

<hr>
<h2 id='typhoid_curves_nostrat_100'>Small example of antibody response curve parameters for typhoid</h2><span id='topic+typhoid_curves_nostrat_100'></span>

<h3>Description</h3>

<p>A subset of data from the SEES study, for examples and testing.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>typhoid_curves_nostrat_100
</code></pre>


<h3>Format</h3>



<h4><code>typhoid_curves_nostrat_100</code></h4>

<p>A <code>curve_params</code> object (from <code><a href="#topic+as_curve_params">as_curve_params()</a></code>) with 500 rows and 7
columns:
</p>

<dl>
<dt>antigen_iso</dt><dd><p>which antigen and isotype are being measured
(data is in long format)</p>
</dd>
<dt>iter</dt><dd><p>MCMC iteration</p>
</dd>
<dt>y0</dt><dd><p>Antibody concentration at t = 0 (start of active infection)</p>
</dd>
<dt>y1</dt><dd><p>Antibody concentration at t = <code>t1</code> (end of active infection)</p>
</dd>
<dt>t1</dt><dd><p>Duration of active infection</p>
</dd>
<dt>alpha</dt><dd><p>Antibody decay rate coefficient</p>
</dd>
<dt>r</dt><dd><p>Antibody decay rate exponent parameter</p>
</dd>
</dl>




<h3>Source</h3>

<p><a href="https://osf.io/rtw5k">https://osf.io/rtw5k</a>
</p>

<hr>
<h2 id='warn.missing.strata'>Warn about missing stratifying variables in a dataset</h2><span id='topic+warn.missing.strata'></span>

<h3>Description</h3>

<p>Warn about missing stratifying variables in a dataset
</p>


<h3>Usage</h3>

<pre><code class='language-R'>warn.missing.strata(data, strata, dataname)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="warn.missing.strata_+3A_data">data</code></td>
<td>
<p>the dataset that should contain the strata</p>
</td></tr>
<tr><td><code id="warn.missing.strata_+3A_strata">strata</code></td>
<td>
<p>a <code><a href="base.html#topic+data.frame">data.frame()</a></code> showing the strata levels that are expected to be in the dataset</p>
</td></tr>
<tr><td><code id="warn.missing.strata_+3A_dataname">dataname</code></td>
<td>
<p>the name of the dataset, for use in warning messages if some strata are missing.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code><a href="base.html#topic+character">character()</a></code> vector of the subset of stratifying variables that are present in <code>pop_data</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
expected_strata &lt;- data.frame(Species = "banana", type = "orchid")

warn.missing.strata(iris, expected_strata, dataname = "iris")

## End(Not run)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
