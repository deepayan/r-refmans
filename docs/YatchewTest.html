<!DOCTYPE html><html lang="en"><head><title>Help for package YatchewTest</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {YatchewTest}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#yatchew_test'><p>Main function</p></a></li>
<li><a href='#yatchew_test.data.frame'><p>General yatchew_test method for unclassed dataframes</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Yatchew (1997), De Chaisemartin &amp; D'Haultfoeuille (2024)
Linearity Test</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1.1</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Diego Ciccia &lt;diego.ciccia@kellogg.northwestern.edu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Test of linearity originally proposed by Yatchew (1997) &lt;<a href="https://doi.org/10.1016%2FS0165-1765%2897%2900218-8">doi:10.1016/S0165-1765(97)00218-8</a>&gt; and improved by de Chaisemartin &amp; D'Haultfoeuille (2024) &lt;<a href="https://doi.org/10.2139%2Fssrn.4284811">doi:10.2139/ssrn.4284811</a>&gt; to be robust under heteroskedasticity. </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Imports:</td>
<td>Rcpp, ggplot2</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp</td>
</tr>
<tr>
<td>Author:</td>
<td>Diego Ciccia [aut, cre],
  Felix Knau [aut],
  Doulo Sow [aut],
  Cl√©ment de Chaisemartin [aut],
  Xavier D'Haultfoeuille [aut]</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-07-23 08:17:29 UTC; cicci</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-07-23 15:10:04 UTC</td>
</tr>
</table>
<hr>
<h2 id='yatchew_test'>Main function</h2><span id='topic+yatchew_test'></span>

<h3>Description</h3>

<p>Test of Linearity of a Conditional Expectation Function (Yatchew, 1997; de Chaisemartin and D'Haultfoeuille, 2024)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>yatchew_test(data, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="yatchew_test_+3A_data">data</code></td>
<td>
<p>A data object.</p>
</td></tr>
<tr><td><code id="yatchew_test_+3A_...">...</code></td>
<td>
<p>Undocumented.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Method dispatch depending on the data object class.
</p>

<hr>
<h2 id='yatchew_test.data.frame'>General yatchew_test method for unclassed dataframes</h2><span id='topic+yatchew_test.data.frame'></span>

<h3>Description</h3>

<p>General yatchew_test method for unclassed dataframes
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'data.frame'
yatchew_test(data, Y, D, het_robust = FALSE, path_plot = FALSE, order = 1, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="yatchew_test.data.frame_+3A_data">data</code></td>
<td>
<p>(data.frame) A dataframe.</p>
</td></tr>
<tr><td><code id="yatchew_test.data.frame_+3A_y">Y</code></td>
<td>
<p>(char) Dependent variable.</p>
</td></tr>
<tr><td><code id="yatchew_test.data.frame_+3A_d">D</code></td>
<td>
<p>(char) Independent variable.</p>
</td></tr>
<tr><td><code id="yatchew_test.data.frame_+3A_het_robust">het_robust</code></td>
<td>
<p>(logical) If FALSE, the test is performed under the assumption of homoskedasticity (Yatchew, 1997). If TRUE, the test is performed using the heteroskedasticity-robust test statistic proposed by de Chaisemartin and D'Haultfoeuille (2024).</p>
</td></tr>
<tr><td><code id="yatchew_test.data.frame_+3A_path_plot">path_plot</code></td>
<td>
<p>(logical) if TRUE and <code>D</code> has length 2, the assigned object will include a plot of the sequence of <code class="reqn">(D_{1i}, D_{2i})</code>s that minimizes the euclidean distance between each pair of consecutive observations (see Overview for further details).</p>
</td></tr>
<tr><td><code id="yatchew_test.data.frame_+3A_order">order</code></td>
<td>
<p>(nonnegative integer k) If this option is specified, the program tests whether the conditional expectation of <code>Y</code> given <code>D</code> is a k-degree polynomial in <code>D</code>. With <code>order = 0</code>, the command tests the hypothesis that the conditional mean of <code>Y</code> given <code>D</code> is constant.</p>
</td></tr>
<tr><td><code id="yatchew_test.data.frame_+3A_...">...</code></td>
<td>
<p>Undocumented.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with test results.
</p>


<h3>Overview</h3>

<p>This program implements the linearity test proposed by Yatchew (1997) and its heteroskedasticity-robust version proposed by de Chaisemartin and D'Haultfoeuille (2024).
In this overview, we sketch the intuition behind the two tests, as to motivate the use of the package and its options.
Please refer to Yatchew (1997) and Section 3 of de Chaisemartin and D'Haultfoeuille (2024) for further details.
</p>
<p>Yatchew (1997) proposes a useful extension of the test with multiple independent variables.
The program implements this extension when the <code>D</code> argument has length <code class="reqn">&gt; 1</code>.
It should be noted that the power and consistency of the test in the multivariate case are not backed by proven theoretical results.
We implemented this extension to allow for testing and exploratory research.
Future theoretical exploration of the multivariate test will depend on the demand and usage of the package.
</p>


<h4>Univariate Yatchew Test</h4>

<p>Let <code class="reqn">Y</code> and <code class="reqn">D</code> be two random variables.
Let <code class="reqn">m(D) = E[Y|D]</code>.
The null hypothesis of the test is that <code class="reqn">m(D) = \alpha_0 + \alpha_1 D</code> for two real numbers <code class="reqn">\alpha_0</code> and <code class="reqn">\alpha_1</code>.
This means that, under the null, <code class="reqn">m(.)</code> is linear in <code class="reqn">D</code>.
The outcome variable can be decomposed as <code class="reqn">Y = m(D) + \varepsilon</code>, with <code class="reqn">E[\varepsilon|D] = 0</code> and <code class="reqn">\Delta Y = \Delta \varepsilon</code> for <code class="reqn">\Delta D \to 0</code>.
In a dataset with <code class="reqn">N</code> i.i.d. realisations of <code class="reqn">(Y, D)</code>, one can test this hypothesis as follows:
</p>

<ol>
<li><p> sort the dataset by <code class="reqn">D</code>;
</p>
</li>
<li><p> denote the corresponding observations by <code class="reqn">(Y_{(i)}, D_{(i)})</code>, with <code class="reqn">i \in \{1, ..., N\}</code>;
</p>
</li>
<li><p> approximate <code class="reqn">\hat{\sigma}^2_{\text{diff}}</code>, i.e. the variance of the first differenced residuals <code class="reqn">\varepsilon_{(i)} - \varepsilon_{(i-1)}</code>, by the variance of <code class="reqn">Y_{(i)} - Y_{(i-1)}</code>;
</p>
</li>
<li><p> compute <code class="reqn">\hat{\sigma}^2_{\text{lin}}</code>, i.e. the variance of the residuals from an OLS regression of <code class="reqn">Y</code> on <code class="reqn">D</code>.
</p>
</li></ol>

<p>Heuristically, the validity of step (3) derives from the fact that <code class="reqn">Y_{(i)} - Y_{(i-1)}</code> = <code class="reqn">m(D_{(i)}) - m(D_{(i-1)})</code> + <code class="reqn">\varepsilon_{(i)} - \varepsilon_{(i-1)}</code> and the first difference term is close to zero for <code class="reqn">D_{(i)} \approx D_{(i-1)}</code>.
Sorting at step (1) ensures that consecutive <code class="reqn">D_{(i)}</code>s are as close as possible, and when the sample size goes to infinity the distance between consecutive observations goes to zero.
Then, Yatchew (1997) shows that under homoskedasticity and regularity conditions
</p>
<p style="text-align: center;"><code class="reqn">T := \sqrt{G}\left(\dfrac{\hat{\sigma}^2_{\text{lin}}}{\hat{\sigma}^2_{\text{diff}}}-1\right) \stackrel{d}{\longrightarrow} \mathcal{N}\left(0,1\right)</code>
</p>

<p>Then, one can reject the linearity of <code class="reqn">m(.)</code> with significance level <code class="reqn">\alpha</code> if <code class="reqn">T &gt; \Phi(1-\alpha)</code>.
</p>
<p>If the homoskedasticity assumption fails, this test leads to overrejection.
De Chaisemartin and D'Haultfoeuille (2024) propose a heteroskedasticity-robust version of the test statistic above.
This version of the Yatchew (1997) test can be implemented by running the command with the option <code>het_robust = TRUE</code>.
</p>



<h4>Multivariate Yatchew Test</h4>

<p>Let <code class="reqn">\textbf{D}</code> be a vector of <code class="reqn">K</code> random variables.
Let <code class="reqn">g(\textbf{D}) = E[Y|\textbf{D}]</code>.
Denote with <code class="reqn">||.,.||</code> the Euclidean distance between two vectors.
The null hypothesis of the multivariate test is <code class="reqn">g(\textbf{D}) = \alpha_0 + A'\textbf{D}</code>, with <code class="reqn">A = (\alpha_1,..., \alpha_K)</code>, for <code class="reqn">K+1</code> real numbers <code class="reqn">\alpha_0</code>, <code class="reqn">\alpha_1</code>, ..., <code class="reqn">\alpha_K</code>.
This means that, under the null, <code class="reqn">g(.)</code> is linear in <code class="reqn">\textbf{D}</code>.
Following the same logic as the univariate case, in a dataset with <code class="reqn">N</code> i.i.d. realisations of <code class="reqn">(Y, \textbf{D})</code> we can approximate the first difference <code class="reqn">\Delta \varepsilon</code> by <code class="reqn">\Delta Y</code> valuing <code class="reqn">g(.)</code> between consecutive observations.
The program runs a nearest neighbor algorithm to find the sequence of observations such that the Euclidean distance between consecutive positions is minimized.
The algorithm has been programmed in C++ and it has been integrated in R thanks to the <code>Rcpp</code> library. The program follows a very simple nearest neighbor approach:
</p>

<ol>
<li><p> collect all the Euclidean distances between all the possible unique pairs of rows in <code class="reqn">\textbf{D}</code> in the matrix <code class="reqn">M</code>, where <code class="reqn">M_{n,m} = ||\textbf{D}_n,\textbf{D}_m||</code> with <code class="reqn">n,m \in \{1, ..., N\}</code>;
</p>
</li>
<li><p> setup the queue to <code class="reqn">Q = \{1, ..., N\}</code>, the (empty) path vector <code class="reqn">I = \{\}</code> and the starting index <code class="reqn">i = 1</code>;
</p>
</li>
<li><p> remove <code class="reqn">i</code> from <code class="reqn">Q</code> and find the column index <code class="reqn">j</code> of M such that <code class="reqn">M_{i,j} = \min_{c \in Q} M_{i,c}</code>;
</p>
</li>
<li><p> append <code class="reqn">j</code> to <code class="reqn">I</code> and start again from step 3 with <code class="reqn">i = j</code> until <code class="reqn">Q</code> is empty.
</p>
</li></ol>

<p>To improve efficiency, the program collects only the <code class="reqn">N(N-1)/2</code> Euclidean distances corresponding to the lower triangle of matrix <code class="reqn">M</code> and chooses <code class="reqn">j</code> such that <code class="reqn">M_{i,j} = \min_{c \in Q} 1\{c &lt; i\} M_{i,c} + 1\{c &gt; i\} M_{c,i}</code>.
The output of the algorithm, i.e. the vector <code class="reqn">I</code>, is a sequence of row numbers such that the distance between the corresponding rows <code class="reqn">\textbf{D}_i</code>s is minimized.
The program also uses two refinements suggested in Appendix A of Yatchew (1997):
</p>

<ul>
<li><p> The entries in <code class="reqn">\textbf{D}</code> are normalized in <code class="reqn">[0,1]</code>;
</p>
</li>
<li><p> The algorithm is applied to sub-cubes, i.e. partitions of the <code class="reqn">[0,1]^K</code> space, and the full path is obtained by joining the extrema of the subpaths.
</p>
</li></ul>

<p>By convention, the program computes <code class="reqn">(2\lceil \log_{10} N \rceil)^K</code> subcubes, where each univariate partition is defined by grouping observations in <code class="reqn">2\lceil \log_{10} N \rceil</code> quantile bins. If <code class="reqn">K = 2</code>, the user can visualize in a ggplot graph the exact path across the normalized <code class="reqn">\textbf{D}_i</code>s by running the command with the option <code>path_plot = TRUE</code>.
</p>
<p>Once the dataset is sorted by <code class="reqn">I</code>, the program resumes from step (2) of the univariate case.
</p>



<h3>Contacts</h3>

<p>If you wish to inquire about the functionalities of this package or to report bugs/suggestions, feel free to post your question in the Issues section of the <a href="https://github.com/chaisemartinPackages/yatchew_test">yatchew_test GitHub repository</a>.
</p>


<h3>References</h3>

<p>de Chaisemartin, C., d'Haultfoeuille, X. (2024). Two-way Fixed Effects and Difference-in-Difference Estimators in Heterogeneous Adoption Designs.
</p>
<p>Yatchew, A. (1997). An elementary estimator of the partial linear model.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>df &lt;- as.data.frame(matrix(NA, nrow = 1E3, ncol = 0))
df$x &lt;- rnorm(1E3)
df$b &lt;- runif(1E3)
df$y &lt;- 2 + df$b * df$x
yatchew_test(data = df, Y = "y", D = "x")
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
