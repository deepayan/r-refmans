<!DOCTYPE html><html><head><title>Help for package ebal</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ebal}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#baltest.collect'>
<p>Collect Covariate Balance Statistics</p></a></li>
<li><a href='#eb'>
<p>Function for Entropy Balancing</p></a></li>
<li><a href='#ebalance'>
<p>Entropy balancing</p></a></li>
<li><a href='#ebalance.trim'>
<p>Trimming of Weights for Entropy Balancing</p></a></li>
<li><a href='#getsquares'>
<p>Generate Matrix of Squared Terms</p></a></li>
<li><a href='#line.searcher'>
<p>Optimal step length search for entropy balancing algorithm</p></a></li>
<li><a href='#matrixmaker'>
<p>Generate Matrix of One-way Interactions and Squared Terms</p>
</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Entropy Reweighting to Create Balanced Samples</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1-8</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-06-08</td>
</tr>
<tr>
<td>Author:</td>
<td>Jens Hainmueller</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jens Hainmueller &lt;jhain@stanford.edu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Package implements entropy balancing, a data preprocessing procedure described in Hainmueller (2008, &lt;<a href="https://doi.org/10.1093%2Fpan%2Fmpr025">doi:10.1093/pan/mpr025</a>&gt;) that allows users to reweight a dataset such that the covariate distributions in the reweighted data satisfy a set of user specified moment conditions. This can be useful to create balanced samples in observational studies with a binary treatment where the control group data can be reweighted to match the covariate moments in the treatment group. Entropy balancing can also be used to reweight a survey sample to known characteristics from a target population.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Depends:</td>
<td>methods</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://web.stanford.edu/~jhain/">https://web.stanford.edu/~jhain/</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-06-09 00:06:48 UTC; jhainmueller</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-06-09 08:10:24 UTC</td>
</tr>
</table>
<hr>
<h2 id='baltest.collect'>
Collect Covariate Balance Statistics 
</h2><span id='topic+baltest.collect'></span>

<h3>Description</h3>

<p>A function that summarizes the covariate balance statistics that are computed by <code>MatchBalance(Matching)</code> in a balance table.  
</p>


<h3>Usage</h3>

<pre><code class='language-R'>baltest.collect(matchbal.out, var.names, after = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="baltest.collect_+3A_matchbal.out">matchbal.out</code></td>
<td>

<p>An object from a call to <code>MatchBalance(Matching)</code>
</p>
</td></tr>
<tr><td><code id="baltest.collect_+3A_var.names">var.names</code></td>
<td>

<p>A vector of covariate names.
</p>
</td></tr>
<tr><td><code id="baltest.collect_+3A_after">after</code></td>
<td>

<p>A logical flag for whether the results from before or after Matching should be summarized. If TRUE <code>baltest.collect</code> summarizes the results from the covariate balance checks that <code>MatchBalance</code> computes in the matched data. If FALSE the results from the balance checks in the unmatched data are used.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code>MatchBalance(Matching)</code> for details.
</p>


<h3>Value</h3>

<p>A matrix that contains the covariate balance statistics in tabular format.
</p>


<h3>Author(s)</h3>

<p>Jens Hainmueller
</p>


<h3>See Also</h3>

<p><code>MatchBalance</code> in the <code>Matching</code> package.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## load(Matching) to run this example
## create toy data: one treatment indicator and three covariates X1-3
#dat &lt;- data.frame(treatment=rbinom(50,size=1,prob=.5),replicate(3,rnorm(50)))
#covarsname &lt;- colnames(dat)[-1]

## run balance checks
#mout &lt;- MatchBalance(treatment~X1+X2+X3,data=dat)

## summarize in balance table
#baltest.collect(matchbal.out=mout,var.names=covarsname,after=FALSE)

</code></pre>

<hr>
<h2 id='eb'>
Function for Entropy Balancing
</h2><span id='topic+eb'></span>

<h3>Description</h3>

<p>This function is called internally by <code><a href="#topic+ebalance">ebalance</a></code> and <code><a href="#topic+ebalance.trim">ebalance.trim</a></code> to implement entropy balancing. This function would normally not be called manually by a user.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>eb(tr.total = tr.total, co.x = co.x,
   coefs = coefs, base.weight = base.weight, 
   max.iterations = max.iterations, 
   constraint.tolerance = constraint.tolerance, 
   print.level = print.level)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="eb_+3A_tr.total">tr.total</code></td>
<td>

<p>NA
</p>
</td></tr>
<tr><td><code id="eb_+3A_co.x">co.x</code></td>
<td>

<p>NA
</p>
</td></tr>
<tr><td><code id="eb_+3A_coefs">coefs</code></td>
<td>

<p>NA
</p>
</td></tr>
<tr><td><code id="eb_+3A_base.weight">base.weight</code></td>
<td>

<p>NA
</p>
</td></tr>
<tr><td><code id="eb_+3A_max.iterations">max.iterations</code></td>
<td>

<p>NA
</p>
</td></tr>
<tr><td><code id="eb_+3A_constraint.tolerance">constraint.tolerance</code></td>
<td>

<p>NA
</p>
</td></tr>
<tr><td><code id="eb_+3A_print.level">print.level</code></td>
<td>

<p>NA
</p>
</td></tr>
</table>


<h3>Value</h3>

<p> A list containing the results from the algorithm.
</p>


<h3>Author(s)</h3>

<p>Jens Hainmueller
</p>


<h3>See Also</h3>

<p><code>ebalance</code>, <code>ebalance.trim</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##---- NA -----
</code></pre>

<hr>
<h2 id='ebalance'>
Entropy balancing
</h2><span id='topic+ebalance'></span>

<h3>Description</h3>

<p>This function implements entropy balancing, a data preprocessing procedure that allows users to reweight a dataset. The preprocessing is based on a maximum entropy reweighting scheme 
that assigns weights to each unit such that the covariate distributions in the reweighted data satisfy a set of moment conditions specified by the researcher. This can be useful to balance covariate distributions in observational studies with a binary treatment where the control group data can be reweighted to match the covariate moments in the treatment group. Entropy balancing can also be used to reweight a survey sample to known characteristics from a target population. The weights that result from entropy balancing
can be passed to regression or other models to subsequently analyze the reweighted data. 
</p>
<p>By default, <code>ebalance</code> reweights the covariate distributions from a control group to match target moments that are computed from a treatment group such that the reweighted data can be used to analyze the average treatment effect on the treated. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ebalance(Treatment, X, base.weight = NULL, 
norm.constant = NULL, coefs = NULL, 
max.iterations = 200, 
constraint.tolerance = 1, print.level = 0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ebalance_+3A_treatment">Treatment</code></td>
<td>

<p>A vector indicating the observations which are in the data group that should be reweighted (i.e. the control group) and 
those which are in the data group that should be used to compute the target moments (i.e. the treatment group). 
This can either be a logical vector or a real vector where 0 denotes control observations and 1 denotes treatment observations. 
By default the target moments are computed using the data from all treatment observations. 
</p>
</td></tr>
<tr><td><code id="ebalance_+3A_x">X</code></td>
<td>

<p>A matrix containing the variables that the researchers wants to include in the reweighting. To adjust the 
means of the covariates, the raw covariates can be included. To adjust the variances of the covariates, squared terms 
of the raw covariates can be included. To adjust co-moments, interaction terms can be included. All columns of 
this matrix must have positive variance and the matrix must be invertible. No missing data is allowed.
</p>
</td></tr>
<tr><td><code id="ebalance_+3A_base.weight">base.weight</code></td>
<td>

<p>An optional vector of base weights for the maximum entropy reweighting (one weight for each control unit). The default is uniform base weights. 
</p>
</td></tr>
<tr><td><code id="ebalance_+3A_norm.constant">norm.constant</code></td>
<td>

<p>An optional normalizing constant. By default the weights are normalized such that the sum of the weights for the reweighted control group match the number of observations in the treatment grou. 
</p>
</td></tr>
<tr><td><code id="ebalance_+3A_coefs">coefs</code></td>
<td>

<p>An optional vector of model coefficients to start the reweighting.
</p>
</td></tr>
<tr><td><code id="ebalance_+3A_max.iterations">max.iterations</code></td>
<td>

<p>Maximum number of iterations that will be run when attempting to reweight the data.
</p>
</td></tr>
<tr><td><code id="ebalance_+3A_constraint.tolerance">constraint.tolerance</code></td>
<td>

<p>This is the tolerance level used by <code>ebalance</code> to decide if the moments in the reweighted data are equal to the target moments.
</p>
</td></tr>
<tr><td><code id="ebalance_+3A_print.level">print.level</code></td>
<td>

<p>Controls the level of printing: 0 (normal printing), 2 (detailed), and 3 (very detailed).
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If the user wants to pass different target moments these should be entered in a new row in the dataset which contains the target means for the covariate distributions. 
</p>


<h3>Value</h3>

<p>An list object of class <code>ebalance</code> with the following elements:
</p>
<table>
<tr><td><code>target.margins</code></td>
<td>
<p>A vector that contains the target moments coded from the covariate distributions of the treatment group.</p>
</td></tr>
<tr><td><code>co.xdata</code></td>
<td>
<p>A matrix that contains the covariate data from the control group.</p>
</td></tr>
<tr><td><code>w</code></td>
<td>
<p>A vector that contains the control group weights assigned by entropy balancing.</p>
</td></tr>
<tr><td><code>coefs</code></td>
<td>
<p>A vector that contains coefficients from the reweighting algorithm.</p>
</td></tr>
<tr><td><code>maxdiff</code></td>
<td>
<p>A scalar that contains the maximum deviation between the moments of the reweighted data and the target moments.</p>
</td></tr>
<tr><td><code>constraint.tolerance</code></td>
<td>
<p>The tolerance level used for the balance constraints.</p>
</td></tr>
<tr><td><code>base.weight</code></td>
<td>
<p>The base weight used.</p>
</td></tr>
<tr><td><code>print.level</code></td>
<td>
<p>The print level used.</p>
</td></tr>
<tr><td><code>converged</code></td>
<td>
<p>Logical flag if algorithm converged within tolerance.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jens Hainmueller
</p>


<h3>References</h3>

<p>Hainmueller, J. (2012) 'Entropy Balancing for Causal Effects: A Multivariate Reweighting Method to Produce Balanced Samples in Observational Studies', Political Analysis (Winter 2012) 20 (1): 25&ndash;46.
</p>
<p>Zaslavsky, A. (1988), 'Representing local reweighting area adjustments by of households', Survey Methodology 14(2), 265&ndash;288.
</p>
<p>Ireland, C. and Kullback, S. (1968), 'Contingency tables with given marginals', Biometrika 55, 179&ndash;188.
</p>
<p>Kullback, S. (1959), Information Theory and Statistics, Wiley, NY.
</p>


<h3>See Also</h3>

<p>Also see <code><a href="#topic+ebalance.trim">ebalance.trim</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# create toy data: treatment indicator and three covariates X1-3
treatment   &lt;- c(rep(0,50),rep(1,30))
X           &lt;- rbind(replicate(3,rnorm(50,0)),replicate(3,rnorm(30,.5)))
colnames(X) &lt;- paste("x",1:3,sep="")

# entropy balancing
eb.out &lt;- ebalance(Treatment=treatment,
                   X=X)
# means in treatment group data
apply(X[treatment==1,],2,mean)
# means in reweighted control group data
apply(X[treatment==0,],2,weighted.mean,w=eb.out$w)
# means in raw data control group data
apply(X[treatment==0,],2,mean)
</code></pre>

<hr>
<h2 id='ebalance.trim'>
Trimming of Weights for Entropy Balancing
</h2><span id='topic+ebalance.trim'></span>

<h3>Description</h3>

<p>Function to trim weights obtained from entropy balancing. It takes the output from a call to <code>ebalance</code> and trims the data weights (subject to the moment conditions) such that the 
ratio of the maximum/minimum weight to the mean weight is 
reduced to satisfy a user specified target. If no user target is specified the maximum weight ratio is automatically trimmed as far as is feasible given the data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ebalance.trim(ebalanceobj, max.weight = NULL,
min.weight = 0, max.trim.iterations = 200,
max.weight.increment = 0.92,
min.weight.increment = 1.08,
print.level = 0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ebalance.trim_+3A_ebalanceobj">ebalanceobj</code></td>
<td>

<p>An object from a call to <code>ebalance</code>.
</p>
</td></tr>
<tr><td><code id="ebalance.trim_+3A_max.weight">max.weight</code></td>
<td>

<p>Optional target for the ratio of the maximum to mean weight.
</p>
</td></tr>
<tr><td><code id="ebalance.trim_+3A_min.weight">min.weight</code></td>
<td>

<p>Optional target for the ratio of the minimum to mean weight.
</p>
</td></tr>         
<tr><td><code id="ebalance.trim_+3A_max.trim.iterations">max.trim.iterations</code></td>
<td>

<p>Maximum number of trimming iterations.
</p>
</td></tr>
<tr><td><code id="ebalance.trim_+3A_max.weight.increment">max.weight.increment</code></td>
<td>

<p>Increment for iterative trimming of the ratio of the maximum to mean weight (a scalar between 0-1, .92 indicates that 
the attempted reduction in the max ratio is 8 percent). 
</p>
</td></tr>
<tr><td><code id="ebalance.trim_+3A_min.weight.increment">min.weight.increment</code></td>
<td>

<p>Increment for iterative trimming of the ratio of the minimum to mean weight (a scalar  &gt; 1, 1.08 indicates that 
the attempted reduction in the max ratio is 8 percent).
</p>
</td></tr>
<tr><td><code id="ebalance.trim_+3A_print.level">print.level</code></td>
<td>

<p>Controls the level of printing: 0 (normal printing), 2 (detailed), and 3 (very detailed).
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An list object of class <code>ebalance.trim</code> with the following elements:
</p>
<table>
<tr><td><code>target.margins</code></td>
<td>
<p>A vector that contains the target moments coded from the covariate distributions of the treatment group.</p>
</td></tr>
<tr><td><code>co.xdata</code></td>
<td>
<p>A matrix that contains the covariate data from the control group.</p>
</td></tr>
<tr><td><code>w</code></td>
<td>
<p>A vector that contains the control group weights assigned by trimming entropy balancing algorithm.</p>
</td></tr>
<tr><td><code>coefs</code></td>
<td>
<p>A vector that contains coefficients from the reweighting algorithm.</p>
</td></tr>
<tr><td><code>maxdiff</code></td>
<td>
<p>A scalar that contains the maximum deviation between the moments of the reweighted data and the target moments.</p>
</td></tr>
<tr><td><code>norm.constant</code></td>
<td>
<p>Normalizing constant used.</p>
</td></tr>
<tr><td><code>constraint.tolerance</code></td>
<td>
<p>The tolerance level used for the balance constraints.</p>
</td></tr>
<tr><td><code>max.iterations</code></td>
<td>
<p>Maximum number of trimming iterations used.</p>
</td></tr>
<tr><td><code>base.weight</code></td>
<td>
<p>The base weight used.</p>
</td></tr>
<tr><td><code>converged</code></td>
<td>
<p>Logical flag if algorithm converged within tolerance.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jens Hainmueller
</p>


<h3>References</h3>

<p>Hainmueller, J. (2012) 'Entropy Balancing for Causal Effects: A Multivariate Reweighting Method to Produce Balanced Samples in Observational Studies', Political Analysis (Winter 2012) 20 (1): 25&ndash;46.
</p>
<p>Zaslavsky, A. (1988), 'Representing local reweighting area adjustments by of households', Survey Methodology 14(2), 265&ndash;288.
</p>
<p>Ireland, C. and Kullback, S. (1968), 'Contingency tables with given marginals', Biometrika 55, 179&ndash;188.
</p>
<p>Kullback, S. (1959), Information Theory and Statistics, Wiley, NY.
</p>


<h3>See Also</h3>

<p>Also see <code><a href="#topic+ebalance.trim">ebalance.trim</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# create toy data: treatment indicator and three covariates X1-3
treatment   &lt;- c(rep(0,50),rep(1,30))
X           &lt;- rbind(replicate(3,rnorm(50,0)),replicate(3,rnorm(30,.5)))
colnames(X) &lt;- paste("x",1:3,sep="")

# entropy balancing
eb.out &lt;- ebalance(Treatment=treatment,
                   X=X)
# means in treatment group data
apply(X[treatment==1,],2,mean)
# means in reweighted control group data
apply(X[treatment==0,],2,weighted.mean,w=eb.out$w)
# means in raw data control group data
apply(X[treatment==0,],2,mean)

# trim weights
eb.out.tr &lt;- ebalance.trim(eb.out)
# means in reweighted control group data
apply(X[treatment==0,],2,weighted.mean,w=eb.out.tr$w)

# untrimmed and trimmed weights
round(summary(eb.out$w),2)
round(summary(eb.out.tr$w),2)

</code></pre>

<hr>
<h2 id='getsquares'>
Generate Matrix of Squared Terms
</h2><span id='topic+getsquares'></span>

<h3>Description</h3>

<p>Takes a matrix of covariates and generates a new matrix that contains the original covariates and all squared terms. Squared terms for binary covariates are omitted.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getsquares(mat)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getsquares_+3A_mat">mat</code></td>
<td>
<p>n by k numeric matrix of covariates.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>n by k*2 numeric matrix that contains the original covariates plus all squared terms.
</p>


<h3>Author(s)</h3>

<p>Jens Hainmueller
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+matrixmaker">matrixmaker</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># create toy matrix
mold &lt;- replicate(3,rnorm(50))
colnames(mold) &lt;- paste("x",1:3,sep="")
head(mold)
# create new matrix
mnew &lt;- getsquares(mold)
head(mnew)
</code></pre>

<hr>
<h2 id='line.searcher'>
Optimal step length search for entropy balancing algorithm 
</h2><span id='topic+line.searcher'></span>

<h3>Description</h3>

<p>Function called internally by <code>ebalance</code> and <code>ebalance.trim</code> to compute optimal step length for entropy balancing algorithm. This function would normally not be called manually by a user.  
</p>


<h3>Usage</h3>

<pre><code class='language-R'>line.searcher(Base.weight, Co.x, 
Tr.total, coefs, Newton, ss)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="line.searcher_+3A_base.weight">Base.weight</code></td>
<td>

<p>NA
</p>
</td></tr>
<tr><td><code id="line.searcher_+3A_co.x">Co.x</code></td>
<td>

<p>NA
</p>
</td></tr>
<tr><td><code id="line.searcher_+3A_tr.total">Tr.total</code></td>
<td>

<p>NA
</p>
</td></tr>
<tr><td><code id="line.searcher_+3A_coefs">coefs</code></td>
<td>

<p>NA
</p>
</td></tr>
<tr><td><code id="line.searcher_+3A_newton">Newton</code></td>
<td>

<p>NA
</p>
</td></tr>
<tr><td><code id="line.searcher_+3A_ss">ss</code></td>
<td>

<p>NA
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the results from the search.
</p>


<h3>Author(s)</h3>

<p>Jens Hainmueller
</p>


<h3>See Also</h3>

<p><code>ebalance</code>, <code>ebalance.trim</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##---- NA -----
</code></pre>

<hr>
<h2 id='matrixmaker'>
Generate Matrix of One-way Interactions and Squared Terms
</h2><span id='topic+matrixmaker'></span>

<h3>Description</h3>

<p>Takes a matrix of covariates and generates a new matrix that contains the original covariates, all one-way interaction terms, and all squared terms.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>matrixmaker(mat)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="matrixmaker_+3A_mat">mat</code></td>
<td>
<p>n by k numeric matrix of covariates.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>n by (k*(k+1))/2 +1) matrix of covariates with original covariates, all one-way interaction terms, and all squared terms. 
</p>


<h3>Author(s)</h3>

<p>Jens Hainmueller
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+getsquares">getsquares</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# create toy matrix
mold &lt;- replicate(3,rnorm(50))
colnames(mold) &lt;- paste("x",1:3,sep="")
head(mold)
# create new matrix
mnew &lt;- matrixmaker(mold)
head(mnew)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
