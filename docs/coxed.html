<!DOCTYPE html><html><head><title>Help for package coxed</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {coxed}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#coxed-package'><p>Duration-Based Quantities of Interest and Simulation Methods for the Cox Proportional Hazards Model</p></a></li>
<li><a href='#baseline.build'><p>Generate simulated baseline hazard, cumulative hazard, survival, failure PDF, and failure CDF functions</p></a></li>
<li><a href='#baseline.plot'><p>Plot the simulated baseline functions</p></a></li>
<li><a href='#bca'><p>Bias-corrected and accelerated confidence intervals</p></a></li>
<li><a href='#bootcov2'><p>Boostrapping algorithm for <code>coxed</code></p></a></li>
<li><a href='#boxsteffensmeier'><p>Data from &quot;A Dynamic Analysis of The Role of War Chests in Campaign Strategy&quot; by</p>
Janet M. Box-Steffensmeier</a></li>
<li><a href='#censor.x'><p>Generate right-censoring to be dependent on the data</p></a></li>
<li><a href='#coxed'><p>Expected durations and marginal changes in expected duration from the</p>
Cox proportional hazards model</a></li>
<li><a href='#coxed.gam'><p>Predict expected durations using the GAM method</p></a></li>
<li><a href='#coxed.gam.tvc'><p>Predict expected durations using the GAM method with time-varying covariates</p></a></li>
<li><a href='#coxed.npsf'><p>Predict expected durations using the GAM method</p></a></li>
<li><a href='#coxed.npsf.tvc'><p>Predict expected durations using the GAM method with time-varying covariates</p></a></li>
<li><a href='#data.plot'><p>Plot the histograms of simulated data</p></a></li>
<li><a href='#generate.lm'><p>Generate simulated durations using a baseline survivor function and proportional hazards</p></a></li>
<li><a href='#make.margeffect'><p>Calculating a simulated marginal effect</p></a></li>
<li><a href='#martinvanberg'><p>Data from &quot;Wasting Time? The Impact of Ideology and Size on Delay in Coalition Formation&quot; by</p>
Lanny W. Martin and Georg Vanberg</a></li>
<li><a href='#rank.predict'><p>Generate predicted ranks for new observations given a new covariate profile</p></a></li>
<li><a href='#sim.survdata'><p>Simulating duration data for the Cox proportional hazards model</p></a></li>
<li><a href='#summary.coxedExpdur'><p>The mean or median expected duration</p></a></li>
<li><a href='#summary.coxedMargin'><p>Marginal changes in expected duration</p></a></li>
<li><a href='#survsim.plot'><p>Plot the simulated baseline functions and histograms of simulated data</p></a></li>
<li><a href='#user.baseline'><p>Calculating baseline functions from a user-specified baseline hazard function</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Duration-Based Quantities of Interest for the Cox Proportional
Hazards Model</td>
</tr>
<tr>
<td>Version:</td>
<td>0.3.3</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0), rms, survival, mgcv</td>
</tr>
<tr>
<td>Description:</td>
<td>Functions for generating, simulating, and visualizing expected durations and marginal changes in duration from the Cox proportional hazards model as described in Kropko and Harden (2017) &lt;<a href="https://doi.org/10.1017%2FS000712341700045X">doi:10.1017/S000712341700045X</a>&gt; and Harden and Kropko (2018) &lt;<a href="https://doi.org/10.1017%2Fpsrm.2018.19">doi:10.1017/psrm.2018.19</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/jkropko/coxed">https://github.com/jkropko/coxed</a></td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>PermAlgo, dplyr, tidyr, ggplot2, gridExtra, mediation, utils</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>6.1.1</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, bindrcpp</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-08-01 16:31:01 UTC; jk8sd</td>
</tr>
<tr>
<td>Author:</td>
<td>Kropko, Jonathan [aut, cre],
  Harden, Jeffrey J. [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>"Kropko, Jonathan" &lt;jkropko@virginia.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-08-02 01:20:07 UTC</td>
</tr>
</table>
<hr>
<h2 id='coxed-package'>Duration-Based Quantities of Interest and Simulation Methods for the Cox Proportional Hazards Model</h2><span id='topic+coxed-package'></span>

<h3>Description</h3>

<p>The Cox proportional hazards model (implemented in R with <code><a href="survival.html#topic+coxph">coxph</a></code> in the <code>survival</code>
package or with <code><a href="rms.html#topic+cph">cph</a></code> in the <code>rms</code> package) is one of the most frequently used estimators
in duration (survival) analysis. Because it is estimated using only the observed durations' rank ordering, typical
quantities of interest used to communicate results of the Cox model come from the hazard function (e.g., hazard ratios
or percentage changes in the hazard rate). These quantities are substantively vague and difficult for many audiences
of research to understand. The <code>coxed</code> package introduces a suite of methods to address these problems.
The package allows researchers to calculate duration-based quantities from Cox model results, such as the expected
duration (or survival time) given covariate values and marginal changes in duration for a specified change in a
covariate. These duration-based quantities often match better with researchers' substantive interests and are
easily understood by most readers.
In addition, no standard method exists for simulating durations directly from the Cox model's data generating
process because it does not assume a distributional form for the baseline hazard function. The <code>coxed</code> package
also contains functions to simulate general duration data that does not rely on an assumption of any particular parametric
hazard function.
</p>


<h3>Duration-Based Quantities of Interest for the Cox Model</h3>

<p>The <code><a href="#topic+coxed">coxed</a></code> function generates expected durations for individual
observations and/or marginal changes in expected duration given a change in a covariate
from the Cox proportional hazards model. Specifically, the methods can compute (1) the
expected duration for each observation used to fit the Cox model, given the covariates,
(2) the expected duration for a &quot;new&quot; observation with a covariate profile set by the
analyst, or (3) the first difference, or change, in expected duration given two new data frames.
</p>
<p>There are two different methods of generating duration-based quantities in the package.
<code><a href="#topic+coxed">coxed</a></code> with <code>type="npsf"</code> calculates expected durations by using the method proposed by
Cox and Oakes (1984, 107-109) for estimating the cumulative baseline hazard function.  This
method is nonparametric and results in a step-function representation of the cumulative
baseline hazard. Cox and Oakes (1984, 108) show that the cumulative baseline hazard function can be estimated
after fitting a Cox model by
</p>
<p style="text-align: center;"><code class="reqn">\hat{H}_0(t) = \sum_{\tau_j &lt; t}\frac{d_j}{\sum_{l\in\Re(\tau_j)}\hat{\psi}(l)},</code>
</p>

<p>where <code class="reqn">\tau_j</code> represents time points earlier than <code class="reqn">t</code>, <code class="reqn">d_j</code> is a count of the
total number of failures at <code class="reqn">\tau_j</code>, <code class="reqn">\Re(\tau_j)</code> is the remaining risk set at <code class="reqn">\tau_j</code>,
and <code class="reqn">\hat{\psi}(l)</code> represents the ELP from the Cox model for observations still in the
risk set at <code class="reqn">\tau_j</code>. This equation is used calculate the cumulative baseline hazard at
all time points in the range of observed durations. This estimate is a stepwise function
because time points with no failures do not contribute to the cumulative hazard, so the function
is flat until the next time point with observed failures.
</p>
<p>We extend this method to obtain expected durations by first calculating the baseline survivor
function from the cumulative hazard function, using
</p>
<p style="text-align: center;"><code class="reqn">\hat{S}_0(t) = \exp[-\hat{H}_0(t)].</code>
</p>

<p>Each observation's survivor function is related to the baseline survivor function by
</p>
<p style="text-align: center;"><code class="reqn">\hat{S}_i(t) = \hat{S}_0(t)^{\hat{\psi}(i)},</code>
</p>

<p>where <code class="reqn">\hat{\psi}(i)</code> is the exponentiated linear predictor (ELP) for observation <code class="reqn">i</code>.
These survivor functions can be used directly to calculate expected durations for each
observation.  The expected value of a non-negative random variable can be calculated by
</p>
<p style="text-align: center;"><code class="reqn">E(X) = \int_0^{\infty} \bigg(1 - F(t)\bigg)dt,</code>
</p>

<p>where <code class="reqn">F(.)</code> is the cumulative distribution function for <code class="reqn">X</code>.  In the case of a
duration variable <code class="reqn">t_i</code>, the expected duration is
</p>
<p style="text-align: center;"><code class="reqn">E(t_i) = \int_0^T S_i(t)\,dt,</code>
</p>

<p>where <code class="reqn">T</code> is the largest possible duration and <code class="reqn">S(t)</code> is the individual's survivor
function.  We approximate this integral with a right Riemann-sum by calculating the survivor
functions at every discrete time point from the minimum to the maximum observed durations,
and multiplying these values by the length of the interval between time points with observed failures:
</p>
<p style="text-align: center;"><code class="reqn">E(t_i) \approx \sum_{t_j \in [0,T]} (t_j - t_{j-1})S_i(t_j).</code>
</p>

<p><code><a href="#topic+coxed">coxed</a></code> with <code>type="gam"</code> employs a generalized additive model (GAM) to map the model's estimated linear
predictor values to duration times and proceeds according to five steps. First, it uses coefficient
estimates from the Cox model, so researchers must first estimate the model just as they always have.
Then the method computes expected values of risk for each observation by matrix-multiplying the
covariates by the estimated coefficients from the model, then exponentiating the result. This creates
the exponentiated linear predictor (ELP). Then the observations are ranked from smallest to largest
according to their values of the ELP. This ranking is interpreted as the expected order of failure;
the larger the value of the ELP, the sooner the model expects that observation to fail, relative to
the other observations. The next step is to connect the model's expected risk for each observation (ELP) to duration time
(the observed durations). A <code><a href="mgcv.html#topic+gam">gam</a></code> fits a model to data by using a series of locally-estimated polynomial
splines set by the user (see, for example, Wood, Pya, and Saefken 2016). It is a flexible means of allowing for
the possibility of nonlinear relationships between variables. <code>coxed</code> with <code>type="gam"</code> uses a GAM to model the observed
durations as a function of the linear predictor ranks generated in the previous step. More specifically, the method
utilizes a cubic regression spline to draw a smoothed line summarizing the bivariate relationship between
the observed durations and the ranks. The GAM fit can be used directly to compute expected durations, given the covariates, for each observation
in the data.
</p>
<p>See Kropko and Harden (2018) for further details about generating expected durations and marginal changes in expected
duration from the Cox model. The <code><a href="#topic+coxed">coxed</a></code> function can also generate these quantities from data with time-varying
covariates (see <code><a href="#topic+coxed.npsf.tvc">coxed.npsf.tvc</a></code> and <code><a href="#topic+coxed.gam.tvc">coxed.gam.tvc</a></code>).
</p>


<h3>Simulating duration data for the Cox model</h3>

<p>The <code><a href="#topic+sim.survdata">sim.survdata</a></code> function generates simulated duration data. It can accept a user-supplied
hazard function, or else it uses the flexible-hazard method described in Harden and Kropko (2018) to generate
a hazard that does not necessarily conform to any parametric hazard function. It can generate data with time-varying
covariates or coefficients. For time-varying covariates <code>type="tvc"</code> it employs the permutational algorithm by Sylvestre and Abrahamowicz (2008).
For time-varying coefficients with <code>type="tvbeta"</code>, the first beta coefficient that is either supplied by the user or generated by
the function is multiplied by the natural log of the failure time under consideration.
</p>
<p>The flexible-hazard method employed when <code>hazard.fun</code> is <code>NULL</code> generates a unique baseline hazard by fitting a curve to
randomly-drawn points. This produces a wide variety
of shapes for the baseline hazard, including those that are unimodal, multimodal, monotonically increasing or decreasing, and many other
shapes. The method then generates a density function based on each baseline hazard and draws durations from it in a way that circumvents
the need to calculate the inverse cumulative baseline hazard. Because the shape of the baseline hazard can vary considerably, this approach
matches the Cox model’s inherent flexibility and better corresponds to the assumed data generating process (DGP) of the Cox model. Moreover,
repeating this process over many iterations in a simulation produces simulated samples of data that better reflect the considerable
heterogeneity in data used by applied researchers. This increases the generalizability of the simulation results. See Harden and Kropko (2018)
for more detail.
</p>
<p>When generating a marginal effect, first the user specifies a covariate by typing its column number in the <code>X</code> matrix into the <code>covariate</code>
argument, then specifies the high and low values at which to fix this covariate.  The function calculates the differences in expected duration for each
observation when fixing the covariate to the high and low values.  If <code>compare</code> is <code>median</code>, the function reports the median of these differences,
and if <code>compare</code> is <code>mean</code>, the function reports the median of these differences, but any function may be employed that takes a vector as input and
outputs a scalar.
</p>
<p>If <code>censor.cond</code> is <code>FALSE</code> then a proportion of the observations specified by <code>censor</code> is randomly and uniformly selected to be right-censored.
If <code>censor.cond</code> is <code>TRUE</code> then censoring depends on the covariates as follows: new coefficients are drawn from normal distributions with mean 0 and
standard deviation of 0.1, and these new coefficients are used to create a new linear predictor using the <code>X</code> matrix.  The observations with the largest
(100 x <code>censor</code>) percent of the linear predictors are designated as right-censored.
</p>
<p>Finally, <code>link[coxed]{survsim.plot}</code> is useful for visualizing the baseline functions, including hazard, that result from
<code>link[coxed]{sim.survdata}</code> for a particular draw of simulated duration data. The function uses <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code>
to create line plots for the baseline failure PDF, the baseline failure CDF, the baseline survivor function,
and the baseline hazard function over time.  The baseline functions and time are attributes of the
<code><a href="#topic+sim.survdata">sim.survdata</a></code> output.
</p>


<h3>Author(s)</h3>

<p>Jonathan Kropko &lt;jkropko@virginia.edu&gt; and Jeffrey J. Harden &lt;jharden2@nd.edu&gt;
</p>


<h3>References</h3>

<p>Harden, J. J. and Kropko, J. (2018) Simulating Duration Data for the Cox Model.
<em>Political Science Research and Methods</em> <a href="https://doi.org/10.1017/psrm.2018.19">https://doi.org/10.1017/psrm.2018.19</a>
</p>
<p>Kropko, J. and Harden, J. J. (2018) Beyond the Hazard Ratio: Generating Expected
Durations from the Cox Proportional Hazards Model. <em>British Journal of Political Science</em>
<a href="https://doi.org/10.1017/S000712341700045X">https://doi.org/10.1017/S000712341700045X</a>
</p>
<p>Box-Steffensmeier, J. M. (1996)
A Dynamic Analysis of The Role of War Chests in Campaign Strategy.
<em>American Journal of Political Science</em> <strong>40</strong> 352-371
</p>
<p>Hyman, J. M. (1983) Accurate monotonicity preserving cubic interpolation. <em>SIAM J. Sci. Stat. Comput.</em> <strong>4</strong>, 645–654.
<a href="https://doi.org/10.1137/0904045">https://doi.org/10.1137/0904045</a>
</p>
<p>Martin, L. W and Vanberg, G. (2003) Wasting Time?
The Impact of Ideology and Size on Delay in Coalition Formation.
<em>British Journal of Political Science</em> <strong>33</strong> 323-344
<a href="https://doi.org/10.1017/S0007123403000140">https://doi.org/10.1017/S0007123403000140</a>
</p>
<p>Sylvestre M.-P., Abrahamowicz M. (2008) Comparison of algorithms to generate event times conditional on time-dependent
covariates. <em>Statistics in Medicine</em> <strong>27(14)</strong>:2618–34. <a href="https://doi.org/10.1002/sim.3092">https://doi.org/10.1002/sim.3092</a>
</p>
<p>Wood, S.N., N. Pya and B. Saefken (2016) Smoothing parameter and model selection for general smooth models (with discussion). <em>Journal of the American Statistical Association</em> <strong>111</strong>, 1548-1575
<a href="http://dx.doi.org/10.1080/01621459.2016.1180986">http://dx.doi.org/10.1080/01621459.2016.1180986</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## See the examples for coxed, sim.survdata, and survsim.plot
</code></pre>

<hr>
<h2 id='baseline.build'>Generate simulated baseline hazard, cumulative hazard, survival, failure PDF, and failure CDF functions</h2><span id='topic+baseline.build'></span>

<h3>Description</h3>

<p>This function is called by <code><a href="#topic+sim.survdata">sim.survdata</a></code> and is not intended to be used by itself.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>baseline.build(T = 100, knots = 8, spline = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="baseline.build_+3A_t">T</code></td>
<td>
<p>The latest time point during which an observation may fail. Failures can occur
as early as 1 and as late as T</p>
</td></tr>
<tr><td><code id="baseline.build_+3A_knots">knots</code></td>
<td>
<p>The number of points to draw while using the flexible-hazard method to generate hazard functions (default is 8).
Ignored if <code>hazard.fun</code> is not <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="baseline.build_+3A_spline">spline</code></td>
<td>
<p>If <code>TRUE</code> (the default), a spline is employed to smooth the generated cumulative baseline hazard, and if <code>FALSE</code>
the cumulative baseline hazard is specified as a step function with steps at the knots. Ignored if <code>hazard.fun</code> is not <code>NULL</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function employs the flexible hazard method described in Harden and Kropko (2018) to generate a baseline
failure CDF: it plots points at (0, 0) and (<code>T</code>+1, 1), and it plots <code>knots</code> additional points with x-coordinates drawn uniformly
from integers in [2, <code>T</code>] and y-coordinates drawn from U[0, 1]. It sorts these coordinates in ascending order
(because a CDF must be non-decreasing) and if <code>spline=TRUE</code> it fits a spline using Hyman’s (1983) cubic smoothing function to preserve the CDF’s monotonicity.
Next it constructs the failure-time PDF by computing the first differences of the CDF at each time point.
It generates the survivor function by subtracting the failure CDF from 1. Finally, it computes the baseline hazard by dividing the failure PDF by the survivor function.
</p>


<h3>Value</h3>

<p>A data frame containing every potential failure time and the baseline failure PDF,
baseline failure CDF, baseline survivor function, and baseline hazard function at each time point.
</p>


<h3>Author(s)</h3>

<p>Jonathan Kropko &lt;jkropko@virginia.edu&gt; and Jeffrey J. Harden &lt;jharden2@nd.edu&gt;
</p>


<h3>References</h3>

<p>Harden, J. J. and Kropko, J. (2018). Simulating Duration Data for the Cox Model.
<em>Political Science Research and Methods</em> <a href="https://doi.org/10.1017/psrm.2018.19">https://doi.org/10.1017/psrm.2018.19</a>
</p>
<p>Hyman, J. M. (1983) Accurate monotonicity preserving cubic interpolation. <em>SIAM J. Sci. Stat. Comput.</em> <strong>4</strong>, 645–654.
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+splinefun">splinefun</a></code>, <code><a href="#topic+sim.survdata">sim.survdata</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>baseline.functions &lt;- baseline.build(T=100, knots=8, spline=TRUE)
</code></pre>

<hr>
<h2 id='baseline.plot'>Plot the simulated baseline functions</h2><span id='topic+baseline.plot'></span>

<h3>Description</h3>

<p>This function is called by <code><a href="#topic+survsim.plot">survsim.plot</a></code> and is not intended to be used by itself.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>baseline.plot(baseline)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="baseline.plot_+3A_baseline">baseline</code></td>
<td>
<p>A data frame containing five variables: time, and the values of the baseline failure PDF,
baseline failure CDF, baseline survivor function, and baseline hazard function at each time point.
Generally, this data frame is taken from the <code>baseline</code> attribute of the <code><a href="#topic+sim.survdata">sim.survdata</a></code>
function</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function reshapes the data for easy faceting with <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code> within
a call to <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code>. Each function is plotted on the y-axis and time is plotted on
the x-axis using <code><a href="ggplot2.html#topic+geom_path">geom_line</a></code>
</p>


<h3>Value</h3>

<p>A figure of class <code>"gg"</code> and <code>"ggplot"</code>
</p>


<h3>Author(s)</h3>

<p>Jonathan Kropko &lt;jkropko@virginia.edu&gt; and Jeffrey J. Harden &lt;jharden2@nd.edu&gt;
</p>


<h3>See Also</h3>

<p><code><a href="#topic+survsim.plot">survsim.plot</a></code>, <code><a href="#topic+sim.survdata">sim.survdata</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>simdata &lt;- sim.survdata(N=1000, T=100, num.data.frames=1)
baseline.plot(simdata$baseline)
</code></pre>

<hr>
<h2 id='bca'>Bias-corrected and accelerated confidence intervals</h2><span id='topic+bca'></span>

<h3>Description</h3>

<p>This function uses the method proposed by DiCiccio and Efron (1996)
to generate confidence intervals that produce more accurate coverage
rates when the distribution of bootstrap draws is non-normal.
This code is adapted from the <code>BC.CI()</code> function within the
<code><a href="mediation.html#topic+mediate">mediate</a></code> function in the <code>mediation</code> package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bca(theta, conf.level = 0.95)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bca_+3A_theta">theta</code></td>
<td>
<p>a vector that contains draws of a quantity of interest using bootstrap samples.
The length of <code>theta</code> is equal to the number of iterations in the previously-run
bootstrap simulation.</p>
</td></tr>
<tr><td><code id="bca_+3A_conf.level">conf.level</code></td>
<td>
<p>the level of the desired confidence interval, as a proportion. Defaults to
.95 which returns the 95 percent confidence interval.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code class="reqn">BC_a</code> confidence intervals are typically calculated using influence statistics
from jackknife simulations. For our purposes, however, running jackknife simulation in addition
to ordinary bootstrapping is too computationally expensive. This function follows the procedure
outlined by DiCiccio and Efron (1996, p. 201) to calculate the bias-correction and acceleration
parameters using only the draws from ordinary bootstrapping.
</p>


<h3>Value</h3>

<p>returns a vector of length 2 in which the first element is the lower bound and the
second element is the upper bound
</p>


<h3>Author(s)</h3>

<p>Jonathan Kropko &lt;jkropko@virginia.edu&gt; and Jeffrey J. Harden &lt;jharden@nd.edu&gt;, based
on the code for the <code><a href="mediation.html#topic+mediate">mediate</a></code> function in the <code>mediation</code> package
by Dustin Tingley, Teppei Yamamoto, Kentaro Hirose, Luke Keele, and Kosuke Imai.
</p>


<h3>References</h3>

<p>DiCiccio, T. J. and B. Efron. (1996). Bootstrap Confidence Intervals. <em>Statistical Science</em>.
11(3): 189–212. <a href="https://doi.org/10.1214/ss/1032280214">https://doi.org/10.1214/ss/1032280214</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+coxed">coxed</a></code>, <code><a href="rms.html#topic+bootcov">bootcov</a></code>, <code><a href="mediation.html#topic+mediate">mediate</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>theta &lt;- rnorm(1000, mean=3, sd=4)
bca(theta, conf.level = .95)
</code></pre>

<hr>
<h2 id='bootcov2'>Boostrapping algorithm for <code>coxed</code></h2><span id='topic+bootcov2'></span>

<h3>Description</h3>

<p>This function uses bootstrapping to create standard errors and
confidence intervals for the quantities produced by the coxed()
function. It is adapted from the <code><a href="rms.html#topic+bootcov">bootcov</a></code> function
in the <code><a href="rms.html#topic+rms">rms</a></code> package. It is called by the <code><a href="#topic+coxed">coxed</a></code>
function and is not intended to be used by itself.  Please refer to
the original <code><a href="rms.html#topic+bootcov">bootcov</a></code> function for general bootstrapping
applications.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bootcov2(fit, cluster, B = 200, fitter, coef.reps = TRUE,
  loglik = FALSE, pr = FALSE, maxit = 15, group = NULL,
  stat = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bootcov2_+3A_fit">fit</code></td>
<td>
<p>an estimated Cox proportional hazards model object with
class &quot;coxph&quot; or &quot;cph&quot;</p>
</td></tr>
<tr><td><code id="bootcov2_+3A_cluster">cluster</code></td>
<td>
<p>a variable indicating groupings. <code>cluster</code> may
be any type of vector (factor, character, integer). Unique values
of <code>cluster</code> indicate possibly correlated groupings of observations.
Note the data used in the fit and stored in <code>fit$x</code> and <code>fit$y</code>
may have had observations containing missing values deleted. It is assumed
that if there were any <code>NA</code>s, an <code>naresid</code> function exists for
the class of fit. This function restores <code>NA</code>s so that the rows of
the design matrix coincide with <code>cluster</code></p>
</td></tr>
<tr><td><code id="bootcov2_+3A_b">B</code></td>
<td>
<p>Number of bootstrap simulation iterations</p>
</td></tr>
<tr><td><code id="bootcov2_+3A_fitter">fitter</code></td>
<td>
<p>the name of a function with arguments <code>(x,y)</code> that will fit
bootstrap samples. Default is taken from the class of fit if it is <code>ols</code>,
<code>lrm</code>, <code>cph</code>, <code>psm</code>, <code>Rq</code>. If <code>fitter="tvc"</code> the
function employs <code><a href="survival.html#topic+agreg.fit">agreg.fit</a></code></p>
</td></tr>
<tr><td><code id="bootcov2_+3A_coef.reps">coef.reps</code></td>
<td>
<p>set to <code>TRUE</code> if you want to store a matrix of all
bootstrap regression coefficient estimates in the returned component <code>boot.Coef</code>.</p>
</td></tr>
<tr><td><code id="bootcov2_+3A_loglik">loglik</code></td>
<td>
<p>set to <code>TRUE</code> to store -2 log likelihoods for each bootstrap model,
evaluated against the original <code>x</code> and <code>y</code> data. The default is to do this when
<code>coef.reps</code> is specified as <code>TRUE</code>. The use of <code>loglik=TRUE</code> assumes
that an <code>oos.loglik</code> method exists for the type of model being analyzed, to calculate
out-of-sample -2 log likelihoods (see <code>rmsMisc</code>). After the B -2 log likelihoods
(stored in the element named <code>boot.loglik</code> in the returned fit object), the <code>B+1</code>
element is the -2 log likelihood for the original model fit</p>
</td></tr>
<tr><td><code id="bootcov2_+3A_pr">pr</code></td>
<td>
<p>set to <code>TRUE</code> to print the current sample number to monitor progress</p>
</td></tr>
<tr><td><code id="bootcov2_+3A_maxit">maxit</code></td>
<td>
<p>maximum number of iterations, to pass to <code>fitter</code></p>
</td></tr>
<tr><td><code id="bootcov2_+3A_group">group</code></td>
<td>
<p>a grouping variable used to stratify the sample upon bootstrapping. This
allows one to handle <code>k</code>-sample problems, i.e., each bootstrap sample will be forced
to select the same number of observations from each level of group as the number appearing
in the original dataset. You may specify both <code>group</code> and <code>cluster</code></p>
</td></tr>
<tr><td><code id="bootcov2_+3A_stat">stat</code></td>
<td>
<p>a single character string specifying the name of a <code>stats</code> element produced
by the fitting function to save over the bootstrap repetitions. The vector of saved statistics
will be in the <code>boot.stats</code> part of the list returned by <code>bootcov</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function contains the same code as the <code><a href="rms.html#topic+bootcov">bootcov</a></code> function in
the <code><a href="rms.html#topic+rms">rms</a></code> package, with a few alterations to work better with the <code><a href="#topic+coxed">coxed</a></code>
function. First, we output a result attribute <code>b.ind</code>, which contains the observation numbers from the estimation sample
that are drawn with replacement to produce the bootstrap sample and takes into account clustering.
Second, we program a new class, <code>tvc</code>, for
<code>fitter</code> to use <code><a href="survival.html#topic+agreg.fit">agreg.fit</a></code> instead of <code><a href="survival.html#topic+agreg.fit">coxph.fit</a></code>
when the data contain time-varying covariates.
</p>


<h3>Author(s)</h3>

<p>Jonathan Kropko &lt;jkropko@virginia.edu&gt; and Jeffrey J. Harden &lt;jharden@nd.edu&gt;, based
on the code for the <code><a href="rms.html#topic+bootcov">bootcov</a></code> function in the <code><a href="rms.html#topic+rms">rms</a></code> package
by Frank Harrell and Bill Pikounis
</p>


<h3>See Also</h3>

<p><code><a href="#topic+coxed">coxed</a></code>, <code><a href="survival.html#topic+coxph">coxph</a></code>, <code><a href="rms.html#topic+cph">cph</a></code>, <code><a href="rms.html#topic+bootcov">bootcov</a></code>
</p>

<hr>
<h2 id='boxsteffensmeier'>Data from &quot;A Dynamic Analysis of The Role of War Chests in Campaign Strategy&quot; by
Janet M. Box-Steffensmeier</h2><span id='topic+boxsteffensmeier'></span>

<h3>Description</h3>

<p>The data cover 397 races for the United States House of Representatives in which an
incumbent ran for reelection in 1990.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>boxsteffensmeier
</code></pre>


<h3>Format</h3>

<p>A data frame with 1376 observations and 8 variables:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>caseid</code> </td><td style="text-align: left;"> ID number </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>start</code> </td><td style="text-align: left;">  Beginning of the measured time interval, in weeks</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>te</code> </td><td style="text-align: left;"> Time to challenger entry (end of the time interval), in weeks </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>ec</code> </td><td style="text-align: left;"> The amount of money (in millions of USD) the incumbent has in reserve </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>dem</code> </td><td style="text-align: left;"> 1 if the incumbent is a Democrat, 0 if the incumbent is a Republican </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>south</code> </td><td style="text-align: left;"> 1 if the district is in the south, 0 else </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>iv</code> </td><td style="text-align: left;"> Prior vote percent </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>cut_hi</code> </td><td style="text-align: left;"> Indicates whether or not a high quality challenger enters the race (censoring variable)</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>


<h3>Source</h3>

<p>Box-Steffensmeier, J. M. (1996)
A Dynamic Analysis of The Role of War Chests in Campaign Strategy.
<em>American Journal of Political Science</em> <strong>40</strong> 352-371
</p>

<hr>
<h2 id='censor.x'>Generate right-censoring to be dependent on the data</h2><span id='topic+censor.x'></span>

<h3>Description</h3>

<p>This function is called by <code><a href="#topic+sim.survdata">sim.survdata</a></code> and is not intended to be used by itself.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>censor.x(x, censor = 0.1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="censor.x_+3A_x">x</code></td>
<td>
<p>A matrix or data frame containing covariates</p>
</td></tr>
<tr><td><code id="censor.x_+3A_censor">censor</code></td>
<td>
<p>The proportion of observations to designate as being right-censored</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The purpose of this function is to efficiently generate indicators for whether or not an observation in simulated duration
data is right-censored. In this case, whether or not an observation is right-censored depends on the covariates in the data.
</p>
<p>This function randomly draws new coefficients, one for every column of <code>x</code>, from the normal distribution with mean 0 and
standard deviation of 0.1.  It uses these new coefficients to build a linear predictor, to which is added a disturbance term which
is also drawn from N(0,.1). A fixed proportion, given by <code>censor</code>, of the observations with the highest values of this linear
predictor are set to be <code>TRUE</code> and the others are set to <code>FALSE</code>.
</p>


<h3>Value</h3>

<p>A vector of logical values
</p>


<h3>Author(s)</h3>

<p>Jonathan Kropko &lt;jkropko@virginia.edu&gt; and Jeffrey J. Harden &lt;jharden2@nd.edu&gt;
</p>


<h3>See Also</h3>

<p><code><a href="#topic+sim.survdata">sim.survdata</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>Xdata &lt;- matrix(rnorm(300), 100, 3)
censor.x(Xdata, .1)
</code></pre>

<hr>
<h2 id='coxed'>Expected durations and marginal changes in expected duration from the
Cox proportional hazards model</h2><span id='topic+coxed'></span>

<h3>Description</h3>

<p><code>coxed()</code> returns expected durations for every observation in the data
used to fit the model, or in new data, or returns the mean or median of these
durations, or differences in duration for two pre-defined covariate profiles.
Standard errors and confidence intervals for all quantities produced by
<code>coxed()</code> are calculated via bootstrapping.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>coxed(cox.model, newdata = NULL, newdata2 = NULL, bootstrap = FALSE,
  method = "npsf", k = -1, B = 200, confidence = "studentized",
  level = 0.95, id = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="coxed_+3A_cox.model">cox.model</code></td>
<td>
<p>The output from a Cox proportional hazards model estimated
with the <code><a href="survival.html#topic+coxph">coxph</a></code> function in the <code>survival</code> package
or with the <code><a href="rms.html#topic+cph">cph</a></code> function in the <code><a href="rms.html#topic+rms">rms</a></code>
package</p>
</td></tr>
<tr><td><code id="coxed_+3A_newdata">newdata</code></td>
<td>
<p>An optional data frame in which to look for variables with
which to predict. If omitted, the fitted values are used</p>
</td></tr>
<tr><td><code id="coxed_+3A_newdata2">newdata2</code></td>
<td>
<p>An optional data frame that can only be specified if
<code>newdata</code> is not omitted, and must have the same dimensions as <code>newdata</code>.
If specified, marginal changes are calculated by subtracting the expected
durations for <code>newdata2</code> from the expected durations for <code>newdata</code></p>
</td></tr>
<tr><td><code id="coxed_+3A_bootstrap">bootstrap</code></td>
<td>
<p>Should bootstrapped standard errors and confidence intervals
be calculated?</p>
</td></tr>
<tr><td><code id="coxed_+3A_method">method</code></td>
<td>
<p>If &quot;npsf&quot; (the default), expected durations are calculated using
the non-parametric step function approach described in Kropko and Harden
(2018). If &quot;gam&quot;, expected durations are calculated using the GAM method</p>
</td></tr>
<tr><td><code id="coxed_+3A_k">k</code></td>
<td>
<p>The number of knots in the GAM smoother. The default is -1, which
employs the <code><a href="mgcv.html#topic+choose.k">choose.k</a></code> function from the <code><a href="mgcv.html#topic+mgcv">mgcv</a></code> package
to choose the number of knots</p>
</td></tr>
<tr><td><code id="coxed_+3A_b">B</code></td>
<td>
<p>Number of bootstrap simulation iterations</p>
</td></tr>
<tr><td><code id="coxed_+3A_confidence">confidence</code></td>
<td>
<p>If &quot;studentized&quot; (the default), bootstrapped CIs
are calculated from the tails of a normal distribution where the mean and
standard deviation are the point estimate and boostrapped SE of each duration
estimate. If &quot;empirical&quot;, bootstrapped confidence intervals are calculated empirically.
If &quot;bca&quot;, bootstrapped confidence intervals are calculated using the bias-correction
and acceleration method described by DiCiccio and Efron (1996).</p>
</td></tr>
<tr><td><code id="coxed_+3A_level">level</code></td>
<td>
<p>The level of the confidence interval to calculate (default is
.95 for a 95 percent confidence interval)</p>
</td></tr>
<tr><td><code id="coxed_+3A_id">id</code></td>
<td>
<p>Cluster variable if bootstrapping is to be done by clusters of
observations rather than individual observations. If the data are coded
with time-varying covariates (using the <code>time2</code> argument in the
<code><a href="survival.html#topic+Surv">Surv</a></code> function), this variable must be the ID variable
in the <em>data that are used to estimate the Cox PH model</em>, and not the ID
variable in new data.</p>
</td></tr>
<tr><td><code id="coxed_+3A_...">...</code></td>
<td>
<p>Additional arguments to be passed to the <code><a href="#topic+bootcov2">bootcov2</a></code>
function, an adaptation of the <code><a href="rms.html#topic+bootcov">bootcov</a></code> function in the
<code><a href="rms.html#topic+rms">rms</a></code> package</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>coxed</code> function generates expected durations for individual
observations and/or marginal changes in expected duration given a change in a covariate
from the Cox proportional hazards model. Specifically, the methods can compute (1) the
expected duration for each observation used to fit the Cox model, given the covariates,
(2) the expected duration for a &quot;new&quot; observation with a covariate profile set by the
analyst, or (3) the first difference, or change, in expected duration given two new data frames.
</p>
<p>There are two different methods, described in Kropko and Harden (2018), of generating duration-based quantities in the package.
The first method calculates expected durations by using a nonparametric estimate of the
baseline hazard and survivor functions (see <code><a href="#topic+coxed.npsf">coxed.npsf</a></code> for details).
The second method employs a generalized additive model
(GAM) to map the model's estimated linear predictor values to duration times (see <code><a href="#topic+coxed.gam">coxed.gam</a></code> for details). Both
methods are also implemented for data structures with time-varying covariates
(see <code><a href="#topic+coxed.npsf.tvc">coxed.npsf.tvc</a></code> and <code><a href="#topic+coxed.gam.tvc">coxed.gam.tvc</a></code>).
</p>


<h3>Value</h3>

<p><code>coxed</code> returns an object of <code><a href="base.html#topic+class">class</a></code> &quot;coxedExpdur&quot; or
&quot;coxedMargin&quot;, which is a list containing some of the following components, depending
on the implementation of <code>coxed</code>:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>exp.dur</code> </td><td style="text-align: left;"> A vector of predicted mean durations for the estimation sample
if <code>newdata</code> is omitted, or else for the specified new data.  If <code>bootstrap</code>
is <code>TRUE</code> bootstrapped standard errors are also provided, as well as the confidence
interval requested by <code>level</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>mean</code> </td><td style="text-align: left;"> The mean of the predicted durations. If <code>bootstrap</code>
is <code>TRUE</code> bootstrapped standard errors are also provided, as well as the confidence
interval requested by <code>level</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>median</code> </td><td style="text-align: left;"> The median of the predicted durations. If <code>bootstrap</code>
is <code>TRUE</code> bootstrapped standard errors are also provided, as well as the confidence
interval requested by <code>level</code>. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>baseline.functions</code> </td><td style="text-align: left;"> The estimated cumulative baseline hazard function and survivor function. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>gam.model</code> </td><td style="text-align: left;"> Output from the <code><a href="mgcv.html#topic+gam">gam</a></code> function in which the durations
are fit against the exponentiated linear predictors from the Cox model.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>gam.data</code> </td><td style="text-align: left;"> Fitted values and confidence intervals from the GAM model.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>exp.dur1</code> </td><td style="text-align: left;">  A vector of predicted mean durations for the observations in <code>newdata1</code>
when calculating marginal effects. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>exp.dur2</code> </td><td style="text-align: left;"> A vector of predicted mean durations for the observations in <code>newdata2</code>
when calculating marginal effects. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>mean1</code> </td><td style="text-align: left;"> The mean of the predicted mean durations for the observations in <code>newdata1</code>
when calculating marginal effects. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>mean2</code> </td><td style="text-align: left;"> The mean of the predicted mean durations for the observations in <code>newdata2</code>
when calculating marginal effects. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>median1</code> </td><td style="text-align: left;"> The median of the predicted mean durations for the observations in <code>newdata1</code>
when calculating marginal effects. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>median2</code> </td><td style="text-align: left;"> The median of the predicted mean durations for the observations in <code>newdata2</code>
when calculating marginal effects. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>diff</code> </td><td style="text-align: left;"> A vector of the difference between the predicted mean durations for each
observation under the covariate profile in <code>newdata2</code> and the covariate profile in <code>newdata1</code>.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>mean.diff</code> </td><td style="text-align: left;"> The mean of the differences in duration across observations. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>median.diff</code> </td><td style="text-align: left;"> The median of the differences in duration across observations. </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Jonathan Kropko &lt;jkropko@virginia.edu&gt; and Jeffrey J. Harden &lt;jharden2@nd.edu&gt;
</p>


<h3>References</h3>

<p>Kropko, J. and Harden, J. J. (2018). Beyond the Hazard Ratio: Generating Expected Durations from the
Cox Proportional Hazards Model. <em>British Journal of Political Science</em> <a href="https://doi.org/10.1017/S000712341700045X">https://doi.org/10.1017/S000712341700045X</a>
</p>
<p>DiCiccio, T. J. and B. Efron. (1996). Bootstrap Confidence Intervals. <em>Statistical Science</em>.
11(3): 189–212. <a href="https://doi.org/10.1214/ss/1032280214">https://doi.org/10.1214/ss/1032280214</a>
</p>


<h3>See Also</h3>

<p><code><a href="survival.html#topic+coxph">coxph</a></code>, <code><a href="rms.html#topic+cph">cph</a></code>, <code><a href="#topic+bootcov2">bootcov2</a></code>,
<code><a href="#topic+coxed.gam">coxed.gam</a></code>, <code><a href="#topic+coxed.gam.tvc">coxed.gam.tvc</a></code>, <code><a href="#topic+coxed.npsf">coxed.npsf</a></code>,
<code><a href="#topic+coxed.npsf.tvc">coxed.npsf.tvc</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>mv.surv &lt;- Surv(martinvanberg$formdur, event = rep(1, nrow(martinvanberg)))
mv.cox &lt;- coxph(mv.surv ~ postel + prevdef + cont + ident + rgovm + pgovno +
     tpgovno + minority, method = "breslow", data = martinvanberg)
summary(mv.cox)

# NPSF method
ed1 &lt;- coxed(mv.cox, method="npsf")
ed1$baseline.functions
ed1$exp.dur
summary(ed1, stat="mean")
summary(ed1, stat="median")

## Not run: ed1 &lt;- coxed(mv.cox, method="npsf", bootstrap = TRUE)
ed1$exp.dur
summary(ed1, stat="mean")
summary(ed1, stat="median")

## End(Not run)

me &lt;- coxed(mv.cox, method="npsf", bootstrap = FALSE,
            newdata = dplyr::mutate(martinvanberg, pgovno=1),
            newdata2 = dplyr::mutate(martinvanberg, pgovno=6))
summary(me, stat="mean")

# GAM method
ed2 &lt;- coxed(mv.cox, method="gam")
summary(ed2$gam.data)
summary(ed2$gam.model)
ed2$exp.dur
summary(ed2, stat="mean")

## Not run: me &lt;- coxed(mv.cox, method="gam", bootstrap = TRUE,
            newdata = dplyr::mutate(martinvanberg, pgovno=1),
            newdata2 = dplyr::mutate(martinvanberg, pgovno=6))
summary(me, stat="mean")
summary(me, stat="median")

## End(Not run)

#Plotting the GAM fit
## Not run: ggplot(ed2$gam.data, aes(x=rank.xb, y=y)) +
    geom_point() +
    geom_line(aes(x=rank.xb, y=gam_fit)) +
    geom_ribbon(aes(ymin=gam_fit_95lb, ymax=gam_fit_95ub), alpha=.5) +
    xlab("Cox model LP rank (smallest to largest)") +
    ylab("Duration")

## End(Not run)

#Time-varying covariates
bs.surv &lt;- Surv(time = boxsteffensmeier$start, time2 = boxsteffensmeier$te,
     event = boxsteffensmeier$cut_hi)
bs.cox &lt;- coxph(bs.surv ~ ec + dem + south + iv, data = boxsteffensmeier, method = "breslow")
summary(bs.cox)

ed1 &lt;- coxed(bs.cox, method="npsf", id=boxsteffensmeier$caseid)
ed1$exp.dur
summary(ed1, stat="mean")
</code></pre>

<hr>
<h2 id='coxed.gam'>Predict expected durations using the GAM method</h2><span id='topic+coxed.gam'></span>

<h3>Description</h3>

<p>This function is called by <code><a href="#topic+coxed">coxed</a></code> and is not intended to be used by itself.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>coxed.gam(cox.model, newdata = NULL, k = -1, coef = NULL,
  b.ind = NULL, warn = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="coxed.gam_+3A_cox.model">cox.model</code></td>
<td>
<p>The output from a Cox proportional hazards model estimated
with the <code><a href="survival.html#topic+coxph">coxph</a></code> function in the <code>survival</code> package
or with the <code><a href="rms.html#topic+cph">cph</a></code> function in the <code><a href="rms.html#topic+rms">rms</a></code>
package</p>
</td></tr>
<tr><td><code id="coxed.gam_+3A_newdata">newdata</code></td>
<td>
<p>An optional data frame in which to look for variables with
which to predict. If omitted, the fitted values are used</p>
</td></tr>
<tr><td><code id="coxed.gam_+3A_k">k</code></td>
<td>
<p>The number of knots in the GAM smoother. The default is -1, which
employs the <code><a href="mgcv.html#topic+choose.k">choose.k</a></code> function from the <code><a href="mgcv.html#topic+mgcv">mgcv</a></code> package
to choose the number of knots</p>
</td></tr>
<tr><td><code id="coxed.gam_+3A_coef">coef</code></td>
<td>
<p>A vector of new coefficients to replace the <code>coefficients</code> attribute
of the <code>cox.model</code>. Used primarily for bootstrapping, to recalculate durations
using new coefficients derived from a bootstrapped sample.
If <code>NULL</code>, the original coefficients are employed</p>
</td></tr>
<tr><td><code id="coxed.gam_+3A_b.ind">b.ind</code></td>
<td>
<p>A vector of observation numbers to pass to the estimation sample to construct
the a bootstrapped sample with replacement</p>
</td></tr>
<tr><td><code id="coxed.gam_+3A_warn">warn</code></td>
<td>
<p>If <code>TRUE</code>, displays warnings, and if <code>FALSE</code> suppresses them</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function employs the GAM method of generating expected durations described
in Kropko and Harden (2018), which proceeds according to five steps. First, it uses coefficient
estimates from the Cox model, so researchers must first estimate the model just as they always have.
Then the method computes expected values of risk for each observation by matrix-multiplying the
covariates by the estimated coefficients from the model, then exponentiating the result. This creates
the exponentiated linear predictor (ELP). Then the observations are ranked from smallest to largest
according to their values of the ELP. This ranking is interpreted as the expected order of failure;
the larger the value of the ELP, the sooner the model expects that observation to fail, relative to
the other observations.
</p>
<p>The next step is to connect the model's expected risk for each observation (ELP) to duration time
(the observed durations). A <code><a href="mgcv.html#topic+gam">gam</a></code> fits a model to data by using a series of locally-estimated polynomial
splines set by the user (see, for example, Wood, Pya, and Saefken 2016). It is a flexible means of allowing for
the possibility of nonlinear relationships between variables. <code>coxed.gam</code> uses a GAM to model the observed
utilizes a cubic regression spline to draw a smoothed line summarizing the bivariate relationship between
the observed durations and the ranks. The GAM fit can be used directly to compute expected durations, given the covariates, for each observation
in the data.
</p>


<h3>Value</h3>

<p>Returns a list containing the following components:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>exp.dur</code> </td><td style="text-align: left;"> A vector of predicted mean durations for the estimation sample
if <code>newdata</code> is omitted, or else for the specified new data. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>gam.model</code> </td><td style="text-align: left;"> Output from the <code><a href="mgcv.html#topic+gam">gam</a></code> function in which the durations
are fit against the exponentiated linear predictors from the Cox model.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>gam.data</code> </td><td style="text-align: left;"> Fitted values and confidence intervals from the GAM model.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Jonathan Kropko &lt;jkropko@virginia.edu&gt; and Jeffrey J. Harden &lt;jharden2@nd.edu&gt;
</p>


<h3>References</h3>

<p>Kropko, J. and Harden, J. J. (2018). Beyond the Hazard Ratio: Generating Expected
Durations from the Cox Proportional Hazards Model. <em>British Journal of Political Science</em>
<a href="https://doi.org/10.1017/S000712341700045X">https://doi.org/10.1017/S000712341700045X</a>
</p>
<p>Wood, S.N., N. Pya and B. Saefken (2016). Smoothing parameter and model selection for general smooth models (with discussion). <em>Journal of the American Statistical Association</em> <strong>111</strong>, 1548-1575
<a href="http://dx.doi.org/10.1080/01621459.2016.1180986">http://dx.doi.org/10.1080/01621459.2016.1180986</a>
</p>


<h3>See Also</h3>

<p><code><a href="mgcv.html#topic+gam">gam</a></code>, <code><a href="#topic+coxed">coxed</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>mv.surv &lt;- Surv(martinvanberg$formdur, event = rep(1, nrow(martinvanberg)))
mv.cox &lt;- coxph(mv.surv ~ postel + prevdef + cont + ident + rgovm +
pgovno + tpgovno + minority, method = "breslow", data = martinvanberg)

ed &lt;- coxed.gam(mv.cox)
summary(ed$gam.data)
summary(ed$gam.model)
ed$exp.dur

#Plotting the GAM fit
## Not run: require(ggplot2)
ggplot(ed$gam.data, aes(x=rank.xb, y=y)) +
    geom_point() +
    geom_line(aes(x=rank.xb, y=gam_fit)) +
    geom_ribbon(aes(ymin=gam_fit_95lb, ymax=gam_fit_95ub), alpha=.5) +
    xlab("Cox model LP rank (smallest to largest)") +
    ylab("Duration")

## End(Not run)

#Running coxed.gam() on a bootstrap sample and with new coefficients
bsample &lt;- sample(1:nrow(martinvanberg), nrow(martinvanberg), replace=TRUE)
newcoefs &lt;- rnorm(8)
ed2 &lt;- coxed.gam(mv.cox, b.ind=bsample, coef=newcoefs)
</code></pre>

<hr>
<h2 id='coxed.gam.tvc'>Predict expected durations using the GAM method with time-varying covariates</h2><span id='topic+coxed.gam.tvc'></span>

<h3>Description</h3>

<p>This function is called by <code><a href="#topic+coxed">coxed</a></code> and is not intended to be used by itself.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>coxed.gam.tvc(cox.model, newdata = NULL, k = -1, coef = NULL,
  b.ind = NULL, warn = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="coxed.gam.tvc_+3A_cox.model">cox.model</code></td>
<td>
<p>The output from a Cox proportional hazards model estimated
with the <code><a href="survival.html#topic+coxph">coxph</a></code> function in the <code>survival</code> package
or with the <code><a href="rms.html#topic+cph">cph</a></code> function in the <code><a href="rms.html#topic+rms">rms</a></code>
package</p>
</td></tr>
<tr><td><code id="coxed.gam.tvc_+3A_newdata">newdata</code></td>
<td>
<p>An optional data frame in which to look for variables with
which to predict. If omitted, the fitted values are used</p>
</td></tr>
<tr><td><code id="coxed.gam.tvc_+3A_k">k</code></td>
<td>
<p>The number of knots in the GAM smoother. The default is -1, which
employs the <code><a href="mgcv.html#topic+choose.k">choose.k</a></code> function from the <code><a href="mgcv.html#topic+mgcv">mgcv</a></code> package
to choose the number of knots</p>
</td></tr>
<tr><td><code id="coxed.gam.tvc_+3A_coef">coef</code></td>
<td>
<p>A vector of new coefficients to replace the <code>coefficients</code> attribute
of the <code>cox.model</code>. Used primarily for bootstrapping, to recalculate durations
using new coefficients derived from a bootstrapped sample.
If <code>NULL</code>, the original coefficients are employed</p>
</td></tr>
<tr><td><code id="coxed.gam.tvc_+3A_b.ind">b.ind</code></td>
<td>
<p>A vector of observation numbers to pass to the estimation sample to construct
the a bootstrapped sample with replacement</p>
</td></tr>
<tr><td><code id="coxed.gam.tvc_+3A_warn">warn</code></td>
<td>
<p>If <code>TRUE</code>, displays warnings, and if <code>FALSE</code> suppresses them</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function employs the GAM method of generating expected durations described
in Kropko and Harden (2018). See <code><a href="#topic+coxed.gam">coxed.gam</a></code> for details.  This code
replicates the code for <code>cox.gam</code>, but works with data whose structure allows time-varying
covariates, and requires using the <code>time2</code> argument of the <code><a href="survival.html#topic+Surv">Surv</a></code> function.
This function requires the data to be reported as cumulative durations. The GAM model is fit using
the ending times for each interval and using only the non-censored observations. Expected durations
are drawn from this GAM as with <code><a href="#topic+coxed.gam">coxed.gam</a></code>.
</p>


<h3>Value</h3>

<p>Returns a list containing the following components:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>exp.dur</code> </td><td style="text-align: left;"> A vector of predicted mean durations for the estimation sample
if <code>newdata</code> is omitted, or else for the specified new data.  </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>gam.model</code> </td><td style="text-align: left;"> Output from the <code><a href="mgcv.html#topic+gam">gam</a></code> function in which the durations
are fit against the exponentiated linear predictors from the Cox model.</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>gam.data</code> </td><td style="text-align: left;"> Fitted values and confidence intervals from the GAM model.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Jonathan Kropko &lt;jkropko@virginia.edu&gt; and Jeffrey J. Harden &lt;jharden2@nd.edu&gt;
</p>


<h3>References</h3>

<p>Kropko, J. and Harden, J. J. (2018). Beyond the Hazard Ratio: Generating Expected
Durations from the Cox Proportional Hazards Model. <em>British Journal of Political Science</em>
<a href="https://doi.org/10.1017/S000712341700045X">https://doi.org/10.1017/S000712341700045X</a>
</p>


<h3>See Also</h3>

<p><code><a href="mgcv.html#topic+gam">gam</a></code>, <code><a href="#topic+coxed">coxed</a></code>, <code><a href="#topic+coxed.gam">coxed.gam</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>bs.surv &lt;- Surv(time = boxsteffensmeier$start, time2 = boxsteffensmeier$te,
     event = boxsteffensmeier$cut_hi)
bs.cox &lt;- coxph(bs.surv ~ ec + dem + south + iv, data = boxsteffensmeier, method = "breslow")
summary(bs.cox)

ed &lt;- coxed.gam.tvc(bs.cox)
ed$exp.dur
</code></pre>

<hr>
<h2 id='coxed.npsf'>Predict expected durations using the GAM method</h2><span id='topic+coxed.npsf'></span>

<h3>Description</h3>

<p>This function is called by <code><a href="#topic+coxed">coxed</a></code> and is not intended to be used by itself.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>coxed.npsf(cox.model, newdata = NULL, coef = NULL, b.ind = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="coxed.npsf_+3A_cox.model">cox.model</code></td>
<td>
<p>The output from a Cox proportional hazards model estimated
with the <code><a href="survival.html#topic+coxph">coxph</a></code> function in the <code>survival</code> package
or with the <code><a href="rms.html#topic+cph">cph</a></code> function in the <code><a href="rms.html#topic+rms">rms</a></code>
package</p>
</td></tr>
<tr><td><code id="coxed.npsf_+3A_newdata">newdata</code></td>
<td>
<p>An optional data frame in which to look for variables with
which to predict. If omitted, the fitted values are used</p>
</td></tr>
<tr><td><code id="coxed.npsf_+3A_coef">coef</code></td>
<td>
<p>A vector of new coefficients to replace the <code>coefficients</code> attribute
of the <code>cox.model</code>. Used primarily for bootstrapping, to recalculate durations
using new coefficients derived from a bootstrapped sample.
If <code>NULL</code>, the original coefficients are employed</p>
</td></tr>
<tr><td><code id="coxed.npsf_+3A_b.ind">b.ind</code></td>
<td>
<p>A vector of observation numbers to pass to the estimation sample to construct
the a bootstrapped sample with replacement</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The non-parametric step function (NPSF) approach to calculating expected durations from the Cox
proportional hazards model, described in Kropko and Harden (2018), uses the method proposed by
Cox and Oakes (1984, 107-109) for estimating the cumulative baseline hazard function.  This
method is nonparametric and results in a step-function representation of the cumulative
baseline hazard.
</p>
<p>Cox and Oakes (1984, 108) show that the cumulative baseline hazard function can be estimated
after fitting a Cox model by
</p>
<p style="text-align: center;"><code class="reqn">\hat{H}_0(t) = \sum_{\tau_j &lt; t}\frac{d_j}{\sum_{l\in\Re(\tau_j)}\hat{\psi}(l)},</code>
</p>

<p>where <code class="reqn">\tau_j</code> represents time points earlier than <code class="reqn">t</code>, <code class="reqn">d_j</code> is a count of the
total number of failures at <code class="reqn">\tau_j</code>, <code class="reqn">\Re(\tau_j)</code> is the remaining risk set at <code class="reqn">\tau_j</code>,
and <code class="reqn">\hat{\psi}(l)</code> represents the ELP from the Cox model for observations still in the
risk set at <code class="reqn">\tau_j</code>. This equation is used calculate the cumulative baseline hazard at
all time points in the range of observed durations. This estimate is a stepwise function
because time points with no failures do not contribute to the cumulative hazard, so the function
is flat until the next time point with observed failures.
</p>
<p>We extend this method to obtain expected durations by first calculating the baseline survivor
function from the cumulative hazard function, using
</p>
<p style="text-align: center;"><code class="reqn">\hat{S}_0(t) = \exp[-\hat{H}_0(t)].</code>
</p>

<p>Each observation's survivor function is related to the baseline survivor function by
</p>
<p style="text-align: center;"><code class="reqn">\hat{S}_i(t) = \hat{S}_0(t)^{\hat{\psi}(i)},</code>
</p>

<p>where <code class="reqn">\hat{\psi}(i)</code> is the exponentiated linear predictor (ELP) for observation <code class="reqn">i</code>.
These survivor functions can be used directly to calculate expected durations for each
observation.  The expected value of a non-negative random variable can be calculated by
</p>
<p style="text-align: center;"><code class="reqn">E(X) = \int_0^{\infty} \bigg(1 - F(t)\bigg)dt,</code>
</p>

<p>where <code class="reqn">F(.)</code> is the cumulative distribution function for <code class="reqn">X</code>.  In the case of a
duration variable <code class="reqn">t_i</code>, the expected duration is
</p>
<p style="text-align: center;"><code class="reqn">E(t_i) = \int_0^T S_i(t)\,dt,</code>
</p>

<p>where <code class="reqn">T</code> is the largest possible duration and <code class="reqn">S(t)</code> is the individual's survivor
function.  We approximate this integral with a right Riemann-sum by calculating the survivor
functions at every discrete time point from the minimum to the maximum observed durations,
and multiplying these values by the length of the interval between time points with observed failures:
</p>
<p style="text-align: center;"><code class="reqn">E(t_i) \approx \sum_{t_j \in [0,T]} (t_j - t_{j-1})S_i(t_j).</code>
</p>



<h3>Value</h3>

<p>Returns a list containing the following components:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>exp.dur</code> </td><td style="text-align: left;"> A vector of predicted mean durations for the estimation sample
if <code>newdata</code> is omitted, or else for the specified new data. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>baseline.functions</code> </td><td style="text-align: left;"> The estimated cumulative baseline hazard function and survivor function. </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Jonathan Kropko &lt;jkropko@virginia.edu&gt; and Jeffrey J. Harden &lt;jharden2@nd.edu&gt;
</p>


<h3>References</h3>

<p>Kropko, J. and Harden, J. J. (2018). Beyond the Hazard Ratio: Generating Expected
Durations from the Cox Proportional Hazards Model. <em>British Journal of Political Science</em>
<a href="https://doi.org/10.1017/S000712341700045X">https://doi.org/10.1017/S000712341700045X</a>
</p>
<p>Cox, D. R., and Oakes, D. (1984). <em>Analysis of Survival Data. Monographs on Statistics &amp; Applied Probability</em>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+coxed">coxed</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>mv.surv &lt;- Surv(martinvanberg$formdur, event = rep(1, nrow(martinvanberg)))
mv.cox &lt;- coxph(mv.surv ~ postel + prevdef + cont + ident + rgovm + pgovno + tpgovno +
     minority, method = "breslow", data = martinvanberg)

ed &lt;- coxed.npsf(mv.cox)
ed$baseline.functions
ed$exp.dur

#Running coxed.npsf() on a bootstrap sample and with new coefficients
bsample &lt;- sample(1:nrow(martinvanberg), nrow(martinvanberg), replace=TRUE)
newcoefs &lt;- rnorm(8)
ed2 &lt;- coxed.npsf(mv.cox, b.ind=bsample, coef=newcoefs)
</code></pre>

<hr>
<h2 id='coxed.npsf.tvc'>Predict expected durations using the GAM method with time-varying covariates</h2><span id='topic+coxed.npsf.tvc'></span>

<h3>Description</h3>

<p>This function is called by <code><a href="#topic+coxed">coxed</a></code> and is not intended to be used by itself.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>coxed.npsf.tvc(cox.model, newdata = NULL, coef = NULL, b.ind = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="coxed.npsf.tvc_+3A_cox.model">cox.model</code></td>
<td>
<p>The output from a Cox proportional hazards model estimated
with the <code><a href="survival.html#topic+coxph">coxph</a></code> function in the <code>survival</code> package
or with the <code><a href="rms.html#topic+cph">cph</a></code> function in the <code><a href="rms.html#topic+rms">rms</a></code>
package</p>
</td></tr>
<tr><td><code id="coxed.npsf.tvc_+3A_newdata">newdata</code></td>
<td>
<p>An optional data frame in which to look for variables with
which to predict. If omitted, the fitted values are used</p>
</td></tr>
<tr><td><code id="coxed.npsf.tvc_+3A_coef">coef</code></td>
<td>
<p>A vector of new coefficients to replace the <code>coefficients</code> attribute
of the <code>cox.model</code>. Used primarily for bootstrapping, to recalculate durations
using new coefficients derived from a bootstrapped sample.
If <code>NULL</code>, the original coefficients are employed</p>
</td></tr>
<tr><td><code id="coxed.npsf.tvc_+3A_b.ind">b.ind</code></td>
<td>
<p>A vector of observation numbers to pass to the estimation sample to construct
the a bootstrapped sample with replacement</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function employs the NPSF method of generating expected durations described
in Kropko and Harden (2018). See <code><a href="#topic+coxed.npsf">coxed.npsf</a></code> for details.  This code
replicates the code for <code>cox.npsf</code>, but works with data whose structure allows time-varying
covariates, and requires using the <code>time2</code> argument of the <code><a href="survival.html#topic+Surv">Surv</a></code> function.
This function requires the data to be reported as cumulative durations. The cumulative baseline hazard
function model is estimated using the ending times for each interval. Then the expected durations are
drawn from the Cox model and the NPSF method as with <code><a href="#topic+coxed.npsf">coxed.npsf</a></code>.
</p>


<h3>Value</h3>

<p>Returns a list containing the following components:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>exp.dur</code> </td><td style="text-align: left;"> A vector of predicted mean durations for the estimation sample
if <code>newdata</code> is omitted, or else for the specified new data. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>baseline.functions</code> </td><td style="text-align: left;"> The estimated cumulative baseline hazard function and survivor function. </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Jonathan Kropko &lt;jkropko@virginia.edu&gt; and Jeffrey J. Harden &lt;jharden2@nd.edu&gt;
</p>


<h3>References</h3>

<p>Kropko, J. and Harden, J. J. (2018). Beyond the Hazard Ratio: Generating Expected Durations
from the Cox Proportional Hazards Model. <em>British Journal of Political Science</em>
<a href="https://doi.org/10.1017/S000712341700045X">https://doi.org/10.1017/S000712341700045X</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+coxed">coxed</a></code>, <code><a href="#topic+coxed.npsf">coxed.npsf</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>bs.surv &lt;- Surv(time = boxsteffensmeier$start, time2 = boxsteffensmeier$te,
     event = boxsteffensmeier$cut_hi)
bs.cox &lt;- coxph(bs.surv ~ ec + dem + south + iv, data = boxsteffensmeier, method = "breslow")

ed &lt;- coxed.npsf.tvc(bs.cox)
ed$exp.dur
</code></pre>

<hr>
<h2 id='data.plot'>Plot the histograms of simulated data</h2><span id='topic+data.plot'></span>

<h3>Description</h3>

<p>This function is called by <code><a href="#topic+survsim.plot">survsim.plot</a></code> and is not intended to be used by itself.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data.plot(data, xb, bins = 30)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="data.plot_+3A_data">data</code></td>
<td>
<p>A data frame of simulated duration data in which the duration variable is called y.
Generally, this data frame is taken from the <code>data</code> attribute of the <code><a href="#topic+sim.survdata">sim.survdata</a></code>
function</p>
</td></tr>
<tr><td><code id="data.plot_+3A_xb">xb</code></td>
<td>
<p>A vector of the linear predictors, combining the covariates and coefficients from the simulation.
Generally, this data frame is taken from the <code>xb</code> attribute of the <code><a href="#topic+sim.survdata">sim.survdata</a></code>
function</p>
</td></tr>
<tr><td><code id="data.plot_+3A_bins">bins</code></td>
<td>
<p>The number of bins to draw in each histogram</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function produces three histograms, one of the simulated durations, one of the linear predictors,
and one of the exponentiated linear predictors. It uses <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code> within
a call to <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code> to arrange the plots.
</p>


<h3>Value</h3>

<p>A figure of class <code>"gg"</code> and <code>"ggplot"</code>
</p>


<h3>Author(s)</h3>

<p>Jonathan Kropko &lt;jkropko@virginia.edu&gt; and Jeffrey J. Harden &lt;jharden2@nd.edu&gt;
</p>


<h3>See Also</h3>

<p><code><a href="#topic+survsim.plot">survsim.plot</a></code>, <code><a href="#topic+sim.survdata">sim.survdata</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>simdata &lt;- sim.survdata(N=1000, T=100, num.data.frames=1)
data.plot(simdata$data, simdata$xb)
</code></pre>

<hr>
<h2 id='generate.lm'>Generate simulated durations using a baseline survivor function and proportional hazards</h2><span id='topic+generate.lm'></span>

<h3>Description</h3>

<p>This function is called by <code><a href="#topic+sim.survdata">sim.survdata</a></code> and is not intended to be used by itself.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>generate.lm(baseline, X = NULL, N = 1000, type = "none",
  beta = NULL, xvars = 3, mu = 0, sd = 1, censor = 0.1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="generate.lm_+3A_baseline">baseline</code></td>
<td>
<p>The baseline hazard, cumulative hazard, survival, failure PDF, and failure CDF as output by <code><a href="#topic+baseline.build">baseline.build</a></code></p>
</td></tr>
<tr><td><code id="generate.lm_+3A_x">X</code></td>
<td>
<p>A user-specified data frame containing the covariates that condition duration. If <code>NULL</code>, covariates are generated from
normal distributions with means given by the <code>mu</code> argument and standard deviations given by the <code>sd</code> argument</p>
</td></tr>
<tr><td><code id="generate.lm_+3A_n">N</code></td>
<td>
<p>Number of observations in each generated data frame</p>
</td></tr>
<tr><td><code id="generate.lm_+3A_type">type</code></td>
<td>
<p>If &quot;none&quot; (the default) data are generated with no time-varying covariates or coefficients.
If &quot;tvc&quot;, data are generated with time-varying covariates, and if &quot;tvbeta&quot; data are generated with time-varying
coefficients (see details)</p>
</td></tr>
<tr><td><code id="generate.lm_+3A_beta">beta</code></td>
<td>
<p>A user-specified vector containing the coefficients that for the linear part of the duration model. If <code>NULL</code>, coefficients are generated from
normal distributions with means of 0 and standard deviations of 0.1</p>
</td></tr>
<tr><td><code id="generate.lm_+3A_xvars">xvars</code></td>
<td>
<p>The number of covariates to generate. Ignored if <code>X</code> is not <code>NULL</code></p>
</td></tr>
<tr><td><code id="generate.lm_+3A_mu">mu</code></td>
<td>
<p>If scalar, all covariates are generated to have means equal to this scalar. If a vector, it specifies the mean of each covariate separately,
and it must be equal in length to <code>xvars</code>. Ignored if <code>X</code> is not <code>NULL</code></p>
</td></tr>
<tr><td><code id="generate.lm_+3A_sd">sd</code></td>
<td>
<p>If scalar, all covariates are generated to have standard deviations equal to this scalar. If a vector, it specifies the standard deviation
of each covariate separately, and it must be equal in length to <code>xvars</code>. Ignored if <code>X</code> is not <code>NULL</code></p>
</td></tr>
<tr><td><code id="generate.lm_+3A_censor">censor</code></td>
<td>
<p>The proportion of observations to designate as being right-censored</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>type="none"</code> then the function generates idiosyncratic survival functions for each observation via proportional hazards: first the
linear predictor is calculated from the X variables and beta coefficients, then the linear predictor is exponentiated and set as the exponent of the
baseline survivor function.  For each individual observation's survival function, a duration is drawn by drawing a single random number on U[0,1]
and finding the time point at which the survival function first decreases past this value. See Harden and Kropko (2018) for a more detailed description
of this algorithm.
</p>
<p>If <code>type="tvc"</code>, this function cannot accept user-supplied data for the covariates, as a time-varying covariate is expressed over time frames
which themselves convey part of the variation of the durations, and we are generating these durations. If user-supplied X data is provided, the
function passes a warning and generates random data instead as if <code>X=NULL</code>. Durations are drawn again using proportional hazards, and are passed
to the <code><a href="PermAlgo.html#topic+permalgorithm">permalgorithm</a></code> function in the <code>PermAlgo</code> package to generate the time-varying data structure (Sylvestre and Abrahamowicz 2008).
</p>
<p>If <code>type="tvbeta"</code> the first coefficient, whether coefficients are user-supplied or randomly generated, is interacted with the natural log of
the time counter from 1 to <code>T</code> (the maximum time point for the <code>baseline</code> functions). Durations are generated via proportional hazards,
and coefficients are saved as a matrix to illustrate their dependence on time.
</p>


<h3>Value</h3>

<p>Returns a list with the following components:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>data</code> </td><td style="text-align: left;"> The simulated data frame, including the simulated durations, the censoring variable, and covariates</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>beta</code> </td><td style="text-align: left;"> The coefficients, varying over time if <code>type</code> is "tvbeta" </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>XB</code> </td><td style="text-align: left;"> The linear predictor for each observation </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>exp.XB</code> </td><td style="text-align: left;"> The exponentiated linear predictor for each observation </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>survmat</code> </td><td style="text-align: left;"> An (<code>N</code> x <code>T</code>) matrix containing the individual survivor function at
time t for the individual represented by row n   </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>tvc</code> </td><td style="text-align: left;"> A logical value indicating whether or not the data includes time-varying covariates </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Jonathan Kropko &lt;jkropko@virginia.edu&gt; and Jeffrey J. Harden &lt;jharden2@nd.edu&gt;
</p>


<h3>References</h3>

<p>Harden, J. J. and Kropko, J. (2018). Simulating Duration Data for the Cox Model.
<em>Political Science Research and Methods</em> <a href="https://doi.org/10.1017/psrm.2018.19">https://doi.org/10.1017/psrm.2018.19</a>
</p>
<p>Sylvestre M.-P., Abrahamowicz M. (2008) Comparison of algorithms to generate event times conditional on time-dependent covariates. <em>Statistics in Medicine</em> <strong>27(14)</strong>:2618–34.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+sim.survdata">sim.survdata</a></code>, <code><a href="PermAlgo.html#topic+permalgorithm">permalgorithm</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>baseline &lt;- baseline.build(T=100, knots=8, spline=TRUE)
simdata &lt;- generate.lm(baseline, N=1000, xvars=5, mu=0, sd=1, type="none", censor=.1)
summary(simdata$data)
simdata &lt;- generate.lm(baseline, N=1000, xvars=5, mu=0, sd=1, type="tvc", censor=.1)
summary(simdata$data)
simdata &lt;- generate.lm(baseline, N=1000, xvars=5, mu=0, sd=1, type="tvbeta", censor=.1)
simdata$beta
</code></pre>

<hr>
<h2 id='make.margeffect'>Calculating a simulated marginal effect</h2><span id='topic+make.margeffect'></span>

<h3>Description</h3>

<p>This function is called by <code><a href="#topic+sim.survdata">sim.survdata</a></code> and is not intended to be used by itself.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make.margeffect(baseline, xb, covariate = 1, low = 0, high = 1,
  compare = median)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="make.margeffect_+3A_baseline">baseline</code></td>
<td>
<p>The baseline hazard functions, output by <code><a href="#topic+baseline.build">baseline.build</a></code></p>
</td></tr>
<tr><td><code id="make.margeffect_+3A_xb">xb</code></td>
<td>
<p>The simulated data, output by <code><a href="#topic+generate.lm">generate.lm</a></code></p>
</td></tr>
<tr><td><code id="make.margeffect_+3A_covariate">covariate</code></td>
<td>
<p>Specification of the column number of the covariate in the <code>X</code> matrix for which to generate a simulated marginal effect (default is 1).
The marginal effect is the difference in expected duration when the covariate is fixed at a high value and the expected duration when the covariate is fixed
at a low value</p>
</td></tr>
<tr><td><code id="make.margeffect_+3A_low">low</code></td>
<td>
<p>The low value of the covariate for which to calculate a marginal effect</p>
</td></tr>
<tr><td><code id="make.margeffect_+3A_high">high</code></td>
<td>
<p>The high value of the covariate for which to calculate a marginal effect</p>
</td></tr>
<tr><td><code id="make.margeffect_+3A_compare">compare</code></td>
<td>
<p>The statistic to employ when examining the two new vectors of expected durations (see details for <code><a href="#topic+sim.survdata">sim.survdata</a></code>).  The default is <code>median</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The idea is to simulate a marginal change in duration so that researchers can compare the performance of
estimators of this statistic using simulated data.
</p>
<p>The function calculates simulated durations for each observation conditional on a baseline hazard function
and exogenous covariates and coefficients.  The <code>covariate</code> argument specifies the variable in the X matrix to
vary so as to measure the marginal effect.  First the covariate is set to the value specified in <code>low</code> for all
observations, then to the value specified in <code>high</code> for all observations.  Given each value, new durations are
drawn. The durations when the covariate equals the low value are subtracted from the durations when the covariate
equals the high value.  The marginal effect is calculated by employing the statistic given by <code>compare</code>, which
is <code>median</code> by default.
</p>


<h3>Value</h3>

<p>A list with three items:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>marg.effect</code> </td><td style="text-align: left;"> A scalar containing the simulated marginal effect</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>data.low</code> </td><td style="text-align: left;"> The durations and covariates when the covariate of interest is set to the low value </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>data.high</code> </td><td style="text-align: left;"> The durations and covariates when the covariate of interest is set to the high value </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Jonathan Kropko &lt;jkropko@virginia.edu&gt; and Jeffrey J. Harden &lt;jharden2@nd.edu&gt;
</p>


<h3>See Also</h3>

<p><code><a href="#topic+baseline.build">baseline.build</a></code>, <code><a href="#topic+generate.lm">generate.lm</a></code>, <code><a href="#topic+sim.survdata">sim.survdata</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>T &lt;- 100
N &lt;- 1000
X &lt;- as.matrix(data.frame(X1=rnorm(N), X2=rnorm(N), X3=rnorm(N)))
beta &lt;- as.matrix(rnorm(3))
baseline &lt;- baseline.build(T=T, knots=8, spline=TRUE)
xb &lt;- generate.lm(baseline, X=X, beta=beta, N=N, censor=.1, type="none")
me &lt;- make.margeffect(baseline, xb, covariate=1, low=0, high=1)
me$marg.effect
</code></pre>

<hr>
<h2 id='martinvanberg'>Data from &quot;Wasting Time? The Impact of Ideology and Size on Delay in Coalition Formation&quot; by
Lanny W. Martin and Georg Vanberg</h2><span id='topic+martinvanberg'></span>

<h3>Description</h3>

<p>The data cover all negotiations to form a government after parliamentary elections in Austria,
Belgium, Denmark, Germany, Ireland, Italy, Luxembourg, Netherlands, Norway, and Sweden between
1950 and 1995.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>martinvanberg
</code></pre>


<h3>Format</h3>

<p>A data frame with 203 observations and 8 variables:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>formdur</code> </td><td style="text-align: left;"> The number of days until negotiations conclude </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>postel</code> </td><td style="text-align: left;"> Indicator for negotiations beginning after an election </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>prevdef</code> </td><td style="text-align: left;"> Indicator for governments following a parliamentary defeat </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>cont</code> </td><td style="text-align: left;"> Indicator for government with continuation rule </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>ident</code> </td><td style="text-align: left;"> Measure of voters’ ease of identifying alternative coalitions </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>rgovm</code> </td><td style="text-align: left;"> Ideological range of the coalition parties </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>pgovno</code> </td><td style="text-align: left;"> Number of parties in coalition </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>tpgovno</code> </td><td style="text-align: left;"> Number of parties * log(time) </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>minority</code> </td><td style="text-align: left;"> Indicator for minority government </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>


<h3>Source</h3>

<p>Martin, L. W and Vanberg, G. (2003) Wasting Time?
The Impact of Ideology and Size on Delay in Coalition Formation.
<em>British Journal of Political Science</em> <strong>33</strong> 323-344
<a href="https://doi.org/10.1017/S0007123403000140">https://doi.org/10.1017/S0007123403000140</a>
</p>

<hr>
<h2 id='rank.predict'>Generate predicted ranks for new observations given a new covariate profile</h2><span id='topic+rank.predict'></span>

<h3>Description</h3>

<p>This function is called by <code><a href="#topic+coxed">coxed</a></code> when <code>method="gam"</code> and new data
are specified, and is not intended to be used by itself.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rank.predict(x, v, warn = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rank.predict_+3A_x">x</code></td>
<td>
<p>A vector of linear predictors for the estimation sample</p>
</td></tr>
<tr><td><code id="rank.predict_+3A_v">v</code></td>
<td>
<p>A vector of linear predictors for the new data</p>
</td></tr>
<tr><td><code id="rank.predict_+3A_warn">warn</code></td>
<td>
<p>If <code>TRUE</code> the function warns the user when linear predictors in the new data are greater than
or less than all of the linear predictors in the estimation sample</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The purpose of <code>rank.predict</code> is to determine for a single new observation what the rank of that
observation's linear predictor would have been had the observation been in the original estimation sample.
It calculates the predicted rank by appending the new observation to the vector of linear predictors for the
estimation sample and calculating the <code><a href="base.html#topic+rank">rank</a></code> of the observation in the new vector. If
the new data contain more than one observation, <code>rank.predict</code> calculates the predicted rank for each
observation independently, without taking the other observations in the new data into account.
</p>
<p>Any observation with a linear predictor less than the minimum linear predictor in the estimation sample will have a predicted
rank of 1; any observation with a linear predictor greater than the maximum linear predictor in the estimation
sample will have a predicted rank of <code>length(v)</code>. If either condition exists, the function provides a warning.
</p>


<h3>Value</h3>

<p>A numeric vector containing the predicted ranks for the observations in <code>x</code>.
</p>


<h3>Author(s)</h3>

<p>Jonathan Kropko &lt;jkropko@virginia.edu&gt; and Jeffrey J. Harden &lt;jharden2@nd.edu&gt;
</p>


<h3>See Also</h3>

<p><code><a href="#topic+coxed">coxed</a></code>, <code><a href="base.html#topic+rank">rank</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>estimationLPs &lt;- rnorm(20)
cbind(estimationLPs, rank(estimationLPs))
newLPs &lt;- rnorm(5)
newLP.rank &lt;- rank.predict(x=newLPs, v=estimationLPs)
cbind(newLPs, newLP.rank)
</code></pre>

<hr>
<h2 id='sim.survdata'>Simulating duration data for the Cox proportional hazards model</h2><span id='topic+sim.survdata'></span>

<h3>Description</h3>

<p><code>sim.survdata()</code> randomly generates data frames containing a user-specified number
of observations, time points, and covariates.  It generates durations, a variable indicating
whether each observation is right-censored, and &quot;true&quot; marginal effects.
It can accept user-specified coefficients, covariates, and baseline hazard functions, and it can
output data with time-varying covariates or using time-varying coefficients.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim.survdata(N = 1000, T = 100, type = "none", hazard.fun = NULL,
  num.data.frames = 1, fixed.hazard = FALSE, knots = 8,
  spline = TRUE, X = NULL, beta = NULL, xvars = 3, mu = 0,
  sd = 0.5, covariate = 1, low = 0, high = 1, compare = median,
  censor = 0.1, censor.cond = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sim.survdata_+3A_n">N</code></td>
<td>
<p>Number of observations in each generated data frame. Ignored if <code>X</code> is not <code>NULL</code></p>
</td></tr>
<tr><td><code id="sim.survdata_+3A_t">T</code></td>
<td>
<p>The latest time point during which an observation may fail. Failures can occur
as early as 1 and as late as T</p>
</td></tr>
<tr><td><code id="sim.survdata_+3A_type">type</code></td>
<td>
<p>If &quot;none&quot; (the default) data are generated with no time-varying covariates or coefficients.
If &quot;tvc&quot;, data are generated with time-varying covariates, and if &quot;tvbeta&quot; data are generated with time-varying
coefficients (see details)</p>
</td></tr>
<tr><td><code id="sim.survdata_+3A_hazard.fun">hazard.fun</code></td>
<td>
<p>A user-specified R function with one argument, representing time, that outputs the baseline hazard function.
If <code>NULL</code>, a baseline hazard function is generated using the flexible-hazard method as described in Harden and
Kropko (2018) (see details)</p>
</td></tr>
<tr><td><code id="sim.survdata_+3A_num.data.frames">num.data.frames</code></td>
<td>
<p>The number of data frames to be generated</p>
</td></tr>
<tr><td><code id="sim.survdata_+3A_fixed.hazard">fixed.hazard</code></td>
<td>
<p>If <code>TRUE</code>, the same hazard function is used to generate each data frame. If <code>FALSE</code> (the default),
different drawn hazard functions are used to generate each data frame.  Ignored if <code>hazard.fun</code> is not <code>NULL</code> or if
<code>num.data.frames</code> is 1</p>
</td></tr>
<tr><td><code id="sim.survdata_+3A_knots">knots</code></td>
<td>
<p>The number of points to draw while using the flexible-hazard method to generate hazard functions (default is 8).
Ignored if <code>hazard.fun</code> is not <code>NULL</code></p>
</td></tr>
<tr><td><code id="sim.survdata_+3A_spline">spline</code></td>
<td>
<p>If <code>TRUE</code> (the default), a spline is employed to smooth the generated cumulative baseline hazard, and if <code>FALSE</code>
the cumulative baseline hazard is specified as a step function with steps at the knots. Ignored if <code>hazard.fun</code> is not <code>NULL</code></p>
</td></tr>
<tr><td><code id="sim.survdata_+3A_x">X</code></td>
<td>
<p>A user-specified data frame containing the covariates that condition duration. If <code>NULL</code>, covariates are generated from
normal distributions with means given by the <code>mu</code> argument and standard deviations given by the <code>sd</code> argument</p>
</td></tr>
<tr><td><code id="sim.survdata_+3A_beta">beta</code></td>
<td>
<p>Either a user-specified vector containing the coefficients that for the linear part of the duration model, or
a user specified matrix with rows equal to <code>T</code> for pre-specified time-varying coefficients.
If <code>NULL</code>, coefficients are generated from normal distributions with means of 0 and standard deviations of 0.1</p>
</td></tr>
<tr><td><code id="sim.survdata_+3A_xvars">xvars</code></td>
<td>
<p>The number of covariates to generate. Ignored if <code>X</code> is not <code>NULL</code></p>
</td></tr>
<tr><td><code id="sim.survdata_+3A_mu">mu</code></td>
<td>
<p>If scalar, all covariates are generated to have means equal to this scalar. If a vector, it specifies the mean of each covariate separately,
and it must be equal in length to <code>xvars</code>. Ignored if <code>X</code> is not <code>NULL</code></p>
</td></tr>
<tr><td><code id="sim.survdata_+3A_sd">sd</code></td>
<td>
<p>If scalar, all covariates are generated to have standard deviations equal to this scalar. If a vector, it specifies the standard deviation
of each covariate separately, and it must be equal in length to <code>xvars</code>. Ignored if <code>X</code> is not <code>NULL</code></p>
</td></tr>
<tr><td><code id="sim.survdata_+3A_covariate">covariate</code></td>
<td>
<p>Specification of the column number of the covariate in the <code>X</code> matrix for which to generate a simulated marginal effect (default is 1).
The marginal effect is the difference in expected duration when the covariate is fixed at a high value and the expected duration when the covariate is fixed
at a low value</p>
</td></tr>
<tr><td><code id="sim.survdata_+3A_low">low</code></td>
<td>
<p>The low value of the covariate for which to calculate a marginal effect</p>
</td></tr>
<tr><td><code id="sim.survdata_+3A_high">high</code></td>
<td>
<p>The high value of the covariate for which to calculate a marginal effect</p>
</td></tr>
<tr><td><code id="sim.survdata_+3A_compare">compare</code></td>
<td>
<p>The statistic to employ when examining the two new vectors of expected durations (see details).  The default is <code>median</code></p>
</td></tr>
<tr><td><code id="sim.survdata_+3A_censor">censor</code></td>
<td>
<p>The proportion of observations to designate as being right-censored</p>
</td></tr>
<tr><td><code id="sim.survdata_+3A_censor.cond">censor.cond</code></td>
<td>
<p>Whether to make right-censoring conditional on the covariates (default is <code>FALSE</code>, but see details)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code><a href="#topic+sim.survdata">sim.survdata</a></code> function generates simulated duration data. It can accept a user-supplied
hazard function, or else it uses the flexible-hazard method described in Harden and Kropko (2018) to generate
a hazard that does not necessarily conform to any parametric hazard function. It can generate data with time-varying
covariates or coefficients. For time-varying covariates <code>type="tvc"</code> it employs the permutational algorithm by Sylvestre and Abrahamowicz (2008).
For time-varying coefficients with <code>type="tvbeta"</code>, the first beta coefficient that is either supplied by the user or generated by
the function is multiplied by the natural log of the failure time under consideration.
</p>
<p>If <code>fixed.hazard=TRUE</code>, one baseline hazard is generated and the same function is used to generate all of the simulated
datasets. If <code>fixed.hazard=FALSE</code> (the default), a new hazard function is generated with each simulation iteration.
</p>
<p>The flexible-hazard method employed when <code>hazard.fun</code> is <code>NULL</code> generates a unique baseline hazard by fitting a curve to
randomly-drawn points. This produces a wide variety
of shapes for the baseline hazard, including those that are unimodal, multimodal, monotonically increasing or decreasing, and many other
shapes. The method then generates a density function based on each baseline hazard and draws durations from it in a way that circumvents
the need to calculate the inverse cumulative baseline hazard. Because the shape of the baseline hazard can vary considerably, this approach
matches the Cox model’s inherent flexibility and better corresponds to the assumed data generating process (DGP) of the Cox model. Moreover,
repeating this process over many iterations in a simulation produces simulated samples of data that better reflect the considerable
heterogeneity in data used by applied researchers. This increases the generalizability of the simulation results. See Harden and Kropko (2018)
for more detail.
</p>
<p>When generating a marginal effect, first the user specifies a covariate by typing its column number in the <code>X</code> matrix into the <code>covariate</code>
argument, then specifies the high and low values at which to fix this covariate.  The function calculates the differences in expected duration for each
observation when fixing the covariate to the high and low values.  If <code>compare</code> is <code>median</code>, the function reports the median of these differences,
and if <code>compare</code> is <code>mean</code>, the function reports the median of these differences, but any function may be employed that takes a vector as input and
outputs a scalar.
</p>
<p>If <code>censor.cond</code> is <code>FALSE</code> then a proportion of the observations specified by <code>censor</code> is randomly and uniformly selected to be right-censored.
If <code>censor.cond</code> is <code>TRUE</code> then censoring depends on the covariates as follows: new coefficients are drawn from normal distributions with mean 0 and
standard deviation of 0.1, and these new coefficients are used to create a new linear predictor using the <code>X</code> matrix.  The observations with the largest
(100 x <code>censor</code>) percent of the linear predictors are designated as right-censored.
</p>


<h3>Value</h3>

<p>Returns an object of class &quot;<code>simSurvdata</code>&quot; which is a list of length <code>num.data.frames</code> for each iteration of data simulation.
Each element of this list is itself a list with the following components:
</p>

<table>
<tr>
 <td style="text-align: left;">
<code>data</code> </td><td style="text-align: left;"> The simulated data frame, including the simulated durations, the censoring variable, and covariates</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>xdata</code> </td><td style="text-align: left;"> The simulated data frame, containing only covariates </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>baseline</code> </td><td style="text-align: left;"> A data frame containing every potential failure time and the baseline failure PDF,
baseline failure CDF, baseline survivor function, and baseline hazard function at each time point. </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>xb</code> </td><td style="text-align: left;"> The linear predictor for each observation </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>exp.xb</code> </td><td style="text-align: left;"> The exponentiated linear predictor for each observation </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>betas</code> </td><td style="text-align: left;"> The coefficients, varying over time if <code>type</code> is "tvbeta" </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>ind.survive</code> </td><td style="text-align: left;"> An (<code>N</code> x <code>T</code>) matrix containing the individual survivor function at
time t for the individual represented by row n   </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>marg.effect</code> </td><td style="text-align: left;"> The simulated marginal change in expected duration comparing the high and low values of
the variable specified with <code>covariate</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code>marg.effect.data</code> </td><td style="text-align: left;"> The <code>X</code> matrix and vector of durations for the low and high conditions </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Jonathan Kropko &lt;jkropko@virginia.edu&gt; and Jeffrey J. Harden &lt;jharden2@nd.edu&gt;
</p>


<h3>References</h3>

<p>Harden, J. J. and Kropko, J. (2018). Simulating Duration Data for the Cox Model.
<em>Political Science Research and Methods</em> <a href="https://doi.org/10.1017/psrm.2018.19">https://doi.org/10.1017/psrm.2018.19</a>
</p>
<p>Sylvestre M.-P., Abrahamowicz M. (2008) Comparison of algorithms to generate event times conditional on time-dependent covariates. <em>Statistics in Medicine</em> <strong>27(14)</strong>:2618–34.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>simdata &lt;- sim.survdata(N=1000, T=100, num.data.frames=2)
require(survival)
data &lt;- simdata[[1]]$data
model &lt;- coxph(Surv(y, failed) ~ X1 + X2 + X3, data=data)
model$coefficients ## model-estimated coefficients
simdata[[1]]$betas ## "true" coefficients

## User-specified baseline hazard
my.hazard &lt;- function(t){ #lognormal with mean of 50, sd of 10
dnorm((log(t) - log(50))/log(10)) /
     (log(10)*t*(1 - pnorm((log(t) - log(50))/log(10))))
}
simdata &lt;- sim.survdata(N=1000, T=100, hazard.fun = my.hazard)

## A simulated data set with time-varying covariates
## Not run: simdata &lt;- sim.survdata(N=1000, T=100, type="tvc", xvars=5, num.data.frames=1)
summary(simdata$data)
model &lt;- coxph(Surv(start, end, failed) ~ X1 + X2 + X3 + X4 + X5, data=simdata$data)
model$coefficients ## model-estimated coefficients
simdata$betas ## "true" coefficients

## End(Not run)

## A simulated data set with time-varying coefficients
simdata &lt;- sim.survdata(N=1000, T=100, type="tvbeta", num.data.frames = 1)
simdata$betas
</code></pre>

<hr>
<h2 id='summary.coxedExpdur'>The mean or median expected duration</h2><span id='topic+summary.coxedExpdur'></span>

<h3>Description</h3>

<p>This function takes the output of <code><a href="#topic+coxed">coxed</a></code> and calculates the
mean or median of the expected durations across the observations for which durations
are estimated.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'coxedExpdur'
summary(object, stat = "mean", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.coxedExpdur_+3A_object">object</code></td>
<td>
<p>The output from <code><a href="#topic+coxed">coxed</a></code>. If <code>newdata2=NULL</code>, so that
<code>coxed</code> is being used to predict duration instead of to calculate a marginal
effect, then the class of the <code>coxed</code> output will be &quot;<code>coxedExpdur</code>&quot; and
this function will be called by the generic <code>summary</code> function</p>
</td></tr>
<tr><td><code id="summary.coxedExpdur_+3A_stat">stat</code></td>
<td>
<p>Either <code>"mean"</code> or <code>"median"</code></p>
</td></tr>
<tr><td><code id="summary.coxedExpdur_+3A_...">...</code></td>
<td>
<p>For future methods</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>bootstrap=TRUE</code> in the call to <code>coxed</code> then a bootstrapped standard error
and confidence interval is reported for the given statistic as well.
</p>


<h3>Value</h3>

<p>A scalar containing the mean or median duration, or a vector that also includes
the bootstrapped standard error and confidence interval for this quantity.
</p>


<h3>Author(s)</h3>

<p>Jonathan Kropko &lt;jkropko@virginia.edu&gt; and Jeffrey J. Harden &lt;jharden2@nd.edu&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>require(survival)
mv.surv &lt;- Surv(martinvanberg$formdur, event = rep(1, nrow(martinvanberg)))
mv.cox &lt;- coxph(mv.surv ~ postel + prevdef + cont + ident + rgovm + pgovno + tpgovno +
     minority, method = "breslow", data = martinvanberg)
summary(mv.cox)

# NPSF method
ed1 &lt;- coxed(mv.cox, method="npsf")
ed1$baseline.functions
ed1$exp.dur
summary(ed1, stat="mean")
summary(ed1, stat="median")

ed1 &lt;- coxed(mv.cox, method="npsf", bootstrap = TRUE)
ed1$exp.dur
summary(ed1, stat="mean")
summary(ed1, stat="median")
</code></pre>

<hr>
<h2 id='summary.coxedMargin'>Marginal changes in expected duration</h2><span id='topic+summary.coxedMargin'></span>

<h3>Description</h3>

<p>This function reports summary statistics for the changes in duration that occur when
comparing observations in <code>newdata2</code> to observations in <code>newdata</code> as specified
in the original call to <code><a href="#topic+coxed">coxed</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'coxedMargin'
summary(object, stat = "mean", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.coxedMargin_+3A_object">object</code></td>
<td>
<p>The output from <code><a href="#topic+coxed">coxed</a></code>. If neither <code>newdata</code> or
<code>newdata2</code> are <code>NULL</code>, <code>coxed</code> is being calculate a marginal
effect and the class of the <code>coxed</code> output will be &quot;<code>coxedMargin</code>&quot;, so
this function will be called by the generic <code>summary</code> function</p>
</td></tr>
<tr><td><code id="summary.coxedMargin_+3A_stat">stat</code></td>
<td>
<p>Either <code>"mean"</code> or <code>"median"</code></p>
</td></tr>
<tr><td><code id="summary.coxedMargin_+3A_...">...</code></td>
<td>
<p>For future methods</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>coxed</code> calculates a vector of expected durations for every observation
in <code>newdata2</code> and <code>newdata</code> (these data frames must have the same number of
observations, and corresponding rows are assumed to refer to the same observation), and
subtracts the expected duration from <code>newdata2</code> from the expected duration from
<code>newdata</code>.  That generates a vector of marginal changes in duration for every
observation.  To generalize a finding across observations, either the mean (if <code>type="mean"</code>)
or the median (if <code>type="median"</code>) of these differences is reported, along with the
mean/median of the expected durations from each of the two covariate profiles.
If <code>bootstrap=TRUE</code> in the call to <code>coxed</code> then a bootstrapped standard error
and confidence interval is reported for each of these quantities as well.
</p>


<h3>Value</h3>

<p>A data.frame containing the mean or median duration for each of <code>newdata2</code> and
<code>newdata</code> and the differences in these durations across the two covariate profiles.
If <code>bootstrap=TRUE</code> in the call to <code>coxed</code>, the data frame also includes
the bootstrapped standard error and confidence interval for these quantities.
</p>


<h3>Author(s)</h3>

<p>Jonathan Kropko &lt;jkropko@virginia.edu&gt; and Jeffrey J. Harden &lt;jharden2@nd.edu&gt;
</p>


<h3>See Also</h3>

<p><code><a href="#topic+coxed">coxed</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>mv.surv &lt;- Surv(martinvanberg$formdur, event = rep(1, nrow(martinvanberg)))
mv.cox &lt;- coxph(mv.surv ~ postel + prevdef + cont + ident + rgovm + pgovno + tpgovno +
     minority, method = "breslow", data = martinvanberg)
summary(mv.cox)

me &lt;- coxed(mv.cox, method="npsf", bootstrap = FALSE,
            newdata = dplyr::mutate(martinvanberg, rgovm=0),
            newdata2 = dplyr::mutate(martinvanberg, rgovm=1.24))
summary(me, stat="mean")
summary(me, stat="median")
</code></pre>

<hr>
<h2 id='survsim.plot'>Plot the simulated baseline functions and histograms of simulated data</h2><span id='topic+survsim.plot'></span>

<h3>Description</h3>

<p>This function takes the output of <code><a href="#topic+sim.survdata">sim.survdata</a></code> and plots the baseline
failure PDF, the baseline failure CDF, the baseline survivor function, and the baseline hazard
function that were generated and used to simulate the data.  The function also produces histograms
of the simulated durations, the linear predictor, and the exponentiated linear predictor.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>survsim.plot(survsim, type = "both", bins = 30, df = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="survsim.plot_+3A_survsim">survsim</code></td>
<td>
<p>An object of class &quot;<code>simSurvdata</code>&quot; output by <code><a href="#topic+sim.survdata">sim.survdata</a></code></p>
</td></tr>
<tr><td><code id="survsim.plot_+3A_type">type</code></td>
<td>
<p>If <code>type="baseline"</code> the function plots the baseline functions.
If <code>type="hist"</code> the function plots the histograms. If <code>type="both"</code> the function
plots both the baseline functions and the histograms, aligned in a 2 x 1 array</p>
</td></tr>
<tr><td><code id="survsim.plot_+3A_bins">bins</code></td>
<td>
<p>The number of bins to draw in each histogram. Ignored if <code>type="baseline"</code></p>
</td></tr>
<tr><td><code id="survsim.plot_+3A_df">df</code></td>
<td>
<p>If <code>survsim</code> is generated by a call to <code><a href="#topic+sim.survdata">sim.survdata</a></code> in which
<code>num.data.frames</code> is greater than 1, the output is a list of iterated simulation output. In this case,
<code>df</code> specifies the particular simulation iteration for which to produce visualizations</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A challenge that can limit research to develop methods to analyze survival data is that a
pre-specified baseline hazard function must be used to generate simulated data, which contradicts the
Cox proportional hazards model's feature of circumventing the hazard to estimate coefficients.  The
flexible-hazard method developed by Harden and Kropko (2018) and implemented in <code><a href="#topic+sim.survdata">sim.survdata</a></code>
allows for the simulation of duration data without assuming a particular parametric form for hazard.
<code>survsim.plot</code> is useful for visualizing the baseline functions, including hazard, that result from
this algorithm for a particular draw of simulated duration data. The function uses <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code>
to create line plots for the baseline failure PDF, the baseline failure CDF, the baseline survivor function,
and the baseline hazard function over time.  The baseline functions and time are attributes of the
<code><a href="#topic+sim.survdata">sim.survdata</a></code> output.
</p>


<h3>Value</h3>

<p>A figure of class <code>"gg"</code> and <code>"ggplot"</code> if <code>type="baseline"</code> or <code>type="hist"</code>, and of
classes <code>"gtable"</code>, <code>"gTree"</code>, <code>"grob"</code>, and <code>"gDesc"</code> if <code>type="both"</code>.
</p>


<h3>Author(s)</h3>

<p>Jonathan Kropko &lt;jkropko@virginia.edu&gt; and Jeffrey J. Harden &lt;jharden2@nd.edu&gt;
</p>


<h3>References</h3>

<p>Harden, J. J. and Kropko, J. (2018). Simulating Duration Data for the Cox Model.
<em>Political Science Research and Methods</em> <a href="https://doi.org/10.1017/psrm.2018.19">https://doi.org/10.1017/psrm.2018.19</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+sim.survdata">sim.survdata</a></code>, <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code>, <code><a href="gridExtra.html#topic+arrangeGrob">grid.arrange</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>simdata &lt;- sim.survdata(N=1000, T=100, num.data.frames=1)
survsim.plot(simdata)
</code></pre>

<hr>
<h2 id='user.baseline'>Calculating baseline functions from a user-specified baseline hazard function</h2><span id='topic+user.baseline'></span>

<h3>Description</h3>

<p>This function is called by <code><a href="#topic+sim.survdata">sim.survdata</a></code> and is not intended to be used by itself.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>user.baseline(user.fun, T)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="user.baseline_+3A_user.fun">user.fun</code></td>
<td>
<p>A user-specified R function with one argument, representing time, that outputs the baseline hazard function</p>
</td></tr>
<tr><td><code id="user.baseline_+3A_t">T</code></td>
<td>
<p>The latest time point during which an observation may fail. Failures can occur
as early as 1 and as late as T</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>user.baseline</code> takes a function as a user-specified baseline hazard which must have
only one argument: time.  <code>user.baseline</code> approximates the cumulative baseline hazard by taking the
cumulative sum of the user-specified hazard function. It calculates the survivor function by exponentiating
the cumulative baseline hazard time -1, the baseline failure CDF by subtracting the survivor function from 1,
and it approximates the baseline failure PDF by taking the first difference of the failure CDF.
survivor function, and baseline failure-time PDF and CDF.
</p>


<h3>Value</h3>

<p>A data frame with five columns representing time from 1 to T, and the user-specified baseline hazard,
cumulative hazard, survivor function, failure PDF and failure CDF at each time point.
</p>


<h3>Author(s)</h3>

<p>Jonathan Kropko &lt;jkropko@virginia.edu&gt; and Jeffrey J. Harden &lt;jharden2@nd.edu&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Writing the hazard to be lognormal with mean of 50, sd of 10
my.hazard &lt;- function(t){
     dnorm((log(t) - log(50))/log(10)) /
          (log(10)*t*(1 - pnorm((log(t) - log(50))/log(10))))
}
lognormal.functions &lt;- user.baseline(my.hazard, 100)
summary(lognormal.functions)

#A customized user-specified hazard
sine.squared.hazard &lt;- user.baseline(function(t) sin(t/25)^2, 30)
summary(sine.squared.hazard)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
