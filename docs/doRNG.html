<!DOCTYPE html><html lang="en"><head><title>Help for package doRNG</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {doRNG}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#doRNG-package'><p>Generic Reproducible Parallel Backend for foreach Loops</p></a></li>
<li><a href='#+25dorng+25'><p>Reproducible Parallel Foreach Backend</p></a></li>
<li><a href='#doRNGversion'><p>Back Compatibility Option for doRNG</p></a></li>
<li><a href='#infoDoRNG'><p>Getting Information About doRNG Foreach Backend</p></a></li>
<li><a href='#registerDoRNG'><p>Registering doRNG for Persistent Reproducible Parallel Foreach Loops</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Generic Reproducible Parallel Backend for 'foreach' Loops</td>
</tr>
<tr>
<td>Version:</td>
<td>1.8.6.1</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides functions to perform
    reproducible parallel foreach loops, using independent
    random streams as generated by L'Ecuyer's combined
    multiple-recursive generator [L'Ecuyer (1999), &lt;<a href="https://doi.org/10.1287%2Fopre.47.1.159">doi:10.1287/opre.47.1.159</a>&gt;].
    It enables to easily convert standard '%dopar%' loops into
    fully reproducible loops, independently of the number
    of workers, the task scheduling strategy, or the chosen
    parallel environment and associated foreach backend.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://renozao.github.io/doRNG/">https://renozao.github.io/doRNG/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/renozao/doRNG/issues">https://github.com/renozao/doRNG/issues</a></td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.0.0), foreach, rngtools (&ge; 1.5)</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats, utils, iterators</td>
</tr>
<tr>
<td>Suggests:</td>
<td>doParallel, doMPI, doRedis, rbenchmark, devtools, knitr,
rbibutils (&ge; 1.3), testthat, pkgmaker (&ge; 0.32.7), covr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-01-13 12:20:36 UTC; hornik</td>
</tr>
<tr>
<td>Author:</td>
<td>Renaud Gaujoux [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Renaud Gaujoux &lt;renozao@protonmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-01-13 16:22:54 UTC</td>
</tr>
</table>
<hr>
<h2 id='doRNG-package'>Generic Reproducible Parallel Backend for foreach Loops</h2><span id='topic+doRNG-package'></span>

<h3>Description</h3>

<p>The <em>doRNG</em> package provides functions to perform
reproducible parallel foreach loops, using independent random streams
as generated by L'Ecuyer's combined multiple-recursive generator (L'Ecuyer (1999)).
It enables to easily convert standard %dopar% loops into fully reproducible loops,
independently of the number of workers, the task scheduling strategy,
or the chosen parallel environment and associated foreach backend.
It has been tested with the following foreach backend: doMC, doSNOW, doMPI.
</p>


<h3>References</h3>

<p>L'Ecuyer P (1999). “Good Parameters and Implementations for Combined Multiple Recursive Random Number Generators.” _Operations Research_, *47*(1), 159-164. ISSN
0030-364X, doi:10.1287/opre.47.1.159 &lt;https://doi.org/10.1287/opre.47.1.159&gt;.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+doRNG">doRNG</a></code>, <code><a href="rngtools.html#topic+RNGseq">RNGseq</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# register parallel backend
library(doParallel)
cl &lt;- makeCluster(2)
registerDoParallel(cl)

## standard %dopar% loop are not reproducible
set.seed(123)
r1 &lt;- foreach(i=1:4) %dopar%{ runif(1) }
set.seed(123)
r2 &lt;- foreach(i=1:4) %dopar%{ runif(1) }
identical(r1, r2)


## %dorng% loops _are_ reproducible
set.seed(123)
r1 &lt;- foreach(i=1:4) %dorng%{ runif(1) }
set.seed(123)
r2 &lt;- foreach(i=1:4) %dorng%{ runif(1) }
identical(r1, r2)


# alternative way of seeding 
a1 &lt;- foreach(i=1:4, .options.RNG=123) %dorng%{ runif(1) }
a2 &lt;- foreach(i=1:4, .options.RNG=123) %dorng%{ runif(1) }
identical(a1, a2) &amp;&amp; identical(a1, r1)


## sequences of %dorng% loops _are_ reproducible
set.seed(123)
s1 &lt;- foreach(i=1:4) %dorng%{ runif(1) }
s2 &lt;- foreach(i=1:4) %dorng%{ runif(1) }
identical(s1, r1) &amp;&amp; !identical(s1, s2)


set.seed(123)
s1.2 &lt;- foreach(i=1:4) %dorng%{ runif(1) }
s2.2 &lt;- foreach(i=1:4) %dorng%{ runif(1) }
identical(s1, s1.2) &amp;&amp; identical(s2, s2.2)

 
## Non-invasive way of converting %dopar% loops into reproducible loops
registerDoRNG(123)
s3 &lt;- foreach(i=1:4) %dopar%{ runif(1) }
s4 &lt;- foreach(i=1:4) %dopar%{ runif(1) }
identical(s3, s1) &amp;&amp; identical(s4, s2)


stopCluster(cl) 

</code></pre>

<hr>
<h2 id='+25dorng+25'>Reproducible Parallel Foreach Backend</h2><span id='topic++25dorng+25'></span>

<h3>Description</h3>

<p><code style="white-space: pre;">&#8288;%dorng%&#8288;</code> is a foreach operator that provides an alternative operator
<code style="white-space: pre;">&#8288;%dopar%&#8288;</code>, which enable reproducible foreach loops to be performed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>obj %dorng% ex
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="+2B25dorng+2B25_+3A_obj">obj</code></td>
<td>
<p>a foreach object as returned by a call to <code><a href="foreach.html#topic+foreach">foreach</a></code>.</p>
</td></tr>
<tr><td><code id="+2B25dorng+2B25_+3A_ex">ex</code></td>
<td>
<p>the <code>R</code> expression to evaluate.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code style="white-space: pre;">&#8288;%dorng%&#8288;</code> returns the result of the foreach loop. See <a href="foreach.html#topic+foreach">foreach::%dopar%</a>.
The whole sequence of RNG seeds is stored in the result object as an attribute.
Use <code>attr(res, 'rng')</code> to retrieve it.
</p>


<h3>Global options</h3>

<p>These options are for advanced users that develop 'foreach backends:
</p>

<ul>
<li><p> 'doRNG.rng_change_warning_skip': if set to a single logical <code>FALSE/TRUE</code>, it indicates
whether a warning should be thrown if the RNG seed is changed by the registered
parallel backend (default=FALSE).
Set it to <code>TRUE</code> if you know that running your backend will change the RNG state and
want to disable the warning.
This option can also be set to a character vector that specifies the name(s) of the backend(s)
for which the warning should be skipped.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="foreach.html#topic+foreach">foreach</a></code>, <code><a href="doParallel.html#topic+doParallel">doParallel</a></code>
, <code><a href="doParallel.html#topic+registerDoParallel">registerDoParallel</a></code>, <code><a href="doMPI.html#topic+doMPI">doMPI</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(doParallel)
cl &lt;- makeCluster(2)
registerDoParallel(cl)

# standard %dopar% loops are _not_ reproducible
set.seed(1234)
s1 &lt;- foreach(i=1:4) %dopar% { runif(1) }
set.seed(1234)
s2 &lt;- foreach(i=1:4) %dopar% { runif(1) }
identical(s1, s2)

# single %dorng% loops are reproducible
r1 &lt;- foreach(i=1:4, .options.RNG=1234) %dorng% { runif(1) }
r2 &lt;- foreach(i=1:4, .options.RNG=1234) %dorng% { runif(1) }
identical(r1, r2)
# the sequence os RNG seed is stored as an attribute
attr(r1, 'rng')

# stop cluster
stopCluster(cl)

# More examples can be found in demo `doRNG`
## Not run: 
demo('doRNG')

## End(Not run)

</code></pre>

<hr>
<h2 id='doRNGversion'>Back Compatibility Option for doRNG</h2><span id='topic+doRNGversion'></span>

<h3>Description</h3>

<p>Sets the behaviour of %dorng% foreach loops from a
given version number.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>doRNGversion(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="doRNGversion_+3A_x">x</code></td>
<td>
<p>version number to switch to, or missing to get the currently
active version number, or <code>NULL</code> to reset to the default behaviour,
i.e. of the latest version.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a character string
If <code>x</code> is missing this function returns the version number from the
current behaviour.
If <code>x</code> is specified, the function returns the old value of the
version number (invisible).
</p>


<h3>Behaviour changes in versions</h3>


<dl>
<dt>1.4</dt><dd><p> The behaviour of <code>doRNGseed</code>, and therefore of
<code style="white-space: pre;">&#8288;%dorng%&#8288;</code> loops, changed in the case where the current RNG was
L'Ecuyer-CMRG.
Using <code>set.seed</code> before a non-seeded loop used not to be identical
to seeding via <code>.options.RNG</code>.
Another bug was that non-seeded loops would share most of their RNG seed!
</p>
</dd>
<dt>1.7.4</dt><dd><p>Prior to this version, in the case where the RNG had not been called yet,
the first seeded <code style="white-space: pre;">&#8288;%dorng%&#8288;</code> loops would not give the identical results as
subsequent loops despite using the same seed
(see <a href="https://github.com/renozao/doRNG/issues/12">https://github.com/renozao/doRNG/issues/12</a>).
</p>
<p>This has been fixed in version 1.7.4, where the RNG is called once (<code>sample(NA)</code>),
whenever the .Random.seed is not found in global environment.
</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>


## Seeding when current RNG is L'Ecuyer-CMRG
RNGkind("L'Ecuyer")

doRNGversion("1.4")
# in version &gt;= 1.4 seeding behaviour changed to fix a bug
set.seed(123)
res &lt;- foreach(i=1:3) %dorng% runif(1)
res2 &lt;- foreach(i=1:3) %dorng% runif(1)
stopifnot( !identical(attr(res, 'rng')[2:3], attr(res2, 'rng')[1:2]) )
res3 &lt;- foreach(i=1:3, .options.RNG=123) %dorng% runif(1)
stopifnot( identical(res, res3) )

# buggy behaviour in version &lt; 1.4
doRNGversion("1.3")
res &lt;- foreach(i=1:3) %dorng% runif(1)
res2 &lt;- foreach(i=1:3) %dorng% runif(1)
stopifnot( identical(attr(res, 'rng')[2:3], attr(res2, 'rng')[1:2]) )
res3 &lt;- foreach(i=1:3, .options.RNG=123) %dorng% runif(1)
stopifnot( !identical(res, res3) )

# restore default RNG  
RNGkind("default")
# restore to current doRNG version
doRNGversion(NULL)

</code></pre>

<hr>
<h2 id='infoDoRNG'>Getting Information About doRNG Foreach Backend</h2><span id='topic+infoDoRNG'></span><span id='topic+doRNG'></span>

<h3>Description</h3>

<p><code>infoDoRNG</code> returns information about the doRNG backend, e.g., version,
number of workers.
It is not meant to be called by the user.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>infoDoRNG(data, item)

doRNG(obj, ex, envir, data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="infoDoRNG_+3A_data">data</code></td>
<td>
<p>configuration data of the doRNG backend</p>
</td></tr>
<tr><td><code id="infoDoRNG_+3A_item">item</code></td>
<td>
<p>the data item requested, as a character string
(e.g. 'name', 'workers', 'version')</p>
</td></tr>
<tr><td><code id="infoDoRNG_+3A_obj">obj</code></td>
<td>
<p>a foreach description of the loop arguments</p>
</td></tr>
<tr><td><code id="infoDoRNG_+3A_ex">ex</code></td>
<td>
<p>the lopp expression</p>
</td></tr>
<tr><td><code id="infoDoRNG_+3A_envir">envir</code></td>
<td>
<p>the loop's evaluation environment</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>infoDoRNG</code> returns the requested info (usually as a character
string or a numeric value).
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>doRNG</code>: implements the generic reproducible foreach backend. It should
not be called directly by the user.
</p>
</li></ul>


<h3>Author(s)</h3>

<p>Renaud Gaujoux
</p>

<hr>
<h2 id='registerDoRNG'>Registering doRNG for Persistent Reproducible Parallel Foreach Loops</h2><span id='topic+registerDoRNG'></span>

<h3>Description</h3>

<p><code>registerDoRNG</code> registers the doRNG foreach backend.
Subsequent <code style="white-space: pre;">&#8288;%dopar%&#8288;</code> loops are then performed using the previously
registered foreach backend, but are internally performed as <a href="#topic++25dorng+25">%dorng%</a> loops,
making them fully reproducible.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>registerDoRNG(seed = NULL, once = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="registerDoRNG_+3A_seed">seed</code></td>
<td>
<p>a numerical seed to use (as a single or 6-length numerical value)</p>
</td></tr>
<tr><td><code id="registerDoRNG_+3A_once">once</code></td>
<td>
<p>a logical to indicate if the RNG sequence should be seeded at the
beginning of each loop or only at the first loop.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Briefly, the RNG is set, before each iteration, with seeds for L'Ecuyer's CMRG
that overall generate a reproducible sequence of statistically independent
random streams.
</p>
<p>Note that (re-)registering a foreach backend other than doRNG, after a call
to <code>registerDoRNG</code> disables doRNG &ndash; which then needs to be registered.
</p>


<h3>Value</h3>

<p>The value returned by <a href="foreach.html#topic+setDoPar">foreach::setDoPar</a>
</p>


<h3>See Also</h3>

<p><a href="#topic++25dorng+25">%dorng%</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(doParallel)
cl &lt;- makeCluster(2)
registerDoParallel(cl)

# One can make reproducible loops using the %dorng% operator
r1 &lt;- foreach(i=1:4, .options.RNG=1234) %dorng% { runif(1) }
# or convert %dopar% loops using registerDoRNG
registerDoRNG(1234)
r2 &lt;- foreach(i=1:4) %dopar% { runif(1) }
identical(r1, r2)
stopCluster(cl)

# Registering another foreach backend disables doRNG
cl &lt;- makeCluster(2)
registerDoParallel(cl)
set.seed(1234)
s1 &lt;- foreach(i=1:4) %dopar% { runif(1) }
set.seed(1234)
s2 &lt;- foreach(i=1:4) %dopar% { runif(1) }
identical(s1, s2)


# doRNG is re-nabled by re-registering it 
registerDoRNG()
set.seed(1234)
r3 &lt;- foreach(i=1:4) %dopar% { runif(1) }
identical(r2, r3)
# NB: the results are identical independently of the task scheduling
# (r2 used 2 nodes, while r3 used 3 nodes)

# argument `once=FALSE` reseeds doRNG's seed at the beginning of each loop 
registerDoRNG(1234, once=FALSE)
r1 &lt;- foreach(i=1:4) %dopar% { runif(1) }
r2 &lt;- foreach(i=1:4) %dopar% { runif(1) }
identical(r1, r2)

# Once doRNG is registered the seed can also be passed as an option to %dopar%
r1.2 &lt;- foreach(i=1:4, .options.RNG=456) %dopar% { runif(1) }
r2.2 &lt;- foreach(i=1:4, .options.RNG=456) %dopar% { runif(1) }
identical(r1.2, r2.2) &amp;&amp; !identical(r1.2, r1)


stopCluster(cl)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
