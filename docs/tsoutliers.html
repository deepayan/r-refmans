<!DOCTYPE html><html><head><title>Help for package tsoutliers</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {tsoutliers}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#bde9915'><p>Data Set: Working Paper &lsquo;bde9915&rsquo;</p></a></li>
<li><a href='#calendar.effects'><p>Calendar Effects</p></a></li>
<li><a href='#coefs2poly'><p>Product of the Polynomials in an ARIMA Model</p></a></li>
<li><a href='#discard.outliers'><p>Stage II of the Procedure: Discard Outliers</p></a></li>
<li><a href='#find.consecutive.outliers'><p>Find outliers at consecutive time points</p></a></li>
<li><a href='#hicp'><p>Data Set: Harmonised Indices of Consumer Prices</p></a></li>
<li><a href='#ipi'><p>Data Set: Industrial Production Indices</p></a></li>
<li><a href='#JarqueBera.test'><p>Jarque-Bera Test for Normality</p></a></li>
<li><a href='#locate.outliers'><p>Stage I of the Procedure: Locate Outliers (Baseline Function)</p></a></li>
<li><a href='#locate.outliers.loops'><p>Stage I of the Procedure: Locate Outliers (Loop Around Functions)</p></a></li>
<li><a href='#outliers'><p>Define Outliers in a Data Frame</p></a></li>
<li><a href='#outliers.effects'><p>Create the Pattern of Different Types of Outliers</p></a></li>
<li><a href='#outliers.regressors'><p>Regressor Variables for the Detection of Outliers</p></a></li>
<li><a href='#outliers.tstatistics'><p>Test Statistics for the Significance of Outliers</p></a></li>
<li><a href='#plot.tsoutliers'><p>Display Outlier Effects Detected by <code>tsoutliers</code></p></a></li>
<li><a href='#print.tsoutliers'><p>Print <code>tsoutliers</code> object</p></a></li>
<li><a href='#remove.outliers-deprecated'><p>Stage II of the Procedure: Discard Outliers</p></a></li>
<li><a href='#tso'><p>Automatic Procedure for Detection of Outliers</p></a></li>
<li><a href='#tsoutliers-package'><p>Automatic Detection of Outliers in Time Series</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Version:</td>
<td>0.6-10</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-02-10</td>
</tr>
<tr>
<td>Title:</td>
<td>Detection of Outliers in Time Series</td>
</tr>
<tr>
<td>Description:</td>
<td>Detection of outliers in time series following the 
    Chen and Liu (1993) &lt;<a href="https://doi.org/10.2307%2F2290724">doi:10.2307/2290724</a>&gt; procedure. 
    Innovational outliers, additive outliers, level shifts, 
    temporary changes and seasonal level shifts are considered.</td>
</tr>
<tr>
<td>Author:</td>
<td>Javier López-de-Lacalle &lt;javlacalle@yahoo.es&gt;</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Javier López-de-Lacalle &lt;javlacalle@yahoo.es&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>forecast, stats</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://jalobe.com">https://jalobe.com</a></td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-02-10 22:05:28 UTC; javlacalle</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-02-12 12:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='bde9915'>Data Set: Working Paper &lsquo;bde9915&rsquo;</h2><span id='topic+bde9915'></span>

<h3>Description</h3>

<p>Data set employed for illustration in the working paper referenced below.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bde9915
</code></pre>


<h3>Format</h3>

<p>A list containing the following monthly series:
</p>

<ul>
<li><p> gipi: Italian industrial production index (1981:1-1996:12);
</p>
</li>
<li><p> euprin: European price index of industrial production (1981:1-1993:1) (*);
</p>
</li>
<li><p> metipi: Spanish production index of metal products (1980:1-1997:7).
</p>
</li></ul>

<p>(*) 1993:12 is reported in the reference document.
</p>


<h3>Note</h3>

<p>The authors of the reference working paper probably use additional variables such as 
holidays to obtain the results reported in the document.
</p>


<h3>References</h3>

<p>Kaiser, R., and Maravall, A. (1999). 
<em>Seasonal Outliers in Time Series</em>.
Banco de España, Servicio de Estudios. Working paper number 9915.
</p>

<hr>
<h2 id='calendar.effects'>Calendar Effects</h2><span id='topic+calendar.effects'></span>

<h3>Description</h3>

<p>This function creates regressor variables for trading day, Easter and leap year effects 
over the sample period where the input time series is sampled.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calendar.effects(x, trading.day = TRUE, easter = 6, 
  leap.year = FALSE, holidays = NULL, easter.date = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calendar.effects_+3A_x">x</code></td>
<td>
<p>a monthly time series.</p>
</td></tr>
<tr><td><code id="calendar.effects_+3A_trading.day">trading.day</code></td>
<td>
<p>logical. If <code>TRUE</code>, trading day regressor variable is returned.</p>
</td></tr>
<tr><td><code id="calendar.effects_+3A_easter">easter</code></td>
<td>
<p>numeric. The number of days before Easter over which the Easter effect spans. 
If it is set to zero Easter variable is not returned.</p>
</td></tr>
<tr><td><code id="calendar.effects_+3A_leap.year">leap.year</code></td>
<td>
<p>logical. If <code>TRUE</code>, leap year regressor variable is returned.</p>
</td></tr>
<tr><td><code id="calendar.effects_+3A_holidays">holidays</code></td>
<td>
<p>an optional numeric vector of the same length as <code>x</code> containing 
the number of holidays for each time period.</p>
</td></tr>
<tr><td><code id="calendar.effects_+3A_easter.date">easter.date</code></td>
<td>
<p>logical indicating whether the date of Easter should be returned.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Let <code class="reqn">wd</code> be the number of working days in a given month 
and <code class="reqn">nwd</code> the number of non-working days.
The trading day variable at time <code class="reqn">t</code> is built as follows:
</p>
<p style="text-align: center;"><code class="reqn">wd = wd - holidays</code>
</p>

<p style="text-align: center;"><code class="reqn">nwd = nwd + holidays</code>
</p>

<p style="text-align: center;"><code class="reqn">td_t = wd - (5/2) \times nwd</code>
</p>

<p>By default, working days are the days from Monday to Friday and 
non-working days are Saturdays and Sundays. If there are additional 
non-working days they can be defined in argument <code>holidays</code>. 
For example, if the 1st of February is a local holiday, the user can define 
a variable containing zeros for all periods except for the periods related 
to February where the 1st of February falls within a working day (Monday to Friday); 
these data are set to one so that they are considered as non working days.
</p>
<p>Easter effect is defined as the proportion of days before Easter 
(by default <code>easter = 6</code>) that lie in March and April, 
respectively for each month. It contains zeros for the remaining months.
</p>
<p>The leap year is a vector of zeros for all months except February, 
where the variable takes on the value <code class="reqn">0.75</code> if the year is a leap year
and <code class="reqn">-0.25</code> otherwise.
</p>


<h3>Value</h3>

<p>A <code>mts</code> matrix containing the selected calendar effects by columns.
</p>
<p>If <code>easter.date</code> is <code>TRUE</code> a list is returned containing the 
<code>mts</code> matrix of calendar effects as well as the dates of Easter for 
each year of the sample.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># display calendar effects for a sample span period
# no data are actually necessary in the input series 
# since calendar effects are concerned only with the dates
# at which the data are sampled
x &lt;- ts(frequency = 12, start = c(1980, 1), end = c(2000, 12))
ce &lt;- calendar.effects(x, leap.year = TRUE)
colnames(ce)
plot(ce, main = "calendar effects")
# Easter days for each year
calendar.effects(x, easter.date = TRUE)$easter
</code></pre>

<hr>
<h2 id='coefs2poly'>Product of the Polynomials in an ARIMA Model</h2><span id='topic+coefs2poly'></span>

<h3>Description</h3>

<p>This function collapses the polynomials of an ARIMA model 
into two polynomials: the product of the autoregressive polynomials 
and the product of the moving average polynomials.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>coefs2poly(x, add = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="coefs2poly_+3A_x">x</code></td>
<td>
<p>an object of class <code>Arima</code>, as returned by <code><a href="stats.html#topic+arima">arima</a></code>.</p>
</td></tr>

<tr><td><code id="coefs2poly_+3A_add">add</code></td>
<td>
<p>logical. If <code>TRUE</code>, the polynomial of the differencing filter 
(if present in the model) is multiplied by the stationary autoregressive 
polynomial. Otherwise only the coefficients of the product of the 
stationary polynomials is returned.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the elements:
<code>arcoefs</code>, the coefficients of the product of the 
autoregressive polynomials;
<code>macoefs</code>, the coefficients of the product of the 
moving average polynomials. 
This list is of class <code>"ArimaPars"</code> so that it can be recognized by 
<code><a href="#topic+outliers.tstatistics">outliers.tstatistics</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># ARIMA(0,1,1)(0,1,1) model
fit &lt;- arima(log(AirPassengers), order = c(0,1,1), 
  seasonal = list(order = c(0,1,1)))
coefs &lt;- coef(fit)

# "coefs2poly" returns the coefficients of the product of 
# the non-seasonal and the seasonal moving average polynomials
a1 &lt;- convolve(c(1, coefs[1]), rev(c(1, rep(0, 11), coefs[2])), type="open")[-1]
a2 &lt;- coefs2poly(fit)$macoefs
a2
all.equal(a1, a2, check.names=FALSE)

# since the model does not contain an autoregressive part
# the product of the regular and the seasonal differencing 
# filter is returned if "add = TRUE"
coefs2poly(fit)$arcoefs
# an empty set is returned if "add = FALSE"
coefs2poly(fit, add = FALSE)$arcoefs

# in a model with non-seasonal part and no differencing filter 
# no multiplication of polynomials are involved and 
# the coefficients are the same as those returned by "coef"
fit &lt;- arima(log(AirPassengers), order = c(1,0,1))
coef(fit)
coefs2poly(fit)
</code></pre>

<hr>
<h2 id='discard.outliers'>Stage II of the Procedure: Discard Outliers</h2><span id='topic+discard.outliers'></span>

<h3>Description</h3>

<p>This functions tests for the significance of a given set of outliers 
in a time series model that is fitted including the outliers as regressor variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>discard.outliers(x, y, cval = NULL, 
  method = c("en-masse", "bottom-up"), 
  delta = 0.7, tsmethod.call = NULL, 
  fdiff = NULL, logfile = NULL, check.rank = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="discard.outliers_+3A_x">x</code></td>
<td>
<p>a list. The output returned by <code><a href="#topic+locate.outliers.oloop">locate.outliers.oloop</a></code>.</p>
</td></tr>
<tr><td><code id="discard.outliers_+3A_y">y</code></td>
<td>
<p>a time series.</p>
</td></tr>
<tr><td><code id="discard.outliers_+3A_cval">cval</code></td>
<td>
<p>a numeric. The critical value to determine the significance of each type of outlier.</p>
</td></tr>
<tr><td><code id="discard.outliers_+3A_method">method</code></td>
<td>
<p>a character. The method to discard/remove outliers. See details.</p>
</td></tr>
<tr><td><code id="discard.outliers_+3A_delta">delta</code></td>
<td>
<p>a numeric. Parameter of the temporary change type of outlier.</p>
</td></tr>


<tr><td><code id="discard.outliers_+3A_tsmethod.call">tsmethod.call</code></td>
<td>
<p>an optional <code>call</code> object. The call to the function used to fit the time 
series model.</p>
</td></tr>






<tr><td><code id="discard.outliers_+3A_fdiff">fdiff</code></td>
<td>
<p>currently ignored.</p>
</td></tr>
<tr><td><code id="discard.outliers_+3A_logfile">logfile</code></td>
<td>
<p>a character or <code>NULL</code>. It is the path to the file where 
tracking information is printed. Ignored if <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="discard.outliers_+3A_check.rank">check.rank</code></td>
<td>
<p>logical. If <code>TRUE</code>, variables generating perfect multicollinearity 
are removed (tentative implementation).</p>
</td></tr>
</table>


<h3>Details</h3>


<p>In the regressions involved in this function, the variables included as regressors 
stand for the effects of the outliers on the data. 
These variables are the output returned by <code><a href="#topic+outliers.effects">outliers.effects</a></code> 
not by <code><a href="#topic+outliers.regressors">outliers.regressors</a></code>, which returns the regressors used in the 
auxiliar regression where outliers are located 
(see second equation defined in <code><a href="#topic+locate.outliers">locate.outliers</a></code>).
</p>
<p>The outliers are defined in input <code>x</code>. If there are regressor variables 
in <code>tsmethod.call$xreg</code> they are considered as other regressor variables 
that are included in the regression to test for the significance of outliers.
</p>
<p>Given a set of potential outliers detected by <code><a href="#topic+locate.outliers">locate.outliers</a></code> and 
<code><a href="#topic+locate.outliers.oloop">locate.outliers.oloop</a></code>, three methods are considered in order to 
determine which outliers are not significant after refitting the model 
(including all the potential outliers):

</p>

<ul>
<li> <p><code>"en-masse"</code>: The complete set of outliers is included as regressor variables and the 
model is fitted again. Those outliers that turn out to be not significant for the critical 
value <code>cval</code> are discarded/removed. The procedure is iterated until all the outliers are significant 
in the final set of outliers.

</p>
</li>
<li> <p><code>"bottom-up"</code>: First the, the outlier with larger <code class="reqn">t</code>-statistic is included in the 
model. If it is significant the presence of the outlier is confirmed. Otherwise it is discarded. 
Then, the next outlier with larger <code class="reqn">t</code>-statistic is included along with the first outlier and 
tested for significance. 
If after including a new outlier, e.g. the <code class="reqn">i</code>-th outlier, the outliers that have been 
confirmed so far significant become not significant, then the <code class="reqn">i</code>-th outlier is discarded 
regardless of the value of its <code class="reqn">t</code>-statistic.






</p>
</li></ul>

<p>The option <code>"en-masse"</code> may be preferred to <code>"bottom-up"</code> when there are are several outliers,
since it may be hard to fit an ARIMA model with many regressor variables.
</p>






<h3>Value</h3>

<p>A list containing the following elements: 
<code>xreg</code>, the variables used as regressors;
<code>xregcoefs</code>, the coefficients of the outlier regressors;
<code>xregtstats</code>, the <code class="reqn">t</code>-statistics of the outlier regressors;;
<code>iter</code>, the number of iterations used by method <code>"en-masse"</code>;
<code>fit</code>, the fitted model;
<code>outliers</code>, the set of outliers after removing those that were not significant.
</p>


<h3>References</h3>

<p>Chen, C. and Liu, Lon-Mu (1993). 
&lsquo;Joint Estimation of Model Parameters and Outlier Effects in Time Series&rsquo;.
<em>Journal of the American Statistical Association</em>,
<b>88</b>(421), pp. 284-297.
</p>
<p>Gómez, V. and Maravall, A. (1996). 
<em>Programs TRAMO and SEATS. Instructions for the user</em>.
Banco de España, Servicio de Estudios. Working paper number 9628.
<a href="http://www.bde.es/f/webbde/SES/Secciones/Publicaciones/PublicacionesSeriadas/DocumentosTrabajo/96/Fich/dt9628e.pdf">http://www.bde.es/f/webbde/SES/Secciones/Publicaciones/PublicacionesSeriadas/DocumentosTrabajo/96/Fich/dt9628e.pdf</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+locate.outliers">locate.outliers</a></code>, <code><a href="#topic+tso">tso</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data("hicp")
y &lt;- log(hicp[["011600"]])
fit &lt;- arima(y, order = c(1, 1, 0), seasonal = list(order = c(2, 0, 2)))
# initial set of outliers
res &lt;- locate.outliers.oloop(y, fit, types = c("AO", "LS", "TC"))
res$outliers
# given the model fitted above, the effect on the data of some of 
# the outliers is not significant (method = "en-masse")
discard.outliers(res, y, method = "en-masse", 
  tsmethod.call = fit$call)$outliers
# in this case, using method = "bottom-up" the first four 
# outliers with higher t-statistic are kept
discard.outliers(res, y, method = "bottom-up", 
  tsmethod.call = fit$call)$outliers

## End(Not run)
</code></pre>

<hr>
<h2 id='find.consecutive.outliers'>Find outliers at consecutive time points</h2><span id='topic+find.consecutive.outliers'></span>

<h3>Description</h3>

<p>Find outliers at consecutive time points and discard those with 
lower <code class="reqn">t</code>-statistic in absolute value.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>find.consecutive.outliers(x, type)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="find.consecutive.outliers_+3A_x">x</code></td>
<td>
<p>a data frame containing the type, index and <code class="reqn">t</code>-statistic related 
to each outlier, named respectively by columns: <code>type</code>, <code>ind</code> and <code>tstat</code></p>
</td></tr></table>
<p>.
</p>
<table>
<tr><td><code id="find.consecutive.outliers_+3A_type">type</code></td>
<td>
<p>a character, the type of outlier to be checked for runs at consecutive points.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In the procedure, this function is applied by type of outliers, 
e.g., two or more consecutive LS are reduced to one LS.
It is still possible to get two or more consecutive outliers of different type 
at consecutive time points. 
Alternatively consecutive outliers of any type could be reduced to a single outlier,
For the time being, this is kept in this way so that for example, the following sequence 
AO1, LS2, LS3,LS4 can collapse to AO-1,LS-4, i.e., the AO is kept.
</p>


<h3>Value</h3>

<p>The row names of input <code>x</code> pointing to the outliers to be discarded, 
i.e., outliers with lower significance than adjacent outliers of the same type.
</p>


<h3>Note</h3>

<p>This function is intended for internal use; 
no check is done for correctness of the arguments passed as input.
</p>

<hr>
<h2 id='hicp'>Data Set: Harmonised Indices of Consumer Prices</h2><span id='topic+hicp'></span>

<h3>Description</h3>

<p>Harmonised indices of consumer prices in the Euro area.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hicp
</code></pre>


<h3>Format</h3>

<p>A list containing the following monthly indices (2005=100).

</p>

<table>
<tr>
 <td style="text-align: left;">
<b>Key</b> </td><td style="text-align: left;"> <b>Description</b> </td><td style="text-align: center;"> <b>Start</b> </td>
</tr>
<tr>
 <td style="text-align: left;"> 
ICP.M.U2.N.000000.4.INX </td><td style="text-align: left;"> Overall index </td><td style="text-align: center;"> 1990:1 </td>
</tr>
<tr>
 <td style="text-align: left;"> 
ICP.M.U2.N.010000.4.INX </td><td style="text-align: left;"> Food and non-alcoholic beverages </td><td style="text-align: center;"> 1990:1 </td>
</tr>
<tr>
 <td style="text-align: left;"> 
ICP.M.U2.N.011000.4.INX </td><td style="text-align: left;"> Food </td><td style="text-align: center;"> 1995:1 </td>
</tr>
<tr>
 <td style="text-align: left;"> 
ICP.M.U2.N.011200.4.INX </td><td style="text-align: left;"> Meat </td><td style="text-align: center;"> 1995:1 </td>
</tr>
<tr>
 <td style="text-align: left;"> 
ICP.M.U2.N.011300.4.INX </td><td style="text-align: left;"> Fish </td><td style="text-align: center;"> 1995:1 </td>
</tr>
<tr>
 <td style="text-align: left;"> 
ICP.M.U2.N.011600.4.INX </td><td style="text-align: left;"> Fruit </td><td style="text-align: center;"> 1995:1 </td>
</tr>
<tr>
 <td style="text-align: left;"> 
ICP.M.U2.N.011700.4.INX </td><td style="text-align: left;"> Vegetables </td><td style="text-align: center;"> 1995:1 </td>
</tr>
<tr>
 <td style="text-align: left;"> 
ICP.M.U2.N.FOODPR.4.INX </td><td style="text-align: left;"> Processed food incl. alcohol and tobacco </td><td style="text-align: center;"> 1990:1 </td>
</tr>
<tr>
 <td style="text-align: left;"> 
ICP.M.U2.N.FOODUN.4.INX </td><td style="text-align: left;"> Unprocessed food </td><td style="text-align: center;"> 1990:1 </td>
</tr>
<tr>
 <td style="text-align: left;"> 
ICP.M.U2.N.IGXE00.4.INX </td><td style="text-align: left;"> Industrial goods excluding energy </td><td style="text-align: center;"> 1990:1 </td>
</tr>
<tr>
 <td style="text-align: left;"> 
ICP.M.U2.N.NRGY00.4.INX </td><td style="text-align: left;"> Energy </td><td style="text-align: center;"> 1990:1 </td>
</tr>
<tr>
 <td style="text-align: left;"> 
ICP.M.U2.N.SERV00.4.INX </td><td style="text-align: left;"> Services </td><td style="text-align: center;"> 1990:1
</td>
</tr>

</table>


<p>All the series end in December 2013.
</p>


<h3>Source</h3>

<p>European Central Bank. 
Statistical Data Warehouse. <a href="http://sdw.ecb.europa.eu/">http://sdw.ecb.europa.eu/</a>.


</p>

<hr>
<h2 id='ipi'>Data Set: Industrial Production Indices</h2><span id='topic+ipi'></span>

<h3>Description</h3>

<p>Industrial production indices in the manufacturing sector
of European Monetary Union countries.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ipi
</code></pre>


<h3>Format</h3>

<p>A list containing monthly indices (2010=100) for the following countries.

</p>

<table>
<tr>
 <td style="text-align: left;">
<b>Country</b> </td><td style="text-align: center;"> <b>Start</b> </td><td style="text-align: left;"> <b>Country</b> </td><td style="text-align: center;"> <b>Start</b> </td>
</tr>
<tr>
 <td style="text-align: left;">  
Belgium </td><td style="text-align: center;"> 2000:1 </td><td style="text-align: left;"> Luxembourg </td><td style="text-align: center;"> 2000:1 </td>
</tr>
<tr>
 <td style="text-align: left;"> 
Germany </td><td style="text-align: center;"> 1999:1 </td><td style="text-align: left;"> Malta </td><td style="text-align: center;"> 2000:1 </td>
</tr>
<tr>
 <td style="text-align: left;"> 
Estonia </td><td style="text-align: center;"> 1999:1 </td><td style="text-align: left;"> Netherlands </td><td style="text-align: center;"> 1999:1 </td>
</tr>
<tr>
 <td style="text-align: left;"> 
Greece </td><td style="text-align: center;"> 2000:1 </td><td style="text-align: left;"> Austria </td><td style="text-align: center;"> 1999:1 </td>
</tr>
<tr>
 <td style="text-align: left;"> 
Spain </td><td style="text-align: center;"> 1999:1 </td><td style="text-align: left;"> Portugal </td><td style="text-align: center;"> 1999:1 </td>
</tr>
<tr>
 <td style="text-align: left;">
France </td><td style="text-align: center;"> 1999:1 </td><td style="text-align: left;"> Slovenia </td><td style="text-align: center;"> 1999:1 </td>
</tr>
<tr>
 <td style="text-align: left;">
Italy </td><td style="text-align: center;"> 1999:1 </td><td style="text-align: left;"> Slovakia </td><td style="text-align: center;"> 2000:1 </td>
</tr>
<tr>
 <td style="text-align: left;"> 
Cyprus </td><td style="text-align: center;"> 2000:1 </td><td style="text-align: left;"> Finland </td><td style="text-align: center;"> 1999:1 </td>
</tr>
<tr>
 <td style="text-align: left;">
Latvia </td><td style="text-align: center;"> 2000:1 </td><td style="text-align: left;">
</td>
</tr>

</table>


<p>All the series end in December 2013.
</p>


<h3>Note</h3>

<p>Data base key: &ldquo;sts_inpr_m&rdquo;,
monthly short-term business statistics. Production in industry.
</p>
<p>Gross data for Ireland is not available in Eurosta's data base, only seasonally 
or working day adjusted data are available for this country.
</p>


<h3>Source</h3>

<p>EUROSTAT. Statistical Office of the European Communities. 
<a href="https://ec.europa.eu/eurostat">https://ec.europa.eu/eurostat</a>.

</p>

<hr>
<h2 id='JarqueBera.test'>Jarque-Bera Test for Normality</h2><span id='topic+JarqueBera.test'></span><span id='topic+print.mhtest'></span>

<h3>Description</h3>

<p>This function applies the test for normality proposed in Jarque and Bera (1980).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>JarqueBera.test(x, fc = 3.5, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="JarqueBera.test_+3A_x">x</code></td>
<td>
<p>a time series of residuals or an object of class <code>Arima</code>.</p>
</td></tr>
<tr><td><code id="JarqueBera.test_+3A_fc">fc</code></td>
<td>
<p>a numeric. Factor to asses whether the first residual observations 
are to be omitted. Ignored if <code>x</code> is not an <code>Arima</code> object. See details.</p>
</td></tr>
<tr><td><code id="JarqueBera.test_+3A_...">...</code></td>
<td>
<p>further arguments. Currently omitted.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is based on function <code><a href="tseries.html#topic+jarque.bera.test">jarque.bera.test</a></code> 
available in package <span class="pkg">tseries</span>.
Here, the results are split in a test for the null hypothesis that the 
skewness is <code class="reqn">0</code>, the null that the kurtosis is <code class="reqn">3</code> and the overall 
Jarque-Bera test.
</p>
<p>The input can be a time series of residuals, <code>jarque.bera.test.default</code>,
or an <code>Arima</code> object, <code>jarque.bera.test.Arima</code> from which the residuals 
are extracted.
In the former case the whole input series of residuals is used. 
In the latter case,
the first <code class="reqn">n0</code> (defined below) residuals are omitted if they are are equal to zero
or if any of them are in absolute value larger than <code>fc</code> times 
the standard deviation of the remaining residuals.
<code class="reqn">n0</code> is set equal to <code>x$arma[6] + x$arma[5] * x$arma[7]</code>, i.e. 
the number of regular differences times the periodicity of the data times 
the number of seasonal differences. If <code class="reqn">n0</code> happens to be equal to <code class="reqn">1</code> 
it is set to <code class="reqn">2</code>.
</p>
<p>If the latter trimming operation is not desired, 
the argument <code>fc</code> can be set to a high value to ensure the complete 
series of residuals in considered; or the function can be called 
as <code>jarque.bera.test(residuals(x))</code>.
</p>
<p>Missing observations are omitted.
</p>


<h3>Value</h3>

<p>A list containing one <code>htest</code> object for the null hypothesis that 
the kurtosis is <code class="reqn">3</code>, the skewness is <code class="reqn">0</code> and a test combining 
both the kurtosis and the skewness to test for the normality of the input data.
</p>


<h3>References</h3>

<p>Jarque, C. M. and Bera, A. K. (1980). 
&lsquo;Efficient test for normality, homoscedasticity and 
serial independence of residuals&rsquo;.
<em>Economic Letters</em>, <b>6</b>(3), pp. 255-259.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+print.mhtest">print.mhtest</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># fit an ARIMA model to the HICP 011600 series
# ARIMA(0,1,0)(2,0,1) was chosen by forecast::auto.arima(ic = "bic")
# normality of the residuals is rejected at the 5% significance level
# due to an excess of kurtosis
data("hicp")
y &lt;- log(hicp[["011600"]])
fit1 &lt;- arima(y, order = c(0, 1, 0), seasonal = list(order = c(2, 0, 1)))
JarqueBera.test(fit1)
JarqueBera.test(residuals(fit1))

# fit ARIMA model for the same series including outliers that were
# detected by "tso" and for the model chosen by "auto.arima"
# normality of the residuals is not rejected at the 5% significance level
# after including the presence of outliers
mo &lt;- outliers(c("AO", "AO", "LS", "LS"), c(79, 210, 85, 225))
xreg &lt;- outliers.effects(mo, length(y))
fit2 &lt;- arima(y, order = c(1, 1, 0), seasonal = list(order = c(2, 0, 2)), 
  xreg = xreg)
JarqueBera.test(fit2)
</code></pre>

<hr>
<h2 id='locate.outliers'>Stage I of the Procedure: Locate Outliers (Baseline Function)</h2><span id='topic+locate.outliers'></span>

<h3>Description</h3>

<p>This function applies the <code class="reqn">t</code>-statistics for the significance of outliers 
at every time point and selects those that are significant given a critical value.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>locate.outliers(resid, pars, cval = 3.5, types = c("AO", "LS", "TC"), delta = 0.7)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="locate.outliers_+3A_resid">resid</code></td>
<td>
<p>a time series. Residuals from a time series model fitted to the data.</p>
</td></tr>

<tr><td><code id="locate.outliers_+3A_pars">pars</code></td>
<td>
<p>a list containing the parameters of the model fitted to the data. 
See details below.</p>
</td></tr>

<tr><td><code id="locate.outliers_+3A_cval">cval</code></td>
<td>
<p>a numeric. The critical value to determine the significance of each 
type of outlier.</p>
</td></tr>

<tr><td><code id="locate.outliers_+3A_types">types</code></td>
<td>
<p>a character vector indicating the types of outliers to be considered.</p>
</td></tr>

<tr><td><code id="locate.outliers_+3A_delta">delta</code></td>
<td>
<p>a numeric. Parameter of the temporary change type of outlier.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Five types of outliers can be considered. 
By default: <code>"AO"</code> additive outliers, <code>"LS"</code> level shifts,
and <code>"TC"</code> temporary changes are selected;
<code>"IO"</code> innovative outliers and <code>"SLS"</code> seasonal level shifts 
can also be selected.
</p>
<p>The approach described in Chen &amp; Liu (1993) is followed to locate outliers.
The original framework is based on ARIMA time series models. 
The extension to structural time series models is currently experimental.
</p>
<p>Let us define an ARIMA model for the series <code class="reqn">y_t^*</code> subject 
to <code class="reqn">m</code> outliers defined as <code class="reqn">L_j(B)</code> with weights <code class="reqn">w</code>:
</p>
<p style="text-align: center;"><code class="reqn">y_t^* = \sum_{j=1}^m \omega_j L_j(B) I_t(t_j) + 
\frac{\theta(B)}{\phi(B) \alpha(B)} a_t \,,</code>
</p>

<p>where <code class="reqn">I_t(t_j)</code> is an indicator variable containing the value 
<code class="reqn">1</code> at observation <code class="reqn">t_j</code> where the <code class="reqn">j</code>-th outlier arises;
<code class="reqn">\phi(B)</code> is an autoregressive polynomial with all roots outside the unit circle;
<code class="reqn">\theta(B)</code> is a moving average polynomial with all roots outside the unit circle;
and <code class="reqn">\alpha(B)</code> is an autoregressive polynomial with all roots on the unit circle.
</p>
<p>The presence of outliers is tested by means of <code class="reqn">t</code>-statistics 
applied on the following regression equation:
</p>
<p style="text-align: center;"><code class="reqn">\pi(B) y_t^* \equiv \hat{e}_t = 
\sum_{j=1}^m \omega_j \pi(B) L_j(B) I_t(t_j) + a_t \,.</code>
</p>

<p>where <code class="reqn">\pi(B) = \sum_{i=0}^\infty \pi_i B^i</code>.

The regressors of the above equation are created by the functions
<code>outliers.regressors.arima</code> and the remaining functions described here.
</p>
<p>The function <code>locate.outliers</code> computes all the <code class="reqn">t</code>-statistics for each type of 
outlier and for every time point. See <code><a href="#topic+outliers.tstatistics">outliers.tstatistics</a></code>.
Then, the cases where the corresponding <code class="reqn">t</code>-statistic are (in absolute value) 
below the threshold <code>cval</code> are removed. Thus, a potential set of outliers is obtained.
</p>
<p>Some polishing rules are applied by <code>locate.outliers</code>:

</p>

<ul>
<li><p> If level shifts are found at consecutive time points, only then point with higher 
<code class="reqn">t</code>-statistic in absolute value is kept.

</p>
</li>
<li><p> If more than one type of outlier exceed the threshold <code>cval</code> at a given time point, 
the type of outlier with higher <code class="reqn">t</code>-statistic in absolute value is kept and the others 
are removed.



</p>
</li></ul>

<p>The argument <code>pars</code> is a list containing the parameters of the model.
In the framework of ARIMA models, the coefficients of the ARIMA must be defined in <code>pars</code> 
as the product of the autoregressive non-seasonal and seasonal polynomials (if any) and the 
differencing filter (if any). The function <code><a href="#topic+coefs2poly">coefs2poly</a></code> can be used to define 
the argument <code>pars</code>. 
</p>


<h3>Value</h3>

<p>A data frame defining by rows the potential set of outliers. 
The type of outlier, the observation, the coefficient and the <code class="reqn">t</code>-statistic
are given by columns respectively for each outlier.
</p>


<h3>Note</h3>

<p>The default critical value, <code>cval</code>, is set equal to <code class="reqn">3.5</code> and, 
hence, it is not based on the sample size as in functions <code><a href="#topic+tso">tso</a></code> 
or <code><a href="#topic+locate.outliers.oloop">locate.outliers.oloop</a></code>.




</p>
<p>Currently the innovational outlier <code>"SLS"</code> is not available 
if <code>pars</code> is related to a structural time series model.
</p>


<h3>References</h3>

<p>Chen, C. and Liu, Lon-Mu (1993). 
&lsquo;Joint Estimation of Model Parameters and Outlier Effects in Time Series&rsquo;.
<em>Journal of the American Statistical Association</em>,
<b>88</b>(421), pp. 284-297.
</p>
<p>Gómez, V. and Maravall, A. (1996). 
<em>Programs TRAMO and SEATS. Instructions for the user</em>.
Banco de España, Servicio de Estudios. Working paper number 9628.
<a href="http://www.bde.es/f/webbde/SES/Secciones/Publicaciones/PublicacionesSeriadas/DocumentosTrabajo/96/Fich/dt9628e.pdf">http://www.bde.es/f/webbde/SES/Secciones/Publicaciones/PublicacionesSeriadas/DocumentosTrabajo/96/Fich/dt9628e.pdf</a>
</p>
<p>Gómez, V. and Taguas, D. (1995). 
<em>Detección y Corrección Automática de Outliers con TRAMO: 
Una Aplicación al IPC de Bienes Industriales no Energéticos</em>.
Ministerio de Economía y Hacienda. Document number D-95006.
<a href="https://www.sepg.pap.hacienda.gob.es/sitios/sepg/es-ES/Presupuestos/DocumentacionEstadisticas/Documentacion/Documents/DOCUMENTOS%20DE%20TRABAJO/D95006.pdf">https://www.sepg.pap.hacienda.gob.es/sitios/sepg/es-ES/Presupuestos/DocumentacionEstadisticas/Documentacion/Documents/DOCUMENTOS%20DE%20TRABAJO/D95006.pdf</a>
</p>
<p>Kaiser, R., and Maravall, A. (1999). 
<em>Seasonal Outliers in Time Series</em>.
Banco de España, Servicio de Estudios. Working paper number 9915.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+locate.outliers.oloop">locate.outliers.oloop</a></code>,
<code><a href="#topic+locate.outliers.iloop">locate.outliers.iloop</a></code>, 
<code><a href="#topic+outliers.tstatistics">outliers.tstatistics</a></code>, 
<code><a href="#topic+tso">tso</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("hicp")
y &lt;- log(hicp[["011600"]])
fit &lt;- arima(y, order = c(1, 1, 0), seasonal = list(order = c(2, 0, 2)))
resid &lt;- residuals(fit)
pars &lt;- coefs2poly(fit)
outliers &lt;- locate.outliers(resid, pars)
outliers
</code></pre>

<hr>
<h2 id='locate.outliers.loops'>Stage I of the Procedure: Locate Outliers (Loop Around Functions)</h2><span id='topic+locate.outliers.oloop'></span><span id='topic+locate.outliers.iloop'></span>

<h3>Description</h3>

<p>These functions implement the inner and outer loops based of the procedure 
to locate outliers following the approach described in Chen and Liu (1993) . 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>locate.outliers.oloop(y, fit, types = c("AO", "LS", "TC"), 
  cval = NULL, maxit.iloop = 4, maxit.oloop = 4, 
  delta = 0.7, logfile = NULL)
locate.outliers.iloop(resid, pars, cval = 3.5, 
  types = c("AO", "LS", "TC"), maxit = 4, delta = 0.7, logfile = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="locate.outliers.loops_+3A_y">y</code></td>
<td>
<p>a time series.</p>
</td></tr>

<tr><td><code id="locate.outliers.loops_+3A_fit">fit</code></td>
<td>
<p>an <code>Arima</code> object. The output from <code><a href="stats.html#topic+arima">arima</a></code> or 
<code><a href="forecast.html#topic+auto.arima">auto.arima</a></code></p>
</td></tr></table>
<p>.

</p>
<table>
<tr><td><code id="locate.outliers.loops_+3A_resid">resid</code></td>
<td>
<p>a time series. Residuals from a time series model fitted to the data.</p>
</td></tr>

<tr><td><code id="locate.outliers.loops_+3A_pars">pars</code></td>
<td>
<p>a list containing the parameters of the model fitted to the data. 
See details in <code><a href="#topic+locate.outliers">locate.outliers</a></code>.</p>
</td></tr>

<tr><td><code id="locate.outliers.loops_+3A_cval">cval</code></td>
<td>
<p>a numeric. The critical value to determine the significance of each type of outlier.</p>
</td></tr>

<tr><td><code id="locate.outliers.loops_+3A_types">types</code></td>
<td>
<p>a character vector indicating the type of outlier to be considered by the 
detection procedure among the following: 
innovational outliers (<code>"IO"</code>), additive outliers (<code>"AO"</code>), 
level shifts (<code>"LS"</code>), temporary changes (<code>"TC"</code>) 
and seasonal level shifts (<code>"SLS"</code>).</p>
</td></tr>

<tr><td><code id="locate.outliers.loops_+3A_maxit">maxit</code></td>
<td>
<p>a numeric. The maximum number of iterations in the inner loop.</p>
</td></tr>

<tr><td><code id="locate.outliers.loops_+3A_maxit.iloop">maxit.iloop</code></td>
<td>
<p>a numeric. Same as argument as <code>maxit</code> to be passed to 
<code>locate.outliers.iloop</code>.</p>
</td></tr>

<tr><td><code id="locate.outliers.loops_+3A_maxit.oloop">maxit.oloop</code></td>
<td>
<p>a numeric. The maximum number of iterations in the outer loop.</p>
</td></tr>

<tr><td><code id="locate.outliers.loops_+3A_delta">delta</code></td>
<td>
<p>a numeric. Parameter of the temporary change type of outlier.</p>
</td></tr>

<tr><td><code id="locate.outliers.loops_+3A_logfile">logfile</code></td>
<td>
<p>a character or <code>NULL</code>. It is the path to the file where 
tracking information is printed. Ignored if <code>NULL</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See also the details section in <code><a href="#topic+locate.outliers">locate.outliers</a></code>.






</p>
<p>The function <code><a href="#topic+locate.outliers.iloop">locate.outliers.iloop</a></code> iterates around the function 
<code>locate.outliers</code> until no additional outliers are found or the maximum number 
of iterations is reached. 
After each iteration, the effect of the outliers on the residuals of the fitted model 
is removed and the <code class="reqn">t</code>-statistics are obtained again for the modified residuals.
No model selection or refit of the model is conducted within this loop.
</p>
<p>The function <code>locate.outliers.oloop</code> is the outer loop of the procedure to locate 
outliers. It iterates around the function <code><a href="#topic+locate.outliers.iloop">locate.outliers.iloop</a></code>.
At the end of each iteration the detected outliers are removed from the original 
data. Then, the time series model is fitted (or selected) again for the adjusted series 
and a new search for outliers is executed. The outer loop stops when no additional outliers 
are detected.
</p>
<p>In function <code>locate.outliers.oloop</code>,
if no value is specified for argument <code>cval</code> a default value based on the sample size 
is used. Let <code class="reqn">n</code> be the number of observations. If <code class="reqn">n \le 50</code> then <code>cval</code> is set 
equal to <code class="reqn">3.0</code>; If <code class="reqn">n \ge 450</code> then <code>cval</code> is set equal to <code class="reqn">4.0</code>;
otherwise <code>cval</code> is set equal to <code class="reqn">3 + 0.0025 * (n - 50)</code>.
</p>


<h3>Value</h3>

<p><code>locate.outliers.iloop</code> returns a data frame defining by rows each 
detected outlier. The data frame follows the same format as the output from 
<code><a href="#topic+locate.outliers">locate.outliers</a></code>.
</p>
<p><code>locate.outliers.oloop</code> returns a list containing the following elements:
<code>fit</code>: information from the last fitted model that will be required by 
other functions in the automatic procedure (parameter estimates, residuals and 
number of observations);
<code>outliers</code>: a data frame defining by rows the detected outliers;
<code>iter</code>: the number of iterations employed by the outer loop.
</p>


<h3>Note</h3>

<p>In <code>locate.outliers.iloop</code> 
the default critical value, <code>cval</code>, is set equal to <code class="reqn">3.5</code> and, 
hence, it is not based on the sample size.
<code>locate.outliers.oloop</code> uses a default critical value based on the 
sampel size as in <code><a href="#topic+tso">tso</a></code>.  
</p>


<h3>References</h3>

<p>Chen, C. and Liu, Lon-Mu (1993). 
&lsquo;Joint Estimation of Model Parameters and Outlier Effects in Time Series&rsquo;.
<em>Journal of the American Statistical Association</em>,
<b>88</b>(421), pp. 284-297.
</p>
<p>Gómez, V. and Maravall, A. (1996). 
<em>Programs TRAMO and SEATS. Instructions for the user</em>.
Banco de España, Servicio de Estudios. Working paper number 9628.
<a href="http://www.bde.es/f/webbde/SES/Secciones/Publicaciones/PublicacionesSeriadas/DocumentosTrabajo/96/Fich/dt9628e.pdf">http://www.bde.es/f/webbde/SES/Secciones/Publicaciones/PublicacionesSeriadas/DocumentosTrabajo/96/Fich/dt9628e.pdf</a>
</p>
<p>Gómez, V. and Taguas, D. (1995). 
<em>Detección y Corrección Automática de Outliers con TRAMO: 
Una Aplicación al IPC de Bienes Industriales no Energéticos</em>.
Ministerio de Economía y Hacienda. Document number D-95006.
<a href="https://www.sepg.pap.hacienda.gob.es/sitios/sepg/es-ES/Presupuestos/DocumentacionEstadisticas/Documentacion/Documents/DOCUMENTOS%20DE%20TRABAJO/D95006.pdf">https://www.sepg.pap.hacienda.gob.es/sitios/sepg/es-ES/Presupuestos/DocumentacionEstadisticas/Documentacion/Documents/DOCUMENTOS%20DE%20TRABAJO/D95006.pdf</a>
</p>
<p>Kaiser, R., and Maravall, A. (1999). 
<em>Seasonal Outliers in Time Series</em>.
Banco de España, Servicio de Estudios. Working paper number 9915.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+outliers.tstatistics">outliers.tstatistics</a></code>, <code><a href="#topic+tso">tso</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># additional outliers may be detected in the inner or outlier loops
# in this case, the inner does not find further potential outliers 
# and stops in the first iteration, while the outer loop detects 
# a new outlier
data("hicp")
y &lt;- log(hicp[["011600"]])
fit &lt;- arima(y, order = c(1, 1, 0), seasonal = list(order = c(2, 0, 2)))
resid &lt;- residuals(fit)
pars &lt;- coefs2poly(fit)
otypes &lt;- c("AO", "LS", "TC")
mo0 &lt;- locate.outliers(resid, pars, types = otypes)
mo0
mo1 &lt;- locate.outliers.iloop(resid, pars, types = otypes)
mo1
mo2 &lt;- locate.outliers.oloop(y, fit, types = otypes)
mo2$iter
mo2$outliers
</code></pre>

<hr>
<h2 id='outliers'>Define Outliers in a Data Frame</h2><span id='topic+outliers'></span>

<h3>Description</h3>

<p>This function is an interface to create a data frame defining 
the type, observation and weight of outliers. The output is properly designed to 
be used as input to other functions such as <code><a href="#topic+outliers.effects">outliers.effects</a></code> 
and <code><a href="#topic+outliers.regressors">outliers.regressors</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>outliers(type, ind, weight = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="outliers_+3A_type">type</code></td>
<td>
<p>a character vector. The types of outliers (&quot;IO&quot;, &quot;AO&quot;, &quot;LS&quot;, &quot;TC&quot;, &quot;SLS&quot;).</p>
</td></tr>
<tr><td><code id="outliers_+3A_ind">ind</code></td>
<td>
<p>a numeric vector. The observations at which each outlier takes effect.</p>
</td></tr>
<tr><td><code id="outliers_+3A_weight">weight</code></td>
<td>
<p>an optional numeric vector. The weights of the outliers. If <code>NULL</code> the 
weights are set equal to one.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>outliers(c("AO", "LS"), c(10, 20))
outliers(c("AO", "LS"), c(10, 20), c(2.1, 3.2))
</code></pre>

<hr>
<h2 id='outliers.effects'>Create the Pattern of Different Types of Outliers</h2><span id='topic+outliers.effects'></span>

<h3>Description</h3>

<p>These functions create a unit or weighted impulse for the five types 
of outliers considered in the package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>outliers.effects(mo, n, weights = FALSE, delta = 0.7, 
  pars = NULL, freq = 12)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="outliers.effects_+3A_mo">mo</code></td>
<td>
<p>a data frame defining the type, location and weight of the outliers to be created.</p>
</td></tr>

<tr><td><code id="outliers.effects_+3A_n">n</code></td>
<td>
<p>a numeric. The length of the variable that will contain the outlier.</p>
</td></tr>

<tr><td><code id="outliers.effects_+3A_weights">weights</code></td>
<td>
<p>logical. If <code>TRUE</code>, the outliers are weighted by the 
values in column <code>"coefhat"</code> of the data frame <code>mo</code>. Otherwise, 
unit weights are considered.</p>
</td></tr>

<tr><td><code id="outliers.effects_+3A_delta">delta</code></td>
<td>
<p>a numeric. Parameter of the temporary change type of outlier.</p>
</td></tr>

<tr><td><code id="outliers.effects_+3A_pars">pars</code></td>
<td>
<p>a list containing the parameters of the time series model fitted to the data. 
Only for innovational outlier. See the details section in <code><a href="#topic+locate.outliers">locate.outliers</a></code>.</p>
</td></tr>

<tr><td><code id="outliers.effects_+3A_freq">freq</code></td>
<td>
<p>a numeric. The periodicity of the data. Only for seasonal level shift.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>These functions delineate the effect of each type of outlier on the observed data. 
See the example below for a representation of the outliers.
</p>
<p>The function <code>outliers.effects</code> operates directly on the output returned 
by <code><a href="stats.html#topic+time">time</a></code>. The remaining functions are called by 
<code>outliers.effects</code> and can be used as a simpler interface to define some outliers.
They generate the type of outliers indicated by their names.
</p>
<p>The column names of the data frame <code>mo</code> must follow the same convention as 
the output returned by <code><a href="#topic+locate.outliers">locate.outliers</a></code>: the column containing the 
observation at which the outlier sparks is named <code>"ind"</code>; 
the column containing the weights is named <code>"coefhat"</code> and the type 
of outlier is specified in a column named <code>"type"</code>. The column <code>"ind"</code> 
should contain the index time point, not the time point in terms of year and season 
as given by <code><a href="stats.html#topic+time">time</a></code>.
</p>


<h3>Value</h3>

<p>A <code>n</code> <code class="reqn">\times</code> <code>nrow(mo)</code> or <code>n</code> <code class="reqn">\times</code> <code>length(ind)</code> matrix
containing by columns each outlier.
</p>


<h3>References</h3>

<p>Chen, C. and Liu, Lon-Mu (1993). 
&lsquo;Joint Estimation of Model Parameters and Outlier Effects in Time Series&rsquo;.
<em>Journal of the American Statistical Association</em>,
<b>88</b>(421), pp. 284-297.
</p>
<p>Gómez, V. and Maravall, A. (1996). 
<em>Programs TRAMO and SEATS. Instructions for the user</em>.
Banco de España, Servicio de Estudios. Working paper number 9628.
<a href="http://www.bde.es/f/webbde/SES/Secciones/Publicaciones/PublicacionesSeriadas/DocumentosTrabajo/96/Fich/dt9628e.pdf">http://www.bde.es/f/webbde/SES/Secciones/Publicaciones/PublicacionesSeriadas/DocumentosTrabajo/96/Fich/dt9628e.pdf</a>
</p>
<p>Kaiser, R., and Maravall, A. (1999). 
<em>Seasonal Outliers in Time Series</em>.
Banco de España, Servicio de Estudios. Working paper number 9915.
<a href="http://www.bde.es/f/webbde/SES/Secciones/Publicaciones/PublicacionesSeriadas/DocumentosTrabajo/99/Fic/dt9915e.pdf">http://www.bde.es/f/webbde/SES/Secciones/Publicaciones/PublicacionesSeriadas/DocumentosTrabajo/99/Fic/dt9915e.pdf</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+locate.outliers">locate.outliers</a></code>, <code><a href="#topic+remove.outliers">remove.outliers</a></code>, 
<code><a href="#topic+tso">tso</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>n &lt;- 30
# innovative outlier based on ARMA(3, 2) model
mo &lt;- outliers("IO", 10)
io &lt;- outliers.effects(mo, n, pars = list(arcoefs = c(0.8, -0.6, 0.2), 
  macoefs = c(-0.5, 0.2)))
plot(c(io[seq.int(10)], rep(NA, 20)), type = "s", ylim = range(io), 
  ylab = "io", main = "IO based on ARMA(3,2)")
lines(c(rep(NA, 9), io[-seq.int(9)]))

# innovative outlier based on Airlines model ARIMA(0,1,1)(0,1,1)
p1 &lt;- c(1, -1)
p2 &lt;- c(1, rep(0, 3), -1)
p1xp2 &lt;- c(1, -1, 0, 0, -1, 1)
p1b &lt;- c(1, -0.6)
p2b &lt;- c(1, rep(0, 3), -0.6)
p2bxp2b &lt;- c(1, -0.6, 0, 0, -0.6, 0.36)
io2 &lt;- outliers.effects(mo, n, pars = list(arcoefs = -p1xp2[-1], 
  macoefs = p2bxp2b[-1]))
plot(c(io2[seq.int(10)], rep(NA, 20)), type = "s", ylim = range(io2), 
  main = "IO based on ARIMA(0,1,1)(0,1,1)", ylab = "io2")
lines(c(rep(NA, 9), io2[-seq.int(9)]))

# additive outlier
mo &lt;- outliers("AO", 10)
ao &lt;- outliers.effects(mo, n)
plot(ao, type = "h", main = "AO: additive outlier")

# level shift
mo &lt;- outliers("LS", 10)
ls &lt;- outliers.effects(mo, n)
plot(ls, type = "s", main = "LS: level shift")

# temporary change
mo &lt;- outliers("TC", 10)
tc &lt;- outliers.effects(mo, n)
plot(c(tc[seq.int(10)], rep(NA, 20)), type = "s", 
  main = "TC: temporary change", ylab = "tc")
lines(c(rep(NA, 9), tc[-seq.int(9)]))

# the temporary change with parameter 0.7 is equivalent to 
# an IO for an AR(1) model with coefficient 0.7
mo &lt;- outliers("IO", 10)
io3 &lt;- outliers.effects(mo, n = n, pars = list(arcoefs = c(0.7), macoefs = c(0)))
all.equal(io3, tc, check.attributes=FALSE)

# the temporary change with parameter 0.7 is equivalent to 
# an IO for an AR(1) model with coefficient 0.7
mo &lt;- outliers("IO", 10)
io4 &lt;- outliers.effects(mo, n = n, pars = list(arcoefs = 1, macoefs = 0))
all.equal(io4, ls, check.attributes=FALSE)

# seasonal level shift (quarterly data)
mo &lt;- outliers("SLS", 10)
sls &lt;- outliers.effects(mo, n, freq = 4)
plot(sls, type = "h", main = "SLS: seasonal level shift")
</code></pre>

<hr>
<h2 id='outliers.regressors'>Regressor Variables for the Detection of Outliers</h2><span id='topic+outliers.regressors'></span>

<h3>Description</h3>

<p>These functions create regressor variables to be used included in the 
regression where tests for presence will be applied.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>outliers.regressors(pars, mo, n, weights = TRUE,
  delta = 0.7, freq = 12)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="outliers.regressors_+3A_pars">pars</code></td>
<td>
<p>a list containing the parameters of the model. 
See details section in <code><a href="#topic+locate.outliers">locate.outliers</a></code>.</p>
</td></tr>







<tr><td><code id="outliers.regressors_+3A_mo">mo</code></td>
<td>
<p>a data frame defining the type, location and weight of the outliers to be created.</p>
</td></tr>
<tr><td><code id="outliers.regressors_+3A_n">n</code></td>
<td>
<p>a numeric. The length of the variable that will contain the outlier.</p>
</td></tr>
<tr><td><code id="outliers.regressors_+3A_weights">weights</code></td>
<td>
<p>logical. If <code>TRUE</code>, the variables are weighted by the 
values in column <code>"coefhat"</code> of the data frame <code>mo</code>. Otherwise, 
unit weights are considered.</p>
</td></tr>
<tr><td><code id="outliers.regressors_+3A_delta">delta</code></td>
<td>
<p>a numeric. Parameter of the temporary change type of outlier.</p>
</td></tr>
<tr><td><code id="outliers.regressors_+3A_freq">freq</code></td>
<td>
<p>a numeric. The periodicity of the data. 
Used only for the seasonal level shift, <code>"SLS"</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The variables returned by these functions are the regressors that take part in 
the second equation defined in <code><a href="#topic+locate.outliers">locate.outliers</a></code>,
(equation (20) in Chen-Liu (1993), equation (3) in the documentat 
attached to the package).
</p>
<p>Regressions are not actually run since the <code class="reqn">t</code>-statistics
can be obtained more conveniently as indicated in equation (14) in Chen-Liu (1993).
These variables are used in function <code><a href="#topic+locate.outliers.iloop">locate.outliers.iloop</a></code> to  
adjust the residuals at each iteration.
</p>
<p>The function <code><a href="#topic+outliers">outliers</a></code> can be used to easily create the input 
argument <code>mo</code>.
</p>


<h3>Value</h3>

<p>A matrix containing the regressors by columms.
</p>


<h3>References</h3>

<p>Chen, C. and Liu, Lon-Mu (1993). 
&lsquo;Joint Estimation of Model Parameters and Outlier Effects in Time Series&rsquo;.
<em>Journal of the American Statistical Association</em>,
<b>88</b>(421), pp. 284-297.
</p>
<p>Kaiser, R., and Maravall, A. (1999). 
<em>Seasonal Outliers in Time Series</em>.
Banco de España, Servicio de Estudios. Working paper number 9915.
<a href="http://www.bde.es/f/webbde/SES/Secciones/Publicaciones/PublicacionesSeriadas/DocumentosTrabajo/99/Fic/dt9915e.pdf">http://www.bde.es/f/webbde/SES/Secciones/Publicaciones/PublicacionesSeriadas/DocumentosTrabajo/99/Fic/dt9915e.pdf</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+locate.outliers">locate.outliers</a></code>, <code><a href="#topic+outliers">outliers</a></code>, 
<code><a href="#topic+outliers.tstatistics">outliers.tstatistics</a></code>, <code><a href="#topic+tso">tso</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># regression of the residuals from the ARIMA model 
# on the corresponding regressors for three additive outliers
# at the 5% level, the first AO is not significant, the others are significant
data("hicp")
y &lt;- log(hicp[["011600"]])
fit &lt;- arima(y, order = c(1, 1, 0), seasonal = list(order = c(2, 0, 2)))
resid &lt;- residuals(fit)
pars &lt;- coefs2poly(fit)
mo &lt;- outliers(rep("AO", 3), c(10, 79, 224))
xreg &lt;- outliers.regressors(pars, mo, length(y))
summary(lm(residuals(fit) ~ 0 + xreg)) 
</code></pre>

<hr>
<h2 id='outliers.tstatistics'>Test Statistics for the Significance of Outliers</h2><span id='topic+outliers.tstatistics'></span>

<h3>Description</h3>

<p>This function computes the <code class="reqn">t</code>-statistics to assess the significance 
of different types of outliers at every possible time point. 
The statistics can be based either on an ARIMA model, 
<code><a href="stats.html#topic+arima">arima</a></code> or <code><a href="forecast.html#topic+auto.arima">auto.arima</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>outliers.tstatistics(pars, resid, types = c("AO", "LS", "TC"), 
  sigma = NULL, delta = 0.7)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="outliers.tstatistics_+3A_pars">pars</code></td>
<td>
<p>a list containing the parameters of the model. 
See details section in <code><a href="#topic+locate.outliers">locate.outliers</a></code>.</p>
</td></tr>
<tr><td><code id="outliers.tstatistics_+3A_resid">resid</code></td>
<td>
<p>a time series. Residuals of the ARIMA model fitted to the data.</p>
</td></tr>
<tr><td><code id="outliers.tstatistics_+3A_types">types</code></td>
<td>
<p>a character vector indicating the types of outliers to be considered.</p>
</td></tr>
<tr><td><code id="outliers.tstatistics_+3A_sigma">sigma</code></td>
<td>
<p>a numeric or <code>NULL</code>. Standard deviation of residuals.</p>
</td></tr>
<tr><td><code id="outliers.tstatistics_+3A_delta">delta</code></td>
<td>
<p>a numeric. Parameter of the temporary change type of outlier.</p>
</td></tr>






</table>


<h3>Details</h3>




















<p>Five types of outliers can be considered. 
By default: <code>"AO"</code> additive outliers, <code>"LS"</code> level shifts,
and <code>"TC"</code> temporary changes are selected;
<code>"IO"</code> innovative outliers and <code>"SLS"</code> seasonal level shifts 
can also be selected.
</p>
<p>The test statistics are based on the second equation defined in <code><a href="#topic+locate.outliers">locate.outliers</a></code>.
</p>
<p>These functions are the called by <code><a href="#topic+locate.outliers">locate.outliers</a></code>.
The approach described in Chen &amp; Liu (1993) is implemented to compute 
the <code class="reqn">t</code>-statistics.
</p>
<p>By default (<code>sigma = NULL</code>), the standard deviation of residuals 
is computed as the mean absolute deviation of <code>resid</code>. 
</p>


<h3>Value</h3>

<p>For each function, a two-column matrix is returned.
The first column contains the estimate of the coefficients related to the type of outlier 
and the second column contains the <code class="reqn">t</code>-statistics.
The value of these statistics for each time point is stored by rows, thus 
the number of rows is equal to the length of <code>resid</code>.
</p>


<h3>References</h3>

<p>Chen, C. and Liu, Lon-Mu (1993). 
&lsquo;Joint Estimation of Model Parameters and Outlier Effects in Time Series&rsquo;.
<em>Journal of the American Statistical Association</em>,
<b>88</b>(421), pp. 284-297.
</p>
<p>Gómez, V. and Maravall, A. (1996). 
<em>Programs TRAMO and SEATS. Instructions for the user</em>.
Banco de España, Servicio de Estudios. Working paper number 9628.
<a href="http://www.bde.es/f/webbde/SES/Secciones/Publicaciones/PublicacionesSeriadas/DocumentosTrabajo/96/Fich/dt9628e.pdf">http://www.bde.es/f/webbde/SES/Secciones/Publicaciones/PublicacionesSeriadas/DocumentosTrabajo/96/Fich/dt9628e.pdf</a>
</p>
<p>Gómez, V. and Taguas, D. (1995). 
<em>Detección y Corrección Automática de Outliers con TRAMO: 
Una Aplicación al IPC de Bienes Industriales no Energéticos</em>.
Ministerio de Economía y Hacienda. Document number D-95006.
<a href="https://www.sepg.pap.hacienda.gob.es/sitios/sepg/es-ES/Presupuestos/DocumentacionEstadisticas/Documentacion/Documents/DOCUMENTOS%20DE%20TRABAJO/D95006.pdf">https://www.sepg.pap.hacienda.gob.es/sitios/sepg/es-ES/Presupuestos/DocumentacionEstadisticas/Documentacion/Documents/DOCUMENTOS%20DE%20TRABAJO/D95006.pdf</a>
</p>
<p>Kaiser, R., and Maravall, A. (1999). 
<em>Seasonal Outliers in Time Series</em>.
Banco de España, Servicio de Estudios. Working paper number 9915.
<a href="http://www.bde.es/f/webbde/SES/Secciones/Publicaciones/PublicacionesSeriadas/DocumentosTrabajo/99/Fic/dt9915e.pdf">http://www.bde.es/f/webbde/SES/Secciones/Publicaciones/PublicacionesSeriadas/DocumentosTrabajo/99/Fic/dt9915e.pdf</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+locate.outliers">locate.outliers</a></code>, <code><a href="#topic+outliers.regressors">outliers.regressors</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># given an ARIMA model detect potential outliers
# for a critical value equal to 3.5
data("hicp")
y &lt;- log(hicp[["011600"]])
fit &lt;- arima(y, order = c(1, 1, 0), seasonal = list(order = c(2, 0, 2)))
resid &lt;- residuals(fit)
pars &lt;- coefs2poly(fit)
tstats &lt;- outliers.tstatistics(pars, resid)
# potential observations affected by an additive outliers
which(abs(tstats[,"AO","tstat"]) &gt; 3.5)
# potential observations affected by a temporary change
which(abs(tstats[,"TC","tstat"]) &gt; 3.5)
# potential observations affected by a level shift
which(abs(tstats[,"LS","tstat"]) &gt; 3.5)
</code></pre>

<hr>
<h2 id='plot.tsoutliers'>Display Outlier Effects Detected by <code>tsoutliers</code></h2><span id='topic+plot.tsoutliers'></span>

<h3>Description</h3>

<p>This function displays the output from function <code><a href="#topic+tso">tso</a></code>. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'tsoutliers'
plot(x, 
  args.lines.y = list(col = "gray80"), args.lines.yadj = list(col = "blue"),
  args.lines.effects = list(type = "s", col = "red"),   
  args.points = list(col = "gray80", bg = "red", pch = 21), plot.points = TRUE, 
  args.x.axis = list(at = pretty(time(x$y)), tcl = -0.5, lwd = 0, lwd.ticks = 1),
  args.y.axis = list(at = pretty(x$y), tcl = -0.5, lwd = 0, lwd.ticks = 1),
  args.effects.axis = list(at = pretty(x$effects), tcl = -0.5, lwd = 0, lwd.ticks = 1),
  ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.tsoutliers_+3A_x">x</code></td>
<td>
<p>a list of class <code>tsoutliers</code> as returned by <code><a href="#topic+tso">tso</a></code>.</p>
</td></tr>
<tr><td><code id="plot.tsoutliers_+3A_args.lines.y">args.lines.y</code></td>
<td>
<p>a list. Arguments passed to <code><a href="graphics.html#topic+lines">lines</a></code> to 
customize the line displaying the original series.</p>
</td></tr>
<tr><td><code id="plot.tsoutliers_+3A_args.lines.yadj">args.lines.yadj</code></td>
<td>
<p>a list. Arguments passed to <code><a href="graphics.html#topic+lines">lines</a></code> to 
customize the line displaying the series adjusted for outliers effects.</p>
</td></tr>
<tr><td><code id="plot.tsoutliers_+3A_args.lines.effects">args.lines.effects</code></td>
<td>
<p>a list. Arguments passed to <code><a href="graphics.html#topic+lines">lines</a></code> to 
customize the line displaying the for outliers effects.</p>
</td></tr>
<tr><td><code id="plot.tsoutliers_+3A_args.points">args.points</code></td>
<td>
<p>a list. Arguments passed to <code><a href="graphics.html#topic+lines">lines</a></code> to 
customize the points drawn if <code>plot.points = TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot.tsoutliers_+3A_plot.points">plot.points</code></td>
<td>
<p>a logical indicating whether the time points of the outliers should 
be drawn as points over the original series.</p>
</td></tr>
<tr><td><code id="plot.tsoutliers_+3A_args.x.axis">args.x.axis</code></td>
<td>
<p>a list. Arguments to be passed to <code><a href="graphics.html#topic+axis">axis</a></code> to customize
the x-axis (time).</p>
</td></tr>
<tr><td><code id="plot.tsoutliers_+3A_args.y.axis">args.y.axis</code></td>
<td>
<p>a list. Arguments to be passed to <code><a href="graphics.html#topic+axis">axis</a></code> to customize 
the y-axis for the original series.</p>
</td></tr>
<tr><td><code id="plot.tsoutliers_+3A_args.effects.axis">args.effects.axis</code></td>
<td>
<p>a list. Arguments to be passed to <code><a href="graphics.html#topic+axis">axis</a></code> to customize 
the y-axis for the outliers effects.</p>
</td></tr>
<tr><td><code id="plot.tsoutliers_+3A_...">...</code></td>
<td>
<p>further arguments to be passed to <code><a href="graphics.html#topic+par">par</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Instead of using the ellipsis, <code>...</code>, arguments passed to other functions are 
defined by means of a list. This approach is taken because there may be a single 
argument name to be used in different parts of the plot with a different value.
For example, the argument <code>col</code> can be defined in <code>args.lines.y</code> to indicate 
the color of the original series, e.g. <code>col = "gray80"</code>; at the same time 
the color for the adjusted series can be defined in the list argument <code>args.lines.yadj</code>.
</p>
<p>For further customizations, the source code of the function can be modified relatively 
easy. Alternatively, a similar plot can be displayed simply as:
<code>plot(cbind(x$y, x$yadj, x$effects), plot.type = "multiple")</code>. 
In this way, the plot can be fully customized by setting the desired arguments to 
to <code>plot</code> or to ancillary functions that can be called afterwards.
</p>


<h3>Value</h3>

<p>None.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+tso">tso</a></code>.
</p>

<hr>
<h2 id='print.tsoutliers'>Print <code>tsoutliers</code> object</h2><span id='topic+print.tsoutliers'></span>

<h3>Description</h3>

<p>This function prints the output from function <code><a href="#topic+tso">tso</a></code>. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'tsoutliers'
print(x, digits = max(3L, getOption("digits") - 3L), call = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.tsoutliers_+3A_x">x</code></td>
<td>
<p>a list of class <code>tsoutliers</code> as returned by <code><a href="#topic+tso">tso</a></code>.</p>
</td></tr>
<tr><td><code id="print.tsoutliers_+3A_digits">digits</code></td>
<td>
<p>integer, the number of significant digits to be used.</p>
</td></tr>
<tr><td><code id="print.tsoutliers_+3A_call">call</code></td>
<td>
<p>logical, if <code>TRUE</code> the <code>call</code> to the fitting method is printed.</p>
</td></tr>
<tr><td><code id="print.tsoutliers_+3A_...">...</code></td>
<td>
<p>further arguments, currently ignored.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When <code><a href="stats.html#topic+arima">arima</a></code> is run from <code><a href="base.html#topic+do.call">do.call</a></code>, the latter 
generates a large object for the <code>call</code> which includes the entire structure 
of the data. This often implies a long output which may not be desired. 
Setting <code>call=FALSE</code> avoids printint the <code>call</code>.
</p>


<h3>Value</h3>

<p>None.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+tso">tso</a></code>.
</p>

<hr>
<h2 id='remove.outliers-deprecated'>Stage II of the Procedure: Discard Outliers</h2><span id='topic+remove.outliers'></span>

<h3>Description</h3>

<p>As of version 0.6-6, <code>remove.outliers</code> has been renamed as <code>discard.outliers</code>.
<code><a href="#topic+discard.outliers">discard.outliers</a></code> should be used.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>remove.outliers(x, y, cval = NULL, 
  method = c("en-masse", "bottom-up"), 
  delta = 0.7, tsmethod.call = NULL, 
  fdiff = NULL, logfile = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="remove.outliers-deprecated_+3A_x">x</code></td>
<td>
<p>a list. The output returned by <code><a href="#topic+locate.outliers.oloop">locate.outliers.oloop</a></code>.</p>
</td></tr>
<tr><td><code id="remove.outliers-deprecated_+3A_y">y</code></td>
<td>
<p>a time series.</p>
</td></tr>
<tr><td><code id="remove.outliers-deprecated_+3A_cval">cval</code></td>
<td>
<p>a numeric. The critical value to determine the significance of each type of outlier.</p>
</td></tr>
<tr><td><code id="remove.outliers-deprecated_+3A_method">method</code></td>
<td>
<p>a character. The method to discard/remove outliers. See details.</p>
</td></tr>
<tr><td><code id="remove.outliers-deprecated_+3A_delta">delta</code></td>
<td>
<p>a numeric. Parameter of the temporary change type of outlier.</p>
</td></tr>
<tr><td><code id="remove.outliers-deprecated_+3A_tsmethod.call">tsmethod.call</code></td>
<td>
<p>an optional <code>call</code> object. The call to the function used to fit the time 
series model.</p>
</td></tr>
<tr><td><code id="remove.outliers-deprecated_+3A_fdiff">fdiff</code></td>
<td>
<p>currently ignored.</p>
</td></tr>
<tr><td><code id="remove.outliers-deprecated_+3A_logfile">logfile</code></td>
<td>
<p>a character or <code>NULL</code>. It is the path to the file where 
tracking information is printed. Ignored if <code>NULL</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+discard.outliers">discard.outliers</a></code>.
</p>

<hr>
<h2 id='tso'>Automatic Procedure for Detection of Outliers</h2><span id='topic+tso'></span><span id='topic+tso0'></span>

<h3>Description</h3>

<p>These functions are the interface to the automatic detection 
procedure provided in this package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tso(y, xreg = NULL, cval = NULL, delta = 0.7, 
  types = c("AO", "LS", "TC"), 
  maxit = 1, maxit.iloop = 4, maxit.oloop = 4, cval.reduce = 0.14286, 
  discard.method = c("en-masse", "bottom-up"), discard.cval = NULL, 
  remove.method, remove.cval,
  tsmethod = c("auto.arima", "arima"), 
  args.tsmethod = NULL, logfile = NULL, check.rank = FALSE)

tso0(x, xreg = NULL, cval = 3.5, delta = 0.7, 
  types = c("AO", "LS", "TC"), maxit.iloop = 4, maxit.oloop = 4,
  discard.method = c("en-masse", "bottom-up"), discard.cval = NULL,   
  tsmethod = c("auto.arima", "arima"), args.tsmethod = NULL, 
  logfile = NULL, check.rank = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tso_+3A_y">y</code></td>
<td>
<p>a time series where outliers are to be detected.</p>
</td></tr>
<tr><td><code id="tso_+3A_x">x</code></td>
<td>
<p>a time series object.</p>
</td></tr>
<tr><td><code id="tso_+3A_xreg">xreg</code></td>
<td>
<p>an optional matrix of regressors with the same number of rows as <code>y</code>.</p>
</td></tr>
<tr><td><code id="tso_+3A_cval">cval</code></td>
<td>
<p>a numeric. The critical value to determine the significance of each type of outlier.</p>
</td></tr>
<tr><td><code id="tso_+3A_delta">delta</code></td>
<td>
<p>a numeric. Parameter of the temporary change type of outlier.</p>
</td></tr>
<tr><td><code id="tso_+3A_types">types</code></td>
<td>
<p>a character vector indicating the type of outlier to be considered by the 
detection procedure: innovational outliers (<code>"IO"</code>), additive outliers (<code>"AO"</code>), 
level shifts (<code>"LS"</code>), temporary changes (<code>"TC"</code>) 
and seasonal level shifts (<code>"SLS"</code>).</p>
</td></tr>
<tr><td><code id="tso_+3A_maxit">maxit</code></td>
<td>
<p>a numeric. The maximum number of iterations.</p>
</td></tr>
<tr><td><code id="tso_+3A_maxit.iloop">maxit.iloop</code></td>
<td>
<p>a numeric. The maximum number of iterations in the inner loop. 
See <code><a href="#topic+locate.outliers">locate.outliers</a></code>.</p>
</td></tr>
<tr><td><code id="tso_+3A_maxit.oloop">maxit.oloop</code></td>
<td>
<p>a numeric. The maximum number of iterations in the outer loop.</p>
</td></tr>
<tr><td><code id="tso_+3A_cval.reduce">cval.reduce</code></td>
<td>
<p>a numeric. Factor by which <code>cval</code> is reduced 
if the procedure is run on the adjusted series, if <code>maxit &gt; 1</code>.</p>
</td></tr>
<tr><td><code id="tso_+3A_discard.method">discard.method</code></td>
<td>
<p>a character. The method used in the second stage of the procedure. 
See <code><a href="#topic+discard.outliers">discard.outliers</a></code>.</p>
</td></tr>
<tr><td><code id="tso_+3A_discard.cval">discard.cval</code></td>
<td>
<p>a numeric. The critical value to determine the significance of each 
type of outlier in the second stage of the procedure (discard outliers). By default it is 
set equal to <code>cval</code>. See details.</p>
</td></tr>
<tr><td><code id="tso_+3A_remove.method">remove.method</code></td>
<td>
<p>deprecated, argument <code>discard.method</code> should be used.</p>
</td></tr>
<tr><td><code id="tso_+3A_remove.cval">remove.cval</code></td>
<td>
<p>deprecated, argument <code>discard.cval</code> should be used.</p>
</td></tr>
<tr><td><code id="tso_+3A_tsmethod">tsmethod</code></td>
<td>
<p>a character. The framework for time series modelling. It basically is the name 
of the function to which the arguments defined in <code>args.tsmethod</code> are referred to.</p>
</td></tr>
<tr><td><code id="tso_+3A_args.tsmethod">args.tsmethod</code></td>
<td>
<p>an optional list containing arguments to be passed to 
the function invoking the method selected in <code>tsmethod</code>.</p>
</td></tr>


<tr><td><code id="tso_+3A_logfile">logfile</code></td>
<td>
<p>a character or <code>NULL</code>. It is the path to the file where 
tracking information is printed. Ignored if <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="tso_+3A_check.rank">check.rank</code></td>
<td>
<p>logical. If <code>TRUE</code> the regressors are checked for perfect collinearity.
The variables related to coefficients that turn out to be <code>NA</code> due to possible 
perfect collinearity are discarded.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Five types of outliers can be considered. 
By default: <code>"AO"</code> additive outliers, <code>"LS"</code> level shifts,
and <code>"TC"</code> temporary changes are selected;
<code>"IO"</code> innovative outliers and <code>"SLS"</code> seasonal level shifts 
can also be selected.
</p>
<p><code>tso0</code> is mostly a wrapper function around the functions 
<code><a href="#topic+locate.outliers">locate.outliers</a></code> and <code><a href="#topic+discard.outliers">discard.outliers</a></code>.
</p>
<p><code>tso</code> iterates around <code>tso0</code> first for the original series 
and then for the adjusted series. The process stops if no additional outliers 
are found in the current iteration or if <code>maxit</code> iterations are reached.
</p>
<p><code>tso0</code> is an auxiliar function (it is the workhorse for <code>tso</code> 
but it is not intended to be called directly by the user,
use <code>tso(maxit = 1, ...)</code> instead.
<code>tso0</code> does not check the arguments since they are assumed to be passed 
already checked by <code>tso</code>; the default value for <code>cval</code> is not based 
on the sample size.
For the time being, <code>tso0</code> is exported in the NAMESPACE since it 
is convenient for debugging.
</p>
<p>If no value is specified for argument <code>cval</code> a default value based on the sample size 
is used. Let <code class="reqn">n</code> be the number of observations. If <code class="reqn">n \le 50</code> then <code>cval</code> is set 
equal to <code class="reqn">3.0</code>; If <code class="reqn">n \ge 450</code> then <code>cval</code> is set equal to <code class="reqn">4.0</code>;
otherwise <code>cval</code> is set equal to <code class="reqn">3 + 0.0025 * (n - 50)</code>.
</p>
<p>If <code>tsmethod</code> is <code>NULL</code>, the following default arguments are used in the 
function selected in <code>tsmethod</code>:
<code>tsmethod = "auto.arima"</code>: <code>allowdrift = FALSE</code>, <code>ic = "bic"</code>;
<code>tsmethod = "arima"</code> = <code>order = c(0, 1, 1)</code> <code>seasonal = list(order = c(0, 1, 1))</code>.
</p>
<p>If <code>args.tsmethod</code> is <code>NULL</code>, the following lists are used by default,
respectively for each method:
<code>auto.arima</code>: <code>list(allowdrift = FALSE, ic = "bic")</code>;
<code>arima</code>: <code>list(order = c(0, 1, 1), seasonal = list(order = c(0, 1, 1)))</code>.
</p>
<p><code>xreg</code> must be a matrix with time series attributes, <code><a href="stats.html#topic+tsp">tsp</a></code>, 
that must be the same same as <code>tsp(x)</code>. Column names are also compulsory.
If there is only one regressor it may still have non-null dimension, i.e. 
it must be a one-column matrix.
</p>
<p>The external regressors (if any) should be defined in the argument <code>xreg</code>.
However, they may be also defined as an element in <code>args.tsmethod</code> since this list 
is passed to function that fits the model. The function <code>tso</code> 
deals with this possibility and returns a warning if <code>"xreg"</code> is defined 
twice with different values. No checks are done in <code>tso0</code>.
</p>
<p>If <code>maxit = 1</code> the procedure is run only once on the original series.
If <code>maxit &gt; 1</code> the procedure is run iteratively, first for the original series 
and then for the adjusted series. The critical value used for the adjusted series 
may be reduced by the factor <code>cval.reduce</code>, equal to <code class="reqn">0.14286</code> by default.
The new critical value is defined as <code class="reqn">cval * (1 - cval.reduce)</code>.
</p>
<p>By default, the same critical value is used in the first stage of the procedure 
(location of outliers) and in the second stage (discard outliers). 
Under the framework of structural time series models I noticed that 
the default critical value based on the sample size is too high, since all the 
potential outliers located in the first stage were discarded in the second stage 
(even in simulated series with known location of outliers). 
In order to investigate this issue, the argument <code>discard.cval</code> has been added. 
In this way a different critical value can be used in the second stage. 
Alternatively, the argument <code>discard.cval</code> could be omitted and simply choose 
a lower critical value, <code>cval</code>, to be used in both stages.
However, using the argument <code>discard.cval</code> is more convenient since it avoids 
locating too many outliers in the first stage.



<code>discard.cval</code> is not affected by <code>cval.reduce</code>.
</p>


<h3>Value</h3>

<p>A list of class <code>tsoutliers</code>.
</p>


<h3>References</h3>

<p>Chen, C. and Liu, Lon-Mu (1993). 
&lsquo;Joint Estimation of Model Parameters and Outlier Effects in Time Series&rsquo;.
<em>Journal of the American Statistical Association</em>,
<b>88</b>(421), pp. 284-297.
</p>
<p>Gómez, V. and Maravall, A. (1996). 
<em>Programs TRAMO and SEATS. Instructions for the user</em>.
Banco de España, Servicio de Estudios. Working paper number 9628.
<a href="http://www.bde.es/f/webbde/SES/Secciones/Publicaciones/PublicacionesSeriadas/DocumentosTrabajo/96/Fich/dt9628e.pdf">http://www.bde.es/f/webbde/SES/Secciones/Publicaciones/PublicacionesSeriadas/DocumentosTrabajo/96/Fich/dt9628e.pdf</a>
</p>
<p>Gómez, V. and Taguas, D. (1995). 
<em>Detección y Corrección Automática de Outliers con TRAMO: 
Una Aplicación al IPC de Bienes Industriales no Energéticos</em>.
Ministerio de Economía y Hacienda. Document number D-95006.
<a href="https://www.sepg.pap.hacienda.gob.es/sitios/sepg/es-ES/Presupuestos/DocumentacionEstadisticas/Documentacion/Documents/DOCUMENTOS%20DE%20TRABAJO/D95006.pdf">https://www.sepg.pap.hacienda.gob.es/sitios/sepg/es-ES/Presupuestos/DocumentacionEstadisticas/Documentacion/Documents/DOCUMENTOS%20DE%20TRABAJO/D95006.pdf</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+locate.outliers">locate.outliers</a></code>, <code><a href="#topic+discard.outliers">discard.outliers</a></code>, 
<code><a href="#topic+plot.tsoutliers">plot.tsoutliers</a></code>, <code><a href="#topic+print.tsoutliers">print.tsoutliers</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data("hicp")
tso(y = log(hicp[[1]]))

## End(Not run)
</code></pre>

<hr>
<h2 id='tsoutliers-package'>Automatic Detection of Outliers in Time Series</h2><span id='topic+_PACKAGE'></span>

<h3>Description</h3>

<p>This package implements a procedure based on the approach described in 
Chen and Liu (1993) for automatic detection of outliers in time series. 
Innovational outliers, additive outliers, level shifts, temporary changes 
and seasonal level shifts are considered.
</p>


<h3>Details</h3>

<p>Time series data often undergo sudden changes that alter
the dynamics of the data transitory or permanently.
These changes are typically non systematic and cannot be captured by 
standard time series models. 
That's why they are known as exogenous or outlier effects. 
Detecting outliers is important because they have an impact on 
the selection of the model, the estimation of parameters and, 
consequently, on forecasts.
</p>
<p>Following the approach described in Chen &amp; Liu (1993), 
an automatic procedure for detection of outliers in time series 
is implemented in the package <span class="pkg">tsoutliers</span>.
The procedure may in turn be run along with the automatic ARIMA model 
selection strategy available in the package <span class="pkg">forecast</span>.
</p>
<p>The function <code><a href="#topic+tso">tso</a></code> is the main interface for the 
automatic procedure. The functions <code><a href="#topic+locate.outliers.oloop">locate.outliers.oloop</a></code>
and <code><a href="#topic+remove.outliers">remove.outliers</a></code> implement respectively the first and 
second stages of the procedure. In practice, the user may stick to use 
the function <code><a href="#topic+tso">tso</a></code>. 
</p>
<p>Although the purpose of the package is to provide an automatic procedure, 
the implementation allows the user to do a manual inspection of each 
step of the procedure. Thus, the package is also useful to track the behaviour
of the procedure and come up with ideas for possible improvements or 
enhancements.
</p>


<p>The functions <code><a href="#topic+locate.outliers.oloop">locate.outliers.oloop</a></code> and <code><a href="#topic+remove.outliers">remove.outliers</a></code> 
implement the major steps of the procedure.
<code><a href="#topic+tso">tso</a></code> is the main interface to the automatic procedure. 
All the options at any stage of the procedure can be defined through the 
arguments passed to <code><a href="#topic+tso">tso</a></code>.
Despite the user may stick to use the function <code><a href="#topic+tso">tso</a></code>,
other functions called by this main interface are exported in the namespace of 
the package. They are helpful for debugging and allow the interested user to more 
easily track each step of the procedure.
</p>
<p>Information supplemental to these help pages is given in the document that is 
provided with the package (&lsquo;<span class="file">tsoutliers/inst/doc/tsoutliers.pdf</span>&rsquo; in the source files).
</p>


<h3>Author(s)</h3>

<p>Javier López-de-Lacalle <a href="mailto:javlacalle@yahoo.es">javlacalle@yahoo.es</a>
</p>


<h3>References</h3>

<p>Chen, C. and Liu, Lon-Mu (1993). 
&lsquo;Joint Estimation of Model Parameters and Outlier Effects in Time Series&rsquo;.
<em>Journal of the American Statistical Association</em>,
<b>88</b>(421), pp. 284-297.
<a href="https://doi.org/10.2307/2290724">doi:10.2307/2290724</a>
</p>
<p>Gómez, V. and Maravall, A. (1996). 
<em>Programs TRAMO and SEATS. Instructions for the user</em>.
Banco de España, Servicio de Estudios. Working paper number 9628.
<a href="http://www.bde.es/f/webbde/SES/Secciones/Publicaciones/PublicacionesSeriadas/DocumentosTrabajo/96/Fich/dt9628e.pdf">http://www.bde.es/f/webbde/SES/Secciones/Publicaciones/PublicacionesSeriadas/DocumentosTrabajo/96/Fich/dt9628e.pdf</a>
</p>
<p>Gómez, V. and Taguas, D. (1995). 
<em>Detección y Corrección Automática de Outliers con TRAMO: 
Una Aplicación al IPC de Bienes Industriales no Energéticos</em>.
Ministerio de Economía y Hacienda. Document number D-95006.
<a href="https://www.sepg.pap.hacienda.gob.es/sitios/sepg/es-ES/Presupuestos/DocumentacionEstadisticas/Documentacion/Documents/DOCUMENTOS%20DE%20TRABAJO/D95006.pdf">https://www.sepg.pap.hacienda.gob.es/sitios/sepg/es-ES/Presupuestos/DocumentacionEstadisticas/Documentacion/Documents/DOCUMENTOS%20DE%20TRABAJO/D95006.pdf</a>
</p>
<p>Hyndman, R.J. and Khandakar, Y. (2008). 
&lsquo;Automatic Time Series Forecasting: The <span class="pkg">forecast</span> Package for <span class="rlang"><b>R</b></span>&rsquo;.
<em>Journal of Statistical Software</em>, <b>27</b>(3), pp. 1-22.
<a href="https://www.jstatsoft.org/v27/i03">https://www.jstatsoft.org/v27/i03</a>
</p>
<p>Hyndman, R.J. with contributions from 
George Athanasopoulos, Slava Razbash, Drew Schmidt, Zhenyu Zhou, Yousaf Khan, 
Christoph Bergmeir and Earo Wang (2014). 
&lsquo;<span class="pkg">forecast</span>: Forecasting functions for time series and linear models&rsquo;.
<span class="rlang"><b>R</b></span> package version 5.4. 
<a href="https://CRAN.R-project.org/package=forecast">https://CRAN.R-project.org/package=forecast</a>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
