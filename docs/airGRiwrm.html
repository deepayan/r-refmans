<!DOCTYPE html><html><head><title>Help for package airGRiwrm</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {airGRiwrm}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#Calibration.GRiwrmInputsModel'><p>Calibration of the parameters of one catchment or a network of sub-catchments</p></a></li>
<li><a href='#ConvertMeteoSD'><p>Conversion of meteorological data from basin scale to sub-basin scale</p></a></li>
<li><a href='#CreateCalibOptions.GRiwrmInputsModel'><p>Creation of the CalibOptions object</p></a></li>
<li><a href='#CreateController'><p>Creation and adding of a controller in a supervisor</p></a></li>
<li><a href='#CreateGRiwrm'><p>Generation of a network description containing all hydraulic nodes and the description</p>
of their connections</a></li>
<li><a href='#CreateInputsCrit.GRiwrmInputsModel'><p>Creation of the InputsCrit object required to the <code>ErrorCrit</code> functions</p></a></li>
<li><a href='#CreateInputsModel'><p>Generic function for creating <code>InputsModel</code> object for either <strong>airGR</strong> or <strong>airGRiwrm</strong></p></a></li>
<li><a href='#CreateInputsModel.GRiwrm'><p>Creation of an InputsModel object for a <strong>airGRiwrm</strong> network</p></a></li>
<li><a href='#CreateRunOptions.GRiwrmInputsModel'><p>Creation of the RunOptions object</p></a></li>
<li><a href='#CreateSupervisor'><p>Creation of a Supervisor for handling regulation in a model</p></a></li>
<li><a href='#getNoSD_Ids'><p>Function to obtain the ID of sub-basins not using SD model</p></a></li>
<li><a href='#getSD_Ids'><p>Function to obtain the ID of sub-basins using SD model</p></a></li>
<li><a href='#isNodeDownstream'><p>Check if a node is downstream another one</p></a></li>
<li><a href='#plot.GRiwrm'><p>Display of a diagram representing the network structure of a GRiwrm object</p></a></li>
<li><a href='#plot.GRiwrmOutputsModel'><p>Function which creates screen plots giving an overview of the model outputs in the GRiwrm network</p></a></li>
<li><a href='#plot.Qm3s'><p>Plot of a <code>Qm3s</code> object (time series of simulated flows)</p></a></li>
<li><a href='#RunModel'><p>RunModel function for both <strong>airGR</strong> InputsModel and GRiwrmInputsModel object</p></a></li>
<li><a href='#RunModel.GR'><p>Run of a rainfall-runoff model on a sub-basin</p></a></li>
<li><a href='#RunModel.GRiwrmInputsModel'><p>RunModel function for <em>GRiwrmInputsModel</em> object</p></a></li>
<li><a href='#RunModel.InputsModel'><p>Wrapper for airGR::RunModel for one sub-basin</p></a></li>
<li><a href='#RunModel.SD'><p>Run a semi-distributed model from rainfall-runoff model outputs</p></a></li>
<li><a href='#RunModel.Supervisor'><p>RunModel function for a GRiwrmInputsModel object</p></a></li>
<li><a href='#Severn'><p>Catchment attributes and hydro-meteorological timeseries for some gauging stations on the Severn River</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>'airGR' Integrated Water Resource Management</td>
</tr>
<tr>
<td>Version:</td>
<td>0.6.2</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-10-24</td>
</tr>
<tr>
<td>Description:</td>
<td>Semi-distributed Precipitation-Runoff Modelling based on
    'airGR' package models integrating human infrastructures and their
    managements.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/AGPL-3">AGPL-3</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://airgriwrm.g-eau.fr/">https://airgriwrm.g-eau.fr/</a>,
<a href="https://github.com/inrae/airGRiwrm#readme">https://github.com/inrae/airGRiwrm#readme</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/inrae/airGRiwrm/issues">https://github.com/inrae/airGRiwrm/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>airGR (&ge; 1.7.0), R (&ge; 2.10)</td>
</tr>
<tr>
<td>Imports:</td>
<td>DiagrammeR, dplyr, graphics, grDevices, utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>htmltools, knitr, rmarkdown, spelling, testthat</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-10-24 15:30:21 UTC; ddorchies</td>
</tr>
<tr>
<td>Author:</td>
<td>David Dorchies <a href="https://orcid.org/0000-0002-6595-7984"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Olivier Delaigue <a href="https://orcid.org/0000-0002-7668-8468"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Guillaume Thirel <a href="https://orcid.org/0000-0002-1444-1830"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>David Dorchies &lt;david.dorchies@inrae.fr&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-10-24 16:00:10 UTC</td>
</tr>
</table>
<hr>
<h2 id='Calibration.GRiwrmInputsModel'>Calibration of the parameters of one catchment or a network of sub-catchments</h2><span id='topic+Calibration.GRiwrmInputsModel'></span><span id='topic+Calibration.InputsModel'></span><span id='topic+Calibration'></span>

<h3>Description</h3>

<p>Calibration algorithm that optimizes the error criterion selected as objective function using the provided functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'GRiwrmInputsModel'
Calibration(
  InputsModel,
  RunOptions,
  InputsCrit,
  CalibOptions,
  useUpstreamQsim = TRUE,
  ...
)

## S3 method for class 'InputsModel'
Calibration(InputsModel, ...)

Calibration(InputsModel, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Calibration.GRiwrmInputsModel_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em> or <em>GRiwrmInputsModel</em>] see <a href="#topic+CreateInputsModel">CreateInputsModel</a></p>
</td></tr>
<tr><td><code id="Calibration.GRiwrmInputsModel_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em> or <em>GRiwrmRunOptions</em>] see <a href="#topic+CreateRunOptions">CreateRunOptions</a></p>
</td></tr>
<tr><td><code id="Calibration.GRiwrmInputsModel_+3A_inputscrit">InputsCrit</code></td>
<td>
<p>[object of class <em>InputsCrit</em> or <em>GRiwrmInputsCrit</em>] see <a href="#topic+CreateInputsCrit">CreateInputsCrit</a></p>
</td></tr>
<tr><td><code id="Calibration.GRiwrmInputsModel_+3A_caliboptions">CalibOptions</code></td>
<td>
<p>[object of class <em>CalibOptions</em> or <em>GRiwrmCalibOptions</em>] see <a href="#topic+CreateCalibOptions">CreateCalibOptions</a> for details</p>
</td></tr>
<tr><td><code id="Calibration.GRiwrmInputsModel_+3A_useupstreamqsim">useUpstreamQsim</code></td>
<td>
<p>boolean describing if simulated (<code>TRUE</code>) or observed (<code>FALSE</code>) flows are used for calibration. Default is <code>TRUE</code></p>
</td></tr>
<tr><td><code id="Calibration.GRiwrmInputsModel_+3A_...">...</code></td>
<td>
<p>further arguments passed to <a href="airGR.html#topic+Calibration">airGR::Calibration</a>, see details</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function can be used either for a catchment (with an <em>InputsModel</em> object) or for a network (with a <em>GRiwrmInputsModel</em> object)
</p>
<p>Argument classes should be consistent to the usage:
</p>

<ul>
<li><p> a <code>InputsModel</code> argument of class <em>InputsModel</em> must be followed by a <code>RunOptions</code> argument of class <em>RunOptions</em>, a <code>InputsCrit</code> argument of class <em>InputsCrit</em> and a <code>CalibOptions</code> of class <em>CalibOptions</em>
</p>
</li>
<li> 

<ul>
<li><p> a <code>InputsModel</code> argument of class <em>GRiwrmInputsModel</em> must be followed by a <code>RunOptions</code> argument of class <em>GRiwrmRunOptions</em>, a <code>InputsCrit</code> argument of class <em>GRiwrmInputsCrit</em> and a <code>CalibOptions</code> of class <em>GRiwrmCalibOptions</em>
</p>
</li></ul>

</li></ul>

<p>See the vignettes for examples.
</p>


<h3>Value</h3>

<p>Depending on the class of <code>InputsModel</code> argument (respectively <code>InputsModel</code> and <code>GRiwrmInputsModel</code> object), the returned value is respectively:
</p>

<ul>
<li><p> a <code>InputsCrit</code> object (See <a href="airGR.html#topic+CreateInputsCrit">airGR::CreateInputsCrit</a>)
</p>
</li>
<li><p> a <code>GRiwrmInputsCrit</code> object which is a <a href="base.html#topic+list">list</a> of <code>InputsCrit</code> objects with one item per modeled sub-catchment
</p>
</li></ul>


<hr>
<h2 id='ConvertMeteoSD'>Conversion of meteorological data from basin scale to sub-basin scale</h2><span id='topic+ConvertMeteoSD'></span><span id='topic+ConvertMeteoSD.GRiwrm'></span><span id='topic+ConvertMeteoSD.character'></span><span id='topic+ConvertMeteoSD.matrix'></span>

<h3>Description</h3>

<p>Conversion of meteorological data from basin scale to sub-basin scale
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ConvertMeteoSD(x, ...)

## S3 method for class 'GRiwrm'
ConvertMeteoSD(x, meteo, ...)

## S3 method for class 'character'
ConvertMeteoSD(x, griwrm, meteo, ...)

## S3 method for class 'matrix'
ConvertMeteoSD(x, areas, temperature = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ConvertMeteoSD_+3A_x">x</code></td>
<td>
<p>either a <code>GRiwrm</code> network description (See <a href="#topic+CreateGRiwrm">CreateGRiwrm</a>), a <a href="base.html#topic+character">character</a> id of a node, or a <a href="base.html#topic+matrix">matrix</a> containing meteorological data</p>
</td></tr>
<tr><td><code id="ConvertMeteoSD_+3A_...">...</code></td>
<td>
<p>Parameters passed to the methods</p>
</td></tr>
<tr><td><code id="ConvertMeteoSD_+3A_meteo">meteo</code></td>
<td>
<p><a href="base.html#topic+matrix">matrix</a> or <a href="base.html#topic+data.frame">data.frame</a> containing meteorological data. Its <a href="base.html#topic+colnames">colnames</a> should be equal to the ID of the basins</p>
</td></tr>
<tr><td><code id="ConvertMeteoSD_+3A_griwrm">griwrm</code></td>
<td>
<p><code>GRiwrm</code> object describing the semi-distributed network (See <a href="#topic+CreateGRiwrm">CreateGRiwrm</a>)</p>
</td></tr>
<tr><td><code id="ConvertMeteoSD_+3A_areas">areas</code></td>
<td>
<p><a href="base.html#topic+numeric">numeric</a> vector with the total area of the basin followed by the areas of the upstream basins in km2</p>
</td></tr>
<tr><td><code id="ConvertMeteoSD_+3A_temperature">temperature</code></td>
<td>
<p><a href="base.html#topic+logical">logical</a> <code>TRUE</code> if the meteorological data contain air temperature. If <code>FALSE</code> minimum output values are bounded to zero</p>
</td></tr>
</table>


<h3>Value</h3>

<p><a href="base.html#topic+matrix">matrix</a> a matrix containing the converted meteorological data
</p>

<hr>
<h2 id='CreateCalibOptions.GRiwrmInputsModel'>Creation of the CalibOptions object</h2><span id='topic+CreateCalibOptions.GRiwrmInputsModel'></span><span id='topic+CreateCalibOptions'></span><span id='topic+CreateCalibOptions.InputsModel'></span><span id='topic+CreateCalibOptions.character'></span><span id='topic+CreateCalibOptions.function'></span>

<h3>Description</h3>

<p>This function can be used either for a catchment (with an <em>InputsModel</em> object) or for a network (with a <em>GRiwrmInputsModel</em> object)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'GRiwrmInputsModel'
CreateCalibOptions(x, ...)

CreateCalibOptions(x, ...)

## S3 method for class 'InputsModel'
CreateCalibOptions(x, ...)

## S3 method for class 'character'
CreateCalibOptions(x, ...)

## S3 method for class ''function''
CreateCalibOptions(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CreateCalibOptions.GRiwrmInputsModel_+3A_x">x</code></td>
<td>
<p>For a single catchment, it can be an object of class <em>InputsModel</em> or a <a href="base.html#topic+function">function</a> or a <a href="base.html#topic+character">character</a> corresponding to <code>FUN_MOD</code> (compliant with <strong>airGR</strong> call). For a network, it should be an object of class <em>GRiwrmInputsModel</em>. See <a href="#topic+CreateInputsModel">CreateInputsModel</a> for details</p>
</td></tr>
<tr><td><code id="CreateCalibOptions.GRiwrmInputsModel_+3A_...">...</code></td>
<td>
<p>arguments passed to <a href="airGR.html#topic+CreateCalibOptions">airGR::CreateCalibOptions</a>, see details</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <a href="airGR.html#topic+CreateCalibOptions">airGR::CreateCalibOptions</a> documentation for a complete list of arguments.
</p>
<p>With a <em>GRiwrmInputsModel</em> object, all arguments are applied on each sub-catchments of the network.
</p>


<h3>Value</h3>

<p>Depending on the class of <code>InputsModel</code> argument (respectively <code>InputsModel</code> and <code>GRiwrmInputsModel</code> object), the returned value is respectively:
</p>

<ul>
<li><p> a <code>CalibOptions</code> object (See <a href="airGR.html#topic+CreateCalibOptions">airGR::CreateCalibOptions</a>)
</p>
</li>
<li><p> a <code>GRiwrmCalibOptions</code> object which is a <a href="base.html#topic+list">list</a> of <code>CalibOptions</code> object with one item per modeled sub-catchment
</p>
</li></ul>


<hr>
<h2 id='CreateController'>Creation and adding of a controller in a supervisor</h2><span id='topic+CreateController'></span>

<h3>Description</h3>

<p>Creation and adding of a controller in a supervisor
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CreateController(supervisor, ctrl.id, Y, U, FUN)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CreateController_+3A_supervisor">supervisor</code></td>
<td>
<p><code>Supervisor</code> object, see <a href="#topic+CreateSupervisor">CreateSupervisor</a></p>
</td></tr>
<tr><td><code id="CreateController_+3A_ctrl.id">ctrl.id</code></td>
<td>
<p><a href="base.html#topic+character">character</a> id of the controller (see Details)</p>
</td></tr>
<tr><td><code id="CreateController_+3A_y">Y</code></td>
<td>
<p><a href="base.html#topic+character">character</a> location of the controlled and/or measured variables in the model.</p>
</td></tr>
<tr><td><code id="CreateController_+3A_u">U</code></td>
<td>
<p><a href="base.html#topic+character">character</a> location of the command variables in the model.</p>
</td></tr>
<tr><td><code id="CreateController_+3A_fun">FUN</code></td>
<td>
<p><a href="base.html#topic+function">function</a> controller logic which calculates <code>U</code> from <code>Y</code> (see Details)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>ctrl.id</code> is a unique id for finding the controller in the supervisor.
If a controller with the same id already exists, it is overwritten by this new one.
</p>
<p><code>FUN</code> should be a function with one <a href="base.html#topic+numeric">numeric</a> parameter.
This parameter will receive the measured values of at <code>Y</code> locations as input
for the previous time step and returns calculated <code>U</code>. These <code>U</code> will then be applied
at their location for the current time step of calculation of the model.
</p>


<h3>Value</h3>

<p>a <code>Controller</code> object which is a list with the following items:
</p>

<ul>
<li> <p><code>id</code> <a href="base.html#topic+character">character</a>: the controller identifier
</p>
</li>
<li> <p><code>U</code> <a href="base.html#topic+matrix">matrix</a>: the list of controls for command variables with each column being the location of the variables and the rows being
the values of the variable for the current time steps (empty by default)
</p>
</li>
<li> <p><code>Unames</code> <a href="base.html#topic+character">character</a>: location of the command variables
</p>
</li>
<li> <p><code>Y</code> <a href="base.html#topic+matrix">matrix</a>: the lists of controls for controlled variables with each column being the location of the variables and the rows being
the values of the variable for the current time steps (empty by default)
</p>
</li>
<li> <p><code>Ynames</code> <a href="base.html#topic+character">character</a>: location of the controlled variables
</p>
</li>
<li> <p><code>FUN</code> <a href="base.html#topic+function">function</a>: controller logic which calculates <code>U</code> from <code>Y</code>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># First create a Supervisor from a model
data(Severn)
nodes &lt;- Severn$BasinsInfo[, c("gauge_id", "downstream_id", "distance_downstream", "area")]
nodes$model &lt;- "RunModel_GR4J"
griwrm &lt;- CreateGRiwrm(nodes,
                 list(id = "gauge_id",
                      down = "downstream_id",
                      length = "distance_downstream"))
BasinsObs &lt;- Severn$BasinsObs
DatesR &lt;- BasinsObs[[1]]$DatesR
PrecipTot &lt;- cbind(sapply(BasinsObs, function(x) {x$precipitation}))
PotEvapTot &lt;- cbind(sapply(BasinsObs, function(x) {x$peti}))
Qobs &lt;- cbind(sapply(BasinsObs, function(x) {x$discharge_spec}))
Precip &lt;- ConvertMeteoSD(griwrm, PrecipTot)
PotEvap &lt;- ConvertMeteoSD(griwrm, PotEvapTot)
InputsModel &lt;- CreateInputsModel(griwrm, DatesR, Precip, PotEvap, Qobs)
sv &lt;- CreateSupervisor(InputsModel)

# A controller which usually releases 0.1 m3/s and provides
# extra release if the downstream flow is below 0.5 m3/s
logicDamRelease &lt;- function(Y) max(0.5 - Y[1], 0.1)
CreateController(sv, "DamRelease", Y = c("54001"), U = c("54095"), FUN = logicDamRelease)
</code></pre>

<hr>
<h2 id='CreateGRiwrm'>Generation of a network description containing all hydraulic nodes and the description
of their connections</h2><span id='topic+CreateGRiwrm'></span><span id='topic+GRiwrm'></span>

<h3>Description</h3>

<p>Generation of a network description containing all hydraulic nodes and the description
of their connections
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CreateGRiwrm(
  db,
  cols = list(id = "id", down = "down", length = "length", model = "model", area =
    "area"),
  keep_all = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CreateGRiwrm_+3A_db">db</code></td>
<td>
<p><a href="base.html#topic+data.frame">data.frame</a> description of the network (See details)</p>
</td></tr>
<tr><td><code id="CreateGRiwrm_+3A_cols">cols</code></td>
<td>
<p><a href="base.html#topic+list">list</a> or <a href="base.html#topic+vector">vector</a> columns of <code>db</code>. By default, mandatory column names are: <code>id</code>, <code>down</code>, <code>length</code>. Other names can be handled with a named list or vector containing items defined as <code>"required name" = "column name in db"</code></p>
</td></tr>
<tr><td><code id="CreateGRiwrm_+3A_keep_all">keep_all</code></td>
<td>
<p><a href="base.html#topic+logical">logical</a> indicating if all columns of <code>db</code> should be kept or if only columns defined in <code>cols</code> should be kept</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>db</code> is a <a href="base.html#topic+data.frame">data.frame</a> which at least contains in its columns:
</p>

<ul>
<li><p> a node identifier (column <code>id</code>),
</p>
</li>
<li><p> the identifier and the hydraulic distance to the downstream node (<a href="base.html#topic+character">character</a> columns <code>down</code> and <a href="base.html#topic+numeric">numeric</a> columns <code>length</code> in km). The last downstream node should have fields <code>down</code> and <code>length</code> set to <code>NA</code>,
</p>
</li>
<li><p> the area of the basin (<a href="base.html#topic+numeric">numeric</a> column <code>area</code> in km2)
</p>
</li>
<li><p> the hydrological model to use if necessary (<a href="base.html#topic+character">character</a> column <code>model</code>) (<a href="base.html#topic+NA">NA</a> for using observed flow instead of a runoff model output)
</p>
</li></ul>



<h3>Value</h3>

<p><a href="base.html#topic+data.frame">data.frame</a> of class <code>GRiwrm</code> describing the airGR semi-distributed model network, with each line corresponding to a location on the river network and with the following columns:
</p>

<ul>
<li> <p><code>id</code> (<a href="base.html#topic+character">character</a>): node identifier
</p>
</li>
<li> <p><code>down</code> (<a href="base.html#topic+character">character</a>): identifier of the node downstream of the current node (<a href="base.html#topic+NA">NA</a> for the most downstream node)
</p>
</li>
<li> <p><code>length</code> (<a href="base.html#topic+numeric">numeric</a>): hydraulic distance to the downstream node in km (<a href="base.html#topic+NA">NA</a> for the most downstream node)
</p>
</li>
<li> <p><code>area</code> (<a href="base.html#topic+numeric">numeric</a>): total area of the basin starting from the current node location in km2
</p>
</li>
<li> <p><code>model</code> (<a href="base.html#topic+character">character</a>): hydrological model to use if necessary (<a href="base.html#topic+NA">NA</a> for using observed flow instead of a runoff model output)
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>###################################################################
# Run the `airGR::RunModel_Lag` example in the GRiwrm fashion way #
# Simulation of a reservoir with a purpose of low-flow mitigation #
###################################################################

## ---- preparation of the InputsModel object

## loading package and catchment data
library(airGRiwrm)
data(L0123001)

## ---- specifications of the reservoir

## the reservoir withdraws 1 m3/s when it's possible considering the flow observed in the basin
Qupstream &lt;- matrix(-sapply(BasinObs$Qls / 1000 - 1, function(x) {
  min(1, max(0, x, na.rm = TRUE))
}), ncol = 1)

## except between July and September when the reservoir releases 3 m3/s for low-flow mitigation
month &lt;- as.numeric(format(BasinObs$DatesR, "%m"))
Qupstream[month &gt;= 7 &amp; month &lt;= 9] &lt;- 3
Qupstream &lt;- Qupstream * 86400 ## Conversion in m3/day

## the reservoir is not an upstream subcachment: its areas is NA
BasinAreas &lt;- c(NA, BasinInfo$BasinArea)

## delay time between the reservoir and the catchment outlet is 2 days and the distance is 150 km
LengthHydro &lt;- 150
## with a delay of 2 days for 150 km, the flow velocity is 75 km per day
Velocity &lt;- (LengthHydro * 1e3 / 2) / (24 * 60 * 60) ## Conversion km/day -&gt; m/s

# This example is a network of 2 nodes which can be describe like this:
db &lt;- data.frame(id = c("Reservoir", "GaugingDown"),
                 length = c(LengthHydro, NA),
                 down = c("GaugingDown", NA),
                 area = c(NA, BasinInfo$BasinArea),
                 model = c(NA, "RunModel_GR4J"),
                 stringsAsFactors = FALSE)

# Create GRiwrm object from the data.frame
griwrm &lt;- CreateGRiwrm(db)
str(griwrm)

# Formatting observations for the hydrological models
# Each input data should be a matrix or a data.frame with the good id in the name of the column
Precip &lt;- matrix(BasinObs$P, ncol = 1)
colnames(Precip) &lt;- "GaugingDown"
PotEvap &lt;- matrix(BasinObs$E, ncol = 1)
colnames(PotEvap) &lt;- "GaugingDown"

# Observed flows contain flows that are directly injected in the model
Qobs = matrix(Qupstream, ncol = 1)
colnames(Qobs) &lt;- "Reservoir"

# Creation of the GRiwrmInputsModel object (= a named list of InputsModel objects)
InputsModels &lt;- CreateInputsModel(griwrm,
                            DatesR = BasinObs$DatesR,
                            Precip = Precip,
                            PotEvap = PotEvap,
                            Qobs = Qobs)
str(InputsModels)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

# Creation of the GriwmRunOptions object
RunOptions &lt;- CreateRunOptions(InputsModels,
                                IndPeriod_Run = Ind_Run)
str(RunOptions)

# Parameters of the SD models should be encapsulated in a named list
ParamGR4J &lt;- c(X1 = 257.238, X2 = 1.012, X3 = 88.235, X4 = 2.208)
Param &lt;- list(`GaugingDown` = c(Velocity, ParamGR4J))

# RunModel for the whole network
OutputsModels &lt;- RunModel(InputsModels,
                          RunOptions = RunOptions,
                          Param = Param)
str(OutputsModels)

# Compare Simulation with reservoir and observation of natural flow
plot(OutputsModels, data.frame(GaugingDown = BasinObs$Qmm[Ind_Run]))
</code></pre>

<hr>
<h2 id='CreateInputsCrit.GRiwrmInputsModel'>Creation of the InputsCrit object required to the <code>ErrorCrit</code> functions</h2><span id='topic+CreateInputsCrit.GRiwrmInputsModel'></span><span id='topic+CreateInputsCrit.InputsModel'></span><span id='topic+CreateInputsCrit'></span>

<h3>Description</h3>

<p>This function can be used either for a catchment (with an <em>InputsModel</em> object) or for a network (with a <em>GRiwrmInputsModel</em> object)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'GRiwrmInputsModel'
CreateInputsCrit(
  InputsModel,
  FUN_CRIT = ErrorCrit_NSE,
  RunOptions,
  Obs,
  AprioriIds = NULL,
  k = 0.15,
  AprCelerity = 1,
  ...
)

## S3 method for class 'InputsModel'
CreateInputsCrit(InputsModel, FUN_CRIT, ...)

CreateInputsCrit(InputsModel, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CreateInputsCrit.GRiwrmInputsModel_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>object of class <em>InputsModel</em> or <em>GRiwrmInputsModel</em>. See <a href="#topic+CreateInputsModel">CreateInputsModel</a></p>
</td></tr>
<tr><td><code id="CreateInputsCrit.GRiwrmInputsModel_+3A_fun_crit">FUN_CRIT</code></td>
<td>
<p>[function (atomic or list)] error criterion function (e.g. <a href="airGR.html#topic+ErrorCrit_RMSE">airGR::ErrorCrit_RMSE</a>, <a href="airGR.html#topic+ErrorCrit_NSE">airGR::ErrorCrit_NSE</a>)</p>
</td></tr>
<tr><td><code id="CreateInputsCrit.GRiwrmInputsModel_+3A_runoptions">RunOptions</code></td>
<td>
<p>object of class <em>RunOptions</em> or <em>GRiwrmRunOptions</em>, see <a href="#topic+CreateRunOptions">CreateRunOptions</a></p>
</td></tr>
<tr><td><code id="CreateInputsCrit.GRiwrmInputsModel_+3A_obs">Obs</code></td>
<td>
<p><a href="base.html#topic+numeric">numeric</a>, <a href="base.html#topic+matrix">matrix</a> or <a href="base.html#topic+data.frame">data.frame</a> series of observed flows, see details</p>
</td></tr>
<tr><td><code id="CreateInputsCrit.GRiwrmInputsModel_+3A_aprioriids">AprioriIds</code></td>
<td>
<p>(optional) named <a href="base.html#topic+list">list</a> or named <a href="base.html#topic+vector">vector</a> of <a href="base.html#topic+character">character</a> used for the parameter regularization (see details)</p>
</td></tr>
<tr><td><code id="CreateInputsCrit.GRiwrmInputsModel_+3A_k">k</code></td>
<td>
<p>(optional) <a href="base.html#topic+numeric">numeric</a> weight coefficient used in the parameter regularization (See <a href="airGR.html#topic+CreateInputsCrit_Lavenne">airGR::CreateInputsCrit_Lavenne</a>)</p>
</td></tr>
<tr><td><code id="CreateInputsCrit.GRiwrmInputsModel_+3A_aprcelerity">AprCelerity</code></td>
<td>
<p>(optional) <a href="base.html#topic+numeric">numeric</a> Default celerity used as a priori parameter for upstream catchments</p>
</td></tr>
<tr><td><code id="CreateInputsCrit.GRiwrmInputsModel_+3A_...">...</code></td>
<td>
<p>arguments passed to <a href="airGR.html#topic+CreateInputsCrit">airGR::CreateInputsCrit</a>, see details</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <a href="airGR.html#topic+CreateInputsCrit">airGR::CreateInputsCrit</a> documentation for a complete list of arguments.
</p>
<p><code>Obs</code> argument is equivalent to the same argument in <a href="airGR.html#topic+CreateInputsCrit">airGR::CreateInputsCrit</a> except that it must be a <a href="base.html#topic+matrix">matrix</a> or a <a href="base.html#topic+data.frame">data.frame</a> if <code>InputsModel</code> is a <em>GRiwrmInputsModel</em> object.
Then, each column of the <a href="base.html#topic+matrix">matrix</a> or <a href="base.html#topic+data.frame">data.frame</a> represents the observations of one of the simulated node with the name of the columns representing the id of each node.
</p>
<p>With a <em>GRiwrmInputsModel</em> object, all arguments are applied on each sub-catchments of the network.
</p>
<p>Parameter regularization consists of defining a priori parameters which are used in a composed criterion based on the formula proposed by Lavenne et al. (2019) (See <a href="airGR.html#topic+CreateInputsCrit_Lavenne">airGR::CreateInputsCrit_Lavenne</a>).
The parameter <code>AprioriIds</code> allows to define which upstream sub-catchment is used for providing a priori parameters. Its format is as follows: <code>AprioriIds &lt;- c("Downstream sub-catchment 1" = "A priori upstream sub-catchment 1", ...)</code> where the quoted strings are the ids of the sub-catchments. See vignettes for more details. The parameter <code>AprCelerity</code> is a default value used as a priori for the parameter 'Celerity' in case of an upstream catchment (without celerity parameter) is used as a priori catchment.
</p>


<h3>Value</h3>

<p>Depending on the class of <code>InputsModel</code> argument (respectively <code>InputsModel</code> and <code>GRiwrmInputsModel</code> object), the returned value is respectively:
</p>

<ul>
<li><p> a <code>InputsCrit</code> object (See <a href="airGR.html#topic+CreateInputsCrit">airGR::CreateInputsCrit</a>)
</p>
</li>
<li><p> a <code>GRiwrmInputsCrit</code> object which is a <a href="base.html#topic+list">list</a> of <code>InputsCrit</code> objects with one item per modeled sub-catchment
</p>
</li></ul>



<h3>References</h3>

<p>De Lavenne, A., Andréassian, V., Thirel, G., Ramos, M.-H., Perrin, C., 2019. A Regularization Approach to Improve the Sequential Calibration of a Semidistributed Hydrological Model. Water Resources Research 55, 8821–8839. <a href="https://doi.org/10.1029/2018WR024266">doi:10.1029/2018WR024266</a>
</p>

<hr>
<h2 id='CreateInputsModel'>Generic function for creating <code>InputsModel</code> object for either <strong>airGR</strong> or <strong>airGRiwrm</strong></h2><span id='topic+CreateInputsModel'></span><span id='topic+CreateInputsModel.default'></span>

<h3>Description</h3>

<p>See the methods <a href="#topic+CreateInputsModel.GRiwrm">CreateInputsModel.GRiwrm</a> for <strong>airGRiwrm</strong> and <a href="airGR.html#topic+CreateInputsModel">airGR::CreateInputsModel</a> for <strong>airGR</strong>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CreateInputsModel(x, ...)

## Default S3 method:
CreateInputsModel(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CreateInputsModel_+3A_x">x</code></td>
<td>
<p>First parameter determining which InputsModel object is created</p>
</td></tr>
<tr><td><code id="CreateInputsModel_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>InputsModel or GRiwrmInputsObject object
</p>

<hr>
<h2 id='CreateInputsModel.GRiwrm'>Creation of an InputsModel object for a <strong>airGRiwrm</strong> network</h2><span id='topic+CreateInputsModel.GRiwrm'></span>

<h3>Description</h3>

<p>Creation of an InputsModel object for a <strong>airGRiwrm</strong> network
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'GRiwrm'
CreateInputsModel(
  x,
  DatesR,
  Precip = NULL,
  PotEvap = NULL,
  Qobs = NULL,
  PrecipScale = TRUE,
  TempMean = NULL,
  TempMin = NULL,
  TempMax = NULL,
  ZInputs = NULL,
  HypsoData = NULL,
  NLayers = 5,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_x">x</code></td>
<td>
<p>[GRiwrm object] diagram of the semi-distributed model (See <a href="#topic+CreateGRiwrm">CreateGRiwrm</a>)</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_datesr">DatesR</code></td>
<td>
<p><a href="base.html#topic+POSIXt">POSIXt</a> vector of dates</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_precip">Precip</code></td>
<td>
<p>(optional) <a href="base.html#topic+matrix">matrix</a> or <a href="base.html#topic+data.frame">data.frame</a> frame of numeric containing precipitation in [mm per time step]. Column names correspond to node IDs</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_potevap">PotEvap</code></td>
<td>
<p>(optional) <a href="base.html#topic+matrix">matrix</a> or <a href="base.html#topic+data.frame">data.frame</a> frame of numeric containing potential evaporation [mm per time step]. Column names correspond to node IDs</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_qobs">Qobs</code></td>
<td>
<p>(optional) <a href="base.html#topic+matrix">matrix</a> or <a href="base.html#topic+data.frame">data.frame</a> frame of numeric containing observed flows in [mm per time step]. Column names correspond to node IDs</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_precipscale">PrecipScale</code></td>
<td>
<p>(optional) named <a href="base.html#topic+vector">vector</a> of <a href="base.html#topic+logical">logical</a> indicating if the mean of the precipitation interpolated on the elevation layers must be kept or not, required to create CemaNeige module inputs, default <code>TRUE</code> (the mean of the precipitation is kept to the original value)</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_tempmean">TempMean</code></td>
<td>
<p>(optional) <a href="base.html#topic+matrix">matrix</a> or <a href="base.html#topic+data.frame">data.frame</a> of time series of mean air temperature [°C], required to create the CemaNeige module inputs</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_tempmin">TempMin</code></td>
<td>
<p>(optional) <a href="base.html#topic+matrix">matrix</a> or <a href="base.html#topic+data.frame">data.frame</a> of time series of minimum air temperature [°C], possibly used to create the CemaNeige module inputs</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_tempmax">TempMax</code></td>
<td>
<p>(optional) <a href="base.html#topic+matrix">matrix</a> or <a href="base.html#topic+data.frame">data.frame</a> of time series of maximum air temperature [°C], possibly used to create the CemaNeige module inputs</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_zinputs">ZInputs</code></td>
<td>
<p>(optional) named <a href="base.html#topic+vector">vector</a> of <a href="base.html#topic+numeric">numeric</a> giving the mean elevation of the Precip and Temp series (before extrapolation) [m], possibly used to create the CemaNeige module input</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_hypsodata">HypsoData</code></td>
<td>
<p>(optional) <a href="base.html#topic+matrix">matrix</a> or <a href="base.html#topic+data.frame">data.frame</a> containing 101 <a href="base.html#topic+numeric">numeric</a> rows: min, q01 to q99 and max of catchment elevation distribution [m], if not defined a single elevation is used for CemaNeige</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_nlayers">NLayers</code></td>
<td>
<p>(optional) named <a href="base.html#topic+vector">vector</a> of <a href="base.html#topic+numeric">numeric</a> integer giving the number of elevation layers requested <a href="base.html#topic+-">-</a>, required to create CemaNeige module inputs, default=5</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_...">...</code></td>
<td>
<p>used for compatibility with S3 methods</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Meteorological data are needed for the nodes of the network that represent a catchment simulated by a rainfall-runoff model. Instead of <a href="airGR.html#topic+CreateInputsModel">airGR::CreateInputsModel</a> that has <a href="base.html#topic+numeric">numeric</a> <a href="base.html#topic+vector">vector</a> as time series inputs, this function uses <a href="base.html#topic+matrix">matrix</a> or <a href="base.html#topic+data.frame">data.frame</a> with the id of the sub-catchment as column names. For single values (<code>ZInputs</code> or <code>NLayers</code>), the function requires named <a href="base.html#topic+vector">vector</a> with the id of the sub-catchment as name item. If an argument is optional, only the column or the named item has to be provided.
</p>
<p>See <a href="airGR.html#topic+CreateInputsModel">airGR::CreateInputsModel</a> documentation for details concerning each input.
</p>


<h3>Value</h3>

<p>A <em>GRiwrmInputsModel</em> object which is a list of <em>InputsModel</em> objects created by <a href="airGR.html#topic+CreateInputsModel">airGR::CreateInputsModel</a> with one item per modeled sub-catchment.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>###################################################################
# Run the `airGR::RunModel_Lag` example in the GRiwrm fashion way #
# Simulation of a reservoir with a purpose of low-flow mitigation #
###################################################################

## ---- preparation of the InputsModel object

## loading package and catchment data
library(airGRiwrm)
data(L0123001)

## ---- specifications of the reservoir

## the reservoir withdraws 1 m3/s when it's possible considering the flow observed in the basin
Qupstream &lt;- matrix(-sapply(BasinObs$Qls / 1000 - 1, function(x) {
  min(1, max(0, x, na.rm = TRUE))
}), ncol = 1)

## except between July and September when the reservoir releases 3 m3/s for low-flow mitigation
month &lt;- as.numeric(format(BasinObs$DatesR, "%m"))
Qupstream[month &gt;= 7 &amp; month &lt;= 9] &lt;- 3
Qupstream &lt;- Qupstream * 86400 ## Conversion in m3/day

## the reservoir is not an upstream subcachment: its areas is NA
BasinAreas &lt;- c(NA, BasinInfo$BasinArea)

## delay time between the reservoir and the catchment outlet is 2 days and the distance is 150 km
LengthHydro &lt;- 150
## with a delay of 2 days for 150 km, the flow velocity is 75 km per day
Velocity &lt;- (LengthHydro * 1e3 / 2) / (24 * 60 * 60) ## Conversion km/day -&gt; m/s

# This example is a network of 2 nodes which can be describe like this:
db &lt;- data.frame(id = c("Reservoir", "GaugingDown"),
                 length = c(LengthHydro, NA),
                 down = c("GaugingDown", NA),
                 area = c(NA, BasinInfo$BasinArea),
                 model = c(NA, "RunModel_GR4J"),
                 stringsAsFactors = FALSE)

# Create GRiwrm object from the data.frame
griwrm &lt;- CreateGRiwrm(db)
str(griwrm)

# Formatting observations for the hydrological models
# Each input data should be a matrix or a data.frame with the good id in the name of the column
Precip &lt;- matrix(BasinObs$P, ncol = 1)
colnames(Precip) &lt;- "GaugingDown"
PotEvap &lt;- matrix(BasinObs$E, ncol = 1)
colnames(PotEvap) &lt;- "GaugingDown"

# Observed flows contain flows that are directly injected in the model
Qobs = matrix(Qupstream, ncol = 1)
colnames(Qobs) &lt;- "Reservoir"

# Creation of the GRiwrmInputsModel object (= a named list of InputsModel objects)
InputsModels &lt;- CreateInputsModel(griwrm,
                            DatesR = BasinObs$DatesR,
                            Precip = Precip,
                            PotEvap = PotEvap,
                            Qobs = Qobs)
str(InputsModels)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

# Creation of the GriwmRunOptions object
RunOptions &lt;- CreateRunOptions(InputsModels,
                                IndPeriod_Run = Ind_Run)
str(RunOptions)

# Parameters of the SD models should be encapsulated in a named list
ParamGR4J &lt;- c(X1 = 257.238, X2 = 1.012, X3 = 88.235, X4 = 2.208)
Param &lt;- list(`GaugingDown` = c(Velocity, ParamGR4J))

# RunModel for the whole network
OutputsModels &lt;- RunModel(InputsModels,
                          RunOptions = RunOptions,
                          Param = Param)
str(OutputsModels)

# Compare Simulation with reservoir and observation of natural flow
plot(OutputsModels, data.frame(GaugingDown = BasinObs$Qmm[Ind_Run]))
</code></pre>

<hr>
<h2 id='CreateRunOptions.GRiwrmInputsModel'>Creation of the RunOptions object</h2><span id='topic+CreateRunOptions.GRiwrmInputsModel'></span><span id='topic+CreateRunOptions'></span><span id='topic+CreateRunOptions.InputsModel'></span><span id='topic+CreateRunOptions.character'></span><span id='topic+CreateRunOptions.function'></span>

<h3>Description</h3>

<p>This function can be used either for a catchment (with an <em>InputsModel</em> object) or for a network (with a <em>GRiwrmInputsModel</em> object)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'GRiwrmInputsModel'
CreateRunOptions(x, IniStates = NULL, ...)

CreateRunOptions(x, ...)

## S3 method for class 'InputsModel'
CreateRunOptions(x, ...)

## S3 method for class 'character'
CreateRunOptions(x, ...)

## S3 method for class ''function''
CreateRunOptions(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CreateRunOptions.GRiwrmInputsModel_+3A_x">x</code></td>
<td>
<p>For a single catchment, it can be an object of class <em>InputsModel</em> or a <a href="base.html#topic+function">function</a> or a <a href="base.html#topic+character">character</a> corresponding to <code>FUN_MOD</code> (compliant with <strong>airGR</strong> call). For a network, it should be an object of class <em>GRiwrmInputsModel</em>. See <a href="#topic+CreateInputsModel">CreateInputsModel</a> for details</p>
</td></tr>
<tr><td><code id="CreateRunOptions.GRiwrmInputsModel_+3A_inistates">IniStates</code></td>
<td>
<p>(optional) <a href="base.html#topic+numeric">numeric</a> object or <a href="base.html#topic+list">list</a> of <a href="base.html#topic+numeric">numeric</a> object of class <em>IniStates</em>, see <a href="airGR.html#topic+CreateIniStates">airGR::CreateIniStates</a> for details</p>
</td></tr>
<tr><td><code id="CreateRunOptions.GRiwrmInputsModel_+3A_...">...</code></td>
<td>
<p>arguments passed to <a href="airGR.html#topic+CreateRunOptions">airGR::CreateRunOptions</a>, see details</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <a href="airGR.html#topic+CreateRunOptions">airGR::CreateRunOptions</a> documentation for a complete list of arguments.
</p>
<p>If <code>InputsModel</code> argument is a <em>GRiwrmInputsModel</em> object, <code>IniStates</code> must be a list of <a href="base.html#topic+numeric">numeric</a> object of class <em>IniStates</em> with one item per modeled sub-catchment.
</p>
<p>With a <em>GRiwrmInputsModel</em> object, all arguments are applied on each sub-catchments of the network.
</p>


<h3>Value</h3>

<p>Depending on the class of <code>InputsModel</code> argument (respectively <em>InputsModel</em> and <em>GRiwrmInputsModel</em> object), the returned value is respectively:
</p>

<ul>
<li><p> a <code>RunOptions</code> object (See <a href="airGR.html#topic+CreateRunOptions">airGR::CreateRunOptions</a>)
</p>
</li>
<li><p> a <code>GRiwrmRunOptions</code> object which is a <a href="base.html#topic+list">list</a> of <code>RunOptions</code> objects with one item per modeled sub-catchment
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>###################################################################
# Run the `airGR::RunModel_Lag` example in the GRiwrm fashion way #
# Simulation of a reservoir with a purpose of low-flow mitigation #
###################################################################

## ---- preparation of the InputsModel object

## loading package and catchment data
library(airGRiwrm)
data(L0123001)

## ---- specifications of the reservoir

## the reservoir withdraws 1 m3/s when it's possible considering the flow observed in the basin
Qupstream &lt;- matrix(-sapply(BasinObs$Qls / 1000 - 1, function(x) {
  min(1, max(0, x, na.rm = TRUE))
}), ncol = 1)

## except between July and September when the reservoir releases 3 m3/s for low-flow mitigation
month &lt;- as.numeric(format(BasinObs$DatesR, "%m"))
Qupstream[month &gt;= 7 &amp; month &lt;= 9] &lt;- 3
Qupstream &lt;- Qupstream * 86400 ## Conversion in m3/day

## the reservoir is not an upstream subcachment: its areas is NA
BasinAreas &lt;- c(NA, BasinInfo$BasinArea)

## delay time between the reservoir and the catchment outlet is 2 days and the distance is 150 km
LengthHydro &lt;- 150
## with a delay of 2 days for 150 km, the flow velocity is 75 km per day
Velocity &lt;- (LengthHydro * 1e3 / 2) / (24 * 60 * 60) ## Conversion km/day -&gt; m/s

# This example is a network of 2 nodes which can be describe like this:
db &lt;- data.frame(id = c("Reservoir", "GaugingDown"),
                 length = c(LengthHydro, NA),
                 down = c("GaugingDown", NA),
                 area = c(NA, BasinInfo$BasinArea),
                 model = c(NA, "RunModel_GR4J"),
                 stringsAsFactors = FALSE)

# Create GRiwrm object from the data.frame
griwrm &lt;- CreateGRiwrm(db)
str(griwrm)

# Formatting observations for the hydrological models
# Each input data should be a matrix or a data.frame with the good id in the name of the column
Precip &lt;- matrix(BasinObs$P, ncol = 1)
colnames(Precip) &lt;- "GaugingDown"
PotEvap &lt;- matrix(BasinObs$E, ncol = 1)
colnames(PotEvap) &lt;- "GaugingDown"

# Observed flows contain flows that are directly injected in the model
Qobs = matrix(Qupstream, ncol = 1)
colnames(Qobs) &lt;- "Reservoir"

# Creation of the GRiwrmInputsModel object (= a named list of InputsModel objects)
InputsModels &lt;- CreateInputsModel(griwrm,
                            DatesR = BasinObs$DatesR,
                            Precip = Precip,
                            PotEvap = PotEvap,
                            Qobs = Qobs)
str(InputsModels)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

# Creation of the GriwmRunOptions object
RunOptions &lt;- CreateRunOptions(InputsModels,
                                IndPeriod_Run = Ind_Run)
str(RunOptions)

# Parameters of the SD models should be encapsulated in a named list
ParamGR4J &lt;- c(X1 = 257.238, X2 = 1.012, X3 = 88.235, X4 = 2.208)
Param &lt;- list(`GaugingDown` = c(Velocity, ParamGR4J))

# RunModel for the whole network
OutputsModels &lt;- RunModel(InputsModels,
                          RunOptions = RunOptions,
                          Param = Param)
str(OutputsModels)

# Compare Simulation with reservoir and observation of natural flow
plot(OutputsModels, data.frame(GaugingDown = BasinObs$Qmm[Ind_Run]))
</code></pre>

<hr>
<h2 id='CreateSupervisor'>Creation of a Supervisor for handling regulation in a model</h2><span id='topic+CreateSupervisor'></span>

<h3>Description</h3>

<p>Creation of a Supervisor for handling regulation in a model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CreateSupervisor(InputsModel, TimeStep = 1L)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CreateSupervisor_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of type <code>GRiwrmInputsModel</code>] inputs of the model</p>
</td></tr>
<tr><td><code id="CreateSupervisor_+3A_timestep">TimeStep</code></td>
<td>
<p><a href="base.html#topic+numeric">numeric</a> number of time steps between each supervision</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>Supervisor</code> object which is an <a href="base.html#topic+environment">environment</a> containing all the necessary variables to run a supervised simulation, such as:
</p>

<ul>
<li> <p><code>DatesR</code> <a href="base.html#topic+POSIXct">POSIXct</a>: vector of date from <code>InputsModel</code>
</p>
</li>
<li> <p><code>InputsModel</code>: a copy of <code>InputsModel</code> provided by <a href="#topic+CreateInputsModel.GRiwrm">CreateInputsModel.GRiwrm</a>
</p>
</li>
<li> <p><code>griwrm</code>: a copy of <code>griwrm</code> provided by <a href="#topic+CreateGRiwrm">CreateGRiwrm</a>
</p>
</li>
<li> <p><code>Controllers</code> <a href="base.html#topic+list">list</a>: list of the controllers used in the supervised simulation (See <a href="#topic+CreateController">CreateController</a>)
</p>
</li>
<li><p> some internal state variables updated during simulation (<code>ts.index</code>, <code>ts.previous</code>, <code>ts.date</code>, <code>ts.index0</code>, <code>controller.id</code>)
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>data(Severn)
nodes &lt;- Severn$BasinsInfo[, c("gauge_id", "downstream_id", "distance_downstream", "area")]
nodes$model &lt;- "RunModel_GR4J"
griwrm &lt;- CreateGRiwrm(nodes,
                 list(id = "gauge_id",
                      down = "downstream_id",
                      length = "distance_downstream"))
BasinsObs &lt;- Severn$BasinsObs
DatesR &lt;- BasinsObs[[1]]$DatesR
PrecipTot &lt;- cbind(sapply(BasinsObs, function(x) {x$precipitation}))
PotEvapTot &lt;- cbind(sapply(BasinsObs, function(x) {x$peti}))
Qobs &lt;- cbind(sapply(BasinsObs, function(x) {x$discharge_spec}))
Precip &lt;- ConvertMeteoSD(griwrm, PrecipTot)
PotEvap &lt;- ConvertMeteoSD(griwrm, PotEvapTot)
InputsModel &lt;- CreateInputsModel(griwrm, DatesR, Precip, PotEvap, Qobs)
sv &lt;- CreateSupervisor(InputsModel)
</code></pre>

<hr>
<h2 id='getNoSD_Ids'>Function to obtain the ID of sub-basins not using SD model</h2><span id='topic+getNoSD_Ids'></span>

<h3>Description</h3>

<p>Function to obtain the ID of sub-basins not using SD model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getNoSD_Ids(InputsModel)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getNoSD_Ids_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[<code>GRiwrmInputsModel</code> object]</p>
</td></tr>
</table>


<h3>Value</h3>

<p><a href="base.html#topic+character">character</a> IDs of the sub-basins not using the SD model
</p>

<hr>
<h2 id='getSD_Ids'>Function to obtain the ID of sub-basins using SD model</h2><span id='topic+getSD_Ids'></span>

<h3>Description</h3>

<p>Function to obtain the ID of sub-basins using SD model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getSD_Ids(InputsModel)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getSD_Ids_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[<code>GRiwrmInputsModel</code> object]</p>
</td></tr>
</table>


<h3>Value</h3>

<p><a href="base.html#topic+character">character</a> IDs of the sub-basins using SD model
</p>

<hr>
<h2 id='isNodeDownstream'>Check if a node is downstream another one</h2><span id='topic+isNodeDownstream'></span>

<h3>Description</h3>

<p>Check if a node is downstream another one
</p>


<h3>Usage</h3>

<pre><code class='language-R'>isNodeDownstream(InputsModel, current_node, down_node)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="isNodeDownstream_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[<code>GRiwrmInputsModel</code> object] see <a href="#topic+CreateInputsModel.GRiwrm">CreateInputsModel.GRiwrm</a> for details</p>
</td></tr>
<tr><td><code id="isNodeDownstream_+3A_current_node">current_node</code></td>
<td>
<p><a href="base.html#topic+character">character</a> with the id of the current node</p>
</td></tr>
<tr><td><code id="isNodeDownstream_+3A_down_node">down_node</code></td>
<td>
<p><a href="base.html#topic+character">character</a> with the id of the node for which we want to know if it is downstream <code>current_node</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p><a href="base.html#topic+logical">logical</a> <code>TRUE</code> if the node with the id <code>down_node</code> is downstream the node with the id <code>current_node</code>
</p>

<hr>
<h2 id='plot.GRiwrm'>Display of a diagram representing the network structure of a GRiwrm object</h2><span id='topic+plot.GRiwrm'></span>

<h3>Description</h3>

<p>Display of a diagram representing the network structure of a GRiwrm object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'GRiwrm'
plot(
  x,
  display = TRUE,
  orientation = "LR",
  width = "100%",
  height = "100%",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.GRiwrm_+3A_x">x</code></td>
<td>
<p>[GRiwrm object] data to display. See <a href="#topic+CreateGRiwrm">CreateGRiwrm</a> for details</p>
</td></tr>
<tr><td><code id="plot.GRiwrm_+3A_display">display</code></td>
<td>
<p><a href="base.html#topic+logical">logical</a> if <code>TRUE</code> displays the diagram with <a href="DiagrammeR.html#topic+mermaid">DiagrammeR::mermaid</a>, returns the mermaid code otherwise</p>
</td></tr>
<tr><td><code id="plot.GRiwrm_+3A_orientation">orientation</code></td>
<td>
<p><a href="base.html#topic+character">character</a> orientation of the graph. Possible values are &quot;LR&quot; (left-right), &quot;RL&quot; (right-left), &quot;TB&quot; (top-bottom), or &quot;BT&quot; (bottom-top). &quot;LR&quot; by default</p>
</td></tr>
<tr><td><code id="plot.GRiwrm_+3A_width">width</code></td>
<td>
<p><a href="base.html#topic+numeric">numeric</a> width of the resulting graphic in pixels (See <a href="DiagrammeR.html#topic+mermaid">DiagrammeR::mermaid</a>)</p>
</td></tr>
<tr><td><code id="plot.GRiwrm_+3A_height">height</code></td>
<td>
<p><a href="base.html#topic+numeric">numeric</a> height of the resulting graphic in pixels (See <a href="DiagrammeR.html#topic+mermaid">DiagrammeR::mermaid</a>)</p>
</td></tr>
<tr><td><code id="plot.GRiwrm_+3A_...">...</code></td>
<td>
<p>Other arguments and parameters you would like to send to JavaScript (See <a href="DiagrammeR.html#topic+mermaid">DiagrammeR::mermaid</a>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function only works inside RStudio because the HTMLwidget produced by DiagrammeR
is not handled on some platforms
</p>


<h3>Value</h3>

<p>Mermaid code of the diagram if display is <code>FALSE</code>, otherwise the function returns the diagram itself.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Display diagram
plot.GRiwrm(griwrm)
# Is the same as
DiagrammeR::mermaid(plot.GRiwrm(griwrm, display = FALSE), width = "100%", height = "100%")

## End(Not run)

</code></pre>

<hr>
<h2 id='plot.GRiwrmOutputsModel'>Function which creates screen plots giving an overview of the model outputs in the GRiwrm network</h2><span id='topic+plot.GRiwrmOutputsModel'></span>

<h3>Description</h3>

<p>Function which creates screen plots giving an overview of the model outputs in the GRiwrm network
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'GRiwrmOutputsModel'
plot(x, Qobs = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.GRiwrmOutputsModel_+3A_x">x</code></td>
<td>
<p>[object of class <em>GRiwrmOutputsModel</em>] see <a href="#topic+RunModel.GRiwrmInputsModel">RunModel.GRiwrmInputsModel</a> for details</p>
</td></tr>
<tr><td><code id="plot.GRiwrmOutputsModel_+3A_qobs">Qobs</code></td>
<td>
<p>(optional) <a href="base.html#topic+matrix">matrix</a> time series of observed flows
(for the same time steps than simulated) (mm/time step) with one column
by hydrological model output named with the node ID (See <a href="#topic+CreateGRiwrm">CreateGRiwrm</a> for details)</p>
</td></tr>
<tr><td><code id="plot.GRiwrmOutputsModel_+3A_...">...</code></td>
<td>
<p>Further arguments for <a href="airGR.html#topic+plot.OutputsModel">airGR::plot.OutputsModel</a> and <a href="graphics.html#topic+plot">plot</a></p>
</td></tr>
</table>


<h3>Value</h3>

<p><a href="base.html#topic+list">list</a> of plots.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>###################################################################
# Run the `airGR::RunModel_Lag` example in the GRiwrm fashion way #
# Simulation of a reservoir with a purpose of low-flow mitigation #
###################################################################

## ---- preparation of the InputsModel object

## loading package and catchment data
library(airGRiwrm)
data(L0123001)

## ---- specifications of the reservoir

## the reservoir withdraws 1 m3/s when it's possible considering the flow observed in the basin
Qupstream &lt;- matrix(-sapply(BasinObs$Qls / 1000 - 1, function(x) {
  min(1, max(0, x, na.rm = TRUE))
}), ncol = 1)

## except between July and September when the reservoir releases 3 m3/s for low-flow mitigation
month &lt;- as.numeric(format(BasinObs$DatesR, "%m"))
Qupstream[month &gt;= 7 &amp; month &lt;= 9] &lt;- 3
Qupstream &lt;- Qupstream * 86400 ## Conversion in m3/day

## the reservoir is not an upstream subcachment: its areas is NA
BasinAreas &lt;- c(NA, BasinInfo$BasinArea)

## delay time between the reservoir and the catchment outlet is 2 days and the distance is 150 km
LengthHydro &lt;- 150
## with a delay of 2 days for 150 km, the flow velocity is 75 km per day
Velocity &lt;- (LengthHydro * 1e3 / 2) / (24 * 60 * 60) ## Conversion km/day -&gt; m/s

# This example is a network of 2 nodes which can be describe like this:
db &lt;- data.frame(id = c("Reservoir", "GaugingDown"),
                 length = c(LengthHydro, NA),
                 down = c("GaugingDown", NA),
                 area = c(NA, BasinInfo$BasinArea),
                 model = c(NA, "RunModel_GR4J"),
                 stringsAsFactors = FALSE)

# Create GRiwrm object from the data.frame
griwrm &lt;- CreateGRiwrm(db)
str(griwrm)

# Formatting observations for the hydrological models
# Each input data should be a matrix or a data.frame with the good id in the name of the column
Precip &lt;- matrix(BasinObs$P, ncol = 1)
colnames(Precip) &lt;- "GaugingDown"
PotEvap &lt;- matrix(BasinObs$E, ncol = 1)
colnames(PotEvap) &lt;- "GaugingDown"

# Observed flows contain flows that are directly injected in the model
Qobs = matrix(Qupstream, ncol = 1)
colnames(Qobs) &lt;- "Reservoir"

# Creation of the GRiwrmInputsModel object (= a named list of InputsModel objects)
InputsModels &lt;- CreateInputsModel(griwrm,
                            DatesR = BasinObs$DatesR,
                            Precip = Precip,
                            PotEvap = PotEvap,
                            Qobs = Qobs)
str(InputsModels)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

# Creation of the GriwmRunOptions object
RunOptions &lt;- CreateRunOptions(InputsModels,
                                IndPeriod_Run = Ind_Run)
str(RunOptions)

# Parameters of the SD models should be encapsulated in a named list
ParamGR4J &lt;- c(X1 = 257.238, X2 = 1.012, X3 = 88.235, X4 = 2.208)
Param &lt;- list(`GaugingDown` = c(Velocity, ParamGR4J))

# RunModel for the whole network
OutputsModels &lt;- RunModel(InputsModels,
                          RunOptions = RunOptions,
                          Param = Param)
str(OutputsModels)

# Compare Simulation with reservoir and observation of natural flow
plot(OutputsModels, data.frame(GaugingDown = BasinObs$Qmm[Ind_Run]))
</code></pre>

<hr>
<h2 id='plot.Qm3s'>Plot of a <code>Qm3s</code> object (time series of simulated flows)</h2><span id='topic+plot.Qm3s'></span>

<h3>Description</h3>

<p>Plot of a <code>Qm3s</code> object (time series of simulated flows)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'Qm3s'
plot(
  x,
  type = "l",
  xlab = "Date",
  ylab = expression("Flow (m"^"3" * "/s)"),
  main = "Simulated flows",
  col = rainbow(ncol(x) - 1),
  legend = colnames(x)[-1],
  legend.cex = 0.7,
  legend.x = "topright",
  legend.y = NULL,
  lty = 1,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.Qm3s_+3A_x">x</code></td>
<td>
<p><a href="base.html#topic+data.frame">data.frame</a> with a first column with <a href="base.html#topic+POSIXt">POSIXt</a> dates and followings columns with flows at each node of the network</p>
</td></tr>
<tr><td><code id="plot.Qm3s_+3A_type">type</code></td>
<td>
<p><a href="base.html#topic+character">character</a> plot type (See <a href="graphics.html#topic+plot.default">plot.default</a>), default &quot;l&quot;</p>
</td></tr>
<tr><td><code id="plot.Qm3s_+3A_xlab">xlab</code></td>
<td>
<p><a href="base.html#topic+character">character</a> label for the x axis, default to &quot;Date&quot;</p>
</td></tr>
<tr><td><code id="plot.Qm3s_+3A_ylab">ylab</code></td>
<td>
<p><a href="base.html#topic+character">character</a> label for the y axis, default to &quot;Flow (m3/s)&quot;</p>
</td></tr>
<tr><td><code id="plot.Qm3s_+3A_main">main</code></td>
<td>
<p><a href="base.html#topic+character">character</a> main title for the plot, default to &quot;Simulated flows&quot;</p>
</td></tr>
<tr><td><code id="plot.Qm3s_+3A_col">col</code></td>
<td>
<p><a href="base.html#topic+character">character</a> plotting color (See <a href="graphics.html#topic+par">par</a>), default to rainbow colors</p>
</td></tr>
<tr><td><code id="plot.Qm3s_+3A_legend">legend</code></td>
<td>
<p><a href="base.html#topic+character">character</a> see parameter <code>legend</code> of <a href="graphics.html#topic+legend">legend</a>. Set to <a href="base.html#topic+NULL">NULL</a> if display of the legend is not wanted</p>
</td></tr>
<tr><td><code id="plot.Qm3s_+3A_legend.cex">legend.cex</code></td>
<td>
<p><a href="base.html#topic+character">character</a> <code>cex</code> parameter for the text of the legend (See <a href="graphics.html#topic+par">par</a>)</p>
</td></tr>
<tr><td><code id="plot.Qm3s_+3A_legend.x">legend.x</code>, <code id="plot.Qm3s_+3A_legend.y">legend.y</code></td>
<td>
<p>Legend position, see <code>x</code> and <code>y</code> parameters in <a href="graphics.html#topic+legend">graphics::legend</a></p>
</td></tr>
<tr><td><code id="plot.Qm3s_+3A_lty">lty</code></td>
<td>
<p><a href="base.html#topic+character">character</a> or <a href="base.html#topic+numeric">numeric</a> The line type (See <a href="graphics.html#topic+par">par</a>)</p>
</td></tr>
<tr><td><code id="plot.Qm3s_+3A_...">...</code></td>
<td>
<p>Further arguments to pass to the <a href="graphics.html#topic+matplot">matplot</a> functions</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Screen plot window.
</p>

<hr>
<h2 id='RunModel'>RunModel function for both <strong>airGR</strong> InputsModel and GRiwrmInputsModel object</h2><span id='topic+RunModel'></span>

<h3>Description</h3>

<p>RunModel function for both <strong>airGR</strong> InputsModel and GRiwrmInputsModel object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RunModel(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="RunModel_+3A_x">x</code></td>
<td>
<p>[object of class <em>InputsModel</em> or <em>GRiwrmInputsModel</em>] see <a href="#topic+CreateInputsModel">CreateInputsModel</a> for details</p>
</td></tr>
<tr><td><code id="RunModel_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Either a <a href="base.html#topic+list">list</a> of OutputsModel object (for GRiwrmInputsModel) or an OutputsModel object (for InputsModel)
</p>

<hr>
<h2 id='RunModel.GR'>Run of a rainfall-runoff model on a sub-basin</h2><span id='topic+RunModel.GR'></span>

<h3>Description</h3>

<p>Function which performs a single model run with the provided function over the selected period.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'GR'
RunModel(x, RunOptions, Param, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="RunModel.GR_+3A_x">x</code></td>
<td>
<p>[object of class <code>InputsModel</code>] <code>InputsModel</code> for <a href="airGR.html#topic+RunModel">airGR::RunModel</a></p>
</td></tr>
<tr><td><code id="RunModel.GR_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <a href="airGR.html#topic+CreateRunOptions">airGR::CreateRunOptions</a> for details</p>
</td></tr>
<tr><td><code id="RunModel.GR_+3A_param">Param</code></td>
<td>
<p><a href="base.html#topic+numeric">numeric</a> vector of model parameters (See details for SD lag model)</p>
</td></tr>
<tr><td><code id="RunModel.GR_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>InputsModel</code> parameter has been created for using a semi-distributed (SD) lag model (See <code><a href="airGR.html#topic+CreateInputsModel">CreateInputsModel</a></code>), the first item of <code>Param</code> parameter should contain a constant lag parameter expressed as a velocity in m/s, parameters for the hydrological model are then shift one position to the right.
</p>


<h3>Value</h3>

<p>[list] see <code><a href="airGR.html#topic+RunModel_GR4J">RunModel_GR4J</a></code> or <code><a href="airGR.html#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code> for details.
</p>
<p>If <code>InputsModel</code> parameter has been created for using a semi-distributed (SD) lag model (See <code><a href="airGR.html#topic+CreateInputsModel">CreateInputsModel</a></code>), the list value contains an extra item named <code>QsimDown</code> which is a numeric series of simulated discharge [mm/time step] related to the run-off contribution of the downstream sub-catchment.
</p>

<hr>
<h2 id='RunModel.GRiwrmInputsModel'>RunModel function for <em>GRiwrmInputsModel</em> object</h2><span id='topic+RunModel.GRiwrmInputsModel'></span>

<h3>Description</h3>

<p>RunModel function for <em>GRiwrmInputsModel</em> object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'GRiwrmInputsModel'
RunModel(x, RunOptions, Param, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="RunModel.GRiwrmInputsModel_+3A_x">x</code></td>
<td>
<p>[object of class <em>GRiwrmInputsModel</em>] see <a href="#topic+CreateInputsModel.GRiwrm">CreateInputsModel.GRiwrm</a> for details</p>
</td></tr>
<tr><td><code id="RunModel.GRiwrmInputsModel_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>GRiwrmRunOptions</em>] see <a href="#topic+CreateRunOptions.GRiwrmInputsModel">CreateRunOptions.GRiwrmInputsModel</a> for details</p>
</td></tr>
<tr><td><code id="RunModel.GRiwrmInputsModel_+3A_param">Param</code></td>
<td>
<p><a href="base.html#topic+list">list</a> parameter values. The list item names are the IDs of the sub-basins. Each item is a <a href="base.html#topic+numeric">numeric</a> <a href="base.html#topic+vector">vector</a></p>
</td></tr>
<tr><td><code id="RunModel.GRiwrmInputsModel_+3A_...">...</code></td>
<td>
<p>Further arguments for compatibility with S3 methods</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <em>GRiwrmOutputsModel</em>. This object is a <a href="base.html#topic+list">list</a> of <em>OutputsModel</em> objects produced by <a href="#topic+RunModel.InputsModel">RunModel.InputsModel</a> for each node of the semi-distributed model.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>###################################################################
# Run the `airGR::RunModel_Lag` example in the GRiwrm fashion way #
# Simulation of a reservoir with a purpose of low-flow mitigation #
###################################################################

## ---- preparation of the InputsModel object

## loading package and catchment data
library(airGRiwrm)
data(L0123001)

## ---- specifications of the reservoir

## the reservoir withdraws 1 m3/s when it's possible considering the flow observed in the basin
Qupstream &lt;- matrix(-sapply(BasinObs$Qls / 1000 - 1, function(x) {
  min(1, max(0, x, na.rm = TRUE))
}), ncol = 1)

## except between July and September when the reservoir releases 3 m3/s for low-flow mitigation
month &lt;- as.numeric(format(BasinObs$DatesR, "%m"))
Qupstream[month &gt;= 7 &amp; month &lt;= 9] &lt;- 3
Qupstream &lt;- Qupstream * 86400 ## Conversion in m3/day

## the reservoir is not an upstream subcachment: its areas is NA
BasinAreas &lt;- c(NA, BasinInfo$BasinArea)

## delay time between the reservoir and the catchment outlet is 2 days and the distance is 150 km
LengthHydro &lt;- 150
## with a delay of 2 days for 150 km, the flow velocity is 75 km per day
Velocity &lt;- (LengthHydro * 1e3 / 2) / (24 * 60 * 60) ## Conversion km/day -&gt; m/s

# This example is a network of 2 nodes which can be describe like this:
db &lt;- data.frame(id = c("Reservoir", "GaugingDown"),
                 length = c(LengthHydro, NA),
                 down = c("GaugingDown", NA),
                 area = c(NA, BasinInfo$BasinArea),
                 model = c(NA, "RunModel_GR4J"),
                 stringsAsFactors = FALSE)

# Create GRiwrm object from the data.frame
griwrm &lt;- CreateGRiwrm(db)
str(griwrm)

# Formatting observations for the hydrological models
# Each input data should be a matrix or a data.frame with the good id in the name of the column
Precip &lt;- matrix(BasinObs$P, ncol = 1)
colnames(Precip) &lt;- "GaugingDown"
PotEvap &lt;- matrix(BasinObs$E, ncol = 1)
colnames(PotEvap) &lt;- "GaugingDown"

# Observed flows contain flows that are directly injected in the model
Qobs = matrix(Qupstream, ncol = 1)
colnames(Qobs) &lt;- "Reservoir"

# Creation of the GRiwrmInputsModel object (= a named list of InputsModel objects)
InputsModels &lt;- CreateInputsModel(griwrm,
                            DatesR = BasinObs$DatesR,
                            Precip = Precip,
                            PotEvap = PotEvap,
                            Qobs = Qobs)
str(InputsModels)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

# Creation of the GriwmRunOptions object
RunOptions &lt;- CreateRunOptions(InputsModels,
                                IndPeriod_Run = Ind_Run)
str(RunOptions)

# Parameters of the SD models should be encapsulated in a named list
ParamGR4J &lt;- c(X1 = 257.238, X2 = 1.012, X3 = 88.235, X4 = 2.208)
Param &lt;- list(`GaugingDown` = c(Velocity, ParamGR4J))

# RunModel for the whole network
OutputsModels &lt;- RunModel(InputsModels,
                          RunOptions = RunOptions,
                          Param = Param)
str(OutputsModels)

# Compare Simulation with reservoir and observation of natural flow
plot(OutputsModels, data.frame(GaugingDown = BasinObs$Qmm[Ind_Run]))
</code></pre>

<hr>
<h2 id='RunModel.InputsModel'>Wrapper for <a href="airGR.html#topic+RunModel">airGR::RunModel</a> for one sub-basin</h2><span id='topic+RunModel.InputsModel'></span>

<h3>Description</h3>

<p>Wrapper for <a href="airGR.html#topic+RunModel">airGR::RunModel</a> for one sub-basin
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'InputsModel'
RunModel(x, RunOptions, Param, FUN_MOD = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="RunModel.InputsModel_+3A_x">x</code></td>
<td>
<p>[object of class <em>InputsModel</em>] see <a href="airGR.html#topic+CreateInputsModel">airGR::CreateInputsModel</a> for details</p>
</td></tr>
<tr><td><code id="RunModel.InputsModel_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <code><a href="airGR.html#topic+CreateRunOptions">CreateRunOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel.InputsModel_+3A_param">Param</code></td>
<td>
<p>[numeric] vector of model parameters (See details for SD lag model)</p>
</td></tr>
<tr><td><code id="RunModel.InputsModel_+3A_fun_mod">FUN_MOD</code></td>
<td>
<p>[function] hydrological model function (e.g. <code><a href="airGR.html#topic+RunModel_GR4J">RunModel_GR4J</a></code>, <code><a href="airGR.html#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code>)</p>
</td></tr>
<tr><td><code id="RunModel.InputsModel_+3A_...">...</code></td>
<td>
<p>Further arguments for compatibility with S3 methods</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function calls <a href="airGR.html#topic+RunModel">airGR::RunModel</a> (See <a href="airGR.html#topic+RunModel">airGR::RunModel</a> for further details).
</p>
<p>The list produced by the function (See Value section of <a href="airGR.html#topic+RunModel_GR4J">airGR::RunModel_GR4J</a>) is here completed by an item <em>$Qsim_m3</em> storing the simulated discharge series in m3/s.
</p>


<h3>Value</h3>

<p>[list] see <code><a href="airGR.html#topic+RunModel_GR4J">RunModel_GR4J</a></code> or <code><a href="airGR.html#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code> for details.
</p>
<p>If <code>InputsModel</code> parameter has been created for using a semi-distributed (SD) lag model (See <code><a href="airGR.html#topic+CreateInputsModel">CreateInputsModel</a></code>), the list value contains an extra item named <code>QsimDown</code> which is a numeric series of simulated discharge [mm/time step] related to the run-off contribution of the downstream sub-catchment.
</p>

<hr>
<h2 id='RunModel.SD'>Run a semi-distributed model from rainfall-runoff model outputs</h2><span id='topic+RunModel.SD'></span>

<h3>Description</h3>

<p>Run a semi-distributed model from rainfall-runoff model outputs
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'SD'
RunModel(x, RunOptions, Param, QcontribDown, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="RunModel.SD_+3A_x">x</code></td>
<td>
<p>[object of class <code>InputsModel</code>] used as <code>InputsModel</code> parameter for <a href="airGR.html#topic+RunModel_Lag">airGR::RunModel_Lag</a></p>
</td></tr>
<tr><td><code id="RunModel.SD_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <code><a href="airGR.html#topic+CreateRunOptions">CreateRunOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel.SD_+3A_param">Param</code></td>
<td>
<p>[numeric] vector of 1 parameter
</p>

<table>
<tr>
 <td style="text-align: left;">
      Velocity </td><td style="text-align: left;"> mean flow velocity [m/s]
    </td>
</tr>

</table>

</td></tr>
<tr><td><code id="RunModel.SD_+3A_qcontribdown">QcontribDown</code></td>
<td>
<p>[numeric] vector or [OutputsModel] containing the time series of the runoff contribution of the downstream sub-basin</p>
</td></tr>
<tr><td><code id="RunModel.SD_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>OutputsModel</code> object. See <a href="airGR.html#topic+RunModel_Lag">airGR::RunModel_Lag</a>
</p>

<hr>
<h2 id='RunModel.Supervisor'>RunModel function for a GRiwrmInputsModel object</h2><span id='topic+RunModel.Supervisor'></span>

<h3>Description</h3>

<p>RunModel function for a GRiwrmInputsModel object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'Supervisor'
RunModel(x, RunOptions, Param, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="RunModel.Supervisor_+3A_x">x</code></td>
<td>
<p>[object of class <code>Supervisor</code>] see <a href="#topic+CreateSupervisor">CreateSupervisor</a> for details</p>
</td></tr>
<tr><td><code id="RunModel.Supervisor_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>GRiwrmRunOptions</em>] see <code>[CreateRunOptions.GRiwrm]</code> for details</p>
</td></tr>
<tr><td><code id="RunModel.Supervisor_+3A_param">Param</code></td>
<td>
<p><a href="base.html#topic+list">list</a> parameter values. The list item names are the IDs of the sub-basins. Each item is a vector of numerical parameters</p>
</td></tr>
<tr><td><code id="RunModel.Supervisor_+3A_...">...</code></td>
<td>
<p>Further arguments for compatibility with S3 methods</p>
</td></tr>
</table>


<h3>Value</h3>

<p><em>GRiwrmOutputsModel</em> object which is a list of <em>OutputsModel</em> objects (See <a href="airGR.html#topic+RunModel">airGR::RunModel</a>) for each node of the semi-distributed model
</p>

<hr>
<h2 id='Severn'>Catchment attributes and hydro-meteorological timeseries for some gauging stations on the Severn River</h2><span id='topic+Severn'></span>

<h3>Description</h3>

<p>Catchment attributes and hydro-meteorological timeseries for some gauging stations on the Severn River
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Severn
</code></pre>


<h3>Format</h3>

<p>a <a href="base.html#topic+list">list</a> with 2 items:
</p>

<ul>
<li><p> &quot;BasinsInfo&quot; which contains a <a href="base.html#topic+data.frame">data.frame</a> with Gauging station identifier, name, coordinates (GPS), area (km2), mean elevation (m), station type, flow period start and end, the bank full flow (m3/s), the identifier of the following downstream station and the distance to the following downstream station
</p>
</li>
<li><p> &quot;BasinObs&quot; which contains a <a href="base.html#topic+list">list</a> with an item by gauging station which contains a <a href="base.html#topic+data.frame">data.frame</a> with <a href="base.html#topic+POSIXct">POSIXct</a> dates, precipitations (mm/time step), potential evapotranspiration (mm/time step) and measured flows (mm/time step)
</p>
</li></ul>



<h3>Source</h3>

<p>These data are extracted from the CAMEL-GB dataset.
</p>
<p>Coxon, G.; Addor, N.; Bloomfield, J.P.; Freer, J.; Fry, M.; Hannaford, J.; Howden, N.J.K.; Lane, R.; Lewis, M.; Robinson, E.L.; Wagener, T.; Woods, R. (2020). Catchment attributes and hydro-meteorological timeseries for 671 catchments across Great Britain (CAMELS-GB). NERC Environmental Information Data Centre. (Dataset). <a href="https://doi.org/10.5285/8344E4F3-D2EA-44F5-8AFA-86D2987543A9">doi:10.5285/8344E4F3-D2EA-44F5-8AFA-86D2987543A9</a>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
