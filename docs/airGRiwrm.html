<!DOCTYPE html><html lang="en-US"><head><title>Help for package airGRiwrm</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {airGRiwrm}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#airGRiwrm-package'><p>airGR based Integrated Water Resource Management Modeling</p></a></li>
<li><a href='#as.Qm3s'><p>Coerce data.frame or content of a data.frame into a <em>Qm3s</em> object ready</p>
for plotting</a></li>
<li><a href='#Calibration.GRiwrmInputsModel'><p>Calibration of the parameters of one catchment or a network of sub-catchments</p></a></li>
<li><a href='#ConvertMeteoSD'><p>Conversion of meteorological data from basin scale to sub-basin scale</p></a></li>
<li><a href='#CreateCalibOptions.GRiwrmInputsModel'><p>Creation of the CalibOptions object</p></a></li>
<li><a href='#CreateController'><p>Creation and adding of a controller in a supervisor</p></a></li>
<li><a href='#CreateGRiwrm'><p>Generation of a network description containing all hydraulic nodes and the</p>
description of their connections</a></li>
<li><a href='#CreateInputsCrit.GRiwrmInputsModel'><p>Creation of the InputsCrit object required to the <code>ErrorCrit</code> functions</p></a></li>
<li><a href='#CreateInputsModel'><p>Generic function for creating <code>InputsModel</code> object for either <strong>airGR</strong> or <strong>airGRiwrm</strong></p></a></li>
<li><a href='#CreateInputsModel.GRiwrm'><p>Creation of an InputsModel object for a <strong>airGRiwrm</strong> network</p></a></li>
<li><a href='#CreateRunOptions.GRiwrmInputsModel'><p>Creation of the RunOptions object</p></a></li>
<li><a href='#CreateSupervisor'><p>Creation of a Supervisor for handling regulation in a model</p></a></li>
<li><a href='#extractParam'><p>Extract calibrated parameters</p></a></li>
<li><a href='#getNodeProperties'><p>Properties of GRiwrm nodes</p></a></li>
<li><a href='#getNodeRanking'><p>Sorting of the nodes from upstream to downstream for RunModel and Calibration</p></a></li>
<li><a href='#getNoSD_Ids'><p>Function to obtain the ID of sub-basins not using SD model</p></a></li>
<li><a href='#getSD_Ids'><p>Function to obtain the ID of sub-basins using SD model</p></a></li>
<li><a href='#isNodeDownstream'><p>Check if a node is downstream or upstream another one</p></a></li>
<li><a href='#mermaid'><p>Plot a mermaid diagram</p></a></li>
<li><a href='#plot.GRiwrm'><p>Plot of a diagram representing the network structure of a GRiwrm object</p></a></li>
<li><a href='#plot.GRiwrmOutputsModel'><p>Function which creates screen plots giving an overview of the model outputs in the GRiwrm network</p></a></li>
<li><a href='#plot.OutputsModelReservoir'><p>Plot simulated reservoir volume, inflows and released flows time series on a reservoir node</p></a></li>
<li><a href='#plot.Qm3s'><p>Plot of a <code>Qm3s</code> object (time series of simulated flows)</p></a></li>
<li><a href='#reduceGRiwrm'><p>Reduce the size of a GRiwrm by selecting the subset of nodes corresponding to a downstream node</p></a></li>
<li><a href='#RunModel'><p>RunModel function for both <strong>airGR</strong> InputsModel and GRiwrmInputsModel object</p></a></li>
<li><a href='#RunModel_Reservoir'><p>Run with a reservoir model</p></a></li>
<li><a href='#RunModel.GR'><p>Run of a rainfall-runoff model on a sub-basin</p></a></li>
<li><a href='#RunModel.GRiwrmInputsModel'><p>RunModel function for <em>GRiwrmInputsModel</em> object</p></a></li>
<li><a href='#RunModel.InputsModel'><p>Wrapper for airGR::RunModel for one sub-basin</p></a></li>
<li><a href='#RunModel.Supervisor'><p>RunModel function for a GRiwrmInputsModel object</p></a></li>
<li><a href='#Severn'><p>Catchment attributes and hydro-meteorological timeseries for some gauging stations on the Severn River</p></a></li>
<li><a href='#sort.GRiwrm'><p>Sort a GRiwrm network in upstream-downstream order ready for Calibration</p></a></li>
<li><a href='#transferGRparams'><p>Transfer GR parameters from one donor sub-basin to a receiver sub-basin</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>'airGR' Integrated Water Resource Management</td>
</tr>
<tr>
<td>Version:</td>
<td>0.7.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-09-22</td>
</tr>
<tr>
<td>Description:</td>
<td>Semi-distributed Precipitation-Runoff Modeling based on
    'airGR' package models integrating human infrastructures and their
    managements.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/AGPL-3">AGPL-3</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://inrae.github.io/airGRiwrm/">https://inrae.github.io/airGRiwrm/</a>,
<a href="https://github.com/inrae/airGRiwrm#readme">https://github.com/inrae/airGRiwrm#readme</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/inrae/airGRiwrm/issues">https://github.com/inrae/airGRiwrm/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>airGR (&ge; 1.7.0), R (&ge; 3.5)</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr, graphics, grDevices, jsonlite, png, rlang, stats,
utils, zlib</td>
</tr>
<tr>
<td>Suggests:</td>
<td>htmltools, knitr, rmarkdown, spelling, testthat, waldo</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-09-22 18:07:37 UTC; ddorchies</td>
</tr>
<tr>
<td>Author:</td>
<td>David Dorchies <a href="https://orcid.org/0000-0002-6595-7984"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Olivier Delaigue <a href="https://orcid.org/0000-0002-7668-8468"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Guillaume Thirel <a href="https://orcid.org/0000-0002-1444-1830"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>David Dorchies &lt;david.dorchies@inrae.fr&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-09-22 18:20:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='airGRiwrm-package'>airGR based Integrated Water Resource Management Modeling</h2><span id='topic+airGRiwrm'></span><span id='topic+airGRiwrm-package'></span>

<h3>Description</h3>

<p>The R-package <strong>airGRiwrm</strong> is an extension of the <strong>airGR</strong> R-package
for semi-distributed hydrological models.
It keeps the same operating mode and functions as <strong>airGR</strong>.
</p>


<h3>Main features</h3>

<p>The R-package <strong>airGRiwrm</strong> proposes a simplified network description for building semi-distributed
models containing several sub-basins with diverse connections including inter-basin
transfers.
It allows to automatically transfer hydrological model parameters for ungauged
locations in the catchment.
Local human influences such as water transfers, releases and withdrawals can
be injected in the network.
The model also handles reservoirs by simulating volume time series from releases
time series provided by the user.
The package also integrates a supervisor that apply user-defined decision algorithms
given model outputs during simulation (centralized feedback control).
</p>


<h3>References of works using airGRiwrm</h3>


<ul>
<li><p> Lemaitre-Basset, T., Thirel, G., Oudin, L., Dorchies, D., 2024.
Water use scenarios versus climate change: Investigating future water
management of the French part of the Moselle.
Journal of Hydrology: Regional Studies 54, 101855. https://doi.org/10.1016/j.ejrh.2024.101855
</p>
</li>
<li><p> Dorchies, D., Delaigue, O., Kahiyeh-Moumin, I., Ricquier, F., Thirel, G., 2023.
Risk-based flood and drought management for multiple reservoirs in a
non-stationary climate: application to the Seine River (No. EGU23-8697).
Presented at the EGU23, Copernicus Meetings. https://doi.org/10.5194/egusphere-egu23-8697
</p>
</li>
<li><p> Soutif-Bellenger, M., Thirel, G., Fernandez, S., Dorchies, D., 2023.
Build and evaluate climate change adaptation with a parsimonious integrated
agro-hydrological model over a catchment in northeastern France (No. EGU23-12160).
Presented at the EGU23, Copernicus Meetings. https://doi.org/10.5194/egusphere-egu23-12160
</p>
</li>
<li><p> Soutif-Bellenger, M., Thirel, G., Therond, O., Villerd, J., 2022.
How much can we simplify irrigation in an integrated modeling purpose?
A case study in southern France (No. IAHS2022-32). Presented at the IAHS2022,
Copernicus Meetings. https://meetingorganizer.copernicus.org/IAHS2022/IAHS2022-32.html.
</p>
</li>
<li><p> Santos, L., Thirel, G., Perrin, C., 2022. Impact of water withdrawals and
releases on the parameters of a bucket-type rainfall-runoff model (No. IAHS2022-421).
Presented at the IAHS2022, Copernicus Meetings.
</p>
</li>
<li><p> Nunez Torres, L., 2021. Simulation d’un bassin versant anthropisé à l’aide
d’un modèle hydrologique semi-distribué: Le bassin de la Seine et ses réservoirs.
Rapport de stage ST5 -Polytech Sorbonne -1er septembre 2021 (other). PolyTech Sorbonne.
https://hal.inrae.fr/hal-03359617
Dau, Q., Dorchies, D., Bader, J.-C., 2021. Many-objective risk assessment
framework for guiding operational decisions on multiple reservoirs.
Presented at the EGU General Assembly 2021 - vEGU21: Gather Online.
https://doi.org/10.5194/egusphere-egu21-10676
</p>
</li></ul>



<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: David Dorchies <a href="mailto:david.dorchies@inrae.fr">david.dorchies@inrae.fr</a> (<a href="https://orcid.org/0000-0002-6595-7984">ORCID</a>)
</p>
<p>Other contributors:
</p>

<ul>
<li><p> Olivier Delaigue <a href="mailto:airGR@inrae.fr">airGR@inrae.fr</a> (<a href="https://orcid.org/0000-0002-7668-8468">ORCID</a>) [contributor]
</p>
</li>
<li><p> Guillaume Thirel (<a href="https://orcid.org/0000-0002-1444-1830">ORCID</a>) [contributor]
</p>
</li></ul>



<h3>References</h3>


<ul>
<li><p> Thirel, G., Dorchies, D., Delaigue, O., Nunez Torres, L., Elmalki, D., 2022.
Évaluation de l’impact du changement climatique et de l’adaptation avec des
outils de modélisation hydrologiques libres.
Presented at the 35e colloque annuel de l’Association Internationale de Climatologie.
</p>
</li>
<li><p> Dorchies, D., Delaigue, O., Thirel, G., 2021. airGRiwrm: an extension of the
airGR R-package for handling Integrated Water Resources Management modeling.
Presented at the EGU General Assembly 2021 - vEGU21: Gather Online, p. EGU21.
https://doi.org/10.5194/egusphere-egu21-2190
</p>
</li>
<li><p> de Lavenne, A., Andréassian, V., Thirel, G., Ramos, M.-H., Perrin, C., 2019.
A regularization approach to improve the sequential calibration of a semidistributed
hydrological model. Water Resources Research 55, 8821–8839. https://doi.org/10.1029/2018WR024266
</p>
</li>
<li><p> Lobligeois, F., Andréassian, V., Perrin, C., Tabary, P., Loumagne, C., 2014.
When does higher spatial resolution rainfall information improve streamflow
simulation? An evaluation using 3620 flood events. Hydrology and Earth System
Sciences 18, 575–594. https://doi.org/10.5194/hess-18-575-2014
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://inrae.github.io/airGRiwrm/">https://inrae.github.io/airGRiwrm/</a>
</p>
</li>
<li> <p><a href="https://github.com/inrae/airGRiwrm#readme">https://github.com/inrae/airGRiwrm#readme</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/inrae/airGRiwrm/issues">https://github.com/inrae/airGRiwrm/issues</a>
</p>
</li></ul>


<hr>
<h2 id='as.Qm3s'>Coerce <a href="base.html#topic+data.frame">data.frame</a> or content of a <a href="base.html#topic+data.frame">data.frame</a> into a <em>Qm3s</em> object ready
for plotting</h2><span id='topic+as.Qm3s'></span>

<h3>Description</h3>

<p>Coerce <a href="base.html#topic+data.frame">data.frame</a> or content of a <a href="base.html#topic+data.frame">data.frame</a> into a <em>Qm3s</em> object ready
for plotting
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as.Qm3s(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as.Qm3s_+3A_...">...</code></td>
<td>
<p>A <a href="base.html#topic+data.frame">data.frame</a> for a single argument, or the arguments of function <a href="base.html#topic+data.frame">data.frame</a></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <a href="base.html#topic+data.frame">data.frame</a> of class <em>Qm3s</em>
</p>

<hr>
<h2 id='Calibration.GRiwrmInputsModel'>Calibration of the parameters of one catchment or a network of sub-catchments</h2><span id='topic+Calibration.GRiwrmInputsModel'></span><span id='topic+Calibration.InputsModel'></span><span id='topic+Calibration'></span><span id='topic+Calibration.Ungauged'></span>

<h3>Description</h3>

<p>Calibration algorithm that optimizes the error criterion selected as objective
function using the provided functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'GRiwrmInputsModel'
Calibration(
  InputsModel,
  RunOptions,
  InputsCrit,
  CalibOptions,
  useUpstreamQsim = TRUE,
  ...
)

## S3 method for class 'InputsModel'
Calibration(InputsModel, CalibOptions, ...)

Calibration(InputsModel, ...)

## S3 method for class 'Ungauged'
Calibration(InputsModel, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Calibration.GRiwrmInputsModel_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em> or <em>GRiwrmInputsModel</em>] see <a href="#topic+CreateInputsModel">CreateInputsModel</a></p>
</td></tr>
<tr><td><code id="Calibration.GRiwrmInputsModel_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em> or <em>GRiwrmRunOptions</em>] see <a href="#topic+CreateRunOptions">CreateRunOptions</a></p>
</td></tr>
<tr><td><code id="Calibration.GRiwrmInputsModel_+3A_inputscrit">InputsCrit</code></td>
<td>
<p>[object of class <em>InputsCrit</em> or <em>GRiwrmInputsCrit</em>] see <a href="#topic+CreateInputsCrit">CreateInputsCrit</a></p>
</td></tr>
<tr><td><code id="Calibration.GRiwrmInputsModel_+3A_caliboptions">CalibOptions</code></td>
<td>
<p>[object of class <em>CalibOptions</em> or <em>GRiwrmCalibOptions</em>] see <a href="#topic+CreateCalibOptions">CreateCalibOptions</a> for details</p>
</td></tr>
<tr><td><code id="Calibration.GRiwrmInputsModel_+3A_useupstreamqsim">useUpstreamQsim</code></td>
<td>
<p>boolean describing if simulated (<code>TRUE</code>) or observed (<code>FALSE</code>) flows are used for calibration. Default is <code>TRUE</code></p>
</td></tr>
<tr><td><code id="Calibration.GRiwrmInputsModel_+3A_...">...</code></td>
<td>
<p>further arguments passed to <a href="airGR.html#topic+Calibration">airGR::Calibration</a>, see details</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function can be used either for a catchment (with an <em>InputsModel</em>
object), for a network (with a <em>GRiwrmInputsModel</em> object), or for an
ungauged node cluster (with a <em>Ungauged</em> object).
</p>
<p>Argument classes should be consistent to the usage:
</p>

<ul>
<li><p> a <code>InputsModel</code> argument of class <em>InputsModel</em> must be followed by a
<code>RunOptions</code> argument of class <em>RunOptions</em>, a <code>InputsCrit</code> argument of
class <em>InputsCrit</em> and a <code>CalibOptions</code> of class <em>CalibOptions</em>
</p>
</li>
<li><p> a <code>InputsModel</code> argument of class <em>GRiwrmInputsModel</em> must be followed
by a <code>RunOptions</code> argument of class <em>GRiwrmRunOptions</em>, a <code>InputsCrit</code>
argument of class <em>GRiwrmInputsCrit</em> and a <code>CalibOptions</code> of class
<em>GRiwrmCalibOptions</em>
</p>
</li></ul>

<p>See the vignettes for examples.
</p>


<h3>Value</h3>

<p>Depending on the class of <code>InputsModel</code> argument (respectively
<code>InputsModel</code> and <code>GRiwrmInputsModel</code> object), the returned value is respectively:
</p>

<ul>
<li><p> a <code>OutputsCalib</code> object (See <a href="airGR.html#topic+Calibration">airGR::Calibration</a> for more details on this object)
</p>
</li>
<li><p> a <code>GRiwrmOutputsCalib</code> object which is a <a href="base.html#topic+list">list</a> of <code>OutputsCalib</code> objects with
one item per modeled sub-catchment
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+CreateGRiwrm">CreateGRiwrm()</a></code>, <code><a href="#topic+CreateInputsModel.GRiwrm">CreateInputsModel.GRiwrm()</a></code>, <code><a href="#topic+CreateInputsCrit">CreateInputsCrit()</a></code>, <code><a href="#topic+CreateCalibOptions">CreateCalibOptions()</a></code>
</p>

<hr>
<h2 id='ConvertMeteoSD'>Conversion of meteorological data from basin scale to sub-basin scale</h2><span id='topic+ConvertMeteoSD'></span><span id='topic+ConvertMeteoSD.GRiwrm'></span><span id='topic+ConvertMeteoSD.character'></span><span id='topic+ConvertMeteoSD.matrix'></span>

<h3>Description</h3>

<p>Conversion of meteorological data from basin scale to sub-basin scale
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ConvertMeteoSD(x, ...)

## S3 method for class 'GRiwrm'
ConvertMeteoSD(x, meteo, ...)

## S3 method for class 'character'
ConvertMeteoSD(x, griwrm, meteo, ...)

## S3 method for class 'matrix'
ConvertMeteoSD(x, areas, temperature = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ConvertMeteoSD_+3A_x">x</code></td>
<td>
<p>either a <code>GRiwrm</code> network description (See <a href="#topic+CreateGRiwrm">CreateGRiwrm</a>), a <a href="base.html#topic+character">character</a> id of a node, or a <a href="base.html#topic+matrix">matrix</a> containing meteorological data</p>
</td></tr>
<tr><td><code id="ConvertMeteoSD_+3A_...">...</code></td>
<td>
<p>Parameters passed to the methods</p>
</td></tr>
<tr><td><code id="ConvertMeteoSD_+3A_meteo">meteo</code></td>
<td>
<p><a href="base.html#topic+matrix">matrix</a> or <a href="base.html#topic+data.frame">data.frame</a> containing meteorological data. Its <a href="base.html#topic+colnames">colnames</a> should be equal to the ID of the basins</p>
</td></tr>
<tr><td><code id="ConvertMeteoSD_+3A_griwrm">griwrm</code></td>
<td>
<p><code>GRiwrm</code> object describing the semi-distributed network (See <a href="#topic+CreateGRiwrm">CreateGRiwrm</a>)</p>
</td></tr>
<tr><td><code id="ConvertMeteoSD_+3A_areas">areas</code></td>
<td>
<p><a href="base.html#topic+numeric">numeric</a> vector with the total area of the basin followed by the areas of the upstream basins in km2</p>
</td></tr>
<tr><td><code id="ConvertMeteoSD_+3A_temperature">temperature</code></td>
<td>
<p><a href="base.html#topic+logical">logical</a> <code>TRUE</code> if the meteorological data contain air temperature. If <code>FALSE</code> minimum output values are bounded to zero</p>
</td></tr>
</table>


<h3>Value</h3>

<p><a href="base.html#topic+matrix">matrix</a> a matrix containing the converted meteorological data
</p>


<h3>See Also</h3>

<p><code><a href="#topic+CreateGRiwrm">CreateGRiwrm()</a></code>, <code><a href="#topic+CreateInputsModel.GRiwrm">CreateInputsModel.GRiwrm()</a></code>
</p>

<hr>
<h2 id='CreateCalibOptions.GRiwrmInputsModel'>Creation of the CalibOptions object</h2><span id='topic+CreateCalibOptions.GRiwrmInputsModel'></span><span id='topic+CreateCalibOptions'></span><span id='topic+CreateCalibOptions.InputsModel'></span><span id='topic+CreateCalibOptions.character'></span><span id='topic+CreateCalibOptions.function'></span><span id='topic+CreateCalibOptions.RunModel_Reservoir'></span>

<h3>Description</h3>

<p>This function can be used either for a catchment (with an <em>InputsModel</em> object) or for a network (with a <em>GRiwrmInputsModel</em> object)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'GRiwrmInputsModel'
CreateCalibOptions(x, FixedParam = NULL, ...)

CreateCalibOptions(x, FixedParam = NULL, ...)

## S3 method for class 'InputsModel'
CreateCalibOptions(x, FixedParam = NULL, ...)

## S3 method for class 'character'
CreateCalibOptions(x, FixedParam = NULL, ...)

## S3 method for class ''function''
CreateCalibOptions(x, FixedParam = NULL, ...)

## S3 method for class 'RunModel_Reservoir'
CreateCalibOptions(x, FixedParam = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="CreateCalibOptions.GRiwrmInputsModel_+3A_x">x</code></td>
<td>
<p>For a single catchment, it can be an object of class <em>InputsModel</em> or a <a href="base.html#topic+function">function</a> or a <a href="base.html#topic+character">character</a> corresponding to <code>FUN_MOD</code> (compliant with <strong>airGR</strong> call). For a network, it should be an object of class <em>GRiwrmInputsModel</em>. See <a href="#topic+CreateInputsModel">CreateInputsModel</a> for details</p>
</td></tr>
<tr><td><code id="CreateCalibOptions.GRiwrmInputsModel_+3A_fixedparam">FixedParam</code></td>
<td>
<p>a <a href="base.html#topic+numeric">numeric</a> <a href="base.html#topic+vector">vector</a> as for <a href="airGR.html#topic+CreateCalibOptions">airGR::CreateCalibOptions</a>,
or a <a href="base.html#topic+list">list</a> giving the values of non-optimized parameters (see details)</p>
</td></tr>
<tr><td><code id="CreateCalibOptions.GRiwrmInputsModel_+3A_...">...</code></td>
<td>
<p>arguments passed to <a href="airGR.html#topic+CreateCalibOptions">airGR::CreateCalibOptions</a>, see details</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <a href="airGR.html#topic+CreateCalibOptions">airGR::CreateCalibOptions</a> documentation for a complete list of arguments.
</p>
<p>With a <em>GRiwrmInputsModel</em> object, all arguments are applied on each sub-catchments of the network
with some adaptation depending on the model used on each node.
</p>
<p>If the argument <code>FixedParam</code> is a <a href="base.html#topic+numeric">numeric</a> <a href="base.html#topic+vector">vector</a>, it is applied to each node of
the network. Parameters are adapted depending on the use of the routing model
and the CemaNeige model on each node. If <code>FixedParam</code> is a <a href="base.html#topic+list">list</a> of <a href="base.html#topic+numeric">numeric</a>,
each item of the list will be applied on corresponding nodes. Use the id &quot;*&quot; for applying
a setting on the remaining nodes. Example for applying one setting for all the
nodes except the id &quot;54057&quot;:
</p>
<div class="sourceCode"><pre>FixedParam &lt;- list(`*` = c(NA, NA, NA, NA, NA, 0.25, NA, 10, NA),
                   `54057` = c(0.5, NA, NA, NA, NA, 0.25, NA, 10, NA))
</pre></div>
<p>The argument <code>IsHyst</code> is ignored since it should be defined previously with <a href="#topic+CreateInputsModel.GRiwrm">CreateInputsModel.GRiwrm</a>.
</p>


<h3>Value</h3>

<p>Depending on the class of <code>InputsModel</code> argument (respectively <code>InputsModel</code> and <code>GRiwrmInputsModel</code> object), the returned value is respectively:
</p>

<ul>
<li><p> a <code>CalibOptions</code> object (See <a href="airGR.html#topic+CreateCalibOptions">airGR::CreateCalibOptions</a>)
</p>
</li>
<li><p> a <code>GRiwrmCalibOptions</code> object which is a <a href="base.html#topic+list">list</a> of <code>CalibOptions</code> object with one item per modeled sub-catchment
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+CreateGRiwrm">CreateGRiwrm()</a></code>, <code><a href="#topic+CreateInputsModel.GRiwrm">CreateInputsModel.GRiwrm()</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions()</a></code>, <code><a href="#topic+CreateInputsCrit">CreateInputsCrit()</a></code>, <code><a href="#topic+Calibration">Calibration()</a></code>
</p>

<hr>
<h2 id='CreateController'>Creation and adding of a controller in a supervisor</h2><span id='topic+CreateController'></span>

<h3>Description</h3>

<p>Creation and adding of a controller in a supervisor
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CreateController(supervisor, ctrl.id, Y, U, FUN)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="CreateController_+3A_supervisor">supervisor</code></td>
<td>
<p><code>Supervisor</code> object, see <a href="#topic+CreateSupervisor">CreateSupervisor</a></p>
</td></tr>
<tr><td><code id="CreateController_+3A_ctrl.id">ctrl.id</code></td>
<td>
<p><a href="base.html#topic+character">character</a> id of the controller (see Details)</p>
</td></tr>
<tr><td><code id="CreateController_+3A_y">Y</code></td>
<td>
<p><a href="base.html#topic+character">character</a> location of the controlled and/or measured variables in the model.</p>
</td></tr>
<tr><td><code id="CreateController_+3A_u">U</code></td>
<td>
<p><a href="base.html#topic+character">character</a> location of the command variables in the model.</p>
</td></tr>
<tr><td><code id="CreateController_+3A_fun">FUN</code></td>
<td>
<p><a href="base.html#topic+function">function</a> controller logic which calculates <code>U</code> from <code>Y</code> (see Details)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>ctrl.id</code> is a unique id for finding the controller in the supervisor.
If a controller with the same id already exists, it is overwritten by this new one.
</p>
<p><code>FUN</code> should be a function with one <a href="base.html#topic+numeric">numeric</a> parameter.
This parameter will receive the measured values of at <code>Y</code> locations as input
for the previous time step and returns calculated <code>U</code>. These <code>U</code> will then be applied
at their location for the current time step of calculation of the model.
</p>
<p>See <a href="#topic+RunModel.Supervisor">RunModel.Supervisor</a> and vignettes for examples of use.
</p>


<h3>Value</h3>

<p>a <code>Controller</code> object which is a list with the following items:
</p>

<ul>
<li> <p><code>id</code> <a href="base.html#topic+character">character</a>: the controller identifier
</p>
</li>
<li> <p><code>U</code> <a href="base.html#topic+matrix">matrix</a>: the list of controls for command variables with each column being the location of the variables and the rows being
the values of the variable for the current time steps (empty by default)
</p>
</li>
<li> <p><code>Unames</code> <a href="base.html#topic+character">character</a>: location of the command variables
</p>
</li>
<li> <p><code>Y</code> <a href="base.html#topic+matrix">matrix</a>: the lists of controls for controlled variables with each column being the location of the variables and the rows being
the values of the variable for the current time steps (empty by default)
</p>
</li>
<li> <p><code>Ynames</code> <a href="base.html#topic+character">character</a>: location of the controlled variables
</p>
</li>
<li> <p><code>FUN</code> <a href="base.html#topic+function">function</a>: controller logic which calculates <code>U</code> from <code>Y</code>
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+RunModel.Supervisor">RunModel.Supervisor()</a></code>, <code><a href="#topic+CreateSupervisor">CreateSupervisor()</a></code>
</p>

<hr>
<h2 id='CreateGRiwrm'>Generation of a network description containing all hydraulic nodes and the
description of their connections</h2><span id='topic+CreateGRiwrm'></span><span id='topic+GRiwrm'></span>

<h3>Description</h3>

<p>Generation of a network description containing all hydraulic nodes and the
description of their connections
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CreateGRiwrm(
  db,
  cols = list(id = "id", down = "down", length = "length", area = "area", model =
    "model", donor = "donor"),
  keep_all = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="CreateGRiwrm_+3A_db">db</code></td>
<td>
<p><a href="base.html#topic+data.frame">data.frame</a> description of the network (See details)</p>
</td></tr>
<tr><td><code id="CreateGRiwrm_+3A_cols">cols</code></td>
<td>
<p><a href="base.html#topic+list">list</a> or <a href="base.html#topic+vector">vector</a> columns of <code>db</code>. By default, mandatory column
names are: <code>id</code>, <code>down</code>, <code>length</code>, <code>area</code> and <code>model</code>. Other names can be
handled with a named list or vector containing items defined as <code>"required name" = "column name in db"</code> (See details)</p>
</td></tr>
<tr><td><code id="CreateGRiwrm_+3A_keep_all">keep_all</code></td>
<td>
<p><a href="base.html#topic+logical">logical</a> indicating if all columns of <code>db</code> should be kept
or if only columns defined in <code>cols</code> should be kept</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>db</code> is a <a href="base.html#topic+data.frame">data.frame</a> which at least contains in its columns:
</p>

<ul>
<li><p> a node identifier (column <code>id</code>),
</p>
</li>
<li><p> the identifier and the hydraulic distance to the downstream node
(<a href="base.html#topic+character">character</a> columns <code>down</code> and <a href="base.html#topic+numeric">numeric</a> columns <code>length</code> in km). The
last downstream node should have fields <code>down</code> and <code>length</code> set to <code>NA</code>,
</p>
</li>
<li><p> the total area of the basin at the node location (<a href="base.html#topic+numeric">numeric</a> column <code>area</code> in km2).
Direct injection node can have a null area defined by <code>NA</code>
</p>
</li>
<li><p> the model to use (<a href="base.html#topic+character">character</a> column <code>model</code>), see section below for details
</p>
</li></ul>

<p>An optional column <code>donor</code> can be used to manually define which sub-basin
will give its parameters to an ungauged node (See <code>Ungauged</code> model below).
</p>


<h4>Available models in airGRiwrm</h4>

<p>The &quot;model&quot; column should be filled by one of the following:
</p>

<ul>
<li><p> One of the hydrological models available in the <strong>airGR</strong> package defined by its
<code>RunModel</code> function (i.e.: <code>RunModel_GR4J</code>, <code>RunModel_GR5HCemaneige</code>...)
</p>
</li>
<li> <p><code>RunModel_Reservoir</code> for simulating a reservoir (See: <a href="#topic+RunModel_Reservoir">RunModel_Reservoir</a>)
</p>
</li>
<li> <p><code>Ungauged</code> for an ungauged node. The sub-basin inherits hydrological model and
parameters from a &quot;donor&quot; sub-basin. If not defined by the user in the column <code>donor</code>,
the donor is automatically set to the first gauged node at downstream.
This set of sub-basins with the same donor downstream then forms an ungauged
node cluster that will be calibrated at once.
</p>
</li>
<li> <p><code>NA</code> for injecting (or abstracting) a flow time series at the location of the node
(direct flow injection)
</p>
</li>
<li> <p><code>Diversion</code> for abstracting a flow time series from an existing node transfer it
to another node. As a <code>Diversion</code> is attached to an existing node, this node is
then described with 2 lines: one for the hydrological model and another one for the
diversion
</p>
</li></ul>




<h3>Value</h3>

<p><a href="base.html#topic+data.frame">data.frame</a> of class <code>GRiwrm</code> describing the airGR semi-distributed
model network, with each line corresponding to a location on the river
network and with the following columns:
</p>

<ul>
<li> <p><code>id</code> (<a href="base.html#topic+character">character</a>): node identifier
</p>
</li>
<li> <p><code>down</code> (<a href="base.html#topic+character">character</a>): identifier of the node downstream of the current
node (<a href="base.html#topic+NA">NA</a> for the most downstream node)
</p>
</li>
<li> <p><code>length</code> (<a href="base.html#topic+numeric">numeric</a>): hydraulic distance to the downstream node in km
(<a href="base.html#topic+NA">NA</a> for the most downstream node)
</p>
</li>
<li> <p><code>area</code> (<a href="base.html#topic+numeric">numeric</a>): total area of the basin starting from the current
node location in km2
</p>
</li>
<li> <p><code>model</code> (<a href="base.html#topic+character">character</a>): hydrological model to use (<a href="base.html#topic+NA">NA</a> for using observed
flow instead of a runoff model output)
</p>
</li>
<li> <p><code>donor</code> (<a href="base.html#topic+character">character</a>): node used as model and calibration parameter &quot;donor&quot; for
ungauged nodes. For other types of nodes, if the donor is different than the
id, it indicates that the node is embedded in an ungauged node cluster.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>library(airGRiwrm)

#########################################
# Network of 2 nodes distant of 150 km: #
#########################################
# - an upstream reservoir modeled as a direct flow injection (no model)
# - a gauging station downstream a catchment of 360 km² modeled with GR4J
db &lt;- data.frame(id = c("Reservoir", "GaugingDown"),
                 length = c(150, NA),
                 down = c("GaugingDown", NA),
                 area = c(NA, 360),
                 model = c(NA, "RunModel_GR4J"),
                 stringsAsFactors = FALSE)
griwrm_basic &lt;- CreateGRiwrm(db)
griwrm_basic
# Network diagram with direct flow node in red, intermediate sub-basin in green
## Not run: 
plot(griwrm_basic)

## End(Not run)

###################################################
# GR4J semi-distributed model of the Severn River #
###################################################
data(Severn)
nodes &lt;- Severn$BasinsInfo
nodes$model &lt;- "RunModel_GR4J"
str(nodes)
# Mismatch column names are renamed to stick with GRiwrm requirements
rename_columns &lt;- list(id = "gauge_id",
                       down = "downstream_id",
                       length = "distance_downstream")
griwrm_severn &lt;- CreateGRiwrm(nodes, rename_columns)
griwrm_severn
# Network diagram with upstream basin nodes in blue, intermediate sub-basin in green
## Not run: 
plot(griwrm_severn)

## End(Not run)

####################################################################
# Severn network with an ungauged station at nodes 54029 and 54001 #
####################################################################
nodes_ungauged &lt;- nodes
nodes_ungauged$model[nodes_ungauged$gauge_id %in% c("54029", "54001")] &lt;- "Ungauged"
# By default the first gauged node at downstream is used for parameter calibration (54032)
# Add a `donor`column for defining manually an upstream or sibling donor
nodes_ungauged$donor &lt;- as.character(NA)
nodes_ungauged$donor[nodes_ungauged$id == "54001"] &lt;- "54095"
griwrm_ungauged &lt;- CreateGRiwrm(nodes_ungauged, rename_columns)
griwrm_ungauged
# Network diagram with gauged nodes of vivid color, and ungauged nodes of dull color
## Not run: 
plot(griwrm_ungauged)

## End(Not run)

###########################################################
# Severn network with a Diversion on the node "54029"     #
# to a reservoir which transfer flows to the node "54001" #
# and a withdrawal on the reservoir                       #
###########################################################
nodes_div &lt;- nodes[, c("gauge_id", "downstream_id", "distance_downstream", "model", "area")]
nodes_div &lt;- rbind(
  nodes_div,
  data.frame(gauge_id            = c("54029"    , "Reservoir"         , "Irrigation_Pump"),
             downstream_id       = c("Reservoir", "54001"             , "Reservoir"      ),
             distance_downstream = c(10         , 5                   , 0                ),
             model               = c("Diversion", "RunModel_Reservoir", NA      ),
             area                = c(NA         , NA                  , NA))
)
griwrm_div &lt;- CreateGRiwrm(nodes_div, rename_columns)
# Network diagram figures Diversion node by a red frame and a red arrow
## Not run: 
plot(griwrm_div, orientation = "TB")

## End(Not run)

# It's also possible to custom the diagram's look with mermaid directives
# (See details in plot.GRiwrm help topic)
## Not run: 
plot(
  griwrm_div,
  header = "%%{init: {'flowchart': {'nodeSpacing': 30, 'rankSpacing': 30, 'curve': 'linear'}}}%%"
)

## End(Not run)
</code></pre>

<hr>
<h2 id='CreateInputsCrit.GRiwrmInputsModel'>Creation of the InputsCrit object required to the <code>ErrorCrit</code> functions</h2><span id='topic+CreateInputsCrit.GRiwrmInputsModel'></span><span id='topic+CreateInputsCrit.InputsModel'></span><span id='topic+CreateInputsCrit'></span>

<h3>Description</h3>

<p>This function can be used either for a catchment (with an <em>InputsModel</em> object) or for a network (with a <em>GRiwrmInputsModel</em> object)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'GRiwrmInputsModel'
CreateInputsCrit(
  InputsModel,
  FUN_CRIT = ErrorCrit_NSE,
  RunOptions,
  Obs,
  AprioriIds = NULL,
  k = 0.15,
  AprCelerity = 1,
  ...
)

## S3 method for class 'InputsModel'
CreateInputsCrit(InputsModel, FUN_CRIT, ...)

CreateInputsCrit(InputsModel, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="CreateInputsCrit.GRiwrmInputsModel_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>object of class <em>InputsModel</em> or <em>GRiwrmInputsModel</em>. See <a href="#topic+CreateInputsModel">CreateInputsModel</a></p>
</td></tr>
<tr><td><code id="CreateInputsCrit.GRiwrmInputsModel_+3A_fun_crit">FUN_CRIT</code></td>
<td>
<p>[function (atomic or list)] error criterion function (e.g. <a href="airGR.html#topic+ErrorCrit_RMSE">airGR::ErrorCrit_RMSE</a>, <a href="airGR.html#topic+ErrorCrit_NSE">airGR::ErrorCrit_NSE</a>)</p>
</td></tr>
<tr><td><code id="CreateInputsCrit.GRiwrmInputsModel_+3A_runoptions">RunOptions</code></td>
<td>
<p>object of class <em>RunOptions</em> or <em>GRiwrmRunOptions</em>, see <a href="#topic+CreateRunOptions">CreateRunOptions</a></p>
</td></tr>
<tr><td><code id="CreateInputsCrit.GRiwrmInputsModel_+3A_obs">Obs</code></td>
<td>
<p><a href="base.html#topic+numeric">numeric</a>, <a href="base.html#topic+matrix">matrix</a> or <a href="base.html#topic+data.frame">data.frame</a> series of observed flows, see details</p>
</td></tr>
<tr><td><code id="CreateInputsCrit.GRiwrmInputsModel_+3A_aprioriids">AprioriIds</code></td>
<td>
<p>(optional) named <a href="base.html#topic+list">list</a> or named <a href="base.html#topic+vector">vector</a> of <a href="base.html#topic+character">character</a> used for the parameter regularization (see details)</p>
</td></tr>
<tr><td><code id="CreateInputsCrit.GRiwrmInputsModel_+3A_k">k</code></td>
<td>
<p>(optional) <a href="base.html#topic+numeric">numeric</a> weight coefficient used in the parameter regularization (See <a href="airGR.html#topic+CreateInputsCrit_Lavenne">airGR::CreateInputsCrit_Lavenne</a>)</p>
</td></tr>
<tr><td><code id="CreateInputsCrit.GRiwrmInputsModel_+3A_aprcelerity">AprCelerity</code></td>
<td>
<p>(optional) <a href="base.html#topic+numeric">numeric</a> Default celerity used as a priori parameter for upstream catchments</p>
</td></tr>
<tr><td><code id="CreateInputsCrit.GRiwrmInputsModel_+3A_...">...</code></td>
<td>
<p>arguments passed to <a href="airGR.html#topic+CreateInputsCrit">airGR::CreateInputsCrit</a>, see details</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <a href="airGR.html#topic+CreateInputsCrit">airGR::CreateInputsCrit</a> documentation for a complete list of arguments.
</p>
<p><code>Obs</code> argument is equivalent to the same argument in <a href="airGR.html#topic+CreateInputsCrit">airGR::CreateInputsCrit</a> except that it must be a <a href="base.html#topic+matrix">matrix</a> or a <a href="base.html#topic+data.frame">data.frame</a> if <code>InputsModel</code> is a <em>GRiwrmInputsModel</em> object.
Then, each column of the <a href="base.html#topic+matrix">matrix</a> or <a href="base.html#topic+data.frame">data.frame</a> represents the observations of one of the simulated node with the name of the columns representing the id of each node.
</p>
<p>With a <em>GRiwrmInputsModel</em> object, all arguments are applied on each sub-catchments of the network.
</p>
<p>Parameter regularization consists of defining a priori parameters which are
used in a composed criterion based on the formula proposed by
Lavenne et al. (2019) (See <a href="airGR.html#topic+CreateInputsCrit_Lavenne">airGR::CreateInputsCrit_Lavenne</a>).
The parameter <code>AprioriIds</code> allows to define which neighbor sub-catchment is
used for providing a priori parameters.
Its format is as follows:
<code>AprioriIds &lt;- c("Downstream sub-catchment 1" = "A priori upstream sub-catchment 1", ...)</code>
where the quoted strings are the ids of the sub-catchments.
The node providing a priori parameters must be calibrated before the
current one.
The sequence order of calibration can be checked with <a href="#topic+getNodeRanking">getNodeRanking</a>.
If the latter is not adequate, this order can be forced by setting the node providing
a priori parameters as donor of the current node in <a href="#topic+CreateGRiwrm">CreateGRiwrm</a>.
See vignettes for more details.
The parameter <code>AprCelerity</code> is a default value used as a priori for the
parameter 'Celerity' in case of an upstream catchment (without celerity parameter)
is used as a priori catchment.
</p>


<h3>Value</h3>

<p>Depending on the class of <code>InputsModel</code> argument (respectively <code>InputsModel</code> and <code>GRiwrmInputsModel</code> object), the returned value is respectively:
</p>

<ul>
<li><p> a <code>InputsCrit</code> object (See <a href="airGR.html#topic+CreateInputsCrit">airGR::CreateInputsCrit</a>)
</p>
</li>
<li><p> a <code>GRiwrmInputsCrit</code> object which is a <a href="base.html#topic+list">list</a> of <code>InputsCrit</code> objects with one item per modeled sub-catchment
</p>
</li></ul>



<h3>References</h3>

<p>De Lavenne, A., Andréassian, V., Thirel, G., Ramos, M.-H., Perrin, C., 2019. A Regularization Approach to Improve the Sequential Calibration of a Semidistributed Hydrological Model. Water Resources Research 55, 8821–8839. <a href="https://doi.org/10.1029/2018WR024266">doi:10.1029/2018WR024266</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+CreateGRiwrm">CreateGRiwrm()</a></code>, <code><a href="#topic+CreateInputsModel.GRiwrm">CreateInputsModel.GRiwrm()</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions()</a></code>, <code><a href="#topic+CreateCalibOptions">CreateCalibOptions()</a></code>, <code><a href="#topic+Calibration">Calibration()</a></code>
</p>

<hr>
<h2 id='CreateInputsModel'>Generic function for creating <code>InputsModel</code> object for either <strong>airGR</strong> or <strong>airGRiwrm</strong></h2><span id='topic+CreateInputsModel'></span><span id='topic+CreateInputsModel.default'></span>

<h3>Description</h3>

<p>See the methods <a href="#topic+CreateInputsModel.GRiwrm">CreateInputsModel.GRiwrm</a> for <strong>airGRiwrm</strong> and <a href="airGR.html#topic+CreateInputsModel">airGR::CreateInputsModel</a> for <strong>airGR</strong>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CreateInputsModel(x, ...)

## Default S3 method:
CreateInputsModel(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="CreateInputsModel_+3A_x">x</code></td>
<td>
<p>First parameter determining which InputsModel object is created</p>
</td></tr>
<tr><td><code id="CreateInputsModel_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>InputsModel or GRiwrmInputsObject object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+CreateInputsModel.GRiwrm">CreateInputsModel.GRiwrm()</a></code>, <code><a href="airGR.html#topic+CreateInputsModel">airGR::CreateInputsModel()</a></code>
</p>

<hr>
<h2 id='CreateInputsModel.GRiwrm'>Creation of an InputsModel object for a <strong>airGRiwrm</strong> network</h2><span id='topic+CreateInputsModel.GRiwrm'></span>

<h3>Description</h3>

<p>Creation of an InputsModel object for a <strong>airGRiwrm</strong> network
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'GRiwrm'
CreateInputsModel(
  x,
  DatesR,
  Precip = NULL,
  PotEvap = NULL,
  Qinf = NULL,
  Qobs = NULL,
  Qmin = NULL,
  Qrelease = NULL,
  PrecipScale = TRUE,
  TempMean = NULL,
  TempMin = NULL,
  TempMax = NULL,
  ZInputs = NULL,
  HypsoData = NULL,
  NLayers = 5,
  IsHyst = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_x">x</code></td>
<td>
<p>[GRiwrm object] diagram of the semi-distributed model (See <a href="#topic+CreateGRiwrm">CreateGRiwrm</a>)</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_datesr">DatesR</code></td>
<td>
<p><a href="base.html#topic+POSIXt">POSIXt</a> vector of dates</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_precip">Precip</code></td>
<td>
<p>(optional) <a href="base.html#topic+matrix">matrix</a> or <a href="base.html#topic+data.frame">data.frame</a> of <a href="base.html#topic+numeric">numeric</a> containing
precipitation in [mm per time step]. Column names correspond to node IDs</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_potevap">PotEvap</code></td>
<td>
<p>(optional) <a href="base.html#topic+matrix">matrix</a> or <a href="base.html#topic+data.frame">data.frame</a> of <a href="base.html#topic+numeric">numeric</a> containing
potential evaporation [mm per time step]. Column names correspond to node IDs</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_qinf">Qinf</code></td>
<td>
<p>(optional) <a href="base.html#topic+matrix">matrix</a> or <a href="base.html#topic+data.frame">data.frame</a> of <a href="base.html#topic+numeric">numeric</a> containing
observed flows. It must be provided only for nodes of type &quot;Direct
injection&quot; and &quot;Diversion&quot;. See <a href="#topic+CreateGRiwrm">CreateGRiwrm</a> for
details about these node types. Unit is [mm per time step] for nodes
with an area, and [m3 per time step] for nodes with <code>area=NA</code>.
Column names correspond to node IDs. Negative flows are abstracted from
the model and positive flows are injected to the model</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_qobs">Qobs</code></td>
<td>
<p>(deprecated) use <code>Qinf</code> instead</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_qmin">Qmin</code></td>
<td>
<p>(optional) <a href="base.html#topic+matrix">matrix</a> or <a href="base.html#topic+data.frame">data.frame</a> of <a href="base.html#topic+numeric">numeric</a> containing
minimum flows to let downstream of a node with a Diversion [m3 per
time step]. Default is zero. Column names correspond to node IDs</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_qrelease">Qrelease</code></td>
<td>
<p>(optional) <a href="base.html#topic+matrix">matrix</a> or <a href="base.html#topic+data.frame">data.frame</a> of <a href="base.html#topic+numeric">numeric</a> containing
release flows by nodes using the model <code>RunModel_Reservoir</code> [m3 per
time step]</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_precipscale">PrecipScale</code></td>
<td>
<p>(optional) named <a href="base.html#topic+vector">vector</a> of <a href="base.html#topic+logical">logical</a> indicating if the
mean of the precipitation interpolated on the elevation layers must be
kept or not, required to create CemaNeige module inputs, default <code>TRUE</code>
(the mean of the precipitation is kept to the original value)</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_tempmean">TempMean</code></td>
<td>
<p>(optional) <a href="base.html#topic+matrix">matrix</a> or <a href="base.html#topic+data.frame">data.frame</a> of time series of mean
air temperature [°C], required to create the CemaNeige module inputs</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_tempmin">TempMin</code></td>
<td>
<p>(optional) <a href="base.html#topic+matrix">matrix</a> or <a href="base.html#topic+data.frame">data.frame</a> of time series of minimum
air temperature [°C], possibly used to create the CemaNeige module inputs</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_tempmax">TempMax</code></td>
<td>
<p>(optional) <a href="base.html#topic+matrix">matrix</a> or <a href="base.html#topic+data.frame">data.frame</a> of time series of maximum
air temperature [°C], possibly used to create the CemaNeige module inputs</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_zinputs">ZInputs</code></td>
<td>
<p>(optional) named <a href="base.html#topic+vector">vector</a> of <a href="base.html#topic+numeric">numeric</a> giving the mean
elevation of the Precip and Temp series (before extrapolation) [m],
possibly used to create the CemaNeige module input</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_hypsodata">HypsoData</code></td>
<td>
<p>(optional) <a href="base.html#topic+matrix">matrix</a> or <a href="base.html#topic+data.frame">data.frame</a> containing 101 <a href="base.html#topic+numeric">numeric</a>
rows: min, q01 to q99 and max of catchment elevation distribution [m],
if not defined a single elevation is used for CemaNeige</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_nlayers">NLayers</code></td>
<td>
<p>(optional) named <a href="base.html#topic+vector">vector</a> of <a href="base.html#topic+numeric">numeric</a> integer giving the number
of elevation layers requested <a href="base.html#topic+-">-</a>, required to create CemaNeige module
inputs, default=5</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_ishyst">IsHyst</code></td>
<td>
<p><a href="base.html#topic+logical">logical</a> boolean indicating if the hysteresis version of
CemaNeige is used. See details of <a href="airGR.html#topic+CreateRunOptions">airGR::CreateRunOptions</a>.</p>
</td></tr>
<tr><td><code id="CreateInputsModel.GRiwrm_+3A_...">...</code></td>
<td>
<p>used for compatibility with S3 methods</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Meteorological data are needed for the nodes of the network that
represent a catchment simulated by a rainfall-runoff model. Instead of
<a href="airGR.html#topic+CreateInputsModel">airGR::CreateInputsModel</a> that has <a href="base.html#topic+numeric">numeric</a> <a href="base.html#topic+vector">vector</a> as time series inputs,
this function uses <a href="base.html#topic+matrix">matrix</a> or <a href="base.html#topic+data.frame">data.frame</a> with the id of the sub-catchment
as column names. For single values (<code>ZInputs</code> or <code>NLayers</code>), the function
requires named <a href="base.html#topic+vector">vector</a> with the id of the sub-catchment as name item. If an
argument is optional, only the column or the named item has to be provided.
</p>
<p>See <a href="airGR.html#topic+CreateInputsModel">airGR::CreateInputsModel</a> documentation for details concerning each input.
</p>
<p>Number of rows of <code>Precip</code>, <code>PotEvap</code>, <code>Qinf</code>, <code>Qmin</code>, <code>TempMean</code>, <code>TempMin</code>,
<code>TempMax</code> must be the same of the length of <code>DatesR</code> (each row corresponds to
a time step defined in <code>DatesR</code>).
</p>
<p>For examples of use see topics <a href="#topic+RunModel.GRiwrmInputsModel">RunModel.GRiwrmInputsModel</a>, <a href="#topic+RunModel_Reservoir">RunModel_Reservoir</a>,
and <a href="#topic+RunModel.Supervisor">RunModel.Supervisor</a>.
</p>
<p>For example of use of Direct Injection nodes, see vignettes
&quot;V03_Open-loop_influenced_flow&quot; and &quot;V04_Closed-loop_regulated_withdrawal&quot;.
</p>
<p>For example of use of Diversion nodes, see example in
<a href="#topic+RunModel.GRiwrmInputsModel">RunModel.GRiwrmInputsModel</a> topic and vignette
&quot;V06_Modelling_regulated_diversion&quot;.
</p>


<h3>Value</h3>

<p>A <em>GRiwrmInputsModel</em> object which is a list of <em>InputsModel</em>
objects created by <a href="airGR.html#topic+CreateInputsModel">airGR::CreateInputsModel</a> with one item per modeled sub-catchment.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+CreateGRiwrm">CreateGRiwrm()</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions()</a></code>, <code><a href="#topic+RunModel.GRiwrmInputsModel">RunModel.GRiwrmInputsModel()</a></code>
</p>

<hr>
<h2 id='CreateRunOptions.GRiwrmInputsModel'>Creation of the RunOptions object</h2><span id='topic+CreateRunOptions.GRiwrmInputsModel'></span><span id='topic+CreateRunOptions'></span><span id='topic+CreateRunOptions.InputsModel'></span><span id='topic+CreateRunOptions.character'></span><span id='topic+CreateRunOptions.function'></span>

<h3>Description</h3>

<p>This function can be used either for a catchment (with an <em>InputsModel</em> object) or for a network (with a <em>GRiwrmInputsModel</em> object)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'GRiwrmInputsModel'
CreateRunOptions(x, IniStates = NULL, ...)

CreateRunOptions(x, ...)

## S3 method for class 'InputsModel'
CreateRunOptions(x, ...)

## S3 method for class 'character'
CreateRunOptions(x, InputsModel, ...)

## S3 method for class ''function''
CreateRunOptions(x, InputsModel, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="CreateRunOptions.GRiwrmInputsModel_+3A_x">x</code></td>
<td>
<p>For a single catchment, it can be an object of class <em>InputsModel</em> or a <a href="base.html#topic+function">function</a> or a <a href="base.html#topic+character">character</a> corresponding to <code>FUN_MOD</code> (compliant with <strong>airGR</strong> call). For a network, it should be an object of class <em>GRiwrmInputsModel</em>. See <a href="#topic+CreateInputsModel">CreateInputsModel</a> for details</p>
</td></tr>
<tr><td><code id="CreateRunOptions.GRiwrmInputsModel_+3A_inistates">IniStates</code></td>
<td>
<p>(optional) <a href="base.html#topic+numeric">numeric</a> object or <a href="base.html#topic+list">list</a> of <a href="base.html#topic+numeric">numeric</a> object of class <em>IniStates</em>, see <a href="airGR.html#topic+CreateIniStates">airGR::CreateIniStates</a> for details</p>
</td></tr>
<tr><td><code id="CreateRunOptions.GRiwrmInputsModel_+3A_...">...</code></td>
<td>
<p>arguments passed to <a href="airGR.html#topic+CreateRunOptions">airGR::CreateRunOptions</a>, see details</p>
</td></tr>
<tr><td><code id="CreateRunOptions.GRiwrmInputsModel_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>object of class <em>InputsModel</em> (only used to be consistent
with the original <a href="airGR.html#topic+CreateRunOptions">airGR::CreateRunOptions</a> which has <code>FUN_MOD</code> as first
parameter)
see <a href="airGR.html#topic+CreateInputsModel">airGR::CreateInputsModel</a> for details</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <a href="airGR.html#topic+CreateRunOptions">airGR::CreateRunOptions</a> documentation for a complete list of arguments.
</p>
<p>If <code>x</code> argument is a <em>GRiwrmInputsModel</em> object, <code>IniStates</code> must be a
list of <a href="base.html#topic+numeric">numeric</a> object of class <em>IniStates</em> with one item per modeled sub-catchment.
</p>
<p>With a <em>GRiwrmInputsModel</em> object, all arguments are applied on each
sub-catchments of the network.
</p>
<p>For examples of use see topics <a href="#topic+RunModel.GRiwrmInputsModel">RunModel.GRiwrmInputsModel</a>, <a href="#topic+RunModel_Reservoir">RunModel_Reservoir</a>,
and <a href="#topic+RunModel.Supervisor">RunModel.Supervisor</a>.
</p>


<h3>Value</h3>

<p>Depending on the class of <code>InputsModel</code> argument (respectively
<em>InputsModel</em> and <em>GRiwrmInputsModel</em> object), the returned value is respectively:
</p>

<ul>
<li><p> a <code>RunOptions</code> object (See <a href="airGR.html#topic+CreateRunOptions">airGR::CreateRunOptions</a>)
</p>
</li>
<li><p> a <code>GRiwrmRunOptions</code> object which is a <a href="base.html#topic+list">list</a> of <code>RunOptions</code> objects with one item per modeled sub-catchment
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+CreateGRiwrm">CreateGRiwrm()</a></code>, <code><a href="#topic+CreateInputsModel.GRiwrm">CreateInputsModel.GRiwrm()</a></code>, <code><a href="#topic+RunModel.GRiwrmInputsModel">RunModel.GRiwrmInputsModel()</a></code>
</p>

<hr>
<h2 id='CreateSupervisor'>Creation of a Supervisor for handling regulation in a model</h2><span id='topic+CreateSupervisor'></span>

<h3>Description</h3>

<p>Creation of a Supervisor for handling regulation in a model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CreateSupervisor(InputsModel, TimeStep = 1L)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="CreateSupervisor_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of type <code>GRiwrmInputsModel</code>] inputs of the model</p>
</td></tr>
<tr><td><code id="CreateSupervisor_+3A_timestep">TimeStep</code></td>
<td>
<p><a href="base.html#topic+numeric">numeric</a> number of time steps between each supervision</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <a href="#topic+RunModel.Supervisor">RunModel.Supervisor</a> and vignettes for examples of use.
</p>


<h3>Value</h3>

<p>A <code>Supervisor</code> object which is an <a href="base.html#topic+environment">environment</a> containing all the necessary variables to run a supervised simulation, such as:
</p>

<ul>
<li> <p><code>DatesR</code> <a href="base.html#topic+POSIXct">POSIXct</a>: vector of date from <code>InputsModel</code>
</p>
</li>
<li> <p><code>InputsModel</code>: a copy of <code>InputsModel</code> provided by <a href="#topic+CreateInputsModel.GRiwrm">CreateInputsModel.GRiwrm</a>
</p>
</li>
<li> <p><code>griwrm</code>: a copy of <code>griwrm</code> provided by <a href="#topic+CreateGRiwrm">CreateGRiwrm</a>
</p>
</li>
<li> <p><code>Controllers</code> <a href="base.html#topic+list">list</a>: list of the controllers used in the supervised simulation (See <a href="#topic+CreateController">CreateController</a>)
</p>
</li>
<li><p> some internal state variables updated during simulation (<code>ts.index</code>, <code>ts.previous</code>, <code>ts.date</code>, <code>ts.index0</code>, <code>controller.id</code>)
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+RunModel.Supervisor">RunModel.Supervisor()</a></code>, <code><a href="#topic+CreateController">CreateController()</a></code>
</p>

<hr>
<h2 id='extractParam'>Extract calibrated parameters</h2><span id='topic+extractParam'></span>

<h3>Description</h3>

<p>Extract <a href="base.html#topic+list">list</a> of parameters from the output of <a href="#topic+Calibration.GRiwrmInputsModel">Calibration.GRiwrmInputsModel</a>
which can be directly used as argument <code>Param</code> of <a href="#topic+RunModel.GRiwrmInputsModel">RunModel.GRiwrmInputsModel</a>
and <a href="#topic+RunModel.Supervisor">RunModel.Supervisor</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extractParam(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="extractParam_+3A_x">x</code></td>
<td>
<p>A <em>GRiwrmOutputsModel</em> object returned by <a href="#topic+Calibration.GRiwrmInputsModel">Calibration.GRiwrmInputsModel</a></p>
</td></tr>
</table>


<h3>Details</h3>

<p>See vignettes and example of <a href="#topic+RunModel_Reservoir">RunModel_Reservoir</a> for examples of use.
</p>


<h3>Value</h3>

<p>A named <a href="base.html#topic+list">list</a> of <a href="base.html#topic+numeric">numeric</a> <a href="base.html#topic+vector">vector</a> containing the calibrated parameters
of each modeled node.
</p>


<h3>See Also</h3>

<p><a href="#topic+Calibration">Calibration</a>, <a href="#topic+RunModel.GRiwrmInputsModel">RunModel.GRiwrmInputsModel</a>, <a href="#topic+RunModel.Supervisor">RunModel.Supervisor</a>
</p>

<hr>
<h2 id='getNodeProperties'>Properties of GRiwrm nodes</h2><span id='topic+getNodeProperties'></span><span id='topic+getAllNodesProperties'></span>

<h3>Description</h3>

<p><code>getNodeProperties</code> returns properties of a single node, and
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getNodeProperties(id, griwrm)

getAllNodesProperties(griwrm)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="getNodeProperties_+3A_id">id</code></td>
<td>
<p><a href="base.html#topic+character">character</a> Id of the node in the GRiwrm object</p>
</td></tr>
<tr><td><code id="getNodeProperties_+3A_griwrm">griwrm</code></td>
<td>
<p>[GRiwrm object] describing the network of the semi-distributed model (See <a href="#topic+CreateGRiwrm">CreateGRiwrm</a>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A &quot;Gauged&quot; node is either a node containing a model that is already
calibrated (parameters are already fixed) or a node containing a model where
observations are available for calibration.
</p>
<p>A &quot;Ungauged&quot; node is a node containing a model which derives its parameters from
another &quot;donor&quot; node.
</p>


<h3>Value</h3>

<p><code>getNodeProperties</code> returns a <a href="base.html#topic+list">list</a> with the following items:
</p>

<ul>
<li><p> &quot;position&quot; (<a href="base.html#topic+character">character</a>): Position of the node in the network (&quot;Upstream&quot; or &quot;Intermediate&quot;)
</p>
</li>
<li><p> &quot;DirectInjection&quot; (<a href="base.html#topic+logical">logical</a>): is the node a Direct Injection node?
</p>
</li>
<li><p> &quot;Diversion&quot; (<a href="base.html#topic+logical">logical</a>): is the node a Diversion node?
</p>
</li>
<li><p> &quot;Reservoir&quot; (<a href="base.html#topic+logical">logical</a>): is the node a Reservoir?
</p>
</li>
<li><p> &quot;airGR&quot; (<a href="base.html#topic+logical">logical</a>): is the node contains an airGR model?
</p>
</li>
<li><p> &quot;calibration&quot; (<a href="base.html#topic+character">character</a>): describe if the node is a &quot;Gauged&quot;, or an &quot;Ungauged&quot; station,
(see details), or &quot;NA&quot; otherwise
</p>
</li>
<li><p> &quot;Upstream&quot; (<a href="base.html#topic+logical">logical</a>): is the node an upstream node?
</p>
</li>
<li><p> &quot;RunOff&quot; (<a href="base.html#topic+logical">logical</a>): is the node contains an hydrological model?
</p>
</li></ul>

<p><code>getAllNodesProperties</code> returns a <a href="base.html#topic+data.frame">data.frame</a> constituted from the list returned
by <code>getNodeProperties</code> for all nodes.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+CreateGRiwrm">CreateGRiwrm()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>###############################################################################
# Severn network with :                                                       #
# - a Diversion on the node "54001" which transfer flows to the node "540029" #
# - node 54002 as a Direct Injection node                                     #
###############################################################################
data(Severn)
nodes &lt;- Severn$BasinsInfo
nodes$model &lt;- "RunModel_GR4J"
str(nodes)
nodes &lt;- nodes[, c("gauge_id", "downstream_id", "distance_downstream", "model", "area")]
# Add a Diversion node from node "54001" to "54029"
nodes &lt;- rbind(nodes,
               data.frame(
                 gauge_id = "54001",
                 downstream_id = "54029",
                 distance_downstream = 20,
                 model = "Diversion",
                 area = NA
               ))
# Set node '54002' as a Direct Injection node
nodes$model[nodes$id == "54002"] &lt;- NA
# Mismatch column names are renamed to stick with GRiwrm requirements
rename_columns &lt;- list(id = "gauge_id",
                       down = "downstream_id",
                       length = "distance_downstream")
# Create GRiwrm object and display properties
griwrm &lt;- CreateGRiwrm(nodes, rename_columns)

str(getNodeProperties("54001", griwrm))

getAllNodesProperties(griwrm)
</code></pre>

<hr>
<h2 id='getNodeRanking'>Sorting of the nodes from upstream to downstream for RunModel and Calibration</h2><span id='topic+getNodeRanking'></span>

<h3>Description</h3>

<p>Sorting of the nodes from upstream to downstream for RunModel and Calibration
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getNodeRanking(griwrm)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="getNodeRanking_+3A_griwrm">griwrm</code></td>
<td>
<p>[object of class <code>GRiwrm</code>] see <a href="#topic+CreateGRiwrm">CreateGRiwrm</a> for details</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The sort is done by searching upstream nodes in the networks recursively.
Ungauged node clusters are processed by cluster and the algorithm tries to
process ungauged nodes which receive their parameters from upstream or
sibling node after their donor node.
Use <code>options(debug = TRUE)</code> to get details on how the sort is performed.
</p>


<h3>Value</h3>

<p>A <a href="base.html#topic+character">character</a> <a href="base.html#topic+vector">vector</a> containing ordered node ids
</p>


<h3>See Also</h3>

<p><code><a href="#topic+CreateGRiwrm">CreateGRiwrm()</a></code>
</p>

<hr>
<h2 id='getNoSD_Ids'>Function to obtain the ID of sub-basins not using SD model</h2><span id='topic+getNoSD_Ids'></span>

<h3>Description</h3>

<p>Function to obtain the ID of sub-basins not using SD model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getNoSD_Ids(InputsModel, include_diversion = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="getNoSD_Ids_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[<code>GRiwrmInputsModel</code> object]</p>
</td></tr>
<tr><td><code id="getNoSD_Ids_+3A_include_diversion">include_diversion</code></td>
<td>
<p><a href="base.html#topic+logical">logical</a> for including diversion nodes</p>
</td></tr>
</table>


<h3>Value</h3>

<p><a href="base.html#topic+character">character</a> IDs of the sub-basins not using the SD model
</p>

<hr>
<h2 id='getSD_Ids'>Function to obtain the ID of sub-basins using SD model</h2><span id='topic+getSD_Ids'></span>

<h3>Description</h3>

<p>Function to obtain the ID of sub-basins using SD model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getSD_Ids(InputsModel, add_diversions = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="getSD_Ids_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[<code>GRiwrmInputsModel</code> object]</p>
</td></tr>
<tr><td><code id="getSD_Ids_+3A_add_diversions">add_diversions</code></td>
<td>
<p><a href="base.html#topic+logical">logical</a> for adding upstream nodes with diversion</p>
</td></tr>
</table>


<h3>Value</h3>

<p><a href="base.html#topic+character">character</a> IDs of the sub-basins using SD model
</p>

<hr>
<h2 id='isNodeDownstream'>Check if a node is downstream or upstream another one</h2><span id='topic+isNodeDownstream'></span><span id='topic+isNodeDownstream.GRiwrmInputsModel'></span><span id='topic+isNodeDownstream.GRiwrm'></span><span id='topic+isNodeUpstream'></span><span id='topic+isNodeUpstream.GRiwrm'></span><span id='topic+isNodeUpstream.GRiwrmInputsModel'></span>

<h3>Description</h3>

<p>Check if a node is downstream or upstream another one
</p>


<h3>Usage</h3>

<pre><code class='language-R'>isNodeDownstream(x, current_node, candidate_node)

## S3 method for class 'GRiwrmInputsModel'
isNodeDownstream(x, current_node, candidate_node)

## S3 method for class 'GRiwrm'
isNodeDownstream(x, current_node, candidate_node)

isNodeUpstream(x, current_node, candidate_node)

## S3 method for class 'GRiwrm'
isNodeUpstream(x, current_node, candidate_node)

## S3 method for class 'GRiwrmInputsModel'
isNodeUpstream(x, current_node, candidate_node)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="isNodeDownstream_+3A_x">x</code></td>
<td>
<p>[<code>GRiwrmInputsModel</code> object] (see <a href="#topic+CreateInputsModel.GRiwrm">CreateInputsModel.GRiwrm</a>) or
[<code>GRiwrm</code> object] (See <a href="#topic+CreateGRiwrm">CreateGRiwrm</a>)</p>
</td></tr>
<tr><td><code id="isNodeDownstream_+3A_current_node">current_node</code></td>
<td>
<p><a href="base.html#topic+character">character</a> with the id of the current node</p>
</td></tr>
<tr><td><code id="isNodeDownstream_+3A_candidate_node">candidate_node</code></td>
<td>
<p><a href="base.html#topic+character">character</a> with the id of the node for which we want
to know if it is downstream or upstream <code>current_node</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p><a href="base.html#topic+logical">logical</a> <code>TRUE</code> if the node with the id <code>down_candidate</code> is downstream
or upstream the node with the id <code>current_node</code>
</p>

<hr>
<h2 id='mermaid'>Plot a mermaid diagram</h2><span id='topic+mermaid'></span><span id='topic+mermaid_gen_link'></span><span id='topic+plot.mermaid'></span>

<h3>Description</h3>

<p>These functions download the diagram from https://mermaid.ink which generates the image.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mermaid(
  diagram,
  format = "png",
  theme = "default",
  dir.dest = tempdir(),
  file.dest = paste0(rlang::hash(link), ".", format),
  link = mermaid_gen_link(diagram, theme = theme, format = format)
)

mermaid_gen_link(
  diagram,
  theme = "default",
  format = "png",
  server = "https://mermaid.ink"
)

## S3 method for class 'mermaid'
plot(x, add = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mermaid_+3A_diagram">diagram</code></td>
<td>
<p>Diagram in mermaid markdown-like language or file (as a connection or file name) containing a diagram specification</p>
</td></tr>
<tr><td><code id="mermaid_+3A_format">format</code></td>
<td>
<p>Image format (either <code>"jpg"</code>, or <code>"png"</code>, or <code>"svg"</code>)</p>
</td></tr>
<tr><td><code id="mermaid_+3A_theme">theme</code></td>
<td>
<p>Mermaid theme (See <a href="https://mermaid.js.org/config/theming.html#available-themes">available themes in Mermaid documentation</a>)</p>
</td></tr>
<tr><td><code id="mermaid_+3A_dir.dest">dir.dest</code></td>
<td>
<p>Destination folder for the downloaded image. This parameter is
ignored if <code>file.dest</code> contains a folder path.</p>
</td></tr>
<tr><td><code id="mermaid_+3A_file.dest">file.dest</code></td>
<td>
<p>Path to the downloaded image. It's combined with <code>dir.dest</code>
if it only contains the name of the file without a folder path.</p>
</td></tr>
<tr><td><code id="mermaid_+3A_link">link</code></td>
<td>
<p>Link generated by <a href="#topic+mermaid_gen_link">mermaid_gen_link</a></p>
</td></tr>
<tr><td><code id="mermaid_+3A_server">server</code></td>
<td>
<p>URL of the server used to generate the link</p>
</td></tr>
<tr><td><code id="mermaid_+3A_x">x</code></td>
<td>
<p><a href="base.html#topic+character">character</a> mermaid diagram dialect</p>
</td></tr>
<tr><td><code id="mermaid_+3A_add">add</code></td>
<td>
<p><a href="base.html#topic+logical">logical</a> to add the diagram on the existing plot</p>
</td></tr>
<tr><td><code id="mermaid_+3A_...">...</code></td>
<td>
<p>Other argument passed to <a href="#topic+mermaid">mermaid</a></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Compared to the <code>diagrammeR::mermaid</code> function, the generated image or plot
is not a HTMLwidget and can be knit in pdf through latex and
moreover, its size can be controlled with <code>fig.width</code> and <code>fig.height</code>.
</p>
<p>If the generation failed (due to internet connection failure or syntax error
in mermaid script), the functions raises no error (see <code>mermaid</code> returned value).
</p>


<h3>Value</h3>


<ul>
<li> <p><code>mermaid</code> returns the path to the downloaded image or <code>NA</code> if the download failed.
In this latter case, get the error message in the attribute &quot;error&quot;.
</p>
</li>
<li> <p><code>mermaid_gen_link</code> returns the link to the web service which generates the diagram
</p>
</li>
<li> <p><code>plot.mermaid</code> produces a R plot with the mermaid diagram
</p>
</li></ul>

<p>Nothing, used for side effect.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
diagram &lt;- "flowchart LR\n  A --&gt; B"
mermaid_gen_link(diagram)
f &lt;- mermaid(diagram)
f

# For displaying the diagram in Rmarkdown document
knitr::include_graphics(mermaid(diagram))

# Clean temporary folder
unlink(f)

## End(Not run)

s &lt;- "flowchart LR
A -&gt; B"
class(s) &lt;- c("mermaid", class(s))
plot(s)
</code></pre>

<hr>
<h2 id='plot.GRiwrm'>Plot of a diagram representing the network structure of a GRiwrm object</h2><span id='topic+plot.GRiwrm'></span>

<h3>Description</h3>

<p>Plot of a diagram representing the network structure of a GRiwrm object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'GRiwrm'
plot(
  x,
  display = TRUE,
  orientation = "LR",
  with_donors = TRUE,
  box_colors = c(UpstreamUngauged = "#eef", UpstreamGauged = "#aaf", IntermediateUngauged
    = "#efe", IntermediateGauged = "#afa", Reservoir = "#9de", DirectInjection = "#faa"),
  defaultClassDef = "stroke:#333",
  header = "%%{init: {'theme': 'neutral'} }%%",
  footer = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.GRiwrm_+3A_x">x</code></td>
<td>
<p>[GRiwrm object] data to display. See <a href="#topic+CreateGRiwrm">CreateGRiwrm</a> for details</p>
</td></tr>
<tr><td><code id="plot.GRiwrm_+3A_display">display</code></td>
<td>
<p><a href="base.html#topic+logical">logical</a> if <code>TRUE</code> plots the diagram, returns the mermaid code otherwise</p>
</td></tr>
<tr><td><code id="plot.GRiwrm_+3A_orientation">orientation</code></td>
<td>
<p><a href="base.html#topic+character">character</a> orientation of the graph. Possible values are
&quot;LR&quot; (left-right), &quot;RL&quot; (right-left), &quot;TB&quot; (top-bottom), or &quot;BT&quot; (bottom-top).</p>
</td></tr>
<tr><td><code id="plot.GRiwrm_+3A_with_donors">with_donors</code></td>
<td>
<p><a href="base.html#topic+logical">logical</a> for drawing boxes around ungauged nodes and their donors</p>
</td></tr>
<tr><td><code id="plot.GRiwrm_+3A_box_colors">box_colors</code></td>
<td>
<p><a href="base.html#topic+list">list</a> containing the color used for the different types of nodes</p>
</td></tr>
<tr><td><code id="plot.GRiwrm_+3A_defaultclassdef">defaultClassDef</code></td>
<td>
<p><a href="base.html#topic+character">character</a> default style apply to all boxes</p>
</td></tr>
<tr><td><code id="plot.GRiwrm_+3A_header">header</code></td>
<td>
<p>mermaid script to add before the generated script (see Details)</p>
</td></tr>
<tr><td><code id="plot.GRiwrm_+3A_footer">footer</code></td>
<td>
<p>mermaid script to add after the generated script</p>
</td></tr>
<tr><td><code id="plot.GRiwrm_+3A_...">...</code></td>
<td>
<p>further parameters passed to <a href="#topic+mermaid">mermaid</a></p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>header</code> parameter allows to add any mermaid code injected before the <code>graph</code>
instruction. It is notably useful for injecting directives that impact the
format of the graph. See <a href="https://mermaid.js.org/config/directives.html">mermaid documentation on directives</a> for
more details and also the
<a href="https://github.com/mermaid-js/mermaid/blob/master/packages/mermaid/src/schemas/config.schema.yaml#L1878">complete list of available directives</a>.
</p>


<h3>Value</h3>

<p>Mermaid code of the diagram if display is <code>FALSE</code>, otherwise the function returns the diagram itself.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+CreateGRiwrm">CreateGRiwrm()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGRiwrm)

#########################################
# Network of 2 nodes distant of 150 km: #
#########################################
# - an upstream reservoir modeled as a direct flow injection (no model)
# - a gauging station downstream a catchment of 360 km² modeled with GR4J
db &lt;- data.frame(id = c("Reservoir", "GaugingDown"),
                 length = c(150, NA),
                 down = c("GaugingDown", NA),
                 area = c(NA, 360),
                 model = c(NA, "RunModel_GR4J"),
                 stringsAsFactors = FALSE)
griwrm_basic &lt;- CreateGRiwrm(db)
griwrm_basic
# Network diagram with direct flow node in red, intermediate sub-basin in green
## Not run: 
plot(griwrm_basic)

## End(Not run)

###################################################
# GR4J semi-distributed model of the Severn River #
###################################################
data(Severn)
nodes &lt;- Severn$BasinsInfo
nodes$model &lt;- "RunModel_GR4J"
str(nodes)
# Mismatch column names are renamed to stick with GRiwrm requirements
rename_columns &lt;- list(id = "gauge_id",
                       down = "downstream_id",
                       length = "distance_downstream")
griwrm_severn &lt;- CreateGRiwrm(nodes, rename_columns)
griwrm_severn
# Network diagram with upstream basin nodes in blue, intermediate sub-basin in green
## Not run: 
plot(griwrm_severn)

## End(Not run)

####################################################################
# Severn network with an ungauged station at nodes 54029 and 54001 #
####################################################################
nodes_ungauged &lt;- nodes
nodes_ungauged$model[nodes_ungauged$gauge_id %in% c("54029", "54001")] &lt;- "Ungauged"
# By default the first gauged node at downstream is used for parameter calibration (54032)
# Add a `donor`column for defining manually an upstream or sibling donor
nodes_ungauged$donor &lt;- as.character(NA)
nodes_ungauged$donor[nodes_ungauged$id == "54001"] &lt;- "54095"
griwrm_ungauged &lt;- CreateGRiwrm(nodes_ungauged, rename_columns)
griwrm_ungauged
# Network diagram with gauged nodes of vivid color, and ungauged nodes of dull color
## Not run: 
plot(griwrm_ungauged)

## End(Not run)

###########################################################
# Severn network with a Diversion on the node "54029"     #
# to a reservoir which transfer flows to the node "54001" #
# and a withdrawal on the reservoir                       #
###########################################################
nodes_div &lt;- nodes[, c("gauge_id", "downstream_id", "distance_downstream", "model", "area")]
nodes_div &lt;- rbind(
  nodes_div,
  data.frame(gauge_id            = c("54029"    , "Reservoir"         , "Irrigation_Pump"),
             downstream_id       = c("Reservoir", "54001"             , "Reservoir"      ),
             distance_downstream = c(10         , 5                   , 0                ),
             model               = c("Diversion", "RunModel_Reservoir", NA      ),
             area                = c(NA         , NA                  , NA))
)
griwrm_div &lt;- CreateGRiwrm(nodes_div, rename_columns)
# Network diagram figures Diversion node by a red frame and a red arrow
## Not run: 
plot(griwrm_div, orientation = "TB")

## End(Not run)

# It's also possible to custom the diagram's look with mermaid directives
# (See details in plot.GRiwrm help topic)
## Not run: 
plot(
  griwrm_div,
  header = "%%{init: {'flowchart': {'nodeSpacing': 30, 'rankSpacing': 30, 'curve': 'linear'}}}%%"
)

## End(Not run)
</code></pre>

<hr>
<h2 id='plot.GRiwrmOutputsModel'>Function which creates screen plots giving an overview of the model outputs in the GRiwrm network</h2><span id='topic+plot.GRiwrmOutputsModel'></span>

<h3>Description</h3>

<p>Function which creates screen plots giving an overview of the model outputs in the GRiwrm network
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'GRiwrmOutputsModel'
plot(x, Qobs = NULL, unit = "m3/s", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.GRiwrmOutputsModel_+3A_x">x</code></td>
<td>
<p>[object of class <em>GRiwrmOutputsModel</em>] see <a href="#topic+RunModel.GRiwrmInputsModel">RunModel.GRiwrmInputsModel</a> for details</p>
</td></tr>
<tr><td><code id="plot.GRiwrmOutputsModel_+3A_qobs">Qobs</code></td>
<td>
<p>(optional) <a href="base.html#topic+matrix">matrix</a> time series of observed flows
(for the same time steps than simulated) (mm/time step) with one column
by hydrological model output named with the node ID (See <a href="#topic+CreateGRiwrm">CreateGRiwrm</a> for details)</p>
</td></tr>
<tr><td><code id="plot.GRiwrmOutputsModel_+3A_unit">unit</code></td>
<td>
<p>(optional) <a href="base.html#topic+character">character</a> flows unit (&quot;m3/s&quot; or &quot;mm&quot;)</p>
</td></tr>
<tr><td><code id="plot.GRiwrmOutputsModel_+3A_...">...</code></td>
<td>
<p>Further arguments for <a href="airGR.html#topic+plot.OutputsModel">airGR::plot.OutputsModel</a> and <a href="base.html#topic+plot">plot</a></p>
</td></tr>
</table>


<h3>Details</h3>

<p>For examples of use see topics <a href="#topic+RunModel.GRiwrmInputsModel">RunModel.GRiwrmInputsModel</a>, <a href="#topic+RunModel_Reservoir">RunModel_Reservoir</a>,
and <a href="#topic+RunModel.Supervisor">RunModel.Supervisor</a>.
</p>


<h3>Value</h3>

<p><a href="base.html#topic+list">list</a> of plots.
</p>

<hr>
<h2 id='plot.OutputsModelReservoir'>Plot simulated reservoir volume, inflows and released flows time series on a reservoir node</h2><span id='topic+plot.OutputsModelReservoir'></span>

<h3>Description</h3>

<p>Plot simulated reservoir volume, inflows and released flows time series on a reservoir node
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'OutputsModelReservoir'
plot(x, Qobs = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.OutputsModelReservoir_+3A_x">x</code></td>
<td>
<p>Object returned by <a href="#topic+RunModel_Reservoir">RunModel_Reservoir</a></p>
</td></tr>
<tr><td><code id="plot.OutputsModelReservoir_+3A_qobs">Qobs</code></td>
<td>
<p>(optional) <a href="base.html#topic+numeric">numeric</a> time series of observed released flow [m3/time step]</p>
</td></tr>
<tr><td><code id="plot.OutputsModelReservoir_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <a href="#topic+plot.Qm3s">plot.Qm3s</a></p>
</td></tr>
</table>


<h3>Value</h3>

<p>Function used for side effect.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#######################################################
# Daily time step simulation of a reservoir filled by #
# one catchment supplying a constant released flow    #
#######################################################

library(airGRiwrm)
data(L0123001)

# Inflows comes from a catchment of 360 km² modeled with GR4J
# The reservoir receives directly the inflows
db &lt;- data.frame(id = c(BasinInfo$BasinCode, "Reservoir"),
                 length = c(0, NA),
                 down = c("Reservoir", NA),
                 area = c(BasinInfo$BasinArea, NA),
                 model = c("RunModel_GR4J", "RunModel_Reservoir"),
                 stringsAsFactors = FALSE)
griwrm &lt;- CreateGRiwrm(db)
## Not run: 
plot(griwrm)

## End(Not run)

# Formatting of GR4J inputs for airGRiwrm (matrix or data.frame with one
# column by sub-basin and node IDs as column names)
Precip &lt;- matrix(BasinObs$P, ncol = 1)
colnames(Precip) &lt;- BasinInfo$BasinCode
PotEvap &lt;- matrix(BasinObs$E, ncol = 1)
colnames(PotEvap) &lt;- BasinInfo$BasinCode

# We propose to compute the constant released flow from
# the median of the natural flow
# The value is in m3 by time step (day)
Qrelease &lt;- median(BasinObs$Qls, na.rm = TRUE) / 1000 * 86400

# Formatting of reservoir released flow inputs for airGRiwrm (matrix or data.frame
# with one column by node and node IDs as column names)
Qrelease &lt;- data.frame(Reservoir = rep(Qrelease, length(BasinObs$DatesR)))

InputsModel &lt;- CreateInputsModel(griwrm, DatesR = BasinObs$DatesR,
                                 Precip = Precip,
                                 PotEvap = PotEvap,
                                 Qinf = Qrelease)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

# Creation of the GRiwmRunOptions object
RunOptions &lt;- CreateRunOptions(
  InputsModel,
  IndPeriod_Run = Ind_Run,
  IndPeriod_WarmUp = seq.int(Ind_Run[1] - 365, length.out = 365)
)

# Initial states of the reservoir can be provided by the user
# For example for starting with an empty reservoir...
RunOptions[["Reservoir"]]$IniStates &lt;- c("Reservoir.V" = 0)

# calibration criterion: preparation of the InputsCrit object
Qobs &lt;- data.frame("L0123001" = BasinObs$Qmm[Ind_Run])
InputsCrit &lt;- CreateInputsCrit(InputsModel,
                               ErrorCrit_KGE2,
                               RunOptions = RunOptions,
                               Obs = Qobs)

# preparation of CalibOptions object
CalibOptions &lt;- CreateCalibOptions(InputsModel)

# Parameters of RunModel_Reservoir must be fixed
CalibOptions[["Reservoir"]]$FixedParam &lt;- c(Vmax = 30E6, celerity = 0.5)

OC &lt;- Calibration(
  InputsModel = InputsModel,
  RunOptions = RunOptions,
  InputsCrit = InputsCrit,
  CalibOptions = CalibOptions
)

# Model parameters
Param &lt;- extractParam(OC)
str(Param)

# Running simulation
OutputsModel &lt;- RunModel(InputsModel, RunOptions, Param)

# Plot the simulated flows and volumes on all nodes
Qobs &lt;- cbind(BasinObs$Qmm[Ind_Run], Qrelease[Ind_Run, ])
colnames(Qobs) &lt;- griwrm$id
plot(OutputsModel, Qobs = Qobs)
# N.B. "Observed releases" should be considered as "Target releases" here

# The plot for the reservoir can also be plotted alone
plot(OutputsModel$Reservoir, Qobs = Qobs[, "Reservoir"])
</code></pre>

<hr>
<h2 id='plot.Qm3s'>Plot of a <code>Qm3s</code> object (time series of simulated flows)</h2><span id='topic+plot.Qm3s'></span>

<h3>Description</h3>

<p>This function plot time series of flow rate in m3/s. It's a method for object
of class &quot;Qm3s&quot; which can be directly called by <code>plot</code>. It can also be called
as a function <code>plot.Qm3s</code> if the first parameter has the good format.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'Qm3s'
plot(
  x,
  type = "l",
  xlab = "Date",
  ylab = expression("Flow rate (m"^"3" * "/s)"),
  main = "Simulated flows",
  col = grDevices::hcl.colors(ncol(x) - 1, "Zissou 1"),
  legend = colnames(x)[-1],
  legend.cex = 0.7,
  legend.x = "topright",
  legend.y = NULL,
  lty = 1,
  mgp = c(2.5, 1, 0),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.Qm3s_+3A_x">x</code></td>
<td>
<p><a href="base.html#topic+data.frame">data.frame</a> with a first column with <a href="base.html#topic+POSIXt">POSIXt</a> dates and followings
columns with flows at each node of the network</p>
</td></tr>
<tr><td><code id="plot.Qm3s_+3A_type">type</code></td>
<td>
<p><a href="base.html#topic+character">character</a> plot type (See <a href="graphics.html#topic+plot.default">plot.default</a>), default &quot;l&quot;</p>
</td></tr>
<tr><td><code id="plot.Qm3s_+3A_xlab">xlab</code></td>
<td>
<p><a href="base.html#topic+character">character</a> label for the x axis, default to &quot;Date&quot;</p>
</td></tr>
<tr><td><code id="plot.Qm3s_+3A_ylab">ylab</code></td>
<td>
<p><a href="base.html#topic+character">character</a> label for the y axis, default to &quot;Flow (m3/s)&quot;</p>
</td></tr>
<tr><td><code id="plot.Qm3s_+3A_main">main</code></td>
<td>
<p><a href="base.html#topic+character">character</a> main title for the plot, default to &quot;Simulated flows&quot;</p>
</td></tr>
<tr><td><code id="plot.Qm3s_+3A_col">col</code></td>
<td>
<p><a href="base.html#topic+character">character</a> plotting colors (See <a href="graphics.html#topic+par">par</a>)</p>
</td></tr>
<tr><td><code id="plot.Qm3s_+3A_legend">legend</code></td>
<td>
<p><a href="base.html#topic+character">character</a> see parameter <code>legend</code> of <a href="graphics.html#topic+legend">legend</a>. Set it to <a href="base.html#topic+NULL">NULL</a>
to hide the legend</p>
</td></tr>
<tr><td><code id="plot.Qm3s_+3A_legend.cex">legend.cex</code></td>
<td>
<p><a href="base.html#topic+character">character</a> <code>cex</code> parameter for the text of the legend (See <a href="graphics.html#topic+par">par</a>)</p>
</td></tr>
<tr><td><code id="plot.Qm3s_+3A_legend.x">legend.x</code>, <code id="plot.Qm3s_+3A_legend.y">legend.y</code></td>
<td>
<p>Legend position, see <code>x</code> and <code>y</code> parameters in <a href="graphics.html#topic+legend">graphics::legend</a></p>
</td></tr>
<tr><td><code id="plot.Qm3s_+3A_lty">lty</code></td>
<td>
<p><a href="base.html#topic+character">character</a> or <a href="base.html#topic+numeric">numeric</a> The line type (See <a href="graphics.html#topic+par">par</a>)</p>
</td></tr>
<tr><td><code id="plot.Qm3s_+3A_mgp">mgp</code></td>
<td>
<p>The margin line for the axis title, axis labels and axis line (See <a href="graphics.html#topic+par">par</a>)</p>
</td></tr>
<tr><td><code id="plot.Qm3s_+3A_...">...</code></td>
<td>
<p>Further arguments to pass to the <a href="graphics.html#topic+matplot">matplot</a> functions</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For examples of use see topics <a href="#topic+RunModel.GRiwrmInputsModel">RunModel.GRiwrmInputsModel</a>, <a href="#topic+RunModel_Reservoir">RunModel_Reservoir</a>,
and <a href="#topic+RunModel.Supervisor">RunModel.Supervisor</a>.
</p>


<h3>Value</h3>

<p>Screen plot window.
</p>

<hr>
<h2 id='reduceGRiwrm'>Reduce the size of a GRiwrm by selecting the subset of nodes corresponding to a downstream node</h2><span id='topic+reduceGRiwrm'></span>

<h3>Description</h3>

<p>Reduce the size of a GRiwrm by selecting the subset of nodes corresponding to a downstream node
</p>


<h3>Usage</h3>

<pre><code class='language-R'>reduceGRiwrm(griwrm, down_node, check = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="reduceGRiwrm_+3A_griwrm">griwrm</code></td>
<td>
<p>A <em>GRiwrm</em> object (See <a href="#topic+CreateGRiwrm">CreateGRiwrm</a>)</p>
</td></tr>
<tr><td><code id="reduceGRiwrm_+3A_down_node">down_node</code></td>
<td>
<p>The ID of the downstream node of the reduced <em>GRiwrm</em></p>
</td></tr>
<tr><td><code id="reduceGRiwrm_+3A_check">check</code></td>
<td>
<p><a href="base.html#topic+logical">logical</a> Check the consistency of the reduced <em>GRiwrm</em></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <em>GRiwrm</em> object only containing nodes located upstream the given downstream node
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Severn)
nodes &lt;- Severn$BasinsInfo
nodes$model &lt;- "RunModel_GR4J"
str(nodes)
# Mismatch column names are renamed to stick with GRiwrm requirements
rename_columns &lt;- list(id = "gauge_id",
                       down = "downstream_id",
                       length = "distance_downstream")
griwrm_severn &lt;- CreateGRiwrm(nodes, rename_columns)
griwrm_severn
# Network diagram with upstream basin nodes in blue, intermediate sub-basin in green
plot(griwrm_severn)
plot(reduceGRiwrm(griwrm_severn, "54032"))

</code></pre>

<hr>
<h2 id='RunModel'>RunModel function for both <strong>airGR</strong> InputsModel and GRiwrmInputsModel object</h2><span id='topic+RunModel'></span>

<h3>Description</h3>

<p>RunModel function for both <strong>airGR</strong> InputsModel and GRiwrmInputsModel object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RunModel(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RunModel_+3A_x">x</code></td>
<td>
<p>[object of class <em>InputsModel</em> or <em>GRiwrmInputsModel</em>] see <a href="#topic+CreateInputsModel">CreateInputsModel</a> for details</p>
</td></tr>
<tr><td><code id="RunModel_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Either a <a href="base.html#topic+list">list</a> of OutputsModel object (for GRiwrmInputsModel) or an OutputsModel object (for InputsModel)
</p>

<hr>
<h2 id='RunModel_Reservoir'>Run with a reservoir model</h2><span id='topic+RunModel_Reservoir'></span>

<h3>Description</h3>

<p>The reservoir model is a model combining a lag model and the calculation of
the water storage time series according to the released flow time series
from the <code>Qrelease</code> parameter of <a href="#topic+CreateInputsModel.GRiwrm">CreateInputsModel.GRiwrm</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RunModel_Reservoir(InputsModel, RunOptions, Param)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RunModel_Reservoir_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em>] see <code><a href="airGR.html#topic+CreateInputsModel">CreateInputsModel</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_Reservoir_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <code><a href="airGR.html#topic+CreateRunOptions">CreateRunOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_Reservoir_+3A_param">Param</code></td>
<td>
<p><a href="base.html#topic+numeric">numeric</a> vector of length 2 containing (1) the maximum capacity
of the reservoir and (2) the celerity in m/s of the upstream inflows.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The simulated flow corresponds to the released flow except when the reservoir
is empty (release flow is limited) or full (release flow is completed by inflows
excess).
</p>
<p>By default, the initial reservoir volume at the beginning of the warm-up period
is equal to the half of the maximum reservoir capacity.
</p>
<p>The parameters of the model can't be calibrated and must be fixed during the
calibration process by using this instruction after the call to
<a href="#topic+CreateCalibOptions">CreateCalibOptions</a>:
</p>
<p><code>CalibOptions[[id_of_the_reservoir]]$FixedParam &lt;- c(Vmax, celerity)</code>
</p>
<p>Initial states of the model consists in the initial volume storage in the
reservoir and can be defined with the following instruction after the call to
<a href="#topic+CreateRunOptions.GRiwrmInputsModel">CreateRunOptions.GRiwrmInputsModel</a>:
</p>
<p><code>RunOptions[[id_of_the_reservoir]]$IniStates &lt;- c("Reservoir.V" = initial_volume_m3)</code>
</p>
<p>The final state of the reservoir is stored in <code>OutputsModel$StateEnd</code> and
can be reused for starting a new simulation with the following instruction:
</p>
<p><code>RunOptions[[id_of_the_reservoir]]$IniStates &lt;- unlist(OutputsModel[[id_of_the_reservoir]]$StateEnd)</code>
</p>
<p>Direct injection nodes connected to a reservoir nodes act as water injections
or withdrawals directly in the reservoir volume (whatever the length between
the direct injection nodes and the reservoir node). The abstraction volumes
that cannot be operated due to an empty reservoir are notified by the
item <code>Qover_m3</code> in the returned <em>OutputsModel</em> object.
</p>


<h3>Value</h3>

<p>An <em>OutputsModel</em> object like the one return by <a href="airGR.html#topic+RunModel">airGR::RunModel</a> but
completed with the items:
</p>

<ul>
<li> <p><code>Vsim</code>: representing the water volume time series in m3
</p>
</li>
<li> <p><code>Qsim_m3</code>: flow released by the reservoir in cubic meters by time step
(see Details)
</p>
</li>
<li> <p><code>Qdiv_m3</code>: only present in case of Diversion in the node, diverted flow in
cubic meters per time step. The latter differs from the flows time series provided
in argument <code>Qinf</code> of <a href="#topic+CreateInputsModel.GRiwrm">CreateInputsModel.GRiwrm</a> by the limitation due to an
empty reservoir
</p>
</li>
<li> <p><code>Qover_m3</code>: only present in case of Diversion in the node, diverted volumes
that cannot be operated due to an empty reservoir
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>#######################################################
# Daily time step simulation of a reservoir filled by #
# one catchment supplying a constant released flow    #
#######################################################

library(airGRiwrm)
data(L0123001)

# Inflows comes from a catchment of 360 km² modeled with GR4J
# The reservoir receives directly the inflows
db &lt;- data.frame(id = c(BasinInfo$BasinCode, "Reservoir"),
                 length = c(0, NA),
                 down = c("Reservoir", NA),
                 area = c(BasinInfo$BasinArea, NA),
                 model = c("RunModel_GR4J", "RunModel_Reservoir"),
                 stringsAsFactors = FALSE)
griwrm &lt;- CreateGRiwrm(db)
## Not run: 
plot(griwrm)

## End(Not run)

# Formatting of GR4J inputs for airGRiwrm (matrix or data.frame with one
# column by sub-basin and node IDs as column names)
Precip &lt;- matrix(BasinObs$P, ncol = 1)
colnames(Precip) &lt;- BasinInfo$BasinCode
PotEvap &lt;- matrix(BasinObs$E, ncol = 1)
colnames(PotEvap) &lt;- BasinInfo$BasinCode

# We propose to compute the constant released flow from
# the median of the natural flow
# The value is in m3 by time step (day)
Qrelease &lt;- median(BasinObs$Qls, na.rm = TRUE) / 1000 * 86400

# Formatting of reservoir released flow inputs for airGRiwrm (matrix or data.frame
# with one column by node and node IDs as column names)
Qrelease &lt;- data.frame(Reservoir = rep(Qrelease, length(BasinObs$DatesR)))

InputsModel &lt;- CreateInputsModel(griwrm, DatesR = BasinObs$DatesR,
                                 Precip = Precip,
                                 PotEvap = PotEvap,
                                 Qinf = Qrelease)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

# Creation of the GRiwmRunOptions object
RunOptions &lt;- CreateRunOptions(
  InputsModel,
  IndPeriod_Run = Ind_Run,
  IndPeriod_WarmUp = seq.int(Ind_Run[1] - 365, length.out = 365)
)

# Initial states of the reservoir can be provided by the user
# For example for starting with an empty reservoir...
RunOptions[["Reservoir"]]$IniStates &lt;- c("Reservoir.V" = 0)

# calibration criterion: preparation of the InputsCrit object
Qobs &lt;- data.frame("L0123001" = BasinObs$Qmm[Ind_Run])
InputsCrit &lt;- CreateInputsCrit(InputsModel,
                               ErrorCrit_KGE2,
                               RunOptions = RunOptions,
                               Obs = Qobs)

# preparation of CalibOptions object
CalibOptions &lt;- CreateCalibOptions(InputsModel)

# Parameters of RunModel_Reservoir must be fixed
CalibOptions[["Reservoir"]]$FixedParam &lt;- c(Vmax = 30E6, celerity = 0.5)

OC &lt;- Calibration(
  InputsModel = InputsModel,
  RunOptions = RunOptions,
  InputsCrit = InputsCrit,
  CalibOptions = CalibOptions
)

# Model parameters
Param &lt;- extractParam(OC)
str(Param)

# Running simulation
OutputsModel &lt;- RunModel(InputsModel, RunOptions, Param)

# Plot the simulated flows and volumes on all nodes
Qobs &lt;- cbind(BasinObs$Qmm[Ind_Run], Qrelease[Ind_Run, ])
colnames(Qobs) &lt;- griwrm$id
plot(OutputsModel, Qobs = Qobs)
# N.B. "Observed releases" should be considered as "Target releases" here

# The plot for the reservoir can also be plotted alone
plot(OutputsModel$Reservoir, Qobs = Qobs[, "Reservoir"])
</code></pre>

<hr>
<h2 id='RunModel.GR'>Run of a rainfall-runoff model on a sub-basin</h2><span id='topic+RunModel.GR'></span>

<h3>Description</h3>

<p>Function which performs a single model run with the provided function over the selected period.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'GR'
RunModel(x, RunOptions, Param, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RunModel.GR_+3A_x">x</code></td>
<td>
<p>[object of class <code>InputsModel</code>] <code>InputsModel</code> for <a href="airGR.html#topic+RunModel">airGR::RunModel</a></p>
</td></tr>
<tr><td><code id="RunModel.GR_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <a href="airGR.html#topic+CreateRunOptions">airGR::CreateRunOptions</a> for details</p>
</td></tr>
<tr><td><code id="RunModel.GR_+3A_param">Param</code></td>
<td>
<p><a href="base.html#topic+numeric">numeric</a> vector of model parameters (See details for SD lag model)</p>
</td></tr>
<tr><td><code id="RunModel.GR_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function runs <a href="airGR.html#topic+RunModel">airGR::RunModel</a> and add an item <code>Qsim_m3</code> to the returned
<em>OutputsModel</em> object.
</p>


<h3>Value</h3>

<p>[list] see <code><a href="airGR.html#topic+RunModel_GR4J">RunModel_GR4J</a></code> or <code><a href="airGR.html#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code> for details.
</p>
<p>If <code>InputsModel</code> parameter has been created for using a semi-distributed (SD) lag model (See <code><a href="airGR.html#topic+CreateInputsModel">CreateInputsModel</a></code>), the list value contains an extra item named <code>QsimDown</code> which is a numeric series of simulated discharge [mm/time step] related to the run-off contribution of the downstream sub-catchment.
</p>

<hr>
<h2 id='RunModel.GRiwrmInputsModel'>RunModel function for <em>GRiwrmInputsModel</em> object</h2><span id='topic+RunModel.GRiwrmInputsModel'></span>

<h3>Description</h3>

<p>RunModel function for <em>GRiwrmInputsModel</em> object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'GRiwrmInputsModel'
RunModel(x, RunOptions, Param, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RunModel.GRiwrmInputsModel_+3A_x">x</code></td>
<td>
<p>[object of class <em>GRiwrmInputsModel</em>] see <a href="#topic+CreateInputsModel.GRiwrm">CreateInputsModel.GRiwrm</a> for details</p>
</td></tr>
<tr><td><code id="RunModel.GRiwrmInputsModel_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>GRiwrmRunOptions</em>] see <a href="#topic+CreateRunOptions.GRiwrmInputsModel">CreateRunOptions.GRiwrmInputsModel</a> for details</p>
</td></tr>
<tr><td><code id="RunModel.GRiwrmInputsModel_+3A_param">Param</code></td>
<td>
<p><a href="base.html#topic+list">list</a> parameter values. The list item names are the IDs of the sub-basins. Each item is a <a href="base.html#topic+numeric">numeric</a> <a href="base.html#topic+vector">vector</a></p>
</td></tr>
<tr><td><code id="RunModel.GRiwrmInputsModel_+3A_...">...</code></td>
<td>
<p>Further arguments for compatibility with S3 methods</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <em>GRiwrmOutputsModel</em>.
This object is a <a href="base.html#topic+list">list</a> of <em>OutputsModel</em> objects produced by <a href="#topic+RunModel.InputsModel">RunModel.InputsModel</a>
for each node of the semi-distributed model.
</p>
<p>It also contains the following attributes (see <a href="base.html#topic+attr">attr</a>):
</p>

<ul>
<li><p> &quot;Qm3s&quot;: a <a href="base.html#topic+data.frame">data.frame</a> containing the dates of simulation and one column by node
with the simulated flows in cubic meters per seconds (See <a href="#topic+plot.Qm3s">plot.Qm3s</a>)
</p>
</li>
<li><p> &quot;GRiwrm&quot;:  a copy of the <em>GRiwrm</em> object produced by <a href="#topic+CreateGRiwrm">CreateGRiwrm</a> and used for the simulation
</p>
</li>
<li><p> &quot;TimeStep&quot;:  time step of the simulation in seconds
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+CreateGRiwrm">CreateGRiwrm()</a></code>, <code><a href="#topic+CreateInputsModel.GRiwrm">CreateInputsModel.GRiwrm()</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>###################################################################
# Run the `airGR::RunModel_Lag` example in the GRiwrm fashion way #
# Simulation of a reservoir with a purpose of low-flow mitigation #
###################################################################

## ---- preparation of the InputsModel object

## loading package and catchment data
library(airGRiwrm)
data(L0123001)

## ---- specifications of the reservoir

## the reservoir withdraws 1 m3/s when it's possible considering the flow observed in the basin
Qupstream &lt;- matrix(-sapply(BasinObs$Qls / 1000 - 1, function(x) {
  min(1, max(0, x, na.rm = TRUE))
}), ncol = 1)

## except between July and September when the reservoir releases 3 m3/s for low-flow mitigation
month &lt;- as.numeric(format(BasinObs$DatesR, "%m"))
Qupstream[month &gt;= 7 &amp; month &lt;= 9] &lt;- 3
Qupstream &lt;- Qupstream * 86400 ## Conversion in m3/day

## the reservoir is not an upstream subcachment: its areas is NA
BasinAreas &lt;- c(NA, BasinInfo$BasinArea)

## delay time between the reservoir and the catchment outlet is 2 days and the distance is 150 km
LengthHydro &lt;- 150
## with a delay of 2 days for 150 km, the flow velocity is 75 km per day
Velocity &lt;- (LengthHydro * 1e3 / 2) / (24 * 60 * 60) ## Conversion km/day -&gt; m/s

# This example is a network of 2 nodes which can be describe like this:
db &lt;- data.frame(id = c("Reservoir", "GaugingDown"),
                 length = c(LengthHydro, NA),
                 down = c("GaugingDown", NA),
                 area = c(NA, BasinInfo$BasinArea),
                 model = c(NA, "RunModel_GR4J"),
                 stringsAsFactors = FALSE)

# Create GRiwrm object from the data.frame
griwrm &lt;- CreateGRiwrm(db)
## Not run: 
plot(griwrm)

## End(Not run)

# Formatting observations for the hydrological models
# Each input data should be a matrix or a data.frame with the good id in the name of the column
Precip &lt;- matrix(BasinObs$P, ncol = 1)
colnames(Precip) &lt;- "GaugingDown"
PotEvap &lt;- matrix(BasinObs$E, ncol = 1)
colnames(PotEvap) &lt;- "GaugingDown"

# Observed flows contain flows that are directly injected in the model
Qinf = matrix(Qupstream, ncol = 1)
colnames(Qinf) &lt;- "Reservoir"

# Creation of the GRiwrmInputsModel object (= a named list of InputsModel objects)
InputsModels &lt;- CreateInputsModel(griwrm,
                            DatesR = BasinObs$DatesR,
                            Precip = Precip,
                            PotEvap = PotEvap,
                            Qinf = Qinf)
str(InputsModels)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

# Creation of the GRiwmRunOptions object
RunOptions &lt;- CreateRunOptions(InputsModels,
                                IndPeriod_Run = Ind_Run)
str(RunOptions)

# Parameters of the SD models should be encapsulated in a named list
ParamGR4J &lt;- c(X1 = 257.238, X2 = 1.012, X3 = 88.235, X4 = 2.208)
Param &lt;- list(`GaugingDown` = c(Velocity, ParamGR4J))

# RunModel for the whole network
OutputsModels &lt;- RunModel(InputsModels,
                          RunOptions = RunOptions,
                          Param = Param)
str(OutputsModels)

# Compare regimes of the simulation with reservoir and observation of natural flow
plot(OutputsModels,
     data.frame(GaugingDown = BasinObs$Qmm[Ind_Run]),
     which = "Regime")

# Plot together simulated flows (m3/s) of the reservoir and the gauging station
plot(attr(OutputsModels, "Qm3s"))


########################################################
# Run the Severn example provided with this package    #
# A natural catchment composed with 6 gauging stations #
########################################################

data(Severn)
nodes &lt;- Severn$BasinsInfo
nodes$model &lt;- "RunModel_GR4J"
# Mismatch column names are renamed to stick with GRiwrm requirements
rename_columns &lt;- list(id = "gauge_id",
                       down = "downstream_id",
                       length = "distance_downstream")
g_severn &lt;- CreateGRiwrm(nodes, rename_columns)

# Network diagram with upstream basin nodes in blue, intermediate sub-basin in green
## Not run: 
plot(g_severn)

## End(Not run)

# Format CAMEL-GB meteorological dataset for airGRiwrm inputs
BasinsObs &lt;- Severn$BasinsObs
DatesR &lt;- BasinsObs[[1]]$DatesR
PrecipTot &lt;- cbind(sapply(BasinsObs, function(x) {x$precipitation}))
PotEvapTot &lt;- cbind(sapply(BasinsObs, function(x) {x$peti}))

# Precipitation and Potential Evaporation are related to the whole catchment
# at each gauging station. We need to compute them for intermediate catchments
# for use in a semi-distributed model
Precip &lt;- ConvertMeteoSD(g_severn, PrecipTot)
PotEvap &lt;- ConvertMeteoSD(g_severn, PotEvapTot)

# CreateInputsModel object
IM_severn &lt;- CreateInputsModel(g_severn, DatesR, Precip, PotEvap)

# GRiwrmRunOptions object
# Run period is set aside the one-year warm-up period
IndPeriod_Run &lt;- seq(
  which(IM_severn[[1]]$DatesR == (IM_severn[[1]]$DatesR[1] + 365*24*60*60)),
  length(IM_severn[[1]]$DatesR) # Until the end of the time series
)
IndPeriod_WarmUp &lt;- seq(1, IndPeriod_Run[1] - 1)

RO_severn &lt;- CreateRunOptions(
  IM_severn,
  IndPeriod_WarmUp = IndPeriod_WarmUp,
  IndPeriod_Run = IndPeriod_Run
)

# Load parameters of the model from Calibration in vignette V02
P_severn &lt;- readRDS(system.file("vignettes", "ParamV02.RDS", package = "airGRiwrm"))

# Run the simulation
OM_severn &lt;- RunModel(IM_severn,
                          RunOptions = RO_severn,
                          Param = P_severn)

# Plot results of simulated flows in m3/s
Qm3s &lt;- attr(OM_severn, "Qm3s")
plot(Qm3s[1:150, ])


##################################################################
# An example of water withdrawal for irrigation with restriction #
# modeled with a Diversion node on the Severn river              #
##################################################################

# A diversion is added at gauging station "54001"
nodes_div &lt;- nodes[,  c("gauge_id", "downstream_id", "distance_downstream", "area", "model")]
names(nodes_div) &lt;- c("id", "down", "length", "area", "model")
nodes_div &lt;- rbind(nodes_div,
                   data.frame(id = "54001", # location of the diversion
                              down = NA,    # the abstracted flow goes outside
                              length = NA,  # down=NA, so length=NA
                              area = NA,    # no area, diverted flow is in m3/day
                              model = "Diversion"))

g_div &lt;- CreateGRiwrm(nodes_div)
# The node "54001" is surrounded in red to show the diverted node
## Not run: 
plot(g_div)

## End(Not run)

# Computation of the irrigation withdraw objective
irrigMonthlyPlanning &lt;- c(0.0, 0.0, 1.2, 2.4, 3.2, 3.6, 3.6, 2.8, 1.8, 0.0, 0.0, 0.0)
names(irrigMonthlyPlanning) &lt;- month.abb
irrigMonthlyPlanning
DatesR_month &lt;- as.numeric(format(DatesR, "%m"))
# Withdrawn flow calculated for each day is negative
Qirrig &lt;- matrix(-irrigMonthlyPlanning[DatesR_month] * 86400, ncol = 1)
colnames(Qirrig) &lt;- "54001"

# Minimum flow to remain downstream the diversion is 12 m3/s
Qmin &lt;- matrix(12 * 86400, nrow = length(DatesR), ncol = 1)
colnames(Qmin) = "54001"

# Creation of GRimwrInputsModel object
IM_div &lt;- CreateInputsModel(g_div, DatesR, Precip, PotEvap, Qinf = Qirrig, Qmin = Qmin)

# RunOptions and parameters are unchanged, we can directly run the simulation
OM_div &lt;- RunModel(IM_div,
                   RunOptions = RO_severn,
                   Param = P_severn)

# Retrieve diverted flow at "54001" and convert it from m3/day to m3/s
Qdiv_m3s &lt;- OM_div$`54001`$Qdiv_m3 / 86400

# Plot the diverted flow for the year 2003
Ind_Plot &lt;- which(
  OM_div[[1]]$DatesR &gt;= as.POSIXct("2003-01-01", tz = "UTC") &amp;
  OM_div[[1]]$DatesR &lt;= as.POSIXct("2003-12-31", tz = "UTC")
)
dfQdiv &lt;- as.Qm3s(DatesR = OM_div[[1]]$DatesR[Ind_Plot],
                     Diverted_flow = Qdiv_m3s[Ind_Plot])

oldpar &lt;- par(mfrow=c(2,1), mar = c(2.5,4,1,1))
plot(dfQdiv)

# Plot natural and influenced flow at station "54001"
df54001 &lt;- cbind(attr(OM_div, "Qm3s")[Ind_Plot, c("DatesR", "54001")],
                 attr(OM_severn, "Qm3s")[Ind_Plot, "54001"])
names(df54001) &lt;- c("DatesR", "54001 with irrigation", "54001 natural flow")
df54001 &lt;- as.Qm3s(df54001)
plot(df54001, ylim = c(0,70))
abline(h = 12, col = "green", lty = "dotted")
par(oldpar)
</code></pre>

<hr>
<h2 id='RunModel.InputsModel'>Wrapper for <a href="airGR.html#topic+RunModel">airGR::RunModel</a> for one sub-basin</h2><span id='topic+RunModel.InputsModel'></span>

<h3>Description</h3>

<p>Wrapper for <a href="airGR.html#topic+RunModel">airGR::RunModel</a> for one sub-basin
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'InputsModel'
RunModel(x = NULL, RunOptions, Param, FUN_MOD = NULL, InputsModel = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RunModel.InputsModel_+3A_x">x</code></td>
<td>
<p>[object of class <em>InputsModel</em>] see <a href="airGR.html#topic+CreateInputsModel">airGR::CreateInputsModel</a> for details</p>
</td></tr>
<tr><td><code id="RunModel.InputsModel_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <code><a href="airGR.html#topic+CreateRunOptions">CreateRunOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel.InputsModel_+3A_param">Param</code></td>
<td>
<p>[numeric] vector of model parameters (See details for SD lag model)</p>
</td></tr>
<tr><td><code id="RunModel.InputsModel_+3A_fun_mod">FUN_MOD</code></td>
<td>
<p>[function] hydrological model function (e.g. <code><a href="airGR.html#topic+RunModel_GR4J">RunModel_GR4J</a></code>, <code><a href="airGR.html#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code>)</p>
</td></tr>
<tr><td><code id="RunModel.InputsModel_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em>] see <code><a href="airGR.html#topic+CreateInputsModel">CreateInputsModel</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel.InputsModel_+3A_...">...</code></td>
<td>
<p>Further arguments for compatibility with S3 methods</p>
</td></tr>
</table>


<h3>Value</h3>

<p>[object of class <em>OutputsModel</em>] returned by <a href="airGR.html#topic+RunModel">airGR::RunModel</a>
(See Value section of <a href="airGR.html#topic+RunModel_GR4J">airGR::RunModel_GR4J</a>) completed by new items:
</p>

<ul>
<li> <p><code>Qsim_m3</code>: simulated flow in cubic meters per time step
</p>
</li>
<li> <p><code>Qover_m3</code> volumes of over abstractions which occurs when <code>RunModel_Lag</code> warns
for negative simulated flows
</p>
</li>
<li> <p><code>Qnat</code>: only present in case of Diversion in the node, simulated flow in mm
per time step before application of the Diversion
</p>
</li>
<li> <p><code>Qdiv_m3</code>: only present in case of Diversion in the node, simulated diverted flow in
cubic meters per time step. The latter differs from the flows time series provided
in argument <code>Qinf</code> of <a href="#topic+CreateInputsModel.GRiwrm">CreateInputsModel.GRiwrm</a> by the limitation of diversion
applied by the minimum flow threshold <code>Qmin</code> to keep flowing in the river
</p>
</li></ul>


<hr>
<h2 id='RunModel.Supervisor'>RunModel function for a GRiwrmInputsModel object</h2><span id='topic+RunModel.Supervisor'></span>

<h3>Description</h3>

<p>RunModel function for a GRiwrmInputsModel object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'Supervisor'
RunModel(x, RunOptions, Param, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RunModel.Supervisor_+3A_x">x</code></td>
<td>
<p>[object of class <code>Supervisor</code>] see <a href="#topic+CreateSupervisor">CreateSupervisor</a> for details</p>
</td></tr>
<tr><td><code id="RunModel.Supervisor_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>GRiwrmRunOptions</em>] see <code>[CreateRunOptions.GRiwrm]</code> for details</p>
</td></tr>
<tr><td><code id="RunModel.Supervisor_+3A_param">Param</code></td>
<td>
<p><a href="base.html#topic+list">list</a> parameter values. The list item names are the IDs of the sub-basins. Each item is a vector of numerical parameters</p>
</td></tr>
<tr><td><code id="RunModel.Supervisor_+3A_...">...</code></td>
<td>
<p>Further arguments for compatibility with S3 methods</p>
</td></tr>
</table>


<h3>Value</h3>

<p><em>GRiwrmOutputsModel</em> object which is a list of <em>OutputsModel</em> objects (See <a href="airGR.html#topic+RunModel">airGR::RunModel</a>) for each node of the semi-distributed model
</p>


<h3>Examples</h3>

<pre><code class='language-R'>###############################################################################
# An example of reservoir management on an hypothetical dam at station "54095"
# on the Severn river build to support low-flows at "54057"
###############################################################################
# A minimum flow of 50 m3/s is maintained at the dam location and an extra-release
# is provided when the flow at the downstream station "54057" cross a minimum
# threshold of 65 m3/s. The dam has a storage capacity of 650 millions m3
###############################################################################
library(airGRiwrm)

# Load Severn network information
data(Severn)
nodes &lt;- Severn$BasinsInfo[, c("gauge_id", "downstream_id", "distance_downstream", "area")]
nodes$model &lt;- "RunModel_GR4J"

# Insert a dam downstream the location the gauging station 54095
# The dam is a direct injection node
nodes$downstream_id[nodes$gauge_id == "54095"] &lt;- "Dam"
nodes$distance_downstream[nodes$gauge_id == "54095"] &lt;- 0
nodes &lt;- rbind(nodes,
               data.frame(gauge_id = "Dam",
                          downstream_id = "54001",
                          distance_downstream = 42,
                          area = NA,
                          model = "RunModel_Reservoir"))

griwrm &lt;- CreateGRiwrm(nodes,
                 list(id = "gauge_id",
                      down = "downstream_id",
                      length = "distance_downstream"))
## Not run: 
plot(griwrm)

## End(Not run)

# Format meteorological inputs for CreateInputs
BasinsObs &lt;- Severn$BasinsObs
DatesR &lt;- BasinsObs[[1]]$DatesR
PrecipTot &lt;- cbind(sapply(BasinsObs, function(x) {x$precipitation}))
PotEvapTot &lt;- cbind(sapply(BasinsObs, function(x) {x$peti}))
Precip &lt;- ConvertMeteoSD(griwrm, PrecipTot)
PotEvap &lt;- ConvertMeteoSD(griwrm, PotEvapTot)

# Create a release flow time series for the dam
# This release will be modified by the Supervisor
# We initiate it with the natural flow for having a good initialization of the
# model at the first time step of the running period
Qinf &lt;- data.frame(
  Dam = BasinsObs$`54095`$discharge_spec * griwrm$area[griwrm$id == "54095"] * 1E3
)

# InputsModel object
IM_severn &lt;- CreateInputsModel(griwrm, DatesR, Precip, PotEvap, Qinf)

# Initialization of the Supervisor
sv &lt;- CreateSupervisor(IM_severn)

# Dam management is modeled by a controller
# This controller releases a minimum flow Qmin and provides
# extra release if flow measured somewhere is below Qthreshold
# Flow is expressed in m3 / time step
# Y[1] = runoff flow at gauging station 54095 filling the reservoir
# Y[2] = flow at gauging station 54057, location of the low-flow objective
# The returned value is the release calculated at the reservoir
# We need to enclose the Supervisor variable and other parameters in
# the environment of the function with a function returning the logic function
factoryDamLogic &lt;- function(sv, Qmin, Qthreshold) {
  function(Y) {
    # Estimate natural flow at low-flow support location
    Qnat &lt;- Y[1] - Y[2]
    # The release is the max between: low-flow support and minimum flow
    U &lt;- max(Qthreshold - Qnat, Qmin)
    return(U)
  }
}

# And define a final function enclosing logic and parameters together
funDamLogic &lt;- factoryDamLogic(
  sv = sv, # The Supervisor which store the released flow
  Qmin = 50 * 86400, # Min flow to maintain downstream the reservoir (m3/day)
  Qthreshold = 65 * 86400 # Min flow threshold to support at station 54057 (m3/day)
)

CreateController(sv, "DamRelease", Y = c("54057", "Dam"), U = "Dam", FUN = funDamLogic)

# GRiwrmRunOptions object simulation of the hydrological year 2002-2003
IndPeriod_Run &lt;- which(
  DatesR &gt;= as.POSIXct("2002-11-01", tz = "UTC") &amp;
  DatesR &lt;= as.POSIXct("2003-11-01", tz = "UTC")
)
IndPeriod_WarmUp &lt;- seq.int(IndPeriod_Run[1] - 366, IndPeriod_Run[1] - 1)
RO_severn &lt;- CreateRunOptions(
  IM_severn,
  IndPeriod_WarmUp = IndPeriod_WarmUp,
  IndPeriod_Run = IndPeriod_Run
)

# Load parameters of the model from Calibration in vignette V02
P_severn &lt;- readRDS(system.file("vignettes", "ParamV02.RDS", package = "airGRiwrm"))

# Set the reservoir parameters: maximum storage capacity and celerity of inflows
# As the distance between the upstream node "54095" and the dam is 0 km, the celerity
# doesn't have any effect. However it must be positive.
P_severn$Dam &lt;- c(Vmax = 650E6, celerity = 1)

# The Supervisor is used instead of InputsModel for running the model
OM_dam &lt;- RunModel(sv,
                   RunOptions = RO_severn,
                   Param = P_severn)

# Plotting the time series of flows and reservoir storage
oldpar &lt;- par(mfrow=c(2,1),
              mar = c(2,3.3,1.2,0.5),
              mgp = c(2,1,0))
plot(attr(OM_dam, "Qm3s")[, c("DatesR", "54095", "Dam", "54057")],
     ylim = c(0, 200))
Vres &lt;- as.Qm3s(DatesR = OM_dam$Dam$DatesR,
                   "Simulated volume" = OM_dam$Dam$Vsim / 1E6)
plot(Vres,
     main = "Simulated reservoir storage",
     ylab = expression("Storage (Mm" ^ "3" * ")"))
par(oldpar)
</code></pre>

<hr>
<h2 id='Severn'>Catchment attributes and hydro-meteorological timeseries for some gauging stations on the Severn River</h2><span id='topic+Severn'></span>

<h3>Description</h3>

<p>Catchment attributes and hydro-meteorological timeseries for some gauging stations on the Severn River
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Severn
</code></pre>


<h3>Format</h3>

<p>a <a href="base.html#topic+list">list</a> with 2 items:
</p>

<ul>
<li><p> &quot;BasinsInfo&quot; which contains a <a href="base.html#topic+data.frame">data.frame</a> with Gauging station identifier, name, coordinates (GPS), area (km2), mean elevation (m), station type, flow period start and end, the bank full flow (m3/s), the identifier of the following downstream station and the distance to the following downstream station
</p>
</li>
<li><p> &quot;BasinObs&quot; which contains a <a href="base.html#topic+list">list</a> with an item by gauging station which contains a <a href="base.html#topic+data.frame">data.frame</a> with <a href="base.html#topic+POSIXct">POSIXct</a> dates, precipitations (mm/time step), potential evapotranspiration (mm/time step) and measured flows (mm/time step)
</p>
</li></ul>



<h3>Source</h3>

<p>These data are extracted from the CAMEL-GB dataset.
</p>
<p>Coxon, G.; Addor, N.; Bloomfield, J.P.; Freer, J.; Fry, M.; Hannaford, J.; Howden, N.J.K.; Lane, R.; Lewis, M.; Robinson, E.L.; Wagener, T.; Woods, R. (2020). Catchment attributes and hydro-meteorological timeseries for 671 catchments across Great Britain (CAMELS-GB). NERC Environmental Information Data Centre. (Dataset). <a href="https://doi.org/10.5285/8344E4F3-D2EA-44F5-8AFA-86D2987543A9">doi:10.5285/8344E4F3-D2EA-44F5-8AFA-86D2987543A9</a>
</p>

<hr>
<h2 id='sort.GRiwrm'>Sort a GRiwrm network in upstream-downstream order ready for Calibration</h2><span id='topic+sort.GRiwrm'></span>

<h3>Description</h3>

<p>It Uses <a href="#topic+getNodeRanking">getNodeRanking</a> for determining the best order for calibration and leaves
direct injection nodes at the tail of the list.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'GRiwrm'
sort(x, decreasing = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sort.GRiwrm_+3A_x">x</code></td>
<td>
<p>A <em>GRiwrm</em> object (See <a href="#topic+CreateGRiwrm">CreateGRiwrm</a>)</p>
</td></tr>
<tr><td><code id="sort.GRiwrm_+3A_decreasing">decreasing</code></td>
<td>
<p>logical.  Should the sort be increasing or decreasing?
Not available for partial sorting.</p>
</td></tr>
<tr><td><code id="sort.GRiwrm_+3A_...">...</code></td>
<td>
<p>arguments to be passed to or from methods or (for the
default methods and objects without a class) to <code>sort.int</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The sorted <em>GRiwrm</em> object in upstream-downstream order ready for Calibration
</p>

<hr>
<h2 id='transferGRparams'>Transfer GR parameters from one donor sub-basin to a receiver sub-basin</h2><span id='topic+transferGRparams'></span>

<h3>Description</h3>

<p>This function is used by <code>Calibration.GRiwrmInputsModel</code> for transferring parameters
to ungauged nodes and
</p>


<h3>Usage</h3>

<pre><code class='language-R'>transferGRparams(
  InputsModel,
  Param,
  donor,
  receiver,
  default_param = NULL,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="transferGRparams_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>A <em>GRiwrmInputsModel</em> object (See <a href="#topic+CreateInputsModel.GRiwrm">CreateInputsModel.GRiwrm</a>)</p>
</td></tr>
<tr><td><code id="transferGRparams_+3A_param">Param</code></td>
<td>
<p><a href="base.html#topic+numeric">numeric</a> vector of GR model parameters</p>
</td></tr>
<tr><td><code id="transferGRparams_+3A_donor">donor</code></td>
<td>
<p><a href="base.html#topic+character">character</a> id of the node which gives its parameters</p>
</td></tr>
<tr><td><code id="transferGRparams_+3A_receiver">receiver</code></td>
<td>
<p><a href="base.html#topic+character">character</a> id of the node which receives the parameters from the donor</p>
</td></tr>
<tr><td><code id="transferGRparams_+3A_default_param">default_param</code></td>
<td>
<p><a href="base.html#topic+numeric">numeric</a> vector of GR model parameters if parameters are missing from the donor</p>
</td></tr>
<tr><td><code id="transferGRparams_+3A_verbose">verbose</code></td>
<td>
<p><a href="base.html#topic+logical">logical</a> Add information message on donor and receiver</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>donor</code> and <code>receiver</code> nodes should have the same GR model with the same snow
module configuration.
</p>
<p>The transfer takes care of:
</p>

<ul>
<li><p> the presence/absence of hydraulic routing parameters between the donor and the receiver
</p>
</li>
<li><p> the transformation of the X4 parameters of GR models
</p>
</li></ul>



<h3>Value</h3>

<p>A <a href="base.html#topic+numeric">numeric</a> <a href="base.html#topic+vector">vector</a> with transferred parameters
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
