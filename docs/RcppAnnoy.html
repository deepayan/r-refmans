<!DOCTYPE html><html><head><title>Help for package RcppAnnoy</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {RcppAnnoy}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#AnnoyIndex'><p>Approximate Nearest Neighbors with Annoy</p></a></li>
<li><a href='#getAnnoyVersion'><p>Get the Annoy library version</p></a></li>
<li><a href='#getArchictectureStatus'><p>Report CPU Architecture and Compiler</p></a></li>
<li><a href='#RcppAnnoy-package'>
<p>Rcpp bindings for the Annoy C++ library for approximate nearest neighbors.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>'Rcpp' Bindings for 'Annoy', a Library for Approximate Nearest
Neighbors</td>
</tr>
<tr>
<td>Version:</td>
<td>0.0.22</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-01-23</td>
</tr>
<tr>
<td>Author:</td>
<td>Dirk Eddelbuettel</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Dirk Eddelbuettel &lt;edd@debian.org&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>'Annoy' is a small C++ library for Approximate Nearest Neighbors 
 written for efficient memory usage as well an ability to load from / save to
 disk. This package provides an R interface by relying on the 'Rcpp' package,
 exposing the same interface as the original Python wrapper to 'Annoy'. See
 <a href="https://github.com/spotify/annoy">https://github.com/spotify/annoy</a> for more on 'Annoy'. 'Annoy' is released
 under Version 2.0 of the Apache License. Also included is a small Windows
 port of 'mmap' which is released under the MIT license.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.1)</td>
</tr>
<tr>
<td>Imports:</td>
<td>methods, Rcpp</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp</td>
</tr>
<tr>
<td>Suggests:</td>
<td>tinytest</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/eddelbuettel/rcppannoy">https://github.com/eddelbuettel/rcppannoy</a>,
<a href="https://dirk.eddelbuettel.com/code/rcpp.annoy.html">https://dirk.eddelbuettel.com/code/rcpp.annoy.html</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/eddelbuettel/rcppannoy/issues">https://github.com/eddelbuettel/rcppannoy/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-01-23 00:46:29 UTC; edd</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-01-23 14:33:04 UTC</td>
</tr>
</table>
<hr>
<h2 id='AnnoyIndex'>Approximate Nearest Neighbors with Annoy</h2><span id='topic+AnnoyIndex'></span><span id='topic+AnnoyEuclidean'></span><span id='topic+Rcpp_AnnoyEuclidean-class'></span><span id='topic+Rcpp_AnnoyEuclidean'></span><span id='topic+AnnoyAngular'></span><span id='topic+Rcpp_AnnoyAngular-class'></span><span id='topic+Rcpp_AnnoyAngular'></span><span id='topic+AnnoyManhattan'></span><span id='topic+Rcpp_AnnoyManhattan-class'></span><span id='topic+Rcpp_AnnoyManhattan'></span><span id='topic+AnnoyHamming'></span><span id='topic+Rcpp_AnnoyHamming-class'></span><span id='topic+Rcpp_AnnoyHamming'></span>

<h3>Description</h3>

<p>Annoy is a small library written to provide fast and memory-efficient
nearest neighbor lookup from a possibly static index which can be
shared across processes.
</p>


<h3>Usage</h3>

<pre>
a &lt;- new(AnnoyEuclidean, vectorsz)

a$setSeed(0)
a$setVerbose(0)

a$addItem(i, dv)

a$getNItems()

a$getItemsVector(i)
a$getDistance(i, j)

a$build(n_trees)

a$getNNsByItem(i, n)
a$getNNsByItemList(i, n, search_k, include_distances)

a$getNNsByVector(v, n)
a$getNNsByVectorList(v, n, search_k, include_distances)

a$save(fn)
a$load(fn)
a$unload()
</pre>


<h3>Details</h3>

<p><code>new(Class, vectorsz)</code>
Create a new Annoy instance of type <code>Class</code> where <code>Class</code>
is on of the following:
<code>AnnoyEuclidean</code>,
<code>AnnoyAngular</code>,
<code>AnnoyManhattan</code>,
<code>AnnoyHamming</code>.
<code>vectorsz</code> denotes the length of the vectors that the Annoy instance
will be indexing.
</p>
<p><code>$addItem(i, v)</code>
Adds item <code>i</code> (any nonnegative integer) with vector <code>v</code>.
Note that it will allocate memory for <code>max(i) + 1</code> items.
</p>
<p><code>$build(n_trees)</code>
Builds a forest of <code>n_trees</code> trees.
More trees gives higher precision when querying.
After calling <code>build</code>, no more items can be added.
</p>
<p><code>$save(fn)</code>
Saves the index to disk as filename <code>fn</code>.
After saving, no more items can be added.
</p>
<p><code>$load(fn)</code>
Loads (mmaps) an index from filename <code>fn</code> on disk.
</p>
<p><code>$unload()</code>
Unloads index.
</p>
<p><code>$getDistance(i, j)</code>
Returns the distance between items <code>i</code> and <code>j</code>
</p>
<p><code>$getNNsByItem(i, n)</code>
Returns the <code>n</code> closest items as an integer vector of indices.
</p>
<p><code>$getNNsByVector(v, n)</code>
Same as <code>$getNNsByItem</code>, but queries by vector <code>v</code> rather than
index <code>i</code>.
</p>
<p><code>$getNNsByItemList(i, n, search_k = -1, include_distances = FALSE)</code>
Returns the n closest items to item <code>i</code> as a list.
During the query it will inspect up to <code>search_k</code> nodes which
defaults to <code>n_trees * n</code> if not provided.
<code>search_k</code> gives you a run-time tradeoff between better accuracy and
speed.
If you set <code>include_distances</code> to <code>TRUE</code>,
it will return a length 2 list with elements <code>"item"</code> &amp;
<code>"distance"</code>.
The <code>"item"</code> element contains the <code>n</code> closest items as an integer
vector of indices.
The optional <code>"distance"</code> element contains the corresponding distances
to <code>"item"</code> as a numeric vector.
</p>
<p><code>$getNNsByVectorList(i, n, search_k = -1, include_distances = FALSE)</code>
Same as <code>$getNNsByItemList</code>, but queries by vector <code>v</code> rather than
index <code>i</code>
</p>
<p><code>$getItemsVector(i)</code>
Returns the vector for item <code>i</code> that was previously added.
</p>
<p><code>$getNItems()</code>
Returns the number of items in the index.
</p>
<p><code>$setVerbose()</code>
If <code>1</code> then messages will be printed during processing.
If <code>0</code> then messages will be suppressed during processing.
</p>
<p><code>$setSeed()</code>
Set random seed for annoy (integer).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(RcppAnnoy)

# BUILDING ANNOY INDEX ---------------------------------------------------------
vector_size &lt;- 10
a &lt;- new(AnnoyEuclidean, vector_size)

a$setSeed(42)

# Turn on verbose status messages (0 to turn off)
a$setVerbose(1)

# Load 100 random vectors into index
for (i in 1:100) a$addItem(i - 1, runif(vector_size)) # Annoy uses zero indexing

# Display number of items in index
a$getNItems()

# Retrieve item at postition 0 in index
a$getItemsVector(0)

# Calculate distance between items at postitions 0 &amp; 1 in index
a$getDistance(0, 1)

# Build forest with 50 trees
a$build(50)


# PERFORMING ANNOY SEARCH ------------------------------------------------------

# Retrieve 5 nearest neighbors to item 0
# Returned as integer vector of indices
a$getNNsByItem(0, 5)

# Retrieve 5 nearest neighbors to item 0
# search_k = -1 will invoke default search_k value of n_trees * n
# Return results as list with an element for distance
a$getNNsByItemList(0, 5, -1, TRUE)

# Retrieve 5 nearest neighbors to item 0
# search_k = -1 will invoke default search_k value of n_trees * n
# Return results as list without an element for distance
a$getNNsByItemList(0, 5, -1, FALSE)


v &lt;- runif(vector_size)
# Retrieve 5 nearest neighbors to vector v
# Returned as integer vector of indices
a$getNNsByVector(v, 5)

# Retrieve 5 nearest neighbors to vector v
# search_k = -1 will invoke default search_k value of n_trees * n
# Return results as list with an element for distance
a$getNNsByVectorList(v, 5, -1, TRUE)

# Retrieve 5 nearest neighbors to vector v
# search_k = -1 will invoke default search_k value of n_trees * n
# Return results as list with an element for distance
a$getNNsByVectorList(v, 5, -1, TRUE)


# SAVING/LOADING ANNOY INDEX ---------------------------------------------------

# Create a tempfile, replace with a local file to keep
treefile &lt;- tempfile(pattern="annoy", fileext="tree")

# Save annoy tree to disk
a$save(treefile)

# Load annoy tree from disk
a$load(treefile)

# Unload index from memory
a$unload()
</code></pre>

<hr>
<h2 id='getAnnoyVersion'>Get the Annoy library version</h2><span id='topic+getAnnoyVersion'></span>

<h3>Description</h3>

<p>Get the version of the Annoy C++ library that RcppAnnoy was compiled with.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getAnnoyVersion(compact = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getAnnoyVersion_+3A_compact">compact</code></td>
<td>
<p>Logical scalar indicating whether a compact
<code><a href="base.html#topic+package_version">package_version</a></code> should be returned.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An integer vector containing the major, minor and patch version numbers;
or if <code>compact=TRUE</code>, a <code><a href="base.html#topic+package_version">package_version</a></code> object.
</p>


<h3>Author(s)</h3>

<p>Aaron Lun
</p>

<hr>
<h2 id='getArchictectureStatus'>Report CPU Architecture and Compiler</h2><span id='topic+getArchictectureStatus'></span>

<h3>Description</h3>

<p>Report CPU Architecture and Compiler
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getArchictectureStatus()
</code></pre>


<h3>Value</h3>

<p>A constant direct created at compile-time describing
the extent of AVX instructions (512 bit, 128 bit, or none)
and compiler use where currently recognised are MSC (unlikely
for R), GCC, Clang, or &lsquo;other&rsquo;.
</p>

<hr>
<h2 id='RcppAnnoy-package'>
Rcpp bindings for the Annoy C++ library for approximate nearest neighbors.
</h2><span id='topic+RcppAnnoy-package'></span><span id='topic+RcppAnnoy'></span><span id='topic+Rcpp_Annoy'></span>

<h3>Description</h3>

<p>Annoy is a small library written to provide fast and memory-efficient
nearest neigbor lookup from a possibly static index which can be
shared across processes.
</p>


<h3>Details</h3>

<p>Details about Annoy are available at the reference listed below.
</p>


<h3>Author(s)</h3>

<p>Dirk Eddelbuettel for the R interface; Erik Bernhardsson for Annoy itself.
</p>
<p>Maintainer: Dirk Eddelbuettel &lt;edd@debian.org&gt;
</p>


<h3>References</h3>

<p><a href="https://github.com/spotify/annoy">https://github.com/spotify/annoy</a>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
