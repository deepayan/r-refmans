<!DOCTYPE html><html lang="en-US"><head><title>Help for package labNorm</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {labNorm}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#labNorm-package'><p>labNorm: Normalize Laboratory Measurements by Age and Sex</p></a></li>
<li><a href='#hemoglobin_data'><p>Example values of Hemoglobin and Creatinine</p></a></li>
<li><a href='#LAB_DETAILS'><p>Available lab names</p></a></li>
<li><a href='#ln_convert_units'><p>Convert values to the default units for the lab</p></a></li>
<li><a href='#ln_download_data'><p>Download high-resolution reference distributions</p></a></li>
<li><a href='#ln_lab_units'><p>Get available units for a lab</p></a></li>
<li><a href='#ln_normalize'><p>Normalize lab values to age and sex</p></a></li>
<li><a href='#ln_plot_dist'><p>Plot age-sex distribution of a lab</p></a></li>
<li><a href='#ln_quantile_value'><p>Compute the lab value for a given quantile</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Normalize Laboratory Measurements by Age and Sex</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.1</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides functions for normalizing standard laboratory measurements (e.g. hemoglobin, cholesterol levels) according to age and sex, based on the algorithms described in "Personalized lab test models to quantify disease potentials in healthy individuals" (Netta Mendelson Cohen, Omer Schwartzman, Ram Jaschek, Aviezer Lifshitz, Michael Hoichman, Ran Balicer, Liran I. Shlush, Gabi Barbash &amp; Amos Tanay, &lt;<a href="https://doi.org/10.1038%2Fs41591-021-01468-6">doi:10.1038/s41591-021-01468-6</a>&gt;). Allows users to easily obtain normalized values for standard lab results, and to visualize their distributions. See more at <a href="https://tanaylab.weizmann.ac.il/labs/">https://tanaylab.weizmann.ac.il/labs/</a>.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Suggests:</td>
<td>covr, mockery, spelling, testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Config/testthat/start-first:</td>
<td>download</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Imports:</td>
<td>cli, dplyr, forcats, ggplot2, glue, purrr, rappdirs, scales,
stats, tibble, utils, withr, yesno</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-01-15 06:44:16 UTC; aviezerl</td>
</tr>
<tr>
<td>Author:</td>
<td>Aviezer Lifshitz [aut, cre],
  Netta Mendelson-Cohen [aut],
  Weizmann Institute of Science [cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Aviezer Lifshitz &lt;aviezer.lifshitz@weizmann.ac.il&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-01-15 14:30:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='labNorm-package'>labNorm: Normalize Laboratory Measurements by Age and Sex</h2><span id='topic+labNorm'></span><span id='topic+labNorm-package'></span>

<h3>Description</h3>

<p><img src="../help/figures/logo.png" style='float: right' alt='logo' width='120' />
</p>
<p>Provides functions for normalizing standard laboratory measurements (e.g. hemoglobin, cholesterol levels) according to age and sex, based on the algorithms described in &quot;Personalized lab test models to quantify disease potentials in healthy individuals&quot; (Netta Mendelson Cohen, Omer Schwartzman, Ram Jaschek, Aviezer Lifshitz, Michael Hoichman, Ran Balicer, Liran I. Shlush, Gabi Barbash &amp; Amos Tanay, <a href="https://doi.org/10.1038/s41591-021-01468-6">doi:10.1038/s41591-021-01468-6</a>). Allows users to easily obtain normalized values for standard lab results, and to visualize their distributions. See more at <a href="https://tanaylab.weizmann.ac.il/labs/">https://tanaylab.weizmann.ac.il/labs/</a>.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Aviezer Lifshitz <a href="mailto:aviezer.lifshitz@weizmann.ac.il">aviezer.lifshitz@weizmann.ac.il</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> Netta Mendelson-Cohen <a href="mailto:netta.mendelsoncohen@weizmann.ac.il">netta.mendelsoncohen@weizmann.ac.il</a>
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> Weizmann Institute of Science [copyright holder]
</p>
</li></ul>


<hr>
<h2 id='hemoglobin_data'>Example values of Hemoglobin and Creatinine</h2><span id='topic+hemoglobin_data'></span><span id='topic+creatinine_data'></span>

<h3>Description</h3>

<p>Example datasets of Hemoglobin and Creatinine values for testing
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hemoglobin_data

creatinine_data
</code></pre>


<h3>Format</h3>



<h4><code>hemoglobin_data</code> <code>creatinine_data</code></h4>

<p>A data frame with 1000 rows and 3 columns:
</p>

<dl>
<dt>age</dt><dd><p>age of the patient</p>
</dd>
<dt>sex</dt><dd><p>sex of the patient</p>
</dd>
<dt>value</dt><dd><p>the lab value for the patient, in the default units for the lab</p>
</dd>
</dl>


<p>An object of class <code>data.frame</code> with 1000 rows and 3 columns.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>head(hemoglobin_data)
head(creatinine_data)
</code></pre>

<hr>
<h2 id='LAB_DETAILS'>Available lab names</h2><span id='topic+LAB_DETAILS'></span>

<h3>Description</h3>

<p>Names of the labs available in the package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>LAB_DETAILS
</code></pre>


<h3>Format</h3>



<h4><code>LAB_DETAILS</code></h4>

<p>A data frame with 95 rows and 4 columns:
</p>

<dl>
<dt>short_name</dt><dd><p>Short lab name</p>
</dd>
<dt>long_name</dt><dd><p>Long lab name</p>
</dd>
<dt>units</dt><dd><p>a list column with all the units available for the lab</p>
</dd>
<dt>default_units</dt><dd><p>the default units for the lab</p>
</dd>
<dt>low_male,high_male,low_female,high_female</dt><dd><p>the reference ranges for the lab, taken from the American Board of Internal Medicine. Can be NA if the lab does not have reference ranges.</p>
</dd>
</dl>




<h3>Source</h3>

<p>American Board of Internal Medicine. ABIM Laboratory Test Reference Ranges â€” July 2021. <a href="https://www.abim.org/~/media/ABIM%20Public/Files/pdf/exam/laboratory-reference-ranges.pdf">https://www.abim.org/~/media/ABIM%20Public/Files/pdf/exam/laboratory-reference-ranges.pdf</a> (2021).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>head(LAB_DETAILS)
</code></pre>

<hr>
<h2 id='ln_convert_units'>Convert values to the default units for the lab</h2><span id='topic+ln_convert_units'></span>

<h3>Description</h3>

<p>Convert values to the default units for the lab
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ln_convert_units(values, units, lab)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ln_convert_units_+3A_values">values</code></td>
<td>
<p>a vector of lab values</p>
</td></tr>
<tr><td><code id="ln_convert_units_+3A_units">units</code></td>
<td>
<p>the units of the lab values. See <code>LAB_DETAILS$units</code> for a list of available units for each lab. If different values have different units then this should be a vector of the same length as <code>values</code>.</p>
</td></tr>
<tr><td><code id="ln_convert_units_+3A_lab">lab</code></td>
<td>
<p>the lab name. See <code>LAB_DETAILS$short_name</code> for a list of available labs.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the values converted to the default units for the lab
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# emulate a dataset with different units

hemoglobin_diff_units &lt;- hemoglobin_data

# first 50 values will be in mg/ML
hemoglobin_diff_units$value[1:50] &lt;- hemoglobin_diff_units$value[1:50] * 10

# last 50 values will be in mmol/L
hemoglobin_diff_units$value[51:100] &lt;- hemoglobin_diff_units$value[51:100] / 1.61


converted &lt;- ln_convert_units(
    hemoglobin_diff_units$value[1:100],
    c(rep("mg/mL", 50), rep("mmol/L", 50)),
    "Hemoglobin"
)

head(converted)
head(hemoglobin_data$value)
</code></pre>

<hr>
<h2 id='ln_download_data'>Download high-resolution reference distributions</h2><span id='topic+ln_download_data'></span><span id='topic+ln_data_downloaded'></span>

<h3>Description</h3>

<p>The data is downloaded to the directory specified by the <code>dir</code> parameter. Note
that if you specified a directory different from the default, you will need to set <code>options(labNorm.dir = dir)</code> in order for the package to use the downloaded data in future sessions.
<br />
Default directories are:
</p>

<ul>
<li><p> Unix: ~/.local/share/LabNorm
</p>
</li>
<li><p> Mac OS X: <code style="white-space: pre;">&#8288;~/Library/Application Support/LabNorm&#8288;</code>
</p>
</li>
<li><p> Win XP (not roaming): <code style="white-space: pre;">&#8288;C:\\Documents and Settings\\&lt;username&gt;\\Data\\&lt;AppAuthor&gt;\\LabNorm&#8288;</code>
</p>
</li>
<li><p> Win XP (roaming): <code style="white-space: pre;">&#8288;C:\\Documents and Settings\\&lt;username&gt;\\Local Settings\\Data\\&lt;AppAuthor&gt;\\LabNorm&#8288;</code>
</p>
</li>
<li><p> Win 7 (not roaming): <code style="white-space: pre;">&#8288;C:\\Users\\&lt;username&gt;\\AppData\\Local\\&lt;AppAuthor&gt;\\LabNorm&#8288;</code>
</p>
</li>
<li><p> Win 7 (roaming): <code style="white-space: pre;">&#8288;C:\\Users\\&lt;username&gt;\\AppData\\Roaming\\&lt;AppAuthor&gt;\\LabNorm&#8288;</code>
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>ln_download_data(dir = NULL)

ln_data_downloaded()
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ln_download_data_+3A_dir">dir</code></td>
<td>
<p>the directory to download the data to. If <code>NULL</code> and the user approves, the data will be downloaded to the package directory, using <code>rappdirs::user_data_dir("labnorm")</code>, otherwise - a temporary directory would be used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>None.
</p>
<p>True if the data was downloaded, false otherwise.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
ln_download_data()


ln_data_downloaded()

</code></pre>

<hr>
<h2 id='ln_lab_units'>Get available units for a lab</h2><span id='topic+ln_lab_units'></span><span id='topic+ln_lab_default_units'></span>

<h3>Description</h3>

<p>Get available units for a lab
</p>
<p>Get the default units for a lab
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ln_lab_units(lab)

ln_lab_default_units(lab)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ln_lab_units_+3A_lab">lab</code></td>
<td>
<p>the lab name. See <code>LAB_DETAILS$short_name</code> for a list of available labs.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a vector of available units for the lab
</p>
<p>the default units for the lab
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ln_lab_units("Hemoglobin")

ln_lab_default_units("Hemoglobin")
</code></pre>

<hr>
<h2 id='ln_normalize'>Normalize lab values to age and sex</h2><span id='topic+ln_normalize'></span><span id='topic+ln_normalize_multi'></span>

<h3>Description</h3>

<p>Normalize standard laboratory measurements (e.g. hemoglobin, cholesterol levels) according to age and sex, based on the algorithms described in &quot;Personalized lab test models to quantify disease potentials in healthy individuals&quot; <a href="https://doi.org/10.1038/s41591-021-01468-6">doi:10.1038/s41591-021-01468-6</a>. <br /> <br />
The &quot;Clalit&quot; reference distributions are based on 2.1B lab measurements taken from 2.8M individuals between 2002-2019, filtered to exclude severe chronic diseases and medication effects. The resulting normalized value is a quantile between 0 and 1, representing the value's position in the reference distribution. <br /> <br />
The &quot;UKBB&quot; reference distributions are based on the UK-Biobank, a large-scale population-based cohort study of 500K individuals, which underwent the same filtering process as the &quot;Clalit&quot; reference distributions.
<br /> <br />
The list of supported labs can be found below or by running <code>LAB_DETAILS$short_name</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ln_normalize(
  values,
  age,
  sex,
  lab,
  units = NULL,
  reference = "Clalit",
  na.rm = FALSE
)

ln_normalize_multi(labs_df, reference = "Clalit", na.rm = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ln_normalize_+3A_values">values</code></td>
<td>
<p>a vector of lab values</p>
</td></tr>
<tr><td><code id="ln_normalize_+3A_age">age</code></td>
<td>
<p>a vector of ages between 20-89 for &quot;Clalit&quot; reference and 35-80 for &quot;UKBB&quot;. Can be a single value if all values are the same age.</p>
</td></tr>
<tr><td><code id="ln_normalize_+3A_sex">sex</code></td>
<td>
<p>a vector of either &quot;male&quot; or &quot;female&quot;. Can be a single value if all values are the same sex.</p>
</td></tr>
<tr><td><code id="ln_normalize_+3A_lab">lab</code></td>
<td>
<p>the lab name. See <code>LAB_DETAILS$short_name</code> for a list of available labs.</p>
</td></tr>
<tr><td><code id="ln_normalize_+3A_units">units</code></td>
<td>
<p>the units of the lab values. See <code>ln_lab_units(lab)</code> for a list of available units for each lab. If <code>NULL</code> then the default units (<code>ln_lab_default_units(lab)</code>) for the lab will be used. If different values have different units then this should be a vector of the same length as <code>values</code>.</p>
</td></tr>
<tr><td><code id="ln_normalize_+3A_reference">reference</code></td>
<td>
<p>the reference distribution to use. Can be either &quot;Clalit&quot; or &quot;UKBB&quot; or &quot;Clalit-demo&quot;. Please download the Clalit and UKBB reference distributions using <code>ln_download_data()</code>.</p>
</td></tr>
<tr><td><code id="ln_normalize_+3A_na.rm">na.rm</code></td>
<td>
<p>if <code>TRUE</code>, then <code>NA</code> in age, sex or values will be ignored and 'NA' would be returned. Otherwise, an error will be thrown.</p>
</td></tr>
<tr><td><code id="ln_normalize_+3A_labs_df">labs_df</code></td>
<td>
<p>a data frame with the columns &quot;value&quot;, &quot;age&quot;, &quot;sex&quot;, &quot;units&quot;, and &quot;lab&quot;. The &quot;lab&quot; column should be a vector with the lab name per row. See <code>ln_normalize</code> for details on the other columns.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a vector of normalized values. If <code>ln_download_data()</code> was not run, a lower resolution reference distribution will be used, which can have an error of up to 5 quantiles (0.05). Otherwise, the full reference distribution will be used. You can check if the high resolution data was downloaded using <code>ln_data_downloaded()</code>. <br />
You can force the function to use the lower resolution distribution by setting <code>options(labNorm.use_low_res = TRUE)</code>. <br />
If the quantile information is not available (e.g. &quot;Estradiol&quot; for male patients, various labs which are not available in the UKBB data), then the function will return <code>NA</code>.
</p>


<h3>reference distribution</h3>

<p>It is highly recommended to use <code>ln_download_data</code> to download the &quot;Clalit&quot; and &quot;UKBB&quot; reference distributions. If you choose not to download the data, the package will use the demo reference distributions included in the package (&quot;Clalit-demo&quot;), which doesn't include all the labs, and has a resolution of 20 quantile bins and therefore may have an error of up to 5 percentiles (0.05), particularly at the edges of the distribution. <br />
</p>


<h3>labs</h3>

<p>The following labs are supported in the &quot;Clalit&quot; reference (some labs are missing from the UKBB reference): <br />
</p>

<ul>
<li><p> WBC
</p>
</li>
<li><p> RBC
</p>
</li>
<li><p> Hemoglobin
</p>
</li>
<li><p> Hematocrit
</p>
</li>
<li><p> Platelets
</p>
</li>
<li><p> MCV
</p>
</li>
<li><p> MCH
</p>
</li>
<li><p> MCHC
</p>
</li>
<li><p> RDW
</p>
</li>
<li><p> MPV
</p>
</li>
<li><p> Large unstained cells, Abs
</p>
</li>
<li><p> Albumin
</p>
</li>
<li><p> Total Cholesterol
</p>
</li>
<li><p> Triglycerides
</p>
</li>
<li><p> BMI
</p>
</li>
<li><p> Iron
</p>
</li>
<li><p> Transferrin
</p>
</li>
<li><p> Ferritin
</p>
</li>
<li><p> PDW
</p>
</li>
<li><p> MPXI
</p>
</li>
<li><p> Total Globulin
</p>
</li>
<li><p> PCT
</p>
</li>
<li><p> HDW
</p>
</li>
<li><p> Fibrinogen
</p>
</li>
<li><p> CH
</p>
</li>
<li><p> Chloride
</p>
</li>
<li><p> Large unstained cells, %
</p>
</li>
<li><p> Macrocytic
</p>
</li>
<li><p> Microcytic
</p>
</li>
<li><p> Hyperchromic
</p>
</li>
<li><p> Hypochromic
</p>
</li>
<li><p> Lymphocytes, Abs
</p>
</li>
<li><p> Lymphocytes, %
</p>
</li>
<li><p> Neutrophils, Abs
</p>
</li>
<li><p> Neutrophils, %
</p>
</li>
<li><p> Monocytes, Abs
</p>
</li>
<li><p> Monocytes, %
</p>
</li>
<li><p> Eosinophils, Abs
</p>
</li>
<li><p> Eosinophils, %
</p>
</li>
<li><p> Basophils, Abs
</p>
</li>
<li><p> Basophils, %
</p>
</li>
<li><p> Microcytic:Hypochromic
</p>
</li>
<li><p> Glucose
</p>
</li>
<li><p> Urea
</p>
</li>
<li><p> Creatinine
</p>
</li>
<li><p> Uric Acid
</p>
</li>
<li><p> Calcium
</p>
</li>
<li><p> Phosphorus
</p>
</li>
<li><p> Total Protein
</p>
</li>
<li><p> HDL Cholesterol
</p>
</li>
<li><p> LDL Cholesterol
</p>
</li>
<li><p> Alk. Phosphatase
</p>
</li>
<li><p> AST
</p>
</li>
<li><p> ALT
</p>
</li>
<li><p> GGT
</p>
</li>
<li><p> LDH
</p>
</li>
<li><p> CPK
</p>
</li>
<li><p> Total Bilirubin
</p>
</li>
<li><p> Direct Bilirubin
</p>
</li>
<li><p> Hemoglobin A1c
</p>
</li>
<li><p> Sodium
</p>
</li>
<li><p> Potassium
</p>
</li>
<li><p> Vitamin D (25-OH)
</p>
</li>
<li><p> Microalbumin:Creatinine
</p>
</li>
<li><p> Urine Creatinine
</p>
</li>
<li><p> Urine Microalbumin
</p>
</li>
<li><p> Non-HDL
</p>
</li>
<li><p> TSH
</p>
</li>
<li><p> T3, Free
</p>
</li>
<li><p> T4, Free
</p>
</li>
<li><p> Blood Pressure, Systolic
</p>
</li>
<li><p> Blood Pressure, Diastolic
</p>
</li>
<li><p> Urine Specific Gravity
</p>
</li>
<li><p> Urine pH
</p>
</li>
<li><p> PT, INR
</p>
</li>
<li><p> PT, sec
</p>
</li>
<li><p> PT, %
</p>
</li>
<li><p> Vitamin B12
</p>
</li>
<li><p> PSA
</p>
</li>
<li><p> ESR
</p>
</li>
<li><p> aPTT, sec
</p>
</li>
<li><p> CRP
</p>
</li>
<li><p> Amylase
</p>
</li>
<li><p> Folic Acid
</p>
</li>
<li><p> Total:HDL
</p>
</li>
<li><p> Hematocrit:Hemoglobin
</p>
</li>
<li><p> Magnesium
</p>
</li>
<li><p> aPTT, ratio
</p>
</li>
<li><p> Indirect Bilirubin
</p>
</li>
<li><p> RDW-SD
</p>
</li>
<li><p> RDW-CV
</p>
</li>
<li><p> LH
</p>
</li>
<li><p> Estradiol
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
# Normalize Hemoglobin values to age and sex
hemoglobin_data$quantile &lt;- ln_normalize(
    hemoglobin_data$value,
    hemoglobin_data$age,
    hemoglobin_data$sex,
    "Hemoglobin"
)

# plot the quantiles vs values for age 50-60
library(ggplot2)
library(dplyr)
hemoglobin_data %&gt;%
    filter(age &gt;= 50 &amp; age &lt;= 60) %&gt;%
    ggplot(aes(x = value, y = quantile, color = sex)) +
    geom_point() +
    theme_classic()

# Different units
hemoglobin_diff_units &lt;- hemoglobin_data
hemoglobin_diff_units$value &lt;- hemoglobin_diff_units$value * 0.1
hemoglobin_diff_units$quantile &lt;- ln_normalize(
    hemoglobin_data$value,
    hemoglobin_data$age,
    hemoglobin_data$sex,
    "Hemoglobin",
    "mg/mL"
)

# Multiple units
creatinine_diff_units &lt;- creatinine_data
creatinine_diff_units$value &lt;- c(
    creatinine_diff_units$value[1:500] * 0.011312,
    creatinine_diff_units$value[501:1000] * 11.312
)
creatinine_diff_units$quantile &lt;- ln_normalize(
    creatinine_diff_units$value,
    creatinine_diff_units$age,
    creatinine_diff_units$sex,
    "Creatinine",
    c(rep("umol/L", 500), rep("mmol/L", 500))
)

# Use UKBB as reference
hemoglobin_data_ukbb &lt;- hemoglobin_data %&gt;% filter(age &gt;= 35 &amp; age &lt;= 80)
hemoglobin_data_ukbb$quantile_ukbb &lt;- ln_normalize(
    hemoglobin_data_ukbb$value,
    hemoglobin_data_ukbb$age,
    hemoglobin_data_ukbb$sex,
    "Hemoglobin",
    reference = "UKBB"
)

# plot UKBB vs Clalit
hemoglobin_data_ukbb %&gt;%
    filter(age &gt;= 50 &amp; age &lt;= 60) %&gt;%
    ggplot(aes(x = quantile, y = quantile_ukbb, color = sex)) +
    geom_point() +
    geom_abline() +
    theme_classic()


# examples on the demo data


library(dplyr)
multi_labs_df &lt;- bind_rows(
    hemoglobin_data %&gt;% mutate(lab = "Hemoglobin"),
    creatinine_data %&gt;% mutate(lab = "Creatinine")
)


multi_labs_df$quantile &lt;- ln_normalize_multi(multi_labs_df)


# on the demo data


head(multi_labs_df)

</code></pre>

<hr>
<h2 id='ln_plot_dist'>Plot age-sex distribution of a lab</h2><span id='topic+ln_plot_dist'></span>

<h3>Description</h3>

<p>Plot age-sex distribution of a lab
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ln_plot_dist(
  lab,
  quantiles = c(0.03, 0.1, 0.15, 0.25, 0.35, 0.65, 0.75, 0.85, 0.9, 0.97),
  reference = "Clalit",
  pal = c("#D7DCE7", "#B0B9D0", "#8997B9", "#6274A2", "#3B528B", "#6274A2", "#8997B9",
    "#B0B9D0", "#D7DCE7"),
  sex = NULL,
  patients = NULL,
  patient_color = "yellow",
  patient_point_size = 2,
  ylim = NULL,
  show_reference = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ln_plot_dist_+3A_lab">lab</code></td>
<td>
<p>the lab name. See <code>LAB_DETAILS$short_name</code> for a list of available labs.</p>
</td></tr>
<tr><td><code id="ln_plot_dist_+3A_quantiles">quantiles</code></td>
<td>
<p>a vector of quantiles to plot, without 0 and 1. Default is <code>c(0.03, 0.1, 0.15, 0.25, 0.35, 0.5, 0.65, 0.75, 0.85, 0.9, 0.97)</code>. Note that if <code>reference="Clalit-demo"</code>, quantiles below 0.05 and above 0.95 would be rounded to 0.05 and 0.95 respectively, and the same would be done for quantiles below 0.01 and above 0.99 when the high-resolution version is available.</p>
</td></tr>
<tr><td><code id="ln_plot_dist_+3A_reference">reference</code></td>
<td>
<p>the reference distribution to use. Can be either &quot;Clalit&quot; or &quot;UKBB&quot; or &quot;Clalit-demo&quot;. Please download the Clalit and UKBB reference distributions using <code>ln_download_data()</code>.</p>
</td></tr>
<tr><td><code id="ln_plot_dist_+3A_pal">pal</code></td>
<td>
<p>a vector of colors to use for the quantiles. Should be of length <code>length(quantiles) - 1</code>.</p>
</td></tr>
<tr><td><code id="ln_plot_dist_+3A_sex">sex</code></td>
<td>
<p>Plot only a single sex (&quot;male&quot; or &quot;female&quot;). If NULL - <code>ggplot2::facet_grid</code> would be used to plot both sexes. Default is NULL.</p>
</td></tr>
<tr><td><code id="ln_plot_dist_+3A_patients">patients</code></td>
<td>
<p>(optional) a data frame of patients to plot as dots over the distribution. See the <code>df</code> parameter of <code>ln_normalize_multi</code> for details.</p>
</td></tr>
<tr><td><code id="ln_plot_dist_+3A_patient_color">patient_color</code></td>
<td>
<p>(optional) the color of the patient dots. Default is &quot;yellow&quot;.</p>
</td></tr>
<tr><td><code id="ln_plot_dist_+3A_patient_point_size">patient_point_size</code></td>
<td>
<p>(optional) the size of the patient dots. Default is 2.</p>
</td></tr>
<tr><td><code id="ln_plot_dist_+3A_ylim">ylim</code></td>
<td>
<p>(optional) a vector of length 2 with the lower and upper limits of the plot. Default would be determined based on the values of the upper and lower percentiles of the lab in each age.</p>
</td></tr>
<tr><td><code id="ln_plot_dist_+3A_show_reference">show_reference</code></td>
<td>
<p>(optional) if TRUE, plot two lines of the upper and lower reference ranges. Default is TRUE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>ggplot2</code> object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
set.seed(60427)


ln_plot_dist("Hemoglobin")

# Plot only females
ln_plot_dist("Creatinine", sex = "female", ylim = c(0, 2))

# Set the ylim
ln_plot_dist("BMI", ylim = c(8, 50))

# Project the distribution of three Hemoglobin values
ln_plot_dist("Hemoglobin", patients = dplyr::sample_n(hemoglobin_data, 3))

# Change the quantiles
ln_plot_dist("Hemoglobin",
    quantiles = seq(0.05, 0.95, length.out = 10)
)

# Change the colors
ln_plot_dist(
    "Hemoglobin",
    quantiles = c(0.03, 0.1, 0.25, 0.5, 0.75, 0.9, 0.97),
    pal = c("red", "orange", "yellow", "green", "blue", "purple")
)

# Change the reference distribution
ln_plot_dist("Hemoglobin", reference = "UKBB")


# on the demo data


</code></pre>

<hr>
<h2 id='ln_quantile_value'>Compute the lab value for a given quantile</h2><span id='topic+ln_quantile_value'></span><span id='topic+ln_patients_quantile_value'></span>

<h3>Description</h3>

<p>The function <code>ln_quantile_value</code> calculates lab values at a specified quantile, using the default units for that lab. The function <code>ln_patients_quantile_value</code> does the same calculation for a specific group of patients. <br />
Default units for a lab can be obtained using <code>ln_lab_default_units</code>. <br />
If no quantile data is available for a particular lab, age, and sex, the function returns 'NA'. <br />
It should be noted that the values of extreme quantiles (e.g. &gt;0.95 or &lt;0.05 on low resolution, &gt;0.99 or &lt;0.01 on high resolution) may not be reliable, as they may represent outliers in the data. <br /> <br />
</p>
<p>Note that <code>ln_quantile_value</code> returns values for all combinations of age, sex, and lab, while <code>ln_patients_quantile_value</code> returns values for a specific set of patients, similar to <code>ln_normalize</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ln_quantile_value(
  quantiles,
  age,
  sex,
  lab,
  reference = "Clalit",
  allow_edge_quantiles = FALSE
)

ln_patients_quantile_value(
  quantiles,
  age,
  sex,
  lab,
  reference = "Clalit",
  allow_edge_quantiles = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ln_quantile_value_+3A_quantiles">quantiles</code></td>
<td>
<p>a vector of quantiles (in the range 0-1) to compute the lab value for, or a vector with a quantile for each patient when running <code>ln_patients_quantile_value</code>.</p>
</td></tr>
<tr><td><code id="ln_quantile_value_+3A_age">age</code></td>
<td>
<p>a vector of ages to compute the lab values for or a vector with an age for each patient when running <code>ln_patients_quantile_value</code>. Note that the age should be in years, and would be floored to the nearest integer.</p>
</td></tr>
<tr><td><code id="ln_quantile_value_+3A_sex">sex</code></td>
<td>
<p>the sexes to compute the lab values for, or a vector with a sex for each patient when running <code>ln_patients_quantile_value</code>. Note that for <code>ln_quantile_value</code> this parameter can only be either: &quot;male&quot;, &quot;female&quot; or c(&quot;male&quot;, &quot;female&quot;)</p>
</td></tr>
<tr><td><code id="ln_quantile_value_+3A_lab">lab</code></td>
<td>
<p>The lab name.</p>
</td></tr>
<tr><td><code id="ln_quantile_value_+3A_reference">reference</code></td>
<td>
<p>the reference distribution to use. Can be either &quot;Clalit&quot; or &quot;UKBB&quot; or &quot;Clalit-demo&quot;. Please download the Clalit and UKBB reference distributions using <code>ln_download_data()</code>.</p>
</td></tr>
<tr><td><code id="ln_quantile_value_+3A_allow_edge_quantiles">allow_edge_quantiles</code></td>
<td>
<p>If <code>TRUE</code> (default) then the function will return the value for the edge quantiles (&lt;0.01 or &gt;0.99) even though they are not reliable. If <code>FALSE</code> then the function will return <code>NA</code> for those quantiles. Note that for the &quot;Clalit-demo&quot; reference, the threshold would be &lt;0.05 or &gt;0.95.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>ln_quantile_value</code> returns a data frame which contains the values for each combination of quantile, age and sex.
The data frame has the the following columns:
</p>

<ul>
<li><p>age: age in years
</p>
</li>
<li><p>sex: &quot;male&quot; or &quot;female&quot;
</p>
</li>
<li><p>quantile: he quantile
</p>
</li>
<li><p>value: the lab value
</p>
</li>
<li><p>unit: the lab unit
</p>
</li>
<li><p>lab: the lab name
</p>
</li></ul>

<p><code>ln_patients_quantile_value</code> returns a vector of value per patient.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
ln_quantile_value(c(0.05, 0.5, 0.95), 50, "male", "WBC")

ln_quantile_value(
    c(0, 0.05, 0.1, 0.4, 0.5, 0.6, 0.9, 1),
    c(50, 60),
    c("male", "female"),
    "Glucose"
)


# on the demo data



hemoglobin_data$quantile &lt;- ln_normalize(
    hemoglobin_data$value,
    hemoglobin_data$age,
    hemoglobin_data$sex,
    "Hemoglobin"
)

hemoglobin_data$value1 &lt;- ln_patients_quantile_value(
    hemoglobin_data$quantile,
    hemoglobin_data$age,
    hemoglobin_data$sex,
    "Hemoglobin"
)
head(hemoglobin_data)




</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
