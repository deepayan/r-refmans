<!DOCTYPE html><html><head><title>Help for package ivmodel</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ivmodel}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#ivmodel-package'>
<p>Statistical Inference and Sensitivity Analysis for Instrumental</p>
Variables Model</a></li>
<li><a href='#AR.power'><p>Power of the Anderson-Rubin (1949) Test</p></a></li>
<li><a href='#AR.size'><p>Sample Size Calculator for the Power of the Anderson-Rubin (1949) Test</p></a></li>
<li><a href='#AR.test'><p>Anderson-Rubin (1949) Test</p></a></li>
<li><a href='#ARsens.power'><p>Power of the Anderson-Rubin (1949) Test with Sensitivity Analysis</p></a></li>
<li><a href='#ARsens.size'><p>Sample Size Calculator for the Power of the Anderson-Rubin (1949) Test with Sensitivity Analysis</p></a></li>
<li><a href='#ARsens.test'><p>Sensitivity Analysis for the Anderson-Rubin (1949) Test</p></a></li>
<li><a href='#balanceLovePlot'><p>Create Love plot of standardized covariate mean differences</p></a></li>
<li><a href='#biasLovePlot'><p>Create Love plot of treatment bias and instrument bias</p></a></li>
<li><a href='#card.data'><p>Card (1995) Data</p></a></li>
<li><a href='#CLR'><p>Conditional Likelihood Ratio Test</p></a></li>
<li><a href='#coef.ivmodel'><p>Coefficients of the Fitted Model in the <code>ivmodel</code> Object</p></a></li>
<li><a href='#coefOther'><p>Exogenous Coefficients of the Fitted Model in the <code>ivmodel</code> Object</p></a></li>
<li><a href='#confint.ivmodel'><p>Confidence Intervals for the Fitted Model in <code>ivmodel</code> Object</p></a></li>
<li><a href='#distributionBalancePlot'><p>Plot randomization distributions of the Mahalanobis distance</p></a></li>
<li><a href='#fitted.ivmodel'><p>Extract Model Fitted values in the <code>ivmodel</code> Object</p></a></li>
<li><a href='#Fuller'><p>Fuller-k Estimator</p></a></li>
<li><a href='#getCovMeanDiffs'><p>Get Covariate Mean Differences</p></a></li>
<li><a href='#getMD'><p>Get Mahalanobis Distance</p></a></li>
<li><a href='#getStandardizedCovMeanDiffs'><p>Get Standardized Covariate Mean Differences</p></a></li>
<li><a href='#icu.data'><p>Pseudo-data based on Branson and Keele (2020)</p></a></li>
<li><a href='#iv.diagnosis'><p>Diagnostics of instrumental variable analysis</p></a></li>
<li><a href='#ivmodel'><p>Fitting Instrumental Variables (IV) Models</p></a></li>
<li><a href='#ivmodel-bransonKeele-internal'><p>Internal <code>ivmodel</code> functions for Branson and Keele (2020)</p></a></li>
<li><a href='#ivmodel-internal'><p>Internal <code>ivmodel</code> functions</p></a></li>
<li><a href='#ivmodelFormula'><p>Fitting Instrumental Variables (IV) Models</p></a></li>
<li><a href='#IVpower'><p>Power calculation for IV models</p></a></li>
<li><a href='#IVsize'><p>Calculating minimum sample size for achieving a certain power</p></a></li>
<li><a href='#KClass'><p>k-Class Estimator</p></a></li>
<li><a href='#LIML'><p>Limited Information Maximum Likelihood Ratio (LIML) Estimator</p></a></li>
<li><a href='#model.matrix.ivmodel'><p>Extract Design Matrix for <code>ivmodel</code> Object</p></a></li>
<li><a href='#para'><p>Parameter Estimation from Ivmodel</p></a></li>
<li><a href='#permTest.absBias'><p>Perform a permutation test using the sum of absolute biases</p></a></li>
<li><a href='#permTest.md'><p>Perform a permutation test using the Mahalanobis distance</p></a></li>
<li><a href='#residuals.ivmodel'><p>Residuals from the Fitted Model in the <code>ivmodel</code> Object</p></a></li>
<li><a href='#TSLS.power'><p>Power of TSLS Estimator</p></a></li>
<li><a href='#TSLS.size'><p>Sample Size Calculator for the Power of Asymptotic T-test</p></a></li>
<li><a href='#vcov.ivmodel'><p>Calculate Variance-Covariance Matrix (i.e. Standard Error) for k-Class Estimators in the <code>ivmodel</code> Object</p></a></li>
<li><a href='#vcovOther'><p>Variance of Exogenous Coefficients of the Fitted Model in the <code>ivmodel</code> Object</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Statistical Inference and Sensitivity Analysis for Instrumental
Variables Model</td>
</tr>
<tr>
<td>Version:</td>
<td>1.9.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-04-08</td>
</tr>
<tr>
<td>Author:</td>
<td>Hyunseung Kang, Yang Jiang, Qingyuan Zhao, and Dylan Small</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Hyunseung Kang &lt;hyunseung@stat.wisc.edu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Carries out instrumental variable
    estimation of causal effects, including power analysis, sensitivity analysis,
    and diagnostics. See Kang, Jiang, Zhao, and Small (2020) <a href="http://pages.cs.wisc.edu/~hyunseung/">http://pages.cs.wisc.edu/~hyunseung/</a> for details.</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats,Matrix,Formula,reshape2,ggplot2</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | file LICENSE</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-04-09 14:32:57 UTC; hyunseung</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-04-09 15:00:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='ivmodel-package'>
Statistical Inference and Sensitivity Analysis for Instrumental
Variables Model
</h2><span id='topic+ivmodel-package'></span>

<h3>Description</h3>

<p>The package fits an instrumental variables (IV) model of the following type. Let <code class="reqn">Y</code>, <code class="reqn">D</code>, <code class="reqn">X</code>, and <code class="reqn">Z</code> represent the outcome, endogenous variable, <em>p</em> dimensional exogenous covariates, and <em>L</em> dimensional instruments, respectively; note that the intercept can be considered as a vector of ones and a part of the exogenous covariates <code class="reqn">X</code>.The package assumes the following IV model
</p>
<p style="text-align: center;"><code class="reqn"> Y = X \alpha + D \beta + \epsilon, E(\epsilon | X, Z) = 0</code>
</p>

<p>It carries out several IV regressions, diagnostics, and tests associated with the parameter <code class="reqn">\beta</code> in the IV model. Also, if there is only one instrument, the package runs a sensitivity analysis discussed in Jiang et al. (2015).
</p>
<p>The package is robust to most data formats, including factor and character data, and can handle very large IV models efficiently using a sparse QR decomposition.
</p>


<h3>Details</h3>

<p>Supply the outcome <code class="reqn">Y</code>, the endogenous variable <code class="reqn">D</code>, and a data frame and/or matrix of instruments <code class="reqn">Z</code>, and a data frame and/or matrix of exogenous covariates <code class="reqn">X</code> (optional) and run <code>ivmodel</code>. Alternatively, one can supply a formula. <code>ivmodel</code> will generate all the relevant statistics for the parameter <code class="reqn">\beta</code>.
</p>
<p>The DESCRIPTION file:
</p>

<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> ivmodel</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Title: </td><td style="text-align: left;"> Statistical Inference and Sensitivity Analysis for Instrumental
Variables Model</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.9.1</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2023-04-08</td>
</tr>
<tr>
 <td style="text-align: left;">
Author: </td><td style="text-align: left;"> Hyunseung Kang, Yang Jiang, Qingyuan Zhao, and Dylan Small</td>
</tr>
<tr>
 <td style="text-align: left;">
Maintainer: </td><td style="text-align: left;"> Hyunseung Kang &lt;hyunseung@stat.wisc.edu&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
Description: </td><td style="text-align: left;"> Carries out instrumental variable
    estimation of causal effects, including power analysis, sensitivity analysis,
    and diagnostics. See Kang, Jiang, Zhao, and Small (2020) &lt;http://pages.cs.wisc.edu/~hyunseung/&gt; for details.</td>
</tr>
<tr>
 <td style="text-align: left;">
Imports: </td><td style="text-align: left;"> stats,Matrix,Formula,reshape2,ggplot2</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL-2 | file LICENSE</td>
</tr>
<tr>
 <td style="text-align: left;">
LazyData: </td><td style="text-align: left;"> true</td>
</tr>
<tr>
 <td style="text-align: left;">
RoxygenNote: </td><td style="text-align: left;"> 7.2.3</td>
</tr>
<tr>
 <td style="text-align: left;">
NeedsCompilation: </td><td style="text-align: left;"> no</td>
</tr>
<tr>
 <td style="text-align: left;">
Repository: </td><td style="text-align: left;"> CRAN</td>
</tr>
<tr>
 <td style="text-align: left;">
Suggests: </td><td style="text-align: left;"> testthat</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>


<p>Index of help topics:
</p>
<pre>
AR.power                Power of the Anderson-Rubin (1949) Test
AR.size                 Sample Size Calculator for the Power of the
                        Anderson-Rubin (1949) Test
AR.test                 Anderson-Rubin (1949) Test
ARsens.power            Power of the Anderson-Rubin (1949) Test with
                        Sensitivity Analysis
ARsens.size             Sample Size Calculator for the Power of the
                        Anderson-Rubin (1949) Test with Sensitivity
                        Analysis
ARsens.test             Sensitivity Analysis for the Anderson-Rubin
                        (1949) Test
CLR                     Conditional Likelihood Ratio Test
Fuller                  Fuller-k Estimator
IVpower                 Power calculation for IV models
IVsize                  Calculating minimum sample size for achieving a
                        certain power
KClass                  k-Class Estimator
LIML                    Limited Information Maximum Likelihood Ratio
                        (LIML) Estimator
TSLS.power              Power of TSLS Estimator
TSLS.size               Sample Size Calculator for the Power of
                        Asymptotic T-test
balanceLovePlot         Create Love plot of standardized covariate mean
                        differences
biasLovePlot            Create Love plot of treatment bias and
                        instrument bias
card.data               Card (1995) Data
coef.ivmodel            Coefficients of the Fitted Model in the
                        'ivmodel' Object
coefOther               Exogenous Coefficients of the Fitted Model in
                        the 'ivmodel' Object
confint.ivmodel         Confidence Intervals for the Fitted Model in
                        'ivmodel' Object
distributionBalancePlot
                        Plot randomization distributions of the
                        Mahalanobis distance
fitted.ivmodel          Extract Model Fitted values in the 'ivmodel'
                        Object
getCovMeanDiffs         Get Covariate Mean Differences
getMD                   Get Mahalanobis Distance
getStandardizedCovMeanDiffs
                        Get Standardized Covariate Mean Differences
icu.data                Pseudo-data based on Branson and Keele (2020)
iv.diagnosis            Diagnostics of instrumental variable analysis
ivmodel                 Fitting Instrumental Variables (IV) Models
ivmodel-package         Statistical Inference and Sensitivity Analysis
                        for Instrumental Variables Model
ivmodelFormula          Fitting Instrumental Variables (IV) Models
model.matrix.ivmodel    Extract Design Matrix for 'ivmodel' Object
para                    Parameter Estimation from Ivmodel
permTest.absBias        Perform a permutation test using the sum of
                        absolute biases
permTest.md             Perform a permutation test using the
                        Mahalanobis distance
residuals.ivmodel       Residuals from the Fitted Model in the
                        'ivmodel' Object
vcov.ivmodel            Calculate Variance-Covariance Matrix (i.e.
                        Standard Error) for k-Class Estimators in the
                        'ivmodel' Object
vcovOther               Variance of Exogenous Coefficients of the
                        Fitted Model in the 'ivmodel' Object
</pre>


<h3>Author(s)</h3>

<p>Hyunseung Kang, Yang Jiang, Qingyuan Zhao, and Dylan Small
</p>
<p>Maintainer: Hyunseung Kang &lt;hyunseung@stat.wisc.edu&gt;
</p>


<h3>References</h3>

<p>Anderson, T. W. and Rubin, H. (1949). Estimation of the parameters of a single equation in a complete system of stochastic equations. <em>Annals of Mathematical Statistics</em> 20, 46-63.<br />
</p>
<p>Andrews, D. W. K., Moreira, M. J., and Stock, J. H. (2006). Optimal two-side invariant similar tests for instrumental variables regression. <em>Econometrica</em> 74, 715-752.<br />
</p>
<p>Card, D.  Using Geographic Variation in College Proximity to Estimate the Return to Schooling. In Aspects of Labor Market Behavior: Essays in Honor of John Vanderkamp, eds. L.N. Christophides, E.K. Grant and R. Swidinsky.  201-222. 
National Longitudinal Survey of Young Men: https://www.nlsinfo.org/investigator/pages/login.jsp
</p>
<p>Fuller, W. (1977). Some properties of a modification of the limited information estimator. <em>Econometrica</em>, 45, 939-953.  <br />
</p>
<p>Moreira, M. J. (2003). A conditional likelihood ratio test for structural models. <em>Econometrica</em> 71, 1027-1048.   <br />
</p>
<p>Sargan, J. D. (1958). The estimation of economic relationships using instrumental variables. <em>Econometrica</em> , 393-415. <br />
</p>
<p>Wang, X., Jiang, Y., Small, D. and Zhang, N. (2017), Sensitivity analysis and power for instrumental variable studies. <em>Biometrics</em> 74(4), 1150-1160. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(card.data)
# One instrument #
Y=card.data[,"lwage"]
D=card.data[,"educ"]
Z=card.data[,"nearc4"]
Xname=c("exper", "expersq", "black", "south", "smsa", "reg661", 
        "reg662", "reg663", "reg664", "reg665", "reg666", "reg667", 
		"reg668", "smsa66")
X=card.data[,Xname]
card.model1IV = ivmodel(Y=Y,D=D,Z=Z,X=X)
card.model1IV

# Multiple instruments
Z = card.data[,c("nearc4","nearc2")]
card.model2IV = ivmodel(Y=Y,D=D,Z=Z,X=X)
card.model2IV
</code></pre>

<hr>
<h2 id='AR.power'>Power of the Anderson-Rubin (1949) Test</h2><span id='topic+AR.power'></span>

<h3>Description</h3>

<p><code>AR.power</code> computes the power of Anderson-Rubin (1949) test based on the given values of parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>AR.power(n, k, l, beta, gamma, Zadj_sq, 
         sigmau, sigmav, rho, alpha = 0.05)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="AR.power_+3A_n">n</code></td>
<td>
<p>Sample size.</p>
</td></tr>
<tr><td><code id="AR.power_+3A_k">k</code></td>
<td>
<p>Number of exogenous variables.</p>
</td></tr>
<tr><td><code id="AR.power_+3A_l">l</code></td>
<td>
<p>Number of instrumental variables.</p>
</td></tr>
<tr><td><code id="AR.power_+3A_beta">beta</code></td>
<td>
<p>True causal effect minus null hypothesis causal effect.</p>
</td></tr>
<tr><td><code id="AR.power_+3A_gamma">gamma</code></td>
<td>
<p>Regression coefficient for effect of instruments on treatment.</p>
</td></tr>
<tr><td><code id="AR.power_+3A_zadj_sq">Zadj_sq</code></td>
<td>
<p>Variance of instruments after regressed on the observed variables.</p>
</td></tr>
<tr><td><code id="AR.power_+3A_sigmau">sigmau</code></td>
<td>
<p>Standard deviation of potential outcome under control. (structural error for y)</p>
</td></tr>
<tr><td><code id="AR.power_+3A_sigmav">sigmav</code></td>
<td>
<p>Standard deviation of error from regressing treatment on instruments.</p>
</td></tr>
<tr><td><code id="AR.power_+3A_rho">rho</code></td>
<td>
<p>Correlation between u (potential outcome under control) and v (error from regressing treatment on instrument).</p>
</td></tr>
<tr><td><code id="AR.power_+3A_alpha">alpha</code></td>
<td>
<p>Significance level.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Power of the Anderson-Rubin test based on the given values of parameters.
</p>


<h3>Author(s)</h3>

<p>Yang Jiang, Hyunseung Kang, and Dylan Small
</p>


<h3>References</h3>

<p>Anderson, T.W. and Rubin, H. (1949).  Estimation of the parameters of a single equation in a complete system of stochastic equations.  Annals of Mathematical Statistics, 20, 46-63.
</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+ivmodel">ivmodel</a></code> for details on the instrumental variables model.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Assume we calculate the power of AR test in a study with one IV (l=1) 
# and the only one exogenous variable is the intercept (k=1). 

# Suppose the difference between the null hypothesis and true causal 
# effect is 1 (beta=1).
# The sample size is 250 (n=250), the IV variance is .25 (Zadj_sq =.25).
# The standard deviation of potential outcome is 1(sigmau= 1). 
# The coefficient of regressing IV upon exposure is .5 (gamma= .5).
# The correlation between u and v is assumed to be .5 (rho=.5). 
# The standard deviation of first stage error is .4 (sigmav=.4). 
# The significance level for the study is alpha = .05.

# power of Anderson-Rubin test:
AR.power(n=250, k=1, l=1, beta=1, gamma=.5, Zadj_sq=.25, 
         sigmau=1, sigmav=.4, rho=.5, alpha = 0.05)

</code></pre>

<hr>
<h2 id='AR.size'>Sample Size Calculator for the Power of the Anderson-Rubin (1949) Test</h2><span id='topic+AR.size'></span>

<h3>Description</h3>

<p><code>AR.size</code> computes the minimum sample size required for achieving certain power of Anderson-Rubin (1949) test for giving value of parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>AR.size(power, k, l, beta, gamma, Zadj_sq, 
        sigmau, sigmav, rho, alpha = 0.05)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="AR.size_+3A_power">power</code></td>
<td>
<p>The desired power over a constant.</p>
</td></tr>
<tr><td><code id="AR.size_+3A_k">k</code></td>
<td>
<p>Number of exogenous variables.</p>
</td></tr>
<tr><td><code id="AR.size_+3A_l">l</code></td>
<td>
<p>Number of instrumental variables.</p>
</td></tr>
<tr><td><code id="AR.size_+3A_beta">beta</code></td>
<td>
<p>True causal effect minus null hypothesis causal effect.</p>
</td></tr>
<tr><td><code id="AR.size_+3A_gamma">gamma</code></td>
<td>
<p>Regression coefficient for the effect of instrument on treatment.</p>
</td></tr>
<tr><td><code id="AR.size_+3A_zadj_sq">Zadj_sq</code></td>
<td>
<p>Variance of instruments after regressed on the observed variables.</p>
</td></tr>
<tr><td><code id="AR.size_+3A_sigmau">sigmau</code></td>
<td>
<p>Standard deviation of potential outcome under control (structural error for y).</p>
</td></tr>
<tr><td><code id="AR.size_+3A_sigmav">sigmav</code></td>
<td>
<p>Standard deviation of error from regressing treatment on instruments</p>
</td></tr>
<tr><td><code id="AR.size_+3A_rho">rho</code></td>
<td>
<p>Correlation between u (potential outcome under control) and v (error from regressing treatment on instrument).</p>
</td></tr>
<tr><td><code id="AR.size_+3A_alpha">alpha</code></td>
<td>
<p>Significance level.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Minimum sample size required for achieving certain power of Anderson-Rubin (1949) test.
</p>


<h3>Author(s)</h3>

<p>Yang Jiang, Hyunseung Kang, and Dylan Small</p>


<h3>References</h3>

<p>Anderson, T.W. and Rubin, H. (1949), Estimation of the parameters of a single equation in a complete system of stochastic equations, Annals of Mathematical Statistics, 20, 46-63.
</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+ivmodel">ivmodel</a></code> for details on the instrumental variables model.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Assume we performed an AR test in a study with one IV (l=1) and the 
# only one exogenous variable is the intercept (k=1). We want to know 
# the minimum sample size for this test to have an at least 0.8 power.

# Suppose the difference between the null hypothesis and true causal 
# effect is 1 (beta=1).
# The IV variance is .25 (Zadj_sq =.25).
# The standard deviation of potential outcome is 1(sigmau= 1). 
# The coefficient of regressing IV upon exposure is .5 (gamma= .5).
# The correlation between u and v is assumed to be .5 (rho=.5). 
# The standard deviation of first stage error is .4 (sigmav=.4). 
# The significance level for the study is alpha = .05.

# minimum sample size required for Anderson-Rubin test:
AR.size(power=0.8, k=1, l=1, beta=1, gamma=.5, Zadj_sq=.25, 
        sigmau=1, sigmav=.4, rho=.5, alpha = 0.05)

</code></pre>

<hr>
<h2 id='AR.test'>Anderson-Rubin (1949) Test</h2><span id='topic+AR.test'></span>

<h3>Description</h3>

<p><code>AR.test</code> computes the Anderson-Rubin (1949) test for the <code>ivmodel</code> object as well as the associated confidence interval.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>AR.test(ivmodel, beta0 = 0, alpha = 0.05)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="AR.test_+3A_ivmodel">ivmodel</code></td>
<td>
<p><code>ivmodel</code> object</p>
</td></tr>
<tr><td><code id="AR.test_+3A_beta0">beta0</code></td>
<td>
<p>Null value <code class="reqn">\beta_0</code> for testing null hypothesis <code class="reqn">H_0: \beta = \beta_0</code> in <code>ivmodel</code>. Default is 0.</p>
</td></tr>
<tr><td><code id="AR.test_+3A_alpha">alpha</code></td>
<td>
<p>The significance level for hypothesis testing. Default is 0.05.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>AR.test</code> returns a list containing the following components
</p>
<table>
<tr><td><code>Fstat</code></td>
<td>
<p>The value of the test statistic for testing the null hypothesis <code class="reqn">H_0: \beta = \beta_0</code> in <code>ivmodel</code></p>
</td></tr>
<tr><td><code>df</code></td>
<td>
<p>degree of freedom for the test statistic</p>
</td></tr>
<tr><td><code>p.value</code></td>
<td>
<p>The p value of the test under the null hypothesis <code class="reqn">H_0: \beta = \beta_0</code> in <code>ivmodel</code></p>
</td></tr>
<tr><td><code>ci</code></td>
<td>
<p>A matrix of two columns, each row contains an interval associated with the confidence interval</p>
</td></tr>
<tr><td><code>ci.info</code></td>
<td>
<p>A human-readable string describing the confidence interval</p>
</td></tr> 
</table>


<h3>Author(s)</h3>

<p>Yang Jiang, Hyunseung Kang, and Dylan Small</p>


<h3>References</h3>

<p>Anderson, T.W. and Rubin, H. (1949), Estimation of the parameters of a single equation in a complete system of stochastic equations, Annals of Mathematical Statistics, 20, 46-63.</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+ivmodel">ivmodel</a></code> for details on the instrumental variables model.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(card.data)
Y=card.data[,"lwage"]
D=card.data[,"educ"]
Z=card.data[,"nearc4"]
Xname=c("exper", "expersq", "black", "south", "smsa", "reg661", 
        "reg662", "reg663", "reg664", "reg665", "reg666", "reg667", 
		"reg668", "smsa66")
X=card.data[,Xname]
foo = ivmodel(Y=Y,D=D,Z=Z,X=X)
AR.test(foo)
</code></pre>

<hr>
<h2 id='ARsens.power'>Power of the Anderson-Rubin (1949) Test with Sensitivity Analysis</h2><span id='topic+ARsens.power'></span>

<h3>Description</h3>

<p><code>ARsens.power</code> computes the power of sensitivity analysis, which is based on an extension of Anderson-Rubin (1949) test and allows IV be possibly invalid within a certain range.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ARsens.power(n, k, beta, gamma, Zadj_sq, sigmau, sigmav, rho, 
             alpha = 0.05, deltarange = deltarange, delta = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ARsens.power_+3A_n">n</code></td>
<td>
<p>Sample size.</p>
</td></tr>
<tr><td><code id="ARsens.power_+3A_k">k</code></td>
<td>
<p>Number of exogenous variables.</p>
</td></tr>
<tr><td><code id="ARsens.power_+3A_beta">beta</code></td>
<td>
<p>True causal effect minus null hypothesis causal effect.</p>
</td></tr>
<tr><td><code id="ARsens.power_+3A_gamma">gamma</code></td>
<td>
<p>Regression coefficient for effect of instruments on treatment.</p>
</td></tr>
<tr><td><code id="ARsens.power_+3A_zadj_sq">Zadj_sq</code></td>
<td>
<p>Variance of instruments after regressed on the observed variables.</p>
</td></tr>
<tr><td><code id="ARsens.power_+3A_sigmau">sigmau</code></td>
<td>
<p>Standard deviation of potential outcome under control (structural error for y).</p>
</td></tr>
<tr><td><code id="ARsens.power_+3A_sigmav">sigmav</code></td>
<td>
<p>Standard deviation of error from regressing treatment on instruments.</p>
</td></tr>
<tr><td><code id="ARsens.power_+3A_rho">rho</code></td>
<td>
<p>Correlation between u (potential outcome under control) and v (error from regressing treatment on instrument).</p>
</td></tr>
<tr><td><code id="ARsens.power_+3A_alpha">alpha</code></td>
<td>
<p>Significance level.</p>
</td></tr>
<tr><td><code id="ARsens.power_+3A_deltarange">deltarange</code></td>
<td>
<p>Range of sensitivity allowance. A numeric vector of length 2.</p>
</td></tr>
<tr><td><code id="ARsens.power_+3A_delta">delta</code></td>
<td>
<p>True value of sensitivity parameter when calculating the power. Usually take delta = 0 for the favorable situation or delta = NULL for unknown delta.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Power of sensitivity analysis for the proposed study, which extends the Anderson-Rubin (1949) test with possibly invalid IV. The power formula is derived in Jiang, Small and Zhang (2015).
</p>


<h3>Author(s)</h3>

<p>Yang Jiang, Hyunseung Kang, and Dylan Small</p>


<h3>References</h3>

<p>Anderson, T.W. and Rubin, H. (1949), Estimation of the parameters of a single equation in a complete system of stochastic equations, Annals of Mathematical Statistics, 20, 46-63.<br />
Wang, X., Jiang, Y., Small, D. and Zhang, N (2017), Sensitivity analysis and power for instrumental variable studies, (under review of Biometrics).</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+ivmodel">ivmodel</a></code> for details on the instrumental variables model.</p>


<h3>Examples</h3>

<pre><code class='language-R'># Assume we calculate the power of sensitivity analysis in a study with
# one IV (l=1) and the only exogenous variable is the intercept (k=1). 

# Suppose the difference between the null hypothesis and true causal 
# effect is 1 (beta=1).
# The sample size is 250 (n=250), the IV variance is .25 (Zadj_sq =.25).
# The standard deviation of potential outcome is 1(sigmau= 1). 
# The coefficient of regressing IV upon exposure is .5 (gamma= .5).
# The correlation between u and v is assumed to be .5 (rho=.5). 
# The standard deviation of first stage error is .4 (sigmav=.4). 
# The significance level for the study is alpha = .05.

# power of sensitivity analysis under the favorable situation, 
# assuming the range of sensitivity allowance is (-0.1, 0.1)
ARsens.power(n=250, k=1, beta=1, gamma=.5, Zadj_sq=.25, sigmau=1, 
     sigmav=.4, rho=.5, alpha = 0.05, deltarange=c(-0.1, 0.1), delta=0)

# power of sensitivity analysis with unknown delta, 
# assuming the range of sensitivity allowance is (-0.1, 0.1)
ARsens.power(n=250, k=1, beta=1, gamma=.5, Zadj_sq=.25, sigmau=1, 
     sigmav=.4, rho=.5, alpha = 0.05, deltarange=c(-0.1, 0.1))

</code></pre>

<hr>
<h2 id='ARsens.size'>Sample Size Calculator for the Power of the Anderson-Rubin (1949) Test with Sensitivity Analysis</h2><span id='topic+ARsens.size'></span>

<h3>Description</h3>

<p><code>ARsens.size</code> computes the minimum sample size required for achieving certain power of sensitivity analysis, which is based on an extension of Anderson-Rubin (1949) test and allows IV be possibly invalid within a certain range.</p>


<h3>Usage</h3>

<pre><code class='language-R'>ARsens.size(power, k, beta, gamma, Zadj_sq, sigmau, sigmav, rho, 
            alpha = 0.05, deltarange = deltarange, delta = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ARsens.size_+3A_power">power</code></td>
<td>
<p>The desired power over a constant.</p>
</td></tr>
<tr><td><code id="ARsens.size_+3A_k">k</code></td>
<td>
<p>Number of exogenous variables. =</p>
</td></tr>
<tr><td><code id="ARsens.size_+3A_beta">beta</code></td>
<td>
<p>True causal effect minus null hypothesis causal effect.</p>
</td></tr>
<tr><td><code id="ARsens.size_+3A_gamma">gamma</code></td>
<td>
<p>Regression coefficient for effect of instruments on treatment.</p>
</td></tr>
<tr><td><code id="ARsens.size_+3A_zadj_sq">Zadj_sq</code></td>
<td>
<p>Variance of instruments after regressed on the observed covariates.</p>
</td></tr>
<tr><td><code id="ARsens.size_+3A_sigmau">sigmau</code></td>
<td>
<p>Standard deviation of potential outcome under control (structural error for y).</p>
</td></tr>
<tr><td><code id="ARsens.size_+3A_sigmav">sigmav</code></td>
<td>
<p>Standard deviation of error from regressing treatment on instruments.</p>
</td></tr>
<tr><td><code id="ARsens.size_+3A_rho">rho</code></td>
<td>
<p>Correlation between u (potential outcome under control) and v (error from regressing treatment on instruments).</p>
</td></tr>
<tr><td><code id="ARsens.size_+3A_alpha">alpha</code></td>
<td>
<p>Significance level.</p>
</td></tr>
<tr><td><code id="ARsens.size_+3A_deltarange">deltarange</code></td>
<td>
<p>Range of sensitivity allowance. A numeric vector of length 2.</p>
</td></tr>
<tr><td><code id="ARsens.size_+3A_delta">delta</code></td>
<td>
<p>True value of sensitivity parameter when calculating power. Usually take delta = 0 for the favorable situation or delta = NULL for unknown delta.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Minimum sample size required for achieving certain power of sensitivity analysis for the proposed study, which extends the Anderson-Rubin (1949) test with possibly invalid IV. The power formula is derived in Jiang, Small and Zhang (2015).</p>


<h3>Author(s)</h3>

<p>Yang Jiang, Hyunseung Kang, and Dylan Small</p>


<h3>References</h3>

<p>Anderson, T.W. and Rubin, H. (1949), Estimation of the parameters of a single equation in a complete system of stochastic equations, Annals of Mathematical Statistics, 20, 46-63.<br />
Wang, X., Jiang, Y., Small, D. and Zhang, N (2017), Sensitivity analysis and power for instrumental variable studies, (under review of Biometrics).
</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+ivmodel">ivmodel</a></code> for details on the instrumental variables model.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Assume we performed a sensitivity analysis in a study with one 
# IV (l=1) and the only exogenous variable is the intercept (k=1). 
# We want to calculate the minimum sample size needed for this 
# sensitivity analysis to have an at least 0.8 power.

# Suppose the difference between the null hypothesis and true causal 
# effect is 1 (beta=1).
# The IV variance is .25 (Zadj_sq =.25).
# The standard deviation of potential outcome is 1(sigmau= 1). 
# The coefficient of regressing IV upon exposure is .5 (gamma= .5).
# The correlation between u and v is assumed to be .5 (rho=.5). 
# The standard deviation of first stage error is .4 (sigmav=.4). 
# The significance level for the study is alpha = .05.

# minimum sample size for sensitivity analysis under the favorable 
# situation, assuming the range of sensitivity allowance is (-0.1, 0.1)
ARsens.size(power=0.8, k=1, beta=1, gamma=.5, Zadj_sq=.25, sigmau=1, 
    sigmav=.4, rho=.5, alpha = 0.05, deltarange=c(-0.1, 0.1), delta=0)

# minimum sample size for sensitivity analysis with unknown delta, 
# assuming the range of sensitivity allowance is (-0.1, 0.1)
ARsens.size(power=0.8, k=1, beta=1, gamma=.5, Zadj_sq=.25, sigmau=1, 
    sigmav=.4, rho=.5, alpha = 0.05, deltarange=c(-0.1, 0.1))

</code></pre>

<hr>
<h2 id='ARsens.test'>Sensitivity Analysis for the Anderson-Rubin (1949) Test</h2><span id='topic+ARsens.test'></span>

<h3>Description</h3>

<p><code>ARsens.test</code> computes sensitivity analysis with possibly invalid instruments, which is an extension of the Anderson-Rubin (1949) test. The formula for sensitivity analysis is derived in Jiang, Small and Zhang (2015).</p>


<h3>Usage</h3>

<pre><code class='language-R'>ARsens.test(ivmodel, beta0 = 0, alpha = 0.05, deltarange = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ARsens.test_+3A_ivmodel">ivmodel</code></td>
<td>
<p><code>ivmodel</code> object.</p>
</td></tr>
<tr><td><code id="ARsens.test_+3A_beta0">beta0</code></td>
<td>
<p>Null value <code class="reqn">\beta_0</code> for testing null hypothesis <code class="reqn">H_0: \beta = \beta_0</code> in <code>ivmodel</code></p>
</td></tr>
<tr><td><code id="ARsens.test_+3A_alpha">alpha</code></td>
<td>
<p>The significance level for hypothesis testing. Default is 0.05.</p>
</td></tr>
<tr><td><code id="ARsens.test_+3A_deltarange">deltarange</code></td>
<td>
<p>Range of sensitivity allowance. A numeric vector of length 2.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>ARsens.test</code> returns a list containing the following components
</p>
<table>
<tr><td><code>ncFstat</code></td>
<td>
<p>The value of the test statistic for testing the null hypothesis <code class="reqn">H_0: \beta = \beta_0</code> in <code>ivmodel</code></p>
</td></tr>
<tr><td><code>df</code></td>
<td>
<p>degree of freedom for the test statistic</p>
</td></tr>
<tr><td><code>ncp</code></td>
<td>
<p>non-central parameter for the test statistic</p>
</td></tr>
<tr><td><code>p.value</code></td>
<td>
<p>The p value of the test under the null hypothesis <code class="reqn">H_0: \beta = \beta_0</code> in <code>ivmodel</code></p>
</td></tr>
<tr><td><code>ci</code></td>
<td>
<p>A matrix of two columns, each row contains an interval associated with the confidence interval</p>
</td></tr>
<tr><td><code>ci.info</code></td>
<td>
<p>A human-readable string describing the confidence interval</p>
</td></tr> 
<tr><td><code>deltarange</code></td>
<td>
<p>The inputted range of sensitivity allowance.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Yang Jiang, Hyunseung Kang, and Dylan Small</p>


<h3>References</h3>

<p>Anderson, T.W. and Rubin, H. (1949), Estimation of the parameters of a single equation in a complete system of stochastic equations, Annals of Mathematical Statistics, 20, 46-63.<br />
Wang, X., Jiang, Y., Small, D. and Zhang, N. (2017), Sensitivity analysis and power for instrumental variable studies, (under review of Biometrics).
</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+ivmodel">ivmodel</a></code> for details on the instrumental variables model.</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(card.data)
Y=card.data[,"lwage"]
D=card.data[,"educ"]
Z=card.data[,"nearc4"]
Xname=c("exper", "expersq", "black", "south", "smsa", "reg661", 
        "reg662", "reg663", "reg664", "reg665", "reg666", "reg667", 
		"reg668", "smsa66")
X=card.data[,Xname]
foo = ivmodel(Y=Y,D=D,Z=Z,X=X)
ARsens.test(foo, deltarange=c(-0.03, 0.03))
</code></pre>

<hr>
<h2 id='balanceLovePlot'>Create Love plot of standardized covariate mean differences</h2><span id='topic+balanceLovePlot'></span>

<h3>Description</h3>

<p><code>balanceLovePlot</code> creates a Love plot of the standardized covariate mean differences across the treatment and the instrument. Can also display the permutation quantiles for these quantities. This function is used to create Figure 3a in Branson and Keele (2020).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>balanceLovePlot(X, D, Z, permQuantiles = FALSE, alpha = 0.05, perms = 1000)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="balanceLovePlot_+3A_x">X</code></td>
<td>
<p>Covariate matrix (with units as rows and covariates as columns).</p>
</td></tr>
<tr><td><code id="balanceLovePlot_+3A_d">D</code></td>
<td>
<p>Indicator vector for a binary treatment (must contain 1 or 0 for each unit).</p>
</td></tr>
<tr><td><code id="balanceLovePlot_+3A_z">Z</code></td>
<td>
<p>Indicator vector for a binary instrument (must contain 1 or 0 for each unit).</p>
</td></tr>
<tr><td><code id="balanceLovePlot_+3A_permquantiles">permQuantiles</code></td>
<td>
<p>If <code>TRUE</code>, displays the permutation quantiles for the standardized covariate mean differences.</p>
</td></tr>
<tr><td><code id="balanceLovePlot_+3A_alpha">alpha</code></td>
<td>
<p>The significance level used for the permutation quantiles. For example, if <code>alpha = 0.05</code>, then the 2.5% and 97.5% permutation quantiles are displayed.</p>
</td></tr>
<tr><td><code id="balanceLovePlot_+3A_perms">perms</code></td>
<td>
<p>Number of permutations used to approximate the permutation quantiles.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Plot of the standardized covariate mean differences across the treatment and the instrument.
</p>


<h3>Author(s)</h3>

<p>Zach Branson and Luke Keele
</p>


<h3>References</h3>

<p>Branson, Z. and Keele, L. (2020). Evaluating a Key Instrumental Variable Assumption Using Randomization Tests. American Journal of Epidemiology. To appear.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>	#load the data
	data(icu.data)
	#the covariate matrix is
	X = as.matrix(subset(icu.data, select = -c(open_bin, icu_bed)))
	#the treatment
	D = icu.data$icu_bed
	#the instrument
	Z = icu.data$open_bin
	#make the Love plot with permutation quantiles
	## Not run: balanceLovePlot(X = X, D = D, Z = Z, permQuantiles = TRUE, perms = 500)
</code></pre>

<hr>
<h2 id='biasLovePlot'>Create Love plot of treatment bias and instrument bias</h2><span id='topic+biasLovePlot'></span>

<h3>Description</h3>

<p><code>biasLovePlot</code> creates a Love plot of the bias across the treatment and the instrument. Can also display the permutation quantiles for these quantities. Note that the bias is different for the treatment than for the instrument, as discussed in Equation (3) of Branson and Keele (2020). This function is used to create Figure 3b in Branson and Keele (2020).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>biasLovePlot(X, D, Z, permQuantiles = FALSE, alpha = 0.05, perms = 1000)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="biasLovePlot_+3A_x">X</code></td>
<td>
<p>Covariate matrix (with units as rows and covariates as columns).</p>
</td></tr>
<tr><td><code id="biasLovePlot_+3A_d">D</code></td>
<td>
<p>Indicator vector for a binary treatment (must contain 1 or 0 for each unit).</p>
</td></tr>
<tr><td><code id="biasLovePlot_+3A_z">Z</code></td>
<td>
<p>Indicator vector for a binary instrument (must contain 1 or 0 for each unit).</p>
</td></tr>
<tr><td><code id="biasLovePlot_+3A_permquantiles">permQuantiles</code></td>
<td>
<p>If <code>TRUE</code>, displays the permutation quantiles for the biases.</p>
</td></tr>
<tr><td><code id="biasLovePlot_+3A_alpha">alpha</code></td>
<td>
<p>The significance level used for the permutation quantiles. For example, if <code>alpha = 0.05</code>, then the 2.5% and 97.5% permutation quantiles are displayed.</p>
</td></tr>
<tr><td><code id="biasLovePlot_+3A_perms">perms</code></td>
<td>
<p>Number of permutations used to approximate the permutation quantiles.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Plot of the bias across the treatment and the instrument.
</p>


<h3>Author(s)</h3>

<p>Zach Branson and Luke Keele
</p>


<h3>References</h3>

<p>Branson, Z. and Keele, L. (2020). Evaluating a Key Instrumental Variable Assumption Using Randomization Tests. American Journal of Epidemiology. To appear.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  #load the data
  data(icu.data)
  #the covariate matrix is
  X = as.matrix(subset(icu.data, select = -c(open_bin, icu_bed)))
  #the treatment
  D = icu.data$icu_bed
  #the instrument
  Z = icu.data$open_bin
  #make the Love plot with permutation quantiles
  ## Not run: biasLovePlot(X = X, D = D, Z = Z, permQuantiles = TRUE, perms = 500)
</code></pre>

<hr>
<h2 id='card.data'>Card (1995) Data</h2><span id='topic+card.data'></span>

<h3>Description</h3>

<p>Data from the National Longitudinal Survey of Young Men (NLSYM) that was used by Card (1995).</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(card.data)</code></pre>


<h3>Format</h3>

<p>A data frame with 3010 observations on the following 35 variables.
</p>

<dl>
<dt><code>id</code></dt><dd><p>subject id</p>
</dd>
<dt><code>nearc2</code></dt><dd><p>indicator for whether a subject grew up near a two-year college</p>
</dd>
<dt><code>nearc4</code></dt><dd><p>indicator for whether a subject grew up near a four-year college</p>
</dd>
<dt><code>educ</code></dt><dd><p>subject's years of education</p>
</dd>
<dt><code>age</code></dt><dd><p>subject's age at the time of the survey in 1976</p>
</dd>
<dt><code>fatheduc</code></dt><dd><p>subject's father's years of education</p>
</dd>
<dt><code>motheduc</code></dt><dd><p>subject's mother's years of education</p>
</dd>
<dt><code>weight</code></dt><dd><p>sampling weight</p>
</dd>
<dt><code>momdad14</code></dt><dd><p>indicator for whether subject lived with both mother and father at age 14</p>
</dd>
<dt><code>sinmom14</code></dt><dd><p>indicator for whether subject lived with single mom at age 14</p>
</dd>
<dt><code>step14</code></dt><dd><p>indicator for whehter subject lived with step-parent at age 14</p>
</dd>
<dt><code>reg661</code></dt><dd><p>indicator for whether subject lived in region 1 (New England) in 1966</p>
</dd>
<dt><code>reg662</code></dt><dd><p>indicator for whether subject lived in region 2 (Middle Atlantic) in 1966</p>
</dd>
<dt><code>reg663</code></dt><dd><p>indicator for whether subject lived in region 3 (East North Central) in 1966</p>
</dd>
<dt><code>reg664</code></dt><dd><p>indicator for whether subject lived in region 4 (West North Central) in 1966</p>
</dd>
<dt><code>reg665</code></dt><dd><p>indicator for whether subject lived in region 5 (South Atlantic) in 1966</p>
</dd>
<dt><code>reg666</code></dt><dd><p>indicator for whether subject lived in region 6 (East South Central) in 1966</p>
</dd>
<dt><code>reg667</code></dt><dd><p>indicator for whether subject lived in region 7 (West South Central) in 1966</p>
</dd>
<dt><code>reg668</code></dt><dd><p>indicator for whether subject lived in region 8 (Mountain) in 1966</p>
</dd>
<dt><code>reg669</code></dt><dd><p>indicator for whether subject lived in region 9 (Pacific) in 1966</p>
</dd>
<dt><code>south66</code></dt><dd><p>indicator for whether subject lived in South in 1966</p>
</dd>
<dt><code>black</code></dt><dd><p>indicator for whether subject's race is black</p>
</dd>
<dt><code>smsa</code></dt><dd><p>indicator for whether subject lived in SMSA in 1976</p>
</dd>
<dt><code>south</code></dt><dd><p>indicator for whether subject lived in the South in 1976</p>
</dd>
<dt><code>smsa66</code></dt><dd><p>indicator for whether subject lived in SMSA in 1966</p>
</dd>
<dt><code>wage</code></dt><dd><p>subject's wage in cents per hour in 1976</p>
</dd>
<dt><code>enroll</code></dt><dd><p>indicator for whether subject is enrolled in college in 1976</p>
</dd>
<dt><code>KWW</code></dt><dd><p>subject's score on the Knowledge of the World of Work (KWW) test in 1966</p>
</dd>
<dt><code>IQ</code></dt><dd><p>IQ-type test score collected from the high school of the subject.</p>
</dd>
<dt><code>married</code></dt><dd><p>indicator for whether the subject was married in 1976.</p>
</dd>
<dt><code>libcrd14</code></dt><dd><p>indicator for whether subject had library card at age 14.</p>
</dd>
<dt><code>exper</code></dt><dd><p>subject's years of labor force experience in 1976</p>
</dd>
<dt><code>lwage</code></dt><dd><p>subject's log wage in 1976</p>
</dd>
<dt><code>expersq</code></dt><dd><p>square of subject's years of labor force experience in 1976</p>
</dd>
<dt><code>region</code></dt><dd><p>region in which subject lived in 1976</p>
</dd>
</dl>



<h3>Source</h3>

<p>Card, D.  Using Geographic Variation in College Proximity to Estimate the Return to Schooling. In Aspects of Labor Market Behavior: Essays in Honor of John Vanderkamp, eds. L.N. Christophides, E.K. Grant and R. Swidinsky.  201-222. National Longitudinal Survey of Young Men: https://www.nlsinfo.org/investigator/pages/login.jsp
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(card.data)
</code></pre>

<hr>
<h2 id='CLR'>Conditional Likelihood Ratio Test</h2><span id='topic+CLR'></span>

<h3>Description</h3>

<p><code>CLR</code> computes the conditional likelihood ratio test (Moreira, 2003) for the <code>ivmodel</code> object as well as the associated confidence interval.</p>


<h3>Usage</h3>

<pre><code class='language-R'>CLR(ivmodel, beta0 = 0, alpha = 0.05)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CLR_+3A_ivmodel">ivmodel</code></td>
<td>
<p><code>ivmodel</code> object</p>
</td></tr>
<tr><td><code id="CLR_+3A_beta0">beta0</code></td>
<td>
<p>Null value <code class="reqn">\beta_0</code> for testing null hypothesis <code class="reqn">H_0: \beta = \beta_0</code> in <code>ivmodel</code>. Default is 0</p>
</td></tr>
<tr><td><code id="CLR_+3A_alpha">alpha</code></td>
<td>
<p>The significance level for hypothesis testing. Default is 0.05</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>CLR.test</code> computes the conditional likelihood ratio test for the instrumental variables model in <code>ivmodel</code> object, specifically for the parameter <code class="reqn">\beta</code>. It also computes the <code class="reqn">1 -\alpha</code> confidence interval associated with it by inverting the test. The test is fully robust to weak instruments (Moreira 2003). We use the approximation suggested in Andrews et al. (2006) to evaluate the p value and the confidence interval.</p>


<h3>Value</h3>

<p><code>CLR</code> returns a list containing the following components
</p>
<table>
<tr><td><code>test.stat</code></td>
<td>
<p>The value of the test statistic for testing the null hypothesis <code class="reqn">H_0: \beta = \beta_0</code> in <code>ivmodel</code></p>
</td></tr>
<tr><td><code>p.value</code></td>
<td>
<p>The p value of the test under the null hypothesis <code class="reqn">H_0: \beta = \beta_0</code> in <code>ivmodel</code></p>
</td></tr>
<tr><td><code>ci</code></td>
<td>
<p>A matrix of two columns, each row contains an interval associated with the confidence interval</p>
</td></tr>
<tr><td><code>ci.info</code></td>
<td>
<p>A human-readable string describing the confidence interval</p>
</td></tr> 
</table>


<h3>Author(s)</h3>

<p>Yang Jiang, Hyunseung Kang, and Dylan Small</p>


<h3>References</h3>

<p>Andrews, D. W. K., Moreira, M. J., and Stock, J. H. (2006). Optimal two-side invariant similar tests for instrumental variables regression. <em>Econometrica</em> 74, 715-752.<br />
Moreira, M. J. (2003). A conditional likelihood ratio test for structural models. <em>Econometrica</em> 71, 1027-1048.
</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+ivmodel">ivmodel</a></code> for details on the instrumental variables model.</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(card.data)
Y=card.data[,"lwage"]
D=card.data[,"educ"]
Z=card.data[,c("nearc4","nearc2")]
Xname=c("exper", "expersq", "black", "south", "smsa", "reg661", 
        "reg662", "reg663", "reg664", "reg665", "reg666", "reg667", 
		"reg668", "smsa66")
X=card.data[,Xname]
card.model2IV = ivmodel(Y=Y,D=D,Z=Z,X=X)
CLR(card.model2IV,alpha=0.01)
</code></pre>

<hr>
<h2 id='coef.ivmodel'>Coefficients of the Fitted Model in the <code>ivmodel</code> Object</h2><span id='topic+coef.ivmodel'></span>

<h3>Description</h3>

<p>This coef methods returns the point estimation, standard error, test statistic and p value for all specified k-Class estimation from an <code>ivmodel</code> object.</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ivmodel'
coef(object,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="coef.ivmodel_+3A_object">object</code></td>
<td>
<p><code>ivmodel</code> object.</p>
</td></tr>
<tr><td><code id="coef.ivmodel_+3A_...">...</code></td>
<td>
<p>Additional arguments to <code>coef</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix summarizes all the k-Class estimations.
</p>


<h3>Author(s)</h3>

<p>Yang Jiang, Hyunseung Kang, and Dylan Small</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+ivmodel">ivmodel</a></code> for details on the instrumental variables model.</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(card.data)
Y=card.data[,"lwage"]
D=card.data[,"educ"]
Z=card.data[,"nearc4"]
Xname=c("exper", "expersq", "black", "south", "smsa", "reg661", 
        "reg662", "reg663", "reg664", "reg665", "reg666", "reg667", 
		"reg668", "smsa66")
X=card.data[,Xname]
foo = ivmodel(Y=Y,D=D,Z=Z,X=X)
coef(foo)
</code></pre>

<hr>
<h2 id='coefOther'>Exogenous Coefficients of the Fitted Model in the <code>ivmodel</code> Object</h2><span id='topic+coefOther'></span>

<h3>Description</h3>

<p>This <code>coefOther</code> returns the point estimates, standard errors, test statistics and p values for the exogenous covariates associated with the outcome. It returns a list of matrices where each matrix is one of the k-Class estimates from an <code>ivmodel</code> object.</p>


<h3>Usage</h3>

<pre><code class='language-R'>coefOther(ivmodel)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="coefOther_+3A_ivmodel">ivmodel</code></td>
<td>
<p><code>ivmodel</code> object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of matrices swhere each matrix summarizes the estimated coefficients from one of hte k-Class estimates.
</p>


<h3>Author(s)</h3>

<p>Hyunseung Kang</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+ivmodel">ivmodel</a></code> for details on the instrumental variables model.</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(card.data)
Y=card.data[,"lwage"]
D=card.data[,"educ"]
Z=card.data[,"nearc4"]
Xname=c("exper", "expersq", "black", "south", "smsa", "reg661", 
        "reg662", "reg663", "reg664", "reg665", "reg666", "reg667", 
		"reg668", "smsa66")
X=card.data[,Xname]
foo = ivmodel(Y=Y,D=D,Z=Z,X=X)
coefOther(foo)
</code></pre>

<hr>
<h2 id='confint.ivmodel'>Confidence Intervals for the Fitted Model in <code>ivmodel</code> Object</h2><span id='topic+confint.ivmodel'></span>

<h3>Description</h3>

<p>This confint methods returns a matrix of two columns, each row represents a confident interval for different IV approaches, which include k-Class, AR (Anderson and Rubin 1949) and CLR (Moreira 2003) estimations. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ivmodel'
confint(object,parm,level=NULL,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="confint.ivmodel_+3A_object">object</code></td>
<td>
<p><code>ivmodel</code> object.</p>
</td></tr>
<tr><td><code id="confint.ivmodel_+3A_parm">parm</code></td>
<td>
<p>Ignored for our code.</p>
</td></tr>
<tr><td><code id="confint.ivmodel_+3A_level">level</code></td>
<td>
<p>The confidence level.</p>
</td></tr>
<tr><td><code id="confint.ivmodel_+3A_...">...</code></td>
<td>
<p>Additional argument(s) for methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix, each row represents a confidence interval for different IV approaches.
</p>


<h3>Author(s)</h3>

<p>Yag Jiang, Hyunseung Kang, and Dylan Small</p>


<h3>References</h3>

<p>Andrews, D. W. K., Moreira, M. J., and Stock, J. H. (2006). Optimal two-side invariant similar tests for instrumental variables regression. <em>Econometrica</em> 74, 715-752.<br />
Moreira, M. J. (2003). A conditional likelihood ratio test for structural models. <em>Econometrica</em> 71, 1027-1048.<br />
Fuller, W. (1977). Some properties of a modification of the limited information estimator. <em>Econometrica</em>, 45, 939-953. <br />
Anderson, T.W. and Rubin, H. (1949), Estimation of the parameters of a single equation in a complete system of stochastic equations, Annals of Mathematical Statistics, 20, 46-63.
</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+ivmodel">ivmodel</a></code> for details on the instrumental variables model.</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(card.data)
Y=card.data[,"lwage"]
D=card.data[,"educ"]
Z=card.data[,"nearc4"]
Xname=c("exper", "expersq", "black", "south", "smsa", "reg661", 
        "reg662", "reg663", "reg664", "reg665", "reg666", "reg667", 
		"reg668", "smsa66")
X=card.data[,Xname]
foo = ivmodel(Y=Y,D=D,Z=Z,X=X)
confint(foo)
</code></pre>

<hr>
<h2 id='distributionBalancePlot'>Plot randomization distributions of the Mahalanobis distance</h2><span id='topic+distributionBalancePlot'></span>

<h3>Description</h3>

<p><code>distributionBalancePlot</code> displays the randomization distribution of the square root of the Mahalanobis distance across the treatment and/or instrument for different assignment mechanisms. This function supports complete randomization (displayed in black), block randomization (displayed in green), and Bernoulli trials for exposure (displayed in red) and instrument (displayed in blue). This function is used to create Figure 4 of Branson and Keele (2020).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>distributionBalancePlot(X, D = NULL, Z = NULL, subclass = NULL,
complete = FALSE, blocked = FALSE, bernoulli = FALSE, perms = 1000)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="distributionBalancePlot_+3A_x">X</code></td>
<td>
<p>Covariate matrix (with units as rows and covariates as columns).</p>
</td></tr>
<tr><td><code id="distributionBalancePlot_+3A_d">D</code></td>
<td>
<p>Indicator vector for a binary treatment (must contain 1 or 0 for each unit).</p>
</td></tr>
<tr><td><code id="distributionBalancePlot_+3A_z">Z</code></td>
<td>
<p>Indicator vector for a binary instrument (must contain 1 or 0 for each unit).</p>
</td></tr>
<tr><td><code id="distributionBalancePlot_+3A_subclass">subclass</code></td>
<td>
<p>Vector of subclasses (one for each unit). Subclasses can be numbers or characters, as long as there is one specified for each unit. Only needed if <code>blocked = TRUE</code>.</p>
</td></tr>
<tr><td><code id="distributionBalancePlot_+3A_complete">complete</code></td>
<td>
<p>If <code>TRUE</code>, displays the randomization distribution of the Mahalanobis distance under complete randomization.</p>
</td></tr>
<tr><td><code id="distributionBalancePlot_+3A_blocked">blocked</code></td>
<td>
<p>If <code>TRUE</code>, displays the randomization distribution of the Mahalanobis distance under block randomization. Needs <code>subclass</code> specified.</p>
</td></tr>
<tr><td><code id="distributionBalancePlot_+3A_bernoulli">bernoulli</code></td>
<td>
<p>If <code>TRUE</code>, displays the randomization distribution of the Mahalanobis distance under Bernoulli trials for the treatment and for the instrument.</p>
</td></tr>
<tr><td><code id="distributionBalancePlot_+3A_perms">perms</code></td>
<td>
<p>Number of permutations used to approximate the randomization distributions.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Plot of randomization distributions of the square root of the Mahalanobis distance across the treatment and/or instrument for different assignment mechanisms.
</p>


<h3>Author(s)</h3>

<p>Zach Branson and Luke Keele
</p>


<h3>References</h3>

<p>Branson, Z. and Keele, L. (2020). Evaluating a Key Instrumental Variable Assumption Using Randomization Tests. American Journal of Epidemiology. To appear.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  #load the data
  data(icu.data)
  #the covariate matrix is
  X = as.matrix(subset(icu.data, select = -c(open_bin, icu_bed)))
  #the treatment
  D = icu.data$icu_bed
  #the instrument
  Z = icu.data$open_bin
  #the subclass
  subclass = icu.data$site
  #make distribution plot of sqrt(MD) for
  #complete randomization, block randomization, and bernoulli trials
  #(just uncomment the code below)
  #distributionBalancePlot(X = X, D = D, Z = Z, subclass = subclass,
  #complete = TRUE, blocked = TRUE, bernoulli = TRUE, perms = 500)
</code></pre>

<hr>
<h2 id='fitted.ivmodel'>Extract Model Fitted values in the <code>ivmodel</code> Object</h2><span id='topic+fitted.ivmodel'></span>

<h3>Description</h3>

<p>This fitted method returns the fitted values from k-Class estimators inside <code>ivmodel</code>.</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ivmodel'
fitted(object,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fitted.ivmodel_+3A_object">object</code></td>
<td>
<p><code>ivmodel</code> object.</p>
</td></tr>
<tr><td><code id="fitted.ivmodel_+3A_...">...</code></td>
<td>
<p>Additional arguments to <code>fitted</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix of fitted values from the k-Class estimations. Specifically, each column of the matrix represents predicted values of the outcome for each individual based on different estimates of the treatment effect from k-Class estimators. By default, one of the columns of the matrix is the predicted outcome when the treatment effect is estimated by ordinary least squares (OLS). Because OLS is generally biased in instrumental variables settings, the predictions will likely be biased. For consistent estimates, the predictions are estimates of E[Y | D,X]. In other words, they marginalize over the unmeasured confounder U
and estimate the mean outcomes among all individuals with measured confounders X if
they were to be assigned treatment value D. For example, in the Card study, if U represents
the income of the study unit's parents which were not measured and X represents experience in years, the value of fitted for E[Y |
D = 16, X = 4] is what the average log income among individuals who
had 4 years of experience would be if they were assigned 16 years of education.
</p>


<h3>Author(s)</h3>

<p>Yang Jiang, Hyunseung Kang, and Dylan Small</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+ivmodel">ivmodel</a></code> for details on the instrumental variables model.</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(card.data)
Y=card.data[,"lwage"]
D=card.data[,"educ"]
Z=card.data[,"nearc4"]
Xname=c("exper", "expersq", "black", "south", "smsa", "reg661", 
        "reg662", "reg663", "reg664", "reg665", "reg666", "reg667", 
		"reg668", "smsa66")
X=card.data[,Xname]
foo = ivmodel(Y=Y,D=D,Z=Z,X=X)
fitted(foo)
</code></pre>

<hr>
<h2 id='Fuller'>Fuller-k Estimator</h2><span id='topic+Fuller'></span>

<h3>Description</h3>

<p><code>Fuller</code> computes the Fuller-k (Fuller 1977) estimate for the <code>ivmodel</code> object.</p>


<h3>Usage</h3>

<pre><code class='language-R'>Fuller(ivmodel,
	      beta0 = 0, alpha = 0.05, b = 1,
	      manyweakSE = FALSE,heteroSE = FALSE,clusterID=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Fuller_+3A_ivmodel">ivmodel</code></td>
<td>
<p><code>ivmodel</code> object.</p>
</td></tr>
<tr><td><code id="Fuller_+3A_beta0">beta0</code></td>
<td>
<p>Null value <code class="reqn">\beta_0</code> for testing null hypothesis <code class="reqn">H_0: \beta = \beta_0</code> in <code>ivmodel</code>. Default is 0.</p>
</td></tr>
<tr><td><code id="Fuller_+3A_alpha">alpha</code></td>
<td>
<p>The significance level for hypothesis testing. Default is 0.05.</p>
</td></tr>
<tr><td><code id="Fuller_+3A_b">b</code></td>
<td>
<p>Positive constant <code class="reqn">b</code> in Fuller-k estimator. Default is
1.</p>
</td></tr>
<tr><td><code id="Fuller_+3A_manyweakse">manyweakSE</code></td>
<td>
<p>Should many weak instrument (and
heteroscedastic-robust) asymptotics in Hansen, Hausman and Newey
(2008) be used to compute standard errors?</p>
</td></tr>
<tr><td><code id="Fuller_+3A_heterose">heteroSE</code></td>
<td>
<p>Should heteroscedastic-robust standard errors be used? Default is FALSE.</p>
</td></tr>
<tr><td><code id="Fuller_+3A_clusterid">clusterID</code></td>
<td>
<p>If cluster-robust standard errors are desired, provide a vector of length that's identical to the sample size. For example, if n = 6 and clusterID = c(1,1,1,2,2,2), there would be two clusters where the first cluster is formed by the first three observations and the second cluster is formed by the last three observations. clusterID can be numeric, character, or factor.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>Fuller</code> computes the Fuller-k estimate for the instrumental variables model in <code>ivmodel</code>, specifically for the parameter <code class="reqn">beta</code>. The computation uses <code>KClass</code> with the value of <code class="reqn">k = k_{LIML} - b/(n - L - p)</code>. It generates a point estimate, a standard error associated with the point estimate, a test statistic and a p value under the null hypothesis <code class="reqn">H_0: \beta = \beta_0</code> in <code>ivmodel</code> along with a <code class="reqn">1-\alpha</code> confidence interval.</p>


<h3>Value</h3>

<p><code>Fuller</code> returns a list containing the following components
</p>
<table>
<tr><td><code>k</code></td>
<td>
<p>The k value used when computing the Fuller estimate with the k-Class estimator.</p>
</td></tr>
<tr><td><code>point.est</code></td>
<td>
<p>Point estimate of <code class="reqn">\beta</code>.</p>
</td></tr>
<tr><td><code>std.err</code></td>
<td>
<p>Standard error of the estimate.</p>
</td></tr>
<tr><td><code>test.stat</code></td>
<td>
<p>The value of the test statistic for testing the null hypothesis <code class="reqn">H_0: \beta = \beta_0</code> in <code>ivmodel</code>.</p>
</td></tr>
<tr><td><code>p.value</code></td>
<td>
<p>The p value of the test under the null hypothesis <code class="reqn">H_0: \beta = \beta_0</code> in <code>ivmodel</code>.</p>
</td></tr>
<tr><td><code>ci</code></td>
<td>
<p>A matrix of one row by two columns specifying the confidence interval associated with the Fuller estimator.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Yang Jiang, Hyunseung Kang, Dylan Small</p>


<h3>References</h3>

<p>Fuller, W. (1977). Some properties of a modification of the limited information estimator. <em>Econometrica</em>, 45, 939-953.
</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+ivmodel">ivmodel</a></code> for details on the instrumental variables model. See also <code><a href="#topic+KClass">KClass</a></code> for more information about the k-Class estimator.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(card.data)
Y=card.data[,"lwage"]
D=card.data[,"educ"]
Z=card.data[,c("nearc4","nearc2")]
Xname=c("exper", "expersq", "black", "south", "smsa", "reg661",
        "reg662", "reg663", "reg664", "reg665", "reg666", "reg667",
		"reg668", "smsa66")
X=card.data[,Xname]
card.model2IV = ivmodel(Y=Y,D=D,Z=Z,X=X)
Fuller(card.model2IV,alpha=0.01)
</code></pre>

<hr>
<h2 id='getCovMeanDiffs'>Get Covariate Mean Differences</h2><span id='topic+getCovMeanDiffs'></span>

<h3>Description</h3>

<p><code>getCovMeanDiffs</code> returns the covariate mean differences between two groups.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getCovMeanDiffs(X, indicator)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getCovMeanDiffs_+3A_x">X</code></td>
<td>
<p>Covariate matrix (with units as rows and covariates as columns).</p>
</td></tr>
<tr><td><code id="getCovMeanDiffs_+3A_indicator">indicator</code></td>
<td>
<p>Binary indicator vector (must contain 1 or 0 for each unit). For example, could be a binary treatment or instrument.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Covariate mean differences between two groups.
</p>


<h3>Author(s)</h3>

<p>Zach Branson and Luke Keele
</p>


<h3>References</h3>

<p>Branson, Z. and Keele, L. (2020). Evaluating a Key Instrumental Variable Assumption Using Randomization Tests. American Journal of Epidemiology. To appear.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>	#load the data
	data(icu.data)
	#the covariate matrix is
	X = as.matrix(subset(icu.data, select = -c(open_bin, icu_bed)))
	#covariate mean differences across the treatment
	getCovMeanDiffs(X = X, indicator = icu.data$icu_bed)
	#covariate mean differences across the instrument
	getCovMeanDiffs(X = X, indicator = icu.data$open_bin)
</code></pre>

<hr>
<h2 id='getMD'>Get Mahalanobis Distance</h2><span id='topic+getMD'></span>

<h3>Description</h3>

<p><code>getMD</code> returns the Mahalanobis distance between two groups.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getMD(X, indicator, covX.inv = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getMD_+3A_x">X</code></td>
<td>
<p>Covariate matrix (with units as rows and covariates as columns).</p>
</td></tr>
<tr><td><code id="getMD_+3A_indicator">indicator</code></td>
<td>
<p>Binary indicator vector (must contain 1 or 0 for each unit). For example, could be a binary treatment or instrument.</p>
</td></tr>
<tr><td><code id="getMD_+3A_covx.inv">covX.inv</code></td>
<td>
<p>Inverse of the covariate covariance matrix. Usually this is left as <code>NULL</code>, because <code>getMD()</code> will compute <code>covX.inv</code> for you. However, if <code>getMD()</code> is used many times (e.g., as in a permutation test), it can be computationally efficient to specify <code>covX.inv</code> beforehand.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Mahalanobis distance between two groups.
</p>


<h3>Author(s)</h3>

<p>Zach Branson and Luke Keele
</p>


<h3>References</h3>

<p>Branson, Z. and Keele, L. (2020). Evaluating a Key Instrumental Variable Assumption Using Randomization Tests. American Journal of Epidemiology. To appear.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>	#load the data
	data(icu.data)
	#the covariate matrix is
	X = as.matrix(subset(icu.data, select = -c(open_bin, icu_bed)))
	#mahalanobis distance across the treatment
	getMD(X = X, indicator = icu.data$icu_bed)
	#mahalanobis distance across the instrument
	getMD(X = X, indicator = icu.data$open_bin)
</code></pre>

<hr>
<h2 id='getStandardizedCovMeanDiffs'>Get Standardized Covariate Mean Differences</h2><span id='topic+getStandardizedCovMeanDiffs'></span>

<h3>Description</h3>

<p><code>getStandardizedCovMeanDiffs</code> returns the standardized covariate mean differences between two groups.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getStandardizedCovMeanDiffs(X, indicator)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getStandardizedCovMeanDiffs_+3A_x">X</code></td>
<td>
<p>Covariate matrix (with units as rows and covariates as columns).</p>
</td></tr>
<tr><td><code id="getStandardizedCovMeanDiffs_+3A_indicator">indicator</code></td>
<td>
<p>Binary indicator vector (must contain 1 or 0 for each unit). For example, could be a binary treatment or instrument.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Standardized covariate mean differences between two groups.
</p>


<h3>Author(s)</h3>

<p>Zach Branson and Luke Keele
</p>


<h3>References</h3>

<p>Branson, Z. and Keele, L. (2020). Evaluating a Key Instrumental Variable Assumption Using Randomization Tests. American Journal of Epidemiology. To appear.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>	#load the data
	data(icu.data)
	#the covariate matrix is
	X = as.matrix(subset(icu.data, select = -c(open_bin, icu_bed)))
	#standardized covariate mean differences across the treatment
	getStandardizedCovMeanDiffs(X = X, indicator = icu.data$icu_bed)
	#standardized covariate mean differences across the instrument
	getStandardizedCovMeanDiffs(X = X, indicator = icu.data$open_bin)
</code></pre>

<hr>
<h2 id='icu.data'>Pseudo-data based on Branson and Keele (2020)</h2><span id='topic+icu.data'></span>

<h3>Description</h3>

<p>Data sampled with replacemenet from the original data from the (SPOT)light study used in Branson and Keele (2020). Also see Keele et al. (2018) for more details about the variables in this dataset.</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(icu.data)</code></pre>


<h3>Format</h3>

<p>A data frame with 13011 observations on the following 18 variables.
</p>

<dl>
<dt><code>age</code></dt><dd><p>Age of the patient in years.</p>
</dd>
<dt><code>male</code></dt><dd><p>Whether or not the patient is male; 1 if male and 0 otherwise.</p>
</dd>
<dt><code>sepsis_dx</code></dt><dd><p>Whether or not the patient is diagnosed with sepsis; 1 if so and 0 otherwise.</p>
</dd>
<dt><code>periarrest</code></dt><dd><p>Whether or not the patient is diagnosed with peri-arrest; 1 if so and 0 otherwise.</p>
</dd>
<dt><code>icnarc_score</code></dt><dd><p>The Intensive Care National Audit and Research Centre physiological score.</p>
</dd>
<dt><code>news_score</code></dt><dd><p>The National Health Service national early warning score.</p>
</dd>
<dt><code>sofa_score</code></dt><dd><p>The sequential organ failure assessment score.</p>
</dd>
<dt><code>v_cc1</code></dt><dd><p>Indicator for level of care at assessment (Level 0, normal ward care).</p>
</dd>
<dt><code>v_cc2</code></dt><dd><p>Indicator for level of care at assessment (Level 1, normal ward care).</p>
</dd>
<dt><code>v_cc4</code></dt><dd><p>Indicator for level of care at assessment (Level 2, care within a high dependency unit).</p>
</dd>
<dt><code>v_cc5</code></dt><dd><p>Indicator for level of care at assessment (Level 3, ICU care).</p>
</dd>
<dt><code>v_cc_r1</code></dt><dd><p>Indicator for recommended level of care at assessment (Level 0, normal ward care).</p>
</dd>
<dt><code>v_cc_r2</code></dt><dd><p>Indicator for recommended level of care after assessment (Level 1, normal ward care).</p>
</dd>
<dt><code>v_cc_r4</code></dt><dd><p>Indicator for recommended level of care after assessment (Level 2, care within a high dependency unit).</p>
</dd>
<dt><code>v_cc_r5</code></dt><dd><p>Indicator for recommended level of care after assessment (Level 3, ICU care).</p>
</dd>
<dt><code>open_bin</code></dt><dd><p>Binary instrument; 1 if the available number of ICU beds was less than 4, and 0 otherwise.</p>
</dd>
<dt><code>icu_bed</code></dt><dd><p>Binary treatment; 1 if admitted to an ICU bed.</p>
</dd>
<dt><code>site</code></dt><dd><p>ID for the hospital that the patient attended.</p>
</dd>
</dl>



<h3>References</h3>

<p>Keele, L. et al. (2018). Stronger instruments and refined covariate balance in an observational study of the effectiveness of prompt admission to intensive care units. Journal of the Royal Statistical Society: Series A (Statistics in Society).
</p>
<p>Branson, Z. and Keele, L. (2020). Evaluating a Key Instrumental Variable Assumption Using Randomization Tests. American Journal of Epidemiology. To appear.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(icu.data)
</code></pre>

<hr>
<h2 id='iv.diagnosis'>Diagnostics of instrumental variable analysis</h2><span id='topic+iv.diagnosis'></span><span id='topic+iv.diagnosis.plot'></span>

<h3>Description</h3>

<p>Diagnostics of instrumental variable analysis
</p>


<h3>Usage</h3>

<pre><code class='language-R'>iv.diagnosis(Y, D, Z, X)

iv.diagnosis.plot(output, bias.ratio = TRUE, base_size = 15, text_size = 5)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="iv.diagnosis_+3A_y">Y</code></td>
<td>
<p>A numeric vector of outcomes.</p>
</td></tr>
<tr><td><code id="iv.diagnosis_+3A_d">D</code></td>
<td>
<p>A vector of endogenous variables.</p>
</td></tr>
<tr><td><code id="iv.diagnosis_+3A_z">Z</code></td>
<td>
<p>A vector of instruments.</p>
</td></tr>
<tr><td><code id="iv.diagnosis_+3A_x">X</code></td>
<td>
<p>A vector, matrix or data frame of (exogenous) covariates.</p>
</td></tr>
<tr><td><code id="iv.diagnosis_+3A_output">output</code></td>
<td>
<p>Output from <code>iv.diagnosis</code>.</p>
</td></tr>
<tr><td><code id="iv.diagnosis_+3A_bias.ratio">bias.ratio</code></td>
<td>
<p>Add bias ratios (text) to the plot?</p>
</td></tr>
<tr><td><code id="iv.diagnosis_+3A_base_size">base_size</code></td>
<td>
<p>size of the axis labels</p>
</td></tr>
<tr><td><code id="iv.diagnosis_+3A_text_size">text_size</code></td>
<td>
<p>size of the text (bias ratios)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list or data frame
</p>

<dl>
<dt>x.mean1</dt><dd><p>Mean of X under Z = 1 (reported if Z is binary)</p>
</dd>
<dt>x.mean0</dt><dd><p>Mean of X under Z = 0 (reported if Z is binary)</p>
</dd>
<dt>coef</dt><dd><p>OLS coefficient of X ~ Z (reported if Z is not binary)</p>
</dd>
<dt>se</dt><dd><p>Standard error of OLS coefficient (reported if Z is not binary)</p>
</dd>
<dt>p.val</dt><dd><p>p-value of the independence of Z and X (Fisher's test if both are binary, logistic regression if Z is binary, linear regression if Z is continuous)</p>
</dd>
<dt>stand.diff</dt><dd><p>Standardized difference (reported if Z is binary)</p>
</dd>
<dt>bias.ratio</dt><dd><p>Bias ratio</p>
</dd>
<dt>bias.amplify</dt><dd><p>Amplification of bias ratio</p>
</dd>
<dt>bias.ols</dt><dd><p>Bias of OLS</p>
</dd>
<dt>bias.2sls</dt><dd><p>Bias of two stage least squares)</p>
</dd>
</dl>



<h3>Functions</h3>


<ul>
<li> <p><code>iv.diagnosis.plot()</code>: IV diagnostic plot
</p>
</li></ul>


<h3>Author(s)</h3>

<p>Qingyuan Zhao
</p>


<h3>References</h3>


<ul>
<li><p>Baiocchi, M., Cheng, J., &amp; Small, D. S. (2014). Instrumental variable methods for causal inference. Statistics in Medicine, 33(13), 2297-2340.
</p>
</li>
<li><p>Jackson, J. W., &amp; Swanson, S. A. (2015). Toward a clearer portrayal of confounding bias in instrumental variable applications. Epidemiology, 26(4), 498.
</p>
</li>
<li><p>Zhao, Q., &amp; Small, D. S. (2018). Graphical diagnosis of confounding bias in instrumental variable analysis. Epidemiology, 29(4), e29&ndash;e31.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>n &lt;- 10000
Z &lt;- rbinom(n, 1, 0.5)
X &lt;- data.frame(matrix(c(rnorm(n), rbinom(n * 5, 1, 0.5)), n))
D &lt;- rbinom(n, 1, plogis(Z + X[, 1] + X[, 2] + X[, 3]))
Y &lt;- D + X[, 1] + X[, 2] + rnorm(n)
print(output &lt;- iv.diagnosis(Y, D, Z, X))
iv.diagnosis.plot(output)

Z &lt;- rnorm(n)
D &lt;- rbinom(n, 1, plogis(Z + X[, 1] + X[, 2] + X[, 3]))
Y &lt;- D + X[, 1] + X[, 2] + rnorm(n)
print(output &lt;- iv.diagnosis(Y, D, Z, X)) ## stand.diff is not reported
iv.diagnosis.plot(output)

</code></pre>

<hr>
<h2 id='ivmodel'>Fitting Instrumental Variables (IV) Models</h2><span id='topic+ivmodel'></span>

<h3>Description</h3>

<p><code>ivmodel</code> fits an instrumental variables (IV) model with one endogenous variable and a continuous outcome. It carries out several IV regressions, diagnostics, and tests associated this IV model. It is robust to most data formats, including factor and character data, and can handle very large IV models efficiently.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ivmodel(Y, D, Z, X, intercept = TRUE,
        beta0 = 0, alpha = 0.05, k = c(0, 1),
        manyweakSE = FALSE, heteroSE = FALSE, clusterID = NULL,
        deltarange = NULL, na.action = na.omit)
 </code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ivmodel_+3A_y">Y</code></td>
<td>
<p>A numeric vector of outcomes.</p>
</td></tr>
<tr><td><code id="ivmodel_+3A_d">D</code></td>
<td>
<p>A vector of endogenous variables.</p>
</td></tr>
<tr><td><code id="ivmodel_+3A_z">Z</code></td>
<td>
<p>A matrix or data frame of instruments.</p>
</td></tr>
<tr><td><code id="ivmodel_+3A_x">X</code></td>
<td>
<p>A matrix or data frame of (exogenous) covariates.</p>
</td></tr>
<tr><td><code id="ivmodel_+3A_intercept">intercept</code></td>
<td>
<p>Should the intercept be included? Default is TRUE and if so, you do not need to add a column of 1s in X.</p>
</td></tr>
<tr><td><code id="ivmodel_+3A_beta0">beta0</code></td>
<td>
<p>Null value <code class="reqn">\beta_0</code> for testing null hypothesis <code class="reqn">H_0: \beta = \beta_0</code> in <code>ivmodel</code>. Default is $0$.</p>
</td></tr>
<tr><td><code id="ivmodel_+3A_alpha">alpha</code></td>
<td>
<p>The significance level for hypothesis testing. Default is 0.05.</p>
</td></tr>
<tr><td><code id="ivmodel_+3A_k">k</code></td>
<td>
<p>A numeric vector of k values for k-class estimation. Default
is 0 (OLS) and 1 (TSLS).</p>
</td></tr>
<tr><td><code id="ivmodel_+3A_manyweakse">manyweakSE</code></td>
<td>
<p>Should many weak instrument (and
heteroscedastic-robust) asymptotics in Hansen, Hausman and Newey
(2008) be used to compute standard errors? (Not supported for k ==0)</p>
</td></tr>
<tr><td><code id="ivmodel_+3A_heterose">heteroSE</code></td>
<td>
<p>Should heteroscedastic-robust standard errors be used? Default is FALSE.</p>
</td></tr>
<tr><td><code id="ivmodel_+3A_clusterid">clusterID</code></td>
<td>
<p>If cluster-robust standard errors are desired, provide a vector of
length that's identical to the sample size. For example, if n = 6 and clusterID = c(1,1,1,2,2,2),
there would be two clusters where the first cluster is formed by the first three observations and
the second cluster is formed by the last three observations. clusterID can be numeric, character, or factor.</p>
</td></tr>
<tr><td><code id="ivmodel_+3A_deltarange">deltarange</code></td>
<td>
<p>Range of <code class="reqn">\delta</code> for sensitivity analysis with the Anderson-Rubin (1949) test.</p>
</td></tr>
<tr><td><code id="ivmodel_+3A_na.action">na.action</code></td>
<td>
<p>NA handling. There are <code>na.fail</code>, <code>na.omit</code>, <code>na.exclude</code>, <code>na.pass</code> available. Default is na.omit.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Let <code class="reqn">Y</code>, <code class="reqn">D</code>, <code class="reqn">X</code>, and <code class="reqn">Z</code> represent the outcome, endogenous variable, <em>p</em> dimensional exogenous covariates, and <em>L</em> dimensional instruments, respectively. Note that the intercept is a type of exogenous covariate and can be added to <code class="reqn">X</code> by specifying <code>intercept</code> as TRUE (the default behavior); the user does not have to manually add an intercept column in <code class="reqn">X</code>. <code>ivmodel</code> assumes the following IV model
</p>
<p style="text-align: center;"><code class="reqn"> Y = X \alpha + D \beta + \epsilon, E(\epsilon | X, Z) = 0</code>
</p>

<p>and produces statistics for <code class="reqn">\beta</code>. In particular, <code>ivmodel</code> computes the OLS, TSLS, k-class, limited information maximum likelihood (LIML), and Fuller-k  (Fuller 1977) estimates of <code class="reqn">\beta</code> using <code>KClass</code>, <code>LIML</code>, and codeFuller. Also, <code>ivmodel</code> computes confidence intervals and hypothesis tests of the type <code class="reqn">H_0: \beta = \beta_0</code> versus <code class="reqn">H_0: \beta \neq \beta_0</code> for the said estimators as well as two weak-IV confidence intervals, Anderson and Rubin (Anderson and Rubin 1949) confidence interval (Anderson and Rubin 1949) and the conditional likelihood ratio confidence interval (Moreira 2003). Finally, the code also conducts a sensitivity analysis if <code class="reqn">Z</code> is one-dimensional (i.e. there is only one instrument) using the method in Jiang et al. (2015).
</p>
<p>Some procedures (e.g. conditional likelihood ratio test, sensitivity analysis with Anderson-Rubin) assume an additional linear model
</p>
<p style="text-align: center;"><code class="reqn">D = Z \gamma + X \kappa + \xi, E(\xi | X, Z) = 0</code>
</p>



<h3>Value</h3>

<p><code>ivmodel</code> returns an object of class &quot;ivmodel&quot;.
</p>
<p>An object class &quot;ivmodel&quot; is a list containing the following components
</p>
<table>
<tr><td><code>n</code></td>
<td>
<p>Sample size.</p>
</td></tr>
<tr><td><code>L</code></td>
<td>
<p>Number of instruments.</p>
</td></tr>
<tr><td><code>p</code></td>
<td>
<p>Number of exogenous covariates (including intercept).</p>
</td></tr>
<tr><td><code>Y</code></td>
<td>
<p>Outcome, cleaned for use in future methods.</p>
</td></tr>
<tr><td><code>D</code></td>
<td>
<p>Treatment, cleaned for use in future methods.</p>
</td></tr>
<tr><td><code>Z</code></td>
<td>
<p>Instrument(s), cleaned for use in future methods.</p>
</td></tr>
<tr><td><code>X</code></td>
<td>
<p>Exogenous covariates (if provided), cleaned for use in future methods.</p>
</td></tr>
<tr><td><code>Yadj</code></td>
<td>
<p>Adjusted outcome, projecting out X.</p>
</td></tr>
<tr><td><code>Dadj</code></td>
<td>
<p>Adjusted treatment, projecting out X.</p>
</td></tr>
<tr><td><code>Zadj</code></td>
<td>
<p>Adjusted instrument(s), projecting out X.</p>
</td></tr>
<tr><td><code>ZadjQR</code></td>
<td>
<p>QR decomposition for adjusted instrument(s).</p>
</td></tr>
<tr><td><code>ZXQR</code></td>
<td>
<p>QR decomposition for concatenated matrix of Z and X.</p>
</td></tr>
<tr><td><code>alpha</code></td>
<td>
<p>Significance level for the hypothesis tests.</p>
</td></tr>
<tr><td><code>beta0</code></td>
<td>
<p>Null value of the hypothesis tests.</p>
</td></tr>
<tr><td><code>kClass</code></td>
<td>
<p>A list from <code>KClass</code> function.</p>
</td></tr>
<tr><td><code>LIML</code></td>
<td>
<p>A list from <code>LIML</code> function.</p>
</td></tr>
<tr><td><code>Fuller</code></td>
<td>
<p>A list from <code>Fuller</code> function.</p>
</td></tr>
<tr><td><code>AR</code></td>
<td>
<p>A list from <code>AR.test</code>.</p>
</td></tr>
<tr><td><code>CLR</code></td>
<td>
<p>A list from <code>CLR</code>.</p>
</td></tr>
</table>
<p>In addition, if there is only one instrument, <code>ivreg</code> will generate an &quot;ARsens&quot; list within &quot;ivmodel&quot; object.
</p>


<h3>Author(s)</h3>

<p>Yang Jiang, Hyunseung Kang, and Dylan Small</p>


<h3>References</h3>

<p>Anderson, T. W. and Rubin, H. (1949). Estimation of the parameters of a single equation in a complete system of stochastic equations. <em>Annals of Mathematical Statistics</em> 20, 46-63.<br />
</p>
<p>Freeman G., Cowling B. J., Schooling C. M. (2013). Power and Sample Size Calculations for Mendelian Randomization Studies Using One Genetic Instrument. <em>International Journal of Epidemiology</em> 42(4), 1157-1163. <br />
</p>
<p>Fuller, W. (1977). Some properties of a modification of the limited information estimator. <em>Econometrica</em>, 45, 939-953.  <br />
</p>
<p>Hansen, C., Hausman, J., and Newey, W. (2008) Estimation with many instrumental variables. <em>Journal of Business and Economic Statistics</em> 26(4), 398-422. <br />
</p>
<p>Moreira, M. J. (2003). A conditional likelihood ratio test for structural models. <em>Econometrica</em> 71, 1027-1048. <br />
</p>
<p>Sargan, J. D. (1958). The estimation of economic relationships using instrumental variables. Econometrica , 393-415. <br />
</p>
<p>Wang, X., Jiang, Y., Small, D. and Zhang, N. (2017), Sensitivity analysis and power for instrumental variable studies. <em>Biometrics</em> 74(4), 1150-1160.
</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+KClass">KClass</a></code>, <code><a href="#topic+LIML">LIML</a></code>, <code><a href="#topic+Fuller">Fuller</a></code>, <code><a href="#topic+AR.test">AR.test</a></code>, and <code><a href="#topic+CLR">CLR</a></code> for individual methods associated with <code>ivmodel</code>. For extracting the estimated effect of the exogenous covariates on the outcome, see <code><a href="#topic+coefOther">coefOther</a></code>. For sensitivity analysis with the AR test,
see <code><a href="#topic+ARsens.test">ARsens.test</a></code>. <code>ivmodel</code> has <code><a href="#topic+vcov.ivmodel">vcov.ivmodel</a></code>,<code><a href="#topic+model.matrix.ivmodel">model.matrix.ivmodel</a></code>,<code><a href="#topic+summary.ivmodel">summary.ivmodel</a></code>, <code><a href="#topic+confint.ivmodel">confint.ivmodel</a></code>, <code><a href="#topic+fitted.ivmodel">fitted.ivmodel</a></code>,
<code><a href="#topic+residuals.ivmodel">residuals.ivmodel</a></code> and <code><a href="#topic+coef.ivmodel">coef.ivmodel</a></code> methods associated with it.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(card.data)
# One instrument #
Y=card.data[,"lwage"]
D=card.data[,"educ"]
Z=card.data[,"nearc4"]
Xname=c("exper", "expersq", "black", "south", "smsa", "reg661",
        "reg662", "reg663", "reg664", "reg665", "reg666", "reg667",
		"reg668", "smsa66")
X=card.data[,Xname]
card.model1IV = ivmodel(Y=Y,D=D,Z=Z,X=X)
card.model1IV

# Multiple instruments
Z = card.data[,c("nearc4","nearc2")]
card.model2IV = ivmodel(Y=Y,D=D,Z=Z,X=X)
card.model2IV
</code></pre>

<hr>
<h2 id='ivmodel-bransonKeele-internal'>Internal <code>ivmodel</code> functions for Branson and Keele (2020)</h2><span id='topic+permuteData.biasedCoin'></span><span id='topic+getBlockPerm'></span><span id='topic+getCompletePerms.meanDiffs'></span><span id='topic+getCompletePerms.balance'></span><span id='topic+getCompletePerms.md'></span><span id='topic+getCompletePerms.absBias'></span><span id='topic+getBlockPerms.md'></span><span id='topic+getBlockPerms.absBias'></span><span id='topic+getBernoulliPerms.md'></span><span id='topic+getBernoulliPerms.absBias'></span>

<h3>Description</h3>

<p>Internal <code>ivmodel</code> functions for Branson and Keele (2020)</p>


<h3>Usage</h3>

<pre><code class='language-R'>	permuteData.biasedCoin(N, probs)
	getBlockPerm(subclassIndicatorTable)
	getCompletePerms.meanDiffs(X, indicator, perms = 1000)
	getCompletePerms.balance(X, indicator, perms = 1000)
	getCompletePerms.md(X, indicator, perms = 1000)
	getCompletePerms.absBias(X, D = NULL, Z = NULL, perms = 1000)
	getBlockPerms.md(X, indicator, subclass, perms = 1000)
	getBlockPerms.absBias(X, D = NULL, Z = NULL, subclass = NULL, perms = 1000)
	getBernoulliPerms.md(X, indicator, perms = 1000)
	getBernoulliPerms.absBias(X, D = NULL, Z = NULL, perms = 1000)
</code></pre>


<h3>Details</h3>

<p><code>permuteData.biasedCoin</code> permutes the treatment indicator according to biased-coin randomization (i.e., Bernoulli trials).
<code>getBlockPerm</code> permutes an indicator (instrument or exposure) within a subclass.
<code>getCompletePerms.meanDiffs</code> returns the covariate mean differences across many permutations of an indicator.
<code>getCompletePerms.balance</code> returns the standardized covariate mean differences across many permutations of an indicator.
<code>getCompletePerms.md</code> returns the Mahalanobis distance across many permutations of an indicator.
<code>getCompletePerms.absBias</code> returns the sum of absolute biases across many permutations of an indicator.
<code>getBlockPerms.md</code> returns the Mahalanobis distance across many block permutations of an indicator.
<code>getBlockPerms.absBias</code> returns the sum of absolute biases across many block permutations of an indicator.
<code>getBernoulliPerms.md</code> returns the Mahalanobis distance across many Bernoulli-trial permutations of an indicator.
<code>getBernoulliPerms.absBias</code> returns the sum of absolute biases across many Bernoulli-trial permutations of an indicator.
</p>


<h3>Author(s)</h3>

<p>Zach Branson and Luke Keele</p>

<hr>
<h2 id='ivmodel-internal'>Internal <code>ivmodel</code> functions</h2><span id='topic+invTwobyTwoSymMatrix'></span><span id='topic+condPvalue'></span><span id='topic+qrrank'></span><span id='topic+qrRM'></span><span id='topic+quadSolver'></span><span id='topic+print.ivmodel'></span><span id='topic+summary.ivmodel'></span>

<h3>Description</h3>

<p>Internal <code>ivmodel</code> functions</p>


<h3>Usage</h3>

<pre><code class='language-R'>  invTwobyTwoSymMatrix(M)
  quadSolver(a,b,c)
  condPvalue(m,qT,k,df2,eps = 0.02)
  qrrank(QR,tol=1e-8)
  qrRM(QR)
  ## S3 method for class 'ivmodel'
print(x,...)
  ## S3 method for class 'ivmodel'
summary(object,...)
</code></pre>


<h3>Details</h3>

<p><code>invTwobyTwoSymMatrix</code> is a helper function to invert two-by-two symmetric matrices. 
<code>quadSolver</code> is a helper function to invert to solve quadratic equations.
<code>condPvalue</code> is a helper function for the conditional likelihood ratio test in <code>CLR.test</code>.
<code>qrrank</code> and <code>qrRM</code> are helper functions for the sparse QR package.
<code>print</code> is a method to print the ivmodel object.
<code>summary</code> is a method that just returns the input, to align with the standard usage of summary method.
</p>


<h3>Author(s)</h3>

<p>Yang Jiang, Hyunseung Kang, and Dylan Small</p>

<hr>
<h2 id='ivmodelFormula'>Fitting Instrumental Variables (IV) Models</h2><span id='topic+ivmodelFormula'></span>

<h3>Description</h3>

<p><code>ivmodelFormula</code> fits an instrumental variables (IV) model with one endogenous variable and a continuous outcome. It carries out several IV regressions, diagnostics, and tests associated this IV model. It is robust to most data formats, including factor and character data, and can handle very large IV models efficiently.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ivmodelFormula(formula, data, subset,
        beta0=0,alpha=0.05,k=c(0,1), 
        manyweakSE = FALSE,
        heteroSE = FALSE, clusterID = NULL, 
        deltarange=NULL, na.action = na.omit)
 </code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ivmodelFormula_+3A_formula">formula</code></td>
<td>
<p>a formula describing the model to be fitted. For example, the formula <code>Y ~ D + X1 + X2 | Z1 + Z2 + X1 + X2</code> describes the mode where
</p>
<p style="text-align: center;"><code class="reqn"> Y = \alpha_0 + D \beta +  X_{1} \alpha_1 + X_{2} \alpha_2 + \epsilon</code>
</p>

<p>and 
</p>
<p style="text-align: center;"><code class="reqn"> D = \gamma_0 + Z_{1} \gamma_1 + Z_{2} \gamma2 + X_{1} \kappa_1 + X_{2} \kappa_2 + \xi</code>
</p>

<p>The outcome is <code>Y</code>, the endogenous variable is <code>D</code>. The exogenous covariates are <code>X1</code> and <code>X2</code>.
The instruments are <code>Z1</code> and <code>Z2</code>. The formula environment follows the formula environment 
in the <code>ivreg</code> function in the AER package.</p>
</td></tr>
<tr><td><code id="ivmodelFormula_+3A_data">data</code></td>
<td>
<p>an optional data frame containing the variables in the model.
By default the variables are taken from the environment which <code>ivmodel</code> is called from</p>
</td></tr>	             
<tr><td><code id="ivmodelFormula_+3A_subset">subset</code></td>
<td>
<p>an index vector indicating which rows should be used.</p>
</td></tr>
<tr><td><code id="ivmodelFormula_+3A_beta0">beta0</code></td>
<td>
<p>Null value <code class="reqn">\beta_0</code> for testing null hypothesis <code class="reqn">H_0: \beta = \beta_0</code> in <code>ivmodel</code>. Default is $0$.</p>
</td></tr>
<tr><td><code id="ivmodelFormula_+3A_alpha">alpha</code></td>
<td>
<p>The significance level for hypothesis testing. Default is 0.05.</p>
</td></tr>
<tr><td><code id="ivmodelFormula_+3A_k">k</code></td>
<td>
<p>A numeric vector of k values for k-class estimation. Default is 0 (OLS) and 1 (TSLS).</p>
</td></tr>
<tr><td><code id="ivmodelFormula_+3A_manyweakse">manyweakSE</code></td>
<td>
<p>Should many weak instrument (and
heteroscedastic-robust) asymptotics in Hansen, Hausman and Newey
(2008) be used to compute standard errors? (Not supported for k ==0)</p>
</td></tr>
<tr><td><code id="ivmodelFormula_+3A_heterose">heteroSE</code></td>
<td>
<p>Should heteroscedastic-robust standard errors be used? Default is FALSE.</p>
</td></tr>
<tr><td><code id="ivmodelFormula_+3A_clusterid">clusterID</code></td>
<td>
<p>If cluster-robust standard errors are desired, provide a vector of 
length that's identical to the sample size. For example, if n = 6 and clusterID = c(1,1,1,2,2,2), 
there would be two clusters where the first cluster is formed by the first three observations and 
the second cluster is formed by the last three observations. clusterID can be numeric, character, or factor.</p>
</td></tr>
<tr><td><code id="ivmodelFormula_+3A_deltarange">deltarange</code></td>
<td>
<p>Range of <code class="reqn">\delta</code> for sensitivity analysis with the Anderson-Rubin (1949) test.</p>
</td></tr>
<tr><td><code id="ivmodelFormula_+3A_na.action">na.action</code></td>
<td>
<p>NA handling. There are <code>na.fail</code>, <code>na.omit</code>, <code>na.exclude</code>, <code>na.pass</code> available. Default is na.omit.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Let <code class="reqn">Y</code>, <code class="reqn">D</code>, <code class="reqn">X</code>, and <code class="reqn">Z</code> represent the outcome, endogenous variable, <em>p</em> dimensional exogenous covariates, and <em>L</em> dimensional instruments, respectively. <code>ivmodel</code> assumes the following IV model
</p>
<p style="text-align: center;"><code class="reqn"> Y = X \alpha + D \beta + \epsilon, E(\epsilon | X, Z) = 0</code>
</p>

<p>and produces statistics for <code class="reqn">\beta</code>. In particular, <code>ivmodel</code> computes the OLS, TSLS, k-class, limited information maximum likelihood (LIML), and Fuller-k  (Fuller 1977) estimates of <code class="reqn">\beta</code> using <code>KClass</code>, <code>LIML</code>, and codeFuller. Also, <code>ivmodel</code> computes confidence intervals and hypothesis tests of the type <code class="reqn">H_0: \beta = \beta_0</code> versus <code class="reqn">H_0: \beta \neq \beta_0</code> for the said estimators as well as two weak-IV confidence intervals, Anderson and Rubin (Anderson and Rubin 1949) confidence interval (Anderson and Rubin 1949) and the conditional likelihood ratio confidence interval (Moreira 2003). Finally, the code also conducts a sensitivity analysis if <code class="reqn">Z</code> is one-dimensional (i.e. there is only one instrument) using the method in Jiang et al. (2015).
</p>
<p>Some procedures (e.g. conditional likelihood ratio test, sensitivity analysis with Anderson-Rubin) assume an additional linear model
</p>
<p style="text-align: center;"><code class="reqn">D = Z \gamma + X \kappa + \xi, E(\xi | X, Z) = 0</code>
</p>



<h3>Value</h3>

<p><code>ivmodel</code> returns an object of class &quot;ivmodel&quot;.
</p>
<p>An object class &quot;ivmodel&quot; is a list containing the following components
</p>
<table>
<tr><td><code>n</code></td>
<td>
<p>Sample size.</p>
</td></tr>
<tr><td><code>L</code></td>
<td>
<p>Number of instruments.</p>
</td></tr>
<tr><td><code>p</code></td>
<td>
<p>Number of exogenous covariates (including intercept).</p>
</td></tr>
<tr><td><code>Y</code></td>
<td>
<p>Outcome, cleaned for use in future methods.</p>
</td></tr>
<tr><td><code>D</code></td>
<td>
<p>Treatment, cleaned for use in future methods.</p>
</td></tr>
<tr><td><code>Z</code></td>
<td>
<p>Instrument(s), cleaned for use in future methods.</p>
</td></tr>
<tr><td><code>X</code></td>
<td>
<p>Exogenous covariates (if provided), cleaned for use in future methods.</p>
</td></tr>
<tr><td><code>Yadj</code></td>
<td>
<p>Adjusted outcome, projecting out X.</p>
</td></tr>
<tr><td><code>Dadj</code></td>
<td>
<p>Adjusted treatment, projecting out X.</p>
</td></tr>
<tr><td><code>Zadj</code></td>
<td>
<p>Adjusted instrument(s), projecting out X.</p>
</td></tr>
<tr><td><code>ZadjQR</code></td>
<td>
<p>QR decomposition for adjusted instrument(s).</p>
</td></tr>
<tr><td><code>ZXQR</code></td>
<td>
<p>QR decomposition for concatenated matrix of Z and X.</p>
</td></tr>
<tr><td><code>alpha</code></td>
<td>
<p>Significance level for the hypothesis tests.</p>
</td></tr>
<tr><td><code>beta0</code></td>
<td>
<p>Null value of the hypothesis tests.</p>
</td></tr>
<tr><td><code>kClass</code></td>
<td>
<p>A list from <code>KClass</code> function.</p>
</td></tr>
<tr><td><code>LIML</code></td>
<td>
<p>A list from <code>LIML</code> function.</p>
</td></tr>
<tr><td><code>Fuller</code></td>
<td>
<p>A list from <code>Fuller</code> function.</p>
</td></tr>
<tr><td><code>AR</code></td>
<td>
<p>A list from <code>AR.test</code>.</p>
</td></tr>
<tr><td><code>CLR</code></td>
<td>
<p>A list from <code>CLR</code>.</p>
</td></tr>
</table>
<p>In addition, if there is only one instrument, <code>ivreg</code> will generate an &quot;ARsens&quot; list within &quot;ivmodel&quot; object.
</p>


<h3>Author(s)</h3>

<p>Yang Jiang, Hyunseung Kang, and Dylan Small</p>


<h3>References</h3>

<p>Anderson, T. W. and Rubin, H. (1949). Estimation of the parameters of a single equation in a complete system of stochastic equations. <em>Annals of Mathematical Statistics</em> 20, 46-63.<br />
</p>
<p>Freeman G., Cowling B. J., Schooling C. M. (2013). Power and Sample Size Calculations for Mendelian Randomization Studies Using One Genetic Instrument. <em>International Journal of Epidemiology</em> 42(4), 1157-1163. <br />
</p>
<p>Fuller, W. (1977). Some properties of a modification of the limited information estimator. <em>Econometrica</em>, 45, 939-953.  <br />
</p>
<p>Hansen, C., Hausman, J., and Newey, W. (2008) Estimation with many instrumental variables. <em>Journal of Business and Economic Statistics</em> 26(4), 398-422. <br />
</p>
<p>Moreira, M. J. (2003). A conditional likelihood ratio test for structural models. <em>Econometrica</em> 71, 1027-1048. <br />
</p>
<p>Sargan, J. D. (1958). The estimation of economic relationships using instrumental variables. Econometrica , 393-415. <br />
</p>
<p>Wang, X., Jiang, Y., Small, D. and Zhang, N. (2017), Sensitivity analysis and power for instrumental variable studies. <em>Biometrics</em> 74(4), 1150-1160.
</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+KClass">KClass</a></code>, <code><a href="#topic+LIML">LIML</a></code>, <code><a href="#topic+Fuller">Fuller</a></code>, <code><a href="#topic+AR.test">AR.test</a></code>, and <code><a href="#topic+CLR">CLR</a></code> for individual methods associated with <code>ivmodel</code>. For extracting the estimated effect of the exogenous covariates on the outcome, see <code><a href="#topic+coefOther">coefOther</a></code>. For sensitivity analysis with the AR test,
see <code><a href="#topic+ARsens.test">ARsens.test</a></code>. <code>ivmodel</code> has <code><a href="#topic+vcov.ivmodel">vcov.ivmodel</a></code>,<code><a href="#topic+model.matrix.ivmodel">model.matrix.ivmodel</a></code>,<code><a href="#topic+summary.ivmodel">summary.ivmodel</a></code>, <code><a href="#topic+confint.ivmodel">confint.ivmodel</a></code>, <code><a href="#topic+fitted.ivmodel">fitted.ivmodel</a></code>,
<code><a href="#topic+residuals.ivmodel">residuals.ivmodel</a></code> and <code><a href="#topic+coef.ivmodel">coef.ivmodel</a></code> methods associated with it.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(card.data)
# One instrument #
Y=card.data[,"lwage"]
D=card.data[,"educ"]
Z=card.data[,"nearc4"]
Xname=c("exper", "expersq", "black", "south", "smsa", "reg661", 
        "reg662", "reg663", "reg664", "reg665", "reg666", "reg667", 
		"reg668", "smsa66")
X=card.data[,Xname]
card.model1IV = ivmodelFormula(lwage ~ educ + exper + expersq + black + 
                                south + smsa + reg661 + 
                                reg662 + reg663 + reg664 + 
                                reg665 + reg666 + reg667 + 
                                reg668 + smsa66 | nearc4 + 
                                exper + expersq + black + 
                                south + smsa + reg661 + 
                                reg662 + reg663 + reg664 + 
                                reg665 + reg666 + reg667 + 
                                reg668 + smsa66,data=card.data)
card.model1IV

# Multiple instruments
Z = card.data[,c("nearc4","nearc2")]
card.model2IV = ivmodelFormula(lwage ~ educ + exper + expersq + black + 
                                south + smsa + reg661 + 
                                reg662 + reg663 + reg664 + 
                                reg665 + reg666 + reg667 + 
                                reg668 + smsa66 | nearc4 + nearc2 +
                                exper + expersq + black + 
                                south + smsa + reg661 + 
                                reg662 + reg663 + reg664 + 
                                reg665 + reg666 + reg667 + 
                                reg668 + smsa66,data=card.data)
card.model2IV
</code></pre>

<hr>
<h2 id='IVpower'>Power calculation for IV models
</h2><span id='topic+IVpower'></span>

<h3>Description</h3>

<p><code>IVpower</code> computes the power for one of the following tests: two stage least square estimates; Anderson-Rubin (1949) test; Sensitivity analysis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>IVpower(ivmodel, n = NULL, alpha = 0.05, beta = NULL, type = "TSLS", 
        deltarange = NULL, delta = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="IVpower_+3A_ivmodel">ivmodel</code></td>
<td>
<p><code>ivmodel</code> object.
</p>
</td></tr>
<tr><td><code id="IVpower_+3A_n">n</code></td>
<td>
<p>number of sample size, if missing, will use the sample size from the input <code>ivmodel</code> object.
</p>
</td></tr>
<tr><td><code id="IVpower_+3A_alpha">alpha</code></td>
<td>
<p>The significance level for hypothesis testing. Default is 0.05.
</p>
</td></tr>
<tr><td><code id="IVpower_+3A_beta">beta</code></td>
<td>
<p>True causal effect minus null hypothesis causal effect. If missing, will use the beta calculated from the input <code>ivmodel</code> object.
</p>
</td></tr>
<tr><td><code id="IVpower_+3A_type">type</code></td>
<td>
<p>Determines which test will be used for power calculation. &quot;TSLS&quot; for two stage least square estimates; &quot;AR&quot; for Anderson-Rubin test; &quot;ARsens&quot; for sensitivity analysis.
</p>
</td></tr>
<tr><td><code id="IVpower_+3A_deltarange">deltarange</code></td>
<td>
<p>Range of sensitivity allowance. A numeric vector of length 2. If missing, will use the deltarange from the input <code>ivmodel</code> object.
</p>
</td></tr>
<tr><td><code id="IVpower_+3A_delta">delta</code></td>
<td>
<p>True value of sensitivity parameter when calculating the power. Usually take delta = 0 for the favorable situation or delta = NULL for unknown delta.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>IVpower</code> computes the power for one of the following tests: two stage least square estimates; Anderson-Rubin (1949) test; Sensitivity analysis. The related value of parameters will be inferred from the input of <code>ivmodel</code> object.
</p>


<h3>Value</h3>

<p>a power value for the specified type of test.
</p>


<h3>Author(s)</h3>

<p>Yang Jiang, Hyunseung Kang, Dylan Small
</p>


<h3>References</h3>

<p>Freeman G, Cowling BJ, Schooling CM (2013). Power and Sample Size Calculations for Mendelian Randomization Studies Using One Genetic Instrument. International journal of epidemiology, 42(4), 1157-1163. <br />
Anderson, T.W. and Rubin, H. (1949).  Estimation of the parameters of a single equation in a complete system of stochastic equations.  Annals of Mathematical Statistics, 20, 46-63. <br />
ang, X., Jiang, Y., Small, D. and Zhang, N (2017), Sensitivity analysis and power for instrumental variable studies, (under review of Biometrics).
</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+ivmodel">ivmodel</a></code> for details on the instrumental variables model. See also <code><a href="#topic+TSLS.power">TSLS.power</a></code>, <code><a href="#topic+AR.power">AR.power</a></code>, <code><a href="#topic+ARsens.power">ARsens.power</a></code> for details on the power calculation.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(card.data)
Y=card.data[,"lwage"]
D=card.data[,"educ"]
Z=card.data[,"nearc4"]
Xname=c("exper", "expersq", "black", "south", "smsa", "reg661", 
        "reg662", "reg663", "reg664", "reg665", "reg666", "reg667", 
		"reg668", "smsa66")
X=card.data[,Xname]
card.model = ivmodel(Y=Y,D=D,Z=Z,X=X)

IVpower(card.model)
IVpower(card.model, n=10^4, type="AR")

</code></pre>

<hr>
<h2 id='IVsize'>Calculating minimum sample size for achieving a certain power
</h2><span id='topic+IVsize'></span>

<h3>Description</h3>

<p><code>IVsize</code> calculates the minimum sample size needed for achieving a certain power in one of the following tests: two stage least square estimates; Anderson-Rubin (1949) test; Sensitivity analysis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>IVsize(ivmodel, power, alpha = 0.05, beta = NULL, type = "TSLS", 
       deltarange = NULL, delta = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="IVsize_+3A_ivmodel">ivmodel</code></td>
<td>
<p><code>ivmodel</code> object.
</p>
</td></tr>
<tr><td><code id="IVsize_+3A_power">power</code></td>
<td>
<p>The power threshold to achieve.
</p>
</td></tr>
<tr><td><code id="IVsize_+3A_alpha">alpha</code></td>
<td>
<p>The significance level for hypothesis testing. Default is 0.05.
</p>
</td></tr>
<tr><td><code id="IVsize_+3A_beta">beta</code></td>
<td>
<p>True causal effect minus null hypothesis causal effect. If missing, will use the beta calculated from the input <code>ivmodel</code> object.
</p>
</td></tr>
<tr><td><code id="IVsize_+3A_type">type</code></td>
<td>
<p>Determines which test will be used for power calculation. &quot;TSLS&quot; for two stage least square estimates; &quot;AR&quot; for Anderson-Rubin test; &quot;ARsens&quot; for sensitivity analysis.
</p>
</td></tr>
<tr><td><code id="IVsize_+3A_deltarange">deltarange</code></td>
<td>
<p>Range of sensitivity allowance. A numeric vector of length 2. If missing, will use the deltarange from the input <code>ivmodel</code> object.
</p>
</td></tr>
<tr><td><code id="IVsize_+3A_delta">delta</code></td>
<td>
<p>True value of sensitivity parameter when calculating the power. Usually take delta = 0 for the favorable situation or delta = NULL for unknown delta.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>IVsize</code> calculates the minimum sample size needed for achieving a certain power for one of the following tests: two stage least square estimates; Anderson-Rubin (1949) test; Sensitivity analysis. The related value of parameters will be inferred from the input of <code>ivmodel</code> object.
</p>


<h3>Value</h3>

<p>minimum sample size needed for achieving a certain power
</p>


<h3>Author(s)</h3>

<p>Yang Jiang, Hyunseung Kang, Dylan Small
</p>


<h3>References</h3>

<p>Freeman G, Cowling BJ, Schooling CM (2013). Power and Sample Size Calculations for Mendelian Randomization Studies Using One Genetic Instrument. International journal of epidemiology, 42(4), 1157-1163. <br />
Anderson, T.W. and Rubin, H. (1949).  Estimation of the parameters of a single equation in a complete system of stochastic equations.  Annals of Mathematical Statistics, 20, 46-63. <br />
ang, X., Jiang, Y., Small, D. and Zhang, N (2017), Sensitivity analysis and power for instrumental variable studies, (under review of Biometrics).
</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+ivmodel">ivmodel</a></code> for details on the instrumental variables model. See also <code><a href="#topic+TSLS.size">TSLS.size</a></code>, <code><a href="#topic+AR.size">AR.size</a></code>, <code><a href="#topic+ARsens.size">ARsens.size</a></code> for calculation details.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(card.data)
Y=card.data[,"lwage"]
D=card.data[,"educ"]
Z=card.data[,"nearc4"]
Xname=c("exper", "expersq", "black", "south", "smsa", "reg661", 
        "reg662", "reg663", "reg664", "reg665", "reg666", "reg667", 
		"reg668", "smsa66")
X=card.data[,Xname]
card.model = ivmodel(Y=Y,D=D,Z=Z,X=X, deltarange=c(-0.01, 0.01))

IVsize(card.model, power=0.8)
IVsize(card.model, power=0.8, type="AR")
IVsize(card.model, power=0.8, type="ARsens", deltarange=c(-0.01, 0.01))

</code></pre>

<hr>
<h2 id='KClass'>k-Class Estimator</h2><span id='topic+KClass'></span>

<h3>Description</h3>

<p><code>KClass</code> computes the k-Class estimate for the <code>ivmodel</code> object.</p>


<h3>Usage</h3>

<pre><code class='language-R'>KClass(ivmodel,
       beta0 = 0, alpha = 0.05, k = c(0, 1),
       manyweakSE = FALSE, heteroSE = FALSE,clusterID = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="KClass_+3A_ivmodel">ivmodel</code></td>
<td>
<p><code>ivmodel</code> object.</p>
</td></tr>
<tr><td><code id="KClass_+3A_beta0">beta0</code></td>
<td>
<p>Null value <code class="reqn">\beta_0</code> for testing null hypothesis <code class="reqn">H_0: \beta = \beta_0</code> in <code>ivmodel</code>. Default is 0.</p>
</td></tr>
<tr><td><code id="KClass_+3A_alpha">alpha</code></td>
<td>
<p>The significance level for hypothesis testing. Default is 0.05.</p>
</td></tr>
<tr><td><code id="KClass_+3A_k">k</code></td>
<td>
<p>A vector of <code class="reqn">k</code> values for the k-Class estimator. Default
is 0 (OLS) and 1 (TSLS).</p>
</td></tr>
<tr><td><code id="KClass_+3A_manyweakse">manyweakSE</code></td>
<td>
<p>Should many weak instrument (and
heteroscedastic-robust) asymptotics in Hansen, Hausman and Newey
(2008) be used to compute standard errors? (Not supported for k=0)</p>
</td></tr>
<tr><td><code id="KClass_+3A_heterose">heteroSE</code></td>
<td>
<p>Should heteroscedastic-robust standard errors be used? Default is FALSE.</p>
</td></tr>
<tr><td><code id="KClass_+3A_clusterid">clusterID</code></td>
<td>
<p>If cluster-robust standard errors are desired, provide a vector of length that's identical to the sample size. For example, if n = 6 and clusterID = c(1,1,1,2,2,2), there would be two clusters where the first cluster is formed by the first three observations and the second cluster is formed by the last three observations. clusterID can be numeric, character, or factor.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>KClass</code> computes the k-Class estimate for the instrumental variables model in <code>ivmodel</code>, specifically for the parameter <code class="reqn">\beta</code>. It generates a point estimate, a standard error associated with the point estimate, a test statistic and a p value under the null hypothesis <code class="reqn">H_0: \beta = \beta_0</code> in <code>ivmodel</code> along with a <code class="reqn">1-\alpha</code> confidence interval.
</p>


<h3>Value</h3>

<p><code>KClass</code> returns a list containing the following components
</p>
<table>
<tr><td><code>k</code></td>
<td>
<p>A row matrix of k values supplied to <code>KClass</code>.</p>
</td></tr>
<tr><td><code>point.est</code></td>
<td>
<p>A row matrix of point estimates of <code class="reqn">\beta</code>, with each row corresponding to the k values supplied.</p>
</td></tr>
<tr><td><code>std.err</code></td>
<td>
<p>A row matrix of standard errors of the estimates, with each row corresponding to the k values supplied.</p>
</td></tr>
<tr><td><code>test.stat</code></td>
<td>
<p>A row matrix of test statistics for testing the null hypothesis <code class="reqn">H_0: \beta = \beta_0</code> in <code>ivmodel</code>, with each row corresponding to the k values supplied.</p>
</td></tr>
<tr><td><code>p.value</code></td>
<td>
<p>A row matrix of p value of the test under the null hypothesis <code class="reqn">H_0: \beta = \beta_0</code> in <code>ivmodel</code>, with each row corresponding to the k values supplied.</p>
</td></tr>
<tr><td><code>ci</code></td>
<td>
<p>A matrix of two columns specifying the confidence interval, with each row corresponding to the k values supplied.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Yang Jiang, Hyunseung Kang, and Dylan Small</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+ivmodel">ivmodel</a></code> for details on the instrumental variables model.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(card.data)
Y=card.data[,"lwage"]
D=card.data[,"educ"]
Z=card.data[,c("nearc4","nearc2")]
Xname=c("exper", "expersq", "black", "south", "smsa", "reg661",
        "reg662", "reg663", "reg664", "reg665", "reg666", "reg667",
		"reg668", "smsa66")
X=card.data[,Xname]
card.model2IV = ivmodel(Y=Y,D=D,Z=Z,X=X)
KClass(card.model2IV,
          k=c(0,1,0.5))

## Not run: 
## The following code tests the mank weak IV standard error for LIML and Fuller.
example &lt;- function(q = 10, rho1 = 0.5, n1 = 10000,
sigma.uv = 0.5, beta = 1, gamma = rep(1/sqrt(q), q)) {

    Sigma1 &lt;- outer(1:q, 1:q, function(i, j) rho1^abs(i - j))

    library(MASS)
    Z1 &lt;- mvrnorm(n1, rep(1, q), Sigma1)
    Z1 &lt;- matrix(2 * as.numeric(Z1 &gt; 0) - 1, nrow = n1)
    UV1 &lt;- mvrnorm(n1, rep(0, 2), matrix(c(1, sigma.uv, sigma.uv, 1), 2))
    X1 &lt;- Z1 
    Y1 &lt;- X1 

    list(Z1 = Z1, X1 = X1, Y1 = Y1)

}

one.sim &lt;- function(manyweakSE) {
    data &lt;- example(q = 100, n1 = 200)
    fit &lt;- ivmodel(data$Y1, data$X1, data$Z1, manyweakSE = manyweakSE)
    1 &gt; coef(fit)[, 2] - 1.96 * coef(fit)[, 3] &amp; 1 &lt; coef(fit)[, 2] + 1.96 * coef(fit)[, 3]
}

res &lt;- replicate(200, one.sim(TRUE))
apply(res, 1, mean)

res &lt;- replicate(200, one.sim(FALSE))
apply(res, 1, mean)

## End(Not run)

</code></pre>

<hr>
<h2 id='LIML'>Limited Information Maximum Likelihood Ratio (LIML) Estimator</h2><span id='topic+LIML'></span>

<h3>Description</h3>

<p><code>LIML</code> computes the LIML estimate for the <code>ivmodel</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>LIML(ivmodel,
     beta0 = 0, alpha = 0.05,
     manyweakSE = FALSE, heteroSE = FALSE,clusterID = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="LIML_+3A_ivmodel">ivmodel</code></td>
<td>
<p><code>ivmodel</code> object.</p>
</td></tr>
<tr><td><code id="LIML_+3A_beta0">beta0</code></td>
<td>
<p>Null value <code class="reqn">\beta_0</code> for testing null hypothesis <code class="reqn">H_0: \beta = \beta_0</code> in <code>ivmodel</code>. Default is 0.</p>
</td></tr>
<tr><td><code id="LIML_+3A_alpha">alpha</code></td>
<td>
<p>The significance level for hypothesis testing. Default is
0.05.</p>
</td></tr>
<tr><td><code id="LIML_+3A_manyweakse">manyweakSE</code></td>
<td>
<p>Should many weak instrument (and
heteroscedastic-robust) asymptotics in Hansen, Hausman and Newey
(2008) be used to compute standard errors?</p>
</td></tr>
<tr><td><code id="LIML_+3A_heterose">heteroSE</code></td>
<td>
<p>Should heteroscedastic-robust standard errors be used? Default is FALSE.</p>
</td></tr>
<tr><td><code id="LIML_+3A_clusterid">clusterID</code></td>
<td>
<p>If cluster-robust standard errors are desired, provide a vector of length that's identical to the sample size. For example, if n = 6 and clusterID = c(1,1,1,2,2,2), there would be two clusters where the first cluster is formed by the first three observations and the second cluster is formed by the last three observations. clusterID can be numeric, character, or factor.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>LIML</code> computes the LIML estimate for the instrumental variables model in <code>ivmodel</code>, specifically for the parameter <code class="reqn">beta</code>. The computation uses <code>KClass</code> with the value of <code class="reqn">k = k_{LIML}</code>, which is the smallest root of the equation
</p>
<p style="text-align: center;"><code class="reqn">det(L^T L - k L^T R_Z L) = 0</code>
</p>

<p>where <code class="reqn">L</code> is a matrix of two columns, the first column consisting of the outcome vector, <code class="reqn">Y</code>, and the second column consisting of the endogenous variable, <code class="reqn">D</code>, and <code class="reqn">R_Z = I - Z (Z^T Z)^{-1} Z^T</code> with <code class="reqn">Z</code> being the matrix of instruments. <code>LIML</code> generates a point estimate, a standard error associated with the point estimate, a test statistic and a p value under the null hypothesis <code class="reqn">H_0: \beta = \beta_0</code> in <code>ivmodel</code> along with a <code class="reqn">1-\alpha</code> confidence interval.
</p>


<h3>Value</h3>

<p><code>LIML</code> returns a list containing the following components
</p>
<table>
<tr><td><code>k</code></td>
<td>
<p>The k value for LIML.</p>
</td></tr>
<tr><td><code>point.est</code></td>
<td>
<p>Point estimate of <code class="reqn">\beta</code>.</p>
</td></tr>
<tr><td><code>std.err</code></td>
<td>
<p>Standard error of the estimate.</p>
</td></tr>
<tr><td><code>test.stat</code></td>
<td>
<p>The value of the test statistic for testing the null hypothesis <code class="reqn">H_0: \beta = \beta_0</code> in <code>ivmodel</code>.</p>
</td></tr>
<tr><td><code>p.value</code></td>
<td>
<p>The p value of the test under the null hypothesis <code class="reqn">H_0: \beta = \beta_0</code> in <code>ivmodel</code>.</p>
</td></tr>
<tr><td><code>ci</code></td>
<td>
<p>A matrix of one row by two columns specifying the confidence interval associated with the Fuller estimator.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Yang Jiang, Hyunseung Kang, Dylan Small</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+ivmodel">ivmodel</a></code> for details on the instrumental variables model. See also <code><a href="#topic+KClass">KClass</a></code> for more information about the k-Class estimator.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(card.data)
Y=card.data[,"lwage"]
D=card.data[,"educ"]
Z=card.data[,c("nearc4","nearc2")]
Xname=c("exper", "expersq", "black", "south", "smsa", "reg661",
        "reg662", "reg663", "reg664", "reg665", "reg666", "reg667",
		"reg668", "smsa66")
X=card.data[,Xname]
card.model2IV = ivmodel(Y=Y,D=D,Z=Z,X=X)
LIML(card.model2IV,alpha=0.01)
</code></pre>

<hr>
<h2 id='model.matrix.ivmodel'>Extract Design Matrix for <code>ivmodel</code> Object</h2><span id='topic+model.matrix.ivmodel'></span>

<h3>Description</h3>

<p>This method extracts the design matrix inside <code>ivmodel</code>.</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ivmodel'
model.matrix(object,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="model.matrix.ivmodel_+3A_object">object</code></td>
<td>
<p><code>ivmodel</code> object.</p>
</td></tr>
<tr><td><code id="model.matrix.ivmodel_+3A_...">...</code></td>
<td>
<p>Additional arguments to <code>fitted</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A design matrix for the <code>ivmodel</code> object.
</p>


<h3>Author(s)</h3>

<p>Yang Jiang, Hyunseung Kang, and Dylan Small</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+ivmodel">ivmodel</a></code> for details on the instrumental variables model.</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(card.data)
Y=card.data[,"lwage"]
D=card.data[,"educ"]
Z=card.data[,"nearc4"]
Xname=c("exper", "expersq", "black", "south", "smsa", "reg661", 
        "reg662", "reg663", "reg664", "reg665", "reg666", "reg667", 
		"reg668", "smsa66")
X=card.data[,Xname]
foo = ivmodel(Y=Y,D=D,Z=Z,X=X)
model.matrix(foo)
</code></pre>

<hr>
<h2 id='para'>Parameter Estimation from Ivmodel
</h2><span id='topic+para'></span>

<h3>Description</h3>

<p><code>para</code> computes the estimation of several parameters for the <code>ivmodel</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>para(ivmodel)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="para_+3A_ivmodel">ivmodel</code></td>
<td>
<p><code>ivmodel</code> object.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>para</code> computes the coefficients of 1st and 2nd stage regression (gamma and beta). It also computes the covariance matrix of the error term of 1st and 2nd stage. (sigmau, sigmav, and rho)
</p>


<h3>Value</h3>

<p><code>para</code> returns a list containing the following components
</p>
<table>
<tr><td><code>gamma</code></td>
<td>
<p>The coefficient of IV in first stage, calculated by linear regression</p>
</td></tr>
<tr><td><code>beta</code></td>
<td>
<p>The TSLS estimator of the exposure effect</p>
</td></tr>
<tr><td><code>sigmau</code></td>
<td>
<p>Standard deviation of potential outcome under control (structural error for y).</p>
</td></tr>
<tr><td><code>sigmav</code></td>
<td>
<p>Standard deviation of error from regressing treatment on instruments</p>
</td></tr>
<tr><td><code>rho</code></td>
<td>
<p>Correlation between u (potential outcome under control) and v (error from regressing treatment on instrument).</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Yang Jiang, Hyunseung Kang, Dylan Small
</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+ivmodel">ivmodel</a></code> for details on the instrumental variables model.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(card.data)
Y=card.data[,"lwage"]
D=card.data[,"educ"]
Z=card.data[,"nearc4"]
Xname=c("exper", "expersq", "black", "south", "smsa", "reg661", 
        "reg662", "reg663", "reg664", "reg665", "reg666", "reg667", 
		"reg668", "smsa66")
X=card.data[,Xname]
cardfit=ivmodel(Y=Y, D=D, Z=Z, X=X)
para(cardfit)
</code></pre>

<hr>
<h2 id='permTest.absBias'>Perform a permutation test using the sum of absolute biases</h2><span id='topic+permTest.absBias'></span>

<h3>Description</h3>

<p><code>permTest.absBias</code> performs a permutation test for complete randomization using the sum of absolute biases as a test statistic.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>permTest.absBias(X, D = NULL, Z = NULL,
assignment = "complete",
perms = 1000, subclass = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="permTest.absBias_+3A_x">X</code></td>
<td>
<p>Covariate matrix (with units as rows and covariates as columns).</p>
</td></tr>
<tr><td><code id="permTest.absBias_+3A_d">D</code></td>
<td>
<p>Indicator vector for a binary treatment (must contain 1 or 0 for each unit).</p>
</td></tr>
<tr><td><code id="permTest.absBias_+3A_z">Z</code></td>
<td>
<p>Indicator vector for a binary instrument (must contain 1 or 0 for each unit).</p>
</td></tr>
<tr><td><code id="permTest.absBias_+3A_assignment">assignment</code></td>
<td>
<p>Must be &quot;complete&quot;, &quot;block&quot;, or &quot;bernoulli&quot;. Designates whether to test for complete randomization, block randomization, or Bernoulli trials.</p>
</td></tr>
<tr><td><code id="permTest.absBias_+3A_subclass">subclass</code></td>
<td>
<p>Vector of subclasses (one for each unit). Subclasses can be numbers or characters, as long as there is one specified for each unit. Only needed if <code>assignment = "block"</code>.</p>
</td></tr>
<tr><td><code id="permTest.absBias_+3A_perms">perms</code></td>
<td>
<p>Number of permutations used to approximate the permutation test.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>p-value testing whether or not an indicator (treatment or instrument) is as-if randomized under complete randomization (i.e., random permutations), block randomization (i.e., random permutations within subclasses), or Bernoulli trials.
</p>


<h3>Author(s)</h3>

<p>Zach Branson and Luke Keele
</p>


<h3>References</h3>

<p>Branson, Z. and Keele, L. (2020). Evaluating a Key Instrumental Variable Assumption Using Randomization Tests. American Journal of Epidemiology. To appear.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>	#load the data
	data(icu.data)
	#the covariate matrix is
	X = as.matrix(subset(icu.data, select = -c(open_bin, icu_bed)))
	#the treatment
	D = icu.data$icu_bed
	#the instrument
	Z = icu.data$open_bin
	#the subclass
	subclass = icu.data$site
	
	#can uncomment the following code for examples
	
	#permutation test for complete randomization (for the treatment)
	#permTest.absBias(X = X, D = D,
	#assignment = "complete", perms = 500)
	#permutation test for complete randomization (for the instrument)
	#permTest.absBias(X = X, D = D, Z = Z,
	#assignment = "complete", perms = 500)
	#permutation test for block randomization (for the treatment)
	#permTest.absBias(X = X, D = D,
	#assignment = "block", subclass = subclass, perms = 500)
	#permutation test for block randomization (for the instrument)
	#permTest.absBias(X = X, D = D, Z = Z,
	#assignment = "block",
	#subclass = subclass, perms = 500)
	#permutation test for bernoulli trials (for the treatment)
	#permTest.absBias(X = X, D = D,
	#assignment = "bernoulli", perms = 500)
	#permutation test for bernoulli randomization (for the instrument)
	#permTest.absBias(X = X, D = D, Z = Z,
	#assignment = "bernoulli", perms = 500)
</code></pre>

<hr>
<h2 id='permTest.md'>Perform a permutation test using the Mahalanobis distance</h2><span id='topic+permTest.md'></span>

<h3>Description</h3>

<p><code>permTest.md</code> performs a permutation test for complete randomization using the Mahalanobis distance as a test statistic.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>permTest.md(X, indicator, assignment = "complete", perms = 1000, subclass = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="permTest.md_+3A_x">X</code></td>
<td>
<p>Covariate matrix (with units as rows and covariates as columns).</p>
</td></tr>
<tr><td><code id="permTest.md_+3A_indicator">indicator</code></td>
<td>
<p>Binary indicator vector (must contain 1 or 0 for each unit). For example, could be a binary treatment or instrument.</p>
</td></tr>
<tr><td><code id="permTest.md_+3A_assignment">assignment</code></td>
<td>
<p>Must be &quot;complete&quot;, &quot;block&quot;, or &quot;bernoulli&quot;. Designates whether to test for complete randomization, block randomization, or Bernoulli trials.</p>
</td></tr>
<tr><td><code id="permTest.md_+3A_subclass">subclass</code></td>
<td>
<p>Vector of subclasses (one for each unit). Subclasses can be numbers or characters, as long as there is one specified for each unit. Only needed if <code>assignment = "block"</code>.</p>
</td></tr>
<tr><td><code id="permTest.md_+3A_perms">perms</code></td>
<td>
<p>Number of permutations used to approximate the permutation test.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>p-value testing whether or not an indicator (treatment or instrument) is as-if randomized under complete randomization (i.e., random permutations), block randomization (i.e., random permutations within subclasses), or Bernoulli trials.
</p>


<h3>Author(s)</h3>

<p>Zach Branson and Luke Keele
</p>


<h3>References</h3>

<p>Branson, Z. and Keele, L. (2020). Evaluating a Key Instrumental Variable Assumption Using Randomization Tests. American Journal of Epidemiology. To appear.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>	#load the data
	data(icu.data)
	#the covariate matrix is
	X = as.matrix(subset(icu.data, select = -c(open_bin, icu_bed)))
	#the treatment
	D = icu.data$icu_bed
	#the instrument
	Z = icu.data$open_bin
	#the subclass
	subclass = icu.data$site
	
	#can uncomment the following code for examples

	#permutation test for complete randomization (for the treatment)
	#permTest.md(X = X, indicator = D,
	#assignment = "complete", perms = 500)
	#permutation test for complete randomization (for the instrument)
	#permTest.md(X = X, indicator = Z,
	#assignment = "complete", perms = 500)
	#permutation test for block randomization (for the treatment)
	#permTest.md(X = X, indicator = D,
	#assignment = "block", subclass = subclass, perms = 500)
	#permutation test for block randomization (for the instrument)
	#permTest.md(X = X, indicator = Z,
	#assignment = "block", subclass = subclass, perms = 500)
	#permutation test for bernoulli trials (for the treatment)
	#permTest.md(X = X, indicator = D,
	#assignment = "bernoulli", perms = 500)
	#permutation test for bernoulli randomization (for the instrument)
	#permTest.md(X = X, indicator = Z,
	#assignment = "bernoulli", perms = 500)
</code></pre>

<hr>
<h2 id='residuals.ivmodel'>Residuals from the Fitted Model in the <code>ivmodel</code> Object</h2><span id='topic+residuals.ivmodel'></span><span id='topic+resid.ivmodel'></span>

<h3>Description</h3>

<p>This function returns the residuals from the k-Class estimators inside the <code>ivmodel</code> object.</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ivmodel'
residuals(object,...)
## S3 method for class 'ivmodel'
resid(object,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="residuals.ivmodel_+3A_object">object</code></td>
<td>
<p><code>ivmodel</code> object.</p>
</td></tr>
<tr><td><code id="residuals.ivmodel_+3A_...">...</code></td>
<td>
<p>Additional arguments to <code>residuals</code> or <code>resid</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix of residuals for each k-Class estimator. Specifically, each column of the matrix represents residuals for each individual based on different estimates of the treatment effect from k-Class estimators. By default, one of the columns of the matrix is the residuals when the treatment effect is estimated by ordinarly least squares (OLS). Because OLS is generally biased in instrumental variables settings, the residuals will likely be biased.
</p>


<h3>Author(s)</h3>

<p>Yang Jiang, Hyunseung Kang, and Dylan Small</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+ivmodel">ivmodel</a></code> for details on the instrumental variables model.</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(card.data)
Y=card.data[,"lwage"]
D=card.data[,"educ"]
Z=card.data[,"nearc4"]
Xname=c("exper", "expersq", "black", "south", "smsa", "reg661", 
        "reg662", "reg663", "reg664", "reg665", "reg666", "reg667", 
		"reg668", "smsa66")
X=card.data[,Xname]
foo = ivmodel(Y=Y,D=D,Z=Z,X=X)
resid(foo)
residuals(foo)
</code></pre>

<hr>
<h2 id='TSLS.power'>Power of TSLS Estimator
</h2><span id='topic+TSLS.power'></span>

<h3>Description</h3>

<p><code>TSLS.power</code> computes the power of the asymptotic t-test of TSLS estimator.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>TSLS.power(n, beta, rho_ZD, sigmau, sigmaDsq, alpha = 0.05)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="TSLS.power_+3A_n">n</code></td>
<td>
<p>Sample size.
</p>
</td></tr>
<tr><td><code id="TSLS.power_+3A_beta">beta</code></td>
<td>
<p>True causal effect minus null hypothesis causal effect.
</p>
</td></tr>
<tr><td><code id="TSLS.power_+3A_rho_zd">rho_ZD</code></td>
<td>
<p>Correlation between the IV Z and the exposure D.
</p>
</td></tr>
<tr><td><code id="TSLS.power_+3A_sigmau">sigmau</code></td>
<td>
<p>Standard deviation of potential outcome under control. (structural error for y)
</p>
</td></tr>
<tr><td><code id="TSLS.power_+3A_sigmadsq">sigmaDsq</code></td>
<td>
<p>The variance of the exposure D.
</p>
</td></tr>
<tr><td><code id="TSLS.power_+3A_alpha">alpha</code></td>
<td>
<p>Significance level.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The power formula is given in Freeman (2013). 
</p>


<h3>Value</h3>

<p>Power of the asymptotic t-test of TSLS estimator basd on given values of parameters.
</p>


<h3>Author(s)</h3>

<p>Yang Jiang, Hyunseung Kang, and Dylan Small
</p>


<h3>References</h3>

<p>Freeman G, Cowling BJ, Schooling CM (2013). Power and Sample Size Calculations for Mendelian Randomization Studies Using One Genetic Instrument. International journal of epidemiology, 42(4), 1157-1163.
</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+ivmodel">ivmodel</a></code> for details on the instrumental variables model.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Assume we calculate the power of asymptotic t-test of TSLS estimator
# in a study with one IV (l=1) and the only one exogenous variable is 
# the intercept (k=1). 

# Suppose the difference between the null hypothesis and true causal
# effect is 1 (beta=1).
# The sample size is 250 (n=250). 
# The correlation between the IV and exposure is .5 (rho_ZD= .5).
# The standard deviation of potential outcome is 1(sigmau= 1). 
# The variance of the exposure is 1 (sigmaDsq=1).
# The significance level for the study is alpha = .05.

# power of asymptotic t-test of TSLS estimator
TSLS.power(n=250, beta=1, rho_ZD=.5, sigmau=1, sigmaDsq=1, alpha = 0.05)
</code></pre>

<hr>
<h2 id='TSLS.size'>Sample Size Calculator for the Power of Asymptotic T-test
</h2><span id='topic+TSLS.size'></span>

<h3>Description</h3>

<p><code>TSLS.size</code> computes the minimum sample size required for achieving certain power of asymptotic t-test of TSLS estimator.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>TSLS.size(power, beta, rho_ZD, sigmau, sigmaDsq, alpha = 0.05)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="TSLS.size_+3A_power">power</code></td>
<td>
<p>The desired power over a constant.
</p>
</td></tr>
<tr><td><code id="TSLS.size_+3A_beta">beta</code></td>
<td>
<p>True causal effect minus null hypothesis causal effect.
</p>
</td></tr>
<tr><td><code id="TSLS.size_+3A_rho_zd">rho_ZD</code></td>
<td>
<p>Correlation between the IV Z and the exposure D.
</p>
</td></tr>
<tr><td><code id="TSLS.size_+3A_sigmau">sigmau</code></td>
<td>
<p>Standard deviation of potential outcome under control. (structural error for y)
</p>
</td></tr>
<tr><td><code id="TSLS.size_+3A_sigmadsq">sigmaDsq</code></td>
<td>
<p>The variance of the exposure D.
</p>
</td></tr>
<tr><td><code id="TSLS.size_+3A_alpha">alpha</code></td>
<td>
<p>Significance level.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The calculation is based on inverting the power formula given in Freeman (2013). 
</p>


<h3>Value</h3>

<p>Minimum sample size required for achieving certain power of asymptotic t-test of TSLS estimator.
</p>


<h3>Author(s)</h3>

<p>Yang Jiang, Hyunseung Kang, and Dylan Small
</p>


<h3>References</h3>

<p>Freeman G, Cowling BJ, Schooling CM (2013). Power and Sample Size Calculations for Mendelian Randomization Studies Using One Genetic Instrument. International journal of epidemiology, 42(4), 1157-1163.
</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+ivmodel">ivmodel</a></code> for details on the instrumental variables model.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Assume we performed an asymptotic t-test of TSLS estimator in a study 
# with one IV (l=1) and the only one exogenous variable is the intercept 
# (k=1). We want to calculate the minimum sample size needed for this 
# test to have an at least 0.8 power.

# Suppose the null hypothesis causal effect is 0 and the true causal 
# effect is 1 (beta=1-0=1).
# The correlation between the IV and exposure is .5 (rho_ZD= .5).
# The standard deviation of potential outcome is 1(sigmau= 1). 
# The variance of the exposure is 1 (sigmaDsq=1).
# The significance level for the study is alpha = .05.

### minimum sample size required for aysmptotic t-test
TSLS.size(power=.8, beta=1, rho_ZD=.5, sigmau=1, sigmaDsq=1, alpha =.05)
</code></pre>

<hr>
<h2 id='vcov.ivmodel'>Calculate Variance-Covariance Matrix (i.e. Standard Error) for k-Class Estimators in the <code>ivmodel</code> Object</h2><span id='topic+vcov.ivmodel'></span>

<h3>Description</h3>

<p>This <code>vcov</code> method returns the variance-covariance matrix for all specified k-Class estimation from an <code>ivmodel</code> object.</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ivmodel'
vcov(object,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vcov.ivmodel_+3A_object">object</code></td>
<td>
<p><code>ivmodel</code> object.</p>
</td></tr>
<tr><td><code id="vcov.ivmodel_+3A_...">...</code></td>
<td>
<p>Additional arguments to <code>vcov</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix of standard error estimates for each k-Class estimator.
</p>


<h3>Author(s)</h3>

<p>Yang Jiang, Hyunseung Kang, and Dylan Small</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+ivmodel">ivmodel</a></code> for details on the instrumental variables model.</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(card.data)
Y=card.data[,"lwage"]
D=card.data[,"educ"]
Z=card.data[,"nearc4"]
Xname=c("exper", "expersq", "black", "south", "smsa", "reg661", 
        "reg662", "reg663", "reg664", "reg665", "reg666", "reg667", 
		"reg668", "smsa66")
X=card.data[,Xname]
foo = ivmodel(Y=Y,D=D,Z=Z,X=X)
vcov(foo)
</code></pre>

<hr>
<h2 id='vcovOther'>Variance of Exogenous Coefficients of the Fitted Model in the <code>ivmodel</code> Object</h2><span id='topic+vcovOther'></span>

<h3>Description</h3>

<p>This <code>vcovOther</code> returns the estimated variances of the estimated coefficients for the exogenous covariates associated with the outcome. All the estimation is based on k-Class estimators.</p>


<h3>Usage</h3>

<pre><code class='language-R'>  vcovOther(ivmodel)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vcovOther_+3A_ivmodel">ivmodel</code></td>
<td>
<p><code>ivmodel</code> object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix where each row represents a k-class estimator and each column represents one of the exogenous covariates. Each element is the estimated variance of the estimated coefficients.
</p>


<h3>Author(s)</h3>

<p>Hyunseung Kang</p>


<h3>See Also</h3>

<p>See also <code><a href="#topic+ivmodel">ivmodel</a></code> for details on the instrumental variables model.</p>


<h3>Examples</h3>

<pre><code class='language-R'>  data(card.data)
  Y=card.data[,"lwage"]
  D=card.data[,"educ"]
  Z=card.data[,"nearc4"]
  Xname=c("exper", "expersq", "black", "south", "smsa", "reg661", 
          "reg662", "reg663", "reg664", "reg665", "reg666", "reg667", 
          "reg668", "smsa66")
  X=card.data[,Xname]
  foo = ivmodel(Y=Y,D=D,Z=Z,X=X)
  vcovOther(foo)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
