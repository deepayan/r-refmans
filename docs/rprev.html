<!DOCTYPE html><html><head><title>Help for package rprev</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {rprev}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#counted_prevalence'><p>Count prevalence from registry data.</p></a></li>
<li><a href='#draw_incident_population'><p>Simulates an incident population according to a specific incidence model</p></a></li>
<li><a href='#extract_covars'><p>Returns the name of the covariates in the registry data set that are required by</p>
the survival model.</a></li>
<li><a href='#fixed_cure'><p>Builds survival models for diseases with cured fractions using population mortality tables</p></a></li>
<li><a href='#plot.incdiag'><p>Visualise disease incidence.</p></a></li>
<li><a href='#plot.survfit.prev'><p>Plot bootstrapped survival curves.</p></a></li>
<li><a href='#predict_survival_probability'><p>Predicts survival probability for given individuals at specific times.</p></a></li>
<li><a href='#prevalence'><p>Estimate point prevalence at an index date.</p></a></li>
<li><a href='#prevsim'><p>Simulated patient dataset.</p></a></li>
<li><a href='#rprev'><p>rprev: Estimate disease point prevalence using a combination of registry data and</p>
Monte Carlo simulations.</a></li>
<li><a href='#sim_prevalence'><p>Estimate prevalence using Monte Carlo simulation.</p></a></li>
<li><a href='#summary.survfit.prev'><p>Obtain N-year survival probability estimates.</p></a></li>
<li><a href='#survfit.prevalence'><p>Form bootstrapped survival curves.</p></a></li>
<li><a href='#test_homogeneity'><p>Inspects disease incidence for its compatibility with a homogeneous Poisson process.</p></a></li>
<li><a href='#test_prevalence_fit'><p>Test simulated prevalence fit.</p></a></li>
<li><a href='#UKmortality'><p>General population survival data.</p></a></li>
<li><a href='#validate_incidence_model'><p>Tests custom incidence models</p></a></li>
<li><a href='#validate_survival_model'><p>Tests that a custom survival object has the required attributes</p>
for use in the <code>prevalence</code> function.</a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Estimating Disease Prevalence from Registry Data</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.5</td>
</tr>
<tr>
<td>Date:</td>
<td>2021-04-30</td>
</tr>
<tr>
<td>Description:</td>
<td>Estimates disease prevalence for a given index date using existing
    registry data extended with Monte Carlo simulations following the method of Crouch et al (2014) &lt;<a href="https://doi.org/10.1016%2Fj.canep.2014.02.005">doi:10.1016/j.canep.2014.02.005</a>&gt;.</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10), survival</td>
</tr>
<tr>
<td>Imports:</td>
<td>data.table, dplyr, ggplot2, lazyeval, lubridate, magrittr,
tidyr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>Suggests:</td>
<td>flexsurv, flexsurvcure, knitr, rmarkdown, rms, testthat, covr</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/stulacy/rprev-dev">https://github.com/stulacy/rprev-dev</a></td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-05-04 08:56:43 UTC; stuart</td>
</tr>
<tr>
<td>Author:</td>
<td>Stuart Lacy [cre, aut],
  Simon Crouch [aut],
  Stephanie Lax [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Stuart Lacy &lt;stuart.lacy@york.ac.uk&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-05-04 16:40:03 UTC</td>
</tr>
</table>
<hr>
<h2 id='counted_prevalence'>Count prevalence from registry data.</h2><span id='topic+counted_prevalence'></span>

<h3>Description</h3>

<p>Counts contribution to prevalence at a specific index from each year of a
registry. A person is included as contributing to disease prevalence if they
are incident within the specified time-span, and are either alive or censored
at the index date. The rationale for including censored cases in prevalence
estimation is that such cases have typically been lost to follow-up, and are
often more likely to have been alive at the index date than not.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>counted_prevalence(formula, index, data, start_date, status_col)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="counted_prevalence_+3A_formula">formula</code></td>
<td>
<p>A formula of the form &lt;event date column&gt; ~ &lt;entry date column&gt;.</p>
</td></tr>
<tr><td><code id="counted_prevalence_+3A_index">index</code></td>
<td>
<p>The date at which to estimate point prevalence as a string in the format
YYYY-MM-DD.</p>
</td></tr>
<tr><td><code id="counted_prevalence_+3A_data">data</code></td>
<td>
<p>A data frame with the corresponding column names provided in
<code>form</code>.</p>
</td></tr>
<tr><td><code id="counted_prevalence_+3A_start_date">start_date</code></td>
<td>
<p>The initial date to start counting prevalence from as a <code>Date</code> object.
Typically the index date - (Nyears * 365.25). Allows for non-whole year prevalence estimations.</p>
</td></tr>
<tr><td><code id="counted_prevalence_+3A_status_col">status_col</code></td>
<td>
<p>The name of the column holding a binary indicator variable
of whether the individual experienced an event at their event time or was
censored.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The number of prevalent cases at the specified
index date as a single integer.
</p>

<hr>
<h2 id='draw_incident_population'>Simulates an incident population according to a specific incidence model</h2><span id='topic+draw_incident_population'></span>

<h3>Description</h3>

<p>This method defines the main behaviour of an incidence model and must be
implemented for any class to be used in <code>prevalence</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>draw_incident_population(object, data, timeframe, covars)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="draw_incident_population_+3A_object">object</code></td>
<td>
<p>The incidence model.</p>
</td></tr>
<tr><td><code id="draw_incident_population_+3A_data">data</code></td>
<td>
<p>The original registry data frame passed into <code>prevalence</code>. It
is supplied in this method so that individual level attributes can be
sampled from the prior distribution.</p>
</td></tr>
<tr><td><code id="draw_incident_population_+3A_timeframe">timeframe</code></td>
<td>
<p>The amount of time in days in which to simulate incidence
for.</p>
</td></tr>
<tr><td><code id="draw_incident_population_+3A_covars">covars</code></td>
<td>
<p>Any patient level covariates that must be included in the
new simulated incident population, as a character vector. These will 
correspond to columns in <code>data</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame where each row corresponds to a simulate incident
patient. The first column must be incidence time (in days). This
will be relative to an unspecified baseline. All covariates specified
in <code>covars</code> must be present in this data frame.
</p>

<hr>
<h2 id='extract_covars'>Returns the name of the covariates in the registry data set that are required by
the survival model.</h2><span id='topic+extract_covars'></span>

<h3>Description</h3>

<p>Used in <code>prevalence</code> to determine which covariates should be sampled when 
simulating an incident population. This should provide a character vector containing
column names of the original registry data set input to <code>prevalence</code> that
are used by the survival model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_covars(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract_covars_+3A_object">object</code></td>
<td>
<p>The survival object itself</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A character vector holding the column names. Can be NULL if no 
covariates are used i.e. the survival model is built based on population 
level data rather than individual level data.
</p>

<hr>
<h2 id='fixed_cure'>Builds survival models for diseases with cured fractions using population mortality tables</h2><span id='topic+fixed_cure'></span>

<h3>Description</h3>

<p>Fits a cure model which assumes that if an individual has survived
beyond a set time-point then they are considered cured and their mortality reverts
to population levels.
Please read the detailed description below for how to use this model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fixed_cure(
  formula = NULL,
  data = NULL,
  cure_time = 10 * 365.25,
  daily_survival = NULL,
  population_covariates = NULL,
  dist = c("exponential", "weibull", "lognormal")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fixed_cure_+3A_formula">formula</code></td>
<td>
<p>Formula specifying survival function, as used in
<code><a href="#topic+prevalence">prevalence</a></code> with the <code>surv_formula</code> argument.
<strong>Must be in days</strong>.</p>
</td></tr>
<tr><td><code id="fixed_cure_+3A_data">data</code></td>
<td>
<p>A data frame with the corresponding column names provided in
<code>form</code>.</p>
</td></tr>
<tr><td><code id="fixed_cure_+3A_cure_time">cure_time</code></td>
<td>
<p>Time-limit at which a patient is considered cured. Note that if this is 0 or negative then
survival will be based purely off the population rates (anything passed into <code>formula</code> and <code>data</code> will
be ignored).</p>
</td></tr>
<tr><td><code id="fixed_cure_+3A_daily_survival">daily_survival</code></td>
<td>
<p>A data frame comprising population survival as a daily probability for as long as possible,
ideally 100 years (36525 days).
Defaults to using UK population survival from the <code>UKmortality</code> data set.
It <strong>must contain columns 'age' and 'surv'</strong>, providing the age (in days) and survival
probability at that age respectively.
It can also be stratified by other variables that are found in the survival <code>formula</code> for this model,
such as sex.</p>
</td></tr>
<tr><td><code id="fixed_cure_+3A_population_covariates">population_covariates</code></td>
<td>
<p>A character vector containing fields to stratify population survival by in addition to
age, as descripted in <code>Details</code> below. These <strong>must</strong> be the names of columns in both <code>data</code> and
<code>daily_survival</code>. If not provided then defaults to the fields that are present in both <code>data</code> and
<code>daily_survival</code>.</p>
</td></tr>
<tr><td><code id="fixed_cure_+3A_dist">dist</code></td>
<td>
<p>The distribution used by the default parametric survival model.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>To model population survival, population mortality tables are required, as specified by the <code>daily_survival</code>
argument. If not provided, then the default population mortality is that of the UK population, which goes up
to 100 years of age. If a simulated individual has expected lifespan longer than the maximum age in the mortality table
then they are estimated to have died at this age limit,
which is why it is advantageous to provide as many accurate survival probabilities as possible.
</p>
<p>Due to the linking with the registry data and the ability for user-specified mortality tables, there are stricter
requirements on the survival models used in cure models than elsewhere. For example, the time-scale of the
survival model specified in <code>formula</code> <strong>must be in days</strong> so that it matches up with the mortality tables.
Likewise, <strong>age in years must be included as a covariate</strong> in the survival model
</p>


<h3>Value</h3>

<p>An object of class <code>fixedcure</code> that can be passed
into <code><a href="#topic+prevalence">prevalence</a></code>.
</p>

<hr>
<h2 id='plot.incdiag'>Visualise disease incidence.</h2><span id='topic+plot.incdiag'></span>

<h3>Description</h3>

<p>Plots a comparison between the smoothed daily incidence function and actual
incidence.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'incdiag'
plot(x, level = 0.95, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.incdiag_+3A_x">x</code></td>
<td>
<p>An <code>incidence</code> object.</p>
</td></tr>
<tr><td><code id="plot.incdiag_+3A_level">level</code></td>
<td>
<p>The desired confidence interval width.</p>
</td></tr>
<tr><td><code id="plot.incdiag_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code>plot</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function generates a plot from the cumulative incidence object. The
incidence rate per year of the registry is shown in red. Mean incidence rate
is shown as a solid blue line, with the confidence interval shown in dashed
blue lines. The smooth fitted to the cumulative incidence data is shown in
green.
</p>


<h3>Value</h3>

<p>An object of class <code>ggplot</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(prevsim)

## Not run: 
inc &lt;- test_homogeneity(prevsim$entrydate, population_size=1e6,
                        start = "2004-01-30", num_reg_years = 9)

plot(inc)

## End(Not run)

</code></pre>

<hr>
<h2 id='plot.survfit.prev'>Plot bootstrapped survival curves.</h2><span id='topic+plot.survfit.prev'></span>

<h3>Description</h3>

<p>This method plots survival curves for a <code>survfit.prev</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'survfit.prev'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.survfit.prev_+3A_x">x</code></td>
<td>
<p>A <code>survfit.prev</code> object.</p>
</td></tr>
<tr><td><code id="plot.survfit.prev_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code>plot</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The survival curve for a model formed on all the data is displayed in orange,
while the 95
as a grey ribbon.
</p>


<h3>Value</h3>

<p>An S3 object of class <code>ggplot</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(prevsim)

## Not run: 
prev_obj &lt;- prevalence(Surv(time, status) ~ age(age) + sex(sex) +
                       entry(entrydate) + event(eventdate),
                       data=prevsim, num_years_to_estimate = c(5, 10),
                       population_size=1e6, start = "2005-09-01",
                       num_reg_years = 8, cure = 5)

survobj &lt;- survfit(prev_obj, newdata=list(age=65, sex=0))

plot(survobj)

## End(Not run)

</code></pre>

<hr>
<h2 id='predict_survival_probability'>Predicts survival probability for given individuals at specific times.</h2><span id='topic+predict_survival_probability'></span>

<h3>Description</h3>

<p>This generic method is required for any survival object used in the main
<code>prevalence</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predict_survival_probability(object, newdata, times)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict_survival_probability_+3A_object">object</code></td>
<td>
<p>The survival object itself</p>
</td></tr>
<tr><td><code id="predict_survival_probability_+3A_newdata">newdata</code></td>
<td>
<p>Simulated incident individuals, with the same attributes specified in
<code>extract_covars</code> and found in the supplied registry data to <code>prevalence</code>.</p>
</td></tr>
<tr><td><code id="predict_survival_probability_+3A_times">times</code></td>
<td>
<p>The time at which to estimate the survival probability of the individual
in the corresponding row of <code>newdata</code>. Must have as many times as <code>newdata</code>
has rows.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector with the same length as <code>times</code> providing the survival probability
estimates.
</p>

<hr>
<h2 id='prevalence'>Estimate point prevalence at an index date.</h2><span id='topic+prevalence'></span>

<h3>Description</h3>

<p>Point prevalence at a specific index date is estimated using contributions to
prevalence from both available registry data, and from Monte Carlo
simulations of the incidence and survival process, as outlined by Crouch et
al (2004) (see References).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prevalence(
  index,
  num_years_to_estimate,
  data,
  inc_formula = NULL,
  inc_model = NULL,
  surv_formula = NULL,
  surv_model = NULL,
  registry_start_date = NULL,
  death_column = NULL,
  incident_column = NULL,
  age_column = "age",
  age_dead = 100,
  status_column = "status",
  N_boot = 1000,
  population_size = NULL,
  proportion = 1e+05,
  level = 0.95,
  dist = c("exponential", "weibull", "lognormal"),
  precision = 2
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="prevalence_+3A_index">index</code></td>
<td>
<p>The date at which to estimate point prevalence as a string in the format
YYYY-MM-DD.</p>
</td></tr>
<tr><td><code id="prevalence_+3A_num_years_to_estimate">num_years_to_estimate</code></td>
<td>
<p>Number of years of data to consider when
estimating point prevalence; multiple values can be specified in a vector.
If any values are greater than the number of years of registry data
available before <code>index_date</code>, incident cases
for the difference will be simulated.</p>
</td></tr>
<tr><td><code id="prevalence_+3A_data">data</code></td>
<td>
<p>A data frame with the corresponding column names provided in
<code>form</code>.</p>
</td></tr>
<tr><td><code id="prevalence_+3A_inc_formula">inc_formula</code></td>
<td>
<p>A formula specifying the columns used in the incidence process.
The LHS should be the name of the column holding the incident dates,
with the RHS specifying any variables that should be stratified by, or 1 if no
stratification. For example, with the supplied <code>prevsim</code> data set, it could
be used as follows:
</p>
<p><code>entrydate ~ 1</code> for a non-stratified process.
<code>entrydate ~ sex</code> for a process that will stratify incidence by sex.</p>
</td></tr>
<tr><td><code id="prevalence_+3A_inc_model">inc_model</code></td>
<td>
<p>An object that has a <code>draw_incident_population</code>
method. See the vignette for further guidance.</p>
</td></tr>
<tr><td><code id="prevalence_+3A_surv_formula">surv_formula</code></td>
<td>
<p>A formula used to specify a survival model, where the
LHS a Surv object, as used by <code>flexsurvreg</code>.</p>
</td></tr>
<tr><td><code id="prevalence_+3A_surv_model">surv_model</code></td>
<td>
<p>An object that has a <code>predict_survival_probability</code>
method. See the vignette for further guidance.</p>
</td></tr>
<tr><td><code id="prevalence_+3A_registry_start_date">registry_start_date</code></td>
<td>
<p>The starting date of the registry. If not supplied
then defaults to the earliest incidence date in the supplied data set.</p>
</td></tr>
<tr><td><code id="prevalence_+3A_death_column">death_column</code></td>
<td>
<p>A string providing the name of the column which holds the death
date information. If not provided then prevalence cannot be counted and estimates
will be solely derived from simulation.</p>
</td></tr>
<tr><td><code id="prevalence_+3A_incident_column">incident_column</code></td>
<td>
<p>A string providing the name of the column which holds the diagnosis
date. If not provided either in this argument or in <code>inc_formula</code>,
then prevalence cannot be counted and estimates will be solely derived from simulation.</p>
</td></tr>
<tr><td><code id="prevalence_+3A_age_column">age_column</code></td>
<td>
<p>A string providing the name of the column that holds patient age. If provided
then patients alive at <code>age_dead</code> are set to die. This helps combat 'immortal' patients.</p>
</td></tr>
<tr><td><code id="prevalence_+3A_age_dead">age_dead</code></td>
<td>
<p>The age at which patients are set to be dead if they are still alive, to prevent
'immortal' patients. Used in conjunction with <code>age_column</code>.</p>
</td></tr>
<tr><td><code id="prevalence_+3A_status_column">status_column</code></td>
<td>
<p>A string providing the name of the column that holds patient event status at
the event time. If not provided in <code>surv_formula</code> or in this argument then prevalence
cannot be counted.</p>
</td></tr>
<tr><td><code id="prevalence_+3A_n_boot">N_boot</code></td>
<td>
<p>Number of bootstrapped calculations to perform.</p>
</td></tr>
<tr><td><code id="prevalence_+3A_population_size">population_size</code></td>
<td>
<p>Integer corresponding to the size of the population at
risk.</p>
</td></tr>
<tr><td><code id="prevalence_+3A_proportion">proportion</code></td>
<td>
<p>The population ratio to estimate prevalence for.</p>
</td></tr>
<tr><td><code id="prevalence_+3A_level">level</code></td>
<td>
<p>Double representing the desired confidence interval width.</p>
</td></tr>
<tr><td><code id="prevalence_+3A_dist">dist</code></td>
<td>
<p>The distribution used by the default parametric survival model.</p>
</td></tr>
<tr><td><code id="prevalence_+3A_precision">precision</code></td>
<td>
<p>Integer representing the number of decimal places required.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The most important parameter is <code>num_years_to_estimate</code>, which governs
the number of previous years of data to use when estimating the prevalence at
the index date. If this parameter is greater than the number of years of
known incident cases available in the supplied registry data (specified with
argument <code>num_registry_years</code>), then the remaining
<code>num_years_to_estimate - num_registry_years</code> years of incident data will
be simulated using Monte Carlo simulation.
</p>
<p>The larger <code>num_years_to_estimate</code>, the more accurate the prevalence
estimate will be, provided an adequate survival model can be fitted to the
registry data. It is therefore important to provide as much clean registry
data as possible.
</p>
<p>Prevalence arises from two stochastic processes: incidence and survival.
This is reflected in the function arguments by multiple options for
each of these processes.
</p>
<p>The incidence process is specified by an object
that has an associated <code>draw_incident_population</code> method, which produces the new
incident population. The default implementation is a homogeneous Poisson process,
whereby interarrival times are distributed according to an exponential distribution.
The <code>inc_formula</code> argument specifies the nature of this process, see the
description for more details. See the vignette for guidance on providing a custom incidence
object.
</p>
<p>The survival process is characterised by a method <code>predict_survival_probability</code>,
that estimates the probability of a given individual being alive at the index date.
The default object is a parametric distribution with the functional form being specified
in <code>surv_formula</code> and distribution given in <code>dist</code>. See the vignette for guidance
on providing a custom survival model.
</p>


<h3>Value</h3>

<p>A <code>prevalence</code> object containing the following attributes:
</p>
<table>
<tr><td><code>estimates</code></td>
<td>
<p>Prevalence estimates at the specified years as both absolute and rates.</p>
</td></tr>
<tr><td><code>simulated</code></td>
<td>
<p>A <code>data.table</code> containing simulated incident cases from each bootstrap iteration
Each row corresponds to a simulated incident case with their simulated attributes and survival status.
Binary flags are provided beginning <code>prev_</code>, which indicate whether that person contributed
to the prevalence for the specified time-period. The <code>prev_registry</code> flag indicates whether that
person was incident during the registry time-span and alive at the index. These cases are used to
assess the model fit, as the numbers can be simply compared to the known registry prevalence.</p>
</td></tr>
<tr><td><code>counted</code></td>
<td>
<p>The number of incident cases present in the registry data set.</p>
</td></tr>
<tr><td><code>full_surv_model</code></td>
<td>
<p>The survival model built on the complete registry data set.</p>
</td></tr>
<tr><td><code>full_inc_model</code></td>
<td>
<p>The incidence model built on the complete registry data set.</p>
</td></tr>
<tr><td><code>surv_models</code></td>
<td>
<p>A list of the survival models fitted to each bootstrap iteration.</p>
</td></tr>
<tr><td><code>inc_models</code></td>
<td>
<p>A list of the incidence models fitted to each bootstrap iteration.</p>
</td></tr>
<tr><td><code>index_date</code></td>
<td>
<p>The index date.</p>
</td></tr>
<tr><td><code>est_years</code></td>
<td>
<p>The years at which prevalence is estimated at.</p>
</td></tr>
<tr><td><code>counted_incidence_rate</code></td>
<td>
<p>The overall incidence rate in the registry data set.</p>
</td></tr>
<tr><td><code>registry_start</code></td>
<td>
<p>The date the registry was identified at starting at.</p>
</td></tr>
<tr><td><code>proportion</code></td>
<td>
<p>The denominator to use for estimating prevalence rates.</p>
</td></tr>
<tr><td><code>status_col</code></td>
<td>
<p>The column in the registry data containing the survival status.</p>
</td></tr>
<tr><td><code>N_boot</code></td>
<td>
<p>The number of bootstrap iterations that were run.</p>
</td></tr>
<tr><td><code>means</code></td>
<td>
<p>Covariate means, used when plotting Kaplan-Meier estimators using <code>survfit</code>.</p>
</td></tr>
<tr><td><code>max_event_time</code></td>
<td>
<p>The maximum time-to-event in the registry data. Again, used in
<code>survfit</code> to scale the time-axis.</p>
</td></tr>
<tr><td><code>pval</code></td>
<td>
<p>The p-value resulting from a hypothesis test on the difference between the
simulated and counted prevalence on the time-span covered by the registry. Tests the
prevalence fit; if a significant result is found then further diagnostics are required.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Crouch, Simon, et al. &quot;Determining disease prevalence from
incidence and survival using simulation techniques.&quot; Cancer epidemiology
38.2 (2014): 193-199.
</p>


<h3>See Also</h3>

<p>Other prevalence functions: 
<code><a href="#topic+test_prevalence_fit">test_prevalence_fit</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(prevsim)

## Not run: 
data(prevsim)

prevalence(index='2013-01-30',
           num_years_to_estimate=c(3, 5, 10, 20),
           data=prevsim,
           inc_formula = entrydate ~ sex,
           surv_formula = Surv(time, status) ~ age + sex,
           dist='weibull',
           population_size = 1e6,
           death_column = 'eventdate')

## End(Not run)

</code></pre>

<hr>
<h2 id='prevsim'>Simulated patient dataset.</h2><span id='topic+prevsim'></span>

<h3>Description</h3>

<p>A dataset in the format of a disease registry, where the outcome being modelled is death
due to the simulated disease. The registry began in January 2003, with 1000 incident cases being
recorded over a period of nearly exactly ten years. The patients are followed up for a further
two years until 17.03.2015, at which point any subjects alive are marked as right censored.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prevsim
</code></pre>


<h3>Format</h3>

<p>A data frame with 1000 rows and 6 columns:
</p>

<dl>
<dt>time</dt><dd><p>time between date of diagnosis and death or censorship in days</p>
</dd>
<dt>status</dt><dd><p>event marker; 1 if patient is deceased and 0 if alive or censored</p>
</dd>
<dt>age</dt><dd><p>age in years at point of entry into the registry</p>
</dd>
<dt>sex</dt><dd><p>string with values 'M' and 'F'</p>
</dd>
<dt>entrydate</dt><dd><p>date of entry into the registry in YYYY-MM-DD format</p>
</dd>
<dt>eventdate</dt><dd><p>date of death or censorship in YYYY-MM-DD format</p>
</dd>
</dl>



<h3>Details</h3>

<p>Demographic and disease-specific data required for prevalence estimations are included,
such as sex, age, and dates of entry and event. <code>eventdate</code> marks the date of the
last known follow-up with the patient, corresponding to death (<code>status = 1</code>) or
censorship (<code>status = 0</code>).
</p>

<hr>
<h2 id='rprev'>rprev: Estimate disease point prevalence using a combination of registry data and
Monte Carlo simulations.</h2><span id='topic+rprev'></span>

<h3>Description</h3>

<p>The rprev package uses available registry data to estimate point prevalence
at a specified index date. This is done by fitting two models to the registry
data: an incidence and a survival model. The first model is used to generate
an incident population with the survival model determining whether an individual
is alive at the index date and therefore contributing to prevalence.
</p>


<h3>Details</h3>

<p>Prevalence is estimated using incident cases from a set number of years,
where the larger this values the more accurate the prevalence estimates are.
However, if the user asks to use more years of incident cases than are
available in the registry data set, then the remaining years of incidence are
simulated.
</p>
<p>The primary function in this package is thereby <code><a href="#topic+prevalence">prevalence</a></code>,
which performs the combination of counted incidence from the registry data,
and the simulated cases, along with the calculation of their survival
probabilities at the index date.
</p>
<p><code><a href="#topic+test_homogeneity">test_homogeneity</a></code> provides a summary of the incident cases in the
registry data set, allowing for inspection of whether the default
homogeneous Poisson process assumption holds for the disease in question.
</p>

<hr>
<h2 id='sim_prevalence'>Estimate prevalence using Monte Carlo simulation.</h2><span id='topic+sim_prevalence'></span>

<h3>Description</h3>

<p>Estimates prevalent cases at a specific index date by use of Monte Carlo
simulation. Simulated cases are marked with age and sex to enable agreement
with population survival data where a cure model is used, and calculation of
the posterior distributions of each.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim_prevalence(
  data,
  index,
  starting_date,
  inc_model,
  surv_model,
  age_column = "age",
  N_boot = 1000,
  age_dead = 100
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sim_prevalence_+3A_data">data</code></td>
<td>
<p>A data frame with the corresponding column names provided in
<code>form</code>.</p>
</td></tr>
<tr><td><code id="sim_prevalence_+3A_index">index</code></td>
<td>
<p>The date at which to estimate point prevalence as a string in the format
YYYY-MM-DD.</p>
</td></tr>
<tr><td><code id="sim_prevalence_+3A_starting_date">starting_date</code></td>
<td>
<p>The initial date to start simulating prevalence from as a <code>Date</code> object.
Typically the index date - (Nyears * 365.25). Allows for non-whole year prevalence estimations.</p>
</td></tr>
<tr><td><code id="sim_prevalence_+3A_inc_model">inc_model</code></td>
<td>
<p>An object that has a <code>draw_incident_population</code>
method. See the vignette for further guidance.</p>
</td></tr>
<tr><td><code id="sim_prevalence_+3A_surv_model">surv_model</code></td>
<td>
<p>An object that has a <code>predict_survival_probability</code>
method. See the vignette for further guidance.</p>
</td></tr>
<tr><td><code id="sim_prevalence_+3A_age_column">age_column</code></td>
<td>
<p>A string providing the name of the column that holds patient age. If provided
then patients alive at <code>age_dead</code> are set to die. This helps combat 'immortal' patients.</p>
</td></tr>
<tr><td><code id="sim_prevalence_+3A_n_boot">N_boot</code></td>
<td>
<p>Number of bootstrapped calculations to perform.</p>
</td></tr>
<tr><td><code id="sim_prevalence_+3A_age_dead">age_dead</code></td>
<td>
<p>The age at which patients are set to be dead if they are still alive, to prevent
'immortal' patients. Used in conjunction with <code>age_column</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the following attributes:
</p>
<table>
<tr><td><code>results</code></td>
<td>
<p>A data.table containing the simulated incident populations from each
simulation along with their covariates and survival status at the index.</p>
</td></tr>
<tr><td><code>full_surv_model</code></td>
<td>
<p>The survival model built on the full registry data set.</p>
</td></tr>
<tr><td><code>full_inc_model</code></td>
<td>
<p>The incidence model built on the full registry data set.</p>
</td></tr>
<tr><td><code>surv_models</code></td>
<td>
<p>A list containing survival models built on each bootstrap sample.</p>
</td></tr>
<tr><td><code>inc_models</code></td>
<td>
<p>A list containing incidence models built on each bootstrap sample.</p>
</td></tr>
</table>

<hr>
<h2 id='summary.survfit.prev'>Obtain N-year survival probability estimates.</h2><span id='topic+summary.survfit.prev'></span>

<h3>Description</h3>

<p>Summarises survival information at pre-specified years of interest on a
<code>survfit.prev</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'survfit.prev'
summary(object, years = c(1, 3, 5), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.survfit.prev_+3A_object">object</code></td>
<td>
<p>A <code>survfit.prev</code> object.</p>
</td></tr>
<tr><td><code id="summary.survfit.prev_+3A_years">years</code></td>
<td>
<p>A vector of years for which to estimate survival probability
from the bootstrapped survival curves.</p>
</td></tr>
<tr><td><code id="summary.survfit.prev_+3A_...">...</code></td>
<td>
<p>Arguments passed to main <code>summary</code> function.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Survival probability is estimated as the mean of the bootstrapped survival
curves at a specific timepoint, with 2.5
confidence intervals. Survival probability can only be estimated at time
points less than the maximum survival time in the original dataset that the
<code>prevalence</code> object was fitted to.
</p>


<h3>Value</h3>

<p>None, displays the survival probabilities to screen as a side-effect.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(prevsim)

## Not run: 
prev_obj &lt;- prevalence(Surv(time, status) ~ age(age) + sex(sex) +
                       entry(entrydate) + event(eventdate),
                       data=prevsim, num_years_to_estimate = c(5, 10),
                       population_size=1e6, start = "2005-09-01",
                       num_reg_years = 8, cure = 5)

survobj &lt;- survfit(prev_obj, newdata=list(age=65, sex=0))

summary(survobj)

summary(survobj, years=c(1, 3, 5, 7))

## End(Not run)

</code></pre>

<hr>
<h2 id='survfit.prevalence'>Form bootstrapped survival curves.</h2><span id='topic+survfit.prevalence'></span>

<h3>Description</h3>

<p>Calculates bootstrapped survival probabilities from the Weibull models fitted
to the <code>prevalence</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'prevalence'
survfit(formula, newdata = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="survfit.prevalence_+3A_formula">formula</code></td>
<td>
<p>A <code>prevalence</code> object.</p>
</td></tr>
<tr><td><code id="survfit.prevalence_+3A_newdata">newdata</code></td>
<td>
<p>A list or dataframe with the covariate values to calculate
survival probabilities for. Defaults to using the mean values from the the
original dataset that the model was fit to.</p>
</td></tr>
<tr><td><code id="survfit.prevalence_+3A_...">...</code></td>
<td>
<p>Other arguments to <code>survfit</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An S3 object of class <code>survfit.prev</code> with the following
attributes: </p>
<table>
<tr><td><code>time</code></td>
<td>
<p>A vector of time points at which survival
probability has been calculated.</p>
</td></tr> <tr><td><code>surv</code></td>
<td>
<p>A matrix of survival
probabilities, where the rows represent a different bootstrapped Weibull
model, and the columns are each timepoint.</p>
</td></tr> <tr><td><code>fullsurv</code></td>
<td>
<p>A vector of
survival probabilities for the predictors provided in newdata.</p>
</td></tr>
</table>

<hr>
<h2 id='test_homogeneity'>Inspects disease incidence for its compatibility with a homogeneous Poisson process.</h2><span id='topic+test_homogeneity'></span>

<h3>Description</h3>

<p>Calculates incidence by year of the registry data, along with mean incidence
with confidence intervals. A smoothed cumulative incidence function is fit to
the data for inspecting deviations in the registry data from a homogeneous
Poisson process.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>test_homogeneity(
  entry,
  year_start = "01-01",
  truncate_start = FALSE,
  truncate_end = FALSE,
  population_size = NULL,
  df = 4,
  proportion = 1e+05,
  level = 0.95,
  precision = 2
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="test_homogeneity_+3A_entry">entry</code></td>
<td>
<p>Vector of diagnosis dates for each patient in the registry in
the format YYYY-MM-DD.</p>
</td></tr>
<tr><td><code id="test_homogeneity_+3A_year_start">year_start</code></td>
<td>
<p>Date which to use to delimit years in the format MM-DD.
See details for how this is used.</p>
</td></tr>
<tr><td><code id="test_homogeneity_+3A_truncate_start">truncate_start</code></td>
<td>
<p>See details.</p>
</td></tr>
<tr><td><code id="test_homogeneity_+3A_truncate_end">truncate_end</code></td>
<td>
<p>See details.</p>
</td></tr>
<tr><td><code id="test_homogeneity_+3A_population_size">population_size</code></td>
<td>
<p>The population of the area covered by the registry. If not provided
then only absolute incidence can be calculated.</p>
</td></tr>
<tr><td><code id="test_homogeneity_+3A_df">df</code></td>
<td>
<p>The desired degrees of freedom of the smooth.</p>
</td></tr>
<tr><td><code id="test_homogeneity_+3A_proportion">proportion</code></td>
<td>
<p>The denominator of the incidence rate.</p>
</td></tr>
<tr><td><code id="test_homogeneity_+3A_level">level</code></td>
<td>
<p>The desired confidence interval width.</p>
</td></tr>
<tr><td><code id="test_homogeneity_+3A_precision">precision</code></td>
<td>
<p>The number of decimal places required.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Annual incidence rates are calculated for every year that is present in
<code>entry</code>, with years being delimited by the date specified in <code>year_start</code>
that include every incident case.
For example, under the default values, if the earliest incident date in <code>entry</code>
is 1981-04-28, and the latest is 2016-12-16, then annual incidence rates will be
calculated with the boundaries [1981-01-01, 1982-01-01), ..., [2016-01-01, 2017-01-01).
</p>
<p>If <code>year_start</code> was specified as '09-01' then the boundaries would be
[1980-09-01, 1981-09-01), ..., [2016-09-01, 2017-09-01).
</p>
<p>The <code>truncate_start</code> and <code>truncate_end</code> arguments remove incident
cases in the first and last years before and after the yearly boundaries
respectively.
</p>
<p>So if they were both <code>TRUE</code>, with <code>year_start</code> as '09-01' as before, then the
boundaries would be [1981-09-01, 1982-09-01), ..., [2015-09-01, 2016-09-01),
i.e. the incident cases in [1981-04-28, 1981-09-01) are discarded by <code>truncate_start</code>
and those in [2016-09-01, 2016-12-16] removed by <code>truncate_end</code>.
</p>
<p>This helps to ensure that annual incidence is measured on a time-scale appropriate
for your registry.
</p>


<h3>Value</h3>

<p>An S3 object of class <code>incidence</code> with the following attributes:
</p>
<table>
<tr><td><code>yearly_incidence</code></td>
<td>
<p>Vector of absolute incidence values for each included
year of the registry</p>
</td></tr>
<tr><td><code>ordered_diagnoses</code></td>
<td>
<p>Vector of times (days) between diagnosis date and
the earliest date of inclusion in the registry, ordered shortest to
longest.</p>
</td></tr>
<tr><td><code>smooth</code></td>
<td>
<p>Smooth fitted to the cumulative incidence data.</p>
</td></tr>
<tr><td><code>index_dates</code></td>
<td>
<p>Dates delimiting the years in which incidence is
calculated.</p>
</td></tr>
<tr><td><code>mean</code></td>
<td>
<p>List containing absolute yearly incidence as well as relative
rates.</p>
</td></tr>
<tr><td><code>pvals</code></td>
<td>
<p>p-values resulting to a test of over and under dispersion on the
incidence data respectively. Used to test the suitability of the homogeneous
Poission process assumption.</p>
</td></tr>
<tr><td><code>dof</code></td>
<td>
<p>Degrees of freedom of the smooth.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>data(prevsim)

## Not run: 
test_homogeneity(prevsim$entrydate)

## End(Not run)

</code></pre>

<hr>
<h2 id='test_prevalence_fit'>Test simulated prevalence fit.</h2><span id='topic+test_prevalence_fit'></span>

<h3>Description</h3>

<p>Calculates a Chi squared test between predicted yearly contributions to
prevalence, and the observed values obtained from the registry, indicating
whether the simulated prevalence values are accurate.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>test_prevalence_fit(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="test_prevalence_fit_+3A_object">object</code></td>
<td>
<p>A <code>prevalence</code> object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>P-value from a chi-squared test of difference between prevalence
prediction and counted prevalence at the index date.
</p>


<h3>See Also</h3>

<p>Other prevalence functions: 
<code><a href="#topic+prevalence">prevalence</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(prevsim)

## Not run: 

obj &lt;- prevalence(Surv(time, status) ~ age(age) + sex(sex) + entry(entrydate) + event(eventdate),
                  data=prevsim, num_years_to_estimate = c(5, 10), population_size=1e6,
                  start = "2005-09-01",
                  num_reg_years = 8, cure = 5)

test_prevalence_fit(obj)

## End(Not run)
</code></pre>

<hr>
<h2 id='UKmortality'>General population survival data.</h2><span id='topic+UKmortality'></span>

<h3>Description</h3>

<p>A dataset containing daily population survival rates for individuals up to 100 years old,
from the UK population, derived from the 2009 mortality rates found at:
<a href="https://www.ons.gov.uk/peoplepopulationandcommunity/birthsdeathsandmarriages/lifeexpectancies/datasets/nationallifetablesunitedkingdomreferencetables">https://www.ons.gov.uk/peoplepopulationandcommunity/birthsdeathsandmarriages/lifeexpectancies/datasets/nationallifetablesunitedkingdomreferencetables</a>,
Adapted from public sector information licensed under the Open Government Licence v3.0.
Data were relabelled according to the mean year of the three-year birth window.
It is stored as a <code>data.table</code> for efficient access.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>UKmortality
</code></pre>


<h3>Format</h3>

<p>A data frame with 109575 rows and 3 columns:
</p>

<dl>
<dt>age</dt><dd><p>age in days</p>
</dd>
<dt>sex</dt><dd><p>string, either 'M' or 'F'</p>
</dd>
<dt>surv</dt><dd><p>survival probability , estimated as the cumulative product of (1 - mortality rate)</p>
</dd>
</dl>


<hr>
<h2 id='validate_incidence_model'>Tests custom incidence models</h2><span id='topic+validate_incidence_model'></span>

<h3>Description</h3>

<p>Runs checks to assess whether a custom incidence model is
suitable for use in <code>prevalence</code>. Provides useful
diagnostic messages if any issues are encountered.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>validate_incidence_model(object, data, timeframe = 3652)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="validate_incidence_model_+3A_object">object</code></td>
<td>
<p>An incidence model to be tested</p>
</td></tr>
<tr><td><code id="validate_incidence_model_+3A_data">data</code></td>
<td>
<p>Registry data in the form of a data frame. Ideally
will be the same source that will be used for the prevalence
estimation later on.</p>
</td></tr>
<tr><td><code id="validate_incidence_model_+3A_timeframe">timeframe</code></td>
<td>
<p>How long to generate incident cases for in days.
This is disease-specific, but the default of ten years
should work well for most diseases.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The dummy incident population that has been generated to allow
for further diagnostics to be run.
</p>

<hr>
<h2 id='validate_survival_model'>Tests that a custom survival object has the required attributes
for use in the <code>prevalence</code> function.</h2><span id='topic+validate_survival_model'></span>

<h3>Description</h3>

<p>Runs checks to assess whether a custom survival model is
suitable for use in <code>prevalence</code>. Provides useful
diagnostic messages if any issues are encountered.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>validate_survival_model(object, data, timeframe = 3652, sample_size = 10)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="validate_survival_model_+3A_object">object</code></td>
<td>
<p>The custom survival object.</p>
</td></tr>
<tr><td><code id="validate_survival_model_+3A_data">data</code></td>
<td>
<p>Registry data in the form of a data frame. Ideally
will be the same source that will be used for the prevalence
estimation later on.</p>
</td></tr>
<tr><td><code id="validate_survival_model_+3A_timeframe">timeframe</code></td>
<td>
<p>Maximum time at which to test survival probability in days.
If not supplied then chooses random values over a period of 10 years, which
should be suitable for many diseases.</p>
</td></tr>
<tr><td><code id="validate_survival_model_+3A_sample_size">sample_size</code></td>
<td>
<p>The number of randomly drawn individuals to predict
sample size for.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>None. Instead, messages get displayed to the
console.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
