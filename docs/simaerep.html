<!DOCTYPE html><html><head><title>Help for package simaerep</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {simaerep}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#+25+26gt+3B+25'><p>Pipe operator</p></a></li>
<li><a href='#aggr_duplicated_visits'><p>Aggregate duplicated visits.</p></a></li>
<li><a href='#check_df_visit'><p>Integrity check for df_visit.</p></a></li>
<li><a href='#eval_sites'><p>Evaluate sites.</p></a></li>
<li><a href='#eval_sites_deprecated'><p>Evaluate sites.</p></a></li>
<li><a href='#exp_implicit_missing_visits'><p>Expose implicitly missing visits.</p></a></li>
<li><a href='#get_config'><p>Get Portfolio Configuration</p></a></li>
<li><a href='#get_ecd_values'><p>Get empirical cumulative distribution values of pval or prob_lower</p></a></li>
<li><a href='#get_legend'><p>replace cowplot::get_legend, to silence warning</p>
Multiple components found; returning the first one. To return all, use 'return_all = TRUE</a></li>
<li><a href='#get_pat_pool_config'><p>Configure study patient pool by site parameters.</p></a></li>
<li><a href='#get_portf_perf'><p>Get Portfolio Performance</p></a></li>
<li><a href='#get_site_mean_ae_dev'><p>Get site mean ae development.</p></a></li>
<li><a href='#get_visit_med75'><p>Get visit_med75.</p></a></li>
<li><a href='#is_orivisit'><p>is orivisit class</p></a></li>
<li><a href='#is_simaerep'><p>is simaerep class</p></a></li>
<li><a href='#orivisit'><p>create orivisit object</p></a></li>
<li><a href='#pat_aggr'><p>Aggregate visit to patient level.</p></a></li>
<li><a href='#pat_pool'><p>Create a study specific patient pool for sampling</p></a></li>
<li><a href='#plot_dots'><p>Plots AE per site as dots.</p></a></li>
<li><a href='#plot_sim_example'><p>Plot simulation example.</p></a></li>
<li><a href='#plot_sim_examples'><p>Plot multiple simulation examples.</p></a></li>
<li><a href='#plot_study'><p>Plot ae development of study and sites highlighting at risk sites.</p></a></li>
<li><a href='#plot_visit_med75'><p>Plot patient visits against visit_med75.</p></a></li>
<li><a href='#plot.simaerep'><p>plot AE under-reporting simulation results</p></a></li>
<li><a href='#poiss_test_site_ae_vs_study_ae'><p>Poisson test for vector with site AEs vs vector with study AEs.</p></a></li>
<li><a href='#prep_for_sim'><p>Prepare data for simulation.</p></a></li>
<li><a href='#prob_lower_site_ae_vs_study_ae'><p>Calculate bootstrapped probability for obtaining a lower site mean AE number.</p></a></li>
<li><a href='#purrr_bar'><p>Execute a purrr or furrr function with a progress</p>
bar.</a></li>
<li><a href='#sim_after_prep'><p>Start simulation after preparation.</p></a></li>
<li><a href='#sim_scenario'><p>simulate single scenario</p></a></li>
<li><a href='#sim_sites'><p>Calculate prob_lower and poisson.test pvalue for study sites.</p></a></li>
<li><a href='#sim_studies'><p>Simulate studies.</p></a></li>
<li><a href='#sim_test_data_patient'><p>simulate patient ae reporting test data</p></a></li>
<li><a href='#sim_test_data_portfolio'><p>Simulate Portfolio Test Data</p></a></li>
<li><a href='#sim_test_data_study'><p>simulate study test data</p></a></li>
<li><a href='#sim_ur_scenarios'><p>Simulate Under-Reporting Scenarios</p></a></li>
<li><a href='#simaerep'><p>create simaerep object</p></a></li>
<li><a href='#site_aggr'><p>Aggregate from visit to site level.</p></a></li>
<li><a href='#with_progress_cnd'><p>Conditional <code>with_progress</code>.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Find Clinical Trial Sites Under-Reporting Adverse Events</td>
</tr>
<tr>
<td>Version:</td>
<td>0.5.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Monitoring of Adverse Event (AE) reporting in clinical trials is 
  important for patient safety. Sites that are under-reporting AEs can be detected 
  using Bootstrap-based simulations that simulate overall AE reporting. Based on the 
  simulation an AE under-reporting probability is assigned to each site in a 
  given trial (Koneswarakantha 2021 &lt;<a href="https://doi.org/10.1007%2Fs40264-020-01011-5">doi:10.1007/s40264-020-01011-5</a>&gt;).</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://openpharma.github.io/simaerep/">https://openpharma.github.io/simaerep/</a>,
<a href="https://github.com/openpharma/simaerep">https://github.com/openpharma/simaerep</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.0), ggplot2</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr (&ge; 1.0.0), tidyr (&ge; 1.1.0), magrittr, purrr, rlang,
stringr, forcats, cowplot, RColorBrewer, furrr (&ge; 0.2.1),
progressr, knitr, tibble</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat, devtools, pkgdown, spelling, haven, vdiffr, lintr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-04-03 11:23:33 UTC; koneswab</td>
</tr>
<tr>
<td>Author:</td>
<td>Bjoern Koneswarakantha
    <a href="https://orcid.org/0000-0003-4585-7799"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut, cre,
    cph],
  F. Hoffmann-La Roche Ltd [cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Bjoern Koneswarakantha &lt;bjoern.koneswarakantha@roche.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-04-03 12:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='+25+26gt+3B+25'>Pipe operator</h2><span id='topic++25+3E+25'></span>

<h3>Description</h3>

<p>See <code>magrittr::<a href="magrittr.html#topic+pipe">%&gt;%</a></code> for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lhs %&gt;% rhs
</code></pre>


<h3>Value</h3>

<p>returns output of rhs function
</p>

<hr>
<h2 id='aggr_duplicated_visits'>Aggregate duplicated visits.</h2><span id='topic+aggr_duplicated_visits'></span>

<h3>Description</h3>

<p>Internal function called by <a href="#topic+check_df_visit">check_df_visit()</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>aggr_duplicated_visits(df_visit)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="aggr_duplicated_visits_+3A_df_visit">df_visit</code></td>
<td>
<p>dataframe with columns: study_id, site_number, patnum, visit,
n_ae</p>
</td></tr>
</table>


<h3>Value</h3>

<p>df_visit corrected
</p>

<hr>
<h2 id='check_df_visit'>Integrity check for df_visit.</h2><span id='topic+check_df_visit'></span>

<h3>Description</h3>

<p>Internal function used by all functions that accept df_visit as a parameter.
Checks for NA columns, numeric visits and AEs, implicitly missing and
duplicated visits.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_df_visit(df_visit)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_df_visit_+3A_df_visit">df_visit</code></td>
<td>
<p>dataframe with columns: study_id, site_number, patnum, visit,
n_ae</p>
</td></tr>
</table>


<h3>Value</h3>

<p>corrected df_visit
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
df_visit &lt;- sim_test_data_study(
  n_pat = 100,
  n_sites = 5,
  frac_site_with_ur = 0.4,
  ur_rate = 0.6
)

df_visit$study_id &lt;- "A"

df_visit_filt &lt;- df_visit %&gt;%
  dplyr::filter(visit != 3)

df_visit_corr &lt;- check_df_visit(df_visit_filt)
3 %in% df_visit_corr$visit
nrow(df_visit_corr) == nrow(df_visit)

df_visit_corr &lt;- check_df_visit(dplyr::bind_rows(df_visit, df_visit))
nrow(df_visit_corr) == nrow(df_visit)

</code></pre>

<hr>
<h2 id='eval_sites'>Evaluate sites.</h2><span id='topic+eval_sites'></span>

<h3>Description</h3>

<p>Correct under-reporting probabilities using  <code><a href="stats.html#topic+p.adjust">p.adjust</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>eval_sites(df_sim_sites, method = "BH", under_only = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="eval_sites_+3A_df_sim_sites">df_sim_sites</code></td>
<td>
<p>dataframe generated by <code><a href="#topic+sim_sites">sim_sites</a></code></p>
</td></tr>
<tr><td><code id="eval_sites_+3A_method">method</code></td>
<td>
<p>character, passed to stats::p.adjust(), if NULL
eval_sites_deprecated() is used instead, Default = &quot;BH&quot;</p>
</td></tr>
<tr><td><code id="eval_sites_+3A_under_only">under_only</code></td>
<td>
<p>compute under-reporting probabilities only, default = TRUE
<a href="#topic+check_df_visit">check_df_visit()</a>, computationally expensive on large data
sets. Default: TRUE</p>
</td></tr>
<tr><td><code id="eval_sites_+3A_...">...</code></td>
<td>
<p>use to pass r_sim_sites parameter to eval_sites_deprecated()</p>
</td></tr>
</table>


<h3>Value</h3>

<p>dataframe with the following columns:
</p>

<dl>
<dt><strong>study_id</strong></dt><dd><p>study identification</p>
</dd>
<dt><strong>site_number</strong></dt><dd><p>site identification</p>
</dd>
<dt><strong>visit_med75</strong></dt><dd><p>median(max(visit)) * 0.75</p>
</dd>
<dt><strong>mean_ae_site_med75</strong></dt><dd><p>mean AE at visit_med75 site level</p>
</dd>
<dt><strong>mean_ae_study_med75</strong></dt><dd><p>mean AE at visit_med75 study level</p>
</dd>
<dt><strong>pval</strong></dt><dd><p>p-value as returned by <code><a href="stats.html#topic+poisson.test">poisson.test</a></code></p>
</dd>
<dt><strong>prob_low</strong></dt><dd><p>bootstrapped probability for having mean_ae_site_med75 or lower</p>
</dd>
<dt><strong>pval_adj</strong></dt><dd><p>adjusted p-values</p>
</dd>
<dt><strong>prob_low_adj</strong></dt><dd><p>adjusted bootstrapped probability for having mean_ae_site_med75 or lower</p>
</dd>
<dt><strong>pval_prob_ur</strong></dt><dd><p>probability under-reporting as 1 - pval_adj, poisson.test (use as benchmark)</p>
</dd>
<dt><strong>prob_low_prob_ur</strong></dt><dd><p>probability under-reporting as 1 - prob_low_adj, bootstrapped (use)</p>
</dd>
</dl>



<h3>See Also</h3>

<p><code><a href="#topic+site_aggr">site_aggr</a></code>,
<code><a href="#topic+sim_sites">sim_sites</a></code>,
<code><a href="stats.html#topic+p.adjust">p.adjust</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>df_visit &lt;- sim_test_data_study(n_pat = 100, n_sites = 5,
    frac_site_with_ur = 0.4, ur_rate = 0.6)

df_visit$study_id &lt;- "A"
df_site &lt;- site_aggr(df_visit)

df_sim_sites &lt;- sim_sites(df_site, df_visit, r = 100)

df_eval &lt;- eval_sites(df_sim_sites)
df_eval

# use deprecated method  -------
df_eval &lt;- eval_sites(df_sim_sites, method = NULL, r_sim_sites = 100)
df_eval
</code></pre>

<hr>
<h2 id='eval_sites_deprecated'>Evaluate sites.</h2><span id='topic+eval_sites_deprecated'></span>

<h3>Description</h3>

<p>Correct under-reporting probabilities by the expected number of
false positives (fp). This has been deprecated in favor of more conventional
methods available via <code><a href="stats.html#topic+p.adjust">p.adjust</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>eval_sites_deprecated(df_sim_sites, r_sim_sites)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="eval_sites_deprecated_+3A_df_sim_sites">df_sim_sites</code></td>
<td>
<p>dataframe generated by <code><a href="#topic+sim_sites">sim_sites()</a></code></p>
</td></tr>
<tr><td><code id="eval_sites_deprecated_+3A_r_sim_sites">r_sim_sites</code></td>
<td>
<p>integer, number of repeats for bootstrap resampling for site
simulation, needed for zero probability correction for fp calculation, Default: 1000</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If by chance expected number of
false positives (fp) is greater than the total number of positives (p) we
set p_vs_fp_ratio = 1 and prob_ur = 0.
</p>


<h3>Value</h3>

<p>dataframe with the following columns:
</p>

<dl>
<dt><strong>study_id</strong></dt><dd><p>study identification</p>
</dd>
<dt><strong>site_number</strong></dt><dd><p>site identification</p>
</dd>
<dt><strong>visit_med75</strong></dt><dd><p>median(max(visit)) * 0.75</p>
</dd>
<dt><strong>mean_ae_site_med75</strong></dt><dd><p>mean AE at visit_med75 site level</p>
</dd>
<dt><strong>mean_ae_study_med75</strong></dt><dd><p>mean AE at visit_med75 study level</p>
</dd>
<dt><strong>pval</strong></dt><dd><p>p-value as returned by <code>poisson.test</code></p>
</dd>
<dt><strong>prob_low</strong></dt><dd><p>bootstrapped probability for having mean_ae_site_med75 or lower</p>
</dd>
<dt><strong>n_site</strong></dt><dd><p>number of study sites</p>
</dd>
<dt><strong>pval_n_detected</strong></dt><dd><p>sites with the same p-value or lower</p>
</dd>
<dt><strong>pval_fp</strong></dt><dd><p>expected number of fp, pval * n_site</p>
</dd>
<dt><strong>pval_p_vs_fp_ratio</strong></dt><dd><p>odds under-reporting as p/fp, poisson.test (use as benchmark)</p>
</dd>
<dt><strong>pval_prob_ur</strong></dt><dd><p>probability under-reporting as 1 - fp/p, poisson.test (use as benchmark)</p>
</dd>
<dt><strong>prob_low_n_detected</strong></dt><dd><p>sites with same bootstrapped probability or lower</p>
</dd>
<dt><strong>prob_low_fp</strong></dt><dd><p>expected number of fp, prob_lower * n_site</p>
</dd>
<dt><strong>prob_low_p_vs_fp_ratio</strong></dt><dd><p>odds under-reporting as p/fp, bootstrapped (use)</p>
</dd>
<dt><strong>prob_low_prob_ur</strong></dt><dd><p>probability under-reporting as 1 - fp/p, bootstrapped (use)</p>
</dd>
</dl>



<h3>See Also</h3>

<p><code><a href="#topic+site_aggr">site_aggr()</a></code>, <code><a href="#topic+sim_sites">sim_sites()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>df_visit &lt;- sim_test_data_study(n_pat = 100, n_sites = 5,
    frac_site_with_ur = 0.4, ur_rate = 0.6)

df_visit$study_id &lt;- "A"
df_site &lt;- site_aggr(df_visit)

df_sim_sites &lt;- sim_sites(df_site, df_visit, r = 100)

df_eval &lt;- eval_sites_deprecated(df_sim_sites, r_sim_sites = 100)
df_eval
</code></pre>

<hr>
<h2 id='exp_implicit_missing_visits'>Expose implicitly missing visits.</h2><span id='topic+exp_implicit_missing_visits'></span>

<h3>Description</h3>

<p>Internal function called by <a href="#topic+check_df_visit">check_df_visit()</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>exp_implicit_missing_visits(df_visit)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="exp_implicit_missing_visits_+3A_df_visit">df_visit</code></td>
<td>
<p>dataframe with columns: study_id, site_number, patnum, visit,
n_ae</p>
</td></tr>
</table>


<h3>Value</h3>

<p>df_visit corrected
</p>

<hr>
<h2 id='get_config'>Get Portfolio Configuration</h2><span id='topic+get_config'></span>

<h3>Description</h3>

<p>Get Portfolio configuration from a dataframe aggregated on
patient level with max_ae and max_visit. Will filter studies with only a few
sites and patients and will anonymize IDs. Portfolio configuration can be
used by <code><a href="#topic+sim_test_data_portfolio">sim_test_data_portfolio</a></code> to generate data for an
artificial portfolio.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_config(
  df_site,
  min_pat_per_study = 100,
  min_sites_per_study = 10,
  anonymize = TRUE,
  pad_width = 4
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_config_+3A_df_site">df_site</code></td>
<td>
<p>dataframe aggregated on patient level with max_ae and max_visit</p>
</td></tr>
<tr><td><code id="get_config_+3A_min_pat_per_study">min_pat_per_study</code></td>
<td>
<p>minimum number of patients per study, Default: 100</p>
</td></tr>
<tr><td><code id="get_config_+3A_min_sites_per_study">min_sites_per_study</code></td>
<td>
<p>minimum number of sites per study, Default: 10</p>
</td></tr>
<tr><td><code id="get_config_+3A_anonymize">anonymize</code></td>
<td>
<p>logical, Default: TRUE</p>
</td></tr>
<tr><td><code id="get_config_+3A_pad_width">pad_width</code></td>
<td>
<p>padding width for newly created IDs, Default: 4</p>
</td></tr>
</table>


<h3>Value</h3>

<p>dataframe with the following columns: </p>

<dl>
<dt><strong>study_id</strong></dt><dd><p>study identification</p>
</dd> <dt><strong>ae_per_visit_mean</strong></dt><dd><p>mean
AE per visit per study</p>
</dd> <dt><strong>site_number</strong></dt><dd><p>site</p>
</dd>
<dt><strong>max_visit_sd</strong></dt><dd><p>standard deviation of maximum patient visits per
site</p>
</dd> <dt><strong>max_visit_mean</strong></dt><dd><p>mean of maximum patient visits per site</p>
</dd>
<dt><strong>n_pat</strong></dt><dd><p>number of patients</p>
</dd> </dl>



<h3>See Also</h3>

<p><code><a href="#topic+sim_test_data_study">sim_test_data_study</a></code>
<code><a href="#topic+get_config">get_config</a></code>
<code><a href="#topic+sim_test_data_portfolio">sim_test_data_portfolio</a></code>
<code><a href="#topic+sim_ur_scenarios">sim_ur_scenarios</a></code>
<code><a href="#topic+get_portf_perf">get_portf_perf</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
df_visit1 &lt;- sim_test_data_study(n_pat = 100, n_sites = 10,
                                 frac_site_with_ur = 0.4, ur_rate = 0.6)

df_visit1$study_id &lt;- "A"

df_visit2 &lt;- sim_test_data_study(n_pat = 100, n_sites = 10,
                                 frac_site_with_ur = 0.2, ur_rate = 0.1)

df_visit2$study_id &lt;- "B"

df_visit &lt;- dplyr::bind_rows(df_visit1, df_visit2)

df_site_max &lt;- df_visit %&gt;%
  dplyr::group_by(study_id, site_number, patnum) %&gt;%
  dplyr::summarise(max_visit = max(visit),
            max_ae = max(n_ae),
            .groups = "drop")

df_config &lt;- get_config(df_site_max)

df_config

df_portf &lt;- sim_test_data_portfolio(df_config)

df_portf

df_scen &lt;- sim_ur_scenarios(df_portf,
                            extra_ur_sites = 2,
                            ur_rate = c(0.5, 1))


df_scen

df_perf &lt;- get_portf_perf(df_scen)

df_perf

</code></pre>

<hr>
<h2 id='get_ecd_values'>Get empirical cumulative distribution values of pval or prob_lower</h2><span id='topic+get_ecd_values'></span>

<h3>Description</h3>

<p>Test function, test applicability of poisson test, by calculating
</p>

<ul>
<li><p> the bootstrapped probability of obtaining a specific p-value or lower, use
in combination with <code><a href="#topic+sim_studies">sim_studies()</a></code>.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>get_ecd_values(df_sim_studies, df_sim_sites, val_str)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_ecd_values_+3A_df_sim_studies">df_sim_studies</code></td>
<td>
<p>dataframe, generated by <code><a href="#topic+sim_studies">sim_studies()</a></code></p>
</td></tr>
<tr><td><code id="get_ecd_values_+3A_df_sim_sites">df_sim_sites</code></td>
<td>
<p>dataframe, generated by <code><a href="#topic+sim_sites">sim_sites()</a></code></p>
</td></tr>
<tr><td><code id="get_ecd_values_+3A_val_str">val_str</code></td>
<td>
<p>c(&quot;prob_low&quot;,&quot;pval&quot;)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>trains a ecdf function for each studies based on the results
of <code><a href="#topic+sim_studies">sim_studies()</a></code>
</p>


<h3>Value</h3>

<p>dataframe with the following columns:
</p>

<dl>
<dt><strong>study_id</strong></dt><dd><p>study identification</p>
</dd>
<dt><strong>site_number</strong></dt><dd><p>site identification</p>
</dd>
<dt><strong>visit_med75</strong></dt><dd><p>median(max(visit)) * 0.75</p>
</dd>
<dt><strong>mean_ae_site_med75</strong></dt><dd><p>mean AE at visit_med75 site level</p>
</dd>
<dt><strong>mean_ae_study_med75</strong></dt><dd><p>mean AE at visit_med75 study level</p>
</dd>
<dt><strong>pval/prob_low</strong></dt><dd><p>p-value as returned by <code>poisson.test</code></p>
</dd>
<dt><strong>pval/prob_low_ecd</strong></dt><dd><p>p-value as returned by <code>poisson.test</code></p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>df_visit &lt;- sim_test_data_study(n_pat = 100, n_sites = 5,
    frac_site_with_ur = 0.4, ur_rate = 0.3)

df_visit$study_id &lt;- "A"
df_site &lt;- site_aggr(df_visit)

df_sim_sites &lt;- sim_sites(df_site, df_visit, r = 100)

df_sim_studies &lt;- sim_studies(
  df_site = df_site,
  df_visit = df_visit,
  r = 3,
  parallel = FALSE,
  poisson_test = TRUE,
  prob_lower = TRUE
)

get_ecd_values(df_sim_studies, df_sim_sites, "prob_low")
get_ecd_values(df_sim_studies, df_sim_sites, "pval")
</code></pre>

<hr>
<h2 id='get_legend'>replace cowplot::get_legend, to silence warning
Multiple components found; returning the first one. To return all, use 'return_all = TRUE</h2><span id='topic+get_legend'></span>

<h3>Description</h3>

<p>replace cowplot::get_legend, to silence warning
Multiple components found; returning the first one. To return all, use 'return_all = TRUE
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_legend(p)
</code></pre>

<hr>
<h2 id='get_pat_pool_config'>Configure study patient pool by site parameters.</h2><span id='topic+get_pat_pool_config'></span>

<h3>Description</h3>

<p>Internal Function used by <code><a href="#topic+sim_sites">sim_sites()</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_pat_pool_config(df_visit, df_site, min_n_pat_with_med75 = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_pat_pool_config_+3A_df_visit">df_visit</code></td>
<td>
<p>dataframe</p>
</td></tr>
<tr><td><code id="get_pat_pool_config_+3A_df_site">df_site</code></td>
<td>
<p>dataframe as created by site_aggr()</p>
</td></tr>
<tr><td><code id="get_pat_pool_config_+3A_min_n_pat_with_med75">min_n_pat_with_med75</code></td>
<td>
<p>minimum number of patients with visit_med_75 for
simulation, Default: 1</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For simulating a study we need to configure the study patient
pool to match the configuration of the sites
</p>


<h3>Value</h3>

<p>dataframe
</p>


<h3>Examples</h3>

<pre><code class='language-R'>df_visit1 &lt;- sim_test_data_study(n_pat = 100, n_sites = 5,
                                      frac_site_with_ur = 0.4, ur_rate = 0.6)

df_visit1$study_id &lt;- "A"

df_visit2 &lt;- sim_test_data_study(n_pat = 1000, n_sites = 3,
                                      frac_site_with_ur = 0.2, ur_rate = 0.1)

df_visit2$study_id &lt;- "B"

df_visit &lt;- dplyr::bind_rows(df_visit1, df_visit2)

df_site &lt;- site_aggr(df_visit)

df_config &lt;- get_pat_pool_config(df_visit, df_site)

df_config
</code></pre>

<hr>
<h2 id='get_portf_perf'>Get Portfolio Performance</h2><span id='topic+get_portf_perf'></span>

<h3>Description</h3>

<p>Performance as true positive rate (tpr as tp/P) on the basis of
desired false positive rates (fpr as fp/P).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_portf_perf(df_scen, stat = "prob_low_prob_ur", fpr = c(0.001, 0.01, 0.05))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_portf_perf_+3A_df_scen">df_scen</code></td>
<td>
<p>dataframe as returned by <code><a href="#topic+sim_ur_scenarios">sim_ur_scenarios</a></code></p>
</td></tr>
<tr><td><code id="get_portf_perf_+3A_stat">stat</code></td>
<td>
<p>character denoting the column name of the under-reporting
statistic, Default: 'prob_low_prob_ur'</p>
</td></tr>
<tr><td><code id="get_portf_perf_+3A_fpr">fpr</code></td>
<td>
<p>numeric vector specifying false positive rates, Default: c(0.001,
0.01, 0.05)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>DETAILS
</p>


<h3>Value</h3>

<p>dataframe
</p>


<h3>See Also</h3>

<p><code><a href="#topic+sim_test_data_study">sim_test_data_study</a></code> <code><a href="#topic+get_config">get_config</a></code>
<code><a href="#topic+sim_test_data_portfolio">sim_test_data_portfolio</a></code> <code><a href="#topic+sim_ur_scenarios">sim_ur_scenarios</a></code>
<code><a href="#topic+get_portf_perf">get_portf_perf</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
df_visit1 &lt;- sim_test_data_study(n_pat = 100, n_sites = 10,
                                 frac_site_with_ur = 0.4, ur_rate = 0.6)

df_visit1$study_id &lt;- "A"

df_visit2 &lt;- sim_test_data_study(n_pat = 100, n_sites = 10,
                                 frac_site_with_ur = 0.2, ur_rate = 0.1)

df_visit2$study_id &lt;- "B"

df_visit &lt;- dplyr::bind_rows(df_visit1, df_visit2)

df_site_max &lt;- df_visit %&gt;%
  dplyr::group_by(study_id, site_number, patnum) %&gt;%
  dplyr::summarise(max_visit = max(visit),
                   max_ae = max(n_ae),
                   .groups = "drop")

df_config &lt;- get_config(df_site_max)

df_config

df_portf &lt;- sim_test_data_portfolio(df_config)

df_portf

df_scen &lt;- sim_ur_scenarios(df_portf,
                            extra_ur_sites = 2,
                            ur_rate = c(0.5, 1))


df_scen

df_perf &lt;- get_portf_perf(df_scen)

df_perf

</code></pre>

<hr>
<h2 id='get_site_mean_ae_dev'>Get site mean ae development.</h2><span id='topic+get_site_mean_ae_dev'></span>

<h3>Description</h3>

<p>Internal function used by <code><a href="#topic+site_aggr">site_aggr()</a></code>, <code><a href="#topic+plot_visit_med75">plot_visit_med75()</a></code>,
returns mean AE development from visit 0 to visit_med75.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_site_mean_ae_dev(df_visit, df_pat, df_site)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_site_mean_ae_dev_+3A_df_visit">df_visit</code></td>
<td>
<p>dataframe</p>
</td></tr>
<tr><td><code id="get_site_mean_ae_dev_+3A_df_pat">df_pat</code></td>
<td>
<p>dataframe as returned by pat_aggr()</p>
</td></tr>
<tr><td><code id="get_site_mean_ae_dev_+3A_df_site">df_site</code></td>
<td>
<p>dataframe as returned by site_aggr()</p>
</td></tr>
</table>


<h3>Value</h3>

<p>dataframe
</p>

<hr>
<h2 id='get_visit_med75'>Get visit_med75.</h2><span id='topic+get_visit_med75'></span>

<h3>Description</h3>

<p>Internal function used by <code><a href="#topic+site_aggr">site_aggr()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_visit_med75(df_pat, method = "med75_adj", min_pat_pool = 0.2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_visit_med75_+3A_df_pat">df_pat</code></td>
<td>
<p>dataframe as returned by <code><a href="#topic+pat_aggr">pat_aggr()</a></code></p>
</td></tr>
<tr><td><code id="get_visit_med75_+3A_method">method</code></td>
<td>
<p>character, one of c(&quot;med75&quot;, &quot;med75_adj&quot;) defining method for
defining evaluation point visit_med75 (see details), Default: &quot;med75_adj&quot;</p>
</td></tr>
<tr><td><code id="get_visit_med75_+3A_min_pat_pool">min_pat_pool</code></td>
<td>
<p>double, minimum ratio of available patients available for
sampling. Determines maximum visit_med75 value see Details. Default: 0.2</p>
</td></tr>
</table>


<h3>Value</h3>

<p>dataframe
</p>

<hr>
<h2 id='is_orivisit'>is orivisit class</h2><span id='topic+is_orivisit'></span>

<h3>Description</h3>

<p>internal function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_orivisit(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is_orivisit_+3A_x">x</code></td>
<td>
<p>object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>logical
</p>

<hr>
<h2 id='is_simaerep'>is simaerep class</h2><span id='topic+is_simaerep'></span>

<h3>Description</h3>

<p>internal function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_simaerep(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is_simaerep_+3A_x">x</code></td>
<td>
<p>object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>logical
</p>

<hr>
<h2 id='orivisit'>create orivisit object</h2><span id='topic+orivisit'></span>

<h3>Description</h3>

<p>Internal S3 object, stores lazy reference to original visit
data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>orivisit(df_visit, call = NULL, env = parent.frame())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="orivisit_+3A_df_visit">df_visit</code></td>
<td>
<p>dataframe with original visit data</p>
</td></tr>
<tr><td><code id="orivisit_+3A_call">call</code></td>
<td>
<p>optional, provide call, Default: NULL</p>
</td></tr>
<tr><td><code id="orivisit_+3A_env">env</code></td>
<td>
<p>optional, provide environment of original visit data, Default: parent.frame()</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Saves variable name of original visit data, checks whether it can be
retrieved from parent environment and stores summary. Original data can be
retrieved using as.data.frame(x).
</p>


<h3>Value</h3>

<p>orivisit object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
df_visit &lt;- sim_test_data_study(
  n_pat = 100,
  n_sites = 5,
  frac_site_with_ur = 0.4,
  ur_rate = 0.6
)

df_visit$study_id &lt;- "A"

visit &lt;- orivisit(df_visit)

object.size(df_visit)
object.size(visit)

as.data.frame(visit)

</code></pre>

<hr>
<h2 id='pat_aggr'>Aggregate visit to patient level.</h2><span id='topic+pat_aggr'></span>

<h3>Description</h3>

<p>Internal function used by <code><a href="#topic+site_aggr">site_aggr()</a></code> and
<code><a href="#topic+plot_visit_med75">plot_visit_med75()</a></code>, adds the maximum visit for each patient.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pat_aggr(df_visit)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pat_aggr_+3A_df_visit">df_visit</code></td>
<td>
<p>dataframe</p>
</td></tr>
</table>


<h3>Value</h3>

<p>dataframe
</p>

<hr>
<h2 id='pat_pool'>Create a study specific patient pool for sampling</h2><span id='topic+pat_pool'></span>

<h3>Description</h3>

<p>Internal function for <code><a href="#topic+sim_sites">sim_sites</a></code>,
filter all visits greater than max_visit_med75_study
returns dataframe with one column for studies and one column with nested
patient data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pat_pool(df_visit, df_site)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pat_pool_+3A_df_visit">df_visit</code></td>
<td>
<p>dataframe, created by <code><a href="#topic+sim_sites">sim_sites</a></code></p>
</td></tr>
<tr><td><code id="pat_pool_+3A_df_site">df_site</code></td>
<td>
<p>dataframe created by <code><a href="#topic+site_aggr">site_aggr</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>dataframe with nested pat_pool column
</p>


<h3>Examples</h3>

<pre><code class='language-R'>df_visit &lt;- sim_test_data_study(
  n_pat = 100,
  n_sites = 5,
  frac_site_with_ur = 0.4,
  ur_rate = 0.6
)

df_visit$study_id &lt;- "A"

df_site &lt;- site_aggr(df_visit)

df_pat_pool &lt;- pat_pool(df_visit, df_site)

df_pat_pool
</code></pre>

<hr>
<h2 id='plot_dots'>Plots AE per site as dots.</h2><span id='topic+plot_dots'></span>

<h3>Description</h3>

<p>This plot is meant to supplement the package documentation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_dots(
  df,
  nrow = 10,
  ncols = 10,
  col_group = "site",
  thresh = NULL,
  color_site_a = "#BDBDBD",
  color_site_b = "#757575",
  color_site_c = "gold3",
  color_high = "#00695C",
  color_low = "#25A69A",
  size_dots = 10
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_dots_+3A_df">df</code></td>
<td>
<p>dataframe, cols = c('site', 'patients', 'n_ae')</p>
</td></tr>
<tr><td><code id="plot_dots_+3A_nrow">nrow</code></td>
<td>
<p>integer, number of rows, Default: 10</p>
</td></tr>
<tr><td><code id="plot_dots_+3A_ncols">ncols</code></td>
<td>
<p>integer, number of columns, Default: 10</p>
</td></tr>
<tr><td><code id="plot_dots_+3A_col_group">col_group</code></td>
<td>
<p>character, grouping column, Default: 'site'</p>
</td></tr>
<tr><td><code id="plot_dots_+3A_thresh">thresh</code></td>
<td>
<p>numeric, threshold to determine color of mean_ae annotation, Default: NULL</p>
</td></tr>
<tr><td><code id="plot_dots_+3A_color_site_a">color_site_a</code></td>
<td>
<p>character, hex color value, Default: '#BDBDBD'</p>
</td></tr>
<tr><td><code id="plot_dots_+3A_color_site_b">color_site_b</code></td>
<td>
<p>character, hex color value, Default: '#757575'</p>
</td></tr>
<tr><td><code id="plot_dots_+3A_color_site_c">color_site_c</code></td>
<td>
<p>character, hex color value, Default: 'gold3'</p>
</td></tr>
<tr><td><code id="plot_dots_+3A_color_high">color_high</code></td>
<td>
<p>character, hex color value, Default: '#00695C'</p>
</td></tr>
<tr><td><code id="plot_dots_+3A_color_low">color_low</code></td>
<td>
<p>character, hex color value, Default: '#25A69A'</p>
</td></tr>
<tr><td><code id="plot_dots_+3A_size_dots">size_dots</code></td>
<td>
<p>integer, Default: 10</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ggplot object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>study &lt;- tibble::tibble(
  site = LETTERS[1:3],
  patients = c(list(seq(1, 50, 1)), list(seq(1, 40, 1)), list(seq(1, 10, 1)))
) %&gt;%
  tidyr::unnest(patients) %&gt;%
  dplyr::mutate(n_ae = as.integer(runif(min = 0, max = 10, n = nrow(.))))

plot_dots(study)
</code></pre>

<hr>
<h2 id='plot_sim_example'>Plot simulation example.</h2><span id='topic+plot_sim_example'></span>

<h3>Description</h3>

<p>This plots supplements the package documentation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_sim_example(
  substract_ae_per_pat = 0,
  size_dots = 10,
  size_raster_label = 12,
  color_site_a = "#BDBDBD",
  color_site_b = "#757575",
  color_site_c = "gold3",
  color_high = "#00695C",
  color_low = "#25A69A",
  title = TRUE,
  legend = TRUE,
  seed = 5
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_sim_example_+3A_substract_ae_per_pat">substract_ae_per_pat</code></td>
<td>
<p>integer, subtract aes from patients at site C, Default: 0</p>
</td></tr>
<tr><td><code id="plot_sim_example_+3A_size_dots">size_dots</code></td>
<td>
<p>integer, Default: 10</p>
</td></tr>
<tr><td><code id="plot_sim_example_+3A_size_raster_label">size_raster_label</code></td>
<td>
<p>integer, Default: 12</p>
</td></tr>
<tr><td><code id="plot_sim_example_+3A_color_site_a">color_site_a</code></td>
<td>
<p>character, hex color value, Default: '#BDBDBD'</p>
</td></tr>
<tr><td><code id="plot_sim_example_+3A_color_site_b">color_site_b</code></td>
<td>
<p>character, hex color value, Default: '#757575'</p>
</td></tr>
<tr><td><code id="plot_sim_example_+3A_color_site_c">color_site_c</code></td>
<td>
<p>character, hex color value, Default: 'gold3'</p>
</td></tr>
<tr><td><code id="plot_sim_example_+3A_color_high">color_high</code></td>
<td>
<p>character, hex color value, Default: '#00695C'</p>
</td></tr>
<tr><td><code id="plot_sim_example_+3A_color_low">color_low</code></td>
<td>
<p>character, hex color value, Default: '#25A69A'</p>
</td></tr>
<tr><td><code id="plot_sim_example_+3A_title">title</code></td>
<td>
<p>logical, include title, Default: T</p>
</td></tr>
<tr><td><code id="plot_sim_example_+3A_legend">legend</code></td>
<td>
<p>logical, include legend, Default: T</p>
</td></tr>
<tr><td><code id="plot_sim_example_+3A_seed">seed</code></td>
<td>
<p>pass seed for simulations Default: 5</p>
</td></tr>
</table>


<h3>Details</h3>

<p>uses <code><a href="#topic+plot_dots">plot_dots()</a></code> and adds 2 simulation panels, uses made-up
site config with three sites A,B,C simulating site C
</p>


<h3>Value</h3>

<p>ggplot
</p>


<h3>See Also</h3>

<p><code><a href="cowplot.html#topic+get_legend">get_legend</a></code>,<code><a href="cowplot.html#topic+plot_grid">plot_grid</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
plot_sim_example(size_dots = 5)

</code></pre>

<hr>
<h2 id='plot_sim_examples'>Plot multiple simulation examples.</h2><span id='topic+plot_sim_examples'></span>

<h3>Description</h3>

<p>This plot is meant to supplement the package documentation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_sim_examples(substract_ae_per_pat = c(0, 1, 3), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_sim_examples_+3A_substract_ae_per_pat">substract_ae_per_pat</code></td>
<td>
<p>integer, Default: c(0, 1, 3)</p>
</td></tr>
<tr><td><code id="plot_sim_examples_+3A_...">...</code></td>
<td>
<p>parameters passed to plot_sim_example()</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is a wrapper for plot_sim_example()
</p>


<h3>Value</h3>

<p>ggplot
</p>


<h3>See Also</h3>

<p><code><a href="cowplot.html#topic+ggdraw">ggdraw</a></code>,<code><a href="cowplot.html#topic+draw_label">draw_label</a></code>,<code><a href="cowplot.html#topic+plot_grid">plot_grid</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
plot_sim_examples(size_dot = 3, size_raster_label = 10)
plot_sim_examples()

</code></pre>

<hr>
<h2 id='plot_study'>Plot ae development of study and sites highlighting at risk sites.</h2><span id='topic+plot_study'></span>

<h3>Description</h3>

<p>Most suitable visual representation of the AE under-reporting statistics.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_study(
  df_visit,
  df_site,
  df_eval,
  study,
  df_al = NULL,
  n_sites = 16,
  pval = FALSE,
  prob_col = "prob_low_prob_ur"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_study_+3A_df_visit">df_visit</code></td>
<td>
<p>dataframe, created by <code><a href="#topic+sim_sites">sim_sites()</a></code></p>
</td></tr>
<tr><td><code id="plot_study_+3A_df_site">df_site</code></td>
<td>
<p>dataframe created by <code><a href="#topic+site_aggr">site_aggr()</a></code></p>
</td></tr>
<tr><td><code id="plot_study_+3A_df_eval">df_eval</code></td>
<td>
<p>dataframe created by <code><a href="#topic+eval_sites">eval_sites()</a></code></p>
</td></tr>
<tr><td><code id="plot_study_+3A_study">study</code></td>
<td>
<p>study</p>
</td></tr>
<tr><td><code id="plot_study_+3A_df_al">df_al</code></td>
<td>
<p>dataframe containing study_id, site_number, alert_level_site,
alert_level_study (optional), Default: NA</p>
</td></tr>
<tr><td><code id="plot_study_+3A_n_sites">n_sites</code></td>
<td>
<p>integer number of most at risk sites, Default: 16</p>
</td></tr>
<tr><td><code id="plot_study_+3A_pval">pval</code></td>
<td>
<p>logical show p-value, Default:FALSE</p>
</td></tr>
<tr><td><code id="plot_study_+3A_prob_col">prob_col</code></td>
<td>
<p>character, denotes probability column, Default: &quot;prob_low_prob_ur&quot;</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Left panel shows mean AE reporting per site (lightblue and darkblue
lines) against mean AE reporting of the entire study (golden line). Single
sites are plotted in descending order by AE under-reporting probability on
the right panel in which grey lines denote cumulative AE count of single
patients. Grey dots in the left panel plot indicate sites that were picked
for single plotting. AE under-reporting probability of dark blue lines
crossed threshold of 95%. Numbers in the upper left corner indicate the
ratio of patients that have been used for the analysis against the total
number of patients. Patients that have not been on the study long enough to
reach the evaluation point (visit_med75) will be ignored.
</p>


<h3>Value</h3>

<p>ggplot
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
df_visit &lt;- sim_test_data_study(n_pat = 1000, n_sites = 10,
    frac_site_with_ur = 0.2, ur_rate = 0.15, max_visit_sd = 8)

df_visit$study_id &lt;- "A"
df_site &lt;- site_aggr(df_visit)

df_sim_sites &lt;- sim_sites(df_site, df_visit, r = 100)

df_eval &lt;- eval_sites(df_sim_sites)

plot_study(df_visit, df_site, df_eval, study = "A")

</code></pre>

<hr>
<h2 id='plot_visit_med75'>Plot patient visits against visit_med75.</h2><span id='topic+plot_visit_med75'></span>

<h3>Description</h3>

<p>Plots cumulative AEs against visits for patients at sites of
given study and compares against visit_med75.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_visit_med75(
  df_visit,
  df_site = NULL,
  study_id_str,
  n_sites = 6,
  min_pat_pool = 0.2,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_visit_med75_+3A_df_visit">df_visit</code></td>
<td>
<p>dataframe</p>
</td></tr>
<tr><td><code id="plot_visit_med75_+3A_df_site">df_site</code></td>
<td>
<p>dataframe, as returned by <code><a href="#topic+site_aggr">site_aggr()</a></code></p>
</td></tr>
<tr><td><code id="plot_visit_med75_+3A_study_id_str">study_id_str</code></td>
<td>
<p>character, specify study in study_id column</p>
</td></tr>
<tr><td><code id="plot_visit_med75_+3A_n_sites">n_sites</code></td>
<td>
<p>integer, Default: 6</p>
</td></tr>
<tr><td><code id="plot_visit_med75_+3A_min_pat_pool">min_pat_pool</code></td>
<td>
<p>double, minimum ratio of available patients available for
sampling. Determines maximum visit_med75 value see Details. Default: 0.2</p>
</td></tr>
<tr><td><code id="plot_visit_med75_+3A_verbose">verbose</code></td>
<td>
<p>logical, Default: TRUE</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ggplot
</p>


<h3>Examples</h3>

<pre><code class='language-R'>df_visit &lt;- sim_test_data_study(n_pat = 120, n_sites = 6,
    frac_site_with_ur = 0.4, ur_rate = 0.6)

df_visit$study_id &lt;- "A"
df_site &lt;- site_aggr(df_visit)

plot_visit_med75(df_visit, df_site, study_id_str = "A", n_site = 6)
</code></pre>

<hr>
<h2 id='plot.simaerep'>plot AE under-reporting simulation results</h2><span id='topic+plot.simaerep'></span>

<h3>Description</h3>

<p>generic plot function for simaerep objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'simaerep'
plot(
  x,
  ...,
  study = NULL,
  what = "ur",
  n_sites = 16,
  df_visit = NULL,
  env = parent.frame()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.simaerep_+3A_x">x</code></td>
<td>
<p>simaerep object</p>
</td></tr>
<tr><td><code id="plot.simaerep_+3A_...">...</code></td>
<td>
<p>additional parameters passed to <a href="#topic+plot_study">plot_study()</a> or
<a href="#topic+plot_visit_med75">plot_visit_med75()</a></p>
</td></tr>
<tr><td><code id="plot.simaerep_+3A_study">study</code></td>
<td>
<p>character specifying study to be plotted, Default: NULL</p>
</td></tr>
<tr><td><code id="plot.simaerep_+3A_what">what</code></td>
<td>
<p>one of c(&quot;ur&quot;, &quot;med75&quot;), specifying whether to plot site AE
under-reporting or visit_med75 values, Default: 'ur'</p>
</td></tr>
<tr><td><code id="plot.simaerep_+3A_n_sites">n_sites</code></td>
<td>
<p>number of sites to plot, Default: 16</p>
</td></tr>
<tr><td><code id="plot.simaerep_+3A_df_visit">df_visit</code></td>
<td>
<p>optional, pass original visit data if it cannot be retrieved
from parent environment, Default: NULL</p>
</td></tr>
<tr><td><code id="plot.simaerep_+3A_env">env</code></td>
<td>
<p>optional, pass environment from which to retrieve original visit
data, Default: parent.frame()</p>
</td></tr>
</table>


<h3>Details</h3>

<p>see <a href="#topic+plot_study">plot_study()</a> and
<a href="#topic+plot_visit_med75">plot_visit_med75()</a>
</p>


<h3>Value</h3>

<p>ggplot object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
df_visit &lt;- sim_test_data_study(
  n_pat = 100,
  n_sites = 5,
  frac_site_with_ur = 0.4,
  ur_rate = 0.6
)

df_visit$study_id &lt;- "A"

aerep &lt;- simaerep(df_visit)

plot(aerep, what = "ur", study = "A")
plot(aerep, what = "med75", study = "A")

</code></pre>

<hr>
<h2 id='poiss_test_site_ae_vs_study_ae'>Poisson test for vector with site AEs vs vector with study AEs.</h2><span id='topic+poiss_test_site_ae_vs_study_ae'></span>

<h3>Description</h3>

<p>Internal function used by <code><a href="#topic+sim_sites">sim_sites()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>poiss_test_site_ae_vs_study_ae(site_ae, study_ae, visit_med75)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="poiss_test_site_ae_vs_study_ae_+3A_site_ae">site_ae</code></td>
<td>
<p>vector with AE numbers</p>
</td></tr>
<tr><td><code id="poiss_test_site_ae_vs_study_ae_+3A_study_ae">study_ae</code></td>
<td>
<p>vector with AE numbers</p>
</td></tr>
<tr><td><code id="poiss_test_site_ae_vs_study_ae_+3A_visit_med75">visit_med75</code></td>
<td>
<p>integer</p>
</td></tr>
</table>


<h3>Details</h3>

<p>sets pvalue=1 if mean AE site is greater than mean AE study or ttest gives error
</p>


<h3>Value</h3>

<p>pval
</p>


<h3>See Also</h3>

<p><code><a href="#topic+sim_sites">sim_sites()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>poiss_test_site_ae_vs_study_ae(
   site_ae = c(5, 3, 3, 2, 1, 6),
   study_ae = c(9, 8, 7, 9, 6, 7, 8),
   visit_med75 = 10
)

poiss_test_site_ae_vs_study_ae(
   site_ae = c(11, 9, 8, 6, 3),
   study_ae = c(9, 8, 7, 9, 6, 7, 8),
   visit_med75 = 10
)
</code></pre>

<hr>
<h2 id='prep_for_sim'>Prepare data for simulation.</h2><span id='topic+prep_for_sim'></span>

<h3>Description</h3>

<p>Internal function called by <code><a href="#topic+sim_sites">sim_sites</a></code>.
Collect AEs per patient at visit_med75 for site and study as a vector of
integers.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prep_for_sim(df_site, df_visit)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="prep_for_sim_+3A_df_site">df_site</code></td>
<td>
<p>dataframe created by <code><a href="#topic+site_aggr">site_aggr</a></code></p>
</td></tr>
<tr><td><code id="prep_for_sim_+3A_df_visit">df_visit</code></td>
<td>
<p>dataframe, created by <code><a href="#topic+sim_sites">sim_sites</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>dataframe
</p>


<h3>See Also</h3>

<p><code><a href="#topic+sim_sites">sim_sites</a></code>, <code><a href="#topic+sim_after_prep">sim_after_prep</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>df_visit &lt;- sim_test_data_study(
   n_pat = 100,
   n_sites = 5,
   frac_site_with_ur = 0.4,
   ur_rate = 0.2
)

df_visit$study_id &lt;- "A"

df_site &lt;- site_aggr(df_visit)

df_prep &lt;- prep_for_sim(df_site, df_visit)
df_prep
</code></pre>

<hr>
<h2 id='prob_lower_site_ae_vs_study_ae'>Calculate bootstrapped probability for obtaining a lower site mean AE number.</h2><span id='topic+prob_lower_site_ae_vs_study_ae'></span>

<h3>Description</h3>

<p>Internal function used by <code><a href="#topic+sim_sites">sim_sites()</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prob_lower_site_ae_vs_study_ae(
  site_ae,
  study_ae,
  r = 1000,
  parallel = FALSE,
  under_only = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="prob_lower_site_ae_vs_study_ae_+3A_site_ae">site_ae</code></td>
<td>
<p>vector with AE numbers</p>
</td></tr>
<tr><td><code id="prob_lower_site_ae_vs_study_ae_+3A_study_ae">study_ae</code></td>
<td>
<p>vector with AE numbers</p>
</td></tr>
<tr><td><code id="prob_lower_site_ae_vs_study_ae_+3A_r">r</code></td>
<td>
<p>integer, denotes number of simulations, default = 1000</p>
</td></tr>
<tr><td><code id="prob_lower_site_ae_vs_study_ae_+3A_parallel">parallel</code></td>
<td>
<p>logical, toggles parallel processing on and of, default = F</p>
</td></tr>
<tr><td><code id="prob_lower_site_ae_vs_study_ae_+3A_under_only">under_only</code></td>
<td>
<p>compute under-reporting probabilities only, default = TRUE</p>
</td></tr>
</table>


<h3>Details</h3>

<p>sets pvalue=1 if mean AE site is greater than mean AE study
</p>


<h3>Value</h3>

<p>pval
</p>


<h3>See Also</h3>

<p><code><a href="purrr.html#topic+safely">safely</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>prob_lower_site_ae_vs_study_ae(
  site_ae = c(5, 3, 3, 2, 1, 6),
  study_ae = c(9, 8, 7, 9, 6, 7, 8),
  parallel = FALSE
)
</code></pre>

<hr>
<h2 id='purrr_bar'>Execute a purrr or furrr function with a progress
bar.</h2><span id='topic+purrr_bar'></span>

<h3>Description</h3>

<p>Internal utility function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>purrr_bar(
  ...,
  .purrr,
  .f,
  .f_args = list(),
  .purrr_args = list(),
  .steps,
  .slow = FALSE,
  .progress = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="purrr_bar_+3A_...">...</code></td>
<td>
<p>iterable arguments passed to .purrr</p>
</td></tr>
<tr><td><code id="purrr_bar_+3A_.purrr">.purrr</code></td>
<td>
<p>purrr or furrr function</p>
</td></tr>
<tr><td><code id="purrr_bar_+3A_.f">.f</code></td>
<td>
<p>function to be executed over iterables</p>
</td></tr>
<tr><td><code id="purrr_bar_+3A_.f_args">.f_args</code></td>
<td>
<p>list of arguments passed to .f, Default: list()</p>
</td></tr>
<tr><td><code id="purrr_bar_+3A_.purrr_args">.purrr_args</code></td>
<td>
<p>list of arguments passed to .purrr, Default: list()</p>
</td></tr>
<tr><td><code id="purrr_bar_+3A_.steps">.steps</code></td>
<td>
<p>integer number of iterations</p>
</td></tr>
<tr><td><code id="purrr_bar_+3A_.slow">.slow</code></td>
<td>
<p>logical slows down execution, Default: FALSE</p>
</td></tr>
<tr><td><code id="purrr_bar_+3A_.progress">.progress</code></td>
<td>
<p>logical, show progress bar, Default: TRUE</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Call still needs to be wrapped in <code><a href="progressr.html#topic+with_progress">with_progress</a></code>
or <code><a href="#topic+with_progress_cnd">with_progress_cnd()</a></code>
</p>


<h3>Value</h3>

<p>result of function passed to .f
</p>


<h3>Examples</h3>

<pre><code class='language-R'># purrr::map
progressr::with_progress(
  purrr_bar(rep(0.25, 5), .purrr = purrr::map, .f = Sys.sleep, .steps = 5)
)


# purrr::walk
progressr::with_progress(
 purrr_bar(rep(0.25, 5), .purrr = purrr::walk,.f = Sys.sleep, .steps = 5)
)

# progress bar off
progressr::with_progress(
  purrr_bar(
    rep(0.25, 5), .purrr = purrr::walk,.f = Sys.sleep, .steps = 5, .progress = FALSE
  )
)

# purrr::map2
progressr::with_progress(
  purrr_bar(
    rep(1, 5), rep(2, 5),
    .purrr = purrr::map2,
    .f = `+`,
    .steps = 5,
    .slow = TRUE
 )
)

# purrr::pmap
progressr::with_progress(
  purrr_bar(
    list(rep(1, 5), rep(2, 5)),
    .purrr = purrr::pmap,
    .f = `+`,
    .steps = 5,
    .slow = TRUE
 )
)

# define function within purr_bar() call
progressr::with_progress(
  purrr_bar(
    list(rep(1, 5), rep(2, 5)),
    .purrr = purrr::pmap,
    .f = function(x, y) {
      paste0(x, y)
    },
    .steps = 5,
    .slow = TRUE
 )
)

# with mutate
progressr::with_progress(
 tibble::tibble(x = rep(0.25, 5)) %&gt;%
  dplyr::mutate(x = purrr_bar(x, .purrr = purrr::map, .f = Sys.sleep, .steps = 5))
)

</code></pre>

<hr>
<h2 id='sim_after_prep'>Start simulation after preparation.</h2><span id='topic+sim_after_prep'></span>

<h3>Description</h3>

<p>Internal function called by <code><a href="#topic+sim_sites">sim_sites</a></code>
after <code><a href="#topic+prep_for_sim">prep_for_sim</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim_after_prep(
  df_sim_prep,
  r = 1000,
  poisson_test = FALSE,
  prob_lower = TRUE,
  progress = FALSE,
  under_only = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sim_after_prep_+3A_df_sim_prep">df_sim_prep</code></td>
<td>
<p>dataframe as returned by
<code><a href="#topic+prep_for_sim">prep_for_sim</a></code></p>
</td></tr>
<tr><td><code id="sim_after_prep_+3A_r">r</code></td>
<td>
<p>integer, denotes number of simulations, default = 1000</p>
</td></tr>
<tr><td><code id="sim_after_prep_+3A_poisson_test">poisson_test</code></td>
<td>
<p>logical, calculates poisson.test pvalue</p>
</td></tr>
<tr><td><code id="sim_after_prep_+3A_prob_lower">prob_lower</code></td>
<td>
<p>logical, calculates probability for getting a lower value</p>
</td></tr>
<tr><td><code id="sim_after_prep_+3A_progress">progress</code></td>
<td>
<p>logical, display progress bar, Default = TRUE</p>
</td></tr>
<tr><td><code id="sim_after_prep_+3A_under_only">under_only</code></td>
<td>
<p>compute under-reporting probabilities only, default = TRUE
<a href="#topic+check_df_visit">check_df_visit()</a>, computationally expensive on large data
sets. Default: TRUE</p>
</td></tr>
</table>


<h3>Value</h3>

<p>dataframe
</p>


<h3>See Also</h3>

<p><code><a href="#topic+sim_sites">sim_sites</a></code>,
<code><a href="#topic+prep_for_sim">prep_for_sim</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>df_visit &lt;- sim_test_data_study(
   n_pat = 100,
   n_sites = 5,
   frac_site_with_ur = 0.4,
   ur_rate = 0.2
)

df_visit$study_id &lt;- "A"

df_site &lt;- site_aggr(df_visit)

df_prep &lt;- prep_for_sim(df_site, df_visit)

df_sim &lt;- sim_after_prep(df_prep)

df_sim
</code></pre>

<hr>
<h2 id='sim_scenario'>simulate single scenario</h2><span id='topic+sim_scenario'></span>

<h3>Description</h3>

<p>internal function called by simulate_scenarios()
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim_scenario(n_ae_site, n_ae_study, frac_pat_with_ur, ur_rate)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sim_scenario_+3A_n_ae_site">n_ae_site</code></td>
<td>
<p>integer vector</p>
</td></tr>
<tr><td><code id="sim_scenario_+3A_n_ae_study">n_ae_study</code></td>
<td>
<p>integer vector</p>
</td></tr>
<tr><td><code id="sim_scenario_+3A_frac_pat_with_ur">frac_pat_with_ur</code></td>
<td>
<p>double</p>
</td></tr>
<tr><td><code id="sim_scenario_+3A_ur_rate">ur_rate</code></td>
<td>
<p>double</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sim_scenario(c(5,5,5,5), c(8,8,8,8), 0.2, 0.5)
sim_scenario(c(5,5,5,5), c(8,8,8,8), 0.75, 0.5)
sim_scenario(c(5,5,5,5), c(8,8,8,8), 1, 0.5)
sim_scenario(c(5,5,5,5), c(8,8,8,8), 1, 1)
sim_scenario(c(5,5,5,5), c(8,8,8,8), 0, 0.5)
sim_scenario(c(5,5,5,5), c(8,8,8,8), 2, 0.5)
</code></pre>

<hr>
<h2 id='sim_sites'>Calculate prob_lower and poisson.test pvalue for study sites.</h2><span id='topic+sim_sites'></span>

<h3>Description</h3>

<p>Collects the number of AEs of all eligible patients that
meet visit_med75 criteria of site. Then  calculates poisson.test pvalue and
bootstrapped probability of having a lower mean value.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim_sites(
  df_site,
  df_visit,
  r = 1000,
  poisson_test = TRUE,
  prob_lower = TRUE,
  progress = TRUE,
  check = TRUE,
  under_only = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sim_sites_+3A_df_site">df_site</code></td>
<td>
<p>dataframe created by <code><a href="#topic+site_aggr">site_aggr</a></code></p>
</td></tr>
<tr><td><code id="sim_sites_+3A_df_visit">df_visit</code></td>
<td>
<p>dataframe, created by <code><a href="#topic+sim_sites">sim_sites</a></code></p>
</td></tr>
<tr><td><code id="sim_sites_+3A_r">r</code></td>
<td>
<p>integer, denotes number of simulations, default = 1000</p>
</td></tr>
<tr><td><code id="sim_sites_+3A_poisson_test">poisson_test</code></td>
<td>
<p>logical, calculates poisson.test pvalue</p>
</td></tr>
<tr><td><code id="sim_sites_+3A_prob_lower">prob_lower</code></td>
<td>
<p>logical, calculates probability for getting a lower value</p>
</td></tr>
<tr><td><code id="sim_sites_+3A_progress">progress</code></td>
<td>
<p>logical, display progress bar, Default = TRUE</p>
</td></tr>
<tr><td><code id="sim_sites_+3A_check">check</code></td>
<td>
<p>logical, perform data check and attempt repair with</p>
</td></tr>
<tr><td><code id="sim_sites_+3A_under_only">under_only</code></td>
<td>
<p>compute under-reporting probabilities only, default = TRUE
<a href="#topic+check_df_visit">check_df_visit()</a>, computationally expensive on large data
sets. Default: TRUE</p>
</td></tr>
</table>


<h3>Value</h3>

<p>dataframe with the following columns:
</p>

<dl>
<dt><strong>study_id</strong></dt><dd><p>study identification</p>
</dd>
<dt><strong>site_number</strong></dt><dd><p>site identification</p>
</dd>
<dt><strong>n_pat</strong></dt><dd><p>number of patients at site</p>
</dd>
<dt><strong>visit_med75</strong></dt><dd><p>median(max(visit)) * 0.75</p>
</dd>
<dt><strong>n_pat_with_med75</strong></dt><dd><p>number of patients at site with med75</p>
</dd>
<dt><strong>mean_ae_site_med75</strong></dt><dd><p>mean AE at visit_med75 site level</p>
</dd>
<dt><strong>mean_ae_study_med75</strong></dt><dd><p>mean AE at visit_med75 study level</p>
</dd>
<dt><strong>n_pat_with_med75_study</strong></dt><dd><p>number of patients at study with med75 excl. site</p>
</dd>
<dt><strong>pval</strong></dt><dd><p>p-value as returned by <code><a href="stats.html#topic+poisson.test">poisson.test</a></code></p>
</dd>
<dt><strong>prob_low</strong></dt><dd><p>bootstrapped probability for having mean_ae_site_med75 or lower</p>
</dd>
</dl>



<h3>See Also</h3>

<p><code><a href="#topic+sim_sites">sim_sites</a></code>,
<code><a href="#topic+site_aggr">site_aggr</a></code>,
<code><a href="#topic+pat_pool">pat_pool</a></code>,
<code><a href="#topic+prob_lower_site_ae_vs_study_ae">prob_lower_site_ae_vs_study_ae</a></code>,
<code><a href="#topic+poiss_test_site_ae_vs_study_ae">poiss_test_site_ae_vs_study_ae</a></code>,
<code><a href="#topic+sim_sites">sim_sites</a></code>,
<code><a href="#topic+prep_for_sim">prep_for_sim</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>df_visit &lt;- sim_test_data_study(
   n_pat = 100,
   n_sites = 5,
   frac_site_with_ur = 0.4,
   ur_rate = 0.2
)

df_visit$study_id &lt;- "A"

df_site &lt;- site_aggr(df_visit)

df_sim_sites &lt;- sim_sites(df_site, df_visit, r = 100)

df_sim_sites %&gt;%
 knitr::kable(digits = 2)
</code></pre>

<hr>
<h2 id='sim_studies'>Simulate studies.</h2><span id='topic+sim_studies'></span>

<h3>Description</h3>

<p>Test function, test applicability of poisson test, by
calculating a the bootstrapped probability of obtaining a specific p-value
or lower, use in combination with <code><a href="#topic+get_ecd_values">get_ecd_values()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim_studies(
  df_visit,
  df_site,
  r = 100,
  poisson_test = TRUE,
  prob_lower = TRUE,
  r_prob_lower = 1000,
  under_only = TRUE,
  parallel = FALSE,
  keep_ae = FALSE,
  min_n_pat_with_med75 = 1,
  studies = NULL,
  .progress = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sim_studies_+3A_df_visit">df_visit</code></td>
<td>
<p>dataframe</p>
</td></tr>
<tr><td><code id="sim_studies_+3A_df_site">df_site</code></td>
<td>
<p>dataframe</p>
</td></tr>
<tr><td><code id="sim_studies_+3A_r">r</code></td>
<td>
<p>integer, denotes number of simulations, Default: 1000</p>
</td></tr>
<tr><td><code id="sim_studies_+3A_poisson_test">poisson_test</code></td>
<td>
<p>logical, calculates poisson.test pvalue, Default: TRUE</p>
</td></tr>
<tr><td><code id="sim_studies_+3A_prob_lower">prob_lower</code></td>
<td>
<p>logical, calculates probability for getting a lower value,
Default: FALSE</p>
</td></tr>
<tr><td><code id="sim_studies_+3A_r_prob_lower">r_prob_lower</code></td>
<td>
<p>integer, denotes number of simulations for prob_lower
value calculation,, Default: 1000</p>
</td></tr>
<tr><td><code id="sim_studies_+3A_under_only">under_only</code></td>
<td>
<p>compute under-reporting probabilities only, default = TRUE</p>
</td></tr>
<tr><td><code id="sim_studies_+3A_parallel">parallel</code></td>
<td>
<p>logical, see examples for registering parallel processing framework
, Default: FALSE</p>
</td></tr>
<tr><td><code id="sim_studies_+3A_keep_ae">keep_ae</code></td>
<td>
<p>logical, keep ae numbers in output dataframe memory increase
roughly 30 percent, Default: F</p>
</td></tr>
<tr><td><code id="sim_studies_+3A_min_n_pat_with_med75">min_n_pat_with_med75</code></td>
<td>
<p>integer, min number of patients with med75 at
site to simulate, Default: 1</p>
</td></tr>
<tr><td><code id="sim_studies_+3A_studies">studies</code></td>
<td>
<p>vector with study names, Default: NULL</p>
</td></tr>
<tr><td><code id="sim_studies_+3A_.progress">.progress</code></td>
<td>
<p>logical, show progress bar</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Here we simulate study replicates maintaining the same number of
sites, patients and visit_med75 by bootstrap resampling, then probabilities
for obtaining lower or same mean_ae count and p-values using poisson.test
are calculated.
</p>
<p>adds column with simulated probabilities for equal or lower
mean_ae at visit_med75
</p>


<h3>Value</h3>

<p>dataframe
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
df_visit1 &lt;- sim_test_data_study(n_pat = 100, n_sites = 5,
                                      frac_site_with_ur = 0.4, ur_rate = 0.6)

df_visit1$study_id &lt;- "A"

df_visit2 &lt;- sim_test_data_study(n_pat = 1000, n_sites = 3,
                                      frac_site_with_ur = 0.2, ur_rate = 0.1)

df_visit2$study_id &lt;- "B"

df_visit &lt;- dplyr::bind_rows(df_visit1, df_visit2)

df_site &lt;- site_aggr(df_visit)

sim_studies(df_visit, df_site, r = 3, keep_ae = TRUE)

## Not run: 
# parallel processing -------------------------
library(future)
future::plan(multiprocess)
sim_studies(df_visit, df_site, r = 3, keep_ae = TRUE, parallel = TRUE)
future::plan(sequential)

## End(Not run)
</code></pre>

<hr>
<h2 id='sim_test_data_patient'>simulate patient ae reporting test data</h2><span id='topic+sim_test_data_patient'></span>

<h3>Description</h3>

<p>helper function for <code><a href="#topic+sim_test_data_study">sim_test_data_study()</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim_test_data_patient(
  .f_sample_max_visit = function() rnorm(1, mean = 20, sd = 4),
  .f_sample_ae_per_visit = function(max_visit) rpois(max_visit, 0.5)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sim_test_data_patient_+3A_.f_sample_max_visit">.f_sample_max_visit</code></td>
<td>
<p>function used to sample the maximum number of aes,
Default: function() rnorm(1, mean = 20, sd = 4)</p>
</td></tr>
<tr><td><code id="sim_test_data_patient_+3A_.f_sample_ae_per_visit">.f_sample_ae_per_visit</code></td>
<td>
<p>function used to sample the aes for each visit,
Default: function(x) rpois(x, 0.5)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>&quot;&quot;
</p>


<h3>Value</h3>

<p>vector containing cumulative aes
</p>


<h3>Examples</h3>

<pre><code class='language-R'>replicate(5, sim_test_data_patient())
replicate(5, sim_test_data_patient(
    .f_sample_ae_per_visit = function(x) rpois(x, 1.2))
  )
replicate(5, sim_test_data_patient(
    .f_sample_max_visit = function() rnorm(1, mean = 5, sd = 5))
  )
</code></pre>

<hr>
<h2 id='sim_test_data_portfolio'>Simulate Portfolio Test Data</h2><span id='topic+sim_test_data_portfolio'></span>

<h3>Description</h3>

<p>Simulate visit level data from a portfolio configuration.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim_test_data_portfolio(
  df_config,
  df_ae_rates = NULL,
  parallel = FALSE,
  progress = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sim_test_data_portfolio_+3A_df_config">df_config</code></td>
<td>
<p>dataframe as returned by <code><a href="#topic+get_config">get_config</a></code></p>
</td></tr>
<tr><td><code id="sim_test_data_portfolio_+3A_df_ae_rates">df_ae_rates</code></td>
<td>
<p>dataframe with ae rates. Default: NULL</p>
</td></tr>
<tr><td><code id="sim_test_data_portfolio_+3A_parallel">parallel</code></td>
<td>
<p>logical activate parallel processing, see details, Default: FALSE</p>
</td></tr>
<tr><td><code id="sim_test_data_portfolio_+3A_progress">progress</code></td>
<td>
<p>logical, Default: TRUE</p>
</td></tr>
</table>


<h3>Details</h3>

<p>uses <code><a href="#topic+sim_test_data_study">sim_test_data_study</a></code>.
We use the <code>furrr</code> package to
implement parallel processing as these simulations can take a long time to
run. For this to work we need to specify the plan for how the code should
run, e.g. 'plan(multisession, workers = 3)
</p>


<h3>Value</h3>

<p>dataframe with the following columns: </p>

<dl>
<dt><strong>study_id</strong></dt><dd><p>study identification</p>
</dd> <dt><strong>ae_per_visit_mean</strong></dt><dd><p>mean
AE per visit per study</p>
</dd> <dt><strong>site_number</strong></dt><dd><p>site</p>
</dd>
<dt><strong>max_visit_sd</strong></dt><dd><p>standard deviation of maximum patient visits per
site</p>
</dd> <dt><strong>max_visit_mean</strong></dt><dd><p>mean of maximum patient visits per site</p>
</dd>
<dt><strong>patnum</strong></dt><dd><p>number of patients</p>
</dd>
<dt><strong>visit</strong></dt><dd><p>visit number</p>
</dd>
<dt><strong>n_ae</strong></dt><dd><p>cumulative sum of AEs</p>
</dd>
</dl>



<h3>See Also</h3>

<p><code><a href="#topic+sim_test_data_study">sim_test_data_study</a></code>
<code><a href="#topic+get_config">get_config</a></code>
<code><a href="#topic+sim_test_data_portfolio">sim_test_data_portfolio</a></code>
<code><a href="#topic+sim_ur_scenarios">sim_ur_scenarios</a></code>
<code><a href="#topic+get_portf_perf">get_portf_perf</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
df_visit1 &lt;- sim_test_data_study(n_pat = 100, n_sites = 10,
                                 frac_site_with_ur = 0.4, ur_rate = 0.6)

df_visit1$study_id &lt;- "A"

df_visit2 &lt;- sim_test_data_study(n_pat = 100, n_sites = 10,
                                 frac_site_with_ur = 0.2, ur_rate = 0.1)

df_visit2$study_id &lt;- "B"

df_visit &lt;- dplyr::bind_rows(df_visit1, df_visit2)

df_site_max &lt;- df_visit %&gt;%
  dplyr::group_by(study_id, site_number, patnum) %&gt;%
  dplyr::summarise(max_visit = max(visit),
            max_ae = max(n_ae),
            .groups = "drop")

df_config &lt;- get_config(df_site_max)

df_config

df_portf &lt;- sim_test_data_portfolio(df_config)

df_portf

df_scen &lt;- sim_ur_scenarios(df_portf,
                            extra_ur_sites = 2,
                            ur_rate = c(0.5, 1))


df_scen

df_perf &lt;- get_portf_perf(df_scen)

df_perf

</code></pre>

<hr>
<h2 id='sim_test_data_study'>simulate study test data</h2><span id='topic+sim_test_data_study'></span>

<h3>Description</h3>

<p>evenly distributes a number of given patients across a number of
given sites. Then simulates ae development of each patient reducing the
number of reported AEs for patients distributed to AE-under-reporting
sites.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim_test_data_study(
  n_pat = 1000,
  n_sites = 20,
  frac_site_with_ur = 0,
  ur_rate = 0,
  max_visit_mean = 20,
  max_visit_sd = 4,
  ae_per_visit_mean = 0.5,
  ae_rates = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sim_test_data_study_+3A_n_pat">n_pat</code></td>
<td>
<p>integer, number of patients, Default: 1000</p>
</td></tr>
<tr><td><code id="sim_test_data_study_+3A_n_sites">n_sites</code></td>
<td>
<p>integer, number of sites, Default: 20</p>
</td></tr>
<tr><td><code id="sim_test_data_study_+3A_frac_site_with_ur">frac_site_with_ur</code></td>
<td>
<p>fraction of AE under-reporting sites, Default: 0</p>
</td></tr>
<tr><td><code id="sim_test_data_study_+3A_ur_rate">ur_rate</code></td>
<td>
<p>AE under-reporting rate, will lower mean ae per visit used to
simulate patients at sites flagged as AE-under-reporting. Negative Values
will simulate over-reporting., Default: 0</p>
</td></tr>
<tr><td><code id="sim_test_data_study_+3A_max_visit_mean">max_visit_mean</code></td>
<td>
<p>mean of the maximum number of visits of each patient,
Default: 20</p>
</td></tr>
<tr><td><code id="sim_test_data_study_+3A_max_visit_sd">max_visit_sd</code></td>
<td>
<p>standard deviation of maximum number of visits of each
patient, Default: 4</p>
</td></tr>
<tr><td><code id="sim_test_data_study_+3A_ae_per_visit_mean">ae_per_visit_mean</code></td>
<td>
<p>mean ae per visit per patient, Default: 0.5</p>
</td></tr>
<tr><td><code id="sim_test_data_study_+3A_ae_rates">ae_rates</code></td>
<td>
<p>vector with visit-specific ae rates, Default: Null</p>
</td></tr>
</table>


<h3>Details</h3>

<p>maximum visit number will be sampled from normal distribution with
characteristics derived from max_visit_mean and max_visit_sd, while the ae
per visit will be sampled from a poisson distribution described by
ae_per_visit_mean.
</p>


<h3>Value</h3>

<p>tibble with columns site_number, patnum, is_ur, max_visit_mean,
max_visit_sd, ae_per_visit_mean, visit, n_ae
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(1)
df_visit &lt;- sim_test_data_study(n_pat = 100, n_sites = 5)
df_visit[which(df_visit$patnum == "P000001"),]
df_visit &lt;- sim_test_data_study(n_pat = 100, n_sites = 5,
    frac_site_with_ur = 0.2, ur_rate = 0.5)
df_visit[which(df_visit$patnum == "P000001"),]
ae_rates &lt;- c(0.7, rep(0.5, 8), rep(0.3, 5))
sim_test_data_study(n_pat = 100, n_sites = 5, ae_rates = ae_rates)
</code></pre>

<hr>
<h2 id='sim_ur_scenarios'>Simulate Under-Reporting Scenarios</h2><span id='topic+sim_ur_scenarios'></span>

<h3>Description</h3>

<p>Use with simulated portfolio data to generate under-reporting
stats for specified scenarios.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim_ur_scenarios(
  df_portf,
  extra_ur_sites = 3,
  ur_rate = c(0.25, 0.5),
  r = 1000,
  poisson_test = FALSE,
  prob_lower = TRUE,
  parallel = FALSE,
  progress = TRUE,
  site_aggr_args = list(),
  eval_sites_args = list()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sim_ur_scenarios_+3A_df_portf">df_portf</code></td>
<td>
<p>dataframe as returned by <code><a href="#topic+sim_test_data_portfolio">sim_test_data_portfolio</a></code></p>
</td></tr>
<tr><td><code id="sim_ur_scenarios_+3A_extra_ur_sites">extra_ur_sites</code></td>
<td>
<p>numeric, set maximum number of additional
under-reporting sites, see details Default: 3</p>
</td></tr>
<tr><td><code id="sim_ur_scenarios_+3A_ur_rate">ur_rate</code></td>
<td>
<p>numeric vector, set under-reporting rates for scenarios
Default: c(0.25, 0.5)</p>
</td></tr>
<tr><td><code id="sim_ur_scenarios_+3A_r">r</code></td>
<td>
<p>integer, denotes number of simulations, default = 1000</p>
</td></tr>
<tr><td><code id="sim_ur_scenarios_+3A_poisson_test">poisson_test</code></td>
<td>
<p>logical, calculates poisson.test pvalue</p>
</td></tr>
<tr><td><code id="sim_ur_scenarios_+3A_prob_lower">prob_lower</code></td>
<td>
<p>logical, calculates probability for getting a lower value</p>
</td></tr>
<tr><td><code id="sim_ur_scenarios_+3A_parallel">parallel</code></td>
<td>
<p>logical, use parallel processing see details, Default: FALSE</p>
</td></tr>
<tr><td><code id="sim_ur_scenarios_+3A_progress">progress</code></td>
<td>
<p>logical, show progress bar, Default: TRUE</p>
</td></tr>
<tr><td><code id="sim_ur_scenarios_+3A_site_aggr_args">site_aggr_args</code></td>
<td>
<p>named list of parameters passed to
<code><a href="#topic+site_aggr">site_aggr</a></code>, Default: list()</p>
</td></tr>
<tr><td><code id="sim_ur_scenarios_+3A_eval_sites_args">eval_sites_args</code></td>
<td>
<p>named list of parameters passed to
<code><a href="#topic+eval_sites">eval_sites</a></code>, Default: list()</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function will apply under-reporting scenarios to each site.
Reducing the number of AEs by a given under-reporting (ur_rate) for all
patients at the site and add the corresponding under-reporting statistics.
Since the under-reporting probability is also affected by the number of
other sites that are under-reporting we additionally calculate
under-reporting statistics in a scenario where additional under reporting
sites are present. For this we use the median number of patients per site
at the study to calculate the final number of patients for which we lower
the AEs in a given under-reporting scenario. We use the furrr package to
implement parallel processing as these simulations can take a long time to
run. For this to work we need to specify the plan for how the code should
run, e.g. plan(multisession, workers = 18)
</p>


<h3>Value</h3>

<p>dataframe with the following columns:
</p>

<dl>
<dt><strong>study_id</strong></dt><dd><p>study identification</p>
</dd>
<dt><strong>site_number</strong></dt><dd><p>site identification</p>
</dd>
<dt><strong>n_pat</strong></dt><dd><p>number of patients at site</p>
</dd>
<dt><strong>n_pat_with_med75</strong></dt><dd><p>number of patients at site with visit_med75</p>
</dd>
<dt><strong>visit_med75</strong></dt><dd><p>median(max(visit)) * 0.75</p>
</dd>
<dt><strong>mean_ae_site_med75</strong></dt><dd><p>mean AE at visit_med75 site level</p>
</dd>
<dt><strong>mean_ae_study_med75</strong></dt><dd><p>mean AE at visit_med75 study level</p>
</dd>
<dt><strong>n_pat_with_med75_study</strong></dt><dd><p>number of patients at site with
visit_med75 at study excl site</p>
</dd>
<dt><strong>extra_ur_sites</strong></dt><dd><p>additional sites
with under-reporting patients</p>
</dd>
<dt><strong>frac_pat_with_ur</strong></dt><dd><p>ratio of
patients in study that are under-reporting</p>
</dd>
<dt><strong>ur_rate</strong></dt><dd><p>under-reporting rate</p>
</dd>
<dt><strong>pval</strong></dt><dd><p>p-value as
returned by <code><a href="stats.html#topic+poisson.test">poisson.test</a></code></p>
</dd>
<dt><strong>prob_low</strong></dt><dd><p>bootstrapped probability for having mean_ae_site_med75
or lower</p>
</dd> <dt><strong>pval_adj</strong></dt><dd><p>adjusted p-values</p>
</dd>
<dt><strong>prob_low_adj</strong></dt><dd><p>adjusted bootstrapped probability for having
mean_ae_site_med75 or lower</p>
</dd> <dt><strong>pval_prob_ur</strong></dt><dd><p>probability
under-reporting as 1 - pval_adj, poisson.test (use as benchmark)</p>
</dd>
<dt><strong>prob_low_prob_ur</strong></dt><dd><p>probability under-reporting as 1 -
prob_low_adj, bootstrapped (use)</p>
</dd>
</dl>



<h3>See Also</h3>

<p><code><a href="#topic+sim_test_data_study">sim_test_data_study</a></code>
<code><a href="#topic+get_config">get_config</a></code>
<code><a href="#topic+sim_test_data_portfolio">sim_test_data_portfolio</a></code>
<code><a href="#topic+sim_ur_scenarios">sim_ur_scenarios</a></code>
<code><a href="#topic+get_portf_perf">get_portf_perf</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
df_visit1 &lt;- sim_test_data_study(n_pat = 100, n_sites = 10,
                                 frac_site_with_ur = 0.4, ur_rate = 0.6)

df_visit1$study_id &lt;- "A"

df_visit2 &lt;- sim_test_data_study(n_pat = 100, n_sites = 10,
                                 frac_site_with_ur = 0.2, ur_rate = 0.1)

df_visit2$study_id &lt;- "B"

df_visit &lt;- dplyr::bind_rows(df_visit1, df_visit2)

df_site_max &lt;- df_visit %&gt;%
  dplyr::group_by(study_id, site_number, patnum) %&gt;%
  dplyr::summarise(max_visit = max(visit),
            max_ae = max(n_ae),
            .groups = "drop")

df_config &lt;- get_config(df_site_max)

df_config

df_portf &lt;- sim_test_data_portfolio(df_config)

df_portf

df_scen &lt;- sim_ur_scenarios(df_portf,
                            extra_ur_sites = 2,
                            ur_rate = c(0.5, 1))


df_scen

df_perf &lt;- get_portf_perf(df_scen)

df_perf

</code></pre>

<hr>
<h2 id='simaerep'>create simaerep object</h2><span id='topic+simaerep'></span>

<h3>Description</h3>

<p>simulate AE under-reporting probabilities
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simaerep(
  df_visit,
  param_site_aggr = list(method = "med75_adj", min_pat_pool = 0.2),
  param_sim_sites = list(r = 1000, poisson_test = FALSE, prob_lower = TRUE),
  param_eval_sites = list(method = "BH"),
  progress = TRUE,
  check = TRUE,
  env = parent.frame(),
  under_only = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simaerep_+3A_df_visit">df_visit</code></td>
<td>
<p>data frame with columns: study_id, site_number, patnum, visit,
n_ae</p>
</td></tr>
<tr><td><code id="simaerep_+3A_param_site_aggr">param_site_aggr</code></td>
<td>
<p>list of parameters passed to <a href="#topic+site_aggr">site_aggr()</a>,
Default: list(method = &quot;med75_adj&quot;, min_pat_pool = 0.2)</p>
</td></tr>
<tr><td><code id="simaerep_+3A_param_sim_sites">param_sim_sites</code></td>
<td>
<p>list of parameters passed to <a href="#topic+sim_sites">sim_sites()</a>,
Default: list(r = 1000, poisson_test = FALSE, prob_lower = TRUE)</p>
</td></tr>
<tr><td><code id="simaerep_+3A_param_eval_sites">param_eval_sites</code></td>
<td>
<p>list of parameters passed to
<a href="#topic+eval_sites">eval_sites()</a>, Default: list(method = &quot;BH&quot;)</p>
</td></tr>
<tr><td><code id="simaerep_+3A_progress">progress</code></td>
<td>
<p>logical, display progress bar, Default = TRUE</p>
</td></tr>
<tr><td><code id="simaerep_+3A_check">check</code></td>
<td>
<p>logical, perform data check and attempt repair with
<a href="#topic+check_df_visit">check_df_visit()</a>, computationally expensive on large data
sets. Default: TRUE</p>
</td></tr>
<tr><td><code id="simaerep_+3A_env">env</code></td>
<td>
<p>optional, provide environment of original visit data, Default:
parent.frame()</p>
</td></tr>
<tr><td><code id="simaerep_+3A_under_only">under_only</code></td>
<td>
<p>logical compute under-reporting probabilities only,
superseeds under_only parameter passed to <a href="#topic+eval_sites">eval_sites()</a> and
<a href="#topic+sim_sites">sim_sites()</a>, Default: TRUE</p>
</td></tr>
</table>


<h3>Details</h3>

<p>executes <a href="#topic+site_aggr">site_aggr()</a>, <a href="#topic+sim_sites">sim_sites()</a> and
<a href="#topic+eval_sites">eval_sites()</a> on original visit data and stores all
intermediate results. Stores lazy reference to original visit data for
facilitated plotting using generic plot(x).
</p>


<h3>Value</h3>

<p>simaerep object
</p>


<h3>See Also</h3>

<p><a href="#topic+site_aggr">site_aggr()</a>, <a href="#topic+sim_sites">sim_sites()</a>,
<a href="#topic+eval_sites">eval_sites()</a>, <a href="#topic+orivisit">orivisit()</a>,
<a href="#topic+plot.simaerep">plot.simaerep()</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
df_visit &lt;- sim_test_data_study(
  n_pat = 100,
  n_sites = 5,
  frac_site_with_ur = 0.4,
  ur_rate = 0.6
)

df_visit$study_id &lt;- "A"

aerep &lt;- simaerep(df_visit)

aerep

str(aerep)

</code></pre>

<hr>
<h2 id='site_aggr'>Aggregate from visit to site level.</h2><span id='topic+site_aggr'></span>

<h3>Description</h3>

<p>Calculates visit_med75, n_pat_with_med75 and mean_ae_site_med75
</p>


<h3>Usage</h3>

<pre><code class='language-R'>site_aggr(df_visit, method = "med75_adj", min_pat_pool = 0.2, check = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="site_aggr_+3A_df_visit">df_visit</code></td>
<td>
<p>dataframe with columns: study_id, site_number, patnum, visit,
n_ae</p>
</td></tr>
<tr><td><code id="site_aggr_+3A_method">method</code></td>
<td>
<p>character, one of c(&quot;med75&quot;, &quot;med75_adj&quot;) defining method for
defining evaluation point visit_med75 (see details), Default: &quot;med75_adj&quot;</p>
</td></tr>
<tr><td><code id="site_aggr_+3A_min_pat_pool">min_pat_pool</code></td>
<td>
<p>double, minimum ratio of available patients available for
sampling. Determines maximum visit_med75 value see Details. Default: 0.2</p>
</td></tr>
<tr><td><code id="site_aggr_+3A_check">check</code></td>
<td>
<p>logical, perform data check and attempt repair with
<a href="#topic+check_df_visit">check_df_visit()</a>, computationally expensive on large data
sets. Default: TRUE</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For determining the visit number at which we are going to evaluate AE
reporting we take the maximum visit of each patient at the site and take the
median. Then we multiply with 0.75 which will give us a cut-off point
determining which patient will be evaluated. Of those patients we will
evaluate we take the minimum of all maximum visits hence ensuring that we
take the highest visit number possible without excluding more patients from
the analysis. In order to ensure that the sampling pool for that visit is
large enough we limit the visit number by the 80% quantile of maximum visits
of all patients in the study.
</p>


<h3>Value</h3>

<p>dataframe with the following columns: </p>

<dl>
<dt><strong>study_id</strong></dt><dd><p>study identification</p>
</dd> <dt><strong>site_number</strong></dt><dd><p>site
identification</p>
</dd> <dt><strong>n_pat</strong></dt><dd><p>number of patients, site level</p>
</dd>
<dt><strong>visit_med75</strong></dt><dd><p>adjusted median(max(visit)) * 0.75 see Details</p>
</dd>
<dt><strong>n_pat_with_med75</strong></dt><dd><p>number of patients that meet visit_med75
criterion, site level</p>
</dd> <dt><strong>mean_ae_site_med75</strong></dt><dd><p>mean AE at visit_med75,
site level</p>
</dd> </dl>



<h3>Examples</h3>

<pre><code class='language-R'>df_visit &lt;- sim_test_data_study(
  n_pat = 100,
  n_sites = 5,
  frac_site_with_ur = 0.4,
  ur_rate = 0.6
)

df_visit$study_id &lt;- "A"

df_site &lt;- site_aggr(df_visit)

df_site %&gt;%
  knitr::kable(digits = 2)
</code></pre>

<hr>
<h2 id='with_progress_cnd'>Conditional <code><a href="progressr.html#topic+with_progress">with_progress</a></code>.</h2><span id='topic+with_progress_cnd'></span>

<h3>Description</h3>

<p>Internal function. Use instead of
<code><a href="progressr.html#topic+with_progress">with_progress</a></code> within custom functions with progress
bars.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>with_progress_cnd(ex, progress = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="with_progress_cnd_+3A_ex">ex</code></td>
<td>
<p>expression</p>
</td></tr>
<tr><td><code id="with_progress_cnd_+3A_progress">progress</code></td>
<td>
<p>logical, Default: TRUE</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This wrapper adds a progress parameter to <code><a href="progressr.html#topic+with_progress">with_progress</a></code>
so that we can control the progress bar in the user facing functions. The progressbar
only shows in interactive mode.
</p>


<h3>Value</h3>

<p>No return value, called for side effects
</p>


<h3>See Also</h3>

<p><code><a href="progressr.html#topic+with_progress">with_progress</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if (interactive()) {

 with_progress_cnd(
   purrr_bar(rep(0.25, 5), .purrr = purrr::map, .f = Sys.sleep, .steps = 5),
   progress = TRUE
 )

 with_progress_cnd(
   purrr_bar(rep(0.25, 5), .purrr = purrr::map, .f = Sys.sleep, .steps = 5),
   progress = FALSE
 )

# wrap a function with progress bar with another call with progress bar

f1 &lt;- function(x, progress = TRUE) {
  with_progress_cnd(
    purrr_bar(x, .purrr = purrr::walk, .f = Sys.sleep, .steps = length(x), .progress = progress),
    progress = progress
  )
}

# inner progress bar blocks outer progress bar
progressr::with_progress(
  purrr_bar(
    rep(rep(1, 3),3), .purrr = purrr::walk, .f = f1, .steps = 3,
    .f_args = list(progress = TRUE)
  )
)

# inner progress bar turned off
progressr::with_progress(
  purrr_bar(
    rep(list(rep(0.25, 3)), 5), .purrr = purrr::walk, .f = f1, .steps = 5,
    .f_args = list(progress = FALSE)
  )
)
}
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
