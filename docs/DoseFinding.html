<!DOCTYPE html><html lang="en"><head><title>Help for package DoseFinding</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {DoseFinding}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#DoseFinding-package'><p>DoseFinding: Planning and Analyzing Dose Finding Experiments</p></a></li>
<li><a href='#bFitMod'>
<p>Fit a dose-response model using Bayesian or bootstrap methods.</p></a></li>
<li><a href='#biom'><p>Biometrics Dose Response data</p></a></li>
<li><a href='#bMCTtest'><p>Performs Bayesian multiple contrast test</p></a></li>
<li><a href='#critVal'><p>Calculate critical value for multiple contrast test</p></a></li>
<li><a href='#defBnds'>
<p>Calculates default bounds for non-linear parameters in dose-response</p>
models</a></li>
<li><a href='#DesignMCPModApp'><p>Start externally hosted DesignMCPMod Shiny App</p></a></li>
<li><a href='#drmodels'><p>Built-in dose-response models in DoseFinding</p></a></li>
<li><a href='#fitMod'><p>Fit non-linear dose-response model</p></a></li>
<li><a href='#glycobrom'><p>Glycopyrronium Bromide dose-response data</p></a></li>
<li><a href='#guesst'><p>Calculate guesstimates based on prior knowledge</p></a></li>
<li><a href='#IBScovars'><p>Irritable Bowel Syndrome Dose Response data with covariates</p></a></li>
<li><a href='#maFitMod'><p>Fit dose-response models via bootstrap model</p>
averaging (bagging)</a></li>
<li><a href='#MCPMod'>
<p>MCPMod - Multiple Comparisons and Modeling</p></a></li>
<li><a href='#MCTpval'><p>Calculate multiplicity adjusted p-values for multiple contrast test</p></a></li>
<li><a href='#MCTtest'>
<p>Performs multiple contrast test</p></a></li>
<li><a href='#migraine'><p>Migraine Dose Response data</p></a></li>
<li><a href='#Mods'><p>Define dose-response models</p></a></li>
<li><a href='#mvpostmix'><p>Prior to posterior updating for a multivariate normal mixture</p></a></li>
<li><a href='#mvtnorm-control'><p>Control options for pmvt and qmvt functions</p></a></li>
<li><a href='#neurodeg'><p>Neurodegenerative disease simulated longitudinal dose-finding data set</p></a></li>
<li><a href='#optContr'><p>Calculate optimal contrasts</p></a></li>
<li><a href='#optDesign'><p>Function to calculate optimal designs</p></a></li>
<li><a href='#planMod'><p>Evaluate performance metrics for fitting dose-response models</p></a></li>
<li><a href='#powMCT'><p>Calculate power for multiple contrast test</p></a></li>
<li><a href='#sampSize'><p>Sample size calculations</p></a></li>
<li><a href='#Target+20doses'><p>Calculate dose estimates for a fitted dose-response model (via <code>fitMod</code>, <code>bFitMod</code>)</p>
or <code>maFitMod</code>) or a <code>Mods</code> object</a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Planning and Analyzing Dose Finding Experiments</td>
</tr>
<tr>
<td>Version:</td>
<td>1.3-1</td>
</tr>
<tr>
<td>Date:</td>
<td>2025-03-07</td>
</tr>
<tr>
<td>Imports:</td>
<td>ggplot2, lattice, mvtnorm</td>
</tr>
<tr>
<td>Suggests:</td>
<td>numDeriv, Rsolnp, quadprog, parallel, multcomp, knitr,
rmarkdown, MASS, testthat, RBesT, nlme</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Marius Thomas &lt;marius.thomas@novartis.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>The DoseFinding package provides functions for the design and analysis
	     of dose-finding experiments (with focus on pharmaceutical Phase
	     II clinical trials). It provides functions for: multiple contrast
	     tests, fitting non-linear dose-response models (using Bayesian and
	     non-Bayesian estimation), calculating optimal designs and an
	     implementation of the MCPMod methodology (Pinheiro et al. (2014)
	     &lt;<a href="https://doi.org/10.1002%2Fsim.6052">doi:10.1002/sim.6052</a>&gt;).</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/openpharma/DoseFinding">https://github.com/openpharma/DoseFinding</a>,
<a href="https://openpharma.github.io/DoseFinding/">https://openpharma.github.io/DoseFinding/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/openpharma/DoseFinding/issues">https://github.com/openpharma/DoseFinding/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-03-11 10:53:03 UTC; THOMAM1D</td>
</tr>
<tr>
<td>Author:</td>
<td>Bjoern Bornkamp <a href="https://orcid.org/0000-0002-6294-8185"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Jose Pinheiro [aut],
  Frank Bretz [aut],
  Ludger Sandig [aut],
  Marius Thomas [aut, cre],
  Novartis Pharma AG [cph, fnd]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-03-11 15:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='DoseFinding-package'>DoseFinding: Planning and Analyzing Dose Finding Experiments</h2><span id='topic+DoseFinding'></span><span id='topic+DoseFinding-package'></span>

<h3>Description</h3>

<p>The DoseFinding package provides functions for the design and analysis of dose-finding experiments (for example pharmaceutical Phase II clinical trials). It provides functions for: multiple
contrast tests (MCTtest), fitting non-linear dose-response models (fitMod), a combination of testing and dose-response modelling (MCPMod), and calculating optimal designs (optDesign), both for
normal and general response variable.
</p>


<h3>Details</h3>

<p>The main functions are:<br />
<b>MCTtest</b>: Implements a multiple contrast tests<br />
<b>powMCT</b>: Power calculations for multiple contrast tests<br />
<b>fitMod</b>: Fits non-linear dose-response models<br />
<b>optDesign</b>: Calculates optimal designs for dose-response models<br />
<b>MCPMod</b>: Performs MCPMod methodology<br />
<b>sampSize</b>: General function for sample size calculation<br />
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Marius Thomas <a href="mailto:marius.thomas@novartis.com">marius.thomas@novartis.com</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> Bjoern Bornkamp <a href="mailto:bjoern.bornkamp@novartis.com">bjoern.bornkamp@novartis.com</a> (<a href="https://orcid.org/0000-0002-6294-8185">ORCID</a>)
</p>
</li>
<li><p> Jose Pinheiro
</p>
</li>
<li><p> Frank Bretz
</p>
</li>
<li><p> Ludger Sandig
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> Novartis Pharma AG [copyright holder, funder]
</p>
</li></ul>



<h3>References</h3>

<p>Bornkamp, B., Bretz, F., Dette, H. and Pinheiro, J. C. (2011).
Response-Adaptive Dose-Finding under model uncertainty, <em>Annals of
Applied Statistics</em>, <b>5</b>, 1611&ndash;1631
</p>
<p>Bornkamp B., Pinheiro J. C., and Bretz, F. (2009). MCPMod: An R Package for
the Design and Analysis of Dose-Finding Studies, <em>Journal of
Statistical Software</em>, <b>29</b>(7), 1&ndash;23
</p>
<p>Bretz, F., Pinheiro, J. C., and Branson, M. (2005), Combining multiple
comparisons and modeling techniques in dose-response studies,
<em>Biometrics</em>, <b>61</b>, 738&ndash;748
</p>
<p>Dette, H., Bretz, F., Pepelyshev, A. and Pinheiro, J. C. (2008). Optimal
Designs for Dose Finding Studies, <em>Journal of the American Statisical
Association</em>, <b>103</b>, 1225&ndash;1237
</p>
<p>O'Quigley, J., Iasonos, A. and Bornkamp, B. (2017) Handbook of methods for
designing, monitoring, and analyzing dose-finding trials, CRC press, Part 3:
Dose-Finding Studies in Phase II
</p>
<p>Pinheiro, J. C., Bornkamp, B., and Bretz, F. (2006). Design and analysis of
dose finding studies combining multiple comparisons and modeling procedures,
<em>Journal of Biopharmaceutical Statistics</em>, <b>16</b>, 639&ndash;656
</p>
<p>Pinheiro, J. C., Bornkamp, B., Glimm, E. and Bretz, F. (2014) Model-based
dose finding under model uncertainty using general parametric models,
<em>Statistics in Medicine</em>, <b>33</b>, 1646&ndash;1661
</p>
<p>Seber, G.A.F. and Wild, C.J. (2003). Nonlinear Regression, Wiley
</p>


<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/openpharma/DoseFinding">https://github.com/openpharma/DoseFinding</a>
</p>
</li>
<li> <p><a href="https://openpharma.github.io/DoseFinding/">https://openpharma.github.io/DoseFinding/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/openpharma/DoseFinding/issues">https://github.com/openpharma/DoseFinding/issues</a>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
data(IBScovars)

## perform (model based) multiple contrast test
## define candidate dose-response shapes
models &lt;- Mods(linear = NULL, emax = 0.2, quadratic = -0.17,
               doses = c(0, 1, 2, 3, 4))
## plot models
plot(models)
## perform multiple contrast test
test &lt;- MCTtest(dose, resp, IBScovars, models=models,
                addCovars = ~ gender)

## fit non-linear emax dose-response model
fitemax &lt;- fitMod(dose, resp, data=IBScovars, model="emax",
                  bnds = c(0.01,5))
## display fitted dose-effect curve
plot(fitemax, CI=TRUE, plotData="meansCI")

## Calculate optimal designs for target dose (TD) estimation
doses &lt;- c(0, 10, 25, 50, 100, 150)
fmodels &lt;- Mods(linear = NULL, emax = 25, exponential = 85,
                logistic = c(50, 10.8811),
                doses = doses, placEff=0, maxEff=0.4)
plot(fmodels, plotTD = TRUE, Delta = 0.2)
weights &lt;- rep(1/4, 4)
desTD &lt;- optDesign(fmodels, weights, Delta=0.2, designCrit="TD")

</code></pre>

<hr>
<h2 id='bFitMod'>
Fit a dose-response model using Bayesian or bootstrap methods.
</h2><span id='topic+bFitMod'></span><span id='topic+coef.bFitMod'></span><span id='topic+predict.bFitMod'></span><span id='topic+plot.bFitMod'></span>

<h3>Description</h3>

<p>For &lsquo;<span class="samp">&#8288;type = "Bayes"&#8288;</span>&rsquo;, MCMC sampling from the posterior distribution of
the dose-response model is done. The function assumes a multivariate
normal distribution for <code>resp</code> with covariance matrix <code>S</code>,
and this is taken as likelihood function and combined with the prior
distributions specified in prior to form the posterior distribution.
</p>
<p>For &lsquo;<span class="samp">&#8288;type = "bootstrap"&#8288;</span>&rsquo;, a multivariate normal distribution for
<code>resp</code> with covariance matrix <code>S</code> is assumed, and a large
number of samples is drawn from this distribution. For each draw the
fitMod function with &lsquo;<span class="samp">&#8288;type = "general"&#8288;</span>&rsquo; is used to fit the draws
from the multivariate normal distribution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bFitMod(dose, resp, model, S, placAdj = FALSE,
        type = c("Bayes", "bootstrap"),
        start = NULL, prior = NULL, nSim = 1000,
        MCMCcontrol = list(), control = NULL, bnds, 
        addArgs = NULL)

## S3 method for class 'bFitMod'
coef(object, ...)

## S3 method for class 'bFitMod'
predict(object, predType = c("full-model", "effect-curve"),
        summaryFct = function(x) quantile(x, probs = c(0.025, 0.25, 0.5, 0.75, 0.975)),
        doseSeq = NULL, lenSeq = 101, ...)

## S3 method for class 'bFitMod'
plot(x, plotType = c("dr-curve", "effect-curve"),
        quant = c(0.025, 0.5, 0.975), 
        plotData = c("means", "meansCI", "none"),
        level = 0.95, lenDose = 201, ...)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="bFitMod_+3A_dose">dose</code></td>
<td>
<p> Numeric specifying the dose variable. </p>
</td></tr>
<tr><td><code id="bFitMod_+3A_resp">resp</code></td>
<td>
<p> Numeric specifying the response estimate
corresponding to the doses in <code>dose</code></p>
</td></tr>
<tr><td><code id="bFitMod_+3A_s">S</code></td>
<td>
<p> Covariance matrix associated with the dose-response
estimate specified via <code>resp</code></p>
</td></tr>
<tr><td><code id="bFitMod_+3A_model">model</code></td>
<td>
<p> Dose-response model to fit, possible models are
&quot;linlog&quot;, &quot;linear&quot;, &quot;quadratic&quot;, &quot;emax&quot;, &quot;exponential&quot;,
&quot;sigEmax&quot;, &quot;betaMod&quot; and &quot;logistic&quot;, see <code><a href="#topic+drmodels">drmodels</a></code>.
</p>
</td></tr>
<tr><td><code id="bFitMod_+3A_placadj">placAdj</code></td>
<td>
<p> Whether or not estimates in &quot;placAdj&quot; are
placebo-adjusted (note that the linear in log and
the logistic model cannot be fitted for placebo-adjusted data)
</p>
</td></tr>
<tr><td><code id="bFitMod_+3A_type">type</code></td>
<td>

<p>Character with allowed values &quot;Bayes&quot; and &quot;bootstrap&quot;, Determining
whether samples are drawn from the posterior, or the bootstrap
distribution.
</p>
</td></tr>
<tr><td><code id="bFitMod_+3A_start">start</code></td>
<td>
<p> Optional starting values for the dose-response
parameters in the MCMC algorithm.
</p>
</td></tr>
<tr><td><code id="bFitMod_+3A_prior">prior</code></td>
<td>

<p>List containing the information regarding the prior distributions
for &lsquo;<span class="samp">&#8288;type = "Bayes"&#8288;</span>&rsquo;.
The list needs to have as many entries as there are model
parameters. The ordering of the list entries should be the same as
in the arguments list of the model see (see <code><a href="#topic+drmodels">drmodels</a></code>).
For example for the Emax model the first entry determines the prior
for e0, the second to eMax and the third to ed50.
</p>
<p>For each list entry the user has the choice to choose
from 4 possible distributions:
</p>

<ul>
<li> <p><code>norm</code>: Vector of length 2 giving mean and standard deviation.
</p>
</li>
<li> <p><code>t</code>: Vector of length 3  giving median, scale and degrees
of freedom of the t-distribution.
</p>
</li>
<li> <p><code>lnorm</code>: Vector of length 2 giving mean and standard
deviation on log scale.
</p>
</li>
<li> <p><code>beta</code>: Vector of length 4 giving lower and upper bound
of the beta prior as well as the alpha and beta parameters of the
beta distribution
</p>
</li></ul>

</td></tr>
<tr><td><code id="bFitMod_+3A_nsim">nSim</code></td>
<td>

<p>Desired number of samples to produce with the algorithm
</p>
</td></tr>
<tr><td><code id="bFitMod_+3A_mcmccontrol">MCMCcontrol</code></td>
<td>

<p>List of control parameters for the MCMC algorithm
</p>

<ul>
<li> <p><code>thin</code> Thinning rate. Must be a positive integer.
</p>
</li>
<li> <p><code>w</code> Numeric of same length as number of parameters in
the model, specifies the width parameters of the slice sampler.
</p>
</li>
<li> <p><code>adapt</code> Logical whether to adapt the <code>w</code> (width)
parameter of the slice sampler in a short trial run. The widths
are chosen as IQR/1.3 of the trial run.
</p>
</li></ul>

</td></tr>
<tr><td><code id="bFitMod_+3A_control">control</code></td>
<td>

<p>Same as the control argument in <code><a href="#topic+fitMod">fitMod</a></code>.
</p>
</td></tr>
<tr><td><code id="bFitMod_+3A_bnds">bnds</code></td>
<td>

<p>Bounds for non-linear parameters, in case &lsquo;<span class="samp">&#8288;type =
    "bootstrap"&#8288;</span>&rsquo;. If missing the the default bounds from
<code><a href="#topic+defBnds">defBnds</a></code> is used.
</p>
</td></tr>
<tr><td><code id="bFitMod_+3A_addargs">addArgs</code></td>
<td>

<p>List containing two entries named &quot;scal&quot; and &quot;off&quot; for the &quot;betaMod&quot;
and &quot;linlog&quot; model. When addArgs is NULL the following defaults are
used &lsquo;<span class="samp">&#8288;list(scal = 1.2*max(doses), off = 0.01*max(doses))&#8288;</span>&rsquo;</p>
</td></tr>
<tr><td><code id="bFitMod_+3A_x">x</code>, <code id="bFitMod_+3A_object">object</code></td>
<td>

<p>A bFitMod object 
</p>
</td></tr>
<tr><td><code id="bFitMod_+3A_predtype">predType</code>, <code id="bFitMod_+3A_summaryfct">summaryFct</code>, <code id="bFitMod_+3A_doseseq">doseSeq</code>, <code id="bFitMod_+3A_lenseq">lenSeq</code></td>
<td>

<p>Arguments for the predict method.
</p>
<p>&lsquo;<span class="samp">&#8288;predType&#8288;</span>&rsquo;: predType determines whether predictions are returned
for the dose-response curve or the effect curve (difference to placebo).
</p>
<p>&lsquo;<span class="samp">&#8288;summaryFct&#8288;</span>&rsquo;: If equal to NULL predictions are calculated for
each sampled parameter value. Otherwise a summary function is
applied to the dose-response predictions for each parameter value.
The default is to calculate 0.025, 0.25, 0.5, 0.75, 0.975 quantiles
of the predictions for each dose.
</p>
<p>&lsquo;<span class="samp">&#8288;doseSeq&#8288;</span>&rsquo;: Where to calculate predictions. If not specified
predictions are calculated on a grid of length &lsquo;<span class="samp">&#8288;lenSeq&#8288;</span>&rsquo; between
minimum and maximum dose.
</p>
<p>&lsquo;<span class="samp">&#8288;lenSeq&#8288;</span>&rsquo;: Length of the default grid where to calculate
predictions.
</p>
</td></tr>
<tr><td><code id="bFitMod_+3A_plottype">plotType</code>, <code id="bFitMod_+3A_quant">quant</code>, <code id="bFitMod_+3A_plotdata">plotData</code>, <code id="bFitMod_+3A_level">level</code>, <code id="bFitMod_+3A_lendose">lenDose</code></td>
<td>

<p>Arguments for plot method.
</p>
<p>&lsquo;<span class="samp">&#8288;plotType&#8288;</span>&rsquo;: Determining whether the dose-response curve or the
effect curve should be plotted.
</p>
<p>&lsquo;<span class="samp">&#8288;quant&#8288;</span>&rsquo;: Vector of quantiles to display in plot
</p>
<p>&lsquo;<span class="samp">&#8288;plotData&#8288;</span>&rsquo;: Determines how the original data are plotted:
Either as means or as means with CI or not. The level of the CI is
determined by the argument &lsquo;<span class="samp">&#8288;level&#8288;</span>&rsquo;.
</p>
<p>&lsquo;<span class="samp">&#8288;level&#8288;</span>&rsquo;: Level for CI, when plotData is equal to
&lsquo;<span class="samp">&#8288;meansCI&#8288;</span>&rsquo;.
</p>
<p>&lsquo;<span class="samp">&#8288;lenDose&#8288;</span>&rsquo;: Number of grid values to use for display.
</p>
</td></tr>
<tr><td><code id="bFitMod_+3A_...">...</code></td>
<td>

<p>Additional arguments are ignored.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Componentwise univariate slice samplers are implemented (see Neal,
2003) to sample from the posterior distribution.
</p>


<h3>Value</h3>

<p>An object of class bFitMod, which is a list containing the matrix of
posterior simulations plus some additional information on the fitted
model.
</p>


<h3>Author(s)</h3>

<p>Bjoern Bornkamp
</p>


<h3>References</h3>

<p>Neal, R. M. (2003), Slice sampling, Annals of Statistics, 31, 705-767
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitMod">fitMod</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  data(biom)
  ## produce first stage fit (using dose as factor)
  anMod &lt;- lm(resp~factor(dose)-1, data=biom)
  drFit &lt;- coef(anMod)
  S &lt;- vcov(anMod)
  dose &lt;- sort(unique(biom$dose))
  ## define prior list
  ## normal prior for E0 (mean=0 and sdev=10)
  ## normal prior for Emax (mean=0 and sdev=100)
  ## beta prior for ED50: bounds: [0,1.5] parameters shape1=0.45, shape2=1.7
  prior &lt;- list(norm = c(0, 10), norm = c(0,100), beta=c(0,1.5,0.45,1.7))
  ## now fit an emax model
  gsample &lt;- bFitMod(dose, drFit, S, model = "emax", 
                      start = c(0, 1, 0.1), nSim = 1000, prior = prior)
  ## summary information
  gsample
  ## samples are stored in
  head(gsample$samples)
  ## predict 0.025, 0.25, 0.5, 0.75, 0.975 Quantile at 0, 0.5 and 1
  predict(gsample, doseSeq = c(0, 0.5, 1))
  ## simple plot function
  plot(gsample)

  ## now look at bootstrap distribution
  gsample &lt;- bFitMod(dose, drFit, S, model = "emax", type = "bootstrap",
                     nSim = 100, bnds = defBnds(1)$emax)
  plot(gsample)

  ## now fit linear interpolation
  prior &lt;- list(norm = c(0,1000), norm = c(0,1000),
                norm = c(0,1000), norm = c(0,1000), norm = c(0,100))
  gsample &lt;- bFitMod(dose, drFit, S, model = "linInt", 
                     start = rep(1,5), nSim = 1000, prior = prior)
  gsample &lt;- bFitMod(dose, drFit, S, model = "linInt", type = "bootstrap",
                     nSim = 100)

  ## data fitted on placebo adjusted scale
  data(IBScovars)
  anovaMod &lt;- lm(resp~factor(dose)+gender, data=IBScovars)
  drFit &lt;- coef(anovaMod)[2:5] # placebo adjusted estimates at doses
  vCov &lt;- vcov(anovaMod)[2:5,2:5]
  dose &lt;- sort(unique(IBScovars$dose))[-1]
  prior &lt;- list(norm = c(0,100), beta=c(0,6,0.45,1.7))
  ## Bayes fit
  gsample &lt;- bFitMod(dose, drFit, vCov, model = "emax", placAdj=TRUE,
                     start = c(1, 0.1), nSim = 1000, prior = prior)
  ## bootstrap fit
  gsample &lt;- bFitMod(dose, drFit, vCov, model = "emax", placAdj=TRUE,
                     type = "bootstrap", start = c(1, 0.1),
                     nSim = 100, prior = prior, bnds = c(0.01,6))
  ## calculate target dose estimate
  TD(gsample, Delta = 0.2)
  ## now fit linear interpolation
  prior &lt;- list(norm = c(0,1000), norm = c(0,1000), norm = c(0,1000), norm = c(0,100))
  gsample &lt;- bFitMod(dose, drFit, vCov, model = "linInt", placAdj=TRUE,
                     start = rep(1,4), nSim = 1000, prior = prior)
  gsample &lt;- bFitMod(dose, drFit, vCov, model = "linInt", type = "bootstrap",
                     placAdj = TRUE, nSim = 100)
</code></pre>

<hr>
<h2 id='biom'>Biometrics Dose Response data</h2><span id='topic+biom'></span>

<h3>Description</h3>

<p>An example data set for dose response studies. This data set was used in
Bretz et al. (2005) to illustrate the MCPMod methodology.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(biom)
</code></pre>


<h3>Format</h3>

<p>A data frame with 100 observations on the following 2 variables.
</p>

<dl>
<dt><code>resp</code></dt><dd><p>a numeric vector containing the response values</p>
</dd>
<dt><code>dose</code></dt><dd><p>a numeric vector containing the dose values</p>
</dd>
</dl>



<h3>Source</h3>

<p>Bretz, F., Pinheiro, J. C., and Branson, M. (2005), Combining
multiple comparisons and modeling techniques in dose-response studies,
<em>Biometrics</em>, <b>61</b>, 738&ndash;748
</p>

<hr>
<h2 id='bMCTtest'>Performs Bayesian multiple contrast test</h2><span id='topic+bMCTtest'></span>

<h3>Description</h3>

<p>This function performs a Bayesian multiple contrast test using normal mixture priors for the response on each dose,
as proposed in Fleischer et al. (2022). For a general description of the multiple contrast test see
<code><a href="#topic+MCTtest">MCTtest</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bMCTtest(
  dose,
  resp,
  data = NULL,
  models,
  S = NULL,
  type = c("normal", "general"),
  prior,
  alpha = 0.025,
  na.action = na.fail,
  mvtcontrol = mvtnorm.control(),
  contMat = NULL,
  critV = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="bMCTtest_+3A_dose">dose</code>, <code id="bMCTtest_+3A_resp">resp</code></td>
<td>
<p>Either vectors of equal length specifying dose and response values, or names of variables in the
data frame specified in &lsquo;<span class="samp">&#8288;data&#8288;</span>&rsquo;.</p>
</td></tr>
<tr><td><code id="bMCTtest_+3A_data">data</code></td>
<td>
<p>Data frame containing the variables referenced in dose and resp if &lsquo;<span class="samp">&#8288;data&#8288;</span>&rsquo; is not specified it is
assumed that &lsquo;<span class="samp">&#8288;dose&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;resp&#8288;</span>&rsquo; are variables referenced from data (and no vectors)</p>
</td></tr>
<tr><td><code id="bMCTtest_+3A_models">models</code></td>
<td>
<p>An object of class &lsquo;<span class="samp">&#8288;Mods&#8288;</span>&rsquo;, see <code><a href="#topic+Mods">Mods</a></code> for details</p>
</td></tr>
<tr><td><code id="bMCTtest_+3A_s">S</code></td>
<td>
<p>The covariance matrix of &lsquo;<span class="samp">&#8288;resp&#8288;</span>&rsquo; when &lsquo;<span class="samp">&#8288;type = "general"&#8288;</span>&rsquo;, see Description.</p>
</td></tr>
<tr><td><code id="bMCTtest_+3A_type">type</code></td>
<td>
<p>Determines whether inference is based on an ANCOVA model under a homoscedastic normality assumption (when
&lsquo;<span class="samp">&#8288;type = "normal"&#8288;</span>&rsquo;), or estimates at the doses and their covariance matrix and degrees of freedom are specified
directly in &lsquo;<span class="samp">&#8288;resp&#8288;</span>&rsquo;, &lsquo;<span class="samp">&#8288;S&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;df&#8288;</span>&rsquo;. See also <code><a href="#topic+fitMod">fitMod</a></code> and Pinheiro et al. (2014).</p>
</td></tr>
<tr><td><code id="bMCTtest_+3A_prior">prior</code></td>
<td>
<p>List of length equal to the number of doses with the prior for each arm.  Each element needs to be of
class &lsquo;<span class="samp">&#8288;normMix&#8288;</span>&rsquo; (See &lsquo;<span class="samp">&#8288;RBesT&#8288;</span>&rsquo; package documentation). It is assumed that the i-th component of the prior
list corresponds to the i-th largest dose. For example the first entry in the list is the prior for the placebo
group, the second entry the prior for the second lowest dose and so on.  Internally the priors across the different
arms are combined (densities multiplied) assuming independence. The resulting multivariate normal mixture prior
will have as many components as the product of the number of components of the individual mixture priors. The
posterior mixture is part of the result object under &quot;posterior&quot;.</p>
</td></tr>
<tr><td><code id="bMCTtest_+3A_alpha">alpha</code></td>
<td>
<p>Significance level for the frequentist multiple contrast test. If no critical values are supplied via
&lsquo;<span class="samp">&#8288;critV&#8288;</span>&rsquo; this is used to derive critical values for Bayesian decision rule.</p>
</td></tr>
<tr><td><code id="bMCTtest_+3A_na.action">na.action</code></td>
<td>
<p>A function which indicates what should happen when the data contain NAs.</p>
</td></tr>
<tr><td><code id="bMCTtest_+3A_mvtcontrol">mvtcontrol</code></td>
<td>
<p>A list specifying additional control parameters for the &lsquo;<span class="samp">&#8288;qmvt&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;pmvt&#8288;</span>&rsquo; calls in the
code, see also <code><a href="#topic+mvtnorm.control">mvtnorm.control</a></code> for details.</p>
</td></tr>
<tr><td><code id="bMCTtest_+3A_contmat">contMat</code></td>
<td>
<p>Contrast matrix to apply to the posterior dose-response estimates. The contrasts need to be in the
columns of the matrix (i.e. the column sums need to be 0). If not specified optimal contrasts are calculated using
<code><a href="#topic+optContr">optContr</a></code>.</p>
</td></tr>
<tr><td><code id="bMCTtest_+3A_critv">critV</code></td>
<td>
<p>Supply a critical value for the maximum posterior probability of the contrasts being greater than zero
that needs to be surpassed to establish a non-flat dose-response. If this argument is NULL, this will be derived
from critical values for frequentist MCP-Mod using the provided &lsquo;<span class="samp">&#8288;alpha&#8288;</span>&rsquo;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If &lsquo;<span class="samp">&#8288;type = "normal"&#8288;</span>&rsquo;, an ANCOVA model based on a homoscedastic normality assumption is fitted and posteriors for
dose-response and contrast vectors are obtained assuming a known variance.
</p>
<p>For &lsquo;<span class="samp">&#8288;type = "general"&#8288;</span>&rsquo; it is assumed multivariate normally distributed estimates are specified in &lsquo;<span class="samp">&#8288;resp&#8288;</span>&rsquo;
with covariance given by &lsquo;<span class="samp">&#8288;S&#8288;</span>&rsquo;, which define the likelihood.  Posteriors for dose-response and contrast vectors
are then obtained assuming a known covariance matrix S
</p>
<p>The multiple contrast test decision is based on the maximum posterior probability of a contrast being greater than
zero. Thresholds for the posterior probability can either be supplied or will be derived from frequentist critical
values. In the latter case the Bayesian test will give approximately the same results as the frequentist multiple
contrast test if uninformative priors are used.
</p>
<p>For the default calculation of optimal contrasts the prior information is ignored (i.e. contrasts are calculated in
the same way as in <code><a href="#topic+MCTtest">MCTtest</a></code>).  Fleischer et al. (2022) discuss using contrasts that take the prior
effective sample sizes into account, which can be slightly more favourable for the Bayesian MCT test. Such
alternative contrasts can be directly handed over via the &lsquo;<span class="samp">&#8288;contMat&#8288;</span>&rsquo; argument.
</p>
<p>For analysis with covariate adjustment, covariate-adjusted &lsquo;<span class="samp">&#8288;resp&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;S&#8288;</span>&rsquo; can be supplied together with
using &lsquo;<span class="samp">&#8288;type = "general"&#8288;</span>&rsquo;. See  'vignette(&quot;binary_data&quot;)' vignette &quot;Design and analysis template MCP-Mod for binary data&quot; for an example
on how to obtain covariate adjusted estimates.
</p>


<h3>Value</h3>

<p>An object of class bMCTtest, a list containing the output.
</p>


<h3>Author(s)</h3>

<p>Marius Thomas
</p>


<h3>References</h3>

<p>Fleischer, F., Bossert, S., Deng, Q., Loley, C. and Gierse, J. (2022).  Bayesian MCP-Mod,
<em>Pharmaceutical Statistics</em>, <b>21</b>, 654&ndash;670
</p>


<h3>See Also</h3>

<p><code><a href="#topic+MCTtest">MCTtest</a></code>, <code><a href="#topic+optContr">optContr</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

if (require("RBesT")) {

###############################
## Normal outcome
###############################

data(biom)
## define shapes for which to calculate optimal contrasts
doses &lt;- c(0, 0.05, 0.2, 0.6, 1)
modlist &lt;- Mods(emax = 0.05, linear = NULL, logistic = c(0.5, 0.1),
                linInt = c(0, 1, 1, 1), doses = doses)
## specify an informative prior for placebo, weakly informative for other arms
plc_prior &lt;- mixnorm(inf = c(0.8, 0.4, 0.1), rob = c(0.2, 0.4, 10))
vague_prior &lt;- mixnorm(c(1, 0, 10))
## i-th component of the prior list corresponds to the i-th largest dose
## (e.g. 1st component -&gt; placebo prior; last component prior for top dose)
prior &lt;- list(plc_prior, vague_prior, vague_prior, vague_prior, vague_prior)

m1 &lt;- bMCTtest(dose, resp, biom, models=modlist, prior = prior)
## now supply a critical value (= threshold for maxmimum posterior probability)
m2 &lt;- bMCTtest(dose, resp, biom, models=modlist, prior = prior, critV = 0.99)

####################################
## Binary outcome with covariates
####################################
## Not run: 
## generate data
logit &lt;- function(p) log(p / (1 - p))
inv_logit &lt;- function(y) 1 / (1 + exp(-y))
doses &lt;- c(0, 0.5, 1.5, 2.5, 4)

## set seed and ensure reproducibility across R versions
set.seed(1, kind = "Mersenne-Twister", sample.kind = "Rejection", normal.kind = "Inversion")
group_size &lt;- 100
dose_vector &lt;- rep(doses, each = group_size)
N &lt;- length(dose_vector)
## generate covariates
x1 &lt;- rnorm(N, 0, 1)
x2 &lt;- factor(sample(c("A", "B"), N, replace = TRUE, prob = c(0.6, 0.4)))
## assume approximately logit(10%) placebo and logit(35%) asymptotic response with ED50=0.5
prob &lt;- inv_logit(emax(dose_vector, -2.2, 1.6, 0.5) + 0.3 * x1 + 0.3 * (x2 == "B"))
dat &lt;- data.frame(y = rbinom(N, 1, prob),
                  dose = dose_vector, x1 = x1, x2 = x2)

## specify an informative prior for placebo (on logit scale), weakly informative for other arms
plc_prior &lt;- mixnorm(inf = c(0.8, -2, 0.5), rob = c(0.2, -2, 10))
vague_prior &lt;- mixnorm(c(1, 0, 10))
prior &lt;- list(plc_prior, vague_prior, vague_prior, vague_prior, vague_prior)

## candidate models
mods &lt;- Mods(emax = c(0.25, 1), sigEmax = rbind(c(1, 3), c(2.5, 4)), betaMod = c(1.1, 1.1),
             placEff = logit(0.1), maxEff = logit(0.35)-logit(0.1),
             doses = doses)

fit_cov &lt;- glm(y~factor(dose) + 0 + x1 + x2, data = dat, family = binomial)

covariate_adjusted_estimates &lt;- function(mu_hat, S_hat, formula_rhs,
                                         doses, other_covariates, n_sim) {
  ## predict every patient under *every* dose
  oc_rep &lt;- as.data.frame(lapply(other_covariates, function(col) rep(col, times = length(doses))))
  d_rep &lt;- rep(doses, each = nrow(other_covariates))
  pdat &lt;- cbind(oc_rep, dose = d_rep)
  X &lt;- model.matrix(formula_rhs, pdat)
  ## average on probability scale then backtransform to logit scale
  mu_star &lt;- logit(tapply(inv_logit(X %*% mu_hat), pdat$dose, mean))
  ## estimate covariance matrix of mu_star
  pred &lt;- replicate(n_sim, logit(tapply(inv_logit(X %*% drop(mvtnorm::rmvnorm(1, mu_hat, S_hat))),
                                        pdat$dose, mean)))
  return(list(mu_star = as.numeric(mu_star), S_star = cov(t(pred))))
}

ca &lt;- covariate_adjusted_estimates(coef(fit_cov), vcov(fit_cov), ~factor(dose)+0+x1+x2,
                                   doses, dat[, c("x1", "x2")], 1000)
bMCTtest(doses, ca$mu_star, S = ca$S_star, type = "general", models = mods, prior = prior)

## End(Not run)
################################################
## example with contrasts handed over
################################################

data(biom)
## define shapes for which to calculate optimal contrasts
doses &lt;- c(0, 0.05, 0.2, 0.6, 1)
modlist &lt;- Mods(emax = 0.05, linear = NULL, sigEmax = c(0.5, 5),
                linInt = c(0, 1, 1, 1), doses = doses)

## specify an informative prior for placebo, weakly informative for other arms
plc_prior &lt;- mixnorm(inf = c(0.8, 0.4, 0.1), rob = c(0.2, 0.4, 10), sigma = 0.7)
vague_prior &lt;- mixnorm(c(1, 0, 10), sigma = 0.7)
prior &lt;- list(plc_prior, vague_prior, vague_prior, vague_prior, vague_prior)

## use prior effective sample sizes to calculate optimal contrasts
prior_ess &lt;- unlist(lapply(prior, ess))
n_grp &lt;- as.numeric(table(biom$dose))
weights &lt;- n_grp + prior_ess
cmat &lt;- optContr(modlist, w = weights)

bMCTtest(dose, resp, biom, models=modlist, prior = prior, contMat = cmat)
}

</code></pre>

<hr>
<h2 id='critVal'>Calculate critical value for multiple contrast test</h2><span id='topic+critVal'></span>

<h3>Description</h3>

<p>Calculation of the critical value for a maximum contrast test. This is based on the equicoordinate quantile function
of the multivariate normal or t distribution as implemented in the <code>qmvt</code> function from the mvtnorm package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>critVal(
  corMat,
  alpha = 0.025,
  df = NULL,
  alternative = c("one.sided", "two.sided"),
  control = mvtnorm.control()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="critVal_+3A_cormat">corMat</code></td>
<td>
<p>Correlation matrix of contrasts</p>
</td></tr>
<tr><td><code id="critVal_+3A_alpha">alpha</code></td>
<td>
<p>Significance level for the multiple contrast test</p>
</td></tr>
<tr><td><code id="critVal_+3A_df">df</code></td>
<td>
<p>Specify the degrees of freedom to use, if this argument is missing &lsquo;<span class="samp">&#8288;df = Inf&#8288;</span>&rsquo; is used (which
corresponds to the multivariate normal distribution).</p>
</td></tr>
<tr><td><code id="critVal_+3A_alternative">alternative</code></td>
<td>
<p>Character determining the alternative for the multiple contrast trend test.</p>
</td></tr>
<tr><td><code id="critVal_+3A_control">control</code></td>
<td>
<p>A list specifying additional control parameters for the &lsquo;<span class="samp">&#8288;qmvt&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;pmvt&#8288;</span>&rsquo; calls in the code,
see also <code><a href="#topic+mvtnorm.control">mvtnorm.control</a></code> for details.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Bjoern Bornkamp
</p>


<h3>See Also</h3>

<p><code><a href="#topic+powMCT">powMCT</a></code>, <code><a href="#topic+optContr">optContr</a></code>, <code><a href="#topic+MCTtest">MCTtest</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
R &lt;- matrix(c(1,0.5,0.5,1), nrow=2)
critVal(R, alpha = 0.05, df = 1)
critVal(R, alpha = 0.05, df = 20)
critVal(R, alpha = 0.05, df = Inf)

</code></pre>

<hr>
<h2 id='defBnds'>
Calculates default bounds for non-linear parameters in dose-response
models
</h2><span id='topic+defBnds'></span>

<h3>Description</h3>

<p>Calculates reasonable bounds for non-linear parameters for the
built-in non-linear regression model based on the dose range under
investigation.
</p>
<p>For the logistic model the first row corresponds to the ED50 parameter and the
second row to the delta parameter. For the sigmoid Emax model the
first row corresponds to the ED50 parameter and the second row to the
h parameter, while for the beta model first and second row correspond
to the delta1 and delta2 parameters. See <code><a href="#topic+logistic">logistic</a></code>,
<code><a href="#topic+sigEmax">sigEmax</a></code> and <code><a href="#topic+betaMod">betaMod</a></code> for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>   defBnds(mD, emax = c(0.001, 1.5)*mD,
           exponential = c(0.1, 2)*mD, 
           logistic = matrix(c(0.001, 0.01, 1.5, 1/2)*mD, 2),
           sigEmax = matrix(c(0.001*mD, 0.5, 1.5*mD, 10), 2),
           betaMod = matrix(c(0.05,0.05,4,4), 2))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="defBnds_+3A_md">mD</code></td>
<td>

<p>Maximum dose in the study.
</p>
</td></tr>
<tr><td><code id="defBnds_+3A_emax">emax</code>, <code id="defBnds_+3A_exponential">exponential</code>, <code id="defBnds_+3A_logistic">logistic</code>, <code id="defBnds_+3A_sigemax">sigEmax</code>, <code id="defBnds_+3A_betamod">betaMod</code></td>
<td>

<p>values for the nonlinear parameters for these model-functions
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List containing bounds for the model parameters.
</p>


<h3>Author(s)</h3>

<p>Bjoern Bornkamp
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitMod">fitMod</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  defBnds(mD = 1)
  defBnds(mD = 200)
</code></pre>

<hr>
<h2 id='DesignMCPModApp'>Start externally hosted DesignMCPMod Shiny App</h2><span id='topic+DesignMCPModApp'></span>

<h3>Description</h3>

<p>This function starts the externally hosted DesignMCPMod Shiny App in a
browser window. The app was developed by Sophie Sun [aut, cre], Danyi
Xiong [aut], Bjoern Bornkamp [ctb], Frank Bretz [ctb], Ardalan
Mirshani [ctb]. This app performs power and sample size calculations
for a multiple contrast test for normal, binary and negative binomial
outcomes. The app uses the DoseFinding package as calculation backend
and the R code underlying the calculations in the app can be extracted
from the app.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  DesignMCPModApp()
</code></pre>

<hr>
<h2 id='drmodels'>Built-in dose-response models in DoseFinding</h2><span id='topic+drmodels'></span><span id='topic+betaMod'></span><span id='topic+emax'></span><span id='topic+sigEmax'></span><span id='topic+exponential'></span><span id='topic+logistic'></span><span id='topic+linear'></span><span id='topic+linlog'></span><span id='topic+quadratic'></span><span id='topic+linInt'></span><span id='topic+betaModGrad'></span><span id='topic+emaxGrad'></span><span id='topic+sigEmaxGrad'></span><span id='topic+exponentialGrad'></span><span id='topic+logisticGrad'></span><span id='topic+linearGrad'></span><span id='topic+linlogGrad'></span><span id='topic+quadraticGrad'></span><span id='topic+linIntGrad'></span>

<h3>Description</h3>

<p>Dose-response model functions and gradients.
</p>
<p>Below are the definitions of the model functions:
</p>
<p><b>Emax model</b> </p>
<p style="text-align: center;"><code class="reqn">
f(d,\theta)=E_0+E_{max}\frac{d}{ED_{50}+d}</code>
</p>

<p><b>Sigmoid Emax Model</b> </p>
<p style="text-align: center;"><code class="reqn">
f(d,\theta)=E_0+E_{max}\frac{d^h}{ED^h_{50}+d^h}</code>
</p>

<p><b>Exponential Model</b> </p>
<p style="text-align: center;"><code class="reqn">
f(d,\theta)=E_0+E_1(\exp(d/\delta)-1)</code>
</p>

<p><b>Beta model</b> </p>
<p style="text-align: center;"><code class="reqn">
f(d,\theta)=E_0+E_{max}B(\delta_1,\delta_2)(d/scal)^{\delta_1}(1-d/scal)^{\delta_2}
</code>
</p>

<p> here
</p>
<p style="text-align: center;"><code class="reqn">B(\delta_1,\delta_2)=(\delta_1+\delta_2)^{\delta_1+\delta_2}/(\delta_1^{\delta_1}
</code>
</p>
<p style="text-align: center;"><code class="reqn">
\delta_2^{\delta_2})</code>
</p>
<p> and <code class="reqn">scal</code> is a fixed dose scaling parameter.
</p>
<p><b>Linear Model</b> </p>
<p style="text-align: center;"><code class="reqn">
f(d,\theta)=E_0+\delta d</code>
</p>

<p><b>Linear in log Model</b> </p>
<p style="text-align: center;"><code class="reqn">
f(d,\theta)=E_0+\delta \log(d + off)</code>
</p>

<p>here <code class="reqn">off</code> is a fixed offset parameter.
</p>
<p><b>Logistic Model</b> </p>
<p style="text-align: center;"><code class="reqn">
f(d, \theta) = E_0 + E_{\max}/\left\{1 + \exp\left[ \left(ED_{50} - d
\right)/\delta \right] \right\}</code>
</p>

<p><b>Quadratic Model</b> </p>
<p style="text-align: center;"><code class="reqn">
f(d,\theta)=E_0+\beta_1d+\beta_2d^2</code>
</p>
<p> The
standardized model equation for the quadratic model is <code class="reqn">d+\delta
d^2</code>, with <code class="reqn">\delta=\beta_2/\beta_1</code>.
</p>
<p><b>Linear Interpolation model</b><br /> The linInt model provides linear
interpolation at the values defined by the nodes vector. In virtually all
situations the nodes vector is equal to the doses used in the analysis. For
example the <code><a href="#topic+Mods">Mods</a></code> and the <code><a href="#topic+fitMod">fitMod</a></code> function
automatically use the doses that are used in the context of the function
call as nodes. The guesstimates specified in the <code><a href="#topic+Mods">Mods</a></code> function
need to be the treatment effects at the active doses standardized to the
interval [0,1] (see the examples in the <code><a href="#topic+Mods">Mods</a></code> function).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>emax(dose, e0, eMax, ed50)
emaxGrad(dose, eMax, ed50, ...)

sigEmax(dose, e0, eMax, ed50, h)
sigEmaxGrad(dose, eMax, ed50, h, ...)

exponential(dose, e0, e1, delta)
exponentialGrad(dose, e1, delta, ...)

quadratic(dose, e0, b1, b2)
quadraticGrad(dose, ...)

betaMod(dose, e0, eMax, delta1, delta2, scal)
betaModGrad(dose, eMax, delta1, delta2, scal, ...)

linear(dose, e0, delta)
linearGrad(dose, ...)

linlog(dose, e0, delta, off = 1)
linlogGrad(dose, off, ...)

logistic(dose, e0, eMax, ed50, delta)
logisticGrad(dose, eMax, ed50, delta, ...)

linInt(dose, resp, nodes)
linIntGrad(dose, resp, nodes, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="drmodels_+3A_dose">dose</code></td>
<td>
<p>Dose variable</p>
</td></tr>
<tr><td><code id="drmodels_+3A_e0">e0</code></td>
<td>
<p>For most models placebo effect. For logistic model left-asymptote
parameter, corresponding to a basal effect level (not the placebo effect)</p>
</td></tr>
<tr><td><code id="drmodels_+3A_emax">eMax</code></td>
<td>
<p>Beta Model: Maximum effect within dose-range<br /> Emax, sigmoid
Emax, logistic Model: Asymptotic maximum effect</p>
</td></tr>
<tr><td><code id="drmodels_+3A_ed50">ed50</code></td>
<td>
<p>Dose giving half of the asymptotic maximum effect</p>
</td></tr>
<tr><td><code id="drmodels_+3A_...">...</code></td>
<td>
<p>Just included for convenience in the gradient functions, so that
for example <code>quadratic(dose, e0=0, b1=1, b2=3)</code> will not throw an error
(although the gradient of the quadratic model is independent of e0, b1 and
b2).</p>
</td></tr>
<tr><td><code id="drmodels_+3A_h">h</code></td>
<td>
<p>Hill parameter, determining the steepness of the model at the ED50</p>
</td></tr>
<tr><td><code id="drmodels_+3A_e1">e1</code></td>
<td>
<p>Slope parameter for exponential model</p>
</td></tr>
<tr><td><code id="drmodels_+3A_delta">delta</code></td>
<td>
<p>Exponential model: Parameter, controlling the convexity of the
model.<br /> Linear and linlog model: Slope parameter<br /> Logistic model:
Parameter controlling determining the steepness of the curve</p>
</td></tr>
<tr><td><code id="drmodels_+3A_b1">b1</code></td>
<td>
<p>first parameter of quadratic model</p>
</td></tr>
<tr><td><code id="drmodels_+3A_b2">b2</code></td>
<td>
<p>second parameter of quadratic model (controls, whether model is
convex or concave)</p>
</td></tr>
<tr><td><code id="drmodels_+3A_delta1">delta1</code></td>
<td>
<p>delta1 parameter for beta model</p>
</td></tr>
<tr><td><code id="drmodels_+3A_delta2">delta2</code></td>
<td>
<p>delta2 parameter for beta model</p>
</td></tr>
<tr><td><code id="drmodels_+3A_scal">scal</code></td>
<td>
<p>Scale parameter (treated as a fixed value, not estimated)</p>
</td></tr>
<tr><td><code id="drmodels_+3A_off">off</code></td>
<td>
<p>Offset value to avoid problems with dose=0 (treated as a fixed
value, not estimated)</p>
</td></tr>
<tr><td><code id="drmodels_+3A_resp">resp</code></td>
<td>
<p>Response values at the nodes for the linInt model</p>
</td></tr>
<tr><td><code id="drmodels_+3A_nodes">nodes</code></td>
<td>
<p>Interpolation nodes for the linear interpolation for the linInt
model (treated as a fixed value, not estimated)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <b>Emax model</b> is used to represent monotone, concave dose-response
shapes.  To distinguish it from the more general sigmoid emax model it is
sometimes also called hyperbolic emax model.
</p>
<p>The <b>sigmoid Emax</b> model is an extension of the (hyperbolic) Emax model
by introducing an additional parameter h, that determines the steepness of
the curve at the ed50 value. The sigmoid Emax model describes monotonic,
sigmoid dose-response relationships. In the toxicology literature this model
is also called four-parameter log-logistic (4pLL) model.
</p>
<p>The <b>quadratic</b> model is intended to capture a possible non-monotonic
dose-response relationship.
</p>
<p>The <b>exponential model</b> is intended to capture a possible sub-linear or
a convex dose-response relationship.
</p>
<p>The <b>beta model</b> is intended to capture non-monotone dose-response
relationships and is more flexible than the quadratic model.  The kernel of
the beta model function consists of the kernel of the density function of a
beta distribution on the interval [0,scal]. The parameter scal is not
estimated but needs to be set to a value larger than the maximum dose. It
can be set in most functions (&lsquo;<span class="samp">&#8288;fitMod&#8288;</span>&rsquo;, &lsquo;<span class="samp">&#8288;Mods&#8288;</span>&rsquo;) via the
&lsquo;<span class="samp">&#8288;addArgs&#8288;</span>&rsquo; argument, when omitted a value of &lsquo;<span class="samp">&#8288;1.2*(maximum dose)&#8288;</span>&rsquo;
is used as default, where the maximum dose is inferred from other input to
the respective function.
</p>
<p>The <b>linear in log-dose</b> model is intended to capture concave shapes.
The parameter <code>off</code> is not estimated in the code but set to a
pre-specified value. It can be set in most functions (&lsquo;<span class="samp">&#8288;fitMod&#8288;</span>&rsquo;,
&lsquo;<span class="samp">&#8288;Mods&#8288;</span>&rsquo;) via the &lsquo;<span class="samp">&#8288;addArgs&#8288;</span>&rsquo; argument, when omitted a value of
&lsquo;<span class="samp">&#8288;0.01*(maximum dose)&#8288;</span>&rsquo; is used as default, where the maximum dose is
inferred from other input to the respective function.
</p>
<p>The <b>logistic model</b> is intended to capture general monotone, sigmoid
dose-response relationships. The logistic model and the sigmoid Emax model
are closely related: The sigmoid Emax model is a logistic model in
log(dose).
</p>
<p>The <b>linInt model</b> provids linear interpolation of the means at the
doses. This can be used as a &quot;nonparametric&quot; estimate of the dose-response
curve, but is probably most interesting for specifying a &quot;nonparametric&quot;
truth during planning and assess how well parametric models work under a
nonparametric truth. For the function &lsquo;<span class="samp">&#8288;Mods&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;fitMod&#8288;</span>&rsquo; the
interpolation &lsquo;<span class="samp">&#8288;nodes&#8288;</span>&rsquo; are selected equal to the dose-levels specified.
</p>


<h3>Value</h3>

<p>Response value for model functions or matrix containing the gradient
evaluations.
</p>


<h3>References</h3>

<p>MacDougall, J. (2006). Analysis of dose-response studies - Emax
model,<em>in</em> N. Ting (ed.), <em>Dose Finding in Drug Development</em>,
Springer, New York, pp. 127&ndash;145
</p>
<p>Pinheiro, J. C., Bretz, F. and Branson, M. (2006). Analysis of dose-response
studies - modeling approaches, <em>in</em> N. Ting (ed.). <em>Dose Finding
in Drug Development</em>, Springer, New York, pp. 146&ndash;171
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitMod">fitMod</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## some quadratic example shapes
quadModList &lt;- Mods(quadratic = c(-0.5, -0.75, -0.85, -1), doses = c(0,1))
plotMods(quadModList)

## some emax example shapes
emaxModList &lt;- Mods(emax = c(0.02,0.1,0.5,1), doses = c(0,1))
plotMods(emaxModList)
## example for gradient
emaxGrad(dose = (0:4)/4, eMax = 1, ed50 = 0.5)

## some sigmoid emax example shapes
sigEmaxModList &lt;- Mods(sigEmax = rbind(c(0.05,1), c(0.15,3), c(0.4,8),
                       c(0.7,8)), doses = c(0,1))
plotMods(sigEmaxModList)
sigEmaxGrad(dose = (0:4)/4, eMax = 1, ed50 = 0.5, h = 8)

## some exponential example shapes
expoModList &lt;- Mods(exponential = c(0.1,0.25,0.5,2), doses=c(0,1))
plotMods(expoModList)
exponentialGrad(dose = (0:4)/4, e1 = 1, delta = 2)

## some beta model example shapes
betaModList &lt;- Mods(betaMod = rbind(c(1,1), c(1.5,0.75), c(0.8,2.5),
                    c(0.4,0.9)), doses=c(0,1), addArgs=list(scal = 1.2))
plotMods(betaModList)
betaModGrad(dose = (0:4)/4, eMax = 1, delta1 = 1, delta2 = 1, scal = 5)

## some logistic model example shapes
logistModList &lt;- Mods(logistic = rbind(c(0.5,0.05), c(0.5,0.15),
                      c(0.2,0.05), c(0.2,0.15)), doses=c(0,1))
plotMods(logistModList)
logisticGrad(dose = (0:4)/4, eMax = 1, ed50 = 0.5, delta = 0.05)

## some linInt shapes
genModList &lt;- Mods(linInt = rbind(c(0.5,1,1),
                      c(0,1,1), c(0,0,1)), doses=c(0,0.5,1,1.5))
plotMods(genModList)
linIntGrad(dose = (0:4)/4, resp=c(0,0.5,1,1,1), nodes=(0:4)/4)


</code></pre>

<hr>
<h2 id='fitMod'>Fit non-linear dose-response model</h2><span id='topic+fitMod'></span><span id='topic+coef.DRMod'></span><span id='topic+vcov.DRMod'></span><span id='topic+predict.DRMod'></span><span id='topic+plot.DRMod'></span><span id='topic+logLik.DRMod'></span><span id='topic+AIC.DRMod'></span><span id='topic+gAIC'></span><span id='topic+gAIC.DRMod'></span>

<h3>Description</h3>

<p>Fits a dose-response model. Built-in dose-response models are &quot;linlog&quot;, &quot;linear&quot;, &quot;quadratic&quot;, &quot;emax&quot;, &quot;exponential&quot;,
&quot;sigEmax&quot;, &quot;betaMod&quot; and &quot;logistic&quot; (see <code><a href="#topic+drmodels">drmodels</a></code>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fitMod(
  dose,
  resp,
  data = NULL,
  model = NULL,
  S = NULL,
  type = c("normal", "general"),
  addCovars = ~1,
  placAdj = FALSE,
  bnds,
  df = NULL,
  start = NULL,
  na.action = na.fail,
  control = NULL,
  addArgs = NULL
)

## S3 method for class 'DRMod'
coef(object, sep = FALSE, ...)

## S3 method for class 'DRMod'
vcov(object, ...)

## S3 method for class 'DRMod'
predict(
  object,
  predType = c("full-model", "ls-means", "effect-curve"),
  newdata = NULL,
  doseSeq = NULL,
  se.fit = FALSE,
  ...
)

## S3 method for class 'DRMod'
plot(
  x,
  CI = FALSE,
  level = 0.95,
  plotData = c("means", "meansCI", "raw", "none"),
  plotGrid = TRUE,
  colMn = 1,
  colFit = 1,
  ...
)

## S3 method for class 'DRMod'
logLik(object, ...)

## S3 method for class 'DRMod'
AIC(object, ..., k = 2)

## S3 method for class 'DRMod'
gAIC(object, ..., k = 2)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fitMod_+3A_dose">dose</code>, <code id="fitMod_+3A_resp">resp</code></td>
<td>
<p>Either vectors of equal length specifying dose and response values, or names of variables in the
data frame specified in &lsquo;<span class="samp">&#8288;data&#8288;</span>&rsquo;.</p>
</td></tr>
<tr><td><code id="fitMod_+3A_data">data</code></td>
<td>
<p>Data frame containing the variables referenced in dose and resp if &lsquo;<span class="samp">&#8288;data&#8288;</span>&rsquo; is not specified it is
assumed that &lsquo;<span class="samp">&#8288;dose&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;resp&#8288;</span>&rsquo; are variables referenced from data (and no vectors)</p>
</td></tr>
<tr><td><code id="fitMod_+3A_model">model</code></td>
<td>
<p>The dose-response model to be used for fitting the data. Built-in models are &quot;linlog&quot;, &quot;linear&quot;,
&quot;quadratic&quot;, &quot;emax&quot;, &quot;exponential&quot;, &quot;sigEmax&quot;, &quot;betaMod&quot; and &quot;logistic&quot; (see <a href="#topic+drmodels">drmodels</a>).</p>
</td></tr>
<tr><td><code id="fitMod_+3A_s">S</code></td>
<td>
<p>The inverse weighting matrix used in case, when &lsquo;<span class="samp">&#8288;type = "general"&#8288;</span>&rsquo;, see Description. For later
inference statements (vcov or predict methods) it is assumed this is the estimated covariance of the estimates in
the first stage fit.</p>
</td></tr>
<tr><td><code id="fitMod_+3A_type">type</code></td>
<td>
<p>Determines whether inference is based on an ANCOVA model under a homoscedastic normality assumption (when
&lsquo;<span class="samp">&#8288;type = "normal"&#8288;</span>&rsquo;), or estimates at the doses and their covariance matrix and degrees of freedom are specified
directly in &lsquo;<span class="samp">&#8288;resp&#8288;</span>&rsquo;, &lsquo;<span class="samp">&#8288;S&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;df&#8288;</span>&rsquo;. See also the Description above and Pinheiro et al. (2014).</p>
</td></tr>
<tr><td><code id="fitMod_+3A_addcovars">addCovars</code></td>
<td>
<p>Formula specifying additional additive linear covariates (only for &lsquo;<span class="samp">&#8288;type = "normal"&#8288;</span>&rsquo;)</p>
</td></tr>
<tr><td><code id="fitMod_+3A_placadj">placAdj</code></td>
<td>
<p>Logical, if true, it is assumed that placebo-adjusted
estimates are specified in &lsquo;<span class="samp">&#8288;resp&#8288;</span>&rsquo; (only possible for &lsquo;<span class="samp">&#8288;type =
"general"&#8288;</span>&rsquo;).</p>
</td></tr>
<tr><td><code id="fitMod_+3A_bnds">bnds</code></td>
<td>
<p>Bounds for non-linear parameters. If missing the the default bounds from <code><a href="#topic+defBnds">defBnds</a></code> is used.
</p>
<p>When the dose-response model has only one non-linear parameter (for example Emax or exponential model), &lsquo;<span class="samp">&#8288;bnds&#8288;</span>&rsquo;
needs to be a vector containing upper and lower bound. For models with two non-linear parameters &lsquo;<span class="samp">&#8288;bnds&#8288;</span>&rsquo; needs
to be a matrix containing the bounds in the rows, see the Description section of <code><a href="#topic+defBnds">defBnds</a></code> for details
on the formatting of the bounds for the individual models.</p>
</td></tr>
<tr><td><code id="fitMod_+3A_df">df</code></td>
<td>
<p>Degrees of freedom to use in case of &lsquo;<span class="samp">&#8288;type = "general"&#8288;</span>&rsquo;. If this argument is missing &lsquo;<span class="samp">&#8288;df = Inf&#8288;</span>&rsquo;
is used. For &lsquo;<span class="samp">&#8288;type = "normal"&#8288;</span>&rsquo; this argument is ignored as the exact degrees of freedom can be deduced from
the model.</p>
</td></tr>
<tr><td><code id="fitMod_+3A_start">start</code></td>
<td>
<p>Vector of starting values for the nonlinear parameters (ignored for linear models). When equal to NULL,
a grid optimization is performed and the best value is used as starting value for the local optimizer.</p>
</td></tr>
<tr><td><code id="fitMod_+3A_na.action">na.action</code></td>
<td>
<p>A function which indicates what should happen when the data contain NAs.</p>
</td></tr>
<tr><td><code id="fitMod_+3A_control">control</code></td>
<td>
<p>A list with entries: &quot;nlminbcontrol&quot;, &quot;optimizetol&quot; and &quot;gridSize&quot;.
</p>
<p>The entry nlminbcontrol needs to be a list and it is passed directly to control argument in the nlminb function,
that is used internally for models with 2 nonlinear parameters.
</p>
<p>The entry optimizetol is passed directly to the tol argument of the optimize function, which is used for models
with 1 nonlinear parameters.
</p>
<p>The entry gridSize needs to be a list with entries dim1 and dim2 giving the size of the grid for the gridsearch in
1d or 2d models.</p>
</td></tr>
<tr><td><code id="fitMod_+3A_addargs">addArgs</code></td>
<td>
<p>List containing two entries named &quot;scal&quot; and &quot;off&quot; for the &quot;betaMod&quot; and &quot;linlog&quot; model. When addArgs
is NULL the following defaults is used &lsquo;<span class="samp">&#8288;list(scal = 1.2*max(doses), off = 0.01*max(doses))&#8288;</span>&rsquo;.</p>
</td></tr>
<tr><td><code id="fitMod_+3A_object">object</code>, <code id="fitMod_+3A_x">x</code></td>
<td>
<p>DRMod object</p>
</td></tr>
<tr><td><code id="fitMod_+3A_sep">sep</code></td>
<td>
<p>Logical determining whether all coefficients should be returned in one numeric or separated in a list.</p>
</td></tr>
<tr><td><code id="fitMod_+3A_...">...</code></td>
<td>
<p>Additional arguments for plotting for the plot method. For all other cases additional arguments are
ignored.</p>
</td></tr>
<tr><td><code id="fitMod_+3A_predtype">predType</code>, <code id="fitMod_+3A_newdata">newdata</code>, <code id="fitMod_+3A_doseseq">doseSeq</code>, <code id="fitMod_+3A_se.fit">se.fit</code></td>
<td>
<p>predType determines whether predictions are returned for the full model
(including potential covariates), the ls-means (SAS type) or the effect curve (difference to placebo).
</p>
<p>newdata gives the covariates to use in producing the predictions (for predType = &quot;full-model&quot;), if missing the
covariates used for fitting are used.
</p>
<p>doseSeq dose-sequence on where to produce predictions (for predType = &quot;effect-curve&quot; and predType = &quot;ls-means&quot;). If
missing the doses used for fitting are used.
</p>
<p>se.fit: logical determining, whether the standard error should be calculated.</p>
</td></tr>
<tr><td><code id="fitMod_+3A_ci">CI</code>, <code id="fitMod_+3A_level">level</code>, <code id="fitMod_+3A_plotdata">plotData</code>, <code id="fitMod_+3A_plotgrid">plotGrid</code>, <code id="fitMod_+3A_colmn">colMn</code>, <code id="fitMod_+3A_colfit">colFit</code></td>
<td>
<p>Arguments for plot method: &lsquo;<span class="samp">&#8288;CI&#8288;</span>&rsquo; determines whether confidence
intervals should be plotted. &lsquo;<span class="samp">&#8288;level&#8288;</span>&rsquo; determines the level of the confidence intervals. &lsquo;<span class="samp">&#8288;plotData&#8288;</span>&rsquo;
determines how the data are plotted: Either as means or as means with CI, raw data or none. In case of &lsquo;<span class="samp">&#8288;type =
"normal"&#8288;</span>&rsquo; and covariates the ls-means are displayed, when &lsquo;<span class="samp">&#8288;type = "general"&#8288;</span>&rsquo; the option &quot;raw&quot; is not available.
&lsquo;<span class="samp">&#8288;colMn&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;colFit&#8288;</span>&rsquo; determine the colors of fitted model and the raw means.</p>
</td></tr>
<tr><td><code id="fitMod_+3A_k">k</code></td>
<td>
<p>Penalty to use for model-selection criterion (AIC uses 2, BIC uses log(n)).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When &lsquo;<span class="samp">&#8288;type = "normal"&#8288;</span>&rsquo; ordinary least squares is used and additional additive covariates can be specified in
&lsquo;<span class="samp">&#8288;addCovars&#8288;</span>&rsquo;. The underlying assumption is hence normally distributed data and homoscedastic variance.
</p>
<p>For &lsquo;<span class="samp">&#8288;type = "general"&#8288;</span>&rsquo; a generalized least squares criterion is used
</p>
<p style="text-align: center;"><code class="reqn">
(f(dose,\theta)-resp)'S^{-1}(f(dose,\theta)-resp)</code>
</p>

<p>and an inverse weighting matrix is specified in &lsquo;<span class="samp">&#8288;S&#8288;</span>&rsquo;, &lsquo;<span class="samp">&#8288;type =
"general"&#8288;</span>&rsquo; is primarily of interest, when fitting a model to AN(C)OVA type
estimates obtained in a first stage fit, then &lsquo;<span class="samp">&#8288;resp&#8288;</span>&rsquo; contains the estimates and &lsquo;<span class="samp">&#8288;S&#8288;</span>&rsquo; is the estimated
covariance matrix for the estimates in &lsquo;<span class="samp">&#8288;resp&#8288;</span>&rsquo;. Statistical inference (e.g. confidence intervals) rely on
asymptotic normality of the first stage estimates, which makes this method of interest only for sufficiently large
sample size for the first stage fit. A modified model-selection criterion can be applied to these model fits (see
also Pinheiro et al. 2014 for details).
</p>
<p>For details on the implemented numerical optimizer see the Details section below.
</p>
<p>Details on numerical optimizer for model-fitting:<br /> For linear models fitting is done using numerical linear algebra
based on the QR decomposition.  For nonlinear models numerical optimization is performed only in the nonlinear
parameters in the model and optimizing over the linear parameters in each iteration (similar as the Golub-Pereyra
implemented in <code><a href="stats.html#topic+nls">nls</a></code>). For models with 1 nonlinear parameter the <code><a href="stats.html#topic+optimize">optimize</a></code> function is used
for 2 nonlinear parameters the <code><a href="stats.html#topic+nlminb">nlminb</a></code> function is used. The starting value is generated using a
grid-search (with the grid size specified via &lsquo;<span class="samp">&#8288;control$gridSize&#8288;</span>&rsquo;), or can directly be handed over via
&lsquo;<span class="samp">&#8288;start&#8288;</span>&rsquo;.
</p>
<p>For details on the asymptotic approximation used for &lsquo;<span class="samp">&#8288;type = "normal"&#8288;</span>&rsquo;, see Seber and Wild (2003, chapter 5).
For details on the asymptotic approximation used for &lsquo;<span class="samp">&#8288;type = "general"&#8288;</span>&rsquo;, and the gAIC, see Pinheiro et al.
(2014).
</p>


<h3>Value</h3>

<p>An object of class DRMod. Essentially a list containing information about the fitted model coefficients, the
residual sum of squares (or generalized residual sum of squares),
</p>


<h3>Author(s)</h3>

<p>Bjoern Bornkamp
</p>


<h3>References</h3>

<p>Pinheiro, J. C., Bornkamp, B., Glimm, E. and Bretz, F. (2014) Model-based dose finding under model
uncertainty using general parametric models, <em>Statistics in Medicine</em>, <b>33</b>, 1646&ndash;1661
</p>
<p>Seber, G.A.F. and Wild, C.J. (2003). Nonlinear Regression, Wiley.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+defBnds">defBnds</a></code>, <code><a href="#topic+drmodels">drmodels</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Fit the emax model to the IBScovars data set
data(IBScovars)
fitemax &lt;- fitMod(dose, resp, data=IBScovars, model="emax",
                  bnds = c(0.01, 4))

## methods for DRMod objects
summary(fitemax)
## extracting coefficients
coef(fitemax)
## (asymptotic) covariance matrix of estimates
vcov(fitemax)
## predicting
newdat &lt;- data.frame(dose = c(0,0.5,1), gender=factor(1))
predict(fitemax, newdata=newdat, predType = "full-model", se.fit = TRUE)
## plotting
plot(fitemax, plotData = "meansCI", CI=TRUE)

## now include (additive) covariate gender
fitemax2 &lt;- fitMod(dose, resp, data=IBScovars, model="emax",
                   addCovars = ~gender, bnds = c(0.01, 4))
vcov(fitemax2)
plot(fitemax2)
## fitted log-likelihood
logLik(fitemax2)
## extracting AIC (or BIC)
AIC(fitemax2)

## Illustrating the "general" approach for a binary regression
## produce first stage fit (using dose as factor)
data(migraine)
PFrate &lt;- migraine$painfree/migraine$ntrt
doseVec &lt;- migraine$dose
doseVecFac &lt;- as.factor(migraine$dose)
## fit logistic regression with dose as factor
fitBin &lt;- glm(PFrate~doseVecFac-1, family = binomial,
              weights = migraine$ntrt)
drEst &lt;- coef(fitBin)
vCov &lt;- vcov(fitBin)
## now fit an Emax model (on logit scale)
gfit &lt;- fitMod(doseVec, drEst, S=vCov, model = "emax", bnds = c(0,100),
                type = "general")
## model fit on logit scale
plot(gfit, plotData = "meansCI", CI = TRUE)
## model on probability scale
logitPred &lt;- predict(gfit, predType ="ls-means", doseSeq = 0:200,
                     se.fit=TRUE)
plot(0:200, 1/(1+exp(-logitPred$fit)), type = "l", ylim = c(0, 0.5),
     ylab = "Probability of being painfree", xlab = "Dose")
LB &lt;- logitPred$fit-qnorm(0.975)*logitPred$se.fit
UB &lt;- logitPred$fit+qnorm(0.975)*logitPred$se.fit
lines(0:200, 1/(1+exp(-LB)))
lines(0:200, 1/(1+exp(-UB)))


## now illustrate "general" approach for placebo-adjusted data (on
## IBScovars) note that the estimates are identical to fitemax2 above)
anovaMod &lt;- lm(resp~factor(dose)+gender, data=IBScovars)
drFit &lt;- coef(anovaMod)[2:5] # placebo adjusted estimates at doses
vCov &lt;- vcov(anovaMod)[2:5,2:5]
dose &lt;- sort(unique(IBScovars$dose))[-1]
## now fit an emax model to these estimates
gfit2 &lt;- fitMod(dose, drFit, S=vCov, model = "emax", type = "general",
               placAdj = TRUE, bnds = c(0.01, 2))
## some outputs
summary(gfit2)
coef(gfit2)
vcov(gfit2)
predict(gfit2, se.fit = TRUE, doseSeq = c(1,2,3,4), predType = "effect-curve")
plot(gfit2, CI=TRUE, plotData = "meansCI")
gAIC(gfit2)

</code></pre>

<hr>
<h2 id='glycobrom'>Glycopyrronium Bromide dose-response data</h2><span id='topic+glycobrom'></span>

<h3>Description</h3>

<p>Data from a clinical study evaluating Efficacy and Safety of Four Doses of
Glycopyrronium Bromide in Patients With Stable Chronic Obstructive Pulmonary
Disease (COPD).  This data set was obtained from clinicaltrials.gov
(NCT00501852).  The study design was a 4 period incomplete cross-over
design. The primary endpoint is the trough forced expiratory volume in 1
second (FEV1) following 7 days of Treatment.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(glycobrom)
</code></pre>


<h3>Format</h3>

<p>A data frame with 5 summary estimates (one per dose). Variables:
A data frame with 5 summary estimates (one per dose). Variables:
</p>

<dl>
<dt><code>dose</code></dt><dd><p>a numeric vector containing the dose values</p>
</dd>
<dt><code>fev1</code></dt><dd><p>a numeric vector containing the least square
mean per dose</p>
</dd>
<dt><code>sdev</code></dt><dd><p>a numeric vector containing the standard errors
of the least square means per dose</p>
</dd>
<dt><code>n</code></dt><dd><p>Number of participants analyzed per treatment group</p>
</dd>
</dl>



<h3>Details</h3>

<p>The data given here are summary estimates (least-square means) for each
dose.
</p>


<h3>Source</h3>

<p>http://clinicaltrials.gov/ct2/show/results/NCT00501852
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 ## simulate a full data set with given means and sdv (here we ignore
  ## the original study was a cross-over design, and simulate a parallel
  ## group design)
  simData &lt;- function(mn, sd, n, doses, fixed = TRUE){
    ## simulate data with means (mns) and standard deviations (sd), for
    ## fixed = TRUE, the data set will have observed means and standard
    ## deviations as given in mns and sd
    resp &lt;- numeric(sum(n))
    uppind &lt;- cumsum(n)
    lowind &lt;- c(0,uppind)+1
    for(i in 1:length(n)){
      rv &lt;- rnorm(n[i])
      if(fixed)
        rv &lt;- scale(rv)
      resp[lowind[i]:uppind[i]] &lt;- mn[i] + sd[i]*rv
    }
    data.frame(doses=rep(doses, n), resp=resp)
  }
  data(glycobrom)
  fullDat &lt;- simData(glycobrom$fev1, glycobrom$sdev, glycobrom$n,
                     glycobrom$dose)

</code></pre>

<hr>
<h2 id='guesst'>Calculate guesstimates based on prior knowledge</h2><span id='topic+guesst'></span>

<h3>Description</h3>

<p>Calculates guesstimates for standardized model parameter(s) using the general approach described in Pinheiro et al.
(2006).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>guesst(
  d,
  p,
  model = c("emax", "exponential", "logistic", "quadratic", "betaMod", "sigEmax"),
  less = TRUE,
  local = FALSE,
  dMax,
  Maxd,
  scal
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="guesst_+3A_d">d</code></td>
<td>
<p>Vector containing dose value(s).</p>
</td></tr>
<tr><td><code id="guesst_+3A_p">p</code></td>
<td>
<p>Vector of expected percentages of the maximum effect achieved at d.</p>
</td></tr>
<tr><td><code id="guesst_+3A_model">model</code></td>
<td>
<p>Character string. Should be one of &quot;emax&quot;, &quot;exponential&quot;, &quot;quadratic&quot;, &quot;betaMod&quot;, &quot;sigEmax&quot;, &quot;logistic&quot;.</p>
</td></tr>
<tr><td><code id="guesst_+3A_less">less</code></td>
<td>
<p>Logical, only needed in case of quadratic model.  Determines if d is smaller (&lsquo;<span class="samp">&#8288;less=TRUE&#8288;</span>&rsquo;) or larger
(&lsquo;<span class="samp">&#8288;less=FALSE&#8288;</span>&rsquo;) than dopt (see Pinheiro et al. (2006) for details).</p>
</td></tr>
<tr><td><code id="guesst_+3A_local">local</code></td>
<td>
<p>Logical indicating whether local or asymptotic version of guesstimate should be derived (defaults to
&lsquo;<span class="samp">&#8288;FALSE&#8288;</span>&rsquo;).  Only needed for emax, logistic and sigEmax model.  When &lsquo;<span class="samp">&#8288;local=TRUE&#8288;</span>&rsquo; the maximum dose must be
provided via &lsquo;<span class="samp">&#8288;Maxd&#8288;</span>&rsquo;.</p>
</td></tr>
<tr><td><code id="guesst_+3A_dmax">dMax</code></td>
<td>
<p>Dose at which maximum effect occurs, only needed for the beta model</p>
</td></tr>
<tr><td><code id="guesst_+3A_maxd">Maxd</code></td>
<td>
<p>Maximum dose to be administered in the trial</p>
</td></tr>
<tr><td><code id="guesst_+3A_scal">scal</code></td>
<td>
<p>Scale parameter, only needed for the beta model</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Calculates guesstimates for the parameters <code class="reqn">\theta_2</code> of the standardized model function based on the
prior expected percentage of the maximum effect at certain dose levels. Note that this function should be used
together with the <code><a href="#topic+plot.Mods">plot.Mods</a></code> function to ensure that the guesstimates are reflecting the prior beliefs.
</p>
<p>For the logistic and sigmoid emax models at least two pairs (d,p) need to be specified.
</p>
<p>For the beta model the dose at which the maximum effect occurs (dMax) has to be specified in addition to the (d,p)
pair.
</p>
<p>For the exponential model the maximum dose administered (Maxd) needs to be specified in addition to the (d,p) pair.
</p>
<p>For the quadratic model one (d,p) pair is needed. It is advisable to specify the location of the maximum within the
dose range with this pair.
</p>
<p>For the emax, sigmoid Emax and logistic model one can choose between a local and an asymptotic version. In the local
version one explicitly forces the standardized model function to pass through the specified points (d,p). For the
asymptotic version it assumed that the standardized model function is equal to 1 at the largest dose (this is the
approach described in Pinheiro et al. (2006)). If the local version is used, convergence problems with the underlying
nonlinear optimization can occur.
</p>


<h3>Value</h3>

<p>Returns a numeric vector containing the guesstimates.
</p>


<h3>References</h3>

<p>Bornkamp B., Pinheiro J. C., and Bretz, F. (2009). MCPMod: An R
Package for the Design and Analysis of Dose-Finding Studies, <em>Journal
of Statistical Software</em>, <b>29</b>(7), 1&ndash;23
</p>
<p>Pinheiro, J. C., Bretz, F., and Branson, M. (2006). Analysis of dose-response studies - modeling approaches,
<em>in</em> N. Ting (ed.), <em>Dose Finding in Drug Development</em>, Springer, New York, pp. 146&ndash;171
</p>


<h3>See Also</h3>

<p><code><a href="#topic+emax">emax</a></code>, <code><a href="#topic+logistic">logistic</a></code>, <code><a href="#topic+betaMod">betaMod</a></code>, <code><a href="#topic+sigEmax">sigEmax</a></code>,
<code><a href="#topic+quadratic">quadratic</a></code>, <code><a href="#topic+exponential">exponential</a></code>, <code><a href="#topic+plot.Mods">plot.Mods</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Emax model
## Expected percentage of maximum effect: 0.8 is associated with
## dose 0.3 (d,p)=(0.3, 0.8), dose range [0,1]
emx1 &lt;- guesst(d=0.3, p=0.8, model="emax")
emax(0.3,0,1,emx1)
## local approach
emx2 &lt;- guesst(d=0.3, p=0.8, model="emax", local = TRUE, Maxd = 1)
emax(0.3,0,1,emx2)/emax(1,0,1,emx2)
## plot models
models &lt;- Mods(emax=c(emx1, emx2), doses=c(0,1))
plot(models)

## Logistic model
## Select two (d,p) pairs (0.2, 0.6) and (0.2, 0.95)
lgc1 &lt;- guesst(d = c(0.2, 0.6), p = c(0.2, 0.95), "logistic")
logistic(c(0.2,0.6), 0, 1, lgc1[1], lgc1[2])
## local approach
lgc2 &lt;- guesst(d = c(0.2, 0.6), p = c(0.2, 0.95), "logistic",
               local = TRUE, Maxd = 1)
r0 &lt;- logistic(0, 0, 1, lgc2[1], lgc2[2])
r1 &lt;- logistic(1, 0, 1, lgc2[1], lgc2[2])
(logistic(c(0.2,0.6), 0, 1, lgc2[1], lgc2[2])-r0)/(r1-r0)
## plot models
models &lt;- Mods(logistic = rbind(lgc1, lgc2), doses=c(0,1))
plot(models)

## Beta Model
## Select one pair (d,p): (0.4,0.8)
## dose, where maximum occurs: 0.8
bta &lt;- guesst(d=0.4, p=0.8, model="betaMod", dMax=0.8, scal=1.2, Maxd=1)
## plot
models &lt;- Mods(betaMod = bta, doses=c(0,1), addArgs = list(scal = 1.2))
plot(models)

## Sigmoid Emax model
## Select two (d,p) pairs (0.2, 0.6) and (0.2, 0.95)
sgE1 &lt;- guesst(d = c(0.2, 0.6), p = c(0.2, 0.95), "sigEmax")
sigEmax(c(0.2,0.6), 0, 1, sgE1[1], sgE1[2])
## local approach
sgE2 &lt;- guesst(d = c(0.2, 0.6), p = c(0.2, 0.95), "sigEmax",
               local = TRUE, Maxd = 1)
sigEmax(c(0.2,0.6), 0, 1, sgE2[1], sgE2[2])/sigEmax(1, 0, 1, sgE2[1], sgE2[2])
models &lt;- Mods(sigEmax = rbind(sgE1, sgE2), doses=c(0,1))
plot(models)

## Quadratic model
## For the quadratic model it is assumed that the maximum effect occurs at
## dose 0.7
quad &lt;- guesst(d = 0.7, p = 1, "quadratic")
models &lt;- Mods(quadratic = quad, doses=c(0,1))
plot(models)

## exponential model
## (d,p) = (0.8,0.5)
expo &lt;- guesst(d = 0.8, p = 0.5, "exponential", Maxd=1)
models &lt;- Mods(exponential = expo, doses=c(0,1))
plot(models)
</code></pre>

<hr>
<h2 id='IBScovars'>Irritable Bowel Syndrome Dose Response data with covariates</h2><span id='topic+IBScovars'></span>

<h3>Description</h3>

<p>A subset of the data used by (Biesheuvel and Hothorn, 2002).  The data are
part of a dose ranging trial on a compound for the treatment of the
irritable bowel syndrome with four active treatment arms, corresponding to
doses 1,2,3,4 and placebo. Note that the original dose levels have been
blinded in this data set for confidentiality. The primary endpoint was a
baseline adjusted abdominal pain score with larger values corresponding to a
better treatment effect. In total 369 patients completed the study, with
nearly balanced allocation across the doses.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(IBScovars)
</code></pre>


<h3>Format</h3>

<p>A data frame with 369 observations on the following 2 variables.
</p>

<dl>
<dt><code>gender</code></dt><dd><p>a factor specifying the gender</p>
</dd>
<dt><code>dose</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>resp</code></dt><dd><p>a numeric vector</p>
</dd>
</dl>



<h3>Source</h3>

<p>Biesheuvel, E. and Hothorn, L. A. (2002). Many-to-one comparisons in
stratified designs, <em>Biometrical Journal</em>, <b>44</b>, 101&ndash;116
</p>

<hr>
<h2 id='maFitMod'>Fit dose-response models via bootstrap model
averaging (bagging)</h2><span id='topic+maFitMod'></span><span id='topic+predict.maFit'></span><span id='topic+plot.maFit'></span><span id='topic+print.maFit'></span>

<h3>Description</h3>

<p>This function fits dose-response models in a bootstrap model
averaging approach motivated by the bagging procedure (Breiman
1996). Given summary estimates for the outcome at each dose, the
function samples summary data from the multivariate normal
distribution. For each sample dose-response models are fit to these
summary estimates and the best model
according to the gAIC is selected.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>maFitMod(dose, resp, S, models, nSim = 1000, control, bnds, addArgs = NULL)

## S3 method for class 'maFit'
predict(
  object,
  summaryFct = function(x) quantile(x, probs = c(0.025, 0.25, 0.5, 0.75, 0.975)),
  doseSeq = NULL,
  ...
)

## S3 method for class 'maFit'
plot(
  x,
  plotData = c("means", "meansCI", "none"),
  xlab = "Dose",
  ylab = "Response",
  title = NULL,
  level = 0.95,
  trafo = function(x) x,
  lenDose = 201,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="maFitMod_+3A_dose">dose</code></td>
<td>
<p>Numeric specifying the dose variable.</p>
</td></tr>
<tr><td><code id="maFitMod_+3A_resp">resp</code></td>
<td>
<p>Numeric specifying the response estimate corresponding
to the doses in <code>dose</code></p>
</td></tr>
<tr><td><code id="maFitMod_+3A_s">S</code></td>
<td>
<p>Covariance matrix associated with the dose-response
estimate specified via <code>resp</code></p>
</td></tr>
<tr><td><code id="maFitMod_+3A_models">models</code></td>
<td>
<p>dose-response models to fit</p>
</td></tr>
<tr><td><code id="maFitMod_+3A_nsim">nSim</code></td>
<td>
<p>Number of bootstrap simulations</p>
</td></tr>
<tr><td><code id="maFitMod_+3A_control">control</code></td>
<td>
<p>Same as the control argument in
<code><a href="#topic+fitMod">fitMod</a></code>.</p>
</td></tr>
<tr><td><code id="maFitMod_+3A_bnds">bnds</code></td>
<td>
<p>Bounds for non-linear parameters. This needs to be a
list with list entries corresponding to the selected bounds. The
names of the list entries need to correspond to the model
names. The <code><a href="#topic+defBnds">defBnds</a></code> function provides the default
selection.</p>
</td></tr>
<tr><td><code id="maFitMod_+3A_addargs">addArgs</code></td>
<td>
<p>List containing two entries named &quot;scal&quot; and &quot;off&quot;
for the &quot;betaMod&quot; and &quot;linlog&quot; model. When addArgs is NULL the
following defaults are used &lsquo;<span class="samp">&#8288;list(scal = 1.2*max(doses), off
= 0.01*max(doses))&#8288;</span>&rsquo;</p>
</td></tr>
<tr><td><code id="maFitMod_+3A_object">object</code></td>
<td>
<p>Object of class maFit</p>
</td></tr>
<tr><td><code id="maFitMod_+3A_summaryfct">summaryFct</code></td>
<td>
<p>If equal to NULL predictions are calculated for
each sampled parameter value. Otherwise a summary function is
applied to the dose-response predictions for each parameter
value.  The default is to calculate 0.025, 0.25, 0.5, 0.75, 0.975
quantiles of the predictions for each dose.</p>
</td></tr>
<tr><td><code id="maFitMod_+3A_doseseq">doseSeq</code></td>
<td>
<p>Where to calculate predictions.</p>
</td></tr>
<tr><td><code id="maFitMod_+3A_...">...</code></td>
<td>
<p>Additional parametes (unused)</p>
</td></tr>
<tr><td><code id="maFitMod_+3A_x">x</code></td>
<td>
<p>object of class maFit</p>
</td></tr>
<tr><td><code id="maFitMod_+3A_plotdata">plotData</code></td>
<td>
<p>Determines how the original data are plotted:
Either as means or as means with CI or not at all. The level of the CI
is determined by the argument &lsquo;<span class="samp">&#8288;level&#8288;</span>&rsquo;.</p>
</td></tr>
<tr><td><code id="maFitMod_+3A_xlab">xlab</code></td>
<td>
<p>x-axis label</p>
</td></tr>
<tr><td><code id="maFitMod_+3A_ylab">ylab</code></td>
<td>
<p>y-axis label</p>
</td></tr>
<tr><td><code id="maFitMod_+3A_title">title</code></td>
<td>
<p>plot title</p>
</td></tr>
<tr><td><code id="maFitMod_+3A_level">level</code></td>
<td>
<p>Level for CI, when plotData is equal to
&lsquo;<span class="samp">&#8288;meansCI&#8288;</span>&rsquo;.</p>
</td></tr>
<tr><td><code id="maFitMod_+3A_trafo">trafo</code></td>
<td>
<p>Plot the fitted models on a transformed scale
(e.g. probability scale if models have been fitted on log-odds
scale). The default for &lsquo;<span class="samp">&#8288;trafo&#8288;</span>&rsquo; is the identity function.</p>
</td></tr>
<tr><td><code id="maFitMod_+3A_lendose">lenDose</code></td>
<td>
<p>Number of grid values to use for display.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class &lsquo;<span class="samp">&#8288;maFit&#8288;</span>&rsquo;, which contains the fitted
dose-response models &lsquo;<span class="samp">&#8288;DRMod&#8288;</span>&rsquo; objects, information on which model
was selected in each bootstrap and basic input parameters.
</p>


<h3>Author(s)</h3>

<p>Bjoern Bornkamp
</p>


<h3>References</h3>

<p>Breiman, L. (1996). Bagging predictors. Machine learning, 24, 123-140.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitMod">fitMod</a></code>, <code><a href="#topic+bFitMod">bFitMod</a></code>, <code><a href="#topic+drmodels">drmodels</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(biom)
## produce first stage fit (using dose as factor)
anMod &lt;- lm(resp~factor(dose)-1, data=biom)
drFit &lt;- coef(anMod)
S &lt;- vcov(anMod)
dose &lt;- sort(unique(biom$dose))
## fit an emax and sigEmax model (increase nSim for real use)
mFit &lt;- maFitMod(dose, drFit, S, model = c("emax", "sigEmax"), nSim = 10)
mFit
plot(mFit, plotData = "meansCI")
ED(mFit, direction = "increasing", p = 0.9)
</code></pre>

<hr>
<h2 id='MCPMod'>
MCPMod - Multiple Comparisons and Modeling
</h2><span id='topic+MCPMod'></span><span id='topic+predict.MCPMod'></span><span id='topic+plot.MCPMod'></span>

<h3>Description</h3>

<p>Tests for a dose-response effect using a model-based multiple contrast
test (see <code><a href="#topic+MCTtest">MCTtest</a></code>), selects one (or several) model(s)
from the significant shapes, fits them using <code><a href="#topic+fitMod">fitMod</a></code>.
For details on the method see Bretz et al. (2005).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MCPMod(dose, resp, data, models, S = NULL, type = c("normal", "general"),
       addCovars = ~1, placAdj = FALSE, selModel = c("AIC", "maxT", "aveAIC"),
       alpha = 0.025, df = NULL, critV = NULL, doseType = c("TD", "ED"),
       Delta, p, pVal = TRUE, alternative = c("one.sided", "two.sided"),
       na.action = na.fail, mvtcontrol = mvtnorm.control(),
       bnds, control = NULL)

## S3 method for class 'MCPMod'
predict(object,
        predType = c("full-model", "ls-means", "effect-curve"),
        newdata = NULL, doseSeq = NULL, se.fit = FALSE, ...)



## S3 method for class 'MCPMod'
plot(x, CI = FALSE, level = 0.95,
       plotData = c("means", "meansCI", "raw", "none"),
       plotGrid = TRUE, colMn = 1, colFit = 1, ...)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="MCPMod_+3A_dose">dose</code>, <code id="MCPMod_+3A_resp">resp</code></td>
<td>

<p>Either vectors of equal length specifying dose and response values,
or names of variables in the data frame specified in &lsquo;<span class="samp">&#8288;data&#8288;</span>&rsquo;.
</p>
</td></tr>
<tr><td><code id="MCPMod_+3A_data">data</code></td>
<td>

<p>Data frame containing the variables referenced in dose and resp if
&lsquo;<span class="samp">&#8288;data&#8288;</span>&rsquo; is not specified it is assumed that &lsquo;<span class="samp">&#8288;dose&#8288;</span>&rsquo; and
&lsquo;<span class="samp">&#8288;resp&#8288;</span>&rsquo; are variables referenced from data (and no vectors)
</p>
</td></tr>
<tr><td><code id="MCPMod_+3A_models">models</code></td>
<td>

<p>An object of class &lsquo;<span class="samp">&#8288;"Mods"&#8288;</span>&rsquo;, see <code><a href="#topic+Mods">Mods</a></code> for
details
</p>
</td></tr>
<tr><td><code id="MCPMod_+3A_s">S</code></td>
<td>

<p>The covariance matrix of &lsquo;<span class="samp">&#8288;resp&#8288;</span>&rsquo; when &lsquo;<span class="samp">&#8288;type = "general"&#8288;</span>&rsquo;,
see Description.
</p>
</td></tr>
<tr><td><code id="MCPMod_+3A_type">type</code></td>
<td>

<p>Determines whether inference is based on an ANCOVA model under a
homoscedastic normality assumption (when &lsquo;<span class="samp">&#8288;type = "normal"&#8288;</span>&rsquo;), or
estimates at the doses and their covariance matrix and degrees of
freedom are specified directly in &lsquo;<span class="samp">&#8288;resp&#8288;</span>&rsquo;, &lsquo;<span class="samp">&#8288;S&#8288;</span>&rsquo; and
&lsquo;<span class="samp">&#8288;df&#8288;</span>&rsquo;. See also <code><a href="#topic+fitMod">fitMod</a></code> and Pinheiro et al. (2014).
</p>
</td></tr>
<tr><td><code id="MCPMod_+3A_addcovars">addCovars</code></td>
<td>

<p>Formula specifying additive linear covariates (for &lsquo;<span class="samp">&#8288;type = "normal"&#8288;</span>&rsquo;)
</p>
</td></tr>
<tr><td><code id="MCPMod_+3A_placadj">placAdj</code></td>
<td>

<p>Logical, if true, it is assumed that placebo-adjusted estimates are
specified in &lsquo;<span class="samp">&#8288;resp&#8288;</span>&rsquo; (only possible for &lsquo;<span class="samp">&#8288;type = "general"&#8288;</span>&rsquo;).
</p>
</td></tr>
<tr><td><code id="MCPMod_+3A_selmodel">selModel</code></td>
<td>

<p>Optional character vector specifying the model selection criterion for
dose estimation.  Possible values are 
</p>

<ul>
<li> <p><code>AIC</code>: Selects model with smallest AIC (this is the default)
</p>
</li>
<li> <p><code>maxT</code>: Selects the model corresponding to the largest t-statistic.
</p>
</li>
<li> <p><code>aveAIC</code>: Uses a weighted average of the models corresponding to the
significant contrasts.  The model weights are chosen by the formula:
<code class="reqn">w_i = \exp(-0.5AIC_i)/\sum_i(\exp(-0.5AIC_i))</code>
See Buckland et al. (1997) for details.
</p>
</li></ul>

<p>For &lsquo;<span class="samp">&#8288;type = "general"&#8288;</span>&rsquo; the &quot;gAIC&quot; is used.
</p>
</td></tr>
<tr><td><code id="MCPMod_+3A_alpha">alpha</code></td>
<td>

<p>Significance level for the multiple contrast test
</p>
</td></tr>
<tr><td><code id="MCPMod_+3A_df">df</code></td>
<td>

<p>Specify the degrees of freedom to use in case &lsquo;<span class="samp">&#8288;type = "general"&#8288;</span>&rsquo;,
for the call to <code><a href="#topic+MCTtest">MCTtest</a></code> and <code><a href="#topic+fitMod">fitMod</a></code>.
Infinite degrees of (&lsquo;<span class="samp">&#8288;df=Inf&#8288;</span>&rsquo;) correspond to the multivariate
normal distribution.
For type = &quot;normal&quot; the degrees of freedom deduced from the AN(C)OVA fit are
used and this argument is ignored.
</p>
</td></tr>
<tr><td><code id="MCPMod_+3A_critv">critV</code></td>
<td>

<p>Supply a pre-calculated critical value. If this argument is NULL, no
critical value will be calculated and the test decision is based on
the p-values. If &lsquo;<span class="samp">&#8288;critV = TRUE&#8288;</span>&rsquo; the critical value will be calculated. 
</p>
</td></tr>
<tr><td><code id="MCPMod_+3A_dosetype">doseType</code>, <code id="MCPMod_+3A_delta">Delta</code>, <code id="MCPMod_+3A_p">p</code></td>
<td>

<p>&lsquo;<span class="samp">&#8288;doseType&#8288;</span>&rsquo; determines the dose to estimate, ED or TD (see also
<code><a href="#topic+Mods">Mods</a></code>), and &lsquo;<span class="samp">&#8288;Delta&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;p&#8288;</span>&rsquo; need to be
specified depending on whether TD or ED is to be estimated.
See <code><a href="#topic+TD">TD</a></code> and <code><a href="#topic+ED">ED</a></code> for details.
</p>
</td></tr>
<tr><td><code id="MCPMod_+3A_pval">pVal</code></td>
<td>

<p>Logical determining, whether p-values should be calculated.
</p>
</td></tr>
<tr><td><code id="MCPMod_+3A_alternative">alternative</code></td>
<td>

<p>Character determining the alternative for the multiple contrast
trend test. 
</p>
</td></tr>
<tr><td><code id="MCPMod_+3A_na.action">na.action</code></td>
<td>

<p>A function which indicates what should happen when
the data contain NAs.
</p>
</td></tr>
<tr><td><code id="MCPMod_+3A_mvtcontrol">mvtcontrol</code></td>
<td>

<p>A list specifying additional control parameters for the &lsquo;<span class="samp">&#8288;qmvt&#8288;</span>&rsquo;
and &lsquo;<span class="samp">&#8288;pmvt&#8288;</span>&rsquo; calls in the code, see also <code><a href="#topic+mvtnorm.control">mvtnorm.control</a></code>
for details.
</p>
</td></tr>
<tr><td><code id="MCPMod_+3A_bnds">bnds</code></td>
<td>

<p>Bounds for non-linear parameters. This needs to be a list with list
entries corresponding to the selected bounds. The names of the list
entries need to correspond to the model names. The
<code><a href="#topic+defBnds">defBnds</a></code> function provides the default selection.
</p>
</td></tr>
<tr><td><code id="MCPMod_+3A_control">control</code></td>
<td>

<p>Control list for the optimization.<br />
A list with entries: &quot;nlminbcontrol&quot;, &quot;optimizetol&quot; and &quot;gridSize&quot;.
</p>
<p>The entry nlminbcontrol needs to be a list and is passed directly to
control argument in the nlminb function, that is used internally for
models with 2 nonlinear parameters (e.g. sigmoid Emax or beta model).
</p>
<p>The entry optimizetol is passed directly to the tol argument of the
optimize function, which is used for models with 1 nonlinear
parameters (e.g. Emax or exponential model).
</p>
<p>The entry gridSize needs to be a list with entries dim1 and dim2
giving the size of the grid for the gridsearch in 1d or 2d models.
</p>
</td></tr>
<tr><td><code id="MCPMod_+3A_object">object</code>, <code id="MCPMod_+3A_x">x</code></td>
<td>

<p>MCPMod object
</p>
</td></tr>
<tr><td><code id="MCPMod_+3A_predtype">predType</code>, <code id="MCPMod_+3A_newdata">newdata</code>, <code id="MCPMod_+3A_doseseq">doseSeq</code>, <code id="MCPMod_+3A_se.fit">se.fit</code>, <code id="MCPMod_+3A_...">...</code></td>
<td>

<p>predType determines whether predictions are returned for the full
model (including potential covariates), the ls-means (SAS type) or the
effect curve (difference to placebo).
</p>
<p>newdata gives the covariates to use in producing the predictions (for
&lsquo;<span class="samp">&#8288;predType = "full-model"&#8288;</span>&rsquo;), if missing the covariates used for fitting
are used.
</p>
<p>doseSeq dose-sequence on where to produce predictions (for
&lsquo;<span class="samp">&#8288;predType = "effect-curve"&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;predType = "ls-means"&#8288;</span>&rsquo;). If
missing the doses used for fitting are used.
</p>
<p>se.fit: logical determining, whether the standard error should be
calculated.
</p>
<p>...: Additional arguments, for plot.MCPMod these are passed to
plot.DRMod.
</p>
</td></tr>
<tr><td><code id="MCPMod_+3A_ci">CI</code>, <code id="MCPMod_+3A_level">level</code>, <code id="MCPMod_+3A_plotdata">plotData</code>, <code id="MCPMod_+3A_plotgrid">plotGrid</code>, <code id="MCPMod_+3A_colmn">colMn</code>, <code id="MCPMod_+3A_colfit">colFit</code></td>
<td>

<p>Arguments for plot method: &lsquo;<span class="samp">&#8288;CI&#8288;</span>&rsquo; determines whether confidence
intervals should be plotted. &lsquo;<span class="samp">&#8288;level&#8288;</span>&rsquo; determines the level of the
confidence intervals. &lsquo;<span class="samp">&#8288;plotData&#8288;</span>&rsquo; determines how the data are plotted:
Either as means or as means with CI, raw data or none. In case of
&lsquo;<span class="samp">&#8288;type = "normal"&#8288;</span>&rsquo; and covariates the ls-means are displayed, when
&lsquo;<span class="samp">&#8288;type = "general"&#8288;</span>&rsquo; the option &quot;raw&quot; is not available.
&lsquo;<span class="samp">&#8288;colMn&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;colFit&#8288;</span>&rsquo; determine the colors of fitted model
and the raw means.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class &lsquo;<span class="samp">&#8288;MCPMod&#8288;</span>&rsquo;, which contains the fitted
&lsquo;<span class="samp">&#8288;MCTtest&#8288;</span>&rsquo; object as well as the &lsquo;<span class="samp">&#8288;DRMod&#8288;</span>&rsquo; objects and
additional information (model selection criteria, dose estimates,
selected models).
</p>


<h3>Author(s)</h3>

<p>Bjoern Bornkamp
</p>


<h3>References</h3>

<p>Bretz, F., Pinheiro, J. C., and Branson, M. (2005), Combining
multiple comparisons and modeling techniques in dose-response
studies, <em>Biometrics</em>, <b>61</b>, 738&ndash;748
</p>
<p>Pinheiro, J. C., Bornkamp, B., and Bretz, F. (2006). Design and analysis of dose finding studies
combining multiple comparisons and modeling procedures, <em>Journal of Biopharmaceutical
Statistics</em>, <b>16</b>, 639&ndash;656
</p>
<p>Pinheiro, J. C., Bretz, F., and Branson, M. (2006). Analysis of dose-response studies - modeling 
approaches, <em>in</em> N. Ting (ed.). <em>Dose Finding in Drug Development</em>, Springer, New York,
pp. 146&ndash;171
</p>
<p>Pinheiro, J. C., Bornkamp, B., Glimm, E. and Bretz, F. (2014)
Model-based dose finding under model uncertainty using general
parametric models, <em>Statistics in Medicine</em>, <b>33</b>,
1646&ndash;1661
</p>
<p>Schorning, K., Bornkamp, B., Bretz, F., &amp; Dette, H. (2016). Model
selection versus model averaging in dose finding
studies. <em>Statistics in Medicine</em>, <b>35</b>, 4021&ndash;4040
</p>
<p>Xun, X. and Bretz, F. (2017) The MCP-Mod methodology: 
Practical Considerations and The DoseFinding R package, 
in O'Quigley, J., Iasonos, A. and Bornkamp, B. (eds)
Handbook of methods for designing, monitoring, and analyzing 
dose-finding trials, CRC press
</p>
<p>Buckland, S. T., Burnham, K. P. and Augustin, N. H. (1997). Model selection an integral part
of inference, <em>Biometrics</em>, <b>53</b>, 603&ndash;618
</p>
<p>Seber, G.A.F. and Wild, C.J. (2003). Nonlinear Regression, Wiley.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+MCTtest">MCTtest</a></code>, <code><a href="#topic+fitMod">fitMod</a></code>, <code><a href="#topic+drmodels">drmodels</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(biom)
## first define candidate model set (only need "standardized" models)
models &lt;- Mods(linear = NULL, emax=c(0.05,0.2), linInt=c(1, 1, 1, 1),
               doses=c(0,0.05,0.2,0.6,1))
plot(models)
## perform MCPMod procedure
MM &lt;- MCPMod(dose, resp, biom, models, Delta=0.5)
## a number of things can be done with an MCPMod object
MM # print method provides basic information
summary(MM) # more information
## predict all significant dose-response models
predict(MM, se.fit=TRUE, doseSeq=c(0,0.2,0.4, 0.9, 1),
        predType="ls-means")
## display all model functions 
plot(MM, plotData="meansCI", CI=TRUE)

## now perform model-averaging
MM2 &lt;- MCPMod(dose, resp, biom, models, Delta=0.5, selModel = "aveAIC")
sq &lt;- seq(0,1,length=11)
pred &lt;- predict(MM, doseSeq=sq, predType="ls-means")
modWeights &lt;- MM2$selMod
## model averaged predictions
pred &lt;- do.call("cbind", pred)%*%modWeights
## model averaged dose-estimate
TDEst &lt;- MM2$doseEst%*%modWeights

## now an example using a general fit and fitting based on placebo
## adjusted first-stage estimates
data(IBScovars)
## ANCOVA fit model including covariates
anovaMod &lt;- lm(resp~factor(dose)+gender, data=IBScovars)
drFit &lt;- coef(anovaMod)[2:5] # placebo adjusted estimates at doses
vCov &lt;- vcov(anovaMod)[2:5,2:5]
dose &lt;- sort(unique(IBScovars$dose))[-1] # no estimate for placebo
## candidate models
models &lt;- Mods(emax = c(0.5, 1), betaMod=c(1,1), doses=c(0,4))
plot(models)
## hand over placebo-adjusted estimates drFit to MCPMod
MM3 &lt;- MCPMod(dose, drFit, S=vCov, models = models, type = "general",
              placAdj = TRUE, Delta=0.2)
plot(MM3, plotData="meansCI")

## The first example, but with critical value handed over
## this is useful, e.g. in simulation studies
MM4 &lt;- MCPMod(dose, resp, biom, models, Delta=0.5, critV = 2.31)
</code></pre>

<hr>
<h2 id='MCTpval'>Calculate multiplicity adjusted p-values for multiple contrast test</h2><span id='topic+MCTpval'></span>

<h3>Description</h3>

<p>Calculate multiplicity adjusted p-values for a maximum contrast test corresponding to a set of contrasts and given a
set of observed test statistics. This function is exported as it may be a useful building block and used in more
complex testing situations that are not covered by <code><a href="#topic+MCTtest">MCTtest</a></code>. Most users probably don't need to use this
function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MCTpval(
  contMat,
  corMat,
  df,
  tStat,
  alternative = c("one.sided", "two.sided"),
  control = mvtnorm.control()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="MCTpval_+3A_contmat">contMat</code></td>
<td>
<p>Contrast matrix to use. The individual contrasts should be saved in the columns of the matrix</p>
</td></tr>
<tr><td><code id="MCTpval_+3A_cormat">corMat</code></td>
<td>
<p>Correlation matrix of contrasts</p>
</td></tr>
<tr><td><code id="MCTpval_+3A_df">df</code></td>
<td>
<p>Degrees of freedom to use for calculation.</p>
</td></tr>
<tr><td><code id="MCTpval_+3A_tstat">tStat</code></td>
<td>
<p>Vector of contrast test statistics</p>
</td></tr>
<tr><td><code id="MCTpval_+3A_alternative">alternative</code></td>
<td>
<p>Character determining the alternative for the multiple contrast trend test.</p>
</td></tr>
<tr><td><code id="MCTpval_+3A_control">control</code></td>
<td>
<p>A list specifying additional control parameters for the &lsquo;<span class="samp">&#8288;qmvt&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;pmvt&#8288;</span>&rsquo; calls in the code,
see also <code><a href="#topic+mvtnorm.control">mvtnorm.control</a></code> for details.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Numeric containing the calculated p-values.
</p>


<h3>Author(s)</h3>

<p>Bjoern Bornkamp
</p>


<h3>References</h3>

<p>Pinheiro, J. C., Bornkamp, B., and Bretz, F. (2006). Design and analysis of dose finding studies
combining multiple comparisons and modeling procedures, <em>Journal of Biopharmaceutical Statistics</em>, <b>16</b>,
639&ndash;656
</p>


<h3>See Also</h3>

<p><code><a href="#topic+MCTtest">MCTtest</a></code>, <code><a href="#topic+optContr">optContr</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(biom)
## define shapes for which to calculate optimal contrasts
modlist &lt;- Mods(emax = 0.05, linear = NULL, logistic = c(0.5, 0.1),
                linInt = c(0, 1, 1, 1), doses = c(0, 0.05, 0.2, 0.6, 1))
contMat &lt;- optContr(modlist, w=1)$contMat
## calculate inputs needed for MCTpval
fit &lt;- lm(resp~factor(dose)-1, data=biom)
est &lt;- coef(fit)
vc &lt;- vcov(fit)
ct &lt;- as.vector(est %*% contMat)
covMat &lt;- t(contMat) %*% vc %*% contMat
den &lt;- sqrt(diag(covMat))
tStat &lt;- ct/den
corMat &lt;- cov2cor(t(contMat) %*% vc %*% contMat)
MCTpval(contMat, corMat, df=100-5, tStat)
## compare to
test &lt;- MCTtest(dose, resp, biom, models=modlist)
attr(test$tStat, "pVal")
</code></pre>

<hr>
<h2 id='MCTtest'>
Performs multiple contrast test
</h2><span id='topic+MCTtest'></span>

<h3>Description</h3>

<p>This function performs a multiple contrast test. The contrasts are
either directly specified in &lsquo;<span class="samp">&#8288;contMat&#8288;</span>&rsquo; or optimal contrasts
derived from the &lsquo;<span class="samp">&#8288;models&#8288;</span>&rsquo; argument. The directionality of the
data (i.e. whether an increase or decrease in the response variable is
beneficial is inferred from the &lsquo;<span class="samp">&#8288;models&#8288;</span>&rsquo; object, see
<code><a href="#topic+Mods">Mods</a></code>).
</p>
<p>For &lsquo;<span class="samp">&#8288;type = "normal"&#8288;</span>&rsquo; an ANCOVA model based on a homoscedastic
normality assumption (with additive covariates specified in
&lsquo;<span class="samp">&#8288;addCovars&#8288;</span>&rsquo;) is fitted.
</p>
<p>For &lsquo;<span class="samp">&#8288;type = "general"&#8288;</span>&rsquo; it is assumed multivariate normally
distributed estimates are specified in &lsquo;<span class="samp">&#8288;resp&#8288;</span>&rsquo; with covariance
given by &lsquo;<span class="samp">&#8288;S&#8288;</span>&rsquo;, and the contrast test statistic is calculated based
on this assumption. Degrees of freedom specified in &lsquo;<span class="samp">&#8288;df&#8288;</span>&rsquo;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MCTtest(dose, resp, data = NULL, models, S = NULL, type = c("normal", "general"),
        addCovars = ~1, placAdj = FALSE, alpha = 0.025, df = NULL,
        critV = NULL, pVal = TRUE,
        alternative = c("one.sided", "two.sided"), na.action = na.fail,
        mvtcontrol = mvtnorm.control(), contMat = NULL)

</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="MCTtest_+3A_dose">dose</code>, <code id="MCTtest_+3A_resp">resp</code></td>
<td>

<p>Either vectors of equal length specifying dose and response values,
or names of variables in the data frame specified in &lsquo;<span class="samp">&#8288;data&#8288;</span>&rsquo;.
</p>
</td></tr>
<tr><td><code id="MCTtest_+3A_data">data</code></td>
<td>

<p>Data frame containing the variables referenced in dose and resp if
&lsquo;<span class="samp">&#8288;data&#8288;</span>&rsquo; is not specified it is assumed that &lsquo;<span class="samp">&#8288;dose&#8288;</span>&rsquo; and
&lsquo;<span class="samp">&#8288;resp&#8288;</span>&rsquo; are variables referenced from data (and no vectors)
</p>
</td></tr>
<tr><td><code id="MCTtest_+3A_models">models</code></td>
<td>

<p>An object of class &lsquo;<span class="samp">&#8288;Mods&#8288;</span>&rsquo;, see <code><a href="#topic+Mods">Mods</a></code> for
details
</p>
</td></tr>
<tr><td><code id="MCTtest_+3A_s">S</code></td>
<td>

<p>The covariance matrix of &lsquo;<span class="samp">&#8288;resp&#8288;</span>&rsquo; when &lsquo;<span class="samp">&#8288;type = "general"&#8288;</span>&rsquo;,
see Description.
</p>
</td></tr>
<tr><td><code id="MCTtest_+3A_type">type</code></td>
<td>

<p>Determines whether inference is based on an ANCOVA model under a
homoscedastic normality assumption (when &lsquo;<span class="samp">&#8288;type = "normal"&#8288;</span>&rsquo;), or
estimates at the doses and their covariance matrix and degrees of
freedom are specified directly in &lsquo;<span class="samp">&#8288;resp&#8288;</span>&rsquo;, &lsquo;<span class="samp">&#8288;S&#8288;</span>&rsquo; and
&lsquo;<span class="samp">&#8288;df&#8288;</span>&rsquo;. See also <code><a href="#topic+fitMod">fitMod</a></code> and Pinheiro et al. (2014).
</p>
</td></tr>
<tr><td><code id="MCTtest_+3A_addcovars">addCovars</code></td>
<td>

<p>Formula specifying additive linear covariates (for &lsquo;<span class="samp">&#8288;type = "normal"&#8288;</span>&rsquo;)
</p>
</td></tr>
<tr><td><code id="MCTtest_+3A_placadj">placAdj</code></td>
<td>

<p>Logical, if true, it is assumed that placebo-adjusted estimates are
specified in &lsquo;<span class="samp">&#8288;resp&#8288;</span>&rsquo; (only possible for &lsquo;<span class="samp">&#8288;type = "general"&#8288;</span>&rsquo;).
</p>
</td></tr>
<tr><td><code id="MCTtest_+3A_alpha">alpha</code></td>
<td>

<p>Significance level for the multiple contrast test
</p>
</td></tr>
<tr><td><code id="MCTtest_+3A_df">df</code></td>
<td>

<p>Specify the degrees of freedom to use in case &lsquo;<span class="samp">&#8288;type = "general"&#8288;</span>&rsquo;.
If this argument is missing &lsquo;<span class="samp">&#8288;df = Inf&#8288;</span>&rsquo; is used (which corresponds
to the multivariate normal distribution).
For type = &quot;normal&quot; the degrees of freedom deduced from the AN(C)OVA fit are
used and this argument is ignored.
</p>
</td></tr>
<tr><td><code id="MCTtest_+3A_critv">critV</code></td>
<td>

<p>Supply a pre-calculated critical value. If this argument is NULL, no
critical value will be calculated and the test decision is based on
the p-values. If &lsquo;<span class="samp">&#8288;critV = TRUE&#8288;</span>&rsquo; the critical value will be calculated. 
</p>
</td></tr>
<tr><td><code id="MCTtest_+3A_pval">pVal</code></td>
<td>

<p>Logical determining, whether p-values should be calculated.
</p>
</td></tr>
<tr><td><code id="MCTtest_+3A_alternative">alternative</code></td>
<td>

<p>Character determining the alternative for the multiple contrast
trend test. 
</p>
</td></tr>
<tr><td><code id="MCTtest_+3A_na.action">na.action</code></td>
<td>

<p>A function which indicates what should happen when
the data contain NAs.
</p>
</td></tr>
<tr><td><code id="MCTtest_+3A_mvtcontrol">mvtcontrol</code></td>
<td>

<p>A list specifying additional control parameters for the &lsquo;<span class="samp">&#8288;qmvt&#8288;</span>&rsquo;
and &lsquo;<span class="samp">&#8288;pmvt&#8288;</span>&rsquo; calls in the code, see also <code><a href="#topic+mvtnorm.control">mvtnorm.control</a></code>
for details.
</p>
</td></tr>
<tr><td><code id="MCTtest_+3A_contmat">contMat</code></td>
<td>

<p>Contrast matrix to apply to the ANCOVA dose-response estimates. The
contrasts need to be in the columns of the matrix (i.e. the column
sums need to be 0).
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Integrals over the multivariate t and multivariate normal distribution
are calculated using the &lsquo;<span class="samp">&#8288;mvtnorm&#8288;</span>&rsquo; package.
</p>


<h3>Value</h3>

<p>An object of class MCTtest, a list containing the output.
</p>


<h3>Author(s)</h3>

<p>Bjoern Bornkamp
</p>


<h3>References</h3>

<p>Hothorn, T., Bretz, F., and Westfall, P. (2008). Simultaneous
Inference in General Parametric Models, <em>Biometrical Journal</em>,
<b>50</b>, 346&ndash;363
</p>
<p>Pinheiro, J. C., Bornkamp, B., Glimm, E. and Bretz, F. (2014)
Model-based dose finding under model uncertainty using general
parametric models, <em>Statistics in Medicine</em>, <b>33</b>,
1646&ndash;1661
</p>


<h3>See Also</h3>

<p><code><a href="#topic+powMCT">powMCT</a></code>, <code><a href="#topic+optContr">optContr</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## example without covariates
data(biom)
## define shapes for which to calculate optimal contrasts
modlist &lt;- Mods(emax = 0.05, linear = NULL, logistic = c(0.5, 0.1),
                linInt = c(0, 1, 1, 1), doses = c(0, 0.05, 0.2, 0.6, 1))
m1 &lt;- MCTtest(dose, resp, biom, models=modlist)
## now calculate critical value (but not p-values)
m2 &lt;- MCTtest(dose, resp, biom, models=modlist, critV = TRUE, pVal = FALSE)
## now hand over critical value
m3 &lt;- MCTtest(dose, resp, biom, models=modlist, critV = 2.24)

## example with covariates
data(IBScovars)
modlist &lt;- Mods(emax = 0.05, linear = NULL, logistic = c(0.5, 0.1),
                linInt = c(0, 1, 1, 1), doses = c(0, 1, 2, 3, 4))
MCTtest(dose, resp, IBScovars, models = modlist, addCovars = ~gender)

## example using general approach (fitted on placebo-adjusted scale)
ancMod &lt;- lm(resp~factor(dose)+gender, data=IBScovars)
## extract estimates and information to feed into MCTtest
drEst &lt;- coef(ancMod)[2:5]
vc &lt;- vcov(ancMod)[2:5, 2:5]
doses &lt;- 1:4
MCTtest(doses, drEst, S = vc, models = modlist, placAdj = TRUE,
        type = "general", df = Inf)

## example with general alternatives handed over
data(biom)
## calculate contrast matrix for the step-contrasts
## represent them as linInt models
models &lt;- Mods(linInt=rbind(c(1,1,1,1),
                            c(0,1,1,1),
                            c(0,0,1,1),
                            c(0,0,0,1)),
                doses=c(0,0.05,0.2,0.6,1))
plot(models)
## now calculate optimal contrasts for these means
## use weights from actual sample sizes
weights &lt;- as.numeric(table(biom$dose))
contMat &lt;- optContr(models, w = weights)
## plot contrasts
plot(contMat)
## perform multiple contrast test
MCTtest(dose, resp, data=biom, contMat = contMat)

## example for using the Dunnett contrasts
## Dunnett contrasts
doses &lt;- sort(unique(biom$dose))
contMat &lt;- rbind(-1, diag(4))
rownames(contMat) &lt;- doses
colnames(contMat) &lt;- paste("D", doses[-1], sep="")
MCTtest(dose, resp, data=biom, contMat = contMat)
</code></pre>

<hr>
<h2 id='migraine'>Migraine Dose Response data</h2><span id='topic+migraine'></span>

<h3>Description</h3>

<p>Data set obtained from clinicaltrials.gov (NCT00712725).  This was
randomized placebo controlled dose-response trial for treatment of acute
migraine. The primary endpoint was &quot;pain freedom at 2 hours postdose&quot; (a
binary measurement).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(migraine)
</code></pre>


<h3>Format</h3>

<p>A data frame with 517 columns corresponding to the patients that
completed the trial
</p>

<dl>
<dt><code>dose</code></dt><dd><p>a numeric vector containing the dose values</p>
</dd>
<dt><code>painfree</code></dt><dd><p>number of treatment responders</p>
</dd>
<dt><code>ntrt</code></dt><dd><p>number of subject per treatment group</p>
</dd>
</dl>



<h3>Source</h3>

<p>http://clinicaltrials.gov/ct2/show/results/NCT00712725
</p>

<hr>
<h2 id='Mods'>Define dose-response models</h2><span id='topic+Mods'></span><span id='topic+getResp'></span><span id='topic+plot.Mods'></span><span id='topic+plotMods'></span>

<h3>Description</h3>

<p>The Mods functions allows to define a set of dose-response models.  The function is used as input object for a number
of other different functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Mods(
  ...,
  doses,
  placEff = 0,
  maxEff,
  direction = c("increasing", "decreasing"),
  addArgs = NULL,
  fullMod = FALSE
)

getResp(fmodels, doses)

plotMods(
  ModsObj,
  nPoints = 200,
  superpose = FALSE,
  xlab = "Dose",
  ylab = "Model means",
  modNams = NULL,
  trafo = function(x) x
)

## S3 method for class 'Mods'
plot(
  x,
  nPoints = 200,
  superpose = FALSE,
  xlab = "Dose",
  ylab = "Model means",
  modNams = NULL,
  plotTD = FALSE,
  Delta,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Mods_+3A_...">...</code></td>
<td>
<p>In function Mods:<br /> Dose-response model names with parameter values specifying the guesstimates for the
<code class="reqn">\theta_2</code> parameters. See <code><a href="#topic+drmodels">drmodels</a></code> for a complete list of dose-response models
implemented. See below for an example specification.<br /> <br /> In function plot.Mods:<br /> Additional arguments to the
&lsquo;<span class="samp">&#8288;xyplot&#8288;</span>&rsquo; call.</p>
</td></tr>
<tr><td><code id="Mods_+3A_doses">doses</code></td>
<td>
<p>Dose levels to be used, this needs to include placebo.</p>
</td></tr>
<tr><td><code id="Mods_+3A_placeff">placEff</code>, <code id="Mods_+3A_maxeff">maxEff</code></td>
<td>
<p>Specify used placebo effect and the maximum effect over placebo.  Either a numeric vector of
the same size as the number of candidate models or of length one.<br /> When these parameters are not specified
&lsquo;<span class="samp">&#8288;placEff = 0&#8288;</span>&rsquo; is assumed, for &lsquo;<span class="samp">&#8288;maxEff = 1&#8288;</span>&rsquo; is assumed, if &lsquo;<span class="samp">&#8288;direction = "increasing"&#8288;</span>&rsquo; and
&lsquo;<span class="samp">&#8288;maxEff = -1&#8288;</span>&rsquo; is assumed, for &lsquo;<span class="samp">&#8288;direction = "decreasing"&#8288;</span>&rsquo;.</p>
</td></tr>
<tr><td><code id="Mods_+3A_direction">direction</code></td>
<td>
<p>Character determining whether the beneficial direction is &lsquo;<span class="samp">&#8288;increasing&#8288;</span>&rsquo; or &lsquo;<span class="samp">&#8288;decreasing&#8288;</span>&rsquo;
with increasing dose levels. This argument is ignored if &lsquo;<span class="samp">&#8288;maxEff&#8288;</span>&rsquo; is specified.</p>
</td></tr>
<tr><td><code id="Mods_+3A_addargs">addArgs</code></td>
<td>
<p>List containing two entries named &quot;scal&quot; and &quot;off&quot; for the &quot;betaMod&quot; and &quot;linlog&quot;. When addArgs is
NULL the following defaults are used &lsquo;<span class="samp">&#8288;list(scal = 1.2*max(doses), off = 0.01*max(doses), nodes = doses)&#8288;</span>&rsquo;.</p>
</td></tr>
<tr><td><code id="Mods_+3A_fullmod">fullMod</code></td>
<td>
<p>Logical determining, whether the model parameters specified in the Mods function (via the ...
argument) should be interpreted as standardized or the full model parameters.</p>
</td></tr>
<tr><td><code id="Mods_+3A_fmodels">fmodels</code></td>
<td>
<p>An object of class Mods</p>
</td></tr>
<tr><td><code id="Mods_+3A_modsobj">ModsObj</code></td>
<td>
<p>For function &lsquo;<span class="samp">&#8288;plotMods&#8288;</span>&rsquo; the &lsquo;<span class="samp">&#8288;ModsObj&#8288;</span>&rsquo; should contain an object of class &lsquo;<span class="samp">&#8288;Mods&#8288;</span>&rsquo;.</p>
</td></tr>
<tr><td><code id="Mods_+3A_npoints">nPoints</code></td>
<td>
<p>Number of points for plotting</p>
</td></tr>
<tr><td><code id="Mods_+3A_superpose">superpose</code></td>
<td>
<p>Logical determining, whether model plots should be superposed</p>
</td></tr>
<tr><td><code id="Mods_+3A_xlab">xlab</code>, <code id="Mods_+3A_ylab">ylab</code></td>
<td>
<p>Label for y-axis and x-axis.</p>
</td></tr>
<tr><td><code id="Mods_+3A_modnams">modNams</code></td>
<td>
<p>When &lsquo;<span class="samp">&#8288;modNams == NULL&#8288;</span>&rsquo;, the names for the panels are determined by the underlying model
functions, otherwise the contents of &lsquo;<span class="samp">&#8288;modNams&#8288;</span>&rsquo; are used.</p>
</td></tr>
<tr><td><code id="Mods_+3A_trafo">trafo</code></td>
<td>
<p>For function &lsquo;<span class="samp">&#8288;plotMods&#8288;</span>&rsquo; there is the option to plot the candidate model set on a transformed scale
(e.g. probability scale if the candidate models are formulated on log-odds scale). The default for &lsquo;<span class="samp">&#8288;trafo&#8288;</span>&rsquo; is
the identity function.</p>
</td></tr>
<tr><td><code id="Mods_+3A_x">x</code></td>
<td>
<p>Object of class Mods with type Mods</p>
</td></tr>
<tr><td><code id="Mods_+3A_plottd">plotTD</code></td>
<td>
<p>&lsquo;<span class="samp">&#8288;plotTD&#8288;</span>&rsquo; is a logical determining, whether the TD should
be plotted. &lsquo;<span class="samp">&#8288;Delta&#8288;</span>&rsquo; is the target effect to estimate for the TD.</p>
</td></tr>
<tr><td><code id="Mods_+3A_delta">Delta</code></td>
<td>
<p>Delta: The target effect size use for the target dose (TD)
(Delta should be &gt; 0).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The dose-response models used in this package (see <code><a href="#topic+drmodels">drmodels</a></code> for details) are of form
</p>
<p style="text-align: center;"><code class="reqn">f(d) = \theta_0+\theta_1 f^0(d,\theta_2)</code>
</p>

<p>where the parameter <code class="reqn">\theta_2</code> is the only non-linear parameter and can be one- or two-dimensional,
depending on the used model.
</p>
<p>One needs to hand over the effect at placebo and the maximum effect in the dose range, from which
<code class="reqn">\theta_0,\theta_1</code> are then back-calculated, the output object is of class &lsquo;<span class="samp">&#8288;"Mods"&#8288;</span>&rsquo;. This
object can form the input for other functions to extract the mean response (&lsquo;<span class="samp">&#8288;getResp&#8288;</span>&rsquo;) or target doses
(<code><a href="#topic+TD">TD</a></code> and <code><a href="#topic+ED">ED</a></code>) corresponding to the models. It is also needed as input to the functions
<code><a href="#topic+powMCT">powMCT</a></code>, <code><a href="#topic+optDesign">optDesign</a></code>
</p>
<p>Some models, for example the beta model (&lsquo;<span class="samp">&#8288;scal&#8288;</span>&rsquo;) and the linlog model (&lsquo;<span class="samp">&#8288;off&#8288;</span>&rsquo;) have parameters that are not
estimated from the data, they need to be specified via the &lsquo;<span class="samp">&#8288;addArgs&#8288;</span>&rsquo; argument.
</p>
<p>The default plot method for &lsquo;<span class="samp">&#8288;Mods&#8288;</span>&rsquo; objects is based on a plot using the &lsquo;<span class="samp">&#8288;lattice&#8288;</span>&rsquo; package for backward
compatibility. The function &lsquo;<span class="samp">&#8288;plotMods&#8288;</span>&rsquo; function implements a plot using the &lsquo;<span class="samp">&#8288;ggplot2&#8288;</span>&rsquo; package.
</p>
<p>NOTE: If a decreasing effect is beneficial for the considered response
variable it needs to specified here, either by using &lsquo;<span class="samp">&#8288;direction =
"decreasing"&#8288;</span>&rsquo; or by specifying a negative &quot;maxEff&quot; argument.
</p>


<h3>Value</h3>

<p>Returns an object of class &lsquo;<span class="samp">&#8288;"Mods"&#8288;</span>&rsquo;. The object contains the specified model parameter values and the
derived linear parameters (based on &lsquo;<span class="samp">&#8288;"placEff"&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;"maxEff"&#8288;</span>&rsquo;) in a list.
</p>


<h3>Author(s)</h3>

<p>Bjoern Bornkamp
</p>


<h3>References</h3>

<p>Pinheiro, J. C., Bornkamp, B., and Bretz, F. (2006). Design and analysis of dose finding studies
combining multiple comparisons and modeling procedures, <em>Journal of Biopharmaceutical Statistics</em>, <b>16</b>,
639&ndash;656
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Mods">Mods</a></code>, <code><a href="#topic+drmodels">drmodels</a></code>, <code><a href="#topic+optDesign">optDesign</a></code>, <code><a href="#topic+powMCT">powMCT</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Example on how to specify candidate models

## Suppose one would like to use the following models with the specified
## guesstimates for theta2, in a situation where the doses to be used are
## 0, 0.05, 0.2, 0.6, 1

## Model            guesstimate(s) for theta2 parameter(s) (name)
## linear           -
## linear in log    -
## Emax             0.05 (ED50)
## Emax             0.3 (ED50)
## exponential      0.7 (delta)
## quadratic       -0.85 (delta)
## logistic         0.4  0.09 (ED50, delta)
## logistic         0.3  0.1 (ED50, delta)
## betaMod          0.3  1.3 (delta1, delta2)
## sigmoid Emax     0.5  2 (ED50, h)
## linInt           0.5 0.75 1 1 (perc of max-effect at doses)
## linInt           0.5 1 0.7 0.5 (perc of max-effect at doses)

## for the linInt model one specifies the effect over placebo for
## each active dose.
## The fixed "scal" parameter of the betaMod is set to 1.2
## The fixed "off"  parameter of the linlog is set to 0.1
## These (standardized) candidate models can be specified as follows

models &lt;- Mods(linear = NULL, linlog = NULL, emax = c(0.05, 0.3),
               exponential = 0.7, quadratic = -0.85,
               logistic = rbind(c(0.4, 0.09), c(0.3, 0.1)),
               betaMod = c(0.3, 1.3), sigEmax = c(0.5, 2),
               linInt = rbind(c(0.5, 0.75, 1, 1), c(0.5, 1, 0.7, 0.5)),
               doses = c(0, 0.05, 0.2, 0.6, 1),
               addArgs = list(scal=1.2, off=0.1))
## "models" now contains the candidate model set, as placEff, maxEff and
## direction were not specified a placebo effect of 0 and an effect of 1
## is assumed

## display of specified candidate set using default plot (based on lattice)
plot(models)
## display using ggplot2
plotMods(models)

## example for creating a candidate set with decreasing response
doses &lt;- c(0, 10, 25, 50, 100, 150)
fmodels &lt;- Mods(linear = NULL, emax = 25,
                   logistic = c(50, 10.88111), exponential = 85,
                   betaMod = rbind(c(0.33, 2.31), c(1.39, 1.39)),
                   linInt = rbind(c(0, 1, 1, 1, 1),
                                  c(0, 0, 1, 1, 0.8)),
                   doses=doses, placEff = 0.5, maxEff = -0.4,
                   addArgs=list(scal=200))
plot(fmodels)
plotMods(fmodels)
## some customizations (different model names, symbols, line-width)
plot(fmodels, lwd = 3, pch = 3, cex=1.2, col="red",
     modNams = paste("mod", 1:8, sep="-"))

## for a full-model object one can calculate the responses
## in a matrix
getResp(fmodels, doses=c(0, 20, 100, 150))

## calculate doses giving an improvement of 0.3 over placebo
TD(fmodels, Delta=0.3, direction = "decreasing")
## discrete version
TD(fmodels, Delta=0.3, TDtype = "discrete", doses=doses, direction = "decreasing")
## doses giving 50% of the maximum effect
ED(fmodels, p=0.5)
ED(fmodels, p=0.5, EDtype = "discrete", doses=doses)

plot(fmodels, plotTD = TRUE, Delta = 0.3)

## example for specifying all model parameters (fullMod=TRUE)
fmods &lt;- Mods(emax = c(0, 1, 0.1), linear = cbind(c(-0.4,0), c(0.2,0.1)),
              sigEmax = c(0, 1.1, 0.5, 3),
              doses = 0:4, fullMod = TRUE)
getResp(fmods, doses=seq(0,4,length=11))
## calculate doses giving an improvement of 0.3 over placebo
TD(fmods, Delta=0.3)
## discrete version
TD(fmods, Delta=0.3, TDtype = "discrete", doses=0:4)
## doses giving 50% of the maximum effect
ED(fmods, p=0.5)
ED(fmods, p=0.5, EDtype = "discrete", doses=0:4)
plot(fmods)
</code></pre>

<hr>
<h2 id='mvpostmix'>Prior to posterior updating for a multivariate normal mixture</h2><span id='topic+mvpostmix'></span>

<h3>Description</h3>

<p>Calculate conjugate posterior mixture of multivariate normals with known covariance matrix 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mvpostmix(priormix, mu_hat, S_hat)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mvpostmix_+3A_priormix">priormix</code></td>
<td>

<p>Prior multivariate normal mixture given as a list of length 3. The
first list entry contains the mixture weights, the second component
the mean vectors and the third component of the list the covariance matrices.
</p>
</td></tr>
<tr><td><code id="mvpostmix_+3A_mu_hat">mu_hat</code></td>
<td>

<p>estimated mean response for each dose
</p>
</td></tr>
<tr><td><code id="mvpostmix_+3A_s_hat">S_hat</code></td>
<td>

<p>estimated covariance matrix
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a posterior multivariate normal mixture as a list of length 3,
containing mixture weights, mean vectors and covariance matrices.
</p>


<h3>Author(s)</h3>

<p>Marius Thomas
</p>


<h3>References</h3>

<p>Bernardo, J. M., and Smith, A. F. (1994). Bayesian theory. John Wiley &amp; Sons.
</p>

<hr>
<h2 id='mvtnorm-control'>Control options for pmvt and qmvt functions</h2><span id='topic+mvtnorm-control'></span><span id='topic+mvtnorm.control'></span>

<h3>Description</h3>

<p>Returns a list (an object of class &quot;GenzBretz&quot;) with control parameters for the &lsquo;<span class="samp">&#8288;pmvt&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;qmvt&#8288;</span>&rsquo; functions
from the &lsquo;<span class="samp">&#8288;mvtnorm&#8288;</span>&rsquo; package. Note that the DoseFinding package always uses &quot;GenzBretz&quot; algorithm. See the mvtnorm
documentation for more information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mvtnorm.control(maxpts = 30000, abseps = 0.001, releps = 0, interval = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mvtnorm-control_+3A_maxpts">maxpts</code></td>
<td>
<p>Maximum number of function values as integer.</p>
</td></tr>
<tr><td><code id="mvtnorm-control_+3A_abseps">abseps</code></td>
<td>
<p>Absolute error tolerance as double.</p>
</td></tr>
<tr><td><code id="mvtnorm-control_+3A_releps">releps</code></td>
<td>
<p>Relative error tolerance as double.</p>
</td></tr>
<tr><td><code id="mvtnorm-control_+3A_interval">interval</code></td>
<td>
<p>Interval to be searched, when the quantile is calculated.</p>
</td></tr>
</table>

<hr>
<h2 id='neurodeg'>Neurodegenerative disease simulated longitudinal dose-finding data set</h2><span id='topic+neurodeg'></span>

<h3>Description</h3>

<p>This simulated data set is motivated by a real Phase 2 clinical study of a
new drug for a neurodegenerative disease. The state of the disease is
measured through a functional scale, with smaller values corresponding to
more severe neurodeterioration. The goal of the drug is to reduce the rate
of disease progression, which is measured by the linear slope of the
functional scale over time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(neurodeg)
</code></pre>


<h3>Format</h3>

<p>A data frame with 100 observations on the following 2 variables.
</p>

<dl>
<dt><code>resp</code></dt><dd><p>a numeric vector containing the response values</p>
</dd>
<dt><code>dose</code></dt><dd><p>a numeric vector containing the dose values</p>
</dd>
<dt><code>id</code></dt><dd><p>Patient ID</p>
</dd>    
<dt><code>time</code></dt><dd><p>time of measurement</p>
</dd>
</dl>



<h3>Details</h3>

<p>The trial design includes placebo and four doses: 1, 3, 10, and 30 mg, with
balanced allocation of 50 patients per arm. Patients are followed up for one
year, with measurements of the functional scale being taken at baseline and
then every three months.
</p>
<p>The functional scale response is assumed to be normally distributed and,
based on historical data, it is believed that the longitudinal progression
of the functional scale over the one year of follow up can be modeled a
simple linear trend. See the example below on how to analyse this type of
data.
</p>
<p>This data set was used in Pinheiro et al. (2014) to illustrate the
generalized MCPMod methodology.
</p>


<h3>Source</h3>

<p>Pinheiro, J. C., Bornkamp, B., Glimm, E. and Bretz, F. (2014)
Model-based dose finding under model uncertainty using general parametric
models, <em>Statistics in Medicine</em>, <b>33</b>, 1646&ndash;1661
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
## reproduce analysis from Pinheiro et al. (2014)
data(neurodeg)
## first fit the linear mixed effect model
library(nlme)
fm &lt;- lme(resp ~ as.factor(dose):time, neurodeg, ~time|id, method = "ML")
muH &lt;- fixef(fm)[-1] # extract estimates
covH &lt;- vcov(fm)[-1,-1]

## derive optimal contrasts for candidate shapes
doses &lt;- c(0, 1, 3, 10, 30)
mod &lt;- Mods(emax = 1.11, quadratic= -0.022, exponential = 8.867,
            linear = NULL, doses = doses) # 
contMat &lt;- optContr(mod, S=covH) # calculate optimal contrasts
## multiple contrast test
MCTtest(doses, muH, S=covH, type = "general", critV = TRUE,
        contMat=contMat)
## fit the emax model
fitMod(doses, muH, S=covH, model="emax", type = "general",
       bnds=c(0.1, 10))


## alternatively one can also fit the model using nlme
nlme(resp ~ b0 + (e0 + eM * dose/(ed50 + dose))*time, neurodeg,
     fixed = b0 + e0 + eM + ed50 ~ 1, random = b0 + e0 ~ 1 | id,
     start = c(200, -4.6, 1.6, 3.2))
## both approaches lead to rather similar results

## End(Not run)

</code></pre>

<hr>
<h2 id='optContr'>Calculate optimal contrasts</h2><span id='topic+optContr'></span><span id='topic+plot.optContr'></span><span id='topic+plotContr'></span>

<h3>Description</h3>

<p>This function calculates a contrast vectors that are optimal for detecting
certain alternatives. The contrast is optimal in the sense of maximizing the
non-centrality parameter of the underlying contrast test statistic:
</p>
<p style="text-align: center;"><code class="reqn">\frac{c'\mu}{\sqrt{c'Sc}}</code>
</p>
<p> Here <code class="reqn">\mu</code> is the
mean vector under the alternative and <code class="reqn">S</code> the covariance matrix
associated with the estimate of <code class="reqn">\mu</code>.  The optimal contrast is
given by </p>
<p style="text-align: center;"><code class="reqn">c^{opt} \propto S^{-1}\left(\mu - \frac{\mu^{\prime}S^{-1}1}
{1^\prime S^{-1} 1}\right),</code>
</p>
 
<p>see Pinheiro et al. (2014).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>optContr(
  models,
  doses,
  w,
  S,
  placAdj = FALSE,
  type = c("unconstrained", "constrained")
)

## S3 method for class 'optContr'
plot(
  x,
  superpose = TRUE,
  xlab = "Dose",
  ylab = NULL,
  plotType = c("contrasts", "means"),
  ...
)

plotContr(optContrObj, xlab = "Dose", ylab = "Contrast coefficients")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="optContr_+3A_models">models</code></td>
<td>
<p>An object of class &lsquo;<span class="samp">&#8288;Mods&#8288;</span>&rsquo; defining the dose-response
shapes for which to calculate optimal contrasts.</p>
</td></tr>
<tr><td><code id="optContr_+3A_doses">doses</code></td>
<td>
<p>Optional argument. If this argument is missing the doses
attribute in the &lsquo;<span class="samp">&#8288;Mods&#8288;</span>&rsquo; object specified in &lsquo;<span class="samp">&#8288;models&#8288;</span>&rsquo; is used.</p>
</td></tr>
<tr><td><code id="optContr_+3A_w">w</code>, <code id="optContr_+3A_s">S</code></td>
<td>
<p>Arguments determining the matrix S used in the formula for the
optimal contrasts. Exactly one of &lsquo;<span class="samp">&#8288;w&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;S&#8288;</span>&rsquo; has to be specified.
Note that &lsquo;<span class="samp">&#8288;w&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;S&#8288;</span>&rsquo; only have to be specified up to
proportionality <br /> </p>
 <dl>
<dt>w</dt><dd><p> Vector specifying weights for the
different doses, in the formula for calculation of the optimal contrasts.
Specifying a weights vector is equivalent to specifying S=diag(1/w) (e.g. in
a homoscedastic case with unequal sample sizes, &lsquo;<span class="samp">&#8288;w&#8288;</span>&rsquo; should be
proportional to the group sample sizes).  </p>
</dd> <dt>S</dt><dd><p> Directly specify a
matrix proportional to the covariance matrix to use.  </p>
</dd> </dl>
</td></tr>
<tr><td><code id="optContr_+3A_placadj">placAdj</code></td>
<td>
<p>Logical determining, whether the contrasts should be applied
to placebo-adjusted estimates. If yes the returned coefficients are no
longer contrasts (i.e. do not sum to 0). However, the result of multiplying
of this &quot;contrast&quot; matrix with the placebo adjusted estimates, will give the
same results as multiplying the original contrast matrix to the unadjusted
estimates.</p>
</td></tr>
<tr><td><code id="optContr_+3A_type">type</code></td>
<td>
<p>For &lsquo;<span class="samp">&#8288;type = "constrained"&#8288;</span>&rsquo; the contrast coefficients of the
zero dose group are constrained to be different from the coefficients of the
active treatment groups. So that a weighted sum of the active treatments is
compared against the zero dose group. For an increasing trend the
coefficient of the zero dose group is negative and all other coefficients
have to be positive (for a decreasing trend the other way round).</p>
</td></tr>
<tr><td><code id="optContr_+3A_x">x</code>, <code id="optContr_+3A_superpose">superpose</code>, <code id="optContr_+3A_xlab">xlab</code>, <code id="optContr_+3A_ylab">ylab</code>, <code id="optContr_+3A_plottype">plotType</code></td>
<td>
<p>Arguments for the plot method for
optContr objects. plotType determines, whether the contrasts or the
underlying (standardized) mean matrix should be plotted.</p>
</td></tr>
<tr><td><code id="optContr_+3A_...">...</code></td>
<td>
<p>Additional arguments for plot method</p>
</td></tr>
<tr><td><code id="optContr_+3A_optcontrobj">optContrObj</code></td>
<td>
<p>For function &lsquo;<span class="samp">&#8288;plotContr&#8288;</span>&rsquo; the &lsquo;<span class="samp">&#8288;optContrObj&#8288;</span>&rsquo;
should contain an object of class &lsquo;<span class="samp">&#8288;optContr&#8288;</span>&rsquo;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note that the directionality (i.e. whether in &quot;increase&quot; in the response
variable is beneficial or a &quot;decrease&quot;, is inferred from the specified
&lsquo;<span class="samp">&#8288;models&#8288;</span>&rsquo; object, see <code><a href="#topic+Mods">Mods</a></code> for details).
</p>
<p>Constrained contrasts (type = &quot;constrained&quot;) add the additional constraint
in the optimization that the sign of the contrast coefficient for control
and active treatments need to be different. The quadratic programming
algorithm from the quadprog package is used to calculate the contrasts.
</p>


<h3>Value</h3>

<p>Object of class &lsquo;<span class="samp">&#8288;optContr&#8288;</span>&rsquo;. A list containing entries contMat
and muMat (i.e. contrast, mean and correlation matrix).
</p>


<h3>Author(s)</h3>

<p>Bjoern Bornkamp
</p>


<h3>References</h3>

<p>Bretz, F., Pinheiro, J. C., and Branson, M. (2005), Combining
multiple comparisons and modeling techniques in dose-response studies,
<em>Biometrics</em>, <b>61</b>, 738&ndash;748
</p>
<p>Pinheiro, J. C., Bornkamp, B., Glimm, E. and Bretz, F. (2014) Model-based
dose finding under model uncertainty using general parametric models,
<em>Statistics in Medicine</em>, <b>33</b>, 1646&ndash;1661
</p>


<h3>See Also</h3>

<p><code><a href="#topic+MCTtest">MCTtest</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
doses &lt;- c(0,10,25,50,100,150)
models &lt;- Mods(linear = NULL, emax = 25,
               logistic = c(50, 10.88111), exponential= 85,
               betaMod=rbind(c(0.33,2.31), c(1.39,1.39)),
               doses = doses, addArgs = list(scal = 200))
contMat &lt;- optContr(models, w = rep(50,6))
plot(contMat)
plotContr(contMat) # display contrasts using ggplot2

## now we would like the "contrasts" for placebo adjusted estimates
dosPlac &lt;- doses[-1]
## matrix proportional to cov-matrix of plac. adj. estimates for balanced data
S &lt;- diag(5)+matrix(1, 5,5)
## note that we explicitly hand over the doses here
contMat0 &lt;- optContr(models, doses=dosPlac, S = S, placAdj = TRUE)
## -&gt; contMat0 is no longer a contrast matrix (columns do not sum to 0)
colSums(contMat0$contMat)
## calculate contrast matrix for unadjusted estimates from this matrix
## (should be same as above)
aux &lt;- rbind(-colSums(contMat0$contMat), contMat0$contMat)
t(t(aux)/sqrt(colSums(aux^2))) ## compare to contMat$contMat

## now calculate constrained contrasts 
if(requireNamespace("quadprog", quietly = TRUE)){
optContr(models, w = rep(50,6), type = "constrained")
optContr(models, doses=dosPlac, S = S, placAdj = TRUE,
         type = "constrained")
}
</code></pre>

<hr>
<h2 id='optDesign'>Function to calculate optimal designs</h2><span id='topic+optDesign'></span><span id='topic+plot.DRdesign'></span><span id='topic+calcCrit'></span><span id='topic+rndDesign'></span>

<h3>Description</h3>

<p>Given a set of models (with full parameter values and model probabilities) the &lsquo;<span class="samp">&#8288;optDesign&#8288;</span>&rsquo; function calculates
the optimal design for estimating the dose-response model parameters (D-optimal) or the design for estimating the
target dose (TD-optimal design) (see Dette, Bretz, Pepelyshev and Pinheiro (2008)), or a mixture of these two
criteria. The design can be plotted (together with the candidate models) using &lsquo;<span class="samp">&#8288;plot.design&#8288;</span>&rsquo;. &lsquo;<span class="samp">&#8288;calcCrit&#8288;</span>&rsquo;
calculates the design criterion for a discrete set of design(s). &lsquo;<span class="samp">&#8288;rndDesign&#8288;</span>&rsquo; provides efficient rounding for the
calculated continous design to a finite sample size.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>optDesign(
  models,
  probs,
  doses,
  designCrit = c("Dopt", "TD", "Dopt&amp;TD", "userCrit"),
  Delta,
  standDopt = TRUE,
  weights,
  nold = rep(0, length(doses)),
  n,
  control = list(),
  optimizer = c("solnp", "Nelder-Mead", "nlminb", "exact"),
  lowbnd = rep(0, length(doses)),
  uppbnd = rep(1, length(doses)),
  userCrit,
  ...
)

calcCrit(
  design,
  models,
  probs,
  doses,
  designCrit = c("Dopt", "TD", "Dopt&amp;TD"),
  Delta,
  standDopt = TRUE,
  weights,
  nold = rep(0, length(doses)),
  n
)

rndDesign(design, n, eps = 1e-04)

## S3 method for class 'DRdesign'
plot(x, models, lwdDes = 10, colDes = rgb(0, 0, 0, 0.3), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="optDesign_+3A_models">models</code></td>
<td>
<p>An object of class &lsquo;<span class="samp">&#8288;c(Mods, fullMod)&#8288;</span>&rsquo;, see the <code><a href="#topic+Mods">Mods</a></code> function for details. When an TD
optimal design should be calculated, the TD needs to exist for all models. If a D-optimal design should be
calculated, you need at least as many doses as there are parameters in the specified models.</p>
</td></tr>
<tr><td><code id="optDesign_+3A_probs">probs</code></td>
<td>
<p>Vector of model probabilities for the models specified in &lsquo;<span class="samp">&#8288;models&#8288;</span>&rsquo;, assumed in the same order as
specified in models</p>
</td></tr>
<tr><td><code id="optDesign_+3A_doses">doses</code></td>
<td>
<p>Optional argument. If this argument is missing the doses attribute in the &lsquo;<span class="samp">&#8288;c(Mods, fullMod)&#8288;</span>&rsquo; object
specified in &lsquo;<span class="samp">&#8288;models&#8288;</span>&rsquo; is used.</p>
</td></tr>
<tr><td><code id="optDesign_+3A_designcrit">designCrit</code></td>
<td>
<p>Determines which type of design to calculate. &quot;TD&amp;Dopt&quot; uses both optimality criteria with equal
weight.</p>
</td></tr>
<tr><td><code id="optDesign_+3A_delta">Delta</code></td>
<td>
<p>Target effect needed for calculating &quot;TD&quot; and &quot;TD&amp;Dopt&quot; type designs.</p>
</td></tr>
<tr><td><code id="optDesign_+3A_standdopt">standDopt</code></td>
<td>
<p>Logical determining, whether the D-optimality criterion (specifically the log-determinant) should be
standardized by the number of parameters in the model or not (only of interest if type = &quot;Dopt&quot; or type =
&quot;TD&amp;Dopt&quot;). This is of interest, when there is more than one model class in the candidate model set (traditionally
standardization this is done in the optimal design literature).</p>
</td></tr>
<tr><td><code id="optDesign_+3A_weights">weights</code></td>
<td>
<p>Vector of weights associated with the response at the doses. Needs to be of the same length as the
&lsquo;<span class="samp">&#8288;doses&#8288;</span>&rsquo;.  This can be used to calculate designs for heteroscedastic or for generalized linear model
situations.</p>
</td></tr>
<tr><td><code id="optDesign_+3A_nold">nold</code>, <code id="optDesign_+3A_n">n</code></td>
<td>
<p>When calculating an optimal design at an interim analysis, &lsquo;<span class="samp">&#8288;nold&#8288;</span>&rsquo; specifies the vector of sample
sizes already allocated to the different doses, and &lsquo;<span class="samp">&#8288;n&#8288;</span>&rsquo; gives sample size for the next cohort.
</p>
<p>For &lsquo;<span class="samp">&#8288;optimizer = "exact"&#8288;</span>&rsquo; one always needs to specify the total sample size via &lsquo;<span class="samp">&#8288;n&#8288;</span>&rsquo;.</p>
</td></tr>
<tr><td><code id="optDesign_+3A_control">control</code></td>
<td>
<p>List containing control parameters passed down to numerical optimization algorithms
(<code><a href="stats.html#topic+optim">optim</a></code>, <code><a href="stats.html#topic+nlminb">nlminb</a></code> or solnp function).<br />
</p>
<p>For &lsquo;<span class="samp">&#8288;type = "exact"&#8288;</span>&rsquo; this should be a list with possible entries &lsquo;<span class="samp">&#8288;maxvls1&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;maxvls2&#8288;</span>&rsquo;,
determining the maximum number of designs allowed for passing to the criterion function (default
&lsquo;<span class="samp">&#8288;maxvls2=1e5&#8288;</span>&rsquo;) and for creating the initial unrestricted matrix of designs (default &lsquo;<span class="samp">&#8288;maxvls1=1e6&#8288;</span>&rsquo;). In
addition there can be an entry &lsquo;<span class="samp">&#8288;groupSize&#8288;</span>&rsquo; in case the patients are allocated a minimum group size is
required.</p>
</td></tr>
<tr><td><code id="optDesign_+3A_optimizer">optimizer</code></td>
<td>
<p>Algorithm used for calculating the optimal design. Options &quot;Nelder-Mead&quot; and &quot;nlminb&quot; use the
<code><a href="stats.html#topic+optim">optim</a></code> and <code><a href="stats.html#topic+nlminb">nlminb</a></code> function and use a trigonometric transformation to turn the
constrained optimization problem into an unconstrained one (see Atkinson, Donev and Tobias, 2007, pages 130,131).
</p>
<p>Option &quot;solnp&quot; uses the solnp function from the Rsolnp package, which implements an optimizer for non-linear
optimization under general constraints.
</p>
<p>Option &quot;exact&quot; tries all given combinations of &lsquo;<span class="samp">&#8288;n&#8288;</span>&rsquo; patients to the given dose groups (subject to the bounds
specified via &lsquo;<span class="samp">&#8288;lowbnd&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;uppbnd&#8288;</span>&rsquo;) and reports the best design. When patients are only allowed to be
allocated in groups of a certain &lsquo;<span class="samp">&#8288;groupSize&#8288;</span>&rsquo;, this can be adjusted via the control argument.
&lsquo;<span class="samp">&#8288;n/groupSize&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;length(doses)&#8288;</span>&rsquo; should be rather small for this approach to be feasible.
</p>
<p>When the number of doses is small (&lt;8) usually &lsquo;<span class="samp">&#8288;"Nelder-Mead"&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;"nlminb"&#8288;</span>&rsquo; are best suited
(&lsquo;<span class="samp">&#8288;"nlminb"&#8288;</span>&rsquo; is usually a bit faster but less stable than &lsquo;<span class="samp">&#8288;"Nelder-Mead"&#8288;</span>&rsquo;). For a larger number of doses
&lsquo;<span class="samp">&#8288;"solnp"&#8288;</span>&rsquo; is the most reliable option (but also slowest) (&lsquo;<span class="samp">&#8288;"Nelder-Mead"&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;"nlminb"&#8288;</span>&rsquo; often
fail). When the sample size is small &lsquo;<span class="samp">&#8288;"exact"&#8288;</span>&rsquo; provides the optimal solution rather quickly.</p>
</td></tr>
<tr><td><code id="optDesign_+3A_lowbnd">lowbnd</code>, <code id="optDesign_+3A_uppbnd">uppbnd</code></td>
<td>
<p>Vectors of the same length as dose vector specifying upper and lower limits for the allocation
weights. This option is only available when using the &quot;solnp&quot; and &quot;exact&quot; optimizers.</p>
</td></tr>
<tr><td><code id="optDesign_+3A_usercrit">userCrit</code></td>
<td>
<p>User defined design criterion, should be a function that given a vector of allocation weights and the
doses returns the criterion function. When specified &lsquo;<span class="samp">&#8288;models&#8288;</span>&rsquo; does not need to be handed over.
</p>
<p>The first argument of &lsquo;<span class="samp">&#8288;userCrit&#8288;</span>&rsquo; should be the vector of design weights, while the second argument should be
the &lsquo;<span class="samp">&#8288;doses&#8288;</span>&rsquo; argument (see example below). Additional arguments to &lsquo;<span class="samp">&#8288;userCrit&#8288;</span>&rsquo; can be passed via ...</p>
</td></tr>
<tr><td><code id="optDesign_+3A_...">...</code></td>
<td>
<p>For function &lsquo;<span class="samp">&#8288;optDesign&#8288;</span>&rsquo; these are additional arguments passed to &lsquo;<span class="samp">&#8288;userCrit&#8288;</span>&rsquo;.<br /> <br /> For
function &lsquo;<span class="samp">&#8288;plot.design&#8288;</span>&rsquo; these are additional parameters passed to <code><a href="#topic+plot.Mods">plot.Mods</a></code>.<br /></p>
</td></tr>
<tr><td><code id="optDesign_+3A_design">design</code></td>
<td>
<p>Argument for &lsquo;<span class="samp">&#8288;rndDesign&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;calcCrit&#8288;</span>&rsquo; functions: Numeric vector (or matrix) of allocation
weights for the different doses. The rows of the matrices need to sum to 1. Alternatively also an object of class
&quot;DRdesign&quot; can be used for &lsquo;<span class="samp">&#8288;rndDesign&#8288;</span>&rsquo;. Note that there should be at least as many design points available as
there are parameters in the dose-response models selected in <code>models</code> (otherwise the code returns an NA).</p>
</td></tr>
<tr><td><code id="optDesign_+3A_eps">eps</code></td>
<td>
<p>Argument for &lsquo;<span class="samp">&#8288;rndDesign&#8288;</span>&rsquo; function: Value under which elements of w will be regarded as 0.</p>
</td></tr>
<tr><td><code id="optDesign_+3A_x">x</code></td>
<td>
<p>Object of class &lsquo;<span class="samp">&#8288;DRdesign&#8288;</span>&rsquo; (for &lsquo;<span class="samp">&#8288;plot.design&#8288;</span>&rsquo;)</p>
</td></tr>
<tr><td><code id="optDesign_+3A_lwddes">lwdDes</code>, <code id="optDesign_+3A_coldes">colDes</code></td>
<td>
<p>Line width and color of the lines plotted for the design (in &lsquo;<span class="samp">&#8288;plot.design&#8288;</span>&rsquo;)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Let <code class="reqn">M_m</code> denote the Fisher information matrix under model m (up to
proportionality). <code class="reqn">M_m</code> is given by <code class="reqn">\sum a_i w_i </code><code class="reqn"> g_i^Tg_i</code>, where <code class="reqn">a_i</code> is
the allocation weight to dose i, <code class="reqn">w_i</code> the weight for dose i specified via &lsquo;<span class="samp">&#8288;weights&#8288;</span>&rsquo; and <code class="reqn">g_i</code>
the gradient vector of model m evaluated at dose i.
</p>
<p>For &lsquo;<span class="samp">&#8288;designCrit = "Dopt"&#8288;</span>&rsquo; the code minimizes the design criterion
</p>
<p style="text-align: center;"><code class="reqn">-\sum_{m}p_m/k_m \log(\det(M_m))</code>
</p>
<p> where <code class="reqn">p_m</code> is the probability for
model m and <code class="reqn">k_m</code> is the number of parameters for model m. When &lsquo;<span class="samp">&#8288;standDopt = FALSE&#8288;</span>&rsquo; the <code class="reqn">k_m</code>
are all assumed to be equal to one.
</p>
<p>For &lsquo;<span class="samp">&#8288;designCrit = "TD"&#8288;</span>&rsquo; the code minimizes the design criterion
</p>
<p style="text-align: center;"><code class="reqn">\sum_{m}p_m \log(v_m)</code>
</p>
<p> where <code class="reqn">p_m</code> is the probability for model m and
<code class="reqn">v_m</code> is proportional to the asymptotic
variance of the TD estimate and given by <code class="reqn">b_m'M_m^{-}b_m</code> (see Dette et al. (2008), p. 1227 for details).
</p>
<p>For &lsquo;<span class="samp">&#8288;designCrit = "Dopt&amp;TD"&#8288;</span>&rsquo; the code minimizes the design criterion
</p>
<p style="text-align: center;"><code class="reqn">\sum_{m}p_m(-0.5\log(\det(M_m))/k_m+0.5\log(v_m))</code>
</p>

<p>Again, for &lsquo;<span class="samp">&#8288;standDopt = FALSE&#8288;</span>&rsquo; the <code class="reqn">k_m</code> are all assumed to be equal to one.
</p>
<p>For details on the &lsquo;<span class="samp">&#8288;rndDesign&#8288;</span>&rsquo; function, see Pukelsheim (1993), Chapter 12.
</p>


<h3>Note</h3>

<p>In some cases (particularly when the number of doses is large, e.g. 7 or larger) it might be necessary to allow
a larger number of iterations in the algorithm (via the argument &lsquo;<span class="samp">&#8288;control&#8288;</span>&rsquo;), particularly for the Nelder-Mead
algorithm. Alternatively one can use the solnp optimizer that is usually the most reliable, but not fastest option.
</p>


<h3>Author(s)</h3>

<p>Bjoern Bornkamp
</p>


<h3>References</h3>

<p>Atkinson, A.C., Donev, A.N. and Tobias, R.D. (2007). Optimum Experimental Designs, with SAS, Oxford
University Press
</p>
<p>Dette, H., Bretz, F., Pepelyshev, A. and Pinheiro, J. C. (2008). Optimal
Designs for Dose Finding Studies, <em>Journal of the American Statisical
Association</em>, <b>103</b>, 1225&ndash;1237
</p>
<p>Pinheiro, J.C., Bornkamp, B. (2017) Designing Phase II Dose-Finding Studies: Sample Size, Doses and Dose Allocation
Weights, in O'Quigley, J., Iasonos, A. and Bornkamp, B. (eds) Handbook of methods for designing, monitoring, and
analyzing dose-finding trials, CRC press
</p>
<p>Pukelsheim, F. (1993). Optimal Design of Experiments, Wiley
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Mods">Mods</a></code>, <code><a href="#topic+drmodels">drmodels</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## calculate designs for Emax model
doses &lt;- c(0, 10, 100)
emodel &lt;- Mods(emax = 15, doses=doses, placEff = 0, maxEff = 1)
optDesign(emodel, probs = 1)
## TD-optimal design
optDesign(emodel, probs = 1, designCrit = "TD", Delta=0.5)
## 50-50 mixture of Dopt and TD
optDesign(emodel, probs = 1, designCrit = "Dopt&amp;TD", Delta=0.5)
## use dose levels different from the ones specified in emodel object
des &lt;- optDesign(emodel, probs = 1, doses = c(0, 5, 20, 100))
## plot models overlaid by design
plot(des, emodel)
## round des to a sample size of exactly 90 patients
rndDesign(des, n=90) ## using the round function would lead to 91 patients

## illustrating different optimizers (see Note above for more comparison)
optDesign(emodel, probs=1, optimizer="Nelder-Mead")
optDesign(emodel, probs=1, optimizer="nlminb")
## optimizer solnp (the default) can deal with lower and upper bounds:
optDesign(emodel, probs=1, designCrit = "TD", Delta=0.5,
          optimizer="solnp", lowbnd = rep(0.2,3))
## exact design using enumeration of all possibilites
optDesign(emodel, probs=1, optimizer="exact", n = 30)
## also allows to fix minimum groupSize
optDesign(emodel, probs=1, designCrit = "TD", Delta=0.5,
          optimizer="exact", n = 30,  control = list(groupSize=5))


## optimal design at interim analysis
## assume there are already 10 patients on each dose and there are 30
## left to randomize, this calculates the optimal increment design
optDesign(emodel, 1, designCrit = "TD", Delta=0.5,
          nold = c(10, 10, 10), n=30)

## use a larger candidate model set
doses &lt;- c(0, 10, 25, 50, 100, 150)
fmods &lt;- Mods(linear = NULL, emax = 25, exponential = 85,
             linlog = NULL, logistic = c(50, 10.8811),
             doses = doses, addArgs=list(off=1),
             placEff=0, maxEff=0.4)
probs &lt;- rep(1/5, 5) # assume uniform prior
desDopt &lt;- optDesign(fmods, probs, optimizer = "nlminb")
desTD &lt;- optDesign(fmods, probs, designCrit = "TD", Delta = 0.2,
                   optimizer = "nlminb")
desMix &lt;- optDesign(fmods, probs, designCrit = "Dopt&amp;TD", Delta = 0.2)
## plot design and truth
plot(desMix, fmods)

## illustrate calcCrit function
## calculate optimal design for beta model
doses &lt;- c(0, 0.49, 25.2, 108.07, 150)
models &lt;- Mods(betaMod = c(0.33, 2.31), doses=doses,
                addArgs=list(scal=200),
                placEff=0, maxEff=0.4)
probs &lt;- 1
deswgts &lt;- optDesign(models, probs, designCrit = "Dopt",
                     control=list(maxit=1000))
## now compare this design to equal allocations on
## 0, 10, 25, 50, 100, 150
doses2 &lt;- c(0, 10, 25, 50, 100, 150)
design2 &lt;- c(1/6, 1/6, 1/6, 1/6, 1/6, 1/6)
crit2 &lt;- calcCrit(design2, models, probs, doses2, designCrit = "Dopt")
## ratio of determinants (returned criterion value is on log scale)
exp(deswgts$crit-crit2)

## example for calculating an optimal design for logistic regression
doses &lt;- c(0, 0.35, 0.5, 0.65, 1)
fMod &lt;- Mods(linear = NULL, doses=doses, placEff=-5, maxEff = 10)
## now calculate weights to use in the covariance matrix
mu &lt;- as.numeric(getResp(fMod, doses=doses))
mu &lt;- 1/(1+exp(-mu))
weights &lt;- mu*(1-mu)
des &lt;- optDesign(fMod, 1, doses, weights = weights)

## one can also specify a user defined criterion function
## here D-optimality for cubic polynomial
CubeCrit &lt;- function(w, doses){
  X &lt;- cbind(1, doses, doses^2, doses^3)
  CVinv &lt;- crossprod(X*w)
  -log(det(CVinv))
}
optDesign(doses = c(0,0.05,0.2,0.6,1),
          designCrit = "userCrit", userCrit = CubeCrit,
          optimizer = "nlminb")
</code></pre>

<hr>
<h2 id='planMod'>Evaluate performance metrics for fitting dose-response models</h2><span id='topic+planMod'></span><span id='topic+plot.planMod'></span><span id='topic+summary.planMod'></span>

<h3>Description</h3>

<p>This function evaluates, the performance metrics for fitting dose-response models (using asymptotic approximations or
simulations). Note that some metrics are available via the print method and others only via the summary
method applied to planMod objects. The implemented metrics are </p>

<ul>
<li><p> Root of the mean-squared error to estimate the placebo-adjusted
dose-response averaged over the used dose-levels, i.e. a rather discrete set
(<code>dRMSE</code>). Available via the print method of planMod objects.  </p>
</li>
<li>
<p>Root of the mean-squared error to estimate the placebo-adjusted
dose-response (<code>cRMSE</code>) averaged over fine (almost continuous) grid at
101 equally spaced values between placebo and the maximum dose. NOTE:
Available via the summary method applied to planMod objects.  </p>
</li>
<li><p> Ratio of
the placebo-adjusted mean-squared error (at the observed doses) of
model-based vs ANOVA approach (<code>Eff-vs-ANOVA</code>). This can be interpreted
on the sample size scale. NOTE: Available via the summary method applied to
planMod objects.  </p>
</li>
<li><p> Power that the (unadjusted) one-sided &lsquo;<span class="samp">&#8288;1-alpha&#8288;</span>&rsquo;
confidence interval comparing the dose with maximum effect vs placebo is
larger than &lsquo;<span class="samp">&#8288;tau&#8288;</span>&rsquo;. By default &lsquo;<span class="samp">&#8288;alpha = 0.025&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;tau = 0&#8288;</span>&rsquo;
(<code>Pow(maxDose)</code>). Available via the print method of planMod objects.
</p>
</li>
<li><p> Probability that the EDp estimate is within the true [EDpLB, EDpUB]
(by default &lsquo;<span class="samp">&#8288;p=0.5&#8288;</span>&rsquo;, &lsquo;<span class="samp">&#8288;pLB=0.25&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;pUB=0.75&#8288;</span>&rsquo;). This metric
gives an idea on the ability to characterize the increasing part of the
dose-response curve (<code>P(EDp)</code>). Available via the print method of
planMod objects.  </p>
</li>
<li><p> Length of the quantile range for a target dose (TD
or EDp). This is calculated by taking the difference of the dUB and dLB
quantile of the empirical distribution of the dose estimates.
(<code>lengthTDCI</code> and <code>lengthEDpCI</code>). It is NOT calculated by
calculating confidence interval lengths in each simulated data-set and
taking the mean. NOTE: Available via the summary method of planMod objects.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>planMod(
  model,
  altModels,
  n,
  sigma,
  S,
  doses,
  asyApprox = TRUE,
  simulation = FALSE,
  alpha = 0.025,
  tau = 0,
  p = 0.5,
  pLB = 0.25,
  pUB = 0.75,
  nSim = 100,
  cores = 1,
  showSimProgress = TRUE,
  bnds,
  addArgs = NULL
)

## S3 method for class 'planMod'
summary(
  object,
  digits = 3,
  len = 101,
  Delta = NULL,
  p = NULL,
  dLB = 0.05,
  dUB = 0.95,
  ...
)

## S3 method for class 'planMod'
plot(
  x,
  type = c("dose-response", "ED", "TD"),
  p,
  Delta,
  placAdj = FALSE,
  xlab = "Dose",
  ylab = "",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="planMod_+3A_model">model</code></td>
<td>
<p>Character vector determining the dose-response model(s) to be used for fitting the data.  When more than
one dose-response model is provided the best fitting model is chosen using the AIC. Built-in models are &quot;linlog&quot;,
&quot;linear&quot;, &quot;quadratic&quot;, &quot;emax&quot;, &quot;exponential&quot;, &quot;sigEmax&quot;, &quot;betaMod&quot; and &quot;logistic&quot; (see <a href="#topic+drmodels">drmodels</a>).</p>
</td></tr>
<tr><td><code id="planMod_+3A_altmodels">altModels</code></td>
<td>
<p>An object of class &lsquo;<span class="samp">&#8288;Mods&#8288;</span>&rsquo;, defining the true mean vectors under which operating characteristics
should be calculated.</p>
</td></tr>
<tr><td><code id="planMod_+3A_n">n</code>, <code id="planMod_+3A_sigma">sigma</code>, <code id="planMod_+3A_s">S</code></td>
<td>
<p>Either a vector &lsquo;<span class="samp">&#8288;n&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;sigma&#8288;</span>&rsquo; or &lsquo;<span class="samp">&#8288;S&#8288;</span>&rsquo; need to be specified.  When &lsquo;<span class="samp">&#8288;n&#8288;</span>&rsquo; and
&lsquo;<span class="samp">&#8288;sigma&#8288;</span>&rsquo; are specified it is assumed computations are made for a normal homoscedastic ANOVA model with group
sample sizes given by &lsquo;<span class="samp">&#8288;n&#8288;</span>&rsquo; and residual standard deviation &lsquo;<span class="samp">&#8288;sigma&#8288;</span>&rsquo;, i.e. the covariance matrix used for
the estimates is thus <code>sigma^2*diag(1/n)</code> and the degrees of freedom are calculated as
<code>sum(n)-nrow(contMat)</code>. When a single number is specified for &lsquo;<span class="samp">&#8288;n&#8288;</span>&rsquo; it is assumed this is the sample size
per group and balanced allocations are used.<br />
</p>
<p>When &lsquo;<span class="samp">&#8288;S&#8288;</span>&rsquo; is specified this will be used as covariance matrix for the estimates.</p>
</td></tr>
<tr><td><code id="planMod_+3A_doses">doses</code></td>
<td>
<p>Doses to use</p>
</td></tr>
<tr><td><code id="planMod_+3A_asyapprox">asyApprox</code>, <code id="planMod_+3A_simulation">simulation</code></td>
<td>
<p>Logicals determining, whether asymptotic approximations or simulations should be
calculated. If multiple models are specified in &lsquo;<span class="samp">&#8288;model&#8288;</span>&rsquo; asymptotic approximations are not available.</p>
</td></tr>
<tr><td><code id="planMod_+3A_alpha">alpha</code>, <code id="planMod_+3A_tau">tau</code></td>
<td>
<p>Significance level for the one-sided confidence interval for model-based contrast of best dose vs
placebo. Tau is the threshold to compare the confidence interval limit to. CI(MaxDCont) gives the percentage that
the bound of the confidence interval was larger than tau.</p>
</td></tr>
<tr><td><code id="planMod_+3A_p">p</code>, <code id="planMod_+3A_plb">pLB</code>, <code id="planMod_+3A_pub">pUB</code></td>
<td>
<p>p determines the type of EDp to estimate. pLB and pUB define the bounds for the EDp estimate. The
performance metric Pr(Id-ED) gives the percentage that the estimated EDp was within the true EDpLB and EDpUB.</p>
</td></tr>
<tr><td><code id="planMod_+3A_nsim">nSim</code></td>
<td>
<p>Number of simulations</p>
</td></tr>
<tr><td><code id="planMod_+3A_cores">cores</code></td>
<td>
<p>Number of cores to use for simulations. By default 1 cores is used, note that cores &gt; 1 will have no
effect Windows, as the mclapply function is used internally.</p>
</td></tr>
<tr><td><code id="planMod_+3A_showsimprogress">showSimProgress</code></td>
<td>
<p>In case of simulations show the progress using a progress-bar.</p>
</td></tr>
<tr><td><code id="planMod_+3A_bnds">bnds</code></td>
<td>
<p>Bounds for non-linear parameters. This needs to be a list with list entries corresponding to the selected
bounds. The names of the list entries need to correspond to the model names. The <code><a href="#topic+defBnds">defBnds</a></code> function
provides the default selection.</p>
</td></tr>
<tr><td><code id="planMod_+3A_addargs">addArgs</code></td>
<td>
<p>See the corresponding argument in function <code><a href="#topic+fitMod">fitMod</a></code>. This argument is directly passed to
fitMod.</p>
</td></tr>
<tr><td><code id="planMod_+3A_object">object</code>, <code id="planMod_+3A_digits">digits</code></td>
<td>
<p>object: A planMod object. digits: Digits in summary output</p>
</td></tr>
<tr><td><code id="planMod_+3A_len">len</code></td>
<td>
<p>Number of equally spaced points to determine the mean-squared error on a grid (cRMSE).</p>
</td></tr>
<tr><td><code id="planMod_+3A_delta">Delta</code></td>
<td>
<p>Additional arguments determining what dose estimate to plot, when &lsquo;<span class="samp">&#8288;type = "ED"&#8288;</span>&rsquo; or &lsquo;<span class="samp">&#8288;type =
"TD"&#8288;</span>&rsquo;</p>
</td></tr>
<tr><td><code id="planMod_+3A_dlb">dLB</code>, <code id="planMod_+3A_dub">dUB</code></td>
<td>
<p>Which quantiles to use for calculation of <code>lengthTDCI</code> and <code>lengthEDpCI</code>. By default dLB =
0.05 and dUB = 0.95, so that this corresponds to a 90% interval.</p>
</td></tr>
<tr><td><code id="planMod_+3A_...">...</code></td>
<td>
<p>Additional arguments (currently ignored)</p>
</td></tr>
<tr><td><code id="planMod_+3A_x">x</code></td>
<td>
<p>An object of class planMod</p>
</td></tr>
<tr><td><code id="planMod_+3A_type">type</code></td>
<td>
<p>Type of plot to produce</p>
</td></tr>
<tr><td><code id="planMod_+3A_placadj">placAdj</code></td>
<td>
<p>When &lsquo;<span class="samp">&#8288;type = "dose-response"&#8288;</span>&rsquo;, this determines whether dose-response estimates are shown on
placebo-adjusted or original scale</p>
</td></tr>
<tr><td><code id="planMod_+3A_xlab">xlab</code>, <code id="planMod_+3A_ylab">ylab</code></td>
<td>
<p>Labels for the plot (ylab only applies for &lsquo;<span class="samp">&#8288;type = "dose-response"&#8288;</span>&rsquo;)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A plot method exists to summarize dose-response and dose estimations graphically.
</p>


<h3>Author(s)</h3>

<p>Bjoern Bornkamp
</p>


<h3>References</h3>

<p>TBD
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitMod">fitMod</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
doses &lt;- c(0,10,25,50,100,150)
fmodels &lt;- Mods(linear = NULL, emax = 25,
                logistic = c(50, 10.88111), exponential= 85,
                betaMod=rbind(c(0.33,2.31),c(1.39,1.39)),
                doses = doses, addArgs=list(scal = 200),
                placEff = 0, maxEff = 0.4)
sigma &lt;- 1
n &lt;- rep(62, 6)*2

model &lt;- "quadratic"
pObj &lt;- planMod(model, fmodels, n, sigma, doses=doses,
               simulation = TRUE,
               alpha = 0.025, nSim = 200,
               p = 0.5, pLB = 0.25, pUB = 0.75)
print(pObj)
## to get additional metrics (e.g. Eff-vs-ANOVA, cRMSE, lengthTDCI, ...)
summary(pObj, p = 0.5, Delta = 0.3)
plot(pObj)
plot(pObj, type = "TD", Delta=0.3)
plot(pObj, type = "ED", p = 0.5)

## End(Not run)
</code></pre>

<hr>
<h2 id='powMCT'>Calculate power for multiple contrast test</h2><span id='topic+powMCT'></span>

<h3>Description</h3>

<p>Calculate power for a multiple contrast test for a set of specified
alternatives.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>powMCT(
  contMat,
  alpha = 0.025,
  altModels,
  n,
  sigma,
  S,
  placAdj = FALSE,
  alternative = c("one.sided", "two.sided"),
  df,
  critV = TRUE,
  control = mvtnorm.control()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="powMCT_+3A_contmat">contMat</code></td>
<td>
<p>Contrast matrix to use. The individual contrasts should be
saved in the columns of the matrix</p>
</td></tr>
<tr><td><code id="powMCT_+3A_alpha">alpha</code></td>
<td>
<p>Significance level to use</p>
</td></tr>
<tr><td><code id="powMCT_+3A_altmodels">altModels</code></td>
<td>
<p>An object of class &lsquo;<span class="samp">&#8288;Mods&#8288;</span>&rsquo;, defining the mean vectors
under which the power should be calculated</p>
</td></tr>
<tr><td><code id="powMCT_+3A_n">n</code>, <code id="powMCT_+3A_sigma">sigma</code>, <code id="powMCT_+3A_s">S</code></td>
<td>
<p>Either a vector &lsquo;<span class="samp">&#8288;n&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;sigma&#8288;</span>&rsquo; or &lsquo;<span class="samp">&#8288;S&#8288;</span>&rsquo; need
to be specified.  When &lsquo;<span class="samp">&#8288;n&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;sigma&#8288;</span>&rsquo; are specified it is assumed
computations are made for a normal homoscedastic ANOVA model with group
sample sizes given by &lsquo;<span class="samp">&#8288;n&#8288;</span>&rsquo; and residual standard deviation &lsquo;<span class="samp">&#8288;sigma&#8288;</span>&rsquo;,
i.e. the covariance matrix used for the estimates is thus
<code>sigma^2*diag(1/n)</code> and the degrees of freedom are calculated as
<code>sum(n)-nrow(contMat)</code>. When a single number is specified for &lsquo;<span class="samp">&#8288;n&#8288;</span>&rsquo;
it is assumed this is the sample size per group and balanced allocations are
used.<br />
</p>
<p>When &lsquo;<span class="samp">&#8288;S&#8288;</span>&rsquo; is specified this will be used as covariance matrix for the
estimates.</p>
</td></tr>
<tr><td><code id="powMCT_+3A_placadj">placAdj</code></td>
<td>
<p>Logical, if true, it is assumed that the standard deviation
or variance matrix of the placebo-adjusted estimates are specified in
&lsquo;<span class="samp">&#8288;sigma&#8288;</span>&rsquo; or &lsquo;<span class="samp">&#8288;S&#8288;</span>&rsquo;, respectively. The contrast matrix has to be
produced on placebo-adjusted scale, see <code><a href="#topic+optContr">optContr</a></code>, so that the
coefficients are no longer contrasts (i.e. do not sum to 0).</p>
</td></tr>
<tr><td><code id="powMCT_+3A_alternative">alternative</code></td>
<td>
<p>Character determining the alternative for the multiple
contrast trend test.</p>
</td></tr>
<tr><td><code id="powMCT_+3A_df">df</code></td>
<td>
<p>Degrees of freedom to assume in case &lsquo;<span class="samp">&#8288;S&#8288;</span>&rsquo; (a general
covariance matrix) is specified. When &lsquo;<span class="samp">&#8288;n&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;sigma&#8288;</span>&rsquo; are
specified the ones from the corresponding ANOVA model are calculated.</p>
</td></tr>
<tr><td><code id="powMCT_+3A_critv">critV</code></td>
<td>
<p>Critical value, if equal to &lsquo;<span class="samp">&#8288;TRUE&#8288;</span>&rsquo; the critical value will
be calculated. Otherwise one can directly specify the critical value here.</p>
</td></tr>
<tr><td><code id="powMCT_+3A_control">control</code></td>
<td>
<p>A list specifying additional control parameters for the
&lsquo;<span class="samp">&#8288;qmvt&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;pmvt&#8288;</span>&rsquo; calls in the code, see also
&lsquo;<span class="samp">&#8288;mvtnorm.control&#8288;</span>&rsquo; for details.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Numeric containing the calculated power values
</p>


<h3>Author(s)</h3>

<p>Bjoern Bornkamp
</p>


<h3>References</h3>

<p>Pinheiro, J. C., Bornkamp, B., and Bretz, F. (2006). Design and
analysis of dose finding studies combining multiple comparisons and modeling
procedures, <em>Journal of Biopharmaceutical Statistics</em>, <b>16</b>,
639&ndash;656
</p>


<h3>See Also</h3>

<p><code><a href="#topic+powN">powN</a></code>, <code><a href="#topic+sampSizeMCT">sampSizeMCT</a></code>,
<code><a href="#topic+MCTtest">MCTtest</a></code>, <code><a href="#topic+optContr">optContr</a></code>, <code><a href="#topic+Mods">Mods</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## look at power under some dose-response alternatives
## first the candidate models used for the contrasts
doses &lt;- c(0,10,25,50,100,150)
## define models to use as alternative 
fmodels &lt;- Mods(linear = NULL, emax = 25,
                logistic = c(50, 10.88111), exponential= 85,
                betaMod=rbind(c(0.33,2.31),c(1.39,1.39)),
                doses = doses, addArgs=list(scal = 200),
                placEff = 0, maxEff = 0.4)
## plot alternatives
plot(fmodels)
## power for to detect a trend
contMat &lt;- optContr(fmodels, w = 1)
powMCT(contMat, altModels = fmodels, n = 50, alpha = 0.05, sigma = 1)

## Not run: 
## power under the Dunnett test
## contrast matrix for Dunnett test with informative names
contMatD &lt;- rbind(-1, diag(5))
rownames(contMatD) &lt;- doses
colnames(contMatD) &lt;- paste("D", doses[-1], sep="")
powMCT(contMatD, altModels = fmodels, n = 50, alpha = 0.05, sigma = 1)

## now investigate power of the contrasts in contMat under "general" alternatives
altFmods &lt;- Mods(linInt = rbind(c(0, 1, 1, 1, 1),
                                  c(0.5, 1, 1, 1, 0.5)),
                 doses=doses, placEff=0, maxEff=0.5)
plot(altFmods)
powMCT(contMat, altModels = altFmods, n = 50, alpha = 0.05, sigma = 1)

## now the first example but assume information only on the
## placebo-adjusted scale
## for balanced allocations and 50 patients with sigma = 1 one obtains
## the following covariance matrix
S &lt;- 1^2/50*diag(6)
## now calculate variance of placebo adjusted estimates
CC &lt;- cbind(-1,diag(5))
V &lt;- (CC)%*%S%*%t(CC)
linMat &lt;- optContr(fmodels, doses = c(10,25,50,100,150),
                   S = V, placAdj = TRUE)
powMCT(linMat, altModels = fmodels, placAdj=TRUE,
       alpha = 0.05, S = V, df=6*50-6) # match df with the df above

## End(Not run)
</code></pre>

<hr>
<h2 id='sampSize'>Sample size calculations</h2><span id='topic+sampSize'></span><span id='topic+sampSizeMCT'></span><span id='topic+targN'></span><span id='topic+plot.targN'></span><span id='topic+powN'></span>

<h3>Description</h3>

<p>The &lsquo;<span class="samp">&#8288;sampSize&#8288;</span>&rsquo; function implements a bisection search algorithm for sample size calculation. The user can hand
over a general target function (via &lsquo;<span class="samp">&#8288;targFunc&#8288;</span>&rsquo;) that is then iterated so that a certain &lsquo;<span class="samp">&#8288;target&#8288;</span>&rsquo; is
achieved. The &lsquo;<span class="samp">&#8288;sampSizeMCT&#8288;</span>&rsquo; is a convenience wrapper of &lsquo;<span class="samp">&#8288;sampSize&#8288;</span>&rsquo; for multiple contrast tests using the
power as target function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sampSize(
  upperN,
  lowerN = floor(upperN/2),
  targFunc,
  target,
  tol = 0.001,
  alRatio,
  Ntype = c("arm", "total"),
  verbose = FALSE
)

sampSizeMCT(
  upperN,
  lowerN = floor(upperN/2),
  ...,
  power,
  sumFct = mean,
  tol = 0.001,
  alRatio,
  Ntype = c("arm", "total"),
  verbose = FALSE
)

targN(
  upperN,
  lowerN,
  step,
  targFunc,
  alRatio,
  Ntype = c("arm", "total"),
  sumFct = c("min", "mean", "max")
)

powN(
  upperN,
  lowerN,
  step,
  ...,
  alRatio,
  Ntype = c("arm", "total"),
  sumFct = c("min", "mean", "max")
)

## S3 method for class 'targN'
plot(x, superpose = TRUE, line.at = NULL, xlab = NULL, ylab = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sampSize_+3A_uppern">upperN</code>, <code id="sampSize_+3A_lowern">lowerN</code></td>
<td>
<p>Upper and lower bound for the target sample size. <code>lowerN</code> defaults to
<code>floor(upperN/2)</code>.</p>
</td></tr>
<tr><td><code id="sampSize_+3A_targfunc">targFunc</code>, <code id="sampSize_+3A_target">target</code></td>
<td>
<p>The target function needs to take as an input the vector of sample sizes in the different dose
groups. For &lsquo;<span class="samp">&#8288;sampSize&#8288;</span>&rsquo; it needs to return a univariate number. For function &lsquo;<span class="samp">&#8288;targN&#8288;</span>&rsquo; it should return a
numerical vector.<br /> <br /> Example: &lsquo;<span class="samp">&#8288;targFunc&#8288;</span>&rsquo; could be a function that calculates the power of a test, and
&lsquo;<span class="samp">&#8288;target&#8288;</span>&rsquo; the desired target power value.  <br /> For function &lsquo;<span class="samp">&#8288;sampSize&#8288;</span>&rsquo; the bisection search iterates the
sample size so that a specific target value is achieved (the implicit assumption is that targFunc is monotonically
increasing in the sample size).<br /> <br /> Function &lsquo;<span class="samp">&#8288;targN&#8288;</span>&rsquo; simply calculates &lsquo;<span class="samp">&#8288;targFunc&#8288;</span>&rsquo; for a given set of
sample sizes.</p>
</td></tr>
<tr><td><code id="sampSize_+3A_tol">tol</code></td>
<td>
<p>A positive numeric value specifying the tolerance level for the bisection search algorithm. Bisection is
stopped if the &lsquo;<span class="samp">&#8288;targFunc&#8288;</span>&rsquo; value is within &lsquo;<span class="samp">&#8288;tol&#8288;</span>&rsquo; of &lsquo;<span class="samp">&#8288;target&#8288;</span>&rsquo;.</p>
</td></tr>
<tr><td><code id="sampSize_+3A_alratio">alRatio</code></td>
<td>
<p>Vector describing the relative patient allocations to the dose groups up to proportionality, e.g.
&lsquo;<span class="samp">&#8288;rep(1, length(doses))&#8288;</span>&rsquo; corresponds to balanced allocations.</p>
</td></tr>
<tr><td><code id="sampSize_+3A_ntype">Ntype</code></td>
<td>
<p>One of &quot;arm&quot; or &quot;total&quot;. Determines, whether the sample size in the smallest arm or the total sample
size is iterated in bisection search algorithm.</p>
</td></tr>
<tr><td><code id="sampSize_+3A_verbose">verbose</code></td>
<td>
<p>Logical value indicating if a trace of the iteration progress of the bisection search algorithm should
be displayed.</p>
</td></tr>
<tr><td><code id="sampSize_+3A_...">...</code></td>
<td>
<p>Arguments directly passed to the <code><a href="#topic+powMCT">powMCT</a></code> function in the &lsquo;<span class="samp">&#8288;sampSizeMCT&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;powN&#8288;</span>&rsquo;
function.</p>
</td></tr>
<tr><td><code id="sampSize_+3A_power">power</code>, <code id="sampSize_+3A_sumfct">sumFct</code></td>
<td>
<p>power is a numeric defining the desired summary power to achieve (in &lsquo;<span class="samp">&#8288;sampSizeMCT&#8288;</span>&rsquo;).</p>
</td></tr>
<tr><td><code id="sampSize_+3A_step">step</code></td>
<td>
<p>Only needed for functions &lsquo;<span class="samp">&#8288;targN&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;powN&#8288;</span>&rsquo;. Stepsize for the sample size at which the target
function is calculated. The steps are calculated via <code>seq(lowerN,upperN,by=step)</code>.</p>
</td></tr>
<tr><td><code id="sampSize_+3A_x">x</code>, <code id="sampSize_+3A_superpose">superpose</code>, <code id="sampSize_+3A_line.at">line.at</code>, <code id="sampSize_+3A_xlab">xlab</code>, <code id="sampSize_+3A_ylab">ylab</code></td>
<td>
<p>arguments for the plot method of &lsquo;<span class="samp">&#8288;targN&#8288;</span>&rsquo; and &lsquo;<span class="samp">&#8288;powN&#8288;</span>&rsquo;, additional
arguments are passed down to the low-level lattice plotting routines.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The &lsquo;<span class="samp">&#8288;targN&#8288;</span>&rsquo; functions calculates a general target function for different given sample sizes. The &lsquo;<span class="samp">&#8288;powN&#8288;</span>&rsquo;
function is a convenience wrapper of &lsquo;<span class="samp">&#8288;targN&#8288;</span>&rsquo; for multiple contrast tests using the power as target function.
</p>


<h3>Author(s)</h3>

<p>Jose Pinheiro, Bjoern Bornkamp
</p>


<h3>References</h3>

<p>Pinheiro, J. C., Bornkamp, B., and Bretz, F. (2006). Design and analysis of dose finding studies
combining multiple comparisons and modeling procedures, <em>Journal of Biopharmaceutical Statistics</em>, <b>16</b>,
639&ndash;656
</p>
<p>Pinheiro, J.C., Bornkamp, B. (2017) Designing Phase II Dose-Finding Studies: Sample Size, Doses and Dose Allocation
Weights, in O'Quigley, J., Iasonos, A. and Bornkamp, B. (eds) Handbook of methods for designing, monitoring, and
analyzing dose-finding trials, CRC press
</p>


<h3>See Also</h3>

<p><code><a href="#topic+powMCT">powMCT</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## sampSize examples

## first define the target function
## first calculate the power to detect all of the models in the candidate set
fmodels &lt;- Mods(linear = NULL, emax = c(25),
                logistic = c(50, 10.88111), exponential=c(85),
                betaMod=matrix(c(0.33,2.31,1.39,1.39), byrow=TRUE, nrow=2),
                doses = c(0,10,25,50,100,150), placEff=0, maxEff=0.4,
                addArgs = list(scal=200))
## contrast matrix to use
contMat &lt;- optContr(fmodels, w=1)
## this function calculates the power under each model and then returns
## the average power under all models
tFunc &lt;- function(n){
  powVals &lt;- powMCT(contMat, altModels=fmodels, n=n, sigma = 1,
                    alpha=0.05)
  mean(powVals)
}

## assume we want to achieve 80% average power over the selected shapes
## and want to use a balanced allocations
## Not run: 
sSize &lt;- sampSize(upperN = 80, targFunc = tFunc, target=0.8,
                  alRatio = rep(1,6), verbose = TRUE)
sSize


## Now the same using the convenience sampSizeMCT function
sampSizeMCT(upperN=80, contMat = contMat, sigma = 1, altModels=fmodels,
            power = 0.8, alRatio = rep(1, 6), alpha = 0.05)
## Alternatively one can also specify an S matrix
## covariance matrix in one observation (6 total observation result in a
## variance of 1 in each group)
S &lt;- 6*diag(6)
## this uses df = Inf, hence a slightly smaller sample size results
sampSizeMCT(upperN=500, contMat = contMat, S=S, altModels=fmodels,
            power = 0.8, alRatio = rep(1, 6), alpha = 0.05, Ntype = "total")


## targN examples
## first calculate the power to detect all of the models in the candidate set
fmodels &lt;- Mods(linear = NULL, emax = c(25),
                logistic = c(50, 10.88111), exponential=c(85),
                betaMod=matrix(c(0.33,2.31,1.39,1.39), byrow=TRUE, nrow=2),
                doses = c(0,10,25,50,100,150), placEff=0, maxEff=0.4,
                addArgs = list(scal=200))
## corresponding contrast matrix
contMat &lt;- optContr(fmodels, w=1)
## define target function
tFunc &lt;- function(n){
  powMCT(contMat, altModels=fmodels, n=n, sigma = 1, alpha=0.05)
}
powVsN &lt;- targN(upperN = 100, lowerN = 10, step = 10, tFunc,
                alRatio = rep(1, 6))
plot(powVsN)

## the same can be achieved using the convenience powN function
## without the need to specify a target function
powN(upperN = 100, lowerN=10, step = 10, contMat = contMat,
     sigma = 1, altModels = fmodels, alpha = 0.05, alRatio = rep(1, 6))

## End(Not run)
</code></pre>

<hr>
<h2 id='Target+20doses'>Calculate dose estimates for a fitted dose-response model (via <code><a href="#topic+fitMod">fitMod</a></code>, <code><a href="#topic+bFitMod">bFitMod</a></code>) 
or <code><a href="#topic+maFitMod">maFitMod</a></code>) or a <code><a href="#topic+Mods">Mods</a></code> object</h2><span id='topic+Target+20doses'></span><span id='topic+TD'></span><span id='topic+ED'></span>

<h3>Description</h3>

<p>The TD (target dose) is defined as the dose that achieves a target effect of Delta over placebo (if
there are multiple such doses, the smallest is chosen):
</p>
<p style="text-align: center;"><code class="reqn">TD_\Delta = \min \{x|f(x) &gt; f(0)+\Delta\}</code>
</p>

<p>If a decreasing trend is beneficial the definition of the TD is
</p>
<p style="text-align: center;"><code class="reqn">TD_\Delta = \min \{x|f(x) &lt; f(0)-\Delta\}</code>
</p>

<p>When <code class="reqn">\Delta</code> is the clinical relevance threshold, then the TD is similar to the usual definition of the
minimum effective dose (MED).
</p>
<p>The ED (effective dose) is defined as the dose that achieves a certain percentage p of the full effect size (within
the observed dose-range!) over placebo (if there are multiple such doses, the smallest is chosen).
</p>
<p style="text-align: center;"><code class="reqn">ED_p=\min\{x|f(x) &gt; f(0) + p(f(dmax)-f(0))</code>
</p>

<p>Note that this definition of the EDp is different from traditional definition based on the Emax model,
where the EDp is defined relative to the <em>asymptotic</em> maximum effect (rather than the maximum effect in the observed dose-range).
</p>
<p>ED or TD calculation for bootstrap model averaging (maFit) objects is based on first calculating the pointwise median dose-response curve estimate. Then calculating the dose estimate based on this curve.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>TD(
  object,
  Delta,
  TDtype = c("continuous", "discrete"),
  direction = c("increasing", "decreasing"),
  doses = NULL
)

ED(
  object,
  p,
  EDtype = c("continuous", "discrete"),
  direction = c("increasing", "decreasing"),
  doses = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Target+2B20doses_+3A_object">object</code></td>
<td>
<p>An object of class c(Mods, fullMod), DRMod, bFitMod or maFit</p>
</td></tr>
<tr><td><code id="Target+2B20doses_+3A_delta">Delta</code>, <code id="Target+2B20doses_+3A_p">p</code></td>
<td>
<p>Delta: The target effect size use for the target dose (TD) (Delta should be &gt; 0).
</p>
<p>p: The percentage of the dose to use for the effective dose.</p>
</td></tr>
<tr><td><code id="Target+2B20doses_+3A_tdtype">TDtype</code>, <code id="Target+2B20doses_+3A_edtype">EDtype</code></td>
<td>
<p>character that determines, whether the dose should be treated as a continuous
variable when calculating the TD/ED or whether the TD/ED should be calculated based on a grid of doses specified in &lsquo;<span class="samp">&#8288;doses&#8288;</span>&rsquo;</p>
</td></tr>
<tr><td><code id="Target+2B20doses_+3A_direction">direction</code></td>
<td>
<p>Direction to be used in defining the TD. This depends on whether an increasing
or decreasing of the response variable is beneficial. In case of ED calculation only needed for maFit objects.</p>
</td></tr>
<tr><td><code id="Target+2B20doses_+3A_doses">doses</code></td>
<td>
<p>Dose levels to be used if &lsquo;<span class="samp">&#8288;TDtype&#8288;</span>&rsquo; or &lsquo;<span class="samp">&#8288;EDtype&#8288;</span>&rsquo; are
equal to &lsquo;<span class="samp">&#8288;"discrete"&#8288;</span>&rsquo;. Needs to include placebo, and may not exceed the dose range of the model(s) provided in &lsquo;<span class="samp">&#8288;object&#8288;</span>&rsquo;.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns the dose estimate
</p>


<h3>Author(s)</h3>

<p>Bjoern Bornkamp
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Mods">Mods</a></code>, <code><a href="#topic+drmodels">drmodels</a></code>,
<code><a href="#topic+fitMod">fitMod</a></code>, <code><a href="#topic+bFitMod">bFitMod</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## example for creating a "full-model" candidate set placebo response
## and maxEff already fixed in Mods call
doses &lt;- c(0, 10, 25, 50, 100, 150)
fmodels &lt;- Mods(linear = NULL, emax = 25,
                logistic = c(50, 10.88111), exponential = 85,
                betaMod = rbind(c(0.33, 2.31), c(1.39, 1.39)),
                linInt = rbind(c(0, 1, 1, 1, 1),
                               c(0, 0, 1, 1, 0.8)),
                doses=doses, placEff = 0, maxEff = 0.4,
                addArgs=list(scal=200))
## calculate doses giving an improvement of 0.3 over placebo
TD(fmodels, Delta=0.3)
## discrete version
TD(fmodels, Delta=0.3, TDtype = "discrete", doses=doses)
## doses giving 50% of the maximum effect
ED(fmodels, p=0.5)
ED(fmodels, p=0.5, EDtype = "discrete", doses=doses)
plot(fmodels, plotTD = TRUE, Delta = 0.3)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
