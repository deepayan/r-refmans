<!DOCTYPE html><html lang="en"><head><title>Help for package actxps</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {actxps}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#actxps-package'><p>actxps: Create Actuarial Experience Studies: Prepare Data, Summarize Results, and Create Reports</p></a></li>
<li><a href='#add_predictions'><p>Add predictions to a data frame</p></a></li>
<li><a href='#add_transactions'><p>Add transactions to an experience study</p></a></li>
<li><a href='#agg_sim_dat'><p>Aggregate simulated annuity data</p></a></li>
<li><a href='#as_exp_df'><p>Termination summary helper functions</p></a></li>
<li><a href='#as_trx_df'><p>Transaction summary helper functions</p></a></li>
<li><a href='#autoplot_exp'><p>Plot experience study results</p></a></li>
<li><a href='#autotable'><p>Tabular experience study summary</p></a></li>
<li><a href='#exp_shiny'><p>Interactively explore experience data</p></a></li>
<li><a href='#exp_stats'><p>Summarize experience study records</p></a></li>
<li><a href='#expose'><p>Create exposure records from census records</p></a></li>
<li><a href='#expose_split'><p>Split calendar exposures by policy year</p></a></li>
<li><a href='#is_exposed_df'><p>Exposed data frame helper functions</p></a></li>
<li><a href='#plot_special'><p>Additional plotting functions for termination studies</p></a></li>
<li><a href='#plot_special_trx'><p>Additional plotting functions for transaction studies</p></a></li>
<li><a href='#pol_yr'><p>Calculate policy duration</p></a></li>
<li><a href='#qx_iamb'><p>2012 Individual Annuity Mortality Table and Projection Scale G2</p></a></li>
<li><a href='#reexports'><p>Objects exported from other packages</p></a></li>
<li><a href='#sim_data'><p>Simulated annuity data</p></a></li>
<li><a href='#step_expose'><p>Create exposure records in a <code>recipes</code> step</p></a></li>
<li><a href='#summary.exposed_df'><p>Summarize experience study records</p></a></li>
<li><a href='#toy_census'><p>Toy policy census data</p></a></li>
<li><a href='#trx_stats'><p>Summarize transactions and utilization rates</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Create Actuarial Experience Studies: Prepare Data, Summarize
Results, and Create Reports</td>
</tr>
<tr>
<td>Version:</td>
<td>1.6.0</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Matt Heaphy &lt;mattrmattrs@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Experience studies are used by actuaries to explore historical
    experience across blocks of business and to inform assumption setting
    activities. This package provides functions for preparing data, creating 
    studies, visualizing results, and beginning assumption development. 
    Experience study methods, including exposure calculations, are described in:
    Atkinson &amp; McGarry (2016) "Experience Study Calculations" 
    <a href="https://www.soa.org/49378a/globalassets/assets/files/research/experience-study-calculations.pdf">https://www.soa.org/49378a/globalassets/assets/files/research/experience-study-calculations.pdf</a>.
    The limited fluctuation credibility method used by the 'exp_stats()'
    function is described in: Herzog (1999, ISBN:1-56698-374-6) 
    "Introduction to Credibility Theory".</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/mattheaphy/actxps/">https://github.com/mattheaphy/actxps/</a>,
<a href="https://mattheaphy.github.io/actxps/">https://mattheaphy.github.io/actxps/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/mattheaphy/actxps/issues">https://github.com/mattheaphy/actxps/issues</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, RColorBrewer, rmarkdown, testthat (&ge; 3.0.0), shiny
(&ge; 1.7.5), bslib (&ge; 0.5.1), thematic</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.1)</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr (&ge; 1.1.1), ggplot2, tibble, rlang, glue, purrr, scales,
gt (&ge; 0.9.0), paletteer, recipes, generics, readr, tidyr,
vctrs, clock, cli</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-01-07 12:18:08 UTC; Matt</td>
</tr>
<tr>
<td>Author:</td>
<td>Matt Heaphy [aut, cre]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-01-07 13:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='actxps-package'>actxps: Create Actuarial Experience Studies: Prepare Data, Summarize Results, and Create Reports</h2><span id='topic+actxps'></span><span id='topic+actxps-package'></span>

<h3>Description</h3>

<p><img src="../help/figures/logo.png" style='float: right' alt='logo' width='120' />
</p>
<p>Experience studies are used by actuaries to explore historical experience across blocks of business and to inform assumption setting activities. This package provides functions for preparing data, creating studies, visualizing results, and beginning assumption development. Experience study methods, including exposure calculations, are described in: Atkinson &amp; McGarry (2016) &quot;Experience Study Calculations&quot; <a href="https://www.soa.org/49378a/globalassets/assets/files/research/experience-study-calculations.pdf">https://www.soa.org/49378a/globalassets/assets/files/research/experience-study-calculations.pdf</a>. The limited fluctuation credibility method used by the 'exp_stats()' function is described in: Herzog (1999, ISBN:1-56698-374-6) &quot;Introduction to Credibility Theory&quot;.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Matt Heaphy <a href="mailto:mattrmattrs@gmail.com">mattrmattrs@gmail.com</a>
</p>


<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/mattheaphy/actxps/">https://github.com/mattheaphy/actxps/</a>
</p>
</li>
<li> <p><a href="https://mattheaphy.github.io/actxps/">https://mattheaphy.github.io/actxps/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/mattheaphy/actxps/issues">https://github.com/mattheaphy/actxps/issues</a>
</p>
</li></ul>


<hr>
<h2 id='add_predictions'>Add predictions to a data frame</h2><span id='topic+add_predictions'></span>

<h3>Description</h3>

<p>Attach predicted values from a model to a data frame with
exposure-level records.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_predictions(.data, model, ..., col_expected = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_predictions_+3A_.data">.data</code></td>
<td>
<p>A data frame, preferably with the class <code>exposed_df</code></p>
</td></tr>
<tr><td><code id="add_predictions_+3A_model">model</code></td>
<td>
<p>A model object that has an S3 method for <code><a href="stats.html#topic+predict">predict()</a></code></p>
</td></tr>
<tr><td><code id="add_predictions_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code><a href="stats.html#topic+predict">predict()</a></code></p>
</td></tr>
<tr><td><code id="add_predictions_+3A_col_expected">col_expected</code></td>
<td>
<p><code>NULL</code> or a character vector containing column names for
each value returned by <code><a href="stats.html#topic+predict">predict()</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function attaches predictions from a model to a data frame
that preferably has the class <code>exposed_df</code>. The <code>model</code> argument must be
a model object that has an S3 method for the <code><a href="stats.html#topic+predict">predict()</a></code> function. This
method must have new data for predictions as the second argument.
</p>
<p>The <code>col_expected</code> argument is optional.
</p>

<ul>
<li><p> If <code>NULL</code>, names from the result of <code><a href="stats.html#topic+predict">predict()</a></code> will be used. If there are
no names, a default name of &quot;expected&quot; is assumed. In the event that
<code><a href="stats.html#topic+predict">predict()</a></code> returns multiple values, the default name will be suffixed by
&quot;_x&quot;, where x = 1 to the number of values returned.
</p>
</li>
<li><p> If a value is passed, it must be a character vector of same length as
the result of <code><a href="stats.html#topic+predict">predict()</a></code>
</p>
</li></ul>



<h3>Value</h3>

<p>A data frame or <code>exposed_df</code> object with one of more new columns
containing predictions.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>expo &lt;- expose_py(census_dat, "2019-12-31") |&gt;
  mutate(surrender = status == "Surrender")
mod &lt;- glm(surrender ~ inc_guar + pol_yr, expo, family = 'binomial')
add_predictions(expo, mod, type = 'response')

</code></pre>

<hr>
<h2 id='add_transactions'>Add transactions to an experience study</h2><span id='topic+add_transactions'></span>

<h3>Description</h3>

<p>Attach summarized transactions to a data frame with
exposure-level records.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_transactions(
  .data,
  trx_data,
  col_pol_num = "pol_num",
  col_trx_date = "trx_date",
  col_trx_type = "trx_type",
  col_trx_amt = "trx_amt"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_transactions_+3A_.data">.data</code></td>
<td>
<p>A data frame with exposure-level records with the class
<code>exposed_df</code>. Use <code><a href="#topic+as_exposed_df">as_exposed_df()</a></code> to convert a data frame to an
<code>exposed_df</code> object if necessary.</p>
</td></tr>
<tr><td><code id="add_transactions_+3A_trx_data">trx_data</code></td>
<td>
<p>A data frame containing transactions details. This data
frame must have columns for policy numbers, transaction dates, transaction
types, and transaction amounts.</p>
</td></tr>
<tr><td><code id="add_transactions_+3A_col_pol_num">col_pol_num</code></td>
<td>
<p>Name of the column in <code>trx_data</code> containing the policy
number</p>
</td></tr>
<tr><td><code id="add_transactions_+3A_col_trx_date">col_trx_date</code></td>
<td>
<p>Name of the column in <code>trx_data</code> containing the
transaction date</p>
</td></tr>
<tr><td><code id="add_transactions_+3A_col_trx_type">col_trx_type</code></td>
<td>
<p>Name of the column in <code>trx_data</code> containing the
transaction type</p>
</td></tr>
<tr><td><code id="add_transactions_+3A_col_trx_amt">col_trx_amt</code></td>
<td>
<p>Name of the column in <code>trx_data</code> containing the
transaction amount</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function attaches transactions to an <code>exposed_df</code> object.
Transactions are grouped and summarized such that the number of rows in
the <code>exposed_df</code> object does not change. Two columns are added to the output
for each transaction type. These columns have names of the pattern
<code style="white-space: pre;">&#8288;trx_n_{*}&#8288;</code> (transaction counts) and <code style="white-space: pre;">&#8288;trx_amt_{*}&#8288;</code> (transaction_amounts).
</p>
<p>Transactions are associated with the <code>exposed_df</code> object by matching
transactions dates with exposure dates ranges found in <code>exposed_df</code>.
</p>
<p>All columns containing dates must be in YYYY-MM-DD format.
</p>


<h3>Value</h3>

<p>An <code>exposed_df</code> object with two new columns containing transaction
counts and amounts for each transaction type found in <code>trx_data</code>. The
<code>exposed_df</code>'s <code>trx_types</code> attributes will be updated to include the new
transaction types found in <code>trx_data.</code>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+expose">expose()</a></code>, <code><a href="#topic+as_exposed_df">as_exposed_df()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>expo &lt;- expose_py(census_dat, "2019-12-31", target_status = "Surrender")
add_transactions(expo, withdrawals)

</code></pre>

<hr>
<h2 id='agg_sim_dat'>Aggregate simulated annuity data</h2><span id='topic+agg_sim_dat'></span>

<h3>Description</h3>

<p>A pre-aggregated version of surrender and withdrawal experience from the
simulated data sets <code>census_dat</code>, <code>withdrawals</code>, and <code>account_vals</code>. This
data is theoretical only and does not represent the experience on any
specific product.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>agg_sim_dat
</code></pre>


<h3>Format</h3>

<p>A data frame containing summarized experience study results grouped
by policy year, income guarantee presence, tax-qualified status, and product.
</p>
<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 180 rows and 16 columns.
</p>


<h3>Details</h3>


<dl>
<dt>pol_yr</dt><dd><p>Policy year</p>
</dd>
<dt>inc_guar</dt><dd><p>Indicates whether the policy was issued with an income
guarantee</p>
</dd>
<dt>qual</dt><dd><p>Indicates whether the policy was purchased with tax-qualified
funds</p>
</dd>
<dt>product</dt><dd><p>Product: a, b, or c</p>
</dd>
<dt>exposure_n</dt><dd><p>Sum of policy year exposures by count</p>
</dd>
<dt>claims_n</dt><dd><p>Sum of claim counts</p>
</dd>
<dt>av</dt><dd><p>Sum of account value</p>
</dd>
<dt>exposure_amt</dt><dd><p>Sum of policy year exposures weighted by account value</p>
</dd>
<dt>claims_amt</dt><dd><p>Sum of claims weighted by account value</p>
</dd>
<dt>av_sq</dt><dd><p>Sum of squared account values</p>
</dd>
<dt>n</dt><dd><p>Number of exposure records</p>
</dd>
<dt>wd</dt><dd><p>Sum of partial withdrawal transactions</p>
</dd>
<dt>wd_n</dt><dd><p>Count of partial withdrawal transactions</p>
</dd>
<dt>wd_flag</dt><dd><p>Count of exposure records with partial withdrawal
transactions</p>
</dd>
<dt>wd_sq</dt><dd><p>Sum of squared partial withdrawal transactions</p>
</dd>
<dt>av_w_wd</dt><dd><p>Sum of account value for exposure records with partial
withdrawal transactions</p>
</dd>
</dl>



<h3>See Also</h3>

<p><a href="#topic+census_dat">census_dat</a>
</p>

<hr>
<h2 id='as_exp_df'>Termination summary helper functions</h2><span id='topic+as_exp_df'></span><span id='topic+is_exp_df'></span>

<h3>Description</h3>

<p>Convert aggregate termination experience studies to the <code>exp_df</code> class.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as_exp_df(
  x,
  expected = NULL,
  wt = NULL,
  col_claims,
  col_exposure,
  col_n_claims,
  col_weight_sq,
  col_weight_n,
  target_status = NULL,
  start_date = as.Date("1900-01-01"),
  end_date = NULL,
  credibility = FALSE,
  conf_level = 0.95,
  cred_r = 0.05,
  conf_int = FALSE
)

is_exp_df(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as_exp_df_+3A_x">x</code></td>
<td>
<p>An object. For <code>as_exp_df()</code>, <code>x</code> must be a data frame.</p>
</td></tr>
<tr><td><code id="as_exp_df_+3A_expected">expected</code></td>
<td>
<p>A character vector containing column names in x with
expected values</p>
</td></tr>
<tr><td><code id="as_exp_df_+3A_wt">wt</code></td>
<td>
<p>Optional. Length 1 character vector. Name of the column in <code>x</code>
containing weights to use in the calculation of claims, exposures, partial
credibility, and confidence intervals.</p>
</td></tr>
<tr><td><code id="as_exp_df_+3A_col_claims">col_claims</code></td>
<td>
<p>Optional. Name of the column in <code>x</code> containing claims. The
assumed default is &quot;claims&quot;.</p>
</td></tr>
<tr><td><code id="as_exp_df_+3A_col_exposure">col_exposure</code></td>
<td>
<p>Optional. Name of the column in <code>x</code> containing exposures.
The assumed default is &quot;exposure&quot;.</p>
</td></tr>
<tr><td><code id="as_exp_df_+3A_col_n_claims">col_n_claims</code></td>
<td>
<p>Optional and only used used when <code>wt</code> is passed. Name of
the column in <code>x</code> containing the number of claims.</p>
</td></tr>
<tr><td><code id="as_exp_df_+3A_col_weight_sq">col_weight_sq</code></td>
<td>
<p>Optional and only used used when <code>wt</code> is passed. Name of
the column in <code>x</code> containing the sum of squared weights.</p>
</td></tr>
<tr><td><code id="as_exp_df_+3A_col_weight_n">col_weight_n</code></td>
<td>
<p>Optional and only used used when <code>wt</code> is passed. Name of
the column in <code>x</code> containing exposure record counts.</p>
</td></tr>
<tr><td><code id="as_exp_df_+3A_target_status">target_status</code></td>
<td>
<p>Character vector of target status values. Default value
= <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="as_exp_df_+3A_start_date">start_date</code></td>
<td>
<p>Experience study start date. Default value = 1900-01-01.</p>
</td></tr>
<tr><td><code id="as_exp_df_+3A_end_date">end_date</code></td>
<td>
<p>Experience study end date</p>
</td></tr>
<tr><td><code id="as_exp_df_+3A_credibility">credibility</code></td>
<td>
<p>If <code>TRUE</code>, future calls to <code><a href="base.html#topic+summary">summary()</a></code> will include
partial credibility weights and credibility-weighted termination rates.</p>
</td></tr>
<tr><td><code id="as_exp_df_+3A_conf_level">conf_level</code></td>
<td>
<p>Confidence level used for the Limited Fluctuation
credibility method and confidence intervals</p>
</td></tr>
<tr><td><code id="as_exp_df_+3A_cred_r">cred_r</code></td>
<td>
<p>Error tolerance under the Limited Fluctuation credibility
method</p>
</td></tr>
<tr><td><code id="as_exp_df_+3A_conf_int">conf_int</code></td>
<td>
<p>If <code>TRUE</code>, future calls to <code><a href="base.html#topic+summary">summary()</a></code> will include
confidence intervals around the observed termination rates and any
actual-to-expected ratios.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>is_exp_df()</code> will return <code>TRUE</code> if <code>x</code> is an <code>exp_df</code> object.
</p>
<p><code>as_exp_df()</code> will coerce a data frame to an <code>exp_df</code> object if that
data frame has columns for exposures and claims.
</p>
<p><code>as_exp_df()</code> is most useful for working with aggregate summaries of
experience that were not created by actxps where individual policy
information is not available. After converting the data to the <code>exp_df</code>
class, <code><a href="base.html#topic+summary">summary()</a></code> can be used to summarize data by any grouping variables,
and <code><a href="#topic+autoplot">autoplot()</a></code> and <code><a href="#topic+autotable">autotable()</a></code> are available for reporting.
</p>
<p>If nothing is passed to <code>wt</code>, the data frame <code>x</code> must include columns
containing:
</p>

<ul>
<li><p> Exposures (<code>exposure</code>)
</p>
</li>
<li><p> Claim counts (<code>claims</code>)
</p>
</li></ul>

<p>If <code>wt</code> is passed, the data must include columns containing:
</p>

<ul>
<li><p> Weighted exposures (<code>exposure</code>)
</p>
</li>
<li><p> Weighted claims (<code>claims</code>)
</p>
</li>
<li><p> Claim counts (<code>n_claims</code>)
</p>
</li>
<li><p> The raw sum of weights <strong>NOT</strong> multiplied by exposures
</p>
</li>
<li><p> Exposure record counts (<code>.weight_n</code>)
</p>
</li>
<li><p> The raw sum of squared weights (<code>.weight_sq</code>)
</p>
</li></ul>

<p>The names in parentheses above are expected column names. If the data
frame passed to <code>as_exp_df()</code> uses different column names, these can be
specified using the <code style="white-space: pre;">&#8288;col_*&#8288;</code> arguments.
</p>
<p>When a column name is passed to <code>wt</code>, the columns <code>.weight</code>, <code>.weight_n</code>,
and <code>.weight_sq</code> are used to calculate credibility and confidence intervals.
If credibility and confidence intervals aren't required, then it is not
necessary to pass anything to <code>wt</code>. The results of <code>as_exp_df()</code> and any
downstream summaries will still be weighted as long as the exposures and
claims are pre-weighted.
</p>
<p><code>target_status</code>, <code>start_date</code>, and <code>end_date</code> are optional arguments that are
only used for printing the resulting <code>exp_df</code> object.
</p>


<h3>Value</h3>

<p>For <code>is_exp_df()</code>, a length-1 logical vector. For <code>as_exp_df()</code>,
an <code>exp_df</code> object.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+exp_stats">exp_stats()</a></code> for information on how <code>exp_df</code> objects are typically
created from individual exposure records.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># convert pre-aggregated experience into an exp_df object
dat &lt;- as_exp_df(agg_sim_dat, col_exposure = "exposure_n",
                 col_claims = "claims_n",
                 target_status = "Surrender",
                 start_date = 2005, end_date = 2019,
                 conf_int = TRUE)
dat
is_exp_df(dat)

# summary by policy year
summary(dat, pol_yr)

# repeat the prior exercise on a weighted basis
dat_wt &lt;- as_exp_df(agg_sim_dat, wt = "av",
                    col_exposure = "exposure_amt",
                    col_claims = "claims_amt",
                    col_n_claims = "claims_n",
                    col_weight_sq = "av_sq",
                    col_weight_n = "n",
                    target_status = "Surrender",
                    start_date = 2005, end_date = 2019,
                    conf_int = TRUE)
dat_wt

# summary by policy year
summary(dat_wt, pol_yr)


</code></pre>

<hr>
<h2 id='as_trx_df'>Transaction summary helper functions</h2><span id='topic+as_trx_df'></span><span id='topic+is_trx_df'></span>

<h3>Description</h3>

<p>Convert aggregate transaction experience studies to the <code>trx_df</code> class.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as_trx_df(
  x,
  col_trx_amt = "trx_amt",
  col_trx_n = "trx_n",
  col_trx_flag = "trx_flag",
  col_exposure = "exposure",
  col_percent_of = NULL,
  col_percent_of_w_trx = NULL,
  col_trx_amt_sq = "trx_amt_sq",
  start_date = as.Date("1900-01-01"),
  end_date = NULL,
  conf_int = FALSE,
  conf_level = 0.95
)

is_trx_df(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as_trx_df_+3A_x">x</code></td>
<td>
<p>An object. For <code>as_trx_df()</code>, <code>x</code> must be a data frame.</p>
</td></tr>
<tr><td><code id="as_trx_df_+3A_col_trx_amt">col_trx_amt</code></td>
<td>
<p>Optional. Name of the column in <code>x</code> containing transaction
amounts.</p>
</td></tr>
<tr><td><code id="as_trx_df_+3A_col_trx_n">col_trx_n</code></td>
<td>
<p>Optional. Name of the column in <code>x</code> containing transaction
counts.</p>
</td></tr>
<tr><td><code id="as_trx_df_+3A_col_trx_flag">col_trx_flag</code></td>
<td>
<p>Optional. Name of the column in <code>x</code> containing the number
of exposure records with transactions.</p>
</td></tr>
<tr><td><code id="as_trx_df_+3A_col_exposure">col_exposure</code></td>
<td>
<p>Optional. Name of the column in <code>x</code> containing exposures.</p>
</td></tr>
<tr><td><code id="as_trx_df_+3A_col_percent_of">col_percent_of</code></td>
<td>
<p>Optional. Name of the column in <code>x</code> containing a
numeric variable to use in &quot;percent of&quot; calculations.</p>
</td></tr>
<tr><td><code id="as_trx_df_+3A_col_percent_of_w_trx">col_percent_of_w_trx</code></td>
<td>
<p>Optional. Name of the column in <code>x</code> containing a
numeric variable to use in &quot;percent of&quot; calculations with transactions.</p>
</td></tr>
<tr><td><code id="as_trx_df_+3A_col_trx_amt_sq">col_trx_amt_sq</code></td>
<td>
<p>Optional and only required when <code>col_percent_of</code> is
passed and <code>conf_int</code> is <code>TRUE</code>. Name of the column in <code>x</code> containing squared
transaction amounts.</p>
</td></tr>
<tr><td><code id="as_trx_df_+3A_start_date">start_date</code></td>
<td>
<p>Experience study start date. Default value = 1900-01-01.</p>
</td></tr>
<tr><td><code id="as_trx_df_+3A_end_date">end_date</code></td>
<td>
<p>Experience study end date</p>
</td></tr>
<tr><td><code id="as_trx_df_+3A_conf_int">conf_int</code></td>
<td>
<p>If <code>TRUE</code>, future calls to <code><a href="base.html#topic+summary">summary()</a></code> will include
confidence intervals around the observed utilization rates and any
<code>percent_of</code> output columns.</p>
</td></tr>
<tr><td><code id="as_trx_df_+3A_conf_level">conf_level</code></td>
<td>
<p>Confidence level for confidence intervals</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>is_trx_df()</code> will return <code>TRUE</code> if <code>x</code> is a <code>trx_df</code> object.
</p>
<p><code>as_trx_df()</code> will coerce a data frame to a <code>trx_df</code> object if that
data frame has the required columns for transaction studies listed below.
</p>
<p><code>as_trx_df()</code> is most useful for working with aggregate summaries of
experience that were not created by actxps where individual policy
information is not available. After converting the data to the <code>trx_df</code>
class, <code><a href="base.html#topic+summary">summary()</a></code> can be used to summarize data by any grouping variables,
and <code><a href="#topic+autoplot">autoplot()</a></code> and <code><a href="#topic+autotable">autotable()</a></code> are available for reporting.
</p>
<p>At a minimum, the following columns are required:
</p>

<ul>
<li><p> Transaction amounts (<code>trx_amt</code>)
</p>
</li>
<li><p> Transaction counts (<code>trx_n</code>)
</p>
</li>
<li><p> The number of exposure records with transactions (<code>trx_flag</code>). This number
is not necessarily equal to transaction counts. If multiple transactions
are allowed per exposure period, <code>trx_flag</code> will be less than <code>trx_n</code>.
</p>
</li>
<li><p> Exposures (<code>exposure</code>)
</p>
</li></ul>

<p>If transaction amounts should be expressed as a percentage of another
variable (i.e. to calculate utilization rates or actual-to-expected ratios),
additional columns are required:
</p>

<ul>
<li><p> A denominator &quot;percent of&quot; column. For example, the sum of account values.
</p>
</li>
<li><p> A denominator &quot;percent of&quot; column for exposure records with transactions.
For example, the sum of account values across all records with non-zero
transaction amounts.
</p>
</li></ul>

<p>If confidence intervals are desired and &quot;percent of&quot; columns are passed, an
additional column for the sum of squared transaction amounts (<code>trx_amt_sq</code>)
is also required.
</p>
<p>The names in parentheses above are expected column names. If the data
frame passed to <code>as_trx_df()</code> uses different column names, these can be
specified using the <code style="white-space: pre;">&#8288;col_*&#8288;</code> arguments.
</p>
<p><code>start_date</code>, and <code>end_date</code> are optional arguments that are
only used for printing the resulting <code>trx_df</code> object.
</p>
<p>Unlike <code><a href="#topic+trx_stats">trx_stats()</a></code>, <code>as_trx_df()</code> only permits a single transaction type and
a single <code>percent_of</code> column.
</p>


<h3>Value</h3>

<p>For <code>is_trx_df()</code>, a length-1 logical vector. For <code>as_trx_df()</code>,
a <code>trx_df</code> object.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+trx_stats">trx_stats()</a></code> for information on how <code>trx_df</code> objects are typically
created from individual exposure records.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># convert pre-aggregated experience into a trx_df object
dat &lt;- as_trx_df(agg_sim_dat,
                 col_exposure = "n",
                 col_trx_amt = "wd",
                 col_trx_n = "wd_n",
                 col_trx_flag = "wd_flag",
                 col_percent_of = "av",
                 col_percent_of_w_trx = "av_w_wd",
                 col_trx_amt_sq = "wd_sq",
                 start_date = 2005, end_date = 2019,
                 conf_int = TRUE)
dat
is_trx_df(dat)

# summary by policy year
summary(dat, pol_yr)

</code></pre>

<hr>
<h2 id='autoplot_exp'>Plot experience study results</h2><span id='topic+autoplot_exp'></span><span id='topic+autoplot.exp_df'></span><span id='topic+autoplot.trx_df'></span>

<h3>Description</h3>

<p>Plot experience study results
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'exp_df'
autoplot(
  object,
  ...,
  x = NULL,
  y = NULL,
  color = NULL,
  mapping,
  second_axis = FALSE,
  second_y = NULL,
  scales = "fixed",
  geoms = c("lines", "bars", "points"),
  y_labels = scales::label_percent(accuracy = 0.1),
  second_y_labels = scales::label_comma(accuracy = 1),
  y_log10 = FALSE,
  conf_int_bars = FALSE
)

## S3 method for class 'trx_df'
autoplot(
  object,
  ...,
  x = NULL,
  y = NULL,
  color = NULL,
  mapping,
  second_axis = FALSE,
  second_y = NULL,
  scales = "fixed",
  geoms = c("lines", "bars", "points"),
  y_labels = scales::label_percent(accuracy = 0.1),
  second_y_labels = scales::label_comma(accuracy = 1),
  y_log10 = FALSE,
  conf_int_bars = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="autoplot_exp_+3A_object">object</code></td>
<td>
<p>An object of class <code>exp_df</code> created by the
function <code><a href="#topic+exp_stats">exp_stats()</a></code> or an object of class <code>trx_df</code> created by the function
<code><a href="#topic+trx_stats">trx_stats()</a></code>.</p>
</td></tr>
<tr><td><code id="autoplot_exp_+3A_...">...</code></td>
<td>
<p>Faceting variables passed to <code><a href="ggplot2.html#topic+facet_wrap">ggplot2::facet_wrap()</a></code>.</p>
</td></tr>
<tr><td><code id="autoplot_exp_+3A_x">x</code></td>
<td>
<p>An unquoted column name in <code>object</code> or expression to use as the <code>x</code>
variable.</p>
</td></tr>
<tr><td><code id="autoplot_exp_+3A_y">y</code></td>
<td>
<p>An unquoted column name in <code>object</code> or expression to use as the
<code>y</code> variable. If unspecified, <code>y</code> will default to the observed termination
rate (<code>q_obs</code>) for <code>exp_df</code> objects and the observed utilization rate
(<code>trx_util</code>) for <code>trx_df</code> objects.</p>
</td></tr>
<tr><td><code id="autoplot_exp_+3A_color">color</code></td>
<td>
<p>An unquoted column name in <code>object</code> or expression to use as the
<code>color</code> and <code>fill</code> variables.</p>
</td></tr>
<tr><td><code id="autoplot_exp_+3A_mapping">mapping</code></td>
<td>
<p>Aesthetic mapping passed to <code><a href="ggplot2.html#topic+ggplot">ggplot2::ggplot()</a></code>. NOTE: If
<code>mapping</code> is supplied, the <code>x</code>, <code>y</code>, and <code>color</code> arguments will be ignored.</p>
</td></tr>
<tr><td><code id="autoplot_exp_+3A_second_axis">second_axis</code></td>
<td>
<p>Logical. If <code>TRUE</code>, the variable specified by
<code>second_y</code> (default = exposure) is plotted on a second
y-axis using an area geometry.</p>
</td></tr>
<tr><td><code id="autoplot_exp_+3A_second_y">second_y</code></td>
<td>
<p>An unquoted column name in <code>object</code> to use as the <code>y</code>
variable on the second y-axis. If unspecified, this will default to
<code>exposure</code>.</p>
</td></tr>
<tr><td><code id="autoplot_exp_+3A_scales">scales</code></td>
<td>
<p>The <code>scales</code> argument passed to <code><a href="ggplot2.html#topic+facet_wrap">ggplot2::facet_wrap()</a></code>.</p>
</td></tr>
<tr><td><code id="autoplot_exp_+3A_geoms">geoms</code></td>
<td>
<p>Type of geometry. If &quot;lines&quot; is passed, the plot will
display lines and points. If &quot;bars&quot;, the plot will display bars. If &quot;points&quot;,
the plot will display points only.</p>
</td></tr>
<tr><td><code id="autoplot_exp_+3A_y_labels">y_labels</code></td>
<td>
<p>Label function passed to <code><a href="ggplot2.html#topic+scale_continuous">ggplot2::scale_y_continuous()</a></code>.</p>
</td></tr>
<tr><td><code id="autoplot_exp_+3A_second_y_labels">second_y_labels</code></td>
<td>
<p>Same as <code>y_labels</code>, but for the second y-axis.</p>
</td></tr>
<tr><td><code id="autoplot_exp_+3A_y_log10">y_log10</code></td>
<td>
<p>If <code>TRUE</code>, the y-axes are plotted on a log-10 scale.</p>
</td></tr>
<tr><td><code id="autoplot_exp_+3A_conf_int_bars">conf_int_bars</code></td>
<td>
<p>If <code>TRUE</code>, confidence interval error bars are included
in the plot. For <code>exp_df</code> objects, this option is available for termination
rates and actual-to-expected ratios. For <code>trx_df</code> objects, this option is
available for utilization rates and any <code>pct_of</code> columns.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If no aesthetic map is supplied, the plot will use the first
grouping variable in <code>object</code> on the x axis and <code>q_obs</code> on the y
axis. In addition, the second grouping variable in <code>object</code> will be
used for color and fill.
</p>
<p>If no faceting variables are supplied, the plot will use grouping
variables 3 and up as facets. These variables are passed into
<code><a href="ggplot2.html#topic+facet_wrap">ggplot2::facet_wrap()</a></code>. Specific to <code>trx_df</code> objects, transaction
type (<code>trx_type</code>) will also be added as a faceting variable.
</p>


<h3>Value</h3>

<p>a <code>ggplot</code> object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot_termination_rates">plot_termination_rates()</a></code>, <code><a href="#topic+plot_actual_to_expected">plot_actual_to_expected()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
study_py &lt;- expose_py(census_dat, "2019-12-31", target_status = "Surrender")

study_py &lt;- study_py |&gt;
  add_transactions(withdrawals)

exp_res &lt;- study_py |&gt; group_by(pol_yr) |&gt; exp_stats()
autoplot(exp_res)

trx_res &lt;- study_py |&gt; group_by(pol_yr) |&gt; trx_stats()
autoplot(trx_res)

</code></pre>

<hr>
<h2 id='autotable'>Tabular experience study summary</h2><span id='topic+autotable'></span><span id='topic+autotable.exp_df'></span><span id='topic+autotable.trx_df'></span>

<h3>Description</h3>

<p><code>autotable()</code> is a generic function used to create a table
from an object of a particular class. Tables are constructed using the
<code>gt</code> package.
</p>
<p><code>autotable.exp_df()</code> is used to convert experience study results to a
presentation-friendly format.
</p>
<p><code>autotable.trx_df()</code> is used to convert transaction study results to a
presentation-friendly format.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>autotable(object, ...)

## S3 method for class 'exp_df'
autotable(
  object,
  fontsize = 100,
  decimals = 1,
  colorful = TRUE,
  color_q_obs = "RColorBrewer::GnBu",
  color_ae_ = "RColorBrewer::RdBu",
  rename_cols = rlang::list2(...),
  show_conf_int = FALSE,
  show_cred_adj = FALSE,
  decimals_amt = 0,
  suffix_amt = FALSE,
  show_total = FALSE,
  ...
)

## S3 method for class 'trx_df'
autotable(
  object,
  fontsize = 100,
  decimals = 1,
  colorful = TRUE,
  color_util = "RColorBrewer::GnBu",
  color_pct_of = "RColorBrewer::RdBu",
  rename_cols = rlang::list2(...),
  show_conf_int = FALSE,
  decimals_amt = 0,
  suffix_amt = FALSE,
  show_total = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="autotable_+3A_object">object</code></td>
<td>
<p>An object of class <code>exp_df</code> usually created by the
function <code><a href="#topic+exp_stats">exp_stats()</a></code> or an object of class <code>trx_df</code> created by the
<code><a href="#topic+trx_stats">trx_stats()</a></code> function.</p>
</td></tr>
<tr><td><code id="autotable_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code><a href="gt.html#topic+gt">gt::gt()</a></code>.</p>
</td></tr>
<tr><td><code id="autotable_+3A_fontsize">fontsize</code></td>
<td>
<p>Font size percentage multiplier.</p>
</td></tr>
<tr><td><code id="autotable_+3A_decimals">decimals</code></td>
<td>
<p>Number of decimals to display for percentages</p>
</td></tr>
<tr><td><code id="autotable_+3A_colorful">colorful</code></td>
<td>
<p>If <code>TRUE</code>, color will be added to the the observed
termination rate and actual-to-expected columns for termination studies, and
the utilization rate and &quot;percentage of&quot; columns for transaction studies.</p>
</td></tr>
<tr><td><code id="autotable_+3A_color_q_obs">color_q_obs</code></td>
<td>
<p>Color palette used for the observed termination rate.</p>
</td></tr>
<tr><td><code id="autotable_+3A_color_ae_">color_ae_</code></td>
<td>
<p>Color palette used for actual-to-expected rates.</p>
</td></tr>
<tr><td><code id="autotable_+3A_rename_cols">rename_cols</code></td>
<td>
<p>An optional list consisting of key-value pairs. This
can be used to relabel columns on the output table. This parameter is most
useful for renaming grouping variables that will appear under their original
variable names if left unchanged. See <code><a href="gt.html#topic+cols_label">gt::cols_label()</a></code> for more
information.</p>
</td></tr>
<tr><td><code id="autotable_+3A_show_conf_int">show_conf_int</code></td>
<td>
<p>If <code>TRUE</code> confidence intervals will be displayed
assuming they are available on <code>object</code>.</p>
</td></tr>
<tr><td><code id="autotable_+3A_show_cred_adj">show_cred_adj</code></td>
<td>
<p>If <code>TRUE</code> credibility-weighted termination rates will
be displayed assuming they are available on <code>object</code>.</p>
</td></tr>
<tr><td><code id="autotable_+3A_decimals_amt">decimals_amt</code></td>
<td>
<p>Number of decimals to display for amount columns (number
of claims, claim amounts, exposures, transaction counts, total transactions,
and average transactions)</p>
</td></tr>
<tr><td><code id="autotable_+3A_suffix_amt">suffix_amt</code></td>
<td>
<p>This argument has the same meaning as the <code>suffixing</code>
argument in <code><a href="gt.html#topic+fmt_number">gt::fmt_number()</a></code> for amount columns. If <code>FALSE</code> (the default),
no scaling or suffixing are applied to amount columns. If <code>TRUE</code>, all amount
columns are automatically scaled and suffixed by &quot;K&quot; (thousands), &quot;M&quot;
(millions), &quot;B&quot; (billions), or &quot;T&quot; (trillions). See <code><a href="gt.html#topic+fmt_number">gt::fmt_number()</a></code> for
more information.</p>
</td></tr>
<tr><td><code id="autotable_+3A_show_total">show_total</code></td>
<td>
<p>If <code>TRUE</code> the table will include grand total row(s).</p>
</td></tr>
<tr><td><code id="autotable_+3A_color_util">color_util</code></td>
<td>
<p>Color palette used for utilization rates.</p>
</td></tr>
<tr><td><code id="autotable_+3A_color_pct_of">color_pct_of</code></td>
<td>
<p>Color palette used for &quot;percentage of&quot; columns.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>color_q_obs</code>, <code>color_ae_</code>, <code>color_util</code>, and <code>color_pct_of</code> arguments
must be strings referencing a discrete color palette available in the
<code>paletteer</code> package. Palettes must be in the form &quot;package::palette&quot;.
For a full list of available palettes, see <a href="paletteer.html#topic+palettes_d_names">paletteer::palettes_d_names</a>.
</p>


<h3>Value</h3>

<p>a <code>gt</code> object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if (interactive()) {
  study_py &lt;- expose_py(census_dat, "2019-12-31", target_status = "Surrender")
  expected_table &lt;- c(seq(0.005, 0.03, length.out = 10), 0.2, 0.15, rep(0.05, 3))

  study_py &lt;- study_py |&gt;
    mutate(expected_1 = expected_table[pol_yr],
           expected_2 = ifelse(inc_guar, 0.015, 0.03)) |&gt;
    add_transactions(withdrawals) |&gt;
    left_join(account_vals, by = c("pol_num", "pol_date_yr"))

  exp_res &lt;- study_py |&gt; group_by(pol_yr) |&gt;
    exp_stats(expected = c("expected_1", "expected_2"), credibility = TRUE,
              conf_int = TRUE)
  autotable(exp_res)

  trx_res &lt;- study_py |&gt; group_by(pol_yr) |&gt;
    trx_stats(percent_of = "av_anniv", conf_int = TRUE)
  autotable(trx_res)
}

</code></pre>

<hr>
<h2 id='exp_shiny'>Interactively explore experience data</h2><span id='topic+exp_shiny'></span>

<h3>Description</h3>

<p>Launch a Shiny application to interactively explore drivers of
experience.
</p>
<p><code>dat</code> must be an <code>exposed_df</code> object. An error will be thrown is any other
object type is passed. If <code>dat</code> has transactions attached, the app will
contain features for both termination and transaction studies. Otherwise,
the app will only support termination studies.
</p>
<p>If nothing is passed to <code>predictors</code>, all columns names in <code>dat</code> will be
used (excluding the policy number, status, termination date, exposure,
transaction counts, and transaction amounts columns).
</p>
<p>The <code>expected</code> argument is optional. As a default, any column names
containing the word &quot;expected&quot; are used.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>exp_shiny(
  dat,
  predictors = names(dat),
  expected = names(dat)[grepl("expected", names(dat))],
  distinct_max = 25L,
  title,
  credibility = TRUE,
  conf_level = 0.95,
  cred_r = 0.05,
  theme = "shiny",
  col_exposure = "exposure"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="exp_shiny_+3A_dat">dat</code></td>
<td>
<p>An <code>exposed_df</code> object.</p>
</td></tr>
<tr><td><code id="exp_shiny_+3A_predictors">predictors</code></td>
<td>
<p>A character vector of independent variables in <code>dat</code> to
include in the Shiny app.</p>
</td></tr>
<tr><td><code id="exp_shiny_+3A_expected">expected</code></td>
<td>
<p>A character vector of expected values in <code>dat</code> to include
in the Shiny app.</p>
</td></tr>
<tr><td><code id="exp_shiny_+3A_distinct_max">distinct_max</code></td>
<td>
<p>Maximum number of distinct values allowed for
<code>predictors</code> to be included as &quot;Color&quot; and &quot;Facets&quot; grouping variables. This
input prevents the drawing of overly complex plots. Default value = 25.</p>
</td></tr>
<tr><td><code id="exp_shiny_+3A_title">title</code></td>
<td>
<p>Optional. Title of the Shiny app. If no title is provided,
a descriptive title will be generated based on attributes of <code>dat</code>.</p>
</td></tr>
<tr><td><code id="exp_shiny_+3A_credibility">credibility</code></td>
<td>
<p>If <code>TRUE</code>, the output will include partial credibility
weights and credibility-weighted termination rates.</p>
</td></tr>
<tr><td><code id="exp_shiny_+3A_conf_level">conf_level</code></td>
<td>
<p>Confidence level used for the Limited Fluctuation
credibility method and confidence intervals</p>
</td></tr>
<tr><td><code id="exp_shiny_+3A_cred_r">cred_r</code></td>
<td>
<p>Error tolerance under the Limited Fluctuation credibility
method</p>
</td></tr>
<tr><td><code id="exp_shiny_+3A_theme">theme</code></td>
<td>
<p>The name of a theme passed to the <code>preset</code> argument of
<code>bslib::bs_theme()</code>. Alternatively, a complete Bootstrap theme created using
<code>bslib::bs_theme()</code>.</p>
</td></tr>
<tr><td><code id="exp_shiny_+3A_col_exposure">col_exposure</code></td>
<td>
<p>Name of the column in <code>dat</code> containing exposures. This
input is only used to clarify the exposure basis when <code>dat</code> is a
<code>split_exposed_df</code> object. For more information on split exposures, see
<code><a href="#topic+expose_split">expose_split()</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value. This function is called for the side effect of
launching a Shiny application.
</p>


<h3>Layout</h3>



<h4>Filters</h4>

<p>The sidebar contains filtering widgets organized by data type for all
variables passed to the <code>predictors</code> argument.
</p>
<p>At the top of the sidebar, information is shown on the percentage of records
remaining after applying filters. A description of all active filters is also
provided.
</p>
<p>The top of the sidebar also includes a &quot;play / pause&quot; switch that can pause
reactivity of the application. Pausing is a good option when multiple changes
are made in quick succession, especially when the underlying data set is
large.
</p>



<h4>Grouping variables</h4>

<p>This box includes widgets to select grouping variables for summarizing
experience. The &quot;x&quot; widget determines the x variable in the plot output.
Similarly, the &quot;Color&quot; and &quot;Facets&quot; widgets are used for color and facets.
Multiple faceting variable selections are allowed. For the table output,
&quot;x&quot;, &quot;Color&quot;, and &quot;Facets&quot; have no particular meaning beyond the order in
which grouping variables are displayed.
</p>



<h4>Study type</h4>

<p>This box includes a toggle to switch between termination studies and
transaction studies (if available). Different options are available for each
study type.
</p>


<h5>Termination studies</h5>

<p>The expected values checkboxes are used to activate and deactivate expected
values passed to the <code>expected</code> argument. These checkboxes also include a
a &quot;control&quot; item for expected values derived using control variables.
These boxes impact the table output directly and the available &quot;y&quot; variables
for the plot. The &quot;Weight by&quot; widget is used to specify which column, if any,
contains weights for summarizing experience. The &quot;Control variables&quot; widget
is used to specify which columns, if any, are used as control variables (
see <code><a href="#topic+exp_stats">exp_stats()</a></code> for more information).
</p>



<h5>Transaction studies</h5>

<p>The transaction types checkboxes are used to activate and deactivate
transaction types that appear in the plot and table outputs. The available
transaction types are taken from the <code>trx_types</code> attribute of <code>dat</code>.
In the plot output, transaction type will always appear as a faceting
variable. The &quot;Transactions as % of&quot; selector will expand the list of
available &quot;y&quot; variables for the plot and impact the table output directly.
Lastly, a toggle exists that allows for all transaction types to be
aggregated into a single group.
</p>




<h4>Output</h4>



<h5>Plot</h5>

<p>This tab includes a plot and various options for customization:
</p>

<ul>
<li><p> y: y variable
</p>
</li>
<li><p> Geometry: plotting geometry
</p>
</li>
<li><p> Second y-axis: activate to enable a second y-axis
</p>
</li>
<li><p> Second axis y: y variable to plot on the second axis
</p>
</li>
<li><p> Add Smoothing: activate to plot loess curves
</p>
</li>
<li><p> Confidence intervals: If available, add error bars for confidence intervals
around the selected y variable
</p>
</li>
<li><p> Free y Scales: activate to enable separate y scales in each plot
</p>
</li>
<li><p> Log y-axis: activate to plot all y-axes on a log-10 scale
</p>
</li></ul>

<p>The gear icon above the plot contains a pop-up menu that can be used to
change the size of the plot for exporting.
</p>



<h5>Table</h5>

<p>This tab includes a data table.
</p>
<p>The gear icon above the table contains a pop-up menu that can be used to
change the appearance of the table:
</p>

<ul>
<li><p> The &quot;Total row&quot;, &quot;Confidence intervals&quot;, and &quot;Credibility-weighted
termination rates&quot; switches add these outputs to the table. These values are
hidden as a default to prevent over-crowding.
</p>
</li>
<li><p> The &quot;Include color scales&quot; switch disables or re-enables conditional color
formatting.
</p>
</li>
<li><p> The &quot;Decimals&quot; slider controls the number of decimals displayed for
percentage fields.
</p>
</li>
<li><p> The &quot;Font size multiple&quot; slider impacts the table's font size
</p>
</li></ul>




<h5>Export</h5>

<p>This pop-up menu contains options for saving summarized experience data, the
plot, or the table. Data is saved as a CSV file. The plot and table are saved
as png files.
</p>




<h3>Examples</h3>

<pre><code class='language-R'>
if (interactive()) {
  study_py &lt;- expose_py(census_dat, "2019-12-31", target_status = "Surrender")
  expected_table &lt;- c(seq(0.005, 0.03, length.out = 10),
                      0.2, 0.15, rep(0.05, 3))

  study_py &lt;- study_py |&gt;
    mutate(expected_1 = expected_table[pol_yr],
           expected_2 = ifelse(inc_guar, 0.015, 0.03)) |&gt;
    add_transactions(withdrawals) |&gt;
    left_join(account_vals, by = c("pol_num", "pol_date_yr"))

  exp_shiny(study_py)
}

</code></pre>

<hr>
<h2 id='exp_stats'>Summarize experience study records</h2><span id='topic+exp_stats'></span><span id='topic+summary.exp_df'></span>

<h3>Description</h3>

<p>Create a summary data frame of termination experience for a
given target status.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>exp_stats(
  .data,
  target_status = attr(.data, "target_status"),
  expected,
  col_exposure = "exposure",
  col_status = "status",
  wt = NULL,
  credibility = FALSE,
  conf_level = 0.95,
  cred_r = 0.05,
  conf_int = FALSE,
  control_vars,
  control_distinct_max = 25L
)

## S3 method for class 'exp_df'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="exp_stats_+3A_.data">.data</code></td>
<td>
<p>A data frame with exposure-level records, ideally of type
<code>exposed_df</code></p>
</td></tr>
<tr><td><code id="exp_stats_+3A_target_status">target_status</code></td>
<td>
<p>A character vector of target status values</p>
</td></tr>
<tr><td><code id="exp_stats_+3A_expected">expected</code></td>
<td>
<p>A character vector containing column names in <code>.data</code>
with expected values</p>
</td></tr>
<tr><td><code id="exp_stats_+3A_col_exposure">col_exposure</code></td>
<td>
<p>Name of the column in <code>.data</code> containing exposures</p>
</td></tr>
<tr><td><code id="exp_stats_+3A_col_status">col_status</code></td>
<td>
<p>Name of the column in <code>.data</code> containing the policy status</p>
</td></tr>
<tr><td><code id="exp_stats_+3A_wt">wt</code></td>
<td>
<p>Optional. Length 1 character vector. Name of the column in
<code>.data</code> containing weights to use in the calculation of claims,
exposures, partial credibility, and confidence intervals.</p>
</td></tr>
<tr><td><code id="exp_stats_+3A_credibility">credibility</code></td>
<td>
<p>If <code>TRUE</code>, the output will include partial credibility
weights and credibility-weighted termination rates.</p>
</td></tr>
<tr><td><code id="exp_stats_+3A_conf_level">conf_level</code></td>
<td>
<p>Confidence level used for the Limited Fluctuation
credibility method and confidence intervals</p>
</td></tr>
<tr><td><code id="exp_stats_+3A_cred_r">cred_r</code></td>
<td>
<p>Error tolerance under the Limited Fluctuation credibility
method</p>
</td></tr>
<tr><td><code id="exp_stats_+3A_conf_int">conf_int</code></td>
<td>
<p>If <code>TRUE</code>, the output will include confidence intervals
around the observed termination rates and any actual-to-expected ratios.</p>
</td></tr>
<tr><td><code id="exp_stats_+3A_control_vars">control_vars</code></td>
<td>
<p><code>".none"</code> or a character vector containing column names
in <code>.data</code> to use as control variables</p>
</td></tr>
<tr><td><code id="exp_stats_+3A_control_distinct_max">control_distinct_max</code></td>
<td>
<p>Maximum number of unique values allowed for
control variables</p>
</td></tr>
<tr><td><code id="exp_stats_+3A_object">object</code></td>
<td>
<p>An <code>exp_df</code> object</p>
</td></tr>
<tr><td><code id="exp_stats_+3A_...">...</code></td>
<td>
<p>Groups to retain after <code>summary()</code> is called</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>.data</code> is grouped, the resulting data frame will contain
one row per group.
</p>
<p>If <code>target_status</code> isn't provided, <code><a href="#topic+exp_stats">exp_stats()</a></code> will use the same
target status from <code>.data</code> if it has the class <code>exposed_df</code>.
Otherwise, all status values except the first level will be assumed.
This will produce a warning message.
</p>


<h3>Value</h3>

<p>A tibble with class <code>exp_df</code>, <code>tbl_df</code>, <code>tbl</code>,
and <code>data.frame</code>. The results include columns for any grouping variables,
claims, exposures, and observed termination rates (<code>q_obs</code>).
</p>

<ul>
<li><p> If any values are passed to <code>expected</code> or <code>control_vars</code>, additional
columns are added for expected termination rates and actual-to-expected
(A/E) ratios. A/E ratios are prefixed by <code>ae_</code>.
</p>
</li>
<li><p> If <code>credibility</code> is set to <code>TRUE</code>, additional columns are added
for partial credibility and credibility-weighted termination rates
(assuming values are passed to <code>expected</code>). Credibility-weighted termination
rates are prefixed by <code>adj_</code>.
</p>
</li>
<li><p> If <code>conf_int</code> is set to <code>TRUE</code>, additional columns are added for lower and
upper confidence interval limits around the observed termination rates and
any actual-to-expected ratios. Additionally, if <code>credibility</code> is <code>TRUE</code> and
expected values are passed to <code>expected</code>, the output will contain confidence
intervals around credibility-weighted termination rates. Confidence interval
columns include the name of the original output column suffixed by either
<code style="white-space: pre;">&#8288;_lower&#8288;</code> or <code style="white-space: pre;">&#8288;_upper&#8288;</code>.
</p>
</li>
<li><p> If a value is passed to <code>wt</code>, additional columns are created containing
the the sum of weights (<code>.weight</code>), the sum of squared weights
(<code>.weight_qs</code>), and the number of records (<code>.weight_n</code>).
</p>
</li></ul>



<h3>Expected values</h3>

<p>The <code>expected</code> argument is optional. If provided, this argument must
be a character vector with values corresponding to column names in <code>.data</code>
containing expected experience. More than one expected basis can be provided.
</p>


<h3>Control variables</h3>

<p>The <code>control_vars</code> argument is optional. If provided, this argument must
be <code>".none"</code> (more on this below) or a character vector with values
corresponding to column names in <code>.data</code>. Control variables are used to
estimate the impact of any grouping variables on observed experience
<em>after accounting for</em> the impact of control variables.
</p>
<p>Mechanically, when values are passed to <code>control_vars</code>, a separate call
is made to <code><a href="#topic+exp_stats">exp_stats()</a></code> using the control variables as grouping variables.
This is used to derive a new expected values basis called <code>control</code>, which is
both added to <code>.data</code> and appended to the <code>expected</code> argument. In the final
output, a column called <code>ae_control</code> shows the relative impact of any
grouping variables after accounting for the control variables.
</p>
<p><strong>About <code>".none"</code></strong>: If <code>".none"</code> is passed to <code>control_vars</code>, a single
aggregate termination rate is calculated for the entire data set and used to
compute <code>control</code> and <code>ae_control</code>.
</p>
<p>The <code>control_distinct_max</code> argument places an upper limit on the number of
unique values that a control variable is allowed to have. This limit exists
to prevent an excessive number of groups on continuous or high-cardinality
features.
</p>
<p>It should be noted that usage of control variables is a rough approximation
and not a substitute for rigorous statistical models. The impact of control
variables is calculated in isolation and does consider other features or
possible confounding variables. As such, control variables are most useful
for exploratory data analysis.
</p>


<h3>Credibility</h3>

<p>If <code>credibility</code> is set to <code>TRUE</code>, the output will contain a
<code>credibility</code> column equal to the partial credibility estimate under
the Limited Fluctuation credibility method (also known as Classical
Credibility) assuming a binomial distribution of claims.
</p>


<h3>Confidence intervals</h3>

<p>If <code>conf_int</code> is set to <code>TRUE</code>, the output will contain lower and upper
confidence interval limits for the observed termination rate and any
actual-to-expected ratios. The confidence level is dictated
by <code>conf_level</code>. If no weighting variable is passed to <code>wt</code>, confidence
intervals will be constructed assuming a binomial distribution of claims.
Otherwise, confidence intervals will be calculated assuming that the
aggregate claims distribution is normal with a mean equal to observed claims
and a variance equal to:
</p>
<p><code>Var(S) = E(N) * Var(X) + E(X)^2 * Var(N)</code>,
</p>
<p>Where <code>S</code> is the aggregate claim random variable, <code>X</code> is the weighting
variable assumed to follow a normal distribution, and <code>N</code> is a binomial
random variable for the number of claims.
</p>
<p>If <code>credibility</code> is <code>TRUE</code> and expected values are passed to <code>expected</code>,
the output will also contain confidence intervals for any
credibility-weighted termination rates.
</p>


<h3><code>summary()</code> Method</h3>

<p>Applying <code>summary()</code> to a <code>exp_df</code> object will re-summarize the
data while retaining any grouping variables passed to the &quot;dots&quot;
(<code>...</code>).
</p>


<h3>References</h3>

<p>Herzog, Thomas (1999). Introduction to Credibility Theory
</p>


<h3>Examples</h3>

<pre><code class='language-R'>toy_census |&gt; expose("2022-12-31", target_status = "Surrender") |&gt;
    exp_stats()

exp_res &lt;- census_dat |&gt;
           expose("2019-12-31", target_status = "Surrender") |&gt;
           group_by(pol_yr, inc_guar) |&gt;
           exp_stats(control_vars = "product")

exp_res
summary(exp_res)
summary(exp_res, inc_guar)

</code></pre>

<hr>
<h2 id='expose'>Create exposure records from census records</h2><span id='topic+expose'></span><span id='topic+expose_py'></span><span id='topic+expose_pq'></span><span id='topic+expose_pm'></span><span id='topic+expose_pw'></span><span id='topic+expose_cy'></span><span id='topic+expose_cq'></span><span id='topic+expose_cm'></span><span id='topic+expose_cw'></span>

<h3>Description</h3>

<p>Convert a data frame of census-level records to exposure-level
records.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expose(
  .data,
  end_date,
  start_date = as.Date("1900-01-01"),
  target_status = NULL,
  cal_expo = FALSE,
  expo_length = c("year", "quarter", "month", "week"),
  col_pol_num = "pol_num",
  col_status = "status",
  col_issue_date = "issue_date",
  col_term_date = "term_date",
  default_status
)

expose_py(...)

expose_pq(...)

expose_pm(...)

expose_pw(...)

expose_cy(...)

expose_cq(...)

expose_cm(...)

expose_cw(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="expose_+3A_.data">.data</code></td>
<td>
<p>A data frame with census-level records</p>
</td></tr>
<tr><td><code id="expose_+3A_end_date">end_date</code></td>
<td>
<p>Experience study end date</p>
</td></tr>
<tr><td><code id="expose_+3A_start_date">start_date</code></td>
<td>
<p>Experience study start date. Default value = 1900-01-01.</p>
</td></tr>
<tr><td><code id="expose_+3A_target_status">target_status</code></td>
<td>
<p>Character vector of target status values. Default value
= <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="expose_+3A_cal_expo">cal_expo</code></td>
<td>
<p>Set to TRUE for calendar year exposures. Otherwise policy
year exposures are assumed.</p>
</td></tr>
<tr><td><code id="expose_+3A_expo_length">expo_length</code></td>
<td>
<p>Exposure period length</p>
</td></tr>
<tr><td><code id="expose_+3A_col_pol_num">col_pol_num</code></td>
<td>
<p>Name of the column in <code>.data</code> containing the policy number</p>
</td></tr>
<tr><td><code id="expose_+3A_col_status">col_status</code></td>
<td>
<p>Name of the column in <code>.data</code> containing the policy status</p>
</td></tr>
<tr><td><code id="expose_+3A_col_issue_date">col_issue_date</code></td>
<td>
<p>Name of the column in <code>.data</code> containing the issue date</p>
</td></tr>
<tr><td><code id="expose_+3A_col_term_date">col_term_date</code></td>
<td>
<p>Name of the column in <code>.data</code> containing the termination
date</p>
</td></tr>
<tr><td><code id="expose_+3A_default_status">default_status</code></td>
<td>
<p>Optional scalar character representing the default
active status code. If not provided, the most common status is assumed.</p>
</td></tr>
<tr><td><code id="expose_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code>expose()</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Census-level data refers to a data set wherein there is one row
per unique policy. Exposure-level data expands census-level data such that
there is one record per policy per observation period. Observation periods
could be any meaningful period of time such as a policy year, policy month,
calendar year, calendar quarter, calendar month, etc.
</p>
<p><code>target_status</code> is used in the calculation of exposures. The annual
exposure method is applied, which allocates a full period of exposure for
any statuses in <code>target_status</code>. For all other statuses, new entrants
and exits are partially exposed based on the time elapsed in the observation
period. This method is consistent with the Balducci Hypothesis, which assumes
that the probability of termination is proportionate to the time elapsed
in the observation period. If the annual exposure method isn't desired,
<code>target_status</code> can be ignored. In this case, partial exposures are
always applied regardless of status.
</p>
<p><code>default_status</code> is used to indicate the default active status that
should be used when exposure records are created.
</p>


<h3>Value</h3>

<p>A tibble with class <code>exposed_df</code>, <code>tbl_df</code>, <code>tbl</code>,
and <code>data.frame</code>. The results include all existing columns in
<code>.data</code> plus new columns for exposures and observation periods. Observation
periods include counters for policy exposures, start dates, and end dates.
Both start dates and end dates are inclusive bounds.
</p>
<p>For policy year exposures, two observation period columns are returned.
Columns beginning with (<code>pol_</code>) are integer policy periods. Columns
beginning with (<code>pol_date_</code>) are calendar dates representing
anniversary dates, monthiversary dates, etc.
</p>


<h3>Policy period and calendar period variations</h3>

<p>The functions <code>expose_py()</code>, <code>expose_pq()</code>, <code>expose_pm()</code>,
<code>expose_pw()</code>, <code>expose_cy()</code>, <code>expose_cq()</code>,
<code>expose_cm()</code>, <code>expose_cw()</code> are convenience functions for
specific implementations of <code>expose()</code>. The two characters after the
underscore describe the exposure type and exposure period, respectively.
</p>
<p>For exposures types:
</p>

<ul>
<li> <p><code>p</code> refers to policy years
</p>
</li>
<li> <p><code>c</code> refers to calendar years
</p>
</li></ul>

<p>For exposure periods:
</p>

<ul>
<li> <p><code>y</code> = years
</p>
</li>
<li> <p><code>q</code> = quarters
</p>
</li>
<li> <p><code>m</code> = months
</p>
</li>
<li> <p><code>w</code> = weeks
</p>
</li></ul>

<p>All columns containing dates must be in YYYY-MM-DD format.
</p>


<h3>References</h3>

<p>Atkinson and McGarry (2016). Experience Study Calculations.
<a href="https://www.soa.org/49378a/globalassets/assets/files/research/experience-study-calculations.pdf">https://www.soa.org/49378a/globalassets/assets/files/research/experience-study-calculations.pdf</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+expose_split">expose_split()</a></code> for information on splitting calendar year
exposures by policy year.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>toy_census |&gt; expose("2020-12-31")

census_dat |&gt; expose_py("2019-12-31", target_status = "Surrender")

</code></pre>

<hr>
<h2 id='expose_split'>Split calendar exposures by policy year</h2><span id='topic+expose_split'></span><span id='topic+is_split_exposed_df'></span>

<h3>Description</h3>

<p>Split calendar period exposures that cross a policy anniversary
into a pre-anniversary record and a post-anniversary record.
</p>
<p>After splitting the data, the resulting data frame will contain both calendar
exposures and policy year exposures. These columns will be named
<code>exposure_cal</code> and <code>exposure_pol</code>, respectively. Calendar exposures will be
in the original units passed to <code>expose_split()</code>. Policy exposures will
always be expressed in years.
</p>
<p>After splitting exposures, downstream functions like <code>exp_stats()</code> and
<code>exp_shiny()</code> will require clarification as to which exposure basis should
be used to summarize results.
</p>
<p><code>is_split_exposed_df()</code> will return <code>TRUE</code> if <code>x</code> is a <code>split_exposed_df</code>
object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expose_split(.data)

is_split_exposed_df(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="expose_split_+3A_.data">.data</code></td>
<td>
<p>An <code>exposed_df</code> object with calendar period exposures.</p>
</td></tr>
<tr><td><code id="expose_split_+3A_x">x</code></td>
<td>
<p>Any object</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>.data</code> must be an <code>exposed_df</code> with calendar year, quarter, month,
or week exposure records. Calendar year exposures are created by the
functions <code><a href="#topic+expose_cy">expose_cy()</a></code>, <code><a href="#topic+expose_cq">expose_cq()</a></code>, <code><a href="#topic+expose_cm">expose_cm()</a></code>, or <code><a href="#topic+expose_cw">expose_cw()</a></code>, (or
<code><a href="#topic+expose">expose()</a></code> when <code>cal_expo = TRUE</code>).
</p>


<h3>Value</h3>

<p>For <code>expose_split()</code>, a tibble with class <code>split_exposed_df</code>,
<code>exposed_df</code>, <code>tbl_df</code>, <code>tbl</code>, and <code>data.frame</code>. The results include all
columns in <code>.data</code> except that <code>exposure</code> has been renamed to <code>exposure_cal</code>.
Additional columns include:
</p>

<ul>
<li> <p><code>exposure_pol</code> - policy year exposures
</p>
</li>
<li> <p><code>pol_yr</code> - policy year
</p>
</li></ul>

<p>For <code>is_split_exposed_df()</code>, a length-1 logical vector.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+expose">expose()</a></code> for information on creating exposure records from census
data.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>toy_census |&gt; expose_cy("2022-12-31") |&gt; expose_split()

</code></pre>

<hr>
<h2 id='is_exposed_df'>Exposed data frame helper functions</h2><span id='topic+is_exposed_df'></span><span id='topic+as_exposed_df'></span>

<h3>Description</h3>

<p>Test for and coerce to the <code>exposed_df</code> class.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_exposed_df(x)

as_exposed_df(
  x,
  end_date,
  start_date = as.Date("1900-01-01"),
  target_status = NULL,
  cal_expo = FALSE,
  expo_length = c("year", "quarter", "month", "week"),
  trx_types = NULL,
  col_pol_num,
  col_status,
  col_exposure,
  col_pol_per,
  cols_dates,
  col_trx_n_ = "trx_n_",
  col_trx_amt_ = "trx_amt_",
  default_status
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="is_exposed_df_+3A_x">x</code></td>
<td>
<p>An object. For <code>as_exposed_df()</code>, <code>x</code> must be a data frame.</p>
</td></tr>
<tr><td><code id="is_exposed_df_+3A_end_date">end_date</code></td>
<td>
<p>Experience study end date</p>
</td></tr>
<tr><td><code id="is_exposed_df_+3A_start_date">start_date</code></td>
<td>
<p>Experience study start date. Default value = 1900-01-01.</p>
</td></tr>
<tr><td><code id="is_exposed_df_+3A_target_status">target_status</code></td>
<td>
<p>Character vector of target status values. Default value
= <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="is_exposed_df_+3A_cal_expo">cal_expo</code></td>
<td>
<p>Set to TRUE for calendar year exposures. Otherwise policy
year exposures are assumed.</p>
</td></tr>
<tr><td><code id="is_exposed_df_+3A_expo_length">expo_length</code></td>
<td>
<p>Exposure period length</p>
</td></tr>
<tr><td><code id="is_exposed_df_+3A_trx_types">trx_types</code></td>
<td>
<p>Optional. Character vector containing unique transaction
types that have been attached to <code>x</code>. For each value in <code>trx_types</code>,
<code>as_exposed_df</code> requires that columns exist in <code>x</code> named <code style="white-space: pre;">&#8288;trx_n_{*}&#8288;</code> and
<code style="white-space: pre;">&#8288;trx_amt_{*}&#8288;</code> containing transaction counts and amounts, respectively. The
prefixes &quot;trx_n_&quot; and &quot;trx_amt_&quot; can be overridden using the <code>col_trx_n_</code>
and <code>col_trx_amt_</code> arguments.</p>
</td></tr>
<tr><td><code id="is_exposed_df_+3A_col_pol_num">col_pol_num</code></td>
<td>
<p>Optional. Name of the column in <code>x</code> containing the policy
number. The assumed default is &quot;pol_num&quot;.</p>
</td></tr>
<tr><td><code id="is_exposed_df_+3A_col_status">col_status</code></td>
<td>
<p>Optional. Name of the column in <code>x</code> containing the policy
status. The assumed default is &quot;status&quot;.</p>
</td></tr>
<tr><td><code id="is_exposed_df_+3A_col_exposure">col_exposure</code></td>
<td>
<p>Optional. Name of the column in <code>x</code> containing exposures.
The assumed default is &quot;exposure&quot;.</p>
</td></tr>
<tr><td><code id="is_exposed_df_+3A_col_pol_per">col_pol_per</code></td>
<td>
<p>Optional. Name of the column in <code>x</code> containing policy
exposure periods. Only necessary if <code>cal_expo</code> is <code>FALSE</code>. The assumed
default is either &quot;pol_yr&quot;, &quot;pol_qtr&quot;, &quot;pol_mth&quot;, or &quot;pol_wk&quot; depending on
the value of <code>expo_length</code>.</p>
</td></tr>
<tr><td><code id="is_exposed_df_+3A_cols_dates">cols_dates</code></td>
<td>
<p>Optional. Names of the columns in <code>x</code> containing exposure
start and end dates. Both date ranges are assumed to be exclusive. The
assumed default is of the form <em>A</em>_<em>B</em>. <em>A</em> is &quot;cal&quot; if <code>cal_expo</code> is <code>TRUE</code>
or &quot;pol&quot; otherwise. <em>B</em> is either &quot;yr&quot;, &quot;qtr&quot;, &quot;mth&quot;, or &quot;wk&quot; depending on
the value of <code>expo_length</code>.</p>
</td></tr>
<tr><td><code id="is_exposed_df_+3A_col_trx_n_">col_trx_n_</code></td>
<td>
<p>Optional. Prefix to use for columns containing transaction
counts.</p>
</td></tr>
<tr><td><code id="is_exposed_df_+3A_col_trx_amt_">col_trx_amt_</code></td>
<td>
<p>Optional. Prefix to use for columns containing transaction
amounts.</p>
</td></tr>
<tr><td><code id="is_exposed_df_+3A_default_status">default_status</code></td>
<td>
<p>Optional scalar character representing the default
active status code. If not provided, the most common status is assumed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>is_exposed_df()</code> will return <code>TRUE</code> if <code>x</code> is an <code>exposed_df</code> object.
</p>
<p><code>as_exposed_df()</code> will coerce a data frame to an <code>exposed_df</code> object if that
data frame has columns for policy numbers, statuses, exposures,
policy periods (for policy exposures only), and exposure start / end dates.
Optionally, if <code>x</code> has transaction counts and amounts by type, these can
be specified without calling <code><a href="#topic+add_transactions">add_transactions()</a></code>.
</p>


<h3>Value</h3>

<p>For <code>is_exposed_df()</code>, a length-1 logical vector. For
<code>as_exposed_df()</code>, an <code>exposed_df</code> object.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+expose">expose()</a></code> for information on how <code>exposed_df</code> objects are typically
created from census data.
</p>

<hr>
<h2 id='plot_special'>Additional plotting functions for termination studies</h2><span id='topic+plot_special'></span><span id='topic+plot_termination_rates'></span><span id='topic+plot_actual_to_expected'></span>

<h3>Description</h3>

<p>These functions create additional experience study plots that are not
available or difficult to produce using the <code><a href="#topic+autoplot.exp_df">autoplot.exp_df()</a></code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_termination_rates(object, ..., include_cred_adj = FALSE)

plot_actual_to_expected(object, ..., add_hline = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_special_+3A_object">object</code></td>
<td>
<p>An object of class <code>exp_df</code> created by the function
<code><a href="#topic+exp_stats">exp_stats()</a></code>.</p>
</td></tr>
<tr><td><code id="plot_special_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code><a href="#topic+autoplot.exp_df">autoplot.exp_df()</a></code>.</p>
</td></tr>
<tr><td><code id="plot_special_+3A_include_cred_adj">include_cred_adj</code></td>
<td>
<p>If <code>TRUE</code>, credibility-weighted termination rates
will be plotted as well.</p>
</td></tr>
<tr><td><code id="plot_special_+3A_add_hline">add_hline</code></td>
<td>
<p>If <code>TRUE</code>, a blue dashed horizontal line will be drawn at
100%.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code><a href="#topic+plot_termination_rates">plot_termination_rates()</a></code> - Create a plot of observed termination rates
and any expected termination rates attached to an <code>exp_df</code> object.
</p>
<p><code><a href="#topic+plot_actual_to_expected">plot_actual_to_expected()</a></code> - Create a plot of actual-to-expected termination
rates attached to an <code>exp_df</code> object.
</p>


<h3>Value</h3>

<p>a <code>ggplot</code> object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+autoplot.exp_df">autoplot.exp_df()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
study_py &lt;- expose_py(census_dat, "2019-12-31", target_status = "Surrender")
expected_table &lt;- c(seq(0.005, 0.03, length.out = 10), 0.2, 0.15, rep(0.05, 3))

study_py &lt;- study_py |&gt;
  mutate(expected_1 = expected_table[pol_yr],
         expected_2 = ifelse(inc_guar, 0.015, 0.03))

exp_res &lt;- study_py |&gt; group_by(pol_yr) |&gt;
  exp_stats(expected = c("expected_1", "expected_2"))

plot_termination_rates(exp_res)

plot_actual_to_expected(exp_res)

</code></pre>

<hr>
<h2 id='plot_special_trx'>Additional plotting functions for transaction studies</h2><span id='topic+plot_special_trx'></span><span id='topic+plot_utilization_rates'></span>

<h3>Description</h3>

<p>These functions create additional experience study plots that are not
available or difficult to produce using the <code><a href="#topic+autoplot.trx_df">autoplot.trx_df()</a></code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_utilization_rates(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_special_trx_+3A_object">object</code></td>
<td>
<p>An object of class <code>trx_df</code> created by the function
<code><a href="#topic+trx_stats">trx_stats()</a></code>.</p>
</td></tr>
<tr><td><code id="plot_special_trx_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code><a href="#topic+autoplot.trx_df">autoplot.trx_df()</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code><a href="#topic+plot_utilization_rates">plot_utilization_rates()</a></code> - Create a plot of transaction frequency and
severity. Frequency is represented by utilization rates (<code>trx_util</code>).
Severity is represented by transaction amounts as a percentage of one or
more other columns in the data (<code style="white-space: pre;">&#8288;{*}_w_trx&#8288;</code>). All severity series begin with
the prefix &quot;pct_of_&quot; and end with the suffix &quot;_w_trx&quot;. The suffix refers to
the fact that the denominator only includes records with non-zero
transactions. Severity series are based on column names passed to the
<code>percent_of</code> argument in <code><a href="#topic+trx_stats">trx_stats()</a></code>. If no &quot;percentage of&quot; columns exist
in <code>object</code>, this function will only plot utilization rates.
</p>


<h3>Value</h3>

<p>a <code>ggplot</code> object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+autoplot.trx_df">autoplot.trx_df()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
study_py &lt;- expose_py(census_dat, "2019-12-31",
                      target_status = "Surrender") |&gt;
  add_transactions(withdrawals) |&gt;
  left_join(account_vals, by = c("pol_num", "pol_date_yr"))

trx_res &lt;- study_py |&gt; group_by(pol_yr) |&gt;
  trx_stats(percent_of = "av_anniv", combine_trx = TRUE)

plot_utilization_rates(trx_res)

</code></pre>

<hr>
<h2 id='pol_yr'>Calculate policy duration</h2><span id='topic+pol_yr'></span><span id='topic+pol_qtr'></span><span id='topic+pol_mth'></span><span id='topic+pol_wk'></span>

<h3>Description</h3>

<p>Given a vector of dates and a vector of issue dates, calculate
policy years, quarters, months, or weeks.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pol_yr(x, issue_date)

pol_qtr(x, issue_date)

pol_mth(x, issue_date)

pol_wk(x, issue_date)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pol_yr_+3A_x">x</code></td>
<td>
<p>A vector of dates</p>
</td></tr>
<tr><td><code id="pol_yr_+3A_issue_date">issue_date</code></td>
<td>
<p>A vector of issue dates</p>
</td></tr>
</table>


<h3>Details</h3>

<p>These functions assume the first day of each policy year is the
anniversary date (or issue date in the first year). The last day of each
policy year is the day before the next anniversary date. Analogous rules
are used for policy quarters, policy months, and policy weeks.
</p>


<h3>Value</h3>

<p>An integer vector
</p>


<h3>Examples</h3>

<pre><code class='language-R'>pol_yr(as.Date("2021-02-28") + 0:2, "2020-02-29")

pol_mth(as.Date("2021-02-28") + 0:2, "2020-02-29")

</code></pre>

<hr>
<h2 id='qx_iamb'>2012 Individual Annuity Mortality Table and Projection Scale G2</h2><span id='topic+qx_iamb'></span><span id='topic+scale_g2'></span>

<h3>Description</h3>

<p>Mortality rates and mortality improvement rates from the 2012 Individual
Annuity Mortality Basic (IAMB) Table and Projection Scale G2.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>qx_iamb

scale_g2
</code></pre>


<h3>Format</h3>

<p>For the 2012 IAMB table, a data frame with 242 rows and 3 columns:
</p>

<dl>
<dt>age</dt><dd><p>Attained age</p>
</dd>
<dt>qx</dt><dd><p>Mortality rate</p>
</dd>
<dt>gender</dt><dd><p>Female or Male</p>
</dd>
</dl>

<p>For the Projection Scale G2 table, a data frame with 242 rows and 3 columns:
</p>

<dl>
<dt>age</dt><dd><p>Attained age</p>
</dd>
<dt>mi</dt><dd><p>Mortality improvement rate</p>
</dd>
<dt>gender</dt><dd><p>Female or Male</p>
</dd>
</dl>



<h3>Source</h3>


<ul>
<li> <p><a href="https://mort.soa.org/">https://mort.soa.org/</a>
</p>
</li>
<li> <p><a href="https://www.actuary.org/sites/default/files/files/publications/Payout_Annuity_Report_09-28-11.pdf">https://www.actuary.org/sites/default/files/files/publications/Payout_Annuity_Report_09-28-11.pdf</a>
</p>
</li></ul>


<hr>
<h2 id='reexports'>Objects exported from other packages</h2><span id='topic+reexports'></span><span id='topic+autoplot'></span><span id='topic+groups'></span><span id='topic+group_by'></span><span id='topic+ungroup'></span><span id='topic+filter'></span><span id='topic+arrange'></span><span id='topic+mutate'></span><span id='topic+select'></span><span id='topic+slice'></span><span id='topic+rename'></span><span id='topic+relocate'></span><span id='topic+left_join'></span><span id='topic+right_join'></span><span id='topic+inner_join'></span><span id='topic+full_join'></span><span id='topic+semi_join'></span><span id='topic+anti_join'></span><span id='topic+prep'></span><span id='topic+bake'></span><span id='topic+tidy'></span>

<h3>Description</h3>

<p>These objects are imported from other packages. Follow the links
below to see their documentation.
</p>

<dl>
<dt>dplyr</dt><dd><p><code><a href="dplyr.html#topic+filter-joins">anti_join</a></code>, <code><a href="dplyr.html#topic+arrange">arrange</a></code>, <code><a href="dplyr.html#topic+filter">filter</a></code>, <code><a href="dplyr.html#topic+mutate-joins">full_join</a></code>, <code><a href="dplyr.html#topic+group_by">group_by</a></code>, <code><a href="dplyr.html#topic+group_data">groups</a></code>, <code><a href="dplyr.html#topic+mutate-joins">inner_join</a></code>, <code><a href="dplyr.html#topic+mutate-joins">left_join</a></code>, <code><a href="dplyr.html#topic+mutate">mutate</a></code>, <code><a href="dplyr.html#topic+relocate">relocate</a></code>, <code><a href="dplyr.html#topic+rename">rename</a></code>, <code><a href="dplyr.html#topic+mutate-joins">right_join</a></code>, <code><a href="dplyr.html#topic+select">select</a></code>, <code><a href="dplyr.html#topic+filter-joins">semi_join</a></code>, <code><a href="dplyr.html#topic+slice">slice</a></code>, <code><a href="dplyr.html#topic+group_by">ungroup</a></code></p>
</dd>
<dt>generics</dt><dd><p><code><a href="generics.html#topic+tidy">tidy</a></code></p>
</dd>
<dt>ggplot2</dt><dd><p><code><a href="ggplot2.html#topic+autoplot">autoplot</a></code></p>
</dd>
<dt>recipes</dt><dd><p><code><a href="recipes.html#topic+bake">bake</a></code>, <code><a href="recipes.html#topic+prep">prep</a></code></p>
</dd>
</dl>

<hr>
<h2 id='sim_data'>Simulated annuity data</h2><span id='topic+sim_data'></span><span id='topic+census_dat'></span><span id='topic+withdrawals'></span><span id='topic+account_vals'></span>

<h3>Description</h3>

<p>Simulated data for a theoretical deferred annuity product with
an optional guaranteed income rider. This data is theoretical only and
does not represent the experience on any specific product.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>census_dat

withdrawals

account_vals
</code></pre>


<h3>Format</h3>

<p>Three data frames containing census records (<code>census_dat</code>),
withdrawal transactions (<code>withdrawals</code>), and historical account values
(<code>account_vals</code>).
</p>
<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 20000 rows and 11 columns.
</p>
<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 160130 rows and 4 columns.
</p>
<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 141252 rows and 3 columns.
</p>


<h3>Census data (<code>census_dat</code>)</h3>


<dl>
<dt>pol_num</dt><dd><p>Policy number</p>
</dd>
<dt>status</dt><dd><p>Policy status: Active, Surrender, or Death</p>
</dd>
<dt>issue_date</dt><dd><p>Issue date</p>
</dd>
<dt>inc_guar</dt><dd><p>Indicates whether the policy was issued with an income guarantee</p>
</dd>
<dt>qual</dt><dd><p>Indicates whether the policy was purchased with tax-qualified funds</p>
</dd>
<dt>age</dt><dd><p>Issue age</p>
</dd>
<dt>product</dt><dd><p>Product: a, b, or c</p>
</dd>
<dt>gender</dt><dd><p>M (Male) or F (Female)</p>
</dd>
<dt>wd_age</dt><dd><p>Age that withdrawals commence</p>
</dd>
<dt>premium</dt><dd><p>Single premium deposit</p>
</dd>
<dt>term_date</dt><dd><p>Termination date upon death or surrender</p>
</dd>
</dl>



<h3>Withdrawal data (<code>withdrawals</code>)</h3>


<dl>
<dt>pol_num</dt><dd><p>Policy number</p>
</dd>
<dt>trx_date</dt><dd><p>Withdrawal transaction date</p>
</dd>
<dt>trx_type</dt><dd><p>Withdrawal transaction type, either Base or Rider</p>
</dd>
<dt>trx_amt</dt><dd><p>Withdrawal transaction amount</p>
</dd>
</dl>



<h3>Account values data (<code>account_vals</code>)</h3>


<dl>
<dt>pol_num</dt><dd><p>Policy number</p>
</dd>
<dt>pol_date_yr</dt><dd><p>Policy anniversary date (beginning of year)</p>
</dd>
<dt>av_anniv</dt><dd><p>Account value on the policy anniversary date</p>
</dd>
</dl>



<h3>See Also</h3>

<p><a href="#topic+census_dat">census_dat</a>
</p>

<hr>
<h2 id='step_expose'>Create exposure records in a <code>recipes</code> step</h2><span id='topic+step_expose'></span>

<h3>Description</h3>

<p><code>step_expose()</code> creates a <em>specification</em> of a recipe step that will convert
a data frame of census-level records to exposure-level records.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>step_expose(
  recipe,
  ...,
  role = NA,
  trained = FALSE,
  end_date,
  start_date = as.Date("1900-01-01"),
  target_status = NULL,
  options = list(cal_expo = FALSE, expo_length = "year"),
  drop_pol_num = TRUE,
  skip = TRUE,
  id = recipes::rand_id("expose")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="step_expose_+3A_recipe">recipe</code></td>
<td>
<p>A recipe object. The step will be added to the
sequence of operations for this recipe.</p>
</td></tr>
<tr><td><code id="step_expose_+3A_...">...</code></td>
<td>
<p>One or more selector functions to choose variables
for this step. See <code><a href="recipes.html#topic+selections">selections()</a></code> for more details.</p>
</td></tr>
<tr><td><code id="step_expose_+3A_role">role</code></td>
<td>
<p>Not used by this step since no new variables are
created.</p>
</td></tr>
<tr><td><code id="step_expose_+3A_trained">trained</code></td>
<td>
<p>A logical to indicate if the quantities for
preprocessing have been estimated.</p>
</td></tr>
<tr><td><code id="step_expose_+3A_end_date">end_date</code></td>
<td>
<p>Experience study end date</p>
</td></tr>
<tr><td><code id="step_expose_+3A_start_date">start_date</code></td>
<td>
<p>Experience study start date. Default value = 1900-01-01.</p>
</td></tr>
<tr><td><code id="step_expose_+3A_target_status">target_status</code></td>
<td>
<p>Character vector of target status values. Default value
= <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="step_expose_+3A_options">options</code></td>
<td>
<p>A named list of additional arguments passed to <code><a href="#topic+expose">expose()</a></code>.</p>
</td></tr>
<tr><td><code id="step_expose_+3A_drop_pol_num">drop_pol_num</code></td>
<td>
<p>Whether the <code>pol_num</code> column produced by <code><a href="#topic+expose">expose()</a></code>
should be dropped. Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="step_expose_+3A_skip">skip</code></td>
<td>
<p>A logical. Should the step be skipped when the
recipe is baked by <code><a href="recipes.html#topic+bake">bake()</a></code>? While all operations are baked
when <code><a href="recipes.html#topic+prep">prep()</a></code> is run, some operations may not be able to be
conducted on new data (e.g. processing the outcome variable(s)).
Care should be taken when using <code>skip = TRUE</code> as it may affect
the computations for subsequent operations.</p>
</td></tr>
<tr><td><code id="step_expose_+3A_id">id</code></td>
<td>
<p>A character string that is unique to this step to identify it.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Policy year exposures are calculated as a default. To switch to calendar
exposures or another exposure length, use pass the appropriate arguments to
the <code>options</code> parameter.
</p>
<p>Policy numbers are dropped as a default whenever the recipe is baked. This
is done to prevent unintentional errors when the model formula includes
all variables (<code>y ~ .</code>). If policy numbers are required for any reason
(mixed effect models, identification, etc.), set <code>drop_pol_num</code> to <code>FALSE</code>.
</p>


<h3>Value</h3>

<p>An updated version of <code>recipe</code> with the new expose step added to the
sequence of any existing operations. For the <code>tidy</code> method, a <code>tibble</code> with
the columns <code>exposure_type</code>, <code>target_status</code>, <code>start_date</code>, and <code>end_date</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+expose">expose()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
expo_rec &lt;- recipes::recipe(status ~ ., toy_census) |&gt;
  step_expose(end_date = "2022-12-31", target_status = "Surrender",
              options = list(expo_length = "month")) |&gt;
  prep()

recipes::juice(expo_rec)

</code></pre>

<hr>
<h2 id='summary.exposed_df'>Summarize experience study records</h2><span id='topic+summary.exposed_df'></span>

<h3>Description</h3>

<p>Create a summary data frame of termination experience for a given target
status.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'exposed_df'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.exposed_df_+3A_object">object</code></td>
<td>
<p>A data frame with exposure-level records</p>
</td></tr>
<tr><td><code id="summary.exposed_df_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code><a href="#topic+exp_stats">exp_stats()</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Calling <code><a href="base.html#topic+summary">summary()</a></code> on an <code>exposed_df</code> object will summarize results using
<code><a href="#topic+exp_stats">exp_stats()</a></code>. See <code><a href="#topic+exp_stats">exp_stats()</a></code> for more information.
</p>


<h3>Value</h3>

<p>A tibble with class <code>exp_df</code>, <code>tbl_df</code>, <code>tbl</code>,
and <code>data.frame</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+exp_stats">exp_stats()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>toy_census |&gt; expose("2022-12-31", target_status = "Surrender") |&gt;
    summary()

</code></pre>

<hr>
<h2 id='toy_census'>Toy policy census data</h2><span id='topic+toy_census'></span>

<h3>Description</h3>

<p>A tiny dataset containing 3 policies: one active, one terminated due to
death, and one terminated due to surrender.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>toy_census
</code></pre>


<h3>Format</h3>

<p>A data frame with 3 rows and 4 columns:
</p>

<dl>
<dt>pol_num</dt><dd><p>Policy number</p>
</dd>
<dt>status</dt><dd><p>Policy status</p>
</dd>
<dt>issue_date</dt><dd><p>Issue date</p>
</dd>
<dt>term_date</dt><dd><p>Termination date</p>
</dd>
</dl>


<hr>
<h2 id='trx_stats'>Summarize transactions and utilization rates</h2><span id='topic+trx_stats'></span><span id='topic+summary.trx_df'></span>

<h3>Description</h3>

<p>Create a summary data frame of transaction counts, amounts,
and utilization rates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trx_stats(
  .data,
  trx_types,
  percent_of = NULL,
  combine_trx = FALSE,
  col_exposure = "exposure",
  full_exposures_only = TRUE,
  conf_int = FALSE,
  conf_level = 0.95
)

## S3 method for class 'trx_df'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="trx_stats_+3A_.data">.data</code></td>
<td>
<p>A data frame with exposure-level records of type
<code>exposed_df</code> with transaction data attached. If necessary, use
<code><a href="#topic+as_exposed_df">as_exposed_df()</a></code> to convert a data frame to an <code>exposed_df</code> object, and use
<code><a href="#topic+add_transactions">add_transactions()</a></code> to attach transactions to an <code>exposed_df</code> object.</p>
</td></tr>
<tr><td><code id="trx_stats_+3A_trx_types">trx_types</code></td>
<td>
<p>A character vector of transaction types to include in the
output. If none is provided, all available transaction types in <code>.data</code>
will be used.</p>
</td></tr>
<tr><td><code id="trx_stats_+3A_percent_of">percent_of</code></td>
<td>
<p>A optional character vector containing column names in
<code>.data</code> to use as denominators in the calculation of utilization rates or
actual-to-expected ratios.</p>
</td></tr>
<tr><td><code id="trx_stats_+3A_combine_trx">combine_trx</code></td>
<td>
<p>If <code>FALSE</code> (default), the results will contain output rows
for each transaction type. If <code>TRUE</code>, the results will contains aggregated
experience across all transaction types.</p>
</td></tr>
<tr><td><code id="trx_stats_+3A_col_exposure">col_exposure</code></td>
<td>
<p>Name of the column in <code>.data</code> containing exposures</p>
</td></tr>
<tr><td><code id="trx_stats_+3A_full_exposures_only">full_exposures_only</code></td>
<td>
<p>If <code>TRUE</code> (default), partially exposed records will
be excluded from <code>data</code>.</p>
</td></tr>
<tr><td><code id="trx_stats_+3A_conf_int">conf_int</code></td>
<td>
<p>If <code>TRUE</code>, the output will include confidence intervals
around the observed utilization rate and any <code>percent_of</code> output columns.</p>
</td></tr>
<tr><td><code id="trx_stats_+3A_conf_level">conf_level</code></td>
<td>
<p>Confidence level for confidence intervals</p>
</td></tr>
<tr><td><code id="trx_stats_+3A_object">object</code></td>
<td>
<p>A <code>trx_df</code> object</p>
</td></tr>
<tr><td><code id="trx_stats_+3A_...">...</code></td>
<td>
<p>Groups to retain after <code>summary()</code> is called</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Unlike <code><a href="#topic+exp_stats">exp_stats()</a></code>, this function requires <code>data</code> to be an
<code>exposed_df</code> object.
</p>
<p>If <code>.data</code> is grouped, the resulting data frame will contain
one row per transaction type per group.
</p>
<p>Any number of transaction types can be passed to the <code>trx_types</code> argument,
however each transaction type <strong>must</strong> appear in the <code>trx_types</code> attribute of
<code>.data</code>. In addition, <code>trx_stats()</code> expects to see columns named <code style="white-space: pre;">&#8288;trx_n_{*}&#8288;</code>
(for transaction counts) and <code style="white-space: pre;">&#8288;trx_amt_{*}&#8288;</code> for (transaction amounts) for each
transaction type. To ensure <code>.data</code> is in the appropriate format, use the
functions <code><a href="#topic+as_exposed_df">as_exposed_df()</a></code> to convert an existing data frame with
transactions or <code><a href="#topic+add_transactions">add_transactions()</a></code> to attach transactions to an existing
<code>exposed_df</code> object.
</p>


<h3>Value</h3>

<p>A tibble with class <code>trx_df</code>, <code>tbl_df</code>, <code>tbl</code>,
and <code>data.frame</code>. The results include columns for any grouping
variables and transaction types, plus the following:
</p>

<ul>
<li> <p><code>trx_n</code>: the number of unique transactions.
</p>
</li>
<li> <p><code>trx_amt</code>: total transaction amount
</p>
</li>
<li> <p><code>trx_flag</code>: the number of observation periods with non-zero transaction amounts.
</p>
</li>
<li> <p><code>exposure</code>: total exposures
</p>
</li>
<li> <p><code>avg_trx</code>: mean transaction amount (<code>trx_amt / trx_flag</code>)
</p>
</li>
<li> <p><code>avg_all</code>: mean transaction amount over all records (<code>trx_amt / exposure</code>)
</p>
</li>
<li> <p><code>trx_freq</code>: transaction frequency when a transaction occurs (<code>trx_n / trx_flag</code>)
</p>
</li>
<li> <p><code>trx_util</code>: transaction utilization per observation period (<code>trx_flag / exposure</code>)
</p>
</li></ul>

<p>If <code>percent_of</code> is provided, the results will also include:
</p>

<ul>
<li><p> The sum of any columns passed to <code>percent_of</code> with non-zero transactions.
These columns include the suffix <code style="white-space: pre;">&#8288;_w_trx&#8288;</code>.
</p>
</li>
<li><p> The sum of any columns passed to <code>percent_of</code>
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;pct_of_{*}_w_trx&#8288;</code>: total transactions as a percentage of column
<code style="white-space: pre;">&#8288;{*}_w_trx&#8288;</code>. In other words, total transactions divided by the sum of a
column including only records utilizing transactions.
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;pct_of_{*}_all&#8288;</code>: total transactions as a percentage of column <code style="white-space: pre;">&#8288;{*}&#8288;</code>. In
other words, total transactions divided by the sum of a column regardless
of whether or not transactions were utilized.
</p>
</li></ul>

<p>If <code>conf_int</code> is set to <code>TRUE</code>, additional columns are added for lower and
upper confidence interval limits around the observed utilization rate and any
<code>percent_of</code> output columns. Confidence interval columns include the name
of the original output column suffixed by either <code style="white-space: pre;">&#8288;_lower&#8288;</code> or <code style="white-space: pre;">&#8288;_upper&#8288;</code>.
</p>

<ul>
<li><p> If values are passed to <code>percent_of</code>, an additional column is created
containing the the sum of squared transaction amounts (<code>trx_amt_sq</code>).
</p>
</li></ul>



<h3>&quot;Percentage of&quot; calculations</h3>

<p>The <code>percent_of</code> argument is optional. If provided, this argument must
be a character vector with values corresponding to columns in <code>.data</code>
containing values to use as denominators in the calculation of utilization
rates or actual-to-expected ratios. Example usage:
</p>

<ul>
<li><p> In a study of partial withdrawal transactions, if <code>percent_of</code> refers to
account values, observed withdrawal rates can be determined.
</p>
</li>
<li><p> In a study of recurring claims, if <code>percent_of</code> refers to a column
containing a maximum benefit amount, utilization rates can be determined.
</p>
</li></ul>



<h3>Confidence intervals</h3>

<p>If <code>conf_int</code> is set to <code>TRUE</code>, the output will contain lower and upper
confidence interval limits for the observed utilization rate and any
<code>percent_of</code> output columns. The confidence level is dictated
by <code>conf_level</code>.
</p>

<ul>
<li><p> Intervals for the utilization rate (<code>trx_util</code>) assume a binomial
distribution.
</p>
</li>
<li><p> Intervals for transactions as a percentage of another column with
non-zero transactions (<code style="white-space: pre;">&#8288;pct_of_{*}_w_trx&#8288;</code>) are constructed using a normal
distribution
</p>
</li>
<li><p> Intervals for transactions as a percentage of another column
regardless of transaction utilization (<code style="white-space: pre;">&#8288;pct_of_{*}_all&#8288;</code>) are calculated
assuming that the aggregate distribution is normal with a mean equal to
observed transactions and a variance equal to:
</p>
<p><code>Var(S) = E(N) * Var(X) + E(X)^2 * Var(N)</code>,
</p>
<p>Where <code>S</code> is the aggregate transactions random variable, <code>X</code> is an individual
transaction amount assumed to follow a normal distribution, and <code>N</code> is a
binomial random variable for transaction utilization.
</p>
</li></ul>



<h3>Default removal of partial exposures</h3>

<p>As a default, partial exposures are removed from <code>.data</code> before summarizing
results. This is done to avoid complexity associated with a lopsided skew
in the timing of transactions. For example, if transactions can occur on a
monthly basis or annually at the beginning of each policy year, partial
exposures may not be appropriate. If a policy had an exposure of 0.5 years
and was taking withdrawals annually at the beginning of the year, an
argument could be made that the exposure should instead be 1 complete year.
If the same policy was expected to take withdrawals 9 months into the year,
it's not clear if the exposure should be 0.5 years or 0.5 / 0.75 years.
To override this treatment, set <code>full_exposures_only</code> to <code>FALSE</code>.
</p>


<h3><code>summary()</code> Method</h3>

<p>Applying <code>summary()</code> to a <code>trx_df</code> object will re-summarize the
data while retaining any grouping variables passed to the &quot;dots&quot;
(<code>...</code>).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>expo &lt;- expose_py(census_dat, "2019-12-31", target_status = "Surrender") |&gt;
  add_transactions(withdrawals)

res &lt;- expo |&gt; group_by(inc_guar) |&gt; trx_stats(percent_of = "premium")
res

summary(res)

expo |&gt; group_by(inc_guar) |&gt;
  trx_stats(percent_of = "premium", combine_trx = TRUE, conf_int = TRUE)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
