<!DOCTYPE html><html><head><title>Help for package cartograflow</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {cartograflow}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#cartograflow'><p>Cartograflow Package</p></a></li>
<li><a href='#flowanalysis'><p>Computation of a global concentration criterion of flows values or features</p></a></li>
<li><a href='#flowcarre'><p>Builds a square matrice from geographical nodes</p></a></li>
<li><a href='#flowcontig'><p>Builds an ordinal distance matrices from a spatial features background</p></a></li>
<li><a href='#flowdist'><p>Builds a continuous distance matrices from a spatial features background</p></a></li>
<li><a href='#flowgini'><p>Analysis of flow concentration (Gini coefficient)</p></a></li>
<li><a href='#flowjointure'><p>Builds a spatial join with a flow dataset</p></a></li>
<li><a href='#flowlowup'><p>Extracts the triangular sub-matrix of flows</p></a></li>
<li><a href='#flowmap'><p>Mapping of an origin-destination flow matrix</p></a></li>
<li><a href='#flowplaces'><p>Computes flow indicators per places</p></a></li>
<li><a href='#flowreduct'><p>Flow matrix reduction according to another matrix</p></a></li>
<li><a href='#flows'><p>MOBPRO: Commuting trips in 2015</p></a></li>
<li><a href='#flowstructmat'><p>Structuring a matrix</p></a></li>
<li><a href='#flowtabmat'><p>Changing the format of a flow dataset</p></a></li>
<li><a href='#flowtype'><p>Compute bilateral several flow types</p></a></li>
<li><a href='#geoid'><p>Geographical ID</p></a></li>
<li><a href='#mat_ex'><p>Example of a small matrice</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Filtering Matrix for Flow Mapping</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.5</td>
</tr>
<tr>
<td>Description:</td>
<td>Functions to prepare and filter an origin-destination matrix for thematic flow mapping purposes.   
             This comes after Bahoken, Francoise (2016), Mapping flow matrix a contribution, PhD in Geography - Territorial sciences. See Bahoken (2017) &lt;<a href="https://doi.org/10.4000%2Fnetcom.2565">doi:10.4000/netcom.2565</a>&gt;.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.4.0)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/fbahoken/cartogRaflow">https://github.com/fbahoken/cartogRaflow</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat, cartography</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr,</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr, graphics, ggplot2, plotly, reshape2, rlang,sf, utils,
igraph</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-10-17 18:39:19 UTC; sylvain</td>
</tr>
<tr>
<td>Author:</td>
<td>Sylvain Blondeau [aut, cre],
  Francoise Bahoken [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Sylvain Blondeau &lt;blondeau.sylvain@yahoo.fr&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-10-17 22:40:21 UTC</td>
</tr>
</table>
<hr>
<h2 id='cartograflow'>Cartograflow Package</h2><span id='topic+cartograflow'></span>

<h3>Description</h3>

<p>This package contains functions to prepare and filter origin-destination matrix
for thematic flow mapping purposes. The spatial objects processing are those of sf package.<br />
This comes after Bahoken, Francoise (2016) Contribution à la cartographie d'une matrice de flux,
Phd in Geography, Sorbonne Paris Cité, Paris 7.
</p>


<h3>Details</h3>

<p>To learn more about cartograflow, see the vignette cartograflow.html
</p>
<p>Main functions :
</p>

<ul>
<li>
<p><a href="#topic+flowanalysis">flowanalysis</a> <a href="#topic+flowcarre">flowcarre</a> <a href="#topic+flowcontig">flowcontig</a> <a href="#topic+flowdist">flowdist</a>
<a href="#topic+flowgini">flowgini</a> <a href="#topic+flowjointure">flowjointure</a>  <a href="#topic+flowmap">flowmap</a> <a href="#topic+flowreduct">flowreduct</a>
<a href="#topic+flowstructmat">flowstructmat</a> <a href="#topic+flowcontig">flowcontig</a>

</p>
</li></ul>


<hr>
<h2 id='flowanalysis'>Computation of a global concentration criterion of flows values or features</h2><span id='topic+flowanalysis'></span>

<h3>Description</h3>

<p>Computation of a global selection criterion
for filtering flows values or flow features.<br />
To be use after <a href="#topic+flowgini">flowgini</a> and before <a href="#topic+flowmap">flowmap</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>flowanalysis(tab, fij = NULL, critflow, critlink, result)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="flowanalysis_+3A_tab">tab</code></td>
<td>
<p>input flow dataset from <a href="#topic+flowgini">flowgini</a></p>
</td></tr>
<tr><td><code id="flowanalysis_+3A_fij">fij</code></td>
<td>
<p>flow value between origin and destination places</p>
</td></tr>
<tr><td><code id="flowanalysis_+3A_critflow">critflow</code></td>
<td>
<p>desired level of information significativity. See Details.</p>
</td></tr>
<tr><td><code id="flowanalysis_+3A_critlink">critlink</code></td>
<td>
<p>desired level of features density. See Details.</p>
</td></tr>
<tr><td><code id="flowanalysis_+3A_result">result</code></td>
<td>
<p>resulting filtering criterion value. See Details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>-critflow =  desired level of flow's information significativity
(e.g. 80
-critlink = desired level of flow's features density (e.g. 20
of the flow features that represents the more significant information. <br />
</p>
<p>-result=&quot;density&quot; returns the desired level of features density as
a 
-result = &quot;significativity&quot; returns the level of flow significativity
as a 
</p>


<h3>References</h3>

<p>Bahoken Françoise, 2016,« La cartographie d’une sélection globale de flux, entre ‘significativité’ et ‘densité’ »,
Netcom Online, 30-3/4 | 2016, Online since 23 March 2017, connection on 05 May 2019. URL : http://journals.openedition.org/netcom/2565 ;
DOI : 10.4000/netcom.2565
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(cartograflow)
data(flowdata)

# 1/4: Computes Gini's coefficent
tabgini &lt;- flowgini(ODpts = flows, origin = "i", destination = "j",
                     valflow = "Fij", lorenz.plot = FALSE)
### [1] Gini's coefficent = 73.16 %

# 2/4: Plot Lorenz curve
flowgini(tabgini,
        origin = "i", dest = "j", valflow = "Fij",
        lorenz.plot = TRUE
)

# 3/4: Compute critflow filtering parameter
# critflow = 0.8 #selected criterion
flowanalysis(tabgini, critflow = 0.8, result = "signif")
### [1] "threshold =  11238  ---  flows =  80 % ---  links =  22.94 %"

</code></pre>

<hr>
<h2 id='flowcarre'>Builds a square matrice from geographical nodes</h2><span id='topic+flowcarre'></span>

<h3>Description</h3>

<p>Builds a square and closed matrice from a dataframe of spatial nodes
</p>


<h3>Usage</h3>

<pre><code class='language-R'>flowcarre(liste, tab, origin, dest, valflow, empty.sq, format, diagonale)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="flowcarre_+3A_liste">liste</code></td>
<td>
<p>list of all the spatial codes as a single dataframe</p>
</td></tr>
<tr><td><code id="flowcarre_+3A_tab">tab</code></td>
<td>
<p>the non squared input flow dataset with three column : origin, destination, flow value</p>
</td></tr>
<tr><td><code id="flowcarre_+3A_origin">origin</code></td>
<td>
<p>node / place of origin of the flow</p>
</td></tr>
<tr><td><code id="flowcarre_+3A_dest">dest</code></td>
<td>
<p>node / place of destination of the flow</p>
</td></tr>
<tr><td><code id="flowcarre_+3A_valflow">valflow</code></td>
<td>
<p>is the flow value between origin and destination places</p>
</td></tr>
<tr><td><code id="flowcarre_+3A_empty.sq">empty.sq</code></td>
<td>
<p>Builds an empty matrix or not. See Details.</p>
</td></tr>
<tr><td><code id="flowcarre_+3A_format">format</code></td>
<td>
<p>is the desired squared flow dataset output format. See Details.</p>
</td></tr>
<tr><td><code id="flowcarre_+3A_diagonale">diagonale</code></td>
<td>
<p>to zero or not the main diagonal. See Details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>- empty.sq is &quot;TRUE&quot; builds an empty matrix ; else is &quot;FALSE&quot; or missing<br /> <br />
- format is &quot;M&quot; for matrice format<br />
- format is &quot;L&quot; for long format, as three column dataframe<br /><br />
- diagonal is &quot;TRUE&quot; to zero the main diagonal
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(cartograflow)
data(flowdata)
var1 &lt;- geoid
var2 &lt;- flows

# 1/2 Compute an empty square matrice with ID code, and sets the value to zero
# Example for matrice format (same procedure for the long format)

mat &lt;- flowcarre(var1, var2,
  origin = "i", dest = "j", valflow = "Fij",
  format = "M", empty.sq = TRUE
)

# 2/2 Fill in the matrice with external flow values
mat &lt;- flowcarre(var1, var2,
  origin = "i", dest = "j", valflow = "Fij",
  format = "M", empty.sq = FALSE
)

# Square a matrice and zero the main diagonal
mat &lt;- flowcarre(var1, var2,
  origin = "i", dest = "j", valflow = "Fij", format = "M",
  empty.sq = FALSE, diagonale = FALSE
)
</code></pre>

<hr>
<h2 id='flowcontig'>Builds an ordinal distance matrices from a spatial features background</h2><span id='topic+flowcontig'></span>

<h3>Description</h3>

<p>From a layer of areal spatial features, compute an ordinal distance matrice
based on a k order criterion of adjacency or contiguity between origin and destination places . <br />
The result is a neighbourhood graph that can be used for filtering flow values before flow mapping (<a href="#topic+flowmap">flowmap</a>)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>flowcontig(bkg, code, k, algo)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="flowcontig_+3A_bkg">bkg</code></td>
<td>
<p>a layer of areal spatial features (eg. the map background)</p>
</td></tr>
<tr><td><code id="flowcontig_+3A_code">code</code></td>
<td>
<p>spatial areal features code</p>
</td></tr>
<tr><td><code id="flowcontig_+3A_k">k</code></td>
<td>
<p>order of adjacency or contiguity between two areal spatial features</p>
</td></tr>
<tr><td><code id="flowcontig_+3A_algo">algo</code></td>
<td>
<p>algorithm to use for ordinal distance calculation. Default is &quot;Dijkstra's&quot;  algorithm. See Details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The (k=1,2,...,k) order of adjacency or contiguity, of an areal spatial features
background, is the number of spatial boundaries to be crossed between
a couple of origin-destination (ODs) places. The k number can be assimilated to a shortest path between two pair of nodes
Argument 'k' is to enter the number k of the contiguity matrix to be constructed ;<br />
-ordre=1 : ODs places are adjacent, ie the flow have to cross only 1 boundary<br />
-ordre=2 : ODs places are distant from 2 borders<br />
-ordre=k : ODs places are distant from k borders<br />
The function returns also the (k) number of the layer
</p>


<h3>Value</h3>

<p>a contiguity matrice with the k orders of adjacency
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(cartograflow)
library(sf)
data(flowdata)
map &lt;- st_read(system.file("shape/MGP_TER.shp", package = "cartograflow"))
graph_ckij_1 &lt;- flowcontig(bkg = map, code = "EPT_NUM", k = 1, algo = "automatic")

flowmap(
  tab = graph_ckij_1,
  fij = "ordre", origin.f = "i", destination.f = "j",
  bkg = map, code = "EPT_NUM", nodes.X = "X", nodes.Y = "Y",
  filter = FALSE
)

</code></pre>

<hr>
<h2 id='flowdist'>Builds a continuous distance matrices from a spatial features background</h2><span id='topic+flowdist'></span>

<h3>Description</h3>

<p>From a layer of areal spatial features, compute and threshold a continuous distance matrix.
The result is either a matrice of distances between ODs, or a flow matrix based on the distance travelled between ODs ; both can be used for filtering flow before flow mapping (<a href="#topic+flowmap">flowmap</a>)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>flowdist(tab, dist.method, result)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="flowdist_+3A_tab">tab</code></td>
<td>
<p>the input flow dataset</p>
</td></tr>
<tr><td><code id="flowdist_+3A_dist.method">dist.method</code></td>
<td>
<p>distance calculation algorithm, default is euclidian calculation</p>
</td></tr>
<tr><td><code id="flowdist_+3A_result">result</code></td>
<td>
<p>Choose Building a &quot;flowdist&quot; or a simple &quot;dist&quot; matrice. See Details</p>
</td></tr>
</table>


<h3>Details</h3>

<p>&ndash; result = &quot;dist&quot; is the simple resulting distance matrice.<br />
&ndash; result = &quot;flowdist&quot; is the resulting distance matrice with additional calculated parameters.<br />
&ndash; It is also possible to filter flow by a level of distance travelled.
</p>


<h3>Value</h3>

<p>(1) A flowdata set with continuous  distances calculations. See dist.method parameter
</p>
<p>(2) A flowdata set with movement from euclidian distances calculations
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(cartograflow)
library(sf)
data(flowdata)
map &lt;- st_read(system.file("shape/MGP_TER.shp", package = "cartograflow"))
tabflow &lt;- flowjointure(
  geom = "area", bkg = map, DF.flow = flows, origin = "i",
  destination = "j", id = "EPT_NUM", x = "X", y = "Y"
)

# Format long with only origin, destination and distance parameters:
tab.distance &lt;- flowdist(tabflow, dist.method = "euclidian", result = "dist")
# Format long with with all parameters: coordinates, distance, mouvement
tab.distance &lt;- flowdist(tabflow, dist.method = "euclidian", result = "flowdist")
</code></pre>

<hr>
<h2 id='flowgini'>Analysis of flow concentration (Gini coefficient)</h2><span id='topic+flowgini'></span>

<h3>Description</h3>

<p>Calculates Gini coefficient, plot Lorenz curve and
threshold the matrice according to a global concentration criterion
for mapping flow intensity or flow density.<br />
To be use before <a href="#topic+flowanalysis">flowanalysis</a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>flowgini(ODpts, origin, destination, valflow, lorenz.plot)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="flowgini_+3A_odpts">ODpts</code></td>
<td>
<p>the input  dataset with : nodes code, flow values and XY coordinates</p>
</td></tr>
<tr><td><code id="flowgini_+3A_origin">origin</code></td>
<td>
<p>ID origin place, in long format</p>
</td></tr>
<tr><td><code id="flowgini_+3A_destination">destination</code></td>
<td>
<p>ID destination place, long format</p>
</td></tr>
<tr><td><code id="flowgini_+3A_valflow">valflow</code></td>
<td>
<p>flow value between origin and destination places</p>
</td></tr>
<tr><td><code id="flowgini_+3A_lorenz.plot">lorenz.plot</code></td>
<td>
<p>to plot or the Lorenz curve. See Details</p>
</td></tr>
</table>


<h3>Details</h3>

<p>flowgini(...,lorenz.plot = TRUE) for ploting Lorenz curve  associate to the gini coefficient, from cumulated flows and links.
</p>


<h3>Value</h3>

<p>plot Lorenz curve for the cumulated flow and links : flowgini(...,gini.plot = TRUE),warning : the function must be not assign a variable
</p>
<p>value of the Gini's coefficent and the table : table&lt;-flowgini(...,missing(gini.plot) or gini.plot = FALSE )
</p>


<h3>References</h3>

<p>Bahoken Françoise, 2016,« La cartographie d’une sélection globale de flux, entre ‘significativité’ et ‘densité’ »,
Netcom Online, 30-3/4 | 2016, Online since 23 March 2017, connection on 05 May 2019. URL : http://journals.openedition.org/netcom/2565 ;
DOI : 10.4000/netcom.2565. <br />
Grasland Claude, 2014, &quot;Flows analysis carto&quot;, unpublished R functions.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(cartograflow)
data(flowdata)
# Computes Gini's coefficent
tabgini &lt;- flowgini(ODpts = flows, origin = "i", destination = "j",
                     valflow = "Fij", lorenz.plot = FALSE)
# Plot Lorenz curve
flowgini(ODpts = flows, origin = "i", dest = "j", valflow = "Fij", lorenz.plot = TRUE)
# See \link{flowanalysis} for viewing the tab_gini table
</code></pre>

<hr>
<h2 id='flowjointure'>Builds a spatial join with a flow dataset</h2><span id='topic+flowjointure'></span>

<h3>Description</h3>

<p>Builds a spatial join between a flow dataset and a
spatial features layer (as a map background)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>flowjointure(geom, bkg, DF.flow, origin, destination, DF.point, id, x, y)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="flowjointure_+3A_geom">geom</code></td>
<td>
<p>the geometry of the spatial features layer: points or areas</p>
</td></tr>
<tr><td><code id="flowjointure_+3A_bkg">bkg</code></td>
<td>
<p>the spatial features layer</p>
</td></tr>
<tr><td><code id="flowjointure_+3A_df.flow">DF.flow</code></td>
<td>
<p>the input flow dataset as a dataframe</p>
</td></tr>
<tr><td><code id="flowjointure_+3A_origin">origin</code></td>
<td>
<p>the place of origin code</p>
</td></tr>
<tr><td><code id="flowjointure_+3A_destination">destination</code></td>
<td>
<p>the place of destination code</p>
</td></tr>
<tr><td><code id="flowjointure_+3A_df.point">DF.point</code></td>
<td>
<p>a dataframe of points or places</p>
</td></tr>
<tr><td><code id="flowjointure_+3A_id">id</code></td>
<td>
<p>dataframe of points or places file code</p>
</td></tr>
<tr><td><code id="flowjointure_+3A_x">x</code></td>
<td>
<p>the X coordinate of the point or places</p>
</td></tr>
<tr><td><code id="flowjointure_+3A_y">y</code></td>
<td>
<p>the Y coordinate of the point or places</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the corresponding joint table between the flow dataset and the
spatial feature layer
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(cartograflow)
library(sf)
data(flowdata)
map &lt;- st_read(system.file("shape/MGP_TER.shp", package = "cartograflow"))
tabflow &lt;- flowjointure(
  geom = "area", bkg = map, DF.flow = flows, origin = "i", destination = "j",
  id = "EPT_NUM", x = "X", y = "Y"
)
</code></pre>

<hr>
<h2 id='flowlowup'>Extracts the triangular sub-matrix of flows</h2><span id='topic+flowlowup'></span>

<h3>Description</h3>

<p>Extracts the upper or lower triangular part of a matrix
</p>


<h3>Usage</h3>

<pre><code class='language-R'>flowlowup(tab, origin = NULL, destination = NULL, fij = NULL, lowup, format, x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="flowlowup_+3A_tab">tab</code></td>
<td>
<p>is the input flow dataset</p>
</td></tr>
<tr><td><code id="flowlowup_+3A_origin">origin</code></td>
<td>
<p>the place of origin code</p>
</td></tr>
<tr><td><code id="flowlowup_+3A_destination">destination</code></td>
<td>
<p>the place of destination code</p>
</td></tr>
<tr><td><code id="flowlowup_+3A_fij">fij</code></td>
<td>
<p>the flow value between origin and destination places</p>
</td></tr>
<tr><td><code id="flowlowup_+3A_lowup">lowup</code></td>
<td>
<p>for selecting lower or upper triangular sub-portion of the original matrix. See Details.</p>
</td></tr>
<tr><td><code id="flowlowup_+3A_format">format</code></td>
<td>
<p>specify the flow dataset format, &quot;M &quot; for square matrix [n*n] or &quot;L&quot; for long [i,j,data]</p>
</td></tr>
<tr><td><code id="flowlowup_+3A_x">x</code></td>
<td>
<p>enter the Enter the triangular part to be extracted: &quot;low&quot;, &quot;up&quot;. See Details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function compute for all pairs or origin-destination places (i,j)
a lower &quot;low&quot; or upper &quot;up&quot; triangular sub-portion of the original matrix
- x = &quot;up&quot;  for the part above the main diagonal <br />
- x = &quot;low&quot; for the part below the main diagonal<br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(cartograflow)
data(flowdata)

###Extract the upper part of the matrix : Long format
tab_up &lt;- flowlowup(flows, format="L", lowup="up")
tab_low&lt;-flowlowup(flows, format="L", lowup="low")

</code></pre>

<hr>
<h2 id='flowmap'>Mapping of an origin-destination flow matrix</h2><span id='topic+flowmap'></span>

<h3>Description</h3>

<p>Mapping of an origin-destination flow matrix
</p>


<h3>Usage</h3>

<pre><code class='language-R'>flowmap(
  tab,
  fij,
  origin.f,
  destination.f,
  bkg = NULL,
  crs,
  nodes = NULL,
  code,
  nodes.X,
  nodes.Y,
  filter,
  plota,
  threshold,
  taille,
  a.head,
  a.length,
  a.angle,
  a.col,
  add = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="flowmap_+3A_tab">tab</code></td>
<td>
<p>the input flow dataset in .csv format. See Details</p>
</td></tr>
<tr><td><code id="flowmap_+3A_fij">fij</code></td>
<td>
<p>the flow value between origin and destination places</p>
</td></tr>
<tr><td><code id="flowmap_+3A_origin.f">origin.f</code></td>
<td>
<p>the place of origin code</p>
</td></tr>
<tr><td><code id="flowmap_+3A_destination.f">destination.f</code></td>
<td>
<p>the place of destination code</p>
</td></tr>
<tr><td><code id="flowmap_+3A_bkg">bkg</code></td>
<td>
<p>a spatial feature layer, as a map background, in .shp or .json or other format</p>
</td></tr>
<tr><td><code id="flowmap_+3A_crs">crs</code></td>
<td>
<p>the coordinate reference system (CRS)</p>
</td></tr>
<tr><td><code id="flowmap_+3A_nodes">nodes</code></td>
<td>
<p>the input points file in .csv format</p>
</td></tr>
<tr><td><code id="flowmap_+3A_code">code</code></td>
<td>
<p>the spatial features code</p>
</td></tr>
<tr><td><code id="flowmap_+3A_nodes.x">nodes.X</code></td>
<td>
<p>the X coordinate of the point or places</p>
</td></tr>
<tr><td><code id="flowmap_+3A_nodes.y">nodes.Y</code></td>
<td>
<p>the Y coordinate of the point or places</p>
</td></tr>
<tr><td><code id="flowmap_+3A_filter">filter</code></td>
<td>
<p>is to filter or not the flow values. See details</p>
</td></tr>
<tr><td><code id="flowmap_+3A_plota">plota</code></td>
<td>
<p>is to add spatial features as map background to the flows's plot</p>
</td></tr>
<tr><td><code id="flowmap_+3A_threshold">threshold</code></td>
<td>
<p>the value of the threshold criterion to filter flows. Default is 1.</p>
</td></tr>
<tr><td><code id="flowmap_+3A_taille">taille</code></td>
<td>
<p>the value of the width of the flow feature</p>
</td></tr>
<tr><td><code id="flowmap_+3A_a.head">a.head</code></td>
<td>
<p>for arrow's head is the arrow head parameter code.
It allows to choose the kind of arrow. See Details</p>
</td></tr>
<tr><td><code id="flowmap_+3A_a.length">a.length</code></td>
<td>
<p>for arrow's length is the length of the edges of the arrow head (in inches)</p>
</td></tr>
<tr><td><code id="flowmap_+3A_a.angle">a.angle</code></td>
<td>
<p>for arrow's angle is the angle from the shaft of the arrow to the edge of the arrow head</p>
</td></tr>
<tr><td><code id="flowmap_+3A_a.col">a.col</code></td>
<td>
<p>for arrow's color</p>
</td></tr>
<tr><td><code id="flowmap_+3A_add">add</code></td>
<td>
<p>is to allow to overlay flow features on external spatial features background</p>
</td></tr>
<tr><td><code id="flowmap_+3A_...">...</code></td>
<td>
<p>Adds the set of variables of the arrow function</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The input .csv flow dataset must be first converted to a dataframe
for optimal performance (troubles remains with tibble format)<br /> <br />
</p>
<p>- filter is &quot;FALSE&quot; means that all the flow value will be plot as segments [(n*(n-1)],
i.e. all the OD matrice's cells out of the main diagonal will be plot.<br />
- filter is &quot;TRUE&quot; means only non-zero values will be plot,
i.e. existing links with or without threshold.<br />
The default threshold is set to 1.<br />
</p>
<p>Flow features are plot as segments betwwen (x0,y0) and (x1,y1)<br />
- a.head is for applying an arrow or not to a segment:<br />
&ndash; code=&quot;0&quot; : the link has no head - no arrow<br />
&ndash; code=&quot;1&quot; : an arrow is draw at (x0[i], y0[i])<br />
&ndash; code=&quot;2&quot; : an arrow is draw at (x1[j], y1[j])<br />
&ndash; code=&quot;3&quot; : an arrow is draw at both nodes.<br />
</p>


<h3>Value</h3>

<p>a matrix or a list with the correct flow dataframe ID code
</p>
<p>The resulting flowmap
</p>


<h3>Examples</h3>

<pre><code class='language-R'>rm(list=ls())
library(cartograflow)
library(sf)
data(flowdata)
# example with the background
map &lt;- st_read(system.file("shape/MGP_TER.shp", package = "cartograflow"))
par(bg = "NA")
plot(st_geometry(map), col = "blue")
flowmap(
  tab = flows, fij = "Fij", origin.f = "i", destination.f = "j",
  bkg = map,add=TRUE, code = "EPT_NUM", nodes.X = "X", nodes.Y = "Y",
  filter = FALSE
)
</code></pre>

<hr>
<h2 id='flowplaces'>Computes flow indicators per places</h2><span id='topic+flowplaces'></span>

<h3>Description</h3>

<p>Compute indicators per places (origin and/or destination ) from the margins of the matrix. Ex/ in and out degrees, gross and net flows, asymmetry .... from an initial matrix
</p>


<h3>Usage</h3>

<pre><code class='language-R'>flowplaces(tab, origin = NULL, destination = NULL, fij = NULL, format, x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="flowplaces_+3A_tab">tab</code></td>
<td>
<p>is the input flow dataset</p>
</td></tr>
<tr><td><code id="flowplaces_+3A_origin">origin</code></td>
<td>
<p>the place of origin code</p>
</td></tr>
<tr><td><code id="flowplaces_+3A_destination">destination</code></td>
<td>
<p>the place of destination code</p>
</td></tr>
<tr><td><code id="flowplaces_+3A_fij">fij</code></td>
<td>
<p>the flow value between origin and destination places</p>
</td></tr>
<tr><td><code id="flowplaces_+3A_format">format</code></td>
<td>
<p>specify the flow dataset format, &quot;M &quot; for square matrix [n*n] or &quot;L&quot; for long [i,j,data]</p>
</td></tr>
<tr><td><code id="flowplaces_+3A_x">x</code></td>
<td>
<p>enter the flowplaces indicator type : &quot;allflowplaces&quot;, &quot;ini&quot;, &quot;outi&quot;, &quot;degi&quot;,&quot;intra&quot;, &quot;Oi&quot;, &quot;Dj&quot;, voli&quot;,&quot;bali&quot;,&quot;asyi&quot;. See Details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function compute for all pairs or origin-destination places (i,j)
a data table that describes the flows from the point of view of Origin / destination places
- x = &quot;ini&quot; for the number of incoming links (as in-degree) <br />
- x = &quot;outi&quot; for the number of outcoming links (as out-degree)<br />
- x = &quot;degi&quot; for the total number of links (as in and out degrees)<br />
- x = &quot;intra&quot; for total intra zonal interaction (if main diagonal is not empty<br />
- x = &quot;Dj&quot; for the total flows received by (j) place <br />
- x = &quot;voli&quot; for the total volume of flow per place <br />
- x = &quot;bali&quot; for the net balance of flow per place <br />
- x = &quot;asyi&quot; for the asymetry of flow per place <br />
- x = &quot;allflowplaces&quot; for computing all the above indicators<br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(cartograflow)
data(flowdata)
bkg &lt;- system.file("shape/MGP_TER.shp",
  package = "cartograflow",
  lib.loc = NULL, mustWork = TRUE)

###1:Computes the total flow volume of places : Long format
voli &lt;- flowplaces(flows, origin ="i",destination="j",fij="Fij",format = "L", x = "voli")
###2:Computes the total flows received by destination place : Long format
tab_bali &lt;- flowplaces(flows, origin ="i",destination="j",fij="Fij",format = "L", x = "bali")
</code></pre>

<hr>
<h2 id='flowreduct'>Flow matrix reduction according to another matrix</h2><span id='topic+flowreduct'></span>

<h3>Description</h3>

<p>Reduces a flow dataset according to an external matrix, eg. a matrix of travelled distance.<br /> 
Builds geographical movements,  by weighting a flow dataset according to a distance criterion.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>flowreduct(tab, tab.metric, metric, d.criteria, d)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="flowreduct_+3A_tab">tab</code></td>
<td>
<p>is the input flowdata set</p>
</td></tr>
<tr><td><code id="flowreduct_+3A_tab.metric">tab.metric</code></td>
<td>
<p>the distance dataset</p>
</td></tr>
<tr><td><code id="flowreduct_+3A_metric">metric</code></td>
<td>
<p>select &quot;continuous&quot; or &quot;ordinal&quot; metric. See Details</p>
</td></tr>
<tr><td><code id="flowreduct_+3A_d.criteria">d.criteria</code></td>
<td>
<p>is for selecting &quot;dmin&quot; or &quot;dmax&quot; distance criteria for &quot;continuous&quot; metric. See Details.</p>
</td></tr>
<tr><td><code id="flowreduct_+3A_d">d</code></td>
<td>
<p>is the value of the selected &quot;dmin&quot; or &quot;dmax&quot;. see Details</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The involved metric can be continous or not.<br />
</p>
<p>(1) Metric is 'continous&quot; for distance as euclidian, maximum, manhattan, etc.<br />
See <a href="#topic+flowdist">flowdist</a> <br />
- Metric is 'ordinal&quot; for computing neighbourhood ordinal distance matrix.
&ndash; Select =&quot;dmin&quot; for reducing flow dataset to flow values that are up or equal to the dmin distance parameter  (Fij&gt;=dmin);<br />
&ndash; select =&quot;dmax&quot; for reducing flow dataset to values that are less or equal to the dmax distance parameter(Fij=&lt;dmin).<br /> <br />
</p>
<p>- Metric is 'ordinal' for computing neighbourhood ordinal distance with k contiguity.<br />
See <a href="#topic+flowcontig">flowcontig</a> for computing ordinal distance matrix <br />
</p>


<h3>Value</h3>

<p>A flow dataset with distances computations and flow reduction
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(cartograflow)
library(sf)
library(dplyr)
data(flowdata)
map &lt;- st_read(system.file("shape/MGP_TER.shp", package = "cartograflow"))

tab &lt;- flowjointure(
  geom = "area", bkg = map, DF.flow = flows, origin = "i", destination = "j",
  id = "EPT_NUM", x = "X", y = "Y"
)

# Example for reducing a flow matrice with a distance matrice, in long format (i,j, distance)
## 1/2: Computes the matrice distances
tab.distance &lt;- flowdist(tab, dist.method = "euclidian", result = "dist")
tab.distance &lt;- tab.distance %&gt;% select(i, j, distance)
## 2/2: Reduce the flow matrice
tab.flow &lt;- flowreduct(flows, tab.distance,
  metric = "continous",
  d.criteria = "dmax", d = 8567
)
</code></pre>

<hr>
<h2 id='flows'>MOBPRO: Commuting trips in 2015</h2><span id='topic+flows'></span>

<h3>Description</h3>

<p>Statistical dataset in .csv:
<code>Extraction of the french national census : "Mobilités professionnelles en 2015 : déplacements domicile - lieu de travail"
- Base flux de mobilité - for the Greater Paris area.</code><br />
<code>Citation: INSEE - RP MOBPRO, 2015.</code><br />
<code>Variable (i) is the place of origin of the flow.</code><br />
<code>Variable (j) is the place of destination of the flow.</code><br />
<code>Variable (Fij) is the flow value between (i,j).</code><br />
<code>Variable (count) is the frequency of the (i,j) couple of places.</code><br />
</p>


<h3>Source</h3>

<p><a href="https://www.insee.fr/fr/statistiques/fichier/3566008/rp2015_mobpro_txt.zip">https://www.insee.fr/fr/statistiques/fichier/3566008/rp2015_mobpro_txt.zip</a>
</p>

<hr>
<h2 id='flowstructmat'>Structuring a matrix</h2><span id='topic+flowstructmat'></span>

<h3>Description</h3>

<p>Fixes an ID shift in the flow matrix (to bo use with <a href="#topic+flowjointure">flowjointure</a> if necessary and <a href="#topic+flowtabmat">flowtabmat</a>)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>flowstructmat(z)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="flowstructmat_+3A_z">z</code></td>
<td>
<p>The input flow dataset in the matrice format where the first column is filled with the ID</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A flow dataset with an usable format
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(cartograflow)
data(flowdata)

dim(mat_ex) # dimension fo the original matrice
### 10 11  # first colum is fill with the ID

tab &lt;- flowstructmat(mat_ex)
dim(tab)
## 10 10 # dimension fo the resulting matrice
</code></pre>

<hr>
<h2 id='flowtabmat'>Changing the format of a flow dataset</h2><span id='topic+flowtabmat'></span>

<h3>Description</h3>

<p>Transform a flow dataset from long to matrice format, and vice versa. 
Square matrice.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>flowtabmat(tab, matlist)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="flowtabmat_+3A_tab">tab</code></td>
<td>
<p>flow dasaset, in matrice or long format</p>
</td></tr>
<tr><td><code id="flowtabmat_+3A_matlist">matlist</code></td>
<td>
<p>choose &quot;matrice&quot; or &quot;long&quot; for the resulting format. See Details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>- matlist=&quot;M&quot; from long (3 columns : origin, destination, flow) to matrice format [n*n];<br />
- matlist=&quot;L&quot; from matrice to long format.
</p>


<h3>Value</h3>

<p>a flow dataset in matrice or in long format
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(cartograflow)
data(flowdata)
# 1: From long to matrix format (n*m)
matFlow &lt;- flowtabmat(flows, matlist = "M")
# 2: From matrix to long format [i,j,Fij]
listflow &lt;- flowtabmat(matFlow, matlist = "L")
</code></pre>

<hr>
<h2 id='flowtype'>Compute bilateral several flow types</h2><span id='topic+flowtype'></span>

<h3>Description</h3>

<p>Compute bilateral flow type: volumn (gross), balance (net), asymetry, min/max ... from an initial asymetric matrix
</p>


<h3>Usage</h3>

<pre><code class='language-R'>flowtype(
  tab,
  origin = NULL,
  destination = NULL,
  fij = NULL,
  format,
  lowup,
  net,
  x
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="flowtype_+3A_tab">tab</code></td>
<td>
<p>is the input flow dataset</p>
</td></tr>
<tr><td><code id="flowtype_+3A_origin">origin</code></td>
<td>
<p>the place of origin code</p>
</td></tr>
<tr><td><code id="flowtype_+3A_destination">destination</code></td>
<td>
<p>the place of destination code</p>
</td></tr>
<tr><td><code id="flowtype_+3A_fij">fij</code></td>
<td>
<p>the flow value between origin and destination places</p>
</td></tr>
<tr><td><code id="flowtype_+3A_format">format</code></td>
<td>
<p>specify the flow dataset format, &quot;M &quot; for square matrix [n*n] or L for long [i,j,data]</p>
</td></tr>
<tr><td><code id="flowtype_+3A_lowup">lowup</code></td>
<td>
<p>for extracting the lower or upper triangular sub-portion of the bilateral volum matrix. See Details.</p>
</td></tr>
<tr><td><code id="flowtype_+3A_net">net</code></td>
<td>
<p>for extracting the &quot;positive&quot; or the &quot;negative&quot; flow values of the bilateral balance) matrix</p>
</td></tr>
<tr><td><code id="flowtype_+3A_x">x</code></td>
<td>
<p>enter the flow indicator type : &quot;alltypes&quot;, &quot;flux&quot;, &quot;transpose&quot;, &quot;bivolum&quot;, &quot;bibal&quot;,&quot;biasym&quot;,&quot;bimin&quot;, &quot;bimax&quot;,&quot;birange&quot; and &quot;bidisym&quot;</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The matrice must be squared (if not, see <a href="#topic+flowcarre">flowcarre</a>).
This function compute for all pairs or origin-destination places (i,j)
involved in an asymetric flow matrix (Fij&lt;&gt; Fji) several matrix :<br />
Param x:
- x = &quot;flux&quot; for the initial flow: (Fij)<br />
- x = &quot;transpose&quot; for the reverse flow value: (Fji) =t(Fij)<br />
- x = &quot;bivolum&quot; for the bilateral volum or gross flow: FSij=(Fij+Fji)<br />
- x = &quot;bibal&quot; for the bilateral balance or net flow: FBij=(Fij-Fji) <br />
- x = &quot;biasym&quot; for asymetry of bilateral flow: FAij=(FBij/FSij)<br />
- x = &quot;bimin&quot; for the minimum of bilateral flow: minFij=(Fij, Fji)<br />
- x = &quot;bimax&quot; for the maximum of bilateral flow: Fij(Fij, Fji)<br />
- x = &quot;birange&quot; for the amplitude of bilateral flows: rangeFij=(maxFij - minFij)<br />
- x = &quot;bidisym&quot; for the bilateral disymetry: FDij=(rangeFij/FSij)
- x = &quot;alltypes&quot; for computing all the available types of flows <br />
Param lowup is for reducing the matrix:<br />
- lowup =&quot;up&quot; for triangular part above the main diagonal <br />
- lowup = &quot;low&quot; for triangular part below the main diagonal<br />
Param net is for extracting positive or negative flow values of the bilateral balance (bibal matrix):<br />
- net =&quot;negative&quot; values<br />
- net =&quot;positive&quot; values<br />
</p>


<h3>References</h3>

<p>Bahoken Francoise, 2016, L'approche cartographique de la décomposition des matrices de flux,
Mappemonde, Revue sur l'image géographique et les formes du territoire,
number 116, URL : https://mappemonde-archive.mgm.fr/num44/articles/art14404.html
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(cartograflow)
data(flowdata)
bkg &lt;- system.file("shape/MGP_TER.shp",package = "cartograflow",
                  lib.loc = NULL, mustWork = TRUE
)

## 1a:Computes flowtypes: Matrix format
matflow &lt;- flowtabmat(flows, matlist = "M")
m &lt;- flowtype(matflow, format = "M", x = "flux")
m &lt;- flowtype(matflow, format = "M", x = "transpose")
m &lt;- flowtype(matflow, format = "M", x = "bivolum")
m &lt;- flowtype(matflow, format = "M", x = "bibal")

## 1b:Computes flowtypes: Long format
types_all &lt;- flowtype(flows,origin ="i",destination="j",fij="Fij", format = "L",
x = "alltypes")
bivol&lt;- flowtype(flows,origin ="i",destination="j",fij="Fij",format = "L",
x = "bivolum",lowup="up")
bibal_net&lt;- flowtype(flows,origin ="i",destination="j",fij="Fij",format = "L",
x = "bibal", net="negative")
</code></pre>

<hr>
<h2 id='geoid'>Geographical ID</h2><span id='topic+geoid'></span>

<h3>Description</h3>

<p><code>One column dataframe in.csv.</code><br />
<code>Variable (COD_GEO_EPT) is the geographical code of the territory</code><br />
<code>citation : APUR, 2018</code>
</p>


<h3>Source</h3>

<p><a href="https://www.insee.fr/fr/statistiques/fichier/3566008/rp2015_mobpro_txt.zip">https://www.insee.fr/fr/statistiques/fichier/3566008/rp2015_mobpro_txt.zip</a>
</p>

<hr>
<h2 id='mat_ex'>Example of a small matrice</h2><span id='topic+mat_ex'></span>

<h3>Description</h3>

<p>Example of a small Origin-Destination flow dataset, in a matrice format
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
