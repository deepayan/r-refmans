<!DOCTYPE html><html lang="en"><head><title>Help for package ecmwfr</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ecmwfr}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#print.ecmwfr_archetype'><p>Methods to deal with visualizing / printing</p>
requesting info from the archetype constructor</a></li>
<li><a href='#wf_archetype'><p>Creates an archetype function</p></a></li>
<li><a href='#wf_check_request'><p>check ECMWF / CDS data requests</p></a></li>
<li><a href='#wf_dataset_info'><p>List ECMWF Data Store dataset information</p></a></li>
<li><a href='#wf_datasets'><p>List ECMWF Data Store dataset</p></a></li>
<li><a href='#wf_delete'><p>Delete ECMWF Data Store request</p></a></li>
<li><a href='#wf_get_key'><p>Get secret ECMWF / CDS token</p></a></li>
<li><a href='#wf_request'><p>ECMWF Data Store (DS) request and download</p></a></li>
<li><a href='#wf_set_key'><p>Set secret ECMWF token</p></a></li>
<li><a href='#wf_transfer'><p>ECMWF data transfer function</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Interface to 'ECMWF' and 'CDS' Data Web Services</td>
</tr>
<tr>
<td>Version:</td>
<td>2.0.3</td>
</tr>
<tr>
<td>Description:</td>
<td>Programmatic interface to the European Centre for Medium-Range
    Weather Forecasts dataset web services (ECMWF; <a href="https://www.ecmwf.int/">https://www.ecmwf.int/</a>)
    and Copernicus's Data Stores. Allows for easy downloads of weather 
    forecasts and climate reanalysis data in R. Data stores covered include the Climate Data Store (CDS; 
    <a href="https://cds.climate.copernicus.eu">https://cds.climate.copernicus.eu</a>), Atmosphere Data Store (ADS; 
    <a href="https://ads.atmosphere.copernicus.eu">https://ads.atmosphere.copernicus.eu</a>) and Early Warning Data Store (CEMS; 
    <a href="https://ewds.climate.copernicus.eu">https://ewds.climate.copernicus.eu</a>).</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/bluegreen-labs/ecmwfr">https://github.com/bluegreen-labs/ecmwfr</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/bluegreen-labs/ecmwfr/issues">https://github.com/bluegreen-labs/ecmwfr/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.2)</td>
</tr>
<tr>
<td>Imports:</td>
<td>httr, memoise, getPass, R6, keyring, tools</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/AGPL-3">AGPL-3</a></td>
</tr>
<tr>
<td>ByteCompile:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>Suggests:</td>
<td>rmarkdown, covr, xml2, testthat, terra, maps, ncdf4, knitr,
rlang, rstudioapi, jsonlite</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-02-10 11:28:47 UTC; khufkens</td>
</tr>
<tr>
<td>Author:</td>
<td>Koen Hufkens <a href="https://orcid.org/0000-0002-5070-8109"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre, cph],
  Reto Stauffer <a href="https://orcid.org/0000-0002-3798-5507"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Elio Campitelli <a href="https://orcid.org/0000-0002-7742-9230"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  BlueGreen Labs [fnd]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Koen Hufkens &lt;koen.hufkens@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-02-10 12:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='print.ecmwfr_archetype'>Methods to deal with visualizing / printing
requesting info from the archetype constructor</h2><span id='topic+print.ecmwfr_archetype'></span>

<h3>Description</h3>

<p>Methods to deal with visualizing / printing
requesting info from the archetype constructor
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ecmwfr_archetype'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.ecmwfr_archetype_+3A_x">x</code></td>
<td>
<p>archetype object</p>
</td></tr>
<tr><td><code id="print.ecmwfr_archetype_+3A_...">...</code></td>
<td>
<p>additional parameters to pass on</p>
</td></tr>
</table>

<hr>
<h2 id='wf_archetype'>Creates an archetype function</h2><span id='topic+wf_archetype'></span>

<h3>Description</h3>

<p>Creates a universal MARS / CDS formatting function, in ways
similar to <code>wf_modify_request()</code> but the added advantage
that you could code for the use of dynamic changes in the
parameters provided to the resulting custom function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wf_archetype(request, dynamic_fields)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="wf_archetype_+3A_request">request</code></td>
<td>
<p>a MARS or CDS request as an R list object.</p>
</td></tr>
<tr><td><code id="wf_archetype_+3A_dynamic_fields">dynamic_fields</code></td>
<td>
<p>character vector of fields that could be changed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Contrary to a simple replacement as in <code>wf_modify_request()</code> the
generated functions are considered custom user written. Given the potential
for complex formulations and formatting commands NO SUPPORT for the
resulting functions can be provided. Only the generation of a valid function
will be guaranteed and tested for.
</p>


<h3>Value</h3>

<p>a function that takes 'dynamic_fields' as arguments and returns a
request as an R list object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

ERA &lt;- wf_archetype(
  request = list(
    dataset_short_name = "reanalysis-era5-pressure-levels",
    product_type = "reanalysis",
    variable = "geopotential",
    year = "2024",
    month = "03",
    day = "01",
    time = "13:00",
    pressure_level = "1000",
    data_format = "grib",
    target = "download.grib"
  ),
    dynamic_fields = c("year", "day", "target")
  )
# print output of the function with below (new) parameters
str(ERA(2021, 3, "new_download.grip"))


## End(Not run)
</code></pre>

<hr>
<h2 id='wf_check_request'>check ECMWF / CDS data requests</h2><span id='topic+wf_check_request'></span>

<h3>Description</h3>

<p>Check the validity of a data request by comparing the main dataset
to the list provided by <code><a href="#topic+wf_datasets">wf_datasets</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wf_check_request(request)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="wf_check_request_+3A_request">request</code></td>
<td>
<p>nested list with query parameters following the layout
as specified on the ECMWF API page</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a data frame with the determined service and url service endpoint
</p>


<h3>Author(s)</h3>

<p>Koen Hufkens
</p>


<h3>See Also</h3>

<p><code><a href="#topic+wf_set_key">wf_set_key</a></code>
<code><a href="#topic+wf_transfer">wf_transfer</a></code>,<code><a href="#topic+wf_request">wf_request</a></code>,
<code><a href="#topic+wf_transfer">wf_transfer</a></code>
</p>

<hr>
<h2 id='wf_dataset_info'>List ECMWF Data Store dataset information</h2><span id='topic+wf_dataset_info'></span>

<h3>Description</h3>

<p>Shows and returns detailed product information about a specific data set
(see <code><a href="#topic+wf_datasets">wf_datasets</a></code>). This includes the list of
sub-products in the collection as well as date and time ranges.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wf_dataset_info(dataset, simplify = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="wf_dataset_info_+3A_dataset">dataset</code></td>
<td>
<p>character, name of the data set for which the product
information should be loaded</p>
</td></tr>
<tr><td><code id="wf_dataset_info_+3A_simplify">simplify</code></td>
<td>
<p>boolean, default <code>TRUE</code>. If <code>TRUE</code> the description
will be returned as tidy data instead of a nested list.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Downloads a tidy data frame with product descriptions from CDS. If
<code>simplify = FALSE</code> a list with product details will be returned.
</p>


<h3>Author(s)</h3>

<p>Reto Stauffer, Koen Hufkens
</p>


<h3>See Also</h3>

<p><code><a href="#topic+wf_datasets">wf_datasets</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
 # Return information
 info &lt;- wf_dataset_info("reanalysis-era5-single-levels")
 names(info)

## End(Not run)
</code></pre>

<hr>
<h2 id='wf_datasets'>List ECMWF Data Store dataset</h2><span id='topic+wf_datasets'></span>

<h3>Description</h3>

<p>Returns a list of all ECMWF datasets, covering all Data Store services
(i.e. CDS, ADS, CEMS). This function is used to validate the datasets
queried by <code><a href="#topic+wf_request">wf_request</a></code>. For optimization reasons
and limit API calls the function is cached and only called once per
session (assuming that available products and their information and
endpoints aren't updated on a regular sub-daily basis).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wf_datasets(service = c("cds", "ads", "cems"), simplify = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="wf_datasets_+3A_service">service</code></td>
<td>
<p>which service to use, one of <code>webapi</code>, <code>cds</code>
or <code>ads</code> (default = webapi)</p>
</td></tr>
<tr><td><code id="wf_datasets_+3A_simplify">simplify</code></td>
<td>
<p>simplify the output, logical (default = <code>TRUE</code>). When
not simplified the raw API return is provided as a nested list, for debugging
purposes  mostly.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>returns a data frame with the ECMWF Data Store datasets
</p>


<h3>Author(s)</h3>

<p>Koen Hufkens
</p>


<h3>See Also</h3>

<p><code><a href="#topic+wf_transfer">wf_transfer</a></code>
<code><a href="#topic+wf_request">wf_request</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
# get a list of ECMWF Data Store datasets
wf_datasets()

## End(Not run)
</code></pre>

<hr>
<h2 id='wf_delete'>Delete ECMWF Data Store request</h2><span id='topic+wf_delete'></span>

<h3>Description</h3>

<p>Deletes a staged download from the queue when not using R6 methods.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wf_delete(url, user = "ecmwfr", verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="wf_delete_+3A_url">url</code></td>
<td>
<p>url to query</p>
</td></tr>
<tr><td><code id="wf_delete_+3A_user">user</code></td>
<td>
<p>user, generally not set (default = &quot;ecmwfr&quot;), used by <code><a href="#topic+wf_set_key">wf_set_key</a></code></p>
</td></tr>
<tr><td><code id="wf_delete_+3A_verbose">verbose</code></td>
<td>
<p>show feedback on processing</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Koen Hufkens
</p>


<h3>See Also</h3>

<p><code><a href="#topic+wf_set_key">wf_set_key</a></code>
<code><a href="#topic+wf_transfer">wf_transfer</a></code>
<code><a href="#topic+wf_request">wf_request</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 

# demo query using a valid request (not shown)
file &lt;- wf_request(request = request)

# delete request
job_url &lt;- file$get_url()
wf_delete(url = job_url)

## End(Not run)
</code></pre>

<hr>
<h2 id='wf_get_key'>Get secret ECMWF / CDS token</h2><span id='topic+wf_get_key'></span>

<h3>Description</h3>

<p>Returns you token set by <code><a href="#topic+wf_set_key">wf_set_key</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wf_get_key(user = "ecmwfr")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="wf_get_key_+3A_user">user</code></td>
<td>
<p>user (email address) used to sign up for the ECMWF data service</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the key set using <code><a href="#topic+wf_set_key">wf_set_key</a></code> saved
in the keychain
</p>


<h3>Author(s)</h3>

<p>Koen Hufkens
</p>


<h3>See Also</h3>

<p><code><a href="#topic+wf_set_key">wf_set_key</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
# set key
wf_set_key(key = "123")

# get key
wf_get_key()

## End(Not run)
</code></pre>

<hr>
<h2 id='wf_request'>ECMWF Data Store (DS) request and download</h2><span id='topic+wf_request'></span><span id='topic+wf_request_batch'></span>

<h3>Description</h3>

<p>Stage a data request, and optionally download the data to disk. Alternatively
you can only stage requests, logging the request URLs to submit download
queries later on using <code><a href="#topic+wf_transfer">wf_transfer</a></code>.
Note that the function will do some basic checks on the <code>request</code> input
to identify possible problems.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wf_request(
  request,
  user = "ecmwfr",
  transfer = TRUE,
  path = tempdir(),
  time_out = 3600,
  retry = 30,
  job_name,
  verbose = TRUE
)

wf_request_batch(
  request_list,
  workers = 2,
  user = "ecmwfr",
  path = tempdir(),
  time_out = 3600,
  retry = 5,
  total_timeout = length(request_list) * time_out/workers
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="wf_request_+3A_request">request</code></td>
<td>
<p>nested list with query parameters following the layout
as specified on the ECMWF APIs page</p>
</td></tr>
<tr><td><code id="wf_request_+3A_user">user</code></td>
<td>
<p>user (default = &quot;ecmwf&quot;) provided by the ECMWF data service,
used to retrieve the token set by <code><a href="#topic+wf_set_key">wf_set_key</a></code></p>
</td></tr>
<tr><td><code id="wf_request_+3A_transfer">transfer</code></td>
<td>
<p>logical, download data TRUE or FALSE (default = TRUE)</p>
</td></tr>
<tr><td><code id="wf_request_+3A_path">path</code></td>
<td>
<p>path were to store the downloaded data</p>
</td></tr>
<tr><td><code id="wf_request_+3A_time_out">time_out</code></td>
<td>
<p>how long to wait on a download to start (default =
<code>3600</code> seconds).</p>
</td></tr>
<tr><td><code id="wf_request_+3A_retry">retry</code></td>
<td>
<p>polling frequency of submitted request for downloading (default =
<code>30</code> seconds).</p>
</td></tr>
<tr><td><code id="wf_request_+3A_job_name">job_name</code></td>
<td>
<p>optional name to use as an RStudio job and as output variable
name. It has to be a syntactically valid name.</p>
</td></tr>
<tr><td><code id="wf_request_+3A_verbose">verbose</code></td>
<td>
<p>show feedback on processing</p>
</td></tr>
<tr><td><code id="wf_request_+3A_request_list">request_list</code></td>
<td>
<p>a list of requests that will be processed in parallel.</p>
</td></tr>
<tr><td><code id="wf_request_+3A_workers">workers</code></td>
<td>
<p>maximum number of simultaneous request that will be submitted
to the service. Most ECMWF services are limited to 20 concurrent requests
(default = 2).</p>
</td></tr>
<tr><td><code id="wf_request_+3A_total_timeout">total_timeout</code></td>
<td>
<p>overall timeout limit for all the requests in seconds.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the path of the downloaded (requested file) or the an R6 object
with download/transfer information
</p>


<h3>Author(s)</h3>

<p>Koen Hufkens
</p>


<h3>See Also</h3>

<p><code><a href="#topic+wf_set_key">wf_set_key</a></code>
<code><a href="#topic+wf_transfer">wf_transfer</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
# set key
wf_set_key(key = "123")

request &lt;- list(
  dataset_short_name = "reanalysis-era5-pressure-levels",
  product_type = "reanalysis",
  variable = "geopotential",
  year = "2024",
  month = "03",
  day = "01",
  time = "13:00",
  pressure_level = "1000",
  data_format = "grib",
  target = "download.grib"
)

# demo query
wf_request(request = request)

# Run as an RStudio Job. When finished, will create a
# variable named "test" in your environment with the path to
# the downloaded file.
wf_request(request = request, job_name = "test")

## End(Not run)
</code></pre>

<hr>
<h2 id='wf_set_key'>Set secret ECMWF token</h2><span id='topic+wf_set_key'></span>

<h3>Description</h3>

<p>Saves the token to your local keychain under
a service called &quot;ecmwfr&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wf_set_key(key, user = "ecmwfr")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="wf_set_key_+3A_key">key</code></td>
<td>
<p>token provided by ECMWF</p>
</td></tr>
<tr><td><code id="wf_set_key_+3A_user">user</code></td>
<td>
<p>user (email address) used to sign up for the ECMWF data service,
if only a single user is needed it defaults to (&quot;ecmwfr&quot;).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In systems without keychain management set the option
keyring_backend to 'file' (i.e. options(keyring_backend = &quot;file&quot;))
in order to write the keychain entry to an encrypted file.
This mostly pertains to headless Linux systems. The keychain files
can be found in ~/.config/r-keyring.
</p>


<h3>Value</h3>

<p>It invisibly returns the user.
</p>


<h3>Author(s)</h3>

<p>Koen Hufkens
</p>


<h3>See Also</h3>

<p><code><a href="#topic+wf_get_key">wf_get_key</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
# set key
wf_set_key(key = "123")

# get key
wf_get_key()

# leave user and key empty to open a browser window to the service's website
# and type the key interactively
wf_set_key()


## End(Not run)
</code></pre>

<hr>
<h2 id='wf_transfer'>ECMWF data transfer function</h2><span id='topic+wf_transfer'></span>

<h3>Description</h3>

<p>Returns the contents of the requested url as a (NetCDF) file downloaded
to disk or the current status of the requested transfer.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wf_transfer(
  url,
  user = "ecmwfr",
  path = tempdir(),
  filename = tempfile("ecmwfr_", tmpdir = ""),
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="wf_transfer_+3A_url">url</code></td>
<td>
<p>R6 <code><a href="#topic+wf_request">wf_request</a></code>) query output or API endpoint</p>
</td></tr>
<tr><td><code id="wf_transfer_+3A_user">user</code></td>
<td>
<p>user (email address) used to sign up for the ECMWF data service,
used to retrieve the token set by <code><a href="#topic+wf_set_key">wf_set_key</a></code>.</p>
</td></tr>
<tr><td><code id="wf_transfer_+3A_path">path</code></td>
<td>
<p>path were to store the downloaded data</p>
</td></tr>
<tr><td><code id="wf_transfer_+3A_filename">filename</code></td>
<td>
<p>filename to use for the downloaded data</p>
</td></tr>
<tr><td><code id="wf_transfer_+3A_verbose">verbose</code></td>
<td>
<p>show feedback on data transfers</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Normal workflows would use the methods included in returned objects. This is
for legacy support and custom scripting only.
</p>


<h3>Value</h3>

<p>a (netCDF) file of data on disk as specified by a
<code><a href="#topic+wf_request">wf_request</a></code>
</p>


<h3>Author(s)</h3>

<p>Koen Hufkens
</p>


<h3>See Also</h3>

<p><code><a href="#topic+wf_set_key">wf_set_key</a></code>
<code><a href="#topic+wf_request">wf_request</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
# request data and grab url and try a transfer
# (request not provided)
r &lt;- wf_request(request, transfer = FALSE)

# check transfer, will download if available
wf_transfer(r$get_url())

## End(Not run)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
