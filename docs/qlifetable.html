<!DOCTYPE html><html lang="en"><head><title>Help for package qlifetable</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {qlifetable}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#annual2quarterly'><p>Estimates quarterly life tables</p></a></li>
<li><a href='#birth_2006'>
<p>Half of male births recorded in the Comunitat Valenciana (Spain) during 2006.</p></a></li>
<li><a href='#compute_SAI'><p>Estimates seasonal-ageing indexes from  quarterly tables of crude rates estimates.</p></a></li>
<li><a href='#coord_age'><p>Time elapsed (in years) since last birthday and the date of the event</p></a></li>
<li><a href='#coord_time'><p>Time elapsed (in years) since the beginning of the year</p></a></li>
<li><a href='#count_events_quarter'><p>Data frame of number of events occurring in each Lexis-diagram quarter</p></a></li>
<li><a href='#crude_mx'><p>Data frame(s) of crude estimates of quarterly (and annual) central rates of mortality estimated from quarterly summary statistics.</p></a></li>
<li><a href='#crude_mx_sh2'><p>Data frame(s) of crude estimates of quarterly (and annual) central rates of mortality estimated using shortcut 2.</p></a></li>
<li><a href='#crude_mx_sh3'><p>Data frame(s) of crude estimates of quarterly (and annual) central rates of mortality estimated using shortcut 3.</p></a></li>
<li><a href='#death_2006'>
<p>Half of male deaths recorded in Comunitat Valenciana (Spain) during year 2006.</p></a></li>
<li><a href='#distribute_excess'><p>Randomly distributes the excess of recorded births in a given day</p></a></li>
<li><a href='#emi_2006'>
<p>Male emigrants recorded in Comunitat Valenciana (Spain) during year 2006.</p></a></li>
<li><a href='#exact_age'><p>Time elapsed (in years) since the dates of birth and event.</p></a></li>
<li><a href='#immi_2006'>
<p>Half of the male immigrants recorded in Comunitat Valenciana (Spain) during year 2006.</p></a></li>
<li><a href='#plot.qlifetable'><p>Graphical representation in a 4x4 raster of a qlifetable data frame.</p></a></li>
<li><a href='#plot.SAI'><p>Graphical representation of a SAI object.</p></a></li>
<li><a href='#pop_2006'>
<p>Half of the male population living in the Comunitat Valenciana (Spain) on January, 1 2006.</p></a></li>
<li><a href='#quarterly_variables'><p>Data frame of quarterly variables</p></a></li>
<li><a href='#SAI_shortcut_1'><p>Estimates seasonal-ageing indexes using shortcut 1.</p></a></li>
<li><a href='#time_exposed_ins'><p>Data frame of time exposed at risk for a population of immigrants/portfolio entries</p></a></li>
<li><a href='#time_exposed_newborns'><p>Data frame of time exposed at risk for a population of newborns</p></a></li>
<li><a href='#time_exposed_outs'><p>Data frame of time exposed at risk for a population of deaths/emigrants/exits (portfolio withdrawals, lapses) during the year of the event.</p></a></li>
<li><a href='#time_exposed_stock'><p>Data frame of time exposed at risk for a stock of general/insured population</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Managing and Building of Quarterly Life Tables</td>
</tr>
<tr>
<td>Version:</td>
<td>0.0.2-5</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jose M. Pavía &lt;jose.m.pavia@uv.es&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Manages, builds and computes statistics and datasets for the 
   construction of quarterly (sub-annual) life tables by exploiting micro-data from
   either a general or an insured population.
   References: 
   Pavía and Lledó (2022) &lt;<a href="https://doi.org/10.1111%2Frssa.12769">doi:10.1111/rssa.12769</a>&gt;.
   Pavía and Lledó (2023) &lt;<a href="https://doi.org/10.1017%2Fasb.2023.16">doi:10.1017/asb.2023.16</a>&gt;.
   Acknowledgements:
   The authors wish to thank Consellería de Educación, Universidades y Empleo, Generalitat Valenciana (grant AICO/2021/257), Ministerio de Ciencia e Innovación (grant PID2021-128228NB-I00) and Fundación Mapfre (grant 'Modelización espacial e intra-anual de la mortalidad en España. Una herramienta automática para el cálculo de productos de vida') for supporting this research.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.eclipse.org/legal/epl-v10.html">EPL</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats, methods</td>
</tr>
<tr>
<td>Suggests:</td>
<td>ggplot2, scales, gridExtra</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-06-25 13:28:38 UTC; mariaamparo</td>
</tr>
<tr>
<td>Author:</td>
<td>Jose M. Pavía <a href="https://orcid.org/0000-0002-0129-726X"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Josep Lledó <a href="https://orcid.org/0000-0002-7475-8549"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-06-28 07:30:07 UTC</td>
</tr>
</table>
<hr>
<h2 id='annual2quarterly'>Estimates quarterly life tables</h2><span id='topic+annual2quarterly'></span>

<h3>Description</h3>

<p>Given an annual life table and a set of estimates seasonal-ageing indexes, estimates the four
quarterly life tables associated to the annual life table.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>annual2quarterly(table.a, SAIs, mx = FALSE, min.age = 0, max.age = 100)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="annual2quarterly_+3A_table.a">table.a</code></td>
<td>
<p>A data.frame corresponding to the reference annual life table. The life table can be defined via
via death probabilities ('qx', default) or death rates ('mx'). The first column of 'table.a' refers to 'age',
and the second column to either 'mx' rates or 'qx' probabilities. In case of using death probabilities ('qx'),
'table.a' can have an optional third column, which refers to the the average number of years lived
for those dying with age x, 'ax'. If this last column is missing ax is assumed to be constant and equal to 0.5.</p>
</td></tr>
<tr><td><code id="annual2quarterly_+3A_sais">SAIs</code></td>
<td>
<p>An object output of the <code><a href="#topic+compute_SAI">compute_SAI</a></code> function.</p>
</td></tr>
<tr><td><code id="annual2quarterly_+3A_mx">mx</code></td>
<td>
<p>A 'TRUE/FALSE' argument informing whether 'table.a' is either an annual life table of death rates or
an annual table of death probabilities. Default, 'FALSE'.</p>
</td></tr>
<tr><td><code id="annual2quarterly_+3A_min.age">min.age</code></td>
<td>
<p>A non-negative integer informing about the initial minimal age for which quarterly tables must be computed.
This minimum age can be increased depending on the ages for which there are values in 'table.a' and in
'SAIs'. Default, 0.</p>
</td></tr>
<tr><td><code id="annual2quarterly_+3A_max.age">max.age</code></td>
<td>
<p>A positive integer informing about the initial maximum age for which quarterly tables must be computed.
This maximum age can be decreased  depending on the ages for which there are values in 'table.a' and in
'SAIs'. Default, 100.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with ten columns
</p>
<table role = "presentation">
<tr><td><code>age</code></td>
<td>
<p> Integer age to which death rates and probabilities corresponds.</p>
</td></tr>
<tr><td><code>quarter.age</code></td>
<td>
<p> Age quarter to which death rates and probabilities corresponds.</p>
</td></tr>
<tr><td><code>mx.quarter.birth.1</code></td>
<td>
<p> Death rates corresponding to people born during the first quarter of the year.</p>
</td></tr>
<tr><td><code>mx.quarter.birth.2</code></td>
<td>
<p> Death rates corresponding to people born during the second quarter of the year.</p>
</td></tr>
<tr><td><code>mx.quarter.birth.3</code></td>
<td>
<p> Death rates corresponding to people born during the third quarter of the year.</p>
</td></tr>
<tr><td><code>mx.quarter.birth.4</code></td>
<td>
<p> Death rates corresponding to people born during the four quarter of the year.</p>
</td></tr>
<tr><td><code>qx.quarter.birth.1</code></td>
<td>
<p> Death Probabilites corresponding to people born during the first quarter of the year.</p>
</td></tr>
<tr><td><code>qx.quarter.birth.2</code></td>
<td>
<p> Death Probabilites corresponding to people born during the second quarter of the year.</p>
</td></tr>
<tr><td><code>qx.quarter.birth.3</code></td>
<td>
<p> Death Probabilites corresponding to people born during the third quarter of the year.</p>
</td></tr>
<tr><td><code>qx.quarter.birth.4</code></td>
<td>
<p> Death Probabilites corresponding to people born during the four quarter of the year.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jose M. Pavia <a href="mailto:pavia@uv.es">pavia@uv.es</a>
</p>
<p>Josep Lledo <a href="mailto:josep.lledo@uv.es">josep.lledo@uv.es</a>
</p>


<h3>References</h3>

<p>Pavia, JM and Lledo, J (2022). Estimation of the Combined Effects of Ageing and Seasonality on Mortality Risk. An application to Spain. *Journal of the Royal Statistical Society, Series A (Statistics in Society)*, 185(2), 471-497. <a href="https://doi.org/10.1111/rssa.12769">doi:10.1111/rssa.12769</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# This can take a while
 t.stock &lt;- time_exposed_stock(pop_2006$date.birth, 2006, "forward")
 t.stock &lt;- t.stock[t.stock$age &lt;= 100, ]
 temp &lt;- quarterly_variables(death_2006$date.birth, death_2006$date.death)
 e.death &lt;- count_events_quarter(temp)
 e.death &lt;- e.death[e.death$age &lt;= 100, ]
 t.birth &lt;- time_exposed_newborns(birth_2006$date.birth)
 out &lt;- crude_mx(t.stock, e.death, time.birth = t.birth)
 SAI.example &lt;- compute_SAI(out, out)
 dx &lt;- tapply(e.death$number.events, e.death$age, sum)
 Lax &lt;- tapply(t.stock$time.exposed, t.stock$age, sum)
 table.ex &lt;- data.frame(age = 0:100, mx.a = dx/Lax)
 example &lt;- annual2quarterly(table.a = table.ex, SAIs = SAI.example, mx = TRUE)


</code></pre>

<hr>
<h2 id='birth_2006'>
Half of male births recorded in the Comunitat Valenciana (Spain) during 2006.
</h2><span id='topic+birth_2006'></span>

<h3>Description</h3>

<p>Data frame containing the dates of birth of a random sample composed by half of all male babies born in the region of Comunitat Valenciana (Spain) during 2006.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(birth_2006)</code></pre>


<h3>Format</h3>

<p>A data frame containing 13,626 rows and 1 column:
</p>

<dl>
<dt>date.birth</dt><dd><p>Dates of birth in format &quot;yyyy-mm-dd&quot;.</p>
</dd>
</dl>


<h3>Source</h3>

<p>National Statistical Institute, <a href="https://www.ine.es/">https://www.ine.es/</a>.
</p>

<hr>
<h2 id='compute_SAI'>Estimates seasonal-ageing indexes from  quarterly tables of crude rates estimates.</h2><span id='topic+compute_SAI'></span>

<h3>Description</h3>

<p>Given a set of quarterly tables of crude rates estimates corresponding to several years (periods),
this function computes their corresponding seasonal-ageing indexes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compute_SAI(x, y, ..., margins = FALSE, min.age = 0, max.age = 100)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compute_SAI_+3A_x">x</code></td>
<td>
<p>A data.frame/list output of either <code><a href="#topic+crude_mx">crude_mx</a></code>, <code><a href="#topic+crude_mx_sh2">crude_mx_sh2</a></code> or <code><a href="#topic+crude_mx_sh3">crude_mx_sh3</a></code> functions corresponding to a period (typically a year).</p>
</td></tr>
<tr><td><code id="compute_SAI_+3A_y">y</code></td>
<td>
<p>A data.frame/list output of either <code><a href="#topic+crude_mx">crude_mx</a></code>, <code><a href="#topic+crude_mx_sh2">crude_mx_sh2</a></code> or <code><a href="#topic+crude_mx_sh3">crude_mx_sh3</a></code> functions corresponding to another period (typically a different year than the one corresponding to 'x').</p>
</td></tr>
<tr><td><code id="compute_SAI_+3A_...">...</code></td>
<td>
<p>Further output(s) of either <code><a href="#topic+crude_mx">crude_mx</a></code>, <code><a href="#topic+crude_mx_sh2">crude_mx_sh2</a></code> or <code><a href="#topic+crude_mx_sh3">crude_mx_sh3</a></code> functions corresponding to another period(s) (typically different year(s) than the ones corresponding to 'x' and 'y').</p>
</td></tr>
<tr><td><code id="compute_SAI_+3A_margins">margins</code></td>
<td>
<p>A 'TRUE/FALSE' argument informing whether or not the marginal seasonal and ageing indexes should be also
computed. Default, 'FALSE'.</p>
</td></tr>
<tr><td><code id="compute_SAI_+3A_min.age">min.age</code></td>
<td>
<p>A non-negative integer informing about the initial minimal age for which SAIs must be computed. This minimum age can
be increased depending on the ages for which there are crude mx estimates (exposed-at-risk) in the objects  'x', 'y', '...'. Default, 0.</p>
</td></tr>
<tr><td><code id="compute_SAI_+3A_max.age">max.age</code></td>
<td>
<p>A positive integer informing about the initial maximum age for which SAIs must be computed. This maximum age can
be decreased depending on the maximum ages for which there are crude mx estimates (exposed-at-risk) in the objects  'x', 'y', '...'.
Default, 100.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>When 'margins = FALSE' a data frame with the (raw, normalized and linearized) estimated seasonal-ageing
indexes (SAI) corresponding to the set of integer ages determined by 'min.age' and 'max.age' and the exposed-at-risk
in the mx crude estimates for each combination of age and calendar quarter.
The data frame has the following components:
</p>
<table role = "presentation">
<tr><td><code>age</code></td>
<td>
<p> Integer age to which the SAIs corresponds.</p>
</td></tr>
<tr><td><code>quarter.age</code></td>
<td>
<p> Age quarter to which the SAIs corresponds.</p>
</td></tr>
<tr><td><code>quarter.calendar</code></td>
<td>
<p> Calendar (time, season) quarter to which the SAIs corresponds.</p>
</td></tr>
<tr><td><code>SAI.raw</code></td>
<td>
<p> Estimates of raw seasonal-ageing indexes for each combination of 'age', 'quarter.age' and 'quarter.calendar'.</p>
</td></tr>
<tr><td><code>SAI.norm</code></td>
<td>
<p> Estimates of seasonal-ageing indexes, attained after normalizing raw SAIs estimates, for each  combination of 'age', 'quarter.age' and 'quarter.calendar'.</p>
</td></tr>
<tr><td><code>SAI.lin</code></td>
<td>
<p> Final estimates of seasonal-ageing indexes, attained after linearizing normalized SAIs estimates,  for each combination of 'age', 'quarter.age' and 'quarter.calendar'.</p>
</td></tr>
</table>
<p>When 'margins = TRUE' the output is a list with three data frames 'SAI', 'SAI.age' and 'SAI.quarter'.
'SAI' is defined as just described above. 'SAI.age' and  'SAI.quarter' contains, in a similar vein than 'SAI',
the estimated marginal SAIs, corresponding to, respectively, the age quarter and the calendar (time, season)
quarter.
</p>


<h3>Author(s)</h3>

<p>Jose M. Pavia <a href="mailto:pavia@uv.es">pavia@uv.es</a>
</p>
<p>Josep Lledo <a href="mailto:josep.lledo@uv.es">josep.lledo@uv.es</a>
</p>


<h3>References</h3>

<p>Pavia, JM and Lledo, J (2022). Estimation of the Combined Effects of Ageing and Seasonality on Mortality Risk. An application to Spain. *Journal of the Royal Statistical Society, Series A (Statistics in Society)*, 185(2), 471-497. <a href="https://doi.org/10.1111/rssa.12769">doi:10.1111/rssa.12769</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# This can take a while
 t.stock &lt;- time_exposed_stock(pop_2006$date.birth, 2006, "forward")
 t.stock &lt;- t.stock[t.stock$age &lt;= 100, ]
 temp &lt;- quarterly_variables(death_2006$date.birth, death_2006$date.death)
 e.death &lt;- count_events_quarter(temp)
 e.death &lt;- e.death[e.death$age &lt;= 100, ]
 t.birth &lt;- time_exposed_newborns(birth_2006$date.birth)
 out &lt;- crude_mx(t.stock, e.death, time.birth = t.birth)
 SAI.example &lt;- compute_SAI(out, out)


# Fast example
dates.b &lt;- c("2017-05-13", "2018-04-12", "2018-12-01")
t.stock &lt;- time_exposed_stock(dates.b, year = 2020, type = "backward")
dates.bd &lt;- c("2018-04-12")
dates.d &lt;- c("2020-05-23")
x &lt;- quarterly_variables(dates.bd, dates.d)
e.death &lt;- count_events_quarter(x)
t.death &lt;- time_exposed_outs(x)
out &lt;- crude_mx(t.stock, e.death, t.death)
SAI.example &lt;- compute_SAI(out, out)
</code></pre>

<hr>
<h2 id='coord_age'>Time elapsed (in years) since last birthday and the date of the event</h2><span id='topic+coord_age'></span>

<h3>Description</h3>

<p>Computes the time(s) elapsed (in years) between the date(s) of last birthday and the date(s) of event(s) for each member of a population.
The age coordinate(s) corresponding to an 1x1-year Lexis diagram, using by default the same length of year employed to compute the (related) time coordinate(s).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>coord_age(
  date.birth,
  date.event,
  random.b = TRUE,
  random.e = TRUE,
  constant.age.year = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="coord_age_+3A_date.birth">date.birth</code></td>
<td>
<p>A character vector with the dates of birth in format either &quot;yyyy-mm-dd&quot; or &quot;yyyy-mm-dd hour:min:secs&quot; (for instance, &quot;2016-01-20 12:00:00&quot;) of a population.
If &quot;hour:min:secs&quot; is omitted the function imputes either &quot;12:00:00&quot;, if 'random.b = FALSE', or
a random hour by default.</p>
</td></tr>
<tr><td><code id="coord_age_+3A_date.event">date.event</code></td>
<td>
<p>A character vector with the dates of events in format either &quot;yyyy-mm-dd&quot; or &quot;yyyy-mm-dd hour:min:secs&quot; (for instance, &quot;2016-01-20 12:00:00&quot;) of a population.
If &quot;hour:min:secs&quot; is omitted the function imputes either &quot;12:00:00&quot;, if 'random.e = FALSE', or
a random hour, by default. This vector must have either length 1, when the aim is to compute
for all the members of the population the age coordinate in an 1x1-year Lexis diagram
in the same temporal point, or the same length as 'date.birth', when the aim is to compute for
each member of the population the age coordinate in the moment of the event (e.g., death).</p>
</td></tr>
<tr><td><code id="coord_age_+3A_random.b">random.b</code></td>
<td>
<p>A 'TRUE/FALSE' argument indicating whether the exact moment (&quot;hour:min:secs&quot;) when the birth occurs within the day is randomly selected. If TRUE, this overwrites &quot;hour:min:secs&quot; in 'date.birth' even if those have been declared. By default, TRUE.</p>
</td></tr>
<tr><td><code id="coord_age_+3A_random.e">random.e</code></td>
<td>
<p>A 'TRUE/FALSE' argument indicating whether the exact moment (&quot;hour:min:secs&quot;) when the event occurs within the day is randomly selected. If TRUE, this overwrites &quot;hour:min:secs&quot; in 'date.event' even if those have been declared. By default, TRUE.</p>
</td></tr>
<tr><td><code id="coord_age_+3A_constant.age.year">constant.age.year</code></td>
<td>
<p>A 'TRUE/FALSE' argument indicating whether the length of the year should be constant, 365.25 days, or variable,
depending on the time lived for the person in each year since her/his dates of birth and event. By default, FALSE.
The advantage of using a non-constant (person-dependent) length of year is congruence when
estimating time exposed at risk: in each year the time exposed along the time and age axes will coincide.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector of the same length as data.birth
</p>


<h3>Note</h3>

<p>If 'constant.age.year = FALSE' (default), the length of the year for each person is computed as a weighted average of the lengths
of the years that the person has lived between his/her dates of birth and event using as weight the time lived for the person during
each year.
</p>


<h3>Author(s)</h3>

<p>Jose M. Pavia <a href="mailto:pavia@uv.es">pavia@uv.es</a>
</p>
<p>Josep Lledo <a href="mailto:josep.lledo@uv.es">josep.lledo@uv.es</a>
</p>


<h3>References</h3>

<p>Pavia, JM and Lledo, J (2022). Estimation of the Combined Effects of Ageing and Seasonality on Mortality Risk. An application to Spain. *Journal of the Royal Statistical Society, Series A (Statistics in Society)*, 185(2), 471-497. <a href="https://doi.org/10.1111/rssa.12769">doi:10.1111/rssa.12769</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+coord_time">coord_time</a></code>, <code><a href="#topic+exact_age">exact_age</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dates.b &lt;- c("1920-05-13", "1999-04-12", "2019-01-01")
dates.e &lt;- c("2002-03-23", "2009-04-12", "2019-01-01")
coord_age(dates.b, dates.e)
</code></pre>

<hr>
<h2 id='coord_time'>Time elapsed (in years) since the beginning of the year</h2><span id='topic+coord_time'></span>

<h3>Description</h3>

<p>Computes the time(s) elapsed (in years) between the beginning of the year and the date(s) of the event(s). The time coordinate(s) in a Lexis diagram.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>coord_time(date.event, random.e = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="coord_time_+3A_date.event">date.event</code></td>
<td>
<p>A character vector with the dates of events in format either &quot;yyyy-mm-dd&quot; or &quot;yyyy-mm-dd hour:min:secs&quot; (for instance, &quot;2016-01-20 12:00:00&quot;) of a population.
If &quot;hour:min:secs&quot; is omitted the function imputes either &quot;12:00:00&quot;, if 'random.e = FALSE', or
a random hour, by default.</p>
</td></tr>
<tr><td><code id="coord_time_+3A_random.e">random.e</code></td>
<td>
<p>A 'TRUE/FALSE' argument indicating whether the exact moment (&quot;hour:min:secs&quot;) when the event occurs within the day is randomly selected. This overwrites &quot;hour:min:secs&quot; in 'date.event' even if this has been declared.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector of the same length as data.event
</p>


<h3>Note</h3>

<p>The length of the year is 365 days in non-leap years and 366 days in leap years.
</p>


<h3>Author(s)</h3>

<p>Jose M. Pavia <a href="mailto:pavia@uv.es">pavia@uv.es</a>
</p>
<p>Josep Lledo <a href="mailto:josep.lledo@uv.es">josep.lledo@uv.es</a>
</p>


<h3>References</h3>

<p>Pavia, JM and Lledo, J (2022). Estimation of the Combined Effects of Ageing and Seasonality on Mortality Risk. An application to Spain. *Journal of the Royal Statistical Society, Series A (Statistics in Society)*, 185(2), 471-497. <a href="https://doi.org/10.1111/rssa.12769">doi:10.1111/rssa.12769</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+coord_age">coord_age</a></code>, <code><a href="#topic+exact_age">exact_age</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dates &lt;- c("2002-03-23", "2009-04-12", "2019-01-01")
coord_time(dates)
dates &lt;- "2019-01-01 14:00:00"
coord_time(dates, FALSE)
</code></pre>

<hr>
<h2 id='count_events_quarter'>Data frame of number of events occurring in each Lexis-diagram quarter</h2><span id='topic+count_events_quarter'></span>

<h3>Description</h3>

<p>Computes for each integer age and each combination of age and seasonal quarter
the number of events occurring in the population.
The computation is performed using the associated data frame of quarterly variables
corresponding to the population obtained using the <code><a href="#topic+quarterly_variables">quarterly_variables</a></code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>count_events_quarter(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="count_events_quarter_+3A_x">x</code></td>
<td>
<p>A data.frame output of the <code><a href="#topic+quarterly_variables">quarterly_variables</a></code> function.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with the number of events for each (potential) combination of integer age and age and
season quarter of the input dataset. The data frame has the following components:
</p>
<table role = "presentation">
<tr><td><code>age</code></td>
<td>
<p> Integer age to which the time exposed at risk corresponds.</p>
</td></tr>
<tr><td><code>quarter.age</code></td>
<td>
<p> Age quarter to which the time exposed at risk corresponds.</p>
</td></tr>
<tr><td><code>quarter.calendar</code></td>
<td>
<p> Calendar (time, season) quarter to which the time exposed at risk corresponds.</p>
</td></tr>
<tr><td><code>number.events</code></td>
<td>
<p> Number of events that occurred during the quarter determined for the
combination of 'age', 'quarter.age' and 'quarter.calendar'.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>The structure of the dataset is similar to those obtained using the <code><a href="#topic+time_exposed_outs">time_exposed_outs</a></code>,
<code><a href="#topic+time_exposed_ins">time_exposed_ins</a></code> and  <code><a href="#topic+time_exposed_stock">time_exposed_stock</a></code> functions.
</p>


<h3>Author(s)</h3>

<p>Jose M. Pavia <a href="mailto:pavia@uv.es">pavia@uv.es</a>
</p>
<p>Josep Lledo <a href="mailto:josep.lledo@uv.es">josep.lledo@uv.es</a>
</p>


<h3>References</h3>

<p>Pavia, JM and Lledo, J (2022). Estimation of the Combined Effects of Ageing and Seasonality on Mortality Risk. An application to Spain. *Journal of the Royal Statistical Society, Series A (Statistics in Society)*, 185(2), 471-497. <a href="https://doi.org/10.1111/rssa.12769">doi:10.1111/rssa.12769</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dates.b &lt;- c("1920-05-13", "1999-04-12", "2019-01-01")
dates.e &lt;- c("2002-03-23", "2009-04-12", "2019-01-01")
x &lt;- quarterly_variables(dates.b, dates.e)
out &lt;- count_events_quarter(x)
</code></pre>

<hr>
<h2 id='crude_mx'>Data frame(s) of crude estimates of quarterly (and annual) central rates of mortality estimated from quarterly summary statistics.</h2><span id='topic+crude_mx'></span>

<h3>Description</h3>

<p>Computes for a general/insured population crude estimates of quarterly (and annual)
central rates of mortality by age (in a set of integer ages) for each combination
of age and calendar quarter, given data sets of times exposed-at-risk of
stocks of population and of number of deaths by each integer age for
each combination of age and seasonal quarter, along with data sets of times
exposed-at-risk (or non-exposed) of immigrants/new policies, emigrants/exits/deaths
and/or newborns.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>crude_mx(
  time.stock,
  events.death,
  time.death = NULL,
  time.outs = NULL,
  time.ins = NULL,
  time.birth = NULL,
  type = "forward",
  annual = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="crude_mx_+3A_time.stock">time.stock</code></td>
<td>
<p>A data frame containing the total exposure-at-risk times for the stock of
the population/portfolio, measured either since the start of the year ('type = &quot;forward&quot;')
or from the end of the year ('type = &quot;backward&quot;') throughout the target period (typically a year).
This data frame must contain the times for a set of consecutive integer ages
for each combination of age and season/calendar quarter. Typically, this data
frame is an output of the function <code><a href="#topic+time_exposed_stock">time_exposed_stock</a></code> or a data frame
with the same structure. The set of consecutive integer ages in this object determines the
range of ages for which crude rates of mortality are estimated by the function.</p>
</td></tr>
<tr><td><code id="crude_mx_+3A_events.death">events.death</code></td>
<td>
<p>A data frame with the number of deaths recorded in the population/portfolio
during the target period (typically a year) in a set of integer ages for each combination of age
and season/calendar quarter. Typically, this is an output of the function
<code><a href="#topic+count_events_quarter">count_events_quarter</a></code> or a data frame with the same structure.
If the range of ages does not cover the range of ages in 'time.stock',
zeros are imputed  for the missing ages.</p>
</td></tr>
<tr><td><code id="crude_mx_+3A_time.death">time.death</code></td>
<td>
<p>A data frame containing either the total non-exposure-at-risk times (when
'type = &quot;forward&quot;') or the total exposure-at-risk times (when 'type = &quot;backward&quot;')
during the target period of the deaths recorded in the population/portfolio.
Typically, this data frame is an output of the function <code><a href="#topic+time_exposed_ins">time_exposed_ins</a></code>
when 'type = &quot;forward&quot;' or an output of the function <code><a href="#topic+time_exposed_outs">time_exposed_outs</a></code>
when 'type = &quot;backward&quot;' or a data frame with the same structure. Default, 'NULL'.
If no 'time.death' data.frame is provided the total (non-) exposure-at-risk times
are computed using the information in 'events.death' under the hypothesis of
uniform distribution of deaths within each age-calendar quarter.</p>
</td></tr>
<tr><td><code id="crude_mx_+3A_time.outs">time.outs</code></td>
<td>
<p>A data frame containing either the total non-exposure-at-risk times (when
'type = &quot;forward&quot;') or the total exposure-at-risk times (when 'type = &quot;backward&quot;')
during the target period of the emigrants/exits recorded in the population/portfolio.
Typically, this data frame is an output of the function <code><a href="#topic+time_exposed_ins">time_exposed_ins</a></code>
when 'type = &quot;forward&quot;' or an output of the function <code><a href="#topic+time_exposed_outs">time_exposed_outs</a></code>
when 'type = &quot;backward&quot;' or a data frame with the same structure. Default, 'NULL'.</p>
</td></tr>
<tr><td><code id="crude_mx_+3A_time.ins">time.ins</code></td>
<td>
<p>A data frame containing either the total exposure-at-risk times (when
'type = &quot;forward&quot;') or the total non-exposure-at-risk times (when 'type = &quot;backward&quot;')
during the target period (typically a year) of the immigrants/new policies recorded in the population/portfolio.
Typically, this data frame is an output of the function <code><a href="#topic+time_exposed_ins">time_exposed_ins</a></code>
when 'type = &quot;forward&quot;' and an output of the function <code><a href="#topic+time_exposed_outs">time_exposed_outs</a></code>
when 'type = &quot;backward&quot;' or a data frame with the same structure. Default, 'NULL'.</p>
</td></tr>
<tr><td><code id="crude_mx_+3A_time.birth">time.birth</code></td>
<td>
<p>A data frame containing the total exposure-at-risk times of the newborns recorded in
the population during the target period. Typically, this data frame is an output of the
function <code><a href="#topic+time_exposed_newborns">time_exposed_newborns</a></code> or a data frame with the same structure.
Default, 'NULL'.</p>
</td></tr>
<tr><td><code id="crude_mx_+3A_type">type</code></td>
<td>
<p>A character string informing if the total time exposed to risk of the stock of
population/portfolio has been computed since the beginning of the year ('&quot;forward&quot;') or
from the end of the year ('&quot;backward&quot;'). Default, '&quot;forward&quot;'.</p>
</td></tr>
<tr><td><code id="crude_mx_+3A_annual">annual</code></td>
<td>
<p>A character string informing whether the annual crude central rates of mortality
should also be computed. Default, 'FALSE'.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>When 'annual = FALSE' a data frame with estimated crude central rates of mortality for the set
of integer ages determined by 'time.stock' for each combination of age and
calendar quarter. The data frame has the following components:
</p>
<table role = "presentation">
<tr><td><code>age</code></td>
<td>
<p> Integer age to which the crude central rate of mortality corresponds.</p>
</td></tr>
<tr><td><code>quarter.age</code></td>
<td>
<p> Age quarter to which the crude central rate of mortality corresponds.</p>
</td></tr>
<tr><td><code>quarter.calendar</code></td>
<td>
<p> Calendar (time, season) quarter to which the crude central rate of mortality corresponds.</p>
</td></tr>
<tr><td><code>exposed</code></td>
<td>
<p> Total exposure-at-risk times in the target population for each combination of 'age', 'quarter.age' and 'quarter.calendar'.</p>
</td></tr>
<tr><td><code>deaths</code></td>
<td>
<p> Number of deaths in the target population for each  combination of 'age', 'quarter.age' and 'quarter.calendar'.</p>
</td></tr>
<tr><td><code>mx</code></td>
<td>
<p> Estimated crude central rate of mortality corresponding to the combination of 'age', 'quarter.age' and 'quarter.calendar'.</p>
</td></tr>
</table>
<p>When 'annual = TRUE' the output is a list with two data frames 'mx.quarterly' and 'mx.annual'.
'mx.quarterly' is a data frame with the estimated quarterly crude central rates of mortality as just described and
'mx.annual' is the corresponding data frame with the estimated annual crude central rates of mortality.
</p>


<h3>Note</h3>

<p>First, it is the responsibility of the user to assure that all the times exposed-at-risk and number of events
correspond to the same target period (typically, the same year).
Second, If the date of reference of the stock of population/portfolio is the beginning of the year ('type = &quot;forward&quot;'),
the total time exposed at risk for each integer age in each age and calendar quarter is computed through:
time_exposed_stock(P) + time_exposed_ins(I) - time_exposed_ins(E) - time_exposed_ins(D) + time_exposed_newborns(B).
On the other hand, if the stock of population/portfolio is referenced at the end of the target year
('type = &quot;backward&quot;'), the total time exposed at risk for each age in each age and seasonal quarter is
computed slightly different: time_exposed_stock(P) - time_exposed_outs(I) + time_exposed_outs(E) + time_exposed_outs(D).
In the above expressions P, I, E, D and B represent, respectively, stocks of population/portfolio,
immigrants/new policies, emigrants/exits, deaths and births after being transformed using the
function <code><a href="#topic+quarterly_variables">quarterly_variables</a></code>.
</p>


<h3>Author(s)</h3>

<p>Jose M. Pavia <a href="mailto:pavia@uv.es">pavia@uv.es</a>
</p>
<p>Josep Lledo <a href="mailto:josep.lledo@uv.es">josep.lledo@uv.es</a>
</p>


<h3>References</h3>

<p>Pavia, JM and Lledo, J (2022). Estimation of the Combined Effects of Ageing and Seasonality on Mortality Risk. An application to Spain. *Journal of the Royal Statistical Society, Series A (Statistics in Society)*, 185(2), 471-497. <a href="https://doi.org/10.1111/rssa.12769">doi:10.1111/rssa.12769</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+crude_mx_sh2">crude_mx_sh2</a></code>, <code><a href="#topic+crude_mx_sh2">crude_mx_sh2</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Do not run, it can take a while
 t.stock &lt;- time_exposed_stock(pop_2006$date.birth, 2006, "forward")
 t.stock &lt;- t.stock[t.stock$age &lt;= 100, ]
 temp &lt;- quarterly_variables(death_2006$date.birth, death_2006$date.death)
 e.death &lt;- count_events_quarter(temp)
 e.death &lt;- e.death[e.death$age &lt;= 100, ]
 t.birth &lt;- time_exposed_newborns(birth_2006$date.birth)
 out &lt;- crude_mx(t.stock, e.death, time.birth = t.birth)

## End(Not run)
dates.b &lt;- c("2017-05-13", "2018-04-12", "2018-12-01")
t.stock &lt;- time_exposed_stock(dates.b, year = 2020, type = "backward")
dates.bd &lt;- c("2018-04-12")
dates.d &lt;- c("2020-05-23")
x &lt;- quarterly_variables(dates.bd, dates.d)
e.death &lt;- count_events_quarter(x)
t.death &lt;- time_exposed_outs(x)
out &lt;- crude_mx(t.stock, e.death, t.death)
</code></pre>

<hr>
<h2 id='crude_mx_sh2'>Data frame(s) of crude estimates of quarterly (and annual) central rates of mortality estimated using shortcut 2.</h2><span id='topic+crude_mx_sh2'></span>

<h3>Description</h3>

<p>Computes for a general/insured population crude estimates of quarterly (and annual)
central rates of mortality by age (in a set of integer ages) for each combination
of age and calendar quarter, using age aggregated data of population stocks and age-season
quarterly counts of deaths by employing shortcut 2, based on equation (2.7),
proposed in Pavia and Lledo (2023).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>crude_mx_sh2(pop.start, pop.end, events.death, annual = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="crude_mx_sh2_+3A_pop.start">pop.start</code></td>
<td>
<p>A data frame, corresponding to the target population/portfolio, containing the stock of
population/portfolio by age collected at the beginning of the year. This data frame must have two columns.
The first column refers to age and the second to the number of people in the population/portfolio
corresponding to each age.</p>
</td></tr>
<tr><td><code id="crude_mx_sh2_+3A_pop.end">pop.end</code></td>
<td>
<p>A data frame, corresponding to the target population/portfolio, containing the stock of
population/portfolio by age collected at the end of the year. This data frame must have two columns.
The first column refers to age and the second to the number of people in the population/portfolio
corresponding to each age.</p>
</td></tr>
<tr><td><code id="crude_mx_sh2_+3A_events.death">events.death</code></td>
<td>
<p>A data frame with the number of deaths recorded in the population/portfolio
during the target year in a set of integer ages for each combination of age
and season/calendar quarter. Typically, this is an output of the function
<code><a href="#topic+count_events_quarter">count_events_quarter</a></code> or a data frame with the same structure.
If the range of ages in 'events.death' does not cover the range of ages in the intersection of
ages defined by 'pop.start' and 'pop.end', zeros are imputed for the missing ages.</p>
</td></tr>
<tr><td><code id="crude_mx_sh2_+3A_annual">annual</code></td>
<td>
<p>A character string informing whether the annual crude central rates of mortality
should also be computed. Default, 'FALSE'.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>When 'annual = FALSE' a data frame with estimated crude central rates of mortality for each combination of age and
calendar quarter in the set of integer ages determined by the intersection of ages of 'pop.start' and 'pop.end'.
The data frame has the following components:
</p>
<table role = "presentation">
<tr><td><code>age</code></td>
<td>
<p> Integer age to which the crude central rate of mortality corresponds.</p>
</td></tr>
<tr><td><code>quarter.age</code></td>
<td>
<p> Age quarter to which the crude central rate of mortality corresponds.</p>
</td></tr>
<tr><td><code>quarter.calendar</code></td>
<td>
<p> Calendar (time, season) quarter to which the crude central rate of mortality corresponds.</p>
</td></tr>
<tr><td><code>exposed</code></td>
<td>
<p> Total exposure-at-risk times in the target population, calulated according to shortcut 2, for each combination of 'age', 'quarter.age' and 'quarter.calendar'.</p>
</td></tr>
<tr><td><code>deaths</code></td>
<td>
<p> Number of deaths in the target population for each  combination of 'age', 'quarter.age' and 'quarter.calendar'.</p>
</td></tr>
<tr><td><code>mx</code></td>
<td>
<p> Estimated crude central rate of mortality corresponding to the combination of 'age', 'quarter.age' and 'quarter.calendar'.</p>
</td></tr>
</table>
<p>When 'annual = TRUE' the output is a list with two data frames 'mx.quarterly' and 'mx.annual'.
'mx.quarterly' is a data frame with the estimated quarterly crude central rates of mortality as just described and
'mx.annual' is the corresponding data frame with the estimated annual crude central rates of mortality.
</p>


<h3>Note</h3>

<p>It is the responsibility of the user to assure that both stocks of population (which determine the ages for
which estimates are computed) and number of events correspond to the same year.
</p>


<h3>Author(s)</h3>

<p>Jose M. Pavia <a href="mailto:pavia@uv.es">pavia@uv.es</a>
</p>
<p>Josep Lledo <a href="mailto:josep.lledo@uv.es">josep.lledo@uv.es</a>
</p>


<h3>References</h3>

<p>Pavia, JM and Lledo, J (2023). Shortcuts for the construction of sub-annual life tables. *ASTIN Bulletin: The Journal of the International Actuarial Association*, 53(2), 332-350. <a href="https://doi.org/10.1017/asb.2023.16">doi:10.1017/asb.2023.16</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+crude_mx">crude_mx</a></code>, <code><a href="#topic+crude_mx_sh3">crude_mx_sh3</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# This can take a while
 pop &lt;- 2005 - as.numeric(substr(pop_2006$date.birth, 1 , 4))
 pop &lt;- as.data.frame(table(pop))
 pop[, 1] &lt;- as.numeric(as.character(pop[, 1]))
 temp &lt;- quarterly_variables(death_2006$date.birth, death_2006$date.death)
 e.death &lt;- count_events_quarter(temp)
 out &lt;- crude_mx_sh2(pop, pop, e.death)


# Fast example
pop.1 &lt;- data.frame(age = c(40, 41), people = c(4134, 4353))
pop.2 &lt;- data.frame(age = c(40, 41), people = c(4250, 4213))
dates.b &lt;- c("1980-04-12")
dates.d &lt;- c("2020-08-23")
x &lt;- quarterly_variables(dates.b, dates.d)
e.death &lt;- count_events_quarter(x)
out &lt;- crude_mx_sh2(pop.1, pop.2, e.death)
</code></pre>

<hr>
<h2 id='crude_mx_sh3'>Data frame(s) of crude estimates of quarterly (and annual) central rates of mortality estimated using shortcut 3.</h2><span id='topic+crude_mx_sh3'></span>

<h3>Description</h3>

<p>Computes for a general/insured population crude estimates of quarterly (and annual)
central rates of mortality by age (in a set of integer ages) for each combination
of age and calendar quarter, using quarterly age aggregated data of population stocks and age-season
quarterly counts of deaths, immigrants/new policies (entries) and emigrants/lapses/expirations (exits)
by employing shortcut 3, based on equation (2.9), proposed in Pavia and Lledo (2023).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>crude_mx_sh3(
  pop.start,
  pop.end,
  events.death,
  events.out,
  events.in,
  annual = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="crude_mx_sh3_+3A_pop.start">pop.start</code></td>
<td>
<p>A data frame, corresponding to the target population/portfolio, containing by age the stock of
population/portfolio by quarter collected at the beginning of the year. This data frame must
have three columns. The first refers to integer ages (e.g., 20, 21, 22,...),
the second to the quarter (with values 1, 2, 3 and 4) and the third to the number of people in
the population/portfolio at the beginning of the year corresponding to each integer age and quarter.</p>
</td></tr>
<tr><td><code id="crude_mx_sh3_+3A_pop.end">pop.end</code></td>
<td>
<p>A data frame, corresponding to the target population/portfolio, containing by age the
stock of population/portfolio by quarter collected at the end of the year. This data frame must
have three columns. The first refers to integer ages (e.g., 20, 21, 22,...),
the second to the quarter (with values 1, 2, 3 and 4) and the third to the number of people in
the population/portfolio at the end of the year corresponding to each integer age and quarter.</p>
</td></tr>
<tr><td><code id="crude_mx_sh3_+3A_events.death">events.death</code></td>
<td>
<p>A data frame with the number of deaths recorded in the population/portfolio
during the target year in a set of integer ages for each combination of age
and season/calendar quarter. Typically, this is an output of the function
<code><a href="#topic+count_events_quarter">count_events_quarter</a></code> or a data frame with the same structure.
If the range of ages in 'events.death' does not cover the range of ages in the intersection of
ages defined by 'pop.start' and 'pop.end', zeros are imputed for the missing ages.</p>
</td></tr>
<tr><td><code id="crude_mx_sh3_+3A_events.out">events.out</code></td>
<td>
<p>A data frame with the number of exits (emigrants/lapses/expirations) recorded in
the population/portfolio during the target year in a set of integer ages for each combination of
age and season/calendar quarter. Typically, this is an output of the function
<code><a href="#topic+count_events_quarter">count_events_quarter</a></code> or a data frame with the same structure.
If the range of ages in 'events.out' does not cover the range of ages in the intersection of
ages defined by 'pop.start' and 'pop.end', zeros are imputed for the missing ages.</p>
</td></tr>
<tr><td><code id="crude_mx_sh3_+3A_events.in">events.in</code></td>
<td>
<p>A data frame with the number of entries (immigrants/new policies) recorded in
the population/portfolio during the target year in a set of integer ages for each combination of
age and season/calendar quarter. Typically, this is an output of the function
<code><a href="#topic+count_events_quarter">count_events_quarter</a></code> or a data frame with the same structure.
If the range of ages in 'events.in' does not cover the range of ages in the intersection of
ages defined by 'pop.start' and 'pop.end', zeros are imputed for the missing ages.</p>
</td></tr>
<tr><td><code id="crude_mx_sh3_+3A_annual">annual</code></td>
<td>
<p>A character string informing whether the annual crude central rates of mortality
should also be computed. Default, 'FALSE'.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>When 'annual = FALSE' a data frame with estimated crude central rates of mortality for each combination of age and
calendar quarter in the set of integer ages determined by the intersection of ages in 'pop.start' and 'pop.end'.
The data frame has the following components:
</p>
<table role = "presentation">
<tr><td><code>age</code></td>
<td>
<p> Integer age to which the crude central rate of mortality corresponds.</p>
</td></tr>
<tr><td><code>quarter.age</code></td>
<td>
<p> Age quarter to which the crude central rate of mortality corresponds.</p>
</td></tr>
<tr><td><code>quarter.calendar</code></td>
<td>
<p> Calendar (time, season) quarter to which the crude central rate of mortality corresponds.</p>
</td></tr>
<tr><td><code>exposed</code></td>
<td>
<p> Total exposure-at-risk times in the target population, calulated according to shortcut 2, for each combination of 'age', 'quarter.age' and 'quarter.calendar'.</p>
</td></tr>
<tr><td><code>deaths</code></td>
<td>
<p> Number of deaths in the target population for each  combination of 'age', 'quarter.age' and 'quarter.calendar'.</p>
</td></tr>
<tr><td><code>mx</code></td>
<td>
<p> Estimated crude central rate of mortality corresponding to the combination of 'age', 'quarter.age' and 'quarter.calendar'.</p>
</td></tr>
</table>
<p>When 'annual = TRUE' the output is a list with two data frames 'mx.quarterly' and 'mx.annual'.
'mx.quarterly' is a data frame with the estimated quarterly crude central rates of mortality as just described and
'mx.annual' is the corresponding data frame with the estimated annual crude central rates of mortality.
</p>


<h3>Note</h3>

<p>It is the responsibility of the user to assure that both stocks of population (which determine the ages for
which estimates are computed) and number of events correspond to the same year.
</p>


<h3>Author(s)</h3>

<p>Jose M. Pavia <a href="mailto:pavia@uv.es">pavia@uv.es</a>
</p>
<p>Josep Lledo <a href="mailto:josep.lledo@uv.es">josep.lledo@uv.es</a>
</p>


<h3>References</h3>

<p>Pavia, JM and Lledo, J (2023). Shortcuts for the construction of sub-annual life tables. *ASTIN Bulletin: The Journal of the International Actuarial Association*, 53(2), 332-350. <a href="https://doi.org/10.1017/asb.2023.16">doi:10.1017/asb.2023.16</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+crude_mx">crude_mx</a></code>, <code><a href="#topic+crude_mx_sh2">crude_mx_sh2</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# This can take a while
 pop &lt;- 2005 - as.numeric(substr(pop_2006$date.birth, 1 , 4))
 pop &lt;- as.data.frame(table(pop))
 pop[, 1] &lt;- as.numeric(as.character(pop[, 1]))
 pop[, 2] &lt;- pop[, 2]/4
 pop &lt;- cbind(apply(pop, 2, rep, each = 4), quarter = rep(1:4, nrow(pop)))[, c(1, 3, 2)]
 pop &lt;- as.data.frame(pop)
 temp &lt;- quarterly_variables(death_2006$date.birth, death_2006$date.death)
 e.death &lt;- count_events_quarter(temp)
 temp &lt;- quarterly_variables(emi_2006$date.birth, emi_2006$date.emi)
 e.emi &lt;- count_events_quarter(temp)
 temp &lt;- quarterly_variables(immi_2006$date.birth, immi_2006$date.immi)
 e.immi &lt;- count_events_quarter(temp)
 out &lt;- crude_mx_sh3(pop, pop, e.death, e.emi, e.immi)


# Fast example
pop.1 &lt;- data.frame(age = c(rep(40, 4), rep(41, 4)), quarter = rep(1:4, 2), people = c(4134, 4353))
pop.2 &lt;- data.frame(age = c(rep(40, 4), rep(41, 4)), quarter = rep(1:4, 2), people = c(4250, 4213))
dates.b &lt;- c("1980-04-12")
dates.d &lt;- c("2020-08-23")
x &lt;- quarterly_variables(dates.b, dates.d)
e.death &lt;- count_events_quarter(x)
dates.b &lt;- c("1980-05-12")
dates.e &lt;- c("2020-06-23")
x &lt;- quarterly_variables(dates.b, dates.e)
e.emi &lt;- count_events_quarter(x)
dates.b &lt;- c("1980-07-12")
dates.i &lt;- c("2020-12-10")
x &lt;- quarterly_variables(dates.b, dates.i)
e.immi &lt;- count_events_quarter(x)
out &lt;- crude_mx_sh3(pop.1, pop.2, e.death, e.emi, e.immi)
</code></pre>

<hr>
<h2 id='death_2006'>
Half of male deaths recorded in Comunitat Valenciana (Spain) during year 2006.
</h2><span id='topic+death_2006'></span>

<h3>Description</h3>

<p>Data frame containing the dates of birth and death of a random sample composed by half of all men who died in the region of Comunitat Valenciana (Spain) during the year 2006.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(death_2006)</code></pre>


<h3>Format</h3>

<p>A data frame containing 10,146 rows and 2 columns:
</p>

<dl>
<dt>date.birth</dt><dd><p>Dates of birth in format &quot;yyyy-mm-dd&quot;.</p>
</dd>
<dt>date.death</dt><dd><p>Dates of death in format &quot;yyyy-mm-dd&quot;.</p>
</dd>
</dl>


<h3>Source</h3>

<p>National Statistical Institute, <a href="https://www.ine.es/">https://www.ine.es/</a>.
</p>

<hr>
<h2 id='distribute_excess'>Randomly distributes the excess of recorded births in a given day</h2><span id='topic+distribute_excess'></span>

<h3>Description</h3>

<p>Randomly distributes a number of births equivalent to the excess of registered births on a given day of a year among the different days of that year.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>distribute_excess(
  date.birth,
  day = "01-01",
  maximum.excess = 50,
  date.event = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="distribute_excess_+3A_date.birth">date.birth</code></td>
<td>
<p>A character vector with the dates of birth in format either &quot;yyyy-mm-dd&quot; or &quot;yyyy-mm-dd hour:min:secs&quot; (for instance, &quot;2016-01-20 12:00:00&quot;) of a population.</p>
</td></tr>
<tr><td><code id="distribute_excess_+3A_day">day</code></td>
<td>
<p>A character vector in format &quot;mm-dd&quot; with the day of the year for which the (assumed) excess must be randomly distributed. By default, &quot;01-01&quot;.</p>
</td></tr>
<tr><td><code id="distribute_excess_+3A_maximum.excess">maximum.excess</code></td>
<td>
<p>A numeric value indicating the percentage of births registered above the average to be surpassed in the target day in order to consider that in that day
an excess of births has been artificially recorded.</p>
</td></tr>
<tr><td><code id="distribute_excess_+3A_date.event">date.event</code></td>
<td>
<p>A character vector with the dates of events in format either &quot;yyyy-mm-dd&quot; or &quot;yyyy-mm-dd hour:min:secs&quot; (for instance, &quot;2016-01-20 12:00:00&quot;) linked to the
population of births. By default, NULL. When the dates of births are linked to some dates of events and both
occur in the same year, it can happen that some imputed dates of births be posterior to the dates of events.
The inclusion of this argument (when different of NULL) avoids this possibility happening.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector of the same length and order as data.birth.
</p>


<h3>Note</h3>

<p>We consider that in a day an excess of births has been registered if the percentage of the number of
births recorded in that day surpasses the average number of births registered during the days of the
corresponding year in a amount higher than 'maximum.excess'.
</p>
<p>An excess usually happens in official statistics on the first of January. This occurs as a consequence of
established protocols in country border systems, because when an immigrant does not know her/his day
of birth, the border officials usually record them as January, 1. This provokes an artificial peak of dates of births
in that date.
</p>


<h3>Author(s)</h3>

<p>Josep Lledo <a href="mailto:josep.lledo@uv.es">josep.lledo@uv.es</a>
</p>
<p>Jose M. Pavia <a href="mailto:pavia@uv.es">pavia@uv.es</a>
</p>


<h3>References</h3>

<p>Pavia, JM and Lledo, J (2022). Estimation of the Combined Effects of Ageing and Seasonality on Mortality Risk. An application to Spain. *Journal of the Royal Statistical Society, Series A (Statistics in Society)*, 185(2), 471-497. <a href="https://doi.org/10.1111/rssa.12769">doi:10.1111/rssa.12769</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+time_exposed_ins">time_exposed_ins</a></code>, <code><a href="#topic+time_exposed_outs">time_exposed_outs</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
dates &lt;- c("1920-05-13", "1999-04-12", "2019-01-01", "2019-01-01",
           "2022-01-01", "2022-01-01", "2022-01-01", "2022-01-01", "2022-01-01")
distribute_excess(dates)
</code></pre>

<hr>
<h2 id='emi_2006'>
Male emigrants recorded in Comunitat Valenciana (Spain) during year 2006.
</h2><span id='topic+emi_2006'></span>

<h3>Description</h3>

<p>Data frame containing the dates of birth and emigration of a random sample composed by half of all men who emigrated from the region of Comunitat Valenciana (Spain) during the year 2006.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(emi_2006)</code></pre>


<h3>Format</h3>

<p>A data frame containing 18,006 rows and 2 columns:
</p>

<dl>
<dt>date.birth</dt><dd><p>Dates of birth in format &quot;yyyy-mm-dd&quot;.</p>
</dd>
<dt>date.emi</dt><dd><p>Dates of death in format &quot;yyyy-mm-dd&quot;.</p>
</dd>
</dl>


<h3>Source</h3>

<p>National Statistical Institute, <a href="https://www.ine.es/">https://www.ine.es/</a>.
</p>

<hr>
<h2 id='exact_age'>Time elapsed (in years) since the dates of birth and event.</h2><span id='topic+exact_age'></span>

<h3>Description</h3>

<p>Computes the time(s) elapsed (in years) between the date(s) of birth and the date(s) of event(s).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>exact_age(
  date.birth,
  date.event,
  random.b = TRUE,
  random.e = TRUE,
  constant.age.year = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="exact_age_+3A_date.birth">date.birth</code></td>
<td>
<p>A character vector with the dates of birth in format either &quot;yyyy-mm-dd&quot; or &quot;yyyy-mm-dd hour:min:secs&quot; (for instance, &quot;2016-01-20 12:00:00&quot;) of a population.
If &quot;hour:min:secs&quot; is omitted the function imputes either &quot;12:00:00&quot;, if 'random.b = FALSE', or
a random hour by default.</p>
</td></tr>
<tr><td><code id="exact_age_+3A_date.event">date.event</code></td>
<td>
<p>A character vector with the dates of events in format either &quot;yyyy-mm-dd&quot; or &quot;yyyy-mm-dd hour:min:secs&quot; (for instance, &quot;2016-01-20 12:00:00&quot;) of a population.
If &quot;hour:min:secs&quot; is omitted the function imputes either &quot;12:00:00&quot;, if 'random.e = FALSE', or
a random hour, by default. This vector must have either length 1, when the aim is to compute
the exact age of all the members of the population in the same temporal point or the same
length as 'date.birth' when the aim is to compute for each member
of the population the exact age in the moment of the event (e.g., death).</p>
</td></tr>
<tr><td><code id="exact_age_+3A_random.b">random.b</code></td>
<td>
<p>A 'TRUE/FALSE' argument indicating whether the exact moment (&quot;hour:min:secs&quot;) when the birth occurs within the day is randomly selected. If TRUE, this overwrites &quot;hour:min:secs&quot; in 'date.birth' even if those have been declared. By default, TRUE.</p>
</td></tr>
<tr><td><code id="exact_age_+3A_random.e">random.e</code></td>
<td>
<p>A 'TRUE/FALSE' argument indicating whether the exact moment (&quot;hour:min:secs&quot;) when the event occurs within the day is randomly selected. If TRUE, this overwrites &quot;hour:min:secs&quot; in 'date.event' even if those have been declared. By default, TRUE.</p>
</td></tr>
<tr><td><code id="exact_age_+3A_constant.age.year">constant.age.year</code></td>
<td>
<p>A 'TRUE/FALSE' argument indicating whether the length of the year should be constant, 365.25 days, or variable,
depending on the time lived for the person in each year since her/his dates of birth and event. By default, FALSE.
The advantage of using a non-constant (person-dependent) length of year is congruence when
estimating time exposed at risk: in each year the time exposed along the time and age axes will coincide.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector of the same length as data.birth
</p>


<h3>Note</h3>

<p>If 'constant.age.year = FALSE' (default), the length of the year for each person is computed as a weighted average of the lengths
of the years that the person has lived between the dates of birth and event using as weight the time lived for the person during
each year.
</p>


<h3>Author(s)</h3>

<p>Jose M. Pavia <a href="mailto:pavia@uv.es">pavia@uv.es</a>
</p>
<p>Josep Lledo <a href="mailto:josep.lledo@uv.es">josep.lledo@uv.es</a>
</p>


<h3>References</h3>

<p>Pavia, JM and Lledo, J (2022). Estimation of the Combined Effects of Ageing and Seasonality on Mortality Risk. An application to Spain. *Journal of the Royal Statistical Society, Series A (Statistics in Society)*, 185(2), 471-497. <a href="https://doi.org/10.1111/rssa.12769">doi:10.1111/rssa.12769</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+coord_age">coord_age</a></code>, <code><a href="#topic+coord_time">coord_time</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dates.b &lt;- c("1920-05-13", "1999-04-12", "2019-01-01")
dates.e &lt;- c("2002-03-23", "2009-04-12", "2019-01-01")
exact_age(dates.b, dates.e)
</code></pre>

<hr>
<h2 id='immi_2006'>
Half of the male immigrants recorded in Comunitat Valenciana (Spain) during year 2006.
</h2><span id='topic+immi_2006'></span>

<h3>Description</h3>

<p>Data frame containing the dates of birth and immigration of a random sample composed by half of all men who immigrate to the region of Comunitat Valenciana (Spain) during the year 2006.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(immi_2006)</code></pre>


<h3>Format</h3>

<p>A data frame containing 48,431 rows and 2 columns:
</p>

<dl>
<dt>date.birth</dt><dd><p>Dates of birth in format &quot;yyyy-mm-dd&quot;.</p>
</dd>
<dt>date.immi</dt><dd><p>Dates of death in format &quot;yyyy-mm-dd&quot;.</p>
</dd>
</dl>


<h3>Source</h3>

<p>National Statistical Institute, <a href="https://www.ine.es/">https://www.ine.es/</a>.
</p>

<hr>
<h2 id='plot.qlifetable'>Graphical representation in a 4x4 raster of a qlifetable data frame.</h2><span id='topic+plot.qlifetable'></span>

<h3>Description</h3>

<p>Plot method for a data frame of events or time exposed occurring in each Lexis-diagram quarter for a set of ages.
This is a plot method for the objects typically obtained using the function <code><a href="#topic+count_events_quarter">count_events_quarter</a></code> or whatever of the time_exposed_ functions (e.g., <code><a href="#topic+time_exposed_outs">time_exposed_outs</a></code>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'qlifetable'
plot(
  x,
  ...,
  range.ages = NULL,
  key = "numbers",
  decimal.digits = 2,
  color.palette = "grey",
  alpha.max = 1,
  alpha.min = 0.4,
  color.values = "black",
  big.mark = NULL,
  size.values = 3,
  legend.name = NULL,
  name.labels.age = c("Q1", "Q2", "Q3", "Q4"),
  name.labels.season = c("Winter", "Spring", "Summer", "Autumn"),
  show.plot = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.qlifetable_+3A_x">x</code></td>
<td>
<p>A data frame of quarterly summary statistics. Typically an output of the function <code><a href="#topic+count_events_quarter">count_events_quarter</a></code> or whatever of the time_exposed_ functions (e.g., <code><a href="#topic+time_exposed_outs">time_exposed_outs</a></code>).</p>
</td></tr>
<tr><td><code id="plot.qlifetable_+3A_...">...</code></td>
<td>
<p>Other arguments passed on to methods. Not currently used.</p>
</td></tr>
<tr><td><code id="plot.qlifetable_+3A_range.ages">range.ages</code></td>
<td>
<p>A vector of integers informing the aggregation of ages for which the graphical representation should be plotted. Default, NULL, the agggregation of all ages is shown.</p>
</td></tr>
<tr><td><code id="plot.qlifetable_+3A_key">key</code></td>
<td>
<p>Type of statistic to be presented in the plot. Either &quot;numbers&quot; or relative &quot;percentages&quot;. Default, &quot;numbers&quot;.</p>
</td></tr>
<tr><td><code id="plot.qlifetable_+3A_decimal.digits">decimal.digits</code></td>
<td>
<p>Integer indicating the number of decimal places to be shown. Default, 2.</p>
</td></tr>
<tr><td><code id="plot.qlifetable_+3A_color.palette">color.palette</code></td>
<td>
<p>Background base color for cells. Default, &quot;grey&quot;.</p>
</td></tr>
<tr><td><code id="plot.qlifetable_+3A_alpha.max">alpha.max</code></td>
<td>
<p>A number in the interval [0, 1]. Maximum level of transparency to be applied for the background to build the palette. Default, 1.</p>
</td></tr>
<tr><td><code id="plot.qlifetable_+3A_alpha.min">alpha.min</code></td>
<td>
<p>A number in the interval [0, 1]. Minimum level of transparency to be applied for the background to build the palette. Default, 0.4.</p>
</td></tr>
<tr><td><code id="plot.qlifetable_+3A_color.values">color.values</code></td>
<td>
<p>Base color for numbers printed in each cell. Default, &quot;black&quot;.</p>
</td></tr>
<tr><td><code id="plot.qlifetable_+3A_big.mark">big.mark</code></td>
<td>
<p>A character string indicating the symbol to be used as thousand separator. Default, NULL.</p>
</td></tr>
<tr><td><code id="plot.qlifetable_+3A_size.values">size.values</code></td>
<td>
<p>A number indicating the font size to be used for inner-cells values. Default, 3.</p>
</td></tr>
<tr><td><code id="plot.qlifetable_+3A_legend.name">legend.name</code></td>
<td>
<p>Name to be use as name in the legend. Default, NULL.</p>
</td></tr>
<tr><td><code id="plot.qlifetable_+3A_name.labels.age">name.labels.age</code></td>
<td>
<p>Names to be used for the (y) age axis. Default, c(&quot;Q1&quot;, &quot;Q2&quot;, &quot;Q3&quot;, &quot;Q4&quot;).</p>
</td></tr>
<tr><td><code id="plot.qlifetable_+3A_name.labels.season">name.labels.season</code></td>
<td>
<p>Names to be used for the (x) season axis. Default, c(&quot;Winter&quot;, &quot;Spring&quot;, &quot;Summer&quot;, &quot;Autumn&quot;).</p>
</td></tr>
<tr><td><code id="plot.qlifetable_+3A_show.plot">show.plot</code></td>
<td>
<p>A TRUE/FALSE indicating if the plot should be displayed as a side-effect. By default, TRUE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisibly returns the (ggplot) description of the plot, which is a list with components that contain the plot itself, the data, information about the scales, panels, etc.
</p>


<h3>Note</h3>

<p>ggplot2 is needed to be installed for this function to work.
</p>


<h3>Author(s)</h3>

<p>Josep Lledo <a href="mailto:josep.lledo@uv.es">josep.lledo@uv.es</a>
</p>
<p>Jose M. Pavia, <a href="mailto:pavia@uv.es">pavia@uv.es</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dates.b &lt;- c("1920-05-13", "1999-04-12", "2019-01-01")
dates.e &lt;- c("2002-03-23", "2009-04-12", "2019-01-01")
x &lt;- quarterly_variables(dates.b, dates.e)
out &lt;- time_exposed_outs(x)
p &lt;- plot(out, show.plot = FALSE)
</code></pre>

<hr>
<h2 id='plot.SAI'>Graphical representation of a SAI object.</h2><span id='topic+plot.SAI'></span>

<h3>Description</h3>

<p>Plot method for a SAI object. This is a plot method for objects obtained using the <code><a href="#topic+compute_SAI">compute_SAI</a></code> function
or the <code><a href="#topic+SAI_shortcut_1">SAI_shortcut_1</a></code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'SAI'
plot(
  x,
  ...,
  min.age = 1,
  max.age = 100,
  decimal.digits = 1,
  color.main = "black",
  color.lm = "blue",
  color.hline = "red",
  size.labels.y = 8,
  axis.age.ticks,
  limits.joint,
  breaks.joint,
  limits.ageing,
  breaks.ageing,
  limits.seasonal,
  breaks.seasonal,
  name.labels.ageing = c("Q1", "Q2", "Q3", "Q4"),
  name.labels.season = c("Winter", "Spring", "Summer", "Autumn"),
  title.season = "Seasonal effects",
  title.ageing = "Ageing effects",
  x.title = "Age",
  show.plot = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.SAI_+3A_x">x</code></td>
<td>
<p>An object output of the <code><a href="#topic+compute_SAI">compute_SAI</a></code> or <code><a href="#topic+SAI_shortcut_1">SAI_shortcut_1</a></code> functions.</p>
</td></tr>
<tr><td><code id="plot.SAI_+3A_...">...</code></td>
<td>
<p>Other arguments passed on to methods. Not currently used.</p>
</td></tr>
<tr><td><code id="plot.SAI_+3A_min.age">min.age</code></td>
<td>
<p>A positive integer informing about the initial minimal age of the range of ages to be represented.
This minimum age can be increased depending on the ages available in the SAI estimates.
Default, 1.</p>
</td></tr>
<tr><td><code id="plot.SAI_+3A_max.age">max.age</code></td>
<td>
<p>A positive integer informing about the initial maximum age of the range of ages to be represented.
This maximum age can be decreased depending on the ages available in the SAI estimates.
Default, 100.</p>
</td></tr>
<tr><td><code id="plot.SAI_+3A_decimal.digits">decimal.digits</code></td>
<td>
<p>Integer indicating the number of decimal places to be shown. Default, 1.</p>
</td></tr>
<tr><td><code id="plot.SAI_+3A_color.main">color.main</code></td>
<td>
<p>Color of the line corresponding to the estimated, normalized SAI. Default, &quot;black&quot;.</p>
</td></tr>
<tr><td><code id="plot.SAI_+3A_color.lm">color.lm</code></td>
<td>
<p>Color of the lm line. Default, &quot;blue&quot;.</p>
</td></tr>
<tr><td><code id="plot.SAI_+3A_color.hline">color.hline</code></td>
<td>
<p>Color of the hline (reference) line. Default, &quot;red&quot;.</p>
</td></tr>
<tr><td><code id="plot.SAI_+3A_size.labels.y">size.labels.y</code></td>
<td>
<p>Number informing the size of the labels of SAI axis. Default, 8.</p>
</td></tr>
<tr><td><code id="plot.SAI_+3A_axis.age.ticks">axis.age.ticks</code></td>
<td>
<p>Optional vector with the values to be presented in the age axis.</p>
</td></tr>
<tr><td><code id="plot.SAI_+3A_limits.joint">limits.joint</code></td>
<td>
<p>Optional vector of length 2 with the limits for the SAI axis of the main plot.</p>
</td></tr>
<tr><td><code id="plot.SAI_+3A_breaks.joint">breaks.joint</code></td>
<td>
<p>Optional vector with the values to be presented in the SAI axis of the main plot.</p>
</td></tr>
<tr><td><code id="plot.SAI_+3A_limits.ageing">limits.ageing</code></td>
<td>
<p>Optional vector of length 2 with the limits for the SAI axis of the marginal ageing SAI plot.</p>
</td></tr>
<tr><td><code id="plot.SAI_+3A_breaks.ageing">breaks.ageing</code></td>
<td>
<p>Optional vector with the values to be presented in the SAI axis of the marginal ageing SAI plot.</p>
</td></tr>
<tr><td><code id="plot.SAI_+3A_limits.seasonal">limits.seasonal</code></td>
<td>
<p>Optional vector of length 2 with the limits for the SAI axis of the marginal seasonal (calendar) SAI plot.</p>
</td></tr>
<tr><td><code id="plot.SAI_+3A_breaks.seasonal">breaks.seasonal</code></td>
<td>
<p>Optional vector with the values to be presented in the SAI axis of the marginal seasonal (calendar) SAI plot.</p>
</td></tr>
<tr><td><code id="plot.SAI_+3A_name.labels.ageing">name.labels.ageing</code></td>
<td>
<p>Names to be used for the (y) ageing axis. Default, c(&quot;Q1&quot;, &quot;Q2&quot;, &quot;Q3&quot;, &quot;Q4&quot;).</p>
</td></tr>
<tr><td><code id="plot.SAI_+3A_name.labels.season">name.labels.season</code></td>
<td>
<p>Names to be used for the (x) season (calendar) axis. Default, c(&quot;Winter&quot;, &quot;Spring&quot;, &quot;Summer&quot;, &quot;Autumn&quot;).</p>
</td></tr>
<tr><td><code id="plot.SAI_+3A_title.season">title.season</code></td>
<td>
<p>Name to be used for identifying the seasonal marginal panels. Default, &quot;Seasonal effects&quot;.</p>
</td></tr>
<tr><td><code id="plot.SAI_+3A_title.ageing">title.ageing</code></td>
<td>
<p>Name to be used for identifying the ageing marginal panels. Default, &quot;Ageing effects&quot;.</p>
</td></tr>
<tr><td><code id="plot.SAI_+3A_x.title">x.title</code></td>
<td>
<p>Name to be used for the x axis. Default, &quot;Age&quot;.</p>
</td></tr>
<tr><td><code id="plot.SAI_+3A_show.plot">show.plot</code></td>
<td>
<p>A TRUE/FALSE value indicating whether the plot should be displayed as a side-effect. By default, TRUE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisibly returns the grob description of the plot, which is a list with components that contain the plot itself, the data, information about the scales, panels, etc.
</p>


<h3>Note</h3>

<p>ggplot2 and gridExtra packages are needed to be installed for this function to work.
</p>


<h3>Author(s)</h3>

<p>Jose M. Pavia, <a href="mailto:pavia@uv.es">pavia@uv.es</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# This can take a while
 t.stock &lt;- time_exposed_stock(pop_2006$date.birth, 2006, "forward")
 t.stock &lt;- t.stock[t.stock$age &lt;= 100, ]
 temp &lt;- quarterly_variables(death_2006$date.birth, death_2006$date.death)
 e.death &lt;- count_events_quarter(temp)
 e.death &lt;- e.death[e.death$age &lt;= 100, ]
 t.birth &lt;- time_exposed_newborns(birth_2006$date.birth)
 out &lt;- crude_mx(t.stock, e.death, time.birth = t.birth)
 SAI.example &lt;- compute_SAI(out, out)
 p &lt;- plot(SAI.example, show.plot = FALSE)

</code></pre>

<hr>
<h2 id='pop_2006'>
Half of the male population living in the Comunitat Valenciana (Spain) on January, 1 2006.
</h2><span id='topic+pop_2006'></span>

<h3>Description</h3>

<p>Data frame containing the dates of birth of a random sample composed by half of all men who were alive on 1 January 2006 in the region of Comunitat Valenciana (Spain).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(pop_2006)</code></pre>


<h3>Format</h3>

<p>A data frame containing 1,197,154 rows and 1 column:
</p>

<dl>
<dt>date.birth</dt><dd><p>Dates of birth in format &quot;yyyy-mm-dd&quot;.</p>
</dd>
</dl>


<h3>Source</h3>

<p>Instituto Valenciano de Estadistica (IVE) <a href="https://pegv.gva.es/es/">https://pegv.gva.es/es/</a>.
</p>

<hr>
<h2 id='quarterly_variables'>Data frame of quarterly variables</h2><span id='topic+quarterly_variables'></span>

<h3>Description</h3>

<p>Computes punctual risk coordinates in the Lexis diagram and quarterly biometric
variables of a population.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>quarterly_variables(
  date.birth,
  date.event,
  random.b = TRUE,
  random.e = TRUE,
  constant.age.year = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="quarterly_variables_+3A_date.birth">date.birth</code></td>
<td>
<p>A character vector with the dates of birth in format either &quot;yyyy-mm-dd&quot; or &quot;yyyy-mm-dd hour:min:secs&quot; (for instance, &quot;2016-01-20 12:00:00&quot;) of a population.
If &quot;hour:min:secs&quot; is omitted the function imputes either &quot;12:00:00&quot;, if 'random.b = FALSE', or
a random hour by default.</p>
</td></tr>
<tr><td><code id="quarterly_variables_+3A_date.event">date.event</code></td>
<td>
<p>A character vector with the dates of events in format either &quot;yyyy-mm-dd&quot; or &quot;yyyy-mm-dd hour:min:secs&quot; (for instance, &quot;2016-01-20 12:00:00&quot;) of a population.
If &quot;hour:min:secs&quot; is omitted the function imputes either &quot;12:00:00&quot;, if 'random.e = FALSE', or
a random hour, by default. This vector must have either length 1, when the aim is to compute
the exact age or the (1x1-Lexis) age coordinate of all the members of the population in the same temporal point or the same
length as 'date.birth' when the aim is to compute for each member
of the population the exact age or the (1x1-Lexis) age coordinate in the moment of the event (e.g., death).</p>
</td></tr>
<tr><td><code id="quarterly_variables_+3A_random.b">random.b</code></td>
<td>
<p>A 'TRUE/FALSE' argument indicating whether the exact moment (&quot;hour:min:secs&quot;) when the birth occurs within the day is randomly selected. If TRUE, this overwrites &quot;hour:min:secs&quot; in 'date.birth' even if those have been declared. By default, TRUE.</p>
</td></tr>
<tr><td><code id="quarterly_variables_+3A_random.e">random.e</code></td>
<td>
<p>A 'TRUE/FALSE' argument indicating whether the exact moment (&quot;hour:min:secs&quot;) when the event occurs within the day is randomly selected. If TRUE, this overwrites &quot;hour:min:secs&quot; in 'date.event' even if those have been declared. By default, TRUE.</p>
</td></tr>
<tr><td><code id="quarterly_variables_+3A_constant.age.year">constant.age.year</code></td>
<td>
<p>A 'TRUE/FALSE' argument indicating whether the length of the year should be constant, 365.25 days, or variable,
depending on the time lived for the person in each year since her/his dates of birth and event. By default, FALSE.
The advantage of using a non-constant (person-dependent) length of year is congruence when
estimating time exposed at risk: in each year the time exposed along the time and age axes will coincide.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame with the following components:
</p>
<table role = "presentation">
<tr><td><code>coord.age</code></td>
<td>
<p> Time elapsed, measure in years, between the last birthday and the date when the event happens.</p>
</td></tr>
<tr><td><code>coord.time</code></td>
<td>
<p> Time coordinate: time elapsed, measure in years, between the begining of the year and the date when the event happens.</p>
</td></tr>
<tr><td><code>age.last.birthday</code></td>
<td>
<p> The integer age at last birthday.</p>
</td></tr>
<tr><td><code>exact.age.at.event</code></td>
<td>
<p> Time elapsed, measure in years, between the dates of birth and event.</p>
</td></tr>
<tr><td><code>quarter.age</code></td>
<td>
<p> Age quarter when the event happens.</p>
</td></tr>
<tr><td><code>quarter.calendar</code></td>
<td>
<p> Calendar (time, season) quarter to which the time exposed at risk corresponds.</p>
</td></tr>
<tr><td><code>year</code></td>
<td>
<p> Year when the event happens.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>In the age axis, the length of the years are assumed either constant 365.25 days ('constant.age.year = TRUE') or
variable ('constant.age.year = FALSE'), depending on the person. In the time axis, the length of the year is either
365 in non-leap years and 366 in leap years. The advantage of using a non-constant (person-dependent) length of year
in the age axis is that in each year the lengths of the years when computing 'coord.age' and 'coord.time'
in both axis are equal.
</p>


<h3>Author(s)</h3>

<p>Jose M. Pavia <a href="mailto:pavia@uv.es">pavia@uv.es</a>
</p>
<p>Josep Lledo <a href="mailto:josep.lledo@uv.es">josep.lledo@uv.es</a>
</p>


<h3>References</h3>

<p>Pavia, JM and Lledo, J (2022). Estimation of the Combined Effects of Ageing and Seasonality on Mortality Risk. An application to Spain. *Journal of the Royal Statistical Society, Series A (Statistics in Society)*, 185(2), 471-497. <a href="https://doi.org/10.1111/rssa.12769">doi:10.1111/rssa.12769</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dates.b &lt;- c("1920-05-13", "1999-04-12", "2019-01-01")
dates.e &lt;- c("2002-03-23", "2009-04-12", "2019-01-01")
quarterly_variables(dates.b, dates.e)
</code></pre>

<hr>
<h2 id='SAI_shortcut_1'>Estimates seasonal-ageing indexes using shortcut 1.</h2><span id='topic+SAI_shortcut_1'></span>

<h3>Description</h3>

<p>Given a set of data frames with the number of deaths recorded in a population/portfolio
during several years (periods) in a set of integer ages for each combination of age and
season/calendar quarter, this function approximates their corresponding seasonal-ageing indexes
by employing shortcut 1, based on equation (2.5), proposed in Pavia and Lledo (2023).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SAI_shortcut_1(x, y, ..., margins = FALSE, min.age = 0, max.age = 100)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="SAI_shortcut_1_+3A_x">x</code></td>
<td>
<p>A data frame with the number of deaths recorded in the population/portfolio during a period (typically a year)
in a set of integer ages for each combination of age and season/calendar quarter. Usually, this is an output
of the <code><a href="#topic+count_events_quarter">count_events_quarter</a></code> function (or a data frame with the same structure).</p>
</td></tr>
<tr><td><code id="SAI_shortcut_1_+3A_y">y</code></td>
<td>
<p>A data frame with the number of deaths recorded in the population/portfolio during another period
(typically a different year than the one corresponding to 'x') in a set of integer ages for each
combination of age and season/calendar quarter. Usually, this is an output
of the <code><a href="#topic+count_events_quarter">count_events_quarter</a></code> function (or a data frame with the same structure).</p>
</td></tr>
<tr><td><code id="SAI_shortcut_1_+3A_...">...</code></td>
<td>
<p>Further data frames similar to 'x' and 'y' corresponding to another period(s)/year(s).</p>
</td></tr>
<tr><td><code id="SAI_shortcut_1_+3A_margins">margins</code></td>
<td>
<p>A 'TRUE/FALSE' argument informing whether or not the marginal seasonal and ageing indexes should be also
computed. Default, 'FALSE'.</p>
</td></tr>
<tr><td><code id="SAI_shortcut_1_+3A_min.age">min.age</code></td>
<td>
<p>A non-negative integer informing about the initial minimal age for which SAIs must be computed. This minimum age can
be increased depending on the ages for which there are crude mx estimates (exposed-at-risk) in the objects  'x', 'y', '...'. Default, 0.</p>
</td></tr>
<tr><td><code id="SAI_shortcut_1_+3A_max.age">max.age</code></td>
<td>
<p>A positive integer informing about the initial maximum age for which SAIs must be computed. This maximum age can
be decreased depending on the maximum ages for which there are crude mx estimates (exposed-at-risk) in the objects  'x', 'y', '...'.
Default, 100.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>When 'margins = FALSE' a data frame with the (raw, normalized and linearized) estimated seasonal-ageing
indexes (SAI) corresponding to the set of integer ages determined by 'min.age' and 'max.age' and the ages
for which there is a least a death in the data frames introduced via the 'x', 'y' and '...' arguments for
each combination of age and calendar quarter. The data frame has the following components:
</p>
<table role = "presentation">
<tr><td><code>age</code></td>
<td>
<p> Integer age to which the SAIs corresponds.</p>
</td></tr>
<tr><td><code>quarter.age</code></td>
<td>
<p> Age quarter to which the SAIs corresponds.</p>
</td></tr>
<tr><td><code>quarter.calendar</code></td>
<td>
<p> Calendar (time, season) quarter to which the SAIs corresponds.</p>
</td></tr>
<tr><td><code>SAI.raw</code></td>
<td>
<p> Estimates of raw seasonal-ageing indexes for each combination of 'age', 'quarter.age' and 'quarter.calendar'.</p>
</td></tr>
<tr><td><code>SAI.norm</code></td>
<td>
<p> Estimates of seasonal-ageing indexes, attained after normalizing raw SAIs estimates, for each  combination of 'age', 'quarter.age' and 'quarter.calendar'.</p>
</td></tr>
<tr><td><code>SAI.lin</code></td>
<td>
<p> Final estimates of seasonal-ageing indexes, attained after linearizing normalized SAIs estimates,  for each combination of 'age', 'quarter.age' and 'quarter.calendar'.</p>
</td></tr>
</table>
<p>When 'margins = TRUE' the output is a list with three data frames 'SAI', 'SAI.age' and 'SAI.quarter'.
'SAI' is defined as just described above. 'SAI.age' and  'SAI.quarter' contains, in a similar vein than 'SAI',
the estimated marginal SAIs, corresponding to, respectively, the age quarter and the calendar (time, season)
quarter.
</p>


<h3>Author(s)</h3>

<p>Jose M. Pavia <a href="mailto:pavia@uv.es">pavia@uv.es</a>
</p>
<p>Josep Lledo <a href="mailto:josep.lledo@uv.es">josep.lledo@uv.es</a>
</p>


<h3>References</h3>

<p>Pavia, JM and Lledo, J (2023). Shortcuts for the construction of sub-annual life tables. *ASTIN Bulletin: The Journal of the International Actuarial Association*, 53(2), 332-350. <a href="https://doi.org/10.1017/asb.2023.16">doi:10.1017/asb.2023.16</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# This can take a while
 temp &lt;- quarterly_variables(death_2006$date.birth, death_2006$date.death)
 e.death &lt;- count_events_quarter(temp)
 SAI.example &lt;- SAI_shortcut_1(e.death, e.death)


# Fast example
dates.b &lt;- c("2017-05-13", "2018-04-12", "2018-01-01")
dates.d &lt;- c("2020-09-23", "2021-10-11", "2021-11-23")
x &lt;- quarterly_variables(dates.b, dates.d)
e.death &lt;- count_events_quarter(x)
SAI.example &lt;- SAI_shortcut_1(e.death, e.death)
</code></pre>

<hr>
<h2 id='time_exposed_ins'>Data frame of time exposed at risk for a population of immigrants/portfolio entries</h2><span id='topic+time_exposed_ins'></span>

<h3>Description</h3>

<p>Computes for each integer age and each combination of age and seasonal quarter
the total time exposed at risk (in years) of a population of immigrants/new policies
(new production) during the year of the event.
The computation is performed using the associated data frame of quarterly variables
corresponding to the population obtained using the <code><a href="#topic+quarterly_variables">quarterly_variables</a></code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>time_exposed_ins(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="time_exposed_ins_+3A_x">x</code></td>
<td>
<p>A data.frame output of the <code><a href="#topic+quarterly_variables">quarterly_variables</a></code> function.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with the time exposed at risk for each (potential) combination of integer age and age and
season quarter of the input dataset. The data frame has the following components:
</p>
<table role = "presentation">
<tr><td><code>age</code></td>
<td>
<p> Integer age to which the time exposed at risk corresponds.</p>
</td></tr>
<tr><td><code>quarter.age</code></td>
<td>
<p> Age quarter to which the time exposed at risk corresponds.</p>
</td></tr>
<tr><td><code>quarter.calendar</code></td>
<td>
<p> Calendar (time, season) quarter to which the time exposed at risk corresponds.</p>
</td></tr>
<tr><td><code>time.exposed</code></td>
<td>
<p> Total time (in years) exposed at risk of the population during the quarter determined for the
combination of 'age', 'quarter.age' and 'quarter.calendar'.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>The time exposed at risk is computed for each death from the beginning of the year in which the event occurred
until the moment of occurrence of the event. Please see the note in the <code><a href="#topic+time_exposed_stock">time_exposed_stock</a></code> function.
</p>


<h3>Author(s)</h3>

<p>Josep Lledo <a href="mailto:josep.lledo@uv.es">josep.lledo@uv.es</a>
</p>
<p>Jose M. Pavia <a href="mailto:pavia@uv.es">pavia@uv.es</a>
</p>


<h3>References</h3>

<p>Pavia, JM and Lledo, J (2022). Estimation of the Combined Effects of Ageing and Seasonality on Mortality Risk. An application to Spain. *Journal of the Royal Statistical Society, Series A (Statistics in Society)*, 185(2), 471-497. <a href="https://doi.org/10.1111/rssa.12769">doi:10.1111/rssa.12769</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+time_exposed_stock">time_exposed_stock</a></code>, <code><a href="#topic+time_exposed_outs">time_exposed_outs</a></code>, <code><a href="#topic+time_exposed_newborns">time_exposed_newborns</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dates.b &lt;- c("1920-05-13", "1999-04-12", "2019-01-01")
dates.e &lt;- c("2002-03-23", "2009-04-12", "2019-01-01")
x &lt;- quarterly_variables(dates.b, dates.e)
out &lt;- time_exposed_ins(x)
</code></pre>

<hr>
<h2 id='time_exposed_newborns'>Data frame of time exposed at risk for a population of newborns</h2><span id='topic+time_exposed_newborns'></span>

<h3>Description</h3>

<p>Computes for each combination of age and seasonal quarter
the total time exposed at risk (in years) of a population of newborns,
during the year of their birth, this is up to the end of the year when they born.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>time_exposed_newborns(date.birth, random.b = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="time_exposed_newborns_+3A_date.birth">date.birth</code></td>
<td>
<p>A character vector with the dates of birth in format either &quot;yyyy-mm-dd&quot; or &quot;yyyy-mm-dd hour:min:secs&quot; (for instance, &quot;2016-01-20 12:00:00&quot;) of the members of the population.
If &quot;hour:min:secs&quot; is omitted the function imputes either &quot;12:00:00&quot;, if 'random.b = FALSE', or
a random hour by default.</p>
</td></tr>
<tr><td><code id="time_exposed_newborns_+3A_random.b">random.b</code></td>
<td>
<p>A 'TRUE/FALSE' argument indicating whether the exact moment (&quot;hour:min:secs&quot;) when the birth occurs within the day is randomly selected. If TRUE, this overwrites &quot;hour:min:secs&quot; in 'date.birth' even if those have been declared. By default, TRUE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with the time exposed at risk for each (potential) combination of integer age and age and
season quarter of the population. The data frame has the following components:
</p>
<table role = "presentation">
<tr><td><code>age</code></td>
<td>
<p> Integer age to which the time exposed at risk corresponds.</p>
</td></tr>
<tr><td><code>quarter.age</code></td>
<td>
<p> Age quarter to which the time exposed at risk corresponds.</p>
</td></tr>
<tr><td><code>quarter.calendar</code></td>
<td>
<p> Calendar (time, season) quarter to which the time exposed at risk corresponds.</p>
</td></tr>
<tr><td><code>time.exposed</code></td>
<td>
<p> Total time (in years) exposed at risk of the population during the quarter determined for the
combination of 'age', 'quarter.age' and 'quarter.season'.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jose M. Pavia <a href="mailto:pavia@uv.es">pavia@uv.es</a>
</p>
<p>Josep Lledo <a href="mailto:josep.lledo@uv.es">josep.lledo@uv.es</a>
</p>


<h3>References</h3>

<p>Pavia, JM and Lledo, J (2022). Estimation of the Combined Effects of Ageing and Seasonality on Mortality Risk. An application to Spain. *Journal of the Royal Statistical Society, Series A (Statistics in Society)*, 185(2), 471-497. <a href="https://doi.org/10.1111/rssa.12769">doi:10.1111/rssa.12769</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+time_exposed_stock">time_exposed_stock</a></code>, <code><a href="#topic+time_exposed_outs">time_exposed_outs</a></code>, <code><a href="#topic+time_exposed_ins">time_exposed_ins</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dates.b &lt;- c("1920-05-13", "1999-04-12", "2019-01-01")
out &lt;- time_exposed_newborns(dates.b)
</code></pre>

<hr>
<h2 id='time_exposed_outs'>Data frame of time exposed at risk for a population of deaths/emigrants/exits (portfolio withdrawals, lapses) during the year of the event.</h2><span id='topic+time_exposed_outs'></span>

<h3>Description</h3>

<p>Computes for each integer age and each combination of age and seasonal quarter
the total time exposed at risk (in years) of a population of deceased/emigrants/exits
(portfolio withdrawals, lapses) during the year of the event.
The computation is performed using the associated data frame of quarterly variables
corresponding to the population obtained using the <code><a href="#topic+quarterly_variables">quarterly_variables</a></code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>time_exposed_outs(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="time_exposed_outs_+3A_x">x</code></td>
<td>
<p>A data.frame output of the <code><a href="#topic+quarterly_variables">quarterly_variables</a></code> function.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with the time exposed at risk for each (potential) combination of integer age and age and
season quarter of the input dataset. The data frame has the following components:
</p>
<table role = "presentation">
<tr><td><code>age</code></td>
<td>
<p> Integer age to which the time exposed at risk corresponds.</p>
</td></tr>
<tr><td><code>quarter.age</code></td>
<td>
<p> Age quarter to which the time exposed at risk corresponds.</p>
</td></tr>
<tr><td><code>quarter.calendar</code></td>
<td>
<p> Calendar (time, season) quarter to which the time exposed at risk corresponds.</p>
</td></tr>
<tr><td><code>time.exposed</code></td>
<td>
<p> Total time (in years) exposed at risk of the population during the quarter determined for the
combination of 'age', 'quarter.age' and 'quarter.calendar'.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>The time exposed at risk is computed for each person from the beginning of the year in which the event occurred
until the moment of occurrence of the event. Please see the note in the <code><a href="#topic+time_exposed_stock">time_exposed_stock</a></code> function.
</p>


<h3>Author(s)</h3>

<p>Josep Lledo <a href="mailto:josep.lledo@uv.es">josep.lledo@uv.es</a>
</p>
<p>Jose M. Pavia <a href="mailto:pavia@uv.es">pavia@uv.es</a>
</p>


<h3>References</h3>

<p>Pavia, JM and Lledo, J (2022). Estimation of the Combined Effects of Ageing and Seasonality on Mortality Risk. An application to Spain. *Journal of the Royal Statistical Society, Series A (Statistics in Society)*, 185(2), 471-497. <a href="https://doi.org/10.1111/rssa.12769">doi:10.1111/rssa.12769</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+time_exposed_stock">time_exposed_stock</a></code>, <code><a href="#topic+time_exposed_newborns">time_exposed_newborns</a></code>, <code><a href="#topic+time_exposed_ins">time_exposed_ins</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dates.b &lt;- c("1920-05-13", "1999-04-12", "2019-01-01")
dates.e &lt;- c("2002-03-23", "2009-04-12", "2019-01-01")
x &lt;- quarterly_variables(dates.b, dates.e)
out &lt;- time_exposed_outs(x)
</code></pre>

<hr>
<h2 id='time_exposed_stock'>Data frame of time exposed at risk for a stock of general/insured population</h2><span id='topic+time_exposed_stock'></span>

<h3>Description</h3>

<p>Computes for each integer age and each combination of age and seasonal quarter
the total time exposed at risk (in years) of a (stock) population of survivors
(expected survivors) during a given year.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>time_exposed_stock(
  date.birth,
  year,
  type,
  random.b = TRUE,
  constant.age.year = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="time_exposed_stock_+3A_date.birth">date.birth</code></td>
<td>
<p>A character vector with the dates of birth in format either &quot;yyyy-mm-dd&quot; or &quot;yyyy-mm-dd hour:min:secs&quot; (for instance, &quot;2016-01-20 12:00:00&quot;) of the members of the population.
If &quot;hour:min:secs&quot; is omitted the function imputes either &quot;12:00:00&quot;, if 'random.b = FALSE', or
a random hour by default.</p>
</td></tr>
<tr><td><code id="time_exposed_stock_+3A_year">year</code></td>
<td>
<p>A numeric vector indicating the year for which the total time exposed at risk (by
quarter) of the population is to be computed.</p>
</td></tr>
<tr><td><code id="time_exposed_stock_+3A_type">type</code></td>
<td>
<p>A character argument informing if the total time exposed to risk is computed either since
the beginning of the year or from the end of the year, depending when the census (stock) of population
(portfolio) has been made. Only two values are allowed: '&quot;forward&quot;' and '&quot;backward&quot;'.
If 'type = &quot;forward&quot;' the time exposed to risk is computed since the beginning of the year
(i.e., it is assumed that the population counting has been performed at the beginning of the year
of interest).
If 'type = &quot;backward&quot;' the time exposed to risk is computed from the end of the year
(i.e., it is assumed that the population counting has been performed at the end of the year of interest).</p>
</td></tr>
<tr><td><code id="time_exposed_stock_+3A_random.b">random.b</code></td>
<td>
<p>A 'TRUE/FALSE' argument indicating whether the exact moment (&quot;hour:min:secs&quot;) when the birth occurs within the day is randomly selected. If TRUE, this overwrites &quot;hour:min:secs&quot; in 'date.birth' even if those have been declared. By default, TRUE.</p>
</td></tr>
<tr><td><code id="time_exposed_stock_+3A_constant.age.year">constant.age.year</code></td>
<td>
<p>A 'TRUE/FALSE' argument indicating whether the length of the year should be constant, 365.25 days, or variable,
depending on the time lived for the person in each year since her/his dates of birth and event. By default, FALSE.
The advantage of using a non-constant (person-dependent) length of year is congruence when
estimating time exposed at risk: in each year the time exposed along the time and age axes will coincide.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with the time exposed at risk for each (potential) combination of integer age and age and
season/calendar quarter of the population. The data frame has the following components:
</p>
<table role = "presentation">
<tr><td><code>age</code></td>
<td>
<p> Integer age to which the time exposed at risk corresponds.</p>
</td></tr>
<tr><td><code>quarter.age</code></td>
<td>
<p> Age quarter to which the time exposed at risk corresponds.</p>
</td></tr>
<tr><td><code>quarter.calendar</code></td>
<td>
<p> Calendar (time, season) quarter to which the time exposed at risk corresponds.</p>
</td></tr>
<tr><td><code>time.exposed</code></td>
<td>
<p> Total time (in years) exposed at risk of the population during the quarter determined for the
combination of 'age', 'quarter.age' and 'quarter.calendar'.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Using the notation of a general population, denoting by P the stock of population counted either at the
beginning or the end of the year, and by E, I, D and B the emigrants, immigrants, deaths and births recorded
during the year, to compute the total time exposed to risk they relate as follows:
</p>
<p>If the census (stock) of the population is performed at the beginning of the year of interest,
it is initially assumed that all the people is going to survive (is going to be at risk) up to
the end of the year. In this case 'type = &quot;forward&quot;' should be used and the total time exposed
at risk, in each age a and (r, s) quarter, is through:
T(a, r, s) = time_exposed_stock(P) + time_exposed_ins(I) - time_exposed_ins(E) -
time_exposed_ins(D) + time_exposed_newborns(B).
</p>
<p>If the census (stock) of population is performed at the end of the year of interest, only the people
who survives up to that date is included in the counting. In this case 'type = &quot;backward&quot;'
should be used and the total time exposed at risk, in each age a and (r, s) quarter, is computed
using the expression: T(a, r, s) = time_exposed_stock(P) - time_exposed_outs(I) + time_exposed_outs(E) +
time_exposed_outs(D).
</p>


<h3>Author(s)</h3>

<p>Jose M. Pavia <a href="mailto:pavia@uv.es">pavia@uv.es</a>
</p>
<p>Josep Lledo <a href="mailto:josep.lledo@uv.es">josep.lledo@uv.es</a>
</p>


<h3>References</h3>

<p>Pavia, JM and Lledo, J (2022). Estimation of the Combined Effects of Ageing and Seasonality on Mortality Risk. An application to Spain. *Journal of the Royal Statistical Society, Series A (Statistics in Society)*, 185(2), 471-497. <a href="https://doi.org/10.1111/rssa.12769">doi:10.1111/rssa.12769</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+time_exposed_ins">time_exposed_ins</a></code>, <code><a href="#topic+time_exposed_outs">time_exposed_outs</a></code>, <code><a href="#topic+time_exposed_newborns">time_exposed_newborns</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dates.b &lt;- c("1920-05-13", "1999-04-12", "2019-01-01")
out &lt;- time_exposed_stock(dates.b, year = 2019, type = "backward")
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
