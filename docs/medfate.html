<!DOCTYPE html><html><head><title>Help for package medfate</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {medfate}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#medfate-package'><p>medfate: Mediterranean Forest Simulation</p></a></li>
<li><a href='#biophysics'><p>Physical and biophysical utility functions</p></a></li>
<li><a href='#carbon'><p>Carbon-related functions</p></a></li>
<li><a href='#defaultControl'><p>Control parameters for simulation models</p></a></li>
<li><a href='#defaultManagementFunction'><p>Default forest management actions</p></a></li>
<li><a href='#defaultSoilParams'><p>Default soil parameters</p></a></li>
<li><a href='#droughtStress'><p>Drought stress indicators</p></a></li>
<li><a href='#evaluation'><p>Evaluation of simulations results</p></a></li>
<li><a href='#exampleforest'><p>Example forest stands</p></a></li>
<li><a href='#examplemeteo'><p>Example daily meteorology data</p></a></li>
<li><a href='#exampleobs'><p>Example observed data</p></a></li>
<li><a href='#extractSubdaily'><p>Extracts subdaily output</p></a></li>
<li><a href='#fire_behaviour'><p>Fire behaviour functions</p></a></li>
<li><a href='#fire_severity'><p>Fire severity functions</p></a></li>
<li><a href='#fireHazard'><p>Fire hazard</p></a></li>
<li><a href='#fordyn'><p>Forest dynamics</p></a></li>
<li><a href='#forest'><p>Forest description</p></a></li>
<li><a href='#forest_mergeTrees'><p>Forest merge functions</p></a></li>
<li><a href='#forest2aboveground'><p>Input for simulation models</p></a></li>
<li><a href='#fuel_properties'><p>Fuel stratification and fuel characteristics</p></a></li>
<li><a href='#growth'><p>Forest growth</p></a></li>
<li><a href='#growth_day'><p>Single-day simulation</p></a></li>
<li><a href='#herb_values'><p>Herbaceous description functions</p></a></li>
<li><a href='#hydraulics_conductancefunctions'><p>Hydraulic confuctance functions</p></a></li>
<li><a href='#hydraulics_scalingconductance'><p>Scaling from conductivity to conductance</p></a></li>
<li><a href='#hydraulics_supplyfunctions'><p>Hydraulic supply functions</p></a></li>
<li><a href='#hydrology_erFactor'><p>Rainfall interception</p></a></li>
<li><a href='#hydrology_soilEvaporationAmount'><p>Soil infiltration, percolation and bare soil evaporation</p></a></li>
<li><a href='#hydrology_verticalInputs'><p>Soil vertical inputs</p></a></li>
<li><a href='#light'><p>Radiation transfer functions</p></a></li>
<li><a href='#modifyParams'><p>Modify parameters</p></a></li>
<li><a href='#moisture'><p>Tissue moisture functions</p></a></li>
<li><a href='#mortality_dailyProbability'><p>Mortality</p></a></li>
<li><a href='#optimization'><p>Multiple model runs and function factories for optimization routines</p></a></li>
<li><a href='#Parameter+20means'>
<p>Parameter average values</p></a></li>
<li><a href='#pheno_updateLeaves'><p>Leaf phenology</p></a></li>
<li><a href='#photo'><p>Photosynthesis submodel functions</p></a></li>
<li><a href='#plant_values'><p>Woody plant cohort description functions</p></a></li>
<li><a href='#plot.forest'><p>Plot forest attributes</p></a></li>
<li><a href='#plot.spwb'><p>Plots simulation results</p></a></li>
<li><a href='#plot.spwb_day'><p>Plots simulation results for one day</p></a></li>
<li><a href='#regeneration'><p>Plant regeneration</p></a></li>
<li><a href='#resetInputs'><p>Reset simulation inputs</p></a></li>
<li><a href='#resistances'><p>Soil-plant resistances</p></a></li>
<li><a href='#root'><p>Root functions</p></a></li>
<li><a href='#SFM_metric'>
<p>Standard fuel models (Albini 1976, Scott &amp; Burgan 2005)</p></a></li>
<li><a href='#shinyplot'><p>Shiny app with interactive plots</p></a></li>
<li><a href='#soil'><p>Soil initialization</p></a></li>
<li><a href='#soil_texture'><p>Soil texture and hydraulics</p></a></li>
<li><a href='#soil_thermodynamics'><p>Soil thermodynamic functions</p></a></li>
<li><a href='#species_values'><p>Species description functions</p></a></li>
<li><a href='#SpParams'>
<p>Data tables with species parameter definition and values for Mediterranean and US</p></a></li>
<li><a href='#spwb'><p>Soil-plant water balance</p></a></li>
<li><a href='#stand_basalArea'><p>Stand values</p></a></li>
<li><a href='#summary.spwb'><p>Summarize simulation results</p></a></li>
<li><a href='#sureau_ecos'><p>Sureau-ECOS inner functions for testing only</p></a></li>
<li><a href='#transp_maximumTranspirationModel'><p>Maximum transpiration vs. LAI</p></a></li>
<li><a href='#transp_stomatalregulation'><p>Stomatal regulation</p></a></li>
<li><a href='#transp_transpirationSperry'><p>Transpiration modes</p></a></li>
<li><a href='#vprofile_leafAreaDensity'><p>Vertical profiles</p></a></li>
<li><a href='#waterUseEfficiency'><p>Water use efficiency</p></a></li>
<li><a href='#wind'><p>Models for canopy turbulence</p></a></li>
<li><a href='#woodformation'><p>Wood formation</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Mediterranean Forest Simulation</td>
</tr>
<tr>
<td>Version:</td>
<td>3.2.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-11-29</td>
</tr>
<tr>
<td>Description:</td>
<td>Simulate Mediterranean forest functioning and dynamics using cohort-based description of vegetation [De Caceres et al. (2015) &lt;<a href="https://doi.org/10.1016%2Fj.agrformet.2015.06.012">doi:10.1016/j.agrformet.2015.06.012</a>&gt;; De Caceres et al. (2021) &lt;<a href="https://doi.org/10.1016%2Fj.agrformet.2020.108233">doi:10.1016/j.agrformet.2020.108233</a>&gt;].</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> | <a href="https://www.r-project.org/Licenses/LGPL-3">LGPL-3</a> [expanded from: GPL (&ge; 2) | LGPL (&ge; 3)]</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://emf-creaf.github.io/medfate/">https://emf-creaf.github.io/medfate/</a></td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>ggplot2 (&ge; 3.0.0), meteoland (&ge; 2.0.0), Rcpp (&ge; 1.0.6),
shiny</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 3.0.0), knitr, rmarkdown</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, meteoland</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/emf-creaf/medfate/issues">https://github.com/emf-creaf/medfate/issues</a></td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-11-30 08:41:27 UTC; miquel</td>
</tr>
<tr>
<td>Author:</td>
<td>Miquel De Cáceres <a href="https://orcid.org/0000-0001-7132-2080"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre, cph],
  Nicolas Martin-StPaul
    <a href="https://orcid.org/0000-0001-7574-0108"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Víctor Granda <a href="https://orcid.org/0000-0002-0469-1991"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Antoine Cabon <a href="https://orcid.org/0000-0001-6426-1726"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Jordi Martínez-Vilalta
    <a href="https://orcid.org/0000-0002-2332-7298"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [ctb],
  Maurizio Mencuccini
    <a href="https://orcid.org/0000-0003-0840-1477"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [ctb],
  Julien Ruffault [ctb],
  François Pimont <a href="https://orcid.org/0000-0002-9842-6207"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Hervé Cochard <a href="https://orcid.org/0000-0002-2727-7072"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Aitor Améztegui <a href="https://orcid.org/0000-0003-2006-1559"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Shengli Huang <a href="https://orcid.org/0000-0003-3927-7042"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  John Burkardt [cph] (Copyright holder of C++ code in 'incgamma.cpp')</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Miquel De Cáceres &lt;miquelcaceres@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-11-30 09:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='medfate-package'>medfate: Mediterranean Forest Simulation</h2><span id='topic+medfate-package'></span><span id='topic+_PACKAGE'></span><span id='topic+medfate'></span>

<h3>Description</h3>

<p>Simulate Mediterranean forest functioning and dynamics using cohort-based description of vegetation
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Miquel De Cáceres
<a href="mailto:miquelcaceres@gmail.com">miquelcaceres@gmail.com</a>
[<a href="https://orcid.org/0000-0001-7132-2080">ORCID</a>]
</p>
<p>Authors: </p>

<ul>
<li><p> Nicolas Martin-StPaul
[<a href="https://orcid.org/0000-0001-7574-0108">ORCID</a>]
</p>
</li>
<li><p> Víctor Granda
[<a href="https://orcid.org/0000-0002-0469-1991">ORCID</a>]
</p>
</li>
<li><p> Antoine Cabon
[<a href="https://orcid.org/0000-0001-6426-1726">ORCID</a>]
</p>
</li></ul>

<p>Contributors: </p>

<ul>
<li><p> Jordi Martínez-Vilalta
[<a href="https://orcid.org/0000-0002-2332-7298">ORCID</a>]
</p>
</li>
<li><p> Maurizio Mencuccini
[<a href="https://orcid.org/0000-0003-0840-1477">ORCID</a>]
</p>
</li>
<li><p> Julien Ruffault
</p>
</li>
<li><p> François Pimont
[<a href="https://orcid.org/0000-0002-9842-6207">ORCID</a>]
</p>
</li>
<li><p> Hervé Cochard
[<a href="https://orcid.org/0000-0002-2727-7072">ORCID</a>]
</p>
</li>
<li><p> Aitor Améztegui
[<a href="https://orcid.org/0000-0001-6426-1726">ORCID</a>]
</p>
</li>
<li><p> Shengli Huang
[<a href="https://orcid.org/0003-3927-7042">ORCID</a>]
</p>
</li></ul>



<h3>References</h3>


<ul>
<li><p>De Cáceres et al. (2015) (<a href="https://doi.org/10.1016/j.agrformet.2015.06.012">doi:10.1016/j.agrformet.2015.06.012</a>)
</p>
</li>
<li><p>De Cáceres et al. (2021) (<a href="https://doi.org/10.1016/j.agrformet.2020.108233">doi:10.1016/j.agrformet.2020.108233</a>)
</p>
</li>
<li><p>Ruffault et al. (2022) (<a href="https://doi.org/10.5194/gmd-15-5593-2022">doi:10.5194/gmd-15-5593-2022</a>)
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links: 
</p>
 
<ul>
<li><p><a href="https://emf-creaf.github.io/medfate/">https://emf-creaf.github.io/medfate/</a> 
</p>
</li>
<li><p><a href="https://emf-creaf.github.io/medfatebook/">https://emf-creaf.github.io/medfatebook/</a> 
</p>
</li></ul>


<hr>
<h2 id='biophysics'>Physical and biophysical utility functions</h2><span id='topic+biophysics'></span><span id='topic+biophysics_radiationDiurnalPattern'></span><span id='topic+biophysics_temperatureDiurnalPattern'></span><span id='topic+biophysics_leafTemperature'></span><span id='topic+biophysics_leafTemperature2'></span><span id='topic+biophysics_leafVapourPressure'></span><span id='topic+biophysics_irradianceToPhotonFlux'></span><span id='topic+biophysics_waterDynamicViscosity'></span>

<h3>Description</h3>

<p>Utility functions for the calculation of biophysical variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>biophysics_radiationDiurnalPattern(t, daylength)

biophysics_temperatureDiurnalPattern(
  t,
  tmin,
  tmax,
  tminPrev,
  tmaxPrev,
  tminNext,
  daylength
)

biophysics_leafTemperature(absRad, airTemperature, u, E, leafWidth = 1)

biophysics_leafTemperature2(
  SWRabs,
  LWRnet,
  airTemperature,
  u,
  E,
  leafWidth = 1
)

biophysics_leafVapourPressure(leafTemp, leafPsi)

biophysics_irradianceToPhotonFlux(I, lambda = 546.6507)

biophysics_waterDynamicViscosity(temp)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="biophysics_+3A_t">t</code></td>
<td>
<p>Time of the day (in seconds).</p>
</td></tr>
<tr><td><code id="biophysics_+3A_daylength">daylength</code></td>
<td>
<p>Day length (in seconds).</p>
</td></tr>
<tr><td><code id="biophysics_+3A_tmin">tmin</code>, <code id="biophysics_+3A_tmax">tmax</code></td>
<td>
<p>Minimum and maximum daily temperature (ºC).</p>
</td></tr>
<tr><td><code id="biophysics_+3A_tminprev">tminPrev</code>, <code id="biophysics_+3A_tmaxprev">tmaxPrev</code>, <code id="biophysics_+3A_tminnext">tminNext</code></td>
<td>
<p>Maximum and minimum daily temperatures of the previous and following day (ºC).</p>
</td></tr>
<tr><td><code id="biophysics_+3A_absrad">absRad</code></td>
<td>
<p>Absorbed long- and short-wave radiation (in W·m-2).</p>
</td></tr>
<tr><td><code id="biophysics_+3A_airtemperature">airTemperature</code></td>
<td>
<p>Air temperature (in ºC).</p>
</td></tr>
<tr><td><code id="biophysics_+3A_u">u</code></td>
<td>
<p>Wind speed above the leaf boundary layer (in m/s).</p>
</td></tr>
<tr><td><code id="biophysics_+3A_e">E</code></td>
<td>
<p>Transpiration flow (in mmol H20·m-2·s-1) per one sided leaf area basis.</p>
</td></tr>
<tr><td><code id="biophysics_+3A_leafwidth">leafWidth</code></td>
<td>
<p>Leaf width (in cm).</p>
</td></tr>
<tr><td><code id="biophysics_+3A_swrabs">SWRabs</code></td>
<td>
<p>Absorbed short-wave radiation (in W·m-2).</p>
</td></tr>
<tr><td><code id="biophysics_+3A_lwrnet">LWRnet</code></td>
<td>
<p>Net long-wave radiation balance (in W·m-2).</p>
</td></tr>
<tr><td><code id="biophysics_+3A_leaftemp">leafTemp</code></td>
<td>
<p>Leaf temperature (ºC).</p>
</td></tr>
<tr><td><code id="biophysics_+3A_leafpsi">leafPsi</code></td>
<td>
<p>Leaf water potential (MPa).</p>
</td></tr>
<tr><td><code id="biophysics_+3A_i">I</code></td>
<td>
<p>Irradiance (in W*m-2).</p>
</td></tr>
<tr><td><code id="biophysics_+3A_lambda">lambda</code></td>
<td>
<p>Wavelength (in nm).</p>
</td></tr>
<tr><td><code id="biophysics_+3A_temp">temp</code></td>
<td>
<p>Temperature (ºC).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Functions <code>biophysics_leafTemperature</code> and <code>biophysics_leafTemperature2</code> calculate leaf temperature according to energy balance equation given in Campbell and Norman (1988). 
</p>
<p>Function <code>biophysics_radiationDiurnalPattern</code> follows the equations given in Liu and Jordan (1960). 
</p>
<p>Function <code>biophysics_temperatureDiurnalPattern</code> determines diurnal temperature pattern assuming a sinusoidal pattern with T = Tmin at sunrise and T = (Tmin+Tmax)/2 at sunset and a linear change in temperature between sunset and Tmin of the day after (McMurtrie et al. 1990). 
</p>
<p>Function <code>biophysics_waterDynamicViscosity</code> calculates water dynamic viscosity following the Vogel (1921) equation.
</p>


<h3>Value</h3>

<p>Values returned for each function are:
</p>

<ul>
<li><p><code>biophysics_leafTemperature</code> and <code>biophysics_leafTemperature2</code>: leaf temperature (in ºC)
</p>
</li>
<li><p><code>biophysics_leafVapourPressure</code>: leaf vapour pressure (in kPa) 
</p>
</li>
<li><p><code>biophysics_radiationDiurnalPattern</code>: the proportion of daily radiation corresponding to the input time in seconds after sunrise. 
</p>
</li>
<li><p><code>biophysics_temperatureDiurnalPattern</code>: diurnal pattern of temperature.
</p>
</li>
<li><p><code>biophysics_waterDynamicViscosity</code>: Water dynamic viscosity relative to 20ºC. 
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>Campbell, G. S., and J. M. Norman. 1998. An introduction to environmental biophysics: 2nd edition. (eqns. 14.1 &amp; 14.3)
</p>
<p>B. Y. H. Liu and R. C. Jordan, “The interrelationship and characteristic distribution of direct, diffuse and total solar radiation,” Solar Energy, vol. 4, no. 3, pp. 1–19, 1960. 
</p>
<p>McMurtrie, R. E., D. A. Rook, and F. M. Kelliher. 1990. Modelling the yield of Pinus radiata on a site limited by water and nitrogen. Forest Ecology and Management 30:381–413.
</p>
<p>H. Vogel, &quot;Das Temperaturabhangigkeitsgesetz der Viskositat von Flussigkeiten&quot;, Physikalische Zeitschrift, vol. 22, pp. 645–646, 1921.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb">spwb</a></code>
</p>

<hr>
<h2 id='carbon'>Carbon-related functions</h2><span id='topic+carbon'></span><span id='topic+carbon_sugarStarchDynamicsLeaf'></span><span id='topic+carbon_sugarStarchDynamicsStem'></span><span id='topic+carbon_osmoticWaterPotential'></span><span id='topic+carbon_sugarConcentration'></span><span id='topic+carbon_relativeSapViscosity'></span><span id='topic+carbon_leafStructuralBiomass'></span><span id='topic+carbon_leafStarchCapacity'></span><span id='topic+carbon_sapwoodStructuralBiomass'></span><span id='topic+carbon_sapwoodStructuralLivingBiomass'></span><span id='topic+carbon_sapwoodStarchCapacity'></span><span id='topic+carbon_carbonCompartments'></span>

<h3>Description</h3>

<p>Low-level functions used in the calculation of carbon balance.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>carbon_sugarStarchDynamicsLeaf(sugarConc, starchConc, eqSugarConc)

carbon_sugarStarchDynamicsStem(sugarConc, starchConc, eqSugarConc)

carbon_osmoticWaterPotential(sugarConc, temp, nonSugarConc)

carbon_sugarConcentration(osmoticWP, temp, nonSugarConc)

carbon_relativeSapViscosity(sugarConc, temp)

carbon_leafStructuralBiomass(LAI, N, SLA)

carbon_leafStarchCapacity(LAI, N, SLA, leafDensity)

carbon_sapwoodStructuralBiomass(SA, H, L, V, woodDensity)

carbon_sapwoodStructuralLivingBiomass(
  SA,
  H,
  L,
  V,
  woodDensity,
  conduit2sapwood
)

carbon_sapwoodStarchCapacity(SA, H, L, V, woodDensity, conduit2sapwood)

carbon_carbonCompartments(x, biomassUnits = "g_m2")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="carbon_+3A_sugarconc">sugarConc</code></td>
<td>
<p>Concentration of soluble sugars (mol/l).</p>
</td></tr>
<tr><td><code id="carbon_+3A_starchconc">starchConc</code></td>
<td>
<p>Concentration of starch (mol/l)</p>
</td></tr>
<tr><td><code id="carbon_+3A_eqsugarconc">eqSugarConc</code></td>
<td>
<p>Equilibrium concentration of soluble sugars (mol/l).</p>
</td></tr>
<tr><td><code id="carbon_+3A_temp">temp</code></td>
<td>
<p>Temperature (degrees Celsius).</p>
</td></tr>
<tr><td><code id="carbon_+3A_nonsugarconc">nonSugarConc</code></td>
<td>
<p>Concentration of inorganic solutes (mol/l).</p>
</td></tr>
<tr><td><code id="carbon_+3A_osmoticwp">osmoticWP</code></td>
<td>
<p>Osmotic water potential (MPa).</p>
</td></tr>
<tr><td><code id="carbon_+3A_lai">LAI</code></td>
<td>
<p>Leaf area index.</p>
</td></tr>
<tr><td><code id="carbon_+3A_n">N</code></td>
<td>
<p>Density (ind·ha-1).</p>
</td></tr>
<tr><td><code id="carbon_+3A_sla">SLA</code></td>
<td>
<p>Specific leaf area (mm2/mg = m2/kg).</p>
</td></tr>
<tr><td><code id="carbon_+3A_leafdensity">leafDensity</code></td>
<td>
<p>Density of leaf tissue (dry weight over volume).</p>
</td></tr>
<tr><td><code id="carbon_+3A_sa">SA</code></td>
<td>
<p>Sapwood area (cm2).</p>
</td></tr>
<tr><td><code id="carbon_+3A_h">H</code></td>
<td>
<p>Plant height (cm).</p>
</td></tr>
<tr><td><code id="carbon_+3A_l">L</code></td>
<td>
<p>Coarse root length (mm) for each soil layer.</p>
</td></tr>
<tr><td><code id="carbon_+3A_v">V</code></td>
<td>
<p>Proportion of fine roots in each soil layer.</p>
</td></tr>
<tr><td><code id="carbon_+3A_wooddensity">woodDensity</code></td>
<td>
<p>Wood density (dry weight over volume).</p>
</td></tr>
<tr><td><code id="carbon_+3A_conduit2sapwood">conduit2sapwood</code></td>
<td>
<p>Proportion of sapwood corresponding to conducive elements (vessels or tracheids) as opposed to parenchymatic tissue.</p>
</td></tr>
<tr><td><code id="carbon_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+growthInput">growthInput</a></code>.</p>
</td></tr>
<tr><td><code id="carbon_+3A_biomassunits">biomassUnits</code></td>
<td>
<p>A string for output biomass units, either &quot;g_ind&quot; (g per individual) or &quot;g_m2&quot; (g per square meter).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Values returned for each function are:
</p>

<ul>
<li><p><code>carbon_leafStarchCapacity</code>: Capacity of storing starch in the leaf compartment (mol gluc/ind.).
</p>
</li>
<li><p><code>carbon_leafStructuralBiomass</code>: Leaf structural biomass (g dry/ind.)
</p>
</li>
<li><p><code>carbon_sapwoodStarchCapacity</code>: Capacity of storing starch in the sapwood compartment (mol gluc/ind.).
</p>
</li>
<li><p><code>carbon_sapwoodStructuralBiomass</code>: Sapwood structural biomass (g dry/ind.)
</p>
</li>
<li><p><code>carbon_sapwoodStructuralLivingBiomass</code>: Living sapwood (parenchyma) structural biomass (g dry/ind.)
</p>
</li>
<li><p><code>carbon_sugarConcentration</code>: Sugar concentration (mol gluc/l)
</p>
</li>
<li><p><code>carbon_osmoticWaterPotential</code>: Osmotic component of water potential (MPa)
</p>
</li>
<li><p><code>carbon_relativeSapViscosity</code>: Relative viscosity of sapwood with respect to pure water (according to Forst et al. (2002)).
</p>
</li>
<li><p><code>carbon_sugarStarchDynamicsLeaf</code>: Rate of conversion from sugar to starch in leaf (mol gluc/l/s).
</p>
</li>
<li><p><code>carbon_sugarStarchDynamicsStem</code>: Rate of conversion from sugar to starch in leaf (mol gluc/l/s).
</p>
</li>
<li><p><code>carbon_carbonCompartments</code>: A data frame with the size of compartments for each plant cohort, in the specified units.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>Forst P, Wermer F, Delgado A (2002). On the pressure dependence of the viscosity of aqueous sugar solutions. Rheol Acta 41: 369–374 DOI 10.1007/s00397-002-0238-y
</p>


<h3>See Also</h3>

<p><code><a href="#topic+growth">growth</a></code>
</p>

<hr>
<h2 id='defaultControl'>Control parameters for simulation models</h2><span id='topic+defaultControl'></span>

<h3>Description</h3>

<p>Creates a list control parameters default values for simulations
</p>


<h3>Usage</h3>

<pre><code class='language-R'>defaultControl(transpirationMode = "Granier")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="defaultControl_+3A_transpirationmode">transpirationMode</code></td>
<td>
<p>Transpiration model (either 'Granier', 'Sperry' or 'Cochard'). See <code><a href="#topic+spwbInput">spwbInput</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function returns a list with default parameters. 
Users can change those defaults that need to be set to other values and use the list as input for model functions. 
The relevant parameters are different for each model function.
</p>


<h3>Value</h3>

<p>A list, with the following options (default values in brackets):
</p>

<p><b>General</b>:
</p>

<ul>
<li><p><code>verbose [= TRUE]</code>: Boolean flag to indicate console output during calculations. In function <code>fordyn</code> <code>verbose</code> is always set to FALSE.
</p>
</li>
<li><p><code>fillMissingRootParams [= TRUE]</code>: Boolean flag to indicate that initializing functions should provide estimates for Z50 and Z95 if these are lacking in the forest data. Note that if <code>fillMissingRootParams</code> is set to <code>FALSE</code> then simulations may fail if the user does not provide values for Z50 and Z95 in tree or shrub data.
</p>
</li>
<li><p><code>fillMissingSpParams [= TRUE]</code>: Boolean flag to indicate that initializing functions should provide estimates for functional parameters if these are lacking in the species parameter table <code><a href="#topic+SpParams">SpParams</a></code>. Note that if <code>fillMissingSpParams</code> is set to <code>FALSE</code> then simulations may fail if the user does not provide values for required parameters.
</p>
</li>
<li><p><code>standResults [= TRUE]</code>: Boolean flag to keep stand-level results (in a list called 'Stand').
</p>
</li>
<li><p><code>soilResults [= TRUE]</code>: Boolean flag to keep stand-level results (in a list called 'Soil').
</p>
</li>
<li><p><code>plantResults [= TRUE]</code>: Boolean flag to keep plant-level results (in a list called 'Plants').
</p>
</li>
<li><p><code>leafResults [= TRUE]</code>: Boolean flag to keep leaf-level results (in elements called 'SunlitLeaves' and 'ShadeLeaves').
</p>
</li>
<li><p><code>temperatureResults [= TRUE]</code>: Boolean flag to keep temperature results (in elements called 'Temperature' and 'TemperatureLayers').
</p>
</li>
<li><p><code>subdailyResults [= FALSE]</code>: Boolean flag to force subdaily results to be stored (as a list called 'subdaily' of <code><a href="#topic+spwb_day">spwb_day</a></code> objects, one by simulated date) in calls to <code><a href="#topic+spwb">spwb</a></code>. In function <code>fordyn</code> <code>subdailyResults</code> is always set to FALSE.
</p>
</li>
<li><p><code>fireHazardResults [= FALSE]</code>: Boolean flag to force calculation of daily fire hazard.
</p>
</li>
<li><p><code>fireHazardStandardWind [= NA]</code>: Wind speed (in m/s) for fire-hazard estimation. If missing, actual wind-speed is used.
</p>
</li>
<li><p><code>fireHazardStandardDFMC [= NA]</code>: Dead fuel moisture content for fire-hazard estimation. If missing, estimation from current weather is used.
</p>
</li></ul>

<p><b>Water balance</b> (functions <code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+pwb">pwb</a></code> or <code><a href="#topic+spwb_day">spwb_day</a></code>):
</p>

<ul>
<li><p><code>transpirationMode [= "Granier"]</code>: Transpiration model (either 'Granier', 'Sperry' or 'Cochard'). See <code><a href="#topic+spwbInput">spwbInput</a></code>.
</p>
</li>
<li><p><code>soilFunctions [= "VG"]</code>: Soil water retention curve and conductivity functions, either 'SX' (for Saxton) or 'VG' (for Van Genuchten). 
If <code>transpirationMode</code> is 'Sperry' or 'Cochard' then soilFunctions is forced to <code>'VG'</code>.
Only simulations with 'Granier' are allowed to use Saxton functions.
</p>
</li>
<li><p><code>defaultWindSpeed [= 2.5]</code>: Default wind speed value (in m/s) to be used when missing from data. 
</p>
</li>
<li><p><code>defaultCO2 [= 386]</code>: Default atmospheric (abovecanopy) CO2 concentration (in micromol·mol-1 = ppm). This value will be used whenever CO2 concentration is not specified in the weather input. 
</p>
</li>
<li><p><code>snowpack [= TRUE]</code>: Boolean flag to indicate the simulation of snow accumulation and melting.
</p>
</li>
<li><p><code>leafPhenology [= TRUE]</code>: Boolean flag to indicate the simulation of leaf phenology for winter-deciduous species.
</p>
</li>
<li><p><code>rockyLayerDrainage [= TRUE]</code>: Boolean flag to indicate the simulation of drainage from rocky layers (&gt; 95% of rocks).
</p>
</li>
<li><p><code>unlimitedSoilWater [= FALSE]</code>: Boolean flag to indicate the simulation of plant transpiration assuming that soil water is always at field capacity.
</p>
</li>
<li><p><code>unfoldingDD [= 300]</code>: Degree-days for complete leaf unfolding after budburst has occurred.
</p>
</li>
<li><p><code>rhizosphereOverlap [= "total"]</code>: A string indicating the degree of rhizosphere spatial overlap between plant cohorts:
</p>

<ul>
<li><p>&quot;none&quot; - no overlap (independent water pools).
</p>
</li>
<li><p>&quot;partial&quot; - partial overlap determined by coarse root volume.
</p>
</li>
<li><p>&quot;total&quot; - total overlap (plants extract from common soil pools).
</p>
</li></ul>


</li>
<li><p><code>verticalLayerSize [= 100]</code>: Size of vertical layers (in cm) for the calculation of light extinction (and photosynthesis).
</p>
</li>
<li><p><code>windMeasurementHeight [= 200]</code>: Height (in cm) over the canopy corresponding to wind measurements.
</p>
</li>
<li><p><code>cavitationRefill [= "total"]</code>: A string indicating how refilling of embolized conduits is done:
</p>

<ul>
<li><p>&quot;none&quot; - no refilling.
</p>
</li>
<li><p>&quot;annual&quot; - every first day of the year.
</p>
</li>
<li><p>&quot;rate&quot; - following a rate of new sapwood formation.
</p>
</li>
<li><p>&quot;total&quot; - instantaneous complete refilling.
</p>
</li></ul>


</li></ul>

<p><b>Water balance</b> (functions <code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+pwb">pwb</a></code> or <code><a href="#topic+spwb_day">spwb_day</a></code> when <code>traspirationMode = "Granier"</code>):
</p>

<ul>
<li><p><code>hydraulicRedistributionFraction [= 0.1]</code>: Fraction of plant transpiration corresponding to hydraulic redistribution.
</p>
</li></ul>

<p><b>Water balance</b> (functions <code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+pwb">pwb</a></code> or <code><a href="#topic+spwb_day">spwb_day</a></code> when <code>traspirationMode = "Sperry"</code> or <code>traspirationMode = "Cochard"</code>):
</p>

<ul>
<li><p><code>ndailysteps [= 24]</code>: Number of steps into which each day is divided for determination of stomatal conductance, transpiration and photosynthesis (24 equals 1-hour intervals).
</p>
</li>
<li><p><code>nsubsteps [= 3600]</code>: Number of substeps into which each step is divided for multi-layer canopy energy balance solving.
</p>
</li>
<li><p><code>capacitance [= FALSE]</code>: Whether the effect of plant water compartments is considered in simulations.
</p>
</li>
<li><p><code>multiLayerBalance [= FALSE]</code>: Flag to indicate multiple canopy energy balance. If <code>FALSE</code>, canopy is considered a single layer for energy balance.
</p>
</li>
<li><p><code>taper [= TRUE]</code>: Whether taper of xylem conduits is accounted for when calculating aboveground stem conductance from xylem conductivity.
</p>
</li>
<li><p><code>maximumStemConductance [= 10]</code>: Maximum allowed value for the stem maximum hydraulic conductance (in mmol·s-1·m-2·MPa-1). Introduced to avoid excessive hydraulic redistribution caused by species with small size (i.e. very large stem conductance).
</p>
</li>
<li><p><code>klatstem [= 0.01]</code>: Stem symplastic-apoplastic lateral conductance (in mmol·s-1·m-2·MPa-1). Only relevant when <code>capacitance = TRUE</code>.
</p>
</li>
<li><p><code>klatleaf [= 0.01]</code>: Leaf symplastic-apoplastic lateral conductance (in mmol·s-1·m-2·MPa-1). Only relevant when <code>capacitance = TRUE</code>.
</p>
</li>
<li><p><code>numericParams</code>: A list with the following elements:
</p>

<ul>
<li><p><code>maxNsteps [= 400]</code>: Maximum number of steps in supply function.
</p>
</li>
<li><p><code>ntrial [= 200]</code>: Number of iteration trials when finding root of equation system.
</p>
</li>
<li><p><code>psiTol [= 0.0001]</code>: Tolerance value for water potential.
</p>
</li>
<li><p><code>ETol [= 0.0001]</code>: Tolerance value for flow.
</p>
</li></ul>


</li>
<li><p><code>thermalCapacityLAI [= 1000000]</code>: Thermal canopy capacitance per LAI unit.
</p>
</li>
<li><p><code>fracLeafResistance [= NA]</code>: Fraction of plant total resistance (leaf+stem+root) that corresponds to leaves. This fraction is used if <code>VCleaf_kmax = NA</code>.
</p>
</li>
<li><p><code>fracRootResistance [= 0.40]</code>: Fraction of plant total resistance (leaf+stem+root) that corresponds to root system.
</p>
</li>
<li><p><code>averageFracRhizosphereResistance [= 0.15]</code>: Fraction to total continuum (leaf+stem+root+rhizosphere) resistance that corresponds to rhizosphere (averaged across soil water potential values).
</p>
</li>
<li><p><code>boundaryLayerSize [= 2000]</code>: Size of the boundary layer (in cm) over the canopy (relevant for multi-layer canopy energy balance).
</p>
</li>
<li><p><code>refillMaximumRate [= 0.05]</code>: Maximum rate of daily refilling of embolized conduits as sapwood area per leaf area (in cm2·m-2·day-1).
</p>
</li></ul>

<p><b>Forest growth</b> (functions <code><a href="#topic+growth">growth</a></code> or <code><a href="#topic+growth_day">growth_day</a></code>):
</p>

<ul>
<li><p><code>subdailyCarbonBalance [= FALSE]</code>: Boolean flag to indicate that labile carbon balance should be conducted at sub-daily steps (applies only to transpirationMode = &quot;Sperry&quot;).
</p>
</li>
<li><p><code>allowDessication [= TRUE]</code>: Boolean flag to indicate that mortality by dessication is allowed.
</p>
</li>
<li><p><code>allowStarvation [= TRUE]</code>: Boolean flag to indicate that mortality by starvation is allowed.
</p>
</li>
<li><p><code>sinkLimitation [= TRUE]</code>: Boolean flag to indicate that temperature and turgor limitations to growth are applied.
</p>
</li>
<li><p><code>shrubDynamics [= TRUE]</code>: Boolean flag to allow the application of demographic processes to shrubs.
</p>
</li>
<li><p><code>herbDynamics [= TRUE]</code>: Boolean flag to allow dynamic herb leaf area as a function of shading due to leaf area of woody cohorts.
</p>
</li>
<li><p><code>allocationStrategy [= "Al2As"]</code>: Strategy for allocation (either &quot;Plant_kmax&quot;, for constant maximum plant conductance, or &quot;Al2As&quot; for constant Huber value).
</p>
</li>
<li><p><code>phloemConductanceFactor [= 0.2])</code>: Factor to transform stem xylem conductance to stem phloem conductance (only for transpirationMode = &quot;Sperry&quot;).
</p>
</li>
<li><p><code>nonSugarConcentration [= 0.25]</code>: Non-sugar (inorganic) solute concentration  (mol·l-1) in cells.
</p>
</li>
<li><p><code>equilibriumOsmoticConcentration [=  c(leaf = 0.8, sapwood = 0.6)]</code>: Equilibrium osmotic concentrations (mol·l-1) for leaf and sapwood cells. The difference between leaf and sapwood values helps maintaining phloem transport. The equilibrium sugar concentration is <code>equilibriumOsmoticConcentration - nonSugarConcentration</code> defaults to <code>[= c(leaf = 0.55, sapwood = 0.35)]</code>. 
</p>
</li>
<li><p><code>minimumRelativeStarchForGrowth [= 0.50]</code>: Default minimum concentration of storage carbon (starch), relative to the maximum storage capacity, for sapwood growth to occur, when not specified via SpParams (<code>RSSG</code>). 
</p>
</li>
<li><p><code>constructionCosts [= c(leaf = 1.5, sapwood = 1.47, fineroot = 1.30)]</code>: Default construction costs, including respiration and structural carbon, per dry weight of new tissue (g gluc · g dry -1) when not specified via SpParams (<code>CCleaf</code>, <code>CCsapwood</code> and <code>CCfineroot</code>).
</p>
</li>
<li><p><code>senescenceRates [= c(sapwood = 0.0001261398, fineroot = 0.001897231)]</code>: Default senescence rates (day-1) for sapwood and fineroots when not specified via SpParams (<code>SRsapwood</code> and <code>SRfineroot</code>). Defaults are equivalent to 9%, 5% and 50% annual turnover for gymnosperm sapwood, angiosperm sapwood and fine roots, respectively.
</p>
</li>
<li><p><code>maximumRelativeGrowthRates [=   c(leaf = 0.03, cambium = 0.005, sapwood = 0.002, fineroot = 0.1)]</code>: Default maximum relative growth rates for leaves (m2 leaf ·cm-2 sapwood· day-1), tree sapwood (cm2 sapwood· cm-1 cambium · day-1), shrub sapwood (cm2 sapwood ·cm-2 sapwood· day-1) and fine roots (g dw · g dw -1 · day -1) when not specified via SpParams (<code>RGRleafmax</code>, <code>RGRcambiummax</code> , <code>RGRsapwoodmax</code> and <code>RGRfinerootmax</code>, respectively).
</p>
</li>
<li><p><code>mortalityMode [= "density/deterministic"]</code>: String describing how mortality is applied. Current accepted values are combinations of &quot;cohort&quot; vs &quot;density&quot; (for whole-cohort mortality vs reduction of stem density) and &quot;deterministic&quot; vs. &quot;stochastic&quot;.
</p>
</li>
<li><p><code>mortalityBaselineRate [= 0.0015]</code>: Default deterministic proportion or probability specifying the baseline reduction of cohort's density occurring in a year (for <code>mortalityMode = "density/deterministic" or "density/stochastic").</code>
</p>
</li>
<li><p><code>mortalityRelativeSugarThreshold [= 0.4]</code>: Threshold of stem sugar concentration relative to the equilibrium sugar concentration, resulting in an increased starvation mortality rate/probability whenever levels are below.
</p>
</li>
<li><p><code>mortalityRWCThreshold [= 0.4]</code>: Threshold of stem relative water content resulting in increased mortality rate/probability whenever levels are below.
</p>
</li>
<li><p><code>recrTreeDBH [= 1]</code>: Default DBH (cm) for recruited trees  (when species parameter <code>RecrTreeDBH</code> is missing).
</p>
</li>
<li><p><code>recrTreeDensity [= 3000]</code>: Default density (ind·ha-1) for recruited trees  (when species parameter <code>RecrTreeDensity</code> is missing).
</p>
</li>
<li><p><code>ingrowthTreeDBH [= 7.5]</code>: Default DBH (cm) for ingrowth trees  (when species parameter <code>RecrTreeDBH</code> is missing).
</p>
</li>
<li><p><code>ingrowthTreeDensity [= 127]</code>: Default density (ind·ha-1) for ingrowth trees  (when species parameter <code>RecrTreeDensity</code> is missing).
</p>
</li></ul>

<p><b>Forest dynamics</b> (function <code><a href="#topic+fordyn">fordyn</a></code>):
</p>

<ul>
<li><p><code>allowSeedBankDynamics [= TRUE]</code>: Boolean flag to indicate that seed production and seed bank dynamics is simulated.
</p>
</li>
<li><p><code>allowRecruitment [= TRUE]</code>: Boolean flag to indicate that recruitment from seeds is allowed.
</p>
</li>
<li><p><code>allowResprouting [= TRUE]</code>: Boolean flag to indicate that resprouting is allowed.
</p>
</li>
<li><p><code>recruitmentMode [= "stochastic"]</code>: String describing how recruitment from seeds is applied. Current accepted values are &quot;deterministic&quot; or &quot;stochastic&quot;.
</p>
</li>
<li><p><code>removeEmptyCohorts [= TRUE]</code>: Boolean flag to indicate the removal of cohorts whose density is too low.
</p>
</li>
<li><p><code>minimumTreeCohortDensity [= 1]</code>: Threshold of tree density resulting in cohort removal.
</p>
</li>
<li><p><code>minimumShrubCohortCover [= 0.01]</code>: Threshold of shrub cover resulting in cohort removal.
</p>
</li>
<li><p><code>dynamicallyMergeCohorts [= FALSE]</code>: Boolean flag to indicate that cohorts should be merged when possible. This option speeds up calculations but results in a loss of cohort identity and reinitialization of many state variables.
</p>
</li>
<li><p><code>seedRain [= NULL]</code>: Vector of species names whose seed rain is to be added to seed bank, regardless of local seed production.
</p>
</li>
<li><p><code>seedProductionTreeHeight [= 300]</code>: Default minimum tree height for producing seeds (when species parameter <code>SeedProductionHeight</code> is missing).
</p>
</li>
<li><p><code>seedProductionShrubHeight [= 30]</code>: Default minimum shrub height for producing seeds (when species parameter <code>SeedProductionHeight</code> is missing).
</p>
</li>
<li><p><code>probRecr [= 0.05]</code>: Default annual probability of seed-recruitment (when species parameter <code>ProbRecr</code> is missing).
</p>
</li>
<li><p><code>minTempRecr [= 0]</code>: Default threshold of minimum average temperature of the coldest month necessary for recruiting from seeds (when species parameter <code>MinTempRecr</code> is missing). 
</p>
</li>
<li><p><code>minMoistureRecr [= 0.3]</code>: Default threshold of minimum moisture index (annual precipitation over annual ETP) necessary for seed-recruiting (when species parameter <code>MinMoistureRecr</code> is missing). 
</p>
</li>
<li><p><code>minFPARRecr [= 10]</code>: Default threshold of minimum fraction of PAR (in %)  reaching the ground necessary for recruiting (when species parameter <code>MinFPARRecr</code> is missing). 
</p>
</li>
<li><p><code>recrTreeHeight [= 620]</code>: Default height (cm) for recruited trees  (when species parameter <code>RecrTreeHeight</code> is missing).
</p>
</li>
<li><p><code>recrShrubCover [= 1]</code>: Default cover (%) for shrubs recruited from seed  (when species parameter <code>RecrShrubCover</code> is missing).
</p>
</li>
<li><p><code>recrShrubHeight [= 25]</code>: Default height (cm) for recruited shrubs  (when species parameter <code>RecrShrubHeight</code> is missing).
</p>
</li>
<li><p><code>recrTreeZ50 [= 100]</code>: Default value for Z50 (mm) in seed-recruited trees  (when species parameter <code>RecrZ50</code> is missing).
</p>
</li>
<li><p><code>recrShrubZ50 [= 50]</code>: Default value for Z50 (mm) in seed-recruited shrubs  (when species parameter <code>RecrZ50</code> is missing).
</p>
</li>
<li><p><code>recrTreeZ95 [= 1000]</code>: Default value for Z95 (mm) in seed-recruited trees  (when species parameter <code>RecrZ50</code> is missing).
</p>
</li>
<li><p><code>recrShrubZ50 [= 500]</code>: Default value for Z95 (mm) in seed-recruited shrubs  (when species parameter <code>RecrZ50</code> is missing).
</p>
</li></ul>




<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwbInput">spwbInput</a></code>, <code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+growth">growth</a></code>, <code><a href="#topic+fordyn">fordyn</a></code>
</p>

<hr>
<h2 id='defaultManagementFunction'>Default forest management actions</h2><span id='topic+defaultManagementFunction'></span><span id='topic+defaultManagementArguments'></span>

<h3>Description</h3>

<p>Function <code>defaultManagementFunction</code> implements actions for 'regular' and 'irregular' management models of monospecific or mixed stands, 
whereas function <code>defaultManagementArguments</code> returns a list with default values for the parameters regulating management. 
Both functions are meant to be used in simulations with <code><a href="#topic+fordyn">fordyn</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>defaultManagementFunction(x, args, verbose = FALSE)

defaultManagementArguments()
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="defaultManagementFunction_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+forest">forest</a></code></p>
</td></tr>
<tr><td><code id="defaultManagementFunction_+3A_args">args</code></td>
<td>
<p>A list of arguments regulating management actions, e.g. the list returned by <code>defaultManagementArguments</code></p>
</td></tr>
<tr><td><code id="defaultManagementFunction_+3A_verbose">verbose</code></td>
<td>
<p>A logical flag enabling console printing</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function implements silvicultural actions following either 'regular' or 'irregular' management models. 
Irregular models are implemented by executing thinning operations only, whereas regular models include both thinning and a set of final cuts. 
Thinning occurs anytime a stand-level metric (e.g. basal area) crosses a given threshold, and different kinds of thinning operations are allowed. 
Unrealistic high frequency thinning can be avoided by setting a minimum number of years to happen between thinning operations. 
Final cuts start whenever mean DBH exceeds a given threshold, and may include different cuts separated a number of years. 
The function can be applied to target management of specific taxa (instead of assuming a monospecific stand), but the thresholds that determine
thinning operations apply to stand-level metrics. Mean DBH will be calculated for the target species only.
Planting is only allowed under regular management models, and is applied after the last final cut. 
Understory clearings are assumed to occur anytime there is an intervention on trees, an only a residual shrub cover is left.
</p>
<p><em>Thinning types</em>:
</p>

<ul>
<li><p><code>above</code>: Extract largest trees (according to DBH) until thinning objective is met.
</p>
</li>
<li><p><code>below</code>: Extract smallest trees (according to DBH) until thinning objective is met.
</p>
</li>
<li><p><code>systematic</code>: Extract equally from all size classes until thinning objective is met.
</p>
</li>
<li><p><code>above-systematic</code>: Extract half the objective as systematic thinning and the other hald as above thinning.
</p>
</li>
<li><p><code>below-systematic</code>: Extract half the objective as systematic thinning and the other hald as below thinning.
</p>
</li>
<li><p><code>free string</code>: A string specifying the proportion of tree cuts from size classes, with size classes separated by &quot;/&quot; and each one composed of a number specifying the upper limit and a number indicating its proportion, separated by &quot;-&quot; (e.g. &quot;10-50/40-30/60-20&quot;).
</p>
</li></ul>



<h3>Value</h3>

<p>Function <code>defaultManagementFunction</code> returns a list with the following items:
</p>

<ul>
<li><p><code>"action"</code>: A string identifying the action performed (e.g. &quot;thinning&quot;).
</p>
</li>
<li><p><code>"N_tree_cut"</code>: A vector with the density of trees removed.
</p>
</li>
<li><p><code>"Cover_shrub_cut"</code>: A vector with the cover of shrubs removed. 
</p>
</li>
<li><p><code>"planted_forest"</code>: An object of class <code><a href="#topic+forest">forest</a></code> with the new plant cohorts resulting from tree/shrub planting.
</p>
</li>
<li><p><code>"management_args"</code>: A list of management arguments to be used in the next call to the management function.
</p>
</li></ul>

<p>Function <code>defaultManagementArguments</code> returns a list with default arguments:
</p>

<ul>
<li><p><code>"type"</code>: Management model, either 'regular' or 'irregular'.
</p>
</li>
<li><p><code>"targetTreeSpecies"</code>: Either <code>"all"</code> for unspecific cuttings or a numeric vector of target tree species to be selected for cutting operations.
</p>
</li>
<li><p><code>"thinning"</code>: Kind of thinning to be applied in irregular models or in regular models before the final cuts. Options are 'below', 'above', 'systematic', 'below-systematic', 'above-systematic' or a string with the proportion of cuts to be applied to different diameter sizes (see details).
</p>
</li>
<li><p><code>"thinningMetric"</code>: The stand-level metric used to decide whether thinning is applied, either 'BA' (basal area), 'N' (density) or 'HB' (Hart-Becking index). 
</p>
</li>
<li><p><code>"thinningThreshold"</code>: The threshold value of the stand-level metric causing the thinning decision.
</p>
</li>
<li><p><code>"thinningPerc"</code>: Percentage of stand's basal area to be removed in thinning operations.
</p>
</li>
<li><p><code>"minThinningInterval"</code>: Minimum number of years between thinning operations.
</p>
</li>
<li><p><code>"yearsSinceThinning"</code>: State variable to count the years since the last thinning ocurred.
</p>
</li>
<li><p><code>"finalMeanDBH"</code>: Mean DBH threshold to start final cuts.
</p>
</li>
<li><p><code>"finalPerc"</code>: String with percentages of basal area to be removed in final cuts, separated by '-' (e.g. &quot;40-60-100&quot;).
</p>
</li>
<li><p><code>"finalPreviousStage"</code>: Integer state variable to store the stage of final cuts ('0' before starting final cuts).
</p>
</li>
<li><p><code>"finalYearsBetweenCuts"</code>: Number of years separating final cuts.
</p>
</li>
<li><p><code>"finalYearsToCut"</code>: State variable to count the years to be passed before new final cut is applied.
</p>
</li>
<li><p><code>"plantingSpecies"</code>: Species code to be planted. If missing, planting does not occur and only natural regeneration is allowed.
</p>
</li>
<li><p><code>"plantingDBH"</code>: Initial DBH (cm) of planted species.
</p>
</li>
<li><p><code>"plantingHeight"</code>: Initial height (cm) of planted species.
</p>
</li>
<li><p><code>"plantingDensity"</code>: Initial density (ind./ha) of the planted species.
</p>
</li>
<li><p><code>"understoryMaximumCover"</code>: Percentage of overall shrub cover to be left after any silvicultural intervention. 
If missing, shrub cover will not be left unmodified.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>
<p>Aitor Améztegui, UdL
</p>
<p>Jose-Ramon Gonzalez Olabarria, CTFC
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fordyn">fordyn</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Load example forest object
data(exampleforestMED)
  
# Define arguments
args = defaultManagementArguments()
  
# Call management function
f = defaultManagementFunction(exampleforestMED, args)
  
#list names
names(f)
  
# Action performed
f$action
  
# Number of trees cut for each cohort
f$N_tree_cut
  
# Percent cover of shrubs removed
f$Cover_shrub_cut
  
</code></pre>

<hr>
<h2 id='defaultSoilParams'>Default soil parameters</h2><span id='topic+defaultSoilParams'></span>

<h3>Description</h3>

<p>Creates a data frame with default soil physical description for model functions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>defaultSoilParams(n = 4)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="defaultSoilParams_+3A_n">n</code></td>
<td>
<p>An integer with the number of soil layers (between two and five).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function returns a data frame with default physical soil description, with soil layers in rows. 
Users can change those that need to be set to other values and use the list as input for function <code><a href="#topic+soil">soil</a></code>.
</p>


<h3>Value</h3>

<p>A data frame with layers in rows and the following columns (and default values):
</p>

<ul>
<li><p><code>widths (= c(300,700,1000,2000)</code>: Width of soil layers (in mm).
</p>
</li>
<li><p><code>clay (= 25)</code>: Clay percentage for each layer (in %).
</p>
</li>
<li><p><code>sand (= 25)</code>: Sand percentage for each layer (in %).
</p>
</li>
<li><p><code>om (= NA)</code>: Organic matter percentage for each layer (in %).
</p>
</li>
<li><p><code>bd (= 1.5)</code>: Bulk density for each layer (in g/cm3).
</p>
</li>
<li><p><code>rfc (= c(20,40,60,85))</code>: Percentage of rock fragment content (volume basis) for each layer.
</p>
</li></ul>



<h3>Note</h3>

<p>While this function is limited to five soil layers, user defined data frames can discretize soils using an unlimited number of soil layers.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+soil">soil</a></code>,  <code><a href="#topic+defaultControl">defaultControl</a></code>, <code><a href="#topic+SpParamsMED">SpParamsMED</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>defaultSoilParams(4)

</code></pre>

<hr>
<h2 id='droughtStress'>Drought stress indicators</h2><span id='topic+droughtStress'></span>

<h3>Description</h3>

<p>Calculates plant drought stress indices, at different temporal scales, from simulation results.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>droughtStress(x, index = "NDD", freq = "years", bySpecies = FALSE, draw = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="droughtStress_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+pwb">pwb</a></code>, <code><a href="#topic+growth">growth</a></code> or <code><a href="#topic+fordyn">fordyn</a></code>.</p>
</td></tr>
<tr><td><code id="droughtStress_+3A_index">index</code></td>
<td>
<p>A string with the index to be calculated, either <code>"DI"</code>, <code>"NDD"</code>, <code>"ADS"</code>, <code>"MDS"</code> or <code>"WSI"</code> (see details).</p>
</td></tr>
<tr><td><code id="droughtStress_+3A_freq">freq</code></td>
<td>
<p>Frequency of stress statistics (see <code><a href="base.html#topic+cut.Date">cut.Date</a></code>). Normally, either <code>"years"</code> or <code>"months"</code> for yearly-based or monthly-based indices.</p>
</td></tr>
<tr><td><code id="droughtStress_+3A_byspecies">bySpecies</code></td>
<td>
<p>Allows aggregating output by species.</p>
</td></tr>
<tr><td><code id="droughtStress_+3A_draw">draw</code></td>
<td>
<p>A boolean flag to indicate that a plot should be returned.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The currently available drought stress indices are:
</p>

<ul>
<li><p><code>"ADS"</code>: Average of daily drought stress values for the period considered.
</p>
</li>
<li><p><code>"MDS"</code>: Maximum daily drought stress during the period considered.
</p>
</li>
<li><p><code>"DI"</code>: Drought intensity, as defined in De Cáceres et al. (2015).
</p>
</li>
<li><p><code>"NDD"</code>: Number of drought days, as defined in De Cáceres et al. (2015).
</p>
</li>
<li><p><code>"WSI"</code>: Water stress integral, as defined in Myers (1988).
</p>
</li></ul>



<h3>Value</h3>

<p>A data frame with periods (e.g., years or months) in rows and plant cohorts (or species) in columns. 
Values are the calculated stress index. If <code>draw=TRUE</code> a ggplot is returned instead.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>De Cáceres M, Martínez-Vilalta J, Coll L, Llorens P, Casals P, Poyatos R, Pausas JG, Brotons L. (2015) Coupling a water balance model with forest inventory data to predict drought stress: the role of forest structural changes vs. climate changes. Agricultural and Forest Meteorology 213: 77-90 (doi:10.1016/j.agrformet.2015.06.012).
</p>
<p>Myers BJ (1988) Water stress integral - a link between short-term stress and long-term growth. Tree Physiology 4: 315–323 (doi: 10.1093/treephys/4.4.315)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+summary.spwb">summary.spwb</a></code>, <code><a href="#topic+waterUseEfficiency">waterUseEfficiency</a></code>
</p>

<hr>
<h2 id='evaluation'>Evaluation of simulations results</h2><span id='topic+evaluation'></span><span id='topic+evaluation_table'></span><span id='topic+evaluation_stats'></span><span id='topic+evaluation_plot'></span><span id='topic+evaluation_metric'></span>

<h3>Description</h3>

<p>Functions to compare model predictions against observed values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>evaluation_table(
  out,
  measuredData,
  type = "SWC",
  cohort = NULL,
  temporalResolution = "day"
)

evaluation_stats(
  out,
  measuredData,
  type = "SWC",
  cohort = NULL,
  temporalResolution = "day"
)

evaluation_plot(
  out,
  measuredData,
  type = "SWC",
  cohort = NULL,
  temporalResolution = "day",
  plotType = "dynamics"
)

evaluation_metric(
  out,
  measuredData,
  type = "SWC",
  cohort = NULL,
  temporalResolution = "day",
  metric = "loglikelihood"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="evaluation_+3A_out">out</code></td>
<td>
<p>An object of class <code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+growth">growth</a></code> or <code><a href="#topic+pwb">pwb</a></code>.</p>
</td></tr>
<tr><td><code id="evaluation_+3A_measureddata">measuredData</code></td>
<td>
<p>A data frame with observed/measured values. Dates should be in row names, whereas columns should be named according to the type of output to be evaluated (see details).</p>
</td></tr>
<tr><td><code id="evaluation_+3A_type">type</code></td>
<td>
<p>A string with the kind of model output to be evaluated. Accepted values are <code>"SWC"</code> (soil moisture content), <code>"REW"</code> relative extractable water, <code>"ETR"</code> (total evapotranspiration), 
<code>"SE+TR"</code> (modelled soil evaporation + transpiration against observed total evapotranspiration), <code>"E"</code> (transpiration per leaf area), <code>"LFMC"</code> (Live fuel moisture content), <code>"WP"</code> (plant water potentials), 
<code>"BAI"</code> (basal area increment), <code>"DI"</code> (diameter increment), 
<code>"DBH"</code> (diameter at breast height) or <code>"Height"</code> (plant height).</p>
</td></tr>
<tr><td><code id="evaluation_+3A_cohort">cohort</code></td>
<td>
<p>A string of the cohort to be compared (e.g. &quot;T1_68&quot;). If <code>NULL</code> results for the first cohort will be evaluated.</p>
</td></tr>
<tr><td><code id="evaluation_+3A_temporalresolution">temporalResolution</code></td>
<td>
<p>A string to indicate the temporal resolution of the model evaluation, which can be &quot;day&quot;, &quot;week&quot;, &quot;month&quot; or &quot;year&quot;. Observed and modelled values are aggregated temporally (using either means or sums) before comparison.</p>
</td></tr>
<tr><td><code id="evaluation_+3A_plottype">plotType</code></td>
<td>
<p>Plot type to draw, either <code>"dynamics"</code> or <code>"scatter"</code>.</p>
</td></tr>
<tr><td><code id="evaluation_+3A_metric">metric</code></td>
<td>
<p>An evaluation metric:
</p>

<ul>
<li><p><code>"MAE"</code>: Mean absolute error.
</p>
</li>
<li><p><code>"MAE.rel"</code>: Mean absolute error in relative terms.
</p>
</li>
<li><p><code>"r"</code>: Pearson's linear correlation coefficient.
</p>
</li>
<li><p><code>"NSE"</code>: Nash-Sutcliffe model efficiency coefficient.
</p>
</li>
<li><p><code>"NSE.abs"</code>: Modified Nash-Sutcliffe model efficiency coefficient (L1 norm) (Legates &amp; McCabe 1999).
</p>
</li>
<li><p><code>"loglikelihood"</code>: Logarithm of the likelihood of observing the data given the model predictions, assuming independent Gaussian errors.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>Users should provide the appropriate columns in <code>measuredData</code>, depending on the type of output to be evaluated:
</p>

<ul>
<li><p><code>"SWC" or "REW"</code>: A column named <code>"SWC"</code> should be present, containing soil moisture content in percent volume. When <code>type="REW"</code>, observed values are divided by the 90% quantile, which is assumed to be the moisture content at field capacity.
</p>
</li>
<li><p><code>"ETR"</code> or <code>"SE+TR"</code>: A column named <code>"ETR"</code> should be present, containing stand's evapotranspiration in mm/day (or mm/week, mm/month, etc, depending on the temporal resolution). If <code>type="ETR"</code> observed values will be compared against modelled evapotranspiration (i.e. sum of transpiration, soil evaporation and interception loss), whereas if <code>type= "SE+TR"</code> observed values will be compared against the sum of transpiration and soil evaporation only.
</p>
</li>
<li><p><code>"E"</code>: For each plant cohort whose transpiration is to be evaluated, a column starting with <code>"E_"</code> and continuing with a cohort name (e.g. <code>"E_T1_68"</code>) with transpiration in L/m2/day on a leaf area basis (or L/m2/week, L/m2/month, etc, depending on the temporal resolution).
</p>
</li>
<li><p><code>"LFMC"</code>: For each plant cohort whose transpiration is to be evaluated, a column starting with <code>"FCM_"</code> and continuing with a cohort name (e.g. <code>"FMC_T1_68"</code>) with fuel moisture content as percent of dry weight.
</p>
</li>
<li><p><code>"WP"</code>: For each plant cohort whose transpiration is to be evaluated, two columns, one starting with <code>"PD_"</code> (for pre-dawn) and the other with <code>"MD_"</code> (for midday), and continuing with a cohort name (e.g. <code>"PD_T1_68"</code>). They should contain leaf water potential values in MPa. These are compared against sunlit water potentials.
</p>
</li>
<li><p><code>"BAI"</code>: For each plant cohort whose growth is to be evaluated, a column starting with <code>"BAI_"</code> and continuing with a cohort name (e.g. <code>"BAI_T1_68"</code>) with basal area increment in cm2/day, cm2/week, cm2/month or cm2/year, depending on the temporal resolution.
</p>
</li>
<li><p><code>"DI"</code>: For each plant cohort whose growth is to be evaluated, a column starting with <code>"DI_"</code> and continuing with a cohort name (e.g. <code>"DI_T1_68"</code>) with basal area increment in cm/day, cm/week, cm/month or cm/year, depending on the temporal resolution.
</p>
</li>
<li><p><code>"DBH"</code>: For each plant cohort whose growth is to be evaluated, a column starting with <code>"DBH_"</code> and continuing with a cohort name (e.g. <code>"DBH_T1_68"</code>) with DBH values in cm.
</p>
</li>
<li><p><code>"Height"</code>: For each plant cohort whose growth is to be evaluated, a column starting with <code>"Height_"</code> and continuing with a cohort name (e.g. <code>"Height_T1_68"</code>) with Height values in cm.
</p>
</li></ul>

<p>Additional columns may exist with the standard error of measured quantities. These should be named as the referred quantity, followed by <code>"_err"</code> (e.g. <code>"PD_T1_68_err"</code>), and are used to draw confidence intervals around observations.
</p>
<p>Row names in <code>measuredData</code> indicate the date of measurement (in the case of days). If measurements refer to months or years, row names should also be in a &quot;year-month-day&quot; format, although with &quot;01&quot; for days and/or months (e.g. &quot;2001-02-01&quot; for february 2001, or &quot;2001-01-01&quot; for year 2001).
</p>


<h3>Value</h3>


<ul>
<li><p>Function <code>evaluation_table</code> returns a data frame with dates, observed and predicted values.
</p>
</li>
<li><p>Function <code>evaluation_stats</code> returns evaluation statistics (a vector or a data frame depending on <code>type</code>):
</p>

<ul>
<li><p><code>Bias</code>: Mean deviation (positive values correspond to model overestimations).
</p>
</li>
<li><p><code>Bias.rel</code>: Bias in relative terms (%).
</p>
</li>
<li><p><code>MAE</code>: Mean absolute error.
</p>
</li>
<li><p><code>MAE.rel</code>: Mean absolute error in relative terms (%).
</p>
</li>
<li><p><code>r</code>: Pearson's linear correlation coefficient.
</p>
</li>
<li><p><code>NSE</code>: Nash-Sutcliffe model efficiency coefficient.
</p>
</li>
<li><p><code>NSE.abs</code>: Modified Nash-Sutcliffe model efficiency coefficient (L1 norm) (Legates &amp; McCabe 1999).
</p>
</li></ul>


</li>
<li><p>Function <code>evaluation_plot</code> returns a ggplot object.
</p>
</li>
<li><p>Function <code>evaluation_metric</code> returns a scalar with the desired metric.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>Legates, D.R., McCabe, G.J., 1999. Evaluating the use of “goodness-of-fit” measures in hydrologic and hydroclimatic model validation. Water Resour. Res. 35, 233–241.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+growth">growth</a></code>, <code><a href="#topic+optimization">optimization</a></code>, <code><a href="#topic+exampleobs">exampleobs</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Load example daily meteorological data
data(examplemeteo)

#Load example plot plant data
data(exampleforestMED)

#Default species parameterization
data(SpParamsMED)

#Initialize soil with default soil params (4 layers)
examplesoil = soil(defaultSoilParams(4))

#Initialize control parameters
control = defaultControl("Granier")

#Initialize input
x1 = forest2spwbInput(exampleforestMED,examplesoil, SpParamsMED, control)

#Call simulation function
S1&lt;-spwb(x1, examplemeteo, latitude = 41.82592, elevation = 100)

#Load observed data (in this case the same simulation results with some added error)  
data(exampleobs)

#Evaluation statistics for soil water content
evaluation_stats(S1, exampleobs)

#NSE only
evaluation_metric(S1, exampleobs, metric="NSE")

#Comparison of temporal dynamics
evaluation_plot(S1, exampleobs)

#Loglikelihood value
evaluation_metric(S1, exampleobs)

</code></pre>

<hr>
<h2 id='exampleforest'>Example forest stands</h2><span id='topic+exampleforestMED'></span><span id='topic+exampleforestMED2'></span>

<h3>Description</h3>

<p>Data set for illustration of model behaviour. Includes a description of the plant cohorts of a forest stand.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(exampleforestMED)
data(exampleforestMED2)
</code></pre>


<h3>Format</h3>

<p>An object of class <code><a href="#topic+forest">forest</a></code> containing the description of the woody (tree or shrub) cohorts and herb layer of a forest patch. <code>exampleforestMED</code> represents the standard forest inventory description, whereas <code>exampleforestMED2</code> is an alternative forest description where leaf area index and crown ratio are supplied instead of structural (density, DBH and cover) parameters. 
</p>


<h3>Source</h3>

<p>DGCN (2005). Tercer Inventario Forestal Nacional (1997-2007): Catalunya. Dirección General de Conservación de la Naturaleza, Ministerio de Medio Ambiente, Madrid.
</p>


<h3>See Also</h3>

 <p><code><a href="#topic+forest">forest</a></code>, <code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+forest2spwbInput">forest2spwbInput</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>data(exampleforestMED)
data(exampleforestMED2)
</code></pre>

<hr>
<h2 id='examplemeteo'>Example daily meteorology data</h2><span id='topic+examplemeteo'></span>

<h3>Description</h3>

<p>Example data set of meteorological input.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(examplemeteo)</code></pre>


<h3>Format</h3>

<p>A data frame containing daily meteorology of a location in Catalonia (Spain) for year 2001.
</p>

<dl>
<dt><code>MinTemperature</code></dt><dd><p>Minimum daily temperature (in degrees Celsius).</p>
</dd>
<dt><code>MaxTemperature</code></dt><dd><p>Maximum daily temperature (in degrees Celsius).</p>
</dd>
<dt><code>Precipitation</code></dt><dd><p>Daily precipitation (in mm of water).</p>
</dd>
<dt><code>MinRelativeHumidity</code></dt><dd><p>Minimum daily relative humidity (in percent).</p>
</dd>
<dt><code>MaxRelativeHumidity</code></dt><dd><p>Maximum daily relative humidity (in percent).</p>
</dd>
<dt><code>Radiation</code></dt><dd><p>Incoming radiation (in MJ/m2).</p>
</dd>
<dt><code>WindSpeed</code></dt><dd><p>Wind speed (in m/s).</p>
</dd>
</dl>



<h3>Source</h3>

<p>Interpolated from weather station data (Spanish and Catalan meteorology agencies) using package 'meteoland'.
</p>


<h3>See Also</h3>

 <p><code><a href="#topic+spwb">spwb</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>data(examplemeteo)
</code></pre>

<hr>
<h2 id='exampleobs'>Example observed data</h2><span id='topic+exampleobs'></span>

<h3>Description</h3>

<p>Example (fake) data set of variables measured in a plot. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(exampleobs)</code></pre>


<h3>Format</h3>

<p>A data frame containing daily 'observed' values for year 2001.
</p>

<dl>
<dt><code>SWC</code></dt><dd><p>Soil moisture content (in m3/m3).</p>
</dd>
<dt><code>ETR</code></dt><dd><p>Total evapotranspiration (mm).</p>
</dd>
<dt><code>E_T1_148</code></dt><dd><p>Transpiration of Pinus halepensis cohort 'T1_148' (L/m2 of leaf area).</p>
</dd>
<dt><code>E_T2_168</code></dt><dd><p>Transpiration of Quercus ilex cohort 'T2_168' (L/m2 of leaf area).</p>
</dd>
<dt><code>FMC_T1_148</code></dt><dd><p>Fuel moisture content of Pinus halepensis cohort 'T1_148'  (in percent).</p>
</dd>
<dt><code>FMC_T2_168</code></dt><dd><p>Fuel moisture content of Quercus ilex cohort 'T2_168' (in percent).</p>
</dd>
<dt><code>BAI_T1_148</code></dt><dd><p>Basal area increment for Pinus halepensis cohort 'T1_148'  (in cm2).</p>
</dd>
<dt><code>BAI_T2_168</code></dt><dd><p>Basal area increment for Quercus ilex cohort 'T2_168' (in cm2).</p>
</dd>
<dt><code>DI_T1_148</code></dt><dd><p>Diameter increment for Pinus halepensis cohort 'T1_148'  (in cm).</p>
</dd>
<dt><code>DI_T2_168</code></dt><dd><p>Diameter increment for Quercus ilex cohort 'T2_168' (in cm).</p>
</dd>
</dl>



<h3>Source</h3>

<p>This data set was actually created by running a simulation and adding some gaussian error to the outputs.
</p>


<h3>See Also</h3>

 <p><code><a href="#topic+evaluation">evaluation</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>data(exampleobs)
</code></pre>

<hr>
<h2 id='extractSubdaily'>Extracts subdaily output</h2><span id='topic+extractSubdaily'></span>

<h3>Description</h3>

<p>Given the result of simulations, this function extracts subdaily output corresponding to each simulated day and returns it as a data frame.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extractSubdaily(x, output = "E", dates = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extractSubdaily_+3A_x">x</code></td>
<td>
<p>An object returned by simulation functions <code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+pwb">pwb</a></code> or <code><a href="#topic+growth">growth</a></code>.</p>
</td></tr>
<tr><td><code id="extractSubdaily_+3A_output">output</code></td>
<td>
<p>See options in section details.</p>
</td></tr>
<tr><td><code id="extractSubdaily_+3A_dates">dates</code></td>
<td>
<p>A date vector indicating the subset of simulated days for which subdaily output is desired.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function only works when simulations have been carried using control option 'subdailyResults = TRUE' (see <code><a href="#topic+defaultControl">defaultControl</a></code>). Subdaily simulation results will then be stored as elements of the a list called 'subdaily' in the simulation output. Function <code>extractSubdaily</code> will assemble subdaily results from this list and return them as a data frame. Options for parameter 'output' are the following:
</p>

<ul>
<li><p>Functions pwb() and spwb(): &quot;E&quot;,&quot;Ag&quot;,&quot;An&quot;,&quot;dEdP&quot;,&quot;RootPsi&quot;,&quot;StemPsi&quot;,&quot;LeafPsi&quot;,&quot;StemPLC&quot;,&quot;StemRWC&quot;,&quot;LeafRWC&quot;,&quot;StemSympRWC&quot;,&quot;LeafSympRWC&quot;,&quot;PWB&quot;, &quot;Temperature&quot;, &quot;ExtractionInst&quot;.
</p>
</li>
<li><p>Additional options for shade and sunlit leaves in pwb() and spbw(): Either &quot;SunlitLeaves$x&quot; or &quot;ShadeLeaves$x&quot; where 'x' is one of the following: &quot;Abs_SWR&quot;,&quot;Abs_PAR&quot;,&quot;Net_LWR&quot;,&quot;E&quot;,&quot;Ag&quot;,&quot;An&quot;,&quot;Ci&quot;,&quot;Gsw&quot;,&quot;VPD&quot;,&quot;Temp&quot;,&quot;Psi&quot;,&quot;iWUE&quot;.
</p>
</li>
<li><p>Additional options for function growth(): &quot;GrossPhotosynthesis&quot;, &quot;MaintenanceRespiration&quot;, &quot;GrowthCosts&quot;, &quot;LabileCarbonBalance&quot;,&quot;SugarLeaf&quot;, &quot;SugarSapwood&quot;, &quot;StarchLeaf&quot;, &quot;StarchSapwood&quot;,&quot;SugarTransport&quot;.
</p>
</li></ul>



<h3>Value</h3>

<p>A data frame with a column 'datetime' and as many columns as plant cohorts.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+summary.spwb">summary.spwb</a></code>
</p>

<hr>
<h2 id='fire_behaviour'>Fire behaviour functions</h2><span id='topic+fire_behaviour'></span><span id='topic+fire_FCCS'></span><span id='topic+fire_Rothermel'></span>

<h3>Description</h3>

<p>Function <code>fire_FCCS()</code> implements a modification of the fire behavior models 
described for the Fuel Characteristics Classification System (FCCS) in Prichard et al. (2013). 
Function <code>fire_Rothermel()</code> implements Rothermel's (1972) fire behaviour 
model (modified from package 'Rothermel' (Giorgio Vacchiano, Davide Ascoli)).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fire_FCCS(
  FCCSpropsSI,
  MliveSI = as.numeric(c(90, 90, 60)),
  MdeadSI = as.numeric(c(6, 6, 6, 6, 6)),
  slope = 0,
  windSpeedSI = 11
)

fire_Rothermel(
  modeltype,
  wSI,
  sSI,
  delta,
  mx_dead,
  hSI,
  mSI,
  u,
  windDir,
  slope,
  aspect
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fire_behaviour_+3A_fccspropssi">FCCSpropsSI</code></td>
<td>
<p>A data frame describing the properties of five fuel strata (canopy, shrub, herbs, dead woody and litter) returned by <code><a href="#topic+fuel_FCCS">fuel_FCCS</a></code>.</p>
</td></tr>
<tr><td><code id="fire_behaviour_+3A_mlivesi">MliveSI</code></td>
<td>
<p>Moisture of live fuels (in percent of dry weight) for canopy, shrub, and herb strata. Live moisture values are drawn from column <code>ActFCM</code> in <code>FCCSpropsSI</code> if available (see <code><a href="#topic+fuel_FCCS">fuel_FCCS</a></code>). Otherwise, moisture values supplied for <code>MliveSI</code> are used.</p>
</td></tr>
<tr><td><code id="fire_behaviour_+3A_mdeadsi">MdeadSI</code></td>
<td>
<p>Moisture of dead fuels (in percent of dry weight) for canopy, shrub, herb, woody and litter strata.</p>
</td></tr>
<tr><td><code id="fire_behaviour_+3A_slope">slope</code></td>
<td>
<p>Slope (in degrees).</p>
</td></tr>
<tr><td><code id="fire_behaviour_+3A_windspeedsi">windSpeedSI</code></td>
<td>
<p>Wind speed (in m/s) at 20 ft (6 m) over vegetation (default 11 m/s = 40 km/h)</p>
</td></tr>
<tr><td><code id="fire_behaviour_+3A_modeltype">modeltype</code></td>
<td>
<p>'S'(tatic) or 'D'(ynamic)</p>
</td></tr>
<tr><td><code id="fire_behaviour_+3A_wsi">wSI</code></td>
<td>
<p>A vector of fuel load (t/ha) for five fuel classes.</p>
</td></tr>
<tr><td><code id="fire_behaviour_+3A_ssi">sSI</code></td>
<td>
<p>A vector of surface-to-volume ratio (m2/m3) for five fuel classes.</p>
</td></tr>
<tr><td><code id="fire_behaviour_+3A_delta">delta</code></td>
<td>
<p>A value of fuel bed depth (cm).</p>
</td></tr>
<tr><td><code id="fire_behaviour_+3A_mx_dead">mx_dead</code></td>
<td>
<p>A value of dead fuel moisture of extinction (percent).</p>
</td></tr>
<tr><td><code id="fire_behaviour_+3A_hsi">hSI</code></td>
<td>
<p>A vector of heat content (kJ/kg) for five fuel classes.</p>
</td></tr>
<tr><td><code id="fire_behaviour_+3A_msi">mSI</code></td>
<td>
<p>A vector of percent moisture on a dry weight basis (percent) for five fuel classes.</p>
</td></tr>
<tr><td><code id="fire_behaviour_+3A_u">u</code></td>
<td>
<p>A value of windspeed (m/s) at midflame height.</p>
</td></tr>
<tr><td><code id="fire_behaviour_+3A_winddir">windDir</code></td>
<td>
<p>Wind direction (in degrees from north). North means blowing from north to south.</p>
</td></tr>
<tr><td><code id="fire_behaviour_+3A_aspect">aspect</code></td>
<td>
<p>Aspect (in degrees from north).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Default moisture, slope and windspeed values are benchmark conditions 
used to calculate fire potentials (Sandberg et al. 2007) and map vulnerability to fire.
</p>


<h3>Value</h3>

<p>Both functions return list with fire behavior variables. 
</p>
<p>In the case of <code>fire_FCCS</code>, the function returns the variables in three blocks (lists <code>SurfaceFire</code>, <code>CrownFire</code> and <code>FirePotentials</code>), and the values are:
</p>

<ul>
<li><p><code>SurfaceFire$`midflame_WindSpeed [m/s]`</code>: Midflame wind speed in the surface fire.
</p>
</li>
<li><p><code>SurfaceFire$phi_wind</code>: Spread rate modifier due to wind.
</p>
</li>
<li><p><code>SurfaceFire$phi_slope</code>: Spread rate modifier due to slope.
</p>
</li>
<li><p><code>SurfaceFire$`I_R_surf [kJ/m2/min]`</code>: Intensity of the surface fire reaction.
</p>
</li>
<li><p><code>SurfaceFire$`I_R_litter [kJ/m2/min]`</code>: Intensity of the litter fire reaction.
</p>
</li>
<li><p><code>SurfaceFire$`q_surf [kJ/m2]`</code>: Heat sink of the surface fire.
</p>
</li>
<li><p><code>SurfaceFire$`q_litter [kJ/m2]`</code>: Heat sink of the litter fire.
</p>
</li>
<li><p><code>SurfaceFire$xi_surf</code>: Propagating flux ratio of the surface fire.
</p>
</li>
<li><p><code>SurfaceFire$xi_litter</code>: Propagating flux ratio of the litter fire.
</p>
</li>
<li><p><code>SurfaceFire$`ROS_surf [m/min]`</code>: Spread rate of the surface fire(without accounting for faster spread in the litter layer).
</p>
</li>
<li><p><code>SurfaceFire$`ROS_litter [m/min]`</code>: Spread rate of the litter fire.
</p>
</li>
<li><p><code>SurfaceFire$`ROS_windslopecap [m/min]`</code>: Maximum surface fire spread rate according to wind speed.
</p>
</li>
<li><p><code>SurfaceFire$`ROS [m/min]`</code>: Final spread rate of the surface fire.
</p>
</li>
<li><p><code>SurfaceFire$`I_b [kW/m]`</code>: Fireline intensity of the surface fire.
</p>
</li>
<li><p><code>SurfaceFire$`FL [m]`</code>: Flame length of the surface fire.
</p>
</li>
<li><p><code>CrownFire$`I_R_canopy [kJ/m2/min]`</code>: Intensity of the canopy fire reaction.
</p>
</li>
<li><p><code>CrownFire$`I_R_crown [kJ/m2/min]`</code>: Intensity of the crown fire reaction (adding surface and canopy reactions).
</p>
</li>
<li><p><code>CrownFire$`q_canopy [kJ/m2]`</code>: Heat sink of the canopy fire.
</p>
</li>
<li><p><code>CrownFire$`q_crown [kJ/m2]`</code>: Heat sink of the crown fire (adding surface and canopy heat sinks).
</p>
</li>
<li><p><code>CrownFire$xi_surf</code>: Propagating flux ratio of the crown fire.
</p>
</li>
<li><p><code>CrownFire$`canopy_WindSpeed [m/s]`</code>: Wind speed in the canopy fire (canopy top wind speed).
</p>
</li>
<li><p><code>CrownFire$WAF</code>: Wind speed adjustment factor for crown fires.
</p>
</li>
<li><p><code>CrownFire$`ROS [m/min]`</code>: Spread rate of the crown fire.
</p>
</li>
<li><p><code>CrownFire$Ic_ratio</code>: Crown initiation ratio.
</p>
</li>
<li><p><code>CrownFire$`I_b [kW/m]`</code>: Fireline intensity of the crown fire.
</p>
</li>
<li><p><code>CrownFire$`FL [m]`</code>: Flame length of the crown fire.
</p>
</li>
<li><p><code>FirePotentials$RP</code>: Surface fire reaction potential ([0-9]).
</p>
</li>
<li><p><code>FirePotentials$SP</code>: Surface fire spread rate potential ([0-9]).
</p>
</li>
<li><p><code>FirePotentials$FP</code>: Surface fire flame length potential ([0-9]).
</p>
</li>
<li><p><code>FirePotentials$SFP</code>: Surface fire potential ([0-9]).
</p>
</li>
<li><p><code>FirePotentials$IC</code>: Crown initiation potential ([0-9]).
</p>
</li>
<li><p><code>FirePotentials$TC</code>: Crown-to-crown transmission potential ([0-9]).
</p>
</li>
<li><p><code>FirePotentials$RC</code>: Crown fire spread rate potential ([0-9]).
</p>
</li>
<li><p><code>FirePotentials$CFC</code>: Crown fire potential ([0-9]).
</p>
</li></ul>



<h3>Note</h3>

<p>Default moisture, slope and windspeed values are benchmark conditions used to calculate fire potentials (Sandberg et al. 2007) and map vulnerability to fire.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>Albini, F. A. (1976). Computer-based models of wildland fire behavior: A users' manual. Ogden, UT: US Department of Agriculture, Forest Service, Intermountain Forest and Range Experiment Station.
</p>
<p>Rothermel, R. C. 1972. A mathematical model for predicting fire spread in wildland fuels. USDA Forest Service Research Paper INT USA.
</p>
<p>Prichard, S. J., D. V Sandberg, R. D. Ottmar, E. Eberhardt, A. Andreu, P. Eagle, and K. Swedin. 2013. Classification System Version 3.0: Technical Documentation.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fuel_FCCS">fuel_FCCS</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Load example plot plant data
data(exampleforestMED)

#Default species parameterization
data(SpParamsMED)

#Calculate fuel properties according to FCCS
fccs = fuel_FCCS(exampleforestMED, SpParamsMED)
  
#Calculate fire behavior according to FCCS
fire_FCCS(fccs)
  
#Load fuel model parameter data
data(SFM_metric)
      
#Fuel stratification (returns heights in cm)
fs = fuel_stratification(exampleforestMED, SpParamsMED)

#Correct windspeed (transform heights to m)
u = 11 #m/s
umf = u*fuel_windAdjustmentFactor(fs$surfaceLayerTopHeight/100, 
                                  fs$canopyBaseHeight/100, 
                                  fs$canopyTopHeight/100, 60)
      
#Call Rothermel function using fuel model 'A6'
fire_Rothermel(modeltype="D", wSI = as.numeric(SFM_metric["A6",2:6]), 
               sSI = as.numeric(SFM_metric["A6",7:11]), 
               delta = as.numeric(SFM_metric["A6",12]),
               mx_dead = as.numeric(SFM_metric["A6",13]),
               hSI = as.numeric(SFM_metric["A6",14:18]),
               mSI = c(10,10,10,30,60),
               u=umf, windDir=0, slope=0, aspect=0)
            
 
</code></pre>

<hr>
<h2 id='fire_severity'>Fire severity functions</h2><span id='topic+fire_severity'></span><span id='topic+fire_plumeTemperature'></span><span id='topic+fire_barkThermalDiffusivity'></span><span id='topic+fire_radialBoleNecrosis'></span><span id='topic+fire_leafThermalFactor'></span><span id='topic+fire_necrosisCriticalTemperature'></span><span id='topic+fire_necrosisHeight'></span>

<h3>Description</h3>

<p>Functions to estimate fire effects on foliage, buds and cambium, based on the model
by Michaletz &amp; Johnson (2008)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fire_plumeTemperature(Ib_surf, z, T_air = 25, rho_air = 1.169)

fire_barkThermalDiffusivity(fmc_bark, rho_bark = 500, T_air = 25)

fire_radialBoleNecrosis(
  Ib_surf,
  t_res,
  bark_diffusivity,
  T_air = 25,
  rho_air = 1.169,
  T_necrosis = 60
)

fire_leafThermalFactor(SLA, h = 130, c = 2500)

fire_necrosisCriticalTemperature(
  t_res,
  thermal_factor,
  T_air = 25,
  T_necrosis = 60
)

fire_necrosisHeight(
  Ib_surf,
  t_res,
  thermal_factor,
  T_air = 25,
  rho_air = 1.169,
  T_necrosis = 60
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fire_severity_+3A_ib_surf">Ib_surf</code></td>
<td>
<p>Surface fireline intensity (kW/m).</p>
</td></tr>
<tr><td><code id="fire_severity_+3A_z">z</code></td>
<td>
<p>height (m).</p>
</td></tr>
<tr><td><code id="fire_severity_+3A_t_air">T_air</code></td>
<td>
<p>Air temperature (degrees Celsius).</p>
</td></tr>
<tr><td><code id="fire_severity_+3A_rho_air">rho_air</code></td>
<td>
<p>Air density (kg/m3).</p>
</td></tr>
<tr><td><code id="fire_severity_+3A_fmc_bark">fmc_bark</code></td>
<td>
<p>Bark moisture content (% dry weight).</p>
</td></tr>
<tr><td><code id="fire_severity_+3A_rho_bark">rho_bark</code></td>
<td>
<p>Bark density (kg/m3).</p>
</td></tr>
<tr><td><code id="fire_severity_+3A_t_res">t_res</code></td>
<td>
<p>fire residence time (seconds).</p>
</td></tr>
<tr><td><code id="fire_severity_+3A_bark_diffusivity">bark_diffusivity</code></td>
<td>
<p>Bark thermal diffusivity (m2/s).</p>
</td></tr>
<tr><td><code id="fire_severity_+3A_t_necrosis">T_necrosis</code></td>
<td>
<p>Temperature of tissue necrosis (degrees Celsius).</p>
</td></tr>
<tr><td><code id="fire_severity_+3A_sla">SLA</code></td>
<td>
<p>Specific leaf area (m2/kg).</p>
</td></tr>
<tr><td><code id="fire_severity_+3A_h">h</code></td>
<td>
<p>Heat transfer coefficient</p>
</td></tr>
<tr><td><code id="fire_severity_+3A_c">c</code></td>
<td>
<p>Specific heat capacity</p>
</td></tr>
<tr><td><code id="fire_severity_+3A_thermal_factor">thermal_factor</code></td>
<td>
<p>Tissue thermal factor.</p>
</td></tr>
</table>


<h3>Value</h3>


<ul>
<li><p>Function <code>fire_plumeTemperature</code> returns the plume temperature at a given height.
</p>
</li>
<li><p>Function <code>fire_barkThermalDiffusivity</code> returns the bark thermal diffusivity given a bark moisture value.
</p>
</li>
<li><p>Function <code>fire_radialBoleNecrosis</code> returns the depth of radial bole necrosis in cm.
</p>
</li>
<li><p>Function <code>fire_leafThermalFactor</code> returns the thermal factor of leaves as a function of specific leaf area.
</p>
</li>
<li><p>Function <code>fire_necrosisCriticalTemperature</code> returns the (plume) temperature yielding necrosis for a given residence time and tissue thermal factor.
</p>
</li>
<li><p>Function <code>fire_necrosisHeight</code> returns the height (in m) of necrosis for tissues with given thermal factor.
</p>
</li></ul>



<h3>References</h3>

<p>Michaletz, S.T., and Johnson, E.A. 2006. A heat transfer model of crown scorch in forest fires. Can. J. For. Res. 36: 2839–2851. doi:10.1139/X06-158.
</p>
<p>Michaletz ST, Johnson EA. 2008. A biophysical process model of tree mortality in surface fires. Canadian Journal of Forest Research 38: 2013–2029.
</p>

<hr>
<h2 id='fireHazard'>Fire hazard</h2><span id='topic+fireHazard'></span>

<h3>Description</h3>

<p>Estimates potential fire behaviour at each daily step of a simulation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fireHazard(
  x,
  SpParams,
  forest = NULL,
  standardConditions = FALSE,
  freq = "days",
  fun = "max"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fireHazard_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+spwb_day">spwb_day</a></code>, <code><a href="#topic+pwb">pwb</a></code>, <code><a href="#topic+growth">growth</a></code>, <code><a href="#topic+growth_day">growth_day</a></code> or <code><a href="#topic+fordyn">fordyn</a></code>.</p>
</td></tr>
<tr><td><code id="fireHazard_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (see <code><a href="#topic+SpParamsDefinition">SpParamsDefinition</a></code> and <code><a href="#topic+SpParamsMED">SpParamsMED</a></code>).</p>
</td></tr>
<tr><td><code id="fireHazard_+3A_forest">forest</code></td>
<td>
<p>An object of class <code><a href="#topic+forest">forest</a></code> (needed if <code>x</code> is not of class <code><a href="#topic+fordyn">fordyn</a></code>).</p>
</td></tr>
<tr><td><code id="fireHazard_+3A_standardconditions">standardConditions</code></td>
<td>
<p>A logical flag to indicate that standard fire weather conditions are to be used (instead of deriving fuel moisture and windspeed from <code>x</code>).</p>
</td></tr>
<tr><td><code id="fireHazard_+3A_freq">freq</code></td>
<td>
<p>Frequency of summary statistics (see <code><a href="base.html#topic+cut.Date">cut.Date</a></code>).</p>
</td></tr>
<tr><td><code id="fireHazard_+3A_fun">fun</code></td>
<td>
<p>Summary function (by default, maximum values).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Live fuel moisture of shrub and canopy layers is estimated from plant water status. 
Dead fuel moisture is estimated following Resco-de-Dios et al. (2015).
</p>


<h3>Value</h3>

<p>A matrix with fire behaviour variables (columns) for each simulated day (rows) or coarser time steps if summaries are requested.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>Resco de Dios, V., A. W. Fellows, R. H. Nolan, M. M. Boer, R. A. Bradstock, F. Domingo, and M. L. Goulden. 2015. A semi-mechanistic model for predicting the moisture content of fine litter. Agricultural and Forest Meteorology 203:64–73.
</p>
<p>Ruffault J, Limousin JM, Pimont F, Dupuy JL, De Cáceres M, Cochard H, Mouillot F, Blackman C, Torres-Ruiz JM, Parsons R, 
Moreno M, Delzon S, Jansen S, Olioso A, Choat B, Martin-StPaul N. 2023. Plant hydraulic modelling of leaf and canopy fuel moisture content reveals increasing vulnerability of a Mediterranean forest to wildfires under extreme drought. 
New Phytologist. (10.1111/nph.18614).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+fuel_FCCS">fuel_FCCS</a></code>, <code><a href="#topic+fire_FCCS">fire_FCCS</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#Load example daily meteorological data
data(examplemeteo)

#Load example plot plant data
data(exampleforestMED)

#Default species parameterization
data(SpParamsMED)

#Initialize soil with default soil params (4 layers)
examplesoil &lt;- soil(defaultSoilParams(4))

#Initialize control parameters
control &lt;- defaultControl("Granier")

#Initialize input
x1 &lt;- forest2spwbInput(exampleforestMED,examplesoil, SpParamsMED, control)

#Call simulation function
S1 &lt;- spwb(x1, examplemeteo, latitude = 41.82592, elevation = 100)

#Evaluate fire hazard
F1 &lt;- fireHazard(S1, SpParamsMED, exampleforestMED)

</code></pre>

<hr>
<h2 id='fordyn'>Forest dynamics</h2><span id='topic+fordyn'></span>

<h3>Description</h3>

<p>Function <code>fordyn</code> implements a forest dynamics model that simulates 
growth, mortality, recruitment and (optionally) management actions in a given forest stand 
during a period specified in the input climatic data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fordyn(
  forest,
  soil,
  SpParams,
  meteo,
  control,
  latitude,
  elevation = NA,
  slope = NA,
  aspect = NA,
  CO2ByYear = numeric(0),
  management_function = NULL,
  management_args = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fordyn_+3A_forest">forest</code></td>
<td>
<p>An object of class <code><a href="#topic+forest">forest</a></code>. Alternatively, the output of a previous run, if continuing a previous simulation.</p>
</td></tr>
<tr><td><code id="fordyn_+3A_soil">soil</code></td>
<td>
<p>An object of class <code><a href="#topic+soil">soil</a></code>.</p>
</td></tr>
<tr><td><code id="fordyn_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (see <code><a href="#topic+SpParamsMED">SpParamsMED</a></code> and <code><a href="#topic+SpParamsDefinition">SpParamsDefinition</a></code>).</p>
</td></tr>
<tr><td><code id="fordyn_+3A_meteo">meteo</code></td>
<td>
<p>A data frame with daily weather data series (see <code><a href="#topic+spwb">spwb</a></code>).</p>
</td></tr>
<tr><td><code id="fordyn_+3A_control">control</code></td>
<td>
<p>A list with default control parameters (see <code><a href="#topic+defaultControl">defaultControl</a></code>).</p>
</td></tr>
<tr><td><code id="fordyn_+3A_latitude">latitude</code></td>
<td>
<p>Latitude (in degrees).</p>
</td></tr>
<tr><td><code id="fordyn_+3A_elevation">elevation</code>, <code id="fordyn_+3A_slope">slope</code>, <code id="fordyn_+3A_aspect">aspect</code></td>
<td>
<p>Elevation above sea level (in m), slope (in degrees) and aspect (in degrees from North).</p>
</td></tr>
<tr><td><code id="fordyn_+3A_co2byyear">CO2ByYear</code></td>
<td>
<p>A named numeric vector with years as names and atmospheric CO2 concentration (in ppm) as values. Used to specify annual changes in CO2 concentration along the simulation (as an alternative to specifying daily values in <code>meteo</code>).</p>
</td></tr>
<tr><td><code id="fordyn_+3A_management_function">management_function</code></td>
<td>
<p>A function that implements forest management actions (see details).</p>
</td></tr>
<tr><td><code id="fordyn_+3A_management_args">management_args</code></td>
<td>
<p>A list of additional arguments to be passed to the <code>management_function</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function <code>fordyn</code> simulates forest dynamics for annual time steps, building on other simulation functions. For each simulated year, the function performs the following steps:
</p>

<ol>
<li><p>Calls function <code><a href="#topic+growth">growth</a></code> to simulate daily water/carbon balance, growth and mortality processes and update the forest object.
</p>
</li>
<li><p>If required, calls function <code>management_function</code>, using as parameters the forest object and <code>management_args</code>, which may result in a density reduction for existing plant cohorts and/or a set of new planted cohorts.
</p>
</li>
<li><p>Simulate natural recruitment (for species present in the stand or given in a seed rain input).
</p>
</li>
<li><p>Prepares the input of function <code><a href="#topic+growth">growth</a></code> for the next annual time step.
</p>
</li>
<li><p>Store forest status, management arguments, and summaries.
</p>
</li></ol>

<p>To enable forest management, the user needs to provide a function that implements it, which is passed to <code>fordyn</code> via its argument <code>management_function</code>. Such function should have  the following arguments:
</p>

<ul>
<li><p><code>"x"</code>: the <code><a href="#topic+forest">forest</a></code> object representing the stand to be managed.
</p>
</li>
<li><p><code>"args"</code>: a list of parameters regulating the behavior of the management function. 
</p>
</li>
<li><p><code>"verbose"</code>: a logical flag to enable console output during the execution of the management function.
</p>
</li></ul>

<p>and return a list with the following elements:
</p>

<ul>
<li><p><code>"action"</code>: A string identifying the action performed (e.g. &quot;thinning&quot;).
</p>
</li>
<li><p><code>"N_tree_cut"</code>: A vector with the density of trees removed.
</p>
</li>
<li><p><code>"Cover_shrub_cut"</code>: A vector with the cover of shrubs removed. 
</p>
</li>
<li><p><code>"planted_forest"</code>: An object of class <code><a href="#topic+forest">forest</a></code> with the new plant cohorts resulting from tree/shrub planting.
</p>
</li>
<li><p><code>"management_args"</code>: A list of management arguments to be used in the next call to the management function.
</p>
</li></ul>

<p>An example of management function is provided in <code><a href="#topic+defaultManagementFunction">defaultManagementFunction</a></code>.
</p>


<h3>Value</h3>

<p>A list of class 'fordyn' with the following elements:
</p>

<ul>
<li><p><code>"StandSummary"</code>: A data frame with stand-level summaries (tree basal area, tree density, shrub cover, etc.) at the beginning of the simulation and after each simulated year.
</p>
</li>
<li><p><code>"SpeciesSummary"</code>: A data frame with species-level summaries (tree basal area, tree density, shrub cover, etc.) at the beginning of the simulation and after each simulated year.
</p>
</li>
<li><p><code>"CohortSummary"</code>: A data frame with cohort-level summaries (tree basal area, tree density, shrub cover, etc.) at the beginning of the simulation and after each simulated year.
</p>
</li>
<li><p><code>"TreeTable"</code>: A data frame with tree-cohort data (species, density, diameter, height, etc.) at the beginning of the simulation (if any) and after each simulated year.
</p>
</li>
<li><p><code>"DeadTreeTable"</code>: A data frame with dead tree-cohort data (species, density, diameter, height, etc.) at the beginning of the simulation and after each simulated year.
</p>
</li>
<li><p><code>"CutTreeTable"</code>: A data frame with cut tree data (species, density, diameter, height, etc.) after each simulated year.
</p>
</li>
<li><p><code>"ShrubTable"</code>: A data frame with shrub-cohort data (species, density, cover, height, etc.) at the beginning of the simulation and after each simulated year.
</p>
</li>
<li><p><code>"DeadShrubTable"</code>: A data frame with dead shrub-cohort data (species, density, cover, height, etc.) at the beginning of the simulation (if any) and after each simulated year.
</p>
</li>
<li><p><code>"CutShrubTable"</code>: A data frame with cut shrub data (species, density, cover, height, etc.) after each simulated year.
</p>
</li>
<li><p><code>"ForestStructures"</code>: A list with the <code><a href="#topic+forest">forest</a></code> object of the stand at the beginning of the simulation and after each simulated year.
</p>
</li>
<li><p><code>"GrowthResults"</code>: A list with the results of calling function <code><a href="#topic+growth">growth</a></code> for each simulated year.
</p>
</li>
<li><p><code>"ManagementArgs"</code>: A list of management arguments to be used in another call to <code>fordyn</code>.
</p>
</li>
<li><p><code>"NextInputObject"</code>: An object of class <code>growthInput</code> to be used in a subsequent simulation.
</p>
</li>
<li><p><code>"NextForestObject"</code>: An object of class <code>forest</code> to be used in a subsequent simulation.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>De Cáceres M, Molowny-Horas R, Cabon A, Martínez-Vilalta J, Mencuccini M, García-Valdés R, Nadal-Sala D, Sabaté S, 
Martin-StPaul N, Morin X, D'Adamo F, Batllori E, Améztegui A (2023) MEDFATE 2.9.3: A trait-enabled model to simulate 
Mediterranean forest function and dynamics at regional scales. 
Geoscientific Model Development 16: 3165-3201 (https://doi.org/10.5194/gmd-16-3165-2023).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+growth">growth</a></code>, <code><a href="#topic+regeneration">regeneration</a></code>, <code><a href="#topic+plot.growth">plot.growth</a></code>, <code><a href="#topic+defaultManagementFunction">defaultManagementFunction</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#Load example daily meteorological data
data(examplemeteo)
#Prepare a two-year meteorological data with half precipitation during 
#the second year
meteo2001 &lt;- examplemeteo
meteo2002 &lt;- examplemeteo
meteo2002$Precipitation &lt;- meteo2002$Precipitation/2
row.names(meteo2002) &lt;- seq(as.Date("2002-01-01"), 
                           as.Date("2002-12-31"), by="day")
meteo_01_02 &lt;- rbind(meteo2001, meteo2002)

#Load example plot plant data
data(exampleforestMED)

#Default species parameterization
data(SpParamsMED)

#Initialize control parameters
control &lt;- defaultControl("Granier")

#Initialize soil with default soil params (4 layers)
examplesoil &lt;- soil(defaultSoilParams(4))

#Call simulation function
fd&lt;-fordyn(exampleforestMED, examplesoil, 
           SpParamsMED, meteo_01_02, control,
           latitude = 41.82592, elevation = 100)

#Stand-level summaries
fd$StandSummary

#Tree table by annual steps
fd$TreeTable

#Dead tree table by annual steps
fd$DeadTreeTable


</code></pre>

<hr>
<h2 id='forest'>Forest description</h2><span id='topic+forest'></span><span id='topic+emptyforest'></span><span id='topic+summary.forest'></span><span id='topic+print.summary.forest'></span>

<h3>Description</h3>

<p>Description of a forest stand
</p>


<h3>Usage</h3>

<pre><code class='language-R'>emptyforest(ntree = 0, nshrub = 0, nseed = 0)

## S3 method for class 'forest'
summary(object, SpParams, ...)

## S3 method for class 'summary.forest'
print(x, digits = getOption("digits"), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="forest_+3A_ntree">ntree</code>, <code id="forest_+3A_nshrub">nshrub</code></td>
<td>
<p>Number of tree and shrub cohorts, respectively.</p>
</td></tr>
<tr><td><code id="forest_+3A_nseed">nseed</code></td>
<td>
<p>Number of species in the seed bank.</p>
</td></tr>
<tr><td><code id="forest_+3A_object">object</code></td>
<td>
<p>An object of class <code>forest</code> has the following structure (see details):
</p>

<ul>
<li><p><code>treeData</code>: A data frame of tree cohorts (in rows) and the following columns:
</p>

<ul>
<li><p><code>Species</code>: String with species (taxon) name or a non-negative integer for tree species identity (i.e., 0,1,2,...) matching SpParams.
</p>
</li>
<li><p><code>Height</code>: Total tree height (in cm).
</p>
</li>
<li><p><code>DBH</code>: Tree diameter at breast height (in cm).
</p>
</li>
<li><p><code>N</code>: Density (number of individuals/hectare) that the measured tree represents.
</p>
</li>
<li><p><code>Z50</code>: Depth (in mm) corresponding to 50% of fine roots.
</p>
</li>
<li><p><code>Z95</code>: Depth (in mm) corresponding to 95% of fine roots.
</p>
</li></ul>


</li>
<li><p><code>shrubData</code>: A data frame of shrub cohorts (in rows) and the following columns:
</p>

<ul>
<li><p><code>Species</code>: String with species (taxon) name or a non-negative integer for shrub species identity (i.e., 0,1,2,...) matching SpParams.
</p>
</li>
<li><p><code>Height</code>: Average total height of plants (in cm).
</p>
</li>
<li><p><code>Cover</code>: Percent cover.
</p>
</li>
<li><p><code>Z50</code>: Depth (in mm) corresponding to 50% of fine roots.
</p>
</li>
<li><p><code>Z95</code>: Depth (in mm) corresponding to 95% of fine roots.
</p>
</li></ul>


</li>
<li><p><code>herbCover</code>: Percent cover of the herb layer (optional).
</p>
</li>
<li><p><code>herbHeight</code>: Mean height (in cm) of the herb layer (optional).
</p>
</li></ul>
</td></tr>
<tr><td><code id="forest_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (see <code><a href="#topic+SpParamsMED">SpParamsMED</a></code>).</p>
</td></tr>
<tr><td><code id="forest_+3A_...">...</code></td>
<td>
<p>Additional parameters for functions <code><a href="base.html#topic+summary">summary</a></code> and <code><a href="base.html#topic+print">print</a></code>.</p>
</td></tr>
<tr><td><code id="forest_+3A_x">x</code></td>
<td>
<p>The object returned by <code>summary.forest</code>.</p>
</td></tr>
<tr><td><code id="forest_+3A_digits">digits</code></td>
<td>
<p>Minimal number of significant digits.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function <code>summary.forest</code> can be used to summarize a <code>forest</code> object in the console. 
Function <code>emptyforest</code> creates an empty <code>forest</code> object.
</p>
<p>The structure presented above for <code>forest</code> objects corresponds to the required data elements. 
A <code>forest</code> object can contain additional information when this is available. Data frames <code>treeData</code> 
and <code>shrubData</code> can contain additional columns:
</p>

<ul>
<li><p><code>LAI</code>: Leaf area index (m2/m2)
</p>
</li>
<li><p><code>FoliarBiomass</code>: Standing dry biomass of leaves (kg/m2)
</p>
</li>
<li><p><code>FuelLoading</code>: Fine fuel loading (kg/m2)
</p>
</li>
<li><p><code>CrownRatio</code>: The ratio between crown length and total height (between 0 and 1)
</p>
</li></ul>

<p>Similarly, one can define <code>forest</code> list elements <code>herbLAI</code>, <code>herbFoliarBiomass</code> or <code>herbFuelLoading</code>.
All these values are used to override allometry-based estimates of those variables when initializing
inputs for functions <code><a href="#topic+spwb">spwb</a></code> or <code><a href="#topic+spwb_day">spwb_day</a></code>. Note that leaf area index, foliar biomass and
fuel loading are related entities, and they are treated as such in medfate. Therefore, users are expected to supply 
one or the other, and not all of them at the same time.
</p>


<h3>Value</h3>

<p>Function <code>summary.forest</code> returns a list with several structural attributes, such as the basal area and LAI of the forest. 
Function <code>emptyforest</code> returns an empty <code>forest</code> object.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+exampleforestMED">exampleforestMED</a></code>, <code><a href="#topic+forest_mergeTrees">forest_mergeTrees</a></code>,  <code><a href="#topic+plot.forest">plot.forest</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(exampleforestMED)
data(SpParamsMED)

# Example forest
exampleforestMED

# Summary of example forest
summary(exampleforestMED, SpParamsMED)

</code></pre>

<hr>
<h2 id='forest_mergeTrees'>Forest merge functions</h2><span id='topic+forest_mergeTrees'></span><span id='topic+forest_mergeShrubs'></span>

<h3>Description</h3>

<p>Functions to merge cohorts of a <code><a href="#topic+forest">forest</a></code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>forest_mergeTrees(x, byDBHclass = TRUE)

forest_mergeShrubs(x, byHeightclass = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="forest_mergeTrees_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+forest">forest</a></code>.</p>
</td></tr>
<tr><td><code id="forest_mergeTrees_+3A_bydbhclass">byDBHclass</code></td>
<td>
<p>Logical flag to indicate that 5-cm tree DBH classes should be kept separated.</p>
</td></tr>
<tr><td><code id="forest_mergeTrees_+3A_byheightclass">byHeightclass</code></td>
<td>
<p>Boolean flag to indicate that 10-cm shrub height classes should be kept separated.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Tree DBH classes are defined in 5-cm intervals, whereas shrub height classes are defined in 10-cm intervals.
Tree DBH and shrub height classes are defined up to a specific size (i.e. larger plants are not merged) 
corresponding to 52.5 cm and 90 cm, respectively.
</p>


<h3>Value</h3>

<p>Another <code><a href="#topic+forest">forest</a></code> object with merged trees or shrubs, depending on the function.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+forest">forest</a></code>,  <code><a href="#topic+fordyn">fordyn</a></code>, <code><a href="#topic+summary.forest">summary.forest</a></code>
</p>

<hr>
<h2 id='forest2aboveground'>Input for simulation models</h2><span id='topic+forest2aboveground'></span><span id='topic+forest2belowground'></span><span id='topic+modelInput'></span><span id='topic+forest2spwbInput'></span><span id='topic+spwbInput'></span><span id='topic+growthInput'></span><span id='topic+forest2growthInput'></span>

<h3>Description</h3>

<p>Functions <code>forest2spwbInput</code> and <code>forest2growthInput</code> take an object of class <code><a href="#topic+forest">forest</a></code> 
and create input objects for simulation functions <code><a href="#topic+spwb">spwb</a></code> (or <code><a href="#topic+pwb">pwb</a></code>) and <code><a href="#topic+growth">growth</a></code>, respectively. 
Function <code>forest2aboveground</code> calculates aboveground variables such as leaf area index. 
Function <code>forest2belowground</code> calculates belowground variables such as fine root distribution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>forest2aboveground(x, SpParams, gdd = NA_real_, loading = FALSE)

forest2belowground(x, soil, SpParams)

forest2spwbInput(x, soil, SpParams, control)

forest2growthInput(x, soil, SpParams, control)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="forest2aboveground_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+forest">forest</a></code>.</p>
</td></tr>
<tr><td><code id="forest2aboveground_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (see <code><a href="#topic+SpParamsDefinition">SpParamsDefinition</a></code> and <code><a href="#topic+SpParamsMED">SpParamsMED</a></code>).</p>
</td></tr>
<tr><td><code id="forest2aboveground_+3A_gdd">gdd</code></td>
<td>
<p>Growth degree days to account for leaf phenology effects (in Celsius). This should be left <code>NA</code> in most applications.</p>
</td></tr>
<tr><td><code id="forest2aboveground_+3A_loading">loading</code></td>
<td>
<p>A logical flag to indicate that fuel loading should be included (for fire hazard calculations).</p>
</td></tr>
<tr><td><code id="forest2aboveground_+3A_soil">soil</code></td>
<td>
<p>An object of class <code><a href="#topic+soil">soil</a></code>.</p>
</td></tr>
<tr><td><code id="forest2aboveground_+3A_control">control</code></td>
<td>
<p>A list with default control parameters (see <code><a href="#topic+defaultControl">defaultControl</a></code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function <code>forest2aboveground</code> extract height and species identity from plant cohorts of <code>x</code>, 
and calculate leaf area index and crown ratio. Functions <code>forest2spwbInput</code> and <code>forest2growthInput</code> also calculate the distribution of fine roots 
across soil, and finds parameter values for each plant cohort according to the parameters of its species as specified in <code>SpParams</code>. 
If <code>control$transpirationMode = "Sperry"</code> or <code>control$transpirationMode = "Cochard"</code>,
the <code>forest2spwbInput</code> and <code>forest2growthInput</code> also estimate the maximum conductance of rhizosphere, root xylem and stem xylem elements.
</p>


<h3>Value</h3>

<p>Function <code>forest2aboveground()</code> returns a data frame with the following columns (rows are identified as specified by function <code><a href="#topic+plant_ID">plant_ID</a></code>):
</p>

<ul>
<li><p><code>SP</code>: Species identity (an integer) (first species is 0).
</p>
</li>
<li><p><code>N</code>: Cohort density (ind/ha) (see function <code><a href="#topic+plant_density">plant_density</a></code>).
</p>
</li>
<li><p><code>DBH</code>: Tree diameter at breast height (cm).
</p>
</li>
<li><p><code>H</code>: Plant total height (cm).
</p>
</li>
<li><p><code>CR</code>: Crown ratio (crown length to total height) (between 0 and 1).
</p>
</li>
<li><p><code>LAI_live</code>: Live leaf area index (m2/m2) (one-side leaf area relative to plot area), includes leaves in winter dormant buds.
</p>
</li>
<li><p><code>LAI_expanded</code>: Leaf area index of expanded leaves (m2/m2) (one-side leaf area relative to plot area).
</p>
</li>
<li><p><code>LAI_dead</code>: Dead leaf area index (m2/m2) (one-side leaf area relative to plot area).
</p>
</li>
<li><p><code>Loading</code>: Fine fuel loading (kg/m2), only if <code>loading = TRUE</code>.
</p>
</li></ul>

<p>Function <code>forest2spwbInput()</code> returns a list of class <code>spwbInput</code> with the following elements (rows of data frames are identified as specified by function <code><a href="#topic+plant_ID">plant_ID</a></code>):
</p>

<ul>
<li><p><code>control</code>: List with control parameters (see <code><a href="#topic+defaultControl">defaultControl</a></code>).
</p>
</li>
<li><p><code>canopy</code>: A list of stand-level state variables.
</p>
</li>
<li><p><code>cohorts</code>: A data frame with cohort information, with columns <code>SP</code> and <code>Name</code>.
</p>
</li>
<li><p><code>above</code>: A data frame with columns  <code>H</code>, <code>CR</code> and <code>LAI</code> (see function <code>forest2aboveground</code>).
</p>
</li>
<li><p><code>below</code>: A data frame with columns <code>Z50</code>, <code>Z95</code>.  If <code>control$transpirationMode = "Sperry"</code> additional columns are <code>fineRootBiomass</code> and <code>coarseRootSoilVolume</code>.
</p>
</li>
<li><p><code>belowLayers</code>: A list. If <code>control$transpirationMode = "Granier"</code> it contains elements: 
</p>

<ul>
<li><p><code>V</code>: A matrix with the proportion of fine roots of each cohort (in rows) in each soil layer (in columns).
</p>
</li>
<li><p><code>L</code>: A matrix with the length of coarse roots of each cohort (in rows) in each soil layer (in columns).
</p>
</li>
<li><p><code>Wpool</code>: A matrix with the soil moisture relative to field capacity around the rhizosphere of each cohort (in rows) in each soil layer (in columns).
</p>
</li></ul>

<p>If <code>control$transpirationMode = "Sperry"</code> or <code>control$transpirationMode = "Cochard"</code> there are the following additional elements:
</p>

<ul>
<li><p><code>VGrhizo_kmax</code>: A matrix with maximum rhizosphere conductance values of each cohort (in rows) in each soil layer (in columns).
</p>
</li>
<li><p><code>VGroot_kmax</code>: A matrix with maximum root xylem conductance values of each cohort (in rows) in each soil layer (in columns).
</p>
</li>
<li><p><code>RhizoPsi</code>: A matrix with the water potential around the rhizosphere of each cohort (in rows) in each soil layer (in columns).
</p>
</li></ul>


</li>
<li><p><code>paramsPhenology</code>: A data frame with leaf phenology parameters:
</p>

<ul>
<li><p><code>PhenologyType</code>: Leaf phenology type.
</p>
</li>
<li><p><code>LeafDuration</code>: Leaf duration (in years).
</p>
</li>
<li><p><code>Sgdd</code>: Degree days needed for leaf budburst (for winter decideous species).
</p>
</li>
<li><p><code>Tbgdd</code>: Base temperature for the calculation of degree days to leaf budburst.
</p>
</li>
<li><p><code>Ssen</code>: Degree days corresponding to leaf senescence.
</p>
</li>
<li><p><code>Phsen</code>: Photoperiod corresponding to start counting senescence degree-days.
</p>
</li>
<li><p><code>Tbsen</code>: Base temperature for the calculation of degree days to leaf senescence.
</p>
</li></ul>


</li>
<li><p><code>paramsAnatomy</code>: A data frame with plant anatomy parameters for each cohort:
</p>

<ul>
<li><p><code>Hmax</code>: Maximum plant height (cm).
</p>
</li>
<li><p><code>Hmed</code>: Median plant height (cm).
</p>
</li>
<li><p><code>Al2As</code>: Leaf area to sapwood area ratio (in m2·m-2).
</p>
</li>
<li><p><code>Ar2Al</code>: Fine root area to leaf area ratio (in m2·m-2).
</p>
</li>
<li><p><code>SLA</code>: Specific leaf area (mm2/mg = m2/kg).
</p>
</li>
<li><p><code>LeafWidth</code>: Leaf width (in cm).
</p>
</li>
<li><p><code>LeafDensity</code>: Density of leaf tissue (dry weight over volume).
</p>
</li>
<li><p><code>WoodDensity</code>: Density of wood tissue (dry weight over volume).
</p>
</li>
<li><p><code>FineRootDensity</code>: Density of fine root tissue (dry weight over volume).
</p>
</li>
<li><p><code>SRL</code>: Specific Root length (cm·g-1).
</p>
</li>
<li><p><code>RLD</code>: Root length density (cm·cm-3).
</p>
</li>
<li><p><code>r635</code>: Ratio between the weight of leaves plus branches and the weight of leaves alone for branches of 6.35 mm.
</p>
</li></ul>


</li>
<li><p><code>paramsInterception</code>: A data frame with rain interception and light extinction parameters for each cohort:
</p>

<ul>
<li><p><code>kPAR</code>: PAR extinction coefficient.
</p>
</li>
<li><p><code>g</code>: Canopy water retention capacity per LAI unit (mm/LAI).
</p>
</li></ul>

<p>If <code>control$transpirationMode = "Sperry"</code> or <code>control$transpirationMode = "Cochard"</code> additional columns are:
</p>

<ul>
<li><p><code>gammaSWR</code>: Reflectance (albedo) coefficient for SWR .
</p>
</li>
<li><p><code>alphaSWR</code>: Absorbance coefficient for SWR .
</p>
</li></ul>


</li>
<li><p><code>paramsTranspiration</code>: A data frame with parameters for transpiration and photosynthesis. If <code>control$transpirationMode = "Granier"</code>, columns are:
</p>

<ul>
<li><p><code>Gswmin</code>: Minimum stomatal conductance to water vapor (in mol H2O·m-2·s-1).
</p>
</li>
<li><p><code>Tmax_LAI</code>: Coefficient relating LAI with the ratio of maximum transpiration over potential evapotranspiration.
</p>
</li>
<li><p><code>Tmax_LAIsq</code>: Coefficient relating squared LAI with the ratio of maximum transpiration over potential evapotranspiration.
</p>
</li>
<li><p><code>Psi_Extract</code>: Water potential corresponding to 50% relative transpiration (in MPa).
</p>
</li>
<li><p><code>Exp_Extract</code>: Parameter of the Weibull function regulating transpiration reduction.
</p>
</li>
<li><p><code>VCstem_c</code>, <code>VCstem_d</code>: Parameters of the stem xylem vulnerability curve.
</p>
</li>
<li><p><code>WUE</code>: Daily water use efficiency (gross photosynthesis over transpiration) under no light, water or CO2 limitations and VPD = 1kPa (g C/mm water).
</p>
</li>
<li><p><code>WUE_par</code>: Coefficient regulating the influence of % PAR on gross photosynthesis.
</p>
</li>
<li><p><code>WUE_par</code>: Coefficient regulating the influence of atmospheric CO2 concentration on gross photosynthesis.
</p>
</li>
<li><p><code>WUE_par</code>: Coefficient regulating the influence of vapor pressure deficit (VPD) on gross photosynthesis.
</p>
</li></ul>

<p>If <code>control$transpirationMode = "Sperry"</code> columns are:
</p>

<ul>
<li><p><code>Gswmin</code>: Minimum stomatal conductance to water vapor (in mol H2O·m-2·s-1).
</p>
</li>
<li><p><code>Gswmax</code>: Maximum stomatal conductance to water vapor (in mol H2O·m-2·s-1).
</p>
</li>
<li><p><code>Vmax298</code>: Maximum Rubisco carboxilation rate at 25ºC (in micromol CO2·s-1·m-2).
</p>
</li>
<li><p><code>Jmax298</code>: Maximum rate of electron transport at 25ºC (in micromol photons·s-1·m-2).
</p>
</li>
<li><p><code>Kmax_stemxylem</code>: Sapwood-specific hydraulic conductivity of stem xylem (in kg H2O·s-1·m-2).
</p>
</li>
<li><p><code>Kmax_rootxylem</code>: Sapwood-specific hydraulic conductivity of root xylem (in kg H2O·s-1·m-2).
</p>
</li>
<li><p><code>VCleaf_kmax</code>: Maximum leaf hydraulic conductance.
</p>
</li>
<li><p><code>VCleaf_c</code>, <code>VCleaf_d</code>: Parameters of the leaf vulnerability curve.
</p>
</li>
<li><p><code>VCstem_kmax</code>: Maximum stem xylem conductance.
</p>
</li>
<li><p><code>VCstem_c</code>, <code>VCstem_d</code>: Parameters of the stem xylem vulnerability curve.
</p>
</li>
<li><p><code>VCroot_c</code>, <code>VCroot_d</code>: Parameters of the root xylem vulnerability curve.
</p>
</li>
<li><p><code>Plant_kmax</code>: Maximum whole-plant conductance.
</p>
</li></ul>

<p>If <code>control$transpirationMode = "Cochard"</code> columns are:
</p>

<ul>
<li><p><code>Gswmin</code>: Minimum stomatal conductance to water vapor (in mol H2O·m-2·s-1).
</p>
</li>
<li><p><code>Gswmax</code>: Maximum stomatal conductance to water vapor (in mol H2O·m-2·s-1).
</p>
</li>
<li><p><code>Vmax298</code>: Maximum Rubisco carboxilation rate at 25ºC (in micromol CO2·s-1·m-2).
</p>
</li>
<li><p><code>Jmax298</code>: Maximum rate of electron transport at 25ºC (in micromol photons·s-1·m-2).
</p>
</li>
<li><p><code>Kmax_stemxylem</code>: Sapwood-specific hydraulic conductivity of stem xylem (in kg H2O·s-1·m-2).
</p>
</li>
<li><p><code>Kmax_rootxylem</code>: Sapwood-specific hydraulic conductivity of root xylem (in kg H2O·s-1·m-2).
</p>
</li>
<li><p><code>VCleaf_kmax</code>: Maximum leaf hydraulic conductance.
</p>
</li>
<li><p><code>VCleaf_c</code>, <code>VCleaf_d</code>: Parameters of the leaf vulnerability curve.
</p>
</li>
<li><p><code>VCstem_kmax</code>: Maximum stem xylem conductance.
</p>
</li>
<li><p><code>VCstem_c</code>, <code>VCstem_d</code>: Parameters of the stem xylem vulnerability curve.
</p>
</li>
<li><p><code>VCroot_c</code>, <code>VCroot_d</code>: Parameters of the root xylem vulnerability curve.
</p>
</li>
<li><p><code>Plant_kmax</code>: Maximum whole-plant conductance.
</p>
</li></ul>


</li>
<li><p><code>paramsWaterStorage</code>: A data frame with plant water storage parameters for each cohort:
</p>

<ul>
<li><p><code>LeafPI0</code>: Osmotic potential at full turgor of leaves (MPa).
</p>
</li>
<li><p><code>LeafEPS</code>: Modulus of elasticity (capacity of the cell wall to resist changes in volume in response to changes in turgor) of leaves (MPa).
</p>
</li>
<li><p><code>LeafAF</code>: Apoplastic fraction (proportion of water outside the living cells) in leaves.
</p>
</li>
<li><p><code>Vleaf</code>: Storage water capacity in leaves, per leaf area (L/m2).
</p>
</li>
<li><p><code>StemPI0</code>: Osmotic potential at full turgor of symplastic xylem tissue (MPa).
</p>
</li>
<li><p><code>StemEPS</code>: Modulus of elasticity (capacity of the cell wall to resist changes in volume in response to changes in turgor) of symplastic xylem tissue (Mpa).
</p>
</li>
<li><p><code>StemAF</code>: Apoplastic fraction (proportion of water outside the living cells) in stem xylem.
</p>
</li>
<li><p><code>Vstem</code>: Storage water capacity in sapwood, per leaf area (L/m2).
</p>
</li></ul>


</li>
<li><p><code>internalPhenology</code> and <code>internalWater</code>: data frames to store internal state variables.
</p>
</li>
<li><p><code>internalFCCS</code>: A data frame with fuel characteristics, according to <code><a href="#topic+fuel_FCCS">fuel_FCCS</a></code> (only if <code>fireHazardResults = TRUE</code>, in the control list).
</p>
</li></ul>

<p>Function <code>forest2growthInput</code> returns a list of class <code>growthInput</code> with the same elements as <code>spwbInput</code>, but with additional information. 
</p>

<ul>
<li><p>Element <code>above</code> includes the following additional columns:
</p>

<ul>
<li><p><code>LA_live</code>: Live leaf area per individual (m2/ind).
</p>
</li>
<li><p><code>LA_dead</code>: Dead leaf area per individual (m2/ind).
</p>
</li>
<li><p><code>SA</code>: Live sapwood area per individual (cm2/ind). 
</p>
</li></ul>


</li>
<li><p><code>paramsGrowth</code>: A data frame with growth parameters for each cohort:
</p>

<ul>
<li><p><code>RERleaf</code>: Maintenance respiration rates (at 20ºC) for leaves (in g gluc·g dry-1·day-1).
</p>
</li>
<li><p><code>RERsapwood</code>: Maintenance respiration rates (at 20ºC) for sapwood (in g gluc·g dry-1·day-1).
</p>
</li>
<li><p><code>RERfineroot</code>: Maintenance respiration rates (at 20ºC) for fine roots (in g gluc·g dry-1·day-1).
</p>
</li>
<li><p><code>CCleaf</code>: Leaf construction costs (in g gluc·g dry-1).
</p>
</li>
<li><p><code>CCsapwood</code>: Sapwood construction costs (in g gluc·g dry-1).
</p>
</li>
<li><p><code>CCfineroot</code>: Fine root construction costs (in g gluc·g dry-1).
</p>
</li>
<li><p><code>RGRleafmax</code>: Maximum leaf relative growth rate (in m2·cm-2·day-1).
</p>
</li>
<li><p><code>RGRsapwoodmax</code>: Maximum sapwood relative growth rate (in cm2·cm-2·day-1).
</p>
</li>
<li><p><code>RGRfinerootmax</code>: Maximum fine root relative growth rate (in g dry·g dry-1·day-1).
</p>
</li>
<li><p><code>SRsapwood</code>: Sapwood daily senescence rate (in day-1).
</p>
</li>
<li><p><code>SRfineroot</code>: Fine root daily senescence rate (in day-1).
</p>
</li>
<li><p><code>RSSG</code>: Minimum relative starch for sapwood growth (proportion).
</p>
</li>
<li><p><code>fHDmin</code>: Minimum value of the height-to-diameter ratio (dimensionless).
</p>
</li>
<li><p><code>fHDmax</code>: Maximum value of the height-to-diameter ratio (dimensionless).
</p>
</li>
<li><p><code>WoodC</code>: Wood carbon content per dry weight (g C /g dry).
</p>
</li></ul>


</li>
<li><p><code>paramsMortalityRegeneration</code>: A data frame with mortality/regeneration parameters for each cohort:
</p>

<ul>
<li><p><code>MortalityBaselineRate</code>: Deterministic proportion or probability specifying the baseline reduction of cohort's density occurring in a year.
</p>
</li>
<li><p><code>SurvivalModelStep</code>: Time step in years of the empirical survival model depending on stand basal area (e.g. 10).
</p>
</li>
<li><p><code>SurvivalB0</code>: Intercept of the logistic baseline survival model depending on stand basal area.
</p>
</li>
<li><p><code>SurvivalB1</code>: Slope of the logistic baseline survival model depending on stand basal area.
</p>
</li>
<li><p><code>RecrTreeDensity</code>: Density of tree recruits from seeds.
</p>
</li>
<li><p><code>IngrowthTreeDensity</code>: Density of trees reaching ingrowth DBH.
</p>
</li>
<li><p><code>RecrTreeDBH</code>: DBH for tree recruits from seeds or resprouting (e.g. 1 cm).
</p>
</li>
<li><p><code>IngrowthTreeDBH</code>: Ingrowth DBH for trees (e.g. 7.5 cm).
</p>
</li></ul>


</li>
<li><p><code>paramsAllometry</code>: A data frame with allometric parameters for each cohort:
</p>

<ul>
<li><p><code>Aash</code>: Regression coefficient relating the square of shrub height with shrub area.
</p>
</li>
<li><p><code>Absh</code>, <code>Bbsh</code>: Allometric coefficients relating phytovolume with dry weight of shrub individuals.
</p>
</li>
<li><p><code>Acr</code>, <code>B1cr</code>, <code>B2cr</code>, <code>B3cr</code>, <code>C1cr</code>, <code>C2cr</code>: Regression coefficients used to calculate crown ratio of trees.
</p>
</li>
<li><p><code>Acw</code>, <code>Bcw</code>: Regression coefficients used to calculated crown width of trees.
</p>
</li></ul>


</li>
<li> <p><code>internalAllocation</code>: A data frame with internal allocation variables for each cohort:
</p>

<ul>
<li><p><code>allocationTarget</code>: Value of the allocation target variable.
</p>
</li>
<li><p><code>leafAreaTarget</code>: Target leaf area (m2) per individual.
</p>
</li>
<li><p><code>sapwoodAreaTarget</code>: Target sapwood area (cm2) per individual.
</p>
</li>
<li><p><code>fineRootBiomassTarget</code>: Target fine root biomass (g dry) per individual.
</p>
</li>
<li><p><code>crownBudPercent</code>: Percentage of the crown with buds.
</p>
</li></ul>


</li>
<li><p><code>internalCarbon</code>: A data frame with the concentration (mol·gluc·l-1) of metabolic and storage carbon compartments for leaves and sapwood.
</p>
</li>
<li><p><code>internalMortality</code>: A data frame to store the cumulative mortality (density for trees and cover for shrubs) predicted during the simulation,
also distinguishing mortality due to starvation or dessication.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+resetInputs">resetInputs</a></code>, <code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+soil">soil</a></code>,  
<code><a href="#topic+forest">forest</a></code>, <code><a href="#topic+SpParamsMED">SpParamsMED</a></code>, <code><a href="#topic+defaultSoilParams">defaultSoilParams</a></code>, <code><a href="#topic+plant_ID">plant_ID</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Load example plot plant data
data(exampleforestMED)

#Default species parameterization
data(SpParamsMED)

# Aboveground parameters
forest2aboveground(exampleforestMED, SpParamsMED)

# Example of aboveground parameters taken from a forest
# described using LAI and crown ratio
data(exampleforestMED2)
forest2aboveground(exampleforestMED2, SpParamsMED)

# Initialize soil with default soil params
examplesoil &lt;- soil(defaultSoilParams())

# Bewowground parameters (distribution of fine roots)
forest2belowground(exampleforestMED, examplesoil, SpParamsMED)

# Initialize control parameters using 'Granier' transpiration mode
control &lt;- defaultControl("Granier")

# Prepare spwb input
forest2spwbInput(exampleforestMED, examplesoil, SpParamsMED, control)
                
# Prepare input for 'Sperry' transpiration mode
control &lt;- defaultControl("Sperry")
forest2spwbInput(exampleforestMED,examplesoil,SpParamsMED, control)

# Prepare input for 'Cochard' transpiration mode
control &lt;- defaultControl("Cochard")
forest2spwbInput(exampleforestMED,examplesoil,SpParamsMED, control)

# Example of initialization from a forest 
# described using LAI and crown ratio
control &lt;- defaultControl("Granier")
forest2spwbInput(exampleforestMED2, examplesoil, SpParamsMED, control)

</code></pre>

<hr>
<h2 id='fuel_properties'>Fuel stratification and fuel characteristics</h2><span id='topic+fuel_properties'></span><span id='topic+fuel_stratification'></span><span id='topic+fuel_FCCS'></span><span id='topic+fuel_windAdjustmentFactor'></span>

<h3>Description</h3>

<p>Function <code>fuel_stratification</code> provides a stratification of the stand into understory and canopy strata. 
Function <code>fuel_FCCS</code> calculates fuel characteristics from a <code>forest</code> object 
following an adaptation of the protocols described for the Fuel Characteristics Classification System (Prichard et al. 2013). 
Function <code>fuel_windAdjustmentFactor</code> determines the adjustment factor of wind for surface fires, according to Andrews (2012).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fuel_stratification(
  object,
  SpParams,
  gdd = NA_real_,
  heightProfileStep = 10,
  maxHeightProfile = 5000,
  bulkDensityThreshold = 0.05
)

fuel_FCCS(
  object,
  SpParams,
  cohortFMC = as.numeric(c()),
  gdd = NA_real_,
  heightProfileStep = 10,
  maxHeightProfile = 5000,
  bulkDensityThreshold = 0.05,
  depthMode = "crownaverage"
)

fuel_windAdjustmentFactor(
  topShrubHeight,
  bottomCanopyHeight,
  topCanopyHeight,
  canopyCover
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fuel_properties_+3A_object">object</code></td>
<td>
<p>An object of class <code><a href="#topic+forest">forest</a></code></p>
</td></tr>
<tr><td><code id="fuel_properties_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (see <code><a href="#topic+SpParamsMED">SpParamsMED</a></code>).</p>
</td></tr>
<tr><td><code id="fuel_properties_+3A_gdd">gdd</code></td>
<td>
<p>Growth degree-days.</p>
</td></tr>
<tr><td><code id="fuel_properties_+3A_heightprofilestep">heightProfileStep</code></td>
<td>
<p>Precision for the fuel bulk density profile.</p>
</td></tr>
<tr><td><code id="fuel_properties_+3A_maxheightprofile">maxHeightProfile</code></td>
<td>
<p>Maximum height for the fuel bulk density profile.</p>
</td></tr>
<tr><td><code id="fuel_properties_+3A_bulkdensitythreshold">bulkDensityThreshold</code></td>
<td>
<p>Minimum fuel bulk density to delimit fuel strata.</p>
</td></tr>
<tr><td><code id="fuel_properties_+3A_cohortfmc">cohortFMC</code></td>
<td>
<p>A numeric vector of (actual) fuel moisture content by cohort.</p>
</td></tr>
<tr><td><code id="fuel_properties_+3A_depthmode">depthMode</code></td>
<td>
<p>Specifies how fuel depth (and therefore canopy and understory bulk density) should be estimated: 
</p>

<ul>
<li><p><code>"crownaverage"</code>: As weighed average of crown lengths using loadings as weights.
</p>
</li>
<li><p><code>"profile"</code>: As the difference of base and top heights in bulk density profiles.  
</p>
</li>
<li><p><code>"absoluteprofile"</code>: As the difference of absolute base and absolute top heights in bulk density profiles.  
</p>
</li></ul>
</td></tr>
<tr><td><code id="fuel_properties_+3A_topshrubheight">topShrubHeight</code></td>
<td>
<p>Shrub stratum top height (in m).</p>
</td></tr>
<tr><td><code id="fuel_properties_+3A_bottomcanopyheight">bottomCanopyHeight</code></td>
<td>
<p>Canopy base height (in m).</p>
</td></tr>
<tr><td><code id="fuel_properties_+3A_topcanopyheight">topCanopyHeight</code></td>
<td>
<p>Canopy top height (in m).</p>
</td></tr>
<tr><td><code id="fuel_properties_+3A_canopycover">canopyCover</code></td>
<td>
<p>Canopy percent cover.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Function <code>fuel_FCCS</code> returns a data frame with five rows corresponding to  fuel layers: 
<code>canopy</code>, <code>shrub</code>, <code>herb</code>, <code>woody</code> and <code>litter</code>. Columns correspond fuel properties:
</p>

<ul>
<li><p><code>w</code>: Fine fuel loading (in kg/m2).
</p>
</li>
<li><p><code>cover</code>: Percent cover.
</p>
</li>
<li><p><code>hbc</code>: Height to base of crowns (in m).
</p>
</li>
<li><p><code>htc</code>: Height to top of crowns (in m).
</p>
</li>
<li><p><code>delta</code>: Fuel depth (in m).
</p>
</li>
<li><p><code>rhob</code>: Fuel bulk density (in kg/m3).
</p>
</li>
<li><p><code>rhop</code>: Fuel particle density (in kg/m3).
</p>
</li>
<li><p><code>PV</code>: Particle volume (in m3/m2).
</p>
</li>
<li><p><code>beta</code>: Packing ratio (unitless).
</p>
</li>
<li><p><code>betarel</code>: Relative packing ratio (unitless).
</p>
</li>
<li><p><code>etabetarel</code>: Reaction efficiency (unitless).
</p>
</li>
<li><p><code>sigma</code>: Surface area-to-volume ratio (m2/m3).
</p>
</li>
<li><p><code>pDead</code>: Proportion of dead fuels.
</p>
</li>
<li><p><code>FAI</code>: Fuel area index (unitless).
</p>
</li>
<li><p><code>h</code>: High heat content (in kJ/kg).
</p>
</li>
<li><p><code>RV</code>: Reactive volume (in m3/m2).
</p>
</li>
<li><p><code>MinFMC</code>: Minimum fuel moisture content (as percent over dry weight).
</p>
</li>
<li><p><code>MaxFMC</code>: Maximum fuel moisture content (as percent over dry weight).
</p>
</li>
<li><p><code>ActFMC</code>: Actual fuel moisture content (as percent over dry weight). These are set to <code>NA</code> if parameter <code>cohortFMC</code> is empty.
</p>
</li></ul>

<p>Function <code>fuel_stratification</code> returns a list with the following items:
</p>

<ul>
<li><p><code>surfaceLayerBaseHeight</code>: Base height of crowns of shrubs in the surface layer (in cm).
</p>
</li>
<li><p><code>surfaceLayerTopHeight</code>: Top height of crowns of shrubs in the surface layer (in cm).
</p>
</li>
<li><p><code>understoryLAI</code>: Cumulated LAI of the understory layer (i.e. leaf area comprised between surface layer base and top heights).
</p>
</li>
<li><p><code>canopyBaseHeight</code>: Base height of tree crowns in the canopy (in cm).
</p>
</li>
<li><p><code>canopyTopHeight</code>: Top height of tree crowns in the canopy (in cm).
</p>
</li>
<li><p><code>canopyLAI</code>: Cumulated LAI of the canopy (i.e. leaf area comprised between canopy base and top heights).
</p>
</li></ul>

<p>Function <code>fuel_cohortFineFMC</code> returns a list with three matrices (for leaves, twigs and fine fuels). 
Each of them contains live moisture content values for each day (in rows) and plant cohort (in columns).
</p>
<p>Function <code>fuel_windAdjustmentFactor</code> returns a value between 0 and 1.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>Andrews, P. L. 2012. Modeling wind adjustment factor and midflame wind speed for Rothermel’s surface fire spread model. USDA Forest Service - General Technical Report RMRS-GTR:1–39.
</p>
<p>Prichard, S. J., D. V Sandberg, R. D. Ottmar, E. Eberhardt, A. Andreu, P. Eagle, and K. Swedin. 2013. Classification System Version 3.0: Technical Documentation.
</p>
<p>Reinhardt, E., D. Lutes, and J. Scott. 2006. FuelCalc: A method for estimating fuel characteristics. Pages 273–282.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fire_FCCS">fire_FCCS</a></code>, <code><a href="#topic+spwb">spwb</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Load example plot plant data
data(exampleforestMED)

#Default species parameterization
data(SpParamsMED)

#Show stratification of fuels
fuel_stratification(exampleforestMED, SpParamsMED)
  
#Calculate fuel properties according to FCCS
fccs = fuel_FCCS(exampleforestMED, SpParamsMED)
fccs

fuel_windAdjustmentFactor(fccs$htc[2], fccs$hbc[1], fccs$htc[1], fccs$cover[1])

</code></pre>

<hr>
<h2 id='growth'>Forest growth</h2><span id='topic+growth'></span>

<h3>Description</h3>

<p>Function <code>growth</code> is a process-based model that performs energy, water and carbon balances; 
and determines changes in water/carbon pools, functional variables (leaf area, sapwood area, root area) 
and structural ones (tree diameter, tree height, shrub cover) for woody plant cohorts in a given forest stand 
during a period specified in the input climatic data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>growth(
  x,
  meteo,
  latitude,
  elevation = NA_real_,
  slope = NA_real_,
  aspect = NA_real_,
  CO2ByYear = numeric(0)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="growth_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+growthInput">growthInput</a></code>.</p>
</td></tr>
<tr><td><code id="growth_+3A_meteo">meteo</code></td>
<td>
<p>A data frame with daily meteorological data series (see <code><a href="#topic+spwb">spwb</a></code>).</p>
</td></tr>
<tr><td><code id="growth_+3A_latitude">latitude</code></td>
<td>
<p>Latitude (in degrees).</p>
</td></tr>
<tr><td><code id="growth_+3A_elevation">elevation</code>, <code id="growth_+3A_slope">slope</code>, <code id="growth_+3A_aspect">aspect</code></td>
<td>
<p>Elevation above sea level (in m), slope (in degrees) and aspect (in degrees from North).</p>
</td></tr>
<tr><td><code id="growth_+3A_co2byyear">CO2ByYear</code></td>
<td>
<p>A named numeric vector with years as names and atmospheric CO2 concentration (in ppm) as values. Used to specify annual changes in CO2 concentration along the simulation (as an alternative to specifying daily values in <code>meteo</code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Detailed model description is available in the medfate book. 
Simulations using the 'Sperry' or 'Cochard' transpiration modes are computationally much more expensive 
than those using the 'Granier' transpiration mode.
</p>


<h3>Value</h3>

<p>A list of class 'growth' with the following elements:
</p>

<ul>
<li><p><code>"latitude"</code>: Latitude (in degrees) given as input. 
</p>
</li>
<li><p><code>"topography"</code>: Vector with elevation, slope and aspect given as input. 
</p>
</li>
<li><p><code>"weather"</code>: A copy of the input weather data frame.
</p>
</li>
<li><p><code>"growthInput"</code>: A copy of the object <code>x</code> of class <code><a href="#topic+growthInput">growthInput</a></code> given as input.
</p>
</li>
<li><p><code>"growthOutput"</code>: An copy of the final state of the object <code>x</code> of class <code><a href="#topic+growthInput">growthInput</a></code>.
</p>
</li>
<li><p><code>"WaterBalance"</code>: A data frame where different water balance variables (see <code><a href="#topic+spwb">spwb</a></code>).
</p>
</li>
<li><p><code>"EnergyBalance"</code>: A data frame with the daily values of energy balance components for the soil and the canopy (only for <code>transpirationMode = "Sperry"</code> or <code>transpirationMode = "Cochard"</code>; see <code><a href="#topic+spwb">spwb</a></code>).
</p>
</li>
<li><p><code>"CarbonBalance"</code>: A data frame where different stand-level carbon balance components (gross primary production, maintenance respiration, synthesis respiration and net primary production), all in g C · m-2.
</p>
</li>
<li><p><code>"BiomassBalance"</code>: A data frame with the daily values of stand biomass balance components (in g dry · m-2.
</p>
</li>
<li><p><code>"Temperature"</code>: A data frame with the daily values of minimum/mean/maximum temperatures for the atmosphere (input), canopy and soil (only for <code>transpirationMode = "Sperry"</code> or <code>transpirationMode = "Cochard"</code>; see <code><a href="#topic+spwb">spwb</a></code>).
</p>
</li>
<li><p><code>"Soil"</code>: A data frame where different soil variables  (see <code><a href="#topic+spwb">spwb</a></code>).
</p>
</li>
<li><p><code>"Stand"</code>: A data frame where different stand-level variables (see <code><a href="#topic+spwb">spwb</a></code>).
</p>
</li>
<li><p><code>"Plants"</code>: A list of daily results for plant cohorts (see <code><a href="#topic+spwb">spwb</a></code>).
</p>
</li>
<li><p><code>"SunlitLeaves"</code> and <code>"ShadeLeaves"</code>: A list with daily results for sunlit and shade leaves (only for <code>transpirationMode = "Sperry"</code> or <code>transpirationMode = "Cochard"</code>; see <code><a href="#topic+spwb">spwb</a></code>).
</p>
</li>
<li><p><code>"LabileCarbonBalance"</code>: A list of daily labile carbon balance results for plant cohorts, with elements:
</p>

<ul>
<li><p><code>"GrossPhotosynthesis"</code>: Daily gross photosynthesis per dry weight of living biomass (g gluc · g dry-1).
</p>
</li>
<li><p><code>"MaintentanceRespiration"</code>: Daily maintenance respiration per dry weight of living biomass (g gluc · g dry-1).
</p>
</li>
<li><p><code>"GrowthCosts"</code>: Daily growth costs per dry weight of living biomass (g gluc · g dry-1).
</p>
</li>
<li><p><code>"RootExudation"</code>: Root exudation per dry weight of living biomass (g gluc · g dry-1).    
</p>
</li>
<li><p><code>"LabileCarbonBalance"</code>: Daily labile carbon balance (photosynthesis - maintenance respiration - growth costs - root exudation) per dry weight of living biomass (g gluc · g dry-1).
</p>
</li>
<li><p><code>"SugarLeaf"</code>: Sugar concentration (mol·l-1) in leaves.
</p>
</li>
<li><p><code>"StarchLeaf"</code>: Starch concentration (mol·l-1) in leaves.
</p>
</li>
<li><p><code>"SugarSapwood"</code>: Sugar concentration (mol·l-1) in sapwood.
</p>
</li>
<li><p><code>"StarchSapwood"</code>: Starch concentration (mol·l-1) in sapwood.
</p>
</li>
<li><p><code>"SugarTransport"</code>:  Average instantaneous rate of carbon transferred between leaves and stem compartments via floem (mol gluc·s-1).
</p>
</li></ul>

</li>
<li><p><code>"PlantBiomassBalance"</code>: A list of daily plant biomass balance results for plant cohorts, with elements:
</p>

<ul>
<li><p><code>"StructuralBiomassBalance"</code>: Daily structural biomass balance (g dry · m-2).
</p>
</li>
<li><p><code>"LabileBiomassBalance"</code>: Daily labile biomass balance (g dry · m-2).
</p>
</li>
<li><p><code>"PlantBiomassBalance"</code>: Daily plant biomass balance, i.e. labile change + structural change (g dry · m-2).
</p>
</li>
<li><p><code>"MortalityBiomassLoss"</code>: Biomass loss due to mortality (g dry · m-2).    
</p>
</li>
<li><p><code>"CohortBiomassBalance"</code>: Daily cohort biomass balance (including mortality) (g dry · m-2).
</p>
</li></ul>

</li>
<li><p><code>"PlantStructure"</code>: A list of daily area and biomass values for compartments of plant cohorts, with elements:
</p>

<ul>
<li><p><code>"LeafBiomass"</code>: Daily amount of leaf structural biomass (in g dry) for an average individual of each plant cohort.
</p>
</li>
<li><p><code>"SapwoodBiomass"</code>: Daily amount of sapwood structural biomass (in g dry) for an average individual of each plant cohort.
</p>
</li>
<li><p><code>"FineRootBiomass"</code>: Daily amount of fine root biomass (in g dry) for an average individual of each plant cohort.
</p>
</li>
<li><p><code>"LeafArea"</code>: Daily amount of leaf area (in m2) for an average individual of each plant cohort.
</p>
</li>
<li><p><code>"SapwoodArea"</code>: Daily amount of sapwood area (in cm2) for an average individual of each plant cohort.
</p>
</li>
<li><p><code>"FineRootArea"</code>: Daily amount of fine root area (in m2) for an average individual of each plant cohort.
</p>
</li>
<li><p><code>"HuberValue"</code>: The ratio of sapwood area to (target) leaf area (in cm2/m2).
</p>
</li>
<li><p><code>"RootAreaLeafArea"</code>: The ratio of fine root area to (target) leaf area (in m2/m2).
</p>
</li>
<li><p><code>"DBH"</code>: Diameter at breast height (in cm) for an average individual of each plant cohort.
</p>
</li>
<li><p><code>"Height"</code>: Height (in cm) for an average individual of each plant cohort.
</p>
</li></ul>

</li>
<li><p><code>"GrowthMortality"</code>: A list of daily growth and mortality rates for plant cohorts, with elements:
</p>

<ul>
<li><p><code>"LAgrowth"</code>: Leaf area growth (in m2·day-1) for an average individual of each plant cohort.
</p>
</li>
<li><p><code>"SAgrowth"</code>: Sapwood area growth rate (in cm2·day-1) for an average individual of each plant cohort.
</p>
</li>
<li><p><code>"FRAgrowth"</code>: Fine root area growth (in m2·day-1) for an average individual of each plant cohort.
</p>
</li>
<li><p><code>"StarvationRate"</code>: Daily mortality rate from starvation (ind/d-1).
</p>
</li>
<li><p><code>"DessicationRate"</code>: Daily mortality rate from dessication (ind/d-1).
</p>
</li>
<li><p><code>"MortalityRate"</code>: Daily mortality rate (any cause) (ind/d-1).
</p>
</li></ul>

</li>
<li><p><code>"subdaily"</code>: A list of objects of class <code><a href="#topic+growth_day">growth_day</a></code>, one per day simulated (only if required in <code>control</code> parameters, see <code><a href="#topic+defaultControl">defaultControl</a></code>).
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>De Cáceres M, Molowny-Horas R, Cabon A, Martínez-Vilalta J, Mencuccini M, García-Valdés R, Nadal-Sala D, Sabaté S, 
Martin-StPaul N, Morin X, D'Adamo F, Batllori E, Améztegui A (2023) MEDFATE 2.9.3: A trait-enabled model to simulate 
Mediterranean forest function and dynamics at regional scales. 
Geoscientific Model Development 16: 3165-3201 (https://doi.org/10.5194/gmd-16-3165-2023).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+growthInput">growthInput</a></code>, <code><a href="#topic+growth_day">growth_day</a></code>, <code><a href="#topic+plot.growth">plot.growth</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Load example daily meteorological data
data(examplemeteo)

#Load example plot plant data
data(exampleforestMED)

#Default species parameterization
data(SpParamsMED)
  
#Initialize control parameters
control &lt;- defaultControl("Granier")
  
#Initialize soil with default soil params (4 layers)
examplesoil &lt;- soil(defaultSoilParams(4))

#Initialize vegetation input
x1 &lt;- forest2growthInput(exampleforestMED, examplesoil, SpParamsMED, control)

#Call simulation function
G1 &lt;- growth(x1, examplemeteo, latitude = 41.82592, elevation = 100)
 

#Switch to 'Sperry' transpiration mode
control &lt;- defaultControl("Sperry")

#Initialize vegetation input
x2 &lt;- forest2growthInput(exampleforestMED,examplesoil, SpParamsMED, control)

#Call simulation function
G2 &lt;-growth(x2, examplemeteo, latitude = 41.82592, elevation = 100)

#Switch to 'Cochard' transpiration mode
control &lt;- defaultControl("Cochard")

#Initialize vegetation input
x3 &lt;- forest2growthInput(exampleforestMED,examplesoil, SpParamsMED, control)

#Call simulation function
G3 &lt;-growth(x3, examplemeteo, latitude = 41.82592, elevation = 100)

      
</code></pre>

<hr>
<h2 id='growth_day'>Single-day simulation</h2><span id='topic+growth_day'></span><span id='topic+spwb_day'></span>

<h3>Description</h3>

<p>Function <code>spwb_day</code> performs water balance for a single day and <code>growth_day</code> 
performs water and carbon balance for a single day.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>growth_day(
  x,
  date,
  meteovec,
  latitude,
  elevation,
  slope,
  aspect,
  runon = 0,
  modifyInput = TRUE
)

spwb_day(
  x,
  date,
  meteovec,
  latitude,
  elevation,
  slope,
  aspect,
  runon = 0,
  modifyInput = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="growth_day_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+spwbInput">spwbInput</a></code> or <code><a href="#topic+growthInput">growthInput</a></code>.</p>
</td></tr>
<tr><td><code id="growth_day_+3A_date">date</code></td>
<td>
<p>Date as string &quot;yyyy-mm-dd&quot;.</p>
</td></tr>
<tr><td><code id="growth_day_+3A_meteovec">meteovec</code></td>
<td>
<p>A named numerical vector with weather data. See variable names in parameter <code>meteo</code> of <code><a href="#topic+spwb">spwb</a></code>.</p>
</td></tr>
<tr><td><code id="growth_day_+3A_latitude">latitude</code></td>
<td>
<p>Latitude (in degrees).</p>
</td></tr>
<tr><td><code id="growth_day_+3A_elevation">elevation</code>, <code id="growth_day_+3A_slope">slope</code>, <code id="growth_day_+3A_aspect">aspect</code></td>
<td>
<p>Elevation above sea level (in m), slope (in degrees) and aspect (in degrees from North).</p>
</td></tr>
<tr><td><code id="growth_day_+3A_runon">runon</code></td>
<td>
<p>Surface water amount running on the target area from upslope (in mm).</p>
</td></tr>
<tr><td><code id="growth_day_+3A_modifyinput">modifyInput</code></td>
<td>
<p>Boolean flag to indicate that the input <code>x</code> object is allowed to be modified during the simulation.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The simulation functions allow using three different sub-models of transpiration and photosynthesis:
</p>

<ul>
<li><p>The sub-model corresponding to 'Granier' transpiration mode is illustrated by function <code><a href="#topic+transp_transpirationGranier">transp_transpirationGranier</a></code> and was described in De Caceres et al. (2015),
and implements an approach originally described in Granier et al. (1999). 
</p>
</li>
<li><p>The sub-model corresponding to 'Sperry' transpiration mode is illustrated by function <code><a href="#topic+transp_transpirationSperry">transp_transpirationSperry</a></code> and was described in De Caceres et al. (2021), and
implements a modelling approach originally described in Sperry et al. (2017).  
</p>
</li>
<li><p>The sub-model corresponding to 'Cochard' transpiration mode is illustrated by function <code><a href="#topic+transp_transpirationCochard">transp_transpirationCochard</a></code> and was described for model SurEau-Ecos v2.0 in Ruffault et al. (2022). 
</p>
</li></ul>

<p>Simulations using the 'Sperry' or 'Cochard' transpiration mode are computationally much more expensive than 'Granier'.
</p>


<h3>Value</h3>

<p>Function <code>spwb_day()</code> returns a list of class <code>spwb_day</code> with the 
following elements:
</p>

<ul>
<li><p><code>"cohorts"</code>: A data frame with cohort information, copied from <code><a href="#topic+spwbInput">spwbInput</a></code>.
</p>
</li>
<li><p><code>"topography"</code>: Vector with elevation, slope and aspect given as input. 
</p>
</li>
<li><p><code>"weather"</code>: A vector with the input weather.
</p>
</li>
<li><p><code>"WaterBalance"</code>: A vector of water balance components (rain, snow, net rain, infiltration, ...) for the simulated day, equivalent to one row of 'WaterBalance' object given in <code><a href="#topic+spwb">spwb</a></code>.
</p>
</li>
<li><p><code>"Soil"</code>: A data frame with results for each soil layer:
</p>

<ul>
<li><p><code>"SoilEvaporation"</code>: Water evaporated from the soil surface (in mm).
</p>
</li>
<li><p><code>"HydraulicInput"</code>: Water entering each soil layer from other layers, transported via plant hydraulic network (in mm) (only for <code>transpirationMode = "Sperry"</code>).
</p>
</li>
<li><p><code>"HydraulicOutput"</code>: Water leaving each soil layer (going to other layers or the transpiration stream) (in mm) (only for <code>transpirationMode = "Sperry"</code>).
</p>
</li>
<li><p><code>"PlantExtraction"</code>: Water extracted by plants from each soil layer (in mm).
</p>
</li>
<li><p><code>"psi"</code>: Soil water potential (in MPa).
</p>
</li></ul>


</li>
<li><p><code>"Stand"</code>: A named vector with with stand values for the simulated day, equivalent to one row of 'Stand' object returned by <code><a href="#topic+spwb">spwb</a></code>.
</p>
</li>
<li><p><code>"Plants"</code>: A data frame of results for each plant cohort (see <code><a href="#topic+transp_transpirationGranier">transp_transpirationGranier</a></code> or <code><a href="#topic+transp_transpirationSperry">transp_transpirationSperry</a></code>).
</p>
</li></ul>

<p>The following items are only returned when <code>transpirationMode = "Sperry"</code> or  <code>transpirationMode = "Cochard"</code>:
</p>

<ul>
<li><p><code>"EnergyBalance"</code>: Energy balance of the stand (see <code><a href="#topic+transp_transpirationSperry">transp_transpirationSperry</a></code>).
</p>
</li>
<li><p><code>"RhizoPsi"</code>: Minimum water potential (in MPa) inside roots, after crossing rhizosphere, per cohort and soil layer.
</p>
</li>
<li><p><code>"SunlitLeaves"</code> and <code>"ShadeLeaves"</code>: For each leaf type, a data frame with values of LAI, Vmax298 and Jmax298 for leaves of this type in each plant cohort.
</p>
</li>
<li><p><code>"ExtractionInst"</code>: Water extracted by each plant cohort during each time step.
</p>
</li>
<li><p><code>"PlantsInst"</code>: A list with instantaneous (per time step) results for each plant cohort (see <code><a href="#topic+transp_transpirationSperry">transp_transpirationSperry</a></code>).
</p>
</li>
<li><p><code>"LightExtinction"</code>: A list of information regarding radiation balance through the canopy, as returned by function <code><a href="#topic+light_instantaneousLightExtinctionAbsortion">light_instantaneousLightExtinctionAbsortion</a></code>.
</p>
</li>
<li><p><code>"CanopyTurbulence"</code>: Canopy turbulence (see <code><a href="#topic+wind_canopyTurbulence">wind_canopyTurbulence</a></code>).
</p>
</li></ul>



<h3>Author(s)</h3>


<ul>
<li><p>Miquel De Cáceres Ainsa, CREAF
</p>
</li>
<li><p>Nicolas Martin-StPaul, URFM-INRAE
</p>
</li></ul>



<h3>References</h3>

<p>De Cáceres M, Martínez-Vilalta J, Coll L, Llorens P, Casals P, Poyatos R, Pausas JG, Brotons L. (2015) Coupling a water balance model with forest inventory data to predict drought stress: the role of forest structural changes vs. climate changes. Agricultural and Forest Meteorology 213: 77-90 (doi:10.1016/j.agrformet.2015.06.012).
</p>
<p>De Cáceres M, Mencuccini M, Martin-StPaul N, Limousin JM, Coll L, Poyatos R, Cabon A, Granda V, Forner A, Valladares F, Martínez-Vilalta J (2021) Unravelling the effect of species mixing on water use and drought stress in holm oak forests: a modelling approach. Agricultural and Forest Meteorology 296 (doi:10.1016/j.agrformet.2020.108233).
</p>
<p>Granier A, Bréda N, Biron P, Villette S (1999) A lumped water balance model to evaluate duration and intensity of drought constraints in forest stands. Ecol Modell 116:269–283. https://doi.org/10.1016/S0304-3800(98)00205-1.
</p>
<p>Ruffault J, Pimont F, Cochard H, Dupuy JL, Martin-StPaul N (2022) 
SurEau-Ecos v2.0: a trait-based plant hydraulics model for simulations of plant water status and drought-induced mortality at the ecosystem level.
Geoscientific Model Development 15, 5593-5626 (doi:10.5194/gmd-15-5593-2022).
</p>
<p>Sperry, J. S., M. D. Venturas, W. R. L. Anderegg, M. Mencuccini, D. S. Mackay, Y. Wang, and D. M. Love. 2017. Predicting stomatal responses to the environment from the optimization of photosynthetic gain and hydraulic cost. Plant Cell and Environment 40, 816-830 (doi: 10.1111/pce.12852).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwbInput">spwbInput</a></code>, <code><a href="#topic+spwb">spwb</a></code>,  <code><a href="#topic+plot.spwb_day">plot.spwb_day</a></code>,  
<code><a href="#topic+growthInput">growthInput</a></code>, <code><a href="#topic+growth">growth</a></code>,  <code><a href="#topic+plot.growth_day">plot.growth_day</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Load example daily meteorological data
data(examplemeteo)

#Load example plot plant data
data(exampleforestMED)

#Default species parameterization
data(SpParamsMED)

#Initialize control parameters
control &lt;- defaultControl("Granier")

# Day to be simulated
d &lt;- 100
meteovec &lt;- unlist(examplemeteo[d,])
date &lt;- rownames(examplemeteo)[d]

#Simulate water balance one day only (Granier mode)
examplesoil &lt;- soil(defaultSoilParams(4))
x1 &lt;- forest2spwbInput(exampleforestMED,examplesoil, SpParamsMED, control)
sd1 &lt;- spwb_day(x1, date, meteovec,  
                latitude = 41.82592, elevation = 100, slope=0, aspect=0) 

#Simulate water balance for one day only (Sperry mode)
control &lt;- defaultControl("Sperry")
x2 &lt;- forest2spwbInput(exampleforestMED, examplesoil, SpParamsMED, control)
sd2 &lt;-spwb_day(x2, date, meteovec,
              latitude = 41.82592, elevation = 100, slope=0, aspect=0)

#Plot plant transpiration (see function 'plot.swb.day()')
plot(sd2)

#Simulate water balance for one day only (Cochard mode)
control &lt;- defaultControl("Cochard")
x3 &lt;- forest2spwbInput(exampleforestMED, examplesoil, SpParamsMED, control)
sd3 &lt;-spwb_day(x3, date, meteovec,
              latitude = 41.82592, elevation = 100, slope=0, aspect=0)


#Simulate water and carbon balance for one day only (Granier mode)
control &lt;- defaultControl("Granier")
x4  &lt;- forest2growthInput(exampleforestMED,examplesoil, SpParamsMED, control)
sd4 &lt;- growth_day(x4, date, meteovec,
                latitude = 41.82592, elevation = 100, slope=0, aspect=0)

</code></pre>

<hr>
<h2 id='herb_values'>Herbaceous description functions</h2><span id='topic+herb_values'></span><span id='topic+herb_foliarBiomass'></span><span id='topic+herb_fuelLoading'></span><span id='topic+herb_LAI'></span>

<h3>Description</h3>

<p>Functions to calculate attributes of the herbaceous component of a <code><a href="#topic+forest">forest</a></code> object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>herb_foliarBiomass(x, SpParams)

herb_fuelLoading(x, SpParams)

herb_LAI(x, SpParams)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="herb_values_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+forest">forest</a></code>.</p>
</td></tr>
<tr><td><code id="herb_values_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (see <code><a href="#topic+SpParamsMED">SpParamsMED</a></code>).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A single scalar:
</p>

<ul>
<li><p><code>herb_foliarBiomass</code>: Herbaceous biomass of leaves (in kg/m2).
</p>
</li>
<li><p><code>herb_fuelLoading</code>: Herbaceous fine fuel loading (in kg/m2).
</p>
</li>
<li><p><code>herb_LAI</code>: Herbaceous leaf area index (m2/m2).
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+forest">forest</a></code>, <code><a href="#topic+plant_basalArea">plant_basalArea</a></code>, <code><a href="#topic+summary.forest">summary.forest</a></code>
</p>

<hr>
<h2 id='hydraulics_conductancefunctions'>Hydraulic confuctance functions</h2><span id='topic+hydraulics_conductancefunctions'></span><span id='topic+hydraulics_psi2K'></span><span id='topic+hydraulics_K2Psi'></span><span id='topic+hydraulics_averagePsi'></span><span id='topic+hydraulics_xylemConductance'></span><span id='topic+hydraulics_xylemPsi'></span><span id='topic+hydraulics_psiCrit'></span><span id='topic+hydraulics_vanGenuchtenConductance'></span><span id='topic+hydraulics_correctConductanceForViscosity'></span><span id='topic+hydraulics_psi2Weibull'></span><span id='topic+hydraulics_vulnerabilityCurvePlot'></span>

<h3>Description</h3>

<p>Set of functions used in the calculation of soil and plant hydraulic conductance.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hydraulics_psi2K(psi, psi_extract, exp_extract = 3)

hydraulics_K2Psi(K, psi_extract, exp_extract = 3)

hydraulics_averagePsi(psi, v, exp_extract, psi_extract)

hydraulics_xylemConductance(psi, kxylemmax, c, d)

hydraulics_xylemPsi(kxylem, kxylemmax, c, d)

hydraulics_psiCrit(c, d, pCrit = 0.001)

hydraulics_vanGenuchtenConductance(psi, krhizomax, n, alpha)

hydraulics_correctConductanceForViscosity(kxylem, temp)

hydraulics_psi2Weibull(psi50, psi88 = NA_real_, psi12 = NA_real_)

hydraulics_vulnerabilityCurvePlot(
  x,
  soil = NULL,
  type = "leaf",
  vulnerabilityFunction = "Weibull",
  psiVec = seq(-0.1, -8, by = -0.01),
  relative = FALSE,
  speciesNames = FALSE,
  draw = TRUE,
  ylim = NULL,
  xlab = NULL,
  ylab = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hydraulics_conductancefunctions_+3A_psi">psi</code></td>
<td>
<p>A scalar (or a vector, depending on the function) with water potential (in MPa).</p>
</td></tr>
<tr><td><code id="hydraulics_conductancefunctions_+3A_psi_extract">psi_extract</code></td>
<td>
<p>Soil water potential (in MPa) corresponding to 50% whole-plant relative transpiration.</p>
</td></tr>
<tr><td><code id="hydraulics_conductancefunctions_+3A_exp_extract">exp_extract</code></td>
<td>
<p>Exponent of the whole-plant relative transpiration Weibull function.</p>
</td></tr>
<tr><td><code id="hydraulics_conductancefunctions_+3A_k">K</code></td>
<td>
<p>Whole-plant relative conductance (0-1).</p>
</td></tr>
<tr><td><code id="hydraulics_conductancefunctions_+3A_v">v</code></td>
<td>
<p>Proportion of fine roots within each soil layer.</p>
</td></tr>
<tr><td><code id="hydraulics_conductancefunctions_+3A_kxylemmax">kxylemmax</code></td>
<td>
<p>Maximum xylem hydraulic conductance (defined as flow per leaf surface unit and per pressure drop).</p>
</td></tr>
<tr><td><code id="hydraulics_conductancefunctions_+3A_c">c</code>, <code id="hydraulics_conductancefunctions_+3A_d">d</code></td>
<td>
<p>Parameters of the Weibull function (generic xylem vulnerability curve).</p>
</td></tr>
<tr><td><code id="hydraulics_conductancefunctions_+3A_kxylem">kxylem</code></td>
<td>
<p>Xylem hydraulic conductance (defined as flow per surface unit and per pressure drop).</p>
</td></tr>
<tr><td><code id="hydraulics_conductancefunctions_+3A_pcrit">pCrit</code></td>
<td>
<p>Proportion of maximum conductance considered critical for hydraulic functioning.</p>
</td></tr>
<tr><td><code id="hydraulics_conductancefunctions_+3A_krhizomax">krhizomax</code></td>
<td>
<p>Maximum rhizosphere hydraulic conductance (defined as flow per leaf surface unit and per pressure drop).</p>
</td></tr>
<tr><td><code id="hydraulics_conductancefunctions_+3A_n">n</code>, <code id="hydraulics_conductancefunctions_+3A_alpha">alpha</code></td>
<td>
<p>Parameters of the Van Genuchten function (rhizosphere vulnerability curve).</p>
</td></tr>
<tr><td><code id="hydraulics_conductancefunctions_+3A_temp">temp</code></td>
<td>
<p>Temperature (in degrees Celsius).</p>
</td></tr>
<tr><td><code id="hydraulics_conductancefunctions_+3A_psi50">psi50</code>, <code id="hydraulics_conductancefunctions_+3A_psi88">psi88</code>, <code id="hydraulics_conductancefunctions_+3A_psi12">psi12</code></td>
<td>
<p>Water potentials (in MPa) corresponding to 50%, 88% and 12% percent conductance loss.</p>
</td></tr>
<tr><td><code id="hydraulics_conductancefunctions_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+spwbInput">spwbInput</a></code>.</p>
</td></tr>
<tr><td><code id="hydraulics_conductancefunctions_+3A_soil">soil</code></td>
<td>
<p>A list containing the description of the soil (see <code><a href="#topic+soil">soil</a></code>).</p>
</td></tr>
<tr><td><code id="hydraulics_conductancefunctions_+3A_type">type</code></td>
<td>
<p>Plot type for <code>hydraulics_vulnerabilityCurvePlot</code>, either <code>"leaf"</code>, 
<code>"stem"</code>, <code>"root"</code> or <code>"rhizosphere"</code>).</p>
</td></tr>
<tr><td><code id="hydraulics_conductancefunctions_+3A_vulnerabilityfunction">vulnerabilityFunction</code></td>
<td>
<p>String indicating the function used to represent vulnerability in plant segments, either &quot;Weibull&quot; or &quot;Sigmoid&quot;.</p>
</td></tr>
<tr><td><code id="hydraulics_conductancefunctions_+3A_psivec">psiVec</code></td>
<td>
<p>Vector of water potential values to evaluate for the vulnerability curve.</p>
</td></tr>
<tr><td><code id="hydraulics_conductancefunctions_+3A_relative">relative</code></td>
<td>
<p>A flag to relativize vulnerability curves to the [0-1] interval.</p>
</td></tr>
<tr><td><code id="hydraulics_conductancefunctions_+3A_speciesnames">speciesNames</code></td>
<td>
<p>A flag to indicate the use of species names instead of cohort names in plots.</p>
</td></tr>
<tr><td><code id="hydraulics_conductancefunctions_+3A_draw">draw</code></td>
<td>
<p>A flag to indicate whether the vulnerability curve should be drawn or just returned.</p>
</td></tr>
<tr><td><code id="hydraulics_conductancefunctions_+3A_ylim">ylim</code>, <code id="hydraulics_conductancefunctions_+3A_xlab">xlab</code>, <code id="hydraulics_conductancefunctions_+3A_ylab">ylab</code></td>
<td>
<p>Graphical parameters to override function defaults.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Details of plant hydraulic models are given the medfate book. 
Function <code>hydraulics_vulnerabilityCurvePlot</code> draws a plot of the vulnerability curves for the given <code>soil</code> object and network properties of each plant cohort in <code>x</code>.
</p>


<h3>Value</h3>

<p>Values returned for each function are:
</p>

<ul>
<li><p><code>hydraulics_psi2K</code>: Whole-plant relative conductance (0-1).
</p>
</li>
<li><p><code>hydraulics_K2Psi</code>: Soil water potential (in MPa) corresponding to the given whole-plant relative conductance value (inverse of <code>hydraulics_psi2K()</code>).
</p>
</li>
<li><p><code>hydraulics_averagePsi</code>: The average water potential (in MPa) across soil layers.
</p>
</li>
<li><p><code>hydraulics_vanGenuchtenConductance</code>: Rhizosphere conductance corresponding to an input water potential (soil vulnerability curve).
</p>
</li>
<li><p><code>hydraulics_xylemConductance</code>: Xylem conductance (flow rate per pressure drop) corresponding to an input water potential (plant vulnerability curve).
</p>
</li>
<li><p><code>hydraulics_xylemPsi</code>: Xylem water potential (in MPa) corresponding to an input xylem conductance (flow rate per pressure drop).
</p>
</li>
<li><p><code>hydraulics_psi2Weibull</code>: Parameters of the Weibull vulnerability curve that goes through the supplied psi50 and psi88 values.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>Sperry, J. S., F. R. Adler, G. S. Campbell, and J. P. Comstock. 1998. Limitation of plant water use by rhizosphere and xylem conductance: results from a model. Plant, Cell and Environment 21:347–359.
</p>
<p>Sperry, J. S., and D. M. Love. 2015. What plant hydraulics can tell us about responses to climate-change droughts. New Phytologist 207:14–27.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+hydraulics_supplyFunctionPlot">hydraulics_supplyFunctionPlot</a></code>, <code><a href="#topic+hydraulics_maximumStemHydraulicConductance">hydraulics_maximumStemHydraulicConductance</a></code>, <code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+soil">soil</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#Manual display of vulnerability curve
kstemmax = 4 # in mmol·m-2·s-1·MPa-1
stemc = 3 
stemd = -4 # in MPa
psiVec = seq(-0.1, -7.0, by =-0.01)
kstem = unlist(lapply(psiVec, hydraulics_xylemConductance, kstemmax, stemc, stemd))
plot(-psiVec, kstem, type="l",ylab="Xylem conductance (mmol·m-2·s-1·MPa-1)", 
     xlab="Canopy pressure (-MPa)", lwd=1.5,ylim=c(0,kstemmax))

#Load example dataset
data(exampleforestMED)

#Default species parameterization
data(SpParamsMED)

#Initialize soil with default soil params (2 layers)
examplesoil = soil(defaultSoilParams(2)) 

#Initialize control parameters
control = defaultControl("Granier")

#Switch to 'Sperry' transpiration mode
control = defaultControl("Sperry")

#Initialize input
x = forest2spwbInput(exampleforestMED,examplesoil, SpParamsMED, control)

#Leaf vulnerability curves
hydraulics_vulnerabilityCurvePlot(x, type="leaf")

#Stem vulnerability curves
hydraulics_vulnerabilityCurvePlot(x, type="stem")
             
</code></pre>

<hr>
<h2 id='hydraulics_scalingconductance'>Scaling from conductivity to conductance</h2><span id='topic+hydraulics_scalingconductance'></span><span id='topic+hydraulics_maximumSoilPlantConductance'></span><span id='topic+hydraulics_soilPlantResistances'></span><span id='topic+hydraulics_averageRhizosphereResistancePercent'></span><span id='topic+hydraulics_findRhizosphereMaximumConductance'></span><span id='topic+hydraulics_taperFactorSavage'></span><span id='topic+hydraulics_terminalConduitRadius'></span><span id='topic+hydraulics_referenceConductivityHeightFactor'></span><span id='topic+hydraulics_maximumStemHydraulicConductance'></span><span id='topic+hydraulics_rootxylemConductanceProportions'></span>

<h3>Description</h3>

<p>Functions used to scale from tissue conductivity to conductance of different elements of the continuum.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hydraulics_maximumSoilPlantConductance(krhizomax, krootmax, kstemmax, kleafmax)

hydraulics_soilPlantResistances(
  psiSoil,
  psiRhizo,
  psiStem,
  PLCstem,
  psiLeaf,
  krhizomax,
  n,
  alpha,
  krootmax,
  rootc,
  rootd,
  kstemmax,
  stemc,
  stemd,
  kleafmax,
  leafc,
  leafd
)

hydraulics_averageRhizosphereResistancePercent(
  krhizomax,
  n,
  alpha,
  krootmax,
  rootc,
  rootd,
  kstemmax,
  stemc,
  stemd,
  kleafmax,
  leafc,
  leafd,
  psiStep = -0.01
)

hydraulics_findRhizosphereMaximumConductance(
  averageResistancePercent,
  n,
  alpha,
  krootmax,
  rootc,
  rootd,
  kstemmax,
  stemc,
  stemd,
  kleafmax,
  leafc,
  leafd,
  initialValue = 0
)

hydraulics_taperFactorSavage(height)

hydraulics_terminalConduitRadius(height)

hydraulics_referenceConductivityHeightFactor(refheight, height)

hydraulics_maximumStemHydraulicConductance(
  xylemConductivity,
  refheight,
  Al2As,
  height,
  taper = FALSE
)

hydraulics_rootxylemConductanceProportions(L, V)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hydraulics_scalingconductance_+3A_krhizomax">krhizomax</code></td>
<td>
<p>Maximum rhizosphere hydraulic conductance (defined as flow per leaf surface unit and per pressure drop).</p>
</td></tr>
<tr><td><code id="hydraulics_scalingconductance_+3A_krootmax">krootmax</code></td>
<td>
<p>Maximum root xylem hydraulic conductance (defined as flow per leaf surface unit and per pressure drop).</p>
</td></tr>
<tr><td><code id="hydraulics_scalingconductance_+3A_kstemmax">kstemmax</code></td>
<td>
<p>Maximum stem xylem hydraulic conductance (defined as flow per leaf surface unit and per pressure drop).</p>
</td></tr>
<tr><td><code id="hydraulics_scalingconductance_+3A_kleafmax">kleafmax</code></td>
<td>
<p>Maximum leaf hydraulic conductance (defined as flow per leaf surface unit and per pressure drop).</p>
</td></tr>
<tr><td><code id="hydraulics_scalingconductance_+3A_psisoil">psiSoil</code></td>
<td>
<p>Soil water potential (in MPa). A scalar or a vector depending on the function.</p>
</td></tr>
<tr><td><code id="hydraulics_scalingconductance_+3A_psirhizo">psiRhizo</code></td>
<td>
<p>Water potential (in MPa) in the rhizosphere (root surface).</p>
</td></tr>
<tr><td><code id="hydraulics_scalingconductance_+3A_psistem">psiStem</code></td>
<td>
<p>Water potential (in MPa) in the stem.</p>
</td></tr>
<tr><td><code id="hydraulics_scalingconductance_+3A_plcstem">PLCstem</code></td>
<td>
<p>Percent loss of conductance (in %) in the stem.</p>
</td></tr>
<tr><td><code id="hydraulics_scalingconductance_+3A_psileaf">psiLeaf</code></td>
<td>
<p>Water potential (in MPa) in the leaf.</p>
</td></tr>
<tr><td><code id="hydraulics_scalingconductance_+3A_n">n</code>, <code id="hydraulics_scalingconductance_+3A_alpha">alpha</code></td>
<td>
<p>Parameters of the Van Genuchten function (rhizosphere vulnerability curve).</p>
</td></tr>
<tr><td><code id="hydraulics_scalingconductance_+3A_rootc">rootc</code>, <code id="hydraulics_scalingconductance_+3A_rootd">rootd</code></td>
<td>
<p>Parameters of the Weibull function for roots (root xylem vulnerability curve).</p>
</td></tr>
<tr><td><code id="hydraulics_scalingconductance_+3A_stemc">stemc</code>, <code id="hydraulics_scalingconductance_+3A_stemd">stemd</code></td>
<td>
<p>Parameters of the Weibull function for stems (stem xylem vulnerability curve).</p>
</td></tr>
<tr><td><code id="hydraulics_scalingconductance_+3A_leafc">leafc</code>, <code id="hydraulics_scalingconductance_+3A_leafd">leafd</code></td>
<td>
<p>Parameters of the Weibull function for leaves (leaf vulnerability curve).</p>
</td></tr>
<tr><td><code id="hydraulics_scalingconductance_+3A_psistep">psiStep</code></td>
<td>
<p>Water potential precision (in MPa).</p>
</td></tr>
<tr><td><code id="hydraulics_scalingconductance_+3A_averageresistancepercent">averageResistancePercent</code></td>
<td>
<p>Average (across water potential values) resistance percent of the rhizosphere, with respect to total resistance (rhizosphere + root xylem + stem xylem).</p>
</td></tr>
<tr><td><code id="hydraulics_scalingconductance_+3A_initialvalue">initialValue</code></td>
<td>
<p>Initial value of rhizosphere conductance.</p>
</td></tr>
<tr><td><code id="hydraulics_scalingconductance_+3A_height">height</code></td>
<td>
<p>Plant height (in cm).</p>
</td></tr>
<tr><td><code id="hydraulics_scalingconductance_+3A_refheight">refheight</code></td>
<td>
<p>Reference plant height of measurement of xylem conductivity (in cm).</p>
</td></tr>
<tr><td><code id="hydraulics_scalingconductance_+3A_xylemconductivity">xylemConductivity</code></td>
<td>
<p>Xylem conductivity as flow per length of conduit and pressure drop (in kg·m-1·s-1·MPa-1).</p>
</td></tr>
<tr><td><code id="hydraulics_scalingconductance_+3A_al2as">Al2As</code></td>
<td>
<p>Leaf area to sapwood area (in m2·m-2).</p>
</td></tr>
<tr><td><code id="hydraulics_scalingconductance_+3A_taper">taper</code></td>
<td>
<p>A boolean flag to indicate correction by taper of xylem conduits (Christoffersen et al. 2017).</p>
</td></tr>
<tr><td><code id="hydraulics_scalingconductance_+3A_l">L</code></td>
<td>
<p>Vector with the length of coarse roots (mm) for each soil layer.</p>
</td></tr>
<tr><td><code id="hydraulics_scalingconductance_+3A_v">V</code></td>
<td>
<p>Vector with the proportion [0-1] of fine roots within each soil layer.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Details of the hydraulic model are given in the medfate book
</p>


<h3>Value</h3>

<p>Values returned for each function are:
</p>

<ul>
<li><p><code>hydraulics_maximumSoilPlantConductance</code>: The maximum soil-plant conductance, in the same units as the input segment conductances.
</p>
</li>
<li><p><code>hydraulics_averageRhizosphereResistancePercent</code>: The average percentage of resistance due to the rhizosphere, calculated across water potential values.
</p>
</li>
<li><p><code>hydraulics_findRhizosphereMaximumConductance</code>: The maximum rhizosphere conductance value given an average rhizosphere resistance and the vulnerability curves of rhizosphere, root and stem elements.
</p>
</li>
<li><p><code>hydraulics_taperFactorSavage</code>: Taper factor according to Savage et al. (2010).
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>Christoffersen, B. O., M. Gloor, S. Fauset, N. M. Fyllas, D. R. Galbraith, T. R. Baker, L. Rowland, R. A. Fisher, O. J. Binks, S. A. Sevanto, C. Xu, S. Jansen, B. Choat, M. Mencuccini, N. G. McDowell, and P. Meir. 2016. Linking hydraulic traits to tropical forest function in a size-structured and trait-driven model (TFS v.1-Hydro). Geoscientific Model Development Discussions 9: 4227–4255.
</p>
<p>Savage, V. M., L. P. Bentley, B. J. Enquist, J. S. Sperry, D. D. Smith, P. B. Reich, and E. I. von Allmen. 2010. Hydraulic trade-offs and space filling enable better predictions of vascular structure and function in plants. Proceedings of the National Academy of Sciences of the United States of America 107:22722–7.
</p>
<p>Olson, M.E., Anfodillo, T., Rosell, J.A., Petit, G., Crivellaro, A., Isnard, S., León-Gómez, C., Alvarado-Cárdenas, L.O., and Castorena, M. 2014. Universal hydraulics of the flowering plants: Vessel diameter scales with stem length across angiosperm lineages, habits and climates. Ecology Letters 17: 988–997.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+hydraulics_psi2K">hydraulics_psi2K</a></code>, <code><a href="#topic+hydraulics_supplyFunctionPlot">hydraulics_supplyFunctionPlot</a></code>, <code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+soil">soil</a></code>
</p>

<hr>
<h2 id='hydraulics_supplyfunctions'>Hydraulic supply functions</h2><span id='topic+hydraulics_supplyfunctions'></span><span id='topic+hydraulics_EXylem'></span><span id='topic+hydraulics_E2psiXylem'></span><span id='topic+hydraulics_E2psiXylemUp'></span><span id='topic+hydraulics_EVanGenuchten'></span><span id='topic+hydraulics_ECrit'></span><span id='topic+hydraulics_ECapacitance'></span><span id='topic+hydraulics_E2psiVanGenuchten'></span><span id='topic+hydraulics_E2psiTwoElements'></span><span id='topic+hydraulics_E2psiBelowground'></span><span id='topic+hydraulics_E2psiAboveground'></span><span id='topic+hydraulics_E2psiFineRootLeaf'></span><span id='topic+hydraulics_E2psiNetworkStem1'></span><span id='topic+hydraulics_E2psiNetwork'></span><span id='topic+hydraulics_supplyFunctionOneXylem'></span><span id='topic+hydraulics_supplyFunctionTwoElements'></span><span id='topic+hydraulics_supplyFunctionThreeElements'></span><span id='topic+hydraulics_supplyFunctionBelowground'></span><span id='topic+hydraulics_supplyFunctionAboveground'></span><span id='topic+hydraulics_supplyFunctionFineRootLeaf'></span><span id='topic+hydraulics_supplyFunctionNetworkStem1'></span><span id='topic+hydraulics_supplyFunctionNetwork'></span><span id='topic+hydraulics_regulatedPsiXylem'></span><span id='topic+hydraulics_regulatedPsiTwoElements'></span><span id='topic+hydraulics_initSperryNetworks'></span><span id='topic+hydraulics_supplyFunctionPlot'></span>

<h3>Description</h3>

<p>Set of functions used in the implementation of hydraulic supply functions (Sperry and Love 2015).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hydraulics_EXylem(
  psiPlant,
  psiUpstream,
  kxylemmax,
  c,
  d,
  allowNegativeFlux = TRUE,
  psiCav = 0
)

hydraulics_E2psiXylem(E, psiUpstream, kxylemmax, c, d, psiCav = 0)

hydraulics_E2psiXylemUp(E, psiDownstream, kxylemmax, c, d, psiCav = 0)

hydraulics_EVanGenuchten(psiRhizo, psiSoil, krhizomax, n, alpha, l = 0.5)

hydraulics_ECrit(psiUpstream, kxylemmax, c, d, pCrit = 0.001)

hydraulics_ECapacitance(
  psi,
  psiPrev,
  PLCprev,
  V,
  fapo,
  c,
  d,
  pi0,
  eps,
  timestep
)

hydraulics_E2psiVanGenuchten(
  E,
  psiSoil,
  krhizomax,
  n,
  alpha,
  psiStep = -1e-04,
  psiMax = -10
)

hydraulics_E2psiTwoElements(
  E,
  psiSoil,
  krhizomax,
  kxylemmax,
  n,
  alpha,
  c,
  d,
  psiCav = 0,
  psiStep = -1e-04,
  psiMax = -10
)

hydraulics_E2psiBelowground(
  E,
  hydraulicNetwork,
  psiIni = as.numeric(c(0)),
  ntrial = 10L,
  psiTol = 1e-04,
  ETol = 1e-04
)

hydraulics_E2psiAboveground(E, psiRootCrown, hydraulicNetwork)

hydraulics_E2psiFineRootLeaf(E, psiFineRoot, hydraulicNetwork)

hydraulics_E2psiNetworkStem1(
  E,
  hydraulicNetwork,
  psiIni = as.numeric(c(0)),
  ntrial = 10L,
  psiTol = 1e-04,
  ETol = 1e-04
)

hydraulics_E2psiNetwork(
  E,
  hydraulicNetwork,
  psiIni = as.numeric(c(0)),
  ntrial = 10L,
  psiTol = 1e-04,
  ETol = 1e-04
)

hydraulics_supplyFunctionOneXylem(
  psiSoil,
  v,
  kstemmax,
  stemc,
  stemd,
  psiCav = 0,
  maxNsteps = 200L,
  dE = 0.01
)

hydraulics_supplyFunctionTwoElements(
  Emax,
  psiSoil,
  krhizomax,
  kxylemmax,
  n,
  alpha,
  c,
  d,
  psiCav = 0,
  dE = 0.1,
  psiMax = -10
)

hydraulics_supplyFunctionThreeElements(
  Emax,
  psiSoil,
  krhizomax,
  kxylemmax,
  kleafmax,
  n,
  alpha,
  stemc,
  stemd,
  leafc,
  leafd,
  psiCav = 0,
  dE = 0.1,
  psiMax = -10
)

hydraulics_supplyFunctionBelowground(
  hydraulicNetwork,
  minFlow = 0,
  maxNsteps = 400L,
  ntrial = 10L,
  psiTol = 1e-04,
  ETol = 1e-04,
  pCrit = 0.001
)

hydraulics_supplyFunctionAboveground(
  Erootcrown,
  psiRootCrown,
  hydraulicNetwork
)

hydraulics_supplyFunctionFineRootLeaf(
  psiFineRoot,
  hydraulicNetwork,
  minFlow = 0,
  maxNsteps = 400L,
  ETol = 1e-04,
  pCrit = 0.001
)

hydraulics_supplyFunctionNetworkStem1(
  hydraulicNetwork,
  minFlow = 0,
  maxNsteps = 400L,
  ntrial = 200L,
  psiTol = 1e-04,
  ETol = 1e-04,
  pCrit = 0.001
)

hydraulics_supplyFunctionNetwork(
  hydraulicNetwork,
  minFlow = 0,
  maxNsteps = 400L,
  ntrial = 200L,
  psiTol = 1e-04,
  ETol = 1e-04,
  pCrit = 0.001
)

hydraulics_regulatedPsiXylem(E, psiUpstream, kxylemmax, c, d, psiStep = -0.01)

hydraulics_regulatedPsiTwoElements(
  Emax,
  psiSoil,
  krhizomax,
  kxylemmax,
  n,
  alpha,
  c,
  d,
  dE = 0.1,
  psiMax = -10
)

hydraulics_initSperryNetworks(x)

hydraulics_supplyFunctionPlot(
  x,
  draw = TRUE,
  type = "E",
  speciesNames = FALSE,
  ylim = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hydraulics_supplyfunctions_+3A_psiplant">psiPlant</code></td>
<td>
<p>Plant water potential (in MPa).</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_psiupstream">psiUpstream</code></td>
<td>
<p>Water potential upstream (in MPa). In a one-component model corresponds to soil potential. In a two-component model corresponds to the potential inside the roots.</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_kxylemmax">kxylemmax</code></td>
<td>
<p>Maximum xylem hydraulic conductance (defined as flow per leaf surface unit and per pressure drop).</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_c">c</code>, <code id="hydraulics_supplyfunctions_+3A_d">d</code></td>
<td>
<p>Parameters of the Weibull function (generic xylem vulnerability curve).</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_allownegativeflux">allowNegativeFlux</code></td>
<td>
<p>A boolean to indicate wether negative flux (i.e. from plant to soil) is allowed.</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_psicav">psiCav</code></td>
<td>
<p>Minimum water potential (in MPa) experienced (for irreversible cavitation).</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_e">E</code></td>
<td>
<p>Flow per surface unit.</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_psidownstream">psiDownstream</code></td>
<td>
<p>Water potential upstream (in MPa).</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_psirhizo">psiRhizo</code></td>
<td>
<p>Soil water potential (in MPa) in the rhizosphere (root surface).</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_psisoil">psiSoil</code></td>
<td>
<p>Soil water potential (in MPa). A scalar or a vector depending on the function.</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_krhizomax">krhizomax</code></td>
<td>
<p>Maximum rhizosphere hydraulic conductance (defined as flow per leaf surface unit and per pressure drop).</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_n">n</code>, <code id="hydraulics_supplyfunctions_+3A_alpha">alpha</code>, <code id="hydraulics_supplyfunctions_+3A_l">l</code></td>
<td>
<p>Parameters of the Van Genuchten function (rhizosphere vulnerability curve).</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_pcrit">pCrit</code></td>
<td>
<p>Critical water potential (in MPa).</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_psi">psi</code></td>
<td>
<p>Water potential (in MPa).</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_psiprev">psiPrev</code></td>
<td>
<p>Water potential (in MPa) in the previous time step.</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_plcprev">PLCprev</code></td>
<td>
<p>Previous proportion of loss conductance [0-1].</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_v">V</code></td>
<td>
<p>Capacity of the compartment per leaf area (in L/m2).</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_fapo">fapo</code></td>
<td>
<p>Apoplastic fraction (proportion) in the segment.</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_pi0">pi0</code></td>
<td>
<p>Full turgor osmotic potential (MPa).</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_eps">eps</code></td>
<td>
<p>Bulk modulus of elasticity (MPa).</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_timestep">timestep</code></td>
<td>
<p>Time step in seconds.</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_psistep">psiStep</code></td>
<td>
<p>Water potential precision (in MPa).</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_psimax">psiMax</code></td>
<td>
<p>Minimum (maximum in absolute value) water potential to be considered (in MPa).</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_hydraulicnetwork">hydraulicNetwork</code></td>
<td>
<p>List with the hydraulic characteristics of nodes in the hydraulic network.</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_psiini">psiIni</code></td>
<td>
<p>Vector of initial water potential values (in MPa).</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_ntrial">ntrial</code></td>
<td>
<p>Maximum number of steps in Newton-Raphson optimization.</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_psitol">psiTol</code></td>
<td>
<p>Precision for water potential estimates (in MPa).</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_etol">ETol</code></td>
<td>
<p>Precision for water flow per surface unit.</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_psirootcrown">psiRootCrown</code></td>
<td>
<p>Soil water potential (in MPa) at the root crown.</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_psifineroot">psiFineRoot</code></td>
<td>
<p>Water potential (in MPa) inside fine roots.</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_v">v</code></td>
<td>
<p>Proportion of fine roots within each soil layer.</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_kstemmax">kstemmax</code></td>
<td>
<p>Maximum stem xylem hydraulic conductance (defined as flow per leaf surface unit and per pressure drop).</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_stemc">stemc</code>, <code id="hydraulics_supplyfunctions_+3A_stemd">stemd</code></td>
<td>
<p>Parameters of the Weibull function for stems (stem xylem vulnerability curve).</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_maxnsteps">maxNsteps</code></td>
<td>
<p>Maximum number of steps in the construction of supply functions.</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_de">dE</code></td>
<td>
<p>Increment of flow per surface unit.</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_emax">Emax</code></td>
<td>
<p>Maximum flow per surface unit.</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_kleafmax">kleafmax</code></td>
<td>
<p>Maximum leaf hydraulic conductance (defined as flow per leaf surface unit and per pressure drop).</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_leafc">leafc</code>, <code id="hydraulics_supplyfunctions_+3A_leafd">leafd</code></td>
<td>
<p>Parameters of the Weibull function for leaves (leaf vulnerability curve).</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_minflow">minFlow</code></td>
<td>
<p>Minimum flow in supply function.</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_erootcrown">Erootcrown</code></td>
<td>
<p>Flow per surface unit at the root crown.</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+spwbInput">spwbInput</a></code>.</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_draw">draw</code></td>
<td>
<p>A flag to indicate whether the supply function should be drawn or just returned.</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_type">type</code></td>
<td>
<p>Plot type for <code>hydraulics_supplyFunctionPlot</code>, either <code>"E"</code>, 
<code>"ERhizo"</code>, <code>"StemPsi"</code>, <code>"RootPsi"</code> or <code>"dEdP"</code>).</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_speciesnames">speciesNames</code></td>
<td>
<p>A flag to indicate the use of species names instead of cohort names in plots.</p>
</td></tr>
<tr><td><code id="hydraulics_supplyfunctions_+3A_ylim">ylim</code></td>
<td>
<p>Graphical parameter to override function defaults.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function <code>hydraulics_supplyFunctionPlot</code> draws a plot of the supply function for the given <code>soil</code> object and network properties of each plant cohort in <code>x</code>. Function <code>hydraulics_vulnerabilityCurvePlot</code> draws a plot of the vulnerability curves for the given <code>soil</code> object and network properties of each plant cohort in <code>x</code>.
</p>


<h3>Value</h3>

<p>Values returned for each function are:
</p>

<ul>
<li><p><code>hydraulics_E2psiXylem</code>: The plant (leaf) water potential (in MPa) corresponding to the input flow, according to the xylem supply function and given an upstream (soil or root) water potential.
</p>
</li>
<li><p><code>hydraulics_E2psiVanGenuchten</code>: The root water potential (in MPa) corresponding to the input flow, according to the rhizosphere supply function and given a soil water potential.
</p>
</li>
<li><p><code>hydraulics_E2psiTwoElements</code>: The plant (leaf) water potential (in MPa) corresponding to the input flow, according to the rhizosphere and plant supply functions and given an input soil water potential.
</p>
</li>
<li><p><code>hydraulics_E2psiNetwork</code>: The rhizosphere, root crown and plant (leaf water potential (in MPa) corresponding to the input flow, according to the vulnerability curves of rhizosphere, root and stem elements in a network.
</p>
</li>
<li><p><code>hydraulics_Ecrit</code>: The critical flow according to the xylem supply function and given an input soil water potential.
</p>
</li>
<li><p><code>hydraulics_EVanGenuchten</code>: The flow (integral of the vulnerability curve) according to the rhizosphere supply function and given an input drop in water potential (soil and rhizosphere).
</p>
</li>
<li><p><code>hydraulics_EXylem</code>: The flow (integral of the vulnerability curve) according to the xylem supply function and given an input drop in water potential (rhizosphere and plant).
</p>
</li>
<li><p><code>hydraulics_supplyFunctionOneXylem</code>, <code>hydraulics_supplyFunctionTwoElements</code> and
<code>hydraulics_supplyFunctionNetwork</code>: A list with different numeric vectors with information of the two-element supply function:
</p>

<ul>
<li><p><code>E</code>: Flow values (supply values).
</p>
</li>
<li><p><code>FittedE</code>: Fitted flow values (for <code>hydraulics_supplyFunctionTwoElements</code>).
</p>
</li>
<li><p><code>Elayers</code>: Flow values across the roots of each soil layer (only for <code>hydraulics_supplyFunctionNetwork</code>).
</p>
</li>
<li><p><code>PsiRhizo</code>: Water potential values at the root surface (only for <code>hydraulics_supplyFunctionNetwork</code>).
</p>
</li>
<li><p><code>PsiRoot</code>: Water potential values inside the root crown (not for <code>hydraulics_supplyFunctionOneXylem</code>).
</p>
</li>
<li><p><code>PsiPlant</code>: Water potential values at the canopy (leaf).
</p>
</li>
<li><p><code>dEdP</code>: Derivatives of the supply function.
</p>
</li></ul>


</li>
<li><p><code>hydraulics_supplyFunctionPlot</code>: If <code>draw = FALSE</code> a list with the result of calling <code>hydraulics_supplyFunctionNetwork</code> for each cohort. 
</p>
</li>
<li><p><code>hydraulics_regulatedPsiXylem</code>: Plant water potential after regulation (one-element loss function) given an input water potential.
</p>
</li>
<li><p><code>hydraulics_regulatedPsiTwoElements</code>: Plant water potential after regulation (two-element loss function) given an input soil water potential.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>Sperry, J. S., F. R. Adler, G. S. Campbell, and J. P. Comstock. 1998. Limitation of plant water use by rhizosphere and xylem conductance: results from a model. Plant, Cell and Environment 21:347–359.
</p>
<p>Sperry, J. S., and D. M. Love. 2015. What plant hydraulics can tell us about responses to climate-change droughts. New Phytologist 207:14–27.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+hydraulics_psi2K">hydraulics_psi2K</a></code>, <code><a href="#topic+hydraulics_maximumStemHydraulicConductance">hydraulics_maximumStemHydraulicConductance</a></code>, <code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+soil">soil</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>kstemmax = 4 # in mmol·m-2·s-1·MPa-1
stemc = 3 
stemd = -4 # in MPa
psiVec = seq(-0.1, -7.0, by =-0.01)

#Vulnerability curve
kstem = unlist(lapply(psiVec, hydraulics_xylemConductance, kstemmax, stemc, stemd))
plot(-psiVec, kstem, type="l",ylab="Xylem conductance (mmol·m-2·s-1·MPa-1)", 
     xlab="Canopy pressure (-MPa)", lwd=1.5,ylim=c(0,kstemmax))

</code></pre>

<hr>
<h2 id='hydrology_erFactor'>Rainfall interception</h2><span id='topic+hydrology_erFactor'></span><span id='topic+hydrology_interception'></span><span id='topic+hydrology_rainInterception'></span><span id='topic+hydrology_interceptionPlot'></span>

<h3>Description</h3>

<p>Function <code>hydrology_rainInterception</code> calculates the amount of rainfall intercepted daily by the canopy, given a rainfall and canopy characteristics. 
Two canopy interception models are currently available: the sparse Gash (1995) model and the Liu (2001) model. 
In both cases the current implementation assumes no trunk interception.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hydrology_erFactor(doy, pet, prec, Rconv = 5.6, Rsyn = 1.5)

hydrology_rainInterception(Rainfall, Cm, p, ER = 0.05, method = "Gash1995")

hydrology_interceptionPlot(
  x,
  SpParams,
  ER = 0.05,
  gdd = NA,
  throughfall = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hydrology_erFactor_+3A_doy">doy</code></td>
<td>
<p>Day of the year.</p>
</td></tr>
<tr><td><code id="hydrology_erFactor_+3A_pet">pet</code></td>
<td>
<p>Potential evapotranspiration for a given day (mm).</p>
</td></tr>
<tr><td><code id="hydrology_erFactor_+3A_prec">prec</code></td>
<td>
<p>Precipitation for a given day (mm).</p>
</td></tr>
<tr><td><code id="hydrology_erFactor_+3A_rconv">Rconv</code>, <code id="hydrology_erFactor_+3A_rsyn">Rsyn</code></td>
<td>
<p>Rainfall rate for convective storms and synoptic storms, respectively, in mm/h.</p>
</td></tr>
<tr><td><code id="hydrology_erFactor_+3A_rainfall">Rainfall</code></td>
<td>
<p>A numeric vector of (daily) rainfall.</p>
</td></tr>
<tr><td><code id="hydrology_erFactor_+3A_cm">Cm</code></td>
<td>
<p>Canopy water storage capacity.</p>
</td></tr>
<tr><td><code id="hydrology_erFactor_+3A_p">p</code></td>
<td>
<p>Proportion of throughfall (normally 1 - c, where c is the canopy cover).</p>
</td></tr>
<tr><td><code id="hydrology_erFactor_+3A_er">ER</code></td>
<td>
<p>The ratio of evaporation rate to rainfall rate.</p>
</td></tr>
<tr><td><code id="hydrology_erFactor_+3A_method">method</code></td>
<td>
<p>Rainfall interception method (either <code>"Gash1995"</code> or <code>"Liu2001"</code>).</p>
</td></tr>
<tr><td><code id="hydrology_erFactor_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+spwbInput">spwbInput</a></code>.</p>
</td></tr>
<tr><td><code id="hydrology_erFactor_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (see <code><a href="#topic+SpParamsMED">SpParamsMED</a></code> and <code><a href="#topic+SpParamsMED">SpParamsMED</a></code>).</p>
</td></tr>
<tr><td><code id="hydrology_erFactor_+3A_gdd">gdd</code></td>
<td>
<p>Growth degree days (in Celsius).</p>
</td></tr>
<tr><td><code id="hydrology_erFactor_+3A_throughfall">throughfall</code></td>
<td>
<p>Boolean flag to plot relative throughfall instead of percentage of intercepted rainfall.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function <code>hydrology_rainInterception</code> can accept either vectors or scalars as parameters <code>Cm</code>, <code>p</code> and <code>ER</code>. If they are supplied as vectors they should be of the same length as <code>Rainfall</code>.
</p>
<p>Function <code>hydrology_erFactor</code> calculates the evaporation-to-rainfall ratio for input values of potential evapotranspiration and rainfall, while accounting for seasonal variation in rainfall intensity (mm/h). Default values <code>Rconv = 5.6</code> and <code>Rsyn = 1.5</code> come from Miralles et al. (2010).
</p>


<h3>Value</h3>

<p>Function <code>hydrology_rainInterception</code> returns a vector of the same length as <code>Rainfall</code> containing intercepted rain values. 
</p>
<p>Function <code>hydrology_erFactor</code> returns a scalar with the evaporation-to-rainfall ratio.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>Liu (2001). Evaluation of the Liu model for predicting rainfall interception in forests world-wide. - Hydrol. Process. 15: 2341-2360.
</p>
<p>Gash (1979). An analytical model of rainfall interception by forests. - Quarterly Journal of the Royal Meteorological Society.                                       
</p>
<p>Gash et al. (1995). Estimating sparse forest rainfall interception with an analytical model. - Journal of Hydrology.
</p>
<p>Miralles DG, Gash JH, Holmes TRH, et al (2010) Global canopy interception from satellite observations. J Geophys Res 115:D16122. doi: 10.1029/2009JD013530.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb">spwb</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Load example plot plant data
data(exampleforestMED)

#Default species parameterization
data(SpParamsMED)

#Draw rainfall interception for two values of the E/R ratio
hydrology_interceptionPlot(exampleforestMED, SpParamsMED, ER = c(0.05, 0.2))

</code></pre>

<hr>
<h2 id='hydrology_soilEvaporationAmount'>Soil infiltration, percolation and bare soil evaporation</h2><span id='topic+hydrology_soilEvaporationAmount'></span><span id='topic+hydrology_soilEvaporation'></span><span id='topic+hydrology_herbaceousTranspiration'></span><span id='topic+hydrology_infiltrationRepartition'></span><span id='topic+hydrology_snowMelt'></span><span id='topic+hydrology_soil'></span><span id='topic+hydrology_infiltrationAmount'></span>

<h3>Description</h3>

<p>Function <code>hydrology_infiltrationAmount</code> calculates the amount of water that infiltrates 
into the topsoil, according to the USDA SCS curve number method (Boughton 1989). 
The remaining is assumed to be lost as surface runoff. 
Function <code>hydrology_soilEvaporationAmount</code> calculates the amount of evaporation from bare soil, following Ritchie (1972). 
Function <code>hydrology_snowMelt</code> calculates the maximum amount of snowmelt according to Kergoat (1998).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hydrology_soilEvaporationAmount(DEF, PETs, Gsoil)

hydrology_soilEvaporation(
  soil,
  soilFunctions,
  pet,
  LgroundSWR,
  modifySoil = TRUE
)

hydrology_herbaceousTranspiration(
  pet,
  LherbSWR,
  herbLAI,
  soil,
  soilFunctions,
  modifySoil = TRUE
)

hydrology_infiltrationRepartition(I, dVec, macro, a = -0.005, b = 3)

hydrology_snowMelt(tday, rad, LgroundSWR, elevation)

hydrology_infiltrationAmount(input, Ssoil)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hydrology_soilEvaporationAmount_+3A_def">DEF</code></td>
<td>
<p>Water deficit in the (topsoil) layer.</p>
</td></tr>
<tr><td><code id="hydrology_soilEvaporationAmount_+3A_pets">PETs</code></td>
<td>
<p>Potential evapotranspiration at the soil surface.</p>
</td></tr>
<tr><td><code id="hydrology_soilEvaporationAmount_+3A_gsoil">Gsoil</code></td>
<td>
<p>Gamma parameter (maximum daily evaporation).</p>
</td></tr>
<tr><td><code id="hydrology_soilEvaporationAmount_+3A_soil">soil</code></td>
<td>
<p>An object of class <code><a href="#topic+soil">soil</a></code>.</p>
</td></tr>
<tr><td><code id="hydrology_soilEvaporationAmount_+3A_soilfunctions">soilFunctions</code></td>
<td>
<p>Soil water retention curve and conductivity functions, either 'SX' (for Saxton) or 'VG' (for Van Genuchten).</p>
</td></tr>
<tr><td><code id="hydrology_soilEvaporationAmount_+3A_pet">pet</code></td>
<td>
<p>Potential evapotranspiration for a given day (mm)</p>
</td></tr>
<tr><td><code id="hydrology_soilEvaporationAmount_+3A_lgroundswr">LgroundSWR</code></td>
<td>
<p>Percentage of short-wave radiation (SWR) reaching the ground.</p>
</td></tr>
<tr><td><code id="hydrology_soilEvaporationAmount_+3A_modifysoil">modifySoil</code></td>
<td>
<p>Boolean flag to indicate that the input <code>soil</code> object should be modified during the simulation.</p>
</td></tr>
<tr><td><code id="hydrology_soilEvaporationAmount_+3A_lherbswr">LherbSWR</code></td>
<td>
<p>Percentage of short-wave radiation (SWR) reaching the herbaceous layer.</p>
</td></tr>
<tr><td><code id="hydrology_soilEvaporationAmount_+3A_herblai">herbLAI</code></td>
<td>
<p>Leaf area index of the herbaceous layer.</p>
</td></tr>
<tr><td><code id="hydrology_soilEvaporationAmount_+3A_i">I</code></td>
<td>
<p>Soil infiltration (in mm of water).</p>
</td></tr>
<tr><td><code id="hydrology_soilEvaporationAmount_+3A_dvec">dVec</code></td>
<td>
<p>Width of soil layers (in mm).</p>
</td></tr>
<tr><td><code id="hydrology_soilEvaporationAmount_+3A_macro">macro</code></td>
<td>
<p>Macroporosity of soil layers (in %).</p>
</td></tr>
<tr><td><code id="hydrology_soilEvaporationAmount_+3A_a">a</code>, <code id="hydrology_soilEvaporationAmount_+3A_b">b</code></td>
<td>
<p>Parameters of the extinction function used for water infitration.</p>
</td></tr>
<tr><td><code id="hydrology_soilEvaporationAmount_+3A_tday">tday</code></td>
<td>
<p>Average day temperature (ºC).</p>
</td></tr>
<tr><td><code id="hydrology_soilEvaporationAmount_+3A_rad">rad</code></td>
<td>
<p>Solar radiation (in MJ/m2/day).</p>
</td></tr>
<tr><td><code id="hydrology_soilEvaporationAmount_+3A_elevation">elevation</code></td>
<td>
<p>Altitude above sea level (m).</p>
</td></tr>
<tr><td><code id="hydrology_soilEvaporationAmount_+3A_input">input</code></td>
<td>
<p>A numeric vector of (daily) water input (in mm of water).</p>
</td></tr>
<tr><td><code id="hydrology_soilEvaporationAmount_+3A_ssoil">Ssoil</code></td>
<td>
<p>Soil water storage capacity (can be referred to topsoil) (in mm of water).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See description of infiltration and soil evaporation processes in De Caceres et al. (2015).
</p>


<h3>Value</h3>

<p>Function <code>hydrology_infiltrationAmount</code> a vector of the same length as <code>input</code> containing the daily amount of water that infiltrates into the soil (in mm of water). 
</p>
<p>Function <code>hydrology_infiltrationRepartition</code> estimates the amount of infiltrated water that reaches each soil layer. 
</p>
<p>Function <code>hydrology_soilEvaporationAmount</code> returns the amount of water evaporated from the soil. 
</p>
<p>Function <code>hydrology_soilEvaporation</code> returns a vector of water evaporated from each soil layer.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>Boughton (1989). A review of the USDA SCS curve number method. - Australian Journal of Soil Research 27: 511-523.
</p>
<p>De Cáceres M, Martínez-Vilalta J, Coll L, Llorens P, Casals P, Poyatos R, Pausas JG, Brotons L. (2015) Coupling a water balance model with forest inventory data to evaluate plant drought stress at the regional level. Agricultural and Forest Meteorology.
</p>
<p>Kergoat L. (1998). A model for hydrological equilibrium of leaf area index on a global scale. Journal of Hydrology 212–213: 268–286.
</p>
<p>Ritchie (1972). Model for predicting evaporation from a row crop with incomplete cover. - Water resources research.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+hydrology_soilWaterInputs">hydrology_soilWaterInputs</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>SoilDepth = c(200,400,800,1200,1500)

#TOPSOIL LAYERS
d1 = pmin(SoilDepth, 300) #&lt;300
#SUBSOIL LAYERS
d2 = pmax(0, pmin(SoilDepth-300,1200)) #300-1500 mm
#ROCK LAYER
d3 = 4000-(d1+d2) #From SoilDepth down to 4.0 m

TS_clay = 15
TS_sand = 25
SS_clay = 15
SS_sand = 25
RL_clay = 15
RL_sand = 25
TS_gravel = 20
SS_gravel = 40
RL_gravel = 95

Theta_FC1=soil_psi2thetaSX(TS_clay, TS_sand, -33) #in m3/m3
Theta_FC2=soil_psi2thetaSX(SS_clay, SS_sand, -33) #in m3/m3
Theta_FC3=soil_psi2thetaSX(RL_clay, RL_sand, -33) #in m3/m3
pcTS_gravel = 1-(TS_gravel/100)
pcSS_gravel = 1-(SS_gravel/100)
pcRL_gravel = 1-(RL_gravel/100)
MaxVol1 = (d1*Theta_FC1*pcTS_gravel)
MaxVol2 = (d2*Theta_FC2*pcSS_gravel)
MaxVol3 = (d3*Theta_FC3*pcRL_gravel)
V = MaxVol1+MaxVol2+MaxVol3

par(mar=c(5,5,1,1), mfrow=c(1,2))
NP = seq(0,60, by=1)
plot(NP,hydrology_infiltrationAmount(NP, V[1]), type="l", xlim=c(0,60), ylim=c(0,60), 
     ylab="Infiltration (mm)", xlab="Net rainfall (mm)", frame=FALSE)
lines(NP,hydrology_infiltrationAmount(NP, V[2]), lty=2)
lines(NP,hydrology_infiltrationAmount(NP, V[3]), lty=3)
lines(NP,hydrology_infiltrationAmount(NP, V[4]), lty=4)
lines(NP,hydrology_infiltrationAmount(NP, V[5]), lty=5)
legend("topleft", bty="n", lty=1:5, 
       legend=c(paste("d =", SoilDepth, "Vsoil =",round(V),"mm")))
plot(NP,NP-hydrology_infiltrationAmount(NP, V[1]), type="l", xlim=c(0,60), ylim=c(0,60), 
     ylab="Runoff (mm)", xlab="Net rainfall (mm)", frame=FALSE)
lines(NP,NP-hydrology_infiltrationAmount(NP, V[2]), lty=2)
lines(NP,NP-hydrology_infiltrationAmount(NP, V[3]), lty=3)
lines(NP,NP-hydrology_infiltrationAmount(NP, V[4]), lty=4)
lines(NP,NP-hydrology_infiltrationAmount(NP, V[5]), lty=5)
legend("topleft", bty="n", lty=1:5, 
       legend=c(paste("d =", SoilDepth,"Vsoil =",round(V),"mm")))

</code></pre>

<hr>
<h2 id='hydrology_verticalInputs'>Soil vertical inputs</h2><span id='topic+hydrology_verticalInputs'></span><span id='topic+hydrology_soilWaterInputs'></span><span id='topic+hydrology_soilInfiltrationPercolation'></span>

<h3>Description</h3>

<p>High-level functions for hydrological processes. Function <code>hydrology_soilWaterInputs</code> performs 
canopy water interception and snow accumulation/melt. Function <code>hydrology_soilInfiltrationPercolation</code> 
performs soil infiltration and percolation from the input given by the previous function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hydrology_soilWaterInputs(
  soil,
  soilFunctions,
  prec,
  er,
  tday,
  rad,
  elevation,
  Cm,
  LgroundPAR,
  LgroundSWR,
  runon = 0,
  snowpack = TRUE,
  modifySoil = TRUE
)

hydrology_soilInfiltrationPercolation(
  soil,
  soilFunctions,
  waterInput,
  rockyLayerDrainage = TRUE,
  modifySoil = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hydrology_verticalInputs_+3A_soil">soil</code></td>
<td>
<p>A list containing the description of the soil (see <code><a href="#topic+soil">soil</a></code>).</p>
</td></tr>
<tr><td><code id="hydrology_verticalInputs_+3A_soilfunctions">soilFunctions</code></td>
<td>
<p>Soil water retention curve and conductivity functions, either 'SX' (for Saxton) or 'VG' (for Van Genuchten).</p>
</td></tr>
<tr><td><code id="hydrology_verticalInputs_+3A_prec">prec</code></td>
<td>
<p>Precipitation for a given day (mm)</p>
</td></tr>
<tr><td><code id="hydrology_verticalInputs_+3A_er">er</code></td>
<td>
<p>The ratio of evaporation rate to rainfall rate.</p>
</td></tr>
<tr><td><code id="hydrology_verticalInputs_+3A_tday">tday</code></td>
<td>
<p>Average day temperature (ºC).</p>
</td></tr>
<tr><td><code id="hydrology_verticalInputs_+3A_rad">rad</code></td>
<td>
<p>Solar radiation (in MJ/m2/day).</p>
</td></tr>
<tr><td><code id="hydrology_verticalInputs_+3A_elevation">elevation</code></td>
<td>
<p>Altitude above sea level (m).</p>
</td></tr>
<tr><td><code id="hydrology_verticalInputs_+3A_cm">Cm</code></td>
<td>
<p>Canopy water storage capacity.</p>
</td></tr>
<tr><td><code id="hydrology_verticalInputs_+3A_lgroundpar">LgroundPAR</code></td>
<td>
<p>Percentage of photosynthetically-acvive radiation (PAR) reaching the ground.</p>
</td></tr>
<tr><td><code id="hydrology_verticalInputs_+3A_lgroundswr">LgroundSWR</code></td>
<td>
<p>Percentage of short-wave radiation (SWR) reaching the ground.</p>
</td></tr>
<tr><td><code id="hydrology_verticalInputs_+3A_runon">runon</code></td>
<td>
<p>Surface water amount running on the target area from upslope (in mm).</p>
</td></tr>
<tr><td><code id="hydrology_verticalInputs_+3A_snowpack">snowpack</code></td>
<td>
<p>Boolean flag to indicate the simulation of snow accumulation and melting.</p>
</td></tr>
<tr><td><code id="hydrology_verticalInputs_+3A_modifysoil">modifySoil</code></td>
<td>
<p>Boolean flag to indicate that the input <code>soil</code> object should be modified during the simulation.</p>
</td></tr>
<tr><td><code id="hydrology_verticalInputs_+3A_waterinput">waterInput</code></td>
<td>
<p>Soil water input for a given day (mm).</p>
</td></tr>
<tr><td><code id="hydrology_verticalInputs_+3A_rockylayerdrainage">rockyLayerDrainage</code></td>
<td>
<p>Boolean flag to indicate the simulation of drainage from rocky layers (&gt; 95% of rocks).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function simulates different vertical hydrological processes, which are described separately in other functions. 
If <code>modifySoil = TRUE</code> the function will modify the <code>soil</code> object (including both soil moisture and 
the snowpack on its surface) as a result of simulating hydrological processes.
</p>


<h3>Value</h3>

<p>Function <code>hydrology_soilWaterInputs</code> returns a named vector with the following elements, all in mm:
</p>
<table>
<tr><td><code>Rain</code></td>
<td>
<p>Precipitation as rainfall.</p>
</td></tr>
<tr><td><code>Snow</code></td>
<td>
<p>Precipitation as snow.</p>
</td></tr>
<tr><td><code>Interception</code></td>
<td>
<p>Rainfall water intercepted by the canopy and evaporated.</p>
</td></tr>
<tr><td><code>NetRain</code></td>
<td>
<p>Rainfall reaching the ground.</p>
</td></tr>
<tr><td><code>Snowmelt</code></td>
<td>
<p>Snow melted during the day, and added to the water infiltrated.</p>
</td></tr>
<tr><td><code>Runon</code></td>
<td>
<p>Surface water amount running on the target area from upslope.</p>
</td></tr>
<tr><td><code>Input</code></td>
<td>
<p>Total soil input, including runon, snowmelt and net rain.</p>
</td></tr>
</table>
<p>Function <code>hydrology_soilInfiltrationPercolation</code> returns a named vector with the following elements, all in mm:
</p>
<table>
<tr><td><code>Infiltration</code></td>
<td>
<p>Water infiltrated into the soil (i.e. throughfall + runon + snowmelt - runoff).</p>
</td></tr>
<tr><td><code>Runoff</code></td>
<td>
<p>Surface water leaving the target area.</p>
</td></tr>
<tr><td><code>DeepDrainage</code></td>
<td>
<p>Water leaving the target soil towards the water table.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb_day">spwb_day</a></code>, <code><a href="#topic+hydrology_rainInterception">hydrology_rainInterception</a></code>, <code><a href="#topic+hydrology_soilEvaporation">hydrology_soilEvaporation</a></code>
</p>

<hr>
<h2 id='light'>Radiation transfer functions</h2><span id='topic+light'></span><span id='topic+light_PARcohort'></span><span id='topic+light_PARground'></span><span id='topic+light_SWRground'></span><span id='topic+light_cohortAbsorbedSWRFraction'></span><span id='topic+light_layerIrradianceFraction'></span><span id='topic+light_layerIrradianceFractionBottomUp'></span><span id='topic+light_cohortSunlitShadeAbsorbedRadiation'></span><span id='topic+light_layerSunlitFraction'></span><span id='topic+light_instantaneousLightExtinctionAbsortion'></span><span id='topic+light_longwaveRadiationSHAW'></span>

<h3>Description</h3>

<p>Functions <code>light_layerIrradianceFraction</code> and <code>light_layerIrradianceFractionBottomUp</code> calculate 
the fraction of above-canopy irradiance (and the soil irradiance, respectively) reaching each vegetation layer. 
Function <code>light_layerSunlitFraction</code> calculates the proportion of sunlit leaves in each vegetation layer. 
Function <code>light_cohortSunlitShadeAbsorbedRadiation</code> calculates the amount of radiation absorved 
by cohort and vegetation layers, while differentiating between sunlit and shade leaves.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>light_PARcohort(x, SpParams, gdd = NA_real_)

light_PARground(x, SpParams, gdd = NA_real_)

light_SWRground(x, SpParams, gdd = NA_real_)

light_cohortAbsorbedSWRFraction(z, x, SpParams, gdd = NA_real_)

light_layerIrradianceFraction(
  LAIme,
  LAImd,
  LAImx,
  k,
  alpha,
  trunkExtinctionFraction = 0.1
)

light_layerIrradianceFractionBottomUp(
  LAIme,
  LAImd,
  LAImx,
  k,
  alpha,
  trunkExtinctionFraction = 0.1
)

light_cohortSunlitShadeAbsorbedRadiation(
  Ib0,
  Id0,
  Ibf,
  Idf,
  beta,
  LAIme,
  LAImd,
  kb,
  kd,
  alpha,
  gamma
)

light_layerSunlitFraction(LAIme, LAImd, kb)

light_instantaneousLightExtinctionAbsortion(
  LAIme,
  LAImd,
  LAImx,
  kPAR,
  alphaSWR,
  gammaSWR,
  ddd,
  ntimesteps = 24L,
  trunkExtinctionFraction = 0.1
)

light_longwaveRadiationSHAW(
  LAIme,
  LAImd,
  LAImx,
  LWRatm,
  Tsoil,
  Tair,
  trunkExtinctionFraction = 0.1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="light_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+forest">forest</a></code></p>
</td></tr>
<tr><td><code id="light_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (see <code><a href="#topic+SpParamsMED">SpParamsMED</a></code>).</p>
</td></tr>
<tr><td><code id="light_+3A_gdd">gdd</code></td>
<td>
<p>Growth degree days.</p>
</td></tr>
<tr><td><code id="light_+3A_z">z</code></td>
<td>
<p>A numeric vector with height values.</p>
</td></tr>
<tr><td><code id="light_+3A_laime">LAIme</code></td>
<td>
<p>A numeric matrix of live expanded LAI values per vegetation layer (row) and cohort (column).</p>
</td></tr>
<tr><td><code id="light_+3A_laimd">LAImd</code></td>
<td>
<p>A numeric matrix of dead LAI values per vegetation layer (row) and cohort (column).</p>
</td></tr>
<tr><td><code id="light_+3A_laimx">LAImx</code></td>
<td>
<p>A numeric matrix of maximum LAI values per vegetation layer (row) and cohort (column).</p>
</td></tr>
<tr><td><code id="light_+3A_k">k</code></td>
<td>
<p>A vector of light extinction coefficients.</p>
</td></tr>
<tr><td><code id="light_+3A_alpha">alpha</code></td>
<td>
<p>A vecfor of leaf absorbance by species.</p>
</td></tr>
<tr><td><code id="light_+3A_trunkextinctionfraction">trunkExtinctionFraction</code></td>
<td>
<p>Fraction of extinction due to trunks (for winter deciduous forests).</p>
</td></tr>
<tr><td><code id="light_+3A_ib0">Ib0</code></td>
<td>
<p>Above-canopy direct incident radiation.</p>
</td></tr>
<tr><td><code id="light_+3A_id0">Id0</code></td>
<td>
<p>Above-canopy diffuse incident radiation.</p>
</td></tr>
<tr><td><code id="light_+3A_ibf">Ibf</code></td>
<td>
<p>Fraction of above-canopy direct radiation reaching each vegetation layer.</p>
</td></tr>
<tr><td><code id="light_+3A_idf">Idf</code></td>
<td>
<p>Fraction of above-canopy diffuse radiation reaching each vegetation layer.</p>
</td></tr>
<tr><td><code id="light_+3A_beta">beta</code></td>
<td>
<p>Solar elevation (in radians).</p>
</td></tr>
<tr><td><code id="light_+3A_kb">kb</code></td>
<td>
<p>A vector of direct light extinction coefficients.</p>
</td></tr>
<tr><td><code id="light_+3A_kd">kd</code></td>
<td>
<p>A vector of diffuse light extinction coefficients.</p>
</td></tr>
<tr><td><code id="light_+3A_gamma">gamma</code></td>
<td>
<p>Vector of canopy reflectance values.</p>
</td></tr>
<tr><td><code id="light_+3A_kpar">kPAR</code></td>
<td>
<p>A vector of visible light extinction coefficients for each cohort.</p>
</td></tr>
<tr><td><code id="light_+3A_alphaswr">alphaSWR</code></td>
<td>
<p>A vecfor of hort-wave absorbance coefficients for each cohort.</p>
</td></tr>
<tr><td><code id="light_+3A_gammaswr">gammaSWR</code></td>
<td>
<p>A vector of short-wave reflectance coefficients (albedo) for each cohort.</p>
</td></tr>
<tr><td><code id="light_+3A_ddd">ddd</code></td>
<td>
<p>A dataframe with direct and diffuse radiation for different subdaily time steps (see function <code>radiation_directDiffuseDay</code> in package meteoland).</p>
</td></tr>
<tr><td><code id="light_+3A_ntimesteps">ntimesteps</code></td>
<td>
<p>Number of subdaily time steps.</p>
</td></tr>
<tr><td><code id="light_+3A_lwratm">LWRatm</code></td>
<td>
<p>Atmospheric downward long-wave radiation (W/m2).</p>
</td></tr>
<tr><td><code id="light_+3A_tsoil">Tsoil</code></td>
<td>
<p>Soil temperature (Celsius).</p>
</td></tr>
<tr><td><code id="light_+3A_tair">Tair</code></td>
<td>
<p>Canopy layer air temperature vector (Celsius).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Functions for short-wave radiation are adapted from Anten &amp; Bastiaans (2016), 
whereas long-wave radiation balance follows Flerchinger et al. (2009). 
Vegetation layers are assumed to be ordered from bottom to top.
</p>


<h3>Value</h3>

<p>Functions <code>light_layerIrradianceFraction</code>, <code>light_layerIrradianceFractionBottomUp</code>  and <code>light_layerSunlitFraction</code> 
return a numeric vector of length equal to the number of vegetation layers. 
</p>
<p>Function <code>light_cohortSunlitShadeAbsorbedRadiation</code> returns a list with 
two elements (matrices): <code>I_sunlit</code> and <code>I_shade</code>.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>Anten, N.P.R., Bastiaans, L., 2016. The use of canopy models to analyze light competition among plants, in: Hikosaka, K., Niinemets, U., Anten, N.P.R. (Eds.), Canopy Photosynthesis: From Basics to Application. Springer, pp. 379–398.
</p>
<p>Flerchinger, G. N., Xiao, W., Sauer, T. J., Yu, Q. 2009. Simulation of within-canopy radiation exchange. NJAS - Wageningen Journal of Life Sciences 57 (1): 5–15. https://doi.org/10.1016/j.njas.2009.07.004.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb">spwb</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>LAI &lt;- 2
nlayer &lt;- 10
LAIlayerlive &lt;- matrix(rep(LAI/nlayer,nlayer),nlayer,1)
LAIlayerdead &lt;- matrix(0,nlayer,1)
kb &lt;- 0.8
kd_PAR &lt;- 0.5
kd_SWR &lt;- kd_PAR/1.35
alpha_PAR &lt;- 0.9
gamma_PAR &lt;- 0.04
gamma_SWR &lt;- 0.05
alpha_SWR &lt;- 0.7

Ibfpar &lt;- light_layerIrradianceFraction(LAIlayerlive,LAIlayerdead,LAIlayerlive,kb, alpha_PAR)
Idfpar &lt;- light_layerIrradianceFraction(LAIlayerlive,LAIlayerdead,LAIlayerlive,kd_PAR, alpha_PAR)
Ibfswr &lt;- light_layerIrradianceFraction(LAIlayerlive,LAIlayerdead,LAIlayerlive,kb, alpha_SWR)
Idfswr &lt;- light_layerIrradianceFraction(LAIlayerlive,LAIlayerdead,LAIlayerlive,kd_SWR, alpha_SWR)
fsunlit &lt;- light_layerSunlitFraction(LAIlayerlive, LAIlayerdead, kb)
SHarea &lt;- (1-fsunlit)*LAIlayerlive[,1] 
SLarea &lt;- fsunlit*LAIlayerlive[,1] 

oldpar &lt;- par(mar=c(4,4,1,1), mfrow=c(1,2))
plot(Ibfpar*100, 1:nlayer,type="l", ylab="Layer", 
     xlab="Percentage of irradiance", xlim=c(0,100), ylim=c(1,nlayer), col="dark green")
lines(Idfpar*100, 1:nlayer, col="dark green", lty=2)
lines(Ibfswr*100, 1:nlayer, col="red")
lines(Idfswr*100, 1:nlayer, col="red", lty=2)
  
plot(fsunlit*100, 1:nlayer,type="l", ylab="Layer", 
     xlab="Percentage of leaves", xlim=c(0,100), ylim=c(1,nlayer))
lines((1-fsunlit)*100, 1:nlayer, lty=2)
par(oldpar)  
  
solarElevation &lt;- 0.67
SWR_direct &lt;- 1100
SWR_diffuse &lt;- 300
PAR_direct &lt;- 550
PAR_diffuse &lt;- 150

abs_PAR &lt;- light_cohortSunlitShadeAbsorbedRadiation(PAR_direct, PAR_diffuse,
                        Ibfpar, Idfpar, beta = solarElevation, 
                        LAIlayerlive, LAIlayerdead, kb, kd_PAR, alpha_PAR, gamma_PAR)
abs_SWR &lt;- light_cohortSunlitShadeAbsorbedRadiation(SWR_direct, SWR_diffuse,
                         Ibfswr, Idfswr, beta = solarElevation, 
                         LAIlayerlive, LAIlayerdead, kb, kd_SWR, alpha_SWR, gamma_SWR)
oldpar &lt;- par(mar=c(4,4,1,1), mfrow=c(1,2))
absRadSL &lt;- abs_SWR$I_sunlit[,1]
absRadSH &lt;- abs_SWR$I_shade[,1]
lambda &lt;- 546.6507
QSL &lt;- abs_PAR$I_sunlit[,1]*lambda*0.836*0.01
QSH &lt;- abs_PAR$I_shade[,1]*lambda*0.836*0.01
plot(QSL, 1:nlayer,type="l", ylab="Layer", 
   xlab="Absorbed PAR quantum flux per leaf area", ylim=c(1,nlayer), col="dark green", 
   xlim=c(0,max(QSL)))
lines(QSH, 1:nlayer, col="dark green", lty=2)
plot(absRadSL, 1:nlayer,type="l", ylab="Layer", 
   xlab="Absorbed SWR per leaf area (W/m2)", ylim=c(1,nlayer), col="red", 
   xlim=c(0,max(absRadSL)))
lines(absRadSH, 1:nlayer, col="red", lty=2)
par(oldpar)
  
</code></pre>

<hr>
<h2 id='modifyParams'>Modify parameters</h2><span id='topic+modifyParams'></span><span id='topic+modifySpParams'></span><span id='topic+modifyCohortParams'></span><span id='topic+modifyInputParams'></span>

<h3>Description</h3>

<p>Routines to modify species parameter table or model input objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>modifySpParams(SpParams, customParams, subsetSpecies = TRUE)

modifyCohortParams(x, customParams, verbose = TRUE)

modifyInputParams(x, customParams, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="modifyParams_+3A_spparams">SpParams</code></td>
<td>
<p>A species parameter data frame, typically <code><a href="#topic+SpParamsMED">SpParamsMED</a></code>.</p>
</td></tr>
<tr><td><code id="modifyParams_+3A_customparams">customParams</code></td>
<td>
<p>A data frame or a named vector with new parameter values (see details).</p>
</td></tr>
<tr><td><code id="modifyParams_+3A_subsetspecies">subsetSpecies</code></td>
<td>
<p>A logical flag to indicate that the output data frame should include only those species mentioned in <code>customParams</code>.</p>
</td></tr>
<tr><td><code id="modifyParams_+3A_x">x</code></td>
<td>
<p>A model input object of class <code><a href="#topic+spwbInput">spwbInput</a></code> or <code><a href="#topic+growthInput">growthInput</a></code>.</p>
</td></tr>
<tr><td><code id="modifyParams_+3A_verbose">verbose</code></td>
<td>
<p>A logical flag to indicate that messages should be printed on the console.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When calling function <code>modifySpParams</code>, <code>customParams</code> should be a data frame with as many rows as species 
and as many columns as parameters to modify, plus a column called 'SpIndex' or 'Species' to match species between the two tables.
</p>
<p>When calling <code>modifyCohortParams</code>, <code>customParams</code> can be a data frame with as many rows as cohorts 
and as many columns as parameters to modify, plus a column called 'Cohort' which will be matched with the cohort names 
given by <code><a href="#topic+spwbInput">spwbInput</a></code> or <code><a href="#topic+growthInput">growthInput</a></code>. 
Alternatively, <code>customParams</code> can be a named list or named numeric vector as for <code>modifyInputParams</code>.
</p>
<p>When calling <code>modifyInputParams</code>, <code>customParams</code> must be either a named list or a named numeric vector. 
Cohort parameters are specified using the syntax &quot;&lt;cohortName&gt;/&lt;paramName&gt;&quot; for names (e.g. &quot;T2_176/Z50&quot; to modify parameter 'Z50' of cohort 'T2_176'). 
Soil layer parameters are specified using the syntax &quot;&lt;paramName&gt;@#layer&quot; for names, where #layer is the layer index (e.g. &quot;rfc@1&quot; will modify the rock fragment content of soil layer 1). 
Control parameters are specified using either &quot;&lt;paramName&gt;&quot; (e.g &quot;phloemConductanceFactor&quot;) or &quot;&lt;paramName&gt;$&lt;subParamName&gt;&quot; (e.g &quot;maximumRelativeGrowthRates$leaf&quot;). 
It may seem unnecessary to modify soil or control parameters via a function, but <code>modifyInputParams</code> is called from optimization functions (see <code><a href="#topic+optimization">optimization</a></code>).
</p>


<h3>Value</h3>

<p>Function <code>modifySpParams</code> returns a modified species parameter data frame. 
</p>
<p>Functions <code>modifyCohortParams</code> and <code>modifyInputParams</code> return a modified <code><a href="#topic+spwbInput">spwbInput</a></code> or <code><a href="#topic+growthInput">growthInput</a></code> object. Note that modifications may affect other parameters beyond those indicated in <code>customParams</code>, as a result of parameter dependencies (see examples).
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwbInput">spwbInput</a></code>, <code><a href="#topic+SpParamsMED">SpParamsMED</a></code>, <code><a href="#topic+optimization">optimization</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Load example daily meteorological data
data(examplemeteo)

#Load example plot plant data
data(exampleforestMED)

#Default species parameterization
data(SpParamsMED)

#Initialize soil with default soil params (4 layers)
examplesoil = soil(defaultSoilParams(4))

#Initialize control parameters
control = defaultControl("Granier")

#Initialize input
x1 = forest2spwbInput(exampleforestMED,examplesoil, SpParamsMED, control)

# Cohort name for Pinus halepensis
PH_coh = paste0("T1_", SpParamsMED$SpIndex[SpParamsMED$Name=="Pinus halepensis"])
PH_coh 

# Modify Z50 and Z95 of Pinus halepensis cohort 
customParams &lt;- c(200,2000)
names(customParams) &lt;- paste0(PH_coh,c("/Z50", "/Z95"))
x1m &lt;- modifyInputParams(x1, customParams)

# Inspect original and modified objects 
x1$below
x1m$below

# Inspect dependencies: fine root distribution across soil layers
x1$belowLayers$V
x1m$belowLayers$V

# Modify rock fragment content and sand proportion of soil layer 1
x1s &lt;- modifyInputParams(x1, c("rfc@1" = 5, "sand@1" = 10))

# Inspect original and modified soils 
x1$soil
x1s$soil

# When modifying growth input objects dependencies increase
x1 = forest2growthInput(exampleforestMED,examplesoil, SpParamsMED, control)
customParams &lt;- c(2000,2)
names(customParams) &lt;- paste0(PH_coh,c("/Al2As", "/LAI_live"))
x1m &lt;- modifyInputParams(x1, customParams)

</code></pre>

<hr>
<h2 id='moisture'>Tissue moisture functions</h2><span id='topic+moisture'></span><span id='topic+moisture_sapwoodWaterCapacity'></span><span id='topic+moisture_leafWaterCapacity'></span><span id='topic+moisture_turgorLossPoint'></span><span id='topic+moisture_symplasticRWC'></span><span id='topic+moisture_symplasticPsi'></span><span id='topic+moisture_apoplasticRWC'></span><span id='topic+moisture_apoplasticPsi'></span><span id='topic+moisture_tissueRWC'></span><span id='topic+plant_water'></span><span id='topic+moisture_pressureVolumeCurvePlot'></span>

<h3>Description</h3>

<p>Set of functions used to calculate tissue moisture from water potential and viceversa.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>moisture_sapwoodWaterCapacity(Al2As, height, V, L, wd)

moisture_leafWaterCapacity(SLA, ld)

moisture_turgorLossPoint(pi0, epsilon)

moisture_symplasticRWC(psiSym, pi0, epsilon)

moisture_symplasticPsi(RWC, pi0, epsilon)

moisture_apoplasticRWC(psiApo, c, d)

moisture_apoplasticPsi(RWC, c, d)

moisture_tissueRWC(psiSym, pi0, epsilon, psiApo, c, d, af)

plant_water(x)

moisture_pressureVolumeCurvePlot(
  x,
  segment = "stem",
  fraction = "all",
  psiVec = seq(-0.1, -8, by = -0.01),
  speciesNames = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="moisture_+3A_al2as">Al2As</code></td>
<td>
<p>Leaf area to sapwood area (in m2·m-2).</p>
</td></tr>
<tr><td><code id="moisture_+3A_height">height</code></td>
<td>
<p>Plant height (in cm).</p>
</td></tr>
<tr><td><code id="moisture_+3A_v">V</code></td>
<td>
<p>Vector with the proportion [0-1] of fine roots within each soil layer.</p>
</td></tr>
<tr><td><code id="moisture_+3A_l">L</code></td>
<td>
<p>Vector with the length of coarse roots (mm) for each soil layer.</p>
</td></tr>
<tr><td><code id="moisture_+3A_wd">wd</code></td>
<td>
<p>Wood density (g·cm-3).</p>
</td></tr>
<tr><td><code id="moisture_+3A_sla">SLA</code></td>
<td>
<p>Specific leaf area (mm2·mg-1).</p>
</td></tr>
<tr><td><code id="moisture_+3A_ld">ld</code></td>
<td>
<p>Leaf tissue density (g·cm-3).</p>
</td></tr>
<tr><td><code id="moisture_+3A_pi0">pi0</code></td>
<td>
<p>Full turgor osmotic potential (MPa).</p>
</td></tr>
<tr><td><code id="moisture_+3A_epsilon">epsilon</code></td>
<td>
<p>Bulk modulus of elasticity (MPa).</p>
</td></tr>
<tr><td><code id="moisture_+3A_psisym">psiSym</code>, <code id="moisture_+3A_psiapo">psiApo</code></td>
<td>
<p>Symplastic or apoplastic water potential (MPa).</p>
</td></tr>
<tr><td><code id="moisture_+3A_rwc">RWC</code></td>
<td>
<p>Relative water content [0-1].</p>
</td></tr>
<tr><td><code id="moisture_+3A_c">c</code>, <code id="moisture_+3A_d">d</code></td>
<td>
<p>Parameters of the xylem vulnerability curve.</p>
</td></tr>
<tr><td><code id="moisture_+3A_af">af</code></td>
<td>
<p>Apoplastic fraction (proportion) in the segment (e.g. leaf or stem).</p>
</td></tr>
<tr><td><code id="moisture_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+spwbInput">spwbInput</a></code> or <code><a href="#topic+growthInput">growthInput</a></code>.</p>
</td></tr>
<tr><td><code id="moisture_+3A_segment">segment</code></td>
<td>
<p>Segment whose relative water content curve to plot, either <code>"stem"</code> or <code>"leaf"</code>
(the latter only available if <code>transpirationMode = "Sperry"</code> or <code>transpirationMode = "Cochard"</code>).</p>
</td></tr>
<tr><td><code id="moisture_+3A_fraction">fraction</code></td>
<td>
<p>Tissue fraction, either <code>"symplastic"</code>, <code>"apoplastic"</code> or <code>"all"</code>.</p>
</td></tr>
<tr><td><code id="moisture_+3A_psivec">psiVec</code></td>
<td>
<p>Vector of water potential values to evaluate for the pressure-volume curve.</p>
</td></tr>
<tr><td><code id="moisture_+3A_speciesnames">speciesNames</code></td>
<td>
<p>A flag to indicate the use of species names instead of cohort names in plots.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Values returned for each function are:
</p>

<ul>
<li><p><code>moisture_symplasticRWC</code>: Relative water content [0-1] of the symplastic fraction.
</p>
</li>
<li><p><code>moisture_apoplasticRWC</code>: Relative water content [0-1] of the apoplastic fraction.
</p>
</li>
<li><p><code>moisture_symplasticWaterPotential</code>: Water potential (in MPa) of the symplastic fraction.
</p>
</li>
<li><p><code>moisture_apoplasticWaterPotential</code>: Water potential (in MPa) of the apoplastic fraction.
</p>
</li>
<li><p><code>moisture_turgorLossPoint</code>: Water potential (in MPa) corresponding to turgor loss point.
</p>
</li>
<li><p><code>moisture_segmentRWC</code>: Segment relative water content [0-1].
</p>
</li>
<li><p><code>water_plant</code>: A vector of water content (mm) per plant cohort.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>Bartlett, M.K., Scoffoni, C., Sack, L. 2012. The determinants of leaf turgor loss point and prediction of drought tolerance of species and biomes: a global meta-analysis. Ecology Letters 15: 393–405.
</p>
<p>Hölttä, T., Cochard, H., Nikinmaa, E., Mencuccini, M. 2009. Capacitive effect of cavitation in xylem conduits: Results from a dynamic model. Plant, Cell and Environment 32: 10–21.
</p>
<p>Martin-StPaul, N., Delzon, S., Cochard, H. 2017. Plant resistance to drought depends on timely stomatal closure. Ecology Letters 20: 1437–1447.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+hydraulics_psi2K">hydraulics_psi2K</a></code>, <code><a href="#topic+hydraulics_supplyFunctionPlot">hydraulics_supplyFunctionPlot</a></code>, <code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+soil">soil</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>psi = seq(-10,0, by=0.1)
rwc_s = rep(NA, length(psi))
for(i in 1:length(psi)) rwc_s[i] = moisture_symplasticRWC(psi[i],-3,12)
plot(psi, rwc_s, type="l", xlab="Water potential (MPa)", ylab = "Symplasmic RWC")

</code></pre>

<hr>
<h2 id='mortality_dailyProbability'>Mortality</h2><span id='topic+mortality_dailyProbability'></span>

<h3>Description</h3>

<p>A simple sigmoid function to determine a daily mortality likelihood according 
to the value of a stress variable.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mortality_dailyProbability(stressValue, stressThreshold)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mortality_dailyProbability_+3A_stressvalue">stressValue</code></td>
<td>
<p>Current value of the stress variable (0 to 1, 
with higher values indicate stronger stress).</p>
</td></tr>
<tr><td><code id="mortality_dailyProbability_+3A_stressthreshold">stressThreshold</code></td>
<td>
<p>Threshold to indicate 50% annual mortality probability.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a probability (between 0 and 1)
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+growth">growth</a></code>, <code><a href="#topic+regeneration">regeneration</a></code>
</p>

<hr>
<h2 id='optimization'>Multiple model runs and function factories for optimization routines</h2><span id='topic+optimization'></span><span id='topic+multiple_runs'></span><span id='topic+optimization_function'></span><span id='topic+optimization_evaluation_function'></span><span id='topic+optimization_multicohort_function'></span><span id='topic+optimization_evaluation_multicohort_function'></span>

<h3>Description</h3>

<p>Function factories to generate functions to be used in model calibration, uncertainty or sensitivity analysis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>multiple_runs(
  parMatrix,
  x,
  meteo,
  latitude,
  elevation = NA,
  slope = NA,
  aspect = NA,
  summary_function = NULL,
  args = NULL,
  verbose = TRUE
)

optimization_function(
  parNames,
  x,
  meteo,
  latitude,
  elevation = NA,
  slope = NA,
  aspect = NA,
  summary_function,
  args = NULL
)

optimization_evaluation_function(
  parNames,
  x,
  meteo,
  latitude,
  elevation = NA,
  slope = NA,
  aspect = NA,
  measuredData,
  type = "SWC",
  cohorts = NULL,
  temporalResolution = "day",
  metric = "loglikelihood"
)

optimization_multicohort_function(
  cohortParNames,
  cohortNames,
  x,
  meteo,
  latitude,
  otherParNames = NULL,
  elevation = NA,
  slope = NA,
  aspect = NA,
  summary_function,
  args = NULL
)

optimization_evaluation_multicohort_function(
  cohortParNames,
  cohortNames,
  x,
  meteo,
  latitude,
  otherParNames = NULL,
  elevation = NA,
  slope = NA,
  aspect = NA,
  measuredData,
  type = "SWC",
  cohorts = cohortNames,
  temporalResolution = "day",
  metric = "loglikelihood"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="optimization_+3A_parmatrix">parMatrix</code></td>
<td>
<p>A matrix of parameter values with runs in rows and parameters in columns. Column names should follow parameter modification naming rules (see examples and naming rules in <code><a href="#topic+modifyInputParams">modifyInputParams</a></code>).</p>
</td></tr>
<tr><td><code id="optimization_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+spwbInput">spwbInput</a></code> or <code><a href="#topic+growthInput">growthInput</a></code>.</p>
</td></tr>
<tr><td><code id="optimization_+3A_meteo">meteo</code>, <code id="optimization_+3A_latitude">latitude</code>, <code id="optimization_+3A_elevation">elevation</code>, <code id="optimization_+3A_slope">slope</code>, <code id="optimization_+3A_aspect">aspect</code></td>
<td>
<p>Additional parameters to simulation functions <code><a href="#topic+spwb">spwb</a></code> or <code><a href="#topic+growth">growth</a></code>.</p>
</td></tr>
<tr><td><code id="optimization_+3A_summary_function">summary_function</code></td>
<td>
<p>A function whose input is the result of <code><a href="#topic+spwb">spwb</a></code> or <code><a href="#topic+growth">growth</a></code>. The function must return a numeric scalar in the case of <code>optimization_function</code>, but is not restricted in the case of <code>multiple_runs</code>.</p>
</td></tr>
<tr><td><code id="optimization_+3A_args">args</code></td>
<td>
<p>A list of additional arguments of <code>optimization_function</code>.</p>
</td></tr>
<tr><td><code id="optimization_+3A_verbose">verbose</code></td>
<td>
<p>A flag to indicate extra console output.</p>
</td></tr>
<tr><td><code id="optimization_+3A_parnames">parNames</code></td>
<td>
<p>A string vector of parameter names (see examples and naming rules in <code><a href="#topic+modifyInputParams">modifyInputParams</a></code>).</p>
</td></tr>
<tr><td><code id="optimization_+3A_measureddata">measuredData</code></td>
<td>
<p>A data frame with observed/measured values. Dates should be in row names, whereas columns should be named according to the type of output to be evaluated (see details).</p>
</td></tr>
<tr><td><code id="optimization_+3A_type">type</code></td>
<td>
<p>A string with the kind of model output to be evaluated. Accepted values are <code>"SWC"</code> (soil moisture content), <code>"REW"</code> relative extractable water, <code>"ETR"</code> (total evapotranspiration), <code>"E"</code> (transpiration per leaf area), <code>"LFMC"</code> (live fuel moisture content) and <code>"WP"</code> (plant water potentials).</p>
</td></tr>
<tr><td><code id="optimization_+3A_cohorts">cohorts</code></td>
<td>
<p>A string or a vector of strings with the cohorts to be compared (e.g. &quot;T1_68&quot;). If several cohort names are provided, the function <code>optimization_cohorts_function</code> evaluates the performance for each one and provides the mean value. If <code>NULL</code> results for the first cohort will be evaluated.</p>
</td></tr>
<tr><td><code id="optimization_+3A_temporalresolution">temporalResolution</code></td>
<td>
<p>A string to indicate the temporal resolution of the model evaluation, which can be &quot;day&quot;, &quot;week&quot;, &quot;month&quot; or &quot;year&quot;. Observed and modelled values are aggregated temporally (using either means or sums) before comparison.</p>
</td></tr>
<tr><td><code id="optimization_+3A_metric">metric</code></td>
<td>
<p>An evaluation metric (see <code><a href="#topic+evaluation_metric">evaluation_metric</a></code>).</p>
</td></tr>
<tr><td><code id="optimization_+3A_cohortparnames">cohortParNames</code></td>
<td>
<p>A string vector of vegetation parameter names for cohorts (e.g. 'Z95' or 'psiExtract').</p>
</td></tr>
<tr><td><code id="optimization_+3A_cohortnames">cohortNames</code></td>
<td>
<p>A string vector of cohort names. All cohorts will be given the same parameter values for each parameter in 'cohortParNames'.</p>
</td></tr>
<tr><td><code id="optimization_+3A_otherparnames">otherParNames</code></td>
<td>
<p>A string vector of parameter names (see examples and naming rules in <code><a href="#topic+modifyInputParams">modifyInputParams</a></code>) for non-vegetation parameters (i.e. control parameters and soil parameters).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code><a href="#topic+evaluation">evaluation</a></code> for details regarding how to specify measured data.
</p>
<p>Functions produced by these function factories should be useful for sensitivity analyses using package 'sensitivity'.
</p>
<p>Parameter naming (i.e. <code>parNames</code>) should follow the rules specified in section details of <code><a href="#topic+modifyInputParams">modifyInputParams</a></code>. 
The exception to the naming rules applies when multiple cohorts are to be modified to the same values with functions 
<code>optimization_multicohort_function</code> and <code>optimization_evaluation_multicohort_function</code>. 
Then, only a vector of parameter names is supplied for <code>cohortParNames</code>.
</p>


<h3>Value</h3>

<p>Function <code>multiple_runs</code> returns a list, whose elements are either the result of calling simulation models 
or the result of calling <code>summary_function</code> afterwards. 
</p>
<p>Function <code>optimization_function</code> returns a function whose parameters are parameter values 
and whose return is a prediction scalar (e.g. total transpiration).
</p>
<p>Function <code>optimization_evaluation_function</code> returns a function whose parameters are parameter values 
and whose return is an evaluation metric (e.g. loglikelihood of the data observations given model predictions). 
If evaluation data contains information for different cohorts (e.g. plant water potentials or transpiration rates) 
then the evaluation is performed for each cohort and the metrics are averaged. 
</p>
<p>Function <code>optimization_multicohorts_function</code> returns a function whose parameters are parameter values 
and whose return is a prediction scalar (e.g. total transpiration). The difference with <code>optimization_function</code> 
is that multiple cohorts are set to the same parameter values.
</p>
<p>Function <code>optimization_evaluation_multicohort_function</code> returns a function whose parameters are parameter values 
and whose return is an evaluation metric (e.g. loglikelihood of the data observations given model predictions). 
If evaluation data contains information for different cohorts (e.g. plant water potentials or transpiration rates) 
then the evaluation is performed for each cohort and the metrics are averaged. The difference with <code>optimization_evaluation_function</code> 
is that multiple cohorts are set to the same parameter values.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+evaluation_metric">evaluation_metric</a></code>, <code><a href="#topic+modifyInputParams">modifyInputParams</a></code>, <code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+growth">growth</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#Load example daily meteorological data
data(examplemeteo)

#Load example plot plant data
data(exampleforestMED)

#Default species parameterization
data(SpParamsMED)

#Initialize soil with default soil params (4 layers)
examplesoil &lt;- soil(defaultSoilParams(4))

#Initialize control parameters
control &lt;- defaultControl("Granier")

#Initialize input
x1 &lt;- forest2spwbInput(exampleforestMED,examplesoil, SpParamsMED, control)

# Cohort name for Pinus halepensis
PH_coh &lt;- paste0("T1_", SpParamsMED$SpIndex[SpParamsMED$Name=="Pinus halepensis"])
PH_coh 

#Parameter names of interest
parNames &lt;- c(paste0(PH_coh,"/Z50"), paste0(PH_coh,"/Z95"))

#Specify parameter matrix
parMatrix &lt;- cbind(c(200,300), c(500,1000))
colnames(parMatrix) &lt;- parNames

#Define a summary function as the total transpiration over the simulated period
sf&lt;-function(x) {sum(x$WaterBalance$Transpiration, na.rm=TRUE)}

#Perform two runs and evaluate the summary function
multiple_runs(parMatrix, 
              x1, examplemeteo, latitude = 42, elevation = 100,
              summary_function = sf)

#Load observed data (in this case the same simulation results with some added error)  
# Generate a prediction function for total transpiration over the simulated period
# as a function of parameters "Z50" and "Z95" for Pinus halepensis cohort 
of&lt;-optimization_function(parNames = parNames,
                          x = x1,
                          meteo = examplemeteo, 
                          latitude = 41.82592, elevation = 100,
                          summary_function = sf)

# Evaluate for the values of the parameter matrix
of(parMatrix[1, ])
of(parMatrix)


# Generate a loglikelihood function for soil water content
# as a function of parameters "Z50" and "Z95" for Pinus halepensis cohort 
data(exampleobs)
oef&lt;-optimization_evaluation_function(parNames = parNames,
                                      x = x1,
                                      meteo = examplemeteo, latitude = 41.82592, elevation = 100,
                                      measuredData = exampleobs, type = "SWC", 
                                      metric = "loglikelihood")

# Loglikelihood for the values of the parameter matrix
oef(parMatrix[1, ])
oef(parMatrix)


</code></pre>

<hr>
<h2 id='Parameter+20means'>
Parameter average values
</h2><span id='topic+trait_family_means'></span>

<h3>Description</h3>

<p>Internal data set with parameter averages for taxonomic families. This is used by input initialization functions to provide suitable parameter values when missing from species parameter tables.
</p>


<h3>Format</h3>

<p>Data frame <code>trait_family_means</code> has taxonomic families in rows and parameter names as columns.
</p>


<h3>Source</h3>

<p>Same sources as <code><a href="#topic+SpParamsMED">SpParamsMED</a></code>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+SpParamsMED">SpParamsMED</a></code>, <code><a href="#topic+spwbInput">spwbInput</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>medfate::trait_family_means
</code></pre>

<hr>
<h2 id='pheno_updateLeaves'>Leaf phenology</h2><span id='topic+pheno_updateLeaves'></span><span id='topic+pheno_leafDevelopmentStatus'></span><span id='topic+pheno_leafSenescenceStatus'></span><span id='topic+pheno_updatePhenology'></span>

<h3>Description</h3>

<p>Function <code>pheno_leafDevelopmentStatus</code> returns the expanded status (0 to 1) of leaves according to the growth degree days required to start bud burst and leaf unfolding, as dictated by a simple ecodormancy (one-phase) model (Chuine et al. 2013). 
Function <code>pheno_leafSenescenceStatus</code> returns the 0/1 senescence status of leaves according to the one-phase senescence model of Delpierre et al. (2009) on the basis of photoperiod and temperature.
Function <code>pheno_updateLeaves</code> updates the status of expanded leaves and dead leaves of object <code>x</code> given the photoperiod, temperature and wind of a given day. It applies the development model for 1 &lt; doy &lt; 180 and the senescence model for 181 &gt; doy &gt; 365.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pheno_leafDevelopmentStatus(Sgdd, gdd, unfoldingDD = 300)

pheno_leafSenescenceStatus(Ssen, sen)

pheno_updatePhenology(x, doy, photoperiod, tmean)

pheno_updateLeaves(x, wind, fromGrowthModel)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pheno_updateLeaves_+3A_sgdd">Sgdd</code></td>
<td>
<p>Degree days required for leaf budburst (in Celsius).</p>
</td></tr>
<tr><td><code id="pheno_updateLeaves_+3A_gdd">gdd</code></td>
<td>
<p>Cumulative degree days (in Celsius)</p>
</td></tr>
<tr><td><code id="pheno_updateLeaves_+3A_unfoldingdd">unfoldingDD</code></td>
<td>
<p>Degree-days for complete leaf unfolding after budburst has occurred.</p>
</td></tr>
<tr><td><code id="pheno_updateLeaves_+3A_ssen">Ssen</code></td>
<td>
<p>Threshold to start leaf senescence.</p>
</td></tr>
<tr><td><code id="pheno_updateLeaves_+3A_sen">sen</code></td>
<td>
<p>Cumulative senescence variable.</p>
</td></tr>
<tr><td><code id="pheno_updateLeaves_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+spwbInput">spwbInput</a></code>.</p>
</td></tr>
<tr><td><code id="pheno_updateLeaves_+3A_doy">doy</code></td>
<td>
<p>Day of the year.</p>
</td></tr>
<tr><td><code id="pheno_updateLeaves_+3A_photoperiod">photoperiod</code></td>
<td>
<p>Day length (in hours).</p>
</td></tr>
<tr><td><code id="pheno_updateLeaves_+3A_tmean">tmean</code></td>
<td>
<p>Average day temperature (in Celsius).</p>
</td></tr>
<tr><td><code id="pheno_updateLeaves_+3A_wind">wind</code></td>
<td>
<p>Average day wind speed (in m/s).</p>
</td></tr>
<tr><td><code id="pheno_updateLeaves_+3A_fromgrowthmodel">fromGrowthModel</code></td>
<td>
<p>Boolean flag to indicate that routine is called from <code><a href="#topic+growth">growth</a></code> simulation function.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Function <code>pheno_leafDevelopmentStatus</code> returns a vector of values between 0 and 1, 
whereas function <code>pheno_leafSenescenceStatus</code> returns a vector of 0 (senescent) and 1 (expanded) values. 
The other two functions do not return any value (see note).
</p>


<h3>Note</h3>

<p>Functions <code>pheno_updatePhenology</code> and <code>pheno_updateLeaves</code> modify the input object <code>x</code>. The first modifies phenological state and the second modifies the leaf area accordingly.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>Chuine, I., De Cortazar-Atauri, I.G., Kramer, K., Hänninen, H., 2013. Plant development models. Phenology: An Integrative Environmental Science. Springer, pp. 275–293.
</p>
<p>Delpierre N, Dufrêne E, Soudani K et al (2009) Modelling interannual and spatial variability of leaf senescence for three deciduous tree species in France. Agric For Meteorol 149:938–948. doi:10.1016/j.agrformet.2008.11.014
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+spwbInput">spwbInput</a></code>
</p>

<hr>
<h2 id='photo'>Photosynthesis submodel functions</h2><span id='topic+photo'></span><span id='topic+photo_GammaTemp'></span><span id='topic+photo_KmTemp'></span><span id='topic+photo_VmaxTemp'></span><span id='topic+photo_JmaxTemp'></span><span id='topic+photo_electronLimitedPhotosynthesis'></span><span id='topic+photo_rubiscoLimitedPhotosynthesis'></span><span id='topic+photo_photosynthesis'></span><span id='topic+photo_leafPhotosynthesisFunction'></span><span id='topic+photo_leafPhotosynthesisFunction2'></span><span id='topic+photo_sunshadePhotosynthesisFunction'></span><span id='topic+photo_multilayerPhotosynthesisFunction'></span>

<h3>Description</h3>

<p>Set of functions used in the calculation of photosynthesis
</p>


<h3>Usage</h3>

<pre><code class='language-R'>photo_GammaTemp(Tleaf)

photo_KmTemp(Tleaf, Oi = 209)

photo_VmaxTemp(Vmax298, Tleaf)

photo_JmaxTemp(Jmax298, Tleaf)

photo_electronLimitedPhotosynthesis(Q, Ci, GT, Jmax)

photo_rubiscoLimitedPhotosynthesis(Ci, GT, Km, Vmax)

photo_photosynthesis(Q, Catm, Gc, Tleaf, Vmax298, Jmax298, verbose = FALSE)

photo_leafPhotosynthesisFunction(
  E,
  psiLeaf,
  Catm,
  Patm,
  Tair,
  vpa,
  u,
  absRad,
  Q,
  Vmax298,
  Jmax298,
  leafWidth = 1,
  refLeafArea = 1,
  verbose = FALSE
)

photo_leafPhotosynthesisFunction2(
  E,
  psiLeaf,
  Catm,
  Patm,
  Tair,
  vpa,
  u,
  SWRabs,
  LWRnet,
  Q,
  Vmax298,
  Jmax298,
  leafWidth = 1,
  refLeafArea = 1,
  verbose = FALSE
)

photo_sunshadePhotosynthesisFunction(
  E,
  psiLeaf,
  Catm,
  Patm,
  Tair,
  vpa,
  SLarea,
  SHarea,
  u,
  absRadSL,
  absRadSH,
  QSL,
  QSH,
  Vmax298SL,
  Vmax298SH,
  Jmax298SL,
  Jmax298SH,
  leafWidth = 1,
  verbose = FALSE
)

photo_multilayerPhotosynthesisFunction(
  E,
  psiLeaf,
  Catm,
  Patm,
  Tair,
  vpa,
  SLarea,
  SHarea,
  u,
  absRadSL,
  absRadSH,
  QSL,
  QSH,
  Vmax298,
  Jmax298,
  leafWidth = 1,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="photo_+3A_tleaf">Tleaf</code></td>
<td>
<p>Leaf temperature (in ºC).</p>
</td></tr>
<tr><td><code id="photo_+3A_oi">Oi</code></td>
<td>
<p>Oxigen concentration (mmol*mol-1).</p>
</td></tr>
<tr><td><code id="photo_+3A_vmax298">Vmax298</code>, <code id="photo_+3A_vmax298sl">Vmax298SL</code>, <code id="photo_+3A_vmax298sh">Vmax298SH</code></td>
<td>
<p>Maximum Rubisco carboxylation rate per leaf area at 298ºK (i.e. 25 ºC) (micromol*s-1*m-2) (for each canopy layer in the case of <code>photo_multilayerPhotosynthesisFunction</code>). 'SH' stands for shade leaves, whereas 'SL' stands for sunlit leaves.</p>
</td></tr>
<tr><td><code id="photo_+3A_jmax298">Jmax298</code>, <code id="photo_+3A_jmax298sl">Jmax298SL</code>, <code id="photo_+3A_jmax298sh">Jmax298SH</code></td>
<td>
<p>Maximum electron transport rate per leaf area at 298ºK (i.e. 25 ºC) (micromol*s-1*m-2) (for each canopy layer in the case of <code>photo_multilayerPhotosynthesisFunction</code>). 'SH' stands for shade leaves, whereas 'SL' stands for sunlit leaves.</p>
</td></tr>
<tr><td><code id="photo_+3A_q">Q</code></td>
<td>
<p>Active photon flux density (micromol * s-1 * m-2).</p>
</td></tr>
<tr><td><code id="photo_+3A_ci">Ci</code></td>
<td>
<p>CO2 internal concentration (micromol * mol-1).</p>
</td></tr>
<tr><td><code id="photo_+3A_gt">GT</code></td>
<td>
<p>CO2 saturation point corrected by temperature (micromol * mol-1).</p>
</td></tr>
<tr><td><code id="photo_+3A_jmax">Jmax</code></td>
<td>
<p>Maximum electron transport rate per leaf area (micromol*s-1*m-2).</p>
</td></tr>
<tr><td><code id="photo_+3A_km">Km</code></td>
<td>
<p>Km = Kc*(1.0+(Oi/Ko)) - Michaelis-Menten term corrected by temperature (in micromol * mol-1).</p>
</td></tr>
<tr><td><code id="photo_+3A_vmax">Vmax</code></td>
<td>
<p>Maximum Rubisco carboxylation rate per leaf area (micromol*s-1*m-2).</p>
</td></tr>
<tr><td><code id="photo_+3A_catm">Catm</code></td>
<td>
<p>CO2 air concentration (micromol * mol-1).</p>
</td></tr>
<tr><td><code id="photo_+3A_gc">Gc</code></td>
<td>
<p>CO2 leaf (stomatal) conductance (mol * s-1 * m-2).</p>
</td></tr>
<tr><td><code id="photo_+3A_verbose">verbose</code></td>
<td>
<p>Boolean flag to indicate console output.</p>
</td></tr>
<tr><td><code id="photo_+3A_e">E</code></td>
<td>
<p>Transpiration flow rate per leaf area (mmol*s-1*m-2).</p>
</td></tr>
<tr><td><code id="photo_+3A_psileaf">psiLeaf</code></td>
<td>
<p>Leaf water potential (MPa).</p>
</td></tr>
<tr><td><code id="photo_+3A_patm">Patm</code></td>
<td>
<p>Atmospheric air pressure (in kPa).</p>
</td></tr>
<tr><td><code id="photo_+3A_tair">Tair</code></td>
<td>
<p>Air temperature (in ºC).</p>
</td></tr>
<tr><td><code id="photo_+3A_vpa">vpa</code></td>
<td>
<p>Vapour pressure deficit (in kPa).</p>
</td></tr>
<tr><td><code id="photo_+3A_u">u</code></td>
<td>
<p>Wind speed above the leaf boundary (in m/s) (for each canopy layer in the case of <code>photo_multilayerPhotosynthesisFunction</code>).</p>
</td></tr>
<tr><td><code id="photo_+3A_absrad">absRad</code></td>
<td>
<p>Absorbed long- and short-wave radiation (in W*m^-2).</p>
</td></tr>
<tr><td><code id="photo_+3A_leafwidth">leafWidth</code></td>
<td>
<p>Leaf width (in cm).</p>
</td></tr>
<tr><td><code id="photo_+3A_refleafarea">refLeafArea</code></td>
<td>
<p>Leaf reference area.</p>
</td></tr>
<tr><td><code id="photo_+3A_swrabs">SWRabs</code></td>
<td>
<p>Absorbed short-wave radiation (in W·m-2).</p>
</td></tr>
<tr><td><code id="photo_+3A_lwrnet">LWRnet</code></td>
<td>
<p>Net long-wave radiation balance (in W·m-2).</p>
</td></tr>
<tr><td><code id="photo_+3A_slarea">SLarea</code>, <code id="photo_+3A_sharea">SHarea</code></td>
<td>
<p>Leaf area index of sunlit/shade leaves (for each canopy layer in the case of <code>photo_multilayerPhotosynthesisFunction</code>).</p>
</td></tr>
<tr><td><code id="photo_+3A_absradsl">absRadSL</code>, <code id="photo_+3A_absradsh">absRadSH</code></td>
<td>
<p>Instantaneous absorbed radiation (W·m-2) per unit of sunlit/shade leaf area (for each canopy layer in the case of <code>photo_multilayerPhotosynthesisFunction</code>).</p>
</td></tr>
<tr><td><code id="photo_+3A_qsl">QSL</code>, <code id="photo_+3A_qsh">QSH</code></td>
<td>
<p>Active photon flux density (micromol * s-1 * m-2) per unit of sunlit/shade leaf area (for each canopy layer in the case of <code>photo_multilayerPhotosynthesisFunction</code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Details of the photosynthesis submodel are given in the medfate book
</p>


<h3>Value</h3>

<p>Values returned for each function are:
</p>

<ul>
<li><p><code>photo_GammaTemp</code>: CO2 compensation concentration (micromol * mol-1).
</p>
</li>
<li><p><code>photo_KmTemp</code>: Michaelis-Menten coefficients of Rubisco for Carbon (micromol * mol-1) and Oxigen (mmol * mol-1).
</p>
</li>
<li><p><code>photo_VmaxTemp</code>: Temperature correction of Vmax298.
</p>
</li>
<li><p><code>photo_JmaxTemp</code>: Temperature correction of Jmax298.
</p>
</li>
<li><p><code>photo_electronLimitedPhotosynthesis</code>: Electron-limited photosynthesis (micromol*s-1*m-2) following Farquhar et al. (1980).
</p>
</li>
<li><p><code>photo_rubiscoLimitedPhotosynthesis</code>: Rubisco-limited photosynthesis (micromol*s-1*m-2) following Farquhar et al. (1980).
</p>
</li>
<li><p><code>photo_photosynthesis</code>: Calculates gross photosynthesis (micromol*s-1*m-2) following (Farquhar et al. (1980) and Collatz et al (1991).
</p>
</li>
<li><p><code>photo_leafPhotosynthesisFunction</code>: Returns a data frame with the following columns:
</p>

<ul>
<li><p><code>LeafTemperature</code>: Leaf temperature (ºC).
</p>
</li>
<li><p><code>LeafVPD</code>: Leaf vapor pressure deficit (kPa).
</p>
</li>
<li><p><code>LeafCi</code>: Internal CO2 concentration (micromol * mol-1).
</p>
</li>
<li><p><code>Gsw</code>: Leaf stomatal conductance to water vapor (mol * s-1 * m-2).
</p>
</li>
<li><p><code>GrossPhotosynthesis</code>: Gross photosynthesis (micromol*s-1*m-2).
</p>
</li>
<li><p><code>NetPhotosynthesis</code>: Net photosynthesis, after discounting autotrophic respiration (micromol*s-1*m-2).
</p>
</li></ul>


</li>
<li><p><code>photo_sunshadePhotosynthesisFunction</code>: Returns a data frame with the following columns:
</p>

<ul>
<li><p><code>GrossPhotosynthesis</code>: Gross photosynthesis (micromol*s-1*m-2).
</p>
</li>
<li><p><code>NetPhotosynthesis</code>: Net photosynthesis, after discounting autotrophic respiration (micromol*s-1*m-2).
</p>
</li>
<li><p><code>LeafCiSL</code>: Sunlit leaf internal CO2 concentration (micromol * mol-1).
</p>
</li>
<li><p><code>LeafCiSH</code>: Shade leaf internal CO2 concentration (micromol * mol-1).
</p>
</li>
<li><p><code>LeafTempSL</code>: Sunlit leaf temperature (ºC).
</p>
</li>
<li><p><code>LeafTempSH</code>: Shade leaf temperature (ºC).
</p>
</li>
<li><p><code>LeafVPDSL</code>: Sunlit leaf vapor pressure deficit (kPa).
</p>
</li>
<li><p><code>LeafVPDSH</code>: Shade leaf vapor pressure deficit (kPa).
</p>
</li></ul>


</li>
<li><p><code>photo_multilayerPhotosynthesisFunction</code>: Return a data frame with the following columns:
</p>

<ul>
<li><p><code>GrossPhotosynthesis</code>: Gross photosynthesis (micromol*s-1*m-2).
</p>
</li>
<li><p><code>NetPhotosynthesis</code>: Net photosynthesis, after discounting autotrophic respiration (micromol*s-1*m-2).
</p>
</li></ul>


</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>Bernacchi, C. J., E. L. Singsaas, C. Pimentel, A. R. Portis, and S. P. Long. 2001. Improved temperature response functions for models of Rubisco-limited photosynthesis. Plant, Cell and Environment 24:253–259.
</p>
<p>Collatz, G. J., J. T. Ball, C. Grivet, and J. A. Berry. 1991. Physiological and environmental regulation of stomatal conductance, photosynthesis and transpiration: a model that includes a laminar boundary layer. Agricultural and Forest Meteorology 54:107–136.
</p>
<p>Farquhar, G. D., S. von Caemmerer, and J. A. Berry. 1980. A biochemical model of photosynthetic CO2 assimilation in leaves of C3 species. Planta 149:78–90.
</p>
<p>Leuning, R. 2002. Temperature dependence of two parameters in a photosynthesis model. Plant, Cell and Environment 25:1205–1210.
</p>
<p>Sperry, J. S., M. D. Venturas, W. R. L. Anderegg, M. Mencuccini, D. S. Mackay, Y. Wang, and D. M. Love. 2016. Predicting stomatal responses to the environment from the optimization of photosynthetic gain and hydraulic cost. Plant Cell and Environment.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+hydraulics_supplyFunctionNetwork">hydraulics_supplyFunctionNetwork</a></code>, <code><a href="#topic+biophysics_leafTemperature">biophysics_leafTemperature</a></code>, <code><a href="#topic+spwb">spwb</a></code>
</p>

<hr>
<h2 id='plant_values'>Woody plant cohort description functions</h2><span id='topic+plant_values'></span><span id='topic+plant_ID'></span><span id='topic+plant_basalArea'></span><span id='topic+plant_largerTreeBasalArea'></span><span id='topic+plant_cover'></span><span id='topic+plant_species'></span><span id='topic+plant_speciesName'></span><span id='topic+plant_density'></span><span id='topic+plant_height'></span><span id='topic+plant_individualArea'></span><span id='topic+plant_crownRatio'></span><span id='topic+plant_crownBaseHeight'></span><span id='topic+plant_crownLength'></span><span id='topic+plant_foliarBiomass'></span><span id='topic+plant_fuelLoading'></span><span id='topic+plant_equilibriumLeafLitter'></span><span id='topic+plant_equilibriumSmallBranchLitter'></span><span id='topic+plant_phytovolume'></span><span id='topic+plant_LAI'></span><span id='topic+plant_characterParameter'></span><span id='topic+plant_parameter'></span>

<h3>Description</h3>

<p>Functions to calculate attributes of woody plants in a <code><a href="#topic+forest">forest</a></code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plant_ID(x, SpParams, treeOffset = 0L, shrubOffset = 0L)

plant_basalArea(x, SpParams)

plant_largerTreeBasalArea(x, SpParams, self_proportion = 0.5)

plant_cover(x, SpParams)

plant_species(x, SpParams)

plant_speciesName(x, SpParams)

plant_density(x, SpParams)

plant_height(x, SpParams)

plant_individualArea(x, SpParams)

plant_crownRatio(x, SpParams)

plant_crownBaseHeight(x, SpParams)

plant_crownLength(x, SpParams)

plant_foliarBiomass(x, SpParams, gdd = NA_real_)

plant_fuelLoading(x, SpParams, gdd = NA_real_, includeDead = TRUE)

plant_equilibriumLeafLitter(x, SpParams, AET = 800)

plant_equilibriumSmallBranchLitter(
  x,
  SpParams,
  smallBranchDecompositionRate = 0.81
)

plant_phytovolume(x, SpParams)

plant_LAI(x, SpParams, gdd = NA_real_, bounded = TRUE)

plant_characterParameter(x, SpParams, parName)

plant_parameter(x, SpParams, parName, fillMissing = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plant_values_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+forest">forest</a></code>.</p>
</td></tr>
<tr><td><code id="plant_values_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (see <code><a href="#topic+SpParamsMED">SpParamsMED</a></code>).</p>
</td></tr>
<tr><td><code id="plant_values_+3A_treeoffset">treeOffset</code>, <code id="plant_values_+3A_shruboffset">shrubOffset</code></td>
<td>
<p>Integers to offset cohort IDs.</p>
</td></tr>
<tr><td><code id="plant_values_+3A_self_proportion">self_proportion</code></td>
<td>
<p>Proportion of the target cohort included in the assessment</p>
</td></tr>
<tr><td><code id="plant_values_+3A_gdd">gdd</code></td>
<td>
<p>Growth degree days (to account for leaf phenology effects).</p>
</td></tr>
<tr><td><code id="plant_values_+3A_includedead">includeDead</code></td>
<td>
<p>A flag to indicate that standing dead fuels (dead branches) are included.</p>
</td></tr>
<tr><td><code id="plant_values_+3A_aet">AET</code></td>
<td>
<p>Actual annual evapotranspiration (in mm).</p>
</td></tr>
<tr><td><code id="plant_values_+3A_smallbranchdecompositionrate">smallBranchDecompositionRate</code></td>
<td>
<p>Decomposition rate of small branches.</p>
</td></tr>
<tr><td><code id="plant_values_+3A_bounded">bounded</code></td>
<td>
<p>A boolean flag to indicate that extreme values should be prevented (maximum tree LAI = 7 and maximum shrub LAI = 3)</p>
</td></tr>
<tr><td><code id="plant_values_+3A_parname">parName</code></td>
<td>
<p>A string with a parameter name.</p>
</td></tr>
<tr><td><code id="plant_values_+3A_fillmissing">fillMissing</code></td>
<td>
<p>A boolean flag to try imputation on missing values.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector with values for each woody plant cohort of the input <code><a href="#topic+forest">forest</a></code> object:
</p>

<ul>
<li><p><code>plant_basalArea</code>: Tree basal area (m2/ha).
</p>
</li>
<li><p><code>plant_largerTreeBasalArea</code>: Basal area (m2/ha) of trees larger (in diameter) than the tree. Half of the trees of the same record are included.
</p>
</li>
<li><p><code>plant_characterParameter</code>: The parameter values of each plant, as strings.
</p>
</li>
<li><p><code>plant_cover</code>: Shrub cover (in percent).
</p>
</li>
<li><p><code>plant_crownBaseHeight</code>: The height corresponding to the start of the crown (in cm).
</p>
</li>
<li><p><code>plant_crownLength</code>: The difference between crown base height and total height (in cm).
</p>
</li>
<li><p><code>plant_crownRatio</code>: The ratio between crown length and total height (between 0 and 1).
</p>
</li>
<li><p><code>plant_density</code>: Plant density (ind/ha). Tree density is directly taken from the forest object, while the shrub density is estimated from cover and height by calculating the area of a single individual.
</p>
</li>
<li><p><code>plant_equilibriumLeafLitter</code>: Litter biomass of leaves at equilibrium (in kg/m2).
</p>
</li>
<li><p><code>plant_equilibriumSmallBranchLitter</code>: Litter biomass of small branches (&lt; 6.35 mm diameter) at equilibrium (in kg/m2).
</p>
</li>
<li><p><code>plant_foliarBiomass</code>: Standing biomass of leaves (in kg/m2).
</p>
</li>
<li><p><code>plant_fuelLoading</code>: Fine fuel load (in kg/m2).
</p>
</li>
<li><p><code>plant_height</code>: Total height (in cm).
</p>
</li>
<li><p><code>plant_ID</code>: Cohort coding for simulation functions (concatenation of 'T' (Trees) or 'S' (Shrub), cohort index and species index).
</p>
</li>
<li><p><code>plant_LAI</code>: Leaf area index (m2/m2).
</p>
</li>
<li><p><code>plant_individualArea</code>: Area (m2) occupied by a shrub individual.
</p>
</li>
<li><p><code>plant_parameter</code>: The parameter values of each plant, as numeric.
</p>
</li>
<li><p><code>plant_phytovolume</code>: Shrub phytovolume (m3/m2).
</p>
</li>
<li><p><code>plant_species</code>: Species identity integer (indices start with 0).
</p>
</li>
<li><p><code>plant_speciesName</code>: String with species taxonomic name (or a functional group).
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+forest">forest</a></code>, <code><a href="#topic+summary.forest">summary.forest</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Default species parameterization
data(SpParamsMED)

#Load example plot
data(exampleforestMED)

#A plant-level way to obtain stand basal area
sum(plant_basalArea(exampleforestMED, SpParamsMED), na.rm=TRUE)

#The analogous plant-level function for LAI
sum(plant_LAI(exampleforestMED, SpParamsMED))
  
#The analogous plant-level function for fuel loading
sum(plant_fuelLoading(exampleforestMED, SpParamsMED))
      
#Summary function for 'forest' objects can be also used
summary(exampleforestMED, SpParamsMED)

#Cohort IDs in the models
plant_ID(exampleforestMED, SpParamsMED)
      
</code></pre>

<hr>
<h2 id='plot.forest'>Plot forest attributes</h2><span id='topic+plot.forest'></span><span id='topic+shinyplot.forest'></span>

<h3>Description</h3>

<p>Convenient wrappers for vertical forest profiles (see <code><a href="#topic+vprofile_leafAreaDensity">vprofile_leafAreaDensity</a></code>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'forest'
plot(
  x,
  SpParams,
  type = "LeafAreaDensity",
  byCohorts = FALSE,
  bySpecies = FALSE,
  includeHerbs = FALSE,
  ...
)

## S3 method for class 'forest'
shinyplot(x, SpParams, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.forest_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+forest">forest</a></code>.</p>
</td></tr>
<tr><td><code id="plot.forest_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (see <code><a href="#topic+SpParamsMED">SpParamsMED</a></code>).</p>
</td></tr>
<tr><td><code id="plot.forest_+3A_type">type</code></td>
<td>
<p>A string of the plot type: &quot;LeafAreaDensity&quot;, &quot;RootDistribution&quot;, &quot;FuelBulkDensity&quot;, &quot;PARExtinction&quot;, &quot;SWRExtinction&quot; or &quot;WindExtinction&quot;.</p>
</td></tr>
<tr><td><code id="plot.forest_+3A_bycohorts">byCohorts</code></td>
<td>
<p>A logical flag to separate profiles for each cohort.</p>
</td></tr>
<tr><td><code id="plot.forest_+3A_byspecies">bySpecies</code></td>
<td>
<p>A logical flag to aggregate results by species.</p>
</td></tr>
<tr><td><code id="plot.forest_+3A_includeherbs">includeHerbs</code></td>
<td>
<p>A logical flag to include herbaceous layer in the profile.</p>
</td></tr>
<tr><td><code id="plot.forest_+3A_...">...</code></td>
<td>
<p>Additional parameters to vertical profiles</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggplot or a shiny application, depending on the function.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+vprofile_leafAreaDensity">vprofile_leafAreaDensity</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(exampleforestMED)
data(SpParamsMED)
plot(exampleforestMED, SpParamsMED)

</code></pre>

<hr>
<h2 id='plot.spwb'>Plots simulation results</h2><span id='topic+plot.spwb'></span><span id='topic+plot.pwb'></span><span id='topic+plot.growth'></span><span id='topic+plot.fordyn'></span>

<h3>Description</h3>

<p>Function <code>plot</code> plots time series of the results of the soil plant water balance model (see <code><a href="#topic+spwb">spwb</a></code>), 
plant water balance model (see <code><a href="#topic+pwb">pwb</a></code>), the forest growth model (see <code><a href="#topic+growth">growth</a></code>) 
or the forest dynamics model (see <code><a href="#topic+fordyn">fordyn</a></code>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'spwb'
plot(
  x,
  type = "PET_Precipitation",
  cohorts = NULL,
  bySpecies = FALSE,
  dates = NULL,
  subdaily = FALSE,
  xlim = NULL,
  ylim = NULL,
  xlab = NULL,
  ylab = NULL,
  summary.freq = NULL,
  ...
)

## S3 method for class 'pwb'
plot(
  x,
  type = "PlantTranspiration",
  cohorts = NULL,
  bySpecies = FALSE,
  dates = NULL,
  subdaily = FALSE,
  xlim = NULL,
  ylim = NULL,
  xlab = NULL,
  ylab = NULL,
  summary.freq = NULL,
  ...
)

## S3 method for class 'growth'
plot(
  x,
  type = "PET_Precipitation",
  cohorts = NULL,
  bySpecies = FALSE,
  dates = NULL,
  subdaily = FALSE,
  xlim = NULL,
  ylim = NULL,
  xlab = NULL,
  ylab = NULL,
  summary.freq = NULL,
  ...
)

## S3 method for class 'fordyn'
plot(
  x,
  type = "StandBasalArea",
  cohorts = NULL,
  bySpecies = FALSE,
  dates = NULL,
  xlim = NULL,
  ylim = NULL,
  xlab = NULL,
  ylab = NULL,
  summary.freq = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.spwb_+3A_x">x</code></td>
<td>
<p>An object of class <code>spwb</code>, <code>pwb</code>, <code>growth</code> or <code>fordyn</code>.</p>
</td></tr>
<tr><td><code id="plot.spwb_+3A_type">type</code></td>
<td>
<p>The information to be plotted (see details)</p>
</td></tr>
<tr><td><code id="plot.spwb_+3A_cohorts">cohorts</code></td>
<td>
<p>An integer, boolean or character vector to select the plant cohorts to be plotted. If <code>cohorts = "T"</code> (resp. <code>cohorts = "S"</code>) then all tree (resp. shrub) cohorts will be displayed.</p>
</td></tr>
<tr><td><code id="plot.spwb_+3A_byspecies">bySpecies</code></td>
<td>
<p>Allows aggregating output by species, before drawing plots (only has an effect with some values of <code>type</code>). Aggregation can involve a sum (as for plant lai or transpiration) or a LAI-weighted mean (as for plant stress or plant water potential), where LAI values are those of <code>LAIlive</code>.</p>
</td></tr>
<tr><td><code id="plot.spwb_+3A_dates">dates</code></td>
<td>
<p>A Date vector with a subset of dates to be plotted.</p>
</td></tr>
<tr><td><code id="plot.spwb_+3A_subdaily">subdaily</code></td>
<td>
<p>Whether subdaily results should be shown, only for simulations using <code>transpirationMode = "Sperry"</code> and having set <code>subdailyResults = TRUE</code> in the simulation control object. If <code>subdaily = TRUE</code>, then the valid strings for <code>type</code> are listed in <code><a href="#topic+plot.spwb_day">plot.spwb_day</a></code>.</p>
</td></tr>
<tr><td><code id="plot.spwb_+3A_xlim">xlim</code></td>
<td>
<p>Range of values for x.</p>
</td></tr>
<tr><td><code id="plot.spwb_+3A_ylim">ylim</code></td>
<td>
<p>Range of values for y.</p>
</td></tr>
<tr><td><code id="plot.spwb_+3A_xlab">xlab</code></td>
<td>
<p>x-axis label.</p>
</td></tr>
<tr><td><code id="plot.spwb_+3A_ylab">ylab</code></td>
<td>
<p>y-axis label.</p>
</td></tr>
<tr><td><code id="plot.spwb_+3A_summary.freq">summary.freq</code></td>
<td>
<p>Frequency of summary statistics (see <code><a href="base.html#topic+cut.Date">cut.Date</a></code>).</p>
</td></tr>
<tr><td><code id="plot.spwb_+3A_...">...</code></td>
<td>
<p>Additional parameters for function <code>plot</code> (not used).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The following plots are currently available for <code><a href="#topic+spwb">spwb</a></code> (most of them also for <code><a href="#topic+pwb">pwb</a></code>):
</p>

<ul>
<li><p><code>"PET_Precipitation"</code>: Potential evapotranspiration and Precipitation.
</p>
</li>
<li><p><code>"PET_NetRain"</code>: Potential evapotranspiration and Net rainfall.
</p>
</li>
<li><p><code>"Snow"</code>: Snow precipitation and snowpack dynamics.
</p>
</li>
<li><p><code>"Export"</code>: Water exported through deep drainage and surface runoff.
</p>
</li>
<li><p><code>"Evapotranspiration"</code>: Plant transpiration and soil evaporation.
</p>
</li>
<li><p><code>"SoilPsi"</code>: Soil water potential.
</p>
</li>
<li><p><code>"SoilRWC"</code>: Soil relative water content (in percent of field capacity).
</p>
</li>
<li><p><code>"SoilTheta"</code>: Soil moisture water content (in percent volume).
</p>
</li>
<li><p><code>"SoilVol"</code>: Soil water volumetric content (in mm).
</p>
</li>
<li><p><code>"PlantExtraction"</code>: Water extracted by plants from each soil layer.
</p>
</li>
<li><p><code>"HydraulicRedistribution"</code>: Water added to each soil layer coming from other soil layers, transported through the plant hydraulic network.
</p>
</li>
<li><p><code>"WTD"</code>: Water table depth.
</p>
</li>
<li><p><code>"LAI"</code>: Expanded and dead leaf area index of the whole stand.
</p>
</li>
<li><p><code>"PlantLAI"</code>: Plant cohort leaf area index (expanded leaves).
</p>
</li>
<li><p><code>"PlantLAIlive"</code>: Plant cohort leaf area index (&quot;live&quot; leaves).
</p>
</li>
<li><p><code>"PlantStress"</code>: Plant cohort average daily drought stress.
</p>
</li>
<li><p><code>"PlantTranspiration"</code>: Plant cohort transpiration.
</p>
</li>
<li><p><code>"TranspirationPerLeaf"</code>: Plant cohort transpiration per leaf area.
</p>
</li>
<li><p><code>"PlantGrossPhotosynthesis"</code>: Plant cohort photosynthesis.
</p>
</li>
<li><p><code>"GrossPhotosynthesisPerLeaf"</code>: Plant cohort photosynthesis per leaf area.
</p>
</li>
<li><p><code>"StemRWC"</code>: Average daily stem relative water content.
</p>
</li>
<li><p><code>"LeafRWC"</code>: Average daily leaf relative water content.
</p>
</li>
<li><p><code>"LFMC"</code>: Live fuel moisture content.
</p>
</li></ul>

<p>The following plots are available for <code><a href="#topic+spwb">spwb</a></code> and <code><a href="#topic+pwb">pwb</a></code> <em>only if</em> <code>transpirationMode = "Granier"</code>:
</p>

<ul>
<li><p><code>"PlantPsi"</code>: Plant cohort water potential.
</p>
</li>
<li><p><code>"FPAR"</code>: Fraction of PAR at the canopy level of each plant cohort.
</p>
</li>
<li><p><code>"AbsorbedSWRFraction"</code>: Fraction of SWR absorbed by each plant cohort.
</p>
</li></ul>

<p>The following plots are available for <code><a href="#topic+spwb">spwb</a></code> and <code><a href="#topic+pwb">pwb</a></code> <em>only if</em> <code>transpirationMode = "Sperry"</code>:
</p>

<ul>
<li><p><code>"SoilPlantConductance"</code>: Average instantaneous overall soil plant conductance (calculated as the derivative of the supply function).
</p>
</li>
<li><p><code>"LeafPsiMin"</code>:  Midday leaf water potential.
</p>
</li>
<li><p><code>"LeafPsiMax"</code>:  Pre-dawn leaf water potential.
</p>
</li>
<li><p><code>"LeafPsiRange"</code>:  Range of leaf water potential.
</p>
</li>
<li><p><code>"LeafPsiMin_SL"</code>: Minimum water potential of sunlit leaves.
</p>
</li>
<li><p><code>"LeafPsiMax_SL"</code>: Maximum water potential of sunlit leaves.
</p>
</li>
<li><p><code>"LeafPsiMin_SH"</code>: Minimum water potential of shade leaves.
</p>
</li>
<li><p><code>"LeafPsiMax_SH"</code>: Maximum water potential of shade leaves.
</p>
</li>
<li><p><code>"TempMin_SL"</code>: Minimum temperature of sunlit leaves.
</p>
</li>
<li><p><code>"TempMax_SL"</code>: Maximum temperature of sunlit leaves.
</p>
</li>
<li><p><code>"TempMin_SH"</code>: Minimum temperature of shade leaves.
</p>
</li>
<li><p><code>"TempMax_SH"</code>: Maximum temperature of shade leaves.
</p>
</li>
<li><p><code>"GSWMin_SL"</code>: Minimum stomatal conductance of sunlit leaves.
</p>
</li>
<li><p><code>"GSWMax_SL"</code>: Maximum stomatal conductance of sunlit leaves.
</p>
</li>
<li><p><code>"GSWMin_SH"</code>: Minimum stomatal conductance of shade leaves.
</p>
</li>
<li><p><code>"GSWMax_SH"</code>: Maximum stomatal conductance of shade leaves.
</p>
</li>
<li><p><code>"StemPsi"</code>:  Midday (upper) stem water potential.
</p>
</li>
<li><p><code>"RootPsi"</code>:  Midday root crown water potential.
</p>
</li>
<li><p><code>"PlantNetPhotosynthesis"</code>:  Plant cohort net photosynthesis.
</p>
</li>
<li><p><code>"NetPhotosynthesisPerLeaf"</code>:  Plant cohort net photosynthesis per leaf area.
</p>
</li>
<li><p><code>"PlantWUE"</code>:  Plant cohort daily water use efficiency.
</p>
</li>
<li><p><code>"PlantAbsorbedSWR"</code>:  Plant cohort absorbed short wave radiation.
</p>
</li>
<li><p><code>"AbsorbedSWRPerLeaf"</code>:  Plant cohort absorbed short wave radiation per leaf area.
</p>
</li>
<li><p><code>"PlantNetLWR"</code>:  Plant cohort net long wave radiation.
</p>
</li>
<li><p><code>"NetLWRPerLeaf"</code>:  Plant cohort net long wave radiation per leaf area.
</p>
</li>
<li><p><code>"AirTemperature"</code>:  Minimum/maximum/mean daily temperatures above canopy.
</p>
</li>
<li><p><code>"CanopyTemperature"</code>:  Minimum/maximum/mean daily temperatures inside canopy.
</p>
</li>
<li><p><code>"SoilTemperature"</code>:  Minimum/maximum/mean daily temperatures inside the first soil layer.
</p>
</li>
<li><p><code>"CanopyEnergyBalance"</code>:  Canopy energy balance components.
</p>
</li>
<li><p><code>"SoilEnergyBalance"</code>:  Soil energy balance components.
</p>
</li></ul>

<p>In addition to the former, the following plots are available for objects <code><a href="#topic+growth">growth</a></code> or <code><a href="#topic+fordyn">fordyn</a></code>:
</p>

<ul>
<li><p><code>"CarbonBalance"</code>:  Stand-level carbon balance components.
</p>
</li>
<li><p><code>"BiomassBalance"</code>:  Stand-level biomass balance components.
</p>
</li>
<li><p><code>"GrossPhotosynthesis"</code>:  Gross photosynthesis rate per dry weight.
</p>
</li>
<li><p><code>"MaintenanceRespiration"</code>:  Maintenance respiration cost per dry weight.
</p>
</li>
<li><p><code>"PhotosynthesisMaintenanceRatio"</code>:  The ratio of gross photosynthesis over maintenance respiration.
</p>
</li>
<li><p><code>"RootExudation"</code>:  Root exudation rate per dry weight.
</p>
</li>
<li><p><code>"LabileCarbonBalance"</code>:  Labile carbon balance per dry weight.
</p>
</li>
<li><p><code>"SugarLeaf"</code>:  Sugar concentration in leaves.
</p>
</li>
<li><p><code>"StarchLeaf"</code>:  Starch concentration in leaves.
</p>
</li>
<li><p><code>"SugarSapwood"</code>:  Sugar concentration in sapwood.
</p>
</li>
<li><p><code>"StarchSapwood"</code>:  Starch concentration in sapwood.
</p>
</li>
<li><p><code>"SugarTransport"</code>:  Phloem sugar transport rate.
</p>
</li>
<li><p><code>"StructuralBiomassBalance"</code>:  Daily structural biomass balance (g dry · ind-2).
</p>
</li>
<li><p><code>"LabileBiomassBalance"</code>:  Daily labile biomass balance (g dry · ind-2).
</p>
</li>
<li><p><code>"PlantBiomassBalance"</code>:  Daily plant biomass balance, i.e. labile change + structural change (g dry · ind-2).
</p>
</li>
<li><p><code>"MortalityBiomassLoss"</code>:  Biomass loss due to mortality (g dry · m-2).    
</p>
</li>
<li><p><code>"PlantBiomassBalance"</code>:  Daily cohort biomass balance (including mortality) (g dry · m-2).
</p>
</li>
<li><p><code>"LeafBiomass"</code>: Leaf structural dry biomass per individual.
</p>
</li>
<li><p><code>"SapwoodBiomass"</code>: Sapwood dry biomass per individual.
</p>
</li>
<li><p><code>"FineRootBiomass"</code>: Fine root dry biomass per individual.
</p>
</li>
<li><p><code>"SapwoodArea"</code>:  Sapwood area per individual.
</p>
</li>
<li><p><code>"LeafArea"</code>:  Leaf area per individual.
</p>
</li>
<li><p><code>"FineRootArea"</code>: Fine root area per individual (only for <code>transpirationMode = "Sperry"</code> or <code>transpirationMode = "Cochard"</code>).
</p>
</li>
<li><p><code>"DBH"</code>: Diameter at breast height (in cm) for an average individual of each plant cohort.
</p>
</li>
<li><p><code>"Height"</code>: Height (in cm) for an average individual of each plant cohort.
</p>
</li>
<li><p><code>"SAgrowth"</code>:  Sapwood area growth rate.
</p>
</li>
<li><p><code>"LAgrowth"</code>:  Leaf area growth rate.
</p>
</li>
<li><p><code>"FRAgrowth"</code>:  Fine root area growth rate (only for <code>transpirationMode = "Sperry"</code> or <code>transpirationMode = "Cochard"</code>).
</p>
</li>
<li><p><code>"HuberValue"</code>:  Ratio of leaf area to sapwood area.
</p>
</li>
<li><p><code>"RootAreaLeafArea"</code>:  Ratio of fine root area to leaf area (only for <code>transpirationMode = "Sperry"</code> or <code>transpirationMode = "Cochard"</code>).
</p>
</li></ul>

<p>Finally, the following plots are only available for <code><a href="#topic+fordyn">fordyn</a></code> simulation results:
</p>

<ul>
<li><p><code>"StandBasalArea"</code>: Stand basal area of living trees.
</p>
</li>
<li><p><code>"StandDensity"</code>: Stand density of living trees.
</p>
</li>
<li><p><code>"SpeciesBasalArea"</code>: Basal area of living trees by species.
</p>
</li>
<li><p><code>"SpeciesDensity"</code>: Density of living trees by species.
</p>
</li>
<li><p><code>"CohortBasalArea"</code>: Basal area of living trees by plant cohort.
</p>
</li>
<li><p><code>"CohortDensity"</code>: Density of living trees by plant cohort.
</p>
</li></ul>



<h3>Value</h3>

<p>An ggplot object
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+pwb">pwb</a></code>, <code><a href="#topic+growth">growth</a></code>, <code><a href="#topic+fordyn">fordyn</a></code>, <code><a href="#topic+summary.spwb">summary.spwb</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Load example daily meteorological data
data(examplemeteo)

#Load example plot plant data
data(exampleforestMED)

#Default species parameterization
data(SpParamsMED)

#Initialize soil with default soil params (2 layers)
examplesoil = soil(defaultSoilParams(2))

#Initialize control parameters
control = defaultControl("Granier")

#Initialize input
x = forest2spwbInput(exampleforestMED,examplesoil, SpParamsMED, control)

#Call simulation function
S1&lt;-spwb(x, examplemeteo, latitude = 41.82592, elevation = 100)

#Plot results
plot(S1)

</code></pre>

<hr>
<h2 id='plot.spwb_day'>Plots simulation results for one day</h2><span id='topic+plot.spwb_day'></span><span id='topic+plot.growth_day'></span><span id='topic+plot.pwb_day'></span>

<h3>Description</h3>

<p>Functions to plot the sub-daily simulation results of <code><a href="#topic+spwb_day">spwb_day</a></code>, <code><a href="#topic+growth_day">growth_day</a></code> 
or the transpiration calculations of <code><a href="#topic+transp_transpirationSperry">transp_transpirationSperry</a></code> or <code><a href="#topic+transp_transpirationCochard">transp_transpirationCochard</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'spwb_day'
plot(
  x,
  type = "PlantTranspiration",
  bySpecies = FALSE,
  xlim = NULL,
  ylim = NULL,
  xlab = NULL,
  ylab = NULL,
  ...
)

## S3 method for class 'growth_day'
plot(
  x,
  type = "PlantTranspiration",
  bySpecies = FALSE,
  xlim = NULL,
  ylim = NULL,
  xlab = NULL,
  ylab = NULL,
  ...
)

## S3 method for class 'pwb_day'
plot(
  x,
  type = "PlantTranspiration",
  bySpecies = FALSE,
  xlim = NULL,
  ylim = NULL,
  xlab = NULL,
  ylab = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.spwb_day_+3A_x">x</code></td>
<td>
<p>An object of class <code>spwb_day</code>, <code>growth_day</code> or <code>pwb_day</code>.</p>
</td></tr>
<tr><td><code id="plot.spwb_day_+3A_type">type</code></td>
<td>
<p>The information to be plotted (see details).</p>
</td></tr>
<tr><td><code id="plot.spwb_day_+3A_byspecies">bySpecies</code></td>
<td>
<p>Allows aggregating output by species, before drawing plots. Aggregation can involve a sum (as for plant LAI or transpiration) 
or a LAI-weighted mean (as for plant stress or plant water potential).</p>
</td></tr>
<tr><td><code id="plot.spwb_day_+3A_xlim">xlim</code></td>
<td>
<p>Range of values for x.</p>
</td></tr>
<tr><td><code id="plot.spwb_day_+3A_ylim">ylim</code></td>
<td>
<p>Range of values for y.</p>
</td></tr>
<tr><td><code id="plot.spwb_day_+3A_xlab">xlab</code></td>
<td>
<p>x-axis label.</p>
</td></tr>
<tr><td><code id="plot.spwb_day_+3A_ylab">ylab</code></td>
<td>
<p>y-axis label.</p>
</td></tr>
<tr><td><code id="plot.spwb_day_+3A_...">...</code></td>
<td>
<p>Additional parameters for function <code>plot</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The following plots are available for <code>spwb_day</code> and <code>pwb_day</code>:
</p>

<ul>
<li><p><code>"LeafPsi"</code>: Leaf water potential (for shade and sunlit leaves).
</p>
</li>
<li><p><code>"LeafPsiAverage"</code>: Average leaf water potential.
</p>
</li>
<li><p><code>"RootPsi"</code>: Root crown water potential.
</p>
</li>
<li><p><code>"StemPsi"</code>: Stem water potential.
</p>
</li>
<li><p><code>"StemPLC"</code>: (Average) percentage of loss conductance in the stem conduits.
</p>
</li>
<li><p><code>"StemRWC"</code>: (Average) relative water content in the stem.
</p>
</li>
<li><p><code>"LeafRWC"</code>: Relative water content in the leaf.
</p>
</li>
<li><p><code>"StemSympRWC"</code>: (Average) relative water content in the stem symplasm.
</p>
</li>
<li><p><code>"LeafSympRWC"</code>: Relative water content in the leaf symplasm.
</p>
</li>
<li><p><code>"SoilPlantConductance"</code>: Overall soil plant conductance (calculated as the derivative of the supply function).
</p>
</li>
<li><p><code>"PlantExtraction"</code>:  Water extracted from each soil layer.
</p>
</li>
<li><p><code>"PlantTranspiration"</code>: Plant cohort transpiration per ground area.
</p>
</li>
<li><p><code>"TranspirationPerLeaf"</code>: Plant cohort transpiration per leaf area.
</p>
</li>
<li><p><code>"PlantGrossPhotosynthesis"</code>: Plant cohort gross photosynthesis per ground area.
</p>
</li>
<li><p><code>"GrossPhotosynthesisPerLeaf"</code>: Plant cohort gross photosynthesis per leaf area.
</p>
</li>
<li><p><code>"PlantNetPhotosynthesis"</code>: Plant cohort net photosynthesis per ground area.
</p>
</li>
<li><p><code>"NetPhotosynthesisPerLeaf"</code>: Plant cohort net photosynthesis per leaf area.
</p>
</li>
<li><p><code>"LeafTranspiration"</code>: Instantaneous transpiration per leaf area (differentiates sunlit and shade leaves).
</p>
</li>
<li><p><code>"LeafGrossPhotosynthesis"</code>: Instantaneous gross photosynthesis per leaf area (differentiates sunlit and shade leaves).
</p>
</li>
<li><p><code>"LeafNetPhotosynthesis"</code>: Instantaneous net photosynthesis per leaf area (differentiates sunlit and shade leaves).
</p>
</li>
<li><p><code>"LeafAbsorbedSWR"</code>: Absorbed short wave radiation per leaf area (differentiates sunlit and shade leaves).
</p>
</li>
<li><p><code>"LeafAbsorbedPAR"</code>: Absorbed photosynthetically-active radiation per leaf area (differentiates sunlit and shade leaves).
</p>
</li>
<li><p><code>"LeafNetLWR"</code>: Net long wave radiation per leaf area (differentiates sunlit and shade leaves).
</p>
</li>
<li><p><code>"LeafCi"</code>: Leaf intercellular CO2 concentration (differentiates sunlit and shade leaves).
</p>
</li>
<li><p><code>"LeafIntrinsicWUE"</code>: Leaf intrinsic water use efficiency, i.e. the ratio between instantaneous photosynthesis and stomatal conductance (differentiates sunlit and shade leaves).
</p>
</li>
<li><p><code>"LeafVPD"</code>: Leaf vapour pressure deficit (differentiates sunlit and shade leaves).
</p>
</li>
<li><p><code>"LeafStomatalConductance"</code>: Leaf stomatal conductance to water vapour (differentiates sunlit and shade leaves).
</p>
</li>
<li><p><code>"LeafTemperature"</code>: Leaf temperature (differentiates sunlit and shade leaves).
</p>
</li>
<li><p><code>"Temperature"</code>: Above-canopy, inside-canopy and soil temperature.
</p>
</li>
<li><p><code>"CanopyEnergyBalance"</code>: Canopy energy balance components.
</p>
</li>
<li><p><code>"SoilEnergyBalance"</code>: Soil energy balance components.
</p>
</li>
<li><p><code>"PlantWaterBalance"</code>: Difference between water extraction from the soil and transpired water per ground area.
</p>
</li>
<li><p><code>"WaterBalancePerLeaf"</code>: Difference between water extraction from the soil and transpired water per leaf area.
</p>
</li></ul>

<p>And the following plots are additionally available for <code>growth_day</code>:
</p>

<ul>
<li><p><code>"GrossPhotosynthesis"</code>: Gross photosynthesis rate per dry weight.
</p>
</li>
<li><p><code>"MaintenanceRespiration"</code>: Maintenance respiration cost per dry weight.
</p>
</li>
<li><p><code>"RootExudation"</code>: Root exudation rate per dry weight.
</p>
</li>
<li><p><code>"LabileCarbonBalance"</code>: Labile carbon balance per dry weight.
</p>
</li>
<li><p><code>"SugarLeaf"</code>: Sugar concentration in leaves.
</p>
</li>
<li><p><code>"StarchLeaf"</code>: Starch concentration in leaves.
</p>
</li>
<li><p><code>"SugarSapwood"</code>: Sugar concentration in sapwood.
</p>
</li>
<li><p><code>"StarchSapwood"</code>: Starch concentration in sapwood.
</p>
</li>
<li><p><code>"SugarTransport"</code>: Phloem sugar transport rate.
</p>
</li></ul>



<h3>Value</h3>

<p>An ggplot object
</p>


<h3>Note</h3>

<p>Only for soil plant water balance simulations using <code>transpirationMode = "Sperry"</code> or <code>transpirationMode = "Cochard"</code>. This function can be used to display subdaily dynamics of corresponding to single days on <code><a href="#topic+spwb">spwb</a></code> runs, if control option <code>subdailyResults</code> is set to <code>TRUE</code>. See also option <code>subdaily</code> in <code><a href="#topic+plot.spwb">plot.spwb</a></code>.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb_day">spwb_day</a></code>, <code><a href="#topic+growth_day">growth_day</a></code>, <code><a href="#topic+plot.spwb">plot.spwb</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Load example daily meteorological data
data(examplemeteo)

#Load example plot plant data
data(exampleforestMED)

#Default species parameterization
data(SpParamsMED)

#Initialize soil with default soil params (2 layers)
examplesoil &lt;- soil(defaultSoilParams(2), W=c(0.5,0.5))

#Switch to 'Sperry' transpiration mode
control &lt;- defaultControl("Sperry")

#Simulate one day only
x2 &lt;- forest2spwbInput(exampleforestMED,examplesoil, SpParamsMED, control)
d &lt;- 100
date &lt;- rownames(examplemeteo)[d]
meteovec &lt;- unlist(examplemeteo[d,])
sd2 &lt;- spwb_day(x2, date, meteovec,
              latitude = 41.82592, elevation = 100, slope= 0, aspect = 0)

#Display transpiration for subdaily steps
plot(sd2, "PlantTranspiration")

</code></pre>

<hr>
<h2 id='regeneration'>Plant regeneration</h2><span id='topic+regeneration'></span><span id='topic+regeneration_seedproduction'></span><span id='topic+regeneration_seedrefill'></span><span id='topic+regeneration_seedmortality'></span><span id='topic+regeneration_recruitment'></span><span id='topic+regeneration_resprouting'></span>

<h3>Description</h3>

<p>Functions to simulate annual plant regeneration from seed recruitment or from resprouting
</p>


<h3>Usage</h3>

<pre><code class='language-R'>regeneration_seedproduction(forest, SpParams, control)

regeneration_seedrefill(seedBank, refillSpecies, refillPercent = NULL)

regeneration_seedmortality(seedBank, SpParams, minPercent = 1)

regeneration_recruitment(
  forest,
  SpParams,
  control,
  minMonthTemp,
  moistureIndex,
  verbose = FALSE
)

regeneration_resprouting(
  forest,
  internalMortality,
  SpParams,
  control,
  management_results = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="regeneration_+3A_forest">forest</code></td>
<td>
<p>An object of class <code><a href="#topic+forest">forest</a></code>.</p>
</td></tr>
<tr><td><code id="regeneration_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (see <code><a href="#topic+SpParamsMED">SpParamsMED</a></code> and <code><a href="#topic+SpParamsDefinition">SpParamsDefinition</a></code>).</p>
</td></tr>
<tr><td><code id="regeneration_+3A_control">control</code></td>
<td>
<p>A list with default control parameters (see <code><a href="#topic+defaultControl">defaultControl</a></code>).</p>
</td></tr>
<tr><td><code id="regeneration_+3A_seedbank">seedBank</code></td>
<td>
<p>A data frame with columns 'Species' and 'Percent', describing a seed bank.</p>
</td></tr>
<tr><td><code id="regeneration_+3A_refillspecies">refillSpecies</code></td>
<td>
<p>A string vector of species names corresponding to seed rain to refill seed bank.</p>
</td></tr>
<tr><td><code id="regeneration_+3A_refillpercent">refillPercent</code></td>
<td>
<p>A numeric vector of indicating the percentage of seed bank refilling (if missing then seed bank is set to 100%).</p>
</td></tr>
<tr><td><code id="regeneration_+3A_minpercent">minPercent</code></td>
<td>
<p>A minimum percent of seed bank to retain entry in <code>seedBank</code> element of <code>forest</code>.</p>
</td></tr>
<tr><td><code id="regeneration_+3A_minmonthtemp">minMonthTemp</code></td>
<td>
<p>Minimum month temperature.</p>
</td></tr>
<tr><td><code id="regeneration_+3A_moistureindex">moistureIndex</code></td>
<td>
<p>Moisture index (annual precipitation over annual potential evapotranspiration).</p>
</td></tr>
<tr><td><code id="regeneration_+3A_verbose">verbose</code></td>
<td>
<p>Boolean flag to indicate console output during calculations.</p>
</td></tr>
<tr><td><code id="regeneration_+3A_internalmortality">internalMortality</code></td>
<td>
<p>A data frame with mortality occurred in the last year of simulation.</p>
</td></tr>
<tr><td><code id="regeneration_+3A_management_results">management_results</code></td>
<td>
<p>The result of calling a management function (see <code><a href="#topic+defaultManagementFunction">defaultManagementFunction</a></code>).</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li><p><code>regeneration_seedproduction</code> evaluates if reproductive individuals (i.e. sufficiently tall individuals) are present. 
</p>
</li>
<li><p><code>regeneration_seedrefill</code> fills seed bank of input <code>forest</code> object with seed rain.
</p>
</li>
<li><p><code>regeneration_seedmortality</code> updates seed bank of input <code>forest</code> object according to annual seed mortality.
</p>
</li>
<li><p><code>regeneration_recruitment</code> evaluates recruitment from the seed bank (or local seed production if seed bank is missing). Minimum month temperature and moisture index values are used to determine if recruitment was successful. 
Species also require a minimum amount of light at the ground level.
</p>
</li>
<li><p><code>regeneration_resprouting</code> evaluates resprouting occurs after “mortality” from die-back (including drought- or pathogen-induced dessication), 
cutting or burning of the aerial part in a species with resprouting ability, 
but not after carbon starvation or baseline mortality (unspecific mortality causes).
</p>
</li></ul>



<h3>Value</h3>


<ul>
<li><p><code>regeneration_seedproduction</code> returns a list of species names
</p>
</li>
<li><p><code>regeneration_seedrefill</code> and <code>regeneration_seedmortality</code> return a copy of the input <code>data.frame</code> object with an update seed bank. 
</p>
</li>
<li><p><code>regeneration_resprouting</code> and <code>regeneration_recruitment</code> return a new object of class <code><a href="#topic+forest">forest</a></code> with the new plant cohorts.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fordyn">fordyn</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Load example plot plant data
data(exampleforestMED)

#Default species parameterization
data(SpParamsMED)

#Initialize control parameters
control &lt;- defaultControl("Granier")
control$recruitmentMode = "deterministic" 

#Recruitment limits
plant_parameter(exampleforestMED, SpParamsMED, "MinTempRecr")
plant_parameter(exampleforestMED, SpParamsMED, "MinMoistureRecr")

#Compare seed recruitment outcomes
regeneration_recruitment(exampleforestMED, SpParamsMED, control, 0, 0.25)
regeneration_recruitment(exampleforestMED, SpParamsMED, control, 3, 0.25)

</code></pre>

<hr>
<h2 id='resetInputs'>Reset simulation inputs</h2><span id='topic+resetInputs'></span>

<h3>Description</h3>

<p>Function <code>resetInputs()</code> allows resetting state variables in <code>x</code> to their defaults.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>resetInputs(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="resetInputs_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+spwbInput">spwbInput</a></code> or <code><a href="#topic+growthInput">growthInput</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Does not return any value. Instead, it modifies input object <code>x</code>.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwbInput">spwbInput</a></code>, <code><a href="#topic+growthInput">growthInput</a></code>, <code><a href="#topic+spwb">spwb</a></code>
</p>

<hr>
<h2 id='resistances'>Soil-plant resistances</h2><span id='topic+resistances'></span>

<h3>Description</h3>

<p>Calculates and draws rhizosphere, root, stem and leaf resistances for simulation time steps
</p>


<h3>Usage</h3>

<pre><code class='language-R'>resistances(
  x,
  cohort,
  relative = FALSE,
  draw = FALSE,
  cumulative = FALSE,
  xlab = NULL,
  ylab = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="resistances_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+pwb">pwb</a></code>, <code><a href="#topic+growth">growth</a></code> or <code><a href="#topic+fordyn">fordyn</a></code>. The function only works with the result of simulations with <code>transpirationMode = "Sperry"</code>.</p>
</td></tr>
<tr><td><code id="resistances_+3A_cohort">cohort</code></td>
<td>
<p>An string indicating the cohort for which resistances are desired.</p>
</td></tr>
<tr><td><code id="resistances_+3A_relative">relative</code></td>
<td>
<p>A boolean flag to indicate that relative percentages are desired as output</p>
</td></tr>
<tr><td><code id="resistances_+3A_draw">draw</code></td>
<td>
<p>A boolean flag to indicate that a plot should be drawn.</p>
</td></tr>
<tr><td><code id="resistances_+3A_cumulative">cumulative</code></td>
<td>
<p>A flag to indicate that drawn series should be cumulative.</p>
</td></tr>
<tr><td><code id="resistances_+3A_xlab">xlab</code></td>
<td>
<p>x-axis label.</p>
</td></tr>
<tr><td><code id="resistances_+3A_ylab">ylab</code></td>
<td>
<p>y-axis label.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function makes internal calls to <code><a href="#topic+hydraulics_soilPlantResistances">hydraulics_soilPlantResistances</a></code>.
</p>


<h3>Value</h3>

<p>A data frame with dates in rows and resistance segments in columns (Rhizosphere, Root, Stem and Leaf). 
Values depend on whether <code>relative = TRUE</code> (percentages) or <code>relative = FALSE</code> (absolute resistance values). 
If <code>draw = TRUE</code> then a plot object is returned.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+waterUseEfficiency">waterUseEfficiency</a></code>, <code><a href="#topic+droughtStress">droughtStress</a></code>
</p>

<hr>
<h2 id='root'>Root functions</h2><span id='topic+root'></span><span id='topic+root_conicDistribution'></span><span id='topic+root_ldrDistribution'></span><span id='topic+root_individualRootedGroundArea'></span><span id='topic+root_specificRootSurfaceArea'></span><span id='topic+root_fineRootRadius'></span><span id='topic+root_fineRootHalfDistance'></span><span id='topic+root_fineRootAreaIndex'></span><span id='topic+root_fineRootBiomass'></span><span id='topic+root_rhizosphereMaximumConductance'></span><span id='topic+root_fineRootSoilVolume'></span><span id='topic+root_coarseRootSoilVolumeFromConductance'></span><span id='topic+root_coarseRootLengthsFromVolume'></span><span id='topic+root_coarseRootLengths'></span><span id='topic+root_coarseRootSoilVolume'></span><span id='topic+root_horizontalProportions'></span>

<h3>Description</h3>

<p>Functions to calculate properties of fine/coarse roots within the soil, given root system parameters and soil layer definition.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>root_conicDistribution(Zcone, d)

root_ldrDistribution(Z50, Z95, d)

root_individualRootedGroundArea(VolInd, V, d, rfc)

root_specificRootSurfaceArea(specificRootLength, rootTissueDensity)

root_fineRootRadius(specificRootLength, rootTissueDensity)

root_fineRootHalfDistance(rootLengthDensity)

root_fineRootAreaIndex(
  Ksoil,
  krhizo,
  lai,
  specificRootLength,
  rootTissueDensity,
  rootLengthDensity
)

root_fineRootBiomass(
  Ksoil,
  krhizo,
  lai,
  N,
  specificRootLength,
  rootTissueDensity,
  rootLengthDensity
)

root_rhizosphereMaximumConductance(
  Ksoil,
  fineRootBiomass,
  lai,
  N,
  specificRootLength,
  rootTissueDensity,
  rootLengthDensity
)

root_fineRootSoilVolume(fineRootBiomass, specificRootLength, rootLengthDensity)

root_coarseRootSoilVolumeFromConductance(
  Kmax_rootxylem,
  VCroot_kmax,
  Al2As,
  v,
  d,
  rfc
)

root_coarseRootLengthsFromVolume(VolInd, v, d, rfc)

root_coarseRootLengths(v, d, depthWidthRatio = 1)

root_coarseRootSoilVolume(v, d, depthWidthRatio = 1)

root_horizontalProportions(poolProportions, VolInd, N, V, d, rfc)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="root_+3A_zcone">Zcone</code></td>
<td>
<p>A vector of depths (in mm) corresponding to the root cone tip.</p>
</td></tr>
<tr><td><code id="root_+3A_d">d</code></td>
<td>
<p>The width (in mm) corresponding to each soil layer.</p>
</td></tr>
<tr><td><code id="root_+3A_z50">Z50</code></td>
<td>
<p>A vector of depths (in mm) corresponding to 50% of roots.</p>
</td></tr>
<tr><td><code id="root_+3A_z95">Z95</code></td>
<td>
<p>A vector of depths (in mm) corresponding to 95% of roots.</p>
</td></tr>
<tr><td><code id="root_+3A_volind">VolInd</code></td>
<td>
<p>Volume of soil (in m3) occupied by coarse roots per individual.</p>
</td></tr>
<tr><td><code id="root_+3A_v">V</code></td>
<td>
<p>Matrix of proportions of fine roots (cohorts x soil layers).</p>
</td></tr>
<tr><td><code id="root_+3A_rfc">rfc</code></td>
<td>
<p>Percentage of rock fragment content (volume basis) for each layer.</p>
</td></tr>
<tr><td><code id="root_+3A_specificrootlength">specificRootLength</code></td>
<td>
<p>Specific fine root length (length of fine roots over weight).</p>
</td></tr>
<tr><td><code id="root_+3A_roottissuedensity">rootTissueDensity</code></td>
<td>
<p>Fine root tissue density (weight over volume at turgidity).</p>
</td></tr>
<tr><td><code id="root_+3A_rootlengthdensity">rootLengthDensity</code></td>
<td>
<p>Fine root length density (length of fine roots over soil volume; cm/cm3)</p>
</td></tr>
<tr><td><code id="root_+3A_ksoil">Ksoil</code></td>
<td>
<p>Soil saturated conductivity (mmol·m-1·s-1·MPa-1).</p>
</td></tr>
<tr><td><code id="root_+3A_krhizo">krhizo</code></td>
<td>
<p>Rhizosphere maximum conductance per leaf area (mmol·m-2·s-1·MPa-1).</p>
</td></tr>
<tr><td><code id="root_+3A_lai">lai</code></td>
<td>
<p>Leaf area index.</p>
</td></tr>
<tr><td><code id="root_+3A_n">N</code></td>
<td>
<p>Density of individuals per hectare.</p>
</td></tr>
<tr><td><code id="root_+3A_finerootbiomass">fineRootBiomass</code></td>
<td>
<p>Biomass of fine roots (g).</p>
</td></tr>
<tr><td><code id="root_+3A_kmax_rootxylem">Kmax_rootxylem</code></td>
<td>
<p>Sapwood-specific hydraulic conductivity of root xylem (in kg H2O·s-1·m-1·MPa-1).</p>
</td></tr>
<tr><td><code id="root_+3A_vcroot_kmax">VCroot_kmax</code></td>
<td>
<p>Root xylem maximum conductance per leaf area (mmol·m-2·s-1·MPa-1).</p>
</td></tr>
<tr><td><code id="root_+3A_al2as">Al2As</code></td>
<td>
<p>Leaf area to sapwood area ratio (in m2·m-2).</p>
</td></tr>
<tr><td><code id="root_+3A_v">v</code></td>
<td>
<p>Vector of proportions of fine roots in each soil layer.</p>
</td></tr>
<tr><td><code id="root_+3A_depthwidthratio">depthWidthRatio</code></td>
<td>
<p>Ratio between radius of the soil layer with the largest radius and maximum rooting depth.</p>
</td></tr>
<tr><td><code id="root_+3A_poolproportions">poolProportions</code></td>
<td>
<p>Division of the stand area among plant cohorts (proportions).</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li><p><code>root_conicDistribution()</code> assumes a (vertical) conic distribution of fine roots, whereas <code>root_ldrDistribution()</code> distributes fine roots according to the linear dose response model of Schenck &amp; Jackson (2002). Return a matrix of fine root proportions in each layer with as many rows as elements in <code>Z</code> (or <code>Z50</code>) and as many columns as soil layers.
</p>
</li>
<li><p><code>root_coarseRootLengths()</code> and <code>root_coarseRootLengthsFromVolume()</code> estimate the length of coarse roots (mm) for each soil layer, including axial and radial lengths.
</p>
</li>
<li><p><code>root_coarseRootSoilVolume</code> estimates the soil volume (m3) occupied by coarse roots of an individual.
</p>
</li>
<li><p><code>root_coarseRootSoilVolumeFromConductance</code> estimates the soil volume (m3) occupied by coarse roots of an individual from root xylem conductance.
</p>
</li>
<li><p><code>root_fineRootHalfDistance()</code> calculates the half distance (cm) between neighbouring fine roots.
</p>
</li>
<li><p><code>root_fineRootRadius()</code> calculates the radius of fine roots (cm).
</p>
</li>
<li><p><code>root_fineRootAreaIndex()</code> estimates the fine root area index for a given soil conductivity and maximum rhizosphere conductance.
</p>
</li>
<li><p><code>root_fineRootBiomass()</code> estimates the biomass of fine roots (g dry/individual) for a given soil conductivity and maximum rhizosphere conductance.
</p>
</li>
<li><p><code>root_rhizosphereMaximumConductance()</code> is the inverse of the preceeding function, i.e. it estimates rhizosphere conductance from soil conductivity and fine root biomass.
</p>
</li>
<li><p><code>root_fineRootSoilVolume()</code> calculates the soil volume (m3) occupied with fine roots.
</p>
</li>
<li><p><code>root_specificRootSurfaceArea()</code> returns the specific fine root area (cm2/g).
</p>
</li>
<li><p><code>root_individualRootedGroundArea()</code> calculates the area (m2) covered by roots of an individual, for each soil layer.
</p>
</li>
<li><p><code>root_horizontalProportions()</code> calculates the (horizontal) proportion of roots of each cohort in the water pool corresponding to itself and that of other cohorts, for each soil layer. Returns a list (with as many elements as cohorts) with each element being a matrix.
</p>
</li></ul>



<h3>Value</h3>

<p>See details.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>Schenk, H., Jackson, R., 2002. The global biogeography of roots. Ecol. Monogr. 72, 311–328.
</p>
<p>Sperry, J. S., Y. Wang, B. T. Wolfe, D. S. Mackay, W. R. L. Anderegg, N. G. Mcdowell, and W. T. Pockman. 2016. Pragmatic hydraulic theory predicts stomatal responses to climatic water deficits. New Phytologist 212, 577–589.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb">spwb</a></code>,  <code><a href="#topic+forest2spwbInput">forest2spwbInput</a></code>, <code><a href="#topic+soil">soil</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Load example plot plant data
data(exampleforestMED)

#Default species parameterization
data(SpParamsMED)

ntree = nrow(exampleforestMED$treeData)

#Initialize soil with default soil params
S = soil(defaultSoilParams())

#Calculate conic root system for trees
V1 = root_conicDistribution(Z=rep(2000,ntree), S$dVec)            
print(V1)
     
#Calculate LDR root system for trees (Schenck &amp; Jackson 2002)
V2 = root_ldrDistribution(Z50 = rep(200,ntree), 
                          Z95 = rep(1000,ntree), S$dVec)
print(V2)     

</code></pre>

<hr>
<h2 id='SFM_metric'>
Standard fuel models (Albini 1976, Scott &amp; Burgan 2005)
</h2><span id='topic+SFM_metric'></span>

<h3>Description</h3>

<p>Standard fuel models converted to metric system. Copied from package 'Rothermel' (Giorgio Vacchiano, Davide Ascoli).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("SFM_metric")</code></pre>


<h3>Format</h3>

<p>A data frame including standard fuel models as in Albini (1976) and Scott and Burgan (2005), to be used as input of <code><a href="#topic+fire_Rothermel">fire_Rothermel</a></code> function. All values converted to metric format.
</p>

<dl>
<dt><code>Fuel_Model_Type</code></dt><dd><p>A factor with levels <code>D</code> (for dynamic) or <code>S</code> (for static).</p>
</dd>
<dt><code>Load_1h</code></dt><dd><p>Loading of 1h fuel class [t/ha].</p>
</dd>
<dt><code>Load_10h</code></dt><dd><p>Loading of 10h fuel class [t/ha].</p>
</dd>
<dt><code>Load_100h</code></dt><dd><p>Loading of 100h fuel class [t/ha]</p>
</dd>
<dt><code>Load_Live_Herb</code></dt><dd><p>Loading of herbaceous fuels [t/ha]</p>
</dd>
<dt><code>Load_Live_Woody</code></dt><dd><p>Loading of woody fuels [t/ha]</p>
</dd>
<dt>&lsquo;<span class="samp">&#8288;SA/V_1h&#8288;</span>&rsquo;</dt><dd><p>Surface area to volume ratio of 1h fuel class [m2/m3]</p>
</dd>
<dt>&lsquo;<span class="samp">&#8288;SA/V_10h&#8288;</span>&rsquo;</dt><dd><p>Surface area to volume ratio of 10h fuel class [m2/m3]</p>
</dd>
<dt>&lsquo;<span class="samp">&#8288;SA/V_100h&#8288;</span>&rsquo;</dt><dd><p>Surface area to volume ratio of 100h fuel class [m2/m3]</p>
</dd>
<dt>&lsquo;<span class="samp">&#8288;SA/V_Live_Herb&#8288;</span>&rsquo;</dt><dd><p>Surface area to volume ratio of herbaceous fuels [m2/m3]</p>
</dd>
<dt>&lsquo;<span class="samp">&#8288;SA/V_Live_Woody&#8288;</span>&rsquo;</dt><dd><p>Surface area to volume ratio of woody fuels [m2/m3]</p>
</dd>
<dt><code>Fuel_Bed_Depth</code></dt><dd><p>Fuel bed depth [cm]</p>
</dd>
<dt><code>Mx_dead</code></dt><dd><p>Dead fuel moisture of extinction [percent]</p>
</dd>
<dt><code>Heat_1h</code></dt><dd><p>Heat content of 1h fuel class [kJ/kg]</p>
</dd>
<dt><code>Heat_10h</code></dt><dd><p>Heat content of 10h fuel class [kJ/kg]</p>
</dd>
<dt><code>Heat_100h</code></dt><dd><p>Heat content of 100h fuel class [kJ/kg]</p>
</dd>
<dt><code>Heat_Live_Herb</code></dt><dd><p>Heat content of herbaceous fuels [kJ/kg]</p>
</dd>
<dt><code>Heat_Live_Woody</code></dt><dd><p>Heat content of woody fuels [kJ/kg]</p>
</dd>
</dl>



<h3>Source</h3>

<p>Albini, F. A. (1976). Computer-based models of wildland fire behavior: A users' manual. Ogden, UT: US Department of Agriculture, Forest Service, Intermountain Forest and Range Experiment Station.
</p>
<p>Scott, J., and Burgan, R. E. (2005). A new set of standard fire behavior fuel models for use with Rothermel's surface fire spread model. Gen. Tech. Rep. RMRSGTR-153. Fort Collins, CO: US Department of Agriculture, Forest Service, Rocky Mountain Research Station.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fire_Rothermel">fire_Rothermel</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(SFM_metric)
</code></pre>

<hr>
<h2 id='shinyplot'>Shiny app with interactive plots</h2><span id='topic+shinyplot'></span><span id='topic+shinyplot.growth'></span><span id='topic+shinyplot.spwb'></span><span id='topic+shinyplot.pwb'></span><span id='topic+shinyplot.fordyn'></span><span id='topic+shinyplot.growth_day'></span><span id='topic+shinyplot.spwb_day'></span><span id='topic+shinyplot.pwb_day'></span>

<h3>Description</h3>

<p>Creates a shiny app with interactive plots for simulation results and evaluation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>shinyplot(x, ...)

## S3 method for class 'growth'
shinyplot(x, measuredData = NULL, ...)

## S3 method for class 'spwb'
shinyplot(x, measuredData = NULL, ...)

## S3 method for class 'pwb'
shinyplot(x, measuredData = NULL, ...)

## S3 method for class 'fordyn'
shinyplot(x, measuredData = NULL, ...)

## S3 method for class 'growth_day'
shinyplot(x, ...)

## S3 method for class 'spwb_day'
shinyplot(x, ...)

## S3 method for class 'pwb_day'
shinyplot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="shinyplot_+3A_x">x</code></td>
<td>
<p>An object of the right class.</p>
</td></tr>
<tr><td><code id="shinyplot_+3A_...">...</code></td>
<td>
<p>Additional parameters.</p>
</td></tr>
<tr><td><code id="shinyplot_+3A_measureddata">measuredData</code></td>
<td>
<p>A data frame with observed/measured values (see <code><a href="#topic+evaluation_plot">evaluation_plot</a></code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Only run this function in interactive mode. When <code>measuredData</code> is not <code>NULL</code>, an additional panel is shown for evaluation plots.
</p>


<h3>Value</h3>

<p>An object that represents the shiny app
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.spwb">plot.spwb</a></code>, <code><a href="#topic+evaluation_plot">evaluation_plot</a></code>
</p>

<hr>
<h2 id='soil'>Soil initialization</h2><span id='topic+soil'></span><span id='topic+print.soil'></span>

<h3>Description</h3>

<p>Initializes soil parameters and state variables for its use in simulations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>soil(SoilParams, VG_PTF = "Toth", W = as.numeric(c(1)), SWE = 0)

## S3 method for class 'soil'
print(x, model = "SX", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="soil_+3A_soilparams">SoilParams</code></td>
<td>
<p>A data frame of soil parameters (see an example in <code><a href="#topic+defaultSoilParams">defaultSoilParams</a></code>).</p>
</td></tr>
<tr><td><code id="soil_+3A_vg_ptf">VG_PTF</code></td>
<td>
<p>Pedotransfer functions to obtain parameters for the van Genuchten-Mualem equations. Either <code>"Carsel"</code> (Carsel and Parrish 1988) or <code>"Toth"</code> (Toth et al. 2015).</p>
</td></tr>
<tr><td><code id="soil_+3A_w">W</code></td>
<td>
<p>A numerical vector with the initial relative water content of each soil layer.</p>
</td></tr>
<tr><td><code id="soil_+3A_swe">SWE</code></td>
<td>
<p>Initial snow water equivalent of the snow pack on the soil surface (mm).</p>
</td></tr>
<tr><td><code id="soil_+3A_x">x</code></td>
<td>
<p>An object of class <code>soil</code>.</p>
</td></tr>
<tr><td><code id="soil_+3A_model">model</code></td>
<td>
<p>Either 'SX' or 'VG' for Saxton or Van Genuchten pedotransfer models.</p>
</td></tr>
<tr><td><code id="soil_+3A_...">...</code></td>
<td>
<p>Additional parameters to <code>print</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function <code>print</code> prompts a description of soil characteristics and state variables (water content and temperature) 
according to a water retention curve (either Saxton's or Van Genuchten's). 
Volume at field capacity is calculated assuming a soil water potential equal to -0.033 MPa. 
Parameter <code>Temp</code> is initialized as missing for all soil layers.
</p>


<h3>Value</h3>

<p>Function <code>soil</code> returns a list of class <code>soil</code> with the following elements:
</p>

<ul>
<li><p><code>SoilDepth</code>: Soil depth (in mm).
</p>
</li>
<li><p><code>W</code>: State variable with relative water content of each layer (in as proportion relative to FC).
</p>
</li>
<li><p><code>Temp</code>: State variable with temperature (in ºC) of each layer.
</p>
</li>
<li><p><code>Ksoil</code>: Kappa parameter for bare soil evaporation.
</p>
</li>
<li><p><code>Gsoil</code>: Gamma parameter for bare soil evaporation (see <code><a href="#topic+hydrology_soilEvaporationAmount">hydrology_soilEvaporationAmount</a></code>).
</p>
</li>
<li><p><code>dVec</code>: Width of soil layers (in mm).
</p>
</li>
<li><p><code>sand</code>: Sand percentage for each layer (in percent volume).
</p>
</li>
<li><p><code>clay</code>: Clay percentage for each layer (in percent volume).
</p>
</li>
<li><p><code>om</code>: Organic matter percentage for each layer (in percent volume).
</p>
</li>
<li><p><code>VG_alpha</code>, <code>VG_n</code>, <code>VG_theta_res</code>, <code>VG_theta_sat</code>: Parameters for van Genuchten's pedotransfer functions, for each layer, corresponding to the USDA texture type.
</p>
</li>
<li><p><code>Ksat</code>: Saturated soil conductivity for each layer (estimated using function <code><a href="#topic+soil_saturatedConductivitySX">soil_saturatedConductivitySX</a></code>.
</p>
</li>
<li><p><code>macro</code>: Macroporosity for each layer (estimated using Stolf et al. 2011).
</p>
</li>
<li><p><code>rfc</code>: Percentage of rock fragment content for each layer.
</p>
</li>
<li><p><code>Kdrain</code>: Saturated vertical hydraulic conductivity (mm/day) (i.e. how easy is deep drainage towards groundwater). Function <code>soil</code> estimates it as a function of soil saturated hydraulic conductivity, but should be parametrized as a function of bedrock material. 
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>Carsel, R.F., and Parrish, R.S. 1988. Developing joint probability distributions of soil water retention characteristics. Water Resources Research 24: 755–769.
</p>
<p>Tóth, B., Weynants, M., Nemes, A., Makó, A., Bilas, G., and Tóth, G. 2015. New generation of hydraulic pedotransfer functions for Europe. European Journal of Soil Science 66: 226–238.
</p>
<p>Stolf, R., Thurler, A., Oliveira, O., Bacchi, S., Reichardt, K., 2011. Method to estimate soil macroporosity and microporosity based on sand content and bulk density. Rev. Bras. Ciencias do Solo 35, 447–459.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+soil_psi2thetaSX">soil_psi2thetaSX</a></code>, <code><a href="#topic+soil_psi2thetaVG">soil_psi2thetaVG</a></code>, <code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+defaultSoilParams">defaultSoilParams</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Initializes soil
s = soil(defaultSoilParams())

# Prints soil characteristics according to Saxton's water retention curve
print(s, model="SX")

# Prints soil characteristics according to Van Genuchten's water retention curve
print(s, model="VG")

</code></pre>

<hr>
<h2 id='soil_texture'>Soil texture and hydraulics</h2><span id='topic+soil_texture'></span><span id='topic+soil_saturatedConductivitySX'></span><span id='topic+soil_unsaturatedConductivitySX'></span><span id='topic+soil_thetaSATSX'></span><span id='topic+soil_theta2psiSX'></span><span id='topic+soil_psi2thetaSX'></span><span id='topic+soil_psi2thetaVG'></span><span id='topic+soil_theta2psiVG'></span><span id='topic+soil_USDAType'></span><span id='topic+soil_thetaFC'></span><span id='topic+soil_thetaWP'></span><span id='topic+soil_thetaSAT'></span><span id='topic+soil_waterFC'></span><span id='topic+soil_waterSAT'></span><span id='topic+soil_waterWP'></span><span id='topic+soil_waterExtractable'></span><span id='topic+soil_theta'></span><span id='topic+soil_water'></span><span id='topic+soil_rockWeight2Volume'></span><span id='topic+soil_psi'></span><span id='topic+soil_conductivity'></span><span id='topic+soil_waterTableDepth'></span><span id='topic+soil_vanGenuchtenParamsCarsel'></span><span id='topic+soil_vanGenuchtenParamsToth'></span><span id='topic+soil_retentionCurvePlot'></span>

<h3>Description</h3>

<p>Low-level functions relating soil texture with soil hydraulics and soil water content.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>soil_saturatedConductivitySX(clay, sand, om = NA_real_, mmol = TRUE)

soil_unsaturatedConductivitySX(theta, clay, sand, om = NA_real_, mmol = TRUE)

soil_thetaSATSX(clay, sand, om = NA_real_)

soil_theta2psiSX(clay, sand, theta, om = NA_real_)

soil_psi2thetaSX(clay, sand, psi, om = NA_real_)

soil_psi2thetaVG(n, alpha, theta_res, theta_sat, psi)

soil_theta2psiVG(n, alpha, theta_res, theta_sat, theta)

soil_USDAType(clay, sand)

soil_thetaFC(soil, model = "SX")

soil_thetaWP(soil, model = "SX")

soil_thetaSAT(soil, model = "SX")

soil_waterFC(soil, model = "SX")

soil_waterSAT(soil, model = "SX")

soil_waterWP(soil, model = "SX")

soil_waterExtractable(soil, model = "SX", minPsi = -5)

soil_theta(soil, model = "SX")

soil_water(soil, model = "SX")

soil_rockWeight2Volume(pWeight, bulkDensity, rockDensity = 2.3)

soil_psi(soil, model = "SX")

soil_conductivity(soil)

soil_waterTableDepth(soil, model = "SX")

soil_vanGenuchtenParamsCarsel(soilType)

soil_vanGenuchtenParamsToth(clay, sand, om, bd, topsoil)

soil_retentionCurvePlot(
  soil,
  model = "SX",
  layer = 1,
  psi = seq(0, -6, by = -0.01),
  relative = TRUE,
  to = "SAT"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="soil_texture_+3A_clay">clay</code></td>
<td>
<p>Percentage of clay (in percent weight).</p>
</td></tr>
<tr><td><code id="soil_texture_+3A_sand">sand</code></td>
<td>
<p>Percentage of sand (in percent weight).</p>
</td></tr>
<tr><td><code id="soil_texture_+3A_om">om</code></td>
<td>
<p>Percentage of organic matter (optional, in percent weight).</p>
</td></tr>
<tr><td><code id="soil_texture_+3A_mmol">mmol</code></td>
<td>
<p>Boolean flag to indicate that saturated conductivity units should be returned in mmol/m/s/MPa. If <code>mmol = FALSE</code> then units are cm/day.</p>
</td></tr>
<tr><td><code id="soil_texture_+3A_theta">theta</code></td>
<td>
<p>Relative water content (in percent volume).</p>
</td></tr>
<tr><td><code id="soil_texture_+3A_psi">psi</code></td>
<td>
<p>Water potential (in MPa).</p>
</td></tr>
<tr><td><code id="soil_texture_+3A_n">n</code>, <code id="soil_texture_+3A_alpha">alpha</code>, <code id="soil_texture_+3A_theta_res">theta_res</code>, <code id="soil_texture_+3A_theta_sat">theta_sat</code></td>
<td>
<p>Parameters of the Van Genuchten-Mualem model (m = 1 - 1/n).</p>
</td></tr>
<tr><td><code id="soil_texture_+3A_soil">soil</code></td>
<td>
<p>Soil object (returned by function <code><a href="#topic+soil">soil</a></code>).</p>
</td></tr>
<tr><td><code id="soil_texture_+3A_model">model</code></td>
<td>
<p>Either 'SX' or 'VG' for Saxton's or Van Genuchten's water retention models; or 'both' to plot both retention models.</p>
</td></tr>
<tr><td><code id="soil_texture_+3A_minpsi">minPsi</code></td>
<td>
<p>Minimum water potential (in MPa) to calculate the amount of extractable water.</p>
</td></tr>
<tr><td><code id="soil_texture_+3A_pweight">pWeight</code></td>
<td>
<p>Percentage of corresponding to rocks, in weight.</p>
</td></tr>
<tr><td><code id="soil_texture_+3A_bulkdensity">bulkDensity</code></td>
<td>
<p>Bulk density of the soil fraction (g/cm3).</p>
</td></tr>
<tr><td><code id="soil_texture_+3A_rockdensity">rockDensity</code></td>
<td>
<p>Rock density (g/cm3).</p>
</td></tr>
<tr><td><code id="soil_texture_+3A_soiltype">soilType</code></td>
<td>
<p>A string indicating the soil type.</p>
</td></tr>
<tr><td><code id="soil_texture_+3A_bd">bd</code></td>
<td>
<p>Bulk density (in g/cm3).</p>
</td></tr>
<tr><td><code id="soil_texture_+3A_topsoil">topsoil</code></td>
<td>
<p>A boolean flag to indicate topsoil layer.</p>
</td></tr>
<tr><td><code id="soil_texture_+3A_layer">layer</code></td>
<td>
<p>Soil layer to be plotted.</p>
</td></tr>
<tr><td><code id="soil_texture_+3A_relative">relative</code></td>
<td>
<p>Boolean flag to indicate that retention curve should be relative to field capacity or saturation.</p>
</td></tr>
<tr><td><code id="soil_texture_+3A_to">to</code></td>
<td>
<p>Either 'SAT' (saturation) or 'FC' (field capacity).</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li><p><code>soil_psi2thetaSX()</code> and <code>soil_theta2psiSX()</code> calculate water potentials (MPa) and water contents (theta) using texture data the formulae of Saxton et al. (1986) or Saxton &amp; Rawls (2006) depending on whether organic matter is available.
</p>
</li>
<li><p><code>soil_psi2thetaVG()</code> and <code>soil_theta2psiVG()</code> to the same calculations as before, but using the Van Genuchten - Mualem equations (Wösten &amp; van Genuchten 1988). 
</p>
</li>
<li><p><code>soil_saturatedConductivitySX()</code> returns the saturated conductivity of the soil (in cm/day or mmol/m/s/MPa), estimated from formulae of Saxton et al. (1986) or Saxton &amp; Rawls (2006) depending on whether organic matter is available.
</p>
</li>
<li><p><code>soil_unsaturatedConductivitySX()</code> returns the unsaturated conductivity of the soil (in cm/day or mmol/m/s/MPa), estimated from formulae of Saxton et al. (1986) or Saxton &amp; Rawls (2006) depending on whether organic matter is available.
</p>
</li>
<li><p><code>soil_USDAType()</code> returns the USDA type (a string) for a given texture.
</p>
</li>
<li><p><code>soil_vanGenuchtenParamsCarsel()</code> gives parameters for van Genuchten-Mualem equations (alpha, n, theta_res and theta_sat, where alpha is in MPa-1) for a given texture type (Leij et al. 1996) 
</p>
</li>
<li><p><code>soil_vanGenuchtenParamsToth()</code> gives parameters for van Genuchten-Mualem equations (alpha, n, theta_res and theta_sat, where alpha is in MPa-1) for a given texture, organic matter and bulk density (Toth et al. 2015).
</p>
</li>
<li><p><code>soil_psi()</code> returns the water potential (MPa) of each soil layer, according to its water retention model.
</p>
</li>
<li><p><code>soil_theta()</code> returns the moisture content (as percent of soil volume) of each soil layer, according to its water retention model.
</p>
</li>
<li><p><code>soil_water()</code> returns the water volume (mm) of each soil layer, according to its water retention model.
</p>
</li>
<li><p><code>soil_conductivity()</code> returns the conductivity of each soil layer (mmol/m/s/MPa), according the Saxton model.
</p>
</li>
<li><p><code>soil_waterExtractable()</code> returns the water volume (mm) extractable from the soil according to its water retention curves and up to a given soil water potential.
</p>
</li>
<li><p><code>soil_waterFC()</code> and <code>soil_thetaFC()</code> calculate the water volume (in mm) and moisture content (as percent of soil volume) of each soil layer at field capacity, respectively.
</p>
</li>
<li><p><code>soil_waterWP()</code> and <code>soil_thetaWP()</code> calculate the water volume (in mm) and moisture content (as percent of soil volume) of each soil layer at wilting point (-1.5 MPa), respectively. 
</p>
</li>
<li><p><code>soil_waterSAT()</code>, <code>soil_thetaSATSX()</code> and <code>soil_thetaSAT()</code> calculate the saturated water volume (in mm) and moisture content (as percent of soil volume) of each soil layer.
</p>
</li>
<li><p><code>soil_waterTableDepth()</code> returns water table depth in mm from surface.
</p>
</li>
<li><p><code>soil_rockWeight2Volume()</code> transforms rock percentage from weight to volume basis.
</p>
</li>
<li><p><code>soil_retentionCurvePlot()</code> allows ploting the water retention curve of a given soil layer.
</p>
</li></ul>



<h3>Value</h3>

<p>Depends on the function (see details).
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>Leij, F.J., Alves, W.J., Genuchten, M.T. Van, Williams, J.R., 1996. The UNSODA Unsaturated Soil Hydraulic Database User’s Manual Version 1.0.
</p>
<p>Saxton, K.E., Rawls, W.J., Romberger, J.S., Papendick, R.I., 1986. Estimating generalized soil-water characteristics from texture. Soil Sci. Soc. Am. J. 50, 1031–1036.
</p>
<p>Saxton, K.E., Rawls, W.J., 2006. Soil water characteristic estimates by texture and organic matter for hydrologic solutions. Soil Sci. Soc. Am. J. 70, 1569. doi:10.2136/sssaj2005.0117
</p>
<p>Wösten, J.H.M., &amp; van Genuchten, M.T. 1988. Using texture and other soil properties to predict the unsaturated soil hydraulic functions. Soil Science Society of America Journal 52: 1762–1770.
</p>
<p>Tóth, B., Weynants, M., Nemes, A., Makó, A., Bilas, G., and Tóth, G. 2015. New generation of hydraulic pedotransfer functions for Europe. European Journal of Soil Science 66: 226–238.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+soil">soil</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Determine USDA soil texture type
type = soil_USDAType(clay=40, sand=10)
type

#Van Genuchten's params (bulk density = 1.3 g/cm)
vg = soil_vanGenuchtenParamsToth(40,10,1,1.3,TRUE)
vg

# Initialize soil object with default params
s = soil(defaultSoilParams())

# Plot Saxton's and Van Genuchten's water retention curves
soil_retentionCurvePlot(s, model="both")

</code></pre>

<hr>
<h2 id='soil_thermodynamics'>Soil thermodynamic functions</h2><span id='topic+soil_thermodynamics'></span><span id='topic+soil_thermalCapacity'></span><span id='topic+soil_thermalConductivity'></span><span id='topic+soil_temperatureGradient'></span><span id='topic+soil_temperatureChange'></span>

<h3>Description</h3>

<p>Functions <code>soil_thermalConductivity</code> and <code>soil_thermalCapacity</code> calculate thermal conductivity and thermal capacity 
for each soil layer, given its texture and water content. Functions <code>soil_temperatureGradient</code> and <code>soil_temperatureChange</code> 
are used to calculate soil temperature gradients (in ºC/m) and temporal temperature change (in ºC/s) 
given soil layer texture and water content (and possibly including heat flux from above).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>soil_thermalCapacity(soil, model = "SX")

soil_thermalConductivity(soil, model = "SX")

soil_temperatureGradient(dVec, Temp)

soil_temperatureChange(dVec, Temp, sand, clay, W, Theta_FC, Gdown)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="soil_thermodynamics_+3A_soil">soil</code></td>
<td>
<p>Soil object (returned by function <code><a href="#topic+soil">soil</a></code>).</p>
</td></tr>
<tr><td><code id="soil_thermodynamics_+3A_model">model</code></td>
<td>
<p>Either 'SX' or 'VG' for Saxton's or Van Genuchten's pedotransfer models.</p>
</td></tr>
<tr><td><code id="soil_thermodynamics_+3A_dvec">dVec</code></td>
<td>
<p>Width of soil layers (in mm).</p>
</td></tr>
<tr><td><code id="soil_thermodynamics_+3A_temp">Temp</code></td>
<td>
<p>Temperature (in ºC) for each soil layer.</p>
</td></tr>
<tr><td><code id="soil_thermodynamics_+3A_sand">sand</code></td>
<td>
<p>Percentage of sand (in percent weight) for each layer.</p>
</td></tr>
<tr><td><code id="soil_thermodynamics_+3A_clay">clay</code></td>
<td>
<p>Percentage of clay (in percent weight) for each layer.</p>
</td></tr>
<tr><td><code id="soil_thermodynamics_+3A_w">W</code></td>
<td>
<p>Soil moisture (in percent of field capacity) for each layer.</p>
</td></tr>
<tr><td><code id="soil_thermodynamics_+3A_theta_fc">Theta_FC</code></td>
<td>
<p>Relative water content (in percent volume) at field capacity for each layer.</p>
</td></tr>
<tr><td><code id="soil_thermodynamics_+3A_gdown">Gdown</code></td>
<td>
<p>Downward heat flux from canopy to soil (in W·m-2).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Function <code>soil_thermalConductivity</code> returns a vector with values of thermal conductivity (W/m/ºK) for each soil layer. 
</p>
<p>Function <code>soil_thermalCapacity</code> returns a vector with values of heat storage capacity (J/m3/ºK) for each soil layer. 
</p>
<p>Function <code>soil_temperatureGradient</code> returns a vector with values of temperature gradient between consecutive soil layers. 
</p>
<p>Function <code>soil_temperatureChange</code> returns a vector with values of instantaneous temperature change (ºC/s) for each soil layer.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>Cox, P.M., Betts, R.A., Bunton, C.B., Essery, R.L.H., Rowntree, P.R., and Smith, J. 1999. The impact of new land surface physics on the GCM simulation of climate and climate sensitivity. Climate Dynamics 15: 183–203.
</p>
<p>Dharssi, I., Vidale, P.L., Verhoef, A., MacPherson, B., Jones, C., and Best, M. 2009. New soil physical properties implemented in the Unified Model at PS18. 9–12.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+soil">soil</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>examplesoil = soil(defaultSoilParams())
soil_thermalConductivity(examplesoil)
soil_thermalCapacity(examplesoil)

#Values change when altering water content (drier layers have lower conductivity and capacity)
examplesoil$W = c(0.1, 0.4, 0.7, 1.0)
soil_thermalConductivity(examplesoil)
soil_thermalCapacity(examplesoil)

</code></pre>

<hr>
<h2 id='species_values'>Species description functions</h2><span id='topic+species_values'></span><span id='topic+species_basalArea'></span><span id='topic+species_cover'></span><span id='topic+species_density'></span><span id='topic+species_foliarBiomass'></span><span id='topic+species_fuelLoading'></span><span id='topic+species_LAI'></span><span id='topic+species_characterParameter'></span><span id='topic+species_parameter'></span>

<h3>Description</h3>

<p>Functions to calculate attributes of a <code><a href="#topic+forest">forest</a></code> object by species or to extract species parameters from a species parameter table (<code><a href="#topic+SpParamsMED">SpParamsMED</a></code>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>species_basalArea(x, SpParams)

species_cover(x, SpParams)

species_density(x, SpParams)

species_foliarBiomass(x, SpParams, gdd = NA_real_)

species_fuelLoading(x, SpParams, gdd = NA_real_, includeDead = TRUE)

species_LAI(x, SpParams, gdd = NA_real_, bounded = TRUE)

species_characterParameter(species, SpParams, parName)

species_parameter(species, SpParams, parName, fillMissing = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="species_values_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+forest">forest</a></code>.</p>
</td></tr>
<tr><td><code id="species_values_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (see <code><a href="#topic+SpParamsMED">SpParamsMED</a></code>).</p>
</td></tr>
<tr><td><code id="species_values_+3A_gdd">gdd</code></td>
<td>
<p>Growth degree days (to account for leaf phenology effects).</p>
</td></tr>
<tr><td><code id="species_values_+3A_includedead">includeDead</code></td>
<td>
<p>A flag to indicate that standing dead fuels (dead branches) are included.</p>
</td></tr>
<tr><td><code id="species_values_+3A_bounded">bounded</code></td>
<td>
<p>A boolean flag to indicate that extreme values should be prevented (maximum tree LAI = 7 and maximum shrub LAI = 3)</p>
</td></tr>
<tr><td><code id="species_values_+3A_species">species</code></td>
<td>
<p>A character vector of species names.</p>
</td></tr>
<tr><td><code id="species_values_+3A_parname">parName</code></td>
<td>
<p>A string with a parameter name.</p>
</td></tr>
<tr><td><code id="species_values_+3A_fillmissing">fillMissing</code></td>
<td>
<p>A boolean flag to try imputation on missing values.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector with values for each species in <code>SpParams</code>:
</p>

<ul>
<li><p><code>species_basalArea</code>: Species basal area (m2/ha).
</p>
</li>
<li><p><code>species_cover</code>: Shrub cover (in percent).
</p>
</li>
<li><p><code>species_density</code>: Plant density (ind/ha). Tree density is directly taken from the forest object, while the shrub density is estimated from cover and height by calculating the area of a single individual.
</p>
</li>
<li><p><code>species_foliarBiomass</code>: Standing biomass of leaves (in kg/m2).
</p>
</li>
<li><p><code>species_fuel</code>: Fine fuel load (in kg/m2).
</p>
</li>
<li><p><code>species_LAI</code>: Leaf area index (m2/m2).
</p>
</li>
<li><p><code>species_phytovolume</code>: Shrub phytovolume (m3/m2).
</p>
</li>
<li><p><code>species_parameter</code>: A numeric vector with the parameter values of each input species.
</p>
</li>
<li><p><code>species_characterParameter</code>: A character vector with the parameter values of each input species.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+forest">forest</a></code>, <code><a href="#topic+plant_basalArea">plant_basalArea</a></code>, <code><a href="#topic+summary.forest">summary.forest</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Default species parameterization
data(SpParamsMED)

# Load example plot
data(exampleforestMED)

# Species basal area in the forest plot
species_basalArea(exampleforestMED, SpParamsMED)
  
# Value of parameter "Psi_Extract" for two species
species_parameter(c("Pinus halepensis", "Quercus ilex"), SpParamsMED, "Psi_Extract")
    
</code></pre>

<hr>
<h2 id='SpParams'>
Data tables with species parameter definition and values for Mediterranean and US
</h2><span id='topic+SpParams'></span><span id='topic+SpParamsDefinition'></span><span id='topic+SpParamsMED'></span>

<h3>Description</h3>

<p>A data sets of species parameter definition and values, the latter resulting from existing databases, fit to empirical data or expert-based guesses.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("SpParamsDefinition")
data("SpParamsMED")
</code></pre>


<h3>Format</h3>

<p>Data frame <code>SpParamsDefinition</code> has parameters in rows and columns 'ParameterName', 'ParameterGroup', 'Definition', 'Type' and 'Units'. Data frame <code>SpParamsMED</code> has species or genus as rows and column names equal to parameter names in <code>SpParamsDefinition</code>.
</p>


<h3>Details</h3>

<p>Plant trait parameter sources are listed in the bibliography section. Details of the procedures used to obtain the species parameter tables can be found in the article 'Species parameterization for Spain' at https://emf-creaf.github.io/medfate/. 
</p>


<h3>Source</h3>

<p>Asse, D., Randin, C. F., Bonhomme, M., Delestrade, A., and Chuine, I. (2020). Process-based models outcompete correlative models in projecting spring phenology of trees in a future warmer climate. Agricultural and Forest Meteorology, 285–286(January), 107931. https://doi.org/10.1016/j.agrformet.2020.107931
</p>
<p>Bartlett, Megan K, Christine Scoffoni, and Lawren Sack. 2012. The determinants of leaf turgor loss point and prediction of drought tolerance of species and biomes: a global meta-analysis. Ecology Letters 15 (5): 393–405. https://doi.org/10.1111/j.1461-0248.2012.01751.x. 
</p>
<p>Choat, Brendan, Steven Jansen, Tim J Brodribb, Hervé Cochard, Sylvain Delzon, Radika Bhaskar, Sandra J Bucci, et al. 2012. Global convergence in the vulnerability of forests to drought. Nature 491 (7426): 752–55. https://doi.org/10.1038/nature11688.
</p>
<p>De Cáceres M, Casals P, Gabriel E, Castro X (2019) Scaling-up individual-level allometric equations to predict stand-level fuel loading in Mediterranean shrublands. Ann For Sci 76:87 (doi:10.1007/s13595-019-0873-4).
</p>
<p>Delpierre, N., Dufrêne, E., Soudani, K., Ulrich, E., Cecchini, S., Boé, J., &amp; François, C. (2009). Modelling interannual and spatial variability of leaf senescence for three deciduous tree species in France. Agricultural and Forest Meteorology, 149(6–7), 938–948. https://doi.org/10.1016/j.agrformet.2008.11.014
</p>
<p>DGCN (2005). Tercer Inventario Forestal Nacional (1997-2007): Catalunya. Dirección General de Conservación de la Naturaleza, Ministerio de Medio Ambiente, Madrid.
</p>
<p>Duursma, Remko A., Christopher J. Blackman, Rosana López, Nicolas K. Martin-StPaul, Hervé Cochard, and Belinda E. Medlyn. 2018. On the minimum leaf conductance: its role in models of plant water use, and ecological and environmental controls. New Phytologist, no. September. https://doi.org/10.1111/nph.15395.
</p>
<p>Hoshika, Yasutomo, Yutaka Osada, Alessandra de Marco, Josep Peñuelas, and Elena Paoletti. 2018. Global diurnal and nocturnal parameters of stomatal conductance in woody plants and major crops. Global Ecology and Biogeography 27 (2): 257–75. https://doi.org/10.1111/geb.12681.
</p>
<p>Kattge, J., S. Díaz, S. Lavorel, I. C. Prentice, P. Leadley, G. Bonisch, E. Garnier, et al. 2011. TRY - a global database of plant traits. Global Change Biology 17 (9): 2905–35. https://doi.org/10.1111/j.1365-2486.2011.02451.x.
</p>
<p>Manzoni, Stefano, Giulia Vico, Amilcare Porporato, and Gabriel Katul. 2013. Biological constraints on water transport in the soil-plant-atmosphere system. Advances in Water Resources 51: 292–304. https://doi.org/10.1016/j.advwatres.2012.03.016.
</p>
<p>Martin-StPaul, Nicolas, Sylvain Delzon, and Hervé Cochard. 2017. Plant resistance to drought depends on timely stomatal closure. Ecology Letters 20 (11): 1437–47. https://doi.org/10.1111/ele.12851.
</p>
<p>Mencuccini, Maurizio, Teresa Rosas, Lucy Rowland, Brendan Choat, Hans Cornelissen, Steven Jansen, Koen Kramer, et al. 2019. Leaf economics and plant hydraulics drive leaf : wood area ratios. New Phytologist. https://doi.org/10.1111/nph.15998.
</p>
<p>Pausas, Juli G., R. Brandon Pratt, Jon E. Keeley, Anna L. Jacobsen, Aaron R. Ramirez, Alberto Vilagrosa, Susana Paula, Iolana N. Kaneakua-Pia, and Stephen D. Davis. 2016. Towards understanding resprouting at the global scale. New Phytologist 209 (3): 945–54. https://doi.org/10.1111/nph.13644.
</p>
<p>Sanchez-Martínez, Pablo, Jordi Martínez-Vilalta, Kyle G. Dexter, Ricardo A. Segovia, and Maurizio Mencuccini. 2020. Adaptation and coordinated evolution of plant hydraulic traits. Ecology Letters, August, ele.13584. https://doi.org/10.1111/ele.13584.
</p>
<p>Tavşanoǧlu, Çaǧatay, and Juli G. Pausas. 2018. A functional trait database for Mediterranean Basin plants. Scientific Data 5: 1–18. https://doi.org/10.1038/sdata.2018.135.
</p>
<p>Vitasse, Y., François, C., Delpierre, N., Dufrêne, E., Kremer, A., Chuine, I., and Delzon, S. (2011). Assessing the effects of climate change on the phenology of European temperate trees. Agricultural and Forest Meteorology, 151(7), 969–980. https://doi.org/10.1016/j.agrformet.2011.03.003
</p>
<p>Yebra, Marta, Gianluca Scortechini, Abdulbaset Badi, Maria Eugenia Beget, Matthias M. Boer, Ross Bradstock, Emilio Chuvieco, et al. 2019. Globe-LFMC, a global plant water status database for vegetation ecophysiology and wildfire applications. Scientific Data 6 (1): 155. https://doi.org/10.1038/s41597-019-0164-9.
</p>
<p>Zanne, A. E., G. Lopez-Gonzalez, D. A. Coomes, J. Ilic, S. Jansen, S. L. Lewis, R. B. Miller, N. G. Swenson, M. C. Wiemann, and J. Chave. 2009. Global wood density database. http://datadryad.org/handle/10255/dryad.235. 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb">spwb</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>data(SpParamsMED)
</code></pre>

<hr>
<h2 id='spwb'>Soil-plant water balance</h2><span id='topic+spwb'></span><span id='topic+pwb'></span>

<h3>Description</h3>

<p>Function <code>spwb()</code> is a water balance model that determines changes in soil moisture, 
soil water potentials, plant transpiration and drought stress at daily steps for a given forest stand 
during a period specified in the input climatic data. Function <code>pwb()</code> performs plant water balance 
only (i.e. soil moisture dynamics is an input) at daily steps for a given forest stand 
during a period specified in the input climatic data. On both simulation functions plant transpiration 
and photosynthesis processes are conducted with different level of detail depending on the transpiration mode.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spwb(
  x,
  meteo,
  latitude,
  elevation = NA_real_,
  slope = NA_real_,
  aspect = NA_real_,
  CO2ByYear = numeric(0)
)

pwb(
  x,
  meteo,
  W,
  latitude,
  elevation = NA_real_,
  slope = NA_real_,
  aspect = NA_real_,
  canopyEvaporation = numeric(0),
  snowMelt = numeric(0),
  soilEvaporation = numeric(0),
  herbTranspiration = numeric(0),
  CO2ByYear = numeric(0)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="spwb_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+spwbInput">spwbInput</a></code>.</p>
</td></tr>
<tr><td><code id="spwb_+3A_meteo">meteo</code></td>
<td>
<p>A data frame with daily meteorological data series. 
Row names of the data frame should correspond to date strings with format &quot;yyyy-mm-dd&quot; (see <code><a href="base.html#topic+Date">Date</a></code>). Alternatively,
a column <code>dates</code> can contain <code><a href="base.html#topic+Date">Date</a></code> or <code><a href="base.html#topic+POSIXct">POSIXct</a></code> classes.
The following columns are required and cannot have missing values:
</p>

<ul>
<li><p><code>MinTemperature</code>: Minimum temperature (in degrees Celsius).
</p>
</li>
<li><p><code>MaxTemperature</code>: Maximum temperature (in degrees Celsius).
</p>
</li>
<li><p><code>Precipitation</code>: Precipitation (in mm).
</p>
</li></ul>

<p>The following columns are required but can contain missing values (NOTE: missing values will raise warnings):
</p>

<ul>
<li><p><code>MinRelativeHumidity</code>: Minimum relative humidity (in percent).
</p>
</li>
<li><p><code>MaxRelativeHumidity</code>: Maximum relative humidity (in percent).
</p>
</li>
<li><p><code>Radiation</code>: Solar radiation (in MJ/m2/day).
</p>
</li></ul>

<p>The following columns are optional:
</p>

<ul>
<li><p><code>WindSpeed</code>: Above-canopy wind speed (in m/s). This column may not exist, or can be left with <code>NA</code> values. In both cases simulations will assume a constant value specified in <code><a href="#topic+defaultControl">defaultControl</a></code>.
</p>
</li>
<li><p><code>CO2</code>: Atmospheric (above-canopy) CO2 concentration (in ppm). This column may not exist, or can be left with <code>NA</code> values. In both cases simulations will assume a constant value specified in <code><a href="#topic+defaultControl">defaultControl</a></code>.
</p>
</li>
<li><p><code>Patm</code>: Atmospheric pressure (in kPa). This column may not exist, or can be left with <code>NA</code> values. In both cases, a value is estimated from elevation.
</p>
</li></ul>
</td></tr>
<tr><td><code id="spwb_+3A_latitude">latitude</code></td>
<td>
<p>Latitude (in degrees).</p>
</td></tr>
<tr><td><code id="spwb_+3A_elevation">elevation</code>, <code id="spwb_+3A_slope">slope</code>, <code id="spwb_+3A_aspect">aspect</code></td>
<td>
<p>Elevation above sea level (in m), slope (in degrees) and aspect (in degrees from North).</p>
</td></tr>
<tr><td><code id="spwb_+3A_co2byyear">CO2ByYear</code></td>
<td>
<p>A named numeric vector with years as names and atmospheric CO2 concentration (in ppm) as values. Used to specify annual changes in CO2 concentration along the simulation (as an alternative to specifying daily values in <code>meteo</code>).</p>
</td></tr>
<tr><td><code id="spwb_+3A_w">W</code></td>
<td>
<p>A matrix with the same number of rows as <code>meteo</code> and as many columns as soil layers, containing the soil moisture of each layer as proportion of field capacity.</p>
</td></tr>
<tr><td><code id="spwb_+3A_canopyevaporation">canopyEvaporation</code></td>
<td>
<p>A vector of daily canopy evaporation (from interception) values (mm). The length should match the number of rows in <code>meteo</code>.</p>
</td></tr>
<tr><td><code id="spwb_+3A_snowmelt">snowMelt</code></td>
<td>
<p>A vector of daily snow melt values (mm). The length should match the number of rows in <code>meteo</code>.</p>
</td></tr>
<tr><td><code id="spwb_+3A_soilevaporation">soilEvaporation</code></td>
<td>
<p>A vector of daily bare soil evaporation values (mm). The length should match the number of rows in <code>meteo</code>.</p>
</td></tr>
<tr><td><code id="spwb_+3A_herbtranspiration">herbTranspiration</code></td>
<td>
<p>A vector of daily herbaceous transpiration values (mm). The length should match the number of rows in <code>meteo</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The simulation functions allow using three different sub-models of transpiration and photosynthesis:
</p>

<ul>
<li><p>The sub-model corresponding to 'Granier' transpiration mode is illustrated by function <code><a href="#topic+transp_transpirationGranier">transp_transpirationGranier</a></code> and was described in De Caceres et al. (2015),
and implements an approach originally described in Granier et al. (1999). 
</p>
</li>
<li><p>The sub-model corresponding to 'Sperry' transpiration mode is illustrated by function <code><a href="#topic+transp_transpirationSperry">transp_transpirationSperry</a></code> and was described in De Caceres et al. (2021), and
implements a modelling approach originally described in Sperry et al. (2017).  
</p>
</li>
<li><p>The sub-model corresponding to 'Cochard' transpiration mode is illustrated by function <code><a href="#topic+transp_transpirationCochard">transp_transpirationCochard</a></code> and was described for model SurEau-Ecos v2.0 in Ruffault et al. (2022). 
</p>
</li></ul>

<p>Simulations using the 'Sperry' or 'Cochard' transpiration mode are computationally much more expensive than 'Granier'.
</p>


<h3>Value</h3>

<p>Function <code>spwb</code> returns a list of class 'spwb' whereas function <code>pwb</code> returns a list of class 'pwb'. 
There are many elements in common in these lists, so they are listed here together:
</p>

<ul>
<li><p><code>"latitude"</code>: Latitude (in degrees) given as input. 
</p>
</li>
<li><p><code>"topography"</code>: Vector with elevation, slope and aspect given as input. 
</p>
</li>
<li><p><code>"weather"</code>: A copy of the input weather data frame.
</p>
</li>
<li><p><code>"spwbInput"</code>: An copy of the object <code>x</code> of class <code><a href="#topic+spwbInput">spwbInput</a></code> given as input.
</p>
</li>
<li><p><code>"spwbOutput"</code>: An copy of the final state of the object <code>x</code> of class <code><a href="#topic+spwbInput">spwbInput</a></code>.
</p>
</li>
<li><p><code>"WaterBalance"</code>: A data frame where different variables (in columns) are given for each simulated day (in rows):
</p>

<ul>
<li><p><code>"PET"</code>: Potential evapotranspiration (in mm).
</p>
</li>
<li><p><code>"Precipitation"</code>: Input precipitation (in mm).
</p>
</li>
<li><p><code>"Rain"</code>: Precipitation as rain (in mm).
</p>
</li>
<li><p><code>"Snow"</code>: Precipitation as snow (in mm).
</p>
</li>
<li><p><code>"NetRain"</code>: Net rain, after accounting for interception (in mm).
</p>
</li>
<li><p><code>"Infiltration"</code>: The amount of water infiltrating into the soil (in mm).
</p>
</li>
<li><p><code>"Runoff"</code>: The amount of water exported via surface runoff (in mm).
</p>
</li>
<li><p><code>"DeepDrainage"</code>: The amount of water exported via deep drainage (in mm).
</p>
</li>
<li><p><code>"Evapotranspiration"</code>: Evapotranspiration (in mm).
</p>
</li>
<li><p><code>"SoilEvaporation"</code>: Bare soil evaporation (in mm).
</p>
</li>
<li><p><code>"HerbTranspiration"</code>: Transpiration due to the herbaceous layer (in mm).
</p>
</li>
<li><p><code>"PlantExtraction"</code>: Amount of water extracted from soil by woody plants (in mm).
</p>
</li>
<li><p><code>"Transpiration"</code>: Woody plant transpiration (in mm).
</p>
</li>
<li><p><code>"HydraulicRedistribution"</code>: Water redistributed among soil layers, transported through the plant hydraulic network.
</p>
</li></ul>

</li>
<li><p><code>"EnergyBalance"</code>: A data frame with the daily values of energy balance components for the soil and the canopy (only for <code>transpirationMode = "Sperry"</code> or <code>transpirationMode = "Cochard"</code>).
</p>
</li>
<li><p><code>"Temperature"</code>: A data frame with the daily values of minimum/mean/maximum temperatures for the atmosphere (input), canopy and soil (only for <code>transpirationMode = "Sperry"</code> or <code>transpirationMode = "Cochard"</code>).
</p>
</li>
<li><p><code>"Soil"</code>: A data frame where different variables (in columns) are given for each simulated day (in rows):
</p>

<ul>
<li><p><code>"W.1"</code>, <code>...</code>, <code>"W.k"</code>: Relative soil moisture content (relative to field capacity) in each soil layer.
</p>
</li>
<li><p><code>"ML.1"</code>, <code>...</code>, <code>"ML.k"</code>: Soil water volume in each soil layer (in L/m2).
</p>
</li>
<li><p><code>"MLTot"</code>: Total soil water volume (in L/m2).
</p>
</li>
<li><p><code>"SWE"</code>: Snow water equivalent (mm) of the snow pack.
</p>
</li>
<li><p><code>"PlantExt.1"</code>, <code>...</code>, <code>"PlantExt.k"</code>: Plant extraction from each soil layer (in mm).
</p>
</li>
<li><p><code>"HydraulicInput.1"</code>, <code>...</code>, <code>"HydraulicInput.k"</code>: Water that entered the layer coming from other layers and transported via the plant hydraulic network (in mm).
</p>
</li>
<li><p><code>"psi.1"</code>, <code>...</code>, <code>"psi.k"</code>: Soil water potential in each soil layer (in MPa).
</p>
</li></ul>

</li>
<li><p><code>"Stand"</code>: A data frame where different variables (in columns) are given for each simulated day (in rows):
</p>

<ul>
<li><p><code>"LAI"</code>: LAI of the stand (including the herbaceous layer and live + dead leaves of woody plants) (in m2/m2).
</p>
</li>
<li><p><code>"LAIherb"</code>: LAI of the herbaceous layer (in m2/m2).
</p>
</li>
<li><p><code>"LAIlive"</code>: LAI of the woody plants assuming all leaves are unfolded (in m2/m2).
</p>
</li>
<li><p><code>"LAIexpanded"</code>: LAI of the woody plants with leaves actually unfolded (in m2/m2).
</p>
</li>
<li><p><code>"LAIdead"</code>: LAI of the woody plants corresponding to dead leaves (in m2/m2).
</p>
</li>
<li><p><code>"Cm"</code>: Water retention capacity of the canopy (in mm) (accounting for leaf phenology).
</p>
</li>
<li><p><code>"LgroundPAR"</code>: The percentage of PAR that reaches the ground (accounting for leaf phenology).
</p>
</li>
<li><p><code>"LgroundSWR"</code>: The percentage of SWR that reaches the ground (accounting for leaf phenology).
</p>
</li></ul>

</li>
<li><p><code>"Plants"</code>: A list of daily results for plant cohorts (see below).
</p>
</li>
<li><p><code>"subdaily"</code>: A list of objects of class <code><a href="#topic+spwb_day">spwb_day</a></code>, one per day simulated (only if required in <code>control</code> parameters, see <code><a href="#topic+defaultControl">defaultControl</a></code>).
</p>
</li></ul>

<p>When <code>transpirationMode = "Granier"</code>, element <code>"Plants"</code> is a list with the following subelements:
</p>

<ul>
<li><p><code>"LAI"</code>: A data frame with the daily leaf area index for each plant cohort.
</p>
</li>
<li><p><code>"LAIlive"</code>: A data frame with the daily leaf area index for each plant cohort, assuming all leaves are unfolded (in m2/m2).
</p>
</li>
<li><p><code>"FPAR"</code>: A data frame with the fraction of PAR at the canopy level of each plant cohort. 
</p>
</li>
<li><p><code>"AbsorbedSWRFraction"</code>: A data frame with the fraction of SWR absorbed by each plant cohort. 
</p>
</li>
<li><p><code>"Transpiration"</code>: A data frame with the amount of daily transpiration (in mm) for each plant cohort.
</p>
</li>
<li><p><code>"GrossPhotosynthesis"</code>: A data frame with the amount of daily gross photosynthesis (in g C·m-2) for each plant cohort. 
</p>
</li>
<li><p><code>"PlantPsi"</code>: A data frame with the average daily water potential of each plant (in MPa).
</p>
</li>
<li><p><code>"StemPLC"</code>: A data frame with the average daily proportion of stem conductance loss of each plant ([0-1]).
</p>
</li>
<li><p><code>"PlantWaterBalance"</code>: A data frame with the daily balance between transpiration and soil water extraction for each plant cohort. 
</p>
</li>
<li><p><code>"LeafRWC"</code>: A data frame with the average daily leaf relative water content of each plant (in percent).
</p>
</li>
<li><p><code>"StemRWC"</code>: A data frame with the average daily stem relative water content of each plant (in percent). 
</p>
</li>
<li><p><code>"LFMC"</code>: A data frame with the daily live fuel moisture content (in percent of dry weight).
</p>
</li>
<li><p><code>"PlantStress"</code>: A data frame with the amount of daily stress [0-1] suffered by each plant cohort (relative whole-plant conductance).
</p>
</li></ul>

<p>If <code>transpirationMode="Sperry"</code> or <code>transpirationMode="Cochard"</code>, element <code>"Plants"</code> is a list with the following subelements:
</p>

<ul>
<li><p><code>"LAI"</code>: A data frame with the daily leaf area index for each plant cohort.
</p>
</li>
<li><p><code>"AbsorbedSWR"</code>: A data frame with the daily SWR absorbed by each plant cohort.
</p>
</li>
<li><p><code>"NetLWR"</code>: A data frame with the daily net LWR by each plant cohort.
</p>
</li>
<li><p><code>"Transpiration"</code>: A data frame with the amount of daily transpiration (in mm) for each plant cohorts.
</p>
</li>
<li><p><code>"GrossPhotosynthesis"</code>: A data frame with the amount of daily gross photosynthesis (in g C·m-2) for each plant cohort. 
</p>
</li>
<li><p><code>"NetPhotosynthesis"</code>: A data frame with the amount of daily net photosynthesis (in g C·m-2) for each plant cohort. 
</p>
</li>
<li><p><code>"dEdP"</code>: A data frame with mean daily values of soil-plant conductance (derivative of the supply function) for each plant cohort.
</p>
</li>
<li><p><code>"PlantWaterBalance"</code>: A data frame with the daily balance between transpiration and soil water extraction for each plant cohort. 
</p>
</li>
<li><p><code>"SunlitLeaves"</code> and <code>"ShadeLeaves"</code>: A list with daily results for sunlit and shade leaves:
</p>

<ul>
<li><p><code>"PsiMin"</code>: A data frame with the minimum (midday) daily sunlit or shade leaf water potential (in MPa). 
</p>
</li>
<li><p><code>"PsiMax"</code>: A data frame with the maximum (predawn) daily sunlit or shade leaf water potential (in MPa). 
</p>
</li></ul>


</li>
<li><p><code>"LeafPsiMin"</code>: A data frame with the minimum (midday) daily (average) leaf water potential of each plant (in MPa).
</p>
</li>
<li><p><code>"LeafPsiMax"</code>: A data frame with the maximum (predawn) daily (average) leaf water potential of each plant (in MPa).
</p>
</li>
<li><p><code>"LeafRWC"</code>: A data frame with the average daily leaf relative water content of each plant (in percent).
</p>
</li>
<li><p><code>"StemRWC"</code>: A data frame with the average daily stem relative water content of each plant (in percent). 
</p>
</li>
<li><p><code>"LFMC"</code>: A data frame with the daily live fuel moisture content (in percent of dry weight).
</p>
</li>
<li><p><code>"StemPsi"</code>: A data frame with the minimum daily stem water potential of each plant (in MPa). 
</p>
</li>
<li><p><code>"StemPLC"</code>: A data frame with the average daily proportion of stem conductance loss of each plant ([0-1]).
</p>
</li>
<li><p><code>"RootPsi"</code>: A data frame with the minimum daily root water potential of each plant (in MPa). 
</p>
</li>
<li><p><code>"RhizoPsi"</code>: A list of data frames (one per plant cohort) with the minimum daily root water potential of each plant (in MPa).
</p>
</li>
<li><p><code>"PlantStress"</code>: A data frame with the amount of daily stress [0-1] suffered by each plant cohort (relative whole-plant conductance).
</p>
</li></ul>



<h3>Author(s)</h3>


<ul>
<li><p>Miquel De Cáceres Ainsa, CREAF
</p>
</li>
<li><p>Nicolas Martin-StPaul, URFM-INRAE
</p>
</li></ul>



<h3>References</h3>

<p>De Cáceres M, Martínez-Vilalta J, Coll L, Llorens P, Casals P, Poyatos R, Pausas JG, Brotons L. (2015) Coupling a water balance model with forest inventory data to predict drought stress: the role of forest structural changes vs. climate changes. Agricultural and Forest Meteorology 213: 77-90 (doi:10.1016/j.agrformet.2015.06.012).
</p>
<p>De Cáceres M, Mencuccini M, Martin-StPaul N, Limousin JM, Coll L, Poyatos R, Cabon A, Granda V, Forner A, Valladares F, Martínez-Vilalta J (2021) Unravelling the effect of species mixing on water use and drought stress in holm oak forests: a modelling approach. Agricultural and Forest Meteorology 296 (doi:10.1016/j.agrformet.2020.108233).
</p>
<p>Granier A, Bréda N, Biron P, Villette S (1999) A lumped water balance model to evaluate duration and intensity of drought constraints in forest stands. Ecol Modell 116:269–283. https://doi.org/10.1016/S0304-3800(98)00205-1.
</p>
<p>Ruffault J, Pimont F, Cochard H, Dupuy JL, Martin-StPaul N (2022) 
SurEau-Ecos v2.0: a trait-based plant hydraulics model for simulations of plant water status and drought-induced mortality at the ecosystem level.
Geoscientific Model Development 15, 5593-5626 (doi:10.5194/gmd-15-5593-2022).
</p>
<p>Sperry, J. S., M. D. Venturas, W. R. L. Anderegg, M. Mencuccini, D. S. Mackay, Y. Wang, and D. M. Love. 2017. Predicting stomatal responses to the environment from the optimization of photosynthetic gain and hydraulic cost. Plant Cell and Environment 40, 816-830 (doi: 10.1111/pce.12852).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwbInput">spwbInput</a></code>, <code><a href="#topic+spwb_day">spwb_day</a></code>, <code><a href="#topic+plot.spwb">plot.spwb</a></code>, 
<code><a href="#topic+forest">forest</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Load example daily meteorological data
data(examplemeteo)

#Load example plot plant data
data(exampleforestMED)

#Default species parameterization
data(SpParamsMED)

#Initialize soil with default soil params (4 layers)
examplesoil &lt;- soil(defaultSoilParams(4))

#Initialize control parameters
control &lt;- defaultControl("Granier")

#Initialize input
x1 &lt;- forest2spwbInput(exampleforestMED,examplesoil, SpParamsMED, control)

#Call simulation function
S1 &lt;- spwb(x1, examplemeteo, latitude = 41.82592, elevation = 100)

#Plot results
plot(S1)

#Monthly summary (averages) of soil water balance
summary(S1, freq="months",FUN=mean, output="Soil")
                  

#Switch to 'Sperry' transpiration mode
control &lt;- defaultControl("Sperry")

#Initialize input
x2 &lt;- forest2spwbInput(exampleforestMED,examplesoil, SpParamsMED, control)

#Call simulation function
S2 &lt;- spwb(x2, examplemeteo, latitude = 41.82592, elevation = 100)

#Switch to 'Cochard' transpiration mode
control &lt;- defaultControl("Cochard")

#Initialize input
x3 &lt;- forest2spwbInput(exampleforestMED,examplesoil, SpParamsMED, control)

#Call simulation function
S3 &lt;- spwb(x3, examplemeteo, latitude = 41.82592, elevation = 100)

                
</code></pre>

<hr>
<h2 id='stand_basalArea'>Stand values</h2><span id='topic+stand_basalArea'></span><span id='topic+stand_foliarBiomass'></span><span id='topic+stand_fuelLoading'></span><span id='topic+stand_LAI'></span><span id='topic+stand_values'></span><span id='topic+stand_dominantTreeDiameter'></span><span id='topic+stand_dominantTreeHeight'></span><span id='topic+stand_hartBeckingIndex'></span><span id='topic+stand_quadraticMeanTreeDiameter'></span><span id='topic+stand_dominantTreeSpecies'></span>

<h3>Description</h3>

<p>Functions to calculate stand attributes of a <code><a href="#topic+forest">forest</a></code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stand_basalArea(x, minDBH = 7.5)

stand_foliarBiomass(x, SpParams, gdd = NA_real_)

stand_fuelLoading(x, SpParams, gdd = NA_real_, includeDead = TRUE)

stand_LAI(x, SpParams, gdd = NA_real_, bounded = TRUE)

stand_dominantTreeDiameter(x, minDBH = 7.5)

stand_dominantTreeHeight(x, minDBH = 7.5)

stand_hartBeckingIndex(x, minDBH = 7.5)

stand_quadraticMeanTreeDiameter(x, minDBH = 7.5)

stand_dominantTreeSpecies(x, SpParams)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stand_basalArea_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+forest">forest</a></code>.</p>
</td></tr>
<tr><td><code id="stand_basalArea_+3A_mindbh">minDBH</code></td>
<td>
<p>Minimum diameter at breast height (in cm) to include in estimation.</p>
</td></tr>
<tr><td><code id="stand_basalArea_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (see <code><a href="#topic+SpParamsMED">SpParamsMED</a></code>).</p>
</td></tr>
<tr><td><code id="stand_basalArea_+3A_gdd">gdd</code></td>
<td>
<p>Growth degree days (to account for leaf phenology effects).</p>
</td></tr>
<tr><td><code id="stand_basalArea_+3A_includedead">includeDead</code></td>
<td>
<p>A flag to indicate that standing dead fuels (dead branches) are included.</p>
</td></tr>
<tr><td><code id="stand_basalArea_+3A_bounded">bounded</code></td>
<td>
<p>A boolean flag to indicate that extreme values should be prevented (maximum tree LAI = 7 and maximum shrub LAI = 3)</p>
</td></tr>
</table>


<h3>Value</h3>


<ul>
<li><p><code>stand_basalArea</code>: Stand basal area (m2/ha).
</p>
</li>
<li><p><code>stand_dominantTreeDiameter</code>: Dominant tree diameter, i.e the average diameter of the 100 widest trees (in cm).
</p>
</li>
<li><p><code>stand_quadraticMeanTreeDiameter</code>: Quadratic mean tree diameter, i.e. the diameter value corresponding to the current basal area and density.
</p>
</li>
<li><p><code>stand_dominantTreeHeight</code>: Dominant tree height, i.e the average height of the 100 tallest trees (in cm).
</p>
</li>
<li><p><code>stand_hartBeckingIndex</code>: Hart-Becking index.
</p>
</li>
<li><p><code>stand_foliarBiomass</code>: Standing biomass of leaves (in kg/m2).
</p>
</li>
<li><p><code>stand_fuel</code>: Stand fine fuel load (in kg/m2).
</p>
</li>
<li><p><code>stand_LAI</code>: Stand leaf area index (m2/m2).
</p>
</li>
<li><p><code>stand_phytovolume</code>: Stand shrub phytovolume (m3/m2).
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+forest">forest</a></code>, <code><a href="#topic+plant_basalArea">plant_basalArea</a></code>, <code><a href="#topic+summary.forest">summary.forest</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Default species parameterization
data(SpParamsMED)
  
#Load example plot
data(exampleforestMED)
    
#A short way to obtain total basal area
stand_basalArea(exampleforestMED)
    
</code></pre>

<hr>
<h2 id='summary.spwb'>Summarize simulation results</h2><span id='topic+summary.spwb'></span><span id='topic+summary.pwb'></span><span id='topic+summary.growth'></span><span id='topic+summary.fordyn'></span>

<h3>Description</h3>

<p>Function <code>summary</code> summarizes the model's output in different temporal steps (i.e. weekly, annual, ...).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'spwb'
summary(
  object,
  freq = "years",
  output = "WaterBalance",
  FUN = sum,
  bySpecies = FALSE,
  months = NULL,
  ...
)

## S3 method for class 'pwb'
summary(
  object,
  freq = "years",
  output = "WaterBalance",
  FUN = sum,
  bySpecies = FALSE,
  months = NULL,
  ...
)

## S3 method for class 'growth'
summary(
  object,
  freq = "years",
  output = "WaterBalance",
  FUN = sum,
  bySpecies = FALSE,
  months = NULL,
  ...
)

## S3 method for class 'fordyn'
summary(
  object,
  freq = "years",
  output = "WaterBalance",
  FUN = sum,
  bySpecies = FALSE,
  months = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.spwb_+3A_object">object</code></td>
<td>
<p>An object of class <code>spwb</code>, <code>pwb</code>, <code>growth</code> or <code>fordyn</code>.</p>
</td></tr>
<tr><td><code id="summary.spwb_+3A_freq">freq</code></td>
<td>
<p>Frequency of summary statistics (see <code><a href="base.html#topic+cut.Date">cut.Date</a></code>).</p>
</td></tr>
<tr><td><code id="summary.spwb_+3A_output">output</code></td>
<td>
<p>The data table to be summarized. Accepted values are the path to data tables in <code>object</code>, such as 'WaterBalance', 'Soil', 'Stand' or 'Plants$LAI'. It is also possible to use strings like 'Transpiration' and the function will interpret it as 'Plants$Transpiration'.</p>
</td></tr>
<tr><td><code id="summary.spwb_+3A_fun">FUN</code></td>
<td>
<p>The function to summarize results (e.g., <code>sum</code>, <code>mean</code>, ...)</p>
</td></tr>
<tr><td><code id="summary.spwb_+3A_byspecies">bySpecies</code></td>
<td>
<p>Allows aggregating output by species before calculating summaries (only has an effect with some values of <code>output</code>). Aggregation can involve a sum (as for plant lai or transpiration) or a LAI-weighted mean (as for plant stress or plant water potential).</p>
</td></tr>
<tr><td><code id="summary.spwb_+3A_months">months</code></td>
<td>
<p>A vector of month numbers (1 to 12) to subset the season where summaries apply.</p>
</td></tr>
<tr><td><code id="summary.spwb_+3A_...">...</code></td>
<td>
<p>Additional parameters for function <code>summary</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix with dates as row names and the desired summaries in columns
</p>


<h3>Note</h3>

<p>When applied to <code><a href="#topic+fordyn">fordyn</a></code> objects, the summary function can be used to gather the results of different yearly steps into a single table while keeping a daily resolution (i.e. using <code>freq = "days"</code>.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+pwb">pwb</a></code>, <code><a href="#topic+growth">growth</a></code>, <code><a href="#topic+fordyn">fordyn</a></code>, <code><a href="#topic+plot.spwb">plot.spwb</a></code>, <code><a href="#topic+extractSubdaily">extractSubdaily</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Load example daily meteorological data
data(examplemeteo)

#Load example plot plant data
data(exampleforestMED)

#Default species parameterization
data(SpParamsMED)

#Initialize soil with default soil params (2 layers)
examplesoil = soil(defaultSoilParams(2))

#Initialize control parameters
control = defaultControl("Granier")

#Initialize input
x = forest2spwbInput(exampleforestMED,examplesoil, SpParamsMED, control)

#Call simulation function
S1&lt;-spwb(x, examplemeteo, latitude = 41.82592, elevation = 100)

#Monthly summary (averages) of soil status
summary(S1, freq="months",FUN=mean, output="Soil")

#Queries the tables in 'Plants'
names(S1$Plants)

#Monthly summary (averages) of plant stress
summary(S1, freq="months",FUN=mean, output="Plants$PlantStress", 
        bySpecies = TRUE)


</code></pre>

<hr>
<h2 id='sureau_ecos'>Sureau-ECOS inner functions for testing only</h2><span id='topic+sureau_ecos'></span><span id='topic+initCochardNetworks'></span><span id='topic+semi_implicit_integration'></span>

<h3>Description</h3>

<p>Function <code>initCochardNetworks</code> initializes hydraulic networks for all plant cohorts in x
Function <code>semi_implicit_integration</code> updates water potentials and cavitation across the hydraulic network
</p>


<h3>Usage</h3>

<pre><code class='language-R'>initCochardNetworks(x)

semi_implicit_integration(network, dt, opt, cavitationRefill = "annual")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sureau_ecos_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+spwbInput">spwbInput</a></code> or <code><a href="#topic+growthInput">growthInput</a></code> created using <code>transpirationMode = "Cochard"</code>.</p>
</td></tr>
<tr><td><code id="sureau_ecos_+3A_network">network</code></td>
<td>
<p>A hydraulic network element of the list returned by <code>initCochardNetworks</code></p>
</td></tr>
<tr><td><code id="sureau_ecos_+3A_dt">dt</code></td>
<td>
<p>Smallest time step (seconds)</p>
</td></tr>
<tr><td><code id="sureau_ecos_+3A_opt">opt</code></td>
<td>
<p>Option flag vector</p>
</td></tr>
<tr><td><code id="sureau_ecos_+3A_cavitationrefill">cavitationRefill</code></td>
<td>
<p>A string indicating how refilling of embolized conduits is done:
</p>

<ul>
<li><p>&quot;none&quot; - no refilling.
</p>
</li>
<li><p>&quot;annual&quot; - every first day of the year.
</p>
</li>
<li><p>&quot;rate&quot; - following a rate of new sapwood formation.
</p>
</li>
<li><p>&quot;total&quot; - instantaneous complete refilling.
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>Function <code>initCochardNetworks</code> returns a vector of length equal to the number of cohorts. Each element is a list with Sureau-ECOS parameters.
Function <code>semi_implicit_integration</code> does not return anything, but modifies input parameter <code>network</code>.
</p>


<h3>Author(s)</h3>


<ul>
<li><p>Miquel De Cáceres Ainsa, CREAF
</p>
</li>
<li><p>Nicolas Martin-StPaul, URFM-INRAE
</p>
</li></ul>



<h3>References</h3>

<p>Ruffault J, Pimont F, Cochard H, Dupuy JL, Martin-StPaul N (2022) 
SurEau-Ecos v2.0: a trait-based plant hydraulics model for simulations of plant water status and drought-induced mortality at the ecosystem level.
Geoscientific Model Development 15, 5593-5626 (doi:10.5194/gmd-15-5593-2022).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb">spwb</a></code>
</p>

<hr>
<h2 id='transp_maximumTranspirationModel'>Maximum transpiration vs. LAI</h2><span id='topic+transp_maximumTranspirationModel'></span>

<h3>Description</h3>

<p>Builds a model of maximum transpiration (Tmax) over potential evapotranspiration (PET) for increasing leaf area index (LAI) values for each plant cohort.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>transp_maximumTranspirationModel(
  x,
  meteo,
  latitude,
  elevation,
  slope,
  aspect,
  LAI_seq = c(0.1, 0.25, seq(0.5, 10, by = 0.5)),
  draw = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="transp_maximumTranspirationModel_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+spwbInput">spwbInput</a></code>, built using the 'Sperry' transpiration mode.</p>
</td></tr>
<tr><td><code id="transp_maximumTranspirationModel_+3A_meteo">meteo</code></td>
<td>
<p>A data frame with daily meteorological data series.</p>
</td></tr>
<tr><td><code id="transp_maximumTranspirationModel_+3A_latitude">latitude</code></td>
<td>
<p>Latitude (in degrees).</p>
</td></tr>
<tr><td><code id="transp_maximumTranspirationModel_+3A_elevation">elevation</code>, <code id="transp_maximumTranspirationModel_+3A_slope">slope</code>, <code id="transp_maximumTranspirationModel_+3A_aspect">aspect</code></td>
<td>
<p>Elevation above sea level (in m), slope (in degrees) and aspect (in degrees from North).</p>
</td></tr>
<tr><td><code id="transp_maximumTranspirationModel_+3A_lai_seq">LAI_seq</code></td>
<td>
<p>Sequence of stand LAI values to be tested.</p>
</td></tr>
<tr><td><code id="transp_maximumTranspirationModel_+3A_draw">draw</code></td>
<td>
<p>Logical flag to indicate plotting of results.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function performs a meta-modelling exercise using the Sperry transpiration model, with the aim to estimate coefficients 
for the equation used in the Granier transpiration model (Granier et al. 1999). The model to be fitted is: <code>y ~ a*LAI + b*LAI^2</code>, 
where <code>y</code> is the ratio between maximum transpiration (Tmax) and Penman's potential evapotranspiration (PET) and <code>LAI</code> is the stand LAI. 
Unlike the original equation of Granier et al. (1999), we fit a zero intercept model so that LAI = 0 translates into zero plant transpiration. 
</p>
<p>The function fits the model for each cohort separately, assuming it represents the whole stand. 
For each stand LAI value in the input sequence, the function uses simulations with Sperry transpiration and the input weather to estimate <code>y = Tmax/PET</code> 
as a function of stand's LAI (deciduous stands include leaf phenology). 
Once simulations have been conducted for each stand LAI value, the function fits a Generalized Linear Model with the above equation, 
assuming a Gamma distribution of residuals and an identity link.
</p>
<p>The coefficients of the model can be used to parametrize Granier's transpiration, 
since coefficients <code>a</code> and <code>b</code> in the equation above correspond to parameters <code>Tmax_LAI</code> and <code>Tmax_LAIsq</code>, 
respectively (see <code><a href="#topic+SpParamsMED">SpParamsMED</a></code>).
</p>


<h3>Value</h3>

<p>Returns a list with as many elements as plant cohorts, each element being a <code><a href="stats.html#topic+glm">glm</a></code> model.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>Granier A, Bréda N, Biron P, Villette S (1999) A lumped water balance model to evaluate duration and intensity of drought constraints in forest stands. Ecol Modell 116:269–283. https://doi.org/10.1016/S0304-3800(98)00205-1.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+transp_transpirationGranier">transp_transpirationGranier</a></code>, <code><a href="#topic+transp_transpirationSperry">transp_transpirationSperry</a></code>, <code><a href="#topic+SpParamsMED">SpParamsMED</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#Load example daily meteorological data
data(examplemeteo)

# Load example plot plant data
data(exampleforestMED)

# Load default species parameters
data(SpParamsMED)

# Initialize soil with default soil params
examplesoil &lt;- soil(defaultSoilParams(4))

# Initialize control parameters for 'Sperry' transpiration mode
control &lt;- defaultControl(transpirationMode="Sperry")

# Initialize input
x2 &lt;- forest2spwbInput(exampleforestMED,examplesoil, SpParamsMED, control)

# Estimate maximum transpiration ratio models for each cohort
# Weather is subset to speed-up results
m &lt;- transp_maximumTranspirationModel(x2, examplemeteo[1:10,], 
                                     41.82592, elevation = 100, 
                                     slope = 0, aspect = 0)

# Inspect the model for first cohort
m[[1]]


</code></pre>

<hr>
<h2 id='transp_stomatalregulation'>Stomatal regulation</h2><span id='topic+transp_stomatalregulation'></span><span id='topic+transp_profitMaximization'></span><span id='topic+transp_stomatalRegulationPlot'></span>

<h3>Description</h3>

<p>Set of high-level functions used in the calculation of stomatal conductance and transpiration. 
Function <code>transp_profitMaximization</code> calculates gain and cost functions, 
as well as profit maximization from supply and photosynthesis input functions. 
Function <code>transp_stomatalRegulationPlot</code> produces a plot with the cohort supply functions against water potential 
and a plot with the cohort photosynthesis functions against water potential, both with the maximum profit values indicated.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>transp_profitMaximization(
  supplyFunction,
  photosynthesisFunction,
  Gswmin,
  Gswmax
)

transp_stomatalRegulationPlot(
  x,
  meteo,
  day,
  timestep,
  latitude,
  elevation,
  slope = NA,
  aspect = NA,
  type = "E"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="transp_stomatalregulation_+3A_supplyfunction">supplyFunction</code></td>
<td>
<p>Water supply function (see <code><a href="#topic+hydraulics_supplyFunctionNetwork">hydraulics_supplyFunctionNetwork</a></code>).</p>
</td></tr>
<tr><td><code id="transp_stomatalregulation_+3A_photosynthesisfunction">photosynthesisFunction</code></td>
<td>
<p>Function returned by <code>photo_photosynthesisFunction()</code>.</p>
</td></tr>
<tr><td><code id="transp_stomatalregulation_+3A_gswmin">Gswmin</code>, <code id="transp_stomatalregulation_+3A_gswmax">Gswmax</code></td>
<td>
<p>Minimum and maximum stomatal conductance to water vapour (mol·m-2·s-1).</p>
</td></tr>
<tr><td><code id="transp_stomatalregulation_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+spwbInput">spwbInput</a></code> built using the 'Sperry' transpiration mode.</p>
</td></tr>
<tr><td><code id="transp_stomatalregulation_+3A_meteo">meteo</code></td>
<td>
<p>A data frame with daily meteorological data series (see <code><a href="#topic+spwb">spwb</a></code>).</p>
</td></tr>
<tr><td><code id="transp_stomatalregulation_+3A_day">day</code></td>
<td>
<p>An integer to identify a day (a row) within <code>meteo</code>.</p>
</td></tr>
<tr><td><code id="transp_stomatalregulation_+3A_timestep">timestep</code></td>
<td>
<p>An integer between 1 and <code>ndailysteps</code> specified in <code>x</code> (see <code><a href="#topic+defaultControl">defaultControl</a></code>).</p>
</td></tr>
<tr><td><code id="transp_stomatalregulation_+3A_latitude">latitude</code></td>
<td>
<p>Latitude (in degrees).</p>
</td></tr>
<tr><td><code id="transp_stomatalregulation_+3A_elevation">elevation</code>, <code id="transp_stomatalregulation_+3A_slope">slope</code>, <code id="transp_stomatalregulation_+3A_aspect">aspect</code></td>
<td>
<p>Elevation above sea level (in m), slope (in degrees) and aspect (in degrees from North).</p>
</td></tr>
<tr><td><code id="transp_stomatalregulation_+3A_type">type</code></td>
<td>
<p>A string with plot type, either <code>"E"</code> (transpiration flow), <code>"Ag"</code> (gross photosynthesis), <code>"An"</code> (net photosynthesis), <code>"Gsw"</code> (stomatal conductance to water vapour), <code>"T"</code> (temperature) or <code>"VPD"</code> (leaf vapour pressure deficit).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Function <code>transp_profitMaximization</code> returns a list with the following elements:
</p>

<ul>
<li><p><code>Cost</code>: Cost function [0-1].
</p>
</li>
<li><p><code>Gain</code>: Gain function [0-1].
</p>
</li>
<li><p><code>Profit</code>: Profit function [0-1].
</p>
</li>
<li><p><code>iMaxProfit</code>: Index corresponding to maximum profit (starting from 0).
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>Sperry, J. S., M. D. Venturas, W. R. L. Anderegg, M. Mencuccini, D. S. Mackay, Y. Wang, and D. M. Love. 2017. Predicting stomatal responses to the environment from the optimization of photosynthetic gain and hydraulic cost. Plant Cell and Environment 40, 816-830 (doi: 10.1111/pce.12852).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+transp_transpirationSperry">transp_transpirationSperry</a></code>, <code><a href="#topic+hydraulics_supplyFunctionNetwork">hydraulics_supplyFunctionNetwork</a></code>, <code><a href="#topic+biophysics_leafTemperature">biophysics_leafTemperature</a></code>, <code><a href="#topic+photo_photosynthesis">photo_photosynthesis</a></code>, <code><a href="#topic+spwb_day">spwb_day</a></code>, <code><a href="#topic+plot.spwb_day">plot.spwb_day</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Load example daily meteorological data
data(examplemeteo)

#Load example plot plant data
data(exampleforestMED)

#Default species parameterization
data(SpParamsMED)

#Initialize soil with default soil params (4 layers)
examplesoil = soil(defaultSoilParams(4))

#Initialize control parameters
control = defaultControl(transpirationMode="Sperry")

#Initialize input
x2 = forest2spwbInput(exampleforestMED,examplesoil, SpParamsMED, control)

# Stomatal VPD curve and chosen value for the 12th time step at day 100
transp_stomatalRegulationPlot(x2, examplemeteo, day=100, timestep = 12,
                              latitude = 41.82592, elevation = 100, type="VPD")
 
</code></pre>

<hr>
<h2 id='transp_transpirationSperry'>Transpiration modes</h2><span id='topic+transp_transpirationSperry'></span><span id='topic+transp_transpirationCochard'></span><span id='topic+transp_modes'></span><span id='topic+transp_transpirationGranier'></span>

<h3>Description</h3>

<p>High-level sub-models representing transpiration, plant hydraulics, photosynthesis and water relations 
within plants.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>transp_transpirationSperry(
  x,
  meteo,
  day,
  latitude,
  elevation,
  slope,
  aspect,
  canopyEvaporation = 0,
  snowMelt = 0,
  soilEvaporation = 0,
  herbTranspiration = 0,
  stepFunctions = NA_integer_,
  modifyInput = TRUE
)

transp_transpirationCochard(
  x,
  meteo,
  day,
  latitude,
  elevation,
  slope,
  aspect,
  canopyEvaporation = 0,
  snowMelt = 0,
  soilEvaporation = 0,
  herbTranspiration = 0,
  modifyInput = TRUE
)

transp_transpirationGranier(
  x,
  meteo,
  day,
  latitude,
  elevation,
  slope,
  aspect,
  modifyInput = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="transp_transpirationSperry_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+spwbInput">spwbInput</a></code> or <code><a href="#topic+growthInput">growthInput</a></code>, built using the 'Granier', 'Sperry' or 'Cochard' transpiration modes.</p>
</td></tr>
<tr><td><code id="transp_transpirationSperry_+3A_meteo">meteo</code></td>
<td>
<p>A data frame with daily meteorological data series (see <code><a href="#topic+spwb">spwb</a></code>).</p>
</td></tr>
<tr><td><code id="transp_transpirationSperry_+3A_day">day</code></td>
<td>
<p>An integer to identify a day (row) within the <code>meteo</code> data frame.</p>
</td></tr>
<tr><td><code id="transp_transpirationSperry_+3A_latitude">latitude</code></td>
<td>
<p>Latitude (in degrees).</p>
</td></tr>
<tr><td><code id="transp_transpirationSperry_+3A_elevation">elevation</code>, <code id="transp_transpirationSperry_+3A_slope">slope</code>, <code id="transp_transpirationSperry_+3A_aspect">aspect</code></td>
<td>
<p>Elevation above sea level (in m), slope (in degrees) and aspect (in degrees from North).</p>
</td></tr>
<tr><td><code id="transp_transpirationSperry_+3A_canopyevaporation">canopyEvaporation</code></td>
<td>
<p>Canopy evaporation (from interception) for <code>day</code> (mm).</p>
</td></tr>
<tr><td><code id="transp_transpirationSperry_+3A_snowmelt">snowMelt</code></td>
<td>
<p>Snow melt values  for <code>day</code> (mm).</p>
</td></tr>
<tr><td><code id="transp_transpirationSperry_+3A_soilevaporation">soilEvaporation</code></td>
<td>
<p>Bare soil evaporation for <code>day</code> (mm).</p>
</td></tr>
<tr><td><code id="transp_transpirationSperry_+3A_herbtranspiration">herbTranspiration</code></td>
<td>
<p>Transpiration of herbaceous plants for <code>day</code> (mm).</p>
</td></tr>
<tr><td><code id="transp_transpirationSperry_+3A_stepfunctions">stepFunctions</code></td>
<td>
<p>An integer to indicate a simulation step for which photosynthesis and profit maximization functions are desired.</p>
</td></tr>
<tr><td><code id="transp_transpirationSperry_+3A_modifyinput">modifyInput</code></td>
<td>
<p>Boolean flag to indicate that the input <code>x</code> object is allowed to be modified during the simulation.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Three sub-models are available: 
</p>

<ul>
<li><p>Sub-model in function <code>transp_transpirationGranier</code> was described in De Cáceres et al. (2015), 
and implements an approach originally described in Granier et al. (1999). 
</p>
</li>
<li><p>Sub-model in function <code>transp_transpirationSperry</code> was described in De Cáceres et al. (2021), and
implements a modelling approach originally described in Sperry et al. (2017). 
</p>
</li>
<li><p>Sub-model in function <code>transp_transpirationCochard</code> was described for SurEau-Ecos v2.0 model in Ruffault et al. (2022). 
</p>
</li></ul>



<h3>Value</h3>

<p>A list with the following elements:
</p>

<ul>
<li><p><code>"cohorts"</code>: A data frame with cohort information, copied from <code><a href="#topic+spwbInput">spwbInput</a></code>.
</p>
</li>
<li><p><code>"Stand"</code>: A vector of stand-level variables.
</p>
</li>
<li><p><code>"Plants"</code>: A data frame of results for each plant cohort. When using <code>transp_transpirationGranier</code>, element <code>"Plants"</code> includes:
</p>

<ul>
<li><p><code>"LAI"</code>: Leaf area index of the plant cohort.
</p>
</li>
<li><p><code>"LAIlive"</code>: Leaf area index of the plant cohort, assuming all leaves are unfolded.
</p>
</li>
<li><p><code>"AbsorbedSWRFraction"</code>: Fraction of SWR absorbed by each cohort.
</p>
</li>
<li><p><code>"Transpiration"</code>: Transpirated water (in mm) corresponding to each cohort.
</p>
</li>
<li><p><code>"GrossPhotosynthesis"</code>: Gross photosynthesis (in gC/m2) corresponding to each cohort.
</p>
</li>
<li><p><code>"psi"</code>: Water potential (in MPa) of the plant cohort (average over soil layers).
</p>
</li>
<li><p><code>"DDS"</code>: Daily drought stress [0-1] (relative whole-plant conductance).
</p>
</li></ul>

<p>When using <code>transp_transpirationSperry</code> or <code>transp_transpirationCochard</code>, element <code>"Plants"</code> includes:
</p>

<ul>
<li><p><code>"LAI"</code>: Leaf area index of the plant cohort.
</p>
</li>
<li><p><code>"LAIlive"</code>: Leaf area index of the plant cohort, assuming all leaves are unfolded.
</p>
</li>
<li><p><code>"Extraction"</code>: Water extracted from the soil (in mm) for each cohort.
</p>
</li>
<li><p><code>"Transpiration"</code>: Transpirated water (in mm) corresponding to each cohort.
</p>
</li>
<li><p><code>"GrossPhotosynthesis"</code>: Gross photosynthesis (in gC/m2) corresponding to each cohort.
</p>
</li>
<li><p><code>"NetPhotosynthesis"</code>: Net photosynthesis (in gC/m2) corresponding to each cohort.
</p>
</li>
<li><p><code>"RootPsi"</code>: Minimum water potential (in MPa) at the root collar.
</p>
</li>
<li><p><code>"StemPsi"</code>: Minimum water potential (in MPa) at the stem.
</p>
</li>
<li><p><code>"StemPLC"</code>: Proportion of conductance loss in stem.
</p>
</li>
<li><p><code>"LeafPsiMin"</code>: Minimum (predawn) water potential (in MPa) at the leaf (representing an average leaf).
</p>
</li>
<li><p><code>"LeafPsiMax"</code>: Maximum (midday) water potential (in MPa) at the leaf (representing an average leaf).
</p>
</li>
<li><p><code>"LeafPsiMin_SL"</code>: Minimum (predawn) water potential (in MPa) at sunlit leaves.
</p>
</li>
<li><p><code>"LeafPsiMax_SL"</code>: Maximum (midday) water potential (in MPa) at sunlit leaves.
</p>
</li>
<li><p><code>"LeafPsiMin_SH"</code>: Minimum (predawn) water potential (in MPa) at shade leaves.
</p>
</li>
<li><p><code>"LeafPsiMax_SH"</code>: Maximum (midday) water potential (in MPa) at shade leaves.
</p>
</li>
<li><p><code>"dEdP"</code>: Overall soil-plant conductance (derivative of the supply function).
</p>
</li>
<li><p><code>"DDS"</code>: Daily drought stress [0-1] (relative whole-plant conductance).
</p>
</li>
<li><p><code>"StemRWC"</code>: Relative water content of stem tissue (including symplasm and apoplasm).
</p>
</li>
<li><p><code>"LeafRWC"</code>: Relative water content of leaf tissue (including symplasm and apoplasm).
</p>
</li>
<li><p><code>"LFMC"</code>: Live fuel moisture content (in percent of dry weight).
</p>
</li>
<li><p><code>"WaterBalance"</code>: Plant water balance (extraction - transpiration).
</p>
</li></ul>


</li>
<li><p><code>"Extraction"</code>: A data frame with mm of water extracted from each soil layer (in columns) by each cohort (in rows).
</p>
<p>The remaining items are only given by <code>transp_transpirationSperry</code> or <code>transp_transpirationCochard</code>:
</p>
</li>
<li><p><code>"EnergyBalance"</code>: A list with the following elements:
</p>

<ul>
<li><p><code>"Temperature"</code>: A data frame with the temperature of the atmosphere ('Tatm'), canopy ('Tcan') and soil ('Tsoil.1', 'Tsoil.2', ...) for each time step.
</p>
</li>
<li><p><code>"CanopyEnergyBalance"</code>: A data frame with the components of the canopy energy balance (in W/m2) for each time step.
</p>
</li>
<li><p><code>"SoilEnergyBalance"</code>: A data frame with the components of the soil energy balance (in W/m2) for each time step.
</p>
</li></ul>
  

</li>
<li><p><code>"RhizoPsi"</code>: Minimum water potential (in MPa) inside roots, after crossing rhizosphere, per cohort and soil layer.
</p>
</li>
<li><p><code>"Sunlitleaves"</code> and <code>"ShadeLeaves"</code>: Data frames for sunlit leaves and shade leaves and the following columns per cohort:
</p>

<ul>
<li><p><code>"LAI"</code>: Cumulative leaf area index of sunlit/shade leaves.
</p>
</li>
<li><p><code>"Vmax298"</code>: Average maximum carboxilation rate for sunlit/shade leaves.
</p>
</li>
<li><p><code>"Jmax298"</code>: Average maximum electron transport rate for sunlit/shade leaves.
</p>
</li></ul>
  

</li>
<li><p><code>"ExtractionInst"</code>: Water extracted by each plant cohort during each time step.
</p>
</li>
<li><p><code>"PlantsInst"</code>: A list with instantaneous (per time step) results for each plant cohort:
</p>

<ul>
<li><p><code>"E"</code>: A data frame with the cumulative transpiration (mm) for each plant cohort during each time step. 
</p>
</li>
<li><p><code>"Ag"</code>: A data frame with the cumulative gross photosynthesis (gC/m2) for each plant cohort during each time step. 
</p>
</li>
<li><p><code>"An"</code>: A data frame with the cumulative net photosynthesis (gC/m2) for each plant cohort during each time step. 
</p>
</li>
<li><p><code>"Sunlitleaves"</code> and <code>"ShadeLeaves"</code>: Lists with instantaneous (for each time step) results for sunlit leaves and shade leaves and the following items:
</p>

<ul>
<li><p><code>"Abs_SWR"</code>: A data frame with instantaneous absorbed short-wave radiation (SWR). 
</p>
</li>
<li><p><code>"Net_LWR"</code>: A data frame with instantaneous net long-wave radiation (LWR). 
</p>
</li>
<li><p><code>"An"</code>: A data frame with instantaneous net photosynthesis (in micromol/m2/s). 
</p>
</li>
<li><p><code>"Ci"</code>: A data frame with instantaneous intercellular CO2 concentration (in ppm). 
</p>
</li>
<li><p><code>"GW"</code>: A data frame with instantaneous stomatal conductance (in mol/m2/s). 
</p>
</li>
<li><p><code>"VPD"</code>: A data frame with instantaneous vapour pressure deficit (in kPa). 
</p>
</li>
<li><p><code>"Temp"</code>: A data frame with leaf temperature (in degrees Celsius). 
</p>
</li>
<li><p><code>"Psi"</code>: A data frame with leaf water potential (in MPa). 
</p>
</li></ul>


</li>
<li><p><code>"dEdP"</code>: A data frame with the slope of the plant supply function (an estimation of whole-plant conductance).
</p>
</li>
<li><p><code>"RootPsi"</code>: A data frame with root crown water potential (in MPa) for each plant cohort during each time step.
</p>
</li>
<li><p><code>"StemPsi"</code>: A data frame with stem water potential (in MPa) for each plant cohort during each time step.
</p>
</li>
<li><p><code>"LeafPsi"</code>: A data frame with leaf (average) water potential (in MPa) for each plant cohort during each time step. 
</p>
</li>
<li><p><code>"StemPLC"</code>: A data frame with the proportion loss of conductance [0-1] for each plant cohort during each time step. 
</p>
</li>
<li><p><code>"StemRWC"</code>: A data frame with the (average) relative water content of stem tissue [0-1] for each plant cohort during each time step. 
</p>
</li>
<li><p><code>"LeafRWC"</code>: A data frame with the relative water content of leaf tissue [0-1] for each plant cohort during each time step. 
</p>
</li>
<li><p><code>"StemSympRWC"</code>: A data frame with the (average) relative water content of symplastic stem tissue [0-1] for each plant cohort during each time step. 
</p>
</li>
<li><p><code>"LeafSympRWC"</code>: A data frame with the relative water content of symplastic leaf tissue [0-1] for each plant cohort during each time step. 
</p>
</li>
<li><p><code>"PWB"</code>: A data frame with plant water balance (extraction - transpiration).
</p>
</li></ul>


</li>
<li><p><code>"LightExtinction"</code>: A list of information regarding radiation balance through the canopy, as returned by function <code><a href="#topic+light_instantaneousLightExtinctionAbsortion">light_instantaneousLightExtinctionAbsortion</a></code>.
</p>
</li>
<li><p><code>"CanopyTurbulence"</code>: Canopy turbulence (see <code><a href="#topic+wind_canopyTurbulence">wind_canopyTurbulence</a></code>).
</p>
</li>
<li><p><code>"SupplyFunctions"</code>: If <code>stepFunctions</code> is not missing, a list of supply functions, photosynthesis functions and profit maximization functions.
</p>
</li></ul>



<h3>Author(s)</h3>


<ul>
<li><p>Miquel De Cáceres Ainsa, CREAF
</p>
</li>
<li><p>Nicolas Martin-StPaul, URFM-INRAE
</p>
</li></ul>



<h3>References</h3>

<p>De Cáceres M, Martínez-Vilalta J, Coll L, Llorens P, Casals P, Poyatos R, Pausas JG, Brotons L. (2015) Coupling a water balance model with forest inventory data to predict drought stress: the role of forest structural changes vs. climate changes. Agricultural and Forest Meteorology 213: 77-90 (doi:10.1016/j.agrformet.2015.06.012).
</p>
<p>De Cáceres M, Mencuccini M, Martin-StPaul N, Limousin JM, Coll L, Poyatos R, Cabon A, Granda V, Forner A, Valladares F, Martínez-Vilalta J (2021) Unravelling the effect of species mixing on water use and drought stress in holm oak forests: a modelling approach. Agricultural and Forest Meteorology 296 (doi:10.1016/j.agrformet.2020.108233).
</p>
<p>Granier A, Bréda N, Biron P, Villette S (1999) A lumped water balance model to evaluate duration and intensity of drought constraints in forest stands. Ecol Modell 116:269–283. https://doi.org/10.1016/S0304-3800(98)00205-1.
</p>
<p>Ruffault J, Pimont F, Cochard H, Dupuy JL, Martin-StPaul N (2022) 
SurEau-Ecos v2.0: a trait-based plant hydraulics model for simulations of plant water status and drought-induced mortality at the ecosystem level.
Geoscientific Model Development 15, 5593-5626 (doi:10.5194/gmd-15-5593-2022).
</p>
<p>Sperry, J. S., M. D. Venturas, W. R. L. Anderegg, M. Mencuccini, D. S. Mackay, Y. Wang, and D. M. Love. 2017. Predicting stomatal responses to the environment from the optimization of photosynthetic gain and hydraulic cost. Plant Cell and Environment 40, 816-830 (doi: 10.1111/pce.12852).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spwb_day">spwb_day</a></code>, <code><a href="#topic+plot.spwb_day">plot.spwb_day</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Load example daily meteorological data
data(examplemeteo)

#Load example plot plant data
data(exampleforestMED)

#Default species parameterization
data(SpParamsMED)

#Initialize soil with default soil params (4 layers)
examplesoil &lt;- soil(defaultSoilParams(4))

#Initialize control parameters
control &lt;- defaultControl("Granier")

#Initialize input
x1 &lt;- forest2spwbInput(exampleforestMED,examplesoil, SpParamsMED, control)

# Transpiration according to Granier's model, plant water potential 
# and plant stress for a given day
t1 &lt;- transp_transpirationGranier(x1, examplemeteo, 1, 
                                 latitude = 41.82592, elevation = 100, slope = 0, aspect = 0, 
                                 modifyInput = FALSE)

#Switch to 'Sperry' transpiration mode
control &lt;- defaultControl("Sperry")

#Initialize input
x2 &lt;- forest2spwbInput(exampleforestMED,examplesoil, SpParamsMED, control)

# Transpiration according to Sperry's model
t2 &lt;- transp_transpirationSperry(x2, examplemeteo, 1, 
                                latitude = 41.82592, elevation = 100, slope = 0, aspect = 0,
                                modifyInput = FALSE)
                                
#Switch to 'Cochard' transpiration mode
control &lt;- defaultControl("Cochard")

#Initialize input
x3 &lt;- forest2spwbInput(exampleforestMED,examplesoil, SpParamsMED, control)

# Transpiration according to Cochard's model
t3 &lt;- transp_transpirationCochard(x3, examplemeteo, 1, 
                                  latitude = 41.82592, elevation = 100, slope = 0, aspect = 0,
                                  modifyInput = FALSE)
                                
</code></pre>

<hr>
<h2 id='vprofile_leafAreaDensity'>Vertical profiles</h2><span id='topic+vprofile_leafAreaDensity'></span><span id='topic+vprofile_rootDistribution'></span><span id='topic+vprofile_fuelBulkDensity'></span><span id='topic+vprofile_PARExtinction'></span><span id='topic+vprofile_SWRExtinction'></span><span id='topic+vprofile_windExtinction'></span>

<h3>Description</h3>

<p>Functions to generate vertical profiles generated by an input <code><a href="#topic+forest">forest</a></code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vprofile_leafAreaDensity(
  x,
  SpParams = NULL,
  z = NULL,
  gdd = NA,
  byCohorts = FALSE,
  bySpecies = FALSE,
  includeHerbs = FALSE,
  draw = TRUE,
  xlim = NULL
)

vprofile_rootDistribution(
  x,
  SpParams,
  d = NULL,
  bySpecies = FALSE,
  draw = TRUE,
  xlim = NULL
)

vprofile_fuelBulkDensity(
  x,
  SpParams,
  z = NULL,
  gdd = NA,
  draw = TRUE,
  xlim = NULL
)

vprofile_PARExtinction(
  x,
  SpParams,
  z = NULL,
  gdd = NA,
  includeHerbs = FALSE,
  draw = TRUE,
  xlim = c(0, 100)
)

vprofile_SWRExtinction(
  x,
  SpParams,
  z = NULL,
  gdd = NA,
  includeHerbs = FALSE,
  draw = TRUE,
  xlim = c(0, 100)
)

vprofile_windExtinction(
  x,
  SpParams,
  u = 1,
  windMeasurementHeight = 200,
  boundaryLayerSize = 2000,
  target = "windspeed",
  z = NULL,
  gdd = NA,
  includeHerbs = FALSE,
  draw = TRUE,
  xlim = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vprofile_leafAreaDensity_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+forest">forest</a></code></p>
</td></tr>
<tr><td><code id="vprofile_leafAreaDensity_+3A_spparams">SpParams</code></td>
<td>
<p>A data frame with species parameters (see <code><a href="#topic+SpParamsMED">SpParamsMED</a></code>).</p>
</td></tr>
<tr><td><code id="vprofile_leafAreaDensity_+3A_z">z</code></td>
<td>
<p>A numeric vector with height values.</p>
</td></tr>
<tr><td><code id="vprofile_leafAreaDensity_+3A_gdd">gdd</code></td>
<td>
<p>Growth degree days.</p>
</td></tr>
<tr><td><code id="vprofile_leafAreaDensity_+3A_bycohorts">byCohorts</code></td>
<td>
<p>Separate profiles for each cohort.</p>
</td></tr>
<tr><td><code id="vprofile_leafAreaDensity_+3A_byspecies">bySpecies</code></td>
<td>
<p>Aggregate cohort profiles by species.</p>
</td></tr>
<tr><td><code id="vprofile_leafAreaDensity_+3A_includeherbs">includeHerbs</code></td>
<td>
<p>Include herbaceous layer in the profile.</p>
</td></tr>
<tr><td><code id="vprofile_leafAreaDensity_+3A_draw">draw</code></td>
<td>
<p>Logical flag to indicate that a plot is desired.</p>
</td></tr>
<tr><td><code id="vprofile_leafAreaDensity_+3A_xlim">xlim</code></td>
<td>
<p>Limits of the x-axis.</p>
</td></tr>
<tr><td><code id="vprofile_leafAreaDensity_+3A_d">d</code></td>
<td>
<p>A numeric vector with soil layer widths.</p>
</td></tr>
<tr><td><code id="vprofile_leafAreaDensity_+3A_u">u</code></td>
<td>
<p>The value of measured wind speed (in m/s).</p>
</td></tr>
<tr><td><code id="vprofile_leafAreaDensity_+3A_windmeasurementheight">windMeasurementHeight</code></td>
<td>
<p>Height corresponding to wind measurement (in cm over the canopy).</p>
</td></tr>
<tr><td><code id="vprofile_leafAreaDensity_+3A_boundarylayersize">boundaryLayerSize</code></td>
<td>
<p>Size of the boundary layer (in cm) over the canopy.</p>
</td></tr>
<tr><td><code id="vprofile_leafAreaDensity_+3A_target">target</code></td>
<td>
<p>Wind property to draw, either &quot;windspeed&quot;, &quot;kineticenergy&quot; (turbulent kinetic energy) or &quot;stress&quot; (Reynold's stress).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If <code>draw = FALSE</code>, the functions return a numeric vector with values measured at each height. Units depend on the profile function:
</p>

<ul>
<li><p><code>vprofile_leafAreaDensity</code>: Cumulative LAI (m2/m2) per height bin.
</p>
</li>
<li><p><code>vprofile_fuelBulkDensity</code>: Fuel bulk density (kg/m3) per height bin.
</p>
</li>
<li><p><code>vprofile_PARExtinction</code>: Percent of photosynthetically active radiation (%) corresponding to each height.
</p>
</li>
<li><p><code>vprofile_SWRExtinction</code>: Percent of shortwave radiation (%) corresponding to each height.
</p>
</li>
<li><p><code>vprofile_windExtinction</code>: Wind speed (m/s) corresponding to each height.
</p>
</li></ul>

<p>If <code>draw = TRUE</code> the functions return a ggplot object, instead.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+forest">forest</a></code>, <code><a href="#topic+plot.forest">plot.forest</a></code>, <code><a href="#topic+wind_canopyTurbulence">wind_canopyTurbulence</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Default species parameterization
data(SpParamsMED)

#Load example plot plant data
data(exampleforestMED)

vprofile_leafAreaDensity(exampleforestMED, SpParamsMED)
vprofile_fuelBulkDensity(exampleforestMED, SpParamsMED)

vprofile_PARExtinction(exampleforestMED, SpParamsMED)
vprofile_SWRExtinction(exampleforestMED, SpParamsMED)

vprofile_windExtinction(exampleforestMED, SpParamsMED)

</code></pre>

<hr>
<h2 id='waterUseEfficiency'>Water use efficiency</h2><span id='topic+waterUseEfficiency'></span>

<h3>Description</h3>

<p>Calculates plant water use efficiency (WUE), at different temporal scales, from simulation results.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>waterUseEfficiency(
  x,
  type = "Plant Ag/E",
  leaves = "average",
  freq = "days",
  draw = TRUE,
  ylim = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="waterUseEfficiency_+3A_x">x</code></td>
<td>
<p>An object of class <code><a href="#topic+spwb">spwb</a></code>, <code><a href="#topic+pwb">pwb</a></code>, <code><a href="#topic+growth">growth</a></code> or <code><a href="#topic+fordyn">fordyn</a></code>.</p>
</td></tr>
<tr><td><code id="waterUseEfficiency_+3A_type">type</code></td>
<td>
<p>A string to indicate the scale of WUE calculation. Either:
</p>

<ul>
<li><p><code>"Leaf iWUE"</code>: Leaf intrinsic WUE, i.e. instantaneous ratio between photosynthesis and stomatal conductance (only for simulations with <code>transpirationMode = "Sperry"</code> or <code>transpirationMode = "Cochard"</code> and <code>subdailyResults = TRUE</code>). 
</p>
</li>
<li><p><code>"Leaf Ci"</code>: Leaf intercellular CO2 concentration (only for simulations with <code>transpirationMode = "Sperry"</code> or <code>transpirationMode = "Cochard"</code> and <code>subdailyResults = TRUE</code>).
</p>
</li>
<li><p><code>"Plant An/E"</code>: Plant (cohort) net photosynthesis over plant transpiration (only for simulations with <code>transpirationMode = "Sperry"</code> or <code>transpirationMode = "Cochard"</code>)
</p>
</li>
<li><p><code>"Stand An/E"</code>: Stand net photosynthesis over stand transpiration (only for simulations with <code>transpirationMode = "Sperry"</code> or <code>transpirationMode = "Cochard"</code>)
</p>
</li>
<li><p><code>"Plant Ag/E"</code>: Plant (cohort) gross photosynthesis over plant transpiration
</p>
</li>
<li><p><code>"Stand Ag/E"</code>: Stand gross photosynthesis over stand transpiration
</p>
</li></ul>
</td></tr>
<tr><td><code id="waterUseEfficiency_+3A_leaves">leaves</code></td>
<td>
<p>Either <code>"sunlit"</code>, <code>"shade"</code> or <code>"average"</code>. Refers to the WUE of different leaf types or the average (with weights according to the LAI of sunlit and shade leaves). Only relevant for <code>type = "iWUE"</code>.</p>
</td></tr>
<tr><td><code id="waterUseEfficiency_+3A_freq">freq</code></td>
<td>
<p>Frequency of summary statistics (see <code><a href="base.html#topic+cut.Date">cut.Date</a></code>).</p>
</td></tr>
<tr><td><code id="waterUseEfficiency_+3A_draw">draw</code></td>
<td>
<p>A boolean flag to indicate that a plot should be returned.</p>
</td></tr>
<tr><td><code id="waterUseEfficiency_+3A_ylim">ylim</code></td>
<td>
<p>Range of values for y.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Temporal aggregation of WUE values is done differently depending on the value of <code>type</code>. 
For <code>type = "Plant Ag/E"</code>, <code>type = "Stand Ag/E"</code>, <code>type = "Plant An/E"</code> and <code>type = "Stand An/E"</code> sums 
or daily photosynthesis and transpiration are first calculated at the desired temporal scale and the ratio is calculated afterwards. 
For <code>type = "Leaf iWUE"</code> intrinsic WUE values are first calculated at the daily scale (as averages of instantaneous An/gs ratios weighted by An) 
and then they are aggregated to the desired scale by calculating weighted averages, where weights are given by daily photosynthesis.
</p>


<h3>Value</h3>

<p>If <code>draw=TRUE</code> a plot is returned. Otherwise, the function returns a matrix with WUE values, 
where rows are dates (at the desired temporal scale), and columns are plant cohorts. 
In the case of <code>type = "Plant Ag/E"</code>, <code>type = "Stand Ag/E"</code>, <code>type = "Plant An/E"</code> and <code>type = "Stand An/E"</code> values are in gC/L. 
In the case of <code>type = "Leaf iWUE"</code> values are in micromol of carbon per mmol of water.
</p>


<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>See Also</h3>

<p><code><a href="#topic+droughtStress">droughtStress</a></code>
</p>

<hr>
<h2 id='wind'>Models for canopy turbulence</h2><span id='topic+wind'></span><span id='topic+wind_canopyTurbulenceModel'></span><span id='topic+wind_canopyTurbulence'></span>

<h3>Description</h3>

<p>Models for canopy turbulence by Katul et al (2004).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wind_canopyTurbulenceModel(zm, Cx, hm, d0, z0, model = "k-epsilon")

wind_canopyTurbulence(
  zmid,
  LAD,
  canopyHeight,
  u,
  windMeasurementHeight = 200,
  model = "k-epsilon"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="wind_+3A_zm">zm</code></td>
<td>
<p>A numeric vector with height values (m).</p>
</td></tr>
<tr><td><code id="wind_+3A_cx">Cx</code></td>
<td>
<p>Effective drag = Cd x leaf area density.</p>
</td></tr>
<tr><td><code id="wind_+3A_hm">hm</code></td>
<td>
<p>Canopy height (m).</p>
</td></tr>
<tr><td><code id="wind_+3A_d0">d0</code></td>
<td>
<p>Zero displacement height (m).</p>
</td></tr>
<tr><td><code id="wind_+3A_z0">z0</code></td>
<td>
<p>Momentum roughness height (m).</p>
</td></tr>
<tr><td><code id="wind_+3A_model">model</code></td>
<td>
<p>Closure model.</p>
</td></tr>
<tr><td><code id="wind_+3A_zmid">zmid</code></td>
<td>
<p>A numeric vector of mid-point heights (in cm) for canopy layers.</p>
</td></tr>
<tr><td><code id="wind_+3A_lad">LAD</code></td>
<td>
<p>A numeric vector of leaf area density values (m3/m2).</p>
</td></tr>
<tr><td><code id="wind_+3A_canopyheight">canopyHeight</code></td>
<td>
<p>Canopy height (in cm).</p>
</td></tr>
<tr><td><code id="wind_+3A_u">u</code></td>
<td>
<p>Measured wind speed (m/s).</p>
</td></tr>
<tr><td><code id="wind_+3A_windmeasurementheight">windMeasurementHeight</code></td>
<td>
<p>Height of wind speed measurement with respect to canopy height (cm).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Implementation in Rcpp of the K-epsilon canopy turbulence models by Katul et al (2004) originally in Matlab code (https://nicholas.duke.edu/people/faculty/katul/k_epsilon_model.htm).
</p>


<h3>Value</h3>

<p>Function <code>wind_canopyTurbulenceModel</code> returns a data frame of vertical profiles for variables:
</p>

<ul>
<li><p><code>z1</code>: Height values.
</p>
</li>
<li><p><code>U1</code>: U/u*, where U is mean velocity and u* is friction velocity.
</p>
</li>
<li><p><code>dU1</code>: dUdz/u*, where dUdz is mean velocity gradient and u* is friction velocity.
</p>
</li>
<li><p><code>epsilon1</code>: epsilon/(u^3/h) where epsilon is the turbulent kinetic dissipation rate, u* is friction velocity and h is canopy height.
</p>
</li>
<li><p><code>k1</code>: k/(u*^2), where k is the turbulent kinetic energy and u* is friction velocity.
</p>
</li>
<li><p><code>uw1</code>: &lt;uw&gt;/(u*^2), where &lt;uw&gt; is the Reynolds stress and u* is friction velocity.
</p>
</li>
<li><p><code>Lmix1</code>: Mixing length.
</p>
</li></ul>

<p>Function <code>wind_canopyTurbulence</code> returns a data frame of vertical profiles for transformed variables:
</p>

<ul>
<li><p><code>zmid</code>: Input mid-point heights (in cm) for canopy layers.
</p>
</li>
<li><p><code>u</code>: Wind speed (m/s).
</p>
</li>
<li><p><code>du</code>: Mean velocity gradient (1/s).
</p>
</li>
<li><p><code>epsilon</code>: Turbulent kinetic dissipation rate.
</p>
</li>
<li><p><code>k</code>: Turbulent kinetic energy.
</p>
</li>
<li><p><code>uw</code>: Reynolds stress.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>Katul GG, Mahrt L, Poggi D, Sanz C (2004) One- and two-equation models for canopy turbulence. Boundary-Layer Meteorol 113:81–109. https://doi.org/10.1023/B:BOUN.0000037333.48760.e5
</p>


<h3>See Also</h3>

<p><code><a href="#topic+vprofile_windExtinction">vprofile_windExtinction</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Default species parameterization
data(SpParamsMED)

#Load example plot plant data
data(exampleforestMED)

#Canopy height (in m)
h= max(exampleforestMED$treeData$Height/100) 
d0 = 0.67*h
z0 = 0.08*h

#Height values (cm)
z = seq(50,1000, by=50)
zm = z/100 # (in m)

# Leaf area density
lad = vprofile_leafAreaDensity(exampleforestMED, SpParamsMED, draw = FALSE,
                               z = c(0,z))
  
# Effective drag
Cd = 0.2
Cx = Cd*lad
  
# canopy turbulence model
wind_canopyTurbulenceModel(zm, Cx,h,d0,z0)

</code></pre>

<hr>
<h2 id='woodformation'>Wood formation</h2><span id='topic+woodformation'></span><span id='topic+woodformation_initRing'></span><span id='topic+woodformation_temperatureEffect'></span><span id='topic+woodformation_relativeExpansionRate'></span><span id='topic+woodformation_growRing'></span><span id='topic+woodformation_relativeGrowthRate'></span>

<h3>Description</h3>

<p>Functions to initialize and expand a ring of tracheids to simulate secondary growth.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>woodformation_initRing()

woodformation_temperatureEffect(
  Tc,
  Y_T = 5,
  DHa = 87500,
  DSd = 1090,
  DHd = 333000
)

woodformation_relativeExpansionRate(psi, Tc, pi, phi, Y_P, Y_T)

woodformation_growRing(
  ring,
  psi,
  Tc,
  Nc = 8.85,
  phi0 = 0.13,
  pi0 = -0.8,
  CRD0 = 8.3,
  Y_P = 0.05,
  Y_T = 5,
  h = 0.043 * 1.8,
  s = 1.8
)

woodformation_relativeGrowthRate(dbh1, dbh2, yeardiff, lower = -2, upper = 8)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="woodformation_+3A_tc">Tc</code></td>
<td>
<p>Temperature in Celsius.</p>
</td></tr>
<tr><td><code id="woodformation_+3A_y_t">Y_T</code></td>
<td>
<p>Temperature yield threshold (in Celsius)</p>
</td></tr>
<tr><td><code id="woodformation_+3A_dha">DHa</code>, <code id="woodformation_+3A_dsd">DSd</code>, <code id="woodformation_+3A_dhd">DHd</code></td>
<td>
<p>Enthalpy of activation, enthalpy difference and entropy difference between the catalytically active and inactive states of the enzymatic system (Parent et al. 2010).</p>
</td></tr>
<tr><td><code id="woodformation_+3A_psi">psi</code></td>
<td>
<p>Water potential (in MPa).</p>
</td></tr>
<tr><td><code id="woodformation_+3A_pi">pi</code></td>
<td>
<p>Osmotic potential (in MPa)</p>
</td></tr>
<tr><td><code id="woodformation_+3A_phi">phi</code></td>
<td>
<p>Cell extensibility (in MPa-1 day-1)</p>
</td></tr>
<tr><td><code id="woodformation_+3A_y_p">Y_P</code></td>
<td>
<p>Turgor pressure yield threshold (in MPa)</p>
</td></tr>
<tr><td><code id="woodformation_+3A_ring">ring</code></td>
<td>
<p>An object of class <code><a href="grDevices.html#topic+ring">ring</a></code> returned by function <code>woodformation_initRing</code>.</p>
</td></tr>
<tr><td><code id="woodformation_+3A_nc">Nc</code></td>
<td>
<p>Number of active cells in the cambium.</p>
</td></tr>
<tr><td><code id="woodformation_+3A_phi0">phi0</code></td>
<td>
<p>Initial value of cell extensibility (in MPa-1 day-1)</p>
</td></tr>
<tr><td><code id="woodformation_+3A_pi0">pi0</code></td>
<td>
<p>Initial value of cell osmotic potential (in MPa)</p>
</td></tr>
<tr><td><code id="woodformation_+3A_crd0">CRD0</code></td>
<td>
<p>Initial value of cell radial diameter</p>
</td></tr>
<tr><td><code id="woodformation_+3A_h">h</code></td>
<td>
<p>Cell wall hardening coefficient (in day-1)</p>
</td></tr>
<tr><td><code id="woodformation_+3A_s">s</code></td>
<td>
<p>Cell wall softening coefficient (unitless)</p>
</td></tr>
<tr><td><code id="woodformation_+3A_dbh1">dbh1</code>, <code id="woodformation_+3A_dbh2">dbh2</code></td>
<td>
<p>Initial and final diameter at breast height.</p>
</td></tr>
<tr><td><code id="woodformation_+3A_yeardiff">yeardiff</code></td>
<td>
<p>Interval between dbh measurements, in years.</p>
</td></tr>
<tr><td><code id="woodformation_+3A_lower">lower</code>, <code id="woodformation_+3A_upper">upper</code></td>
<td>
<p>Lower and upper bounds for root finding.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Function <code>woodformation_initRing()</code> returns a list of class 'ring', 
that is a list containing a data frame <code>cells</code> and two vectors: <code>P</code> and <code>SA</code>. 
Dataframe <code>cells</code> contains the columns &quot;formation_date&quot;, &quot;phi&quot;, &quot;pi&quot; and &quot;CRD&quot; and as many rows as dates processed. 
Vectors <code>P</code> and <code>SA</code> contain, respectively, the number of cells produced and the sapwood area 
corresponding to the ring of cells (assuming a tangencial radius of 20 micrometers). 
</p>
<p>Function <code>woodformation_growRing()</code> modifies the input 'ring' object according to the environmental conditions given as input.
</p>
<p>Function <code>woodformation_relativeExpansionRate()</code> returns a numeric scalar with the relative expansion rate. 
</p>
<p>Function <code>woodformation_temperatureEffect()</code> returns a scalar between 0 and 1 reflecting the temperature effect on tissue formation rate. 
</p>
<p>Function <code>woodformation_relativeGrowthRate</code> returns the annual growth rate, relative to cambium perimeter, estimated from initial and final diameter values.
</p>


<h3>Note</h3>

<p>Code modified from package xylomod by Antoine Cabon, available at GitHub
</p>


<h3>Author(s)</h3>

<p>Antoine Cabon, CTFC
</p>
<p>Miquel De Cáceres Ainsa, CREAF
</p>


<h3>References</h3>

<p>Cabon A, Fernández-de-Uña L, Gea-Izquierdo G, Meinzer FC, Woodruff DR, Martínez-Vilalta J, De Cáceres M. 2020a. Water potential control of turgor-driven tracheid enlargement in Scots pine at its xeric distribution edge. New Phytologist 225: 209–221.
</p>
<p>Cabon A, Peters RL, Fonti P, Martínez-Vilalta  J, De Cáceres M. 2020b. Temperature and water potential co-limit stem cambial activity along a steep elevational gradient. New Phytologist: nph.16456.
</p>
<p>Parent, B., O. Turc, Y. Gibon, M. Stitt, and F. Tardieu. 2010. Modelling temperature-compensated physiological rates, based on the co-ordination of responses to temperature of developmental processes. Journal of Experimental Botany 61:2057–2069.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+growth">growth</a></code>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
