<!DOCTYPE html><html lang="en"><head><title>Help for package EBASE</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {EBASE}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#credible_plot'><p>Plot credible intervals for a, R, and b</p></a></li>
<li><a href='#credible_prep'><p>Get credible intervals for a, R, b</p></a></li>
<li><a href='#ebase'><p>Estuarine Bayesian Single-station Estimation method for ecosystem metabolism</p></a></li>
<li><a href='#ebase_eqboxy'><p>Oxygen saturation</p></a></li>
<li><a href='#ebase_form'><p>Format ebase output</p></a></li>
<li><a href='#ebase_plot'><p>Plot results from EBASE</p></a></li>
<li><a href='#ebase_prep'><p>Prepare data for ebase</p></a></li>
<li><a href='#ebase_rho'><p>Seawater density calculation</p></a></li>
<li><a href='#ebase_schmidt'><p>Schmidt number calculation</p></a></li>
<li><a href='#ebase_years'><p>Estuarine Bayesian Single-station Estimation method for ecosystem metabolism for long time series</p></a></li>
<li><a href='#exdat'><p>Sample data from Apalachicola NERRS</p></a></li>
<li><a href='#exres'><p>Example results for four days from Apalachicola NERRS</p></a></li>
<li><a href='#fit_plot'><p>Plot observed and modeled dissolved oxygen</p></a></li>
<li><a href='#interp_plot'><p>Create a diagnostic plot showing interpolated values prior to metabolism estimates</p></a></li>
<li><a href='#metab_update'><p>Update metabolism jags fit</p></a></li>
<li><a href='#prior_plot'><p>Plot prior distributions for a, R, and b</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Estuarine Bayesian Single-Station Estimation Method for
Ecosystem Metabolism</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-09-25</td>
</tr>
<tr>
<td>Description:</td>
<td>Estimate ecosystem metabolism in a Bayesian framework for
  individual water quality monitoring stations with continuous dissolved
  oxygen time series. A mass balance equation is used that provides
  estimates of parameters for gross primary production, respiration,
  and gas exchange. Methods adapted from Grace et al. (2015)
  &lt;<a href="https://doi.org/10.1002%2Flom3.10011">doi:10.1002/lom3.10011</a>&gt; and Wanninkhof (2014) &lt;<a href="https://doi.org/10.4319%2Flom.2014.12.351">doi:10.4319/lom.2014.12.351</a>&gt;.
  Details in Beck et al. (2024) &lt;<a href="https://doi.org/10.1002%2Flom3.10620">doi:10.1002/lom3.10620</a>&gt;.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5)</td>
</tr>
<tr>
<td>Imports:</td>
<td>doParallel, dplyr, foreach, ggplot2 (&ge; 3.4.0), lubridate,
R2jags (&ge; 0.6.1), rjags (&ge; 4.10), tidyr, truncnorm, zoo</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 3.0.0), knitr, rmarkdown, covr</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://creativecommons.org/publicdomain/zero/1.0/legalcode">CC0</a></td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>JAGS 4.x.y (https://mcmc-jags.sourceforge.net)</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://fawda123.github.io/EBASE/">https://fawda123.github.io/EBASE/</a>,
<a href="https://github.com/fawda123/EBASE/">https://github.com/fawda123/EBASE/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/fawda123/EBASE/issues">https://github.com/fawda123/EBASE/issues</a></td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>LazyDataCompression:</td>
<td>xz</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-09-25 15:29:23 UTC; mbeck</td>
</tr>
<tr>
<td>Author:</td>
<td>Marcus Beck <a href="https://orcid.org/0000-0002-4996-0059"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cre],
  Maria Herrmann [aut],
  Jill Arriola <a href="https://orcid.org/0000-0003-2173-8349"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Raymond Najjar <a href="https://orcid.org/0000-0002-2960-5965"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Marcus Beck &lt;mbeck@tbep.org&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-09-25 17:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='credible_plot'>Plot credible intervals for a, R, and b</h2><span id='topic+credible_plot'></span>

<h3>Description</h3>

<p>Plot credible intervals for a, R, and b
</p>


<h3>Usage</h3>

<pre><code class='language-R'>credible_plot(res, params = c("a", "R", "b"))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="credible_plot_+3A_res">res</code></td>
<td>
<p>output data frame from <code><a href="#topic+ebase">ebase</a></code></p>
</td></tr>
<tr><td><code id="credible_plot_+3A_params">params</code></td>
<td>
<p>character vector indicating which parameters to plot, one to any of <code>a</code>, <code>R</code>, or <code>b</code>,  (default all)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function plots 95% credible intervals (2.5th to 97.5th percentiles, approximate posterior distributions) for <code>a</code>, <code>R</code> and/or <code>b</code> using the output from <code><a href="#topic+ebase">ebase</a></code>. Results in the plot are grouped by the <code>ndays</code> argument that was used in <code><a href="#topic+ebase">ebase</a></code>.
</p>


<h3>Value</h3>

<p>A <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code> object
</p>


<h3>Examples</h3>

<pre><code class='language-R'># plot credible intervals
credible_plot(exres)
</code></pre>

<hr>
<h2 id='credible_prep'>Get credible intervals for a, R, b</h2><span id='topic+credible_prep'></span>

<h3>Description</h3>

<p>Get credible intervals for a, R, b
</p>


<h3>Usage</h3>

<pre><code class='language-R'>credible_prep(res, params = c("a", "R", "b"), labels = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="credible_prep_+3A_res">res</code></td>
<td>
<p>output data frame from <code><a href="#topic+ebase">ebase</a></code></p>
</td></tr>
<tr><td><code id="credible_prep_+3A_params">params</code></td>
<td>
<p>character vector indicating which parameters to plot, one to any of <code>a</code>, <code>R</code>, or <code>b</code> (default all)</p>
</td></tr>
<tr><td><code id="credible_prep_+3A_labels">labels</code></td>
<td>
<p>logical indicating of parameter labels are output as an expression for parsing in plot facets, default <code>FALSE</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function gets 95% credible intervals (2.5th to 97.5th percentiles, approximate posterior distributions) for <code>a</code>, <code>R</code>, and/or <code>b</code> using the output from <code><a href="#topic+ebase">ebase</a></code>. The function is used in <code><a href="#topic+credible_plot">credible_plot</a></code>, but is provided as a separate function for convenience.
</p>


<h3>Value</h3>

<p>A data frame
</p>


<h3>Examples</h3>

<pre><code class='language-R'># get credible intervals
credible_prep(exres)
</code></pre>

<hr>
<h2 id='ebase'>Estuarine Bayesian Single-station Estimation method for ecosystem metabolism</h2><span id='topic+ebase'></span>

<h3>Description</h3>

<p>Estuarine Bayesian Single-station Estimation method for ecosystem metabolism
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ebase(
  dat,
  Z,
  interval,
  ndays = 1,
  aprior = c(4, 2),
  rprior = c(300, 150),
  bprior = c(0.251, 0.125),
  bmax = 0.502,
  nogas = FALSE,
  doave = TRUE,
  maxinterp = 43200/interval,
  n.iter = 10000,
  update.chains = TRUE,
  n.burnin = n.iter * 0.5,
  n.chains = 3,
  n.thin = 10,
  model_file = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ebase_+3A_dat">dat</code></td>
<td>
<p>input data frame</p>
</td></tr>
<tr><td><code id="ebase_+3A_z">Z</code></td>
<td>
<p>numeric as single value for water column depth (m) or vector equal in length to number of rows in <code>dat</code></p>
</td></tr>
<tr><td><code id="ebase_+3A_interval">interval</code></td>
<td>
<p>timestep interval in seconds</p>
</td></tr>
<tr><td><code id="ebase_+3A_ndays">ndays</code></td>
<td>
<p>numeric for number of days in <code>dat</code> for optimizing the metabolic equation, see details</p>
</td></tr>
<tr><td><code id="ebase_+3A_aprior">aprior</code></td>
<td>
<p>numeric vector of length two indicating the mean and standard deviation for the prior distribution of the <em>a</em> parameter, see details</p>
</td></tr>
<tr><td><code id="ebase_+3A_rprior">rprior</code></td>
<td>
<p>numeric vector of length two indicating the mean and standard deviation for the prior distribution of the <em>R</em> parameter, see details</p>
</td></tr>
<tr><td><code id="ebase_+3A_bprior">bprior</code></td>
<td>
<p>numeric vector of length two indicating the mean and standard deviation for the prior distribution of the <em>b</em> parameter, see details</p>
</td></tr>
<tr><td><code id="ebase_+3A_bmax">bmax</code></td>
<td>
<p>numeric value for the upper limit on the prior distribution for <code>bprior</code>, set as twice the default value of the mean</p>
</td></tr>
<tr><td><code id="ebase_+3A_nogas">nogas</code></td>
<td>
<p>logical indicating if gas exchange is not included in the metabolic model, see details</p>
</td></tr>
<tr><td><code id="ebase_+3A_doave">doave</code></td>
<td>
<p>logical indicating if the average dissolved oxygen concentration is used as the starting value for the estimation (default), otherwise the first observation will be used if <code>FALSE</code>, see details</p>
</td></tr>
<tr><td><code id="ebase_+3A_maxinterp">maxinterp</code></td>
<td>
<p>numeric value for minimum number of continuous observations that must not be interpolated within a group defined by <code>ndays</code> to assign as <code>NA</code> in output, see details</p>
</td></tr>
<tr><td><code id="ebase_+3A_n.iter">n.iter</code></td>
<td>
<p>number of MCMC iterations, passed to <code><a href="R2jags.html#topic+jags">jags</a></code></p>
</td></tr>
<tr><td><code id="ebase_+3A_update.chains">update.chains</code></td>
<td>
<p>logical to run <code><a href="#topic+metab_update">metab_update</a></code> if chains do not converge</p>
</td></tr>
<tr><td><code id="ebase_+3A_n.burnin">n.burnin</code></td>
<td>
<p>number of MCMC chains to delete, passed to <code><a href="R2jags.html#topic+jags">jags</a></code></p>
</td></tr>
<tr><td><code id="ebase_+3A_n.chains">n.chains</code></td>
<td>
<p>number of MCMC chains to run, passed to <code><a href="R2jags.html#topic+jags">jags</a></code></p>
</td></tr>
<tr><td><code id="ebase_+3A_n.thin">n.thin</code></td>
<td>
<p>number of nth iterations to save for each chain, passed to <code><a href="R2jags.html#topic+jags">jags</a></code></p>
</td></tr>
<tr><td><code id="ebase_+3A_model_file">model_file</code></td>
<td>
<p><code>NULL</code> to use the model file included with the package or a path to a model text file can be used</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Required input data are time series for dissolved oxygen (mg L-1), water temperature (C), salinity (psu), total PAR (W m-2), and wind speed (m s-1).  See the <code><a href="#topic+exdat">exdat</a></code> example data file for a representation of the required data.  Data are typically from continuously monitored water quality and weather parameters are hourly of sub-hourly time steps.  Oxygen concentrations are converted to mmol/m3 prior to metabolic estimation. Water column depth is also required.  This can be supplied as a single value or a vector of length equal to the number of rows in <code>dat</code>.
</p>
<p>The metabolic estimates are based on a mass balance equation in Grace et al. 2015 with the gas exchange estimate from Wanninkhof 2004.  It is similar to that provided by the BASEmetab R package at <a href="https://github.com/dgiling/BASEmetab">https://github.com/dgiling/BASEmetab</a>, with modifications to estimate different parameters. The equation optimized in the JAGS model is:
</p>
<p style="text-align: center;"><code class="reqn"> Z\frac{dC_d}{dt} = aPAR - R + bU_{10}^2\left(\frac{Sc}{600} \right)^{-0.5} \left(C_{Sat} - C_d \right )</code>
</p>

<p>More simply:
</p>
<p style="text-align: center;"><code class="reqn"> Z\frac{dC_d}{dt} = P - R + D</code>
</p>

<p>Net ecosystem metabolism (NEM) is then estimated as:
</p>
<p style="text-align: center;"><code class="reqn">NEM = P - R</code>
</p>

<p>Gross production is provided by <em>aPAR</em>, respiration is provided by <em>R</em>, and gas exchange is provided by the remainder.  The likelihood of the parameters <em>a</em>, <em>R</em>, and <em>b</em> given the observed data are estimated from the JAGS model using prior distributions shown in the model file. At each time step, the change in oxygen concentration between time steps is calculated from the equation using model inputs and parameter guesses, and then a finite difference approximation is used to estimate modeled oxygen concentration.  The first modeled value starts at the mean oxygen concentration for all measurements in the optimization period.  The estimated concentration at each time step is also returned for comparison to observed as one measure of model performance.
</p>
<p>The prior distributions for the <em>a</em>, <em>R</em>, and <em>b</em> parameters are defined in the model file included with the package as normal distributions with mean and standard deviations provided by the <code>aprior</code>, <code>rprior</code>, and <code>bprior</code> arguments. The default values were chosen based on approximate values from national syntheses of metabolic estimates.  An additional constraint is that all the prior distributions are truncated to be positive values as required by the core metabolism equation above. The upper limit for <em>b</em> is set as two times 0.251, as given in eqn. 4 in Wanninkhof 2014. Units for each parameter are (mmol m-2 d-1)/(W m-2) for <em>a</em>, mmol m-2 d-1 for <em>R</em>, and (cm hr-1)/(m2 s-2) for <em>b</em>.
</p>
<p>The <code>ndays</code> argument defines the model optimization period as the number of days that are used for optimizing the above mass balance equation.  By default, this is done each day, i.e., <code>ndays= 1</code> such that a loop is used that applies the model equation to observations within each day, evaluated iteratively from the first observation in a day to the last.  Individual parameter estimates for <em>a</em>, <em>R</em>, and <em>b</em> are then returned for each day.  However, more days can be used to estimate the unknown parameters, such that the loop can be evaluated for every <code>ndays</code> specified by the argument.  The <code>ndays</code> argument will separate the input data into groups of consecutive days, where each group has a total number of days equal to <code>ndays</code>.  The final block may not include the complete number of days specified by <code>ndays</code> if the number of unique dates in the input data includes a remainder when divided by <code>ndays</code>, e.g., if seven days are in the input data and <code>ndays = 5</code>, there will be two groups where the first has five days and the second has two days. The output data from <code>ebase</code> includes a column that specifies the grouping that was used based on <code>ndays</code>.
</p>
<p>Missing values in the input data are also interpolated prior to estimating metabolism.  It is the responsibility of the user to verify that these interpolated values are not wildly inaccurate.  Missing values are linearly interpolated between non-missing values at the time step specified by the value in <code>interval</code>.  This works well for small gaps, but can easily create inaccurate values at gaps larger than a few hours. The <code><a href="#topic+interp_plot">interp_plot</a></code> function can be used to visually assess the interpolated values. Records at the start or end of the input time series that do not include a full day are also removed.  A warning is returned to the console if gaps are found or dangling records are found.
</p>
<p>The <code>maxinterp</code> argument specifies a minimum number of observations that must not be interpolated within groups defined by <code>ndays</code> that are assigned <code>NA</code> in the output (except <code>Date</code> and <code>DateTimeStamp</code>).  Groups with continuous rows of interpolated values with length longer than this argument are assigned <code>NA</code>.  The default value is half a day, i.e., 43200 seconds divided by the value in <code>interval</code>.
</p>
<p>The <code>doave</code> argument can be used to define which dissolved oxygen value is used as the starting point in the Bayesian estimation for the optimization period.  The default setting (<code>doave = TRUE</code>) will use the average of all the dissolved oxygen values in the optimization period defined by <code>ndays</code>.  For example, the average of all dissolved oxygen values in each 24 hour period will be used if <code>doave = TRUE</code> and <code>ndays = 1</code>.  The first dissolved oxygen observation of the time series in the optimization period will be used as the starting point if <code>doave = F</code>.  In this case, the simulated dissolved oxygen time series will always start at the first observed dissolved oxygen value for each optimization period.
</p>


<h3>Value</h3>

<p>A data frame with metabolic estimates for areal gross production (<code>P</code>, O2 mmol m-2 d-1), respiration (<code>R</code>,  O2 mmol m-2 d-1), and gas exchange (<code>D</code>, O2 mmol m-2 d-1, positive values as ingassing, negative values as outgassing).  <code>NEM</code> (net ecosystem metabolism, O2 mmol m-2 d-1) is also returned as <code>P</code> - <code>R</code>. Additional parameters estimated by the model that are returned include <code>a</code> and <code>b</code>.  The <code>a</code> parameter is a constant that represents the primary production per quantum of light with units of (mmol m-2 d-1)/(W m-2) and is used to estimate gross production (Grace et al., 2015).  The <code>b</code> parameter is a constant used to estimate gas exchange in (cm hr-1)/(m2 s-2) (provided as 0.251 in eqn. 4 in Wanninkhof 2014).  Observed dissolved oxygen (<code>DO_obs</code>, mmol m-3), modeled dissolved oxygen (<code>DO_mod</code>, mmol m-3), and delta dissolved oxygen of the modeled results (<code>dDO</code>, mmol m-3 d-1) are also returned.  Note that delta dissolved oxygen is a daily rate.
</p>
<p>95% credible intervals for <code>a</code>, <code>b</code>, and <code>R</code> are also returned in the corresponding columns <code>alo</code>, <code>ahi</code>, <code>blo</code>, <code>bhi</code>, <code>Rlo</code>, and <code>Rhi</code>, for the 2.5th and 97.5th percentile estimates for each parameter, respectively.  These values indicate the interval within which there is a 95% probability that the true parameter is in this range. Note that all values for these parameters are repeated across rows, although only one estimate for each is returned based on the number of days defined by <code>ndays</code>.
</p>
<p>Model fit can also be assessed using the <code>converge</code> and <code>rsq</code> columns.  The values in these columns apply to each group in the <code>grp</code> column as specified with the <code>ndays</code> argument. The <code>converge</code> column indicates <code>"Check convergence"</code> or <code>"Fine"</code> if the JAGS estimate converged at that iteration (repeated across rows for the group).  The <code>n.chains</code> argument can be increased if convergence is not achieved. Similarly, the <code>rsq</code> column shows the r-squared values of the linear fit between the modeled and observed dissolved oxygen (repeated across rows for the group).  These values can also be viewed with <code><a href="#topic+fit_plot">fit_plot</a></code>.
</p>
<p>The <code>nogas</code> argument can be set to <code>TRUE</code> to exclude gas exchange from the metabolic estimates.  This will force the prior distribution for <code>b</code> as mean 0 and standard deviation approximately 0.
</p>


<h3>References</h3>

<p>Grace, M.R., Giling, D.P., Hladyz, S., Caron, V., Thompson, R.M., Nally, R.M., 2015. Fast processing of diel oxygen curves: Estimating stream metabolism with BASE (BAyesian Single-station Estimation). Limnology and Oceanography: Methods 13, e10011. https://doi.org/10.1002/lom3.10011
</p>
<p>Wanninkhof, R., 2014. Relationship between wind speed and gas exchange over the ocean revisited. Limnology and Oceanography: Methods 12, 351â€“362. https://doi.org/10.4319/lom.2014.12.351
</p>


<h3>Examples</h3>

<pre><code class='language-R'># get one day of data
dat &lt;- exdat[as.Date(exdat$DateTimeStamp, tz = 'America/Jamaica') == as.Date('2012-06-01'), ]

# run ebase, use more chains and iterations for a better fit, update.chains as T
ebase(dat, interval = 900, Z = 1.85, n.chains = 2, n.iter = 50, 
 update.chains = FALSE)
</code></pre>

<hr>
<h2 id='ebase_eqboxy'>Oxygen saturation</h2><span id='topic+ebase_eqboxy'></span>

<h3>Description</h3>

<p>Oxygen saturation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ebase_eqboxy(temp, salt)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ebase_eqboxy_+3A_temp">temp</code></td>
<td>
<p>numeric for temperature (C)</p>
</td></tr>
<tr><td><code id="ebase_eqboxy_+3A_salt">salt</code></td>
<td>
<p>numeric for salinity (PSU)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function to calculate equilibrium OXYGEN concentration in seawater, from water temparure (C) and salinity (PSU)
</p>


<h3>Value</h3>

<p>oxysat (mmol/m^3)
</p>


<h3>References</h3>

<p>Garcia, H., Gordon, L.I., 1992. Oxygen solubility in seawater: Better fitting equations. Limnology and Oceanography 37, 1307-1312. https://doi.org/10.4319/lo.1992.37.6.1307
</p>


<h3>Examples</h3>

<pre><code class='language-R'>temp &lt;- c(10, 20, 30)
salt &lt;- c(30, 35, 40)
ebase_eqboxy(temp = temp, salt = salt)
</code></pre>

<hr>
<h2 id='ebase_form'>Format ebase output</h2><span id='topic+ebase_form'></span>

<h3>Description</h3>

<p>Format ebase output
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ebase_form(out, dat, interval, maxinterp = 43200/interval)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ebase_form_+3A_out">out</code></td>
<td>
<p>data.frame for model output</p>
</td></tr>
<tr><td><code id="ebase_form_+3A_dat">dat</code></td>
<td>
<p>data.frame as returned by <code><a href="#topic+ebase_prep">ebase_prep</a></code></p>
</td></tr>
<tr><td><code id="ebase_form_+3A_interval">interval</code></td>
<td>
<p>timestep interval in seconds</p>
</td></tr>
<tr><td><code id="ebase_form_+3A_maxinterp">maxinterp</code></td>
<td>
<p>numeric value for minimum number of continuous observations that must not be interpolated within a group defined by <code>ndays</code> to assign as <code>NA</code> in output</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is used internally with <code><a href="#topic+ebase">ebase</a></code> and should not be called by itself.
</p>


<h3>Value</h3>

<p>Formatted output for <code><a href="#topic+ebase">ebase</a></code> with interpolated rows as <code>NA</code> (except <code>Date</code> and <code>DateTimeStamp</code> as defined by <code>maxinterp</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)

# get four days of data
dat &lt;- exdat %&gt;% 
  filter(lubridate::month(DateTimeStamp) == 6) %&gt;% 
  filter(lubridate::day(DateTimeStamp) %in% 1:4)
dat &lt;- ebase_prep(dat, Z = 1.85, interval = 900, ndays = 1)

ebase_form(exres, dat, interval = 900, maxinterp = 48) 
</code></pre>

<hr>
<h2 id='ebase_plot'>Plot results from EBASE</h2><span id='topic+ebase_plot'></span>

<h3>Description</h3>

<p>Plot results from EBASE
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ebase_plot(res, asnem = FALSE, instantaneous = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ebase_plot_+3A_res">res</code></td>
<td>
<p>output data frame from <code><a href="#topic+ebase">ebase</a></code></p>
</td></tr>
<tr><td><code id="ebase_plot_+3A_asnem">asnem</code></td>
<td>
<p>logical indicating if <code>NEM</code> is plotted with <code>P</code> and negative <code>R</code>, see details</p>
</td></tr>
<tr><td><code id="ebase_plot_+3A_instantaneous">instantaneous</code></td>
<td>
<p>logical indicating if results are instantaneous (default) or averaged to daily</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The plot shows <code>P</code>, <code>R</code>, and <code>D</code> over time as positive values if <code>asnem = F</code> (default). Positive values for <code>D</code> are ingassing, negative outgassing.
</p>
<p>If <code>asnem = T</code>, <code>NEM</code> is plotted as a separate line as the difference between <code>P</code> and <code>R</code>. <code>R</code> is shown as negative values to indicate the negative influence on <code>NEM</code>. <code>D</code> is also excluded.
</p>
<p>If <code>instantaneous = F</code>, the plot shows daily-averaged values.  The y-axis units are the same for daily or instantaneous values.
</p>


<h3>Value</h3>

<p>A <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># plot instantaneous
ebase_plot(exres)

# plot NEM, negative R, exclude D
ebase_plot(exres, asnem = TRUE)

# plot daily-averaged
ebase_plot(exres, instantaneous = FALSE)
</code></pre>

<hr>
<h2 id='ebase_prep'>Prepare data for ebase</h2><span id='topic+ebase_prep'></span>

<h3>Description</h3>

<p>Prepare data for ebase
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ebase_prep(dat, Z, interval, ndays = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ebase_prep_+3A_dat">dat</code></td>
<td>
<p>input data frame</p>
</td></tr>
<tr><td><code id="ebase_prep_+3A_z">Z</code></td>
<td>
<p>numeric as single value for water column depth (m) or vector equal in length to number of rows in <code>dat</code></p>
</td></tr>
<tr><td><code id="ebase_prep_+3A_interval">interval</code></td>
<td>
<p>timestep interval in seconds</p>
</td></tr>
<tr><td><code id="ebase_prep_+3A_ndays">ndays</code></td>
<td>
<p>numeric for number of days in <code>dat</code> for optimizing the metabolic equation, see details</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Checks if all columns are present by matching those in <code><a href="#topic+exdat">exdat</a></code>, checks if <code>DateTimeStamp</code> is in ascending order, converts dissolved oxygen from mg/L to mmol/m3, calculates the Schmidt number (unitless) from water temp (C) and salinity (psu), and calculates dissolved oxygen equilibrium concentration (mmol/m3) from salinity and temperature
</p>
<p>The <code>ndays</code> argument defines the number of days that are used for optimizing the above mass balance equation.  By default, this is done each day, i.e., <code>ndays= 1</code> such that a loop is used that applies the model equation to observations within each day, evaluated iteratively from the first observation in a day to the last.  Individual parameter estimates for <em>a</em>, <em>R</em>, and <em>b</em> are then returned for each day.  However, more days can be used to estimate the unknown parameters, such that the loop can be evaluated for every <code>ndays</code> specified by the argument.  The <code>ndays</code> argument will separate the input data into groups of consecutive days, where each group has a total number of days equal to <code>ndays</code>.  The final block may not include the complete number of days specified by <code>ndays</code> if the number of unique dates in the input data includes a remainder when divided by <code>ndays</code>, e.g., if seven days are in the input data and <code>ndays = 5</code>, there will be two groups where the first has five days and the second has two days. The output data from <code><a href="#topic+ebase">ebase</a></code> includes a column that specifies the grouping that was used based on <code>ndays</code>.
</p>
<p>Missing values are interpolated at the interval specified by the <code>interval</code> argument for conformance with the core model equation. Records at the start or end of the input time series that do not include a full day are also removed.  A warning is returned to the console if gaps are found or dangling records are found.
</p>


<h3>Value</h3>

<p>A data frame with additional columns required for <code><a href="#topic+ebase">ebase</a></code>. Dissolved oxygen as a volumetric concentration in <code>dat</code> as mg/L is returned in areal units as mmol/m2. If multiple time steps are identified, the number of rows in data frame is expanded based on the time step define by <code>interval</code>.  Numeric values in the expanded rows will be interpolated if <code>interp = TRUE</code>, otherwise they will remain as <code>NA</code> values.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dat &lt;- ebase_prep(exdat, Z = 1.85, interval = 900)
head(dat)
</code></pre>

<hr>
<h2 id='ebase_rho'>Seawater density calculation</h2><span id='topic+ebase_rho'></span>

<h3>Description</h3>

<p>Seawater density calculation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ebase_rho(temp, salt, P)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ebase_rho_+3A_temp">temp</code></td>
<td>
<p>numeric for temperature (C)</p>
</td></tr>
<tr><td><code id="ebase_rho_+3A_salt">salt</code></td>
<td>
<p>numeric for salinity (PSU)</p>
</td></tr>
<tr><td><code id="ebase_rho_+3A_p">P</code></td>
<td>
<p>numeric for pressure above atmospheric (dbar)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Density of seawater is calculated according to the internationally accepted (UNESCO) equations. The standard error of the equation is 3.6 x 10-3 kg/m-3.
</p>


<h3>Value</h3>

<p>Rho (kg/m^3)
</p>


<h3>References</h3>

<p>Millero, F.J., Poisson, A., 1981. International one-atmosphere equation of state of seawater. Deep Sea Research 28, 625-629. https://doi.org/10.1016/0198-0149(81)90122-9
</p>


<h3>Examples</h3>

<pre><code class='language-R'>temp &lt;- c(10, 20, 30)
salt &lt;- c(30, 35, 40)
ebase_rho(temp = temp, salt = salt, P = 0)
</code></pre>

<hr>
<h2 id='ebase_schmidt'>Schmidt number calculation</h2><span id='topic+ebase_schmidt'></span>

<h3>Description</h3>

<p>Schmidt number calculation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ebase_schmidt(temp, salt)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ebase_schmidt_+3A_temp">temp</code></td>
<td>
<p>numeric for temperature (C)</p>
</td></tr>
<tr><td><code id="ebase_schmidt_+3A_salt">salt</code></td>
<td>
<p>numeric for salinity (PSU)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The Schmidt number is calculated for the air-sea gas transfer velocity.
</p>


<h3>Value</h3>

<p>sc (unitless)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>temp &lt;- c(10, 20, 30)
salt &lt;- c(30, 35, 40)
ebase_schmidt(temp = temp, salt = salt)
</code></pre>

<hr>
<h2 id='ebase_years'>Estuarine Bayesian Single-station Estimation method for ecosystem metabolism for long time series</h2><span id='topic+ebase_years'></span>

<h3>Description</h3>

<p>Estuarine Bayesian Single-station Estimation method for ecosystem metabolism for long time series
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ebase_years(
  dat,
  Z,
  interval,
  ndays = 1,
  aprior = c(4, 2),
  rprior = c(300, 150),
  bprior = c(0.251, 0.125),
  bmax = 0.502,
  nogas = FALSE,
  doave = TRUE,
  maxinterp = 43200/interval,
  n.iter = 10000,
  update.chains = TRUE,
  n.burnin = n.iter * 0.5,
  n.chains = 3,
  n.thin = 10,
  model_file = NULL,
  ncores = NULL,
  quiet = TRUE,
  maxtry = 5
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ebase_years_+3A_dat">dat</code></td>
<td>
<p>input data frame</p>
</td></tr>
<tr><td><code id="ebase_years_+3A_z">Z</code></td>
<td>
<p>numeric as single value for water column depth (m) or vector equal in length to number of rows in <code>dat</code></p>
</td></tr>
<tr><td><code id="ebase_years_+3A_interval">interval</code></td>
<td>
<p>timestep interval in seconds</p>
</td></tr>
<tr><td><code id="ebase_years_+3A_ndays">ndays</code></td>
<td>
<p>numeric for number of days in <code>dat</code> for optimizing the metabolic equation, see details</p>
</td></tr>
<tr><td><code id="ebase_years_+3A_aprior">aprior</code></td>
<td>
<p>numeric vector of length two indicating the mean and standard deviation for the prior distribution of the <em>a</em> parameter, see details</p>
</td></tr>
<tr><td><code id="ebase_years_+3A_rprior">rprior</code></td>
<td>
<p>numeric vector of length two indicating the mean and standard deviation for the prior distribution of the <em>R</em> parameter, see details</p>
</td></tr>
<tr><td><code id="ebase_years_+3A_bprior">bprior</code></td>
<td>
<p>numeric vector of length two indicating the mean and standard deviation for the prior distribution of the <em>b</em> parameter, see details</p>
</td></tr>
<tr><td><code id="ebase_years_+3A_bmax">bmax</code></td>
<td>
<p>numeric value for the upper limit on the prior distribution for <code>bprior</code>, set as twice the default value of the mean</p>
</td></tr>
<tr><td><code id="ebase_years_+3A_nogas">nogas</code></td>
<td>
<p>logical indicating if gas exchange is not included in the metabolic model, see details</p>
</td></tr>
<tr><td><code id="ebase_years_+3A_doave">doave</code></td>
<td>
<p>logical indicating if the average dissolved oxygen concentration is used as the starting value for the estimation (default), otherwise the first observation will be used if <code>FALSE</code>, see details</p>
</td></tr>
<tr><td><code id="ebase_years_+3A_maxinterp">maxinterp</code></td>
<td>
<p>numeric value for minimum number of continuous observations that must not be interpolated within a group defined by <code>ndays</code> to assign as <code>NA</code> in output, see details</p>
</td></tr>
<tr><td><code id="ebase_years_+3A_n.iter">n.iter</code></td>
<td>
<p>number of MCMC iterations, passed to <code><a href="R2jags.html#topic+jags">jags</a></code></p>
</td></tr>
<tr><td><code id="ebase_years_+3A_update.chains">update.chains</code></td>
<td>
<p>logical to run <code><a href="#topic+metab_update">metab_update</a></code> if chains do not converge</p>
</td></tr>
<tr><td><code id="ebase_years_+3A_n.burnin">n.burnin</code></td>
<td>
<p>number of MCMC chains to delete, passed to <code><a href="R2jags.html#topic+jags">jags</a></code></p>
</td></tr>
<tr><td><code id="ebase_years_+3A_n.chains">n.chains</code></td>
<td>
<p>number of MCMC chains to run, passed to <code><a href="R2jags.html#topic+jags">jags</a></code></p>
</td></tr>
<tr><td><code id="ebase_years_+3A_n.thin">n.thin</code></td>
<td>
<p>number of nth iterations to save for each chain, passed to <code><a href="R2jags.html#topic+jags">jags</a></code></p>
</td></tr>
<tr><td><code id="ebase_years_+3A_model_file">model_file</code></td>
<td>
<p><code>NULL</code> to use the model file included with the package or a path to a model text file can be used</p>
</td></tr>
<tr><td><code id="ebase_years_+3A_ncores">ncores</code></td>
<td>
<p>numeric for number of cores to use for parallel processing, use <code>NULL</code> to suppress</p>
</td></tr>
<tr><td><code id="ebase_years_+3A_quiet">quiet</code></td>
<td>
<p>logical to suppress progress messages to the console</p>
</td></tr>
<tr><td><code id="ebase_years_+3A_maxtry">maxtry</code></td>
<td>
<p>numeric for maximum number of times to retry the model if it fails</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code><a href="#topic+ebase">ebase</a></code> is run for each year in the supplied data. This facilitates running <code><a href="#topic+ebase">ebase</a></code> on long time series by running the model sequentially on each year of data, with progress messages printed to the console if <code>quiet = FALSE</code>. The model run for each year will restart if it fails, up to <code>maxtry</code> times, after which processing continues with the next year.  The model is run in parallel using the number of cores used set by <code>ncores</code>. If <code>ncores = NULL</code>, sequential processing is used.  All other arguments are passed to <code><a href="#topic+ebase">ebase</a></code>.
</p>
<p>Similar results can be obtained by running <code><a href="#topic+ebase">ebase</a></code> on the entire data set, but this function is useful for long time series where the model may fail for some years, e.g., when weather data may be missing for some years.
</p>


<h3>Value</h3>

<p>Output identical to that returned by <code><a href="#topic+ebase">ebase</a></code>, where the results for each year are appended to the data frame as the function progresses through the years. Note that the <code>grp</code> column that specifies the optimization period defined by <code>ndays</code> is unique to each year, e.g., values will be repeated across years.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># get one day of data
dat &lt;- exdat[as.Date(exdat$DateTimeStamp, tz = 'America/Jamaica') == as.Date('2012-06-01'), ]

# run ebase, use more chains and iterations for a better fit, update.chains as T
ebase_years(dat, Z = 1.85, interval = 900, n.chains = 2, n.iter = 50, 
 update.chains = FALSE)
</code></pre>

<hr>
<h2 id='exdat'>Sample data from Apalachicola NERRS</h2><span id='topic+exdat'></span>

<h3>Description</h3>

<p>Sample data from Apalachicola NERRS
</p>


<h3>Usage</h3>

<pre><code class='language-R'>exdat
</code></pre>


<h3>Format</h3>

<p>A <code>data.frame</code> object with 27648 rows and 6 columns
</p>

<dl>
<dt>DateTimeStamp</dt><dd><p>date and time, America/Jamaica time zone, 15 minute time step</p>
</dd>
<dt>DO_obs</dt><dd><p>dissolved oxygen, mg/L</p>
</dd>
<dt>Temp</dt><dd><p>water temperature, C</p>
</dd>
<dt>Sal</dt><dd><p>salinity, psu</p>
</dd>
<dt>PAR</dt><dd><p>total PAR, W/m2</p>
</dd>
<dt>WSpd</dt><dd><p>num, m/s</p>
</dd>
</dl>



<h3>See Also</h3>

<p>Other utilities: 
<code><a href="#topic+exres">exres</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>head(exdat)
</code></pre>

<hr>
<h2 id='exres'>Example results for four days from Apalachicola NERRS</h2><span id='topic+exres'></span>

<h3>Description</h3>

<p>Example results for four days from Apalachicola NERRS
</p>


<h3>Usage</h3>

<pre><code class='language-R'>exres
</code></pre>


<h3>Format</h3>

<p>A data frame with 384 observations and 29 variables:
</p>

<dl>
<dt>DateTimeStamp</dt><dd><p>POSIXct, format: &quot;2012-06-01 00:00:00&quot; &quot;2012-06-01 00:15:00&quot; ...</p>
</dd>
<dt>Date</dt><dd><p>Date, format: &quot;2012-06-01&quot; &quot;2012-06-01&quot; ...</p>
</dd>
<dt>grp</dt><dd><p>Numeric, grouping variable defined by <code>ndays</code> in <code><a href="#topic+ebase">ebase</a></code></p>
</dd>
<dt>Z</dt><dd><p>Numeric, depth in meters</p>
</dd>
<dt>DO_obs</dt><dd><p>Numeric, observed dissolved oxygen, mmol m-3</p>
</dd>
<dt>DO_mod</dt><dd><p>Numeric, modelled dissolved oxygen, mmol m-3</p>
</dd>
<dt>DO_modlo</dt><dd><p>Numeric, lower credible interval of modelled dissolved oxygen</p>
</dd>
<dt>DO_modhi</dt><dd><p>Numeric, upper credible interval of modelled dissolved oxygen</p>
</dd>
<dt>dDO</dt><dd><p>Numeric, change in dissolved oxygen, mmol m-3 d-1</p>
</dd>
<dt>converge</dt><dd><p>Character, convergence status</p>
</dd>
<dt>rsq</dt><dd><p>Numeric, R-squared value</p>
</dd>
<dt>a</dt><dd><p>Numeric, parameter a (mmol m-2 d-1)/(W m-2)</p>
</dd>
<dt>alo</dt><dd><p>Numeric, lower credible interval of parameter a</p>
</dd>
<dt>ahi</dt><dd><p>Numeric, upper credible interval of parameter a</p>
</dd>
<dt>b</dt><dd><p>Numeric, parameter b, (cm hr-1)/(m2 s-2)</p>
</dd>
<dt>blo</dt><dd><p>Numeric, lower credible interval of parameter b</p>
</dd>
<dt>bhi</dt><dd><p>Numeric, upper credible interval of parameter b</p>
</dd>
<dt>P</dt><dd><p>Numeric, production, O2 mmol m-2 d-1</p>
</dd>
<dt>Plo</dt><dd><p>Numeric, lower credible interval of parameter P</p>
</dd>
<dt>Phi</dt><dd><p>Numeric, upper credible interval of parameter P</p>
</dd>
<dt>R</dt><dd><p>Numeric, respiration, O2 mmol m-2 d-1</p>
</dd>
<dt>Rlo</dt><dd><p>Numeric, lower credible interval of parameter R</p>
</dd>
<dt>Rhi</dt><dd><p>Numeric, upper credible interval of parameter R</p>
</dd>
<dt>NEM</dt><dd><p>Numeric, net ecosystem metabolism, O2 mmol m-2 d-1</p>
</dd>
<dt>NEMlo</dt><dd><p>Numeric, lower credible interval of parameter NEM</p>
</dd>
<dt>NEMhi</dt><dd><p>Numeric, upper credible interval of parameter NEM</p>
</dd>
<dt>D</dt><dd><p>Numeric, gas exchange, O2 mmol m-2 d-1)</p>
</dd>
<dt>Dlo</dt><dd><p>Numeric, lower credible interval of parameter D</p>
</dd>
<dt>Dhi</dt><dd><p>Numeric, upper credible interval of parameter D</p>
</dd>
</dl>



<h3>See Also</h3>

<p>Other utilities: 
<code><a href="#topic+exdat">exdat</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>head(exres)
</code></pre>

<hr>
<h2 id='fit_plot'>Plot observed and modeled dissolved oxygen</h2><span id='topic+fit_plot'></span>

<h3>Description</h3>

<p>Plot observed and modeled dissolved oxygen
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_plot(res, bygroup = FALSE, scatter = FALSE, showfit = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fit_plot_+3A_res">res</code></td>
<td>
<p>output data frame from <code><a href="#topic+ebase">ebase</a></code></p>
</td></tr>
<tr><td><code id="fit_plot_+3A_bygroup">bygroup</code></td>
<td>
<p>logical indicating if the plot is faceted by group</p>
</td></tr>
<tr><td><code id="fit_plot_+3A_scatter">scatter</code></td>
<td>
<p>logical indicating if a scatter plot of modeled versus estimated dissolved oxygen is returned</p>
</td></tr>
<tr><td><code id="fit_plot_+3A_showfit">showfit</code></td>
<td>
<p>logical indicating if a linear fit is shown in the plot, applies only if <code>scatter = TRUE</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Dissolved oxygen (mmol/m3) is plotted as observed from the input data (points) and modeled (lines) based on inputs to <code><a href="#topic+ebase">ebase</a></code> if <code>scatter = FALSE</code>.  A scatter plot of modeled versus estimated dissolved oxygen is returned if <code>scatter = TRUE</code>, including a linear fit if <code>showfit = TRUE</code>.  The plot is faceted by group based on the <code>ndays</code> argument to <code><a href="#topic+ebase">ebase</a></code> if <code>bygroup = TRUE</code>.  The r-squared value of the fit between modeled and observed dissolved oxygen is also shown in the facet label for the group if <code>bygroup = TRUE</code>.
</p>


<h3>Value</h3>

<p>A <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code> object
</p>


<h3>Examples</h3>

<pre><code class='language-R'># plot observed and modeled DO
fit_plot(exres)

# plot observed and modeled DO by group
fit_plot(exres, bygroup = TRUE)

# as scatter plot
fit_plot(exres, scatter = TRUE)

# as scatter plot by group
fit_plot(exres, scatter = TRUE, bygroup = TRUE)
</code></pre>

<hr>
<h2 id='interp_plot'>Create a diagnostic plot showing interpolated values prior to metabolism estimates</h2><span id='topic+interp_plot'></span>

<h3>Description</h3>

<p>Create a diagnostic plot showing interpolated values prior to metabolism estimates
</p>


<h3>Usage</h3>

<pre><code class='language-R'>interp_plot(
  dat,
  param = c("DO_obs", "DO_sat", "Z", "Temp", "Sal", "PAR", "WSpd", "sc"),
  Z,
  interval,
  ndays = 1
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="interp_plot_+3A_dat">dat</code></td>
<td>
<p>input data frame</p>
</td></tr>
<tr><td><code id="interp_plot_+3A_param">param</code></td>
<td>
<p>character string of the parameter to plot, one of <code>DO_obs</code>, <code>DO_sat</code>, <code>Z</code>, <code>Temp</code>, <code>Sal</code>, <code>PAR</code>, <code>WSpd</code>, or <code>sc</code></p>
</td></tr>
<tr><td><code id="interp_plot_+3A_z">Z</code></td>
<td>
<p>numeric as single value for water column depth (m) or vector equal in length to number of rows in <code>dat</code></p>
</td></tr>
<tr><td><code id="interp_plot_+3A_interval">interval</code></td>
<td>
<p>timestep interval in seconds</p>
</td></tr>
<tr><td><code id="interp_plot_+3A_ndays">ndays</code></td>
<td>
<p>numeric for number of days in <code>dat</code> for optimizing the metabolic equation, see details</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Missing values in the input data can also be interpolated prior to estimating metabolism.  This is the default behavior and it is the responsibility of the user to verify that these interpolated values are not wildly inaccurate.  Missing values are linearly interpolated between non-missing values at the time step specified by the value in <code>interval</code>.  This works well for small gaps, but can easily create inaccurate values at gaps larger than a few hours. The plot from this function can be used to visually assess the interpolated gaps.
</p>


<h3>Value</h3>

<p>A <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code> object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)

# get four days of data
dat &lt;- exdat %&gt;% 
  filter(lubridate::month(DateTimeStamp) == 6) %&gt;% 
  filter(lubridate::day(DateTimeStamp) %in% 1:4)
  
# create missing values
set.seed(222)
dat &lt;- dat %&gt;% 
  slice_sample(prop = 0.9) %&gt;% 
  arrange(DateTimeStamp)

interp_plot(dat, Z = 1.85, interval = 900, param = 'DO_sat')
</code></pre>

<hr>
<h2 id='metab_update'>Update metabolism jags fit</h2><span id='topic+metab_update'></span>

<h3>Description</h3>

<p>Update metabolism jags fit
</p>


<h3>Usage</h3>

<pre><code class='language-R'>metab_update(metabfit, update.chains, n.iter)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="metab_update_+3A_metabfit">metabfit</code></td>
<td>
<p>initial jags metabolism output</p>
</td></tr>
<tr><td><code id="metab_update_+3A_update.chains">update.chains</code></td>
<td>
<p>logical to update, only if TRUE</p>
</td></tr>
<tr><td><code id="metab_update_+3A_n.iter">n.iter</code></td>
<td>
<p>number of iterations</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is used by <code><a href="#topic+ebase">ebase</a></code> and is not to be called directly by the user.  It provides additional model iterations if convergence is not achieved.
</p>


<h3>Value</h3>

<p>Updated jags metabolism output
</p>

<hr>
<h2 id='prior_plot'>Plot prior distributions for a, R, and b</h2><span id='topic+prior_plot'></span>

<h3>Description</h3>

<p>Plot prior distributions for a, R, and b
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prior_plot(
  aprior = c(4, 2),
  rprior = c(300, 150),
  bprior = c(0.251, 0.125),
  bmax = 0.502,
  n = 1000
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="prior_plot_+3A_aprior">aprior</code></td>
<td>
<p>numeric vector of length two indicating the mean and standard deviation for the prior distribution of the <em>a</em> parameter, see details</p>
</td></tr>
<tr><td><code id="prior_plot_+3A_rprior">rprior</code></td>
<td>
<p>numeric vector of length two indicating the mean and standard deviation for the prior distribution of the <em>R</em> parameter, see details</p>
</td></tr>
<tr><td><code id="prior_plot_+3A_bprior">bprior</code></td>
<td>
<p>numeric vector of length two indicating the mean and standard deviation for the prior distribution of the <em>b</em> parameter, see details</p>
</td></tr>
<tr><td><code id="prior_plot_+3A_bmax">bmax</code></td>
<td>
<p>numeric value for the upper limit on the prior distribution for <code>bprior</code>, set as twice the default value of the mean</p>
</td></tr>
<tr><td><code id="prior_plot_+3A_n">n</code></td>
<td>
<p>numeric indicating number of random samples to draw from prior distributions</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function produces a plot of the prior distributions that are used in <code><a href="#topic+ebase">ebase</a></code> for the <em>a</em>, <em>R</em>, and <em>b</em> parameters for the optimization equation for estimating metabolism.  The <code><a href="#topic+ebase">ebase</a></code> function uses the same default values for the arguments for <code>aprior</code>, <code>rprior</code>, and <code>bprior</code> as required for this function.  If the default values are changed for <code><a href="#topic+ebase">ebase</a></code>, this function can be used to assess how changing characteristics of the prior distributions could influence the resulting parameter estimates and their posterior distributions (e.g., as shown with <code><a href="#topic+credible_plot">credible_plot</a></code>.
</p>
<p>All parameters follow a normal Gaussian distribution for the priors with the means and standard deviations defined by the arguments. All distributions are truncated to include only values greater than zero as required by the core metabolism equation. The upper limit for <em>b</em> is also set as twice the default value of the mean in the <code>bprior</code> argument. Truncated normal distributions are obtained using the <code><a href="truncnorm.html#topic+rtruncnorm">rtruncnorm</a></code> function with the number of random samples defined by the <code>n</code> argument.
</p>
<p>The density curves for each parameter are normalized such that the peak values are always equal to 1.
</p>


<h3>Value</h3>

<p>A <code><a href="ggplot2.html#topic+ggplot">ggplot</a></code> object
</p>


<h3>Examples</h3>

<pre><code class='language-R'># default plot
prior_plot()

# changing the mean and standard deviation for the b parameter
prior_plot(bprior = c(0.2, 0.05))
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
