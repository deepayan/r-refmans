<!DOCTYPE html><html><head><title>Help for package BayesSurvival</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {BayesSurvival}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#BayesSurv'><p>Compute the posterior mean and a credible band for the survival and</p>
cumulative hazard, and the posterior mean for the hazard.</a></li>
<li><a href='#CumhazEval'><p>Evaluate whether a true cumulative hazard function is contained</p>
in the credible set.</a></li>
<li><a href='#MCMCDepGammaFirst'><p>Sampler for the first interval for the piecewise exponential prior</p>
with dependent Gamma heights.</a></li>
<li><a href='#MCMCDepGammaIntermediate'><p>Sampler for the intermediate intervals for the piecewise exponential prior</p>
with dependent Gamma heights.</a></li>
<li><a href='#PlotBayesSurv'><p>Plot the posterior mean with credible band for the survival function</p>
or cumulative hazard, or the posterior mean for the hazard</a></li>
<li><a href='#RadiusCredibleSet'><p>Computes the radius of a fixed width credible set for the</p>
survival or the cumulative hazard</a></li>
<li><a href='#ReshapeData'><p>Reshape right censored data to be used with a piecewise exponential</p>
prior.</a></li>
<li><a href='#SamplePosteriorDepGamma'><p>Draw samples from the posterior for the hazard, using the piecewise</p>
exponential (histogram) prior with dependent Gamma heights</a></li>
<li><a href='#SamplePosteriorIndepGamma'><p>Draw samples from the posterior for the hazard, using the piecewise</p>
exponential (histogram) prior with independent Gamma heights</a></li>
<li><a href='#SurvEval'><p>Evaluate whether a true survival function is contained</p>
in the credible set.</a></li>
<li><a href='#SurvivalFromCumhaz'><p>Transform posterior draws from the cumulative hazard into posterior</p>
draws from the survival.</a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Bayesian Survival Analysis for Right Censored Data</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.0</td>
</tr>
<tr>
<td>Author:</td>
<td>Stephanie van der Pas [aut, cre],
    Ismael Castillo [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Stephanie van der Pas &lt;s.l.vanderpas@amsterdamumc.nl&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Performs unadjusted Bayesian survival analysis for right censored time-to-event data. The main function, BayesSurv(), computes the posterior mean and a credible band for the survival function and for the cumulative hazard, as well as the posterior mean for the hazard, starting from a piecewise exponential (histogram) prior with Gamma distributed heights that are either independent, or have a Markovian dependence structure.
    A function, PlotBayesSurv(), is provided to easily create plots of the posterior means of the hazard, cumulative hazard and survival function, with a credible band accompanying the latter two.
    The priors and samplers are described in more detail in Castillo and Van der Pas (2020) "Multiscale Bayesian survival analysis" &lt;<a href="https://arxiv.org/abs/2005.02889">arXiv:2005.02889</a>&gt;. In that paper it is also shown that the credible bands for the survival function and the cumulative hazard can be considered confidence bands (under mild conditions) and thus offer reliable uncertainty quantification.</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>LazyData:</td>
<td>false</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.6.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>survival, stats, ggplot2</td>
</tr>
<tr>
<td>Suggests:</td>
<td>simsurv, knitr, rmarkdown</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.0</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-03-12 15:53:58 UTC; stephanie</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-03-12 21:00:13 UTC</td>
</tr>
</table>
<hr>
<h2 id='BayesSurv'>Compute the posterior mean and a credible band for the survival and
cumulative hazard, and the posterior mean for the hazard.</h2><span id='topic+BayesSurv'></span>

<h3>Description</h3>

<p>This is the main function of this package, computing relevant quantities for
a Bayesian survival analysis of (possibly right-censored) time-to-event-data.
Starting with a piecewise exponential prior with dependent or independent
Gamma heights (details below) on the hazard function, the function computes
the posterior mean for the hazard, cumulative hazard and survival function,
serving as an estimator for the true functions. In addition, for the
cumulative hazard and survival function, the radius for a fixed-width
credible band is computed. The interpretation of this credible band as a
confidence band is justified in Castillo and Van der Pas (2020).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>BayesSurv(
  df,
  time = "time",
  event = "event",
  prior = c("Dependent", "Independent"),
  K = ceiling((dim(df)[1]/log(dim(df)[1]))^(1/2)),
  time.max = max(df[[time]]),
  alpha = 0.05,
  N = 1000,
  alpha.dep = 1,
  alpha0.dep = 1.5,
  beta0.dep = 1,
  alpha.indep = 1.5,
  beta.indep = 1,
  surv.factor = 10,
  surv.epsilon = 1e-10
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="BayesSurv_+3A_df">df</code></td>
<td>
<p>A dataframe, containing at minimum a column with follow-up times
and a column with a status indicator (event observed or censored).</p>
</td></tr>
<tr><td><code id="BayesSurv_+3A_time">time</code></td>
<td>
<p>The name of the column in the dataframe containing the (possibly
right-censored) follow-up times, that is, the minimum of the time of the
event and the time of censoring. Input the name as character/string.</p>
</td></tr>
<tr><td><code id="BayesSurv_+3A_event">event</code></td>
<td>
<p>The name of the column in the dataframe containing the status
indicator, which must be coded as: 0 = censored, 1 = event observed. Input
the name as character/string.</p>
</td></tr>
<tr><td><code id="BayesSurv_+3A_prior">prior</code></td>
<td>
<p>Select either dependent or independent Gamma heights for the
piecewise exponential prior on the hazard. Dependent heights (with the
Markov structure described below) is default.</p>
</td></tr>
<tr><td><code id="BayesSurv_+3A_k">K</code></td>
<td>
<p>The number of intervals to be used in the piecewise exponential
(histogram) prior. Default is set to <code class="reqn">K = (n / \log{n})^{1/2}</code>, with
<code class="reqn">n</code> the number of observations, as recommended by Castillo and Van der
Pas (2020).</p>
</td></tr>
<tr><td><code id="BayesSurv_+3A_time.max">time.max</code></td>
<td>
<p>The maximum follow-up time to consider, corresponding to the
parameter <code class="reqn">\tau</code> in Castillo and Van der Pas (2020).</p>
</td></tr>
<tr><td><code id="BayesSurv_+3A_alpha">alpha</code></td>
<td>
<p>The function will compute (1-<code>alpha</code>)100% credible bands
for the cumulative hazard and survival function.</p>
</td></tr>
<tr><td><code id="BayesSurv_+3A_n">N</code></td>
<td>
<p>The number of samples to draw from the posterior.</p>
</td></tr>
<tr><td><code id="BayesSurv_+3A_alpha.dep">alpha.dep</code></td>
<td>
<p>For the dependent Gamma prior only. The main parameter
<code class="reqn">\alpha</code> for the dependent Gamma prior, as described below. It is
recommended to take <code>alpha.dep</code> smaller than <code>alpha0.dep</code>.</p>
</td></tr>
<tr><td><code id="BayesSurv_+3A_alpha0.dep">alpha0.dep</code></td>
<td>
<p>For the dependent Gamma prior only. The shape parameter for
the Gamma prior on the histogram height for the first interval. It is
recommended to take <code>alpha.dep</code> smaller than <code>alpha0.dep</code>.</p>
</td></tr>
<tr><td><code id="BayesSurv_+3A_beta0.dep">beta0.dep</code></td>
<td>
<p>For the dependent Gamma prior only. The rate parameter for
the Gamma prior on the histogram height for the first interval.</p>
</td></tr>
<tr><td><code id="BayesSurv_+3A_alpha.indep">alpha.indep</code></td>
<td>
<p>For the independent Gamma prior only. The shape parameter
for the Gamma prior on the histogram height for each interval.</p>
</td></tr>
<tr><td><code id="BayesSurv_+3A_beta.indep">beta.indep</code></td>
<td>
<p>For the independent Gamma prior only. The rate parameter
for the Gamma prior on the histogram height for each interval.</p>
</td></tr>
<tr><td><code id="BayesSurv_+3A_surv.factor">surv.factor</code></td>
<td>
<p>The survival function is computed on an equispaced grid
consisting of <code>K x surv.factor</code> (the number of intervals times this
factor).</p>
</td></tr>
<tr><td><code id="BayesSurv_+3A_surv.epsilon">surv.epsilon</code></td>
<td>
<p>The survival function is computed on the interval [0,
<code>time.max</code> - <code>surv.epsilon</code>].</p>
</td></tr>
</table>


<h3>Details</h3>

<p>There are two options for the prior: a piecewise exponential (histogram)
prior with dependent Gamma heights and a piecewise exponential (histogram)
prior with independent Gamma heights. Both priors are described in detail in
Castillo and Van der Pas (2020). The dependent prior has a Markov structure,
where the height of each interval depends on the height of the previous
interval. It implements the autoregressive idea of Arjas and Gasbarra (1994).
With <code class="reqn">\lambda_k</code> the histogram height on interval <code class="reqn">k</code> and <code class="reqn">\alpha</code> a
user-selected parameter, the structure is such that, with <code class="reqn">K</code> the number
of intervals:
</p>
<p style="text-align: center;"><code class="reqn">E[\lambda_k | \lambda_{k-1}, \ldots, \lambda_1] = \lambda_{k-1}, k = 2, \ldots, K.</code>
</p>

<p style="text-align: center;"><code class="reqn">Var(\lambda_k | \lambda_{k-1}, \ldots, \lambda_1) = (\lambda_{k-1})^2/\alpha, k = 2, \ldots, K.</code>
</p>

<p>In the independent Gamma prior, the prior draws for the <code class="reqn">\lambda_k</code>'s are
independent of each other and are taken from a Gamma distribution with
user-specified shape and rate parameters.
</p>
<p>The guideline for the number of intervals <code class="reqn">K</code> suggested by Castillo and
Van der Pas (2020) is
</p>
<p style="text-align: center;"><code class="reqn">K = (n / \log{n})^{1/(1 + 2\gamma)},</code>
</p>

<p>where <code class="reqn">n</code> is the number of observations and <code class="reqn">\gamma</code> is related to
the smoothness of the true hazard function. In the absence of information
about the smoothness, a default value of <code class="reqn">\gamma = 1/2</code> is recommended
and this is implemented as the default in this package. If this choice leads
to many intervals with zero events, it is recommended to decrease the number
of intervals.
</p>
<p>The samplers used for the dependent and independent Gamma priors are described
in the Supplement to Castillo and Van der Pas (2020).
</p>


<h3>Value</h3>

<table>
<tr><td><code>haz.post.mean</code></td>
<td>
<p>The posterior mean for the hazard, given as the
value on each of the <code class="reqn">K</code> intervals.</p>
</td></tr>
<tr><td><code>cumhaz.post.mean</code></td>
<td>
<p>The posterior mean for the cumulative hazard,
given as the value at the end of each of the <code class="reqn">K</code> intervals. The
cumulative hazard can be obtained from this by starting at 0 and
linearly interpolating between each of the returned values.</p>
</td></tr>
<tr><td><code>cumhaz.radius</code></td>
<td>
<p>The radius for the credible set for
the cumulative hazard.</p>
</td></tr>
<tr><td><code>surv.post.mean</code></td>
<td>
<p>The posterior mean for the
survival, given at each value contained in the also returned
<code>surv.eval.grid</code>.</p>
</td></tr>
<tr><td><code>surv.radius</code></td>
<td>
<p>The radius for the credible set for
the survival.</p>
</td></tr>
<tr><td><code>surv.eval.grid</code></td>
<td>
<p>The grid on which the
posterior mean for the survival has been computed. A finer grid can be
obtained by increasing <code>surv.factor</code> in the function call.</p>
</td></tr>
<tr><td><code>time.max</code></td>
<td>
<p>The maximum follow-up time considered.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Castillo and Van der Pas (2020). Multiscale Bayesian survival
analysis. &lt;arXiv:2005.02889&gt;.
</p>
<p>Arjas and Gasbarra (1994). Nonparametric Bayesian inference from right
censored survival data, using the Gibbs sampler. Statistica Sinica 4(2):505-524.
</p>


<h3>See Also</h3>

<p><a href="#topic+PlotBayesSurv">PlotBayesSurv</a> for a function that takes the result
from <code>BayesSurv()</code> and produces plots of the posterior mean of the hazard,
the posterior mean and credible band for the cumulative hazard, and the
posterior mean and credible band for the survival. To obtain direct samples
from the posterior for the hazard, see <a href="#topic+SamplePosteriorDepGamma">SamplePosteriorDepGamma</a> and
<a href="#topic+SamplePosteriorIndepGamma">SamplePosteriorIndepGamma</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Demonstration on a simulated data set
library(simsurv)
library(ggplot2)
hazard.true &lt;- function(t,x, betas, ...){1.2*(5*(t+0.05)^3 - 10*(t+0.05)^2 + 5*(t+0.05) ) + 0.7}
sim.df &lt;- data.frame(id = 1:1000)
df &lt;- simsurv(x = sim.df, maxt = 1, hazard = hazard.true)

bs &lt;- BayesSurv(df, "eventtime", "status")
PlotBayesSurv(bs, object = "survival")
PlotBayesSurv(bs, object = "cumhaz")
PlotBayesSurv(bs, object = "hazard")

</code></pre>

<hr>
<h2 id='CumhazEval'>Evaluate whether a true cumulative hazard function is contained
in the credible set.</h2><span id='topic+CumhazEval'></span>

<h3>Description</h3>

<p>This function is intended to evaluate the Bayesian procedure in a
simulation study. To that end, this function can be used to check
whether the true (user-defined) cumulative hazard function is
contained in the credible set generated by the function
<a href="#topic+BayesSurv">BayesSurv</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CumhazEval(time.grid, true.cumhaz, post.mean, radius)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CumhazEval_+3A_time.grid">time.grid</code></td>
<td>
<p>The time grid on which to evaluate the cumulative
hazard.</p>
</td></tr>
<tr><td><code id="CumhazEval_+3A_true.cumhaz">true.cumhaz</code></td>
<td>
<p>The true cumulative hazard function.</p>
</td></tr>
<tr><td><code id="CumhazEval_+3A_post.mean">post.mean</code></td>
<td>
<p>The posterior mean of the cumulative hazard, given
as a function.</p>
</td></tr>
<tr><td><code id="CumhazEval_+3A_radius">radius</code></td>
<td>
<p>The radius of the credible set for the cumulative hazard.</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>covered</code></td>
<td>
<p>Indicator whether the true cumulative hazard function is
completely covered by the credible set on the times contained in
<code>time.grid</code>. 0 = not completely covered, 1 = completely covered.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Castillo and Van der Pas (2020). Multiscale Bayesian survival
analysis. &lt;arXiv:2005.02889&gt;.
</p>


<h3>See Also</h3>

<p><a href="#topic+BayesSurv">BayesSurv</a>, which computes the posterior mean of the
cumulative hazard as well as the radius for its credible set.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Demonstration on a simulated data set
library(simsurv)
library(ggplot2)
hazard.true &lt;- function(t,x, betas, ...){1.2*(5*(t+0.05)^3 - 10*(t+0.05)^2 + 5*(t+0.05) ) + 0.7}
cumhaz.true &lt;- Vectorize( function(t){integrate(hazard.true, 0, t)$value} )
sim.df &lt;- data.frame(id = 1:1000)
df &lt;- simsurv(x = sim.df, maxt = 1, hazard = hazard.true)

bs &lt;- BayesSurv(df, "eventtime", "status")
K &lt;- length(bs$haz.post.mean)
cumhaz.pm &lt;- approxfun(c(0, (bs$time.max/K)*(1:K) ), c(0, cumsum(bs$haz.post.mean*bs$time.max/K)))
CumhazEval(bs$surv.eval.grid, cumhaz.true, cumhaz.pm, bs$cumhaz.radius)


</code></pre>

<hr>
<h2 id='MCMCDepGammaFirst'>Sampler for the first interval for the piecewise exponential prior
with dependent Gamma heights.</h2><span id='topic+MCMCDepGammaFirst'></span>

<h3>Description</h3>

<p>This is the sampler for the first interval in case the piecewise exponential
prior with dependent Gamma heights is selected. The sampler is described in
the Supplement to Castillo and Van der Pas (2020). Most users of the package
will not work with this function directly, but instead use the main function
<a href="#topic+BayesSurv">BayesSurv</a>, in which this particular function is incorporated.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MCMCDepGammaFirst(
  current,
  next.haz,
  failure,
  exposure,
  alpha.dep = 1,
  alpha0.dep = 1.5,
  beta0.dep = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="MCMCDepGammaFirst_+3A_current">current</code></td>
<td>
<p>The value of the height of the first interval from the
previous iteration.</p>
</td></tr>
<tr><td><code id="MCMCDepGammaFirst_+3A_next.haz">next.haz</code></td>
<td>
<p>The value of the height of the second interval from the
previous iteration.</p>
</td></tr>
<tr><td><code id="MCMCDepGammaFirst_+3A_failure">failure</code></td>
<td>
<p>The number of individuals who had an event during the first
interval.</p>
</td></tr>
<tr><td><code id="MCMCDepGammaFirst_+3A_exposure">exposure</code></td>
<td>
<p>The total amount of time all individuals were exposed for
during the first interval.</p>
</td></tr>
<tr><td><code id="MCMCDepGammaFirst_+3A_alpha.dep">alpha.dep</code></td>
<td>
<p>The main parameter <code class="reqn">\alpha</code> for the dependent Gamma
prior, as described in the documentation for <a href="#topic+BayesSurv">BayesSurv</a>. It is
recommended to take <code>alpha.dep</code> smaller than <code>alpha0.dep</code>.</p>
</td></tr>
<tr><td><code id="MCMCDepGammaFirst_+3A_alpha0.dep">alpha0.dep</code></td>
<td>
<p>The shape parameter for the Gamma prior on the histogram
height for the first interval. It is recommended to take <code>alpha.dep</code>
smaller than <code>alpha0.dep</code>.</p>
</td></tr>
<tr><td><code id="MCMCDepGammaFirst_+3A_beta0.dep">beta0.dep</code></td>
<td>
<p>The rate parameter for the Gamma prior on the histogram
height for the first interval.</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>res</code></td>
<td>
<p>A new sample of the histogram height of the first interval.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Castillo and Van der Pas (2020). Multiscale Bayesian survival
analysis. &lt;arXiv:2005.02889&gt;.
</p>


<h3>See Also</h3>

<p><a href="#topic+BayesSurv">BayesSurv</a>, which computes the posterior mean and credible
bands for the cumulative hazard and survival functions, as well as the
posterior mean for the hazard. Within <a href="#topic+BayesSurv">BayesSurv</a>, the present
function as well as <a href="#topic+MCMCDepGammaIntermediate">MCMCDepGammaIntermediate</a> is called through
<a href="#topic+SamplePosteriorDepGamma">SamplePosteriorDepGamma</a>.
</p>

<hr>
<h2 id='MCMCDepGammaIntermediate'>Sampler for the intermediate intervals for the piecewise exponential prior
with dependent Gamma heights.</h2><span id='topic+MCMCDepGammaIntermediate'></span>

<h3>Description</h3>

<p>This is the sampler for the intermediate intervals (= all intervals except
for the first and last one) in case the piecewise exponential prior with
dependent Gamma heights is selected. The sampler is described in the
Supplement to Castillo and Van der Pas (2020) and uses MCMC within Gibbs,
with a Gamma proposal with shape parameter equal to the number of events in
the interval plus some epsilon (to prevent proposals equal to zero if there
are no events in an interval) and rate parameter equal to the parameter alpha
(set by the user) divided by histogram height on the previous interval, plus
the total amount of time all individuals were exposed during this interval.
Most users of the package will not work with this function directly, but
instead use the main function <a href="#topic+BayesSurv">BayesSurv</a>, in which this particular
function is incorporated.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MCMCDepGammaIntermediate(
  current,
  prev.haz,
  next.haz,
  failure,
  exposure,
  alpha.dep
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="MCMCDepGammaIntermediate_+3A_current">current</code></td>
<td>
<p>The value of the height of the first interval from the
previous iteration.</p>
</td></tr>
<tr><td><code id="MCMCDepGammaIntermediate_+3A_prev.haz">prev.haz</code></td>
<td>
<p>The value of the height of the preceding interval from
the previous iteration.</p>
</td></tr>
<tr><td><code id="MCMCDepGammaIntermediate_+3A_next.haz">next.haz</code></td>
<td>
<p>The value of the height of the next interval from the
previous iteration.</p>
</td></tr>
<tr><td><code id="MCMCDepGammaIntermediate_+3A_failure">failure</code></td>
<td>
<p>The number of individuals who had an event during the first
interval.</p>
</td></tr>
<tr><td><code id="MCMCDepGammaIntermediate_+3A_exposure">exposure</code></td>
<td>
<p>The total amount of time all individuals were exposed for
during the first interval.</p>
</td></tr>
<tr><td><code id="MCMCDepGammaIntermediate_+3A_alpha.dep">alpha.dep</code></td>
<td>
<p>The main parameter <code class="reqn">\alpha</code> for the dependent Gamma
prior, as described in the documentation for <a href="#topic+BayesSurv">BayesSurv</a>. It is
recommended to take <code>alpha.dep</code> smaller than <code>alpha0.dep</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>res</code></td>
<td>
<p>A new sample of the histogram height of the selected
interval.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Castillo and Van der Pas (2020). Multiscale Bayesian survival
analysis. &lt;arXiv:2005.02889&gt;.
</p>


<h3>See Also</h3>

<p><a href="#topic+BayesSurv">BayesSurv</a>, which computes the posterior mean and credible
bands for the cumulative hazard and survival functions, as well as the
posterior mean for the hazard. Within <a href="#topic+BayesSurv">BayesSurv</a>, the present
function as well as <a href="#topic+MCMCDepGammaFirst">MCMCDepGammaFirst</a> is called through
<a href="#topic+SamplePosteriorDepGamma">SamplePosteriorDepGamma</a>.
</p>

<hr>
<h2 id='PlotBayesSurv'>Plot the posterior mean with credible band for the survival function
or cumulative hazard, or the posterior mean for the hazard</h2><span id='topic+PlotBayesSurv'></span>

<h3>Description</h3>

<p>This function takes the output from <a href="#topic+BayesSurv">BayesSurv</a> and uses ggplot2
to make plots of (1) the posterior mean of the survival function
with credible band, or (2) the posterior mean of the cumulative hazard
with credible band, or (3) the posterior mean of the cumulative hazard.
Users can select some plotting options within this function. Further
changes to the plot can be made by storing the plot and adding
ggplot2 syntax (see the examples).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PlotBayesSurv(
  bayes.surv.object,
  object = c("survival", "cumhaz", "hazard"),
  band = TRUE,
  color = "darkblue",
  plot.title = "",
  xlab = "time",
  ylab = "",
  legend = TRUE,
  alpha.band = 0.4
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="PlotBayesSurv_+3A_bayes.surv.object">bayes.surv.object</code></td>
<td>
<p>The output from the function <a href="#topic+BayesSurv">BayesSurv</a>.</p>
</td></tr>
<tr><td><code id="PlotBayesSurv_+3A_object">object</code></td>
<td>
<p>The object to be plotted, the user may select &quot;survival&quot;
for the survival function, &quot;cumhaz&quot; for the cumulative hazard, or
&quot;hazard&quot; for the hazard function. Default is the survival function.</p>
</td></tr>
<tr><td><code id="PlotBayesSurv_+3A_band">band</code></td>
<td>
<p>Indicator whether a credible band should be plotted (only
possible for the survival function and the cumulative hazard).</p>
</td></tr>
<tr><td><code id="PlotBayesSurv_+3A_color">color</code></td>
<td>
<p>The color to be used for the posterior mean and the
credible band (if applicable).</p>
</td></tr>
<tr><td><code id="PlotBayesSurv_+3A_plot.title">plot.title</code></td>
<td>
<p>A title for the plot.</p>
</td></tr>
<tr><td><code id="PlotBayesSurv_+3A_xlab">xlab</code></td>
<td>
<p>A label for the horizontal axis.</p>
</td></tr>
<tr><td><code id="PlotBayesSurv_+3A_ylab">ylab</code></td>
<td>
<p>a label for the vertical axis.</p>
</td></tr>
<tr><td><code id="PlotBayesSurv_+3A_legend">legend</code></td>
<td>
<p>If TRUE, a legend saying 'Credible band' will be included.</p>
</td></tr>
<tr><td><code id="PlotBayesSurv_+3A_alpha.band">alpha.band</code></td>
<td>
<p>The transparency of the credible band.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The posterior mean of the hazard and the posterior mean and credible
band of the cumulative hazard are plotted exactly. The survival is plotted
exactly at the points contained in the vector <code>surv.eval.grid</code> contained
in the object created by <a href="#topic+BayesSurv">BayesSurv</a>. Between these points, the survival
is linearly interpolated. To evaluate the survival exactly at more points
(and to obtain a smoother plot), increase the parameter <code>surv.factor</code>
within <a href="#topic+BayesSurv">BayesSurv</a>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>gg</code></td>
<td>
<p>The plot, which may be edited further by adding
ggplot2 syntax.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Castillo and Van der Pas (2020). Multiscale Bayesian survival
analysis. &lt;arXiv:2005.02889&gt;.
</p>


<h3>See Also</h3>

<p><a href="#topic+BayesSurv">BayesSurv</a> to create the required object for this
plotting function.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Demonstration on a simulated data set
library(simsurv)
library(ggplot2)
hazard.true &lt;- function(t,x, betas, ...){1.2*(5*(t+0.05)^3 - 10*(t+0.05)^2 + 5*(t+0.05) ) + 0.7}
sim.df &lt;- data.frame(id = 1:1000)
df &lt;- simsurv(x = sim.df, maxt = 1, hazard = hazard.true)

bs &lt;- BayesSurv(df, "eventtime", "status")
PlotBayesSurv(bs, object = "survival")

cumhaz.plot &lt;- PlotBayesSurv(bs, object = "cumhaz")
cumhaz.plot + labs(title = "Cumulative hazard")

</code></pre>

<hr>
<h2 id='RadiusCredibleSet'>Computes the radius of a fixed width credible set for the
survival or the cumulative hazard</h2><span id='topic+RadiusCredibleSet'></span>

<h3>Description</h3>

<p>This function finds a radius such that (1-alpha)100% of posterior
draws are within a distance of at most this radius to the posterior
mean. Most users will not use this function directly, but instead
use <a href="#topic+BayesSurv">BayesSurv</a>, in which this function is used.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RadiusCredibleSet(draws, post.mean, alpha = 0.05)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="RadiusCredibleSet_+3A_draws">draws</code></td>
<td>
<p>A matrix of posterior draws of either the cumulative
hazard or the survival. Each row contains a draw, the columns correspond
to time points on which the cumulative hazard or survival is evaluated.</p>
</td></tr>
<tr><td><code id="RadiusCredibleSet_+3A_post.mean">post.mean</code></td>
<td>
<p>The posterior mean of the cumulative hazard or survival
function, evaluated at the same time points as the draws.</p>
</td></tr>
<tr><td><code id="RadiusCredibleSet_+3A_alpha">alpha</code></td>
<td>
<p>The credible band will be such that (1-alpha)100% of draws is
contained in it.</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>radius</code></td>
<td>
<p>The radius of the credible set.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Castillo and Van der Pas (2020). Multiscale Bayesian survival
analysis. &lt;arXiv:2005.02889&gt;.
</p>


<h3>See Also</h3>

<p><a href="#topic+BayesSurv">BayesSurv</a>, which computes the posterior mean and the
radius of the credible band for the cumulative hazard function as
well as the survival, and the posterior mean for the hazard. These objects
can then be visualized by using <a href="#topic+PlotBayesSurv">PlotBayesSurv</a>.
</p>

<hr>
<h2 id='ReshapeData'>Reshape right censored data to be used with a piecewise exponential
prior.</h2><span id='topic+ReshapeData'></span>

<h3>Description</h3>

<p>To draw from the posterior of the piecewise exponential priors implemented
in this package, it is convenient to convert the data so that two vectors
are obtained: one containing the total amount of time all individuals
were under follow-up during each interval, and one containing the
number of events that happened during each interval. This function takes
a dataframe with a column of times (the minimum of the time of the event
and the time of censoring) and a column indicating the status (0 if censored,
1 if the event was observed) and reshapes it into the desired format. Most
users will not use this function directly, but will instead use the main
function <a href="#topic+BayesSurv">BayesSurv</a>, which uses the present function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ReshapeData(
  df,
  time = "time",
  event = "event",
  K = ceiling((dim(df)[1]/log(dim(df)[1]))^(1/2)),
  time.max = max(df[[time]])
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ReshapeData_+3A_df">df</code></td>
<td>
<p>A dataframe, containing at minimum a column with follow-up times
and a column with a status indicator (event observed or censored).</p>
</td></tr>
<tr><td><code id="ReshapeData_+3A_time">time</code></td>
<td>
<p>The name of the column in the dataframe containing the (possibly
right-censored) follow-up times, that is, the minimum of the time of the
event and the time of censoring. Input the name as character/string.</p>
</td></tr>
<tr><td><code id="ReshapeData_+3A_event">event</code></td>
<td>
<p>The name of the column in the dataframe containing the status
indicator, which must be coded as: 0 = censored, 1 = event observed. Input
the name as character/string.</p>
</td></tr>
<tr><td><code id="ReshapeData_+3A_k">K</code></td>
<td>
<p>The number of intervals to be used in the piecewise exponential
(histogram) prior. Default is set to <code class="reqn">K = (n / \log{n})^{1/2}</code>, with
<code class="reqn">n</code> the number of observations, as recommended by Castillo and Van der
Pas (2020).</p>
</td></tr>
<tr><td><code id="ReshapeData_+3A_time.max">time.max</code></td>
<td>
<p>The maximum follow-up time to consider, corresponding to the
parameter <code class="reqn">tau</code> in Castillo and Van der Pas (2020).</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>failures</code></td>
<td>
<p>A vector of length <code class="reqn">K</code>, containing for each
interval the number of individuals who had an event during that interval.</p>
</td></tr>
<tr><td><code>exposures</code></td>
<td>
<p>A vector of length <code class="reqn">K</code>, containing for each interval
the total amount of time all individuals together were under follow-up
during that interval.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Castillo and Van der Pas (2020). Multiscale Bayesian survival
analysis. &lt;arXiv:2005.02889&gt;.
</p>


<h3>See Also</h3>

<p><a href="#topic+BayesSurv">BayesSurv</a>, which computes the posterior mean and the
radius of the credible band for the cumulative hazard function as
well as the survival, and the posterior mean for the hazard. These objects
can then be visualized by using <a href="#topic+PlotBayesSurv">PlotBayesSurv</a>.
</p>

<hr>
<h2 id='SamplePosteriorDepGamma'>Draw samples from the posterior for the hazard, using the piecewise
exponential (histogram) prior with dependent Gamma heights</h2><span id='topic+SamplePosteriorDepGamma'></span>

<h3>Description</h3>

<p>The sampler is described in the Supplement to Castillo and Van der Pas
(2020) and uses MCMC within Gibbs, with a Gamma proposal with shape
parameter equal to the number of events in each interval plus some epsilon
(to prevent proposals equal to zero if there are no events in an interval)
and rate parameter equal to the parameter alpha (set by the user) divided by
histogram height on the previous interval, plus the total amount of time all
individuals were exposed during this interval. Most users of the package will
not work with this function directly, but instead use the main function
<a href="#topic+BayesSurv">BayesSurv</a>, in which this particular function is incorporated.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SamplePosteriorDepGamma(
  failures,
  exposures,
  N = 1000,
  alpha.dep = 1,
  alpha0.dep = 1.5,
  beta0.dep = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SamplePosteriorDepGamma_+3A_failures">failures</code></td>
<td>
<p>A vector of length <code class="reqn">K</code> (the total number of intervals),
containing for each interval the number of individuals who had an event
during that interval.</p>
</td></tr>
<tr><td><code id="SamplePosteriorDepGamma_+3A_exposures">exposures</code></td>
<td>
<p>A vector of length <code class="reqn">K</code> (the total number of intervals),
containing for each interval the total amount of time all individuals
together were under follow-up during that interval.</p>
</td></tr>
<tr><td><code id="SamplePosteriorDepGamma_+3A_n">N</code></td>
<td>
<p>The number of draws to take.</p>
</td></tr>
<tr><td><code id="SamplePosteriorDepGamma_+3A_alpha.dep">alpha.dep</code></td>
<td>
<p>The main parameter <code class="reqn">\alpha</code> for the dependent Gamma
prior, as described in the documentation for <a href="#topic+BayesSurv">BayesSurv</a>. It is
recommended to take <code>alpha.dep</code> smaller than <code>alpha0.dep</code>.</p>
</td></tr>
<tr><td><code id="SamplePosteriorDepGamma_+3A_alpha0.dep">alpha0.dep</code></td>
<td>
<p>The shape parameter for the Gamma prior on the histogram
height for the first interval. It is recommended to take <code>alpha.dep</code>
smaller than <code>alpha0.dep</code>.</p>
</td></tr>
<tr><td><code id="SamplePosteriorDepGamma_+3A_beta0.dep">beta0.dep</code></td>
<td>
<p>The rate parameter for the Gamma prior on the histogram
height for the first interval.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The samples returned by this function are draws from the posterior for the
hazard function. To obtain draws from the posterior for the cumulative
hazard, one can use numerical integration. One way to achieve this is by
first finding the values of the cumulative hazard at the end of each interval,
e.g. by <code>t(apply(samples*time.max/K, 1, cumsum))</code>, where <code>samples</code>
is the output from the present function and <code>time.max</code> and <code>K</code> are
as described for <a href="#topic+BayesSurv">BayesSurv</a>, and then using <code>approxfun()</code> to linearly
interpolate in between. To obtain posterior samples from the survival, one
could then use <a href="#topic+SurvivalFromCumhaz">SurvivalFromCumhaz</a>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>samples</code></td>
<td>
<p>A <code class="reqn">N</code> by <code class="reqn">K</code> (the number of draws by the
number of intervals) matrix, with each row containing a draw from the
posterior for the hazard, based on a histogram prior with dependent
Gamma heights.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Castillo and Van der Pas (2020). Multiscale Bayesian survival
analysis. &lt;arXiv:2005.02889&gt;.
</p>


<h3>See Also</h3>

<p><a href="#topic+BayesSurv">BayesSurv</a>, which computes the posterior mean and credible
bands for the cumulative hazard and survival functions, as well as the
posterior mean for the hazard. Within <a href="#topic+BayesSurv">BayesSurv</a>, the present
function is called.
</p>

<hr>
<h2 id='SamplePosteriorIndepGamma'>Draw samples from the posterior for the hazard, using the piecewise
exponential (histogram) prior with independent Gamma heights</h2><span id='topic+SamplePosteriorIndepGamma'></span>

<h3>Description</h3>

<p>The sampler is described in the Supplement to Castillo and Van der Pas
(2020). Most users of the package will not work with this function directly,
but instead use the main function <a href="#topic+BayesSurv">BayesSurv</a>, in which this particular
function is incorporated.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SamplePosteriorIndepGamma(
  failures,
  exposures,
  N = 1000,
  alpha.indep = 1.5,
  beta.indep = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SamplePosteriorIndepGamma_+3A_failures">failures</code></td>
<td>
<p>A vector of length <code class="reqn">K</code> (the total number of intervals),
containing for each interval the number of individuals who had an event
during that interval.</p>
</td></tr>
<tr><td><code id="SamplePosteriorIndepGamma_+3A_exposures">exposures</code></td>
<td>
<p>A vector of length <code class="reqn">K</code> (the total number of intervals),
containing for each interval the total amount of time all individuals
together were under follow-up during that interval.</p>
</td></tr>
<tr><td><code id="SamplePosteriorIndepGamma_+3A_n">N</code></td>
<td>
<p>The number of draws to take.</p>
</td></tr>
<tr><td><code id="SamplePosteriorIndepGamma_+3A_alpha.indep">alpha.indep</code></td>
<td>
<p>The shape parameter for the Gamma prior on the histogram
height for each interval.</p>
</td></tr>
<tr><td><code id="SamplePosteriorIndepGamma_+3A_beta.indep">beta.indep</code></td>
<td>
<p>The rate parameter for the Gamma prior on the histogram
height for each interval.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The samples returned by this function are draws from the posterior for the
hazard function. To obtain draws from the posterior for the cumulative
hazard, one can use numerical integration. One way to achieve this is by
first finding the values of the cumulative hazard at the end of each interval,
e.g. by <code>t(apply(samples*time.max/K, 1, cumsum))</code>, where <code>samples</code>
is the output from the present function and <code>time.max</code> and <code>K</code> are
as described for <a href="#topic+BayesSurv">BayesSurv</a>, and then using <code>approxfun()</code> to linearly
interpolate in between. To obtain posterior samples from the survival, one
could then use <a href="#topic+SurvivalFromCumhaz">SurvivalFromCumhaz</a>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>samples</code></td>
<td>
<p>A <code class="reqn">N</code> by <code class="reqn">K</code> (the number of draws by the
number of intervals) matrix, with each row containing a draw from the
posterior for the hazard, based on a histogram prior with independent
Gamma heights.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Castillo and Van der Pas (2020). Multiscale Bayesian survival
analysis. &lt;arXiv:2005.02889&gt;.
</p>


<h3>See Also</h3>

<p><a href="#topic+BayesSurv">BayesSurv</a>, which computes the posterior mean and credible
bands for the cumulative hazard and survival functions, as well as the
posterior mean for the hazard. Within <a href="#topic+BayesSurv">BayesSurv</a>, the present
function is called.
</p>

<hr>
<h2 id='SurvEval'>Evaluate whether a true survival function is contained
in the credible set.</h2><span id='topic+SurvEval'></span>

<h3>Description</h3>

<p>This function is intended to evaluate the Bayesian procedure in a
simulation study. To that end, this function can be used to check
whether the true (user-defined) survival function is
contained in the credible set generated by the function
<a href="#topic+BayesSurv">BayesSurv</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SurvEval(time.grid, true.surv, post.mean, radius)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SurvEval_+3A_time.grid">time.grid</code></td>
<td>
<p>The time grid on which to evaluate the survival
function.</p>
</td></tr>
<tr><td><code id="SurvEval_+3A_true.surv">true.surv</code></td>
<td>
<p>The true survival function.</p>
</td></tr>
<tr><td><code id="SurvEval_+3A_post.mean">post.mean</code></td>
<td>
<p>The posterior mean of the survival function, given
as a function.</p>
</td></tr>
<tr><td><code id="SurvEval_+3A_radius">radius</code></td>
<td>
<p>The radius of the credible set for the survival function</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>covered</code></td>
<td>
<p>Indicator whether the true survival function is
completely covered by the credible set on the times contained in
<code>time.grid</code>. 0 = not completely covered, 1 = completely covered.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Castillo and Van der Pas (2020). Multiscale Bayesian survival
analysis. &lt;arXiv:2005.02889&gt;.
</p>


<h3>See Also</h3>

<p><a href="#topic+BayesSurv">BayesSurv</a>, which computes the posterior mean of the
survival function as well as the radius for its credible set.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Demonstration on a simulated data set
library(simsurv)
library(ggplot2)
hazard.true &lt;- function(t,x, betas, ...){1.2*(5*(t+0.05)^3 - 10*(t+0.05)^2 + 5*(t+0.05) ) + 0.7}
cumhaz.true &lt;- Vectorize( function(t){integrate(hazard.true, 0, t)$value} )
surv.true &lt;- function(t){exp(-cumhaz.true(t))}

sim.df &lt;- data.frame(id = 1:1000)
df &lt;- simsurv(x = sim.df, maxt = 1, hazard = hazard.true)

bs &lt;- BayesSurv(df, "eventtime", "status")
surv.pm &lt;- approxfun(bs$surv.eval.grid, bs$surv.post.mean)
SurvEval(bs$surv.eval.grid, surv.true, surv.pm, bs$surv.radius)


</code></pre>

<hr>
<h2 id='SurvivalFromCumhaz'>Transform posterior draws from the cumulative hazard into posterior
draws from the survival.</h2><span id='topic+SurvivalFromCumhaz'></span>

<h3>Description</h3>

<p>Most users will not use this function directly, but will instead use the main
function <a href="#topic+BayesSurv">BayesSurv</a>, which calls this function. This function may be
used to create posterior draws of the survival function, based on posterior
draws of the cumulative hazard. It does so at a number of equispaced time
points on the interval [0, <code>time.max</code> - <code>surv.epsilon</code>], with the
number equal to the product of the number of intervals used in the prior, and
a user-defined factor.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SurvivalFromCumhaz(cumhaz, time.max, surv.factor = 10, surv.epsilon = 1e-10)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SurvivalFromCumhaz_+3A_cumhaz">cumhaz</code></td>
<td>
<p>A matrix containing posterior draws of the cumulative. Each row
contains one draw, the columns correspond to each interval. The values in each
draw are the values of the cumulative hazard at the end of the corresponding
interval.</p>
</td></tr>
<tr><td><code id="SurvivalFromCumhaz_+3A_time.max">time.max</code></td>
<td>
<p>The maximum follow-up time to consider, corresponding to the
parameter <code class="reqn">\tau</code> in Castillo and Van der Pas (2020).</p>
</td></tr>
<tr><td><code id="SurvivalFromCumhaz_+3A_surv.factor">surv.factor</code></td>
<td>
<p>The survival function is computed on an equispaced grid
consisting of <code>K x surv.factor</code> (the number of intervals times this
factor).</p>
</td></tr>
<tr><td><code id="SurvivalFromCumhaz_+3A_surv.epsilon">surv.epsilon</code></td>
<td>
<p>The survival function is computed on the interval [0,
<code>time.max</code> - <code>surv.epsilon</code>].</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>surv(eval.vec)</code></td>
<td>
<p>A numeric vector containing the posterior mean of
the survival function, evaluated at <code>K x surv.factor</code> (where <code>K</code>
is the number of intervals used in the prior) equidistant time points on
the interval [0, <code>time.max</code> - <code>surv.epsilon</code>].</p>
</td></tr>
</table>


<h3>References</h3>

<p>Castillo and Van der Pas (2020). Multiscale Bayesian survival
analysis. &lt;arXiv:2005.02889&gt;.
</p>


<h3>See Also</h3>

<p><a href="#topic+BayesSurv">BayesSurv</a>, which computes the posterior mean and the
radius of the credible band for the cumulative hazard function as
well as the survival, and the posterior mean for the hazard. These objects
can then be visualized by using <a href="#topic+PlotBayesSurv">PlotBayesSurv</a>.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
