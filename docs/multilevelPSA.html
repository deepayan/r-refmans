<!DOCTYPE html><html><head><title>Help for package multilevelPSA</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {multilevelPSA}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#align.plots'><p>Adapted from ggExtra package which is no longer available. This is related to</p>
an experimental mlpsa plot that will combine the circular plot along with
the two individual distributions.</a></li>
<li><a href='#as.data.frame.covariate.balance'><p>Returns the overall effects as a data frame.</p></a></li>
<li><a href='#covariate.balance'><p>Estimate covariate effect sizes before and after propensity score adjustment.</p></a></li>
<li><a href='#covariateBalance'><p>Calculate covariate effect size differences before and after stratification.</p></a></li>
<li><a href='#cv.trans.psa'><p>Transformation of Factors to Individual Levels</p></a></li>
<li><a href='#difftable.plot'><p>This function produces a ggplot2 figure containing the mean differences for</p>
each level two, or cluster.</a></li>
<li><a href='#getPropensityScores'><p>Returns a data frame with two columns corresponding to the level 2 variable</p>
and the fitted value from the logistic regression.</a></li>
<li><a href='#getStrata'><p>Returns a data frame with two columns corresponding to the level 2 variable</p>
and the leaves from the conditional inference trees.</a></li>
<li><a href='#is.mlpsa'><p>Returns true if the object is of type <code>mlpsa</code></p></a></li>
<li><a href='#loess.plot'><p>Loess plot with density distributions for propensity scores and outcomes on</p>
top and right, respectively.</a></li>
<li><a href='#lsos'><p>Nicer list of objects in memory. Particularly useful for analysis of large data.</p>
<a href="#%20http://stackoverflow.com/questions/1358003/tricks-to-manage-the-available-memory-in-an-r-session"># http://stackoverflow.com/questions/1358003/tricks-to-manage-the-available-memory-in-an-r-session</a></a></li>
<li><a href='#missing.plot'><p>Returns a heat map graphic representing missingness of variables grouped by</p>
the given grouping vector.</a></li>
<li><a href='#mlpsa'><p>This function will perform phase II of the multilevel propensity score analysis.</p></a></li>
<li><a href='#mlpsa.circ.plot'><p>Plots the results of a multilevel propensity score model.</p></a></li>
<li><a href='#mlpsa.ctree'><p>Estimates propensity scores using the recursive partitioning in a conditional inference framework.</p></a></li>
<li><a href='#mlpsa.difference.plot'><p>Creates a graphic summarizing the differences between treatment and comparison</p>
groups within and across level two clusters.</a></li>
<li><a href='#mlpsa.distribution.plot'><p>Plots distribution for either the treatment or comparison group.</p></a></li>
<li><a href='#mlpsa.logistic'><p>Estimates propensity scores using logistic regression.</p></a></li>
<li><a href='#multilevelPSA-package'><p>Multilevel Propensity Score Analysis</p></a></li>
<li><a href='#pisa.colnames'><p>Mapping of variables in <code>pisana</code> with full descriptions.</p></a></li>
<li><a href='#pisa.countries'><p>Data frame mapping PISA countries to their three letter abbreviation.</p></a></li>
<li><a href='#pisa.psa.cols'><p>Character vector representing the list of covariates used for estimating</p>
propensity scores.</a></li>
<li><a href='#pisana'><p>North American (i.e. Canada, Mexico, and United States) student results of the 2009</p>
Programme of International Student Assessment.</a></li>
<li><a href='#plot.covariate.balance'><p>Multiple covariate balance assessment plot.</p></a></li>
<li><a href='#plot.mlpsa'><p>Plots the results of a multilevel propensity score model.</p></a></li>
<li><a href='#plot.psrange'><p>Plots densities and ranges for the propensity scores.</p></a></li>
<li><a href='#print.covariate.balance'><p>Prints the overall effects before and after propensity score adjustment.</p></a></li>
<li><a href='#print.mlpsa'><p>Prints basic information about a <code>mlpsa</code> class.</p></a></li>
<li><a href='#print.psrange'><p>Prints information about a psrange result.</p></a></li>
<li><a href='#print.xmlpsa'><p>Prints the results of <code>mlpsa</code> and <code>xtable.mlpsa</code>.</p></a></li>
<li><a href='#psrange'><p>Estimates models with increasing number of comparison subjects starting from</p>
1:1 to using all available comparison group subjects.</a></li>
<li><a href='#summary.mlpsa'><p>Provides a summary of a <code>mlpsa</code> class.</p></a></li>
<li><a href='#summary.psrange'><p>Prints the summary results of psrange.</p></a></li>
<li><a href='#tree.plot'><p>Heat map representing variables used in a conditional inference tree across level 2 variables.</p></a></li>
<li><a href='#xtable.mlpsa'><p>Prints the results of <code>mlpsa</code> as a LaTeX table.</p></a></li>
<li><a href='#zeroGrob'><p>The zero grob draws nothing and has zero size.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Title:</td>
<td>Multilevel Propensity Score Analysis</td>
</tr>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Author:</td>
<td>Jason Bryer &lt;jason@bryer.org&gt;</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jason Bryer &lt;jason@bryer.org&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Conducts and visualizes propensity score analysis for multilevel, 
  or clustered data. Bryer &amp; Pruzek (2011) &lt;<a href="https://doi.org/10.1080%2F00273171.2011.636693">doi:10.1080/00273171.2011.636693</a>&gt;.</td>
</tr>
<tr>
<td>Version:</td>
<td>1.2.5</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="http://github.com/jbryer/multilevelPSA">http://github.com/jbryer/multilevelPSA</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/jbryer/multilevelPSA/issues">https://github.com/jbryer/multilevelPSA/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>ggplot2, xtable, R (&ge; 3.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>PSAgraphics, plyr, psych, reshape, grid, party, MASS</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat</td>
</tr>
<tr>
<td>Date:</td>
<td>2018-03-22</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>6.0.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2018-03-22 18:43:58 UTC; jbryer</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2018-03-22 20:21:26 UTC</td>
</tr>
</table>
<hr>
<h2 id='align.plots'>Adapted from ggExtra package which is no longer available. This is related to
an experimental mlpsa plot that will combine the circular plot along with
the two individual distributions.</h2><span id='topic+align.plots'></span>

<h3>Description</h3>

<p>Adapted from ggExtra package which is no longer available. This is related to
an experimental mlpsa plot that will combine the circular plot along with
the two individual distributions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'plots'
align(gl, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="align.plots_+3A_gl">gl</code></td>
<td>
<p>grid.layout</p>
</td></tr>
<tr><td><code id="align.plots_+3A_...">...</code></td>
<td>
<p>graphic elements to combine.</p>
</td></tr>
</table>

<hr>
<h2 id='as.data.frame.covariate.balance'>Returns the overall effects as a data frame.</h2><span id='topic+as.data.frame.covariate.balance'></span>

<h3>Description</h3>

<p>Returns the overall effects as a data frame.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'covariate.balance'
as.data.frame(x, row.names = NULL,
  optional = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="as.data.frame.covariate.balance_+3A_x">x</code></td>
<td>
<p>results of <code><a href="#topic+covariate.balance">covariate.balance</a></code>.</p>
</td></tr>
<tr><td><code id="as.data.frame.covariate.balance_+3A_row.names">row.names</code></td>
<td>
<p>unused.</p>
</td></tr>
<tr><td><code id="as.data.frame.covariate.balance_+3A_optional">optional</code></td>
<td>
<p>unused.</p>
</td></tr>
<tr><td><code id="as.data.frame.covariate.balance_+3A_...">...</code></td>
<td>
<p>unused</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a data frame with overall covariate effects before and after adjustment.
</p>

<hr>
<h2 id='covariate.balance'>Estimate covariate effect sizes before and after propensity score adjustment.</h2><span id='topic+covariate.balance'></span>

<h3>Description</h3>

<p>Estimate covariate effect sizes before and after propensity score adjustment.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>covariate.balance(covariates, treatment, level2, strata, abs = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="covariate.balance_+3A_covariates">covariates</code></td>
<td>
<p>frame or matrix of covariates.</p>
</td></tr>
<tr><td><code id="covariate.balance_+3A_treatment">treatment</code></td>
<td>
<p>vector of treatment indicators.</p>
</td></tr>
<tr><td><code id="covariate.balance_+3A_level2">level2</code></td>
<td>
<p>vector indicating level 2 membership.</p>
</td></tr>
<tr><td><code id="covariate.balance_+3A_strata">strata</code></td>
<td>
<p>strata indicators.</p>
</td></tr>
<tr><td><code id="covariate.balance_+3A_abs">abs</code></td>
<td>
<p>if TRUE absolute values of effect sizes will be plotted.</p>
</td></tr>
</table>

<hr>
<h2 id='covariateBalance'>Calculate covariate effect size differences before and after stratification.</h2><span id='topic+covariateBalance'></span>

<h3>Description</h3>

<p>This function is modified from the <code>cv.bal.psa</code> function in the 
<code>PSAgrpahics</code> package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>covariateBalance(covariates, treatment, propensity, strata = NULL,
  int = NULL, tree = FALSE, minsize = 2, universal.psd = TRUE,
  trM = 0, absolute.es = TRUE, trt.value = NULL, use.trt.var = FALSE,
  verbose = FALSE, xlim = NULL, plot.strata = TRUE, na.rm = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="covariateBalance_+3A_covariates">covariates</code></td>
<td>
<p>dataframe of interest</p>
</td></tr>
<tr><td><code id="covariateBalance_+3A_treatment">treatment</code></td>
<td>
<p>binary vector of 0s and 1s (necessarily? what if character, or 1, 2?)</p>
</td></tr>
<tr><td><code id="covariateBalance_+3A_propensity">propensity</code></td>
<td>
<p>PS scores from some method or other.</p>
</td></tr>
<tr><td><code id="covariateBalance_+3A_strata">strata</code></td>
<td>
<p>either a vector of strata number for each row of covariate, or 
one number n in which case it is attempted to group rows by ps scores into 
n strata of size approximately 1/n.  This does not seem to work well in the 
case of few specific propensity values, as from a tree.</p>
</td></tr>
<tr><td><code id="covariateBalance_+3A_int">int</code></td>
<td>
<p>either a number m used to divide [0,1] into m equal length subintervals, 
or a vector of cut points between 0 an    1 defining the subintervals (perhaps 
as suggested by loess.psa).  In either case these subintervals define strata, 
so strata can be of any size.</p>
</td></tr>
<tr><td><code id="covariateBalance_+3A_tree">tree</code></td>
<td>
<p>logical, if unique ps scores are few, as from a recursively partitioned 
tree, then TRUE will force each ps value to define a stratum.</p>
</td></tr>
<tr><td><code id="covariateBalance_+3A_minsize">minsize</code></td>
<td>
<p>smallest allowable stratum-treatment size.  If violated, strata is 
removed.</p>
</td></tr>
<tr><td><code id="covariateBalance_+3A_universal.psd">universal.psd</code></td>
<td>
<p>If 'TRUE', forces standard deviations used to be unadjusted 
for stratification.</p>
</td></tr>
<tr><td><code id="covariateBalance_+3A_trm">trM</code></td>
<td>
<p>trimming proportion for mean calculations.</p>
</td></tr>
<tr><td><code id="covariateBalance_+3A_absolute.es">absolute.es</code></td>
<td>
<p>logical, if 'TRUE' routine uses absolute values of all effect sizes.</p>
</td></tr>
<tr><td><code id="covariateBalance_+3A_trt.value">trt.value</code></td>
<td>
<p>allows user to specify which value is active treatment, if desired.</p>
</td></tr>
<tr><td><code id="covariateBalance_+3A_use.trt.var">use.trt.var</code></td>
<td>
<p>logical, if true then Rubin-Stuart method using only treatment 
variance with be used in effect size calculations.</p>
</td></tr>
<tr><td><code id="covariateBalance_+3A_verbose">verbose</code></td>
<td>
<p>logical, controls output that is visibly returned.</p>
</td></tr>
<tr><td><code id="covariateBalance_+3A_xlim">xlim</code></td>
<td>
<p>limits for the x-axis.</p>
</td></tr>
<tr><td><code id="covariateBalance_+3A_plot.strata">plot.strata</code></td>
<td>
<p>logical indicating whether to print strata.</p>
</td></tr>
<tr><td><code id="covariateBalance_+3A_na.rm">na.rm</code></td>
<td>
<p>should missing values be removed.</p>
</td></tr>
<tr><td><code id="covariateBalance_+3A_...">...</code></td>
<td>
<p>currently unused.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note: effect sizes are calculated as treatment 1 - treatment 0, or treatment B - treatment A.
</p>


<h3>Author(s)</h3>

<p>Robert M. Pruzek RMPruzek@yahoo.com
</p>
<p>James E. Helmreich James.Helmreich@Marist.edu
</p>
<p>KuangNan Xiong harryxkn@yahoo.com
</p>
<p>Jason Bryer jason@bryer.org
</p>

<hr>
<h2 id='cv.trans.psa'>Transformation of Factors to Individual Levels</h2><span id='topic+cv.trans.psa'></span>

<h3>Description</h3>

<p>The function <code>cv.trans.psa</code> takes a covariate data frame and replaces each 
categorical covariate of <code>n &gt;=3</code> levels with n new binary covariate columns, 
one for each level. Transforms covariate dataframe for use with the function 
<code>cv.bal.psa</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cv.trans.psa(covariates, fcol = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cv.trans.psa_+3A_covariates">covariates</code></td>
<td>
<p>A dataframe of covariates, presumably some factors.</p>
</td></tr>
<tr><td><code id="cv.trans.psa_+3A_fcol">fcol</code></td>
<td>
<p>An optional vector containing the factor columns in the covariate 
data frame. In <code>NULL</code> (default) routine to identify factors internally.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>NOTE: This function originated in the <code>PSAgraphics</code> package. It has been
adapted here for the <code>multilevelPSA</code> package.
</p>


<h3>Author(s)</h3>

<p>James E. Helmreich James.Helmreich@Marist.edu
</p>
<p>Robert M. Pruzek RMPruzek@yahoo.com
</p>
<p>KuangNan Xiong harryxkn@yahoo.com
</p>
<p>Jason Bryer jason@bryer.org
</p>

<hr>
<h2 id='difftable.plot'>This function produces a ggplot2 figure containing the mean differences for
each level two, or cluster.</h2><span id='topic+difftable.plot'></span>

<h3>Description</h3>

<p>This function produces a ggplot2 figure containing the mean differences for
each level two, or cluster.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>difftable.plot(x, fill.colors = NULL, legendlab = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="difftable.plot_+3A_x">x</code></td>
<td>
<p>the results of <code><a href="#topic+mlpsa">mlpsa</a></code>.</p>
</td></tr>
<tr><td><code id="difftable.plot_+3A_fill.colors">fill.colors</code></td>
<td>
<p>the colors to use for each level two.</p>
</td></tr>
<tr><td><code id="difftable.plot_+3A_legendlab">legendlab</code></td>
<td>
<p>the label to use for the legend, or NULL to exclude.</p>
</td></tr>
<tr><td><code id="difftable.plot_+3A_...">...</code></td>
<td>
<p>currently unused.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a ggplot2 figure
</p>

<hr>
<h2 id='getPropensityScores'>Returns a data frame with two columns corresponding to the level 2 variable
and the fitted value from the logistic regression.</h2><span id='topic+getPropensityScores'></span>

<h3>Description</h3>

<p>Returns a data frame with two columns corresponding to the level 2 variable
and the fitted value from the logistic regression.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getPropensityScores(lr.results, nStrata = 5)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getPropensityScores_+3A_lr.results">lr.results</code></td>
<td>
<p>the results of <code><a href="#topic+mlpsa.logistic">mlpsa.logistic</a></code></p>
</td></tr>
<tr><td><code id="getPropensityScores_+3A_nstrata">nStrata</code></td>
<td>
<p>number of strata within each level.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a data frame
</p>


<h3>See Also</h3>

<p>mlpsa.logistic
</p>

<hr>
<h2 id='getStrata'>Returns a data frame with two columns corresponding to the level 2 variable
and the leaves from the conditional inference trees.</h2><span id='topic+getStrata'></span>

<h3>Description</h3>

<p>Returns a data frame with two columns corresponding to the level 2 variable
and the leaves from the conditional inference trees.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getStrata(party.results, data, level2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getStrata_+3A_party.results">party.results</code></td>
<td>
<p>the results of <code><a href="#topic+mlpsa.ctree">mlpsa.ctree</a></code></p>
</td></tr>
<tr><td><code id="getStrata_+3A_data">data</code></td>
<td>
<p>the data frame to merge results to</p>
</td></tr>
<tr><td><code id="getStrata_+3A_level2">level2</code></td>
<td>
<p>the name of the level 2 variable.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a data frame
</p>


<h3>See Also</h3>

<p>mlpsa.ctree
</p>

<hr>
<h2 id='is.mlpsa'>Returns true if the object is of type <code>mlpsa</code></h2><span id='topic+is.mlpsa'></span>

<h3>Description</h3>

<p>Returns true if the object is of type <code>mlpsa</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is.mlpsa(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is.mlpsa_+3A_x">x</code></td>
<td>
<p>the object to test</p>
</td></tr>
</table>

<hr>
<h2 id='loess.plot'>Loess plot with density distributions for propensity scores and outcomes on
top and right, respectively.</h2><span id='topic+loess.plot'></span>

<h3>Description</h3>

<p>Loess plot with density distributions for propensity scores and outcomes on
top and right, respectively.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>loess.plot(x, response, treatment, responseTitle = "",
  treatmentTitle = "Treatment", percentPoints.treat = 0.1,
  percentPoints.control = 0.01, points.treat.alpha = 0.1,
  points.control.alpha = 0.1, plot.strata, plot.strata.alpha = 0.2, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="loess.plot_+3A_x">x</code></td>
<td>
<p>vector of propensity scores.</p>
</td></tr>
<tr><td><code id="loess.plot_+3A_response">response</code></td>
<td>
<p>the response variable.</p>
</td></tr>
<tr><td><code id="loess.plot_+3A_treatment">treatment</code></td>
<td>
<p>the treatment variable as a logical type.</p>
</td></tr>
<tr><td><code id="loess.plot_+3A_responsetitle">responseTitle</code></td>
<td>
<p>the label to use for the y-axis (i.e. the name of the response variable)</p>
</td></tr>
<tr><td><code id="loess.plot_+3A_treatmenttitle">treatmentTitle</code></td>
<td>
<p>the label to use for the treatment legend.</p>
</td></tr>
<tr><td><code id="loess.plot_+3A_percentpoints.treat">percentPoints.treat</code></td>
<td>
<p>the percentage of treatment points to randomly plot.</p>
</td></tr>
<tr><td><code id="loess.plot_+3A_percentpoints.control">percentPoints.control</code></td>
<td>
<p>the percentage of control points to randomly plot.</p>
</td></tr>
<tr><td><code id="loess.plot_+3A_points.treat.alpha">points.treat.alpha</code></td>
<td>
<p>the transparency level for treatment points.</p>
</td></tr>
<tr><td><code id="loess.plot_+3A_points.control.alpha">points.control.alpha</code></td>
<td>
<p>the transparency level for control points.</p>
</td></tr>
<tr><td><code id="loess.plot_+3A_plot.strata">plot.strata</code></td>
<td>
<p>an integer value greater than 2 indicating the number of vertical lines to 
plot corresponding to quantiles.</p>
</td></tr>
<tr><td><code id="loess.plot_+3A_plot.strata.alpha">plot.strata.alpha</code></td>
<td>
<p>the alpha level for the vertical lines.</p>
</td></tr>
<tr><td><code id="loess.plot_+3A_...">...</code></td>
<td>
<p>other parameters passed to <code><a href="ggplot2.html#topic+geom_smooth">geom_smooth</a></code> and
<code><a href="ggplot2.html#topic+stat_smooth">stat_smooth</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a ggplot2 figure
</p>


<h3>See Also</h3>

<p>plot.mlpsa
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
require(multilevelPSA)
require(party)
data(pisana)
data(pisa.psa.cols)
cnt = 'USA' #Can change this to USA, MEX, or CAN
pisana2 = pisana[pisana$CNT == cnt,]
pisana2$treat &lt;- as.integer(pisana2$PUBPRIV) %% 2
lr.results &lt;- glm(treat ~ ., data=pisana2[,c('treat',pisa.psa.cols)], family='binomial')
st = data.frame(ps=fitted(lr.results), 
				math=apply(pisana2[,paste('PV', 1:5, 'MATH', sep='')], 1, mean), 
				pubpriv=pisana2$treat)
				st$treat = as.logical(st$pubpriv)
loess.plot(st$ps, response=st$math, treatment=st$treat, percentPoints.control = 0.4, 
           percentPoints.treat=0.4)

## End(Not run)
</code></pre>

<hr>
<h2 id='lsos'>Nicer list of objects in memory. Particularly useful for analysis of large data. 
<a href="#%20http://stackoverflow.com/questions/1358003/tricks-to-manage-the-available-memory-in-an-r-session"># http://stackoverflow.com/questions/1358003/tricks-to-manage-the-available-memory-in-an-r-session</a></h2><span id='topic+lsos'></span>

<h3>Description</h3>

<p>Nicer list of objects in memory. Particularly useful for analysis of large data. 
<a href="#%20http://stackoverflow.com/questions/1358003/tricks-to-manage-the-available-memory-in-an-r-session"># http://stackoverflow.com/questions/1358003/tricks-to-manage-the-available-memory-in-an-r-session</a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lsos(..., n = 10)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="lsos_+3A_...">...</code></td>
<td>
<p>not used.</p>
</td></tr>
<tr><td><code id="lsos_+3A_n">n</code></td>
<td>
<p>the number of objects to return.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list of objects loaded sorted by size.
</p>

<hr>
<h2 id='missing.plot'>Returns a heat map graphic representing missingness of variables grouped by
the given grouping vector.</h2><span id='topic+missing.plot'></span>

<h3>Description</h3>

<p>NOTE: This is an experimental function and the results may vary depending on the
nature of the dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>missing.plot(x, grouping, grid = FALSE, widths = c(ggplot2::unit(3, "null"),
  ggplot2::unit(1, "inches")), heights = c(ggplot2::unit(1, "inches"),
  ggplot2::unit(3, "null")), color = "red", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="missing.plot_+3A_x">x</code></td>
<td>
<p>a data frame containing the variables to visualize missingness</p>
</td></tr>
<tr><td><code id="missing.plot_+3A_grouping">grouping</code></td>
<td>
<p>a vector of length nrow(vars) corresponding to how missing will be grouped by</p>
</td></tr>
<tr><td><code id="missing.plot_+3A_grid">grid</code></td>
<td>
<p>whether to draw a grid between tiles</p>
</td></tr>
<tr><td><code id="missing.plot_+3A_widths">widths</code></td>
<td>
<p>the ratio of the widths of the heatmap and histogram.</p>
</td></tr>
<tr><td><code id="missing.plot_+3A_heights">heights</code></td>
<td>
<p>the ratio of the heights of the heatmap and histogram.</p>
</td></tr>
<tr><td><code id="missing.plot_+3A_color">color</code></td>
<td>
<p>the color used for indicating missingness.</p>
</td></tr>
<tr><td><code id="missing.plot_+3A_...">...</code></td>
<td>
<p>currently unused.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a ggplot2 expression
</p>


<h3>See Also</h3>

<p>plot.mlpsa
</p>

<hr>
<h2 id='mlpsa'>This function will perform phase II of the multilevel propensity score analysis.</h2><span id='topic+mlpsa'></span>

<h3>Description</h3>

<p>TODO: Need more details
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mlpsa(response, treatment = NULL, strata = NULL, level2 = NULL,
  minN = 5, reverse = FALSE, ci.level = 0.05)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mlpsa_+3A_response">response</code></td>
<td>
<p>vector containing the response values</p>
</td></tr>
<tr><td><code id="mlpsa_+3A_treatment">treatment</code></td>
<td>
<p>vector containing the treatment conditions</p>
</td></tr>
<tr><td><code id="mlpsa_+3A_strata">strata</code></td>
<td>
<p>vector containing the strata for each response</p>
</td></tr>
<tr><td><code id="mlpsa_+3A_level2">level2</code></td>
<td>
<p>vector containing the level 2 specifications</p>
</td></tr>
<tr><td><code id="mlpsa_+3A_minn">minN</code></td>
<td>
<p>the minimum number of subjects per strata for that strata to be 
included in the analysis.</p>
</td></tr>
<tr><td><code id="mlpsa_+3A_reverse">reverse</code></td>
<td>
<p>reverse the order of treatment and control for the difference
calculation.</p>
</td></tr>
<tr><td><code id="mlpsa_+3A_ci.level">ci.level</code></td>
<td>
<p>the confidence level to use for confidence intervals. Defaults
to a 95% confidence level.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The ci.adjust provides a Bonferroni-Sidak adjusted confidence intervals based
on the number of levels/clusters.
</p>


<h3>Value</h3>

<p>a mlpsa class
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mlpsa.ctree">mlpsa.ctree</a></code> <code><a href="#topic+mlpsa.logistic">mlpsa.logistic</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
require(multilevelPSA)
require(party)
data(pisana)
data(pisa.colnames)
data(pisa.psa.cols)
mlctree = mlpsa.ctree(pisana[,c('CNT','PUBPRIV',pisa.psa.cols)], formula=PUBPRIV ~ ., level2='CNT')
student.party = getStrata(mlctree, pisana, level2='CNT')
student.party$mathscore = apply(student.party[,paste0('PV', 1:5, 'MATH')], 1, sum) / 5
results.psa.math = mlpsa(response=student.party$mathscore, 
       treatment=student.party$PUBPRIV, 
       strata=student.party$strata, 
       level2=student.party$CNT, minN=5)
results.psa.math
summary(results.psa.math)

## End(Not run)
</code></pre>

<hr>
<h2 id='mlpsa.circ.plot'>Plots the results of a multilevel propensity score model.</h2><span id='topic+mlpsa.circ.plot'></span>

<h3>Description</h3>

<p>The plot created uses the <code>ggplot2</code> framework. As such, additional modifications
can be made. This plot is an extension of the <code>circ.psa</code> function in the
<code>PSAgraphics</code> package for multilevel models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mlpsa.circ.plot(x, xlab = names(multilevelPSA$level2.summary)[4],
  ylab = names(multilevelPSA$level2.summary)[5], legendlab = "Level 2",
  title = NULL, overall.col = "blue", overall.ci.col = "green",
  level1.plot = FALSE, level1.point.size = NULL, level1.rug.plot = NULL,
  level1.projection.lines = FALSE, level2.plot = TRUE,
  level2.point.size = NULL, level2.rug.plot = "tr",
  level2.projection.lines = TRUE, level2.label = FALSE,
  unweighted.means = FALSE, weighted.means = FALSE, fill.colors = NULL,
  ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mlpsa.circ.plot_+3A_x">x</code></td>
<td>
<p>the results of <code><a href="#topic+mlpsa">mlpsa</a></code>.</p>
</td></tr>
<tr><td><code id="mlpsa.circ.plot_+3A_xlab">xlab</code></td>
<td>
<p>label for the x-axis.</p>
</td></tr>
<tr><td><code id="mlpsa.circ.plot_+3A_ylab">ylab</code></td>
<td>
<p>label for the y-axis.</p>
</td></tr>
<tr><td><code id="mlpsa.circ.plot_+3A_legendlab">legendlab</code></td>
<td>
<p>the label for the legend, or NULL to exclude.</p>
</td></tr>
<tr><td><code id="mlpsa.circ.plot_+3A_title">title</code></td>
<td>
<p>title for the figure.</p>
</td></tr>
<tr><td><code id="mlpsa.circ.plot_+3A_overall.col">overall.col</code></td>
<td>
<p>the color used for the overall results.</p>
</td></tr>
<tr><td><code id="mlpsa.circ.plot_+3A_overall.ci.col">overall.ci.col</code></td>
<td>
<p>the color used for the confidence intervals.</p>
</td></tr>
<tr><td><code id="mlpsa.circ.plot_+3A_level1.plot">level1.plot</code></td>
<td>
<p>logical value indicating whether level 1 points should be plotted.</p>
</td></tr>
<tr><td><code id="mlpsa.circ.plot_+3A_level1.point.size">level1.point.size</code></td>
<td>
<p>the size of level 1 points</p>
</td></tr>
<tr><td><code id="mlpsa.circ.plot_+3A_level1.rug.plot">level1.rug.plot</code></td>
<td>
<p>the placement for plotting a level 2 rug. Possible values
are <code>bl</code> (for left and bottom), <code>tr</code> (for top and right), or
NULL (to exclude).</p>
</td></tr>
<tr><td><code id="mlpsa.circ.plot_+3A_level1.projection.lines">level1.projection.lines</code></td>
<td>
<p>logical value indicating whether level 1 project lines
(parallel to the unit line) are drawn.</p>
</td></tr>
<tr><td><code id="mlpsa.circ.plot_+3A_level2.plot">level2.plot</code></td>
<td>
<p>logical value indicating whether level 2 points should be plotted.</p>
</td></tr>
<tr><td><code id="mlpsa.circ.plot_+3A_level2.point.size">level2.point.size</code></td>
<td>
<p>the size of level 2 points</p>
</td></tr>
<tr><td><code id="mlpsa.circ.plot_+3A_level2.rug.plot">level2.rug.plot</code></td>
<td>
<p>the placement for plotting a level 2 rug. Possible values
are <code>bl</code> (for left and bottom), <code>tr</code> (for top and right), or
NULL (to exclude).</p>
</td></tr>
<tr><td><code id="mlpsa.circ.plot_+3A_level2.projection.lines">level2.projection.lines</code></td>
<td>
<p>logical value indicating whether level 2 project lines
(parallel to the unit line) are drawn.</p>
</td></tr>
<tr><td><code id="mlpsa.circ.plot_+3A_level2.label">level2.label</code></td>
<td>
<p>logical value indicating whether level 2 points should be labeled.</p>
</td></tr>
<tr><td><code id="mlpsa.circ.plot_+3A_unweighted.means">unweighted.means</code></td>
<td>
<p>logical value indicating whether horizontal and vertical
lines are drawn representing the unweighted (i.e. unadjusted from phase I
of PSA) means for each level 2, or cluster.</p>
</td></tr>
<tr><td><code id="mlpsa.circ.plot_+3A_weighted.means">weighted.means</code></td>
<td>
<p>logical value indicating whether horizontal and vertical
lines are drawn representing the weighted means for each level 2, or cluster.</p>
</td></tr>
<tr><td><code id="mlpsa.circ.plot_+3A_fill.colors">fill.colors</code></td>
<td>
<p>if specified, the colors to use for level 2 points.</p>
</td></tr>
<tr><td><code id="mlpsa.circ.plot_+3A_...">...</code></td>
<td>
<p>currently unused.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>plot.mlpsa
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data(pisana)
data(pisa.colnames)
data(pisa.psa.cols)
mlctree = mlpsa.ctree(pisana[,c('CNT','PUBPRIV',pisa.psa.cols)], 
                      formula=PUBPRIV ~ ., level2='CNT')
student.party = getStrata(mlctree, pisana, level2='CNT')
student.party$mathscore = apply(student.party[,paste0('PV', 1:5, 'MATH')], 1, sum) / 5
results.psa.math = mlpsa(response=student.party$mathscore, 
       treatment=student.party$PUBPRIV, 
       strata=student.party$strata, 
       level2=student.party$CNT, minN=5)
mlpsa.circ.plot(results.psa.math, legendlab=FALSE)

## End(Not run)
</code></pre>

<hr>
<h2 id='mlpsa.ctree'>Estimates propensity scores using the recursive partitioning in a conditional inference framework.</h2><span id='topic+mlpsa.ctree'></span>

<h3>Description</h3>

<p>This function will estimate propensity scores using the conditional inference
framework as outlined in the <code>party</code> package. Specifically, a separate
tree will be estimated for each level 2 (or cluster). A key advantage of this
framework over other methods for estimating propensity scores is that this
method will work on data sets containing missing values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mlpsa.ctree(vars, formula, level2, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mlpsa.ctree_+3A_vars">vars</code></td>
<td>
<p>a data frame containing the covariates to use for estimating the propensity scores.</p>
</td></tr>
<tr><td><code id="mlpsa.ctree_+3A_formula">formula</code></td>
<td>
<p>the model for estimating the propensity scores. For example,
treat ~ .</p>
</td></tr>
<tr><td><code id="mlpsa.ctree_+3A_level2">level2</code></td>
<td>
<p>the name of the column in <code>vars</code> specifying the level 2 (or cluster).</p>
</td></tr>
<tr><td><code id="mlpsa.ctree_+3A_...">...</code></td>
<td>
<p>currently unused.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list of BinaryTree-class classes for each level 2
</p>


<h3>References</h3>

<p>Torsten Hothorn, Kurt Hornik and Achim Zeileis (2006). Unbiased 
Recursive Partitioning: A Conditional Inference Framework. Journal
of Computational and Graphical Statistics, 15(3), 651&ndash;674.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+getStrata">getStrata</a></code>
</p>
<p><code><a href="#topic+tree.plot">tree.plot</a></code>
</p>

<hr>
<h2 id='mlpsa.difference.plot'>Creates a graphic summarizing the differences between treatment and comparison
groups within and across level two clusters.</h2><span id='topic+mlpsa.difference.plot'></span>

<h3>Description</h3>

<p>Creates a graphic summarizing the differences between treatment and comparison
groups within and across level two clusters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mlpsa.difference.plot(x, xlab, ylab = NULL, title = NULL,
  overall.col = "blue", overall.ci.col = "green",
  level2.point.size = NULL, level1.points = TRUE, errorbars = TRUE,
  errorbars.adjusted.ci = TRUE, level2.rug.plot = TRUE, jitter = TRUE,
  reorder = TRUE, labelLevel2 = TRUE, sd = NULL, xlim, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mlpsa.difference.plot_+3A_x">x</code></td>
<td>
<p>the results of <code><a href="#topic+mlpsa">mlpsa</a></code>.</p>
</td></tr>
<tr><td><code id="mlpsa.difference.plot_+3A_xlab">xlab</code></td>
<td>
<p>label for the x-axis, or NULL to exclude.</p>
</td></tr>
<tr><td><code id="mlpsa.difference.plot_+3A_ylab">ylab</code></td>
<td>
<p>label for the y-axis, or NULL to exclude.</p>
</td></tr>
<tr><td><code id="mlpsa.difference.plot_+3A_title">title</code></td>
<td>
<p>title of the figure, or NULL to exclude.</p>
</td></tr>
<tr><td><code id="mlpsa.difference.plot_+3A_overall.col">overall.col</code></td>
<td>
<p>the color of the overall results line.</p>
</td></tr>
<tr><td><code id="mlpsa.difference.plot_+3A_overall.ci.col">overall.ci.col</code></td>
<td>
<p>the color of the overall confidence interval.</p>
</td></tr>
<tr><td><code id="mlpsa.difference.plot_+3A_level2.point.size">level2.point.size</code></td>
<td>
<p>the point size of level 2 points.</p>
</td></tr>
<tr><td><code id="mlpsa.difference.plot_+3A_level1.points">level1.points</code></td>
<td>
<p>logical value indicating whether level 1 strata should be plotted.</p>
</td></tr>
<tr><td><code id="mlpsa.difference.plot_+3A_errorbars">errorbars</code></td>
<td>
<p>logical value indicating whether error bars should be plotted for
for each level 1.</p>
</td></tr>
<tr><td><code id="mlpsa.difference.plot_+3A_errorbars.adjusted.ci">errorbars.adjusted.ci</code></td>
<td>
<p>whether the Bonferroni adjusted error bars should
be plotted (these will be dashed lines).</p>
</td></tr>
<tr><td><code id="mlpsa.difference.plot_+3A_level2.rug.plot">level2.rug.plot</code></td>
<td>
<p>logical value indicating whether a rug plot should be
plotted for level 2.</p>
</td></tr>
<tr><td><code id="mlpsa.difference.plot_+3A_jitter">jitter</code></td>
<td>
<p>logical value indicating whether level 1 points should be jittered.</p>
</td></tr>
<tr><td><code id="mlpsa.difference.plot_+3A_reorder">reorder</code></td>
<td>
<p>logical value indicating whether the level two clusters should be
reordered from largest difference to smallest.</p>
</td></tr>
<tr><td><code id="mlpsa.difference.plot_+3A_labellevel2">labelLevel2</code></td>
<td>
<p>logical value indicating whether the difference for each level 2
should be labeled.</p>
</td></tr>
<tr><td><code id="mlpsa.difference.plot_+3A_sd">sd</code></td>
<td>
<p>If specified, effect sizes will be plotted instead of difference in the
native unit.</p>
</td></tr>
<tr><td><code id="mlpsa.difference.plot_+3A_xlim">xlim</code></td>
<td>
<p>the limits of the x-axis.</p>
</td></tr>
<tr><td><code id="mlpsa.difference.plot_+3A_...">...</code></td>
<td>
<p>currently unused.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>plot.mlpsa
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data(pisana)
data(pisa.colnames)
data(pisa.psa.cols)
mlctree = mlpsa.ctree(pisana[,c('CNT','PUBPRIV',pisa.psa.cols)], formula=PUBPRIV ~ ., level2='CNT')
student.party = getStrata(mlctree, pisana, level2='CNT')
student.party$mathscore = apply(student.party[,paste0('PV', 1:5, 'MATH')], 1, sum) / 5
results.psa.math = mlpsa(response=student.party$mathscore, 
       treatment=student.party$PUBPRIV, 
       strata=student.party$strata, 
       level2=student.party$CNT, minN=5)
mlpsa.difference.plot(results.psa.math, sd=mean(student.party$mathscore, na.rm=TRUE))

## End(Not run)
</code></pre>

<hr>
<h2 id='mlpsa.distribution.plot'>Plots distribution for either the treatment or comparison group.</h2><span id='topic+mlpsa.distribution.plot'></span>

<h3>Description</h3>

<p>Plots distribution for either the treatment or comparison group.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mlpsa.distribution.plot(x, treat, fill.colours = NULL, flip = TRUE,
  label = treat, level2.label = NULL, legendlab = NULL,
  axis.text.size = 8, fill.colors = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mlpsa.distribution.plot_+3A_x">x</code></td>
<td>
<p>the results of <code><a href="#topic+mlpsa">mlpsa</a></code>.</p>
</td></tr>
<tr><td><code id="mlpsa.distribution.plot_+3A_treat">treat</code></td>
<td>
<p>the group to plot. This must be one of the two levels of the treatment variable.</p>
</td></tr>
<tr><td><code id="mlpsa.distribution.plot_+3A_fill.colours">fill.colours</code></td>
<td>
<p>if specified, the colors to use for level 2 points.</p>
</td></tr>
<tr><td><code id="mlpsa.distribution.plot_+3A_flip">flip</code></td>
<td>
<p>if TRUE, the level 2 clusters will be on the y-axis and the outcome
variable on the x-axis. Otherwise reversed.</p>
</td></tr>
<tr><td><code id="mlpsa.distribution.plot_+3A_label">label</code></td>
<td>
<p>the label to use for the axis.</p>
</td></tr>
<tr><td><code id="mlpsa.distribution.plot_+3A_level2.label">level2.label</code></td>
<td>
<p>the axis label for the level 2 indicators.</p>
</td></tr>
<tr><td><code id="mlpsa.distribution.plot_+3A_legendlab">legendlab</code></td>
<td>
<p>the label for the legend, or NULL to exclude a legend.</p>
</td></tr>
<tr><td><code id="mlpsa.distribution.plot_+3A_axis.text.size">axis.text.size</code></td>
<td>
<p>the size of the axis text</p>
</td></tr>
<tr><td><code id="mlpsa.distribution.plot_+3A_fill.colors">fill.colors</code></td>
<td>
<p>if specified, the colors to use for level 2 points.</p>
</td></tr>
<tr><td><code id="mlpsa.distribution.plot_+3A_...">...</code></td>
<td>
<p>currently unused.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>plot.mlpsa
</p>

<hr>
<h2 id='mlpsa.logistic'>Estimates propensity scores using logistic regression.</h2><span id='topic+mlpsa.logistic'></span>

<h3>Description</h3>

<p>This method will estimate a separate logistic regression model for each level 2
(or cluster).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mlpsa.logistic(vars, formula, level2, stepAIC = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mlpsa.logistic_+3A_vars">vars</code></td>
<td>
<p>data frame containing the variables to estimate the logistic regression</p>
</td></tr>
<tr><td><code id="mlpsa.logistic_+3A_formula">formula</code></td>
<td>
<p>the logistic regression formula to use</p>
</td></tr>
<tr><td><code id="mlpsa.logistic_+3A_level2">level2</code></td>
<td>
<p>the name of the column containing the level 2 specification</p>
</td></tr>
<tr><td><code id="mlpsa.logistic_+3A_stepaic">stepAIC</code></td>
<td>
<p>if true, the <code><a href="MASS.html#topic+stepAIC">stepAIC</a></code> from the <code>MASS</code> package
will be used within each level.</p>
</td></tr>
<tr><td><code id="mlpsa.logistic_+3A_...">...</code></td>
<td>
<p>currently unused.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list of glm classes for each level 2 or stepwise-selected model if stepAIC is true.
</p>


<h3>See Also</h3>

<p>getPropensityScores
</p>

<hr>
<h2 id='multilevelPSA-package'>Multilevel Propensity Score Analysis</h2><span id='topic+multilevelPSA-package'></span><span id='topic+multilevelPSA'></span>

<h3>Description</h3>

<p>This packages provides functions to estimate and visualize multilevel propensity
score analysis.
</p>


<h3>Details</h3>

<p>This package extends the principles put forth by the <code>PSAgraphics</code> 
(Helmreich, Pruzek, &amp; Xiong, 2010) for multilevel, or clustered, data.
</p>
<p>Propensity score analyses are typically done in two phases. In phase I, a
statistical model predicting treatment using the available individual covariates 
is estimated. This package currently currently provides functions to perform
propensity score estimates using logistic regression (see <code><a href="#topic+mlpsa.logistic">mlpsa.logistic</a></code>)
and conditional inference trees (see <code><a href="#topic+mlpsa.ctree">mlpsa.ctree</a></code>). The latter method
provides explicit stratifications as defined by each leaf node. The former however,
results in a numerical value ranging from zero to one (i.e. the fitted values).
A common approach is to then create stratifications using quintiles. However,
other approaches such as Loess regression are also provided.
</p>
<p>Phase II of typical propensity score analyses concerns with the comparison of an
outcome between the treatment and comparison groups. The <code><a href="#topic+mlpsa">mlpsa</a></code>
method will perform this analysis in a multilevel, or clustered, fashion. That
is, the results of the <code><a href="#topic+mlpsa">mlpsa</a></code> procedure produce summary results
at level one (i.e. each strata within each cluster), level two (i.e. overall results
for each cluster), and overall (i.e. overall results across all clusters).
</p>
<p>This package also provides a number of visualizations that provide a critical
part in presenting, understanding, and interpreting the results. See
<code><a href="#topic+plot.mlpsa">plot.mlpsa</a></code> for details.
</p>


<h3>Author(s)</h3>

<p>Jason Bryer <a href="mailto:jason@bryer.org">jason@bryer.org</a>
</p>


<h3>References</h3>

<p><a href="https://CRAN.R-project.org/package=PSAgraphics">https://CRAN.R-project.org/package=PSAgraphics</a>
<a href="http://www.jstatsoft.org/v29/i06/">http://www.jstatsoft.org/v29/i06/</a>
</p>


<h3>See Also</h3>

<p><code>PSAgraphics</code>
</p>

<hr>
<h2 id='pisa.colnames'>Mapping of variables in <code><a href="#topic+pisana">pisana</a></code> with full descriptions.</h2><span id='topic+pisa.colnames'></span>

<h3>Description</h3>

<p>This data frame provides three variables, <code>Variable</code> corresponding to the
column names in <code><a href="#topic+pisana">pisana</a></code>, <code>ShortDesc</code> providing a short
description of the variable as a valid R object name, and <code>Desc</code> providing
a longer description of the variable.
</p>


<h3>Format</h3>

<p>a data frame with 50 rows of 3 variables.</p>

<hr>
<h2 id='pisa.countries'>Data frame mapping PISA countries to their three letter abbreviation.</h2><span id='topic+pisa.countries'></span>

<h3>Description</h3>

<p>This data frame has two columns, <code>CNT3</code> for the three letter abbreviation
of each country and <code>Country</code> that provides the full country name in English.
</p>


<h3>Format</h3>

<p>data frame with 65 rows of 2 variables.</p>

<hr>
<h2 id='pisa.psa.cols'>Character vector representing the list of covariates used for estimating
propensity scores.</h2><span id='topic+pisa.psa.cols'></span>

<h3>Description</h3>

<p>Character vector representing the list of covariates used for estimating
propensity scores.
</p>


<h3>Format</h3>

<p>a character vector with covariate names for estimating propensity scores.</p>

<hr>
<h2 id='pisana'>North American (i.e. Canada, Mexico, and United States) student results of the 2009
Programme of International Student Assessment.</h2><span id='topic+pisana'></span>

<h3>Description</h3>

<p>Student results from the 2009 Programme of International Student Assessment (PISA)
as provided by the Organization for Economic Co-operation and Development (OECD).
See <a href="http://www.pisa.oecd.org/">http://www.pisa.oecd.org/</a> for more information including the code book.
</p>


<h3>Format</h3>

<p>a data frame with 66,548 obvservations of 65 variables.</p>


<h3>Details</h3>

<p>Note that missing values have been imputed using the 
<a href="mice">http://cran.r-project.org/web/packages/mice/index.html</a> package.
Details on the specific procedure are in the <code>pisa.impute</code> function
in the <a href="http://github.com/jbryer/pisa"><code>pisa</code> package</a>.
</p>


<h3>Source</h3>

<p>Organization for Economic Co-operation and Development
</p>


<h3>References</h3>

<p>Organization for Economic Co-operation and Development (2009).
Programme for International Student Assessment (PISA). 
<a href="http://www.pisa.oecd.org/">http://www.pisa.oecd.org/</a>
</p>

<hr>
<h2 id='plot.covariate.balance'>Multiple covariate balance assessment plot.</h2><span id='topic+plot.covariate.balance'></span>

<h3>Description</h3>

<p>A graphic based upon <code>cv.bal.psa</code> function in the <code>PSAgraphics</code>
package. This graphic plots the effect sizes for multiple covariates before and
after propensity score adjustement.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'covariate.balance'
plot(x, plot.strata = FALSE,
  order = c("unadjusted", "adjusted"), strata.size = 3,
  strata.legend.guide = "none", point.size = 3, point.alpha = 1,
  line.color = "black", line.alpha = 0.2, legend.position = c(0.8, 0.2),
  ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.covariate.balance_+3A_x">x</code></td>
<td>
<p>results of <code><a href="#topic+covariate.balance">covariate.balance</a></code>.</p>
</td></tr>
<tr><td><code id="plot.covariate.balance_+3A_plot.strata">plot.strata</code></td>
<td>
<p>whether individual strata should be plotted.</p>
</td></tr>
<tr><td><code id="plot.covariate.balance_+3A_order">order</code></td>
<td>
<p>how to order the y-axis. Possible values are adjusted,
unadjusted, or NULL (don't reorder).</p>
</td></tr>
<tr><td><code id="plot.covariate.balance_+3A_strata.size">strata.size</code></td>
<td>
<p>text size for strata if plotted.</p>
</td></tr>
<tr><td><code id="plot.covariate.balance_+3A_strata.legend.guide">strata.legend.guide</code></td>
<td>
<p>guide for legend placement for strata.</p>
</td></tr>
<tr><td><code id="plot.covariate.balance_+3A_point.size">point.size</code></td>
<td>
<p>size of the overall effect size points.</p>
</td></tr>
<tr><td><code id="plot.covariate.balance_+3A_point.alpha">point.alpha</code></td>
<td>
<p>transparency level of the overall effect size points.</p>
</td></tr>
<tr><td><code id="plot.covariate.balance_+3A_line.color">line.color</code></td>
<td>
<p>the color of the line connecting the overall effect size points.</p>
</td></tr>
<tr><td><code id="plot.covariate.balance_+3A_line.alpha">line.alpha</code></td>
<td>
<p>transparency level of the line connecting the overall effect size points.</p>
</td></tr>
<tr><td><code id="plot.covariate.balance_+3A_legend.position">legend.position</code></td>
<td>
<p>where to position the legend.</p>
</td></tr>
<tr><td><code id="plot.covariate.balance_+3A_...">...</code></td>
<td>
<p>currently unused.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a ggplot2 with an attribute, <code>effects</code>, that is the data frame
used to create the plot.
</p>

<hr>
<h2 id='plot.mlpsa'>Plots the results of a multilevel propensity score model.</h2><span id='topic+plot.mlpsa'></span>

<h3>Description</h3>

<p>The plot created uses the <code>ggplot2</code> framework. As such, additional modifications
can be made. This plot is an extension of the <code>circ.psa</code> function in the
<code>PSAgraphics</code> package for multilevel models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mlpsa'
plot(x, ratio = c(1, 2), plotExtra = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.mlpsa_+3A_x">x</code></td>
<td>
<p>the results of <code><a href="#topic+mlpsa">mlpsa</a></code>.</p>
</td></tr>
<tr><td><code id="plot.mlpsa_+3A_ratio">ratio</code></td>
<td>
<p>the ratio of the size of the distribution plots (left and bottom)
to the circular plot.</p>
</td></tr>
<tr><td><code id="plot.mlpsa_+3A_plotextra">plotExtra</code></td>
<td>
<p>a plot to place in the lower left corner.</p>
</td></tr>
<tr><td><code id="plot.mlpsa_+3A_...">...</code></td>
<td>
<p>parameters passed to <code><a href="#topic+mlpsa.circ.plot">mlpsa.circ.plot</a></code> and 
<code><a href="#topic+mlpsa.distribution.plot">mlpsa.distribution.plot</a></code></p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
require(multilevelPSA)
require(party)
data(pisana)
data(pisa.colnames)
data(pisa.psa.cols)
mlctree = mlpsa.ctree(pisana[,c('CNT','PUBPRIV',pisa.psa.cols)], formula=PUBPRIV ~ ., level2='CNT')
student.party = getStrata(mlctree, pisana, level2='CNT')
student.party$mathscore = apply(student.party[,paste0('PV', 1:5, 'MATH')], 1, sum) / 5
results.psa.math = mlpsa(response=student.party$mathscore, 
       treatment=student.party$PUBPRIV, 
       strata=student.party$strata, 
       level2=student.party$CNT, minN=5)
plot(results.psa.math)

## End(Not run)
</code></pre>

<hr>
<h2 id='plot.psrange'>Plots densities and ranges for the propensity scores.</h2><span id='topic+plot.psrange'></span>

<h3>Description</h3>

<p>Plots densities and ranges for the propensity scores.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'psrange'
plot(x, xlab = NULL, ylab = NULL,
  labels = c("Comparison", "Treatment"), text.ratio.size = 4,
  text.ncontrol.size = 3, point.size = 1, point.alpha = 0.6,
  line.width = 6, density.alpha = 0.2, rect.color = "green",
  rect.alpha = 0.2, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.psrange_+3A_x">x</code></td>
<td>
<p>the result of psrange.</p>
</td></tr>
<tr><td><code id="plot.psrange_+3A_xlab">xlab</code></td>
<td>
<p>label for x-axis.</p>
</td></tr>
<tr><td><code id="plot.psrange_+3A_ylab">ylab</code></td>
<td>
<p>label for y-axis.</p>
</td></tr>
<tr><td><code id="plot.psrange_+3A_labels">labels</code></td>
<td>
<p>labels for the comparison and treatment legend.</p>
</td></tr>
<tr><td><code id="plot.psrange_+3A_text.ratio.size">text.ratio.size</code></td>
<td>
<p>size of the text for the ratio.</p>
</td></tr>
<tr><td><code id="plot.psrange_+3A_text.ncontrol.size">text.ncontrol.size</code></td>
<td>
<p>size of the text for the number of control units.</p>
</td></tr>
<tr><td><code id="plot.psrange_+3A_point.size">point.size</code></td>
<td>
<p>size of the points for the minimum and maximum ranges for
each model.</p>
</td></tr>
<tr><td><code id="plot.psrange_+3A_point.alpha">point.alpha</code></td>
<td>
<p>the alpha (transparency) level for the points.</p>
</td></tr>
<tr><td><code id="plot.psrange_+3A_line.width">line.width</code></td>
<td>
<p>the width of the line between the median of the minimum
and maximum ranges.</p>
</td></tr>
<tr><td><code id="plot.psrange_+3A_density.alpha">density.alpha</code></td>
<td>
<p>the alpha (transparency) level of the density curves.</p>
</td></tr>
<tr><td><code id="plot.psrange_+3A_rect.color">rect.color</code></td>
<td>
<p>the color of the rectangle surrounding the range of minimum
and maximum ranges.</p>
</td></tr>
<tr><td><code id="plot.psrange_+3A_rect.alpha">rect.alpha</code></td>
<td>
<p>the alpha (transparency) level of the rectangle.</p>
</td></tr>
<tr><td><code id="plot.psrange_+3A_...">...</code></td>
<td>
<p>currently unused.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a ggplot2 object
</p>

<hr>
<h2 id='print.covariate.balance'>Prints the overall effects before and after propensity score adjustment.</h2><span id='topic+print.covariate.balance'></span>

<h3>Description</h3>

<p>Prints the overall effects before and after propensity score adjustment.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'covariate.balance'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.covariate.balance_+3A_x">x</code></td>
<td>
<p>results of <code><a href="#topic+covariate.balance">covariate.balance</a></code>.</p>
</td></tr>
<tr><td><code id="print.covariate.balance_+3A_...">...</code></td>
<td>
<p>unused.</p>
</td></tr>
</table>

<hr>
<h2 id='print.mlpsa'>Prints basic information about a <code>mlpsa</code> class.</h2><span id='topic+print.mlpsa'></span>

<h3>Description</h3>

<p>Prints basic information about a <code>mlpsa</code> class.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mlpsa'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.mlpsa_+3A_x">x</code></td>
<td>
<p>the <code>mlpsa</code> class.</p>
</td></tr>
<tr><td><code id="print.mlpsa_+3A_...">...</code></td>
<td>
<p>unused.</p>
</td></tr>
</table>

<hr>
<h2 id='print.psrange'>Prints information about a psrange result.</h2><span id='topic+print.psrange'></span>

<h3>Description</h3>

<p>Prints information about a psrange result.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'psrange'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.psrange_+3A_x">x</code></td>
<td>
<p>psrange to print info about.</p>
</td></tr>
<tr><td><code id="print.psrange_+3A_...">...</code></td>
<td>
<p>currently unused</p>
</td></tr>
</table>

<hr>
<h2 id='print.xmlpsa'>Prints the results of <code><a href="#topic+mlpsa">mlpsa</a></code> and <code><a href="#topic+xtable.mlpsa">xtable.mlpsa</a></code>.</h2><span id='topic+print.xmlpsa'></span>

<h3>Description</h3>

<p>Print method for <code><a href="#topic+xtable.mlpsa">xtable.mlpsa</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'xmlpsa'
print(x, tabular.environment = "longtable",
  floating = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.xmlpsa_+3A_x">x</code></td>
<td>
<p>result of <code><a href="#topic+xtable.mlpsa">xtable.mlpsa</a></code></p>
</td></tr>
<tr><td><code id="print.xmlpsa_+3A_tabular.environment">tabular.environment</code></td>
<td>
<p>see <code><a href="xtable.html#topic+print.xtable">print.xtable</a></code>.</p>
</td></tr>
<tr><td><code id="print.xmlpsa_+3A_floating">floating</code></td>
<td>
<p>see <code><a href="xtable.html#topic+print.xtable">print.xtable</a></code>.</p>
</td></tr>
<tr><td><code id="print.xmlpsa_+3A_...">...</code></td>
<td>
<p>other parameters passed to <code><a href="xtable.html#topic+print.xtable">print.xtable</a></code></p>
</td></tr>
</table>

<hr>
<h2 id='psrange'>Estimates models with increasing number of comparison subjects starting from
1:1 to using all available comparison group subjects.</h2><span id='topic+psrange'></span>

<h3>Description</h3>

<p>Estimates models with increasing number of comparison subjects starting from
1:1 to using all available comparison group subjects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>psrange(df, treatvar, formula, nsteps = 10, nboot = 10, samples,
  type = c("logistic", "ctree"), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="psrange_+3A_df">df</code></td>
<td>
<p>data frame with variables to pass to glm</p>
</td></tr>
<tr><td><code id="psrange_+3A_treatvar">treatvar</code></td>
<td>
<p>vector representing treatment placement. Should be coded as
0s (for control) and 1s (for treatment).</p>
</td></tr>
<tr><td><code id="psrange_+3A_formula">formula</code></td>
<td>
<p>formula for logistic regression model</p>
</td></tr>
<tr><td><code id="psrange_+3A_nsteps">nsteps</code></td>
<td>
<p>number of steps to estimate from 1:1 to using all control records.</p>
</td></tr>
<tr><td><code id="psrange_+3A_nboot">nboot</code></td>
<td>
<p>number of models to execute for each step.</p>
</td></tr>
<tr><td><code id="psrange_+3A_samples">samples</code></td>
<td>
<p>the sample sizes to draw from control group for each step.</p>
</td></tr>
<tr><td><code id="psrange_+3A_type">type</code></td>
<td>
<p>either logistic for Logistic regression (using <code>glm</code> 
function) or ctree for Conditional Inference Trees (using the 
<code>ctree</code> function).</p>
</td></tr>
<tr><td><code id="psrange_+3A_...">...</code></td>
<td>
<p>other parameters passed to glm.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a class of psrange that contains a summary data frame, a details data
frame, and a list of each individual result from glm.
</p>

<hr>
<h2 id='summary.mlpsa'>Provides a summary of a <code>mlpsa</code> class.</h2><span id='topic+summary.mlpsa'></span>

<h3>Description</h3>

<p>Provides a summary of a <code>mlpsa</code> class.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mlpsa'
summary(object, overall.label = "Overall", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.mlpsa_+3A_object">object</code></td>
<td>
<p>the mlpsa object.</p>
</td></tr>
<tr><td><code id="summary.mlpsa_+3A_overall.label">overall.label</code></td>
<td>
<p>the label to place in the strata column for the overall results.</p>
</td></tr>
<tr><td><code id="summary.mlpsa_+3A_...">...</code></td>
<td>
<p>unused.</p>
</td></tr>
</table>

<hr>
<h2 id='summary.psrange'>Prints the summary results of psrange.</h2><span id='topic+summary.psrange'></span>

<h3>Description</h3>

<p>Prints the summary results of psrange.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'psrange'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.psrange_+3A_object">object</code></td>
<td>
<p>psrange to print summary of.</p>
</td></tr>
<tr><td><code id="summary.psrange_+3A_...">...</code></td>
<td>
<p>currently unused.</p>
</td></tr>
</table>

<hr>
<h2 id='tree.plot'>Heat map representing variables used in a conditional inference tree across level 2 variables.</h2><span id='topic+tree.plot'></span>

<h3>Description</h3>

<p>This figure provides a summary of the covariates used within each level two cluster
along with their relative importance. Covariates are listed on the y-axis and 
level two clusters along the x-axis. Cells that are shaded indicate that that
covariate was present in the conditional. The shade of the color represents
the highest level within the tree that covariate appeared. That is, the darkest
color, or depth 1, corresponds to the covariate used at the root of the tree, or
the first split.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tree.plot(x, colNames, level2Col, colLabels = NULL, color.high = "azure",
  color.low = "steelblue", color.na = "white", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tree.plot_+3A_x">x</code></td>
<td>
<p>the results of <code><a href="#topic+mlpsa.ctree">mlpsa.ctree</a></code></p>
</td></tr>
<tr><td><code id="tree.plot_+3A_colnames">colNames</code></td>
<td>
<p>the columns to include in the graphic</p>
</td></tr>
<tr><td><code id="tree.plot_+3A_level2col">level2Col</code></td>
<td>
<p>the name of the level 2 column.</p>
</td></tr>
<tr><td><code id="tree.plot_+3A_collabels">colLabels</code></td>
<td>
<p>column labels to use. This is a data frame with two columns, the
first column should match the values in <code>trees</code> and the second column
the description that will be used for labeling the variables.</p>
</td></tr>
<tr><td><code id="tree.plot_+3A_color.high">color.high</code></td>
<td>
<p>color for variables with less relative importance as determined
by occurring later in the tree (further from the root split).</p>
</td></tr>
<tr><td><code id="tree.plot_+3A_color.low">color.low</code></td>
<td>
<p>color for variables with greater relative importance as determined
by occurring sooner in the tree (closer to the root split).</p>
</td></tr>
<tr><td><code id="tree.plot_+3A_color.na">color.na</code></td>
<td>
<p>color for variables that do not occur in the tree.</p>
</td></tr>
<tr><td><code id="tree.plot_+3A_...">...</code></td>
<td>
<p>currently unused.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a ggplot2 expression
</p>


<h3>See Also</h3>

<p>plot.mlpsa
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
require(party)
data(pisana)
data(pisa.colnames)
data(pisa.psa.cols)
mlctree = mlpsa.ctree(pisana[,c('CNT','PUBPRIV',pisa.psa.cols)], formula=PUBPRIV ~ ., level2='CNT')
student.party = getStrata(mlctree, pisana, level2='CNT')
tree.plot(mlctree, level2Col=pisana$CNT)

## End(Not run)
</code></pre>

<hr>
<h2 id='xtable.mlpsa'>Prints the results of <code><a href="#topic+mlpsa">mlpsa</a></code> as a LaTeX table.</h2><span id='topic+xtable.mlpsa'></span>

<h3>Description</h3>

<p>This function implements the <code><a href="xtable.html#topic+xtable">xtable</a></code> method for <code><a href="#topic+mlpsa">mlpsa</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mlpsa'
xtable(x, caption, label, align, digits = 2, display = NULL,
  auto = FALSE, include.note = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="xtable.mlpsa_+3A_x">x</code></td>
<td>
<p>results of <code><a href="#topic+mlpsa">mlpsa</a></code></p>
</td></tr>
<tr><td><code id="xtable.mlpsa_+3A_caption">caption</code></td>
<td>
<p>passed through to <code><a href="xtable.html#topic+xtable">xtable</a></code>.</p>
</td></tr>
<tr><td><code id="xtable.mlpsa_+3A_label">label</code></td>
<td>
<p>passed through to <code><a href="xtable.html#topic+xtable">xtable</a></code>.</p>
</td></tr>
<tr><td><code id="xtable.mlpsa_+3A_align">align</code></td>
<td>
<p>Not used.</p>
</td></tr>
<tr><td><code id="xtable.mlpsa_+3A_digits">digits</code></td>
<td>
<p>number of digits to print.</p>
</td></tr>
<tr><td><code id="xtable.mlpsa_+3A_display">display</code></td>
<td>
<p>passed through to <code><a href="xtable.html#topic+xtable">xtable</a></code>.</p>
</td></tr>
<tr><td><code id="xtable.mlpsa_+3A_auto">auto</code></td>
<td>
<p>passed through to <code><a href="xtable.html#topic+xtable">xtable</a></code>.</p>
</td></tr>
<tr><td><code id="xtable.mlpsa_+3A_include.note">include.note</code></td>
<td>
<p>include a table note indicating how many rows were removed
due to insufficient data within a strata.</p>
</td></tr>
<tr><td><code id="xtable.mlpsa_+3A_...">...</code></td>
<td>
<p>other parameters passed to <code><a href="#topic+summary.mlpsa">summary.mlpsa</a></code></p>
</td></tr>
</table>

<hr>
<h2 id='zeroGrob'>The zero grob draws nothing and has zero size.</h2><span id='topic+zeroGrob'></span>

<h3>Description</h3>

<p>The zero grob draws nothing and has zero size.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>zeroGrob()
</code></pre>


<h3>Author(s)</h3>

<p>hadley
</p>


<h3>References</h3>

<p>https://github.com/hadley/ggplot2/blob/master/R/grob-null.r
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
