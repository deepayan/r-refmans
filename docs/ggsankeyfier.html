<!DOCTYPE html><html><head><title>Help for package ggsankeyfier</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ggsankeyfier}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#draw_key_sankeyedge'><p>Key glyphs for legends</p></a></li>
<li><a href='#ecosystem_services'><p>Data on risks to supply ecosystem services</p></a></li>
<li><a href='#GeomSankeynode'><p>Bars representing nodes in a Sankey diagram</p></a></li>
<li><a href='#GeomSankeysegment'><p>Sankey edges (flows)</p></a></li>
<li><a href='#ggsankeyfier-package'><p>ggsankeyfier: Create Sankey and Alluvial Diagrams Using 'ggplot2'</p></a></li>
<li><a href='#pivot_stages_longer'><p>Pivot wide data to long for plotting as Sankey</p></a></li>
<li><a href='#PositionSankey'><p>Position nodes and edges in a Sankey diagram</p></a></li>
<li><a href='#scale_waist_continuous'><p>Sankey edge waist line scales</p></a></li>
<li><a href='#StatSankeyedge'><p>Sankey stats</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Create Sankey and Alluvial Diagrams Using 'ggplot2'</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.7</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-02-29</td>
</tr>
<tr>
<td>Author:</td>
<td>Pepijn de Vries <a href="https://orcid.org/0000-0002-7961-6646"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre, dtc],
  Gerjan Piet <a href="https://orcid.org/0000-0003-0702-1624"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [dtc],
  Ruud Jongbloed <a href="https://orcid.org/0000-0002-9378-5382"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [dtc],
  Anne Grundlehner <a href="https://orcid.org/0000-0003-3375-3511"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [dtc],
  Jacqueline Tamis <a href="https://orcid.org/0000-0002-8206-5830"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [dtc]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Pepijn de Vries &lt;pepijn.devries@outlook.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Sankey and alluvial diagrams visualise flows of quantities across
    stages in stacked bars. This package makes it easy to create such
    diagrams using 'ggplot2'.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.1.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr, ggplot2 (&ge; 3.4.4), grid (&ge; 4.1.0), gridBezier,
methods, rlang, scales, stats, tidyr, vwline</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, stringr, svglite, testthat (&ge; 3.0.0),
vdiffr</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Collate:</td>
<td>'draw_edges.r' 'draw_key.r' 'ecosystem_services.r'
'geom_segment.r' 'scale_waist.r' 'geom_edge.r'
'position_helpers.r' 'geom_node.r' 'ggsankeyfier-package.r'
'imports.r' 'pivot_stages.r' 'position.r' 'short_cuts.r'
'stat_edge.r' 'stat_node_helpers.r' 'stat_node.r'</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://pepijn-devries.github.io/ggsankeyfier/">https://pepijn-devries.github.io/ggsankeyfier/</a>,
<a href="https://github.com/pepijn-devries/ggsankeyfier/">https://github.com/pepijn-devries/ggsankeyfier/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/pepijn-devries/ggsankeyfier/issues">https://github.com/pepijn-devries/ggsankeyfier/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-02-29 22:38:56 UTC; vries171</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-03-01 15:02:37 UTC</td>
</tr>
</table>
<hr>
<h2 id='draw_key_sankeyedge'>Key glyphs for legends</h2><span id='topic+draw_key_sankeyedge'></span><span id='topic+draw_key_sankeynode'></span>

<h3>Description</h3>

<p>Each geom has an associated function that draws the key when the geom needs
to be displayed in a legend. These functions are called <code style="white-space: pre;">&#8288;draw_key_*()&#8288;</code>, where
<code>*</code> stands for the name of the respective key glyph. The key glyphs can be
customized for individual geoms by providing a geom with the <code>key_glyph</code>
argument (see <code><a href="ggplot2.html#topic+layer">layer()</a></code> or examples below.)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>draw_key_sankeyedge(data, params, size)

draw_key_sankeynode(data, params, size)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="draw_key_sankeyedge_+3A_data">data</code></td>
<td>
<p>A single row data frame containing the scaled aesthetics to
display in this key</p>
</td></tr>
<tr><td><code id="draw_key_sankeyedge_+3A_params">params</code></td>
<td>
<p>A list of additional parameters supplied to the geom.</p>
</td></tr>
<tr><td><code id="draw_key_sankeyedge_+3A_size">size</code></td>
<td>
<p>Width and height of key in mm.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A grid grob.
</p>


<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## The key glyph for sankey diagrams can be applied to different geoms as well.
## In the example below it is applied to a histogram

library(ggplot2)
ggplot(data.frame(x = rnorm(100), groups = rep(letters[1:2], 2)),
       aes(x = x, fill = groups)) +
  geom_histogram(key_glyph = draw_key_sankeyedge, binwidth = 0.2, alpha = 1)
ggplot(data.frame(x = rnorm(100), groups = rep(letters[1:2], 2)),
       aes(x = x, fill = groups)) +
  geom_histogram(key_glyph = draw_key_sankeynode, binwidth = 0.2)

</code></pre>

<hr>
<h2 id='ecosystem_services'>Data on risks to supply ecosystem services</h2><span id='topic+ecosystem_services'></span><span id='topic+ecosystem_services_pivot1'></span><span id='topic+ecosystem_services_pivot2'></span>

<h3>Description</h3>

<p>Data indicating a risk resulting from anthropological activities to the
marine ecosystem and its capacity to supply services.
This data set serves (aggregated from Piet <em>et al.</em> (submitted)) as an example
to illustrate the package's features.
</p>


<h3>Format</h3>

<p><code>ecosystem_services</code> is  a <code>data.frame</code> with
3421 rows and 8 columns.
The columns are:
</p>

<ul>
<li> <p><code>activity_type</code>: Type of activities that pose a risk
</p>
</li>
<li> <p><code>activity_realm</code>: Aggregation of activity types
</p>
</li>
<li> <p><code>pressure_cat</code>: Category of pressures exerted by the activities and
eventually pose a risk to the ecosystem.
</p>
</li>
<li> <p><code>biotic_group</code>: Biotic groups affected by the pressures.
</p>
</li>
<li> <p><code>biotic_realm</code>: Aggregation of biotic groups
</p>
</li>
<li> <p><code>service_division</code>: Division of ecosystem services that are
provided by the biotic groups and affected by the activities.
</p>
</li>
<li> <p><code>service_section</code>: Aggregation of service divisions.
</p>
</li>
<li> <p><code>RCSES</code>: 'Risk to Capacity to Supply Ecosystem Services'.
A numerical score reflecting the amount of risk for the ecosystem to
supply specific services. For more details see Piet et al. (submitted)
</p>
</li></ul>

<p>This <code>data.frame</code> is in a wide oriented format, typical for most common
applications. Each row in the <code>data.frame</code> represents a unique pathway where each
<code>activity_tpe</code> poses a risk to an ecosystem <code>sevice_division</code>, via a
<code>pressure_cat</code> and <code>biotic_group</code>. Each column either contains information on
a specific stage or the overall quantifier (in this case <code>RCSES</code>).
</p>
<p>In its present form it is not suitable to directly plot as a Sankey diagram.
For that purpose it needs to be pivoted with <code><a href="#topic+pivot_stages_longer">pivot_stages_longer()</a></code>. Two
different variants are prepared with this function: <code>ecosystem_services_pivot1</code>
and <code>ecosystem_services_pivot2</code>.
</p>
<p>The latter pivot contains <code>service_section</code> as an extra feature which can be used
for additional decoration of a Sankey diagram. It is therefore more detailed than
the first alternative.
</p>
<p><code>ecosystem_services_pivot1</code> is  a <code>data.frame</code> with
112 rows and 5
columns. Columns are:
</p>

<ul>
<li> <p><code>RCSES</code>: See above at <code>ecosystem_services</code>.
</p>
</li>
<li> <p><code>edge_id</code>: Unique numerical identifier for each edge in a Sankey diagram.
</p>
</li>
<li> <p><code>connector</code>: One of <code>'from'</code> or <code>'to'</code>, indicating whether we are looking
at the start or the end of an edge.
</p>
</li>
<li> <p><code>node</code>: A collection of <code>activity_realm</code>, <code>pressure_cat</code>, <code>biotic_realm</code> and
<code>service_section</code> values from the <code>ecosystem_services</code> <code>data.frame</code>.
</p>
</li>
<li> <p><code>stage</code>: Stages in a Sankey diagram formed by the columns <code>activity_realm</code>,
<code>pressure_cat</code>, <code>biotic_realm</code> and <code>service_section</code> from the
<code>ecosystem_services</code> <code>data.frame</code>.
</p>
</li></ul>

<p><code>ecosystem_services_pivot1</code> is created from <code>ecosystem_services</code> using
<code><a href="#topic+pivot_stages_longer">pivot_stages_longer()</a></code> and can be used directly in a Sankey diagram (using
<code><a href="#topic+geom_sankeynode">geom_sankeynode()</a></code> and <code><a href="#topic+geom_sankeyedge">geom_sankeyedge()</a></code>)
</p>
<p><code>ecosystem_services_pivot2</code> is  a <code>data.frame</code> with
252 rows and 6.
It is the same as <code>ecosystem_services_pivot1</code> with the exception of a distinct
extra column <code>service_division</code> which allows for more detailed aesthetics in
a Sankey diagram.
</p>


<h3>Author(s)</h3>

<p>Pepijn de Vries, Gerjan Piet, Jacob Bentley, Ruud Jongbloed, Anne Grundlehner, Jacqueline Tamis
</p>


<h3>References</h3>

<p>Piet GJ, Bentley J, Jongbloed RH, Grundlehner A, Tamis JE, De Vries P
(submitted) A Cumulative Impact Assessment on the North Sea Capacity to
Supply Ecosystem Services. <a href="https://doi.org/10.2139/ssrn.4450241">doi:10.2139/ssrn.4450241</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("ecosystem_services")
library(ggplot2)

if (requireNamespace("stringr")) {
  library(stringr)

  pos &lt;- position_sankey(v_space = "auto", align = "justify")
  pos_text &lt;- position_sankey(v_space = "auto", align = "justify", nudge_x = 0.1)

  ## A simplified version of the Sankey diagram as published by Piet _et al._ (submitted)
  ggplot(ecosystem_services |&gt;
           pivot_stages_longer(
             c("activity_type", "pressure_cat", "biotic_group", "service_section"),
             "RCSES"),
         aes(x = stage, y = RCSES, group = node, connector = connector, edge_id = edge_id)) +
    geom_sankeyedge(aes(fill = RCSES), position = pos) +
    geom_sankeynode(position = pos) +
    geom_text(aes(label = str_wrap(node, 20)), position = pos_text, stat = "sankeynode",
              hjust = 0, cex = 2) +
    scale_fill_viridis_c(option = "turbo", trans = "sqrt") +
    theme_minimal()
}
</code></pre>

<hr>
<h2 id='GeomSankeynode'>Bars representing nodes in a Sankey diagram</h2><span id='topic+GeomSankeynode'></span><span id='topic+geom_sankeynode'></span>

<h3>Description</h3>

<p>In a Sankey diagram nodes are depicted as stacked bars, possibly with
vertical spacing between them. Use <code>geom_sankeynode()</code> to add nodes to
your Sankey diagram. If you combine the nodes with <code><a href="#topic+geom_sankeyedge">geom_sankeyedge()</a></code>,
make sure that both use the same <code>position</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GeomSankeynode

geom_sankeynode(
  mapping = NULL,
  data = NULL,
  stat = "sankeynode",
  position = "sankey",
  na.rm = FALSE,
  show.legend = NA,
  width = "auto",
  align = c("bottom", "top", "center", "justify"),
  order = c("ascending", "descending", "as_is"),
  h_space = "auto",
  v_space = 0,
  nudge_x = 0,
  nudge_y = 0,
  split_nodes = FALSE,
  split_tol = 0.001,
  direction = c("forward", "backward"),
  inherit.aes = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="GeomSankeynode_+3A_mapping">mapping</code></td>
<td>
<p>Set of aesthetic mappings created by <code><a href="ggplot2.html#topic+aes">aes()</a></code>. If specified and
<code>inherit.aes = TRUE</code> (the default), it is combined with the default mapping
at the top level of the plot. You must supply <code>mapping</code> if there is no plot
mapping.</p>
</td></tr>
<tr><td><code id="GeomSankeynode_+3A_data">data</code></td>
<td>
<p>The data to be displayed in this layer. There are three
options:
</p>
<p>If <code>NULL</code>, the default, the data is inherited from the plot
data as specified in the call to <code><a href="ggplot2.html#topic+ggplot">ggplot()</a></code>.
</p>
<p>A <code>data.frame</code>, or other object, will override the plot
data. All objects will be fortified to produce a data frame. See
<code><a href="ggplot2.html#topic+fortify">fortify()</a></code> for which variables will be created.
</p>
<p>A <code>function</code> will be called with a single argument,
the plot data. The return value must be a <code>data.frame</code>, and
will be used as the layer data. A <code>function</code> can be created
from a <code>formula</code> (e.g. <code>~ head(.x, 10)</code>).</p>
</td></tr>
<tr><td><code id="GeomSankeynode_+3A_stat">stat</code></td>
<td>
<p>The statistical transformation to use on the data for this
layer, either as a <code>ggproto</code> <code>Geom</code> subclass or as a string naming the
stat stripped of the <code>stat_</code> prefix (e.g. <code>"count"</code> rather than
<code>"stat_count"</code>)</p>
</td></tr>
<tr><td><code id="GeomSankeynode_+3A_position">position</code></td>
<td>
<p>Position adjustment, either as a string naming the adjustment
(e.g. <code>"jitter"</code> to use <code>position_jitter</code>), or the result of a call to a
position adjustment function. Use the latter if you need to change the
settings of the adjustment.</p>
</td></tr>
<tr><td><code id="GeomSankeynode_+3A_na.rm">na.rm</code></td>
<td>
<p>If <code>FALSE</code>, the default, missing values are removed with
a warning. If <code>TRUE</code>, missing values are silently removed.</p>
</td></tr>
<tr><td><code id="GeomSankeynode_+3A_show.legend">show.legend</code></td>
<td>
<p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.
It can also be a named logical vector to finely select the aesthetics to
display.</p>
</td></tr>
<tr><td><code id="GeomSankeynode_+3A_width">width</code></td>
<td>
<p>Width of the node (<code>numeric</code>). When <code>split_nodes</code> is set to <code>TRUE</code>
each part of the split node will have half this width. Use <code>"auto"</code> to automatically
determine a suitable width.</p>
</td></tr>
<tr><td><code id="GeomSankeynode_+3A_align">align</code></td>
<td>
<p>A <code>character</code> that indicates how the nodes across the stages are aligned.
It can be any of <code>"top"</code>, <code>"bottom"</code>, <code>"center"</code> or <code>"justify"</code>.</p>
</td></tr>
<tr><td><code id="GeomSankeynode_+3A_order">order</code></td>
<td>
<p>A <code>character</code> indicating the method to be used for the order of stacking
nodes and edges in a plot.
Should be one of: <code>ascending</code> (default), sorts nodes and edges from large to small
(largest on top); <code>descending</code> sorts nodes and edges from small to large (smallest
on top); <code>as_is</code> will leave the order of nodes and edges as they are in <code>data</code>.</p>
</td></tr>
<tr><td><code id="GeomSankeynode_+3A_h_space">h_space</code></td>
<td>
<p>Horizontal space between split nodes (<code>numeric</code>). This argument is
ignored when <code>split_nodes == FALSE</code>. Use <code>"auto"</code> to automatically position split nodes.</p>
</td></tr>
<tr><td><code id="GeomSankeynode_+3A_v_space">v_space</code></td>
<td>
<p>Vertical space between nodes (<code>numeric</code>). When set to zero (<code>0</code>),
the Sankey diagram becomes an alluvial plot. Use <code>"auto"</code> to automatically determine
a suitable vertical space.</p>
</td></tr>
<tr><td><code id="GeomSankeynode_+3A_nudge_x">nudge_x</code>, <code id="GeomSankeynode_+3A_nudge_y">nudge_y</code></td>
<td>
<p>Horizontal and vertical adjustment to nudge items by. Can
be useful for offsetting labels.</p>
</td></tr>
<tr><td><code id="GeomSankeynode_+3A_split_nodes">split_nodes</code></td>
<td>
<p>A <code>logical</code> value indicating whether the source and destination nodes
should be depicted as separate boxes.</p>
</td></tr>
<tr><td><code id="GeomSankeynode_+3A_split_tol">split_tol</code></td>
<td>
<p>When the relative node size (resulting source and destination edges)
differs more than this fraction, the node will be displayed as two separate bars.</p>
</td></tr>
<tr><td><code id="GeomSankeynode_+3A_direction">direction</code></td>
<td>
<p>One of <code>"forward"</code> (default) or <code>"backward"</code>. When set to <code>"backward"</code>
the direction of the edges will be inverted. In most cases this
parameter won't affect the plot. It can be helpful when you want to decorate the
end of an edge (instead of the start; see examples).</p>
</td></tr>
<tr><td><code id="GeomSankeynode_+3A_inherit.aes">inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics,
rather than combining with them. This is most useful for helper functions
that define both data and aesthetics and shouldn't inherit behaviour from
the default plot specification, e.g. <code><a href="ggplot2.html#topic+borders">borders()</a></code>.</p>
</td></tr>
<tr><td><code id="GeomSankeynode_+3A_...">...</code></td>
<td>
<p>Other arguments passed on to <code><a href="ggplot2.html#topic+layer">layer()</a></code>. These are
often aesthetics, used to set an aesthetic to a fixed value, like
<code>colour = "red"</code> or <code>size = 3</code>. They may also be parameters
to the paired geom/stat.</p>
</td></tr>
</table>


<h3>Format</h3>

<p>An object of class <code>GeomSankeynode</code> (inherits from <code>GeomBar</code>, <code>GeomRect</code>, <code>Geom</code>, <code>ggproto</code>, <code>gg</code>) of length 6.
</p>


<h3>Details</h3>

<p>This <code>ggplot2</code> layer depicts the size of all connected edges as a bar. The height of
of each bar is determined by the sum of <code>y</code> aesthetic in each <code>group</code>. When the sum of edges
that flow to a bar differ more than <code>split_tol</code> compared to the edges that flow from the
same node, a vertical split is introduced in the node.
</p>


<h3>Value</h3>

<p>Returns a <code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code> which can be added to a <code><a href="ggplot2.html#topic+ggplot">ggplot2::ggplot()</a></code>
</p>


<h3>Aesthetics</h3>

<p><code>geom_sankeynode()</code> understands the following aesthetics (required aesthetics
are in bold)
</p>
<p><img src="../help/figures/important_aspects.svg" alt="Important aspects" />
</p>

<ul>
<li> <p><strong><code>x</code></strong>: Works for variables on a discrete scale. Might work for continuous variables
but is not guaranteed. This variable is used to distinguish between stages in the
Sankey diagram on the x axis.
</p>
</li>
<li> <p><strong><code>y</code></strong>: A continuous variable representing the width of the edges in a Sankey
diagram.
</p>
</li>
<li> <p><strong><code>group</code></strong>: A discrete variable used for grouping edges to nodes in each stage.
Essentially it is an identifier for the nodes.
</p>
</li>
<li> <p><strong><code>connector</code></strong>: Indicates which side of an edge is reflected by the corresponding
record. Should be one of <code>"from"</code> or <code>"to"</code>.
</p>
</li>
<li> <p><strong><code>edge_id</code></strong>: A unique identifier value for each edge. This identifier is used
to link specific <code>"from"</code> and <code>"to"</code> records in an edge (flow).
</p>
</li>
<li><p> fill: see <code>vignette("ggplot2-specs", "ggplot2")</code>
</p>
</li>
<li><p> colour: see <code>vignette("ggplot2-specs", "ggplot2")</code>
</p>
</li>
<li><p> linetype: see <code>vignette("ggplot2-specs", "ggplot2")</code>
</p>
</li>
<li><p> linewidth: see <code>vignette("ggplot2-specs", "ggplot2")</code>
</p>
</li>
<li><p> alpha: A variable to control the opacity of an element.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ggplot2)
data("ecosystem_services")

ggplot(ecosystem_services_pivot1, aes(x = stage, y = RCSES, group = node,
                    connector = connector, edge_id = edge_id,
                    fill = node)) +
  geom_sankeynode(v_space = "auto") +
  geom_sankeyedge(v_space = "auto")
</code></pre>

<hr>
<h2 id='GeomSankeysegment'>Sankey edges (flows)</h2><span id='topic+GeomSankeysegment'></span><span id='topic+geom_sankeysegment'></span><span id='topic+GeomSankeyedge'></span><span id='topic+geom_sankeyedge'></span>

<h3>Description</h3>

<p><code>geom_sankeysegment()</code> draws a straight line between two connected nodes,
<code>geom_sankeyedge()</code> draws a ribbon between nodes following a Bezier curved path.
If you combine the edges with <code><a href="#topic+geom_sankeynode">geom_sankeynode()</a></code>, make sure that both use the
same <code>position</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GeomSankeysegment

geom_sankeysegment(
  mapping = NULL,
  data = NULL,
  stat = "sankeyedge",
  position = "sankey",
  na.rm = FALSE,
  show.legend = NA,
  order = c("ascending", "descending", "as_is"),
  width = "auto",
  align = c("bottom", "top", "center", "justify"),
  h_space = "auto",
  v_space = 0,
  nudge_x = 0,
  nudge_y = 0,
  split_nodes = FALSE,
  split_tol = 0.001,
  direction = c("forward", "backward"),
  inherit.aes = TRUE,
  ...
)

GeomSankeyedge

geom_sankeyedge(
  mapping = NULL,
  data = NULL,
  stat = "sankeyedge",
  position = "sankey",
  na.rm = FALSE,
  show.legend = NA,
  slope = 0.5,
  ncp = 100,
  width = "auto",
  align = c("bottom", "top", "center", "justify"),
  order = c("ascending", "descending", "as_is"),
  h_space = "auto",
  v_space = 0,
  nudge_x = 0,
  nudge_y = 0,
  split_nodes = FALSE,
  split_tol = 0.001,
  direction = c("forward", "backward"),
  inherit.aes = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="GeomSankeysegment_+3A_mapping">mapping</code></td>
<td>
<p>Set of aesthetic mappings created by <code><a href="ggplot2.html#topic+aes">aes()</a></code>. If specified and
<code>inherit.aes = TRUE</code> (the default), it is combined with the default mapping
at the top level of the plot. You must supply <code>mapping</code> if there is no plot
mapping.</p>
</td></tr>
<tr><td><code id="GeomSankeysegment_+3A_data">data</code></td>
<td>
<p>The data to be displayed in this layer. There are three
options:
</p>
<p>If <code>NULL</code>, the default, the data is inherited from the plot
data as specified in the call to <code><a href="ggplot2.html#topic+ggplot">ggplot()</a></code>.
</p>
<p>A <code>data.frame</code>, or other object, will override the plot
data. All objects will be fortified to produce a data frame. See
<code><a href="ggplot2.html#topic+fortify">fortify()</a></code> for which variables will be created.
</p>
<p>A <code>function</code> will be called with a single argument,
the plot data. The return value must be a <code>data.frame</code>, and
will be used as the layer data. A <code>function</code> can be created
from a <code>formula</code> (e.g. <code>~ head(.x, 10)</code>).</p>
</td></tr>
<tr><td><code id="GeomSankeysegment_+3A_stat">stat</code></td>
<td>
<p>The statistical transformation to use on the data for this
layer, either as a <code>ggproto</code> <code>Geom</code> subclass or as a string naming the
stat stripped of the <code>stat_</code> prefix (e.g. <code>"count"</code> rather than
<code>"stat_count"</code>)</p>
</td></tr>
<tr><td><code id="GeomSankeysegment_+3A_position">position</code></td>
<td>
<p>Position adjustment, either as a string naming the adjustment
(e.g. <code>"jitter"</code> to use <code>position_jitter</code>), or the result of a call to a
position adjustment function. Use the latter if you need to change the
settings of the adjustment.</p>
</td></tr>
<tr><td><code id="GeomSankeysegment_+3A_na.rm">na.rm</code></td>
<td>
<p>If <code>FALSE</code>, the default, missing values are removed with
a warning. If <code>TRUE</code>, missing values are silently removed.</p>
</td></tr>
<tr><td><code id="GeomSankeysegment_+3A_show.legend">show.legend</code></td>
<td>
<p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.
It can also be a named logical vector to finely select the aesthetics to
display.</p>
</td></tr>
<tr><td><code id="GeomSankeysegment_+3A_order">order</code></td>
<td>
<p>A <code>character</code> indicating the method to be used for the order of stacking
nodes and edges in a plot.
Should be one of: <code>ascending</code> (default), sorts nodes and edges from large to small
(largest on top); <code>descending</code> sorts nodes and edges from small to large (smallest
on top); <code>as_is</code> will leave the order of nodes and edges as they are in <code>data</code>.</p>
</td></tr>
<tr><td><code id="GeomSankeysegment_+3A_width">width</code></td>
<td>
<p>Width of the node (<code>numeric</code>). When <code>split_nodes</code> is set to <code>TRUE</code>
each part of the split node will have half this width. Use <code>"auto"</code> to automatically
determine a suitable width.</p>
</td></tr>
<tr><td><code id="GeomSankeysegment_+3A_align">align</code></td>
<td>
<p>A <code>character</code> that indicates how the nodes across the stages are aligned.
It can be any of <code>"top"</code>, <code>"bottom"</code>, <code>"center"</code> or <code>"justify"</code>.</p>
</td></tr>
<tr><td><code id="GeomSankeysegment_+3A_h_space">h_space</code></td>
<td>
<p>Horizontal space between split nodes (<code>numeric</code>). This argument is
ignored when <code>split_nodes == FALSE</code>. Use <code>"auto"</code> to automatically position split nodes.</p>
</td></tr>
<tr><td><code id="GeomSankeysegment_+3A_v_space">v_space</code></td>
<td>
<p>Vertical space between nodes (<code>numeric</code>). When set to zero (<code>0</code>),
the Sankey diagram becomes an alluvial plot. Use <code>"auto"</code> to automatically determine
a suitable vertical space.</p>
</td></tr>
<tr><td><code id="GeomSankeysegment_+3A_nudge_x">nudge_x</code>, <code id="GeomSankeysegment_+3A_nudge_y">nudge_y</code></td>
<td>
<p>Horizontal and vertical adjustment to nudge items by. Can
be useful for offsetting labels.</p>
</td></tr>
<tr><td><code id="GeomSankeysegment_+3A_split_nodes">split_nodes</code></td>
<td>
<p>A <code>logical</code> value indicating whether the source and destination nodes
should be depicted as separate boxes.</p>
</td></tr>
<tr><td><code id="GeomSankeysegment_+3A_split_tol">split_tol</code></td>
<td>
<p>When the relative node size (resulting source and destination edges)
differs more than this fraction, the node will be displayed as two separate bars.</p>
</td></tr>
<tr><td><code id="GeomSankeysegment_+3A_direction">direction</code></td>
<td>
<p>One of <code>"forward"</code> (default) or <code>"backward"</code>. When set to <code>"backward"</code>
the direction of the edges will be inverted. In most cases this
parameter won't affect the plot. It can be helpful when you want to decorate the
end of an edge (instead of the start; see examples).</p>
</td></tr>
<tr><td><code id="GeomSankeysegment_+3A_inherit.aes">inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics,
rather than combining with them. This is most useful for helper functions
that define both data and aesthetics and shouldn't inherit behaviour from
the default plot specification, e.g. <code><a href="ggplot2.html#topic+borders">borders()</a></code>.</p>
</td></tr>
<tr><td><code id="GeomSankeysegment_+3A_...">...</code></td>
<td>
<p>Other arguments passed on to <code><a href="ggplot2.html#topic+layer">layer()</a></code>. These are
often aesthetics, used to set an aesthetic to a fixed value, like
<code>colour = "red"</code> or <code>size = 3</code>. They may also be parameters
to the paired geom/stat.</p>
</td></tr>
<tr><td><code id="GeomSankeysegment_+3A_slope">slope</code></td>
<td>
<p>Slope parameter (<code>numeric</code>) for the Bezier curves used to depict the edges.
Any value between 0 and 1 will work nicely. Other non-zero values will also work.</p>
</td></tr>
<tr><td><code id="GeomSankeysegment_+3A_ncp">ncp</code></td>
<td>
<p>Number of control points on the Bezier curve that forms the edge. Larger
numbers will result in smoother curves, but cost more computational time. Default is
100.</p>
</td></tr>
</table>


<h3>Format</h3>

<p>An object of class <code>GeomSankeysegment</code> (inherits from <code>GeomSegment</code>, <code>Geom</code>, <code>ggproto</code>, <code>gg</code>) of length 4.
</p>
<p>An object of class <code>GeomSankeyedge</code> (inherits from <code>GeomSankeysegment</code>, <code>GeomSegment</code>, <code>Geom</code>, <code>ggproto</code>, <code>gg</code>) of length 7.
</p>


<h3>Details</h3>

<p>This <code>ggplot2</code> layer connects between paired nodes via a Bezier curve. The width
of the curve is determined by its <code>y</code> aesthetic. It will be attempted to keep the
width of the curve constant along its curved path, for the targeted graphics device.
When the aspect ratio of the graphics device is altered after the plot is generated,
the aspect ratio maybe off. In that case render the plot again.
</p>


<h3>Value</h3>

<p>Returns a <code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code> which can be added to a <code><a href="ggplot2.html#topic+ggplot">ggplot2::ggplot()</a></code>
</p>


<h3>Aesthetics</h3>

<p><code>geom_sankeysegment()</code> and <code>geom_sankeyedge()</code> understand the following
aesthetics (required aesthetics are in bold)
</p>
<p><img src="../help/figures/important_aspects.svg" alt="Important aspects" />
</p>

<ul>
<li> <p><strong><code>x</code></strong>: Works for variables on a discrete scale. Might work for continuous variables
but is not guaranteed. This variable is used to distinguish between stages in the
Sankey diagram on the x axis.
</p>
</li>
<li> <p><strong><code>y</code></strong>: A continuous variable representing the width of the edges in a Sankey
diagram.
</p>
</li>
<li> <p><strong><code>group</code></strong>: A discrete variable used for grouping edges to nodes in each stage.
Essentially it is an identifier for the nodes.
</p>
</li>
<li> <p><strong><code>connector</code></strong>: Indicates which side of an edge is reflected by the corresponding
record. Should be one of <code>"from"</code> or <code>"to"</code>.
</p>
</li>
<li> <p><strong><code>edge_id</code></strong>: A unique identifier value for each edge. This identifier is used
to link specific <code>"from"</code> and <code>"to"</code> records in an edge (flow).
</p>
</li>
<li><p> fill: see <code>vignette("ggplot2-specs", "ggplot2")</code>
</p>
</li>
<li><p> colour: see <code>vignette("ggplot2-specs", "ggplot2")</code>
</p>
</li>
<li><p> linetype: see <code>vignette("ggplot2-specs", "ggplot2")</code>
</p>
</li>
<li><p> linewidth: see <code>vignette("ggplot2-specs", "ggplot2")</code>
</p>
</li>
<li><p> alpha: A variable to control the opacity of an element.
</p>
</li></ul>


<ul>
<li><p> waist: A variable to control the width of an edge in between
two nodes. Small values will create a hour glass shape, whereas large values will
produce an apple shape.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ggplot2)
data("ecosystem_services")

ggplot(ecosystem_services_pivot1, aes(x = stage, y = RCSES, group = node,
                    connector = connector, edge_id = edge_id,
                    fill = node)) +
  geom_sankeynode(v_space = "auto") +
  geom_sankeyedge(v_space = "auto")
</code></pre>

<hr>
<h2 id='ggsankeyfier-package'>ggsankeyfier: Create Sankey and Alluvial Diagrams Using 'ggplot2'</h2><span id='topic+ggsankeyfier'></span><span id='topic+ggsankeyfier-package'></span>

<h3>Description</h3>

<p><img src="../help/figures/logo.png" style='float: right' alt='logo' width='120' />
</p>
<p>Sankey and alluvial diagrams visualise flows of quantities across stages in stacked bars. This package makes it easy to create such diagrams using 'ggplot2'.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Pepijn de Vries <a href="mailto:pepijn.devries@outlook.com">pepijn.devries@outlook.com</a> (<a href="https://orcid.org/0000-0002-7961-6646">ORCID</a>) [data contributor]
</p>
<p>Other contributors:
</p>

<ul>
<li><p> Gerjan Piet (<a href="https://orcid.org/0000-0003-0702-1624">ORCID</a>) [data contributor]
</p>
</li>
<li><p> Ruud Jongbloed (<a href="https://orcid.org/0000-0002-9378-5382">ORCID</a>) [data contributor]
</p>
</li>
<li><p> Anne Grundlehner (<a href="https://orcid.org/0000-0003-3375-3511">ORCID</a>) [data contributor]
</p>
</li>
<li><p> Jacqueline Tamis (<a href="https://orcid.org/0000-0002-8206-5830">ORCID</a>) [data contributor]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://pepijn-devries.github.io/ggsankeyfier/">https://pepijn-devries.github.io/ggsankeyfier/</a>
</p>
</li>
<li> <p><a href="https://github.com/pepijn-devries/ggsankeyfier/">https://github.com/pepijn-devries/ggsankeyfier/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/pepijn-devries/ggsankeyfier/issues">https://github.com/pepijn-devries/ggsankeyfier/issues</a>
</p>
</li></ul>


<hr>
<h2 id='pivot_stages_longer'>Pivot wide data to long for plotting as Sankey</h2><span id='topic+pivot_stages_longer'></span>

<h3>Description</h3>

<p>Pivot data from a wide to a long format suitable for plotting Sankey diagrams.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pivot_stages_longer(
  data,
  stages_from,
  values_from,
  additional_aes_from,
  invert_nodes = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pivot_stages_longer_+3A_data">data</code></td>
<td>
<p>A <code>data.frame</code> (or an object inheriting the <code>data.frame</code> class),
which needs to be pivoted.</p>
</td></tr>
<tr><td><code id="pivot_stages_longer_+3A_stages_from">stages_from</code></td>
<td>
<p>A <code>vector</code> of column names, which represent the stages.</p>
</td></tr>
<tr><td><code id="pivot_stages_longer_+3A_values_from">values_from</code></td>
<td>
<p>A <code>vector</code> of column names, which contains <code>numeric</code> values
that represent the size of the edges in Sankey diagrams. When there are multiple
values for a single edge, they are summed.</p>
</td></tr>
<tr><td><code id="pivot_stages_longer_+3A_additional_aes_from">additional_aes_from</code></td>
<td>
<p>A <code>vector</code> of column names of data that you want to
use to decorate elements in your Sankey diagram. This argument is optional. See also
<code>vignette("data_management")</code> and <code>vignette("decorating")</code>.</p>
</td></tr>
<tr><td><code id="pivot_stages_longer_+3A_invert_nodes">invert_nodes</code></td>
<td>
<p>When pivoting information from <code>stages_from</code>, its data is
converted into a <code>factor</code>. Set <code>invert_nodes</code> to <code>TRUE</code> if you want to invert the
order of the levels of the <code>factor</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Typically, data to be displayed as a Sankey, is collected and stored in a
wide format, where each stage (i.e., x-axis of a Sankey diagram) is in a
column. The <code>ggplot2</code> philosophy requires the data to be in a long format,
such that diagram decorations (aesthetics) can be mapped to specific
columns.
</p>
<p>This function pivots wide data in an appropriate long format, by indicating
which columns contain the stages, and in which order they should appear in
the Sankey.
</p>
<p>For more details see <code>vignette("data_management")</code>
</p>


<h3>Value</h3>

<p>Returns a <a href="dplyr.html#topic+reexports">dplyr::tibble</a> with all the selected columns from <code>data</code> pivoted.
The stages will be listed in the column named <code>stage</code> and nodes in the column named
<code>node</code>. The result will contain two new columns: a column named <code>connector</code> indicating
whether the row in the <code>tibble</code> reflects the source of an edge (value <code>'from'</code>) or
destination of an edge (value <code>'to'</code>); and a column named <code>edge_id</code>, containing a
unique identifier for each edge. The <code>edge_id</code> is required for the plotting routine
in order to identify which edge source should be connected with which edge destination.
</p>


<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("ecosystem_services")

ecosystem_services_p1 &lt;-
  pivot_stages_longer(
    data        = ecosystem_services,
    stages_from = c("activity_type", "pressure_cat",
                    "biotic_group", "service_division"),
    values_from = "RCSES")

## suppose we want to decorate our Sankey
## with information on the 'section' of the services:
ecosystem_services_p2 &lt;-
  pivot_stages_longer(
    data        = ecosystem_services,
    stages_from = c("activity_type", "pressure_cat",
                    "biotic_group", "service_division"),
    values_from = "RCSES",
    additional_aes_from = "service_section")

</code></pre>

<hr>
<h2 id='PositionSankey'>Position nodes and edges in a Sankey diagram</h2><span id='topic+PositionSankey'></span><span id='topic+position_sankey'></span>

<h3>Description</h3>

<p>Calculates the <code>x</code> and <code>y</code> positions of elements (nodes and edges) in a
Sankey diagram.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PositionSankey

position_sankey(
  width = "auto",
  align = c("bottom", "top", "center", "justify"),
  order = c("ascending", "descending", "as_is"),
  h_space = "auto",
  v_space = 0,
  nudge_x = 0,
  nudge_y = 0,
  split_nodes = FALSE,
  split_tol = 0.001,
  direction = c("forward", "backward"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="PositionSankey_+3A_width">width</code></td>
<td>
<p>Width of the node (<code>numeric</code>). When <code>split_nodes</code> is set to <code>TRUE</code>
each part of the split node will have half this width. Use <code>"auto"</code> to automatically
determine a suitable width.</p>
</td></tr>
<tr><td><code id="PositionSankey_+3A_align">align</code></td>
<td>
<p>A <code>character</code> that indicates how the nodes across the stages are aligned.
It can be any of <code>"top"</code>, <code>"bottom"</code>, <code>"center"</code> or <code>"justify"</code>.</p>
</td></tr>
<tr><td><code id="PositionSankey_+3A_order">order</code></td>
<td>
<p>A <code>character</code> indicating the method to be used for the order of stacking
nodes and edges in a plot.
Should be one of: <code>ascending</code> (default), sorts nodes and edges from large to small
(largest on top); <code>descending</code> sorts nodes and edges from small to large (smallest
on top); <code>as_is</code> will leave the order of nodes and edges as they are in <code>data</code>.</p>
</td></tr>
<tr><td><code id="PositionSankey_+3A_h_space">h_space</code></td>
<td>
<p>Horizontal space between split nodes (<code>numeric</code>). This argument is
ignored when <code>split_nodes == FALSE</code>. Use <code>"auto"</code> to automatically position split nodes.</p>
</td></tr>
<tr><td><code id="PositionSankey_+3A_v_space">v_space</code></td>
<td>
<p>Vertical space between nodes (<code>numeric</code>). When set to zero (<code>0</code>),
the Sankey diagram becomes an alluvial plot. Use <code>"auto"</code> to automatically determine
a suitable vertical space.</p>
</td></tr>
<tr><td><code id="PositionSankey_+3A_nudge_x">nudge_x</code>, <code id="PositionSankey_+3A_nudge_y">nudge_y</code></td>
<td>
<p>Horizontal and vertical adjustment to nudge items by. Can
be useful for offsetting labels.</p>
</td></tr>
<tr><td><code id="PositionSankey_+3A_split_nodes">split_nodes</code></td>
<td>
<p>A <code>logical</code> value indicating whether the source and destination nodes
should be depicted as separate boxes.</p>
</td></tr>
<tr><td><code id="PositionSankey_+3A_split_tol">split_tol</code></td>
<td>
<p>When the relative node size (resulting source and destination edges)
differs more than this fraction, the node will be displayed as two separate bars.</p>
</td></tr>
<tr><td><code id="PositionSankey_+3A_direction">direction</code></td>
<td>
<p>One of <code>"forward"</code> (default) or <code>"backward"</code>. When set to <code>"backward"</code>
the direction of the edges will be inverted. In most cases this
parameter won't affect the plot. It can be helpful when you want to decorate the
end of an edge (instead of the start; see examples).</p>
</td></tr>
<tr><td><code id="PositionSankey_+3A_...">...</code></td>
<td>
<p>Arguments passed on to <code><a href="ggplot2.html#topic+ggproto">ggplot2::ggproto()</a></code>.</p>
</td></tr>
</table>


<h3>Format</h3>

<p>An object of class <code>PositionSankey</code> (inherits from <code>Position</code>, <code>ggproto</code>, <code>gg</code>) of length 13.
</p>


<h3>Details</h3>

<p>Based on the <code style="white-space: pre;">&#8288;stat_*&#8288;</code> function applied to the parent's (<code><a href="#topic+stat_sankeynode">stat_sankeynode()</a></code>,
<code><a href="#topic+stat_sankeyedge">stat_sankeyedge</a></code>) object either node or edge positions are calculated respectively.
These positions can be used to add additional layers (e.g., text or labels) to the
plot.
</p>


<h3>Value</h3>

<p>Returns a <code><a href="ggplot2.html#topic+ggplot2-ggproto">ggplot2::Position</a></code> class object.
</p>


<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ggplot2)
data("ecosystem_services")

pos  &lt;- position_sankey(v_space = "auto", order = "ascending")
pos2 &lt;- position_sankey(v_space = "auto", order = "ascending", direction = "backward")

## Let's subset the data, to make the plot less cluttered:
es_subset &lt;- pivot_stages_longer(
  subset(ecosystem_services, RCSES &gt; 0.01),
  c("activity_realm", "biotic_realm", "service_section"),
  "RCSES",
  "service_section"
)


plot &lt;-
  ggplot(es_subset, aes(x = stage, y = RCSES, group = node,
                                    connector = connector, edge_id = edge_id,
                                    fill = node)) +
  geom_sankeynode(position = pos) +
  geom_sankeyedge(position = pos, aes(fill = service_section))

# position labels at nodes
plot + geom_text(aes(label = node), stat = "sankeynode", position = pos)
# position labels at the start of edges
plot + geom_text(aes(label = sprintf("%0.2f", RCSES)), stat = "sankeyedge", position = pos)
# position labels at the end of edges
plot + geom_text(aes(label = sprintf("%0.2f", RCSES)), stat = "sankeyedge", position = pos2)
</code></pre>

<hr>
<h2 id='scale_waist_continuous'>Sankey edge waist line scales</h2><span id='topic+scale_waist_continuous'></span><span id='topic+scale_waist_datetime'></span><span id='topic+scale_waist_binned'></span><span id='topic+scale_waist_discrete'></span><span id='topic+scale_waist_manual'></span><span id='topic+scale_waist_identity'></span>

<h3>Description</h3>

<p>The waist scale can be used to control the waist (i.e., the width of the edge at its centre)
of edges in Sankey diagrams, in order to put emphasis on specific edges.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>scale_waist_continuous(..., range = c(0, 1))

scale_waist_datetime(..., range = c(0, 1))

scale_waist_binned(..., range = c(0, 1))

scale_waist_discrete(..., range = c(0, 1))

scale_waist_manual(..., values = NULL, breaks = ggplot2::waiver())

scale_waist_identity(..., guide = "none")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="scale_waist_continuous_+3A_...">...</code></td>
<td>
<p>arguments passed onto underpinning scale constructors.</p>
</td></tr>
<tr><td><code id="scale_waist_continuous_+3A_range">range</code></td>
<td>
<p>A <code>vector</code> of two <code>numeric</code> values used to scale the waist in between.
Should be <code style="white-space: pre;">&#8288;&gt;= 0&#8288;</code>.</p>
</td></tr>
<tr><td><code id="scale_waist_continuous_+3A_values">values</code></td>
<td>
<p>a set of aesthetic values to map data values to. The values
will be matched in order (usually alphabetical) with the limits of the
scale, or with <code>breaks</code> if provided. If this is a named vector, then the
values will be matched based on the names instead. Data values that don't
match will be given <code>na.value</code>.</p>
</td></tr>
<tr><td><code id="scale_waist_continuous_+3A_breaks">breaks</code></td>
<td>
<p>One of:
</p>

<ul>
<li> <p><code>NULL</code> for no breaks
</p>
</li>
<li> <p><code>waiver()</code> for the default breaks (the scale limits)
</p>
</li>
<li><p> A character vector of breaks
</p>
</li>
<li><p> A function that takes the limits as input and returns breaks
as output
</p>
</li></ul>
</td></tr>
<tr><td><code id="scale_waist_continuous_+3A_guide">guide</code></td>
<td>
<p>Guide to use for this scale. Defaults to <code>"none"</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This scale can be used to scale the centre of a Sankey edge. At one end of the scale
the edge will be shaped like an hour glass, at the other end it will be shaped as an
apple.
</p>


<h3>Value</h3>

<p>Returns a <a href="ggplot2.html#topic+ggplot2-ggproto">ggplot2::Scale</a> object which can be added to a <a href="ggplot2.html#topic+ggplot">ggplot2::ggplot</a> to
control the waist of Sankey diagram edges.
</p>


<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ggplot2)
data("ecosystem_services")

p &lt;-
  ggplot(ecosystem_services_pivot2, aes(x = stage, y = RCSES, group = node,
                                        connector = connector, edge_id = edge_id,
                                        waist = RCSES)) +
  geom_sankeynode(v_space = "auto") +
  geom_sankeyedge(v_space = "auto", aes(fill = service_section))

p + scale_waist_binned(range = c(0.1, 2))
p + scale_waist_binned(range = c(2, 0.1))
</code></pre>

<hr>
<h2 id='StatSankeyedge'>Sankey stats</h2><span id='topic+StatSankeyedge'></span><span id='topic+stat_sankeyedge'></span><span id='topic+StatSankeynode'></span><span id='topic+stat_sankeynode'></span>

<h3>Description</h3>

<p>Aggregates value on the <code>y</code> axis per <code>group</code> for nodes, and for all used aesthetics for
edges.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>StatSankeyedge

stat_sankeyedge(
  mapping = NULL,
  data = NULL,
  geom = "sankeyedge",
  position = "sankey",
  na.rm = FALSE,
  slope = 0.5,
  ncp = 100,
  show.legend = NA,
  inherit.aes = TRUE,
  ...
)

StatSankeynode

stat_sankeynode(
  mapping = NULL,
  data = NULL,
  geom = "sankeynode",
  position = "sankey",
  na.rm = FALSE,
  show.legend = NA,
  inherit.aes = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="StatSankeyedge_+3A_mapping">mapping</code></td>
<td>
<p>Set of aesthetic mappings created by <code><a href="ggplot2.html#topic+aes">aes()</a></code>. If specified and
<code>inherit.aes = TRUE</code> (the default), it is combined with the default mapping
at the top level of the plot. You must supply <code>mapping</code> if there is no plot
mapping.</p>
</td></tr>
<tr><td><code id="StatSankeyedge_+3A_data">data</code></td>
<td>
<p>The data to be displayed in this layer. There are three
options:
</p>
<p>If <code>NULL</code>, the default, the data is inherited from the plot
data as specified in the call to <code><a href="ggplot2.html#topic+ggplot">ggplot()</a></code>.
</p>
<p>A <code>data.frame</code>, or other object, will override the plot
data. All objects will be fortified to produce a data frame. See
<code><a href="ggplot2.html#topic+fortify">fortify()</a></code> for which variables will be created.
</p>
<p>A <code>function</code> will be called with a single argument,
the plot data. The return value must be a <code>data.frame</code>, and
will be used as the layer data. A <code>function</code> can be created
from a <code>formula</code> (e.g. <code>~ head(.x, 10)</code>).</p>
</td></tr>
<tr><td><code id="StatSankeyedge_+3A_geom">geom</code></td>
<td>
<p>a string naming the <code>ggplot2::proto</code> Geom subclass. Should be either
<code>"sankeynode"</code> or <code>"sankeedge"</code>.</p>
</td></tr>
<tr><td><code id="StatSankeyedge_+3A_position">position</code></td>
<td>
<p>A <code>character</code> string or function specifying the positioning routine.
By default this is <code>"sankey"</code>.</p>
</td></tr>
<tr><td><code id="StatSankeyedge_+3A_na.rm">na.rm</code></td>
<td>
<p>If <code>FALSE</code>, the default, missing values are removed with
a warning. If <code>TRUE</code>, missing values are silently removed.</p>
</td></tr>
<tr><td><code id="StatSankeyedge_+3A_slope">slope</code></td>
<td>
<p>Slope parameter (<code>numeric</code>) for the Bezier curves used to depict the edges.
Any value between 0 and 1 will work nicely. Other non-zero values will also work.</p>
</td></tr>
<tr><td><code id="StatSankeyedge_+3A_ncp">ncp</code></td>
<td>
<p>Number of control points on the Bezier curve that forms the edge. Larger
numbers will result in smoother curves, but cost more computational time. Default is
100.</p>
</td></tr>
<tr><td><code id="StatSankeyedge_+3A_show.legend">show.legend</code></td>
<td>
<p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.
It can also be a named logical vector to finely select the aesthetics to
display.</p>
</td></tr>
<tr><td><code id="StatSankeyedge_+3A_inherit.aes">inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics,
rather than combining with them. This is most useful for helper functions
that define both data and aesthetics and shouldn't inherit behaviour from
the default plot specification, e.g. <code><a href="ggplot2.html#topic+borders">borders()</a></code>.</p>
</td></tr>
<tr><td><code id="StatSankeyedge_+3A_...">...</code></td>
<td>
<p>Passed to <code><a href="ggplot2.html#topic+layer">ggplot2::layer()</a></code> function</p>
</td></tr>
</table>


<h3>Format</h3>

<p>An object of class <code>StatSankeyedge</code> (inherits from <code>Stat</code>, <code>ggproto</code>, <code>gg</code>) of length 4.
</p>
<p>An object of class <code>StatSankeynode</code> (inherits from <code>Stat</code>, <code>ggproto</code>, <code>gg</code>) of length 3.
</p>


<h3>Details</h3>

<p>Wrangles data before it can be passed to <code><a href="#topic+position_sankey">position_sankey()</a></code>.
</p>


<h3>Value</h3>

<p>Returns a ggplot2 stat layer which can be used in a ggplot.
</p>


<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(ggplot2)
data("ecosystem_services")

p &lt;- ggplot(ecosystem_services_pivot1, aes(x = stage, y = RCSES, group = node,
                                           connector = connector, edge_id = edge_id,
                                           fill = node))
p + stat_sankeynode()
p + stat_sankeyedge()
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
