<!DOCTYPE html><html><head><title>Help for package ChemoSpec2D</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ChemoSpec2D}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#calcLvls'><p>Calculate Levels for Contour and Image Type Plots</p></a></li>
<li><a href='#centscaleSpectra2D'><p>Center and Scale a Spectra2D Object Along the Samples Dimension</p></a></li>
<li><a href='#check4Gaps'><p>Check for Discontinuities (Gaps) in a Vector &amp; Optionally Make a Plot</p></a></li>
<li><a href='#ChemoSpec2D-package'><p>Exploratory Chemometrics for 2D Spectroscopy</p></a></li>
<li><a href='#chkSpectra'><p>Verify the Integrity of a Spectra or Spectra2D Object</p></a></li>
<li><a href='#colorSymbol'><p>Color and Symbols in ChemoSpec and ChemoSpec2D</p></a></li>
<li><a href='#computeVolume'><p>Compute the Volume of a Specified Shift Range in a 2D Spectrum</p></a></li>
<li><a href='#files2Spectra2DObject'><p>Import Data into a Spectra2D Object</p></a></li>
<li><a href='#hats_alignSpectra2D'><p>Align the Spectra in a Spectra2D Object using the HATS algorithm.</p></a></li>
<li><a href='#import2Dspectra'><p>Import 2D Spectroscopic Data</p></a></li>
<li><a href='#inspectLvls'><p>Inspect Levels for Contour Plots of Spectra2D Objects</p></a></li>
<li><a href='#LofC'><p>Create a List of Colors</p></a></li>
<li><a href='#LofL'><p>Create a List of Contour Levels</p></a></li>
<li><a href='#miaSpectra2D'><p>Multivariate Image Analysis (Tucker 1) of a Spectra2D Object</p></a></li>
<li><a href='#MUD'><p>Made Up 2D NMR-Like Data Sets</p></a></li>
<li><a href='#normSpectra2D'><p>Normalize a Spectra2D Object</p></a></li>
<li><a href='#pfacSpectra2D'><p>PARAFAC Analysis of a Spectra2D Object</p></a></li>
<li><a href='#plotLoadings2D'><p>Plot Loadings from a PARAFAC, MIA or POP Analysis of a Spectra2D Object</p></a></li>
<li><a href='#plotScores'><p>Plot Scores from PCA, MIA or PARAFAC Analysis of a Spectra or Spectra2D Object</p></a></li>
<li><a href='#plotScree'><p>Scree Plots from PCA or MIA Analysis of a Spectra or Spectra2D Object</p></a></li>
<li><a href='#plotSlice'><p>Plot a Slice of a Spectra2D Object</p></a></li>
<li><a href='#plotSpectra2D'><p>Plot a Spectra2D Object</p></a></li>
<li><a href='#popSpectra2D'><p>Plain Old PCA (POP) of Spectra2D Objects</p></a></li>
<li><a href='#removeFreq'><p>Remove Frequencies from a Spectra or Spectra2D Object</p></a></li>
<li><a href='#removeGroup'><p>Remove Groups from a Spectra or Spectra2D Object</p></a></li>
<li><a href='#removePeaks2D'><p>Remove Peaks in a Spectra2D Object</p></a></li>
<li><a href='#removeSample'><p>Remove Samples from a Spectra or Spectra2D Object</p></a></li>
<li><a href='#sampleDist'><p>Compute the Distances Between Samples in a Spectra or Spectra2D Object</p></a></li>
<li><a href='#shiftSpectra2D'><p>Shift the Spectra in a Spectra2D Object</p></a></li>
<li><a href='#showScale'><p>Display a pdf Version of the Contour Scale</p></a></li>
<li><a href='#Spectra2D'><p>Spectra2D Objects</p></a></li>
<li><a href='#sumGroups'><p>Summarize the Group Membership of a Spectra or Spectra2D Object</p></a></li>
<li><a href='#sumSpectra'><p>Summarize a Spectra or Spectra2D Object</p></a></li>
<li><a href='#updateGroups'><p>Update Group Names in a Spectra or Spectra2D Object</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Exploratory Chemometrics for 2D Spectroscopy</td>
</tr>
<tr>
<td>Version:</td>
<td>0.5.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2021-10-09</td>
</tr>
<tr>
<td>Description:</td>
<td>A collection of functions for exploratory chemometrics of 2D spectroscopic data sets such as COSY (correlated spectroscopy) and HSQC (heteronuclear single quantum coherence) 2D NMR (nuclear magnetic resonance) spectra. 'ChemoSpec2D' deploys methods aimed primarily at classification of samples and the identification of spectral features which are important in distinguishing samples from each other. Each 2D spectrum (a matrix) is treated as the unit of observation, and thus the physical sample in the spectrometer corresponds to the  sample from a statistical perspective.  In addition to chemometric tools, a few tools are provided for plotting 2D spectra, but these are not intended to replace the functionality typically available on the spectrometer. 'ChemoSpec2D' takes many of its cues from 'ChemoSpec' and tries to create consistent graphical output and to be very user friendly.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5), ChemoSpecUtils (&ge; 1.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>tools, utils, colorspace, readJDX, ggplot2</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, tinytest, irlba, ThreeWay, multiway, parallel,
matrixStats, R.utils, mlrMBO, ParamHelpers, smoof, mlr, lhs,
RcppRoll, rmarkdown, robustbase, bookdown, CMLS</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/bryanhanson/ChemoSpec2D">https://github.com/bryanhanson/ChemoSpec2D</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/bryanhanson/ChemoSpec2D/issues">https://github.com/bryanhanson/ChemoSpec2D/issues</a></td>
</tr>
<tr>
<td>ByteCompile:</td>
<td>TRUE</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-10-09 20:58:07 UTC; bryanhanson</td>
</tr>
<tr>
<td>Author:</td>
<td>Bryan A. Hanson <a href="https://orcid.org/0000-0003-3536-8246"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Bryan A. Hanson &lt;hanson@depauw.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-10-11 07:40:38 UTC</td>
</tr>
</table>
<hr>
<h2 id='calcLvls'>Calculate Levels for Contour and Image Type Plots</h2><span id='topic+calcLvls'></span>

<h3>Description</h3>

<p>Given a matrix or vector input, this function will assist in selecting levels for preparing
contour and image type plots.  For instance, levels can be spaced evenly,
logrithmically, exponentially or using a cumulative distribution function.
<code>NA</code> values are ignored.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calcLvls(
  M,
  n = 10,
  mode = "even",
  lambda = 1.5,
  base = 2,
  showHist = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calcLvls_+3A_m">M</code></td>
<td>
<p>A numeric matrix or vector.</p>
</td></tr>
<tr><td><code id="calcLvls_+3A_n">n</code></td>
<td>
<p>An integer giving the number of levels desired:
</p>

<ul>
<li><p> For <code>mode = "even"</code> <code>n</code> evenly spaced levels are returned.
</p>
</li>
<li><p> For <code>mode = "ecdf"</code>, <code>n</code> should be one or more values in the interval [0...1].
For instance, a value of 0.6 corresponds to a single level in which 60 percent
of the matrix values are below, and 40 percent above.
</p>
</li>
<li><p> For all other values of <code>mode</code>, <code>n</code> is used internally as <code>floor(n/2)</code>
and the result eventually doubled in order to give a symmetric set of levels. In addition,
only the positive or negative levels may be selected, leaving you with
<code>floor(n/2)/2</code> levels.
</p>
</li></ul>
</td></tr>
<tr><td><code id="calcLvls_+3A_mode">mode</code></td>
<td>
<p>Character.  One of <code>"even"</code>, <code>"log"</code>, <code>"exp"</code>,
<code>"ecdf"</code>, <code>"posexp"</code>, <code>"negexp"</code>, <code>"poslog"</code>, <code>"neglog"</code>
or <code>NMR</code>. <code>"even"</code> will create evenly
spaced levels.  <code>"log"</code> will create levels which are more closely
spaced at the high values, while <code>"exp"</code> does the opposite.  The pos- or
neg- versions select just the positive or negative values.  <code>"ecdf"</code>
computes levels at the requested quantiles of the matrix. <code>NMR</code> uses
<code>exp</code>, <code>lambda = 2.0</code> and <code>n = 32</code>.  It also removes the four
values closest to zero, where the data may be primarily noise.</p>
</td></tr>
<tr><td><code id="calcLvls_+3A_lambda">lambda</code></td>
<td>
<p>Numeric.  A non-zero exponent used with <code>method = "exp"</code>
and relatives.  Higher values push the levels toward zero.</p>
</td></tr>
<tr><td><code id="calcLvls_+3A_base">base</code></td>
<td>
<p>Integer.  The base used with <code>method = "log"</code> and
relatives.</p>
</td></tr>
<tr><td><code id="calcLvls_+3A_showhist">showHist</code></td>
<td>
<p>Logical.  Shall a histogram be drawn showing the location of
the chosen levels?</p>
</td></tr>
<tr><td><code id="calcLvls_+3A_...">...</code></td>
<td>
<p>Arguments to be passed downstream.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector giving the levels.
</p>


<h3>Author(s)</h3>

<p>Bryan A. Hanson, DePauw University. <a href="mailto:hanson@depauw.edu">hanson@depauw.edu</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
set.seed(9)
MM &lt;- matrix(runif(100, -1, 1), nrow = 10) # test data
tsts &lt;- c("even", "log", "poslog", "exp", "posexp", "ecdf", "NMR")
for (i in 1:length(tsts)) {
  nl &lt;- 20
  if (tsts[i] == "ecdf") nl &lt;- seq(0.1, 0.9, 0.1)
  levels &lt;- calcLvls(
    M = MM, n = nl, mode = tsts[i],
    showHist = TRUE, main = tsts[i]
  )
}
</code></pre>

<hr>
<h2 id='centscaleSpectra2D'>Center and Scale a Spectra2D Object Along the Samples Dimension</h2><span id='topic+centscaleSpectra2D'></span>

<h3>Description</h3>

<p>This function will optionally center, and optionally scale, a <code>Spectra2D</code> object along the
samples dimension (i.e. this is pixel-wise scaling in the language of multivariate
image analysis). Several scaling options are available.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>centscaleSpectra2D(spectra, center = FALSE, scale = "noscale")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="centscaleSpectra2D_+3A_spectra">spectra</code></td>
<td>
<p>An object of S3 class <code><a href="#topic+Spectra2D">Spectra2D</a></code>.</p>
</td></tr>
<tr><td><code id="centscaleSpectra2D_+3A_center">center</code></td>
<td>
<p>Logical.  Should the spectra be centered before possibly scaling?  Will give an error
if <code>center = TRUE</code> and a log function is requested for scaling.</p>
</td></tr>
<tr><td><code id="centscaleSpectra2D_+3A_scale">scale</code></td>
<td>
<p>A character string indicating the type of scaling to apply.  One of
<code>c("autoscale", "Pareto", "log", "log10")</code>. For the log functions, centering is not carried
out since logarithm is not defined for negative values.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of S3 class <code><a href="#topic+Spectra2D">Spectra2D</a></code>.
</p>


<h3>Author(s)</h3>

<p>Bryan A. Hanson, DePauw University.
</p>


<h3>References</h3>

<p>R. Bro and A. K. Smilde &quot;Centering and Scaling in Component Analysis&quot; J. Chemometrics
vol. 17 pgs 16-33 (2003).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+normSpectra2D">normSpectra2D</a></code> for another means of scaling.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(MUD1)
tst &lt;- centscaleSpectra2D(MUD1)
</code></pre>

<hr>
<h2 id='check4Gaps'>Check for Discontinuities (Gaps) in a Vector &amp; Optionally Make a Plot</h2><span id='topic+check4Gaps'></span>

<h3>Description</h3>

<p>This function is used by <code>ChemoSpec</code> and <code>ChemoSpec2D</code>, but is
formally part of <code>ChemoSpecUtils</code>.  You can access
full documentation via <code><a href="ChemoSpecUtils.html#topic+check4Gaps">check4Gaps</a></code>.
</p>

<hr>
<h2 id='ChemoSpec2D-package'>Exploratory Chemometrics for 2D Spectroscopy</h2><span id='topic+ChemoSpec2D-package'></span><span id='topic+ChemoSpec2D'></span>

<h3>Description</h3>

<p>Description: A collection of functions for exploratory chemometrics of 2D
spectroscopic data sets such as COSY and HSQC NMR spectra. ChemoSpec2D deploys
methods aimed primarily at classification of samples and the identification of
spectral features which are important in distinguishing samples from each other.
Each 2D spectrum (a matrix) is treated as the unit of observation, and thus the
physical sample in the spectrometer corresponds to the  sample from a statistical
perspective.  In addition to chemometric tools, a few tools are provided for
plotting 2D spectra, but these are not intended to replace the functionality
typically available on the spectrometer. ChemoSpec2D takes many of its cues from
ChemoSpec and tries to create consistent graphical output and to be very user friendly.
A vignette is available.
</p>


<h3>Author(s)</h3>

<p>Bryan A. Hanson.
</p>
<p>Maintainer: Bryan A. Hanson <a href="mailto:hanson@depauw.edu">hanson@depauw.edu</a>
</p>

<hr>
<h2 id='chkSpectra'>Verify the Integrity of a Spectra or Spectra2D Object</h2><span id='topic+chkSpectra'></span>

<h3>Description</h3>

<p>This function is used by <code>ChemoSpec</code> and <code>ChemoSpec2D</code>, but is
formally part of <code>ChemoSpecUtils</code>.  You can access
full documentation via <code><a href="ChemoSpecUtils.html#topic+chkSpectra">chkSpectra</a></code>.
</p>

<hr>
<h2 id='colorSymbol'>Color and Symbols in ChemoSpec and ChemoSpec2D</h2><span id='topic+colorSymbol'></span>

<h3>Description</h3>

<p>You can access
full documentation via <code><a href="ChemoSpecUtils.html#topic+colorSymbol">colorSymbol</a></code>.
</p>

<hr>
<h2 id='computeVolume'>Compute the Volume of a Specified Shift Range in a 2D Spectrum</h2><span id='topic+computeVolume'></span>

<h3>Description</h3>

<p>This function takes a range of frequencies for each dimension, and calculates
the volume of the enclosed region.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>computeVolume(spectra, F2range = NULL, F1range = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="computeVolume_+3A_spectra">spectra</code></td>
<td>
<p>An object of S3 class <code><a href="#topic+Spectra2D">Spectra2D</a></code>.</p>
</td></tr>
<tr><td><code id="computeVolume_+3A_f2range">F2range</code></td>
<td>
<p>A formula giving a frequency range. May include
&quot;low&quot; or &quot;high&quot; representing the extremes of the spectra.  Values below or above the range of
F2 are tolerated without notice and are handled as <code>min</code> or <code>max</code>, respectively.</p>
</td></tr>
<tr><td><code id="computeVolume_+3A_f1range">F1range</code></td>
<td>
<p>As for <code>F2range</code>, but for the F1 dimension.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector of volumes, one for each spectrum.
</p>


<h3>Author(s)</h3>

<p>Bryan A. Hanson, DePauw University.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(MUD1)
tst &lt;- computeVolume(MUD1, F2range = 3 ~ 4, F1range = 55 ~ 70)
</code></pre>

<hr>
<h2 id='files2Spectra2DObject'>Import Data into a Spectra2D Object</h2><span id='topic+files2Spectra2DObject'></span>

<h3>Description</h3>

<p>This function imports data into a <code><a href="#topic+Spectra2D">Spectra2D</a></code> object.  It primarily uses
<code><a href="utils.html#topic+read.table">read.table</a></code> to read files so it is
very flexible in regard to file formatting.  <span class="pkg">Be sure to see the ...
argument below for important details you need to provide.</span>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>files2Spectra2DObject(
  gr.crit = NULL,
  gr.cols = "auto",
  fmt = NULL,
  nF2 = NULL,
  x.unit = "no frequency unit provided",
  y.unit = "no frequency unit provided",
  z.unit = "no intensity unit provided",
  descrip = "no description provided",
  fileExt = "\\.(csv|CSV)$",
  out.file = "mydata",
  debug = 0,
  chk = TRUE,
  allowSloppy = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="files2Spectra2DObject_+3A_gr.crit">gr.crit</code></td>
<td>
<p>Group Criteria.  A vector of character strings which will be
searched for among the file/sample names in order to assign an individual
spectrum to group membership. This is done using grep, so characters
like &quot;.&quot; (period/dot) do not have their literal meaning (see below).
Warnings are issued if there are file/sample
names that don't match entries in <code>gr.crit</code> or there are entries in
<code>gr.crit</code> that don't match any file names.</p>
</td></tr>
<tr><td><code id="files2Spectra2DObject_+3A_gr.cols">gr.cols</code></td>
<td>
<p>Group Colors.  See <code><a href="#topic+colorSymbol">colorSymbol</a></code> for some options. One of the following:
</p>

<ul>
<li><p> Legacy behavior and the default: The word <code>"auto"</code>, in which case up to 8 colors will
be automatically assigned from package <code>RColorBrewer Set1</code>.
</p>
</li>
<li> <p><code>"Col7"</code>. A unique set of up to 7 colorblind-friendly colors is used.
</p>
</li>
<li> <p><code>"Col8"</code>. A unique set of up to 8 colors is used.
</p>
</li>
<li> <p><code>"Col12"</code>. A mostly paired set of up to 12 colors is used.
</p>
</li>
<li><p> A vector of acceptable color designations with the same length as <code>gr.crit</code>.
</p>
</li></ul>

<p>Colors will be assigned one for one, so the first element of
<code>gr.crit</code> is assigned the first element of <code>gr.col</code> and so forth.  For <code>Col12</code>
you should pay careful attention to the order of <code>gr.crit</code> in order to match up colors.
See <code><a href="ChemoSpecUtils.html#topic+colorSymbol">colorSymbol</a></code> for further details.</p>
</td></tr>
<tr><td><code id="files2Spectra2DObject_+3A_fmt">fmt</code></td>
<td>
<p>A character string giving the format of the data. Consult
<code><a href="#topic+import2Dspectra">import2Dspectra</a></code> for options.
If <code>fileExt</code> is one of <code>dx, DX, jdx or JDX</code>, <code>fmt</code> will automatically
be set to <code>"dx"</code> and package <code>readJDX</code> will be used for the import.  In this case
check the values of F2 and F1 carefully.  The values are taken from the file,
for some files/vendors the values might be in Hz rather than ppm.</p>
</td></tr>
<tr><td><code id="files2Spectra2DObject_+3A_nf2">nF2</code></td>
<td>
<p>Integer giving the number of data points in the F2 (x) dimension.
Note: If <em>any</em> dimension is zero-filled you may need to study
the acquistion details to get the correct value for this argument.
This may be vendor-dependent.</p>
</td></tr>
<tr><td><code id="files2Spectra2DObject_+3A_x.unit">x.unit</code></td>
<td>
<p>A character string giving the units for the F2 dimension
(frequency or wavelength corresponding to the x dimension).</p>
</td></tr>
<tr><td><code id="files2Spectra2DObject_+3A_y.unit">y.unit</code></td>
<td>
<p>A character string giving the units for the F1 dimension
(frequency or wavelength corresponding to the y dimension).</p>
</td></tr>
<tr><td><code id="files2Spectra2DObject_+3A_z.unit">z.unit</code></td>
<td>
<p>A character string giving the units of the z-axis (some sort
of intensity).</p>
</td></tr>
<tr><td><code id="files2Spectra2DObject_+3A_descrip">descrip</code></td>
<td>
<p>A character string describing the data set.</p>
</td></tr>
<tr><td><code id="files2Spectra2DObject_+3A_fileext">fileExt</code></td>
<td>
<p>A character string giving the extension of the files to be
processed. <code>regex</code> strings can be used.  For instance, the default
finds files with either <code>".csv"</code> or <code>".CSV"</code> as the extension.
Matching is done via a grep process, which is greedy.
If <code>fileExt</code> is one of <code>dx, DX, jdx or JDX</code>, <code>fmt</code> will automatically be
set to <code>"dx"</code> and package <code>readJDX</code> will be used for the import.</p>
</td></tr>
<tr><td><code id="files2Spectra2DObject_+3A_out.file">out.file</code></td>
<td>
<p>A file name.  The completed object of S3 class <code><a href="#topic+Spectra2D">Spectra2D</a></code> will be written
to this file.</p>
</td></tr>
<tr><td><code id="files2Spectra2DObject_+3A_debug">debug</code></td>
<td>
<p>Integer.  Set to 1 or <code>TRUE</code> for basic reporting when there are problems.
If importing JCAMP-DX files, values greater than 1 give additional and potentially
huge output.  Once you know which file is the problem, you may wish to troubleshoot
directly using package <code>readJDX</code>.</p>
</td></tr>
<tr><td><code id="files2Spectra2DObject_+3A_chk">chk</code></td>
<td>
<p>Logical. Should the <code>Spectra</code> object be checked for integrity?  If you are having
trouble importing your data, set this to <code>FALSE</code> and do <code>str(your object)</code> to investigate.</p>
</td></tr>
<tr><td><code id="files2Spectra2DObject_+3A_allowsloppy">allowSloppy</code></td>
<td>
<p>Logical. <span class="pkg">Experimental Feature</span> If <code>TRUE</code>, disable checking of the data set, and
return all pieces of the raw import from <code>import2Dspectra</code> in the <code>spectra$data</code> object.
The resulting object currently cannot be used by any other functions in this package!  The
intent is allow importing of spectra that differ slightly in the number of points in each dimension.
With this option one can use <code>str</code> on the resulting object to inspect the differences.
Future functions will allow one to clean up the data.</p>
</td></tr>
<tr><td><code id="files2Spectra2DObject_+3A_...">...</code></td>
<td>
<p>Arguments to be passed to <code><a href="utils.html#topic+read.table">read.table</a></code>,
<code><a href="base.html#topic+list.files">list.files</a></code> or <code>readJDX</code>; see the &quot;Advanced Tricks&quot; section.
For <code>read.table</code>, <span class="pkg">You MUST supply values for <code>sep</code>, <code>dec</code> and <code>header</code> consistent
with your file structure, unless they are the same as the defaults for <code><a href="utils.html#topic+read.table">read.table</a></code></span>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>files2Spectra2DObject</code> acts on all files in the current working
directory with the specified <code>fileExt</code> so there should be no
extraneous files with that extension in the directory.
</p>


<h3>Value</h3>

<p>One of these objects:
</p>

<ul>
<li><p> If <code>allowSloppy = FALSE</code>, the default, an object of class <code><a href="#topic+Spectra2D">Spectra2D</a></code>.
</p>
</li>
<li><p> If <code>allowSloppy = TRUE</code>, an object of undocumented class <code>SloppySpectra2D</code>.
These objects are <span class="pkg">experimental</span> and are not checked by <code>chkSpectra</code>.
For these objects <code>spectra$F1</code> and <code>spectra$F2</code> are <code>NA</code>, and each
<code>spectra$data</code> entry is a list with elements F1, F2 and M, which is the matrix
of imported data (basically, the object returned by <code>import2Dspectra</code>).
</p>
</li>
<li><p> In each case,
an <em>unnamed</em> object of S3 class <code><a href="#topic+Spectra2D">Spectra2D</a></code> or <code>SloppySpectra2D</code>
is also written to <code>out.file</code>.
To read it back into the workspace, use <code>new.name &lt;- loadObject(out.file)</code>
(<code>loadObject</code> is package <span class="pkg">R.utils</span>).
</p>
</li></ul>



<h3>gr.crit and Sample Name Gotchas</h3>

<p>The matching of <code>gr.crit</code> against the sample file names is done one at
a time, in order, using grep.  While powerful, this has the potential to lead
to some &quot;gotchas&quot; in certain cases, noted below.
</p>
<p>Your file system may allow file/sample names which <code>R</code> will not like, and will
cause confusing behavior.  File/sample names become variables in <code>ChemoSpec</code>, and <code>R</code>
does not like things like &quot;-&quot; (minus sign or hyphen) in file/sample names.  A hyphen
is converted to a period (&quot;.&quot;) if found, which is fine for a variable name.
However, a period in <code>gr.crit</code> is interpreted from the grep point of view,
namely a period matches any single character.  At this point, things may behave
very differently than one might hope.  See <code><a href="base.html#topic+make.names">make.names</a></code> for allowed
characters in <code>R</code> variables and make sure your file/sample names comply.
</p>
<p>The entries in <code>gr.crit</code> must be
mutually exclusive.  For example, if you have files with names like
&quot;Control_1&quot; and &quot;Sample_1&quot; and use <code>gr.crit = c("Control", "Sample")</code>
groups will be assigned as you would expect.  But, if you have file names
like &quot;Control_1_Shade&quot; and &quot;Sample_1_Sun&quot; you can't use <code>gr.crit =
c("Control", "Sample", "Sun", "Shade")</code> because each criteria is grepped in
order, and the &quot;Sun/Shade&quot; phrases, being last, will form the basis for your
groups.  Because this is a grep process, you can get around this by using
regular expressions in your <code>gr.crit</code> argument to specify the desired
groups in a mutually exclusive manner.  In this second example, you could
use <code>gr.crit = c("Control(.*)Sun"</code>, <code>"Control(.*)Shade"</code>, <code>"Sample(.*)Sun"</code>,
<code>"Sample(.*)Shade")</code> to have your groups assigned based upon both phrases in
the file names.
</p>
<p>To summarize, <code>gr.crit</code> is used as a grep pattern, and the file/sample names
are the target.  Make sure your file/sample names comply with <code><a href="base.html#topic+make.names">make.names</a></code>.
</p>
<p>Finally, samples whose names are not matched using <code>gr.crit</code> are still
incorporated into the <code><a href="#topic+Spectra2D">Spectra2D</a></code> object, but they are not
assigned a group. Therefore they don't plot, but they do take up space in a
plot!  A warning is issued in these cases, since one wouldn't normally want
a spectrum to be orphaned this way.
</p>
<p>All these problems can generally be identified by running <code><a href="ChemoSpecUtils.html#topic+sumSpectra">sumSpectra</a></code>
once the data is imported.
</p>


<h3>Advanced Tricks</h3>

<p>The ... argument can be used to pass any argument to <code>read.table</code> or <code>list.files</code>.
This includes the possibility of passing arguments that will cause trouble later, for instance
<code>na.strings</code> in <code>read.table</code>.  While one might successfully read in data with <code>NA</code>,
it will eventually cause problems.  The intent of this feature is to allow one to recurse
a directory tree containing the data, and/or to specify a starting point other than the current
working directory.  So for instance if the current working directory is not the directory containing
the data files, you can use <code>path = "my_path"</code> to point to the desired top-level
directory, and <code>recursive = TRUE</code> to work your way through a set of subdirectories.  In addition,
if you are reading in JCAMP-DX files, you can pass arguments to <code>readJDX</code> via ..., e.g. <code>SOFC = FALSE</code>.
Finally, while argument <code>fileExt</code> appears to be a file extension (from its
name and the description elsewhere), it's actually just a grep pattern that you can apply
to any part of the file name if you know how to construct the proper pattern.
</p>


<h3>Author(s)</h3>

<p>Bryan A. Hanson, DePauw University.
</p>

<hr>
<h2 id='hats_alignSpectra2D'>Align the Spectra in a Spectra2D Object using the HATS algorithm.</h2><span id='topic+hats_alignSpectra2D'></span>

<h3>Description</h3>

<p>Align the spectra in a <code><a href="#topic+Spectra2D">Spectra2D</a></code> object using an implementation
of the HATS algorithm described by Robinette <em>et al.</em>.  Currently, only
global, not local, alignment is carried out.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hats_alignSpectra2D(
  spectra,
  maxF2 = NULL,
  maxF1 = NULL,
  dist_method = "cosine",
  minimize = FALSE,
  thres = 0.99,
  no.it = 20L,
  restarts = 2L,
  method = "MBO",
  fill = "noise",
  plot = FALSE,
  debug = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hats_alignSpectra2D_+3A_spectra">spectra</code></td>
<td>
<p>An object of S3 class <code><a href="#topic+Spectra2D">Spectra2D</a></code>.</p>
</td></tr>
<tr><td><code id="hats_alignSpectra2D_+3A_maxf2">maxF2</code></td>
<td>
<p>Integer.  The most extreme positive <code>F2step</code> to allow during the
alignment process (units are data points).  Search for the optimal alignment will
cover the region <code>-maxF2</code> ... <code>maxF2</code> and <code>-maxF1</code>
... <code>maxF1</code>.  Defaults to about 10% of the number of points.</p>
</td></tr>
<tr><td><code id="hats_alignSpectra2D_+3A_maxf1">maxF1</code></td>
<td>
<p>Integer.  As for <code>maxF2</code>, but for F1.</p>
</td></tr>
<tr><td><code id="hats_alignSpectra2D_+3A_dist_method">dist_method</code></td>
<td>
<p>Character. The distance method to use in the objective function.
See <code><a href="ChemoSpecUtils.html#topic+rowDist">rowDist</a></code> for options.</p>
</td></tr>
<tr><td><code id="hats_alignSpectra2D_+3A_minimize">minimize</code></td>
<td>
<p>Logical. Is the goal to minimize the objective function?  If so, use <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="hats_alignSpectra2D_+3A_thres">thres</code></td>
<td>
<p>Numeric. Prior to launching the optimization, the objective function is evaluated
for no shift in case this is actually the best alignment (saving a great deal of time).
If this initial check exceeds the value of <code>thres</code> (when <code>minimize = FALSE</code>),
or is below <code>thres</code> when <code>minimize = TRUE</code>, no optimization is performed
and the unshifted spectra are returned.</p>
</td></tr>
<tr><td><code id="hats_alignSpectra2D_+3A_no.it">no.it</code></td>
<td>
<p>Integer. The maximum number of iterations in the optimization.</p>
</td></tr>
<tr><td><code id="hats_alignSpectra2D_+3A_restarts">restarts</code></td>
<td>
<p>Integer. The maximum number of independent rounds of optimization.</p>
</td></tr>
<tr><td><code id="hats_alignSpectra2D_+3A_method">method</code></td>
<td>
<p>Character. Currently only <code>method = "MBO"</code> is available which uses
the HATS algorithm plus model based optimization (aka Bayesian optimization) method to
align the spectra. Use <code>plot = TRUE</code> to see this in action.</p>
</td></tr>
<tr><td><code id="hats_alignSpectra2D_+3A_fill">fill</code></td>
<td>
<p>Aligning spectra requires that at least some spectra be shifted left/right
and up/down.  When a spectrum is shifted, spaces are opened that must be filled with something:
</p>

<ul>
<li><p> If <code>fill = "zeros"</code> the spaces are filled with zeros.
</p>
</li>
<li><p> If <code>fill = "noise"</code> the spaces are filled with an estimate of the noise from the
original spectrum.
</p>
</li></ul>
</td></tr>
<tr><td><code id="hats_alignSpectra2D_+3A_plot">plot</code></td>
<td>
<p>Logical. Shall a plot of the alignment progress be made?  The plot is useful for
diagnostic purposes.  Every step of the alignment has a corresponding plot so you should
probably direct the output to a pdf file.</p>
</td></tr>
<tr><td><code id="hats_alignSpectra2D_+3A_debug">debug</code></td>
<td>
<p>Integer.
</p>

<ul>
<li><p> Values &gt;= 1 give messages about alignment progress in black text.
</p>
</li>
<li><p> Values &gt;= 2 print the merge matrix from the <code>hclust</code> object, if <code>plot</code>
is also <code>TRUE</code>.  This is the guide tree.
</p>
</li>
<li><p> For <code>method = "MBO"</code> values less than 2 suppress some messages and warnings from
the underlying functions.  If the alignment doesn't work well, set <code>debug = 2</code>.
</p>
</li>
<li><p> Setting <code>plot = TRUE</code> also gives a view of alignment diagnostics.
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of S3 class <code><a href="#topic+Spectra2D">Spectra2D</a></code>.
</p>


<h3>Advice</h3>


<ul>
<li><p> I suggest that you plot your possibly mis-aligned spectra first, zooming in on a small region where
alignment might be an issue, and get an idea of the size of the alignment problem.  This will help
you choose good values for <code>maxF1</code> and <code>maxF2</code> which will speed up the search.
</p>
</li>
<li><p> The algorithm uses random numbers to initialize the search, so set the seed for reproducible results.
Different seeds may give different results; you may find it useful to experiment a bit and see how
the alignment turns out.
</p>
</li>
<li><p> Be sure that your choice of <code>thres</code>, <code>minimize</code> and <code>dist_method</code> are self-consistent.
Some <code>dist_method</code> choices are bounded, others unbounded, and some should be minimized, others maximized.
</p>
</li>
<li><p> You should use <code><a href="#topic+sampleDist">sampleDist</a></code> to visualize the distances ahead of time.  The method
chosen should return a wide numerical range between samples or it won't give a good alignment result.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Bryan A. Hanson, DePauw University.
</p>


<h3>References</h3>

<p>Roughly follows the algorithm described in Robinette et al. 2011
<em>Anal. Chem.</em> vol. 83, 1649-1657 (2011) dx.doi.org/10.1021/ac102724x
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
set.seed(123)
library("ggally") # for diagnostic plots
data(MUD2)
sumSpectra(MUD2)
mylvls &lt;- seq(3, 30, 3)

# Plot before alignment
plotSpectra2D(MUD2,
  which = c(2, 3, 5, 6), showGrid = TRUE,
  lvls = LofL(mylvls, 4),
  cols = LofC(c("black", "red", "blue", "green"), 4, 10, 2)
)

# Carry out alignment
# You might want to direct the diagnostic output here to a pdf file
# This alignment takes about 90 seconds including the plotting overhead
MUD2a &lt;- hats_alignSpectra2D(MUD2, method = "MBO", debug = 1, plot = TRUE)

# Plot after alignment
plotSpectra2D(MUD2a,
  which = c(2, 3, 5, 6), showGrid = TRUE,
  lvls = LofL(mylvls, 4),
  cols = LofC(c("black", "red", "blue", "green"), 4, 10, 2)
)

## End(Not run)

</code></pre>

<hr>
<h2 id='import2Dspectra'>Import 2D Spectroscopic Data</h2><span id='topic+import2Dspectra'></span>

<h3>Description</h3>

<p>This function imports a single file (for instance, a csv) containing a 2D
spectroscopic data set.  The current version handles various types of
ASCII text files as well as a few other types.
This function is called by <code><a href="#topic+files2Spectra2DObject">files2Spectra2DObject</a></code>
and is exported and documented to assist in developing new format codes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>import2Dspectra(file, fmt, nF2, debug = 0, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="import2Dspectra_+3A_file">file</code></td>
<td>
<p>Character string giving the path to a file containing a 2D spectrum.</p>
</td></tr>
<tr><td><code id="import2Dspectra_+3A_fmt">fmt</code></td>
<td>
<p>Character string giving the format code to use.  Details below.</p>
</td></tr>
<tr><td><code id="import2Dspectra_+3A_nf2">nF2</code></td>
<td>
<p>Integer giving the number of data points in the F2 (x) dimension.
Note: If <em>any</em> dimension is zero-filled you may need to study
the acquistion details to get the correct value for this argument.
This may be vendor-dependent.</p>
</td></tr>
<tr><td><code id="import2Dspectra_+3A_debug">debug</code></td>
<td>
<p>Integer.  Applies to <code>fmt = "dx"</code> only.  See <code><a href="readJDX.html#topic+readJDX">readJDX</a></code>
for details.</p>
</td></tr>
<tr><td><code id="import2Dspectra_+3A_...">...</code></td>
<td>
<p>Arguments to be passed to <code><a href="utils.html#topic+read.table">read.table</a></code>, or <code>readJDX</code>.
For <code>read.table</code>, <span class="pkg">You MUST supply values for <code>sep</code>, <code>dec</code> and <code>header</code> consistent
with your file structure, unless they are the same as the defaults for <code><a href="utils.html#topic+read.table">read.table</a></code></span>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with 3 elements:
</p>

<ul>
<li><p> A matrix of the z values.  The no. of columns = <code>nF2</code> and the no. of rows
follows from the size of the imported data.
</p>
</li>
<li><p> A vector giving the F2 (x) values.
</p>
</li>
<li><p> A vector giving the F1 (y) values.
</p>
</li></ul>



<h3>Format Codes for Plain-Text ASCII Files</h3>

<p>ASCII format codes are constructed in two parts separated by a hyphen.
Three or more columns are expected. The first part gives
the order of the columns in the file, e.g. F2F1R means the first column has the F2 values,
the second column has the F1 values and the third the real-valued intensities.  The second part of the
format code relates to the order of the rows, i.e. which column varies fastest and in what direction.
These codes are best understood in relation to how the data is stored internally in a matrix.
The internal matrix is organized exactly as the data appears on the screen, with F2 decreasing
left-to-right, and F1 increasing top-to-bottom. There are many possible formats (only those listed
are implemented, please e-mail for help creating additional combinations):
</p>

<ul>
<li> <p><code>"F2F1R-F2decF1dec"</code> Columns in the file are F2 (x), F1 (y), real.  Both F2 and F1 are decreasing.
Last row is first in the file.  This format is used at least some of the time by
nmrPipe.
</p>
</li>
<li> <p><code>fmt = "F1F2RI-F1decF2dec2"</code> Columns in the file are F1 (y), F2 (x), real and imaginary
(imaginary data will be skipped).  F1 is held at a fixed value while F2 decreases.  F1 starts high
and decreases, so last row is first in the file. There are two sets of data in the file:
The data after FT'ing along F2 only, and the data after FT'ing along both dimensions.  The &quot;2&quot;
in the format name means we are taking the second data set.
This format is used by JEOL when exporting to &quot;generic ascii&quot;.  Argument <code>nF2</code> is ignored
with this format as the value is sought from the corresponding <code>*.hdr</code> file.  Doing so
also allows one to import files with slightly different F1 and or F2, but for this to be successful
you will need to 1) set <code>allowSloppy = TRUE</code> in the call to <code>files2Spectra2DObject</code> and
2) harmonize the dimensions manually after initial import.
</p>
</li></ul>



<h3>Other Format Codes</h3>

<p>Here are some other format codes you can use:
</p>

<ul>
<li> <p><code>"SimpleM"</code>.  Imports matrices composed of z values.  The F2 and F1 values
are created from the dimension of the matrix.  After import, you will have to manually
convert the F2 and F1 values to ppm.  You may also have to transpose the matrices, or
perhaps invert the order of the rows or columns.  Imported via <code>read.table</code>.
</p>
</li>
<li> <p><code>"Btotxt"</code>.  This format imports Bruker data written to a file using the Bruker
&quot;totxt&quot; command.  Tested with TopSpin 4.0.7.  This format is read via <code>readLines</code>
and thus the ... argument does not apply.
</p>
</li>
<li> <p><code>"dx"</code>.  This format imports files written in the JCAMP-DX format, via
package <code><a href="readJDX.html#topic+readJDX">readJDX</a></code>.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Bryan A. Hanson, DePauw University.
</p>

<hr>
<h2 id='inspectLvls'>Inspect Levels for Contour Plots of Spectra2D Objects</h2><span id='topic+inspectLvls'></span>

<h3>Description</h3>

<p>Given a <code>Spectra2D</code> object, this function will assist in selecting levels
for preparing contour and image type plots.
Any of the arguments to <code><a href="#topic+calcLvls">calcLvls</a></code> can be used
to compute the levels, or you can choose your own by inspection.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>inspectLvls(spectra, which = 1, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="inspectLvls_+3A_spectra">spectra</code></td>
<td>
<p>An object of S3 class <code><a href="#topic+Spectra2D">Spectra2D</a></code>.</p>
</td></tr>
<tr><td><code id="inspectLvls_+3A_which">which</code></td>
<td>
<p>Integer.  The spectrum/spectra to be analyzed.  If a vector,
the intensities are combined.</p>
</td></tr>
<tr><td><code id="inspectLvls_+3A_...">...</code></td>
<td>
<p>Arguments to be passed downstream to <code><a href="#topic+calcLvls">calcLvls</a></code> and/or
the plot function (e.g. <code>ylim</code>).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector giving the levels (invisibly).
</p>


<h3>Author(s)</h3>

<p>Bryan A. Hanson, DePauw University. <a href="mailto:hanson@depauw.edu">hanson@depauw.edu</a>
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+pfacSpectra2D">pfacSpectra2D</a></code> for further examples.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(MUD1)
inspectLvls(MUD1, ylim = c(0, 300), main = "MUD1 Spectrum 1, mode = even")
inspectLvls(MUD1, ylim = c(0, 300), mode = "NMR", main = "MUD1 Spectrum 1, mode = NMR")
</code></pre>

<hr>
<h2 id='LofC'>Create a List of Colors</h2><span id='topic+LofC'></span>

<h3>Description</h3>

<p>When overlaying multiple 2D NMR spectra, one needs to supply a vector of colors for each spectrum contour,
as a list with length equal to the number of spectra to be plotted.
This is a convenience function which takes a vector of colors and copies it into a list, ready for
use  with <code><a href="#topic+plotSpectra2D">plotSpectra2D</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>LofC(cols, nspec = 1L, ncon = 1L, mode = 1L)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="LofC_+3A_cols">cols</code></td>
<td>
<p>Character. A vector of color designations.</p>
</td></tr>
<tr><td><code id="LofC_+3A_nspec">nspec</code></td>
<td>
<p>Integer. The number of spectra to be plotted.</p>
</td></tr>
<tr><td><code id="LofC_+3A_ncon">ncon</code></td>
<td>
<p>Integer. The number of contour levels.</p>
</td></tr>
<tr><td><code id="LofC_+3A_mode">mode</code></td>
<td>
<p>Integer. <em>How</em> to replicate the colors:
</p>

<ul>
<li><p> If <code>mode = 1L</code>, each list element in the return value is a copy of <code>cols</code>.
Use this mode when you want to use varied colors for the contour levels. <code>length(cols)</code>
must be the same as the number of contour levels passed to <code><a href="#topic+plotSpectra2D">plotSpectra2D</a></code>,
possibly via <code><a href="#topic+LofL">LofL</a></code>.
</p>
</li>
<li><p> If <code>mode = 2L</code>, each list element in the return value is composed of a single color.
Use this mode when you want each spectrum to be plotted in its own color. The first list element
is <code>ncon</code> replicates of <code>cols[1]</code>, the second list element is
<code>n</code> replicates of <code>cols[2]</code> etc. <code>length(cols)</code> must equal <code>nspec</code> in this mode.
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of length <code>nspec</code>, the number of spectra to be plotted; each entry is a vector of colors.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>mycols &lt;- c("red", "green", "blue")
LofC(mycols, 1, 3, 1)
LofC(mycols, 3, 3, 2)
</code></pre>

<hr>
<h2 id='LofL'>Create a List of Contour Levels</h2><span id='topic+LofL'></span>

<h3>Description</h3>

<p>When overlaying multiple 2D NMR spectra, one needs to supply a vector of contour levels for each spectrum, as a list.
This is a convenience function which takes a set of levels and copies it into a list, ready for
use  with <code><a href="#topic+plotSpectra2D">plotSpectra2D</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>LofL(lvls, n)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="LofL_+3A_lvls">lvls</code></td>
<td>
<p>Numeric.  A vector of the desired levels.</p>
</td></tr>
<tr><td><code id="LofL_+3A_n">n</code></td>
<td>
<p>Integer.  The number of spectra to be plotted, which is also the number of times to replicate the levels.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of length <code>n</code>; each entry is a copy of <code>lvls</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plotSpectra2D">plotSpectra2D</a></code> for an example.
</p>

<hr>
<h2 id='miaSpectra2D'>Multivariate Image Analysis (Tucker 1) of a Spectra2D Object</h2><span id='topic+miaSpectra2D'></span>

<h3>Description</h3>

<p>Carry out multivariate image analysis of a <code><a href="#topic+Spectra2D">Spectra2D</a></code> object
(multivariate image analysis is the same as a Tucker1 analysis).
Function <code><a href="ThreeWay.html#topic+pcasup1">pcasup1</a></code> from package <span class="pkg">ThreeWay</span> is used.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>miaSpectra2D(spectra)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="miaSpectra2D_+3A_spectra">spectra</code></td>
<td>
<p>An object of S3 class <code><a href="#topic+Spectra2D">Spectra2D</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list per <code><a href="ThreeWay.html#topic+pcasup1">pcasup1</a></code>.  Of particular interest are the
elements <code>C</code> containing the eigenvectors and <code>1c</code> containing the eigenvalues.
We add the class <code>mia</code> to the list for our use later, as well as a <code>method</code>
element for annotating plots.
</p>


<h3>Author(s)</h3>

<p>Bryan A. Hanson, DePauw University.
</p>


<h3>References</h3>

<p>A. Smilde, R. Bro and P. Geladi
&quot;Multi-way Analysis: Applications in the Chemical Sciences&quot; Wiley (2004).
See especially Example 4.5.
</p>
<p>P. Geladi and H. Grahn &quot;Multivariate Image Analysis&quot; Wiley (1996).  Note that
in this text the meanings of scores and loadings are reversed from the usual
spectroscopic uses of the terms.
</p>


<h3>See Also</h3>

<p>For other data reduction methods for <code>Spectra2D</code> objects, see
<code><a href="#topic+pfacSpectra2D">pfacSpectra2D</a></code> and <code><a href="#topic+popSpectra2D">popSpectra2D</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("ggplot2")
data(MUD1)
res &lt;- miaSpectra2D(MUD1)

# plotScores &amp; plotScree use ggplot2 graphics

p1 &lt;- plotScores(MUD1, res, tol = 1.0, ellipse = "cls")
p1 &lt;- p1 + ggtitle("MIA Scores")
p1

p2 &lt;- plotScree(res)
p2

# plotLoadings2D uses base graphics
MUD1a &lt;- plotLoadings2D(MUD1, res,
  load_lvls = seq(-90, 0, 10),
  main = "MIA Comp. 1 Loadings"
)

# Selection of loading matrix levels can be aided by the following
# Use MUD1a$names to find the index of the loadings

inspectLvls(MUD1a,
  which = 11, ylim = c(0, 80),
  main = "Histogram of Loadings Matrix"
)
</code></pre>

<hr>
<h2 id='MUD'>Made Up 2D NMR-Like Data Sets</h2><span id='topic+MUD'></span><span id='topic+MUD1'></span><span id='topic+MUD2'></span>

<h3>Description</h3>

<p>Made Up Data that resemble simple, HSQC-like 2D NMR data sets.  Lean, low resolution
and designed primarily to check graphics and test functions. <span class="pkg">As this is made up
data, there is no underlying tri-linear structure and therefore one should NOT try to interpret
the output of <code>miaSpectra2D</code> or <code>pfacSpectra2D</code> run on this data</span>.
</p>

<ul>
<li> <p><code>MUD1</code> is intended to test and demonstrate data reduction functions.  The HSQC-like data
is derived from the 1H and 13C spectra of 3-methyl-1-butanol and the corresponding ethyl ether,
idealized slightly for simplicity. There are 10 spectra.  Sample 1 is the alcohol; samples 2-5 are
the alcohol with local shifts (specifically, two peaks have been shifted +/- one data point).
Samples 6-10 are the ether, treated in a similar fashion.
</p>
</li>
<li> <p><code>MUD2</code> is intended to test and demonstrate alignment algorithms.  The HSQC-like data
is derived from the 1H and 13C spectra of 3-methyl-1-butanol, idealized slightly for
simplicity. There are 10 spectra.  The first one is &quot;correct&quot; and the other samples have global shifts on one
or both dimensions.
</p>
</li></ul>



<h3>Format</h3>

<p>The data are stored as a <code><a href="#topic+Spectra2D">Spectra2D</a></code> object.
</p>


<h3>Author(s)</h3>

<p>Bryan A. Hanson, DePauw University.
</p>


<h3>Source</h3>

<p>Created from scratch. Contact the author for a script if interested.
</p>

<hr>
<h2 id='normSpectra2D'>Normalize a Spectra2D Object</h2><span id='topic+normSpectra2D'></span>

<h3>Description</h3>

<p>This function carries out normalization of the spectra in a
<code><a href="#topic+Spectra2D">Spectra2D</a></code> object.  The current options are:
</p>

<ul>
<li> <p><code>"zero2one"</code> normalizes each 2D spectrum to a [0 ... 1] scale.
</p>
</li>
<li> <p><code>"minusPlus"</code> normalizes each 2D spectrum to a [-1 ... 1] scale.
</p>
</li>
<li> <p><code>"TotInt"</code> normalizes each 2D spectrum so that the total area is one.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>normSpectra2D(spectra, method = "zero2one")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="normSpectra2D_+3A_spectra">spectra</code></td>
<td>
<p>An object of S3 class <code><a href="#topic+Spectra2D">Spectra2D</a></code> to be normalized.</p>
</td></tr>
<tr><td><code id="normSpectra2D_+3A_method">method</code></td>
<td>
<p>Character string giving the method for normalization.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of S3 class <code><a href="#topic+Spectra2D">Spectra2D</a></code>.
</p>


<h3>Author(s)</h3>

<p>Bryan A. Hanson, DePauw University.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+centscaleSpectra2D">centscaleSpectra2D</a></code> for another means of scaling.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(MUD1)
MUD1n &lt;- normSpectra2D(MUD1)
MUD1b &lt;- removeFreq(MUD1, remF2 = 2.5 ~ 3.5)
MUD1bn &lt;- normSpectra2D(MUD1b)
</code></pre>

<hr>
<h2 id='pfacSpectra2D'>PARAFAC Analysis of a Spectra2D Object</h2><span id='topic+pfacSpectra2D'></span>

<h3>Description</h3>

<p>Carry out PARAFAC analysis of a <code><a href="#topic+Spectra2D">Spectra2D</a></code> object.
Function <code><a href="multiway.html#topic+parafac">parafac</a></code> from <span class="pkg">multiway</span> is used.
For large data sets, computational time may be long enough that
it might desirable to run in batch mode and possibly use parallel processing.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pfacSpectra2D(spectra, parallel = FALSE, setup = FALSE, nfac = 2, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pfacSpectra2D_+3A_spectra">spectra</code></td>
<td>
<p>An object of S3 class <code><a href="#topic+Spectra2D">Spectra2D</a></code>.</p>
</td></tr>
<tr><td><code id="pfacSpectra2D_+3A_parallel">parallel</code></td>
<td>
<p>Logical.  Should parallel processing be used?
Unless you love waiting, you should use parallel processing for larger data sets.
If you are working on a shared machine and/or another process (created by you or
another user) might also try to access all or some of the cores in your CPU,
you should be careful to avoid hogging the cores.
<code>parallel::detectCores()</code> will tell you how many cores are available to everyone.
You can run <code>options(mc.cores = 2)</code> to set the number of cores this function will use.</p>
</td></tr>
<tr><td><code id="pfacSpectra2D_+3A_setup">setup</code></td>
<td>
<p>Logical.  If <code>TRUE</code> the parallel environment will be automatically
configured for you.  If <code>FALSE</code>, the user must configure the environment
themselves (desirable for instance if working on Azure or AWS EC2).</p>
</td></tr>
<tr><td><code id="pfacSpectra2D_+3A_nfac">nfac</code></td>
<td>
<p>Integer.  The number of factors/components to compute.</p>
</td></tr>
<tr><td><code id="pfacSpectra2D_+3A_...">...</code></td>
<td>
<p>Additional parameters to be passed to function <code><a href="multiway.html#topic+parafac">parafac</a></code>.
You should give thought to value of <code>const</code>, allowed options can be seen in
<code><a href="CMLS.html#topic+const">const</a></code>. The default is to compute an unconstrained solution.
However, in some cases one may wish to apply a non-negativity constraint.  Also,
to suppress the progress bar, you can use <code>verbose = FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>pfac</code> and <code>parafac</code>, modified to include a list
element called <code>$method</code> which is <code>parafac</code>.
</p>


<h3>Warning</h3>

<p>To get reproducible results you will need to <code>set.seed()</code>.  See the example.
</p>


<h3>Author(s)</h3>

<p>Bryan A. Hanson, DePauw University.
</p>


<h3>References</h3>

<p>R. Bro &quot;PARAFAC. Tutorial and applications&quot; <em>Chemometrics and Intelligent
Laboratory Systems</em> vol. 38 pgs. 149-171 (1997).
</p>
<p>A. Smilde, R. Bro and P. Geladi
&quot;Multi-way Analysis: Applications in the Chemical Sciences&quot; Wiley (2004).
</p>


<h3>See Also</h3>

<p>For other data reduction methods for <code>Spectra2D</code> objects, see
<code><a href="#topic+miaSpectra2D">miaSpectra2D</a></code> and <code><a href="#topic+popSpectra2D">popSpectra2D</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("ggplot2")
data(MUD1)
set.seed(123)
res &lt;- pfacSpectra2D(MUD1, parallel = FALSE, nfac = 2)

# plotScores uses ggplot2 graphics

p1 &lt;- plotScores(MUD1, res, leg.loc = "topright", ellipse = "cls")
p1 &lt;- p1 + ggtitle("PARAFAC Score Plot")
p1

# plotLoadings2D uses base graphics

res1 &lt;- plotLoadings2D(MUD1, res,
  load_lvls = c(1, 5, 10, 15, 25),
  main = "PARAFAC Comp. 1 Loadings")
res2 &lt;- plotLoadings2D(MUD1, res,
  load_lvls = c(1, 5, 10, 15, 25),
  ref = 2, ref_lvls = seq(5, 35, 5),
  ref_cols = rep("black", 7),
  main = "PARAFAC Comp. 1 Loadings + Ref. Spectrum")

# Selection of loading matrix levels can be aided by the following
# Use res1$names to find the index of the loadings

inspectLvls(res1,
  which = 11, ylim = c(0, 50),
  main = "Histogram of Loadings Matrix")

</code></pre>

<hr>
<h2 id='plotLoadings2D'>Plot Loadings from a PARAFAC, MIA or POP Analysis of a Spectra2D Object</h2><span id='topic+plotLoadings2D'></span>

<h3>Description</h3>

<p>Computes (if necessary) and plots loadings from a PARAFAC, MIA or POP analysis of a
<code><a href="#topic+Spectra2D">Spectra2D</a></code> object. The loadings matrix has has dimensions
F1 x F2 and is a 2D pseudo-spectrum.  A reference spectrum may also be drawn.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotLoadings2D(
  spectra,
  so,
  load = 1,
  ref = NULL,
  load_lvls = NULL,
  ref_lvls = NULL,
  load_cols = NULL,
  ref_cols = NULL,
  plot = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotLoadings2D_+3A_spectra">spectra</code></td>
<td>
<p>An object of S3 class <code><a href="#topic+Spectra2D">Spectra2D</a></code>.</p>
</td></tr>
<tr><td><code id="plotLoadings2D_+3A_so">so</code></td>
<td>
<p>(&quot;Score Object&quot;) One of the following:
</p>

<ul>
<li><p> An object of class <code>mia</code> produced by
function <code><a href="#topic+miaSpectra2D">miaSpectra2D</a></code>.
</p>
</li>
<li><p> An object of class <code>pfac</code> produced by
function <code><a href="#topic+pfacSpectra2D">pfacSpectra2D</a></code>.
</p>
</li>
<li><p> An object of class <code>pop</code> produced by
function <code><a href="#topic+popSpectra2D">popSpectra2D</a></code>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="plotLoadings2D_+3A_load">load</code></td>
<td>
<p>An integer specifying the loading to plot.</p>
</td></tr>
<tr><td><code id="plotLoadings2D_+3A_ref">ref</code></td>
<td>
<p>An integer giving the spectrum in <code>spectra</code> to use
as a reference spectrum, which is plotted behind the loadings.
Defaults to <code>NULL</code> which does not plot a reference spectrum.</p>
</td></tr>
<tr><td><code id="plotLoadings2D_+3A_load_lvls">load_lvls</code></td>
<td>
<p>A vector specifying the contour levels
for the loadings pseudo-spectrum.
If <code>NULL</code>, values are computed using <code>calcLvls</code>.</p>
</td></tr>
<tr><td><code id="plotLoadings2D_+3A_ref_lvls">ref_lvls</code></td>
<td>
<p>A vector specifying the levels at which to compute contours
for the reference spectrum.
If <code>NULL</code>, values are computed using <code>calcLvls</code>.</p>
</td></tr>
<tr><td><code id="plotLoadings2D_+3A_load_cols">load_cols</code></td>
<td>
<p>A vector specifying the colors for the contours in the laoding spectrum.
If <code>NULL</code>, defaults to a scheme of values
running from blue (low) to red (high), centered on green (zero).</p>
</td></tr>
<tr><td><code id="plotLoadings2D_+3A_ref_cols">ref_cols</code></td>
<td>
<p>A vector specifying the colors for the contours in the reference
spectrum. If <code>NULL</code>, set to gray.</p>
</td></tr>
<tr><td><code id="plotLoadings2D_+3A_plot">plot</code></td>
<td>
<p>Logical.  Shall a plot be made?  Plotting large data sets can be slow.
Run the function with <code>plot = FALSE</code>, then use <code><a href="#topic+inspectLvls">inspectLvls</a></code>
to figure out desirable levels, then set <code>plot = TRUE</code>.</p>
</td></tr>
<tr><td><code id="plotLoadings2D_+3A_...">...</code></td>
<td>
<p>Additional parameters to be passed to plotting functions.  For instance
<code>showGrid = TRUE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The modified <code>Spectra2D</code> object is returned invisibly.
The loadings matrix will be appended with a sample of name of Loadings_x where
<code>x = load</code>. Side effect is a plot.
</p>


<h3>Scale</h3>

<p>You can view the color scale for the plot via <code><a href="#topic+showScale">showScale</a></code>.
</p>


<h3>Levels &amp; Colors</h3>

<p>The number of levels and colors must match, and they are used 1 for 1.  If you
provide <code>n</code> colors, and no levels, the automatic calculation of levels may return
a number of levels other than <code>n</code>, in which case the function will override your colors and
assign new colors for the number of levels it computed (with a message).  To get
exactly what you want, specify both levels and colors in equal numbers.  Function
<code><a href="#topic+inspectLvls">inspectLvls</a></code> can help you choose appropriate levels.
</p>


<h3>Overlaying Spectra</h3>

<p>If you specify more than one spectrum to plot, e.g. <code>which = c(1,2)</code>, then
arguments <code>lvls</code> and <code>cols</code> must be lists of levels and colors, one list
element for each spectrum to be plotted (if specified at all).  Two convenience functions exist to
make this process easier: <code><a href="#topic+LofL">LofL</a></code> and <code><a href="#topic+LofC">LofC</a></code>. See the examples.
</p>


<h3>Author(s)</h3>

<p>Bryan A. Hanson, DePauw University.
</p>


<h3>See Also</h3>

<p>Please see <code><a href="#topic+pfacSpectra2D">pfacSpectra2D</a></code>, <code><a href="#topic+miaSpectra2D">miaSpectra2D</a></code> or
<code><a href="#topic+popSpectra2D">popSpectra2D</a></code> for examples.
</p>

<hr>
<h2 id='plotScores'>Plot Scores from PCA, MIA or PARAFAC Analysis of a Spectra or Spectra2D Object</h2><span id='topic+plotScores'></span>

<h3>Description</h3>

<p>This function is used by <code>ChemoSpec</code> and <code>ChemoSpec2D</code>, but is
formally part of <code>ChemoSpecUtils</code>.  You can access
full documentation via <code><a href="ChemoSpecUtils.html#topic+plotScores">plotScores</a></code>.
</p>

<hr>
<h2 id='plotScree'>Scree Plots from PCA or MIA Analysis of a Spectra or Spectra2D Object</h2><span id='topic+plotScree'></span>

<h3>Description</h3>

<p>This function is used by <code>ChemoSpec</code> and <code>ChemoSpec2D</code>, but is
formally part of <code>ChemoSpecUtils</code>.  You can access
full documentation via <code><a href="ChemoSpecUtils.html#topic+plotScree">plotScree</a></code>.
</p>

<hr>
<h2 id='plotSlice'>Plot a Slice of a Spectra2D Object</h2><span id='topic+plotSlice'></span>

<h3>Description</h3>

<p>Plots a slice of a 2D spectrum stored in a <code><a href="#topic+Spectra2D">Spectra2D</a></code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotSlice(spectra, which = 1, F2 = NULL, F1 = NULL, showGrid = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotSlice_+3A_spectra">spectra</code></td>
<td>
<p>An object of S3 class <code><a href="#topic+Spectra2D">Spectra2D</a></code>.</p>
</td></tr>
<tr><td><code id="plotSlice_+3A_which">which</code></td>
<td>
<p>A single integer specifying which 2D spectrum from which to
plot the slice.</p>
</td></tr>
<tr><td><code id="plotSlice_+3A_f2">F2</code></td>
<td>
<p>A single frequency to plot.  Matched to the nearest value.</p>
</td></tr>
<tr><td><code id="plotSlice_+3A_f1">F1</code></td>
<td>
<p>As for <code>F2</code>.</p>
</td></tr>
<tr><td><code id="plotSlice_+3A_showgrid">showGrid</code></td>
<td>
<p>Logical. If TRUE, show a dotted gray line at each x axis tick mark.</p>
</td></tr>
<tr><td><code id="plotSlice_+3A_...">...</code></td>
<td>
<p>Additional parameters to be passed to the plotting routines.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Side effect is a plot.
</p>


<h3>Note</h3>

<p>Only one of <code>F2</code> or <code>F1</code> should be given.
</p>


<h3>Author(s)</h3>

<p>Bryan A. Hanson, DePauw University.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(MUD1)
plotSlice(MUD1, F1 = 22, main = "Slice @ F1 = 22 ppm")
</code></pre>

<hr>
<h2 id='plotSpectra2D'>Plot a Spectra2D Object</h2><span id='topic+plotSpectra2D'></span>

<h3>Description</h3>

<p>Plots a 2D spectrum stored in a <code><a href="#topic+Spectra2D">Spectra2D</a></code> object.
This is primarily for inspection and for preparation of final plots.
If you need to do extensive exploration, you should probably go back
to the spectrometer.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotSpectra2D(
  spectra,
  which = 1,
  lvls = NULL,
  cols = NULL,
  showNA = TRUE,
  showGrid = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotSpectra2D_+3A_spectra">spectra</code></td>
<td>
<p>An object of S3 class <code><a href="#topic+Spectra2D">Spectra2D</a></code>.</p>
</td></tr>
<tr><td><code id="plotSpectra2D_+3A_which">which</code></td>
<td>
<p>An integer specifying which spectrum to plot.  May be a vector.</p>
</td></tr>
<tr><td><code id="plotSpectra2D_+3A_lvls">lvls</code></td>
<td>
<p>A numeric vector specifying the levels at which to compute contours.
If <code>NULL</code>, values are computed using <code><a href="#topic+calcLvls">calcLvls</a></code>.  If
argument <code>which</code> gives more than one spectrum to plot, then <code>lvls</code>
must be a list of levels of <code>length(which)</code>.</p>
</td></tr>
<tr><td><code id="plotSpectra2D_+3A_cols">cols</code></td>
<td>
<p>A vector of valid color designations.  If provided, must be of the
the same length as <code>lvls</code> (i.e. each contour is a particular color).
If <code>NULL</code>, defaults to using a scheme of up to nine values
running from blue (low) to red (high), centered on green (zero).  If
argument <code>which</code> gives more than one spectrum to plot, then <code>cols</code>
must be a list of colors of <code>length(which)</code>.</p>
</td></tr>
<tr><td><code id="plotSpectra2D_+3A_showna">showNA</code></td>
<td>
<p>Logical. Should the locations of peaks removed by <code><a href="#topic+removePeaks2D">removePeaks2D</a></code>
be shown?  If present, these are shown by a gray line at each frequency.</p>
</td></tr>
<tr><td><code id="plotSpectra2D_+3A_showgrid">showGrid</code></td>
<td>
<p>Logical. If TRUE, show a dotted gray line at each tick mark.</p>
</td></tr>
<tr><td><code id="plotSpectra2D_+3A_...">...</code></td>
<td>
<p>Additional parameters to be passed to the plotting routines.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Side effect is a plot.
</p>


<h3>Warning</h3>

<p>One cannot remove frequencies from the interior of a 2D NMR data set and expect to get a meaningful
contour plot, because doing so puts unrelated peaks adjacent in the data set.
This would lead to contours being drawn that don't exist in the original data set.
This function will check for missing frequencies and stops if any are found.
</p>


<h3>Scale</h3>

<p>You can view the color scale for the plot via <code><a href="#topic+showScale">showScale</a></code>.
</p>


<h3>Levels &amp; Colors</h3>

<p>The number of levels and colors must match, and they are used 1 for 1.  If you
provide <code>n</code> colors, and no levels, the automatic calculation of levels may return
a number of levels other than <code>n</code>, in which case the function will override your colors and
assign new colors for the number of levels it computed (with a message).  To get
exactly what you want, specify both levels and colors in equal numbers.  Function
<code><a href="#topic+inspectLvls">inspectLvls</a></code> can help you choose appropriate levels.
</p>


<h3>Overlaying Spectra</h3>

<p>If you specify more than one spectrum to plot, e.g. <code>which = c(1,2)</code>, then
arguments <code>lvls</code> and <code>cols</code> must be lists of levels and colors, one list
element for each spectrum to be plotted (if specified at all).  Two convenience functions exist to
make this process easier: <code><a href="#topic+LofL">LofL</a></code> and <code><a href="#topic+LofC">LofC</a></code>. See the examples.
</p>


<h3>Author(s)</h3>

<p>Bryan A. Hanson, DePauw University.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(MUD1)
mylvls &lt;- seq(5, 30, 5)
plotSpectra2D(MUD1,
  which = 7, lvls = mylvls,
  main = "MUD1 Sample 7"
)

# Invert the screen which makes the colors pop!
op &lt;- par(no.readonly = TRUE)
par(bg = "black", fg = "white", col.axis = "white", col.main = "white")
plotSpectra2D(MUD1,
  which = 7, lvls = mylvls,
  main = "MUD1 Sample 7"
)
par(op)

# Overlay multiple spectra:

plotSpectra2D(MUD1,
  which = c(6, 1), lvls = LofL(mylvls, 2),
  cols = LofC(c("red", "black"), 2, length(mylvls), 2),
  main = "MUD1 Sample 1 (red) &amp; Sample 6 (black)\n(4 of 6 peaks overlap)"
)
</code></pre>

<hr>
<h2 id='popSpectra2D'>Plain Old PCA (POP) of Spectra2D Objects</h2><span id='topic+popSpectra2D'></span>

<h3>Description</h3>

<p>This function unstacks a <code>Spectra2D</code> object and conducts IRLBA
PCA on it.
To unstack, each F1 slice (parallel to F2) is concatenated one after the other
so that each 2D spectrum becomes a 1D spectrum.  The length of this spectrum will be
equal to the length of the F2 dimension times the length of the F1 dimension.
PCA is performed on the collection of 1D spectra (one spectrum from each 2D spectrum).
The IRLBA algorithm is used because the resulting matrix (n samples  in rows x F1 * F2 columns)
can be very large, and other PCA algorithms can struggle.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>popSpectra2D(spectra, n = 3, choice = "noscale", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="popSpectra2D_+3A_spectra">spectra</code></td>
<td>
<p>An object of S3 class <code><a href="#topic+Spectra2D">Spectra2D</a></code>.</p>
</td></tr>
<tr><td><code id="popSpectra2D_+3A_n">n</code></td>
<td>
<p>Integer. The number of components desired.</p>
</td></tr>
<tr><td><code id="popSpectra2D_+3A_choice">choice</code></td>
<td>
<p>A character string indicating the choice of scaling.  One of
<code>c("noscale"</code>, <code>"autoscale"</code>, <code>"Pareto")</code>.</p>
</td></tr>
<tr><td><code id="popSpectra2D_+3A_...">...</code></td>
<td>
<p>Other parameters to be passed to <code><a href="irlba.html#topic+prcomp_irlba">prcomp_irlba</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The scale choice <code>autoscale</code> scales the columns by their standard
deviation.  <code>Pareto</code> scales by the square root of the standard
deviation. <code>"autoscale"</code> is called &quot;standard normal variate&quot; or &quot;correlation matrix PCA&quot;
in some literature.  This action is performed on the unstacked matrix, as is centering.
</p>


<h3>Value</h3>

<p>An object of classes <code>prcomp</code>, <code>pop</code> and <code>computed_via_irlba</code>
modified to include a list element called <code>$method</code>, a character string describing the
pre-processing carried out and the type of PCA performed (used to annotate
plots).
</p>


<h3>Author(s)</h3>

<p>Bryan A. Hanson, DePauw University.
</p>


<h3>References</h3>

<p>J. Baglama and L. Reichel, &quot;Augmented Implicitly Restarted Lanczos
Bidiagonalization Methods&quot;  <em>SIAM J. Sci. Comput.</em> (2005).
</p>


<h3>See Also</h3>

<p>For other data reduction methods for <code>Spectra2D</code> objects, see
<code><a href="#topic+miaSpectra2D">miaSpectra2D</a></code> and <code><a href="#topic+pfacSpectra2D">pfacSpectra2D</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("ggplot2")
data(MUD1)
res &lt;- popSpectra2D(MUD1)

# plotScores &amp; plotScree use ggplot2 graphics

p1 &lt;- plotScores(MUD1, res, ellipse = "cls")
p1 &lt;- p1 + ggtitle("POP Scores")
p1

p2 &lt;- plotScree(res)
p2

# plotLoadings2D uses base graphics

MUD1a &lt;- plotLoadings2D(MUD1, res,
  load_lvls = c(-0.2, -0.1, 0.1, 0.2),
  load_cols = rep("black", 4), main = "POP Comp. 1 Loadings")

</code></pre>

<hr>
<h2 id='removeFreq'>Remove Frequencies from a Spectra or Spectra2D Object</h2><span id='topic+removeFreq'></span>

<h3>Description</h3>

<p>This function is used by <code>ChemoSpec</code> and <code>ChemoSpec2D</code>, but is
formally part of <code>ChemoSpecUtils</code>.  You can access
full documentation via <code><a href="ChemoSpecUtils.html#topic+removeFreq">removeFreq</a></code>.
</p>

<hr>
<h2 id='removeGroup'>Remove Groups from a Spectra or Spectra2D Object</h2><span id='topic+removeGroup'></span>

<h3>Description</h3>

<p>This function is used by <code>ChemoSpec</code> and <code>ChemoSpec2D</code>, but is
formally part of <code>ChemoSpecUtils</code>.  You can access
full documentation via <code><a href="ChemoSpecUtils.html#topic+removeGroup">removeGroup</a></code>.
</p>

<hr>
<h2 id='removePeaks2D'>Remove Peaks in a Spectra2D Object</h2><span id='topic+removePeaks2D'></span>

<h3>Description</h3>

<p>This function sets peaks at specified frequencies in a <code><a href="#topic+Spectra2D">Spectra2D</a></code>
object to <code>NA</code>. This effectively removes these peaks from calculations of
contours which can speed things up and clarifies the visual presentation of data.
This function is useful for removing regions with large
interfering peaks (e.g. the water peak in 1H NMR), or regions that are primarily
noise.  This function leaves the frequency axes intact.  Note that the
<code><a href="multiway.html#topic+parafac">parafac</a></code> function, used by <code><a href="#topic+pfacSpectra2D">pfacSpectra2D</a></code>, does not allow <code>NA</code>
in the input data matrices.  See <code><a href="#topic+removeFreq">removeFreq</a></code> for a way to shrink
the data set without introducing <code>NA</code>s.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>removePeaks2D(spectra, remF2 = NULL, remF1 = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="removePeaks2D_+3A_spectra">spectra</code></td>
<td>
<p>An object of S3 class <code><a href="#topic+Spectra2D">Spectra2D</a></code> from which to
remove selected peaks.</p>
</td></tr>
<tr><td><code id="removePeaks2D_+3A_remf2">remF2</code></td>
<td>
<p>A formula giving the range of frequencies to be set to <code>NA</code>.  May include
&quot;low&quot; or &quot;high&quot; representing the extremes of the spectra.    Values outside the range of
F2 are tolerated without notice and are handled <code>min</code> or <code>max</code>.See the examples.</p>
</td></tr>
<tr><td><code id="removePeaks2D_+3A_remf1">remF1</code></td>
<td>
<p>As for <code>remF2</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of S3 class <code><a href="#topic+Spectra2D">Spectra2D</a></code>.
</p>


<h3>Author(s)</h3>

<p>Bryan A. Hanson, DePauw University.
</p>


<h3>See Also</h3>

<p><code><a href="ChemoSpecUtils.html#topic+removeFreq">removeFreq</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Note we will set contours a bit low to better
# show what is going on.

data(MUD1)

plotSpectra2D(MUD1,
  which = 7, lvls = 0.1, cols = "black",
  main = "MUD1 Sample 7: Complete Data Set"
)

MUD1a &lt;- removePeaks2D(MUD1, remF2 = 2.5 ~ 4)
sumSpectra(MUD1a)
plotSpectra2D(MUD1a,
  which = 7, lvls = 0.1, cols = "black",
  main = "MUD1 Sample 7\nRemoved Peaks: F2 2.5 ~ 4"
)

MUD1b &lt;- removePeaks2D(MUD1, remF2 = low ~ 2)
sumSpectra(MUD1b)
plotSpectra2D(MUD1b,
  which = 7, lvls = 0.1, cols = "black",
  main = "MUD1 Sample 7\nRemoved Peaks: F2 low ~ 2"
)

MUD1c &lt;- removePeaks2D(MUD1, remF1 = high ~ 23)
sumSpectra(MUD1c)
plotSpectra2D(MUD1c,
  which = 7, lvls = 0.1, cols = "black",
  main = "MUD1 Sample 7\nRemoved Peaks: F1 high ~ 23"
)

MUD1d &lt;- removePeaks2D(MUD1, remF2 = 2.5 ~ 4, remF1 = 45 ~ 55)
sumSpectra(MUD1d)
plotSpectra2D(MUD1d,
  which = 7, lvls = 0.1, cols = "black",
  main = "MUD1 Sample 7\nRemoved Peaks: F2 2.5 ~ 4 &amp; F1 45 ~ 55"
)
</code></pre>

<hr>
<h2 id='removeSample'>Remove Samples from a Spectra or Spectra2D Object</h2><span id='topic+removeSample'></span>

<h3>Description</h3>

<p>This function is used by <code>ChemoSpec</code> and <code>ChemoSpec2D</code>, but is
formally part of <code>ChemoSpecUtils</code>.  You can access
full documentation via <code><a href="ChemoSpecUtils.html#topic+removeSample">removeSample</a></code>.
</p>

<hr>
<h2 id='sampleDist'>Compute the Distances Between Samples in a Spectra or Spectra2D Object</h2><span id='topic+sampleDist'></span>

<h3>Description</h3>

<p>This function is used by <code>ChemoSpec</code> and <code>ChemoSpec2D</code>, but is
formally part of <code>ChemoSpecUtils</code>.  You can access
full documentation via <code><a href="ChemoSpecUtils.html#topic+sampleDist">sampleDist</a></code>.
</p>

<hr>
<h2 id='shiftSpectra2D'>Shift the Spectra in a Spectra2D Object</h2><span id='topic+shiftSpectra2D'></span>

<h3>Description</h3>

<p>Shift the spectra in a <code><a href="#topic+Spectra2D">Spectra2D</a></code> object manually.  During shifting, some rows
or columns are thrown away and new rows or columns are introduced.  These new entries may
be filled with zeros, or noise from the original spectra.
</p>

<ul>
<li><p> (+) <code>shiftF2</code> - shift right: trim right, fill left
</p>
</li>
<li><p> (-) <code>shiftF2</code> - shift left: trim left, fill right
</p>
</li>
<li><p> (+) <code>shiftF1</code> - shift up: trim top, fill bottom
</p>
</li>
<li><p> (-) <code>shiftF1</code> - shift down: trim bottom, fill top
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>shiftSpectra2D(
  spectra,
  which = NULL,
  shiftF2 = 0L,
  shiftF1 = 0L,
  fill = "noise"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="shiftSpectra2D_+3A_spectra">spectra</code></td>
<td>
<p>An object of S3 class <code><a href="#topic+Spectra2D">Spectra2D</a></code>.</p>
</td></tr>
<tr><td><code id="shiftSpectra2D_+3A_which">which</code></td>
<td>
<p>An integer specifying which spectra to shift.  May be a vector.</p>
</td></tr>
<tr><td><code id="shiftSpectra2D_+3A_shiftf2">shiftF2</code></td>
<td>
<p>Integer.  The number of data points to shift along the F2 dimension.  See Details.</p>
</td></tr>
<tr><td><code id="shiftSpectra2D_+3A_shiftf1">shiftF1</code></td>
<td>
<p>As per <code>shiftF2</code>, but for the F1 dimension.</p>
</td></tr>
<tr><td><code id="shiftSpectra2D_+3A_fill">fill</code></td>
<td>
<p>Aligning spectra requires that at least some spectra be shifted left/right
and up/down.  When a spectrum is shifted, spaces are opened that must be filled with something:
</p>

<ul>
<li><p> If <code>fill = "zeros"</code> the spaces are filled with zeros.
</p>
</li>
<li><p> If <code>fill = "noise"</code> the spaces are filled with an estimate of the noise from the
original spectrum.
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of S3 class <code><a href="#topic+Spectra2D">Spectra2D</a></code>.
</p>


<h3>Author(s)</h3>

<p>Bryan A. Hanson, DePauw University.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(MUD2)
# Show the first two spectra, overlaid

mylvls &lt;- seq(5, 35, 5)
plotSpectra2D(MUD2,
  which = 1:2, lvls = LofL(mylvls, 2),
  cols = LofC(c("red", "black"), 2, length(mylvls), 2),
  main = "MUD2 Sample 1 (black) &amp; Sample 2 (red)"
)

# Now shift Sample 2
MUD2s &lt;- shiftSpectra2D(MUD2, which = 2, shiftF1 = -2)
plotSpectra2D(MUD2s,
  which = 1:2, lvls = LofL(mylvls, 2),
  cols = LofC(c("red", "black"), 2, length(mylvls), 2),
  main = "MUD2 Sample 1 (black) &amp; Sample 2 (red)\n(samples now aligned/overlap)"
)
</code></pre>

<hr>
<h2 id='showScale'>Display a pdf Version of the Contour Scale</h2><span id='topic+showScale'></span>

<h3>Description</h3>

<p>This function opens the files containing the contour scale in an appropriate viewer.
One file has a white background and the other a black background.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>showScale()
</code></pre>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
showScale()

## End(Not run)

</code></pre>

<hr>
<h2 id='Spectra2D'>Spectra2D Objects</h2><span id='topic+Spectra2D'></span>

<h3>Description</h3>

<p>In <code>ChemoSpec2D</code>, spectral data sets are stored in an S3 class called
<code>Spectra2D</code>, which contains a variety of information in addition to the
spectra themselves.  <code>Spectra2D</code> objects are created by
<code><a href="#topic+files2Spectra2DObject">files2Spectra2DObject</a></code>.
</p>


<h3>Structure</h3>

<p>The structure of a <code>Spectra2D</code> object is a list of eight
elements and an attribute as follows:
w
</p>

<table>
<tr>
 <td style="text-align: left;">
  <em>element</em> </td><td style="text-align: left;"> <em>type</em> </td><td style="text-align: left;"> <em>description</em></td>
</tr>
<tr>
 <td style="text-align: left;">

  $F2 </td><td style="text-align: left;"> num </td><td style="text-align: left;"> A common frequency (or wavelength) axis corresponding </td>
</tr>
<tr>
 <td style="text-align: left;">
      </td><td style="text-align: left;"> </td><td style="text-align: left;"> to the F2 dimension in NMR or the x axis more generally.</td>
</tr>
<tr>
 <td style="text-align: left;">
      </td><td style="text-align: left;"> </td><td style="text-align: left;"> Must be sorted ascending.</td>
</tr>
<tr>
 <td style="text-align: left;">

  $F1 </td><td style="text-align: left;"> num </td><td style="text-align: left;"> A common frequency (or wavelength) axis corresponding </td>
</tr>
<tr>
 <td style="text-align: left;">
      </td><td style="text-align: left;"> </td><td style="text-align: left;"> to the F1 dimension in NMR or the y axis more generally.</td>
</tr>
<tr>
 <td style="text-align: left;">
      </td><td style="text-align: left;"> </td><td style="text-align: left;"> Must be sorted ascending.</td>
</tr>
<tr>
 <td style="text-align: left;">

  $data </td><td style="text-align: left;"> num </td><td style="text-align: left;"> A list of matrices.  Each matrix contains a 2D spectrum.</td>
</tr>
<tr>
 <td style="text-align: left;">
        </td><td style="text-align: left;"> </td><td style="text-align: left;"> Each matrix should have <code>length(F1)</code> rows and </td>
</tr>
<tr>
 <td style="text-align: left;">
        </td><td style="text-align: left;"> </td><td style="text-align: left;"> <code>length(F2)</code> columns. The matrix must not have dimnames.</td>
</tr>
<tr>
 <td style="text-align: left;">
        </td><td style="text-align: left;"> </td><td style="text-align: left;"> The low end of the F2 dimension is last column of the last row</td>
</tr>
<tr>
 <td style="text-align: left;">
        </td><td style="text-align: left;"> </td><td style="text-align: left;"> (lower right hand corner as typically displayed).  The low end of</td>
</tr>
<tr>
 <td style="text-align: left;">
        </td><td style="text-align: left;"> </td><td style="text-align: left;"> the F1 dimension is the last column of the first row (upper right hand corner).</td>
</tr>
<tr>
 <td style="text-align: left;">
        </td><td style="text-align: left;"> </td><td style="text-align: left;"> In other words, the spectrum is stored as typically displayed.</td>
</tr>
<tr>
 <td style="text-align: left;">
        </td><td style="text-align: left;"> </td><td style="text-align: left;"> The list of matrices, if named, should have the same names as</td>
</tr>
<tr>
 <td style="text-align: left;">
        </td><td style="text-align: left;"> </td><td style="text-align: left;"> <code>names</code>.  However, this is not currently enforced.</td>
</tr>
<tr>
 <td style="text-align: left;">

  $names </td><td style="text-align: left;"> chr </td><td style="text-align: left;"> The sample names for the spectra; length must be no. samples.</td>
</tr>
<tr>
 <td style="text-align: left;">

  $groups </td><td style="text-align: left;"> factor </td><td style="text-align: left;"> The group classification of the samples; length must be no. samples.</td>
</tr>
<tr>
 <td style="text-align: left;">

  $colors </td><td style="text-align: left;"> character </td><td style="text-align: left;"> Colors for plotting; length must be no. samples.</td>
</tr>
<tr>
 <td style="text-align: left;">
          </td><td style="text-align: left;"> </td><td style="text-align: left;"> Colors correspond to groups.</td>
</tr>
<tr>
 <td style="text-align: left;">

  $units </td><td style="text-align: left;"> chr </td><td style="text-align: left;"> Three entries, the first giving the F2 (x) axis unit, the</td>
</tr>
<tr>
 <td style="text-align: left;">
        </td><td style="text-align: left;"> </td><td style="text-align: left;"> second the F1 (y) axis unit, and the third the z axis unit,</td>
</tr>
<tr>
 <td style="text-align: left;">
        </td><td style="text-align: left;"> </td><td style="text-align: left;"> usually some kind of intensity.</td>
</tr>
<tr>
 <td style="text-align: left;">

  $desc </td><td style="text-align: left;"> chr </td><td style="text-align: left;"> A character string describing the data set.</td>
</tr>
<tr>
 <td style="text-align: left;">

  - attr </td><td style="text-align: left;"> chr </td><td style="text-align: left;"> "Spectra2D" The S3 class designation.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Bryan A. Hanson, DePauw University.
</p>


<h3>See Also</h3>

<p><code><a href="ChemoSpecUtils.html#topic+sumSpectra">sumSpectra</a></code> to summarize a <code>Spectra2D</code> object.
<code><a href="ChemoSpecUtils.html#topic+sumGroups">sumGroups</a></code> to summarize group membership of a <code>Spectra2D</code>
object. <code><a href="ChemoSpecUtils.html#topic+chkSpectra">chkSpectra</a></code> to verify the integrity of a
<code>Spectra2D</code> object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(MUD1)
str(MUD1)
sumSpectra(MUD1)
</code></pre>

<hr>
<h2 id='sumGroups'>Summarize the Group Membership of a Spectra or Spectra2D Object</h2><span id='topic+sumGroups'></span>

<h3>Description</h3>

<p>This function is used by <code>ChemoSpec</code> and <code>ChemoSpec2D</code>, but is
formally part of <code>ChemoSpecUtils</code>.  You can access
full documentation via <code><a href="ChemoSpecUtils.html#topic+sumGroups">sumGroups</a></code>.
</p>

<hr>
<h2 id='sumSpectra'>Summarize a Spectra or Spectra2D Object</h2><span id='topic+sumSpectra'></span>

<h3>Description</h3>

<p>This function is used by <code>ChemoSpec</code> and <code>ChemoSpec2D</code>, but is
formally part of <code>ChemoSpecUtils</code>.  You can access
full documentation via <code><a href="ChemoSpecUtils.html#topic+sumSpectra">sumSpectra</a></code>.
</p>

<hr>
<h2 id='updateGroups'>Update Group Names in a Spectra or Spectra2D Object</h2><span id='topic+updateGroups'></span>

<h3>Description</h3>

<p>This function is used by <code>ChemoSpec</code> and <code>ChemoSpec2D</code>, but is
formally part of <code>ChemoSpecUtils</code>.  You can access
full documentation via <code><a href="ChemoSpecUtils.html#topic+updateGroups">updateGroups</a></code>.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
