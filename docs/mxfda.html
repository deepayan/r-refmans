<!DOCTYPE html><html><head><title>Help for package mxfda</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {mxfda}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#mxfda-package'><p>mxfda: A Functional Data Analysis Package for Spatial Single Cell Data</p></a></li>
<li><a href='#+25+26gt+3B+25'><p>Pipe operator</p></a></li>
<li><a href='#add_summary_function'><p>Add Summary Function</p></a></li>
<li><a href='#bivariate'><p>bivariate</p></a></li>
<li><a href='#entropy'><p>Entropy</p></a></li>
<li><a href='#extract_c'><p>extract_c</p></a></li>
<li><a href='#extract_fpca_object'><p>Extract FPCA object</p></a></li>
<li><a href='#extract_fpca_scores'><p>Extract FPCA scores</p></a></li>
<li><a href='#extract_model'><p>Extract Model</p></a></li>
<li><a href='#extract_spatial_summary'><p>Summarise spatial data in mxFDA object</p></a></li>
<li><a href='#extract_summary_functions'><p>Extract Summary Functions</p></a></li>
<li><a href='#extract_surface'><p>Extract Surface</p></a></li>
<li><a href='#filter_data'><p>Filter Data</p></a></li>
<li><a href='#filter_spatial'><p>Filter Spatial data</p></a></li>
<li><a href='#Gcross'><p>Gcross</p></a></li>
<li><a href='#Gest'><p>Gest</p></a></li>
<li><a href='#get_data'><p>Get Data</p></a></li>
<li><a href='#impute_fpca'><p>impute_fpca</p></a></li>
<li><a href='#is.empty'><p>Is Empty</p></a></li>
<li><a href='#Kcross'><p>Kcross</p></a></li>
<li><a href='#Kest'><p>Kest</p></a></li>
<li><a href='#Lcross'><p>Lcross</p></a></li>
<li><a href='#Lest'><p>Lest</p></a></li>
<li><a href='#lung_df'><p>Multiplex imaging data from a non-small cell lung cancer study.</p></a></li>
<li><a href='#lung_FDA'><p>Multiplex imaging data from a non-small cell lung cancer study</p></a></li>
<li><a href='#make_mxfda'><p>Make mxFDA class object</p></a></li>
<li><a href='#metric.exists'><p>Check if Spatial Summary Exists</p></a></li>
<li><a href='#one_zero'><p>1/0 Checker</p></a></li>
<li><a href='#ovarian_FDA'><p>Multiplex imaging data from an ovarian cancer tumor microarray</p></a></li>
<li><a href='#plot_fpc'><p>Create plot of mean +/- scaled eigenfunctions from FPCA</p></a></li>
<li><a href='#plot_mfpc'><p>Create plot of mean +/- scaled eigenfunctions from FPCA</p></a></li>
<li><a href='#plot.afcmSurface'><p>Plot afcm object</p></a></li>
<li><a href='#plot.lfcmSurface'><p>Plot lfcm surface</p></a></li>
<li><a href='#plot.mxFDA'><p>Plot mxFDA object</p></a></li>
<li><a href='#plot.sofr'><p>Plot sofr object</p></a></li>
<li><a href='#process_fcm'><p>process_fcm</p></a></li>
<li><a href='#run_fcm'><p>Run Function Cox Models</p></a></li>
<li><a href='#run_fpca'><p>run_fpca</p></a></li>
<li><a href='#run_mfcm'><p>Run function Cox models for data with multiple samples per subject</p></a></li>
<li><a href='#run_mfpca'><p>run_fpca</p></a></li>
<li><a href='#run_sofr'><p>Run Scalar on Function Regression</p></a></li>
<li><a href='#spatialTIME_summary_functions'><p><code>spatialTIME</code> summary function extraction</p></a></li>
<li><a href='#summary.mxFDA'><p>Summary method for object of class <code>mxFDA</code></p></a></li>
<li><a href='#univariate'><p>univariate</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>A Functional Data Analysis Package for Spatial Single Cell Data</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-05-06</td>
</tr>
<tr>
<td>Description:</td>
<td>Methods and tools for deriving spatial summary functions from single-cell imaging
  data and performing functional data analyses. Functions can be applied to other single-cell
  technologies such as spatial transcriptomics. Functional regression and functional principal component analysis methods
  are in the 'refund' package <a href="https://cran.r-project.org/package=refund">https://cran.r-project.org/package=refund</a> while calculation of the
  spatial summary functions are from the 'spatstat' package <a href="https://spatstat.org/">https://spatstat.org/</a>.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/julia-wrobel/mxfda/">https://github.com/julia-wrobel/mxfda/</a>,
<a href="http://juliawrobel.com/mxfda/">http://juliawrobel.com/mxfda/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/julia-wrobel/mxfda/issues/">https://github.com/julia-wrobel/mxfda/issues/</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat (&ge; 3.0.0), tidyverse, survival,
ggpubr, spatialTIME, tibble, broom, refund.shiny</td>
</tr>
<tr>
<td>Imports:</td>
<td>magrittr, rlang, tidyr, purrr, dplyr, ggplot2, lifecycle,
methods, stats, refund (&ge; 0.1-35), reshape2, mgcv,
spatstat.geom, spatstat.explore, SpatEntropy, SimDesign</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10),</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>LazyDataCompression:</td>
<td>bzip2</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-05-07 15:22:52 UTC; 4471592</td>
</tr>
<tr>
<td>Author:</td>
<td>Julia Wrobel <a href="https://orcid.org/0000-0001-6783-1421"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Alex Soupir <a href="https://orcid.org/0000-0003-1251-9179"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Alex Soupir &lt;alex.soupir@moffitt.org&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-05-08 11:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='mxfda-package'>mxfda: A Functional Data Analysis Package for Spatial Single Cell Data</h2><span id='topic+mxfda'></span><span id='topic+mxfda-package'></span>

<h3>Description</h3>

<p>Methods and tools for deriving spatial summary functions from single-cell imaging data and performing functional data analyses. Functions can be applied to other single-cell technologies such as spatial transcriptomics. Functional regression and functional principal component analysis methods are in the 'refund' package <a href="https://cran.r-project.org/package=refund">https://cran.r-project.org/package=refund</a> while calculation of the spatial summary functions are from the 'spatstat' package <a href="https://spatstat.org/">https://spatstat.org/</a>.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Alex Soupir <a href="mailto:alex.soupir@moffitt.org">alex.soupir@moffitt.org</a> (<a href="https://orcid.org/0000-0003-1251-9179">ORCID</a>)
</p>
<p>Authors:
</p>

<ul>
<li><p> Julia Wrobel <a href="mailto:julia.wrobel@emory.edu">julia.wrobel@emory.edu</a> (<a href="https://orcid.org/0000-0001-6783-1421">ORCID</a>)
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/julia-wrobel/mxfda/">https://github.com/julia-wrobel/mxfda/</a>
</p>
</li>
<li> <p><a href="http://juliawrobel.com/mxfda/">http://juliawrobel.com/mxfda/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/julia-wrobel/mxfda/issues/">https://github.com/julia-wrobel/mxfda/issues/</a>
</p>
</li></ul>


<hr>
<h2 id='+25+26gt+3B+25'>Pipe operator</h2><span id='topic++25+3E+25'></span>

<h3>Description</h3>

<p>See <code style="white-space: pre;">&#8288;magrittr::[\%&gt;\%][magrittr::pipe]&#8288;</code> for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lhs %&gt;% rhs
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="+2B25+2B26gt+2B3B+2B25_+3A_lhs">lhs</code></td>
<td>
<p>A value or the magrittr placeholder.</p>
</td></tr>
<tr><td><code id="+2B25+2B26gt+2B3B+2B25_+3A_rhs">rhs</code></td>
<td>
<p>A function call using the magrittr semantics.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The result of calling <code>rhs(lhs)</code>.
</p>

<hr>
<h2 id='add_summary_function'>Add Summary Function</h2><span id='topic+add_summary_function'></span>

<h3>Description</h3>

<p>Sometimes other ways of calculating summary functions is wanted and is done in other packages,
in this instance the data can be loaded into the <code>mxFDA</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_summary_function(mxFDAobject, summary_function_data, metric)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="add_summary_function_+3A_mxfdaobject">mxFDAobject</code></td>
<td>
<p>object of class <code>mxFDA</code></p>
</td></tr>
<tr><td><code id="add_summary_function_+3A_summary_function_data">summary_function_data</code></td>
<td>
<p>data frame with <code>summary_key</code> from <code>mxFDA</code> object as key column for summary function</p>
</td></tr>
<tr><td><code id="add_summary_function_+3A_metric">metric</code></td>
<td>
<p>character vector with either 'uni' or 'bi' and 'k', 'l', or 'g'; e.g. 'uni g'</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an updated <code>mxFDA</code> object with a derived value added. See <code><a href="#topic+make_mxfda">make_mxfda()</a></code> for more details.
</p>


<h3>Author(s)</h3>

<p>Alex Soupir <a href="mailto:alex.soupir@moffitt.org">alex.soupir@moffitt.org</a>
</p>

<hr>
<h2 id='bivariate'>bivariate</h2><span id='topic+bivariate'></span>

<h3>Description</h3>

<p>Internal function called by <code>extract_summary_functions</code> to calculate a bivariate spatial summary function for a single image.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bivariate(
  mximg,
  markvar,
  mark1,
  mark2,
  r_vec,
  func = c(Kcross, Lcross, Gcross, entropy),
  edge_correction,
  breaks = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bivariate_+3A_mximg">mximg</code></td>
<td>
<p>Dataframe of cell-level multiplex imaging data for a single image.
Should have variables <code>x</code> and <code>y</code> to denote x and y spatial locations of each cell.</p>
</td></tr>
<tr><td><code id="bivariate_+3A_markvar">markvar</code></td>
<td>
<p>The name of the variable that denotes cell type(s) of interest. Character.</p>
</td></tr>
<tr><td><code id="bivariate_+3A_mark1">mark1</code></td>
<td>
<p>Character string that denotes first cell type of interest.</p>
</td></tr>
<tr><td><code id="bivariate_+3A_mark2">mark2</code></td>
<td>
<p>Character string that denotes second cell type of interest.</p>
</td></tr>
<tr><td><code id="bivariate_+3A_r_vec">r_vec</code></td>
<td>
<p>Numeric vector of radii over which to evaluate spatial summary functions. Must begin at 0.</p>
</td></tr>
<tr><td><code id="bivariate_+3A_func">func</code></td>
<td>
<p>Spatial summary function to calculate. Options are c(Kcross, Lcross, Gcross) which denote Ripley's K, Besag's L, and nearest neighbor G function, respectively, or entropy from Vu et al, 2023.</p>
</td></tr>
<tr><td><code id="bivariate_+3A_edge_correction">edge_correction</code></td>
<td>
<p>Character string that denotes the edge correction method for spatial summary function. For Kcross and Lcross choose one of c(&quot;border&quot;, &quot;isotropic&quot;, &quot;Ripley&quot;, &quot;translate&quot;, &quot;none&quot;). For Gcross choose one of c(&quot;rs&quot;, &quot;km&quot;, &quot;han&quot;)</p>
</td></tr>
<tr><td><code id="bivariate_+3A_breaks">breaks</code></td>
<td>
<p>an integer for the number of breaks used for entropy</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Value</h3>

<p>A <code>data.frame</code> containing:
</p>
<table>
<tr><td><code>r</code></td>
<td>
<p>the radius of values over which the spatial summary function is evaluated</p>
</td></tr>
<tr><td><code>sumfun</code></td>
<td>
<p>the values of the spatial summary function</p>
</td></tr>
<tr><td><code>csr</code></td>
<td>
<p>the values of the spatial summary function under complete spatial randomness</p>
</td></tr>
<tr><td><code>fundiff</code></td>
<td>
<p>sumfun - csr, positive values indicate clustering and negative values repulsion</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Julia Wrobel <a href="mailto:julia.wrobel@emory.edu">julia.wrobel@emory.edu</a>
</p>


<h3>References</h3>

<p>Xiao, L., Ruppert, D., Zipunnikov, V., and Crainiceanu, C. (2016).
Fast covariance estimation for high-dimensional functional data.
<em>Statistics and Computing</em>, 26, 409-421.
DOI: 10.1007/s11222-014-9485-x.
</p>
<p>Vu, T., Seal, S., Ghosh, T., Ahmadian, M., Wrobel, J., &amp; Ghosh, D. (2023).
FunSpace: A functional and spatial analytic approach to cell imaging data using entropy measures.
<em>PLOS Computational Biology</em>, 19(9), e1011490.
</p>

<hr>
<h2 id='entropy'>Entropy</h2><span id='topic+entropy'></span>

<h3>Description</h3>

<p>Entropy
</p>


<h3>Usage</h3>

<pre><code class='language-R'>entropy(X, i, j, r_vec, correction)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="entropy_+3A_x">X</code></td>
<td>
<p>object of class <code>ppp</code> from spatstat with 2 marks</p>
</td></tr>
<tr><td><code id="entropy_+3A_i">i</code></td>
<td>
<p>ignored</p>
</td></tr>
<tr><td><code id="entropy_+3A_j">j</code></td>
<td>
<p>ignored</p>
</td></tr>
<tr><td><code id="entropy_+3A_r_vec">r_vec</code></td>
<td>
<p>vector of length wanted for breaks (will be rescaled) with max value at max for measuring entropy</p>
</td></tr>
<tr><td><code id="entropy_+3A_correction">correction</code></td>
<td>
<p>ignored</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>


<h3>Value</h3>

<p>data frame with entropy calculated for <code>length(r_vec)</code> bins within 0 to <code>max(r_vec)</code>
</p>


<h3>Author(s)</h3>

<p>Thao Vu <a href="mailto:thao.3.vu@cuanschutz.edu">thao.3.vu@cuanschutz.edu</a>
</p>
<p>Alex Soupir <a href="mailto:alex.soupir@moffitt.org">alex.soupir@moffitt.org</a>
</p>


<h3>References</h3>

<p>Vu, T., Seal, S., Ghosh, T., Ahmadian, M., Wrobel, J., &amp; Ghosh, D. (2023).
FunSpace: A functional and spatial analytic approach to cell imaging data using entropy measures.
<em>PLOS Computational Biology</em>, 19(9), e1011490.
</p>
<p>Altieri, L., Cocchi, D., &amp; Roli, G. (2018).
A new approach to spatial entropy measures.
<em>Environmental and ecological statistics</em>, 25, 95-110.
</p>

<hr>
<h2 id='extract_c'>extract_c</h2><span id='topic+extract_c'></span>

<h3>Description</h3>

<p>Function to calculate c-index from a an AFCM or LFCM fit
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_c(fit, survival_time, event)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract_c_+3A_fit">fit</code></td>
<td>
<p>fit AFCM or LFCM model fit object.</p>
</td></tr>
<tr><td><code id="extract_c_+3A_survival_time">survival_time</code></td>
<td>
<p>Vector of survival/censoring times</p>
</td></tr>
<tr><td><code id="extract_c_+3A_event">event</code></td>
<td>
<p>Survival statust (0 = censored, 1 = event)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>c-index
</p>


<h3>Author(s)</h3>

<p>Erjia Cui
</p>

<hr>
<h2 id='extract_fpca_object'>Extract FPCA object</h2><span id='topic+extract_fpca_object'></span>

<h3>Description</h3>

<p>Function that extracts the FPCA object created either by <code><a href="#topic+run_fpca">run_fpca()</a></code> or <code><a href="#topic+run_mfpca">run_mfpca()</a></code> from the <code>mxFDA</code> object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_fpca_object(mxFDAobject, what)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract_fpca_object_+3A_mxfdaobject">mxFDAobject</code></td>
<td>
<p>object of class <code>mxFDA</code></p>
</td></tr>
<tr><td><code id="extract_fpca_object_+3A_what">what</code></td>
<td>
<p>what functional PCA data to extract, e.g. 'uni k'</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>
<p>Output object can be visualized with <code><a href="refund.shiny.html#topic+plot_shiny">refund.shiny::plot_shiny()</a></code>
</p>


<h3>Value</h3>

<p><code>fpca</code> object created with <code><a href="#topic+run_fcm">run_fcm()</a></code>
</p>


<h3>Author(s)</h3>

<p>Alex Soupir <a href="mailto:alex.soupir@moffitt.org">alex.soupir@moffitt.org</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#load ovarian mxFDA object
data('ovarian_FDA')

#run the FPCA
ovarian_FDA = run_fpca(ovarian_FDA, metric = "uni g", r = "r", value = "fundiff",
                       lightweight = TRUE,
                       pve = .99)

#extract the fpca object
obj = extract_fpca_object(ovarian_FDA, "uni g fpca")

</code></pre>

<hr>
<h2 id='extract_fpca_scores'>Extract FPCA scores</h2><span id='topic+extract_fpca_scores'></span>

<h3>Description</h3>

<p>Extract FPCA scores
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_fpca_scores(mxFDAobject, what)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract_fpca_scores_+3A_mxfdaobject">mxFDAobject</code></td>
<td>
<p>object of class <code>mxFDA</code></p>
</td></tr>
<tr><td><code id="extract_fpca_scores_+3A_what">what</code></td>
<td>
<p>what functional PCA data to extract, e.g. 'uni k'</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Value</h3>

<p>fpca object
</p>


<h3>Author(s)</h3>

<p>Alex Soupir <a href="mailto:alex.soupir@moffitt.org">alex.soupir@moffitt.org</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#load ovarian mxFDA object
data('ovarian_FDA')

#run ghe lfcm model
ovarian_FDA = run_fpca(ovarian_FDA, metric = "uni g", r = "r",
                       value = "fundiff",
                       analysis_vars = c("age", "survival_time"))

#extract uni fpc scores
fpc = extract_fpca_scores(ovarian_FDA, 'uni g fpca')

</code></pre>

<hr>
<h2 id='extract_model'>Extract Model</h2><span id='topic+extract_model'></span>

<h3>Description</h3>

<p>Currently only extracts functional cox models not mixed functional cox models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_model(mxFDAobject, metric, type, model_name)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract_model_+3A_mxfdaobject">mxFDAobject</code></td>
<td>
<p>object of class <code>mxFDA</code></p>
</td></tr>
<tr><td><code id="extract_model_+3A_metric">metric</code></td>
<td>
<p>metric functional PCA data to extract, e.g. 'uni k'</p>
</td></tr>
<tr><td><code id="extract_model_+3A_type">type</code></td>
<td>
<p>one of &quot;cox&quot;, &quot;mcox&quot;, or &quot;sofr&quot; to specify the type of model to extract</p>
</td></tr>
<tr><td><code id="extract_model_+3A_model_name">model_name</code></td>
<td>
<p>character string of the model name to retrieve</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Value</h3>

<p>fit functional model
</p>


<h3>Author(s)</h3>

<p>Alex Soupir <a href="mailto:alex.soupir@moffitt.org">alex.soupir@moffitt.org</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#load ovarian mxFDA object
data('ovarian_FDA')

#run the lfcm model
ovarian_FDA = run_fcm(ovarian_FDA, model_name = "fit_lfcm",
                      formula = survival_time ~ age, event = "event",
                      metric = "uni g", r = "r", value = "fundiff",
                      analysis_vars = c("age", "survival_time"),
                      afcm = FALSE)

#extract model
mod = extract_model(ovarian_FDA, 'uni g', 'cox', 'fit_lfcm')

</code></pre>

<hr>
<h2 id='extract_spatial_summary'>Summarise spatial data in mxFDA object</h2><span id='topic+extract_spatial_summary'></span>

<h3>Description</h3>

<p>Summarise spatial data in mxFDA object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_spatial_summary(mxFDAobject, columns, grouping_columns = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract_spatial_summary_+3A_mxfdaobject">mxFDAobject</code></td>
<td>
<p>object of class <code>mxFDA</code></p>
</td></tr>
<tr><td><code id="extract_spatial_summary_+3A_columns">columns</code></td>
<td>
<p>character vector for column heading for cells to summarise</p>
</td></tr>
<tr><td><code id="extract_spatial_summary_+3A_grouping_columns">grouping_columns</code></td>
<td>
<p>character vector of other columns to use as grouping, such as region classification column</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>
<p>Currently this function is experimental as it only handles data that has text in the columns. Eventually,
will be able to handle any data inputs such as those from HALO where cells are designated as positive (1) or
negative (0) for a cell phenotypes.
</p>


<h3>Value</h3>

<p>data frame with percent of total points per spatial sample <code>columns</code>.
If multiple levels are present in <code>columns</code> columns, multiple output columns will be provided.
</p>


<h3>Author(s)</h3>

<p>Alex Soupir <a href="mailto:alex.soupir@moffitt.org">alex.soupir@moffitt.org</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#load data
data(lung_df)

#create data frames for `mxFDA` object
clinical = lung_df %&gt;%
  dplyr::select(image_id, patient_id, patientImage_id, gender,
         age, survival_days, survival_status, stage) %&gt;%
  dplyr::distinct()
#make small, just need to make sure it runs
spatial = lung_df %&gt;%
  dplyr::select(-image_id, -gender, -age, -survival_days, -survival_status, -stage) %&gt;%
  dplyr::filter(patientImage_id %in% clinical$patientImage_id[1:10])

#create `mxFDA` object
mxFDAobject = make_mxfda(metadata = clinical,
                         spatial = spatial,
                         subject_key = "patient_id",
                         sample_key = "patientImage_id")

#get markers
markers = colnames(mxFDAobject@Spatial) %&gt;%
  grep("pheno", ., value = TRUE)

#extract summary
df = extract_spatial_summary(mxFDAobject, markers)

</code></pre>

<hr>
<h2 id='extract_summary_functions'>Extract Summary Functions</h2><span id='topic+extract_summary_functions'></span>

<h3>Description</h3>

<p>Function to extract spatial summary functions from the <code>Spatial</code> slot of an <code>mxFDA</code> object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_summary_functions(
  mxFDAobject,
  r_vec = seq(0, 100, by = 10),
  extract_func = c(univariate, bivariate),
  summary_func = c(Kest, Lest, Gest),
  markvar,
  mark1,
  mark2 = NULL,
  edge_correction,
  breaks = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract_summary_functions_+3A_mxfdaobject">mxFDAobject</code></td>
<td>
<p>object of class <code>mxFDA</code></p>
</td></tr>
<tr><td><code id="extract_summary_functions_+3A_r_vec">r_vec</code></td>
<td>
<p>Numeric vector of radii over which to evaluate spatial summary functions. Must begin at 0.</p>
</td></tr>
<tr><td><code id="extract_summary_functions_+3A_extract_func">extract_func</code></td>
<td>
<p>Defaults to univariate, which calculates univariate spatial summary functions. Choose bivariate for bivariate spatial summary functions.</p>
</td></tr>
<tr><td><code id="extract_summary_functions_+3A_summary_func">summary_func</code></td>
<td>
<p>Spatial summary function to calculate. Options are c(Kest, Lest, Gest) which denote Ripley's K, Besag's L, and nearest neighbor G function, respectively.</p>
</td></tr>
<tr><td><code id="extract_summary_functions_+3A_markvar">markvar</code></td>
<td>
<p>The name of the variable that denotes cell type(s) of interest. Character.</p>
</td></tr>
<tr><td><code id="extract_summary_functions_+3A_mark1">mark1</code></td>
<td>
<p>Character string that denotes first cell type of interest.</p>
</td></tr>
<tr><td><code id="extract_summary_functions_+3A_mark2">mark2</code></td>
<td>
<p>Character string that denotes second cell type of interest for calculating bivariate summary statistics. Not used when calculating univariate statistics.</p>
</td></tr>
<tr><td><code id="extract_summary_functions_+3A_edge_correction">edge_correction</code></td>
<td>
<p>Character string that denotes the edge correction method for spatial summary function. For Kest and Lest choose one of c(&quot;border&quot;, &quot;isotropic&quot;, &quot;Ripley&quot;, &quot;translate&quot;, &quot;none&quot;). For Gest choose one of c(&quot;rs&quot;, &quot;km&quot;, &quot;han&quot;)</p>
</td></tr>
<tr><td><code id="extract_summary_functions_+3A_breaks">breaks</code></td>
<td>
<p>integer value for number of breaks in r_vec. Used only for entropy measure</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Value</h3>

<p>an object of class <code>mxFDA</code> containing the corresponding spatial summary function slot filled. See <code><a href="#topic+make_mxfda">make_mxfda()</a></code> for object structure details.
</p>


<h3>Author(s)</h3>

<p>Julia Wrobel <a href="mailto:julia.wrobel@emory.edu">julia.wrobel@emory.edu</a>
</p>
<p>Alex Soupir <a href="mailto:alex.soupir@moffitt.org">alex.soupir@moffitt.org</a>
</p>


<h3>References</h3>

<p>Xiao, L., Ruppert, D., Zipunnikov, V., and Crainiceanu, C. (2016).
Fast covariance estimation for high-dimensional functional data.
<em>Statistics and Computing</em>, 26, 409-421.
DOI: 10.1007/s11222-014-9485-x.
</p>
<p><code><a href="spatstat.explore.html#topic+Kest">spatstat.explore::Kest()</a></code>
</p>
<p><code><a href="spatstat.explore.html#topic+Gest">spatstat.explore::Gest()</a></code>
</p>
<p><code><a href="spatstat.explore.html#topic+Lest">spatstat.explore::Lest()</a></code>
</p>
<p><code><a href="spatstat.explore.html#topic+Kcross">spatstat.explore::Kcross()</a></code>
</p>
<p><code><a href="spatstat.explore.html#topic+Gcross">spatstat.explore::Gcross()</a></code>
</p>
<p><code><a href="spatstat.explore.html#topic+Lcross">spatstat.explore::Lcross()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#load ovarian FDA object
data('ovarian_FDA')

#run function
ovarian_FDA = extract_summary_functions(ovarian_FDA, r_vec = 0:100,
                                        extract_func = univariate,
                                        summary_func = Kest,
                                        markvar = "immune",
                                        mark1 = "immune",
                                        edge_correction = "trans")

</code></pre>

<hr>
<h2 id='extract_surface'>Extract Surface</h2><span id='topic+extract_surface'></span>

<h3>Description</h3>

<p>Function that transforms functional models from linear or additive functional cox models into <code>afcmSurface</code> or <code>lfcmSurface</code> objects to be plotted.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_surface(
  mxFDAobject,
  metric,
  model = NULL,
  r = "r",
  value = "fundiff",
  grid_length = 100,
  analysis_vars,
  p = 0.05,
  filter_cols = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract_surface_+3A_mxfdaobject">mxFDAobject</code></td>
<td>
<p>object of class <code>mxFDA</code> with model <code>model</code> calculated wihtin</p>
</td></tr>
<tr><td><code id="extract_surface_+3A_metric">metric</code></td>
<td>
<p>spatial summary function to extract surface for</p>
</td></tr>
<tr><td><code id="extract_surface_+3A_model">model</code></td>
<td>
<p>character string for the name of the model for <code>metric</code> data</p>
</td></tr>
<tr><td><code id="extract_surface_+3A_r">r</code></td>
<td>
<p>Character string, the name of the variable that identifies the function domain (usually a radius for spatial summary functions). Default is &quot;r&quot;.</p>
</td></tr>
<tr><td><code id="extract_surface_+3A_value">value</code></td>
<td>
<p>Character string, the name of the variable that identifies the spatial summary function values. Default is &quot;fundiff&quot;.</p>
</td></tr>
<tr><td><code id="extract_surface_+3A_grid_length">grid_length</code></td>
<td>
<p>Length of grid on which to evaluate coefficient functions.</p>
</td></tr>
<tr><td><code id="extract_surface_+3A_analysis_vars">analysis_vars</code></td>
<td>
<p>Other variables used in modeling FCM fit.</p>
</td></tr>
<tr><td><code id="extract_surface_+3A_p">p</code></td>
<td>
<p>numeric p-value used for predicting significant AFCM surface</p>
</td></tr>
<tr><td><code id="extract_surface_+3A_filter_cols">filter_cols</code></td>
<td>
<p>a named vector of factors to filter summary functions to in <code>c(Derived_Column = "Level_to_Filter")</code> format</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a 4 element list of either class <code>lfcmSurface</code> or <code>afcmSurface</code> depending on the class of model
</p>
<table>
<tr><td><code>Surface</code></td>
<td>
<p><code>data.frame</code> for term predictions for the surface of the metric * radius area</p>
</td></tr>
<tr><td><code>Prediction</code></td>
<td>
<p><code>data.frame</code> for standard error of the terms for the above surface. AFCM models use the <code>p</code> to set the upper and lower standard errors of <code class="reqn">\beta_1</code></p>
</td></tr>
<tr><td><code>Metric</code></td>
<td>
<p>character of the spatial summary function used; helps keep track if running many models</p>
</td></tr>
<tr><td><code>P-value</code></td>
<td>
<p>a numeric value of the input p-value</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Julia Wrobel <a href="mailto:julia.wrobel@emory.edu">julia.wrobel@emory.edu</a>
</p>
<p>Alex Soupir <a href="mailto:alex.soupir@moffitt.org">alex.soupir@moffitt.org</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#load ovarian mxFDA object
data('ovarian_FDA')

#run the lfcm model
ovarian_FDA = run_fcm(ovarian_FDA, model_name = "fit_lfcm",
                      formula = survival_time ~ age, event = "event",
                      metric = "uni g", r = "r", value = "fundiff",
                      analysis_vars = c("age", "survival_time"),
                      afcm = FALSE)

#extract surface
model_surface = extract_surface(ovarian_FDA, metric = 'uni g',
                                model = 'fit_lfcm',
                                analysis_vars = 'age') #variables in model

</code></pre>

<hr>
<h2 id='filter_data'>Filter Data</h2><span id='topic+filter_data'></span>

<h3>Description</h3>

<p>not used in an important want currently
</p>


<h3>Usage</h3>

<pre><code class='language-R'>filter_data(dat, filter_columns)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="filter_data_+3A_dat">dat</code></td>
<td>
<p>a data frame which to filter</p>
</td></tr>
<tr><td><code id="filter_data_+3A_filter_columns">filter_columns</code></td>
<td>
<p>named vector where names is the column and element is what to filter to</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>


<h3>Value</h3>

<p>data frame filtered
</p>

<hr>
<h2 id='filter_spatial'>Filter Spatial data</h2><span id='topic+filter_spatial'></span>

<h3>Description</h3>

<p>function to filter the spatial data slot of the <code>mxFDA</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>filter_spatial(mxFDAobject, ..., based_on = "meta", force = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="filter_spatial_+3A_mxfdaobject">mxFDAobject</code></td>
<td>
<p>object of class <code>mxFDA</code></p>
</td></tr>
<tr><td><code id="filter_spatial_+3A_...">...</code></td>
<td>
<p>expressions that return a logical TRUE/FALSE value when evaluated on columns of the meta data slot. These expressions get passed to <code><a href="dplyr.html#topic+filter">dplyr::filter()</a></code> so must be compatible.</p>
</td></tr>
<tr><td><code id="filter_spatial_+3A_based_on">based_on</code></td>
<td>
<p>character for which data slot to use for filtering, either 'meta', or 'spatial'. Default to 'meta'.</p>
</td></tr>
<tr><td><code id="filter_spatial_+3A_force">force</code></td>
<td>
<p>logical whether or not to return empty spatial data <em>if</em> filtering results in 0 rows</p>
</td></tr>
</table>


<h3>Value</h3>

<p>object of class <code>mxFDA</code> with the spatial slot filtered. See <code><a href="#topic+make_mxfda">make_mxfda()</a></code> for more details on object
</p>


<h3>Author(s)</h3>

<p>Alex Soupir <a href="mailto:alex.soupir@moffitt.org">alex.soupir@moffitt.org</a>
</p>


<h3>References</h3>

<p><code><a href="dplyr.html#topic+filter">dplyr::filter()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#load ovarian mxFDA object
data(ovarian_FDA)

#filter ages greater than 50
ovarian_FDA_age50 = filter_spatial(ovarian_FDA, age &gt;= 50, based_on = 'meta')

</code></pre>

<hr>
<h2 id='Gcross'>Gcross</h2><span id='topic+Gcross'></span>

<h3>Description</h3>

<p>See <code><a href="spatstat.explore.html#topic+Gcross">spatstat.explore::Gcross()</a></code>
</p>


<h3>Value</h3>

<p>object of class &quot;fv&quot; with columns for radii, theoretical bivariate G, and columns for edge corrections.
</p>

<hr>
<h2 id='Gest'>Gest</h2><span id='topic+Gest'></span>

<h3>Description</h3>

<p>See <code><a href="spatstat.explore.html#topic+Gest">spatstat.explore::Gest()</a></code>
</p>


<h3>Value</h3>

<p>object of class &quot;fv&quot; with columns for radii, theoretical G, and columns for edge corrections.
</p>

<hr>
<h2 id='get_data'>Get Data</h2><span id='topic+get_data'></span>

<h3>Description</h3>

<p>Returns data from slots within the mxfDA object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_data(mxFDAobject, what, type)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_data_+3A_mxfdaobject">mxFDAobject</code></td>
<td>
<p>object of class <code>mxFDA</code></p>
</td></tr>
<tr><td><code id="get_data_+3A_what">what</code></td>
<td>
<p>character string of length 2 for what to return. produced by unlisting &quot;uni k&quot; or &quot;bi g fpca&quot; type strings</p>
</td></tr>
<tr><td><code id="get_data_+3A_type">type</code></td>
<td>
<p>the type of data to get for the what summary function</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Value</h3>

<p>slot data
</p>

<hr>
<h2 id='impute_fpca'>impute_fpca</h2><span id='topic+impute_fpca'></span>

<h3>Description</h3>

<p>Internal function called by <code>TITLE: regression function</code> that imputes missing data in functional predictors using FPCA.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>impute_fpca(
  mxfundata,
  id,
  r = "r",
  value = "fundiff",
  knots = NULL,
  analysis_vars,
  smooth
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="impute_fpca_+3A_mxfundata">mxfundata</code></td>
<td>
<p>Dataframe of spatial summary functions from multiplex imaging data, in long format. Can be estimated using the function <code>extract_summary_functions</code> or provided separately.</p>
</td></tr>
<tr><td><code id="impute_fpca_+3A_id">id</code></td>
<td>
<p>Character string, the name of the variable that identifies each unique subject.</p>
</td></tr>
<tr><td><code id="impute_fpca_+3A_r">r</code></td>
<td>
<p>Character string, the name of the variable that identifies the function domain (usually a radius for spatial summary functions). Default is &quot;r&quot;.</p>
</td></tr>
<tr><td><code id="impute_fpca_+3A_value">value</code></td>
<td>
<p>Character string, the name of the variable that identifies the spatial summary function values. Default is &quot;fundiff&quot;.</p>
</td></tr>
<tr><td><code id="impute_fpca_+3A_knots">knots</code></td>
<td>
<p>Number of knots for defining spline basis.</p>
</td></tr>
<tr><td><code id="impute_fpca_+3A_analysis_vars">analysis_vars</code></td>
<td>
<p>Optional list of variables to be retained for downstream analysis.</p>
</td></tr>
<tr><td><code id="impute_fpca_+3A_smooth">smooth</code></td>
<td>
<p>Option to smooth data using FPCA.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>dataframe</code> where the missing function values (NA) for the <code>value</code> variable have been replaced with estimates from FPCA.
</p>


<h3>Author(s)</h3>

<p>Julia Wrobel <a href="mailto:julia.wrobel@emory.edu">julia.wrobel@emory.edu</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># simulate data
set.seed(1001)

</code></pre>

<hr>
<h2 id='is.empty'>Is Empty</h2><span id='topic+is.empty'></span>

<h3>Description</h3>

<p>checks whether or not a slot is empty in the mxfDA objecct
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is.empty(obj, slot.name)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="is.empty_+3A_obj">obj</code></td>
<td>
<p>object with slots</p>
</td></tr>
<tr><td><code id="is.empty_+3A_slot.name">slot.name</code></td>
<td>
<p>character string of for the name of a slot</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Value</h3>

<p><code>TRUE</code>, <code>FALSE</code>, or <code>stop</code> command
</p>

<hr>
<h2 id='Kcross'>Kcross</h2><span id='topic+Kcross'></span>

<h3>Description</h3>

<p>See <code><a href="spatstat.explore.html#topic+Kcross">spatstat.explore::Kcross()</a></code>
</p>


<h3>Value</h3>

<p>object of class &quot;fv&quot; with columns for radii, theoretical bivariate K, and columns for edge corrections.
</p>

<hr>
<h2 id='Kest'>Kest</h2><span id='topic+Kest'></span>

<h3>Description</h3>

<p>See <code><a href="spatstat.explore.html#topic+Kest">spatstat.explore::Kest()</a></code>
</p>


<h3>Value</h3>

<p>object of class &quot;fv&quot; with columns for radii, theoretical K, and columns for edge corrections.
</p>

<hr>
<h2 id='Lcross'>Lcross</h2><span id='topic+Lcross'></span>

<h3>Description</h3>

<p>See <code><a href="spatstat.explore.html#topic+Lcross">spatstat.explore::Lcross()</a></code>
</p>


<h3>Value</h3>

<p>object of class &quot;fv&quot; with columns for radii, theoretical bivariate L, and columns for edge corrections.
</p>

<hr>
<h2 id='Lest'>Lest</h2><span id='topic+Lest'></span>

<h3>Description</h3>

<p>See <code><a href="spatstat.explore.html#topic+Lest">spatstat.explore::Lest()</a></code>
</p>


<h3>Value</h3>

<p>object of class &quot;fv&quot; with columns for radii, theoretical L, and columns for edge corrections.
</p>

<hr>
<h2 id='lung_df'>Multiplex imaging data from a non-small cell lung cancer study.</h2><span id='topic+lung_df'></span>

<h3>Description</h3>

<p>This data is adapted from the VectraPolarisData Bioconductor package. There are multiple ROIs for each patient.
Data was filtered to include only the cells in the tumor compartment.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lung_df
</code></pre>


<h3>Format</h3>



<h4><code>lung_df</code></h4>

<p>A data frame with 879,694 rows and 19 columns:
</p>

<dl>
<dt>image_id</dt><dd><p>Image id for a given patient</p>
</dd>
<dt>patient_id</dt><dd><p>Unique patient id</p>
</dd>
<dt>age</dt><dd><p>Patient age at time of cancer diagnosis</p>
</dd>
<dt>survival_days</dt><dd><p>Survival time from diagnosis, in days</p>
</dd>
<dt>survival_status</dt><dd><p>Censoring variable, 1 = death, 0 = censor</p>
</dd>
<dt>x</dt><dd><p>Cell x position</p>
</dd>
<dt>y</dt><dd><p>Cell y position</p>
</dd>
</dl>
<p>...

</p>



<h3>Source</h3>

<p><a href="https://bioconductor.org/packages/release/data/experiment/html/VectraPolarisData.html">https://bioconductor.org/packages/release/data/experiment/html/VectraPolarisData.html</a>
</p>

<hr>
<h2 id='lung_FDA'>Multiplex imaging data from a non-small cell lung cancer study</h2><span id='topic+lung_FDA'></span>

<h3>Description</h3>

<p>This data is adapted from the VectraPolarisData Bioconductor package. There are multiple ROIs for each patient.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lung_FDA
</code></pre>


<h3>Format</h3>



<h4><code>lung_FDA</code></h4>

<p>An mxFDA object with augmented non-small cel lung cancer multiplex immunofluorescence data, and NN G(r) calculated:
</p>

<dl>
<dt>Metadata</dt><dd><p>information about the spatial samples with column <code>sample_key</code> column in both</p>
</dd>
<dt>Spatial</dt><dd><p>cell-level information with <code>x</code> and <code>y</code> columns along with <code>sample_key</code> to link to <code>Metadata</code></p>
</dd>
<dt>subject_key</dt><dd><p>column in <code>Metadata</code> that may have multiple <code>sample_key</code> values for each, akin to patient IDs</p>
</dd>
<dt>sample_key</dt><dd><p>column in both <code>Metadata</code> and <code>Spatial</code> that is a 1:1 with the samples (unique per sample)</p>
</dd>
<dt>univariate_summaries</dt><dd><p>univariate summary slot with nearest neighbor G calculared</p>
</dd>
<dt>bivariate_summaries</dt><dd><p>empty slot available for bivariate summaries</p>
</dd>
<dt>functional_pca</dt><dd><p>empty slot for functional PCA data of summaries</p>
</dd>
<dt>functional_cox</dt><dd><p>empty slot for functional models</p>
</dd>
</dl>




<h3>Details</h3>

<p>Spatial summary functions of lung cancer multiplex imaging data.
</p>
<p>This data is adapted from the VectraPolarisData Bioconductor package.
Signal between the survival outcome and spatial summary functions has been augmented for teaching purposes.
Spatial relationship is summarized using the nearest neighbor G function.
</p>
<p>Includes only spatial samples that had 10 or more radii with calculable G function
</p>


<h3>Source</h3>

<p><a href="https://bioconductor.org/packages/release/data/experiment/html/VectraPolarisData.html">https://bioconductor.org/packages/release/data/experiment/html/VectraPolarisData.html</a>
</p>

<hr>
<h2 id='make_mxfda'>Make mxFDA class object</h2><span id='topic+make_mxfda'></span>

<h3>Description</h3>

<p>Used to create an object of class <code>mxFDA</code> that can be used with the <a href="#topic+mxfda">mxfda</a> package for functional data analysis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make_mxfda(metadata, spatial = NULL, subject_key, sample_key)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="make_mxfda_+3A_metadata">metadata</code></td>
<td>
<p>metadata with columns <code>subject_key</code> and <code>sample_key</code></p>
</td></tr>
<tr><td><code id="make_mxfda_+3A_spatial">spatial</code></td>
<td>
<p>spatial information, either list or df, with column <code>sample_key</code>. <code>Spatial</code> can be empty if inputting data already derived. See <code><a href="#topic+add_summary_function">add_summary_function()</a></code> for more details.</p>
</td></tr>
<tr><td><code id="make_mxfda_+3A_subject_key">subject_key</code></td>
<td>
<p>column name in <code>Metadata</code> for subject ID</p>
</td></tr>
<tr><td><code id="make_mxfda_+3A_sample_key">sample_key</code></td>
<td>
<p>column linking <code>Metadata</code> to <code>Spatial</code> data</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Value</h3>

<p>S4 object of class <code>mxFDA</code>
</p>
<table>
<tr><td><code>Metadata</code></td>
<td>
<p>slot of class <code>data.frame</code> that contains sample and subject level information</p>
</td></tr>
<tr><td><code>Spatial</code></td>
<td>
<p>slot of class <code>data.frame</code> that contains point level information within samples. An example would be cells belonging to TMA cores</p>
</td></tr>
<tr><td><code>subject_key</code></td>
<td>
<p>slot of class <code>character</code> that corresponds to a column in the <code>Metadata</code> slot that groups samples at a subject level. An example would be &quot;<em>patient_id</em>&quot;</p>
</td></tr>
<tr><td><code>sample_key</code></td>
<td>
<p>slot of class <code>character</code> that corresponds to a column both in the <code>Metadata</code> and <code>Spatial</code> slots that links samples to characteristics</p>
</td></tr>
<tr><td><code>univariate_summaries</code></td>
<td>
<p>slot of class <code>list</code> where univariate summary functions calculated on <code>Spatial</code> would be stored</p>
</td></tr>
<tr><td><code>bivariate_summaries</code></td>
<td>
<p>slot of class <code>list</code> where bivariate summary functions calculated on <code>Spatial</code> would be stored</p>
</td></tr>
<tr><td><code>functional_pca</code></td>
<td>
<p>slot of class <code>list</code> where FPCA results are stored</p>
</td></tr>
<tr><td><code>functional_mpca</code></td>
<td>
<p>slot of class <code>list</code> where MFPCA results are stored</p>
</td></tr>
<tr><td><code>functional_cox</code></td>
<td>
<p>slot of class <code>list</code> where functional cox model results are stored</p>
</td></tr>
<tr><td><code>functional_mcox</code></td>
<td>
<p>slot of class <code>list</code> where mixed functional cox model results are stored</p>
</td></tr>
<tr><td><code>scalar_on_function</code></td>
<td>
<p>slot of class <code>list</code> where functional models are fit to scalar responses</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alex Soupir <a href="mailto:alex.soupir@moffitt.org">alex.soupir@moffitt.org</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#select sample metadata
clinical = lung_df %&gt;%
  dplyr::select(image_id, patient_id, patientImage_id,
                gender, age, survival_days, survival_status, stage) %&gt;%
  dplyr::distinct()
#select the spatial information
spatial = lung_df %&gt;%
  dplyr::select(-image_id, -gender, -age, -survival_days, -survival_status, -stage)
sample_id_column = "patientImage_id"
#create the mxFDA object
mxFDAobject = make_mxfda(metadata = clinical,
                         spatial = spatial,
                         subject_key = "patient_id",
                         sample_key = sample_id_column)

</code></pre>

<hr>
<h2 id='metric.exists'>Check if Spatial Summary Exists</h2><span id='topic+metric.exists'></span>

<h3>Description</h3>

<p>Makes sure in processing functions that the spatial summary function has been calculated before running FPCA or models
</p>


<h3>Usage</h3>

<pre><code class='language-R'>metric.exists(mxFDAobject, metric)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="metric.exists_+3A_mxfdaobject">mxFDAobject</code></td>
<td>
<p>object of class <code>mxFDA</code></p>
</td></tr>
<tr><td><code id="metric.exists_+3A_metric">metric</code></td>
<td>
<p>a character vector split with and passed by other functions</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Value</h3>

<p>a stopped function if slot not in summary functions
</p>

<hr>
<h2 id='one_zero'>1/0 Checker</h2><span id='topic+one_zero'></span>

<h3>Description</h3>

<p>1/0 Checker
</p>


<h3>Usage</h3>

<pre><code class='language-R'>one_zero(vec)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="one_zero_+3A_vec">vec</code></td>
<td>
<p>vector of hopefully 1s and 0s but anything</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Value</h3>

<p><code>TRUE</code> or <code>FALSE</code> depending on if something other than 0/1 is in the vector
</p>

<hr>
<h2 id='ovarian_FDA'>Multiplex imaging data from an ovarian cancer tumor microarray</h2><span id='topic+ovarian_FDA'></span>

<h3>Description</h3>

<p>This data is adapted from the VectraPolarisData Bioconductor package and comes from a tumor-microarray of tissue samples from 128 patients with ovarian cancer.
There is one patient per subject.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ovarian_FDA
</code></pre>


<h3>Format</h3>



<h4><code>ovarian_FDA</code></h4>

<p>An mxFDA object with augmented ovarian cancer multiplex immunofluorescence data, and NN G(r) calculated:
</p>

<dl>
<dt>Metadata</dt><dd><p>information about the spatial samples with column <code>sample_key</code> column in both</p>
</dd>
<dt>Spatial</dt><dd><p>cell-level information with <code>x</code> and <code>y</code> columns along with <code>sample_key</code> to link to <code>Metadata</code></p>
</dd>
<dt>subject_key</dt><dd><p>column in <code>Metadata</code> that may have multiple <code>sample_key</code> values for each, akin to patient IDs</p>
</dd>
<dt>sample_key</dt><dd><p>column in both <code>Metadata</code> and <code>Spatial</code> that is a 1:1 with the samples (unique per sample)</p>
</dd>
<dt>univariate_summaries</dt><dd><p>univariate summary slot with nearest neighbor G calculared</p>
</dd>
<dt>bivariate_summaries</dt><dd><p>empty slot available for bivariate summaries</p>
</dd>
<dt>functional_pca</dt><dd><p>empty slot for functional PCA data of summaries</p>
</dd>
<dt>functional_cox</dt><dd><p>empty slot for functional models</p>
</dd>
</dl>




<h3>Details</h3>

<p>Spatial summary functions of ovarian cancer multiplex imaging data.
</p>
<p>This data is adapted from the VectraPolarisData Bioconductor package.
Signal between the survival outcome and spatial summary functions has been augmented for teaching purposes.
Spatial relationship is summarized using the nearest neighbor G function.
</p>


<h3>Source</h3>

<p><a href="https://bioconductor.org/packages/release/data/experiment/html/VectraPolarisData.html">https://bioconductor.org/packages/release/data/experiment/html/VectraPolarisData.html</a>
</p>

<hr>
<h2 id='plot_fpc'>Create plot of mean +/- scaled eigenfunctions from FPCA</h2><span id='topic+plot_fpc'></span>

<h3>Description</h3>

<p>Produces a ggplot with mean plus or minus two standard deviations of a selected FPC.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_fpc(obj, pc_choice)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_fpc_+3A_obj">obj</code></td>
<td>
<p>fpca object to be plotted.</p>
</td></tr>
<tr><td><code id="plot_fpc_+3A_pc_choice">pc_choice</code></td>
<td>
<p>FPC to be plotted.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#superseded"><img src="../help/figures/lifecycle-superseded.svg" alt='[Superseded]' /></a>
</p>


<h3>Value</h3>

<p>object of class ggplot
</p>


<h3>Author(s)</h3>

<p>Julia Wrobel <a href="mailto:julia.wrobel@emory.edu">julia.wrobel@emory.edu</a>
</p>

<hr>
<h2 id='plot_mfpc'>Create plot of mean +/- scaled eigenfunctions from FPCA</h2><span id='topic+plot_mfpc'></span>

<h3>Description</h3>

<p>Produces a ggplot with mean plus or minus two standard deviations of a selected FPC.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_mfpc(obj, pc_choice_level1, pc_choice_level2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_mfpc_+3A_obj">obj</code></td>
<td>
<p>fpca object to be plotted.</p>
</td></tr>
<tr><td><code id="plot_mfpc_+3A_pc_choice_level1">pc_choice_level1</code>, <code id="plot_mfpc_+3A_pc_choice_level2">pc_choice_level2</code></td>
<td>
<p>FPC to be plotted.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#superseded"><img src="../help/figures/lifecycle-superseded.svg" alt='[Superseded]' /></a>
</p>


<h3>Value</h3>

<p>list of objects of class ggplot
</p>


<h3>Author(s)</h3>

<p>Julia Wrobel <a href="mailto:julia.wrobel@emory.edu">julia.wrobel@emory.edu</a>
</p>

<hr>
<h2 id='plot.afcmSurface'>Plot afcm object</h2><span id='topic+plot.afcmSurface'></span>

<h3>Description</h3>

<p>Plot afcm object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'afcmSurface'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.afcmSurface_+3A_x">x</code></td>
<td>
<p>object of class <code>afcmSurface</code> to be plotted</p>
</td></tr>
<tr><td><code id="plot.afcmSurface_+3A_...">...</code></td>
<td>
<p>currently ignored</p>
</td></tr>
</table>


<h3>Value</h3>

<p>object compatable with ggplot2
</p>


<h3>Author(s)</h3>

<p>Julia Wrobel <a href="mailto:julia.wrobel@emory.edu">julia.wrobel@emory.edu</a>
</p>
<p>Alex Soupir <a href="mailto:alex.soupir@moffitt.org">alex.soupir@moffitt.org</a>
</p>

<hr>
<h2 id='plot.lfcmSurface'>Plot lfcm surface</h2><span id='topic+plot.lfcmSurface'></span>

<h3>Description</h3>

<p>Plot lfcm surface
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'lfcmSurface'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.lfcmSurface_+3A_x">x</code></td>
<td>
<p>object of class <code>lfcmSurface</code> to be plotted</p>
</td></tr>
<tr><td><code id="plot.lfcmSurface_+3A_...">...</code></td>
<td>
<p>currently ignored</p>
</td></tr>
</table>


<h3>Value</h3>

<p>object compatable with ggplot2
</p>


<h3>Author(s)</h3>

<p>Julia Wrobel <a href="mailto:julia.wrobel@emory.edu">julia.wrobel@emory.edu</a>
</p>
<p>Alex Soupir <a href="mailto:alex.soupir@moffitt.org">alex.soupir@moffitt.org</a>
</p>

<hr>
<h2 id='plot.mxFDA'>Plot mxFDA object</h2><span id='topic+plot.mxFDA'></span>

<h3>Description</h3>

<p>Plot mxFDA object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mxFDA'
plot(x, filter_cols = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.mxFDA_+3A_x">x</code></td>
<td>
<p>object of class <code>mxFDA</code> to be plotted</p>
</td></tr>
<tr><td><code id="plot.mxFDA_+3A_filter_cols">filter_cols</code></td>
<td>
<p>column key to filter</p>
</td></tr>
<tr><td><code id="plot.mxFDA_+3A_...">...</code></td>
<td>
<p>additional paramters including <code>y</code>, <code>what</code>, and <code>sampleID</code> to inform whats to be plotted</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>
<p>If there are multiple metrics that are included in the derived table, an extra parameter <code>filter_cols</code>
in the format of <code>c(Derived_Column = "Level_to_Filter")</code> will return curves from the <code>Derived_Column</code>
with the level <code>Level_to_Filter</code>
</p>
<p>When plotting mFPCA objects, additional arguments <code>level1</code> and <code>level2</code> help indicate which FPCA from level 1 and level 2 to plot
</p>


<h3>Value</h3>

<p>object of class <code>ggplot</code> compatible the <code>ggplot2</code> aesthetics
</p>


<h3>Author(s)</h3>

<p>Alex Soupir <a href="mailto:alex.soupir@moffitt.org">alex.soupir@moffitt.org</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#set seed
set.seed(333)
#plotting summary
data("ovarian_FDA")
plot(ovarian_FDA, y = 'fundiff', what = 'uni g')
#running fpca
ovarian_FDA = run_fpca(ovarian_FDA, metric = "uni g", r = "r", value = "fundiff",
                       lightweight = TRUE,
                       pve = .99)
#plot fpca
plot(ovarian_FDA, what = 'uni g fpca', pc_choice = 1)

</code></pre>

<hr>
<h2 id='plot.sofr'>Plot sofr object</h2><span id='topic+plot.sofr'></span>

<h3>Description</h3>

<p>Plot sofr object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'sofr'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.sofr_+3A_x">x</code></td>
<td>
<p>object of class <code>sofr</code> to be plotted</p>
</td></tr>
<tr><td><code id="plot.sofr_+3A_...">...</code></td>
<td>
<p>currently ignored</p>
</td></tr>
</table>


<h3>Value</h3>

<p>object compatable with ggplot2
</p>


<h3>Author(s)</h3>

<p>Julia Wrobel <a href="mailto:julia.wrobel@emory.edu">julia.wrobel@emory.edu</a>
</p>
<p>Alex Soupir <a href="mailto:alex.soupir@moffitt.org">alex.soupir@moffitt.org</a>
</p>

<hr>
<h2 id='process_fcm'>process_fcm</h2><span id='topic+process_fcm'></span>

<h3>Description</h3>

<p>Internal function called by <code>run_fcm</code> that transforms long format functional data for use in a linear or additive functional Cox model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>process_fcm(
  mxfundata,
  id,
  r = "r",
  value = "fundiff",
  analysis_vars,
  quantile_transform = FALSE,
  multilevel = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="process_fcm_+3A_mxfundata">mxfundata</code></td>
<td>
<p>Dataframe of spatial summary functions from multiplex imaging data, in long format. Can be estimated using the function <code>extract_summary_functions</code> or provided separately.</p>
</td></tr>
<tr><td><code id="process_fcm_+3A_id">id</code></td>
<td>
<p>Character string, the name of the variable that identifies each unique subject.</p>
</td></tr>
<tr><td><code id="process_fcm_+3A_r">r</code></td>
<td>
<p>Character string, the name of the variable that identifies the function domain (usually a radius for spatial summary functions). Default is &quot;r&quot;.</p>
</td></tr>
<tr><td><code id="process_fcm_+3A_value">value</code></td>
<td>
<p>Character string, the name of the variable that identifies the spatial summary function values. Default is &quot;fundiff&quot;.</p>
</td></tr>
<tr><td><code id="process_fcm_+3A_analysis_vars">analysis_vars</code></td>
<td>
<p>Optional list of variables to be retained for downstream analysis.</p>
</td></tr>
<tr><td><code id="process_fcm_+3A_quantile_transform">quantile_transform</code></td>
<td>
<p>If TRUE, a quantile transformation is applied to the functional predictor before modeling</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>dataframe</code> with matrix-valued covariates <code>l_int</code>, <code>t_int</code>, and <code>func</code> for use in a linear or additive functional Cox model.
</p>


<h3>Author(s)</h3>

<p>Julia Wrobel <a href="mailto:julia.wrobel@emory.edu">julia.wrobel@emory.edu</a>
</p>
<p>Alex Soupir <a href="mailto:alex.soupir@moffitt.org">alex.soupir@moffitt.org</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># simulate data
set.seed(1001)

</code></pre>

<hr>
<h2 id='run_fcm'>Run Function Cox Models</h2><span id='topic+run_fcm'></span>

<h3>Description</h3>

<p>Fit a functional Cox regression model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>run_fcm(
  mxFDAobject,
  model_name,
  formula,
  event = "event",
  metric = "uni k",
  r = "r",
  value = "fundiff",
  afcm = FALSE,
  smooth = FALSE,
  filter_cols = NULL,
  ...,
  knots = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="run_fcm_+3A_mxfdaobject">mxFDAobject</code></td>
<td>
<p>Dataframe of spatial summary functions from multiplex imaging data, in long format. Can be estimated using the function <code>extract_summary_functions</code> or provided separately.</p>
</td></tr>
<tr><td><code id="run_fcm_+3A_model_name">model_name</code></td>
<td>
<p>character string to give the fit model in the functional cox slot</p>
</td></tr>
<tr><td><code id="run_fcm_+3A_formula">formula</code></td>
<td>
<p>Formula to be fed to mgcv in the form of survival_time ~ x1 + x2. Does not contain functional predictor. Character valued. Data must contain censoring variable called &quot;event&quot;.</p>
</td></tr>
<tr><td><code id="run_fcm_+3A_event">event</code></td>
<td>
<p>character string for the column in Metadata that contains 1/0 for the survival event</p>
</td></tr>
<tr><td><code id="run_fcm_+3A_metric">metric</code></td>
<td>
<p>name of calculated spatial metric to use</p>
</td></tr>
<tr><td><code id="run_fcm_+3A_r">r</code></td>
<td>
<p>Character string, the name of the variable that identifies the function domain (usually a radius for spatial summary functions). Default is &quot;r&quot;.</p>
</td></tr>
<tr><td><code id="run_fcm_+3A_value">value</code></td>
<td>
<p>Character string, the name of the variable that identifies the spatial summary function values. Default is &quot;fundiff&quot;.</p>
</td></tr>
<tr><td><code id="run_fcm_+3A_afcm">afcm</code></td>
<td>
<p>If TRUE, runs additive functional Cox model. If FALSE, runs linear functional cox model. Defaults to linear functional cox model.</p>
</td></tr>
<tr><td><code id="run_fcm_+3A_smooth">smooth</code></td>
<td>
<p>Option to smooth data using FPCA. Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="run_fcm_+3A_filter_cols">filter_cols</code></td>
<td>
<p>a named vector of factors to filter summary functions to in <code>c(Derived_Column = "Level_to_Filter")</code> format</p>
</td></tr>
<tr><td><code id="run_fcm_+3A_...">...</code></td>
<td>
<p>Optional other arguments to be passed to <code>fpca.face</code></p>
</td></tr>
<tr><td><code id="run_fcm_+3A_knots">knots</code></td>
<td>
<p>Number of knots for defining spline basis.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Value</h3>

<p>A <code>list</code> which is a linear or additive functional Cox model fit. See <code>mgcv::gam</code> for more details.
</p>


<h3>Author(s)</h3>

<p>Julia Wrobel <a href="mailto:julia.wrobel@emory.edu">julia.wrobel@emory.edu</a>
</p>
<p>Alex Soupir <a href="mailto:alex.soupir@moffitt.org">alex.soupir@moffitt.org</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#load ovarian mxFDA object
data('ovarian_FDA')

#run the lfcm model
ovarian_FDA = run_fcm(ovarian_FDA, model_name = "fit_lfcm",
                      formula = survival_time ~ age, event = "event",
                      metric = "uni g", r = "r", value = "fundiff",
                      afcm = FALSE)

</code></pre>

<hr>
<h2 id='run_fpca'>run_fpca</h2><span id='topic+run_fpca'></span>

<h3>Description</h3>

<p>This is a wrapper for the function <code>fpca.face</code> from the <code>refund</code> package. EXPAND
</p>


<h3>Usage</h3>

<pre><code class='language-R'>run_fpca(
  mxFDAobject,
  metric = "uni k",
  r = "r",
  value = "fundiff",
  knots = NULL,
  analysis_vars = NULL,
  lightweight = FALSE,
  filter_cols = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="run_fpca_+3A_mxfdaobject">mxFDAobject</code></td>
<td>
<p>object of class <code>mxFDA</code> created by <code>make_mxfda</code> with metrics derived with <code>extract_summary_functions</code></p>
</td></tr>
<tr><td><code id="run_fpca_+3A_metric">metric</code></td>
<td>
<p>name of calculated spatial metric to use</p>
</td></tr>
<tr><td><code id="run_fpca_+3A_r">r</code></td>
<td>
<p>Character string, the name of the variable that identifies the function domain (usually a radius for spatial summary functions). Default is &quot;r&quot;.</p>
</td></tr>
<tr><td><code id="run_fpca_+3A_value">value</code></td>
<td>
<p>Character string, the name of the variable that identifies the spatial summary function values. Default is &quot;fundiff&quot;.</p>
</td></tr>
<tr><td><code id="run_fpca_+3A_knots">knots</code></td>
<td>
<p>Number of knots for defining spline basis.Defaults to the number of measurements per function divided by 2.</p>
</td></tr>
<tr><td><code id="run_fpca_+3A_analysis_vars">analysis_vars</code></td>
<td>
<p>Optional list of variables to be retained for downstream analysis.</p>
</td></tr>
<tr><td><code id="run_fpca_+3A_lightweight">lightweight</code></td>
<td>
<p>Default is FALSE. If TRUE, removes Y and Yhat from returned FPCA object. A good option to select for large datasets.</p>
</td></tr>
<tr><td><code id="run_fpca_+3A_filter_cols">filter_cols</code></td>
<td>
<p>a named vector of factors to filter summary functions to in <code>c(Derived_Column = "Level_to_Filter")</code> format</p>
</td></tr>
<tr><td><code id="run_fpca_+3A_...">...</code></td>
<td>
<p>Optional other arguments to be passed to <code>fpca.face</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>
<p>The <code>filter_cols</code> parameter is useful when the summary function was input by the user using <code><a href="#topic+add_summary_function">add_summary_function()</a></code> and the multiple marks were assessed; a column called &quot;Markers&quot; with tumor infiltrating lymphocytes as well as cytotoxic T cells. This parameter allows for filtering down to include only one or the other.
</p>


<h3>Value</h3>

<p>A <code>mxFDA</code> object with the <code>functional_pca</code> slot filled for the respective spatial summary function containing:
</p>
<table>
<tr><td><code>mxfundata</code></td>
<td>
<p>The original dataframe of spatial summary functions, with scores from FPCA appended for downstream modeling</p>
</td></tr>
<tr><td><code>fpc_object</code></td>
<td>
<p>A list of class &quot;fpca&quot; with elements described in the documentation for  <code>refund::fpca.face</code></p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Julia Wrobel <a href="mailto:julia.wrobel@emory.edu">julia.wrobel@emory.edu</a>
</p>
<p>Alex Soupir <a href="mailto:alex.soupir@moffitt.org">alex.soupir@moffitt.org</a>
</p>


<h3>References</h3>

<p>Xiao, L., Ruppert, D., Zipunnikov, V., and Crainiceanu, C. (2016).
Fast covariance estimation for high-dimensional functional data.
<em>Statistics and Computing</em>, 26, 409-421.
DOI: 10.1007/s11222-014-9485-x.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#load ovarian mxFDA object
data('ovarian_FDA')

#run the FPCA
ovarian_FDA = run_fpca(ovarian_FDA, metric = "uni g", r = "r", value = "fundiff",
                       lightweight = TRUE,
                       pve = .99)

</code></pre>

<hr>
<h2 id='run_mfcm'>Run function Cox models for data with multiple samples per subject</h2><span id='topic+run_mfcm'></span>

<h3>Description</h3>

<p>Fit a functional Cox regression model when there are multiple functions per subject, which arise from multiple samples per subject.
It is not necessary for all subjects to have the same number of samples.The function first performs a multilevel functional principal components
analysis (MFPCA) decomposition to the spatial summary function. Then, the average curve for each subject is used in a functional Cox model (FCM).
Variation around each subject's mean is captured by calculating the standard deviation of the level 2 scores from MFPCA, then including this as
a scalar variable in the FCM called &quot;level2_score_sd&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>run_mfcm(
  mxFDAobject,
  model_name,
  formula,
  event = "event",
  metric = "uni k",
  r = "r",
  value = "fundiff",
  afcm = FALSE,
  filter_cols = NULL,
  pve = 0.99,
  ...,
  knots = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="run_mfcm_+3A_mxfdaobject">mxFDAobject</code></td>
<td>
<p>Dataframe of spatial summary functions from multiplex imaging data, in long format. Can be estimated using the function <code>extract_summary_functions</code> or provided separately.</p>
</td></tr>
<tr><td><code id="run_mfcm_+3A_model_name">model_name</code></td>
<td>
<p>character string to give the fit model in the functional cox slot</p>
</td></tr>
<tr><td><code id="run_mfcm_+3A_formula">formula</code></td>
<td>
<p>Formula to be fed to mgcv in the form of survival_time ~ x1 + x2. Does not contain functional predictor. Character valued. Data must contain censoring variable called &quot;event&quot;.</p>
</td></tr>
<tr><td><code id="run_mfcm_+3A_event">event</code></td>
<td>
<p>character string for the column in Metadata that contains 1/0 for the survival event</p>
</td></tr>
<tr><td><code id="run_mfcm_+3A_metric">metric</code></td>
<td>
<p>name of calculated spatial metric to use</p>
</td></tr>
<tr><td><code id="run_mfcm_+3A_r">r</code></td>
<td>
<p>Character string, the name of the variable that identifies the function domain (usually a radius for spatial summary functions). Default is &quot;r&quot;.</p>
</td></tr>
<tr><td><code id="run_mfcm_+3A_value">value</code></td>
<td>
<p>Character string, the name of the variable that identifies the spatial summary function values. Default is &quot;fundiff&quot;.</p>
</td></tr>
<tr><td><code id="run_mfcm_+3A_afcm">afcm</code></td>
<td>
<p>If TRUE, runs additive functional Cox model. If FALSE, runs linear functional cox model. Defaults to linear functional cox model.</p>
</td></tr>
<tr><td><code id="run_mfcm_+3A_filter_cols">filter_cols</code></td>
<td>
<p>a named vector of factors to filter summary functions to in <code>c(Derived_Column = "Level_to_Filter")</code> format</p>
</td></tr>
<tr><td><code id="run_mfcm_+3A_pve">pve</code></td>
<td>
<p>Proportion of variance explained by multilevel functional principal components analysis in mfpca step</p>
</td></tr>
<tr><td><code id="run_mfcm_+3A_...">...</code></td>
<td>
<p>Optional other arguments to be passed to <code>fpca.face</code></p>
</td></tr>
<tr><td><code id="run_mfcm_+3A_knots">knots</code></td>
<td>
<p>Number of knots for defining spline basis.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Value</h3>

<p>A <code>list</code> which is a linear or additive functional Cox model fit. See <code>mgcv::gam</code> for more details.
</p>


<h3>Author(s)</h3>

<p>Julia Wrobel <a href="mailto:julia.wrobel@emory.edu">julia.wrobel@emory.edu</a>
</p>
<p>Alex Soupir <a href="mailto:alex.soupir@moffitt.org">alex.soupir@moffitt.org</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#load ovarian mxFDA object
data('lung_FDA')

# run the lfcm model
lung_FDA = run_mfcm(lung_FDA, model_name = "fit_mlfcm",
                      formula = survival_days ~ age,
                      event = "survival_status",
                      metric = "uni g", r = "r", value = "fundiff",
                      pve = 0.99,
                      afcm = FALSE)
</code></pre>

<hr>
<h2 id='run_mfpca'>run_fpca</h2><span id='topic+run_mfpca'></span>

<h3>Description</h3>

<p>This is a wrapper for the function <code>mfpca.face</code> from the <code>refund</code> package. EXPAND
</p>


<h3>Usage</h3>

<pre><code class='language-R'>run_mfpca(
  mxFDAobject,
  metric = "uni k",
  r = "r",
  value = "fundiff",
  knots = NULL,
  lightweight = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="run_mfpca_+3A_mxfdaobject">mxFDAobject</code></td>
<td>
<p>object of class <code>mxFDA</code> created by <code><a href="#topic+make_mxfda">make_mxfda()</a></code> with metrics derived with <code><a href="#topic+extract_summary_functions">extract_summary_functions()</a></code></p>
</td></tr>
<tr><td><code id="run_mfpca_+3A_metric">metric</code></td>
<td>
<p>name of calculated spatial metric to use</p>
</td></tr>
<tr><td><code id="run_mfpca_+3A_r">r</code></td>
<td>
<p>Character string, the name of the variable that identifies the function domain (usually a radius for spatial summary functions). Default is &quot;r&quot;.</p>
</td></tr>
<tr><td><code id="run_mfpca_+3A_value">value</code></td>
<td>
<p>Character string, the name of the variable that identifies the spatial summary function values. Default is &quot;fundiff&quot;.</p>
</td></tr>
<tr><td><code id="run_mfpca_+3A_knots">knots</code></td>
<td>
<p>Number of knots for defining spline basis.Defaults to the number of measurements per function divided by 2.</p>
</td></tr>
<tr><td><code id="run_mfpca_+3A_lightweight">lightweight</code></td>
<td>
<p>Default is FALSE. If TRUE, removes Y and Yhat from returned mFPCA object. A good option to select for large datasets.</p>
</td></tr>
<tr><td><code id="run_mfpca_+3A_...">...</code></td>
<td>
<p>Optional other arguments to be passed to <code>mfpca.face</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Value</h3>

<p>A <code>mxFDA</code> object  with the <code>functional_mpca</code> slot for the respective spatial summary function containing:
</p>
<table>
<tr><td><code>mxfundata</code></td>
<td>
<p>The original dataframe of spatial summary functions, with scores from FPCA appended for downstream modeling</p>
</td></tr>
<tr><td><code>fpc_object</code></td>
<td>
<p>A list of class &quot;fpca&quot; with elements described in the documentation for  <code>refund::fpca.face</code></p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>unknown <a href="mailto:first.last@domain.extension">first.last@domain.extension</a>
</p>
<p>Julia Wrobel <a href="mailto:julia.wrobel@emory.edu">julia.wrobel@emory.edu</a>
</p>
<p>Alex Soupir <a href="mailto:alex.soupir@moffitt.org">alex.soupir@moffitt.org</a>
</p>


<h3>References</h3>

<p>Xiao, L., Ruppert, D., Zipunnikov, V., and Crainiceanu, C. (2016).
Fast covariance estimation for high-dimensional functional data.
<em>Statistics and Computing</em>, 26, 409-421.
DOI: 10.1007/s11222-014-9485-x.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#load data
data(lung_FDA)

#run mixed fpca
lung_FDA = run_mfpca(lung_FDA, metric = 'uni g')

</code></pre>

<hr>
<h2 id='run_sofr'>Run Scalar on Function Regression</h2><span id='topic+run_sofr'></span>

<h3>Description</h3>

<p>Fit a scalar-on-function regression model. Uses refund::pfr under the hood for computations, and stores results in the mxfda object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>run_sofr(
  mxFDAobject,
  model_name,
  formula,
  family = "gaussian",
  metric = "uni k",
  r = "r",
  value = "fundiff",
  smooth = FALSE,
  filter_cols = NULL,
  ...,
  knots = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="run_sofr_+3A_mxfdaobject">mxFDAobject</code></td>
<td>
<p>Dataframe of spatial summary functions from multiplex imaging data, in long format. Can be estimated using the function <code>extract_summary_functions</code> or provided separately.</p>
</td></tr>
<tr><td><code id="run_sofr_+3A_model_name">model_name</code></td>
<td>
<p>character string to give the fit model</p>
</td></tr>
<tr><td><code id="run_sofr_+3A_formula">formula</code></td>
<td>
<p>Formula to be fed to mgcv in the form of outcome ~ x1 + x2. Does not contain functional predictor. Character valued.</p>
</td></tr>
<tr><td><code id="run_sofr_+3A_family">family</code></td>
<td>
<p>Exponential family distribution to be passed to <code>mgcv::gam</code>. Defaults to &quot;gaussian&quot;. Select &quot;binomial&quot; for binary outcome.</p>
</td></tr>
<tr><td><code id="run_sofr_+3A_metric">metric</code></td>
<td>
<p>Name of calculated spatial metric to use</p>
</td></tr>
<tr><td><code id="run_sofr_+3A_r">r</code></td>
<td>
<p>Character string, the name of the variable that identifies the function domain (usually a radius for spatial summary functions). Default is &quot;r&quot;.</p>
</td></tr>
<tr><td><code id="run_sofr_+3A_value">value</code></td>
<td>
<p>Character string, the name of the variable that identifies the spatial summary function values. Default is &quot;fundiff&quot;.</p>
</td></tr>
<tr><td><code id="run_sofr_+3A_smooth">smooth</code></td>
<td>
<p>Option to smooth data using FPCA. Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="run_sofr_+3A_filter_cols">filter_cols</code></td>
<td>
<p>a named vector of factors to filter summary functions to in <code>c(Derived_Column = "Level_to_Filter")</code> format</p>
</td></tr>
<tr><td><code id="run_sofr_+3A_...">...</code></td>
<td>
<p>Optional other arguments to be passed to <code>fpca.face</code></p>
</td></tr>
<tr><td><code id="run_sofr_+3A_knots">knots</code></td>
<td>
<p>Number of knots for defining spline basis.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Value</h3>

<p>A <code>list</code> which is a linear or additive functional Cox model fit. See <code>mgcv::gam</code> for more details.
</p>


<h3>Author(s)</h3>

<p>Julia Wrobel <a href="mailto:julia.wrobel@emory.edu">julia.wrobel@emory.edu</a>
</p>
<p>Alex Soupir <a href="mailto:alex.soupir@moffitt.org">alex.soupir@moffitt.org</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#load ovarian mxFDA object
data('ovarian_FDA')

# run scalar on function regression model with a continuous outcome (age)
ovarian_FDA = run_sofr(ovarian_FDA,
                       model_name = "fit_sofr",
                       formula = age~stage,
                       metric = "uni g", r = "r", value = "fundiff")

# run scalar on function regression model with a binary outcome (stage)
# also known as functional logistic regression
ovarian_FDA = run_sofr(ovarian_FDA,
                       model_name = "fit_sofr",
                       formula = stage~age,
                       family = "binomial",
                       metric = "uni g", r = "r", value = "fundiff")

</code></pre>

<hr>
<h2 id='spatialTIME_summary_functions'><code>spatialTIME</code> summary function extraction</h2><span id='topic+spatialTIME_summary_functions'></span>

<h3>Description</h3>

<p><code>spatialTIME</code> summary function extraction
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spatialTIME_summary_functions(
  mxFDAobject,
  metric = "uni k",
  markers = NULL,
  r_range = 0:100,
  num_permutations = 50,
  edge_correction = "trans",
  permute = TRUE,
  workers = 1,
  xloc = "x",
  yloc = "y"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="spatialTIME_summary_functions_+3A_mxfdaobject">mxFDAobject</code></td>
<td>
<p>object of class <code>mxFDA</code> for which to calculate summary functions</p>
</td></tr>
<tr><td><code id="spatialTIME_summary_functions_+3A_metric">metric</code></td>
<td>
<p>string vector with combination of uni/bi k/g</p>
</td></tr>
<tr><td><code id="spatialTIME_summary_functions_+3A_markers">markers</code></td>
<td>
<p>column names of spatial</p>
</td></tr>
<tr><td><code id="spatialTIME_summary_functions_+3A_r_range">r_range</code></td>
<td>
<p>vector of radii to calculate metrics</p>
</td></tr>
<tr><td><code id="spatialTIME_summary_functions_+3A_num_permutations">num_permutations</code></td>
<td>
<p>integer for the number of permutations to perform</p>
</td></tr>
<tr><td><code id="spatialTIME_summary_functions_+3A_edge_correction">edge_correction</code></td>
<td>
<p>character vector of length 1 or 2 depending on the metrics for edge corrections to perform</p>
</td></tr>
<tr><td><code id="spatialTIME_summary_functions_+3A_permute">permute</code></td>
<td>
<p>logical whether to permute CSR or not. Required <code>TRUE</code> for Nearest Neighbor G</p>
</td></tr>
<tr><td><code id="spatialTIME_summary_functions_+3A_workers">workers</code></td>
<td>
<p>integer for number of cores to use to calculate derived variables</p>
</td></tr>
<tr><td><code id="spatialTIME_summary_functions_+3A_xloc">xloc</code>, <code id="spatialTIME_summary_functions_+3A_yloc">yloc</code></td>
<td>
<p>columns in the spatial data which to use for point locations</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>


<h3>Value</h3>

<p><code>mxFDA</code> object with the summary function slots filled according to input metric
</p>


<h3>Author(s)</h3>

<p>Alex Soupir <a href="mailto:alex.soupir@moffitt.org">alex.soupir@moffitt.org</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># example code

</code></pre>

<hr>
<h2 id='summary.mxFDA'>Summary method for object of class <code>mxFDA</code></h2><span id='topic+summary.mxFDA'></span>

<h3>Description</h3>

<p>Summary method for object of class <code>mxFDA</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mxFDA'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.mxFDA_+3A_object">object</code></td>
<td>
<p>object of class <code>mxFDA</code></p>
</td></tr>
<tr><td><code id="summary.mxFDA_+3A_...">...</code></td>
<td>
<p>unused currently</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Value</h3>

<p>summary of object to the R console
</p>


<h3>Author(s)</h3>

<p>Alex Soupir <a href="mailto:alex.soupir@moffitt.org">alex.soupir@moffitt.org</a>
</p>

<hr>
<h2 id='univariate'>univariate</h2><span id='topic+univariate'></span>

<h3>Description</h3>

<p>Internal function called by <code><a href="#topic+extract_summary_functions">extract_summary_functions()</a></code> to calculate a univariate spatial summary function for a single image.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>univariate(
  mximg,
  markvar,
  mark1,
  mark2,
  r_vec,
  func = c(Kest, Lest, Gest),
  edge_correction,
  breaks = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="univariate_+3A_mximg">mximg</code></td>
<td>
<p>Dataframe of cell-level multiplex imaging data for a single image.
Should have variables <code>x</code> and <code>y</code> to denote x and y spatial locations of each cell.</p>
</td></tr>
<tr><td><code id="univariate_+3A_markvar">markvar</code></td>
<td>
<p>The name of the variable that denotes cell type(s) of interest. Character.</p>
</td></tr>
<tr><td><code id="univariate_+3A_mark1">mark1</code></td>
<td>
<p>dummy filler, unused</p>
</td></tr>
<tr><td><code id="univariate_+3A_mark2">mark2</code></td>
<td>
<p>dummy filler, unused</p>
</td></tr>
<tr><td><code id="univariate_+3A_r_vec">r_vec</code></td>
<td>
<p>Numeric vector of radii over which to evaluate spatial summary functions. Must begin at 0.</p>
</td></tr>
<tr><td><code id="univariate_+3A_func">func</code></td>
<td>
<p>Spatial summary function to calculate. Options are c(Kest, Lest, Gest) which denote Ripley's K, Besag's L, and nearest neighbor G function, respectively.</p>
</td></tr>
<tr><td><code id="univariate_+3A_edge_correction">edge_correction</code></td>
<td>
<p>Character string that denotes the edge correction method for spatial summary function. For Kest and Lest choose one of c(&quot;border&quot;, &quot;isotropic&quot;, &quot;Ripley&quot;, &quot;translate&quot;, &quot;none&quot;). For Gest choose one of c(&quot;rs&quot;, &quot;km&quot;, &quot;han&quot;)</p>
</td></tr>
<tr><td><code id="univariate_+3A_breaks">breaks</code></td>
<td>
<p>ignored</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Value</h3>

<p>A <code>data.frame</code> containing:
</p>
<table>
<tr><td><code>r</code></td>
<td>
<p>the radius of values over which the spatial summary function is evaluated</p>
</td></tr>
<tr><td><code>sumfun</code></td>
<td>
<p>the values of the spatial summary function</p>
</td></tr>
<tr><td><code>csr</code></td>
<td>
<p>the values of the spatial summary function under complete spatial randomness</p>
</td></tr>
<tr><td><code>fundiff</code></td>
<td>
<p>sumfun - csr, positive values indicate clustering and negative values repulsion</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Julia Wrobel <a href="mailto:julia.wrobel@emory.edu">julia.wrobel@emory.edu</a>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
