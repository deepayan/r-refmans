<!DOCTYPE html><html><head><title>Help for package sphet</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {sphet}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#sphet-package'><p>Estimation of spatial models with heteroskedastic innovations</p></a></li>
<li><a href='#circular'><p>Generate circular weigthing matrices</p></a></li>
<li><a href='#coldis'><p>Object of class distance for Columbus dataset</p>
10-nearest neighbors matrix for columbus dataset</a></li>
<li><a href='#distance'><p>Distance measures available in distance</p></a></li>
<li><a href='#gstslshet'><p>GM estimation of a Cliff-Ord type model with Heteroskedastic Innovations</p></a></li>
<li><a href='#impacts'><p>Generate impacts for spreg lag and sarar models</p></a></li>
<li><a href='#impacts.error_sphet'><p>Generate impacts for objects of class error_sphet created in sphet</p></a></li>
<li><a href='#impacts.gstsls'><p>Generate impacts for objects of class sarar_gmm created in sphet</p></a></li>
<li><a href='#impacts.ols_sphet'><p>Generate impacts for objects of class ols_sphet created in sphet</p></a></li>
<li><a href='#impacts.stsls_sphet'><p>Generate impacts for objects of class lag_gmm created in sphet</p></a></li>
<li><a href='#kpjtest'><p>Kelejian and Piras J-test</p></a></li>
<li><a href='#listw2dgCMatrix'><p>Interface between Matrix class objects and weights list</p></a></li>
<li><a href='#print.sphet'><p>print method for class sphet</p></a></li>
<li><a href='#print.summary.sphet'><p>print method for class sphet</p></a></li>
<li><a href='#read.gwt2dist'><p>Read distance ojbects</p></a></li>
<li><a href='#spreg'><p>GM estimation of a Cliff-Ord type model with Heteroskedastic Innovations</p></a></li>
<li><a href='#stslshac'><p>Spatial two stages least square with HAC standard errors</p></a></li>
<li><a href='#summary.sphet'><p>print method for class sphet</p></a></li>
<li><a href='#utilities'><p>Functions used by gstslshet.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Version:</td>
<td>2.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-01-05</td>
</tr>
<tr>
<td>Title:</td>
<td>Estimation of Spatial Autoregressive Models with and without
Heteroskedastic Innovations</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.0.1)</td>
</tr>
<tr>
<td>Imports:</td>
<td>nlme, spatialreg, spdep, Matrix, sp, methods, stats, utils,
mvtnorm, stringr, coda, spData, sf</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/gpiras/sphet">https://github.com/gpiras/sphet</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/gpiras/sphet/issues">https://github.com/gpiras/sphet/issues</a></td>
</tr>
<tr>
<td>Description:</td>
<td>Functions for fitting Cliff-Ord-type spatial autoregressive models with and without heteroskedastic innovations using Generalized Method of Moments estimation are provided. Some support is available for fitting spatial HAC models, and for fitting with non-spatial endogeneous variables using instrumental variables.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>LazyData:</td>
<td>no</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.0</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-01-05 18:02:33 UTC; gpiras</td>
</tr>
<tr>
<td>Author:</td>
<td>Gianfranco Piras <a href="https://orcid.org/0000-0003-0225-6061"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Roger Bivand <a href="https://orcid.org/0000-0003-2392-6140"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Gianfranco Piras &lt;gpiras@mac.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-01-06 00:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='sphet-package'>Estimation of spatial models with heteroskedastic innovations</h2><span id='topic+sphet-package'></span><span id='topic+sphet'></span>

<h3>Description</h3>

<p>A set of functions to estimate spatial models with heteroskedastic innovations
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> sphet</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.12</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2021-06-17</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL</td>
</tr>
<tr>
 <td style="text-align: left;">
LazyLoad: </td><td style="text-align: left;"> yes</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p> Gianfranco Piras <a href="mailto:gpiras@mac.com">gpiras@mac.com</a></p>


<h3>References</h3>

<p>Piras, Gianfranco (2010) 
sphet: Spatial Models with Heteroskedastic Innovations in R,
<em>Journal of Statistical Software</em> June 2010, Volume 35, Issue 1. 
</p>
<p>Bivand, R; Millo, G; Piras, G. (2021)
A Review of Software for Spatial Econometrics in R
<em>Mathematics</em> 9 (11):1276.
</p>
<p>Bivand, R; Piras, G. (2015)
Comparing Implementations of Estimation Methods for Spatial Econometrics,
<em>Journal of Statistical Software</em>, Volume 63, Issue 18, 1&ndash;36.
</p>

<hr>
<h2 id='circular'>Generate circular weigthing matrices</h2><span id='topic+circular'></span>

<h3>Description</h3>

<p>The function generates k-ahead and k-behind weighting matrices as in Kelejian and Prucha (1999)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>circular(nrow, ncol, ab)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="circular_+3A_nrow">nrow</code></td>
<td>
<p>Number of rows</p>
</td></tr>
<tr><td><code id="circular_+3A_ncol">ncol</code></td>
<td>
<p>Number of columns</p>
</td></tr>
<tr><td><code id="circular_+3A_ab">ab</code></td>
<td>
<p>Ahead - behind</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Generate circular weigthing matrices
</p>


<h3>Value</h3>

<p>An object of class <code>nb</code>
</p>


<h3>Author(s)</h3>

<p>Gianfranco Piras <a href="mailto:gpiras@mac.com">gpiras@mac.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ab.3 &lt;- circular(10, 10, 3)
ab.5 &lt;-  circular(15, 15, 5)
</code></pre>

<hr>
<h2 id='coldis'>Object of class distance for Columbus dataset 
10-nearest neighbors matrix for columbus dataset</h2><span id='topic+coldis'></span><span id='topic+knn10columbus'></span>

<h3>Description</h3>

<p>Object of class distance for Columbus dataset 
10-nearest neighbors matrix for columbus dataset
</p>


<h3>Format</h3>

<p>A list of neighbors and distances for the columbus neighborhoods
</p>


<h3>Author(s)</h3>

<p>Gianfranco Piras <a href="mailto:gpiras@mac.com">gpiras@mac.com</a>
</p>

<hr>
<h2 id='distance'>Distance measures available in distance</h2><span id='topic+distance'></span>

<h3>Description</h3>

<p>Reads points coordinates and generates objects of class <code>distance.matrix</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>distance(coord, region.id = NULL, output = TRUE,
type = c("NN", "distance", "inverse"),
measure = c("euclidean", "gcircle", "chebyshev", "braycur", "canberra"),
nn = 6, cutoff = FALSE, miles = TRUE, R = NULL, shape.name = NULL, region.id.name = NULL,
firstline = FALSE, file.name = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="distance_+3A_coord">coord</code></td>
<td>
<p>a matrix with the (X,Y)-coordinates of the points. The first column can be the 
region.id variable giving the ordering of the observations</p>
</td></tr>
<tr><td><code id="distance_+3A_region.id">region.id</code></td>
<td>
<p>variable that defines the ordering of the observations</p>
</td></tr>
<tr><td><code id="distance_+3A_output">output</code></td>
<td>
<p>when TRUE (default) writes the object to a file</p>
</td></tr>
<tr><td><code id="distance_+3A_type">type</code></td>
<td>
<p>one of <code>("NN","distance","inverse")</code>. Nearest neighbors, distance or inverse distance</p>
</td></tr>
<tr><td><code id="distance_+3A_measure">measure</code></td>
<td>
<p>one of <code>("euclidean","gcircle","chebyshev","braycur","canberra")</code>.The distance measure to be employed in the calculations
(See Details)</p>
</td></tr>
<tr><td><code id="distance_+3A_nn">nn</code></td>
<td>
<p>the number of nearest neighbors</p>
</td></tr>
<tr><td><code id="distance_+3A_cutoff">cutoff</code></td>
<td>
<p>If type is <code>distance</code> or <code>inverse</code>. Assumes values 1, 2 or 3. 
When 1, the cutoff is set to the first quantile of the distribution of distances. When 2 to the median, and when 3 to 
the third quantile. Only observations with distance less than cutoff distance are neighbors.</p>
</td></tr>
<tr><td><code id="distance_+3A_miles">miles</code></td>
<td>
<p>If TRUE (default), distances are in miles, otherwise in Km. (See <code><a href="sp.html#topic+spDists">spDists</a></code> wcich returns km, and are converted if required)</p>
</td></tr>
<tr><td><code id="distance_+3A_r">R</code></td>
<td>
<p>deprecated, <code><a href="sp.html#topic+spDists">spDists</a></code> uses an approximation to the WGS84 spheroid</p>
</td></tr>
<tr><td><code id="distance_+3A_shape.name">shape.name</code></td>
<td>
<p>The name of the shape file. See Details</p>
</td></tr>
<tr><td><code id="distance_+3A_region.id.name">region.id.name</code></td>
<td>
<p>The name of the <code>region.id</code> variable. See Details</p>
</td></tr>
<tr><td><code id="distance_+3A_firstline">firstline</code></td>
<td>
<p>If <code>TRUE</code>, a first line is added to the output file. See Details</p>
</td></tr>
<tr><td><code id="distance_+3A_file.name">file.name</code></td>
<td>
<p>If <code>output</code>, the name of the output file. See Details</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Writes distance matrices
</p>
<p>The object created is similar to the content of a <code>'GWT'</code> file. The output file can be of any format. 
In particular, it could be a <code>'GWT'</code> file. When <code>firstline</code> is <code>TRUE</code>, an header line is added to the <code>'GWT'</code> file. 
The first element is simply a place holder, the second is the number of observations. The name of the shape file 
and of the id variable can be specified by the options <code>shape.name</code> and <code>region.id.name</code> respectively. 
The function performs a series of test on the <code>region.id</code> variable. If a <code>region.id</code> variable is not specified and 
<code>coord</code> only has two columns, a sequence from 1 to the number of observations is generated and 
used as identification variable. If <code>region.id</code> is specified 
and the first column of <code>coord</code> contains an id variable they should be the same. 
</p>
<p>The distance measures implemented in <code>sphet</code> are:
</p>

<ul>
<li> <p><code>'euclidean'</code>: <code class="reqn">\sqrt{\sum{(x_i - y_i)^2}}</code>
</p>
</li>
<li> <p><code>'chebyshev'</code>: <code class="reqn">max(|x_i - y_i|)</code> 
</p>
</li>
<li> <p><code>'braycur'</code>: <code class="reqn"> \frac{\sum{|x_i - y_i|}}{\sum{|x_i + y_i|}}</code>
</p>
</li>
<li> <p><code>'canberra'</code>:  <code class="reqn">  \frac{\sum{|x_i - y_i|}}{\sum{|x_i| + |y_i|}} </code>
</p>
</li>
<li> <p><code>'gcircle'</code>: see <code><a href="sp.html#topic+spDists">spDists</a></code>, which uses an approximation to the WGS84 spheroid. 
</p>
</li></ul>



<h3>Value</h3>

<p>A <code>matrix</code> of three columns: <code>from</code>, <code>to</code>, and <code>distance</code>
</p>


<h3>Author(s)</h3>

<p>Gianfranco Piras <a href="mailto:gpiras@mac.com">gpiras@mac.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'> 
set.seed("1234")
X &lt;- runif(100, 0, 70)
Y &lt;- runif(100, -30, 20)
coord1 &lt;- cbind(seq(1,100), X, Y)
thm2 &lt;- distance(coord1, region.id = NULL, 
output = FALSE, type = "NN", nn = 6)
thm2 &lt;- distance(coord1, region.id = NULL, output = FALSE, type = "distance", cutoff = 1)

</code></pre>

<hr>
<h2 id='gstslshet'>GM estimation of a Cliff-Ord type model with Heteroskedastic Innovations</h2><span id='topic+gstslshet'></span>

<h3>Description</h3>

<p>Multi step GM/IV estimation of a linear Cliff and Ord -type of model
of the form:
</p>
<p style="text-align: center;"><code class="reqn">y=\lambda W y + X \beta + u  </code>
</p>

<p style="text-align: center;"><code class="reqn">u=\rho W u + e</code>
</p>
<p>  with </p>
<p style="text-align: center;"><code class="reqn">e ~ N(0,\sigma^2_i) </code>
</p>

<p>The model allows for spatial lag in the dependent variable
and disturbances. The innovations in the disturbance process are assumed 
heteroskedastic of an unknown form.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gstslshet(formula, data = list(), listw, na.action = na.fail, 
           zero.policy = NULL, initial.value = 0.2, abs.tol = 1e-20, 
           rel.tol = 1e-10, eps = 1e-5, inverse = T, sarar = T)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gstslshet_+3A_formula">formula</code></td>
<td>
<p>a description of the model to be fit</p>
</td></tr>
<tr><td><code id="gstslshet_+3A_data">data</code></td>
<td>
<p>an object of class <a href="base.html#topic+data.frame">data.frame</a>. An optional data frame containing the variables
in the model.</p>
</td></tr>
<tr><td><code id="gstslshet_+3A_listw">listw</code></td>
<td>
<p>an object of class <code>listw</code> created for example by <code>nb2listw</code></p>
</td></tr>
<tr><td><code id="gstslshet_+3A_na.action">na.action</code></td>
<td>
<p>a function which indicates what should happen when the data contains missing values.
See <a href="stats.html#topic+lm">lm</a> for details.</p>
</td></tr>
<tr><td><code id="gstslshet_+3A_zero.policy">zero.policy</code></td>
<td>
<p>See <code>lagsarlm</code> for details</p>
</td></tr>
<tr><td><code id="gstslshet_+3A_initial.value">initial.value</code></td>
<td>
<p>The initial value for <code class="reqn">\rho</code>. It can be either numeric (default is 0.2) or
set to <code>'SAR'</code>, in which case the optimization will start from the estimated coefficient of a regression of the 2SLS 
residuals over their spatial lag (i.e. a spatial AR model)</p>
</td></tr>
<tr><td><code id="gstslshet_+3A_abs.tol">abs.tol</code></td>
<td>
<p>Absolute tolerance. See <a href="stats.html#topic+nlminb">nlminb</a> for details.</p>
</td></tr>
<tr><td><code id="gstslshet_+3A_rel.tol">rel.tol</code></td>
<td>
<p>Relative tolerance. See <a href="stats.html#topic+nlminb">nlminb</a> for details.</p>
</td></tr>
<tr><td><code id="gstslshet_+3A_eps">eps</code></td>
<td>
<p>Tolerance level for the approximation. See Details.</p>
</td></tr>
<tr><td><code id="gstslshet_+3A_inverse">inverse</code></td>
<td>
<p><code>TRUE</code>. If <code>FALSE</code>, an appoximated inverse is calculated. See Details.</p>
</td></tr>
<tr><td><code id="gstslshet_+3A_sarar">sarar</code></td>
<td>
<p><code>TRUE</code>. If <code>FALSE</code>, a spatial error model is estimated.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The procedure consists of two steps alternating GM and IV estimators. Each step consists of sub-steps.
In step one <code class="reqn">\delta = [\beta',\lambda]'</code> is estimated by 2SLS. The 2SLS residuals are first employed
to obtain an initial (consistent but not efficient) GM estimator of <code class="reqn">\rho</code> and then a consistent and efficient 
estimator (involving the variance-covariance matrix of the limiting distribution of the normalized sample moments). 
In step two, the spatial Cochrane-Orcutt transformed model is estimated by 2SLS. This corresponds to a GS2SLS procedure. 
The GS2SLS residuals are used to obtain a consistent and efficient GM estimator for <code class="reqn">\rho</code>. 
</p>
<p>The initial value for the optimization in step 1b is taken to be <code>initial.value</code>. The initial value in step 1c is the 
optimal parameter of step 1b. Finally, the initial value for the optimization of step 2b is the optimal parameter of step 1c.
</p>
<p>Internally, the object of class <code>listw</code> is transformed into a <a href="Matrix.html#topic+Matrix">Matrix</a> 
using the function <a href="#topic+listw2dgCMatrix">listw2dgCMatrix</a>.
</p>
<p>The expression of the estimated variance covariance matrix of the limiting 
distribution of the normalized sample moments based on 2SLS residuals 
involves the inversion of <code class="reqn">I-\rho W'</code>.
When <code>inverse</code> is <code>FALSE</code>, the inverse is calculated using the approximation 
<code class="reqn">I +\rho W' + \rho^2 W'^2 + ...+ \rho^n W'^n</code>. 
The powers considered depend on a condition. 
The  function will keep adding terms until the absolute value of the <code>sum</code> of all elements 
of the matrix <code class="reqn">\rho^i W^i</code> is greater than a fixed <code class="reqn">\epsilon</code> (<code>eps</code>). By default <code>eps</code>
is set to 1e-5.
</p>


<h3>Value</h3>

<p>A list object of class <code>sphet</code>
</p>
<table>
<tr><td><code>coefficients</code></td>
<td>
<p>Generalized Spatial two stage least squares coefficient estimates of <code class="reqn">\delta</code> and GM estimator for <code class="reqn">\rho</code>. </p>
</td></tr>
<tr><td><code>var</code></td>
<td>
<p>variance-covariance matrix of the estimated coefficients</p>
</td></tr>
<tr><td><code>s2</code></td>
<td>
<p>GS2SLS residuals variance</p>
</td></tr>
<tr><td><code>residuals</code></td>
<td>
<p>GS2SLS residuals</p>
</td></tr>
<tr><td><code>yhat</code></td>
<td>
<p>difference between GS2SLS residuals and response variable</p>
</td></tr>
<tr><td><code>call</code></td>
<td>
<p>the call used to create this object</p>
</td></tr>
<tr><td><code>model</code></td>
<td>
<p>the model matrix of data</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p><code>'gs2slshac'</code></p>
</td></tr>
<tr><td><code>W</code></td>
<td>
<p>Wald test for both <code class="reqn">\rho</code> and <code class="reqn">\lambda</code> are zero</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Gianfranco Piras <a href="mailto:gpiras@mac.com">gpiras@mac.com</a>
</p>


<h3>References</h3>

<p>Arraiz, I. and Drukker, M.D. and Kelejian, H.H. and Prucha, I.R. (2007) 
A spatial Cliff-Ord-type Model with Heteroskedastic Innovations: Small and Large Sample Results,
<em>Department of Economics, University of Maryland</em>'
</p>
<p>Kelejian, H.H. and Prucha, I.R. (2007) 
Specification and Estimation of Spatial Autoregressive Models with Autoregressive and Heteroskedastic Disturbances,
<em>Journal of Econometrics</em>, forthcoming.
</p>
<p>Kelejian, H.H. and Prucha, I.R. (1999) 
A Generalized Moments Estimator for the Autoregressive Parameter in a Spatial Model,
<em>International Economic Review</em>, <b>40</b>, pages 509&ndash;533.
</p>
<p>Kelejian, H.H. and Prucha, I.R. (1998) 
A Generalized Spatial Two Stage Least Square Procedure for Estimating a Spatial Autoregressive
Model with Autoregressive Disturbances,
<em>Journal of Real Estate Finance and Economics</em>, <b>17</b>, pages 99&ndash;121.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+stslshac">stslshac</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(columbus, package = "spdep")
listw &lt;- spdep::nb2listw(col.gal.nb)
res &lt;- gstslshet(CRIME ~ HOVAL + INC, data = columbus, listw = listw)
summary(res)

</code></pre>

<hr>
<h2 id='impacts'>Generate impacts for spreg lag and sarar models</h2><span id='topic+impacts'></span>

<h3>Description</h3>

<p>Generate impacts for spreg lag and sarar models
</p>


<h3>Usage</h3>

<pre><code class='language-R'>impacts(obj, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="impacts_+3A_obj">obj</code></td>
<td>
<p>An object of class sphet</p>
</td></tr>
<tr><td><code id="impacts_+3A_...">...</code></td>
<td>
<p>Additional arguments to be passed</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Estimate of the Average Total, Average Direct, and Average Indirect Effects
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(columbus, package="spdep")
listw &lt;- spdep::nb2listw(col.gal.nb)
res &lt;- spreg(CRIME~HOVAL + INC, data=columbus , listw= listw,
            het = TRUE, verbose = FALSE, model = "sarar")
summary(res)
effects &lt;- impacts(res, listw = listw, R = 399)
summary(effects)
</code></pre>

<hr>
<h2 id='impacts.error_sphet'>Generate impacts for objects of class error_sphet created in sphet</h2><span id='topic+impacts.error_sphet'></span>

<h3>Description</h3>

<p>Generate impacts for objects of class error_sphet created in sphet
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'error_sphet'
impacts(
  obj,
  ...,
  tr = NULL,
  R = NULL,
  listw = NULL,
  evalues = NULL,
  tol = 1e-06,
  empirical = FALSE,
  Q = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="impacts.error_sphet_+3A_obj">obj</code></td>
<td>
<p>A spreg spatial regression object created by <code>spreg</code> with model =&quot;lag&quot;</p>
</td></tr>
<tr><td><code id="impacts.error_sphet_+3A_...">...</code></td>
<td>
<p>Arguments passed through to methods in the <span class="pkg">coda</span> package</p>
</td></tr>
<tr><td><code id="impacts.error_sphet_+3A_tr">tr</code></td>
<td>
<p>A vector of traces of powers of the spatial weights matrix created using <code>trW</code>, for approximate impact measures; if not given, <code>listw</code> must be given for exact measures (for small to moderate spatial weights matrices); the traces must be for the same spatial weights as were used in fitting the spatial regression</p>
</td></tr>
<tr><td><code id="impacts.error_sphet_+3A_r">R</code></td>
<td>
<p>If given, simulations are used to compute distributions for the impact measures, returned as <code>mcmc</code> objects</p>
</td></tr>
<tr><td><code id="impacts.error_sphet_+3A_listw">listw</code></td>
<td>
<p>a listw object</p>
</td></tr>
<tr><td><code id="impacts.error_sphet_+3A_evalues">evalues</code></td>
<td>
<p>vector of eigenvalues of spatial weights matrix for impacts calculations</p>
</td></tr>
<tr><td><code id="impacts.error_sphet_+3A_tol">tol</code></td>
<td>
<p>Argument passed to <code>mvrnorm</code>: tolerance (relative to largest variance) for numerical lack of positive-definiteness in the coefficient covariance matrix</p>
</td></tr>
<tr><td><code id="impacts.error_sphet_+3A_empirical">empirical</code></td>
<td>
<p>Argument passed to <code>mvrnorm</code> (default FALSE): if true, the coefficients and their covariance matrix specify the empirical not population mean and covariance matrix</p>
</td></tr>
<tr><td><code id="impacts.error_sphet_+3A_q">Q</code></td>
<td>
<p>default NULL, else an integer number of cumulative power series impacts to calculate if <code>tr</code> is given</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Estimate of the Average Total, Average Direct, and Average Indirect Effects
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(sphet)
require("sf", quietly=TRUE)
columbus &lt;- st_read(system.file("shapes/columbus.shp", package="spData")[1], quiet=TRUE)
col.gal.nb &lt;- spdep::read.gal(system.file("weights/columbus.gal", package="spData")[1])
listw &lt;- spdep::nb2listw(col.gal.nb)
error1 &lt;- spreg(CRIME ~ INC + HOVAL, columbus, listw, Durbin=TRUE,
                model = "error")
summary(error1)
impacts(error1)
summary(impacts(error1))
error2 &lt;- spreg(CRIME ~ INC + HOVAL, columbus, listw, Durbin= ~ INC,
                model = "error")
impacts(error2)
error3 &lt;- spreg(CRIME ~ HOVAL, columbus, listw, Durbin= ~ INC,
                model = "error")
summary(impacts(error3))

</code></pre>

<hr>
<h2 id='impacts.gstsls'>Generate impacts for objects of class sarar_gmm created in sphet</h2><span id='topic+impacts.gstsls'></span>

<h3>Description</h3>

<p>Generate impacts for objects of class sarar_gmm created in sphet
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'gstsls'
impacts(
  obj,
  ...,
  tr = NULL,
  R = NULL,
  listw = NULL,
  evalues = NULL,
  tol = 1e-06,
  empirical = FALSE,
  Q = NULL,
  KPformula = FALSE,
  prt = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="impacts.gstsls_+3A_obj">obj</code></td>
<td>
<p>A spreg spatial regression object created by <code>spreg</code> with model =&quot;sarar&quot;</p>
</td></tr>
<tr><td><code id="impacts.gstsls_+3A_...">...</code></td>
<td>
<p>Arguments passed through to methods in the <span class="pkg">coda</span> package</p>
</td></tr>
<tr><td><code id="impacts.gstsls_+3A_tr">tr</code></td>
<td>
<p>A vector of traces of powers of the spatial weights matrix created using <code>trW</code>, for approximate impact measures; if not given, <code>listw</code> must be given for exact measures (for small to moderate spatial weights matrices); the traces must be for the same spatial weights as were used in fitting the spatial regression</p>
</td></tr>
<tr><td><code id="impacts.gstsls_+3A_r">R</code></td>
<td>
<p>If given, simulations are used to compute distributions for the impact measures, returned as <code>mcmc</code> objects</p>
</td></tr>
<tr><td><code id="impacts.gstsls_+3A_listw">listw</code></td>
<td>
<p>a listw object</p>
</td></tr>
<tr><td><code id="impacts.gstsls_+3A_evalues">evalues</code></td>
<td>
<p>vector of eigenvalues of spatial weights matrix for impacts calculations</p>
</td></tr>
<tr><td><code id="impacts.gstsls_+3A_tol">tol</code></td>
<td>
<p>Argument passed to <code>mvrnorm</code>: tolerance (relative to largest variance) for numerical lack of positive-definiteness in the coefficient covariance matrix</p>
</td></tr>
<tr><td><code id="impacts.gstsls_+3A_empirical">empirical</code></td>
<td>
<p>Argument passed to <code>mvrnorm</code> (default FALSE): if true, the coefficients and their covariance matrix specify the empirical not population mean and covariance matrix</p>
</td></tr>
<tr><td><code id="impacts.gstsls_+3A_q">Q</code></td>
<td>
<p>default NULL, else an integer number of cumulative power series impacts to calculate if <code>tr</code> is given</p>
</td></tr>
<tr><td><code id="impacts.gstsls_+3A_kpformula">KPformula</code></td>
<td>
<p>default FALSE, else inference of the impacts based on Kelejian and Piras (2020)</p>
</td></tr>
<tr><td><code id="impacts.gstsls_+3A_prt">prt</code></td>
<td>
<p>prints the KP summary of the VC matrix</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Estimate of the Average Total, Average Direct, and Average Indirect Effects
</p>


<h3>References</h3>

<p>Roger Bivand, Gianfranco Piras (2015). Comparing Implementations of Estimation Methods for Spatial Econometrics. <em>Journal of Statistical Software</em>, 63(18), 1-36. <a href="https://www.jstatsoft.org/v63/i18/">https://www.jstatsoft.org/v63/i18/</a>.
Harry Kelejian, Gianfranco Piras (2020). Spillover effects in spatial models: Generalization and extensions. <em>Journal of Regional Science</em>, 60(3), 425-442. <a href="https://onlinelibrary.wiley.com/doi/10.1111/jors.12476">https://onlinelibrary.wiley.com/doi/10.1111/jors.12476</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(boston, package="spData")
Wb &lt;- as(spdep::nb2listw(boston.soi), "CsparseMatrix")
ev &lt;- eigen(Wb)$values
trMatb &lt;- spatialreg::trW(Wb, type="mult")
sarar1 &lt;- spreg(log(CMEDV) ~ CRIM + ZN + INDUS + CHAS + I(NOX^2) + 
                  I(RM^2) +  AGE + log(DIS) + log(RAD) + TAX + PTRATIO + B + log(LSTAT), 
                data = boston.c, listw = Wb, model = "sarar")
summary(sarar1)
impacts(sarar1, KPformula = TRUE)
summary(impacts(sarar1, tr = trMatb, R=1000), zstats=TRUE, short=TRUE)
summary(impacts(sarar1, evalues = ev, R=1000), zstats=TRUE, short=TRUE)

sarar2 &lt;- spreg(log(CMEDV) ~ CRIM + ZN + INDUS + CHAS + I(NOX^2) + 
                  I(RM^2) +  AGE + log(DIS) + log(RAD) + TAX + PTRATIO + B + log(LSTAT), 
                data = boston.c, listw = Wb, model = "sarar", Durbin = TRUE)

summary(sarar2)
impacts(sarar2, evalues = ev, KPformula = TRUE)
impacts(sarar2, evalues = ev)
impacts(sarar2, listw = spdep::nb2listw(boston.soi))
impacts(sarar2, tr = trMatb)
summary(impacts(sarar2, evalues = ev, R=1000), zstats=TRUE, short=TRUE)

sarar3 &lt;- spreg(log(CMEDV) ~ CRIM + ZN + INDUS + CHAS + I(NOX^2) + 
                  I(RM^2) +  AGE + log(DIS) + log(RAD) + TAX + PTRATIO + B + log(LSTAT), 
                data = boston.c, listw = Wb, model = "sarar", Durbin = ~CRIM + TAX)

summary(sarar3)
impacts(sarar3, evalues = ev)
impacts(sarar3, evalues = ev, KPformula = TRUE)
impacts(sarar3, evalues = ev, KPformula = TRUE, tr = trMatb)
impacts(sarar3, listw = spdep::nb2listw(boston.soi))
impacts(sarar3, tr = trMatb)
summary(impacts(sarar3, listw = spdep::nb2listw(boston.soi), R=1000), zstats=TRUE, short=TRUE)

sarar4 &lt;- spreg(log(CMEDV) ~ CRIM + ZN + INDUS + CHAS + I(NOX^2) + 
                  I(RM^2) +  AGE + log(DIS) + log(RAD) + TAX + PTRATIO + B , 
                data = boston.c, listw = Wb, model = "sarar", Durbin = ~CRIM + TAX + log(LSTAT))

summary(sarar4)
impacts(sarar4, evalues = ev)
summary(impacts(sarar4, evalues = ev, R=1000), zstats=TRUE, short=TRUE)

sarar5 &lt;- spreg(log(CMEDV) ~ CRIM + ZN + INDUS + CHAS + I(NOX^2) + I(RM^2) +  AGE + log(DIS), 
                data = boston.c, listw = Wb, model = "sarar", Durbin = ~ TAX + log(LSTAT))

summary(sarar5)
impacts(sarar5, evalues = ev)
summary(impacts(sarar4, tr = trMatb, R=1000), zstats=TRUE, short=TRUE)
</code></pre>

<hr>
<h2 id='impacts.ols_sphet'>Generate impacts for objects of class ols_sphet created in sphet</h2><span id='topic+impacts.ols_sphet'></span>

<h3>Description</h3>

<p>Generate impacts for objects of class ols_sphet created in sphet
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ols_sphet'
impacts(
  obj,
  ...,
  tr = NULL,
  R = NULL,
  listw = NULL,
  evalues = NULL,
  tol = 1e-06,
  empirical = FALSE,
  Q = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="impacts.ols_sphet_+3A_obj">obj</code></td>
<td>
<p>A spreg spatial regression object created by <code>spreg</code> with model =&quot;lag&quot;</p>
</td></tr>
<tr><td><code id="impacts.ols_sphet_+3A_...">...</code></td>
<td>
<p>Arguments passed through to methods in the <span class="pkg">coda</span> package</p>
</td></tr>
<tr><td><code id="impacts.ols_sphet_+3A_tr">tr</code></td>
<td>
<p>A vector of traces of powers of the spatial weights matrix created using <code>trW</code>, for approximate impact measures; if not given, <code>listw</code> must be given for exact measures (for small to moderate spatial weights matrices); the traces must be for the same spatial weights as were used in fitting the spatial regression</p>
</td></tr>
<tr><td><code id="impacts.ols_sphet_+3A_r">R</code></td>
<td>
<p>If given, simulations are used to compute distributions for the impact measures, returned as <code>mcmc</code> objects</p>
</td></tr>
<tr><td><code id="impacts.ols_sphet_+3A_listw">listw</code></td>
<td>
<p>a listw object</p>
</td></tr>
<tr><td><code id="impacts.ols_sphet_+3A_evalues">evalues</code></td>
<td>
<p>vector of eigenvalues of spatial weights matrix for impacts calculations</p>
</td></tr>
<tr><td><code id="impacts.ols_sphet_+3A_tol">tol</code></td>
<td>
<p>Argument passed to <code>mvrnorm</code>: tolerance (relative to largest variance) for numerical lack of positive-definiteness in the coefficient covariance matrix</p>
</td></tr>
<tr><td><code id="impacts.ols_sphet_+3A_empirical">empirical</code></td>
<td>
<p>Argument passed to <code>mvrnorm</code> (default FALSE): if true, the coefficients and their covariance matrix specify the empirical not population mean and covariance matrix</p>
</td></tr>
<tr><td><code id="impacts.ols_sphet_+3A_q">Q</code></td>
<td>
<p>default NULL, else an integer number of cumulative power series impacts to calculate if <code>tr</code> is given</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Estimate of the Average Total, Average Direct, and Average Indirect Effects
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(boston, package="spData")
Wb &lt;- as(spdep::nb2listw(boston.soi), "CsparseMatrix") 
ev &lt;- eigen(Wb)$values
trMatb &lt;- spatialreg::trW(Wb, type="mult")

lm.D &lt;- spreg(log(CMEDV) ~ CRIM + ZN + INDUS + CHAS + I(NOX^2) + I(RM^2) +  AGE + log(DIS), 
          data = boston.c, listw = Wb, model = "ols", Durbin =  TRUE)
summary(lm.D)
impacts(lm.D)
summary(impacts(lm.D))

lm.D2 &lt;- spreg(log(CMEDV) ~ CRIM + ZN + INDUS + CHAS + I(NOX^2) + I(RM^2) +  AGE + log(DIS), 
               data = boston.c, listw = Wb, model = "ols", Durbin =  ~AGE)
summary(lm.D2)
impacts(lm.D2)
summary(impacts(lm.D2))

lm.D3 &lt;- spreg(log(CMEDV) ~ CRIM + ZN +  CHAS + I(NOX^2) + I(RM^2) +  AGE, 
               data = boston.c, listw = Wb, model = "ols", Durbin =  ~AGE + INDUS )
summary(lm.D3)
impacts(lm.D3)
summary(impacts(lm.D3))

require("sf", quietly=TRUE)
columbus &lt;- st_read(system.file("shapes/columbus.shp", package="spData")[1], quiet=TRUE)
col.gal.nb &lt;- spdep::read.gal(system.file("weights/columbus.gal", package="spData")[1])
listw &lt;- spdep::nb2listw(col.gal.nb)
knear &lt;- spdep::knearneigh(cbind(columbus$X, columbus$Y), 5)
knb &lt;- spdep::knn2nb(knear)
dist &lt;- spdep::nbdists(knb, cbind(columbus$X, columbus$Y))
k5d &lt;- spdep::nb2listw(knb, glist = dist, style = "B")
class(k5d) &lt;- c("listw", "nb", "distance")
lm.D4 &lt;- spreg(CRIME ~ INC + HOVAL, columbus, listw, Durbin=TRUE,
               model = "ols")
summary(lm.D4)
impacts(lm.D4)

lm.D5 &lt;- spreg(CRIME ~ INC + HOVAL, columbus, listw, Durbin= ~ INC,
               model = "ols")
summary(lm.D5)
impacts(lm.D5)
summary(impacts(lm.D5))

lm.D6 &lt;- spreg(CRIME ~ HOVAL, columbus, listw, Durbin= ~ INC,
               model = "ols")
summary(lm.D6)
summary(impacts(lm.D6))
## Not run: 
lm.D7 &lt;- spreg(CRIME ~ INC + HOVAL, columbus, listw,
                 model = "ols", HAC = TRUE, distance = k5d, 
                                  type = "Triangular")
summary(lm.D7)
impacts(lm.D7)
summary(impacts(lm.D7))

## End(Not run)
lm.D8 &lt;- spreg(CRIME ~ INC + HOVAL, data = columbus, listw = listw, Durbin=TRUE,
               model = "ols", distance = k5d, type = "Triangular")
summary(lm.D8)
impacts(lm.D8)
summary(impacts(lm.D8))


lmD.9 &lt;- spreg(CRIME ~ INC + HOVAL, data = columbus, listw = listw, Durbin= ~ INC,
               model = "ols", distance = k5d, type = "Parzen")
               
impacts(lmD.9)

lmD.10 &lt;- spreg(CRIME ~ HOVAL, columbus, listw, Durbin= ~ INC,
                model = "ols", distance = k5d, type = "Bisquare")
summary(lmD.10)
summary(impacts(lmD.10))
</code></pre>

<hr>
<h2 id='impacts.stsls_sphet'>Generate impacts for objects of class lag_gmm created in sphet</h2><span id='topic+impacts.stsls_sphet'></span>

<h3>Description</h3>

<p>Generate impacts for objects of class lag_gmm created in sphet
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'stsls_sphet'
impacts(
  obj,
  ...,
  tr = NULL,
  R = NULL,
  listw = NULL,
  evalues = NULL,
  tol = 1e-06,
  empirical = FALSE,
  Q = NULL,
  KPformula = FALSE,
  prt = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="impacts.stsls_sphet_+3A_obj">obj</code></td>
<td>
<p>A spreg spatial regression object created by <code>spreg</code> with model =&quot;lag&quot;</p>
</td></tr>
<tr><td><code id="impacts.stsls_sphet_+3A_...">...</code></td>
<td>
<p>Arguments passed through to methods in the <span class="pkg">coda</span> package</p>
</td></tr>
<tr><td><code id="impacts.stsls_sphet_+3A_tr">tr</code></td>
<td>
<p>A vector of traces of powers of the spatial weights matrix created using <code>trW</code>, for approximate impact measures; if not given, <code>listw</code> must be given for exact measures (for small to moderate spatial weights matrices); the traces must be for the same spatial weights as were used in fitting the spatial regression</p>
</td></tr>
<tr><td><code id="impacts.stsls_sphet_+3A_r">R</code></td>
<td>
<p>If given, simulations are used to compute distributions for the impact measures, returned as <code>mcmc</code> objects</p>
</td></tr>
<tr><td><code id="impacts.stsls_sphet_+3A_listw">listw</code></td>
<td>
<p>a listw object</p>
</td></tr>
<tr><td><code id="impacts.stsls_sphet_+3A_evalues">evalues</code></td>
<td>
<p>vector of eigenvalues of spatial weights matrix for impacts calculations</p>
</td></tr>
<tr><td><code id="impacts.stsls_sphet_+3A_tol">tol</code></td>
<td>
<p>Argument passed to <code>mvrnorm</code>: tolerance (relative to largest variance) for numerical lack of positive-definiteness in the coefficient covariance matrix</p>
</td></tr>
<tr><td><code id="impacts.stsls_sphet_+3A_empirical">empirical</code></td>
<td>
<p>Argument passed to <code>mvrnorm</code> (default FALSE): if true, the coefficients and their covariance matrix specify the empirical not population mean and covariance matrix</p>
</td></tr>
<tr><td><code id="impacts.stsls_sphet_+3A_q">Q</code></td>
<td>
<p>default NULL, else an integer number of cumulative power series impacts to calculate if <code>tr</code> is given</p>
</td></tr>
<tr><td><code id="impacts.stsls_sphet_+3A_kpformula">KPformula</code></td>
<td>
<p>default FALSE, else inference of the impacts based on Kelejian and Piras (2020)</p>
</td></tr>
<tr><td><code id="impacts.stsls_sphet_+3A_prt">prt</code></td>
<td>
<p>prints the KP summary of the VC matrix</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Estimate of the Average Total, Average Direct, and Average Indirect Effects
</p>


<h3>References</h3>

<p>Roger Bivand, Gianfranco Piras (2015). Comparing Implementations of Estimation Methods for Spatial Econometrics. <em>Journal of Statistical Software</em>, 63(18), 1-36. <a href="https://www.jstatsoft.org/v63/i18/">https://www.jstatsoft.org/v63/i18/</a>.
Harry Kelejian, Gianfranco Piras (2020). Spillover effects in spatial models: Generalization and extensions. <em>Journal of Regional Science</em>, 60(3), 425-442. <a href="https://onlinelibrary.wiley.com/doi/10.1111/jors.12476">https://onlinelibrary.wiley.com/doi/10.1111/jors.12476</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>require("sf", quietly=TRUE)
library(coda)
columbus &lt;- st_read(system.file("shapes/columbus.shp", package="spData")[1], quiet=TRUE)
col.gal.nb &lt;- spdep::read.gal(system.file("weights/columbus.gal", package="spData")[1])
listw &lt;- spdep::nb2listw(col.gal.nb)
ev &lt;- spatialreg::eigenw(listw)
W &lt;- as(listw, "CsparseMatrix")
trMatc &lt;- spatialreg::trW(W, type="mult")
trMC &lt;- spatialreg::trW(W, type="MC")
#LAG
lobj_gm &lt;- spreg(CRIME ~ INC + HOVAL, columbus, listw,
                model = "lag")
summary(lobj_gm)
lobj_gmh &lt;- spreg(CRIME ~ INC + HOVAL, columbus, listw,
                 model = "lag", het = TRUE)
summary(lobj_gmh)
set.seed(1)
impacts(lobj_gm, listw=listw)
impacts(lobj_gm, tr=trMatc)
impacts(lobj_gm, tr=trMC)
impacts(lobj_gm, evalues=ev)
impacts(lobj_gmh, listw=listw)
impacts(lobj_gmh, tr=trMatc)
impacts(lobj_gmh, tr=trMC)
impacts(lobj_gmh, evalues=ev)
#same impacts but different SD
summary(impacts(lobj_gm, evalues = ev, R = 1000))
summary(impacts(lobj_gmh, evalues = ev, R = 1000))
lobjIQ5_gm &lt;- impacts(lobj_gm, tr=trMatc, R=1000, Q=5)
summary(lobjIQ5_gm, zstats=TRUE, short=TRUE)
summary(lobjIQ5_gm, zstats=TRUE, short=TRUE, reportQ=TRUE)
# LAG durbin TRUE
mobj_gm &lt;- spreg(CRIME ~ INC + HOVAL, columbus, listw, Durbin=TRUE,
                model = "lag")
summary(mobj_gm)
mobj_gmh &lt;- spreg(CRIME ~ INC + HOVAL, columbus, listw, Durbin=TRUE,
                 model = "lag", het = TRUE)
mobj_gm2 &lt;- spreg(CRIME ~ INC, columbus, listw, Durbin=TRUE,
                model = "lag")
summary(mobj_gmh)
impacts(mobj_gm, KPformula = TRUE)
impacts(mobj_gm2, KPformula = TRUE)
summary(impacts(mobj_gm2, evalues=ev, R=1000), short=TRUE, zstats=TRUE)
impacts(mobj_gm, listw=listw)
impacts(mobj_gm, tr=trMatc)
impacts(mobj_gm, tr=trMC)
impacts(mobj_gm, evalues=ev)
summary(impacts(mobj_gm, evalues=ev, R=1000), short=TRUE, zstats=TRUE)
impacts(mobj_gmh, listw=listw)
impacts(mobj_gmh, tr=trMatc)
impacts(mobj_gmh, tr=trMC)
impacts(mobj_gmh, evalues=ev)
summary(impacts(mobj_gmh, tr=trMatc, R=1000), short=TRUE, zstats=TRUE)
#lag durbin = ~formula
mobj1_gm &lt;- spreg(CRIME ~ INC + HOVAL, columbus, listw, Durbin= ~ INC,
                 model = "lag")
mobj1_gmh &lt;- spreg(CRIME ~ INC + HOVAL, columbus, listw, Durbin= ~ INC,
                  model = "lag", het = TRUE)
impacts(mobj1_gm, tr=trMatc)
impacts(mobj1_gm, listw=listw)
impacts(mobj1_gm, KPformula = TRUE)
summary(impacts(mobj_gm, evalues=ev, R=200), short=TRUE, zstats=TRUE)
summary(impacts(mobj1_gm, tr=trMatc, R=200), short=TRUE, zstats=TRUE)
mobj1_gm &lt;- spreg(CRIME ~ HOVAL, columbus, listw, Durbin= ~ INC,
                 model = "lag")
summary(impacts(mobj1_gm, evalues=ev, R=200), short=TRUE, zstats=TRUE)
</code></pre>

<hr>
<h2 id='kpjtest'>Kelejian and Piras J-test</h2><span id='topic+kpjtest'></span>

<h3>Description</h3>

<p>The function calculate the Kelejian and Piras J-test for spatial models.
Both models (under the null and under the alternative) 
can be specified with additional endogenous variables, and additional instruments. 
The model under the null allows for heteroskedasticity as well as spatial autocorrelation:
</p>
<p style="text-align: center;"><code class="reqn">y=\lambda W y + X \beta + u  </code>
</p>

<p style="text-align: center;"><code class="reqn">u=Re</code>
</p>
<p>  with </p>
<p style="text-align: center;"><code class="reqn">e ~ N(0,\sigma^2_i) </code>
</p>

<p>Note that when R reduces to an identity matrix, the error term, while still heteroskedastic, is not spatially autocorrelated. 
On the other hand, when the <code class="reqn">\sigma^2_i</code> are all the same (and R is an identity matrix) than the error term is neither heteroskedastic nor autocorrelated.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>kpjtest(H0model, H1model, data = list(), listw0 = NULL, listw1 = NULL, 
         endogH0 = NULL, endogH1 = NULL, instrumentsH0 = NULL, instrumentsH1 = NULL, 
         lag.instr = FALSE, model = "lag", het = FALSE, HAC = F, 
         distance = NULL, type = "Epanechnikov",
         bandwidth = "variable",  na.action = na.fail)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="kpjtest_+3A_h0model">H0model</code></td>
<td>
<p>Formula object for the specification of the model under the null</p>
</td></tr>
<tr><td><code id="kpjtest_+3A_h1model">H1model</code></td>
<td>
<p>Formula object for the specification of the model under the alternative</p>
</td></tr>
<tr><td><code id="kpjtest_+3A_data">data</code></td>
<td>
<p>an object of class <a href="base.html#topic+data.frame">data.frame</a>. An optional data frame containing the variables
in the model</p>
</td></tr>
<tr><td><code id="kpjtest_+3A_listw0">listw0</code></td>
<td>
<p>an object of class <code>listw</code>, <code>matrix</code>, or <code>Matrix</code>. The spatial weighting matrix under the null model</p>
</td></tr>
<tr><td><code id="kpjtest_+3A_listw1">listw1</code></td>
<td>
<p>an object of class <code>listw</code>, <code>matrix</code>, or <code>Matrix</code>. The spatial weighting matrix under the alternative model</p>
</td></tr>
<tr><td><code id="kpjtest_+3A_endogh0">endogH0</code></td>
<td>
<p>additional endogenous variables under the null model. Default <code>NULL</code>. If not <code>NULL</code> should be specified as a formula with no dependent variable (endog = ~ x1 + x2). Note the ~ before the expression</p>
</td></tr>
<tr><td><code id="kpjtest_+3A_endogh1">endogH1</code></td>
<td>
<p>additional endogenous variables under the alternative model. Default <code>NULL</code>. If not <code>NULL</code> should be specified as a formula with no dependent variable (endog = ~ x1 + x2). Note the ~ before the expression</p>
</td></tr>
<tr><td><code id="kpjtest_+3A_instrumentsh0">instrumentsH0</code></td>
<td>
<p>external instruments for the null model. Default <code>NULL</code>. If not <code>NULL</code> should be specified 
as a formula with no dependent variable (instruments = ~ x1 + x2). Note the ~ before the expression</p>
</td></tr>
<tr><td><code id="kpjtest_+3A_instrumentsh1">instrumentsH1</code></td>
<td>
<p>external instruments for the alternative model. Default <code>NULL</code>. If not <code>NULL</code> should be specified 
as a formula with no dependent variable (instruments = ~ x1 + x2). Note the ~ before the expression</p>
</td></tr>
<tr><td><code id="kpjtest_+3A_lag.instr">lag.instr</code></td>
<td>
<p>should the external instruments be spatially lagged?</p>
</td></tr>
<tr><td><code id="kpjtest_+3A_model">model</code></td>
<td>
<p>one of <code>lag</code>, or <code>sarar</code>. The current version of the function only implements the lag model.</p>
</td></tr>
<tr><td><code id="kpjtest_+3A_het">het</code></td>
<td>
<p>default FALSE: if TRUE uses the methods developed for heteroskedasticity</p>
</td></tr>
<tr><td><code id="kpjtest_+3A_hac">HAC</code></td>
<td>
<p>perform the HAC estimator of Kelejian and Prucha, 2007 on the null (and augmented) model.</p>
</td></tr>
<tr><td><code id="kpjtest_+3A_distance">distance</code></td>
<td>
<p>an object of class <code>distance</code> created for example by <a href="#topic+read.gwt2dist">read.gwt2dist</a> 
The object contains the specification of the distance measure 
to be employed in the estimation of the VC matrix. See Details.</p>
</td></tr>
<tr><td><code id="kpjtest_+3A_type">type</code></td>
<td>
<p>One of <code>c("Epanechnikov","Triangular","Bisquare","Parzen", "QS","TH","Rectangular")</code>. 
The type of Kernel to be used. See Details.</p>
</td></tr>
<tr><td><code id="kpjtest_+3A_bandwidth">bandwidth</code></td>
<td>
<p>&quot;variable&quot; (default) - or numeric when a fixed bandwidth is specified by the user.</p>
</td></tr>
<tr><td><code id="kpjtest_+3A_na.action">na.action</code></td>
<td>
<p>a function which indicates what should happen when the data contains missing values. See <a href="stats.html#topic+lm">lm</a> for details</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In order to calculate the J-test, the function follows a few steps:
</p>

<ul>
<li><p> The alternative model is estimated by S2SLS. 
</p>
</li>
<li><p> Based on the estimated parameters in the previous step,  obtain a prediction based on the alternative models of the dependent vector in the null model. The predictor is based on the right hand side of the model. 
</p>
</li>
<li><p> Use these predicted values of the dependent variable based on the alternative models into the null model to obtain the augmented model. 
</p>
</li>
<li><p> Estimate the augmented model by 2SLS using all of the instruments relating to the null model as well as all of the instruments relating to the alternative models. 
</p>
</li>
<li><p> Test for the statistical significance of the predicted value. If it is not significant, accept the null model. If it is  significant, reject the null and conclude that the true model is the alternative models. 
</p>
</li></ul>

<p>The output is an object of class <code>sphet</code> where the last row of the table of coefficients is the prediction. 
</p>
<p>When the model is heteroskedastic as well as spatially autocorrelated, an HAC procedure is employed. 
The default sets the bandwith for each observation to the maximum distance for that observation (i.e.
the max of each element of the list of distances). 
</p>
<p>Six different kernel functions are implemented:
</p>

<ul>
<li> <p><code>'Epanechnikov'</code>: <code class="reqn">K(z) = 1-z^2</code>
</p>
</li>
<li> <p><code>'Triangular'</code>: <code class="reqn">K(z) = 1-z</code> 
</p>
</li>
<li> <p><code>'Bisquare'</code>: <code class="reqn">K(z) = (1-z^2)^2</code>
</p>
</li>
<li> <p><code>'Parzen'</code>: <code class="reqn">K(z) = 1-6z^2+6 |z|^3</code> if  <code class="reqn">z \leq 0.5</code> and  
<code class="reqn"> K(z) = 2(1-|z|)^3</code> if <code class="reqn">0.5 &lt; z \leq 1</code> 
</p>
</li>
<li> <p><code>'TH'</code> (Tukey - Hanning):  <code class="reqn"> K(z) = \frac{1+ \cos(\pi z)}{2}</code>
</p>
</li>
<li> <p><code>'Rectangular'</code>:  <code class="reqn"> K(z) = 1</code>
</p>
</li>
<li> <p><code>'QS'</code> (Quadratic Spectral): <code class="reqn">K(z) = \frac{25}{12\pi^2z^2} 
     (\frac{\sin(6\pi z)/5)}{6\pi z/5} - \cos(6\pi z)/5)</code>). 
</p>
</li></ul>

<p>If the kernel type is not one of the six implemented, the function will terminate with an error message. 
The spatial two stage least square estimator is based on the matrix of instruments <code class="reqn">H=[X,WX,W^2X^2]</code>.
</p>


<h3>Value</h3>

<p>A list object of class <code>sphet</code>
</p>
<table>
<tr><td><code>coefficients</code></td>
<td>
<p>Generalized Spatial two stage least squares coefficient estimates of <code class="reqn">\delta</code> and GM estimator for <code class="reqn">\rho</code>. </p>
</td></tr>
<tr><td><code>var</code></td>
<td>
<p>variance-covariance matrix of the estimated coefficients</p>
</td></tr>
<tr><td><code>s2</code></td>
<td>
<p>GS2SLS residuals variance</p>
</td></tr>
<tr><td><code>residuals</code></td>
<td>
<p>GS2SLS residuals</p>
</td></tr>
<tr><td><code>yhat</code></td>
<td>
<p>difference between GS2SLS residuals and response variable</p>
</td></tr>
<tr><td><code>call</code></td>
<td>
<p>the call used to create this object</p>
</td></tr>
<tr><td><code>model</code></td>
<td>
<p>the model matrix of data</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p><code>'s2slshac'</code></p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Gianfranco Piras <a href="mailto:gpiras@mac.com">gpiras@mac.com</a>
</p>


<h3>References</h3>

<p>Kelejian and Piras (2017). <em>Spatial Econometrics</em>. Academic Press. ISBN: 978-0-12-813387-3 
</p>
<p>Gianfranco Piras (2010). sphet: Spatial Models with Heteroskedastic Innovations in R. <em>Journal of Statistical Software</em>, 35(1), 1-21. <a href="https://www.jstatsoft.org/v35/i01/">https://www.jstatsoft.org/v35/i01/</a>.
</p>
<p>Roger Bivand, Gianfranco Piras (2015). Comparing Implementations of Estimation Methods for Spatial Econometrics. <em>Journal of Statistical Software</em>, 63(18), 1-36. <a href="https://www.jstatsoft.org/v63/i18/">https://www.jstatsoft.org/v63/i18/</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'> library(spdep)
 library(sphet)
 data(boston)
 boslw &lt;- nb2listw(boston.soi)
 
 Bos.Knn &lt;- knearneigh(boston.utm, k = 5)
 bos.nb &lt;- knn2nb(Bos.Knn)
 boslw2 &lt;- nb2listw(bos.nb)
 
 fm &lt;- log(MEDV) ~ CRIM + ZN + INDUS + CHAS
 fm2 &lt;- log(MEDV) ~ CRIM + ZN + INDUS + RM + AGE 
 
 test &lt;- kpjtest(fm, fm2, data = boston.c, 
 listw0 = boslw, listw1 = boslw2, model = "lag")
 
</code></pre>

<hr>
<h2 id='listw2dgCMatrix'>Interface between Matrix class objects and weights list</h2><span id='topic+listw2dgCMatrix'></span>

<h3>Description</h3>

<p>Interface between Matrix class objects and weights list
</p>


<h3>Usage</h3>

<pre><code class='language-R'>listw2dgCMatrix(listw, zero.policy = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="listw2dgCMatrix_+3A_listw">listw</code></td>
<td>
<p>a <code>listw</code> object created for example by <code>nb2listw</code></p>
</td></tr>
<tr><td><code id="listw2dgCMatrix_+3A_zero.policy">zero.policy</code></td>
<td>
<p>See <code>lagsarlm</code> for details</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Matrix class object: a sparse Matrix
</p>


<h3>Author(s)</h3>

<p>Gianfranco Piras <a href="mailto:gpiras@mac.com">gpiras@mac.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(spdep)
data(columbus)
listw &lt;- nb2listw(col.gal.nb)
spW &lt;- listw2dgCMatrix(listw)
</code></pre>

<hr>
<h2 id='print.sphet'>print method for class sphet</h2><span id='topic+print.sphet'></span>

<h3>Description</h3>

<p>Method used to print objects of class <code>'summary.sphet'</code> and <code>'sphet'</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'sphet'
print(x, digits = max(3, getOption("digits") - 3),...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.sphet_+3A_x">x</code></td>
<td>
<p>an object of class 'sphet'</p>
</td></tr>
<tr><td><code id="print.sphet_+3A_digits">digits</code></td>
<td>
<p>minimal number of significant digits, see <code>print.default</code></p>
</td></tr>
<tr><td><code id="print.sphet_+3A_...">...</code></td>
<td>
<p>additional arguments to be passed</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The summary function summary.sphet returns an objects of class 'sphet' 
organized in a coefficient matrix.
</p>


<h3>Author(s)</h3>

<p>Gianfranco Piras<a href="mailto:gpiras@mac.com">gpiras@mac.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gstslshet">gstslshet</a></code>, <code><a href="#topic+stslshac">stslshac</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(spdep)
data(columbus)
listw &lt;- nb2listw(col.gal.nb)
res &lt;- spreg(CRIME~HOVAL + INC, data=columbus, listw=listw, model ="sarar")
summary(res)
</code></pre>

<hr>
<h2 id='print.summary.sphet'>print method for class sphet</h2><span id='topic+print.summary.sphet'></span>

<h3>Description</h3>

<p>Method used to print objects of class <code>'summary.sphet'</code> and <code>'sphet'</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'summary.sphet'
print(x,digits= max(3, getOption("digits") - 2), 
width=getOption("width"), obsinfo=FALSE,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.summary.sphet_+3A_x">x</code></td>
<td>
<p>an object of class 'sphet'</p>
</td></tr>
<tr><td><code id="print.summary.sphet_+3A_digits">digits</code></td>
<td>
<p>minimal number of significant digits, see <code>print.default</code></p>
</td></tr>
<tr><td><code id="print.summary.sphet_+3A_width">width</code></td>
<td>
<p>controls the maximum number of columns on a line used in printing</p>
</td></tr>
<tr><td><code id="print.summary.sphet_+3A_obsinfo">obsinfo</code></td>
<td>
<p>for objects of class <code>distance</code>: if <code>TRUE</code> prints observation-wise information</p>
</td></tr>
<tr><td><code id="print.summary.sphet_+3A_...">...</code></td>
<td>
<p>additional arguments to be passed</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The summary function summary.sphet returns an objects of class 'sphet' 
organized in a coefficient matrix.
</p>


<h3>Author(s)</h3>

<p>Gianfranco Piras<a href="mailto:gpiras@mac.com">gpiras@mac.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gstslshet">gstslshet</a></code>, <code><a href="#topic+stslshac">stslshac</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(spdep)
data(columbus)
listw &lt;- nb2listw(col.gal.nb)
res &lt;- spreg(CRIME~HOVAL + INC, data=columbus, listw=listw, model ="sarar")
summary(res)
</code></pre>

<hr>
<h2 id='read.gwt2dist'>Read distance ojbects</h2><span id='topic+read.gwt2dist'></span>

<h3>Description</h3>

<p>The function reads &quot;GWT&quot; files (i.e. generated using <a href="#topic+distance">distance</a>. 
It will read also other more general formats (as for example .txt files).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read.gwt2dist(file, region.id = NULL, skip = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="read.gwt2dist_+3A_file">file</code></td>
<td>
<p>name of file to be read</p>
</td></tr>
<tr><td><code id="read.gwt2dist_+3A_region.id">region.id</code></td>
<td>
<p>variable that defines the ordering of the observations</p>
</td></tr>
<tr><td><code id="read.gwt2dist_+3A_skip">skip</code></td>
<td>
<p>number of lines to skip</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The first line of a <code>'GWT'</code> file generally contains some information 
(e.g. the name of the shape file, the number of observations), 
in which case, <code>skip</code> should be equal to 1. 
When the <code>file</code> has a <code>'GWT'</code> extension, 
the number of observations is generally retrived from the first line. 
Alternatively, it is fixed to the length 
of the <a href="base.html#topic+unique">unique</a> <code>region.id</code> variable.
</p>


<h3>Value</h3>

<p>An object of class <code>distance</code>
</p>


<h3>Author(s)</h3>

<p>Gianfranco Piras <a href="mailto:gpiras@mac.com">gpiras@mac.com</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(spdep)
data(columbus)
dist &lt;- read.gwt2dist(file = system.file('extdata/knn10columbus.GWT',
package = "sphet"), region.id = columbus$POLYID)

## End(Not run)
</code></pre>

<hr>
<h2 id='spreg'>GM estimation of a Cliff-Ord type model with Heteroskedastic Innovations</h2><span id='topic+spreg'></span>

<h3>Description</h3>

<p>Multi step GM/IV estimation of a linear Cliff and Ord -type of model 
of the form:
</p>
<p style="text-align: center;"><code class="reqn">y=\lambda W y + X \beta + u  </code>
</p>

<p style="text-align: center;"><code class="reqn">u=\rho W u + e</code>
</p>
<p>  with </p>
<p style="text-align: center;"><code class="reqn">e ~ N(0,\sigma^2_i) </code>
</p>

<p>The model allows for spatial lag in the dependent variable
and disturbances. The innovations in the disturbance process are assumed 
heteroskedastic of an unknown form.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spreg(formula, data = list(), listw, listw2 = NULL, 
        endog = NULL, instruments = NULL, 
        lag.instr = FALSE, initial.value = 0.2, 
        model = c("sarar", "lag", "error", "ivhac", "ols"),
        het = FALSE, verbose = FALSE, 
        na.action = na.fail,  HAC = FALSE, 
        distance = NULL, type =  c("Epanechnikov","Triangular",
                                   "Bisquare", "Parzen", "QS", "TH","Rectangular"), 
        bandwidth = "variable" , step1.c = FALSE,
        control = list(), Durbin = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="spreg_+3A_formula">formula</code></td>
<td>
<p>a description of the model to be fit</p>
</td></tr>
<tr><td><code id="spreg_+3A_data">data</code></td>
<td>
<p>an object of class <a href="base.html#topic+data.frame">data.frame</a>. An optional data frame containing the variables 
in the model</p>
</td></tr>
<tr><td><code id="spreg_+3A_listw">listw</code></td>
<td>
<p>an object of class <code>listw</code>, <code>matrix</code>, or <code>Matrix</code></p>
</td></tr>
<tr><td><code id="spreg_+3A_listw2">listw2</code></td>
<td>
<p>an object of class <code>listw</code>, <code>matrix</code>, or <code>Matrix</code> specified only when <code>sarar</code> is true</p>
</td></tr>
<tr><td><code id="spreg_+3A_endog">endog</code></td>
<td>
<p>additional endogenous variables. Default <code>NULL</code>. If not <code>NULL</code> should be specified
as a formula with no dependent variable (endog = ~ x1 + x2). Note the ~ before the expression.</p>
</td></tr>
<tr><td><code id="spreg_+3A_instruments">instruments</code></td>
<td>
<p>external instruments. Default <code>NULL</code>. If not <code>NULL</code> should be specified 
as a formula with no dependent variable (instruments = ~ x1 + x2). Note the ~ before the expression.</p>
</td></tr>
<tr><td><code id="spreg_+3A_lag.instr">lag.instr</code></td>
<td>
<p>should the external instruments be spatially lagged?</p>
</td></tr>
<tr><td><code id="spreg_+3A_initial.value">initial.value</code></td>
<td>
<p>The initial value for <code class="reqn">\rho</code>. It can be either numeric (default is 0.2) or
set to <code>'SAR'</code>, in which case the optimization will start from the estimated coefficient of a regression of the 2SLS 
residuals over their spatial lag (i.e. a spatial AR model)</p>
</td></tr>
<tr><td><code id="spreg_+3A_model">model</code></td>
<td>
<p>one of <code>lag</code>, <code>error</code>, <code>sarar</code>, <code>ivhac</code>, or <code>ols</code>. 
If HAC is TRUE, model should be one of <code>ivhac</code>, or <code>ols</code>.</p>
</td></tr>
<tr><td><code id="spreg_+3A_het">het</code></td>
<td>
<p>default FALSE: if TRUE uses the methods developed for heteroskedasticity</p>
</td></tr>
<tr><td><code id="spreg_+3A_verbose">verbose</code></td>
<td>
<p>print optimization details</p>
</td></tr>
<tr><td><code id="spreg_+3A_na.action">na.action</code></td>
<td>
<p>a function which indicates what should happen when the data contains missing values. See <a href="stats.html#topic+lm">lm</a> for details.</p>
</td></tr>
<tr><td><code id="spreg_+3A_hac">HAC</code></td>
<td>
<p>perform the HAC estimator of Kelejian and Prucha, 2007.</p>
</td></tr>
<tr><td><code id="spreg_+3A_distance">distance</code></td>
<td>
<p>an object of class <code>distance</code> created for example by <a href="#topic+read.gwt2dist">read.gwt2dist</a>
The object contains the specification of the distance measure 
to be employed in the estimation of the VC matrix. See Details.</p>
</td></tr>
<tr><td><code id="spreg_+3A_type">type</code></td>
<td>
<p>One of <code>c("Epanechnikov","Triangular","Bisquare","Parzen", "QS","TH","Rectangular")</code>.
The type of Kernel to be used. default = <code>"Epanechnikov"</code> See Details.</p>
</td></tr>
<tr><td><code id="spreg_+3A_bandwidth">bandwidth</code></td>
<td>
<p>&quot;variable&quot; (default) - or numeric when a fixed bandwidth is specified by the user.</p>
</td></tr>
<tr><td><code id="spreg_+3A_step1.c">step1.c</code></td>
<td>
<p>Should step 1.c from Arraiz et al. 2012 be performed?</p>
</td></tr>
<tr><td><code id="spreg_+3A_control">control</code></td>
<td>
<p>A list of control arguments. See <a href="stats.html#topic+nlminb">nlminb</a></p>
</td></tr>
<tr><td><code id="spreg_+3A_durbin">Durbin</code></td>
<td>
<p>Should (some of) the regressors be lagged? Default FALSE. If not <code>FALSE</code> should be specified 
as a formula with no dependent variable (Durbin = ~ x1 + x2) or set to <code>TRUE</code>. See details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The procedure consists of two steps alternating GM and IV estimators. Each step consists of sub-steps.
In step one <code class="reqn">\delta = [\beta',\lambda]'</code> is estimated by 2SLS. The 2SLS residuals are first employed
to obtain an consistent GM estimator of <code class="reqn">\rho</code>.
</p>
<p>In step two, the spatial Cochrane-Orcutt transformed model is estimated by 2SLS. This corresponds to a GS2SLS procedure. 
The GS2SLS residuals are used to obtain a consistent and efficient GM estimator for <code class="reqn">\rho</code>. 
</p>
<p>The initial value for the optimization in step 1b is taken to be <code>initial.value</code>. 
The initial value for the optimization of step 2b is the optimal parameter of step 1b.
</p>
<p>Internally, the object of class <code>listw</code> is transformed into a <a href="Matrix.html#topic+Matrix">Matrix</a> 
using the function <a href="#topic+listw2dgCMatrix">listw2dgCMatrix</a>.
</p>
<p>For the HAC estimator (Kelejian and Prucha, 2007),  there are four possibilities:
</p>

<ul>
<li><p> A model with only Wy
</p>
</li>
<li><p> A model with Wy and additional endogenous 
</p>
</li>
<li><p> Only additional endogenous (with no Wy)
</p>
</li>
<li><p> No additional endogenous variables
</p>
</li></ul>

<p>Furthermore, the default sets the bandwith for each observation to the maximum distance for that observation (i.e.
the max of each element of the list of distances). 
</p>
<p>Six different kernel functions are implemented:
</p>

<ul>
<li> <p><code>'Epanechnikov'</code>: <code class="reqn">K(z) = 1-z^2</code>
</p>
</li>
<li> <p><code>'Triangular'</code>: <code class="reqn">K(z) = 1-z</code> 
</p>
</li>
<li> <p><code>'Bisquare'</code>: <code class="reqn">K(z) = (1-z^2)^2</code>
</p>
</li>
<li> <p><code>'Parzen'</code>: <code class="reqn">K(z) = 1-6z^2+6 |z|^3</code> if  <code class="reqn">z \leq 0.5</code> and  
<code class="reqn"> K(z) = 2(1-|z|)^3</code> if <code class="reqn">0.5 &lt; z \leq 1</code> 
</p>
</li>
<li> <p><code>'TH'</code> (Tukey - Hanning):  <code class="reqn"> K(z) = \frac{1+ \cos(\pi z)}{2}</code>
</p>
</li>
<li> <p><code>'Rectangular'</code>:  <code class="reqn"> K(z) = 1</code>
</p>
</li>
<li> <p><code>'QS'</code> (Quadratic Spectral): <code class="reqn">K(z) = \frac{25}{12\pi^2z^2} 
                                                  (\frac{\sin(6\pi z)/5)}{6\pi z/5} - \cos(6\pi z)/5)</code>). 
</p>
</li></ul>

<p>If the kernel type is not one of the six implemented, the function will terminate with an error message.
</p>


<h3>Value</h3>

<p>A list object of class <code>sphet</code>
</p>
<table>
<tr><td><code>coefficients</code></td>
<td>
<p>Generalized Spatial two stage least squares coefficient estimates of <code class="reqn">\delta</code> and GM estimator for <code class="reqn">\rho</code>. </p>
</td></tr>
<tr><td><code>var</code></td>
<td>
<p>variance-covariance matrix of the estimated coefficients</p>
</td></tr>
<tr><td><code>s2</code></td>
<td>
<p>GS2SLS residuals variance</p>
</td></tr>
<tr><td><code>residuals</code></td>
<td>
<p>GS2SLS residuals</p>
</td></tr>
<tr><td><code>yhat</code></td>
<td>
<p>difference between GS2SLS residuals and response variable</p>
</td></tr>
<tr><td><code>call</code></td>
<td>
<p>the call used to create this object</p>
</td></tr>
<tr><td><code>model</code></td>
<td>
<p>the model matrix of data</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p><code>'gs2slshac'</code></p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Gianfranco Piras <a href="mailto:gpiras@mac.com">gpiras@mac.com</a>
</p>


<h3>References</h3>

<p>Arraiz, I. and Drukker, M.D. and Kelejian, H.H. and Prucha, I.R. (2010) 
A spatial Cliff-Ord-type Model with Heteroskedastic Innovations: Small and Large Sample Results,
<em>Journal of Regional Sciences</em>, <b>50</b>, pages 592&ndash;614.
</p>
<p>Drukker, D.M. and Egger, P. and Prucha, I.R. (2013)
On Two-step Estimation of a Spatial Auto regressive Model with Autoregressive
Disturbances and Endogenous Regressors, 
<em>Econometric Review</em>, <b>32</b>, pages 686&ndash;733. 
</p>
<p>Kelejian, H.H. and Prucha, I.R. (2010) 
Specification and Estimation of Spatial Autoregressive Models with Autoregressive and Heteroskedastic Disturbances,
<em>Journal of Econometrics</em>, <b>157</b>, pages 53&ndash;67. 
</p>
<p>Kelejian, H.H. and Prucha, I.R. (1999) 
A Generalized Moments Estimator for the Autoregressive Parameter in a Spatial Model,
<em>International Economic Review</em>, <b>40</b>, pages 509&ndash;533.
</p>
<p>Kelejian, H.H. and Prucha, I.R. (1998) 
A Generalized Spatial Two Stage Least Square Procedure for Estimating a Spatial Autoregressive
Model with Autoregressive Disturbances,
<em>Journal of Real Estate Finance and Economics</em>, <b>17</b>, pages 99&ndash;121.
</p>
<p>Gianfranco Piras (2010). sphet: Spatial Models with Heteroskedastic Innovations in R. <em>Journal of Statistical Software</em>, 35(1), 1-21. doi: <a href="https://doi.org/10.18637/jss.v035.i01">10.18637/jss.v035.i01</a>.
</p>
<p>Roger Bivand, Gianfranco Piras (2015). Comparing Implementations of Estimation Methods for Spatial Econometrics. <em>Journal of Statistical Software</em>, 63(18), 1-36. doi: <a href="https://doi.org/10.18637/jss.v063.i18">10.18637/jss.v063.i18</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+stslshac">stslshac</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(columbus, package="spdep")
listw &lt;- spdep::nb2listw(col.gal.nb)
res &lt;- spreg(CRIME ~ HOVAL + INC, data = columbus , listw = listw,
             het = TRUE, verbose = FALSE, model = "sarar")
summary(res)
Effects &lt;- impacts(res, listw = listw, R = 1000)
</code></pre>

<hr>
<h2 id='stslshac'>Spatial two stages least square with HAC standard errors</h2><span id='topic+stslshac'></span><span id='topic+tsls'></span>

<h3>Description</h3>

<p>Non-parametric heteroskedasticity and autocorrelation 
consistent (HAC) estimator of the variance-covariance (VC) for a vector of sample moments within a 
spatial context. The disturbance vector is generated as follows:
</p>
<p style="text-align: center;"><code class="reqn"> u = R  \epsilon </code>
</p>

<p>where <code class="reqn">R</code> is a non-stochastic matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stslshac(formula, data = list(), listw,
             na.action = na.fail, zero.policy = NULL, HAC = TRUE,
             distance = NULL, type = "Epanechnikov", 
             bandwidth = "variable", W2X = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stslshac_+3A_formula">formula</code></td>
<td>
<p>a description of the model to be fit</p>
</td></tr>
<tr><td><code id="stslshac_+3A_data">data</code></td>
<td>
<p>an object of class <a href="base.html#topic+data.frame">data.frame</a>. An optional data frame containing the variables
in the model.</p>
</td></tr>
<tr><td><code id="stslshac_+3A_listw">listw</code></td>
<td>
<p>an object of class <code>listw</code> created for example by <code>nb2listw</code></p>
</td></tr>
<tr><td><code id="stslshac_+3A_na.action">na.action</code></td>
<td>
<p>a function which indicates what should happen when the data contains missing values.
See <a href="stats.html#topic+lm">lm</a> for details.</p>
</td></tr>
<tr><td><code id="stslshac_+3A_zero.policy">zero.policy</code></td>
<td>
<p>See <code>lagsarlm</code> for details</p>
</td></tr>
<tr><td><code id="stslshac_+3A_hac">HAC</code></td>
<td>
<p>if FALSE traditional standard errors are provided.</p>
</td></tr>
<tr><td><code id="stslshac_+3A_distance">distance</code></td>
<td>
<p>an object of class <code>distance</code> created for example by <a href="#topic+read.gwt2dist">read.gwt2dist</a> 
The object contains the specification of the distance measure 
to be employed in the estimation of the VC matrix. See Details.</p>
</td></tr>
<tr><td><code id="stslshac_+3A_type">type</code></td>
<td>
<p>One of <code>c("Epanechnikov","Triangular","Bisquare","Parzen", "QS","TH")</code>.
The type of Kernel to be used. See Details.</p>
</td></tr>
<tr><td><code id="stslshac_+3A_bandwidth">bandwidth</code></td>
<td>
<p>&quot;variable&quot; (default) - or numeric when a fixed bandwidth is specified by the user.</p>
</td></tr>
<tr><td><code id="stslshac_+3A_w2x">W2X</code></td>
<td>
<p>default TRUE. if FALSE only WX are used as instruments in the spatial two stage least squares.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The default sets the bandwith for each observation to the maximum distance for 
that observation (i.e.
the max of each element of the list of distances). 
</p>
<p>Six different kernel functions are implemented:
</p>

<ul>
<li> <p><code>'Epanechnikov'</code>: <code class="reqn">K(z) = 1-z^2</code>
</p>
</li>
<li> <p><code>'Rectangular'</code>: <code class="reqn">K(z) = 1</code>
</p>
</li>
<li> <p><code>'Triangular'</code>: <code class="reqn">K(z) = 1-z</code> 
</p>
</li>
<li> <p><code>'Bisquare'</code>: <code class="reqn">K(z) = (1-z^2)^2</code>
</p>
</li>
<li> <p><code>'Parzen'</code>: <code class="reqn">K(z) = 1-6z^2+6 |z|^3</code> if  <code class="reqn">z \leq 0.5</code> and  
<code class="reqn"> K(z) = 2(1-|z|)^3</code> if <code class="reqn">0.5 &lt; z \leq 1</code> 
</p>
</li>
<li> <p><code>'TH'</code> (Tukey - Hanning):  <code class="reqn"> K(z) = \frac{1+ \cos(\pi z)}{2}</code>
</p>
</li>
<li> <p><code>'QS'</code> (Quadratic Spectral): <code class="reqn">K(z) = \frac{25}{12\pi^2z^2} 
(\frac{\sin(6\pi z)/5)}{6\pi z/5} - \cos(6\pi z)/5)</code>). 
</p>
</li></ul>

<p>If the kernel type is not one of the six implemented, the function will terminate with an error message. 
The spatial two stage least square estimator is based on the matrix of instruments <code class="reqn">H=[X,WX,W^2X^2]</code>.
</p>


<h3>Value</h3>

<p>A list object of class <code>sphet</code>
</p>
<table>
<tr><td><code>coefficients</code></td>
<td>
<p>Spatial two stage least squares coefficient estimates</p>
</td></tr>
<tr><td><code>vcmat</code></td>
<td>
<p>variance-covariance matrix of the estimated coefficients</p>
</td></tr>
<tr><td><code>s2</code></td>
<td>
<p>S2sls residulas variance</p>
</td></tr>
<tr><td><code>residuals</code></td>
<td>
<p>S2sls residuals</p>
</td></tr>
<tr><td><code>yhat</code></td>
<td>
<p>difference between residuals and response variable</p>
</td></tr>
<tr><td><code>call</code></td>
<td>
<p>the call used to create this object</p>
</td></tr>
<tr><td><code>model</code></td>
<td>
<p>the model matrix of data</p>
</td></tr>
<tr><td><code>type</code></td>
<td>
<p>the kernel employed in the estimation</p>
</td></tr>
<tr><td><code>bandwidth</code></td>
<td>
<p>the type of bandwidth</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p><code>'s2slshac'</code></p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Gianfranco Piras <a href="mailto:gpiras@mac.com">gpiras@mac.com</a>
</p>


<h3>References</h3>

<p>Kelejian, H.H. and Prucha, I.R. (2007) 
HAC estimation in a spatial framework,
<em>Journal of Econometrics</em>, <b>140</b>, pages 131&ndash;154.
</p>
<p>Kelejian, H.H. and Prucha, I.R. (1999) 
A Generalized Moments Estimator for the Autoregressive Parameter in a Spatial Model,
<em>International Economic Review</em>, <b>40</b>, pages 509&ndash;533.
</p>
<p>Kelejian, H.H. and Prucha, I.R. (1998) 
A Generalized Spatial Two Stage Least Square Procedure for Estimating a Spatial Autoregressive
Model with Autoregressive Disturbances,
<em>Journal of Real Estate Finance and Economics</em>, <b>17</b>, pages 99&ndash;121.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gstslshet">gstslshet</a></code>, <code><a href="#topic+distance">distance</a></code>, <code><a href="#topic+distance">distance</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(spdep)
data(columbus)
listw &lt;- nb2listw(col.gal.nb)
data(coldis)
res &lt;- stslshac(CRIME ~ HOVAL + INC, data = columbus, listw = listw,  
distance = coldis, type = 'Triangular')
summary(res)
</code></pre>

<hr>
<h2 id='summary.sphet'>print method for class sphet</h2><span id='topic+summary.sphet'></span><span id='topic+sumres'></span>

<h3>Description</h3>

<p>Method used to print objects of class <code>'summary.sphet'</code> and <code>'sphet'</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'sphet'
summary(object, width=getOption("width"), digits=getOption("digits"),obsinfo=FALSE,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.sphet_+3A_object">object</code></td>
<td>
<p>an object of class 'sphet'</p>
</td></tr>
<tr><td><code id="summary.sphet_+3A_width">width</code></td>
<td>
<p>controls the maximum number of columns on a line used in printing</p>
</td></tr>
<tr><td><code id="summary.sphet_+3A_digits">digits</code></td>
<td>
<p>minimal number of significant digits, see <code>print.default</code></p>
</td></tr>
<tr><td><code id="summary.sphet_+3A_obsinfo">obsinfo</code></td>
<td>
<p>for objects of class <code>distance</code>: if <code>TRUE</code> prints observation-wise information</p>
</td></tr>
<tr><td><code id="summary.sphet_+3A_...">...</code></td>
<td>
<p>additional arguments to be passed</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The summary function summary.sphet returns an objects of class 'sphet' 
organized in a coefficient matrix.
</p>


<h3>Author(s)</h3>

<p>Gianfranco Piras<a href="mailto:gpiras@mac.com">gpiras@mac.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gstslshet">gstslshet</a></code>, <code><a href="#topic+stslshac">stslshac</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(spdep)
data(columbus)
listw &lt;- nb2listw(col.gal.nb)
res &lt;- spreg(CRIME~HOVAL + INC, data=columbus, listw=listw, model ="sarar")
summary(res)
</code></pre>

<hr>
<h2 id='utilities'>Functions used by gstslshet.</h2><span id='topic+utilities'></span><span id='topic+fistslsfast'></span><span id='topic+fistslserror'></span><span id='topic+fifour'></span><span id='topic+fierror'></span><span id='topic+Ggfastfast'></span><span id='topic+arg'></span><span id='topic+arg1'></span><span id='topic+Omega'></span><span id='topic+Omegabis'></span>

<h3>Description</h3>


<ul>
<li> <p><code>arg</code> and <code>arg1</code> are the objective functions of the non-linear 
estimators in the GMM procedure. 
</p>
</li>
<li> <p><code>Omega</code> and <code>Omegabis</code> generates the variance-covariance matrices 
of the Original and Transformed models (See Arraiz et al., 2007 for details.)
</p>
</li>
<li> <p><code>Ggfastfast</code> calculates G and g.
</p>
</li>
<li><p> All other functions perform calculations to estimates various objects 
defined in Appendix B2 and B3 in Arraiz et al., 2007.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Gianfranco Piras <a href="mailto:gpiras@mac.com">gpiras@mac.com</a>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
