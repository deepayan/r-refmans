<!DOCTYPE html><html lang="en-US"><head><title>Help for package stats19</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {stats19}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#accidents_sample'><p>Sample of stats19 data (2022 collisions)</p></a></li>
<li><a href='#casualties_sample'><p>Sample of stats19 data (2022 casualties)</p></a></li>
<li><a href='#check_input_file'><p>Local helper to be reused.</p></a></li>
<li><a href='#dl_stats19'><p>Download STATS19 data for a year</p></a></li>
<li><a href='#file_names'><p>stats19 file names for easy access</p></a></li>
<li><a href='#find_file_name'><p>Find file names within stats19::file_names.</p></a></li>
<li><a href='#format_casualties'><p>Format STATS19 casualties</p></a></li>
<li><a href='#format_collisions'><p>Format STATS19 'collisions' data</p></a></li>
<li><a href='#format_column_names'><p>Format column names of raw STATS19 data</p></a></li>
<li><a href='#format_ppp'><p>Convert STATS19 data into ppp (spatstat) format.</p></a></li>
<li><a href='#format_sf'><p>Format convert STATS19 data into spatial (sf) object</p></a></li>
<li><a href='#format_vehicles'><p>Format STATS19 vehicles data</p></a></li>
<li><a href='#get_data_directory'><p>Get data download dir</p></a></li>
<li><a href='#get_MOT'><p>Download vehicle data from the DVSA MOT API using VRM.</p></a></li>
<li><a href='#get_stats19'><p>Download, read and format STATS19 data in one function.</p></a></li>
<li><a href='#get_stats19_adjustments'><p>Download and read-in severity adjustment factors</p></a></li>
<li><a href='#get_ULEZ'><p>Download DVLA-based vehicle data from the TfL API using VRM.</p></a></li>
<li><a href='#get_url'><p>Convert file names to urls</p></a></li>
<li><a href='#locate_files'><p>Locate a file on disk</p></a></li>
<li><a href='#locate_one_file'><p>Pin down a file on disk from four parameters.</p></a></li>
<li><a href='#phrase'><p>Generate a phrase for data download purposes</p></a></li>
<li><a href='#police_boundaries'><p>Police force boundaries in England (2016)</p></a></li>
<li><a href='#read_casualties'><p>Read in STATS19 road safety data from .csv files downloaded.</p></a></li>
<li><a href='#read_collisions'><p>Read in STATS19 road safety data from .csv files downloaded.</p></a></li>
<li><a href='#read_vehicles'><p>Read in stats19 road safety data from .csv files downloaded.</p></a></li>
<li><a href='#schema_original'><p>Schema for stats19 data (UKDS)</p></a></li>
<li><a href='#select_file'><p>Interactively select from options</p></a></li>
<li><a href='#set_data_directory'><p>Set data download dir</p></a></li>
<li><a href='#stats19_schema'><p>Stats19 schema and variables</p></a></li>
<li><a href='#vehicles_sample'><p>Sample of stats19 data (2022 vehicles)</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Work with Open Road Traffic Casualty Data from Great Britain</td>
</tr>
<tr>
<td>Version:</td>
<td>3.3.1</td>
</tr>
<tr>
<td>Description:</td>
<td>Tools to help download, process and analyse the UK road collision data collected using the
  'STATS19' form. The datasets are provided as 'CSV' files with detailed road safety information about the
  circumstances of car crashes and other incidents on the roads resulting in casualties in Great Britain
  from 1979 to present. Tables are available on 'colissions' with the circumstances (e.g. speed limit
  of road), information about  'vehicles' involved (e.g. type of vehicle), and 'casualties' (e.g. age).
  The statistics relate only to events on public roads that were reported
  to the police, and subsequently recorded, using the 'STATS19' collision reporting form. See
  the Department for Transport website 
  <a href="https://www.data.gov.uk/dataset/cb7ae6f0-4be6-4935-9277-47e5ce24a11f/road-accidents-safety-data">https://www.data.gov.uk/dataset/cb7ae6f0-4be6-4935-9277-47e5ce24a11f/road-accidents-safety-data</a> for more
  information on these datasets.
  The package is described in a paper in the Journal of Open Source Software
  (Lovelace et al. 2019) &lt;<a href="https://doi.org/10.21105%2Fjoss.01181">doi:10.21105/joss.01181</a>&gt;.
  See 
  Gilardi et al. (2022) &lt;<a href="https://doi.org/10.1111%2Frssa.12823">doi:10.1111/rssa.12823</a>&gt;,
  Vidal-Tortosa et al. (2021) &lt;<a href="https://doi.org/10.1016%2Fj.jth.2021.101291">doi:10.1016/j.jth.2021.101291</a>&gt;, and
  Tait et al. (2023) &lt;<a href="https://doi.org/10.1016%2Fj.aap.2022.106895">doi:10.1016/j.aap.2022.106895</a>&gt; for examples of how the data can be used for
  methodological and empirical road safety research.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/ropensci/stats19">https://github.com/ropensci/stats19</a>,
<a href="https://docs.ropensci.org/stats19/">https://docs.ropensci.org/stats19/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/ropensci/stats19/issues">https://github.com/ropensci/stats19/issues</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>methods, sf, readr, tools</td>
</tr>
<tr>
<td>Suggests:</td>
<td>curl (&ge; 3.2), dplyr, ggplot2, knitr, lubridate, rmarkdown,
stringr, testthat (&ge; 2.1.0), tidyr, pkgdown, kableExtra,
leaflet, geojsonsf, htmltools, tmap, jsonlite, spatstat.geom,
osmdata, covr</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>X-schema.org-keywords:</td>
<td>stats19, road-safety, transport, car-crashes,
ropensci, data</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-01-14 23:50:12 UTC; robin</td>
</tr>
<tr>
<td>Author:</td>
<td>Robin Lovelace <a href="https://orcid.org/0000-0001-5679-6536"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Malcolm Morgan <a href="https://orcid.org/0000-0002-9488-9183"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Layik Hama <a href="https://orcid.org/0000-0003-1912-4890"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Mark Padgham <a href="https://orcid.org/0000-0003-2172-5265"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  David Ranzolin [rev],
  Adam Sparks <a href="https://orcid.org/0000-0002-0061-8359"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [rev,
    ctb],
  Ivo Wengraf [ctb],
  RAC Foundation [fnd]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Robin Lovelace &lt;rob00x@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-01-15 08:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='accidents_sample'>Sample of stats19 data (2022 collisions)</h2><span id='topic+accidents_sample'></span><span id='topic+accidents_sample_raw'></span>

<h3>Description</h3>

<p>Sample of stats19 data (2022 collisions)
</p>


<h3>Format</h3>

<p>A data frame
</p>


<h3>Note</h3>

<p>These were generated using the script in the
<code>data-raw</code> directory (<code>misc.Rmd</code> file).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
nrow(accidents_sample_raw)
accidents_sample_raw

</code></pre>

<hr>
<h2 id='casualties_sample'>Sample of stats19 data (2022 casualties)</h2><span id='topic+casualties_sample'></span><span id='topic+casualties_sample_raw'></span>

<h3>Description</h3>

<p>Sample of stats19 data (2022 casualties)
</p>


<h3>Format</h3>

<p>A data frame
</p>


<h3>Note</h3>

<p>These were generated using the script in the
<code>data-raw</code> directory (<code>misc.Rmd</code> file).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
nrow(casualties_sample_raw)
casualties_sample_raw

</code></pre>

<hr>
<h2 id='check_input_file'>Local helper to be reused.</h2><span id='topic+check_input_file'></span>

<h3>Description</h3>

<p>Local helper to be reused.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_input_file(filename = NULL, type = NULL, data_dir = NULL, year = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_input_file_+3A_filename">filename</code></td>
<td>
<p>Character string of the filename of the .csv to read, if this is given, type and
years determine whether there is a target to read, otherwise disk scan would be needed.</p>
</td></tr>
<tr><td><code id="check_input_file_+3A_type">type</code></td>
<td>
<p>The type of file to be downloaded (e.g. 'collisions', 'casualty' or
'vehicles'). Not case sensitive and searches using regular expressions ('acc' will work).</p>
</td></tr>
<tr><td><code id="check_input_file_+3A_data_dir">data_dir</code></td>
<td>
<p>Where sets of downloaded data would be found.</p>
</td></tr>
<tr><td><code id="check_input_file_+3A_year">year</code></td>
<td>
<p>Single year for which data are to be read</p>
</td></tr>
</table>

<hr>
<h2 id='dl_stats19'>Download STATS19 data for a year</h2><span id='topic+dl_stats19'></span>

<h3>Description</h3>

<p>Download STATS19 data for a year
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dl_stats19(
  year = NULL,
  type = NULL,
  data_dir = get_data_directory(),
  file_name = NULL,
  ask = FALSE,
  silent = FALSE,
  timeout = 600
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dl_stats19_+3A_year">year</code></td>
<td>
<p>A year matching file names on the STATS19
<a href="https://www.data.gov.uk/dataset/cb7ae6f0-4be6-4935-9277-47e5ce24a11f/road-accidents-safety-data">data release page</a>
e.g. <code>2020</code></p>
</td></tr>
<tr><td><code id="dl_stats19_+3A_type">type</code></td>
<td>
<p>One of 'collision', 'casualty', 'Vehicle'; defaults to 'collision'.
This text string is used to match the file names released by the DfT.</p>
</td></tr>
<tr><td><code id="dl_stats19_+3A_data_dir">data_dir</code></td>
<td>
<p>Parent directory for all downloaded files. Defaults to <code>tempdir()</code>.</p>
</td></tr>
<tr><td><code id="dl_stats19_+3A_file_name">file_name</code></td>
<td>
<p>The file name (DfT named) to download.</p>
</td></tr>
<tr><td><code id="dl_stats19_+3A_ask">ask</code></td>
<td>
<p>Should you be asked whether or not to download the files? <code>TRUE</code> by default.</p>
</td></tr>
<tr><td><code id="dl_stats19_+3A_silent">silent</code></td>
<td>
<p>Boolean. If <code>FALSE</code> (default value), display useful progress
messages on the screen.</p>
</td></tr>
<tr><td><code id="dl_stats19_+3A_timeout">timeout</code></td>
<td>
<p>Timeout in seconds for the download if current option is less than
this value. Defaults to 600 (10 minutes).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function downloads and unzips UK road crash data.
It results in unzipped .csv files that are put
in the temporary directory specified by <code>get_data_directory()</code> or provided <code>data_dir</code>.
</p>
<p>The file downloaded would be for a specific year (e.g. 2022).
It could also be a file containing data for a range of two (e.g. 2005-2014).
</p>
<p>The <code style="white-space: pre;">&#8288;dl_*&#8288;</code> functions can download many MB of data so ensure you
have a sufficient internet access and hard disk space.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_stats19">get_stats19()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if (curl::has_internet()) {
  # type by default is collisions table
  dl_stats19(year = 2022)
  # with type as casualty
  dl_stats19(year = 2022, type = "casualty")
  # try another year
  dl_stats19(year = 2023)
}

</code></pre>

<hr>
<h2 id='file_names'>stats19 file names for easy access</h2><span id='topic+file_names'></span><span id='topic+file_names_old'></span>

<h3>Description</h3>

<p>URL decoded file names. Currently there are 52 file names
released by the DfT (Department for Transport) and the details include
how these were obtained and would be kept up to date.
</p>


<h3>Format</h3>

<p>A named list
</p>


<h3>Note</h3>

<p>These were generated using the script in the
<code>data-raw</code> directory (<code>misc.Rmd</code> file).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>head(file_names)
</code></pre>

<hr>
<h2 id='find_file_name'>Find file names within stats19::file_names.</h2><span id='topic+find_file_name'></span>

<h3>Description</h3>

<p>Currently, there are 52 file names to download/read data from.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>find_file_name(years = NULL, type = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="find_file_name_+3A_years">years</code></td>
<td>
<p>Year for which data are to be found</p>
</td></tr>
<tr><td><code id="find_file_name_+3A_type">type</code></td>
<td>
<p>One of 'collisions', 'casualty' or
'vehicles' ignores case.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>find_file_name(2016)
find_file_name(2016, type = "collision")
find_file_name(1985, type = "collision")
find_file_name(type = "cas")
find_file_name(type = "collision")
find_file_name(2016:2022) # warning when multiple years requested
</code></pre>

<hr>
<h2 id='format_casualties'>Format STATS19 casualties</h2><span id='topic+format_casualties'></span>

<h3>Description</h3>

<p>Format STATS19 casualties
</p>


<h3>Usage</h3>

<pre><code class='language-R'>format_casualties(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="format_casualties_+3A_x">x</code></td>
<td>
<p>Data frame created with <code>read_casualties()</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function formats raw STATS19 data
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if(curl::has_internet()) {
dl_stats19(year = 2022, type = "casualty")
x = read_casualties(year = 2022)
casualties = format_casualties(x)
}

</code></pre>

<hr>
<h2 id='format_collisions'>Format STATS19 'collisions' data</h2><span id='topic+format_collisions'></span>

<h3>Description</h3>

<p>Format STATS19 'collisions' data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>format_collisions(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="format_collisions_+3A_x">x</code></td>
<td>
<p>Data frame created with <code>read_collisions()</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is a helper function to format raw STATS19 data
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  if(curl::has_internet()) {
    dl_stats19(year = 2022, type = "collision")
  }

</code></pre>

<hr>
<h2 id='format_column_names'>Format column names of raw STATS19 data</h2><span id='topic+format_column_names'></span>

<h3>Description</h3>

<p>This function takes messy column names and returns clean ones that work well with
R by default. Names that are all lower case with no R-unfriendly characters
such as spaces and <code>-</code> are returned.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>format_column_names(column_names)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="format_column_names_+3A_column_names">column_names</code></td>
<td>
<p>Column names to be cleaned</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Column names cleaned.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if(curl::has_internet()) {
crashes_raw = read_collisions(year = 2022)
column_names = names(crashes_raw)
column_names
format_column_names(column_names = column_names)
}

</code></pre>

<hr>
<h2 id='format_ppp'>Convert STATS19 data into ppp (spatstat) format.</h2><span id='topic+format_ppp'></span>

<h3>Description</h3>

<p>This function is a wrapper around the <code><a href="spatstat.geom.html#topic+ppp">spatstat.geom::ppp()</a></code> function and
it is used to transform STATS19 data into a ppp format.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>format_ppp(data, window = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="format_ppp_+3A_data">data</code></td>
<td>
<p>A STATS19 dataframe to be converted into ppp format.</p>
</td></tr>
<tr><td><code id="format_ppp_+3A_window">window</code></td>
<td>
<p>A windows of observation, an object of class <code>owin()</code>. If
<code>window = NULL</code> (i.e. the default) then the function creates an approximate
bounding box covering the whole UK. It can also be used to filter only the
events occurring in a specific region of UK (see the examples of
<code><a href="#topic+get_stats19">get_stats19</a></code>).</p>
</td></tr>
<tr><td><code id="format_ppp_+3A_...">...</code></td>
<td>
<p>Additional parameters that should be passed to
<code><a href="spatstat.geom.html#topic+ppp">spatstat.geom::ppp()</a></code> function. Read the help page of that function
for a detailed description of the available parameters.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ppp object.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+format_sf">format_sf</a></code> for an analogous function used to convert
data into sf format and <code><a href="spatstat.geom.html#topic+ppp">spatstat.geom::ppp()</a></code> for the original function.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if (requireNamespace("spatstat.geom", quietly = TRUE)) {
  x_ppp = format_ppp(accidents_sample)
  x_ppp
}

</code></pre>

<hr>
<h2 id='format_sf'>Format convert STATS19 data into spatial (sf) object</h2><span id='topic+format_sf'></span>

<h3>Description</h3>

<p>Format convert STATS19 data into spatial (sf) object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>format_sf(x, lonlat = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="format_sf_+3A_x">x</code></td>
<td>
<p>Data frame created with <code>read_collisions()</code></p>
</td></tr>
<tr><td><code id="format_sf_+3A_lonlat">lonlat</code></td>
<td>
<p>Should the results be returned in longitude/latitude?
By default <code>FALSE</code>, meaning the British National Grid (EPSG code: 27700)
is used.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>x_sf = format_sf(accidents_sample)
sf:::plot.sf(x_sf)
</code></pre>

<hr>
<h2 id='format_vehicles'>Format STATS19 vehicles data</h2><span id='topic+format_vehicles'></span>

<h3>Description</h3>

<p>Format STATS19 vehicles data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>format_vehicles(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="format_vehicles_+3A_x">x</code></td>
<td>
<p>Data frame created with <code>read_vehicles()</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function formats raw STATS19 data
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if(curl::has_internet()) {
dl_stats19(year = 2022, type = "vehicle", ask = FALSE)
x = read_vehicles(year = 2022, format = FALSE)
vehicles = format_vehicles(x)
}

</code></pre>

<hr>
<h2 id='get_data_directory'>Get data download dir</h2><span id='topic+get_data_directory'></span>

<h3>Description</h3>

<p>Get data download dir
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_data_directory()
</code></pre>


<h3>Examples</h3>

<pre><code class='language-R'># get_data_directory()
</code></pre>

<hr>
<h2 id='get_MOT'>Download vehicle data from the DVSA MOT API using VRM.</h2><span id='topic+get_MOT'></span>

<h3>Description</h3>

<p>Download vehicle data from the DVSA MOT API using VRM.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_MOT(vrm, apikey)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_MOT_+3A_vrm">vrm</code></td>
<td>
<p>A list of VRMs as character strings.</p>
</td></tr>
<tr><td><code id="get_MOT_+3A_apikey">apikey</code></td>
<td>
<p>Your API key as a character string.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function takes a a character vector of vehicle registrations (VRMs) and returns vehicle data from MOT records.
It returns a data frame of those VRMs which were successfully used with the DVSA MOT API.
</p>
<p>Information on the DVSA MOT API is available here:
https://dvsa.github.io/mot-history-api-documentation/
</p>
<p>The DVSA MOT API requires a registration.  The function therefore requires the API key provided by the DVSA.
Be aware that the API has usage limits.  The function will therefore limit lists with more than 150,000 VRMs.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
vrm = c("1RAC","P1RAC")
apikey = Sys.getenv("MOTKEY")
if(nchar(apikey) &gt; 0) {
  get_MOT(vrm = vrm, apikey = apikey)
}

</code></pre>

<hr>
<h2 id='get_stats19'>Download, read and format STATS19 data in one function.</h2><span id='topic+get_stats19'></span>

<h3>Description</h3>

<p>Download, read and format STATS19 data in one function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_stats19(
  year = NULL,
  type = "collision",
  data_dir = get_data_directory(),
  file_name = NULL,
  format = TRUE,
  ask = FALSE,
  silent = FALSE,
  output_format = "tibble",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_stats19_+3A_year">year</code></td>
<td>
<p>A year matching file names on the STATS19
<a href="https://www.data.gov.uk/dataset/cb7ae6f0-4be6-4935-9277-47e5ce24a11f/road-accidents-safety-data">data release page</a>
e.g. <code>2020</code></p>
</td></tr>
<tr><td><code id="get_stats19_+3A_type">type</code></td>
<td>
<p>One of 'collision', 'casualty', 'Vehicle'; defaults to 'collision'.
This text string is used to match the file names released by the DfT.</p>
</td></tr>
<tr><td><code id="get_stats19_+3A_data_dir">data_dir</code></td>
<td>
<p>Parent directory for all downloaded files. Defaults to <code>tempdir()</code>.</p>
</td></tr>
<tr><td><code id="get_stats19_+3A_file_name">file_name</code></td>
<td>
<p>The file name (DfT named) to download.</p>
</td></tr>
<tr><td><code id="get_stats19_+3A_format">format</code></td>
<td>
<p>Switch to return raw read from file, default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="get_stats19_+3A_ask">ask</code></td>
<td>
<p>Should you be asked whether or not to download the files? <code>TRUE</code> by default.</p>
</td></tr>
<tr><td><code id="get_stats19_+3A_silent">silent</code></td>
<td>
<p>Boolean. If <code>FALSE</code> (default value), display useful progress
messages on the screen.</p>
</td></tr>
<tr><td><code id="get_stats19_+3A_output_format">output_format</code></td>
<td>
<p>A string that specifies the desired output format. The
default value is <code>"tibble"</code>. Other possible values are <code>"data.frame"</code>, <code>"sf"</code>
and <code>"ppp"</code>, that, respectively, returns objects of class <code><a href="base.html#topic+data.frame">data.frame</a></code>,
<code><a href="sf.html#topic+sf">sf::sf</a></code> and <code><a href="spatstat.geom.html#topic+ppp">spatstat.geom::ppp</a></code>. Any other string is ignored and a tibble
output is returned. See details and examples.</p>
</td></tr>
<tr><td><code id="get_stats19_+3A_...">...</code></td>
<td>
<p>Other arguments be passed to <code><a href="#topic+format_sf">format_sf()</a></code> or
<code><a href="#topic+format_ppp">format_ppp()</a></code> functions. Read and run the examples.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function uses gets STATS19 data. Behind the scenes it uses
<code>dl_stats19()</code> and <code style="white-space: pre;">&#8288;read_*&#8288;</code> functions, returning a
<code>tibble</code> (default), <code>data.frame</code>, <code>sf</code> or <code>ppp</code> object, depending on the
<code>output_format</code> parameter.
The function returns data for a specific year (e.g. <code>year = 2022</code>)
</p>
<p>Note: for years before 2016 the function may return data from more years than are
requested due to the nature of the files hosted at
<a href="https://www.data.gov.uk/dataset/cb7ae6f0-4be6-4935-9277-47e5ce24a11f/road-accidents-safety-data">data.gov.uk</a>.
</p>
<p>As this function uses <code>dl_stats19</code> function, it can download many MB of data,
so ensure you have a sufficient disk space.
</p>
<p>If <code>output_format = "data.frame"</code> or <code>output_format = "sf"</code> or <code>output_format = "ppp"</code> then the output data is transformed into a data.frame, sf or ppp
object using the <code><a href="base.html#topic+as.data.frame">as.data.frame()</a></code> or <code><a href="#topic+format_sf">format_sf()</a></code> or <code><a href="#topic+format_ppp">format_ppp()</a></code>
functions, as shown in the examples.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dl_stats19">dl_stats19()</a></code>
</p>
<p><code><a href="#topic+read_collisions">read_collisions()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if(curl::has_internet()) {
col = get_stats19(year = 2022, type = "collision")
cas2 = get_stats19(year = 2022, type = "casualty")
veh = get_stats19(year = 2022, type = "vehicle")
class(col)
# data.frame output
x = get_stats19(2022, silent = TRUE, output_format = "data.frame")
class(x)

# Run tests only if endpoint is alive:
if(nrow(x) &gt; 0) {

# sf output
x_sf = get_stats19(2022, silent = TRUE, output_format = "sf")

# sf output with lonlat coordinates
x_sf = get_stats19(2022, silent = TRUE, output_format = "sf", lonlat = TRUE)
sf::st_crs(x_sf)

if (requireNamespace("spatstat.geom", quietly = TRUE)) {
# ppp output
x_ppp = get_stats19(2022, silent = TRUE, output_format = "ppp")

# We can use the window parameter of format_ppp function to filter only the
# events occurred in a specific area. For example we can create a new bbox
# of 5km around the city center of Leeds

leeds_window = spatstat.geom::owin(
xrange = c(425046.1, 435046.1),
yrange = c(428577.2, 438577.2)
)

leeds_ppp = get_stats19(2022, silent = TRUE, output_format = "ppp", window = leeds_window)
spatstat.geom::plot.ppp(leeds_ppp, use.marks = FALSE, clipwin = leeds_window)

# or even more fancy examples where we subset all the events occurred in a
# pre-defined polygon area

# The following example requires osmdata package
# greater_london_sf_polygon = osmdata::getbb(
# "Greater London, UK",
# format_out = "sf_polygon"
# )
# spatstat works only with planar coordinates
# greater_london_sf_polygon = sf::st_transform(greater_london_sf_polygon, 27700)
# then we extract the coordinates and create the window object.
# greater_london_polygon = sf::st_coordinates(greater_london_sf_polygon)[, c(1, 2)]
# greater_london_window = spatstat.geom::owin(poly = greater_london_polygon)

# greater_london_ppp = get_stats19(2022, output_format = "ppp", window = greater_london_window)
# spatstat.geom::plot.ppp(greater_london_ppp, use.marks = FALSE, clipwin = greater_london_window)
}
}
}

</code></pre>

<hr>
<h2 id='get_stats19_adjustments'>Download and read-in severity adjustment factors</h2><span id='topic+get_stats19_adjustments'></span>

<h3>Description</h3>

<p>See the DfT's documentation on adjustment factors
<a href="https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/833813/annex-update-severity-adjustments-methodology.pdf">Annex: Update to severity adjustments methodology</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_stats19_adjustments(
  data_dir = get_data_directory(),
  u = paste0("https://data.dft.gov.uk/road-accidents-safety-data/",
    "dft-road-casualty-statistics-casualty-adjustment-lookup_",
    "2004-latest-published-year.csv")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_stats19_adjustments_+3A_data_dir">data_dir</code></td>
<td>
<p>Where sets of downloaded data would be found.</p>
</td></tr>
<tr><td><code id="get_stats19_adjustments_+3A_u">u</code></td>
<td>
<p>The URL of the zip file with adjustments to download</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <a href="https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/820588/severity-reporting-methodology-final-report.odt">Estimating and adjusting for changes in the method of severity reporting for road accidents and casualty data: final report</a>
for details.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if(curl::has_internet()) {
adjustment = get_stats19_adjustments()
}

</code></pre>

<hr>
<h2 id='get_ULEZ'>Download DVLA-based vehicle data from the TfL API using VRM.</h2><span id='topic+get_ULEZ'></span>

<h3>Description</h3>

<p>Download DVLA-based vehicle data from the TfL API using VRM.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_ULEZ(vrm)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_ULEZ_+3A_vrm">vrm</code></td>
<td>
<p>A list of VRMs as character strings.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function takes a character vector of vehicle registrations (VRMs) and returns DVLA-based vehicle data from TfL's API, included ULEZ eligibility.
It returns a data frame of those VRMs which were successfully used with the TfL API.  Vehicles are either compliant, non-compliant or exempt.  ULEZ-exempt vehicles will not have all vehicle details returned - they will simply be marked &quot;exempt&quot;.
</p>
<p>Be aware that the API has usage limits.  The function will therefore limit API calls to below 50 per minute - this is the maximum rate before an API key is required.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if(curl::has_internet()) {
vrm = c("1RAC","P1RAC")
get_ULEZ(vrm = vrm)
}

</code></pre>

<hr>
<h2 id='get_url'>Convert file names to urls</h2><span id='topic+get_url'></span>

<h3>Description</h3>

<p>Convert file names to urls
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_url(
  file_name = "",
  domain = "https://data.dft.gov.uk",
  directory = "road-accidents-safety-data"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_url_+3A_file_name">file_name</code></td>
<td>
<p>Optional file name to add to the url returned (empty by default)</p>
</td></tr>
<tr><td><code id="get_url_+3A_domain">domain</code></td>
<td>
<p>The domain from where the data will be downloaded</p>
</td></tr>
<tr><td><code id="get_url_+3A_directory">directory</code></td>
<td>
<p>The subdirectory of the url</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function returns urls that allow data to be downloaded from the pages:
</p>
<p>https://data.dft.gov.uk/road-accidents-safety-data/RoadSafetyData_2015.zip
</p>
<p>Last updated: October 2020.
Files available from the s3 url in the default <code>domain</code> argument.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># get_url(find_file_name(1985))
</code></pre>

<hr>
<h2 id='locate_files'>Locate a file on disk</h2><span id='topic+locate_files'></span>

<h3>Description</h3>

<p>Helper function to locate files. Given below params, the function
returns 0 or more files found at location/names given.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>locate_files(
  data_dir = get_data_directory(),
  type = NULL,
  years = NULL,
  quiet = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="locate_files_+3A_data_dir">data_dir</code></td>
<td>
<p>Super directory where dataset(s) were first downloaded to.</p>
</td></tr>
<tr><td><code id="locate_files_+3A_type">type</code></td>
<td>
<p>One of 'Collision', 'Casualties', 'Vehicles'; defaults to 'Collision', ignores case.</p>
</td></tr>
<tr><td><code id="locate_files_+3A_years">years</code></td>
<td>
<p>Years for which data are to be found</p>
</td></tr>
<tr><td><code id="locate_files_+3A_quiet">quiet</code></td>
<td>
<p>Print out messages (files found)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Character string representing the full path of a single file found,
list of directories where data from the Department for Transport
(stats19::filenames) have been downloaded, or NULL if no files were found.
</p>

<hr>
<h2 id='locate_one_file'>Pin down a file on disk from four parameters.</h2><span id='topic+locate_one_file'></span>

<h3>Description</h3>

<p>Pin down a file on disk from four parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>locate_one_file(
  filename = NULL,
  data_dir = get_data_directory(),
  year = NULL,
  type = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="locate_one_file_+3A_filename">filename</code></td>
<td>
<p>Character string of the filename of the .csv to read, if this
is given, type and years determine whether there is a target to read,
otherwise disk scan would be needed.</p>
</td></tr>
<tr><td><code id="locate_one_file_+3A_data_dir">data_dir</code></td>
<td>
<p>Where sets of downloaded data would be found.</p>
</td></tr>
<tr><td><code id="locate_one_file_+3A_year">year</code></td>
<td>
<p>Single year for which file is to be found.</p>
</td></tr>
<tr><td><code id="locate_one_file_+3A_type">type</code></td>
<td>
<p>One of: 'Collision', 'Casualties', 'Vehicles'; ignores case.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>One of: path for one file, a message <code style="white-space: pre;">&#8288;More than one file found&#8288;</code> or error if none found.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
locate_one_file()
locate_one_file(filename = "Cas.csv")

</code></pre>

<hr>
<h2 id='phrase'>Generate a phrase for data download purposes</h2><span id='topic+phrase'></span>

<h3>Description</h3>

<p>Generate a phrase for data download purposes
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phrase()
</code></pre>


<h3>Examples</h3>

<pre><code class='language-R'>stats19:::phrase()
</code></pre>

<hr>
<h2 id='police_boundaries'>Police force boundaries in England (2016)</h2><span id='topic+police_boundaries'></span>

<h3>Description</h3>

<p>This dataset represents the 43 police forces in England and Wales.
These are described on the
<a href="https://en.wikipedia.org/wiki/List_of_police_forces_of_the_United_Kingdom">Wikipedia page</a>.
on UK police forces.
</p>


<h3>Format</h3>

<p>An sf data frame
</p>


<h3>Details</h3>

<p>The geographic boundary data were taken from the UK government's
official geographic data portal.
See http://geoportal.statistics.gov.uk/
</p>


<h3>Note</h3>

<p>These were generated using the script in the
<code>data-raw</code> directory (<code>misc.Rmd</code> file) in the package's GitHub repo:
<a href="https://github.com/ITSLeeds/stats19">github.com/ITSLeeds/stats19</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>nrow(police_boundaries)
police_boundaries[police_boundaries$pfa16nm == "West Yorkshire", ]
sf:::plot.sf(police_boundaries)
</code></pre>

<hr>
<h2 id='read_casualties'>Read in STATS19 road safety data from .csv files downloaded.</h2><span id='topic+read_casualties'></span>

<h3>Description</h3>

<p>Read in STATS19 road safety data from .csv files downloaded.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_casualties(
  year = NULL,
  filename = "",
  data_dir = get_data_directory(),
  format = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="read_casualties_+3A_year">year</code></td>
<td>
<p>Single year for which data are to be read</p>
</td></tr>
<tr><td><code id="read_casualties_+3A_filename">filename</code></td>
<td>
<p>Character string of the filename of the .csv to read, if this is given, type and
years determine whether there is a target to read, otherwise disk scan would be needed.</p>
</td></tr>
<tr><td><code id="read_casualties_+3A_data_dir">data_dir</code></td>
<td>
<p>Where sets of downloaded data would be found.</p>
</td></tr>
<tr><td><code id="read_casualties_+3A_format">format</code></td>
<td>
<p>Switch to return raw read from file, default is <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function returns a data frame, in which each record is a reported casualty
in the STATS19 dataset.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if(curl::has_internet()) {
dl_stats19(year = 2022, type = "casualty")
casualties = read_casualties(year = 2022)
}

</code></pre>

<hr>
<h2 id='read_collisions'>Read in STATS19 road safety data from .csv files downloaded.</h2><span id='topic+read_collisions'></span>

<h3>Description</h3>

<p>Read in STATS19 road safety data from .csv files downloaded.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_collisions(
  year = NULL,
  filename = "",
  data_dir = get_data_directory(),
  format = TRUE,
  silent = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="read_collisions_+3A_year">year</code></td>
<td>
<p>Single year for which data are to be read</p>
</td></tr>
<tr><td><code id="read_collisions_+3A_filename">filename</code></td>
<td>
<p>Character string of the filename of the .csv to read, if this is given, type and
years determine whether there is a target to read, otherwise disk scan would be needed.</p>
</td></tr>
<tr><td><code id="read_collisions_+3A_data_dir">data_dir</code></td>
<td>
<p>Where sets of downloaded data would be found.</p>
</td></tr>
<tr><td><code id="read_collisions_+3A_format">format</code></td>
<td>
<p>Switch to return raw read from file, default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="read_collisions_+3A_silent">silent</code></td>
<td>
<p>Boolean. If <code>FALSE</code> (default value), display useful progress
messages on the screen.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is a wrapper function to access and load stats 19 data in a user-friendly way.
The function returns a data frame, in which each record is a reported incident in the
STATS19 data.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if(curl::has_internet()) {
dl_stats19(year = 2019, type = "collision")
ac = read_collisions(year = 2019)

dl_stats19(year = 2019, type = "collision")
ac_2019 = read_collisions(year = 2019)
}

</code></pre>

<hr>
<h2 id='read_vehicles'>Read in stats19 road safety data from .csv files downloaded.</h2><span id='topic+read_vehicles'></span>

<h3>Description</h3>

<p>Read in stats19 road safety data from .csv files downloaded.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_vehicles(
  year = NULL,
  filename = "",
  data_dir = get_data_directory(),
  format = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="read_vehicles_+3A_year">year</code></td>
<td>
<p>Single year for which data are to be read</p>
</td></tr>
<tr><td><code id="read_vehicles_+3A_filename">filename</code></td>
<td>
<p>Character string of the filename of the .csv to read, if this is given, type and
years determine whether there is a target to read, otherwise disk scan would be needed.</p>
</td></tr>
<tr><td><code id="read_vehicles_+3A_data_dir">data_dir</code></td>
<td>
<p>Where sets of downloaded data would be found.</p>
</td></tr>
<tr><td><code id="read_vehicles_+3A_format">format</code></td>
<td>
<p>Switch to return raw read from file, default is <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function returns a data frame, in which each record is a reported vehicle in the
STATS19 dataset for the data_dir and filename provided.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if(curl::has_internet()) {
dl_stats19(year = 2019, type = "vehicle")
ve = read_vehicles(year = 2019)
}

</code></pre>

<hr>
<h2 id='schema_original'>Schema for stats19 data (UKDS)</h2><span id='topic+schema_original'></span>

<h3>Description</h3>

<p>Schema for stats19 data (UKDS)
</p>


<h3>Format</h3>

<p>A data frame
</p>

<hr>
<h2 id='select_file'>Interactively select from options</h2><span id='topic+select_file'></span>

<h3>Description</h3>

<p>Interactively select from options
</p>


<h3>Usage</h3>

<pre><code class='language-R'>select_file(fnames)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="select_file_+3A_fnames">fnames</code></td>
<td>
<p>File names to select from</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'># fnames = c("f1", "f2")
# stats19:::select_file(fnames)
</code></pre>

<hr>
<h2 id='set_data_directory'>Set data download dir</h2><span id='topic+set_data_directory'></span>

<h3>Description</h3>

<p>Handy function to manage <code>stats19</code> package underlying environment
variable. If run interactively it makes sure user does not change
directory by mistatke.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_data_directory(data_path)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_data_directory_+3A_data_path">data_path</code></td>
<td>
<p>valid existing path to save downloaded files in.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'># set_data_directory("MY_PATH")
</code></pre>

<hr>
<h2 id='stats19_schema'>Stats19 schema and variables</h2><span id='topic+stats19_schema'></span><span id='topic+stats19_variables'></span>

<h3>Description</h3>

<p><code>stats19_schema</code> and <code>stats19_variables</code> contain
metadata on <span class="pkg">stats19</span> data.
<code>stats19_schema</code> is a look-up table matching
codes provided in the raw stats19 dataset with
character strings.
</p>


<h3>Note</h3>

<p>The schema data can be (re-)generated using the script in the
<code>data-raw</code> directory.
</p>

<hr>
<h2 id='vehicles_sample'>Sample of stats19 data (2022 vehicles)</h2><span id='topic+vehicles_sample'></span><span id='topic+vehicles_sample_raw'></span>

<h3>Description</h3>

<p>Sample of stats19 data (2022 vehicles)
</p>


<h3>Format</h3>

<p>A data frame
</p>


<h3>Note</h3>

<p>These were generated using the script in the
<code>data-raw</code> directory (<code>misc.Rmd</code> file).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
nrow(vehicles_sample_raw)
vehicles_sample_raw

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
