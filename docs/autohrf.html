<!DOCTYPE html><html><head><title>Help for package autohrf</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {autohrf}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#autohrf'><p>autohrf</p></a></li>
<li><a href='#autohrf-datasets'><p>Datasets for autohrf examples</p>
Example datasets for use in <span class="pkg">autohrf</span> examples and vignettes.
The datasets were extracted from the internal
Mind and Brain Lab's (MBLab, <a href="http://www.mblab.si">http://www.mblab.si</a> repository.
MBLab is a research lab at the
Faculty of Arts, Department of Psychology,
University of Ljubljana, Slovenia.</a></li>
<li><a href='#convolve_events'><p>convolve_events</p></a></li>
<li><a href='#convolve_hrf'><p>convolve_hrf</p></a></li>
<li><a href='#create_boynton_hrf'><p>create_boynton_hrf</p></a></li>
<li><a href='#create_child'><p>create_child</p></a></li>
<li><a href='#create_first_generation'><p>create_first_generation</p></a></li>
<li><a href='#create_new_generation'><p>create_new_generation</p></a></li>
<li><a href='#create_spm_hrf'><p>create_boynton_hrf</p></a></li>
<li><a href='#downsample'><p>downsample</p></a></li>
<li><a href='#evaluate_model'><p>evaluate_model</p></a></li>
<li><a href='#fit_to_constraints'><p>fit_to_constraints</p></a></li>
<li><a href='#get_best_models'><p>get_best_models</p></a></li>
<li><a href='#get_parents'><p>get_parents</p></a></li>
<li><a href='#plot_best_models'><p>plot_best_models</p></a></li>
<li><a href='#plot_events'><p>plot_events</p></a></li>
<li><a href='#plot_fitness'><p>plot_fitness</p></a></li>
<li><a href='#plot_model'><p>plot_model</p></a></li>
<li><a href='#run_model'><p>run_model</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Automated Generation of Data-Informed GLM Models in Task-Based
fMRI Data Analysis</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1.3</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jure Demšar &lt;jure.demsar@fri.uni-lj.si&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Analysis of task-related functional magnetic resonance imaging (fMRI) activity at the level of individual participants is commonly based on general linear modelling (GLM) that allows us to estimate to what extent the blood oxygenation level dependent (BOLD) signal can be explained by task response predictors specified in the GLM model. The predictors are constructed by convolving the hypothesised timecourse of neural activity with an assumed hemodynamic response function (HRF). To get valid and precise estimates of task response, it is important to construct a model of neural activity that best matches actual neuronal activity. The construction of models is most often driven by predefined assumptions on the components of brain activity and their duration based on the task design and specific aims of the study. However, our assumptions about the onset and duration of component processes might be wrong and can also differ across brain regions. This can result in inappropriate or suboptimal models, bad fitting of the model to the actual data and invalid estimations of brain activity. Here we present an approach in which theoretically driven models of task response are used to define constraints based on which the final model is derived computationally using the actual data. Specifically, we developed 'autohrf' — a package for the 'R' programming language that allows for data-driven estimation of HRF models. The package uses genetic algorithms to efficiently search for models that fit the underlying data well. The package uses automated parameter search to find the onset and duration of task predictors which result in the highest fitness of the resulting GLM based on the fMRI signal under predefined restrictions. We evaluate the usefulness of the 'autohrf' package on publicly available datasets of task-related fMRI activity. Our results suggest that by using 'autohrf' users can find better task related brain activity models in a quick and efficient manner.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>cowplot (&ge; 1.1.1), doParallel (&ge; 1.0.17), dplyr (&ge; 1.0.8),
foreach (&ge; 1.5.2), ggplot2 (&ge; 3.3.5), gtools (&ge; 3.9.2),
lubridate (&ge; 1.8.0), magrittr (&ge; 2.0.2), RColorBrewer (&ge;
1.1)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr (&ge; 1.38), testthat (&ge; 3.1.3)</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.0</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/demsarjure/autohrf">https://github.com/demsarjure/autohrf</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/demsarjure/autohrf/issues">https://github.com/demsarjure/autohrf/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-01-16 13:40:36 UTC; jure</td>
</tr>
<tr>
<td>Author:</td>
<td>Jure Demšar [cre, aut],
  Nina Purg [aut],
  Grega Repovš [aut]</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-01-16 14:00:11 UTC</td>
</tr>
</table>
<hr>
<h2 id='autohrf'>autohrf</h2><span id='topic+autohrf'></span>

<h3>Description</h3>

<p>A function that automatically finds the parameters of model's
that best match the underlying data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>autohrf(
  d,
  model_constraints,
  tr,
  roi_weights = NULL,
  allow_overlap = FALSE,
  population = 100,
  iter = 100,
  mutation_rate = 0.1,
  mutation_factor = 0.05,
  elitism = 0.1,
  hrf = "spm",
  t = 32,
  p_boynton = c(2.25, 1.25, 2),
  p_spm = c(6, 16, 1, 1, 6, 0),
  f = 100,
  cores = NULL,
  autohrf = NULL,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="autohrf_+3A_d">d</code></td>
<td>
<p>A dataframe with the signal data: roi, t and y. ROI is the name of
the region, t is the timestamp and y the value of the signal.</p>
</td></tr>
<tr><td><code id="autohrf_+3A_model_constraints">model_constraints</code></td>
<td>
<p>A list of model specifications to use for fitting.
Each specification is represented as a data frame containing information
about it (event, start_time, end_time, min_duration and max_duration).</p>
</td></tr>
<tr><td><code id="autohrf_+3A_tr">tr</code></td>
<td>
<p>MRI's repetition time.</p>
</td></tr>
<tr><td><code id="autohrf_+3A_roi_weights">roi_weights</code></td>
<td>
<p>A data frame with ROI weights: roi, weight. ROI is the
name of the region, weight a number that defines the importance of that roi,
the default weight for a ROI is 1. If set to 2 for a particular ROI that ROI
will be twice as important.</p>
</td></tr>
<tr><td><code id="autohrf_+3A_allow_overlap">allow_overlap</code></td>
<td>
<p>Whether to allow overlap between events.</p>
</td></tr>
<tr><td><code id="autohrf_+3A_population">population</code></td>
<td>
<p>The size of the population in the genetic algorithm.</p>
</td></tr>
<tr><td><code id="autohrf_+3A_iter">iter</code></td>
<td>
<p>Number of iterations in the genetic algorithm.</p>
</td></tr>
<tr><td><code id="autohrf_+3A_mutation_rate">mutation_rate</code></td>
<td>
<p>The mutation rate in the genetic algorithm.</p>
</td></tr>
<tr><td><code id="autohrf_+3A_mutation_factor">mutation_factor</code></td>
<td>
<p>The mutation factor in the genetic algorithm.</p>
</td></tr>
<tr><td><code id="autohrf_+3A_elitism">elitism</code></td>
<td>
<p>The degree of elitism (promote a percentage of the best
solutions) in the genetic algorithm.</p>
</td></tr>
<tr><td><code id="autohrf_+3A_hrf">hrf</code></td>
<td>
<p>Method to use for HRF generation.</p>
</td></tr>
<tr><td><code id="autohrf_+3A_t">t</code></td>
<td>
<p>The t parameter for Boynton or SPM HRF generation.</p>
</td></tr>
<tr><td><code id="autohrf_+3A_p_boynton">p_boynton</code></td>
<td>
<p>Parameters for the Boynton's HRF.</p>
</td></tr>
<tr><td><code id="autohrf_+3A_p_spm">p_spm</code></td>
<td>
<p>Parameters for the SPM HRF.</p>
</td></tr>
<tr><td><code id="autohrf_+3A_f">f</code></td>
<td>
<p>Upsampling factor.</p>
</td></tr>
<tr><td><code id="autohrf_+3A_cores">cores</code></td>
<td>
<p>Number of cores to use for parallel processing. Set to the
number of provided model constraints by default.</p>
</td></tr>
<tr><td><code id="autohrf_+3A_autohrf">autohrf</code></td>
<td>
<p>Results of a previous autohrf run to continue.</p>
</td></tr>
<tr><td><code id="autohrf_+3A_verbose">verbose</code></td>
<td>
<p>Whether to print progress of the fitting process.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing model fits for each of the provided model
specifications.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># prepare model specs
model3 &lt;- data.frame(
  event        = c("encoding", "delay", "response"),
  start_time   = c(0,          2.65,     12.5),
  end_time     = c(3,          12.5,     16)
)

model4 &lt;- data.frame(
  event        = c("fixation", "target", "delay", "response"),
  start_time   = c(0,          2.5,      2.65,    12.5),
  end_time     = c(2.5,        3,        12.5,    15.5)
)

model_constraints &lt;- list(model3, model4)

# run autohrf
df &lt;- flanker
autofit &lt;- autohrf(df, model_constraints, tr = 2.5,
                   population = 2, iter = 2, cores = 1)

</code></pre>

<hr>
<h2 id='autohrf-datasets'>Datasets for autohrf examples
Example datasets for use in <span class="pkg">autohrf</span> examples and vignettes.
The datasets were extracted from the internal
Mind and Brain Lab's (MBLab, <a href="http://www.mblab.si">http://www.mblab.si</a> repository.
MBLab is a research lab at the
Faculty of Arts, Department of Psychology,
University of Ljubljana, Slovenia.</h2><span id='topic+autohrf-datasets'></span><span id='topic+swm'></span><span id='topic+swm_autofit'></span><span id='topic+swm_autofit1'></span><span id='topic+swm_autofit2'></span><span id='topic+flanker'></span><span id='topic+flanker_autofit'></span>

<h3>Description</h3>

<p>Datasets for autohrf examples
Example datasets for use in <span class="pkg">autohrf</span> examples and vignettes.
The datasets were extracted from the internal
Mind and Brain Lab's (MBLab, <a href="http://www.mblab.si">http://www.mblab.si</a> repository.
MBLab is a research lab at the
Faculty of Arts, Department of Psychology,
University of Ljubljana, Slovenia.
</p>


<h3>Format</h3>


<dl>
<dt><code>swm</code></dt><dd>
<p>fMRI dataset for a spatial working memory experiment.
</p>
<p>Source: Internal MBLab repository.
</p>
<p>11520 obs. of 3 variables
</p>

<ul>
<li> <p><code>roi</code> region of interest.
</p>
</li>
<li> <p><code>time</code> time stamp.
</p>
</li>
<li> <p><code>y</code> BOLD value.
</p>
</li></ul>

</dd>
<dt><code>swm_autofit</code></dt><dd>
<p>Stored results from a pre-completed autohrf run.
</p>
<p>Source: Internal MBLab repository.
</p>
</dd>
<dt><code>swm_autofit1</code></dt><dd>
<p>Stored results from a pre-completed autohrf run.
</p>
<p>Source: Internal MBLab repository.
</p>
</dd>
<dt><code>swm_autofit2</code></dt><dd>
<p>Stored results from a pre-completed autohrf run.
</p>
<p>Source: Internal MBLab repository.
</p>
</dd>
<dt><code>flanker</code></dt><dd>
<p>fMRI dataset for a flanker experiment.
</p>
<p>Source: Internal MBLab repository.
</p>
<p>192 obs. of 3 variables
</p>

<ul>
<li> <p><code>roi</code> region of interest.
</p>
</li>
<li> <p><code>time</code> time stamp.
</p>
</li>
<li> <p><code>y</code> BOLD value.
</p>
</li></ul>

</dd>
<dt><code>flanker_autofit</code></dt><dd>
<p>Stored results from a pre-completed autohrf run.
</p>
<p>Source: Internal MBLab repository.
</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'># load swm data
data_swm &lt;- swm

# load the previously completed autofits
autofit &lt;- swm_autofit
autofit1 &lt;- swm_autofit1
autofit2 &lt;- swm_autofit2

# load flanker data
data_flanker &lt;- flanker

# load the previously completed autofits
autofit3 &lt;- flanker_autofit
</code></pre>

<hr>
<h2 id='convolve_events'>convolve_events</h2><span id='topic+convolve_events'></span>

<h3>Description</h3>

<p>A helper function for convolving events of a model with a
generated HRF signal.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>convolve_events(
  model,
  tr,
  max_duration,
  hrf = "spm",
  t = 32,
  p_boynton = c(2.25, 1.25, 2),
  p_spm = c(6, 16, 1, 1, 6, 0),
  f = 100
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="convolve_events_+3A_model">model</code></td>
<td>
<p>A data frame containing information about the model to use
and its events (event, start_time and duration).</p>
</td></tr>
<tr><td><code id="convolve_events_+3A_tr">tr</code></td>
<td>
<p>MRI's repetition time.</p>
</td></tr>
<tr><td><code id="convolve_events_+3A_max_duration">max_duration</code></td>
<td>
<p>Maximum duration of the signal.</p>
</td></tr>
<tr><td><code id="convolve_events_+3A_hrf">hrf</code></td>
<td>
<p>Method to use for HRF generation, can be &quot;boynton&quot; or &quot;spm&quot;.</p>
</td></tr>
<tr><td><code id="convolve_events_+3A_t">t</code></td>
<td>
<p>The t parameter for Boynton or SPM HRF generation.</p>
</td></tr>
<tr><td><code id="convolve_events_+3A_p_boynton">p_boynton</code></td>
<td>
<p>Parameters for the Boynton's HRF.</p>
</td></tr>
<tr><td><code id="convolve_events_+3A_p_spm">p_spm</code></td>
<td>
<p>Parameters for the SPM HRF.</p>
</td></tr>
<tr><td><code id="convolve_events_+3A_f">f</code></td>
<td>
<p>Upsampling factor.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a list with the convolved signal and time series.
</p>

<hr>
<h2 id='convolve_hrf'>convolve_hrf</h2><span id='topic+convolve_hrf'></span>

<h3>Description</h3>

<p>A helper function for convolving HRF with a signal.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>convolve_hrf(y, hrf_s)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="convolve_hrf_+3A_y">y</code></td>
<td>
<p>The signal.</p>
</td></tr>
<tr><td><code id="convolve_hrf_+3A_hrf_s">hrf_s</code></td>
<td>
<p>The HRF.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns the convolution between HRF and the signal.
</p>

<hr>
<h2 id='create_boynton_hrf'>create_boynton_hrf</h2><span id='topic+create_boynton_hrf'></span>

<h3>Description</h3>

<p>A helper function for creating a Boynton HRF.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_boynton_hrf(tr, t = 32, p = c(2.25, 1.25, 2))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_boynton_hrf_+3A_tr">tr</code></td>
<td>
<p>MRI's repetition time.</p>
</td></tr>
<tr><td><code id="create_boynton_hrf_+3A_t">t</code></td>
<td>
<p>The t parameter for Boynton or SPM HRF generation.</p>
</td></tr>
<tr><td><code id="create_boynton_hrf_+3A_p">p</code></td>
<td>
<p>Parameters for the Boynton's HRF.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a Boynton HRF function.
</p>

<hr>
<h2 id='create_child'>create_child</h2><span id='topic+create_child'></span>

<h3>Description</h3>

<p>A helper function for creating a child from parents.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_child(
  start_time,
  end_time,
  n_events,
  mutation_rate,
  mutation_factor,
  current_model,
  p1,
  p2,
  allow_overlap
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_child_+3A_start_time">start_time</code></td>
<td>
<p>A list with model's event start times.</p>
</td></tr>
<tr><td><code id="create_child_+3A_end_time">end_time</code></td>
<td>
<p>A list with model's event end times.</p>
</td></tr>
<tr><td><code id="create_child_+3A_n_events">n_events</code></td>
<td>
<p>Number of events in the model.</p>
</td></tr>
<tr><td><code id="create_child_+3A_mutation_rate">mutation_rate</code></td>
<td>
<p>The mutation rate in the genetic algorithm.</p>
</td></tr>
<tr><td><code id="create_child_+3A_mutation_factor">mutation_factor</code></td>
<td>
<p>The mutation factor in the genetic algorithm.</p>
</td></tr>
<tr><td><code id="create_child_+3A_current_model">current_model</code></td>
<td>
<p>The constraints of the current model.</p>
</td></tr>
<tr><td><code id="create_child_+3A_p1">p1</code></td>
<td>
<p>The first selected parent.</p>
</td></tr>
<tr><td><code id="create_child_+3A_p2">p2</code></td>
<td>
<p>The second selected parent.</p>
</td></tr>
<tr><td><code id="create_child_+3A_allow_overlap">allow_overlap</code></td>
<td>
<p>Whether to allow overlap between events.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A child model created from two parents.
</p>

<hr>
<h2 id='create_first_generation'>create_first_generation</h2><span id='topic+create_first_generation'></span>

<h3>Description</h3>

<p>A helper function for creating the first generation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_first_generation(current_model, n_events, population, allow_overlap)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_first_generation_+3A_current_model">current_model</code></td>
<td>
<p>The constraints of the current model.</p>
</td></tr>
<tr><td><code id="create_first_generation_+3A_n_events">n_events</code></td>
<td>
<p>Number of events in the model.</p>
</td></tr>
<tr><td><code id="create_first_generation_+3A_population">population</code></td>
<td>
<p>The size of the population in the genetic algorithm.</p>
</td></tr>
<tr><td><code id="create_first_generation_+3A_allow_overlap">allow_overlap</code></td>
<td>
<p>Whether to allow overlap between events.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns the first generation of models.
</p>

<hr>
<h2 id='create_new_generation'>create_new_generation</h2><span id='topic+create_new_generation'></span>

<h3>Description</h3>

<p>A helper function for creating a new generation of possible
solutions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_new_generation(
  elitism,
  population,
  start_time,
  end_time,
  fitness,
  n_events,
  mutation_factor,
  mutation_rate,
  current_model,
  allow_overlap
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_new_generation_+3A_elitism">elitism</code></td>
<td>
<p>The degree of elitism (promote a percentage of the best
solutions) in the genetic algorithm.</p>
</td></tr>
<tr><td><code id="create_new_generation_+3A_population">population</code></td>
<td>
<p>The size of the population in the genetic algorithm.</p>
</td></tr>
<tr><td><code id="create_new_generation_+3A_start_time">start_time</code></td>
<td>
<p>A list with model's event start times.</p>
</td></tr>
<tr><td><code id="create_new_generation_+3A_end_time">end_time</code></td>
<td>
<p>A list with model's event end times.</p>
</td></tr>
<tr><td><code id="create_new_generation_+3A_fitness">fitness</code></td>
<td>
<p>A fitness score of all candidate models.</p>
</td></tr>
<tr><td><code id="create_new_generation_+3A_n_events">n_events</code></td>
<td>
<p>Number of events in the model.</p>
</td></tr>
<tr><td><code id="create_new_generation_+3A_mutation_factor">mutation_factor</code></td>
<td>
<p>The mutation factor in the genetic algorithm.</p>
</td></tr>
<tr><td><code id="create_new_generation_+3A_mutation_rate">mutation_rate</code></td>
<td>
<p>The mutation rate in the genetic algorithm.</p>
</td></tr>
<tr><td><code id="create_new_generation_+3A_current_model">current_model</code></td>
<td>
<p>The constraints of the current model.</p>
</td></tr>
<tr><td><code id="create_new_generation_+3A_allow_overlap">allow_overlap</code></td>
<td>
<p>Whether to allow overlap between events.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A new generation of candidate models.
</p>

<hr>
<h2 id='create_spm_hrf'>create_boynton_hrf</h2><span id='topic+create_spm_hrf'></span>

<h3>Description</h3>

<p>A helper function for creating a SPM HRF.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_spm_hrf(tr, t = 32, p = c(6, 16, 1, 1, 6, 0))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_spm_hrf_+3A_tr">tr</code></td>
<td>
<p>MRI's repetition time.</p>
</td></tr>
<tr><td><code id="create_spm_hrf_+3A_t">t</code></td>
<td>
<p>The t parameter for Boynton or SPM HRF generation.</p>
</td></tr>
<tr><td><code id="create_spm_hrf_+3A_p">p</code></td>
<td>
<p>Parameters for the SPM HRF.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a SPM HRF function.
</p>

<hr>
<h2 id='downsample'>downsample</h2><span id='topic+downsample'></span>

<h3>Description</h3>

<p>A helper function for downsampling a given signal.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>downsample(y, f = 100)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="downsample_+3A_y">y</code></td>
<td>
<p>The signal.</p>
</td></tr>
<tr><td><code id="downsample_+3A_f">f</code></td>
<td>
<p>Upsampling factor.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns the downsampled signal.
</p>

<hr>
<h2 id='evaluate_model'>evaluate_model</h2><span id='topic+evaluate_model'></span>

<h3>Description</h3>

<p>A function for evaluating the model against the data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>evaluate_model(
  d,
  model,
  tr,
  roi_weights = NULL,
  hrf = "spm",
  t = 32,
  p_boynton = c(2.25, 1.25, 2),
  p_spm = c(6, 16, 1, 1, 6, 0),
  f = 100,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="evaluate_model_+3A_d">d</code></td>
<td>
<p>A dataframe with the signal data: roi, t and y. ROI is the name of
the region, t is the timestamp and y the value of the signal.</p>
</td></tr>
<tr><td><code id="evaluate_model_+3A_model">model</code></td>
<td>
<p>A data frame containing information about the model to use
and its events (event, start_time and duration).</p>
</td></tr>
<tr><td><code id="evaluate_model_+3A_tr">tr</code></td>
<td>
<p>MRI's repetition time.</p>
</td></tr>
<tr><td><code id="evaluate_model_+3A_roi_weights">roi_weights</code></td>
<td>
<p>A data frame with ROI weights: roi, weight. ROI is the
name of the region, weight a number that defines the importance of that roi,
the default weight for a ROI is 1. If set to 2 for a particular ROI that ROI
will be twice as important.</p>
</td></tr>
<tr><td><code id="evaluate_model_+3A_hrf">hrf</code></td>
<td>
<p>Method to use for HRF generation, can be &quot;boynton&quot; or &quot;spm&quot;.</p>
</td></tr>
<tr><td><code id="evaluate_model_+3A_t">t</code></td>
<td>
<p>The t parameter for Boynton or SPM HRF generation.</p>
</td></tr>
<tr><td><code id="evaluate_model_+3A_p_boynton">p_boynton</code></td>
<td>
<p>Parameters for the Boynton's HRF.</p>
</td></tr>
<tr><td><code id="evaluate_model_+3A_p_spm">p_spm</code></td>
<td>
<p>Parameters for the SPM HRF.</p>
</td></tr>
<tr><td><code id="evaluate_model_+3A_f">f</code></td>
<td>
<p>Upsampling factor.</p>
</td></tr>
<tr><td><code id="evaluate_model_+3A_verbose">verbose</code></td>
<td>
<p>Whether to print a report of the evaluation results.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a list that contains the model, fits of events for
each ROI, convolved events, TR and evaluation scores for each ROI.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># create the model
m &lt;- data.frame(event = c("encoding", "delay", "response"),
start_time = c(0, 2.5, 12.5), duration = c(2.5, 10, 5))

# evaluate
df &lt;- flanker
res &lt;- evaluate_model(df, m, tr = 2.5)

</code></pre>

<hr>
<h2 id='fit_to_constraints'>fit_to_constraints</h2><span id='topic+fit_to_constraints'></span>

<h3>Description</h3>

<p>A helper function for fitting a model to constraints.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_to_constraints(
  model_id,
  d,
  model_constraints,
  tr,
  roi_weights,
  allow_overlap,
  population,
  iter,
  mutation_rate,
  mutation_factor,
  elitism,
  hrf,
  t,
  p_boynton,
  p_spm,
  f,
  autohrf = NULL,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fit_to_constraints_+3A_model_id">model_id</code></td>
<td>
<p>ID of the model.</p>
</td></tr>
<tr><td><code id="fit_to_constraints_+3A_d">d</code></td>
<td>
<p>A dataframe with the signal data: roi, t and y. ROI is the name of
the region, t is the timestamp and y the value of the signal.</p>
</td></tr>
<tr><td><code id="fit_to_constraints_+3A_model_constraints">model_constraints</code></td>
<td>
<p>A list of model specifications to use for fitting.
Each specification is represented as a data frame containing information
about it (event, start_time, end_time, min_duration and max_duration).</p>
</td></tr>
<tr><td><code id="fit_to_constraints_+3A_tr">tr</code></td>
<td>
<p>MRI's repetition time.</p>
</td></tr>
<tr><td><code id="fit_to_constraints_+3A_roi_weights">roi_weights</code></td>
<td>
<p>A data frame with ROI weights: roi, weight. ROI is the
name of the region, weight a number that defines the importance of that roi,
the default weight for a ROI is 1. If set to 2 for a particular ROI that ROI
will be twice as important.</p>
</td></tr>
<tr><td><code id="fit_to_constraints_+3A_allow_overlap">allow_overlap</code></td>
<td>
<p>Whether to allow overlap between events.</p>
</td></tr>
<tr><td><code id="fit_to_constraints_+3A_population">population</code></td>
<td>
<p>The size of the population in the genetic algorithm.</p>
</td></tr>
<tr><td><code id="fit_to_constraints_+3A_iter">iter</code></td>
<td>
<p>Number of iterations in the genetic algorithm.</p>
</td></tr>
<tr><td><code id="fit_to_constraints_+3A_mutation_rate">mutation_rate</code></td>
<td>
<p>The mutation rate in the genetic algorithm.</p>
</td></tr>
<tr><td><code id="fit_to_constraints_+3A_mutation_factor">mutation_factor</code></td>
<td>
<p>The mutation factor in the genetic algorithm.</p>
</td></tr>
<tr><td><code id="fit_to_constraints_+3A_elitism">elitism</code></td>
<td>
<p>The degree of elitism (promote a percentage of the best
solutions) in the genetic algorithm.</p>
</td></tr>
<tr><td><code id="fit_to_constraints_+3A_hrf">hrf</code></td>
<td>
<p>Method to use for HRF generation.</p>
</td></tr>
<tr><td><code id="fit_to_constraints_+3A_t">t</code></td>
<td>
<p>The t parameter for Boynton or SPM HRF generation.</p>
</td></tr>
<tr><td><code id="fit_to_constraints_+3A_p_boynton">p_boynton</code></td>
<td>
<p>Parameters for the Boynton's HRF.</p>
</td></tr>
<tr><td><code id="fit_to_constraints_+3A_p_spm">p_spm</code></td>
<td>
<p>Parameters for the SPM HRF.</p>
</td></tr>
<tr><td><code id="fit_to_constraints_+3A_f">f</code></td>
<td>
<p>Upsampling factor.</p>
</td></tr>
<tr><td><code id="fit_to_constraints_+3A_autohrf">autohrf</code></td>
<td>
<p>Results of a previous autohrf run to continue.</p>
</td></tr>
<tr><td><code id="fit_to_constraints_+3A_verbose">verbose</code></td>
<td>
<p>Whether to print progress of the fitting process.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns the best model given provided constraints.
</p>

<hr>
<h2 id='get_best_models'>get_best_models</h2><span id='topic+get_best_models'></span>

<h3>Description</h3>

<p>Returns and prints the best fitted model for each of the specs
used in autohrf.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_best_models(autofit, return_fitness = FALSE, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_best_models_+3A_autofit">autofit</code></td>
<td>
<p>Output of the autohrf function.</p>
</td></tr>
<tr><td><code id="get_best_models_+3A_return_fitness">return_fitness</code></td>
<td>
<p>Whether to return models or fitness.</p>
</td></tr>
<tr><td><code id="get_best_models_+3A_verbose">verbose</code></td>
<td>
<p>Whether to print information or only return the result.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a list containing the best models for each of the provided
constraints.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># prepare model specs
model3 &lt;- data.frame(
  event        = c("encoding", "delay", "response"),
  start_time   = c(0,          2.65,     12.5),
  end_time     = c(3,          12.5,     16)
)

model4 &lt;- data.frame(
  event        = c("fixation", "target", "delay", "response"),
  start_time   = c(0,          2.5,      2.65,    12.5),
  end_time     = c(2.5,        3,        12.5,    15.5)
)

model_constraints &lt;- list(model3, model4)

# run autohrf
df &lt;- flanker
autofit &lt;- autohrf(df, model_constraints, tr = 2.5,
                   population = 2, iter = 2, cores = 1)

# print best models
get_best_models(autofit)

</code></pre>

<hr>
<h2 id='get_parents'>get_parents</h2><span id='topic+get_parents'></span>

<h3>Description</h3>

<p>A helper function for getting parents for the child model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_parents(fitness)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_parents_+3A_fitness">fitness</code></td>
<td>
<p>A fitness score of all candidate models.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Parents for the child model.
</p>

<hr>
<h2 id='plot_best_models'>plot_best_models</h2><span id='topic+plot_best_models'></span>

<h3>Description</h3>

<p>Plots the best fitted model for each of the specs in autohrf.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_best_models(autofit, ncol = NULL, nrow = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_best_models_+3A_autofit">autofit</code></td>
<td>
<p>Output of the autohrf function.</p>
</td></tr>
<tr><td><code id="plot_best_models_+3A_ncol">ncol</code></td>
<td>
<p>Number of columns in the plot.</p>
</td></tr>
<tr><td><code id="plot_best_models_+3A_nrow">nrow</code></td>
<td>
<p>Number of rows in the plot.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Plots the grid containing a visualization of the best models for each
of the provided constraints.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># prepare model specs
model3 &lt;- data.frame(
  event        = c("encoding", "delay", "response"),
  start_time   = c(0,          2.65,     12.5),
  end_time     = c(3,          12.5,     16)
)

model4 &lt;- data.frame(
  event        = c("fixation", "target", "delay", "response"),
  start_time   = c(0,          2.5,      2.65,    12.5),
  end_time     = c(2.5,        3,        12.5,    15.5)
)

model_constraints &lt;- list(model3, model4)

# run autohrf
df &lt;- flanker
autofit &lt;- autohrf(df, model_constraints, tr = 2.5,
                   population = 2, iter = 2, cores = 1)

# plot best models
plot_best_models(autofit)

</code></pre>

<hr>
<h2 id='plot_events'>plot_events</h2><span id='topic+plot_events'></span>

<h3>Description</h3>

<p>A helper function for plotting events of a fitted model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_events(af, i = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_events_+3A_af">af</code></td>
<td>
<p>The output from the autohrf function.</p>
</td></tr>
<tr><td><code id="plot_events_+3A_i">i</code></td>
<td>
<p>Model index.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a plot of the events.
</p>

<hr>
<h2 id='plot_fitness'>plot_fitness</h2><span id='topic+plot_fitness'></span>

<h3>Description</h3>

<p>Plots how fitness changed through iterations of autohrf.
Use this to investigate whether your solution converged.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_fitness(autofit)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_fitness_+3A_autofit">autofit</code></td>
<td>
<p>Output of the autohrf function.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggplot visualization of fitness through time.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># prepare model specs
model3 &lt;- data.frame(
  event        = c("encoding", "delay", "response"),
  start_time   = c(0,          2.65,     12.5),
  end_time     = c(3,          12.5,     16)
)

model4 &lt;- data.frame(
  event        = c("fixation", "target", "delay", "response"),
  start_time   = c(0,          2.5,      2.65,    12.5),
  end_time     = c(2.5,        3,        12.5,    15.5)
)

model_constraints &lt;- list(model3, model4)

# run autohrf
df &lt;- flanker
autofit &lt;- autohrf(df, model_constraints, tr = 2.5,
                   population = 2, iter = 2, cores = 1)

# plot fitness
plot_fitness(autofit)

</code></pre>

<hr>
<h2 id='plot_model'>plot_model</h2><span id='topic+plot_model'></span>

<h3>Description</h3>

<p>Plots a manually constructed model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_model(
  model_evaluation,
  by_roi = FALSE,
  ncol = NULL,
  nrow = NULL,
  scales = "free_y",
  rois = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_model_+3A_model_evaluation">model_evaluation</code></td>
<td>
<p>The output from the evaluate_model function.</p>
</td></tr>
<tr><td><code id="plot_model_+3A_by_roi">by_roi</code></td>
<td>
<p>Whether to plot the fit for each ROI independently.</p>
</td></tr>
<tr><td><code id="plot_model_+3A_ncol">ncol</code></td>
<td>
<p>Number of columns in the facet wrap.</p>
</td></tr>
<tr><td><code id="plot_model_+3A_nrow">nrow</code></td>
<td>
<p>Number of rows in the facet wrap.</p>
</td></tr>
<tr><td><code id="plot_model_+3A_scales">scales</code></td>
<td>
<p>Whether to free certain axes of the facet wrap.</p>
</td></tr>
<tr><td><code id="plot_model_+3A_rois">rois</code></td>
<td>
<p>A subset of ROIs to visualize.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggplot visualization of the model.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># prepare model specs
model3 &lt;- data.frame(event      = c("encoding", "delay", "response"),
                     start_time = c(0,           2.65,    12.5),
                     duration   = c(2.65,        9.85,    3))


</code></pre>

<hr>
<h2 id='run_model'>run_model</h2><span id='topic+run_model'></span>

<h3>Description</h3>

<p>A helper function for evaluating a model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>run_model(d, ce, model, roi_weights = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="run_model_+3A_d">d</code></td>
<td>
<p>A dataframe with the signal data: roi, t and y. ROI is the name of
the region, t is the timestamp and y the value of the signal.</p>
</td></tr>
<tr><td><code id="run_model_+3A_ce">ce</code></td>
<td>
<p>Result of the convolve_events function.</p>
</td></tr>
<tr><td><code id="run_model_+3A_model">model</code></td>
<td>
<p>A data frame containing information about the model to use
and its events (event, start_time and duration).</p>
</td></tr>
<tr><td><code id="run_model_+3A_roi_weights">roi_weights</code></td>
<td>
<p>A data frame with ROI weights: roi, weight. ROI is the
name of the region, weight a number that defines the importance of that roi,
the default weight for a ROI is 1. If set to 2 for a particular ROI that ROI
will be twice as important.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns the model's evaluation.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
