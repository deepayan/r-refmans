<!DOCTYPE html><html lang="en"><head><title>Help for package angstroms</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {angstroms}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#angstroms'><p>Tools for ROMS model output.</p></a></li>
<li><a href='#antarctica'><p>Antarctica simple coastline.</p></a></li>
<li><a href='#coords_points'><p>Create SpatialPoints.</p></a></li>
<li><a href='#croproms'><p>Crop a ROMS layer</p></a></li>
<li><a href='#ice_fake'><p>Fake model data.</p></a></li>
<li><a href='#rawdata'><p>Read the variable as is</p></a></li>
<li><a href='#romsboundary'><p>Boundary polygon from raster of coordinates.</p></a></li>
<li><a href='#romscoords'><p>Extract coordinate arrays from ROMS.</p></a></li>
<li><a href='#romsdata'><p>ROMS single slice 2D layer</p>
</p>
<p>Extract a data layer from ROMS by name and 4-D slice.</p></a></li>
<li><a href='#romshcoords'><p>Coordinates at depth</p></a></li>
<li><a href='#romsmap'><p>Remap an object to the ROMS grid.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Tools for 'ROMS' the Regional Ocean Modeling System</td>
</tr>
<tr>
<td>Version:</td>
<td>0.0.1</td>
</tr>
<tr>
<td>Description:</td>
<td>Helper functions for working with Regional Ocean Modeling System 'ROMS' output. See
    <a href="https://www.myroms.org/">https://www.myroms.org/</a> for more information about 'ROMS'. </td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.3.0), raster</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>nabor, ncdf4, proj4, sp, spbabel</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>6.0.1</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat, covr</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/mdsumner/angstroms">https://github.com/mdsumner/angstroms</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/mdsumner/angstroms/issues">https://github.com/mdsumner/angstroms/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2017-05-01 02:42:30 UTC; mdsumner</td>
</tr>
<tr>
<td>Author:</td>
<td>Michael D. Sumner [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Michael D. Sumner &lt;mdsumner@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2017-05-01 10:35:22 UTC</td>
</tr>
</table>
<hr>
<h2 id='angstroms'>Tools for ROMS model output.</h2><span id='topic+angstroms'></span><span id='topic+angstroms-package'></span>

<h3>Description</h3>

<p>Facilities for  easy access to Regional Ocean Modeling System (ROMS) output.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
<code><a href="#topic+coords_points">coords_points</a></code> </td><td style="text-align: left;"> produce <a href="sp.html#topic+SpatialPoints">sp::SpatialPoints</a> from ROMS coordinate arrays  </td>
</tr>
<tr>
 <td style="text-align: left;">
<code><a href="#topic+croproms">croproms</a></code> </td><td style="text-align: left;"> create a <a href="raster.html#topic+extent">raster::extent</a> by cropping a ROMS data layer  </td>
</tr>
<tr>
 <td style="text-align: left;">
<code><a href="#topic+rawdata">rawdata</a></code> </td><td style="text-align: left;"> read raw NetCDF variables by name </td>
</tr>
<tr>
 <td style="text-align: left;">
<code><a href="#topic+romsdata">romsdata</a></code> read data layers from 4D variables by arbitrary slice  </td>
</tr>
<tr>
 <td style="text-align: left;">
<code><a href="#topic+romsboundary">romsboundary</a></code> </td><td style="text-align: left;"> generate the spatial boundary of the ROMS data set in x-y coordinate space </td>
</tr>
<tr>
 <td style="text-align: left;">
<code><a href="#topic+romscoords">romscoords</a></code> </td><td style="text-align: left;"> extract the x-y (long-lat) coordinates </td>
</tr>
<tr>
 <td style="text-align: left;">
<code><a href="#topic+romshcoords">romshcoords</a></code> </td><td style="text-align: left;"> extract the multi-layer 'h'eight grid with S-coordinate stretching applied </td>
</tr>
<tr>
 <td style="text-align: left;">
<code><a href="#topic+romsmap">romsmap</a></code> </td><td style="text-align: left;"> re-map a spatial layer (polygons, lines, points) into ROMS grid space </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>


<hr>
<h2 id='antarctica'>Antarctica simple coastline.</h2><span id='topic+antarctica'></span>

<h3>Description</h3>

<p>Taken from &quot;rnaturalearth::countries110&quot;
</p>

<hr>
<h2 id='coords_points'>Create SpatialPoints.</h2><span id='topic+coords_points'></span>

<h3>Description</h3>

<p>Convenience wrapper around <code>SpatialPoints</code> for a two layer brick with longitude and latitude coordinate arrays.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>coords_points(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="coords_points_+3A_x">x</code></td>
<td>
<p>two layer <code>RasterBrick</code> with longitude and latitude values</p>
</td></tr>
<tr><td><code id="coords_points_+3A_...">...</code></td>
<td>
<p>ignored</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>SpatialPoints</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## library(raadtools)
##coords_points(romscoords(cpolarfiles()$fullname[1]))

pts &lt;- coords_points(ice_coords)
</code></pre>

<hr>
<h2 id='croproms'>Crop a ROMS layer</h2><span id='topic+croproms'></span>

<h3>Description</h3>

<p>Crop a ROMS data layer from <code>romsdata</code> with a raster extent.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>croproms(x, ext, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="croproms_+3A_x">x</code></td>
<td>
<p>ROMS xy- coordinates, see <code>romscoords</code></p>
</td></tr>
<tr><td><code id="croproms_+3A_ext">ext</code></td>
<td>
<p><code>raster::extent</code> in the coordinate system of <code>x</code></p>
</td></tr>
<tr><td><code id="croproms_+3A_...">...</code></td>
<td>
<p>ignored</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The spatial crop is performed in the coordinate space of roms data.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## notice that extent is in long-lat, but ice_local is in the grid
## space of ice_coords
ice_local &lt;- croproms(ice_coords, extent(100, 120, -75, -60))
plot(ice_coords[[2]], col = grey(seq(0, 1, length  = 20)))
plot(crop(ice_fake, ice_local), add = TRUE)
</code></pre>

<hr>
<h2 id='ice_fake'>Fake model data.</h2><span id='topic+ice_fake'></span><span id='topic+ice_coords'></span>

<h3>Description</h3>

<p><code>ice_coords</code> and <code>ice_fake</code> are generated from a projected map of southern Ocean sea ice data.
</p>


<h3>Details</h3>

<p>The coords layer is the longitude and latitude values for the centres of the polar cells. This is veyr loosely
analogous to the coordinate arrays used by ROMS data, included here for working examples, illustration and code tests.
</p>
<p>The proper metadata for these layers is
&quot;-3950000, 3950000, -3950000, 4350000  (xmin, xmax, ymin, ymax)&quot;
</p>
<p>&quot;+proj=stere +lat_0=-90 +lat_ts=-70 +lon_0=0 +k=1 +x_0=0 +y_0=0 +a=6378273 +b=6356889.449 +units=m +no_defs&quot;
</p>

<hr>
<h2 id='rawdata'>Read the variable as is</h2><span id='topic+rawdata'></span>

<h3>Description</h3>

<p>Read the variable as is
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rawdata(x, varname)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rawdata_+3A_x">x</code></td>
<td>
<p>netcdf file path</p>
</td></tr>
<tr><td><code id="rawdata_+3A_varname">varname</code></td>
<td>
<p>variable name</p>
</td></tr>
</table>

<hr>
<h2 id='romsboundary'>Boundary polygon from raster of coordinates.</h2><span id='topic+romsboundary'></span>

<h3>Description</h3>

<p>Create a boundary polygon by tracking around coordinates stored in a RasterStack.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>romsboundary(cds)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="romsboundary_+3A_cds">cds</code></td>
<td>
<p>two-layer Raster</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The first layer in the stack is treated as the X coordinate, second as Y.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ice_grid_boundary &lt;- romsboundary(ice_coords)
plot(antarctica)
## does not make sense in this space
plot(ice_grid_boundary, add = TRUE, border = "grey")

## ok in this one
#library(rgdal)
#   proj4string(ice_grid_boundary) &lt;- CRS("+init=epsg:4326")
# pweird &lt;- "+proj=laea +lon_0=147 +lat_0=-42 +ellps=WGS84"
#  laea_world &lt;- spTransform(antarctica, pweird)
#  plot(extent(laea_world) + 8e6, type = "n", asp = 1)
#  plot(laea_world, add = TRUE)
#  plot(spTransform(ice_grid_boundary, pweird), add  = TRUE, border = "darkgrey")
</code></pre>

<hr>
<h2 id='romscoords'>Extract coordinate arrays from ROMS.</h2><span id='topic+romscoords'></span>

<h3>Description</h3>

<p>Returns a RasterStack of the given variable names.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>romscoords(x, spatial = c("lon_u", "lat_u"), ncdf = TRUE,
  transpose = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="romscoords_+3A_x">x</code></td>
<td>
<p>ROMS file name</p>
</td></tr>
<tr><td><code id="romscoords_+3A_spatial">spatial</code></td>
<td>
<p>names of coordinate variables (e.g. lon_u, lat_u)</p>
</td></tr>
<tr><td><code id="romscoords_+3A_ncdf">ncdf</code></td>
<td>
<p>default to NetCDF no matter what file name</p>
</td></tr>
<tr><td><code id="romscoords_+3A_transpose">transpose</code></td>
<td>
<p>the extents (ROMS is FALSE, Access is TRUE)</p>
</td></tr>
<tr><td><code id="romscoords_+3A_...">...</code></td>
<td>
<p>unused</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The two layers from the model output are used to define the real-world space. This is used to create a boundary <code>romsboundary</code>, to map real-world
objects into  grid space <code>romscoords</code> and to generate graticules for mapping into the grid space with <code>graphics::contour</code>.
</p>


<h3>Value</h3>

<p>RasterStack with two layers of the 2D-variables
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  coord &lt;- romscoord("roms.nc")

## End(Not run)
## with in-built fake data
plot(ice_fake, asp = 0.5)
contour(ice_coords[[1]], add = TRUE, levels = seq(-165, 165, by = 15))
contour(ice_coords[[2]], add = TRUE)

</code></pre>

<hr>
<h2 id='romsdata'>ROMS single slice 2D layer
Extract a data layer from ROMS by name and 4-D slice.</h2><span id='topic+romsdata'></span><span id='topic+roms_xy'></span><span id='topic+roms_xz'></span><span id='topic+roms_xt'></span><span id='topic+roms_yz'></span><span id='topic+roms_yt'></span><span id='topic+roms_zt'></span>

<h3>Description</h3>

<p><code>romsdata</code> always works in the first two dimensions (x-y), the more specialist functions will
work in the space indicated by their name <code>roms_xy</code>, <code>roms_xt</code> and so on.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>roms_xy(x, varname, slice = c(1L, 1L), transpose = TRUE, ...)

roms_xz(x, varname, slice = c(1L, 1L), transpose = TRUE, ...)

roms_xt(x, varname, slice = c(1L, 1L), transpose = TRUE, ...)

roms_yz(x, varname, slice = c(1L, 1L), transpose = TRUE, ...)

roms_yt(x, varname, slice = c(1L, 1L), transpose = TRUE, ...)

roms_zt(x, varname, slice = c(1L, 1L), transpose = TRUE, ...)

romsdata(x, varname, slice = c(1L, 1L), ncdf = TRUE, transpose = TRUE,
  ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="romsdata_+3A_x">x</code></td>
<td>
<p>ROMS file name</p>
</td></tr>
<tr><td><code id="romsdata_+3A_varname">varname</code></td>
<td>
<p>name of ROMS variable</p>
</td></tr>
<tr><td><code id="romsdata_+3A_slice">slice</code></td>
<td>
<p>index in w and t (depth and time), defaults to first encountered</p>
</td></tr>
<tr><td><code id="romsdata_+3A_transpose">transpose</code></td>
<td>
<p>the extents (ROMS is FALSE, Access is TRUE)</p>
</td></tr>
<tr><td><code id="romsdata_+3A_...">...</code></td>
<td>
<p>unused</p>
</td></tr>
<tr><td><code id="romsdata_+3A_ncdf">ncdf</code></td>
<td>
<p>default to <code>TRUE</code>, set to <code>FALSE</code> to allow raster format detection brick</p>
</td></tr>
</table>


<h3>Value</h3>

<p>RasterLayer
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#x &lt;- raadtools:::cpolarfiles()$fullname[1]
#plot(roms_xy(x, "u"))
#plot(roms_xz(x, "u", slice = c(392L,1L)), asp = NA)
#plot(roms_xt(x, "u", slice = c(392L,1L)), asp = NA)

#plot(roms_yz(x, "u"))
#plot(roms_yt(x, "u", slice = c(1L,1L)), asp = NA)
#plot(roms_zt(x, "u", slice = c(1L, 392L)), asp = NA)
</code></pre>

<hr>
<h2 id='romshcoords'>Coordinates at depth</h2><span id='topic+romshcoords'></span>

<h3>Description</h3>

<p>Extract the multi-layer 'h'eight grid with S-coordinate stretching applied
</p>


<h3>Usage</h3>

<pre><code class='language-R'>romshcoords(x, S = "Cs_r", depth = "h")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="romshcoords_+3A_x">x</code></td>
<td>
<p>ROMS file name</p>
</td></tr>
<tr><td><code id="romshcoords_+3A_s">S</code></td>
<td>
<p>of S-coordinate stretching curve at RHO-points</p>
</td></tr>
<tr><td><code id="romshcoords_+3A_depth">depth</code></td>
<td>
<p>depth thing</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>S</code> and <code>h</code> are the  names of the appropriate variables
</p>


<h3>Value</h3>

<p>RasterStack with a layer for every depth
</p>

<hr>
<h2 id='romsmap'>Remap an object to the ROMS grid.</h2><span id='topic+romsmap'></span><span id='topic+romsmap.SpatialPolygonsDataFrame'></span><span id='topic+romsmap.SpatialLinesDataFrame'></span><span id='topic+romsmap.SpatialPointsDataFrame'></span>

<h3>Description</h3>

<p>Find the nearest-neighbour coordinates of <code>x</code> in the coordinate arrays of <code>coords</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>romsmap(x, ...)

## S3 method for class 'SpatialPolygonsDataFrame'
romsmap(x, coords, crop = FALSE,
  lonlat = TRUE, ...)

## S3 method for class 'SpatialLinesDataFrame'
romsmap(x, coords, crop = FALSE,
  lonlat = TRUE, ...)

## S3 method for class 'SpatialPointsDataFrame'
romsmap(x, coords, crop = FALSE,
  lonlat = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="romsmap_+3A_x">x</code></td>
<td>
<p>object to transform to the grid space, e.g. a <code><a href="sp.html#topic+Spatial">Spatial</a></code> object</p>
</td></tr>
<tr><td><code id="romsmap_+3A_...">...</code></td>
<td>
<p>unused</p>
</td></tr>
<tr><td><code id="romsmap_+3A_coords">coords</code></td>
<td>
<p>romscoords RasterStack</p>
</td></tr>
<tr><td><code id="romsmap_+3A_crop">crop</code></td>
<td>
<p>logical, if <code>TRUE</code> crop x to the extent of the boundary of the values in coords</p>
</td></tr>
<tr><td><code id="romsmap_+3A_lonlat">lonlat</code></td>
<td>
<p>logical, if <code>TRUE</code> check for need to back-transform to longitude/latitude and do it</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The input <code>coords</code> is a assumed to be a 2-layer RasterStack or RasterBrick and
using <code>nabor::knn</code> the nearest matching position of the coordinates of <code>x</code> is found in the grid space of <code>coords</code>. The
motivating use-case is the curvilinear longitude and latitude arrays of ROMS model output.
</p>
<p>No account is made for the details of a ROMS cell, though this may be included in future. We tested only with the &quot;lon_u&quot; and &quot;lat_u&quot;
arrays.
</p>


<h3>Value</h3>

<p>input object with coordinates transformed to space of the coords
</p>


<h3>Note</h3>

<p>Do not use this for extraction purposes without checking the output, this is best used for exploration
and visualization. Re-mapping ROMS data is better done by looking up the <code>coords_points</code> within spatial objects,
and transferring via the grid index.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ant_ice_coords &lt;- romsmap(antarctica, ice_coords)
plot(ice_fake, main = "sea ice in pure grid space")
plot(ant_ice_coords, add = TRUE)


</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
