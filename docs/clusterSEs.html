<!DOCTYPE html><html><head><title>Help for package clusterSEs</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {clusterSEs}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#cluster.bs.glm'><p>Pairs Cluster Bootstrapped p-Values For GLM</p></a></li>
<li><a href='#cluster.bs.ivreg'><p>Pairs Cluster Bootstrapped p-Values For Regression With Instrumental Variables</p></a></li>
<li><a href='#cluster.bs.mlogit'><p>Pairs Cluster Bootstrapped p-Values For mlogit</p></a></li>
<li><a href='#cluster.bs.plm'><p>Pairs Cluster Bootstrapped p-Values For PLM</p></a></li>
<li><a href='#cluster.im.glm'><p>Cluster-Adjusted Confidence Intervals And p-Values For GLM</p></a></li>
<li><a href='#cluster.im.ivreg'><p>Cluster-Adjusted Confidence Intervals And p-Values For GLM</p></a></li>
<li><a href='#cluster.im.mlogit'><p>Cluster-Adjusted Confidence Intervals And p-Values For mlogit</p></a></li>
<li><a href='#cluster.wild.glm'><p>Wild Cluster Bootstrapped p-Values For Linear Family GLM</p></a></li>
<li><a href='#cluster.wild.ivreg'><p>Wild Cluster Bootstrapped p-Values For For Regression With Instrumental Variables</p></a></li>
<li><a href='#cluster.wild.plm'><p>Wild Cluster Bootstrapped p-Values For PLM</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Calculate Cluster-Robust p-Values and Confidence Intervals</td>
</tr>
<tr>
<td>Version:</td>
<td>2.6.5</td>
</tr>
<tr>
<td>Description:</td>
<td>Calculate p-values and confidence intervals using cluster-adjusted
    t-statistics (based on Ibragimov and Muller (2010) &lt;<a href="https://doi.org/10.1198%2Fjbes.2009.08046">doi:10.1198/jbes.2009.08046</a>&gt;, pairs cluster bootstrapped t-statistics, and wild cluster bootstrapped t-statistics (the latter two techniques based on Cameron, Gelbach, and Miller (2008) &lt;<a href="https://doi.org/10.1162%2Frest.90.3.414">doi:10.1162/rest.90.3.414</a>&gt;. Procedures are included for use with GLM, ivreg, plm (pooling or fixed effects), and mlogit models.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.3.0), AER, Formula, plm, stats</td>
</tr>
<tr>
<td>Imports:</td>
<td>sandwich, lmtest, mlogit (&ge; 1.1-0), utils, dfidx</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-04-05 19:51:21 UTC; justi</td>
</tr>
<tr>
<td>Author:</td>
<td>Justin Esarey [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Justin Esarey &lt;justin@justinesarey.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-04-05 20:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='cluster.bs.glm'>Pairs Cluster Bootstrapped p-Values For GLM</h2><span id='topic+cluster.bs.glm'></span>

<h3>Description</h3>

<p>This software estimates p-values using pairs cluster bootstrapped t-statistics for GLM models (Cameron, Gelbach, and Miller 2008). The data set is repeatedly re-sampled by cluster, a model is estimated, and inference is based on the sampling distribution of the pivotal (t) statistic.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cluster.bs.glm(
  mod,
  dat,
  cluster,
  ci.level = 0.95,
  boot.reps = 1000,
  stratify = FALSE,
  cluster.se = TRUE,
  report = TRUE,
  prog.bar = TRUE,
  output.replicates = FALSE,
  seed = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cluster.bs.glm_+3A_mod">mod</code></td>
<td>
<p>A model estimated using <code>glm</code>.</p>
</td></tr>
<tr><td><code id="cluster.bs.glm_+3A_dat">dat</code></td>
<td>
<p>The data set used to estimate <code>mod</code>.</p>
</td></tr>
<tr><td><code id="cluster.bs.glm_+3A_cluster">cluster</code></td>
<td>
<p>A formula of the clustering variable.</p>
</td></tr>
<tr><td><code id="cluster.bs.glm_+3A_ci.level">ci.level</code></td>
<td>
<p>What confidence level should CIs reflect?</p>
</td></tr>
<tr><td><code id="cluster.bs.glm_+3A_boot.reps">boot.reps</code></td>
<td>
<p>The number of bootstrap samples to draw.</p>
</td></tr>
<tr><td><code id="cluster.bs.glm_+3A_stratify">stratify</code></td>
<td>
<p>Sample clusters only (= FALSE) or clusters and observations by cluster (= TRUE).</p>
</td></tr>
<tr><td><code id="cluster.bs.glm_+3A_cluster.se">cluster.se</code></td>
<td>
<p>Use clustered standard errors (= TRUE) or ordinary SEs (= FALSE) for bootstrap replicates.</p>
</td></tr>
<tr><td><code id="cluster.bs.glm_+3A_report">report</code></td>
<td>
<p>Should a table of results be printed to the console?</p>
</td></tr>
<tr><td><code id="cluster.bs.glm_+3A_prog.bar">prog.bar</code></td>
<td>
<p>Show a progress bar of the bootstrap (= TRUE) or not (= FALSE).</p>
</td></tr>
<tr><td><code id="cluster.bs.glm_+3A_output.replicates">output.replicates</code></td>
<td>
<p>Should the cluster bootstrap coefficient replicates be output (= TRUE) or not (= FALSE)?</p>
</td></tr>
<tr><td><code id="cluster.bs.glm_+3A_seed">seed</code></td>
<td>
<p>Random number seed for replicability (default is NULL).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the elements
</p>
<table>
<tr><td><code>p.values</code></td>
<td>
<p>A matrix of the estimated p-values.</p>
</td></tr>
<tr><td><code>ci</code></td>
<td>
<p>A matrix of confidence intervals.</p>
</td></tr>
<tr><td><code>replicates</code></td>
<td>
<p>Optional: A matrix of the coefficient estimates from each cluster bootstrap replicate.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Code to estimate GLM clustered standard errors by Mahmood Arai: http://thetarzan.wordpress.com/2011/06/11/clustered-standard-errors-in-r/. Cluster SE degrees of freedom correction = (M/(M-1)) with M = the number of clusters.
</p>


<h3>Author(s)</h3>

<p>Justin Esarey
</p>


<h3>References</h3>

<p>Esarey, Justin, and Andrew Menger. 2017. &quot;Practical and Effective Approaches to Dealing with Clustered Data.&quot; <em>Political Science Research and Methods</em> forthcoming: 1-35. &lt;URL:http://jee3.web.rice.edu/cluster-paper.pdf&gt;.
</p>
<p>Cameron, A. Colin, Jonah B. Gelbach, and Douglas L. Miller. 2008. &quot;Bootstrap-Based Improvements for Inference with Clustered Errors.&quot; <em>The Review of Economics and Statistics</em> 90(3): 414-427. &lt;DOI:10.1162/rest.90.3.414&gt;.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

##################################################################
# example one: predict whether respondent has a university degree
##################################################################
require(effects)
data(WVS)
logit.model &lt;- glm(degree ~ religion + gender + age, data=WVS, family=binomial(link="logit"))
summary(logit.model)

# compute pairs cluster bootstrapped p-values
clust.bs.p &lt;- cluster.bs.glm(logit.model, WVS, ~ country, report = T)

  
######################################
# example two: predict chicken weight
######################################
rm(list=ls())
data(ChickWeight)

dum &lt;- model.matrix(~ ChickWeight$Diet)
ChickWeight$Diet2 &lt;- as.numeric(dum[,2])
ChickWeight$Diet3 &lt;- as.numeric(dum[,3])
ChickWeight$Diet4 &lt;- as.numeric(dum[,4])

weight.mod2 &lt;- glm(formula = weight~Diet2+Diet3+Diet4+log(Time+1),data=ChickWeight)

# compute pairs cluster bootstrapped p-values
clust.bs.w &lt;- cluster.bs.glm(weight.mod2, ChickWeight, ~ Chick, report = T)


###################################################################
# example three: murder rate by U.S. state, with interaction term
###################################################################
rm(list=ls())
require(datasets)

state.x77.dat &lt;- data.frame(state.x77)
state.x77.dat$Region &lt;- state.region
state.x77.dat$IncomeXHS &lt;- state.x77.dat$Income * state.x77.dat$HS.Grad
income.mod &lt;- glm( Murder ~ Income + HS.Grad + IncomeXHS , data=state.x77.dat)

# compute pairs cluster bootstrapped p-values
clust.bs.inc &lt;- cluster.bs.glm(income.mod, state.x77.dat, ~ Region, 
                               report = T, output.replicates=T, boot.reps=10000)

# compute effect of income on murder rate, by percentage of HS graduates
# using conventional standard errors
HS.grad.vec &lt;- seq(from=38, to=67, by=1)
me.income &lt;- coefficients(income.mod)[2] + coefficients(income.mod)[4]*HS.grad.vec
plot(me.income ~ HS.grad.vec, type="l", ylim=c(-0.0125, 0.0125), 
     xlab="% HS graduates", ylab="ME of income on murder rate")
se.income &lt;- sqrt( vcov(income.mod)[2,2] + vcov(income.mod)[4,4]*(HS.grad.vec)^2 +
                   2*vcov(income.mod)[2,4]*HS.grad.vec )
ci.h &lt;- me.income + qt(0.975, lower.tail=T, df=46) * se.income
ci.l &lt;- me.income - qt(0.975, lower.tail=T, df=46) * se.income
lines(ci.h ~ HS.grad.vec, lty=2)
lines(ci.l ~ HS.grad.vec, lty=2)

# use pairs cluster bootstrap to compute CIs, including bootstrap bias-correction factor
# including bootstrap bias correction factor
# cluster on Region
################################################
# marginal effect replicates =
me.boot &lt;- matrix(data = clust.bs.inc$replicates[,2], nrow=10000, ncol=30, byrow=F) +
           as.matrix(clust.bs.inc$replicates[,4]) %*% t(HS.grad.vec)
# compute bias-corrected MEs
me.income.bias.cor &lt;- 2*me.income - apply(X=me.boot, FUN=mean, MARGIN=2)
# adjust bootstrap replicates for bias
me.boot.bias.cor &lt;- me.boot + matrix(data = 2*(me.income - 
                                     apply(X=me.boot, FUN=mean, MARGIN=2)),
                                     ncol=30, nrow=10000, byrow=T)
# compute pairs cluster bootstrap 95% CIs, including bias correction
me.boot.plot &lt;- apply(X = me.boot.bias.cor, FUN=quantile, MARGIN=2, probs=c(0.025, 0.975))
# plot bootstrap bias-corrected marginal effects
lines(me.income.bias.cor ~ HS.grad.vec, lwd=2)
# plot 95% Cis
# a little lowess smoothing applied to compensate for discontinuities 
# arising from shifting between replicates
lines(lowess(me.boot.plot[1,] ~ HS.grad.vec), lwd=2, lty=2)
lines(lowess(me.boot.plot[2,] ~ HS.grad.vec), lwd=2, lty=2)

# finishing touches to plot
legend(lty=c(1,2,1,2), lwd=c(1,1,2,2), "topleft", 
       legend=c("Model Marginal Effect", "Conventional 95% CI", 
                "BS Bias-Corrected Marginal Effect", "Cluster Bootstrap 95% CI"))


## End(Not run)
</code></pre>

<hr>
<h2 id='cluster.bs.ivreg'>Pairs Cluster Bootstrapped p-Values For Regression With Instrumental Variables</h2><span id='topic+cluster.bs.ivreg'></span>

<h3>Description</h3>

<p>This software estimates p-values using pairs cluster bootstrapped t-statistics for instrumental variables regression models (Cameron, Gelbach, and Miller 2008). The data set is repeatedly re-sampled by cluster, a model is estimated, and inference is based on the sampling distribution of the pivotal (t) statistic.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cluster.bs.ivreg(
  mod,
  dat,
  cluster,
  ci.level = 0.95,
  boot.reps = 1000,
  stratify = FALSE,
  cluster.se = TRUE,
  report = TRUE,
  prog.bar = TRUE,
  output.replicates = FALSE,
  seed = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cluster.bs.ivreg_+3A_mod">mod</code></td>
<td>
<p>A model estimated using <code>ivreg</code>.</p>
</td></tr>
<tr><td><code id="cluster.bs.ivreg_+3A_dat">dat</code></td>
<td>
<p>The data set used to estimate <code>mod</code>.</p>
</td></tr>
<tr><td><code id="cluster.bs.ivreg_+3A_cluster">cluster</code></td>
<td>
<p>A formula of the clustering variable.</p>
</td></tr>
<tr><td><code id="cluster.bs.ivreg_+3A_ci.level">ci.level</code></td>
<td>
<p>What confidence level should CIs reflect?</p>
</td></tr>
<tr><td><code id="cluster.bs.ivreg_+3A_boot.reps">boot.reps</code></td>
<td>
<p>The number of bootstrap samples to draw.</p>
</td></tr>
<tr><td><code id="cluster.bs.ivreg_+3A_stratify">stratify</code></td>
<td>
<p>Sample clusters only (= FALSE) or clusters and observations by cluster (= TRUE).</p>
</td></tr>
<tr><td><code id="cluster.bs.ivreg_+3A_cluster.se">cluster.se</code></td>
<td>
<p>Use clustered standard errors (= TRUE) or ordinary SEs (= FALSE) for bootstrap replicates.</p>
</td></tr>
<tr><td><code id="cluster.bs.ivreg_+3A_report">report</code></td>
<td>
<p>Should a table of results be printed to the console?</p>
</td></tr>
<tr><td><code id="cluster.bs.ivreg_+3A_prog.bar">prog.bar</code></td>
<td>
<p>Show a progress bar of the bootstrap (= TRUE) or not (= FALSE).</p>
</td></tr>
<tr><td><code id="cluster.bs.ivreg_+3A_output.replicates">output.replicates</code></td>
<td>
<p>Should the cluster bootstrap coefficient replicates be output (= TRUE) or not (= FALSE)?</p>
</td></tr>
<tr><td><code id="cluster.bs.ivreg_+3A_seed">seed</code></td>
<td>
<p>Random number seed for replicability (default is NULL).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the elements
</p>
<table>
<tr><td><code>p.values</code></td>
<td>
<p>A matrix of the estimated p-values.</p>
</td></tr>
<tr><td><code>ci</code></td>
<td>
<p>A matrix of confidence intervals.</p>
</td></tr>
<tr><td><code>replicates</code></td>
<td>
<p>Optional: A matrix of the coefficient estimates from each cluster bootstrap replicate.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Code to estimate clustered standard errors by Mahmood Arai: http://thetarzan.wordpress.com/2011/06/11/clustered-standard-errors-in-r/. Cluster SE degrees of freedom correction = (M/(M-1)) with M = the number of clusters.
</p>


<h3>Author(s)</h3>

<p>Justin Esarey
</p>


<h3>References</h3>

<p>Esarey, Justin, and Andrew Menger. 2017. &quot;Practical and Effective Approaches to Dealing with Clustered Data.&quot; <em>Political Science Research and Methods</em> forthcoming: 1-35. &lt;URL:http://jee3.web.rice.edu/cluster-paper.pdf&gt;.
</p>
<p>Cameron, A. Colin, Jonah B. Gelbach, and Douglas L. Miller. 2008. &quot;Bootstrap-Based Improvements for Inference with Clustered Errors.&quot; <em>The Review of Economics and Statistics</em> 90(3): 414-427. &lt;DOI:10.1162/rest.90.3.414&gt;.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

##############################################
# example one: predict cigarette consumption
##############################################
require(AER)
data("CigarettesSW", package = "AER") 
CigarettesSW$rprice &lt;- with(CigarettesSW, price/cpi)
CigarettesSW$rincome &lt;- with(CigarettesSW, income/population/cpi)
CigarettesSW$tdiff &lt;- with(CigarettesSW, (taxs - tax)/cpi)
fm &lt;- ivreg(log(packs) ~ log(rprice) + log(rincome) | 
    log(rincome) + tdiff + I(tax/cpi), data = CigarettesSW)

# compute pairs cluster bootstrapped p-values
cluster.bs.c &lt;- cluster.bs.ivreg(fm, dat = CigarettesSW, cluster = ~state, report = T)


################################################
# example two: pooled IV analysis of employment
################################################
require(plm)
require(AER)
data(EmplUK)
EmplUK$lag.wage &lt;- lag(EmplUK$wage)
emp.iv &lt;- ivreg(emp ~ wage + log(capital+1) | output + lag.wage + log(capital+1), data = EmplUK)

# compute cluster-adjusted p-values
cluster.bs.e &lt;- cluster.bs.ivreg(mod = emp.iv, dat = EmplUK, cluster = ~firm)


## End(Not run)
</code></pre>

<hr>
<h2 id='cluster.bs.mlogit'>Pairs Cluster Bootstrapped p-Values For mlogit</h2><span id='topic+cluster.bs.mlogit'></span>

<h3>Description</h3>

<p>This software estimates p-values using pairs cluster bootstrapped t-statistics for multinomial logit models (Cameron, Gelbach, and Miller 2008). The data set is repeatedly re-sampled by cluster, a model is estimated, and inference is based on the sampling distribution of the pivotal (t) statistic.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cluster.bs.mlogit(
  mod,
  dat,
  cluster,
  ci.level = 0.95,
  boot.reps = 1000,
  cluster.se = TRUE,
  report = TRUE,
  prog.bar = TRUE,
  output.replicates = FALSE,
  seed = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cluster.bs.mlogit_+3A_mod">mod</code></td>
<td>
<p>A model estimated using <code>mlogit</code>.</p>
</td></tr>
<tr><td><code id="cluster.bs.mlogit_+3A_dat">dat</code></td>
<td>
<p>The data set used to estimate <code>mod</code>.</p>
</td></tr>
<tr><td><code id="cluster.bs.mlogit_+3A_cluster">cluster</code></td>
<td>
<p>A formula of the clustering variable.</p>
</td></tr>
<tr><td><code id="cluster.bs.mlogit_+3A_ci.level">ci.level</code></td>
<td>
<p>What confidence level should CIs reflect?</p>
</td></tr>
<tr><td><code id="cluster.bs.mlogit_+3A_boot.reps">boot.reps</code></td>
<td>
<p>The number of bootstrap samples to draw.</p>
</td></tr>
<tr><td><code id="cluster.bs.mlogit_+3A_cluster.se">cluster.se</code></td>
<td>
<p>Use clustered standard errors (= TRUE) or ordinary SEs (= FALSE) for bootstrap replicates.</p>
</td></tr>
<tr><td><code id="cluster.bs.mlogit_+3A_report">report</code></td>
<td>
<p>Should a table of results be printed to the console?</p>
</td></tr>
<tr><td><code id="cluster.bs.mlogit_+3A_prog.bar">prog.bar</code></td>
<td>
<p>Show a progress bar of the bootstrap (= TRUE) or not (= FALSE).</p>
</td></tr>
<tr><td><code id="cluster.bs.mlogit_+3A_output.replicates">output.replicates</code></td>
<td>
<p>Should the cluster bootstrap coefficient replicates be output (= TRUE) or not (= FALSE)?</p>
</td></tr>
<tr><td><code id="cluster.bs.mlogit_+3A_seed">seed</code></td>
<td>
<p>Random number seed for replicability (default is NULL).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the elements
</p>
<table>
<tr><td><code>p.values</code></td>
<td>
<p>A matrix of the estimated p-values.</p>
</td></tr>
<tr><td><code>ci</code></td>
<td>
<p>A matrix of confidence intervals.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Code to estimate GLM clustered standard errors by Mahmood Arai: http://thetarzan.wordpress.com/2011/06/11/clustered-standard-errors-in-r/, although modified slightly to work for <code>mlogit</code> models. Cluster SE degrees of freedom correction = (M/(M-1)) with M = the number of clusters.
</p>


<h3>Author(s)</h3>

<p>Justin Esarey
</p>


<h3>References</h3>

<p>Esarey, Justin, and Andrew Menger. 2017. &quot;Practical and Effective Approaches to Dealing with Clustered Data.&quot; <em>Political Science Research and Methods</em> forthcoming: 1-35. &lt;URL:http://jee3.web.rice.edu/cluster-paper.pdf&gt;.
</p>
<p>Cameron, A. Colin, Jonah B. Gelbach, and Douglas L. Miller. 2008. &quot;Bootstrap-Based Improvements for Inference with Clustered Errors.&quot; <em>The Review of Economics and Statistics</em> 90(3): 414-427. &lt;DOI:10.1162/rest.90.3.414&gt;.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

#######################################
# example one: train ticket selection
#######################################
require(mlogit)
data("Train", package="mlogit")
Train$choiceid &lt;- 1:nrow(Train)

Tr &lt;- dfidx(Train, shape = "wide", varying = 4:11, sep = "_", 
          choice = "choice", idx = list(c("choiceid", "id")), 
          idnames = c(NA, "alt"))
Tr$price &lt;- Tr$price/100 * 2.20371
Tr$time &lt;- Tr$time/60

ml.Train &lt;- mlogit(choice ~ price + time + change + comfort | -1, Tr)

# compute pairs cluster bootstrapped p-values
# note: few reps to speed up example
cluster.bs.tr &lt;- cluster.bs.mlogit(ml.Train, Tr, ~ id, boot.reps=100)


##################################################################
# example two: predict type of heating system installed in house
##################################################################
require(mlogit)
data("Heating", package = "mlogit")
H &lt;- Heating
H$region &lt;- as.numeric(H$region)
H.ml &lt;- dfidx(H, shape="wide", choice="depvar", varying=c(3:12),
         idx = list(c("idcase", "region")))
m &lt;- mlogit(depvar~ic+oc, H.ml)

# compute pairs cluster bootstrapped p-values
cluster.bs.h &lt;- cluster.bs.mlogit(m, H.ml, ~ region, boot.reps=1000)


## End(Not run)
</code></pre>

<hr>
<h2 id='cluster.bs.plm'>Pairs Cluster Bootstrapped p-Values For PLM</h2><span id='topic+cluster.bs.plm'></span>

<h3>Description</h3>

<p>This software estimates p-values using pairs cluster bootstrapped t-statistics for fixed effects panel linear models (Cameron, Gelbach, and Miller 2008). The data set is repeatedly re-sampled by cluster, a model is estimated, and inference is based on the sampling distribution of the pivotal (t) statistic.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cluster.bs.plm(
  mod,
  dat,
  cluster = "group",
  ci.level = 0.95,
  boot.reps = 1000,
  cluster.se = TRUE,
  report = TRUE,
  prog.bar = TRUE,
  output.replicates = FALSE,
  seed = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cluster.bs.plm_+3A_mod">mod</code></td>
<td>
<p>A &quot;within&quot; model estimated using <code>plm</code>.</p>
</td></tr>
<tr><td><code id="cluster.bs.plm_+3A_dat">dat</code></td>
<td>
<p>The data set used to estimate <code>mod</code>.</p>
</td></tr>
<tr><td><code id="cluster.bs.plm_+3A_cluster">cluster</code></td>
<td>
<p>Clustering dimension (&quot;group&quot;, the default, or &quot;time&quot;).</p>
</td></tr>
<tr><td><code id="cluster.bs.plm_+3A_ci.level">ci.level</code></td>
<td>
<p>What confidence level should CIs reflect?</p>
</td></tr>
<tr><td><code id="cluster.bs.plm_+3A_boot.reps">boot.reps</code></td>
<td>
<p>The number of bootstrap samples to draw.</p>
</td></tr>
<tr><td><code id="cluster.bs.plm_+3A_cluster.se">cluster.se</code></td>
<td>
<p>Use clustered standard errors (= TRUE) or ordinary SEs (= FALSE) for bootstrap replicates.</p>
</td></tr>
<tr><td><code id="cluster.bs.plm_+3A_report">report</code></td>
<td>
<p>Should a table of results be printed to the console?</p>
</td></tr>
<tr><td><code id="cluster.bs.plm_+3A_prog.bar">prog.bar</code></td>
<td>
<p>Show a progress bar of the bootstrap (= TRUE) or not (= FALSE).</p>
</td></tr>
<tr><td><code id="cluster.bs.plm_+3A_output.replicates">output.replicates</code></td>
<td>
<p>Should the cluster bootstrap coefficient replicates be output (= TRUE) or not (= FALSE)?</p>
</td></tr>
<tr><td><code id="cluster.bs.plm_+3A_seed">seed</code></td>
<td>
<p>Random number seed for replicability (default is NULL).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the elements
</p>
<table>
<tr><td><code>p.values</code></td>
<td>
<p>A matrix of the estimated p-values.</p>
</td></tr>
<tr><td><code>ci</code></td>
<td>
<p>A matrix of confidence intervals.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Justin Esarey
</p>


<h3>References</h3>

<p>Esarey, Justin, and Andrew Menger. 2017. &quot;Practical and Effective Approaches to Dealing with Clustered Data.&quot; <em>Political Science Research and Methods</em> forthcoming: 1-35. &lt;URL:http://jee3.web.rice.edu/cluster-paper.pdf&gt;.
</p>
<p>Cameron, A. Colin, Jonah B. Gelbach, and Douglas L. Miller. 2008. &quot;Bootstrap-Based Improvements for Inference with Clustered Errors.&quot; <em>The Review of Economics and Statistics</em> 90(3): 414-427. &lt;DOI:10.1162/rest.90.3.414&gt;.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

# predict employment levels, cluster on group
require(plm)
data(EmplUK)

emp.1 &lt;- plm(emp ~ wage + log(capital+1), data = EmplUK, 
             model = "within", index=c("firm", "year"))
cluster.bs.plm(mod=emp.1, dat=EmplUK, cluster="group", ci.level = 0.95, 
          boot.reps = 1000, cluster.se = TRUE, report = TRUE, 
          prog.bar = TRUE)

# cluster on time

cluster.bs.plm(mod=emp.1, dat=EmplUK, cluster="time", ci.level = 0.95, 
            boot.reps = 1000, cluster.se = TRUE, report = TRUE, 
            prog.bar = TRUE)


## End(Not run)
</code></pre>

<hr>
<h2 id='cluster.im.glm'>Cluster-Adjusted Confidence Intervals And p-Values For GLM</h2><span id='topic+cluster.im.glm'></span>

<h3>Description</h3>

<p>Computes p-values and confidence intervals for GLM models based on cluster-specific model estimation (Ibragimov and Muller 2010). A separate model is estimated in each cluster, and then p-values and confidence intervals are computed based on a t/normal distribution of the cluster-specific estimates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cluster.im.glm(
  mod,
  dat,
  cluster,
  ci.level = 0.95,
  report = TRUE,
  drop = FALSE,
  truncate = FALSE,
  return.vcv = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cluster.im.glm_+3A_mod">mod</code></td>
<td>
<p>A model estimated using <code>glm</code>.</p>
</td></tr>
<tr><td><code id="cluster.im.glm_+3A_dat">dat</code></td>
<td>
<p>The data set used to estimate <code>mod</code>.</p>
</td></tr>
<tr><td><code id="cluster.im.glm_+3A_cluster">cluster</code></td>
<td>
<p>A formula of the clustering variable.</p>
</td></tr>
<tr><td><code id="cluster.im.glm_+3A_ci.level">ci.level</code></td>
<td>
<p>What confidence level should CIs reflect?</p>
</td></tr>
<tr><td><code id="cluster.im.glm_+3A_report">report</code></td>
<td>
<p>Should a table of results be printed to the console?</p>
</td></tr>
<tr><td><code id="cluster.im.glm_+3A_drop">drop</code></td>
<td>
<p>Should clusters within which a model cannot be estimated be dropped?</p>
</td></tr>
<tr><td><code id="cluster.im.glm_+3A_truncate">truncate</code></td>
<td>
<p>Should outlying cluster-specific beta estimates be excluded?</p>
</td></tr>
<tr><td><code id="cluster.im.glm_+3A_return.vcv">return.vcv</code></td>
<td>
<p>Should a VCV matrix and the means of cluster-specific coefficient estimates be returned?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the elements
</p>
<table>
<tr><td><code>p.values</code></td>
<td>
<p>A matrix of the estimated p-values.</p>
</td></tr>
<tr><td><code>ci</code></td>
<td>
<p>A matrix of confidence intervals.</p>
</td></tr>
<tr><td><code>vcv.hat</code></td>
<td>
<p>Optional: A cluster-level variance-covariance matrix for coefficient estimates.</p>
</td></tr>
<tr><td><code>beta.bar</code></td>
<td>
<p>Optional: A vector of means for cluster-specific coefficient estimates.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Confidence intervals are centered on the cluster averaged estimate, which can diverge from original model estimates under several circumstances (e.g., if clusters have different numbers of observations). Consequently, confidence intervals may not be centered on original model estimates. If drop = TRUE, any cluster for which all coefficients cannot be estimated will be automatically dropped from the analysis. If truncate = TRUE, any cluster for which any coefficient is more than 6 times the interquartile range from the cross-cluster mean will also be dropped as an outlier.
</p>


<h3>Author(s)</h3>

<p>Justin Esarey
</p>


<h3>References</h3>

<p>Esarey, Justin, and Andrew Menger. 2017. &quot;Practical and Effective Approaches to Dealing with Clustered Data.&quot; <em>Political Science Research and Methods</em> forthcoming: 1-35. &lt;URL:http://jee3.web.rice.edu/cluster-paper.pdf&gt;.
</p>
<p>Ibragimov, Rustam, and Ulrich K. Muller. 2010. &quot;t-Statistic Based Correlation and Heterogeneity Robust Inference.&quot; <em>Journal of Business &amp; Economic Statistics</em> 28(4): 453-468. &lt;DOI:10.1198/jbes.2009.08046&gt;.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

#####################################################################
# example one: predict whether respondent has a university degree
#####################################################################

require(effects)
data(WVS)
logit.model &lt;- glm(degree ~ religion + gender + age, data=WVS, family=binomial(link="logit"))
summary(logit.model)

# compute cluster-adjusted p-values
clust.im.p &lt;- cluster.im.glm(logit.model, WVS, ~ country, report = T)

############################################################################
# example two: linear model of whether respondent has a university degree
#              with interaction between gender and age + country FEs
############################################################################

WVS$degree.n &lt;- as.numeric(WVS$degree)
WVS$gender.n &lt;- as.numeric(WVS$gender)
WVS$genderXage &lt;- WVS$gender.n * WVS$age
lin.model &lt;- glm(degree.n ~ gender.n + age + genderXage + religion + as.factor(country), data=WVS)

# compute marginal effect of male gender on probability of obtaining a university degree
# using conventional standard errors
age.vec &lt;- seq(from=18, to=90, by=1)
me.age &lt;- coefficients(lin.model)[2] + coefficients(lin.model)[4]*age.vec
plot(me.age ~ age.vec, type="l", ylim=c(-0.1, 0.1), xlab="age", 
     ylab="ME of male gender on Pr(university degree)")
se.age &lt;- sqrt( vcov(lin.model)[2,2] + vcov(lin.model)[4,4]*(age.vec)^2 + 
                2*vcov(lin.model)[2,4]*age.vec)
ci.h &lt;- me.age + qt(0.975, lower.tail=T, df=lin.model$df.residual) * se.age
ci.l &lt;- me.age - qt(0.975, lower.tail=T, df=lin.model$df.residual) * se.age
lines(ci.h ~ age.vec, lty=2)
lines(ci.l ~ age.vec, lty=2)


# cluster on country, compute CIs for marginal effect of gender on degree attainment
# drop the FEs (absorbed into cluster-level coefficients)
lin.model.n &lt;- glm(degree.n ~ gender.n + age + genderXage + religion, data=WVS)
clust.im.result &lt;- cluster.im.glm(lin.model.n, WVS, ~ country, report = T, return.vcv = T)
# compute ME using average of cluster-level estimates (CIs center on this)
me.age.im &lt;- clust.im.result$beta.bar[2] + clust.im.result$beta.bar[4]*age.vec
se.age.im &lt;- sqrt( clust.im.result$vcv[2,2] + clust.im.result$vcv[4,4]*(age.vec)^2 +
                   2*clust.im.result$vcv[2,4]*age.vec)
# center the CIs on the ME using average of cluster-level estimates
# important: divide by sqrt(G) to convert SE of cluster-level estimates 
#            into SE of the mean, where G = number of clusters
G &lt;- length(unique(WVS$country))
ci.h.im &lt;- me.age.im + qt(0.975, lower.tail=T, df=(G-1)) * se.age.im/sqrt(G)
ci.l.im &lt;- me.age.im - qt(0.975, lower.tail=T, df=(G-1)) * se.age.im/sqrt(G)
plot(me.age.im ~ age.vec, type="l", ylim=c(-0.2, 0.2), xlab="age", 
     ylab="ME of male gender on Pr(university degree)")
lines(ci.h.im ~ age.vec, lty=2)
lines(ci.l.im ~ age.vec, lty=2)
# for comparison, here's the ME estimate and CIs from the baseline model
lines(me.age ~ age.vec, lty=1, col="gray")
lines(ci.h ~ age.vec, lty=3, col="gray")
lines(ci.l ~ age.vec, lty=3, col="gray")


## End(Not run)
</code></pre>

<hr>
<h2 id='cluster.im.ivreg'>Cluster-Adjusted Confidence Intervals And p-Values For GLM</h2><span id='topic+cluster.im.ivreg'></span>

<h3>Description</h3>

<p>Computes p-values and confidence intervals for GLM models based on cluster-specific model estimation (Ibragimov and Muller 2010). A separate model is estimated in each cluster, and then p-values and confidence intervals are computed based on a t/normal distribution of the cluster-specific estimates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cluster.im.ivreg(
  mod,
  dat,
  cluster,
  ci.level = 0.95,
  report = TRUE,
  drop = FALSE,
  return.vcv = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cluster.im.ivreg_+3A_mod">mod</code></td>
<td>
<p>A model estimated using <code>ivreg</code>.</p>
</td></tr>
<tr><td><code id="cluster.im.ivreg_+3A_dat">dat</code></td>
<td>
<p>The data set used to estimate <code>mod</code>.</p>
</td></tr>
<tr><td><code id="cluster.im.ivreg_+3A_cluster">cluster</code></td>
<td>
<p>A formula of the clustering variable.</p>
</td></tr>
<tr><td><code id="cluster.im.ivreg_+3A_ci.level">ci.level</code></td>
<td>
<p>What confidence level should CIs reflect?</p>
</td></tr>
<tr><td><code id="cluster.im.ivreg_+3A_report">report</code></td>
<td>
<p>Should a table of results be printed to the console?</p>
</td></tr>
<tr><td><code id="cluster.im.ivreg_+3A_drop">drop</code></td>
<td>
<p>Should clusters within which a model cannot be estimated be dropped?</p>
</td></tr>
<tr><td><code id="cluster.im.ivreg_+3A_return.vcv">return.vcv</code></td>
<td>
<p>Should a VCV matrix and the means of cluster-specific coefficient estimates be returned?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the elements
</p>
<table>
<tr><td><code>p.values</code></td>
<td>
<p>A matrix of the estimated p-values.</p>
</td></tr>
<tr><td><code>ci</code></td>
<td>
<p>A matrix of confidence intervals.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Confidence intervals are centered on the cluster averaged estimate, which can diverge from original model estimates under several circumstances (e.g., if clusters have different numbers of observations). Consequently, confidence intervals may not be centered on original model estimates. If drop = TRUE, any cluster for which all coefficients cannot be estimated will be automatically dropped from the analysis.
</p>


<h3>Author(s)</h3>

<p>Justin Esarey
</p>


<h3>References</h3>

<p>Esarey, Justin, and Andrew Menger. 2017. &quot;Practical and Effective Approaches to Dealing with Clustered Data.&quot; <em>Political Science Research and Methods</em> forthcoming: 1-35. &lt;URL:http://jee3.web.rice.edu/cluster-paper.pdf&gt;.
</p>
<p>Ibragimov, Rustam, and Ulrich K. Muller. 2010. &quot;t-Statistic Based Correlation and Heterogeneity Robust Inference.&quot; <em>Journal of Business &amp; Economic Statistics</em> 28(4): 453-468. &lt;DOI:10.1198/jbes.2009.08046&gt;.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

# example: pooled IV analysis of employment
require(plm)
require(AER)
data(EmplUK)
EmplUK$lag.wage &lt;- lag(EmplUK$wage)
emp.iv &lt;- ivreg(emp ~ wage + log(capital+1) | output + lag.wage + log(capital+1), data = EmplUK)

# compute cluster-adjusted p-values
cluster.im.e &lt;- cluster.im.ivreg(mod=emp.iv, dat=EmplUK, cluster = ~firm)


## End(Not run)
</code></pre>

<hr>
<h2 id='cluster.im.mlogit'>Cluster-Adjusted Confidence Intervals And p-Values For mlogit</h2><span id='topic+cluster.im.mlogit'></span>

<h3>Description</h3>

<p>Computes p-values and confidence intervals for multinomial logit models based on cluster-specific model estimation (Ibragimov and Muller 2010). A separate model is estimated in each cluster, and then p-values and confidence intervals are computed based on a t/normal distribution of the cluster-specific estimates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cluster.im.mlogit(
  mod,
  dat,
  cluster,
  ci.level = 0.95,
  report = TRUE,
  truncate = FALSE,
  return.vcv = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cluster.im.mlogit_+3A_mod">mod</code></td>
<td>
<p>A model estimated using <code>mlogit</code>.</p>
</td></tr>
<tr><td><code id="cluster.im.mlogit_+3A_dat">dat</code></td>
<td>
<p>The data set used to estimate <code>mod</code>.</p>
</td></tr>
<tr><td><code id="cluster.im.mlogit_+3A_cluster">cluster</code></td>
<td>
<p>A formula of the clustering variable.</p>
</td></tr>
<tr><td><code id="cluster.im.mlogit_+3A_ci.level">ci.level</code></td>
<td>
<p>What confidence level should CIs reflect?</p>
</td></tr>
<tr><td><code id="cluster.im.mlogit_+3A_report">report</code></td>
<td>
<p>Should a table of results be printed to the console?</p>
</td></tr>
<tr><td><code id="cluster.im.mlogit_+3A_truncate">truncate</code></td>
<td>
<p>Should outlying cluster-specific beta estimates be excluded?</p>
</td></tr>
<tr><td><code id="cluster.im.mlogit_+3A_return.vcv">return.vcv</code></td>
<td>
<p>Should a VCV matrix and the means of cluster-specific coefficient estimates be returned?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the elements
</p>
<table>
<tr><td><code>p.values</code></td>
<td>
<p>A matrix of the estimated p-values.</p>
</td></tr>
<tr><td><code>ci</code></td>
<td>
<p>A matrix of confidence intervals.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Confidence intervals are centered on the cluster averaged estimate, which can diverge from original model estimates under several circumstances (e.g., if clusters have different numbers of observations). Consequently, confidence intervals may not be centered on original model estimates. Any cluster for which all coefficients cannot be estimated will be automatically dropped from the analysis. If truncate = TRUE, any cluster for which any coefficient is more than 6 times the interquartile range from the cross-cluster mean will also be dropped as an outlier.
</p>


<h3>Author(s)</h3>

<p>Justin Esarey
</p>


<h3>References</h3>

<p>Esarey, Justin, and Andrew Menger. 2017. &quot;Practical and Effective Approaches to Dealing with Clustered Data.&quot; <em>Political Science Research and Methods</em> forthcoming: 1-35. &lt;URL:http://jee3.web.rice.edu/cluster-paper.pdf&gt;.
</p>
<p>Ibragimov, Rustam, and Ulrich K. Muller. 2010. &quot;t-Statistic Based Correlation and Heterogeneity Robust Inference.&quot; <em>Journal of Business &amp; Economic Statistics</em> 28(4): 453-468. &lt;DOI:10.1198/jbes.2009.08046&gt;.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

# example: predict type of heating system installed in house
require(mlogit)
data("Heating", package = "mlogit")
H &lt;- Heating
H$region &lt;- as.numeric(H$region)
H.ml &lt;- dfidx(H, shape="wide", choice="depvar", varying=c(3:12),
         idx = list(c("idcase", "region")))
m &lt;- mlogit(depvar~ic+oc, H.ml)

# compute cluster-adjusted p-values
cluster.im.h &lt;- cluster.im.mlogit(m, H.ml, ~ region)


## End(Not run)
</code></pre>

<hr>
<h2 id='cluster.wild.glm'>Wild Cluster Bootstrapped p-Values For Linear Family GLM</h2><span id='topic+cluster.wild.glm'></span>

<h3>Description</h3>

<p>This software estimates p-values using wild cluster bootstrapped t-statistics for linear family GLM models (Cameron, Gelbach, and Miller 2008). Residuals are repeatedly re-sampled by cluster to form a pseudo-dependent variable, a model is estimated for each re-sampled data set, and inference is based on the sampling distribution of the pivotal (t) statistic. Users may choose whether to impose the null hypothesis for independent variables; the null is never imposed for the intercept or any model that includes factor variables, interactions, or polynomials (although manually specified versions of these can circumvent the restriction). Confidence intervals are only reported when the null hypothesis is <em>not</em> imposed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cluster.wild.glm(
  mod,
  dat,
  cluster,
  ci.level = 0.95,
  impose.null = TRUE,
  boot.reps = 1000,
  report = TRUE,
  prog.bar = TRUE,
  output.replicates = FALSE,
  seed = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cluster.wild.glm_+3A_mod">mod</code></td>
<td>
<p>A linear (identity link) model estimated using <code>glm</code>.</p>
</td></tr>
<tr><td><code id="cluster.wild.glm_+3A_dat">dat</code></td>
<td>
<p>The data set used to estimate <code>mod</code>.</p>
</td></tr>
<tr><td><code id="cluster.wild.glm_+3A_cluster">cluster</code></td>
<td>
<p>A formula of the clustering variable.</p>
</td></tr>
<tr><td><code id="cluster.wild.glm_+3A_ci.level">ci.level</code></td>
<td>
<p>What confidence level should CIs reflect? (Note: only reported when <code>impose.null == FALSE</code>).</p>
</td></tr>
<tr><td><code id="cluster.wild.glm_+3A_impose.null">impose.null</code></td>
<td>
<p>Should we impose the null Ho?</p>
</td></tr>
<tr><td><code id="cluster.wild.glm_+3A_boot.reps">boot.reps</code></td>
<td>
<p>The number of bootstrap samples to draw.</p>
</td></tr>
<tr><td><code id="cluster.wild.glm_+3A_report">report</code></td>
<td>
<p>Should a table of results be printed to the console?</p>
</td></tr>
<tr><td><code id="cluster.wild.glm_+3A_prog.bar">prog.bar</code></td>
<td>
<p>Show a progress bar of the bootstrap (= TRUE) or not (= FALSE).</p>
</td></tr>
<tr><td><code id="cluster.wild.glm_+3A_output.replicates">output.replicates</code></td>
<td>
<p>Should the cluster bootstrap coefficient replicates be output (= TRUE) or not (= FALSE)? Only available when impose.null = FALSE.</p>
</td></tr>
<tr><td><code id="cluster.wild.glm_+3A_seed">seed</code></td>
<td>
<p>Random number seed for replicability (default is NULL).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the elements
</p>
<table>
<tr><td><code>p.values</code></td>
<td>
<p>A matrix of the estimated p-values.</p>
</td></tr>
<tr><td><code>ci</code></td>
<td>
<p>A matrix of confidence intervals (if null not imposed).</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Code to estimate GLM clustered standard errors by Mahmood Arai: http://thetarzan.wordpress.com/2011/06/11/clustered-standard-errors-in-r/. Cluster SE degrees of freedom correction = (M/(M-1)) with M = the number of clusters.
</p>


<h3>Author(s)</h3>

<p>Justin Esarey
</p>


<h3>References</h3>

<p>Esarey, Justin, and Andrew Menger. 2017. &quot;Practical and Effective Approaches to Dealing with Clustered Data.&quot; <em>Political Science Research and Methods</em> forthcoming: 1-35. &lt;URL:http://jee3.web.rice.edu/cluster-paper.pdf&gt;.
</p>
<p>Cameron, A. Colin, Jonah B. Gelbach, and Douglas L. Miller. 2008. &quot;Bootstrap-Based Improvements for Inference with Clustered Errors.&quot; <em>The Review of Economics and Statistics</em> 90(3): 414-427. &lt;DOI:10.1162/rest.90.3.414&gt;.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

#########################################
# example one: predict chicken weight
#########################################

# predict chick weight using diet, do not impose the null hypothesis
# because of factor variable "Diet"
data(ChickWeight)
weight.mod &lt;- glm(formula = weight~Diet,data=ChickWeight)
cluster.wd.w.1 &lt;-cluster.wild.glm(weight.mod, dat = ChickWeight,cluster = ~Chick, boot.reps = 1000)

# impose null
dum &lt;- model.matrix(~ ChickWeight$Diet)
ChickWeight$Diet2 &lt;- as.numeric(dum[,2])
ChickWeight$Diet3 &lt;- as.numeric(dum[,3])
ChickWeight$Diet4 &lt;- as.numeric(dum[,4])

weight.mod2 &lt;- glm(formula = weight~Diet2+Diet3+Diet4,data=ChickWeight)
cluster.wd.w.2 &lt;-cluster.wild.glm(weight.mod2, dat = ChickWeight,cluster = ~Chick, boot.reps = 1000)

############################################################################
# example two: linear model of whether respondent has a university degree
#              with interaction between gender and age + country FEs
############################################################################

require(effects)
data(WVS)

WVS$degree.n &lt;- as.numeric(WVS$degree)
WVS$gender.n &lt;- as.numeric(WVS$gender)
WVS$genderXage &lt;- WVS$gender.n * WVS$age
lin.model &lt;- glm(degree.n ~ gender.n + age + genderXage + religion, data=WVS)

# compute marginal effect of male gender on probability of obtaining a university degree
# using conventional standard errors
age.vec &lt;- seq(from=18, to=90, by=1)
me.age &lt;- coefficients(lin.model)[2] + coefficients(lin.model)[4]*age.vec
plot(me.age ~ age.vec, type="l", ylim=c(-0.1, 0.1), xlab="age", 
     ylab="ME of male gender on Pr(university degree)")
se.age &lt;- sqrt( vcov(lin.model)[2,2] + vcov(lin.model)[4,4]*(age.vec)^2 +
                2*vcov(lin.model)[2,4]*age.vec)
ci.h &lt;- me.age + qt(0.975, lower.tail=T, df=lin.model$df.residual) * se.age
ci.l &lt;- me.age - qt(0.975, lower.tail=T, df=lin.model$df.residual) * se.age
lines(ci.h ~ age.vec, lty=2)
lines(ci.l ~ age.vec, lty=2)


# cluster on country, compute CIs for marginal effect of gender on degree attainment
clust.wild.result &lt;- cluster.wild.glm(lin.model, WVS, ~ country, 
                                      impose.null = F, report = T, 
                                      output.replicates=T)
replicates &lt;- clust.wild.result$replicates
me.boot &lt;- matrix(data=NA, nrow=dim(replicates)[1], ncol=length(age.vec))
for(i in 1:dim(replicates)[1]){
  me.boot[i,] &lt;- replicates[i,"gender.n"] + replicates[i,"genderXage"]*age.vec
}
ci.wild &lt;- apply(FUN=quantile, X=me.boot, MARGIN=2, probs=c(0.025, 0.975))

# a little lowess smoothing applied to compensate for discontinuities 
# arising from shifting between replicates
lines(lowess(ci.wild[1,] ~ age.vec), lty=3)
lines(lowess(ci.wild[2,] ~ age.vec), lty=3)

# finishing touches to plot
legend(lty=c(1,2,3), "topleft",
       legend=c("Model Marginal Effect", "Conventional 95% CI",
                "Wild BS 95% CI"))
                

## End(Not run)
</code></pre>

<hr>
<h2 id='cluster.wild.ivreg'>Wild Cluster Bootstrapped p-Values For For Regression With Instrumental Variables</h2><span id='topic+cluster.wild.ivreg'></span>

<h3>Description</h3>

<p>This software estimates p-values using wild cluster bootstrapped t-statistics for instrumental variables regression models (Cameron, Gelbach, and Miller 2008). Residuals are repeatedly re-sampled by cluster to form a pseudo-dependent variable, a model is estimated for each re-sampled data set, and inference is based on the sampling distribution of the pivotal (t) statistic. Users may choose whether to impose the null hypothesis for independent variables; the null is never imposed for the intercept or any model that includes factor variables, interactions, or polynomials (although manually specified versions of these can circumvent the restriction). Confidence intervals are only reported when the null hypothesis is <em>not</em> imposed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cluster.wild.ivreg(
  mod,
  dat,
  cluster,
  ci.level = 0.95,
  impose.null = TRUE,
  boot.reps = 1000,
  report = TRUE,
  prog.bar = TRUE,
  output.replicates = FALSE,
  seed = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cluster.wild.ivreg_+3A_mod">mod</code></td>
<td>
<p>A linear (identity link) model estimated using <code>ivreg</code>.</p>
</td></tr>
<tr><td><code id="cluster.wild.ivreg_+3A_dat">dat</code></td>
<td>
<p>The data set used to estimate <code>mod</code>.</p>
</td></tr>
<tr><td><code id="cluster.wild.ivreg_+3A_cluster">cluster</code></td>
<td>
<p>A formula of the clustering variable.</p>
</td></tr>
<tr><td><code id="cluster.wild.ivreg_+3A_ci.level">ci.level</code></td>
<td>
<p>What confidence level should CIs reflect? (Note: only reported when <code>impose.null == FALSE</code>).</p>
</td></tr>
<tr><td><code id="cluster.wild.ivreg_+3A_impose.null">impose.null</code></td>
<td>
<p>Should we impose the null Ho?</p>
</td></tr>
<tr><td><code id="cluster.wild.ivreg_+3A_boot.reps">boot.reps</code></td>
<td>
<p>The number of bootstrap samples to draw.</p>
</td></tr>
<tr><td><code id="cluster.wild.ivreg_+3A_report">report</code></td>
<td>
<p>Should a table of results be printed to the console?</p>
</td></tr>
<tr><td><code id="cluster.wild.ivreg_+3A_prog.bar">prog.bar</code></td>
<td>
<p>Show a progress bar of the bootstrap (= TRUE) or not (= FALSE).</p>
</td></tr>
<tr><td><code id="cluster.wild.ivreg_+3A_output.replicates">output.replicates</code></td>
<td>
<p>Should the cluster bootstrap coefficient replicates be output (= TRUE) or not (= FALSE)? Only available when impose.null = FALSE.</p>
</td></tr>
<tr><td><code id="cluster.wild.ivreg_+3A_seed">seed</code></td>
<td>
<p>Random number seed for replicability (default is NULL).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the elements
</p>
<table>
<tr><td><code>p.values</code></td>
<td>
<p>A matrix of the estimated p-values.</p>
</td></tr>
<tr><td><code>ci</code></td>
<td>
<p>A matrix of confidence intervals (if null not imposed).</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Code to estimate clustered standard errors by Mahmood Arai: http://thetarzan.wordpress.com/2011/06/11/clustered-standard-errors-in-r/. Cluster SE degrees of freedom correction = (M/(M-1)) with M = the number of clusters.
</p>


<h3>Author(s)</h3>

<p>Justin Esarey
</p>


<h3>References</h3>

<p>Esarey, Justin, and Andrew Menger. 2017. &quot;Practical and Effective Approaches to Dealing with Clustered Data.&quot; <em>Political Science Research and Methods</em> forthcoming: 1-35. &lt;URL:http://jee3.web.rice.edu/cluster-paper.pdf&gt;.
</p>
<p>Cameron, A. Colin, Jonah B. Gelbach, and Douglas L. Miller. 2008. &quot;Bootstrap-Based Improvements for Inference with Clustered Errors.&quot; <em>The Review of Economics and Statistics</em> 90(3): 414-427. &lt;DOI:10.1162/rest.90.3.414&gt;.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

#############################################
# example one: predict cigarette consumption
#############################################
require(AER)
data("CigarettesSW", package = "AER") 
CigarettesSW$rprice &lt;- with(CigarettesSW, price/cpi)
CigarettesSW$rincome &lt;- with(CigarettesSW, income/population/cpi)
CigarettesSW$tdiff &lt;- with(CigarettesSW, (taxs - tax)/cpi)
fm &lt;- ivreg(log(packs) ~ log(rprice) + log(rincome) | 
    log(rincome) + tdiff + I(tax/cpi), data = CigarettesSW)

# compute cluster-adjusted p-values
cluster.wd.c &lt;- cluster.wild.ivreg(fm, dat=CigarettesSW, cluster = ~state, report = T)


################################################
# example two: pooled IV analysis of employment
################################################
require(plm)
require(AER)
data(EmplUK)
EmplUK$lag.wage &lt;- lag(EmplUK$wage)
emp.iv &lt;- ivreg(emp ~ wage + log(capital+1) | output + lag.wage + log(capital+1), data = EmplUK)

# compute cluster-adjusted p-values
cluster.wd.e &lt;- cluster.wild.ivreg(mod=emp.iv, dat=EmplUK, cluster = ~firm)


## End(Not run)
</code></pre>

<hr>
<h2 id='cluster.wild.plm'>Wild Cluster Bootstrapped p-Values For PLM</h2><span id='topic+cluster.wild.plm'></span>

<h3>Description</h3>

<p>This software estimates p-values using wild cluster bootstrapped t-statistics for fixed effects panel linear models (Cameron, Gelbach, and Miller 2008). Residuals are repeatedly re-sampled by cluster to form a pseudo-dependent variable, a model is estimated for each re-sampled data set, and inference is based on the sampling distribution of the pivotal (t) statistic. The null is never imposed for PLM models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cluster.wild.plm(
  mod,
  dat,
  cluster,
  ci.level = 0.95,
  boot.reps = 1000,
  report = TRUE,
  prog.bar = TRUE,
  output.replicates = FALSE,
  seed = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cluster.wild.plm_+3A_mod">mod</code></td>
<td>
<p>A &quot;within&quot; model estimated using <code>plm</code>.</p>
</td></tr>
<tr><td><code id="cluster.wild.plm_+3A_dat">dat</code></td>
<td>
<p>The data set used to estimate <code>mod</code>.</p>
</td></tr>
<tr><td><code id="cluster.wild.plm_+3A_cluster">cluster</code></td>
<td>
<p>Clustering dimension (&quot;group&quot;, the default, or &quot;time&quot;).</p>
</td></tr>
<tr><td><code id="cluster.wild.plm_+3A_ci.level">ci.level</code></td>
<td>
<p>What confidence level should CIs reflect? (Note: only reported when <code>impose.null == FALSE</code>).</p>
</td></tr>
<tr><td><code id="cluster.wild.plm_+3A_boot.reps">boot.reps</code></td>
<td>
<p>The number of bootstrap samples to draw.</p>
</td></tr>
<tr><td><code id="cluster.wild.plm_+3A_report">report</code></td>
<td>
<p>Should a table of results be printed to the console?</p>
</td></tr>
<tr><td><code id="cluster.wild.plm_+3A_prog.bar">prog.bar</code></td>
<td>
<p>Show a progress bar of the bootstrap (= TRUE) or not (= FALSE).</p>
</td></tr>
<tr><td><code id="cluster.wild.plm_+3A_output.replicates">output.replicates</code></td>
<td>
<p>Should the cluster bootstrap coefficient replicates be output (= TRUE) or not (= FALSE)?</p>
</td></tr>
<tr><td><code id="cluster.wild.plm_+3A_seed">seed</code></td>
<td>
<p>Random number seed for replicability (default is NULL).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the elements
</p>
<table>
<tr><td><code>p.values</code></td>
<td>
<p>A matrix of the estimated p-values.</p>
</td></tr>
<tr><td><code>ci</code></td>
<td>
<p>A matrix of confidence intervals (if null not imposed).</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Justin Esarey
</p>


<h3>References</h3>

<p>Esarey, Justin, and Andrew Menger. 2017. &quot;Practical and Effective Approaches to Dealing with Clustered Data.&quot; <em>Political Science Research and Methods</em> forthcoming: 1-35. &lt;URL:http://jee3.web.rice.edu/cluster-paper.pdf&gt;.
</p>
<p>Cameron, A. Colin, Jonah B. Gelbach, and Douglas L. Miller. 2008. &quot;Bootstrap-Based Improvements for Inference with Clustered Errors.&quot; <em>The Review of Economics and Statistics</em> 90(3): 414-427. &lt;DOI:10.1162/rest.90.3.414&gt;.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

# predict employment levels, cluster on group
require(plm)
data(EmplUK)

emp.1 &lt;- plm(emp ~ wage + log(capital+1), data = EmplUK, model = "within",
             index=c("firm", "year"))
cluster.wild.plm(mod=emp.1, dat=EmplUK, cluster="group", ci.level = 0.95,
        boot.reps = 1000, report = TRUE, prog.bar = TRUE)

# cluster on time
cluster.wild.plm(mod=emp.1, dat=EmplUK, cluster="time", ci.level = 0.95, 
            boot.reps = 1000, report = TRUE, prog.bar = TRUE)


## End(Not run)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
