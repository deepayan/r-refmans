<!DOCTYPE html><html><head><title>Help for package twangMediation</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {twangMediation}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#twangMediation-package'><p>twangMediation: Twang Causal Mediation Modeling via Weighting</p></a></li>
<li><a href='#bal.table.mediation'><p>Compute the balance table for mediation object.</p></a></li>
<li><a href='#calculate_effects'><p>Calculate the actual effects</p></a></li>
<li><a href='#check_missing'><p>Check vector for NA or NAN values.</p></a></li>
<li><a href='#desc.effects'><p>Describe the effects</p></a></li>
<li><a href='#desc.effects.mediation'><p>Describe the effects from a mediation object</p></a></li>
<li><a href='#dx.wts.mediation'><p>Compute diagnostics assessing covariates balance.</p></a></li>
<li><a href='#NSDUH_female'><p>A dataset containing the substance use condition and sexual orientation</p>
of 40293 women respondents to the 2017 &amp; 2018 National Survey of Drug Use
and Health.</a></li>
<li><a href='#plot.mediation'><p>Plot the <code>mediation</code> object.</p></a></li>
<li><a href='#print.bal.table.mediation'><p>Default print statement for <code>mediation</code> class</p></a></li>
<li><a href='#print.mediation'><p>Default print statement for <code>mediation</code> class</p></a></li>
<li><a href='#summary.mediation'><p>Displays a useful description of a <code>mediation</code> object.</p></a></li>
<li><a href='#swapTxCtrl'><p>Auxiliary function to swap treatment and control in one element of a desc</p>
object from a ps object or dx.wts object</a></li>
<li><a href='#tMdat'><p>Simulated data for twangMediation</p></a></li>
<li><a href='#weighted_mean'><p>Calculate a weighted mean.</p></a></li>
<li><a href='#wgtmed'><p>Weighted mediation analysis.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Twang Causal Mediation Modeling via Weighting</td>
</tr>
<tr>
<td>Version:</td>
<td>1.2</td>
</tr>
<tr>
<td>Author:</td>
<td>Dan McCaffrey [aut, cre],
  Katherine Castellano [aut],
  Donna Coffman [aut],
  Brian Vegetabile [aut],
  Megan Schuler [aut],
  Haoyu Zhou [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Dan McCaffrey &lt;dmccaffrey@ets.org&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides functions for estimating natural direct and indirect effects for mediation analysis. It uses weighting where the weights are functions of estimates of the probability of exposure or treatment assignment (Hong, G (2010). <a href="https://cepa.stanford.edu/sites/default/files/workshops/GH_JSM%20Proceedings%202010.pdf">https://cepa.stanford.edu/sites/default/files/workshops/GH_JSM%20Proceedings%202010.pdf</a> Huber, M. (2014). &lt;<a href="https://doi.org/10.1002%2Fjae.2341">doi:10.1002/jae.2341</a>&gt;). Estimation of probabilities can use generalized boosting or logistic regression. Additional functions provide diagnostics of the model fit and weights. The vignette provides details and examples.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>Imports:</td>
<td>twang, gbm (&ge; 1.5-3), graphics, stats, lattice, latticeExtra,
survey</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, xgboost</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-08-11 20:59:47 UTC; tophey</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-08-16 11:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='twangMediation-package'>twangMediation: Twang Causal Mediation Modeling via Weighting</h2><span id='topic+twangMediation'></span><span id='topic+twangMediation-package'></span>

<h3>Description</h3>

<p>Provides functions for estimating natural direct and indirect effects for mediation analysis. It uses weighting where the weights are functions of estimates of the probability of exposure or treatment assignment (Hong, G (2010). &lt;https://cepa.stanford.edu/sites/default/files/workshops/GH_JSM
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Dan McCaffrey <a href="mailto:dmccaffrey@ets.org">dmccaffrey@ets.org</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> Katherine Castellano <a href="mailto:kecastellano@ets.org">kecastellano@ets.org</a>
</p>
</li>
<li><p> Donna Coffman <a href="mailto:donna.coffman@temple.edu">donna.coffman@temple.edu</a>
</p>
</li>
<li><p> Brian Vegetabile <a href="mailto:bvegetab@rand.org">bvegetab@rand.org</a>
</p>
</li>
<li><p> Megan Schuler <a href="mailto:mschuler@rand.org">mschuler@rand.org</a>
</p>
</li>
<li><p> Haoyu Zhou <a href="mailto:haoyu.zhou@temple.edu">haoyu.zhou@temple.edu</a>
</p>
</li></ul>


<hr>
<h2 id='bal.table.mediation'>Compute the balance table for mediation object.</h2><span id='topic+bal.table.mediation'></span>

<h3>Description</h3>

<p>Compute the balance table for mediation object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bal.table.mediation(x, digits = 3, details = FALSE, plot = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bal.table.mediation_+3A_x">x</code></td>
<td>
<p>A <code>mediation</code> object</p>
</td></tr>
<tr><td><code id="bal.table.mediation_+3A_digits">digits</code></td>
<td>
<p>Number of digits to round to. Dafault: 3</p>
</td></tr>
<tr><td><code id="bal.table.mediation_+3A_details">details</code></td>
<td>
<p>logical. If <code>TRUE</code> covariate balance for the models
used to create the inputs into the weights used in effect estimation
is checked. If <code>FALSE</code> the additional balance is not checked.</p>
</td></tr>
<tr><td><code id="bal.table.mediation_+3A_plot">plot</code></td>
<td>
<p>logical. If <code>TRUE</code>, plots of the balance for all covariates
are outputted for each type of effect (NIE0, NIE1, NDE0, NDE1, TE)
for each stopping method. If <code>FALSE</code>, no plots are returned.</p>
</td></tr>
<tr><td><code id="bal.table.mediation_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>res</code></td>
<td>
<p>tables detailing covariate balance across
exposure groups both before and after weighting</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+print.bal.table.mediation">print.bal.table.mediation</a></code>, <code><a href="#topic+wgtmed">wgtmed</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("tMdat")

## tMdat is small simulated data set included in twangMedRiation for 
## demonstrating the functions. See ?tMdat for details

fit.es.max &lt;- wgtmed(M ~ w1 + w2 + w3,
                      data = tMdat,
                      a_treatment = "A",
                      y_outcome = "Y",
                      total_effect_wts = tMdat$te.wgt,
                      method = "logistic"
                      )

bal.table.mediation(fit.es.max)
</code></pre>

<hr>
<h2 id='calculate_effects'>Calculate the actual effects</h2><span id='topic+calculate_effects'></span>

<h3>Description</h3>

<p>Calculate the actual effects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_effects(w_11, w_00, w_10, w_01, y_outcome, sampw = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calculate_effects_+3A_w_11">w_11</code></td>
<td>
<p>The Y(1, M(1)) weights</p>
</td></tr>
<tr><td><code id="calculate_effects_+3A_w_00">w_00</code></td>
<td>
<p>The Y(0, M(0)) weights</p>
</td></tr>
<tr><td><code id="calculate_effects_+3A_w_10">w_10</code></td>
<td>
<p>The Y(1, M(0)) weights</p>
</td></tr>
<tr><td><code id="calculate_effects_+3A_w_01">w_01</code></td>
<td>
<p>The Y(0, M(1)) weights</p>
</td></tr>
<tr><td><code id="calculate_effects_+3A_y_outcome">y_outcome</code></td>
<td>
<p>The Y variable</p>
</td></tr>
<tr><td><code id="calculate_effects_+3A_sampw">sampw</code></td>
<td>
<p>Sampling weights, set to NULL by default.</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>res</code></td>
<td>
<p>The actual effects</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+wgtmed">wgtmed</a></code>
</p>

<hr>
<h2 id='check_missing'>Check vector for NA or NAN values.</h2><span id='topic+check_missing'></span>

<h3>Description</h3>

<p><code>check_missing</code> raises and error if the data contains.
NA or NAN values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_missing(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_missing_+3A_x">x</code></td>
<td>
<p>numeric
The data set to check for NA or NAN values.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Indicator of the existence of NA or NAN values
</p>

<hr>
<h2 id='desc.effects'>Describe the effects</h2><span id='topic+desc.effects'></span>

<h3>Description</h3>

<p>Describe the effects, and calculate standard
errors and confidence intervals
</p>


<h3>Usage</h3>

<pre><code class='language-R'>desc.effects(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="desc.effects_+3A_x">x</code></td>
<td>
<p>An object</p>
</td></tr>
<tr><td><code id="desc.effects_+3A_...">...</code></td>
<td>
<p>list, optional
Additional arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Effects, standard errors and confidence intervals of an object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+desc.effects.mediation">desc.effects.mediation</a></code>, <code><a href="#topic+wgtmed">wgtmed</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("tMdat")

## tMdat is small simulated data set included in twangMediation for 
## demonstrating the functions. See ?tMdat for details

fit.es.max &lt;- wgtmed(M ~ w1 + w2 + w3,
                      data = tMdat,
                      a_treatment = "A",
                      y_outcome = "Y",
                      total_effect_wts = tMdat$te.wgt,
                      method = "ps",
                      ps_n.trees=1500,
                      ps_shrinkage=0.01,
                      ps_stop.method=c("es.max")
                      )

desc.effects(fit.es.max)
</code></pre>

<hr>
<h2 id='desc.effects.mediation'>Describe the effects from a mediation object</h2><span id='topic+desc.effects.mediation'></span>

<h3>Description</h3>

<p>Describe the effects, and calculate standard
errors and confidence intervals from a mediation object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mediation'
desc.effects(x, y_outcome = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="desc.effects.mediation_+3A_x">x</code></td>
<td>
<p>A mediation object</p>
</td></tr>
<tr><td><code id="desc.effects.mediation_+3A_y_outcome">y_outcome</code></td>
<td>
<p>The outcome; if <code>NULL</code>,
then Y must have been provided to the
original mediation function.</p>
</td></tr>
<tr><td><code id="desc.effects.mediation_+3A_...">...</code></td>
<td>
<p>Additional arguments..</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>results</code></td>
<td>
<p>effects, standard errors,
and confidence intervals of a mediation object</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+desc.effects">desc.effects</a></code>, <code><a href="#topic+wgtmed">wgtmed</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("tMdat")

## tMdat is small simulated data set included in twangMediation for 
## demonstrating the functions. See ?tMdat for details

fit.es.max &lt;- wgtmed(M ~ w1 + w2 + w3,
                      data = tMdat,
                      a_treatment = "A",
                      y_outcome = "Y",
                      total_effect_wts = tMdat$te.wgt,
                      method = "ps",
                      ps_n.trees=1500,
                      ps_shrinkage=0.01,
                      ps_stop.method=c("es.max")
                      )

desc.effects(fit.es.max)
</code></pre>

<hr>
<h2 id='dx.wts.mediation'>Compute diagnostics assessing covariates balance.</h2><span id='topic+dx.wts.mediation'></span>

<h3>Description</h3>

<p><code>dx.wts.mediation</code> takes a <code>ps</code> object or a set of propensity scores and
computes diagnostics assessing covariates balance.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dx.wts.mediation(
  x,
  data,
  estimand,
  vars = NULL,
  treat.var,
  x.as.weights = TRUE,
  sampw = NULL,
  perm.test.iters = 0
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dx.wts.mediation_+3A_x">x</code></td>
<td>
<p>A data frame, matrix, or vector of propensity score weights or a ps
object. <code>x</code> can also be a data frame, matrix, or vector of
propensity scores if <code>x.as.weights=FALSE</code>.</p>
</td></tr>
<tr><td><code id="dx.wts.mediation_+3A_data">data</code></td>
<td>
<p>A data frame.</p>
</td></tr>
<tr><td><code id="dx.wts.mediation_+3A_estimand">estimand</code></td>
<td>
<p>The estimand of interest: either &quot;ATT&quot; or &quot;ATE&quot;.</p>
</td></tr>
<tr><td><code id="dx.wts.mediation_+3A_vars">vars</code></td>
<td>
<p>A vector of character strings naming variables in <code>data</code> on
which to assess balance.</p>
</td></tr>
<tr><td><code id="dx.wts.mediation_+3A_treat.var">treat.var</code></td>
<td>
<p>A character string indicating which variable in <code>data</code>
contains the 0/1 treatment group indicator.</p>
</td></tr>
<tr><td><code id="dx.wts.mediation_+3A_x.as.weights">x.as.weights</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code> indicating whether <code>x</code>
specifies propensity score weights or propensity scores.
Ignored if <code>x</code> is a ps object. Default: <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="dx.wts.mediation_+3A_sampw">sampw</code></td>
<td>
<p>Optional sampling weights. If <code>x</code> is a <code>ps</code> object, then the
sampling weights should have been passed to <a href="twang.html#topic+ps">ps</a> and
not specified here. <code>dx.wts.mediation</code> will issue a warning if
<code>x</code> is a ps object and <code>sampw</code> is also specified.</p>
</td></tr>
<tr><td><code id="dx.wts.mediation_+3A_perm.test.iters">perm.test.iters</code></td>
<td>
<p>A non-negative integer giving the number of iterations
of the permutation test for the KS statistic. If <code>perm.test.iters=0</code>,
then the function returns an analytic approximation to the p-value. This
argument is ignored is <code>x</code> is a <code>ps</code> object. Setting
<code>perm.test.iters=200</code> will yield precision to within 3% if the true
p-value is 0.05. Use <code>perm.test.iters=500</code> to be within 2%.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Creates a balance table that compares unweighted and weighted means and
standard deviations, computes effect sizes, and KS statistics to assess the
ability of the propensity scores to balance the treatment and control groups.
</p>


<h3>Value</h3>

<p>Returns a list containing
</p>

<ul>
<li> <p><code>treat</code> The vector of 0/1 treatment assignment indicators.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+wgtmed">wgtmed</a>,<a href="#topic+bal.table.mediation">bal.table.mediation</a>,
  <a href="#topic+print.mediation">print.mediation</a>,<a href="#topic+summary.mediation">summary.mediation</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("tMdat")

## tMdat is small simulated data set included in twangMediation for 
## demonstrating the functions. See ?tMdat for details

fit.es.max &lt;- wgtmed(M ~ w1 + w2 + w3,
                      data = tMdat,
                      a_treatment = "A",
                      y_outcome = "Y",
                      total_effect_wts = tMdat$te.wgt,
                      method = "ps",
                      ps_n.trees=1500,
                      ps_shrinkage=0.01,
                      ps_stop.method=c("es.max")
                      )

## dx.wts.mediation is used internally by bal.table.mediation,
##   print.mediation, and summary.mediation

summary(fit.es.max)
</code></pre>

<hr>
<h2 id='NSDUH_female'>A dataset containing the substance use condition and sexual orientation
of 40293 women respondents to the 2017 &amp; 2018 National Survey of Drug Use
and Health.</h2><span id='topic+NSDUH_female'></span>

<h3>Description</h3>

<p>A dataset containing the substance use condition and sexual orientation
of 40293 women respondents to the 2017 &amp; 2018 National Survey of Drug Use
and Health.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NSDUH_female
</code></pre>


<h3>Format</h3>

<p>A data frame with 40293 rows and 24 variables:
</p>

<dl>
<dt>cigmon</dt><dd><p>indiidual smoked any cigarettes within the past month, yes or no</p>
</dd>
<dt>educ</dt><dd><p>education level, 1 = less than high school diploma,
2 = high school diploma, 3 = some college/associates degree,
4 = college degree or higher</p>
</dd>
<dt>income</dt><dd><p>income level, 1 &lt;= $20,000, 2 = $20,000 - $49,999,
3 = $50,000 - 70,000, 4 = $75,000+</p>
</dd>
<dt>NSDUHwt</dt><dd><p>NSDUH sampling weight</p>
</dd>
<dt>vestr</dt><dd><p>NSDUH strata variable</p>
</dd>
<dt>verep</dt><dd><p>NSDUH replicate within stratum</p>
</dd>
<dt>employ</dt><dd><p>employment status, 1 = full-time employment,
2 = part-time employment, 3 = student, 4 = unemployed, 5 = other</p>
</dd>
<dt>race</dt><dd><p>1 = non-Hispanic white, 2 = non-Hispanic Black,
3 = student, 4 = multiracial/other race</p>
</dd>
<dt>alc15</dt><dd><p>iniciated alcohol use prior to 15 years old</p>
</dd>
<dt>cig15</dt><dd><p>iniciated smoking prior to 15 years old, yes or no</p>
</dd>
<dt>lgb_flag</dt><dd><p>1 = lesbian, gay or sexual, 0 = heterosexual</p>
</dd>
<dt>alc_cig_depend</dt><dd><p>individual meets criteria for
either past-year alcohol use disorder or nicotine dependence</p>
</dd>
<dt>weight2y</dt><dd><p>NSDUH sampling weights(scaled for
pooling 2017 and 2018 survey years)</p>
</dd>
<dt>age</dt><dd><p>age, 1 = 18-25, 2 = 26-34, 3 = 35-49, 4 = 50+</p>
</dd>
</dl>



<h3>Value</h3>

<table>
<tr><td><code>NSDUH_female</code></td>
<td>
<p>A sample data for demonstration</p>
</td></tr>
</table>


<h3>Source</h3>

<p><a href="https://nsduhweb.rti.org/respweb/homepage.cfm">https://nsduhweb.rti.org/respweb/homepage.cfm</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+wgtmed">wgtmed</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data(NSDUH_female)

## End(Not run)
</code></pre>

<hr>
<h2 id='plot.mediation'>Plot the <code>mediation</code> object.</h2><span id='topic+plot.mediation'></span>

<h3>Description</h3>

<p>Plot the <code>mediation</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mediation'
plot(x, subset = NULL, color = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.mediation_+3A_x">x</code></td>
<td>
<p>weighted_mediation object</p>
</td></tr>
<tr><td><code id="plot.mediation_+3A_subset">subset</code></td>
<td>
<p>Used to restrict which of the <code>stop.method</code>s will be used
in the figure. For example <code>subset = c(1,3)</code> would indicate that the
first and third <code>stop.method</code>s (in alphabetical order of those specified
in the original call to the mediation function) should be included in the
figure. If x$method = <code>logistic</code> or <code>crossval</code>, there is no need to subset
as there is only one method used.</p>
</td></tr>
<tr><td><code id="plot.mediation_+3A_color">color</code></td>
<td>
<p>If <code>color = FALSE</code>, figures will be gray scale. Default: <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot.mediation_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Distribution plots of NIE1 (distribution of mediator for treatment
sample weighted to match distribution of mediator under control for the population)
and NIE0 (distribution of mediator for control sample weighted to match
distribution of mediator under treatment for the population) for each mediator.
For continuous mediators, distributions are plotted with density curves and
for categorical (factor) mediators, distributions are plotted with barplots. .
</p>


<h3>See Also</h3>

<p><code><a href="#topic+wgtmed">wgtmed</a></code> for function input
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("tMdat")

## tMdat is small simulated data set included in twangMediation for 
## demonstrating the functions. See ?tMdat for details

fit.es.max &lt;- wgtmed(M ~ w1 + w2 + w3,
                      data = tMdat,
                      a_treatment = "A",
                      y_outcome = "Y",
                      total_effect_wts = tMdat$te.wgt,
                      method = "ps",
                      ps_n.trees=1500,
                      ps_shrinkage=0.01,
                      ps_stop.method=c("es.max")
                      )

plot(fit.es.max)
</code></pre>

<hr>
<h2 id='print.bal.table.mediation'>Default print statement for <code>mediation</code> class</h2><span id='topic+print.bal.table.mediation'></span>

<h3>Description</h3>

<p>Default print statement for <code>mediation</code> class
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bal.table.mediation'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.bal.table.mediation_+3A_x">x</code></td>
<td>
<p>A <code>bal.table.mediation</code> object.</p>
</td></tr>
<tr><td><code id="print.bal.table.mediation_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Default print statement.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bal.table.mediation">bal.table.mediation</a></code>, <code><a href="#topic+wgtmed">wgtmed</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("tMdat")

## tMdat is small simulated data set included in twangMediation for 
## demonstrating the functions. See ?tMdat for details

fit.es.max &lt;- wgtmed(M ~ w1 + w2 + w3,
                      data = tMdat,
                      a_treatment = "A",
                      y_outcome = "Y",
                      total_effect_wts = tMdat$te.wgt,
                      method = "ps",
                      ps_n.trees=1500,
                      ps_shrinkage=0.01,
                      ps_stop.method=c("es.max")
                      )

bal.table.mediation(fit.es.max)
</code></pre>

<hr>
<h2 id='print.mediation'>Default print statement for <code>mediation</code> class</h2><span id='topic+print.mediation'></span>

<h3>Description</h3>

<p>Default print statement for <code>mediation</code> class
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mediation'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.mediation_+3A_x">x</code></td>
<td>
<p>A <code>mediation</code> object.</p>
</td></tr>
<tr><td><code id="print.mediation_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Default print statement.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+wgtmed">wgtmed</a></code> for in put.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("tMdat")

## tMdat is small simulated data set included in twangMediation for 
## demonstrating the functions. See ?tMdat for details

fit.es.max &lt;- wgtmed(M ~ w1 + w2 + w3,
                      data = tMdat,
                      a_treatment = "A",
                      y_outcome = "Y",
                      total_effect_wts = tMdat$te.wgt,
                      method = "ps",
                      ps_n.trees=1500,
                      ps_shrinkage=0.01,
                      ps_stop.method=c("es.max")
                      )

print(fit.es.max)
</code></pre>

<hr>
<h2 id='summary.mediation'>Displays a useful description of a <code>mediation</code> object.</h2><span id='topic+summary.mediation'></span>

<h3>Description</h3>

<p>Displays a useful description of a <code>mediation</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mediation'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.mediation_+3A_object">object</code></td>
<td>
<p>A <code>mediation</code> object</p>
</td></tr>
<tr><td><code id="summary.mediation_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>ps_tables</code></td>
<td>
<p>Table of observations' propensity scores</p>
</td></tr>
<tr><td><code>mediator_distribution_check</code></td>
<td>
<p>balance tables for NIE_1 and NIE_0</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+wgtmed">wgtmed</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("tMdat")

## tMdat is small simulated data set included in twangMediation for 
## demonstrating the functions. See ?tMdat for details

## The tMdat data contains the following variables
## See ?tMdat for details

fit.es.max &lt;- wgtmed(M ~ w1 + w2 + w3,
                      data = tMdat,
                      a_treatment = "A",
                      y_outcome = "Y",
                      total_effect_wts = tMdat$te.wgt,
                      method = "ps",
                      ps_n.trees=1500,
                      ps_shrinkage=0.01,
                      ps_stop.method=c("es.max")
                      )

summary(fit.es.max)
</code></pre>

<hr>
<h2 id='swapTxCtrl'>Auxiliary function to swap treatment and control in one element of a desc
object from a ps object or dx.wts object</h2><span id='topic+swapTxCtrl'></span>

<h3>Description</h3>

<p>Call this in the <code>wgtmed()</code> function and the <code>bal.table.mediation()</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>swapTxCtrl(dd)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="swapTxCtrl_+3A_dd">dd</code></td>
<td>
<p>numeric
An element of a desc object from a ps or dx.wts object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A desc object with swapped treatment and control
</p>


<h3>See Also</h3>

<p><code><a href="twang.html#topic+ps">ps</a></code>, <code><a href="#topic+dx.wts.mediation">dx.wts.mediation</a></code>
</p>

<hr>
<h2 id='tMdat'>Simulated data for twangMediation</h2><span id='topic+tMdat'></span>

<h3>Description</h3>

<p>A simulate dataset for demonstrating the functions in the twangMediation
package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tMdat
</code></pre>


<h3>Format</h3>

<p>A data frame with 500 rows and 7 variables:
</p>

<dl>
<dt>w1</dt><dd><p>Simulated continuous covariate</p>
</dd>
<dt>w2</dt><dd><p>Simulated continuous covariate</p>
</dd>
<dt>w3</dt><dd><p>Simulated continuous covariate</p>
</dd>
<dt>A</dt><dd><p>Simulated dichotomous exposure indicator</p>
</dd>
<dt>Y</dt><dd><p>Simulated continuous outcome</p>
</dd>
<dt>M</dt><dd><p>Simulated mediator that has 11 unique values</p>
</dd>
<dt>te.wgt</dt><dd><p>Estimated inverse probability weight, estimated using GBM via the twang ps function</p>
</dd>
</dl>



<h3>Value</h3>

<table>
<tr><td><code>tMdat</code></td>
<td>
<p>A sample of simulated data for demonstration</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+wgtmed">wgtmed</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data(tMdat)

## End(Not run)
</code></pre>

<hr>
<h2 id='weighted_mean'>Calculate a weighted mean.</h2><span id='topic+weighted_mean'></span>

<h3>Description</h3>

<p><code>weighted_mean</code> calculates a weighted mean, given a vector.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>weighted_mean(x, weights, multiplier = NULL, na.rm = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="weighted_mean_+3A_x">x</code></td>
<td>
<p>numeric
The the data set</p>
</td></tr>
<tr><td><code id="weighted_mean_+3A_weights">weights</code></td>
<td>
<p>numeric
The weights</p>
</td></tr>
<tr><td><code id="weighted_mean_+3A_multiplier">multiplier</code></td>
<td>
<p>An additional vector to multiply
Default : <code>NULL</code></p>
</td></tr>
<tr><td><code id="weighted_mean_+3A_na.rm">na.rm</code></td>
<td>
<p>Whether to remove NA values.
Default: <code>TRUE</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>numeric
The weighted mean of the data.
</p>

<hr>
<h2 id='wgtmed'>Weighted mediation analysis.</h2><span id='topic+wgtmed'></span>

<h3>Description</h3>

<p>Estimate causal mediation mechanism of a treatment
using propensity score weighting.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wgtmed(
  formula.med,
  data,
  a_treatment,
  y_outcome = NULL,
  med_interact = NULL,
  total_effect_wts = NULL,
  total_effect_ps = NULL,
  total_effect_stop_rule = NULL,
  method = "ps",
  sampw = NULL,
  ps_n.trees = 10000,
  ps_interaction.depth = 3,
  ps_shrinkage = 0.01,
  ps_bag.fraction = 1,
  ps_n.minobsinnode = 10,
  ps_perm.test.iters = 0,
  ps_verbose = FALSE,
  ps_stop.method = c("ks.mean", "ks.max"),
  ps_version = "gbm",
  ps_ks.exact = NULL,
  ps_n.keep = 1,
  ps_n.grid = 25,
  ps_cv.folds = 10,
  ps_keep.data = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="wgtmed_+3A_formula.med">formula.med</code></td>
<td>
<p>A object of class <a href="stats.html#topic+formula">formula</a> relating the mediatior(s)
to the covariates (potential confounding variables).</p>
</td></tr>
<tr><td><code id="wgtmed_+3A_data">data</code></td>
<td>
<p>A dataset of class <a href="base.html#topic+data.frame">data.frame</a> that includes the treatment indicator, mediator(s), and covariates.</p>
</td></tr>
<tr><td><code id="wgtmed_+3A_a_treatment">a_treatment</code></td>
<td>
<p>The (character) name of the treatment variable, which must be
dichotomous (0, 1).</p>
</td></tr>
<tr><td><code id="wgtmed_+3A_y_outcome">y_outcome</code></td>
<td>
<p>The (character) name of the outcome variable, y. If this is not provided, then
no effects will be calculated and a warning will be raised. Default : <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="wgtmed_+3A_med_interact">med_interact</code></td>
<td>
<p>The (character) vector of names of variables specified on the right-hand side
of formula.med that consist of crossproducts or interactions between a covariate
and the mediator. See the tutorial for details on these variables.</p>
</td></tr>
<tr><td><code id="wgtmed_+3A_total_effect_wts">total_effect_wts</code></td>
<td>
<p>A vector of total effect weights, which if left <code>NULL</code>
then total_effect_ps must be supplied. Default : <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="wgtmed_+3A_total_effect_ps">total_effect_ps</code></td>
<td>
<p>A ps object that contains the total effect weights,</p>
</td></tr>
<tr><td><code id="wgtmed_+3A_total_effect_stop_rule">total_effect_stop_rule</code></td>
<td>
<p>The stopping rule (<code>ks.mean</code>, <code>ks.max</code>, <code>es.mean</code>, <code>es.max</code>) for the total effect weights, which
only needs to be specified if total_effect_ps is provided. Default : <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="wgtmed_+3A_method">method</code></td>
<td>
<p>The method for getting weights (&quot;ps&quot;, &quot;logistic&quot;, or &quot;crossval&quot;). Default : <code>"ps"</code>.</p>
</td></tr>
<tr><td><code id="wgtmed_+3A_sampw">sampw</code></td>
<td>
<p>Optional sampling weights Default : <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="wgtmed_+3A_ps_n.trees">ps_n.trees</code></td>
<td>
<p>Number of gbm iterations passed on to <a href="gbm.html#topic+gbm">gbm</a>. Default: 10000.</p>
</td></tr>
<tr><td><code id="wgtmed_+3A_ps_interaction.depth">ps_interaction.depth</code></td>
<td>
<p>A positive integer denoting the tree depth used in
gradient boosting. Default: 3.</p>
</td></tr>
<tr><td><code id="wgtmed_+3A_ps_shrinkage">ps_shrinkage</code></td>
<td>
<p>A numeric value between 0 and 1 denoting the learning rate.
See <a href="gbm.html#topic+gbm">gbm</a> for more details. Default: 0.01.</p>
</td></tr>
<tr><td><code id="wgtmed_+3A_ps_bag.fraction">ps_bag.fraction</code></td>
<td>
<p>A numeric value between 0 and 1 denoting the fraction of
the observations randomly selected in each iteration of the gradient
boosting algorithm to propose the next tree. See <a href="gbm.html#topic+gbm">gbm</a> for
more details. Default: 1.0.</p>
</td></tr>
<tr><td><code id="wgtmed_+3A_ps_n.minobsinnode">ps_n.minobsinnode</code></td>
<td>
<p>An integer specifying the minimum number of observations
in the terminal nodes of the trees used in the gradient boosting.  See <a href="gbm.html#topic+gbm">gbm</a> for
more details. Default: 10.</p>
</td></tr>
<tr><td><code id="wgtmed_+3A_ps_perm.test.iters">ps_perm.test.iters</code></td>
<td>
<p>A non-negative integer giving the number of iterations
of the permutation test for the KS statistic. If <code>perm.test.iters=0</code>
then the function returns an analytic approximation to the p-value. Setting
<code>perm.test.iters=200</code> will yield precision to within 3% if the true
p-value is 0.05. Use <code>perm.test.iters=500</code> to be within 2%. Default: 0.</p>
</td></tr>
<tr><td><code id="wgtmed_+3A_ps_verbose">ps_verbose</code></td>
<td>
<p>If <code>TRUE</code>, lots of information will be printed to monitor the
the progress of the fitting. Default: <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="wgtmed_+3A_ps_stop.method">ps_stop.method</code></td>
<td>
<p>A method or methods of measuring and summarizing balance across pretreatment
variables. Current options are <code>ks.mean</code>, <code>ks.max</code>, <code>es.mean</code>, and <code>es.max</code>. <code>ks</code> refers to the
Kolmogorov-Smirnov statistic and es refers to standardized effect size. These are summarized
across the pretreatment variables by either the maximum (<code>.max</code>) or the mean (<code>.mean</code>).
Default: <code>c("ks.mean", "ks.max")</code>.</p>
</td></tr>
<tr><td><code id="wgtmed_+3A_ps_version">ps_version</code></td>
<td>
<p>&quot;gbm&quot;, &quot;xgboost&quot;, or &quot;legacy&quot;, indicating which version of the twang package to use.
</p>

<ul>
<li> <p><code>"gbm"</code> uses gradient boosting from the <code><a href="gbm.html#topic+gbm">gbm</a></code> package.
</p>
</li>
<li> <p><code>"xgboost"</code> uses gradient boosting from the <code><a href="xgboost.html#topic+xgboost">xgboost</a></code> package.
</p>
</li>
<li> <p><code>"legacy"</code> uses the prior implementation of the <code>ps</code> function.
</p>
</li></ul>
</td></tr>
<tr><td><code id="wgtmed_+3A_ps_ks.exact">ps_ks.exact</code></td>
<td>
<p><code>NULL</code> or a logical indicating whether the
Kolmogorov-Smirnov p-value should be based on an approximation of exact
distribution from an unweighted two-sample Kolmogorov-Smirnov test. If
<code>NULL</code>, the approximation based on the exact distribution is computed
if the product of the effective sample sizes is less than 10,000.
Otherwise, an approximation based on the asymptotic distribution is used.
<strong>Warning:</strong> setting <code>ks.exact = TRUE</code> will add substantial
computation time for larger sample sizes. Default: <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="wgtmed_+3A_ps_n.keep">ps_n.keep</code></td>
<td>
<p>A numeric variable indicating the algorithm should only
consider every <code>n.keep</code>-th iteration of the propensity score model and
optimize balance over this set instead of all iterations. Default : 1.</p>
</td></tr>
<tr><td><code id="wgtmed_+3A_ps_n.grid">ps_n.grid</code></td>
<td>
<p>A numeric variable that sets the grid size for an initial
search of the region most likely to minimize the <code>stop.method</code>. A
value of <code>n.grid=50</code> uses a 50 point grid from <code>1:n.trees</code>. It
finds the minimum, say at grid point 35. It then looks for the actual
minimum between grid points 34 and 36.If specified with <code>n.keep&gt;1</code>, <code>n.grid</code>
corresponds to a grid of points on the kept iterations as defined by <code>n.keep</code>. Default: 25.</p>
</td></tr>
<tr><td><code id="wgtmed_+3A_ps_cv.folds">ps_cv.folds</code></td>
<td>
<p>A numeric variable that sets the number of cross-validation folds if
using method='crossval'. Default: 10.</p>
</td></tr>
<tr><td><code id="wgtmed_+3A_ps_keep.data">ps_keep.data</code></td>
<td>
<p>A logical variable that determines if the dataset should be saved
in the resulting <code>ps</code> model objects. Default: <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For users comfortable with <a href="twang.html#topic+ps">ps</a>, any options prefaced with
<code>ps_</code> are passed directly to the <code>ps()</code> function.
Model A is used to estimate Pr(A=1 | X) where X is the vector of background covariates specified in <code>formula.med</code>. If <code>method</code> equals <code>"ps"</code> model A is fit using the <a href="twang.html#topic+twang">twang</a> <code>ps</code> function with estimand= <code>"ATE"</code>. If <code>method</code> equals <code>"logistic"</code> then model A is fit using logistic regression. If <code>method</code> equals <code>"crossval"</code> then <a href="gbm.html#topic+gbm">gbm</a> using cross-validation is used to estimate model A. Because X might include variables not used to estimate the user-provided total effect weights, model A is fit rather than using the user-provided total effect weights to derive Pr(A | X). If the user uses the same set of variables to estimate their provided total effect weights as they enter in the wgtmed function to estimate the cross-world weights and the user uses the same estimation method and arguments as specified in the wgtmed function, then the estimated model A will match the model the user used to obtain the provided total effect weights.
</p>


<h3>Value</h3>

<p>mediation object
The <code>mediation</code> object includes the following:
</p>

<ul>
<li> <p><code>model_a</code> The model A <code>ps()</code> results.
</p>
</li>
<li> <p><code>model_m1</code> The model M1 <code>ps()</code> results.
</p>
</li>
<li> <p><code>model_m0</code> The model M0 <code>ps()</code> results.
</p>
</li>
<li> <p><code>data</code> The data set used to compute models
</p>
</li>
<li> <p><code>stopping_methods</code> The stopping methods passed to <code>stop.method</code>.
</p>
</li>
<li> <p><code>datestamp</code> The date when the analysis was run.
</p>
</li>
<li><p> For each <code>stop.method</code>, a list with the following:
</p>

<ul>
<li> <p><code>TE</code> The total effect.
</p>
</li>
<li> <p><code>NDE_0</code> The natural direct effect, holding the mediator constant at 0.
</p>
</li>
<li> <p><code>NIE_1</code> The natural indirect effect, holding the exposure constant at 1.
</p>
</li>
<li> <p><code>NDE_1</code> The natural direct effect, holding the mediator constant at 1.
</p>
</li>
<li> <p><code>NIE_0</code> The natural indirect effect, holding the exposure constant at 0.
</p>
</li>
<li> <p><code>expected_treatment0_mediator0</code> E(Y(0, M(0)))
</p>
</li>
<li> <p><code>expected_treatment1_mediator1</code> E(Y(1, M(1)))
</p>
</li>
<li> <p><code>expected_treatment1_mediator0</code> E(Y(1, M(0)))
</p>
</li>
<li> <p><code>expected_treatment0_mediator1</code> E(Y(0, M(1)))
</p>
</li></ul>

</li>
<li> <p><code>dx.wts</code> A list with information for checking covariate balance of for each
estimated effect. Elements are TE, NIE1, NDE0, NIE0, NDE1, with results of
<code>twang</code> <code>dx.wts</code> for the covariates when weighted  by weights used in the
estimating the effect.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="twang.html#topic+ps">ps</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("tMdat")

## tMdat is small simulated data set included in twangMediation for 
## demonstrating the functions. See ?tMdat for details

head(tMdat)

## The tMdat data contains the following variables:
##   w1, w2, w3 -- Simulatad covariates
##   A   -- Simulated dichotomous exposure indicator
##   M   -- Simulated discrete mediator (11 values)
##   Y   -- Simulated continuous outcome
##   te.wgt -- Estimated inverse probability weight, estimated using 
##             GBM via the twang ps function

fit.es.max &lt;- wgtmed(M ~ w1 + w2 + w3,
                      data = tMdat,
                      a_treatment = "A",
                      y_outcome = "Y",
                      total_effect_wts = tMdat$te.wgt,
                      method = "ps",
                      ps_n.trees=1500,
                      ps_shrinkage=0.01,
                      ps_stop.method=c("es.max")
                      )

fit.es.max
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
