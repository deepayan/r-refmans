<!DOCTYPE html><html lang="en"><head><title>Help for package rakeR</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {rakeR}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#check_constraint'><p>check_constraint</p></a></li>
<li><a href='#check_ind'><p>check_ind</p></a></li>
<li><a href='#extract'><p>extract</p></a></li>
<li><a href='#extract_weights'><p>extract_weights</p></a></li>
<li><a href='#integerise'><p>integerise</p></a></li>
<li><a href='#rake'><p>rake</p></a></li>
<li><a href='#simulate'><p>simulate</p></a></li>
<li><a href='#weight'><p>weight</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Easy Spatial Microsimulation (Raking) in R</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2017-10-10</td>
</tr>
<tr>
<td>Description:</td>
<td>Functions for performing spatial microsimulation ('raking')
    in R.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.4.0)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>6.0.1</td>
</tr>
<tr>
<td>Imports:</td>
<td>ipfp, wrswoR</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat, readr</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://philmikejones.github.io/rakeR/">https://philmikejones.github.io/rakeR/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/philmikejones/rakeR/issues">https://github.com/philmikejones/rakeR/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2017-10-10 13:39:10 UTC; lw1pj</td>
</tr>
<tr>
<td>Author:</td>
<td>Phil Mike Jones <a href="https://orcid.org/0000-0001-5173-3245"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Robin Lovelace [aut] (Many functions are based on code by Robin
    Lovelace and Morgane Dumont),
  Morgane Dumont [aut] (Many functions are based on code by Robin
    Lovelace and Morgane Dumont),
  Andrew Smith [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Phil Mike Jones &lt;philmikejones@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2017-10-10 13:44:46 UTC</td>
</tr>
</table>
<hr>
<h2 id='check_constraint'>check_constraint</h2><span id='topic+check_constraint'></span>

<h3>Description</h3>

<p>Checks a constraint table for common errors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_constraint(constraint_var, num_zones)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_constraint_+3A_constraint_var">constraint_var</code></td>
<td>
<p>The constraint table to check, usually a data frame</p>
</td></tr>
<tr><td><code id="check_constraint_+3A_num_zones">num_zones</code></td>
<td>
<p>The number of zones that should be present in the table</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Checks a constraint table for the following common errors:
</p>

<ul>
<li><p> Ensures all zone codes are unique
</p>
</li>
<li><p> Ensures there are the expected number of zones
</p>
</li>
<li><p> Ensures all but the zone column are numeric (integer or double)
</p>
</li></ul>



<h3>Value</h3>

<p>If no errors are detected the function returns silently. Any errors
will stop the function or script to be investigated.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cons &lt;- data.frame(
"zone"      = letters[1:3],
"age_0_49"  = c(8, 2, 7),
"age_gt_50" = c(4, 8, 4),
"sex_f"     = c(6, 6, 8),
"sex_m"     = c(6, 4, 3)
)
check_constraint(cons, 3)  # no errors
</code></pre>

<hr>
<h2 id='check_ind'>check_ind</h2><span id='topic+check_ind'></span>

<h3>Description</h3>

<p>Checks an individual (survey) variable for common errors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_ind(ind_var)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_ind_+3A_ind_var">ind_var</code></td>
<td>
<p>the individual (survey) variable you want to check</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Checks an individual (survey) variable for the following common errors:
</p>

<ul>
<li><p> That each row sums to 1 (i.e. correctly converted to a dummy
variable)
</p>
</li></ul>



<h3>Value</h3>

<p>If no errors are detected the function returns silently. Any errors
will stop the function or script to be investigated.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## check_ind(ind_var)
</code></pre>

<hr>
<h2 id='extract'>extract</h2><span id='topic+extract'></span>

<h3>Description</h3>

<p>Extract aggregate weights from individual weight table
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract(weights, inds, id)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="extract_+3A_weights">weights</code></td>
<td>
<p>A weight table, typically produced by rakeR::weight()</p>
</td></tr>
<tr><td><code id="extract_+3A_inds">inds</code></td>
<td>
<p>The individual level data</p>
</td></tr>
<tr><td><code id="extract_+3A_id">id</code></td>
<td>
<p>The unique id variable in the individual level data (inds),
usually the first column</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Extract aggregate weights from individual weight table, typically produced
by rakeR::weight()
</p>
<p>Extract cannot operate with numeric variables because it creates a new
variable for each unique factor of each variable
If you want numeric information, like income, use integerise() instead.
</p>


<h3>Value</h3>

<p>A data frame with zones and aggregated simulated values for each
variable
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run
## Use weights object from weights()
## ext_weights &lt;- extract(weights = weights, inds = inds, id = "id")
</code></pre>

<hr>
<h2 id='extract_weights'>extract_weights</h2><span id='topic+extract_weights'></span>

<h3>Description</h3>

<p>Deprecated: use rakeR::extract()
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_weights(weights, inds, id)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="extract_weights_+3A_weights">weights</code></td>
<td>
<p>A weight table, typically produced by rakeR::weight()</p>
</td></tr>
<tr><td><code id="extract_weights_+3A_inds">inds</code></td>
<td>
<p>The individual level data</p>
</td></tr>
<tr><td><code id="extract_weights_+3A_id">id</code></td>
<td>
<p>The unique id variable in the individual level data (inds),
usually the first column</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with zones and aggregated simulated values for each
variable
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run
## extract_weights() is deprecated, use extract() instead
</code></pre>

<hr>
<h2 id='integerise'>integerise</h2><span id='topic+integerise'></span><span id='topic+integerize'></span>

<h3>Description</h3>

<p>Generate integer cases from numeric weights matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>integerise(weights, inds, method = "trs", seed = 42)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="integerise_+3A_weights">weights</code></td>
<td>
<p>A matrix or data frame of fractional weights, typically
provided by <code>rakeR::weight()</code></p>
</td></tr>
<tr><td><code id="integerise_+3A_inds">inds</code></td>
<td>
<p>The individual&ndash;level data (i.e. one row per individual)</p>
</td></tr>
<tr><td><code id="integerise_+3A_method">method</code></td>
<td>
<p>The integerisation method specified as a character string.
Defaults to <code>"trs"</code>; currently other methods are not implemented.</p>
</td></tr>
<tr><td><code id="integerise_+3A_seed">seed</code></td>
<td>
<p>The seed to use, defaults to 42.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Extracted weights (using rakeR::extract()) are more 'precise' than
integerised weights (although the user should be careful this is not
spurious precision based on context) as they return fractions.
Nevertheless, integerised weights are useful in cases when:
</p>

<ul>
<li><p>Numeric information (such as income) is required, as this needs
to be cut() to work with rakeR::extract()
</p>
</li>
<li><p>Simulated 'individuals' are required for case studies of key
areas.
</p>
</li>
<li><p>Input individual-level data for agent-based or dynamic models are
required
</p>
</li></ul>

<p>The default integerisation method uses the 'truncate, replicate, sample'
method developed by Robin Lovelace and Dimitris Ballas
<a href="http://www.sciencedirect.com/science/article/pii/S0198971513000240">http://www.sciencedirect.com/science/article/pii/S0198971513000240</a>
</p>
<p>Other methods (for example proportional probabilities) may be implemented
at a later date.
</p>


<h3>Value</h3>

<p>A data frame of integerised cases
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cons &lt;- data.frame(
  "zone"      = letters[1:3],
  "age_0_49"  = c(8, 2, 7),
  "age_gt_50" = c(4, 8, 4),
  "sex_f"     = c(6, 6, 8),
  "sex_m"     = c(6, 4, 3),
  stringsAsFactors = FALSE
)

inds &lt;- data.frame(
  "id"     = LETTERS[1:5],
  "age"    = c("age_gt_50", "age_gt_50", "age_0_49", "age_gt_50", "age_0_49"),
  "sex"    = c("sex_m", "sex_m", "sex_m", "sex_f", "sex_f"),
  "income" = c(2868, 2474, 2231, 3152, 2473),
  stringsAsFactors = FALSE
)
vars &lt;- c("age", "sex")

weights     &lt;- weight(cons = cons, inds = inds, vars = vars)
weights_int &lt;- integerise(weights, inds = inds)
</code></pre>

<hr>
<h2 id='rake'>rake</h2><span id='topic+rake'></span>

<h3>Description</h3>

<p>A convenience function wrapping <code>weight()</code> and <code>extract()</code> or
<code>weight()</code> and <code>integerise()</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rake(cons, inds, vars, output = "fraction", iterations = 10, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rake_+3A_cons">cons</code></td>
<td>
<p>A data frame of constraint variables</p>
</td></tr>
<tr><td><code id="rake_+3A_inds">inds</code></td>
<td>
<p>A data frame of individual&ndash;level (survey) data</p>
</td></tr>
<tr><td><code id="rake_+3A_vars">vars</code></td>
<td>
<p>A character string of variables to iterate over</p>
</td></tr>
<tr><td><code id="rake_+3A_output">output</code></td>
<td>
<p>A string specifying the desired output, either &quot;fraction&quot;
(extract()) or &quot;integer&quot; (integerise())</p>
</td></tr>
<tr><td><code id="rake_+3A_iterations">iterations</code></td>
<td>
<p>The number of iterations to perform. Defaults to 10.</p>
</td></tr>
<tr><td><code id="rake_+3A_...">...</code></td>
<td>
<p>Additional arguments to pass to depending on desired output:
</p>

<ul>
<li><p>if &quot;fraction&quot; specify 'id' (see extract() documentation)
</p>
</li>
<li><p>if &quot;integer&quot; specify 'method' and 'seed' (see integerise()
documentation)
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with extracted weights (if output == &quot;fraction&quot;, the
default) or integerised cases (if output == &quot;integer&quot;)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## not run
## frac_weights &lt;- rake(cons, inds, vars, output = "fraction",
##                      id = "id")

## int_weight &lt;- rake(cons, inds, vars, output = "integer",
##                    method = "trs", seed = "42")
</code></pre>

<hr>
<h2 id='simulate'>simulate</h2><span id='topic+simulate'></span>

<h3>Description</h3>

<p>Deprecated: integerise() %&gt;% simulate() has been replaced by simply
integerise() to be consistent with extract().
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simulate(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="simulate_+3A_...">...</code></td>
<td>
<p>arguments previously passed to simulate()</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns an error if used. Just use integerise()
</p>

<hr>
<h2 id='weight'>weight</h2><span id='topic+weight'></span>

<h3>Description</h3>

<p>Produces fractional weights using the iterative proportional fitting
algorithm.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>weight(cons, inds, vars = NULL, iterations = 10)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="weight_+3A_cons">cons</code></td>
<td>
<p>A data frame containing all the constraints. This
should be in the format of one row per zone, one column per constraint
category. The first column should be a zone code; all other columns must be
numeric counts.</p>
</td></tr>
<tr><td><code id="weight_+3A_inds">inds</code></td>
<td>
<p>A data frame containing individual&ndash;level (survey) data. This
should be in the format of one row per individual, one column per
constraint. The first column should be an individual ID.</p>
</td></tr>
<tr><td><code id="weight_+3A_vars">vars</code></td>
<td>
<p>A character vector of variables that constrain the simulation
(i.e. independent variables)</p>
</td></tr>
<tr><td><code id="weight_+3A_iterations">iterations</code></td>
<td>
<p>The number of iterations the algorithm should complete.
Defaults to 10</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The first column of each data frame should be an ID. The first column of
<code>cons</code> should contain the zone codes. The first column of <code>inds</code>
should contain the individual unique identifier.
</p>
<p>Both data frames should only contain:
</p>

<ul>
<li><p> an ID column (zone ID <code>cons</code> or individual ID <code>inds</code>).
</p>
</li>
<li><p> constraints <code>inds</code> or constraint category <code>cons</code>.
</p>
</li>
<li> <p><code>inds</code> can optionally contain additional dependent variables
that do not influence the weighting process.
</p>
</li></ul>

<p>No other columns should be present (the user can merge these back in later).
</p>
<p>It is essential that the levels in each <code>inds</code> constraint (i.e. column)
match exactly with the column names in <code>cons</code>. In the example below see
how the column names in cons (<code>'age_0_49', 'sex_f', ...</code>) match exactly
the levels in <code>inds</code> variables.
</p>
<p>The columns in <code>cons</code> must be in alphabetical order because these are
created alphabetically when they are 'spread' in the individual&ndash;level data.
</p>


<h3>Value</h3>

<p>A data frame of fractional weights for each individual in each zone
with zone codes recorded in column names and individual id recorded in row
names.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># SimpleWorld
cons &lt;- data.frame(
"zone"      = letters[1:3],
"age_0_49"  = c(8, 2, 7),
"age_gt_50" = c(4, 8, 4),
"sex_f"     = c(6, 6, 8),
"sex_m"     = c(6, 4, 3),
stringsAsFactors = FALSE
)
inds &lt;- data.frame(
"id"     = LETTERS[1:5],
"age"    = c("age_gt_50", "age_gt_50", "age_0_49", "age_gt_50", "age_0_49"),
"sex"    = c("sex_m", "sex_m", "sex_m", "sex_f", "sex_f"),
"income" = c(2868, 2474, 2231, 3152, 2473),
stringsAsFactors = FALSE
)
# Set variables to constrain over
vars &lt;- c("age", "sex")
weights &lt;- weight(cons = cons, inds = inds, vars = vars)
print(weights)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
