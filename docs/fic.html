<!DOCTYPE html><html><head><title>Help for package fic</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {fic}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#fic-package'><p>Focused Information Criteria for Model Comparison</p></a></li>
<li><a href='#all_inds.default'><p>Form indicator matrix describing all submodels of a general linear wide model</p></a></li>
<li><a href='#birthwt'><p>Risk factors associated with low infant birth weight</p></a></li>
<li><a href='#expand_inds'><p>Form 'fic' model indicator argument in presence of factors</p></a></li>
<li><a href='#fic_core'><p>Focused information criteria: core calculation functions</p></a></li>
<li><a href='#fic.coxph'><p>Focused information criteria for Cox proportional hazard regression models</p></a></li>
<li><a href='#fic.default'><p>Focused information criteria: main user interface</p></a></li>
<li><a href='#fic.flexsurvreg'><p>Focused information criteria for flexible parametric survival models</p></a></li>
<li><a href='#fic.glm'><p>Focused information criteria for generalized linear models</p></a></li>
<li><a href='#fic.lm'><p>Focused information criteria for linear models</p></a></li>
<li><a href='#fic.msm'><p>Focused information criteria for multi-state models for panel data</p></a></li>
<li><a href='#fic.survreg'><p>Focused information criteria for parametric survival models</p></a></li>
<li><a href='#fit_submodels'><p>Fit submodels of a general linear wide model, defined by a matrix of indicators</p>
for inclusion of covariates</a></li>
<li><a href='#focus_fns'><p>Built-in focus functions and their derivatives</p></a></li>
<li><a href='#get_H0'><p>Interpolate cumulative hazard function from a fitted Cox model</p></a></li>
<li><a href='#ggplot_fic'><p>Plot focused model comparison statistics: ggplot2 method</p></a></li>
<li><a href='#melanoma'><p>Malignant melanoma survival data</p></a></li>
<li><a href='#newdata_to_X'><p>Convert data frame of covariate values to a design matrix</p></a></li>
<li><a href='#plot.fic'><p>Plot focused model comparison statistics: base graphics method</p></a></li>
<li><a href='#summary.fic'><p>Summarise focused model comparison results</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Focused Information Criteria for Model Comparison</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2019-04-09</td>
</tr>
<tr>
<td>Description:</td>
<td>Compares how well different models estimate a quantity of interest (the "focus") so that different models may be preferred for different purposes.  Comparisons within any class of models fitted by maximum likelihood are supported, with shortcuts for commonly-used classes such as generalised linear models and parametric survival models.  The methods originate from Claeskens and Hjort (2003) &lt;<a href="https://doi.org/10.1198%2F016214503000000819">doi:10.1198/016214503000000819</a>&gt; and Claeskens and Hjort (2008, ISBN:9780521852258).</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Christopher Jackson &lt;chris.jackson@mrc-bsu.cam.ac.uk&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats, numDeriv, mvtnorm, ggplot2, scales, survival, tensor,
abind</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/chjackson/fic">https://github.com/chjackson/fic</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/chjackson/fic/issues">https://github.com/chjackson/fic/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>6.0.1</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat, msm(&ge; 1.6.6), flexsurv, sn,
gapminder, GGally</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2019-04-12 11:20:35 UTC; chris</td>
</tr>
<tr>
<td>Author:</td>
<td>Christopher Jackson [cre, aut] (package design and programming),
  Gerda Claeskens [aut] (method development and design advice),
  Howard Thom [ctb]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2019-04-13 08:32:39 UTC</td>
</tr>
</table>
<hr>
<h2 id='fic-package'>Focused Information Criteria for Model Comparison</h2><span id='topic+fic-package'></span>

<h3>Description</h3>

<p>For a full explanation of the methods behind the <span class="pkg">fic</span> package and worked examples of using it, see the main package vignette &quot;Different models for different purposes: focused model comparison in R&quot;
</p>

<hr>
<h2 id='all_inds.default'>Form indicator matrix describing all submodels of a general linear wide model</h2><span id='topic+all_inds.default'></span><span id='topic+all_inds'></span><span id='topic+all_inds.lm'></span><span id='topic+all_inds.glm'></span><span id='topic+all_inds.coxph'></span>

<h3>Description</h3>

<p>Form indicator matrix describing all possible submodels of a general linear wide model, where the submodels are defined by selected covariates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## Default S3 method:
all_inds(wide, inds0 = NULL, auxpars = NULL, ...)

all_inds(wide, inds0, ...)

## S3 method for class 'lm'
all_inds(wide, inds0, ...)

## S3 method for class 'glm'
all_inds(wide, inds0, ...)

## S3 method for class 'coxph'
all_inds(wide, inds0, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="all_inds.default_+3A_wide">wide</code></td>
<td>
<p>A fitted model of standard R format, such that <code>terms(wide)</code> returns information about the terms of the model formula.  Models outside standard R packages may not support this.</p>
</td></tr>
<tr><td><code id="all_inds.default_+3A_inds0">inds0</code></td>
<td>
<p>Narrow model indicators, in format described in <code><a href="#topic+fic">fic</a></code>.</p>
</td></tr>
<tr><td><code id="all_inds.default_+3A_auxpars">auxpars</code></td>
<td>
<p>Names of parameters in the wide model other than the covariate effects being selected from.  By default, for linear and generalised linear models this is <code>c("(Intercept)")</code>, and for Cox regression this is omitted.</p>
</td></tr>
<tr><td><code id="all_inds.default_+3A_...">...</code></td>
<td>
<p>Other arguments. Currently unused.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix in the format required by the <code>inds</code> argument of <code>fic()</code>, representing all possible submodels of the wide model.
</p>
<p>The number of rows is the number of models, and the number of columns is the number of parameters in the wide model.   The <code class="reqn">r,s</code> entry of the matrix is a 1 if the <code class="reqn">r</code>th submodel includes parameter <code class="reqn">s</code>, and 0 otherwise.
</p>
<p>If a factor is included (excluded) from the submodel, then all corresponding parameters are included (excluded).
</p>
<p>See the package vignettes for examples.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>bwt.glm &lt;- glm(low ~ lwtkg + age + smoke, data=birthwt, family="binomial")
all_inds(bwt.glm, inds0=c(1,0,0,0))

# note no intercept term in Cox models, so inds0 has two elements here
library(survival)
wide &lt;- coxph(Surv(years, death==1) ~ sex + thick_centred, data=melanoma)
all_inds(wide, inds0=c(0,0))

</code></pre>

<hr>
<h2 id='birthwt'>Risk factors associated with low infant birth weight</h2><span id='topic+birthwt'></span>

<h3>Description</h3>

<p>Risk factors associated with low infant birth weight
</p>


<h3>Usage</h3>

<pre><code class='language-R'>birthwt
</code></pre>


<h3>Format</h3>

<p>A data frame with 189 rows and 19 variables.  The first 10 columns are included in the dataset of the same name in the <span class="pkg">MASS</span> package.  The remaining 9 columns are defined in Claeskens and Hjort (2008), and are included in this dataset for convenience.
</p>

<dl>
<dt>low</dt><dd><p>indicator of birth weight less than 2.5 kg</p>
</dd>
<dt>age</dt><dd><p>mother's age in years</p>
</dd>
<dt>lwt</dt><dd><p>mother's weight in pounds at last menstrual period</p>
</dd>
<dt>race</dt><dd><p>mother's race (‘1’ = white, ‘2’ = black, ‘3’ = other)</p>
</dd>
<dt>smoke</dt><dd><p>smoking status during pregnancy</p>
</dd>
<dt>ptl</dt><dd><p>number of previous premature labours</p>
</dd>
<dt>ht</dt><dd><p>history of hypertension</p>
</dd>
<dt>ui</dt><dd><p>presence of uterine irritability</p>
</dd>
<dt>ftv</dt><dd><p>number of physician visits during the first trimester</p>
</dd>
<dt>bwt</dt><dd><p>birth weight in grams</p>
</dd>
<dt>smokeui</dt><dd><p>Binary indicator for both smoking and uterine irritation</p>
</dd>
<dt>smokeage</dt><dd><p>Interaction between age and binary (0/1) smoking status, that is, <code>age</code> for smokers and zero for non-smokers.</p>
</dd>
<dt>intercpt</dt><dd><p>Intercept term (all 1)</p>
</dd>
<dt>raceother</dt><dd><p>Binary indicator for <code>race</code> &quot;other&quot;</p>
</dd>
<dt>raceblack</dt><dd><p>Binary indicator for <code>race</code> &quot;black&quot;</p>
</dd>
<dt>ftv2p</dt><dd><p>Binary indicator for <code>ftv</code>, number of physician visits during the first trimester, 2 or more</p>
</dd>
<dt>ftv1</dt><dd><p>Binary indicator for <code>ftv</code> 1</p>
</dd>
<dt>ptd</dt><dd><p>Binary indicator for <code>ptl</code>, number of previous premature labours, 1 or more</p>
</dd>
<dt>lwtkg</dt><dd><p>Weight measured in kg, as used in Claeskens and Hjort.  Note <code>lwt</code>, as used in <span class="pkg">MASS</span>, is in pounds.</p>
</dd>
</dl>


<h3>Source</h3>

<p><span class="pkg">MASS</span> package (Venables, W. N. and Ripley, B. D. (2002) Modern Applied Statistics with S. Fourth edition. Springer); originally from Hosmer, D.W. and Lemeshow, S. (1989) Applied Logistic Regression. New York: Wiley
</p>


<h3>References</h3>

<p>Claeskens, G., &amp; Hjort, N. L. (2008). Model selection and model averaging (Vol. 330). Cambridge: Cambridge University Press.
</p>

<hr>
<h2 id='expand_inds'>Form 'fic' model indicator argument in presence of factors</h2><span id='topic+expand_inds'></span>

<h3>Description</h3>

<p>Given a model indicator <code>inds</code> identifying terms in a regression
model, convert this to the format needed for <code><a href="#topic+fic">fic</a></code> by converting
indicators for regression terms to indicators for inclusion of
parameters.  Only required if there are factors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expand_inds(inds, wide)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="expand_inds_+3A_inds">inds</code></td>
<td>
<p>Matrix or vector of indicators for which parameters are included in the submodel or submodels to be assessed.
</p>
<p>A matrix should be supplied if there are multiple submodels.  This should have number of rows equal to the number of submodels, and number of columns equal to the total number of parameters in the wide model.  It contains 1s in the positions where the parameter is included in the submodel, and 0s in positions where the parameter is excluded.  This should always be 1 in the positions defining the narrow model, as specified in <code>inds0</code>.</p>
</td></tr>
<tr><td><code id="expand_inds_+3A_wide">wide</code></td>
<td>
<p>Fitted model object containing the wide model.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If a regression term is a factor, then the 0 or 1 indicating its
inclusion/exclusion is replicated to a length given by the number
of factor levels minus 1, that is, the number of parameters
pertaining to that factor.
</p>
<p>This function only works for classes of models for which the
<code>model.matrix</code> function is understood and returns objects
with an <code>"assign"</code> attribute. This includes all the
commonly-used models in base R.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Five terms in this model: intercept and four covariates,
# but the covariate "ftv" is a factor with 3 levels,
# so there are six parameters
bwt.glm &lt;- glm(low ~ lwtkg + age + smoke + ftv, data=birthwt, family="binomial")

## Convert indicator for terms to indicator for parameters 
inds &lt;- rbind(c(1,1,1,0,0),
              c(1,1,1,1,1))
expand_inds(inds, bwt.glm)


</code></pre>

<hr>
<h2 id='fic_core'>Focused information criteria: core calculation functions</h2><span id='topic+fic_core'></span><span id='topic+fic_multi'></span>

<h3>Description</h3>

<p>Core FIC calculation functions underlying the user interface in <code><a href="#topic+fic">fic</a></code>.
<code>fic_core</code> just handles one submodel, while <code>fic_multi</code> can assess multiple submodels of the same wide model.  For <code>fic_multi</code>, <code>inds</code> and <code>parsub</code> can be matrices with one row per submodel, while for <code>fic_core</code> they must be vectors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fic_core(par, J, inds, inds0, gamma0 = 0, n, focus_deriv = NULL)

fic_multi(par, J, inds, inds0, gamma0 = 0, n, focus = NULL,
  focus_deriv = NULL, wt = NULL, parsub = NULL, auxpar = NULL,
  auxsub = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fic_core_+3A_par">par</code></td>
<td>
<p>Vector of maximum likelihood estimates from the wide model</p>
</td></tr>
<tr><td><code id="fic_core_+3A_j">J</code></td>
<td>
<p>Information matrix from the wide model, evaluated at the maximum likelihood estimates (note that this definition differs from Claeskens and Hjort, where <code>J</code> is defined as the information divided by the sample size <code>n</code>)</p>
</td></tr>
<tr><td><code id="fic_core_+3A_inds">inds</code></td>
<td>
<p>Matrix or vector of indicators for which parameters are included in the submodel or submodels to be assessed.
</p>
<p>A matrix should be supplied if there are multiple submodels.  This should have number of rows equal to the number of submodels, and number of columns equal to the total number of parameters in the wide model.  It contains 1s in the positions where the parameter is included in the submodel, and 0s in positions where the parameter is excluded.  This should always be 1 in the positions defining the narrow model, as specified in <code>inds0</code>.</p>
</td></tr>
<tr><td><code id="fic_core_+3A_inds0">inds0</code></td>
<td>
<p>Vector of indicators specifying the narrow model, in the same format as <code>inds</code>.  If this is omitted, the narrow model is assumed to be defined by the first row of <code>inds</code> (if <code>inds</code> is a matrix), or <code>inds</code> itself if this is a vector.</p>
</td></tr>
<tr><td><code id="fic_core_+3A_gamma0">gamma0</code></td>
<td>
<p>Vector of special values taken by the parameters <code class="reqn">gamma</code> which define the narrow model.
</p>
<p>This defaults to 0, as in covariate selection, where &quot;excluded&quot; coefficients are fixed to 0. 
</p>
<p>This should either be a scalar, assumed to be the same for all parameters fixed in the narrow model, or a vector of length equal to the number of parameters from the wide model which are fixed in the narrow model, that is, the number of entries of <code>inds0</code> which are zero.</p>
</td></tr>
<tr><td><code id="fic_core_+3A_n">n</code></td>
<td>
<p>Number of observations in the data used to fit the wide model.</p>
</td></tr>
<tr><td><code id="fic_core_+3A_focus_deriv">focus_deriv</code></td>
<td>
<p>Vector of partial derivatives of the focus function with respect to the parameters in the wide model.  This is required by <code>fic_core</code>.
</p>
<p>If there are multiple submodels, this should be a matrix with number of rows equal to the number of submodels, and number of columns equal to the number of parameters in the wide model.  If there is a single submodel, this should be a vector with number of columns equal to the number of parameters in the wide model.
</p>
<p>This should take the value given by <code>gamma0</code> in positions where the parameter is excluded from the submodel.
For example, coefficients of covariates should take the value 0 if the covariate is excluded.</p>
</td></tr>
<tr><td><code id="fic_core_+3A_focus">focus</code></td>
<td>
<p>An R function with:
</p>

<ul>
<li><p> first argument named <code>par</code>, denoting a vector of parameters, of the same length as in wide model
</p>
</li>
<li><p> other arguments defining alternative focuses.  These are supplied through the <code>...</code> argument to <code><a href="#topic+fic">fic</a></code>.  In the built-in examples, there is an argument named <code>X</code>, denoting alternative covariate values.  The required format is documented below. 
</p>
</li></ul>

<p>The function should return the focus quantity of interest.  If additional arguments are supplied which are vectors or matrices, e.g. <code>X</code>, then these are assumed to represent multiple focuses, and <code>focus</code> should return a vector giving the focus for <code>par</code> and each row of <code>X</code>.  Otherwise <code>focus</code> should return a scalar giving the focus value at <code>par</code>.
</p>
<p>Not required if <code>focus_deriv</code> is specified.
</p>
<p>Alternatively, <code>focus</code> can be a character string naming a built-in focus function supplied by the <span class="pkg">fic</span> package.  Currently these include:
</p>
<p><code>"prob_logistic"</code>, the probability of the outcome in a logistic regression model
</p>
<p><code>"mean_normal"</code> the mean outcome in a normal linear regression model
</p>
<p>See <code><a href="#topic+focus_fns">focus_fns</a></code> for the functions underlying these built-in focuses.</p>
</td></tr>
<tr><td><code id="fic_core_+3A_wt">wt</code></td>
<td>
<p>Vector of weights to apply to different covariate values in <code>X</code>.  This should have length equal to the number of alternative values for the covariates, that is, the number of alternative focuses of interest.  The covariate-specific focused model comparison statistics are then supplemented by averaged statistics for a population defined by this distribution of covariate values.  If this argument is omitted, the values are assumed to have equal weight when computing the average.   The weights are not normalised, though the interpretation is unclear if the weights don't sum to one.</p>
</td></tr>
<tr><td><code id="fic_core_+3A_parsub">parsub</code></td>
<td>
<p>Vector of maximum likelihood estimates from the submodel, or a matrix if there are multiple submodels. 
Only required to return the estimate of the focus quantity alongside 
the model assessment statistics for the submodel. If omitted, the estimate is omitted.</p>
</td></tr>
<tr><td><code id="fic_core_+3A_auxpar">auxpar</code></td>
<td>
<p>Estimates of auxiliary parameters from the wide model. The only built-in example is the dispersion parameter for GLMs.</p>
</td></tr>
<tr><td><code id="fic_core_+3A_auxsub">auxsub</code></td>
<td>
<p>List of estimates of auxiliary parameters from the submodel.  The only built-in example is the dispersion parameter for GLMs.</p>
</td></tr>
<tr><td><code id="fic_core_+3A_...">...</code></td>
<td>
<p>Other arguments to the focus function can be supplied here.
</p>
<p>The built-in focus functions <code><a href="#topic+prob_logistic">prob_logistic</a></code> and <code><a href="#topic+mean_normal">mean_normal</a></code> take an argument <code>X</code> giving covariate values defining the focus. This can either be a matrix or a vector, or a list or data frame that can be coerced into a matrix. 
</p>
<p>If just one focus is needed, then <code>X</code> can be a vector of length equal to the number of parameters in the wide model.
</p>
<p>To compute focused model comparison statistics for multiple focuses defined by the same focus function evaluated at multiple covariate values, <code>X</code> should be a matrix, with number of columns equal to the number of parameters in the wide model, and number of rows equal to the number of alternative focuses.
</p>
<p>For a typical regression model, the first parameter will denote an intercept, so the first value of <code>X</code> should be 1, and the remaining values should correspond to covariates whose coefficients form parameters of the wide model.  See the examples in the vignette.
</p>
<p>Arguments to the focus function other than <code>X</code> can also be supplied as a matrix, vector, list or data frame in the same way. An exception is when the argument is supplied as a vector, this is assumed to refer to multiple focuses.   For example, suppose the focus function defines the quantile of a distribution, and takes an argument <code>focus_p</code>, then calling <code>fic(...,focus_p=c(0.1, 0.9))</code> indicates two alternative focuses defined by the 0.1 and 0.9 quantiles.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>See <code><a href="#topic+fic">fic</a></code>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fic">fic</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Lower-level implementation of the example in the main vignette

wide.glm &lt;- glm(low ~ lwtkg + age + smoke + ht + ui + smokeage + smokeui,
                data=birthwt, family=binomial)
mod1.glm &lt;- glm(low ~ lwtkg + age + smoke, data=birthwt, family=binomial)
inds0 &lt;- c(1,1,0,0,0,0,0,0)
inds1 &lt;- c(1,1,1,1,0,0,0,0)
focus_plogis &lt;- function(par, X)plogis(X %*% par)
vals.smoke &lt;-    c(1, 58.24, 22.95, 1, 0, 0, 22.95, 0)
vals.nonsmoke &lt;- c(1, 59.50, 23.43, 0, 0, 0, 0, 0)
X &lt;- rbind(vals.smoke, vals.nonsmoke)
par &lt;- coef(wide.glm)
n &lt;- nrow(birthwt)
J &lt;- solve(vcov(wide.glm))
fic_multi(par=par, J=J,  inds=inds1, inds0=inds0, n=n, focus="prob_logistic",
          X=X, parsub=c(coef(mod1.glm), 0, 0, 0, 0))

## Even lower-level implementation, requiring derivatives of the focus
## These are available analytically in this example, but would normally
## need to be calculated using numerical differentiation

focus_deriv &lt;- prob_logistic_deriv(par=par, X=X)
fic_core(par=par, J=J, inds=inds1, inds0=inds0, gamma0=0, n=n,
         focus_deriv=focus_deriv)

</code></pre>

<hr>
<h2 id='fic.coxph'>Focused information criteria for Cox proportional hazard regression models</h2><span id='topic+fic.coxph'></span>

<h3>Description</h3>

<p>Focused model comparison for Cox models fitted with <code>coxph</code> from the <code>survival</code> package.  Built-in focuses include the hazard ratio, survival and cumulative hazard.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'coxph'
fic(wide, inds, inds0 = NULL, gamma0 = 0, focus, X = NULL,
  t = NULL, sub = "auto", tidy = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fic.coxph_+3A_wide">wide</code></td>
<td>
<p>Fitted model object containing the wide model.</p>
</td></tr>
<tr><td><code id="fic.coxph_+3A_inds">inds</code></td>
<td>
<p>Matrix or vector of indicators for which parameters are included in the submodel or submodels to be assessed.
</p>
<p>A matrix should be supplied if there are multiple submodels.  This should have number of rows equal to the number of submodels, and number of columns equal to the total number of parameters in the wide model.  It contains 1s in the positions where the parameter is included in the submodel, and 0s in positions where the parameter is excluded.  This should always be 1 in the positions defining the narrow model, as specified in <code>inds0</code>.</p>
</td></tr>
<tr><td><code id="fic.coxph_+3A_inds0">inds0</code></td>
<td>
<p>Vector of indicators specifying the narrow model, in the same format as <code>inds</code>.  If this is omitted, the narrow model is assumed to be defined by the first row of <code>inds</code> (if <code>inds</code> is a matrix), or <code>inds</code> itself if this is a vector.</p>
</td></tr>
<tr><td><code id="fic.coxph_+3A_gamma0">gamma0</code></td>
<td>
<p>Vector of special values taken by the parameters <code class="reqn">gamma</code> which define the narrow model.
</p>
<p>This defaults to 0, as in covariate selection, where &quot;excluded&quot; coefficients are fixed to 0. 
</p>
<p>This should either be a scalar, assumed to be the same for all parameters fixed in the narrow model, or a vector of length equal to the number of parameters from the wide model which are fixed in the narrow model, that is, the number of entries of <code>inds0</code> which are zero.</p>
</td></tr>
<tr><td><code id="fic.coxph_+3A_focus">focus</code></td>
<td>
<p>Three built-in focus quantities are supported:
</p>
<p><code>"hr"</code> for the hazard ratio between individuals with covariate values of <code>X</code> and 0. 
</p>
<p><code>"survival"</code> for the survival probability at time or times given in <code>t</code>.
</p>
<p><code>"cumhaz"</code> for the cumulative hazard at time or times given in <code>t</code>.
</p>
<p>Alternatively, a list of three R functions can be supplied, with components named <code>"focus"</code>, <code>"deriv"</code> and <code>"dH"</code> respectively giving the focus, derivative with respect to the log hazard ratios, and derivative with respect to the cumulative hazards.   Each function should have arguments <code>par</code>, <code>H0</code>, <code>X</code> and <code>t</code>, giving the log hazard ratios, baseline cumulative hazard, covariate values and time points at which the focus function should be evaluated.  See the section &quot;User-defined focuses&quot; below for a little more information.</p>
</td></tr>
<tr><td><code id="fic.coxph_+3A_x">X</code></td>
<td>
<p>Covariate values to evaluate the focus at.  See <code><a href="#topic+fic">fic</a></code>, argument <code>...</code>, for the required format.</p>
</td></tr>
<tr><td><code id="fic.coxph_+3A_t">t</code></td>
<td>
<p>times to evaluate the focus at.  Only relevant for survival and cumulative hazard focuses, as the hazard ratio is constant through time.</p>
</td></tr>
<tr><td><code id="fic.coxph_+3A_sub">sub</code></td>
<td>
<p>If <code>"auto"</code> (the default) then the submodels are fitted automatically within this function.   If <code>NULL</code> they are not fitted, and focus estimates are not returned with the results.</p>
</td></tr>
<tr><td><code id="fic.coxph_+3A_tidy">tidy</code></td>
<td>
<p>If <code>TRUE</code> the results are returned as a data frame with variables to indicate the submodels, focuses and corresponding result statistics.  If <code>FALSE</code>, the results are returned as a three-dimensional array, with dimensions indexed by the submodels, result statistics and focuses respectively.</p>
</td></tr>
<tr><td><code id="fic.coxph_+3A_...">...</code></td>
<td>
<p>Other arguments to the focus function can be supplied here.
</p>
<p>The built-in focus functions <code><a href="#topic+prob_logistic">prob_logistic</a></code> and <code><a href="#topic+mean_normal">mean_normal</a></code> take an argument <code>X</code> giving covariate values defining the focus. This can either be a matrix or a vector, or a list or data frame that can be coerced into a matrix. 
</p>
<p>If just one focus is needed, then <code>X</code> can be a vector of length equal to the number of parameters in the wide model.
</p>
<p>To compute focused model comparison statistics for multiple focuses defined by the same focus function evaluated at multiple covariate values, <code>X</code> should be a matrix, with number of columns equal to the number of parameters in the wide model, and number of rows equal to the number of alternative focuses.
</p>
<p>For a typical regression model, the first parameter will denote an intercept, so the first value of <code>X</code> should be 1, and the remaining values should correspond to covariates whose coefficients form parameters of the wide model.  See the examples in the vignette.
</p>
<p>Arguments to the focus function other than <code>X</code> can also be supplied as a matrix, vector, list or data frame in the same way. An exception is when the argument is supplied as a vector, this is assumed to refer to multiple focuses.   For example, suppose the focus function defines the quantile of a distribution, and takes an argument <code>focus_p</code>, then calling <code>fic(...,focus_p=c(0.1, 0.9))</code> indicates two alternative focuses defined by the 0.1 and 0.9 quantiles.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Stratified Cox models are not currently supported.
</p>


<h3>User-defined focuses</h3>

<p>Each function should have four arguments:
</p>
<p><code>par</code> Vector of estimated coefficients, the log hazard ratios in the Cox model.
</p>
<p><code>H0</code>  Cumulative hazard estimate at a set of times, in the form of the output from <code><a href="survival.html#topic+basehaz">basehaz</a></code>.   The function <code><a href="#topic+get_H0">get_H0</a></code> can be used on this estimate to obtain the estimate at any other times by interpolation.
</p>
<p><code>X</code>  Matrix of covariates, with <code>ncov</code> rows and <code>npar</code> columns, where <code>ncov</code> is the number of alternative covariate values definining alternative focuses we want to compare models for, and <code>npar</code> is the number of coefficients in the model.
</p>
<p><code>t</code>  Vector of times defining alternative focus quantities (such as the survival)
</p>
<p>For examples, examine the source for the built-in functions
</p>
<p><code>fic:::cox_hr,fic:::cox_hr_deriv,fic:::cox_hr_dH</code> for the hazard ratio between <code>X</code> and <code>0</code>
</p>
<p><code>fic:::cox_cumhaz,fic:::cox_cumhaz_deriv,fic:::cox_cumhaz_dH</code> for the cumulative hazard
</p>
<p><code>fic:::cox_survival,fic:::cox_survival_deriv,fic:::cox_survival_dH</code> for the survival.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Example of focused covariate selection in a Cox model
## For more information see the main package vignette.

library(survival)
wide &lt;- coxph(Surv(years, death==1) ~ sex + thick_centred + infilt +
              epith + ulcer + depth + age, data=melanoma)

## Define models to be selected from
## Sex included in all models
## Select between models including all combinations of other covariates
inds0 &lt;- expand_inds(c(1,0,0,0,0,0,0), wide)
combs &lt;- all_inds(wide, inds0)

## Covariate values defining focus 
newdata &lt;- with(melanoma,
                data.frame(sex = c("female","male"),
                           thick_centred = tapply(thick_centred, sex, mean),
                           infilt=4, epith=1, ulcer=1, depth=2,
                           age = tapply(age, sex, mean)))
X &lt;- newdata_to_X(newdata, wide, intercept=FALSE)

## Focus is 5-year survival for these covariate values
ficall &lt;- fic(wide, inds=combs, inds0=inds0, focus="survival", X=X, t=5)
ggplot_fic(ficall)
summary(ficall)

</code></pre>

<hr>
<h2 id='fic.default'>Focused information criteria: main user interface</h2><span id='topic+fic.default'></span><span id='topic+FIC'></span><span id='topic+fic'></span>

<h3>Description</h3>

<p>Focused information criteria for general models.  These methods estimate the bias and variance of estimates of a quantity of interest (the &quot;focus&quot;) when smaller submodels are used in place of a &quot;wide&quot; model that is assumed to generate the data but may not give precise enough estimates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## Default S3 method:
fic(wide, inds, inds0 = NULL, gamma0 = 0, focus = NULL,
  focus_deriv = NULL, wt = NULL, sub = NULL, fns = NULL, FIC = FALSE,
  B = 0, loss = loss_mse, tidy = TRUE, ...)

fic(wide, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fic.default_+3A_wide">wide</code></td>
<td>
<p>Fitted model object containing the wide model.</p>
</td></tr>
<tr><td><code id="fic.default_+3A_inds">inds</code></td>
<td>
<p>Matrix or vector of indicators for which parameters are included in the submodel or submodels to be assessed.
</p>
<p>A matrix should be supplied if there are multiple submodels.  This should have number of rows equal to the number of submodels, and number of columns equal to the total number of parameters in the wide model.  It contains 1s in the positions where the parameter is included in the submodel, and 0s in positions where the parameter is excluded.  This should always be 1 in the positions defining the narrow model, as specified in <code>inds0</code>.</p>
</td></tr>
<tr><td><code id="fic.default_+3A_inds0">inds0</code></td>
<td>
<p>Vector of indicators specifying the narrow model, in the same format as <code>inds</code>.  If this is omitted, the narrow model is assumed to be defined by the first row of <code>inds</code> (if <code>inds</code> is a matrix), or <code>inds</code> itself if this is a vector.</p>
</td></tr>
<tr><td><code id="fic.default_+3A_gamma0">gamma0</code></td>
<td>
<p>Vector of special values taken by the parameters <code class="reqn">gamma</code> which define the narrow model.
</p>
<p>This defaults to 0, as in covariate selection, where &quot;excluded&quot; coefficients are fixed to 0. 
</p>
<p>This should either be a scalar, assumed to be the same for all parameters fixed in the narrow model, or a vector of length equal to the number of parameters from the wide model which are fixed in the narrow model, that is, the number of entries of <code>inds0</code> which are zero.</p>
</td></tr>
<tr><td><code id="fic.default_+3A_focus">focus</code></td>
<td>
<p>An R function with:
</p>

<ul>
<li><p> first argument named <code>par</code>, denoting a vector of parameters, of the same length as in wide model
</p>
</li>
<li><p> other arguments defining alternative focuses.  These are supplied through the <code>...</code> argument to <code><a href="#topic+fic">fic</a></code>.  In the built-in examples, there is an argument named <code>X</code>, denoting alternative covariate values.  The required format is documented below. 
</p>
</li></ul>

<p>The function should return the focus quantity of interest.  If additional arguments are supplied which are vectors or matrices, e.g. <code>X</code>, then these are assumed to represent multiple focuses, and <code>focus</code> should return a vector giving the focus for <code>par</code> and each row of <code>X</code>.  Otherwise <code>focus</code> should return a scalar giving the focus value at <code>par</code>.
</p>
<p>Not required if <code>focus_deriv</code> is specified.
</p>
<p>Alternatively, <code>focus</code> can be a character string naming a built-in focus function supplied by the <span class="pkg">fic</span> package.  Currently these include:
</p>
<p><code>"prob_logistic"</code>, the probability of the outcome in a logistic regression model
</p>
<p><code>"mean_normal"</code> the mean outcome in a normal linear regression model
</p>
<p>See <code><a href="#topic+focus_fns">focus_fns</a></code> for the functions underlying these built-in focuses.</p>
</td></tr>
<tr><td><code id="fic.default_+3A_focus_deriv">focus_deriv</code></td>
<td>
<p>Vector of partial derivatives of the focus function with respect to the parameters in the wide model.  This is not usually needed, as it can generally be computed automatically and accurately from the function supplied in <code>focus</code>, using numerical differentiation.</p>
</td></tr>
<tr><td><code id="fic.default_+3A_wt">wt</code></td>
<td>
<p>Vector of weights to apply to different covariate values in <code>X</code>.  This should have length equal to the number of alternative values for the covariates, that is, the number of alternative focuses of interest.  The covariate-specific focused model comparison statistics are then supplemented by averaged statistics for a population defined by this distribution of covariate values.  If this argument is omitted, the values are assumed to have equal weight when computing the average.   The weights are not normalised, though the interpretation is unclear if the weights don't sum to one.</p>
</td></tr>
<tr><td><code id="fic.default_+3A_sub">sub</code></td>
<td>
<p>List of fitted model objects corresponding to each submodel to be assessed. 
</p>
<p>For some classes of models with built in methods for <code>fic</code>, e.g. <code><a href="#topic+fic.glm">fic.glm</a></code>, the submodels are fitted automatically by default, so this argument does not need to be supplied.
</p>
<p>Otherwise, this argument can be omitted, but it is required if you want the estimate of the focus function under each submodel to be included in the results, which is usually the case.</p>
</td></tr>
<tr><td><code id="fic.default_+3A_fns">fns</code></td>
<td>
<p>Named list of functions to extract the quantities from the fitted model object that are required to calculate the focused model comparison statistics.  By default this is
</p>
<p><code>list(coef=coef, nobs=nobs, vcov=vcov)</code>
</p>
<p>Suppose the fitted model object is called <code>mod</code>.  This default list assumes that
</p>

<ul>
<li> <p><code>coef(mod)</code> returns the vector of parameter estimates,
</p>
</li>
<li> <p><code>vcov(mod)</code> returns the covariance matrix for the parameter estimates,
</p>
</li>
<li> <p><code>nobs(mod)</code> returns the number of observations used in the model fit.  Only required if the 'classic' FIC is required, and not required to compute the mean square error of the focus.
</p>
</li></ul>

<p>If one or more of these functions does not work for <code>mod</code>, then the defaults can be changed.
For example, suppose the functions <code>coef()</code>, <code>nobs()</code> and <code>vcov()</code> are
not understood (or return something different) for your class of model objects, but
the parameters are stored in <code>mod$estimates</code>,
the number of observations is in <code>mod$data$nobs</code>, and
the covariance matrix is in <code>mod$cov</code>, 
then the <code>fns</code> argument should be set to 
</p>
<p><code>list(
     coef = function(x){x$estimates},
     nobs = function(x){x$data$nobs},
     vcov = function(x){x$cov}
     )</code>
</p>
<p>If less than three components are specified in <code>fns</code>, then the missing components are assumed to take their default values.</p>
</td></tr>
<tr><td><code id="fic.default_+3A_fic">FIC</code></td>
<td>
<p>If <code>TRUE</code>, then the Focused Information Criterion is returned with the results alongside the mean squared error and its components.  This is done for built-in model classes, but optional for user-defined model classes, since it requires knowledge of the sample size <code>n</code> as well as the estimates and covariance matrix under the wide model.</p>
</td></tr>
<tr><td><code id="fic.default_+3A_b">B</code></td>
<td>
<p>If <code>B</code> is 0 (the default) the standard analytic formulae for the focused model comparison statistics are used with mean square error loss.   If <code>B</code>&gt;0, then a parametric bootstrap method is used with <code>B</code> bootstrap samples, and the loss specified in the <code>loss</code> argument. More details of this approach are given in the package vignette &quot;Focused model comparison with bootstrapping and alternative loss functions&quot;.</p>
</td></tr>
<tr><td><code id="fic.default_+3A_loss">loss</code></td>
<td>
<p>A function returning an estimated loss for a submodel estimate under the sampling distribution of the wide model.  Only applicable when using bootstrapping.  This should have two arguments <code>sub</code> and <code>wide</code>.  <code>sub</code> should be a scalar giving the focus estimate from a submodel.  <code>wide</code> should be a vector with a sample of focus estimates from the wide model, e.g. generated by a bootstrap method.  By default this is a function calculating the root mean square error of the submodel estimate.   An example is given in the vignette  &quot;Focused model comparison with bootstrapping and alternative loss functions&quot;.</p>
</td></tr>
<tr><td><code id="fic.default_+3A_tidy">tidy</code></td>
<td>
<p>If <code>TRUE</code> the results are returned as a data frame with variables to indicate the submodels, focuses and corresponding result statistics.  If <code>FALSE</code>, the results are returned as a three-dimensional array, with dimensions indexed by the submodels, result statistics and focuses respectively.</p>
</td></tr>
<tr><td><code id="fic.default_+3A_...">...</code></td>
<td>
<p>Other arguments to the focus function can be supplied here.
</p>
<p>The built-in focus functions <code><a href="#topic+prob_logistic">prob_logistic</a></code> and <code><a href="#topic+mean_normal">mean_normal</a></code> take an argument <code>X</code> giving covariate values defining the focus. This can either be a matrix or a vector, or a list or data frame that can be coerced into a matrix. 
</p>
<p>If just one focus is needed, then <code>X</code> can be a vector of length equal to the number of parameters in the wide model.
</p>
<p>To compute focused model comparison statistics for multiple focuses defined by the same focus function evaluated at multiple covariate values, <code>X</code> should be a matrix, with number of columns equal to the number of parameters in the wide model, and number of rows equal to the number of alternative focuses.
</p>
<p>For a typical regression model, the first parameter will denote an intercept, so the first value of <code>X</code> should be 1, and the remaining values should correspond to covariates whose coefficients form parameters of the wide model.  See the examples in the vignette.
</p>
<p>Arguments to the focus function other than <code>X</code> can also be supplied as a matrix, vector, list or data frame in the same way. An exception is when the argument is supplied as a vector, this is assumed to refer to multiple focuses.   For example, suppose the focus function defines the quantile of a distribution, and takes an argument <code>focus_p</code>, then calling <code>fic(...,focus_p=c(0.1, 0.9))</code> indicates two alternative focuses defined by the 0.1 and 0.9 quantiles.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The returned data frame or array contains the following components, describing characteristics of the defined submodel.  See the package vignette for full, formal definitions, and Chapter 6 of Claeskens and Hjort, 2008.
</p>
<table>
<tr><td><code>rmse</code></td>
<td>
<p>The root mean square error of the estimate of the focus quantity.  Defined as the square root of (squared unadjusted bias plus variance).  This is an asymptotically unbiased estimator, but may occasionally be indeterminate if the estimate of the squared bias plus variance is negative.</p>
</td></tr>
<tr><td><code>rmse.adj</code></td>
<td>
<p>The root mean square error, based on a bias estimator which is adjusted to avoid negative squared bias.  Defined on page 157 of Claeskens and Hjort as the sum of the variance and the squared adjusted bias.</p>
</td></tr>
<tr><td><code>bias</code></td>
<td>
<p>The estimated bias of the focus quantity, adjusted to avoid negative squared bias.  This is defined as the square root of the quantity <code class="reqn">sqb3(S)</code> from page 152 of Claeskens and Hjort, multiplied by the sign of the unadjusted bias. </p>
</td></tr>
<tr><td><code>se</code></td>
<td>
<p>The estimated standard error (root variance) of the focus quantity.  Defined on page 157.</p>
</td></tr>
<tr><td><code>FIC</code></td>
<td>
<p>The focused information criterion (equation 6.1 from Claeskens and Hjort), if <code>FIC=TRUE</code> was supplied. </p>
</td></tr>
</table>
<p>The object returned by <code>fic</code> also has the following attributes, which can be extracted with the <code><a href="base.html#topic+attr">attr</a></code> function.
</p>
<table>
<tr><td><code>iwide</code></td>
<td>
<p>Index of the wide model in the vector of submodels, or <code>NULL</code> if the wide model is not included. </p>
</td></tr>
<tr><td><code>inarr</code></td>
<td>
<p>Index of the narrow model in the vector of submodels, or <code>NULL</code> if the wide model is not included. </p>
</td></tr>
<tr><td><code>sub</code></td>
<td>
<p>List of fitted submodel objects.</p>
</td></tr>
<tr><td><code>parnames</code></td>
<td>
<p>Vector of names of parameters in the wide model.</p>
</td></tr>
<tr><td><code>inds</code></td>
<td>
<p>Submodel indicators, as supplied in the <code>inds</code> argument.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Claeskens, G., &amp; Hjort, N. L. (2008). Model selection and model averaging (Vol. 330). Cambridge: Cambridge University Press.
</p>
<p>Claeskens, G., &amp; Hjort, N. L. (2003). The focused information criterion. Journal of the American Statistical Association, 98(464), 900-916.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
wide.glm &lt;- glm(low ~ lwtkg + age + smoke + ht + ui + smokeage + smokeui,
                data=birthwt, family=binomial)
inds &lt;- rbind(
              narrow = c(1,1,0,0,0,0,0,0),
              mod1 = c(1,1,1,1,0,0,0,0),
              wide = c(1,1,1,1,1,1,1,1)
)
vals.smoke &lt;-    c(1, 58.24, 22.95, 1, 0, 0, 22.95, 0)
vals.nonsmoke &lt;- c(1, 59.50, 23.43, 0, 0, 0, 0, 0)
X &lt;- rbind("Smokers"=vals.smoke, "Non-smokers"=vals.nonsmoke)

fic(wide=wide.glm, inds=inds, focus="prob_logistic", X=X)

focus &lt;- function(par, X)plogis(X %*% par)    
fic(wide=wide.glm, inds=inds, focus=focus, X=X)   # equivalent

</code></pre>

<hr>
<h2 id='fic.flexsurvreg'>Focused information criteria for flexible parametric survival models</h2><span id='topic+fic.flexsurvreg'></span>

<h3>Description</h3>

<p>Focused information criteria for parametric survival models fitted with the <span class="pkg">flexsurv</span> package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'flexsurvreg'
fic(wide, inds, inds0 = NULL, gamma0 = 0,
  focus = NULL, focus_deriv = NULL, wt = NULL, sub = NULL, B = 0,
  loss = loss_mse, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fic.flexsurvreg_+3A_wide">wide</code></td>
<td>
<p>Object of class <code>"flexsurvreg"</code> containing the wide model.
These are returned, for example, by the <code><a href="flexsurv.html#topic+flexsurvreg">flexsurvreg</a></code> and 
the <code><a href="flexsurv.html#topic+flexsurvspline">flexsurvspline</a></code> functions.</p>
</td></tr>
<tr><td><code id="fic.flexsurvreg_+3A_inds">inds</code></td>
<td>
<p>Matrix or vector of indicators for which parameters are included in the submodel or submodels to be assessed.
</p>
<p>A matrix should be supplied if there are multiple submodels.  This should have number of rows equal to the number of submodels, and number of columns equal to the total number of parameters in the wide model.  It contains 1s in the positions where the parameter is included in the submodel, and 0s in positions where the parameter is excluded.  This should always be 1 in the positions defining the narrow model, as specified in <code>inds0</code>.</p>
</td></tr>
<tr><td><code id="fic.flexsurvreg_+3A_inds0">inds0</code></td>
<td>
<p>Vector of indicators specifying the narrow model, in the same format as <code>inds</code>.  If this is omitted, the narrow model is assumed to be defined by the first row of <code>inds</code> (if <code>inds</code> is a matrix), or <code>inds</code> itself if this is a vector.</p>
</td></tr>
<tr><td><code id="fic.flexsurvreg_+3A_gamma0">gamma0</code></td>
<td>
<p>Vector of special values taken by the parameters <code class="reqn">gamma</code> which define the narrow model.
</p>
<p>This defaults to 0, as in covariate selection, where &quot;excluded&quot; coefficients are fixed to 0. 
</p>
<p>This should either be a scalar, assumed to be the same for all parameters fixed in the narrow model, or a vector of length equal to the number of parameters from the wide model which are fixed in the narrow model, that is, the number of entries of <code>inds0</code> which are zero.</p>
</td></tr>
<tr><td><code id="fic.flexsurvreg_+3A_focus">focus</code></td>
<td>
<p>An R function with:
</p>

<ul>
<li><p> first argument named <code>par</code>, denoting a vector of parameters, of the same length as in wide model
</p>
</li>
<li><p> other arguments defining alternative focuses.  These are supplied through the <code>...</code> argument to <code><a href="#topic+fic">fic</a></code>.  In the built-in examples, there is an argument named <code>X</code>, denoting alternative covariate values.  The required format is documented below. 
</p>
</li></ul>

<p>The function should return the focus quantity of interest.  If additional arguments are supplied which are vectors or matrices, e.g. <code>X</code>, then these are assumed to represent multiple focuses, and <code>focus</code> should return a vector giving the focus for <code>par</code> and each row of <code>X</code>.  Otherwise <code>focus</code> should return a scalar giving the focus value at <code>par</code>.
</p>
<p>Not required if <code>focus_deriv</code> is specified.
</p>
<p>Alternatively, <code>focus</code> can be a character string naming a built-in focus function supplied by the <span class="pkg">fic</span> package.  Currently these include:
</p>
<p><code>"prob_logistic"</code>, the probability of the outcome in a logistic regression model
</p>
<p><code>"mean_normal"</code> the mean outcome in a normal linear regression model
</p>
<p>See <code><a href="#topic+focus_fns">focus_fns</a></code> for the functions underlying these built-in focuses.</p>
</td></tr>
<tr><td><code id="fic.flexsurvreg_+3A_focus_deriv">focus_deriv</code></td>
<td>
<p>Vector of partial derivatives of the focus function with respect to the parameters in the wide model.  This is not usually needed, as it can generally be computed automatically and accurately from the function supplied in <code>focus</code>, using numerical differentiation.</p>
</td></tr>
<tr><td><code id="fic.flexsurvreg_+3A_wt">wt</code></td>
<td>
<p>Vector of weights to apply to different covariate values in <code>X</code>.  This should have length equal to the number of alternative values for the covariates, that is, the number of alternative focuses of interest.  The covariate-specific focused model comparison statistics are then supplemented by averaged statistics for a population defined by this distribution of covariate values.  If this argument is omitted, the values are assumed to have equal weight when computing the average.   The weights are not normalised, though the interpretation is unclear if the weights don't sum to one.</p>
</td></tr>
<tr><td><code id="fic.flexsurvreg_+3A_sub">sub</code></td>
<td>
<p>List of objects of class <code><a href="flexsurv.html#topic+flexsurvreg">flexsurvreg</a></code> containing the submodels to be assessed. Optional. Only required if you want the estimate of the focus
function under the submodels to be included in the results.</p>
</td></tr>
<tr><td><code id="fic.flexsurvreg_+3A_b">B</code></td>
<td>
<p>If <code>B</code> is 0 (the default) the standard analytic formulae for the focused model comparison statistics are used with mean square error loss.   If <code>B</code>&gt;0, then a parametric bootstrap method is used with <code>B</code> bootstrap samples, and the loss specified in the <code>loss</code> argument. More details of this approach are given in the package vignette &quot;Focused model comparison with bootstrapping and alternative loss functions&quot;.</p>
</td></tr>
<tr><td><code id="fic.flexsurvreg_+3A_loss">loss</code></td>
<td>
<p>A function returning an estimated loss for a submodel estimate under the sampling distribution of the wide model.  Only applicable when using bootstrapping.  This should have two arguments <code>sub</code> and <code>wide</code>.  <code>sub</code> should be a scalar giving the focus estimate from a submodel.  <code>wide</code> should be a vector with a sample of focus estimates from the wide model, e.g. generated by a bootstrap method.  By default this is a function calculating the root mean square error of the submodel estimate.   An example is given in the vignette  &quot;Focused model comparison with bootstrapping and alternative loss functions&quot;.</p>
</td></tr>
<tr><td><code id="fic.flexsurvreg_+3A_...">...</code></td>
<td>
<p>Other arguments to the focus function can be supplied here.
</p>
<p>The built-in focus functions <code><a href="#topic+prob_logistic">prob_logistic</a></code> and <code><a href="#topic+mean_normal">mean_normal</a></code> take an argument <code>X</code> giving covariate values defining the focus. This can either be a matrix or a vector, or a list or data frame that can be coerced into a matrix. 
</p>
<p>If just one focus is needed, then <code>X</code> can be a vector of length equal to the number of parameters in the wide model.
</p>
<p>To compute focused model comparison statistics for multiple focuses defined by the same focus function evaluated at multiple covariate values, <code>X</code> should be a matrix, with number of columns equal to the number of parameters in the wide model, and number of rows equal to the number of alternative focuses.
</p>
<p>For a typical regression model, the first parameter will denote an intercept, so the first value of <code>X</code> should be 1, and the remaining values should correspond to covariates whose coefficients form parameters of the wide model.  See the examples in the vignette.
</p>
<p>Arguments to the focus function other than <code>X</code> can also be supplied as a matrix, vector, list or data frame in the same way. An exception is when the argument is supplied as a vector, this is assumed to refer to multiple focuses.   For example, suppose the focus function defines the quantile of a distribution, and takes an argument <code>focus_p</code>, then calling <code>fic(...,focus_p=c(0.1, 0.9))</code> indicates two alternative focuses defined by the 0.1 and 0.9 quantiles.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Any situation where all models being compared are special cases of a single &quot;wide&quot; model are supported.  Examples include covariate selection, selection between models for the baseline hazard/survival with different levels of flexibility (e.g. comparing exponential, Weibull and generalized gamma).  Some of these are illustrated in the <span class="pkg">fic</span> package vignette &quot;Examples of focused model comparison: parametric survival models&quot;.
</p>
<p>The choice between <code><a href="flexsurv.html#topic+flexsurvspline">flexsurvspline</a></code> models with different numbers of knots is not supported, unless perhaps if the knot locations are defined manually so that models are nested within each other, but this has not been investigated.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Simulated example from the "fic" package vignette on
## parametric survival modelling.
## See this vignette for more details and more examples.

set.seed(1)

if (requireNamespace("flexsurv", quietly=TRUE)){

## Simulate from an exponential 
y &lt;- rexp(50); cen &lt;- rep(1,50)

## Fit wide generalized gamma, and compare
## exponential, weibull and generalized gamma models
indmat &lt;- rbind(exp    = c(1,0,0),
                weib   = c(1,1,0),
                ggamma = c(1,1,1))
gge &lt;- flexsurv::flexsurvreg(survival::Surv(y, cen) ~ 1, dist="gengamma")

## Focus is restricted mean survival over 8 time units 
focus &lt;- function(par){
   flexsurv::rmst_gengamma(8, par[1], exp(par[2]), par[3])
}

## Weibull model actually has lowest FIC and RMSE even though it's
## not true: extra variability is deemed worth alleviating the
## risk of bias.

fic(gge, inds=indmat, gamma0=c(0,1), focus=focus)

}
</code></pre>

<hr>
<h2 id='fic.glm'>Focused information criteria for generalized linear models</h2><span id='topic+fic.glm'></span>

<h3>Description</h3>

<p>Focused information criteria for generalized linear models fitted with <code><a href="stats.html#topic+glm">glm</a></code>.
Used to compare models with different covariates (more generally,
different linear terms).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'glm'
fic(wide, inds, inds0 = NULL, gamma0 = 0, focus = NULL,
  focus_deriv = NULL, wt = NULL, sub = "auto", B = 0, loss = loss_mse,
  ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fic.glm_+3A_wide">wide</code></td>
<td>
<p>Fitted model object containing the wide model.</p>
</td></tr>
<tr><td><code id="fic.glm_+3A_inds">inds</code></td>
<td>
<p>Matrix or vector of indicators for which parameters are included in the submodel or submodels to be assessed.
</p>
<p>A matrix should be supplied if there are multiple submodels.  This should have number of rows equal to the number of submodels, and number of columns equal to the total number of parameters in the wide model.  It contains 1s in the positions where the parameter is included in the submodel, and 0s in positions where the parameter is excluded.  This should always be 1 in the positions defining the narrow model, as specified in <code>inds0</code>.</p>
</td></tr>
<tr><td><code id="fic.glm_+3A_inds0">inds0</code></td>
<td>
<p>Vector of indicators specifying the narrow model, in the same format as <code>inds</code>.  If this is omitted, the narrow model is assumed to be defined by the first row of <code>inds</code> (if <code>inds</code> is a matrix), or <code>inds</code> itself if this is a vector.</p>
</td></tr>
<tr><td><code id="fic.glm_+3A_gamma0">gamma0</code></td>
<td>
<p>Vector of special values taken by the parameters <code class="reqn">gamma</code> which define the narrow model.
</p>
<p>This defaults to 0, as in covariate selection, where &quot;excluded&quot; coefficients are fixed to 0. 
</p>
<p>This should either be a scalar, assumed to be the same for all parameters fixed in the narrow model, or a vector of length equal to the number of parameters from the wide model which are fixed in the narrow model, that is, the number of entries of <code>inds0</code> which are zero.</p>
</td></tr>
<tr><td><code id="fic.glm_+3A_focus">focus</code></td>
<td>
<p>An R function with:
</p>

<ul>
<li><p> first argument named <code>par</code>, denoting a vector of parameters, of the same length as in wide model
</p>
</li>
<li><p> other arguments defining alternative focuses.  These are supplied through the <code>...</code> argument to <code><a href="#topic+fic">fic</a></code>.  In the built-in examples, there is an argument named <code>X</code>, denoting alternative covariate values.  The required format is documented below. 
</p>
</li></ul>

<p>The function should return the focus quantity of interest.  If additional arguments are supplied which are vectors or matrices, e.g. <code>X</code>, then these are assumed to represent multiple focuses, and <code>focus</code> should return a vector giving the focus for <code>par</code> and each row of <code>X</code>.  Otherwise <code>focus</code> should return a scalar giving the focus value at <code>par</code>.
</p>
<p>Not required if <code>focus_deriv</code> is specified.
</p>
<p>Alternatively, <code>focus</code> can be a character string naming a built-in focus function supplied by the <span class="pkg">fic</span> package.  Currently these include:
</p>
<p><code>"prob_logistic"</code>, the probability of the outcome in a logistic regression model
</p>
<p><code>"mean_normal"</code> the mean outcome in a normal linear regression model
</p>
<p>See <code><a href="#topic+focus_fns">focus_fns</a></code> for the functions underlying these built-in focuses.</p>
</td></tr>
<tr><td><code id="fic.glm_+3A_focus_deriv">focus_deriv</code></td>
<td>
<p>Vector of partial derivatives of the focus function with respect to the parameters in the wide model.  This is not usually needed, as it can generally be computed automatically and accurately from the function supplied in <code>focus</code>, using numerical differentiation.</p>
</td></tr>
<tr><td><code id="fic.glm_+3A_wt">wt</code></td>
<td>
<p>Vector of weights to apply to different covariate values in <code>X</code>.  This should have length equal to the number of alternative values for the covariates, that is, the number of alternative focuses of interest.  The covariate-specific focused model comparison statistics are then supplemented by averaged statistics for a population defined by this distribution of covariate values.  If this argument is omitted, the values are assumed to have equal weight when computing the average.   The weights are not normalised, though the interpretation is unclear if the weights don't sum to one.</p>
</td></tr>
<tr><td><code id="fic.glm_+3A_sub">sub</code></td>
<td>
<p>If <code>"auto"</code> (the default) then the submodels are fitted automatically within this function.   If <code>NULL</code> they are not fitted, and focus estimates are not returned with the results.</p>
</td></tr>
<tr><td><code id="fic.glm_+3A_b">B</code></td>
<td>
<p>If <code>B</code> is 0 (the default) the standard analytic formulae for the focused model comparison statistics are used with mean square error loss.   If <code>B</code>&gt;0, then a parametric bootstrap method is used with <code>B</code> bootstrap samples, and the loss specified in the <code>loss</code> argument. More details of this approach are given in the package vignette &quot;Focused model comparison with bootstrapping and alternative loss functions&quot;.</p>
</td></tr>
<tr><td><code id="fic.glm_+3A_loss">loss</code></td>
<td>
<p>A function returning an estimated loss for a submodel estimate under the sampling distribution of the wide model.  Only applicable when using bootstrapping.  This should have two arguments <code>sub</code> and <code>wide</code>.  <code>sub</code> should be a scalar giving the focus estimate from a submodel.  <code>wide</code> should be a vector with a sample of focus estimates from the wide model, e.g. generated by a bootstrap method.  By default this is a function calculating the root mean square error of the submodel estimate.   An example is given in the vignette  &quot;Focused model comparison with bootstrapping and alternative loss functions&quot;.</p>
</td></tr>
<tr><td><code id="fic.glm_+3A_...">...</code></td>
<td>
<p>Other arguments to the focus function can be supplied here.
</p>
<p>The built-in focus functions <code><a href="#topic+prob_logistic">prob_logistic</a></code> and <code><a href="#topic+mean_normal">mean_normal</a></code> take an argument <code>X</code> giving covariate values defining the focus. This can either be a matrix or a vector, or a list or data frame that can be coerced into a matrix. 
</p>
<p>If just one focus is needed, then <code>X</code> can be a vector of length equal to the number of parameters in the wide model.
</p>
<p>To compute focused model comparison statistics for multiple focuses defined by the same focus function evaluated at multiple covariate values, <code>X</code> should be a matrix, with number of columns equal to the number of parameters in the wide model, and number of rows equal to the number of alternative focuses.
</p>
<p>For a typical regression model, the first parameter will denote an intercept, so the first value of <code>X</code> should be 1, and the remaining values should correspond to covariates whose coefficients form parameters of the wide model.  See the examples in the vignette.
</p>
<p>Arguments to the focus function other than <code>X</code> can also be supplied as a matrix, vector, list or data frame in the same way. An exception is when the argument is supplied as a vector, this is assumed to refer to multiple focuses.   For example, suppose the focus function defines the quantile of a distribution, and takes an argument <code>focus_p</code>, then calling <code>fic(...,focus_p=c(0.1, 0.9))</code> indicates two alternative focuses defined by the 0.1 and 0.9 quantiles.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The model parameters include the intercept, followed by the coefficients of any covariates.  Any &quot;dispersion&quot; parameter is excluded from the parameters indicated by <code>inds</code> and <code>inds0</code>.   
</p>
<p>Only covariate selection problems are supported in this function.
To compare between models with a fixed and unknown dispersion,
<code><a href="stats.html#topic+glm">glm</a></code> would have to be replaced by maximum likelihood
estimation routines written by hand, along the lines described in
the &quot;skew-normal models&quot; vignette.
</p>
<p>The focus function can however depend on the value of the
dispersion parameter.  The focus function should then have
an argument called <code>dispersion</code>.  See the example of a gamma
GLM below, where the focus is the mean outcome for some covariate
value.
</p>
<p>Examples of covariate selection in logistic regression are given in the main package vignette.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Gamma regression with one binary covariate

# Simulated data 
set.seed(1)
simx &lt;- rbinom(1000, 1, 0.5)
mean0 &lt;- 1.1
simy &lt;- rgamma(1000, shape=2, scale=exp(log(mean0) + 0.2*simx))

mod &lt;- glm(simy ~ simx, family=Gamma(link="log"))

# Check the parameter estimates are close to true
# values used for simulation
(shape &lt;- 1 / summary(mod)$dispersion)
coef(mod)[2] # log mean ratio associated with covariate. true value 0.2
exp(coef(mod)[1] - log(shape))  # mean with x=0, true value 1.1
exp(coef(mod)[1] + coef(mod)[2] - log(shape))  # mean with x=1

focus_mean &lt;- function(par, X, dispersion){  
  exp(X %*% par - log(1/dispersion))
}

X &lt;- rbind("x0" = c(1,0), "x1" = c(1,1))
inds &lt;- rbind("no_covariate"=c(1,0), "covariate"=c(1,1))

fic(mod, inds=inds, focus=focus_mean, X=X)

# The focus need not depend on X or the dispersion
focus_base_scale &lt;- function(par, dispersion){  
  exp(par[1])
}
fic(mod, inds=inds, focus=focus_base_scale)

# ...equivalently,
focus_base_scale &lt;- function(par){  
  exp(par[1])
}
fic(mod, inds=inds, focus=focus_base_scale)



</code></pre>

<hr>
<h2 id='fic.lm'>Focused information criteria for linear models</h2><span id='topic+fic.lm'></span>

<h3>Description</h3>

<p>Focused information criteria for linear models fitted with <code><a href="stats.html#topic+lm">lm</a></code>.
Typically used to compare models with different covariates (more generally,
different linear terms).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'lm'
fic(wide, inds, inds0 = NULL, gamma0 = 0, focus = NULL,
  focus_deriv = NULL, wt = NULL, sub = "auto", B = 0, loss = loss_mse,
  ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fic.lm_+3A_wide">wide</code></td>
<td>
<p>Fitted model object containing the wide model.</p>
</td></tr>
<tr><td><code id="fic.lm_+3A_inds">inds</code></td>
<td>
<p>Matrix or vector of indicators for which parameters are included in the submodel or submodels to be assessed.
</p>
<p>A matrix should be supplied if there are multiple submodels.  This should have number of rows equal to the number of submodels, and number of columns equal to the total number of parameters in the wide model.  It contains 1s in the positions where the parameter is included in the submodel, and 0s in positions where the parameter is excluded.  This should always be 1 in the positions defining the narrow model, as specified in <code>inds0</code>.</p>
</td></tr>
<tr><td><code id="fic.lm_+3A_inds0">inds0</code></td>
<td>
<p>Vector of indicators specifying the narrow model, in the same format as <code>inds</code>.  If this is omitted, the narrow model is assumed to be defined by the first row of <code>inds</code> (if <code>inds</code> is a matrix), or <code>inds</code> itself if this is a vector.</p>
</td></tr>
<tr><td><code id="fic.lm_+3A_gamma0">gamma0</code></td>
<td>
<p>Vector of special values taken by the parameters <code class="reqn">gamma</code> which define the narrow model.
</p>
<p>This defaults to 0, as in covariate selection, where &quot;excluded&quot; coefficients are fixed to 0. 
</p>
<p>This should either be a scalar, assumed to be the same for all parameters fixed in the narrow model, or a vector of length equal to the number of parameters from the wide model which are fixed in the narrow model, that is, the number of entries of <code>inds0</code> which are zero.</p>
</td></tr>
<tr><td><code id="fic.lm_+3A_focus">focus</code></td>
<td>
<p>An R function with:
</p>

<ul>
<li><p> first argument named <code>par</code>, denoting a vector of parameters, of the same length as in wide model
</p>
</li>
<li><p> other arguments defining alternative focuses.  These are supplied through the <code>...</code> argument to <code><a href="#topic+fic">fic</a></code>.  In the built-in examples, there is an argument named <code>X</code>, denoting alternative covariate values.  The required format is documented below. 
</p>
</li></ul>

<p>The function should return the focus quantity of interest.  If additional arguments are supplied which are vectors or matrices, e.g. <code>X</code>, then these are assumed to represent multiple focuses, and <code>focus</code> should return a vector giving the focus for <code>par</code> and each row of <code>X</code>.  Otherwise <code>focus</code> should return a scalar giving the focus value at <code>par</code>.
</p>
<p>Not required if <code>focus_deriv</code> is specified.
</p>
<p>Alternatively, <code>focus</code> can be a character string naming a built-in focus function supplied by the <span class="pkg">fic</span> package.  Currently these include:
</p>
<p><code>"prob_logistic"</code>, the probability of the outcome in a logistic regression model
</p>
<p><code>"mean_normal"</code> the mean outcome in a normal linear regression model
</p>
<p>See <code><a href="#topic+focus_fns">focus_fns</a></code> for the functions underlying these built-in focuses.</p>
</td></tr>
<tr><td><code id="fic.lm_+3A_focus_deriv">focus_deriv</code></td>
<td>
<p>Vector of partial derivatives of the focus function with respect to the parameters in the wide model.  This is not usually needed, as it can generally be computed automatically and accurately from the function supplied in <code>focus</code>, using numerical differentiation.</p>
</td></tr>
<tr><td><code id="fic.lm_+3A_wt">wt</code></td>
<td>
<p>Vector of weights to apply to different covariate values in <code>X</code>.  This should have length equal to the number of alternative values for the covariates, that is, the number of alternative focuses of interest.  The covariate-specific focused model comparison statistics are then supplemented by averaged statistics for a population defined by this distribution of covariate values.  If this argument is omitted, the values are assumed to have equal weight when computing the average.   The weights are not normalised, though the interpretation is unclear if the weights don't sum to one.</p>
</td></tr>
<tr><td><code id="fic.lm_+3A_sub">sub</code></td>
<td>
<p>If <code>"auto"</code> (the default) then the submodels are fitted automatically within this function.   If <code>NULL</code> they are not fitted, and focus estimates are not returned with the results. 
</p>
<p>The model parameters include the intercept, followed by the coefficients of any covariates.   The standard deviation is excluded.
</p>
<p>Only covariate selection problems are supported in this function.  To compare between models with a fixed and unknown standard deviation, hand-written maximum likelihood estimation routines would be needed, along the lines described in the &quot;skew-normal models&quot; vignette. 
</p>
<p>The focus can depend on the standard deviation.  The focus function should then have an argument <code>sigma</code>. 
</p>
<p>See the vignette &quot;Using the fic R package for focused model comparison: linear regression&quot; for some examples.</p>
</td></tr>
<tr><td><code id="fic.lm_+3A_b">B</code></td>
<td>
<p>If <code>B</code> is 0 (the default) the standard analytic formulae for the focused model comparison statistics are used with mean square error loss.   If <code>B</code>&gt;0, then a parametric bootstrap method is used with <code>B</code> bootstrap samples, and the loss specified in the <code>loss</code> argument. More details of this approach are given in the package vignette &quot;Focused model comparison with bootstrapping and alternative loss functions&quot;.</p>
</td></tr>
<tr><td><code id="fic.lm_+3A_loss">loss</code></td>
<td>
<p>A function returning an estimated loss for a submodel estimate under the sampling distribution of the wide model.  Only applicable when using bootstrapping.  This should have two arguments <code>sub</code> and <code>wide</code>.  <code>sub</code> should be a scalar giving the focus estimate from a submodel.  <code>wide</code> should be a vector with a sample of focus estimates from the wide model, e.g. generated by a bootstrap method.  By default this is a function calculating the root mean square error of the submodel estimate.   An example is given in the vignette  &quot;Focused model comparison with bootstrapping and alternative loss functions&quot;.</p>
</td></tr>
<tr><td><code id="fic.lm_+3A_...">...</code></td>
<td>
<p>Other arguments to the focus function can be supplied here.
</p>
<p>The built-in focus functions <code><a href="#topic+prob_logistic">prob_logistic</a></code> and <code><a href="#topic+mean_normal">mean_normal</a></code> take an argument <code>X</code> giving covariate values defining the focus. This can either be a matrix or a vector, or a list or data frame that can be coerced into a matrix. 
</p>
<p>If just one focus is needed, then <code>X</code> can be a vector of length equal to the number of parameters in the wide model.
</p>
<p>To compute focused model comparison statistics for multiple focuses defined by the same focus function evaluated at multiple covariate values, <code>X</code> should be a matrix, with number of columns equal to the number of parameters in the wide model, and number of rows equal to the number of alternative focuses.
</p>
<p>For a typical regression model, the first parameter will denote an intercept, so the first value of <code>X</code> should be 1, and the remaining values should correspond to covariates whose coefficients form parameters of the wide model.  See the examples in the vignette.
</p>
<p>Arguments to the focus function other than <code>X</code> can also be supplied as a matrix, vector, list or data frame in the same way. An exception is when the argument is supplied as a vector, this is assumed to refer to multiple focuses.   For example, suppose the focus function defines the quantile of a distribution, and takes an argument <code>focus_p</code>, then calling <code>fic(...,focus_p=c(0.1, 0.9))</code> indicates two alternative focuses defined by the 0.1 and 0.9 quantiles.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
## Covariate selection in Motor Trend cars data
## See the "fic" package vignette on linear models for more details

wide.lm &lt;- lm(mpg ~ am + wt + qsec + disp + hp, data=mtcars)

## Select between all submodels 
ncovs_wide &lt;- length(coef(wide.lm)) - 1
inds0 &lt;- c(1, rep(0, ncovs_wide))
inds &lt;- all_inds(wide.lm, inds0)

## Two focuses: mean MPG for automatic and manual transmission,
## given mean values of the other covariates 
cmeans &lt;- colMeans(model.frame(wide.lm)[,c("wt","qsec","disp","hp")])
X &lt;- rbind(
  "auto"   = c(intercept=1, am=0, cmeans),
  "manual" = c(intercept=1, am=1, cmeans)
)
ficres &lt;- fic(wide.lm, inds=inds, focus=mean_normal, X=X)
summary(ficres)
ggplot_fic(ficres)


</code></pre>

<hr>
<h2 id='fic.msm'>Focused information criteria for multi-state models for panel data</h2><span id='topic+fic.msm'></span>

<h3>Description</h3>

<p>Focused information criteria for multi-state models fitted with <code><a href="msm.html#topic+msm">msm</a></code> from the <span class="pkg">msm</span> package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'msm'
fic(wide, inds, inds0 = NULL, gamma0 = 0, focus = NULL,
  focus_deriv = NULL, wt = NULL, sub = NULL, B = 0, loss = loss_mse,
  ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fic.msm_+3A_wide">wide</code></td>
<td>
<p>Object returned by <code><a href="msm.html#topic+msm">msm</a></code> containing the wide model.</p>
</td></tr>
<tr><td><code id="fic.msm_+3A_inds">inds</code></td>
<td>
<p>Matrix or vector of indicators for which parameters are included in the submodel or submodels to be assessed.
</p>
<p>A matrix should be supplied if there are multiple submodels.  This should have number of rows equal to the number of submodels, and number of columns equal to the total number of parameters in the wide model.  It contains 1s in the positions where the parameter is included in the submodel, and 0s in positions where the parameter is excluded.  This should always be 1 in the positions defining the narrow model, as specified in <code>inds0</code>.</p>
</td></tr>
<tr><td><code id="fic.msm_+3A_inds0">inds0</code></td>
<td>
<p>Vector of indicators specifying the narrow model, in the same format as <code>inds</code>.  If this is omitted, the narrow model is assumed to be defined by the first row of <code>inds</code> (if <code>inds</code> is a matrix), or <code>inds</code> itself if this is a vector.</p>
</td></tr>
<tr><td><code id="fic.msm_+3A_gamma0">gamma0</code></td>
<td>
<p>Vector of special values taken by the parameters <code class="reqn">gamma</code> which define the narrow model.
</p>
<p>This defaults to 0, as in covariate selection, where &quot;excluded&quot; coefficients are fixed to 0. 
</p>
<p>This should either be a scalar, assumed to be the same for all parameters fixed in the narrow model, or a vector of length equal to the number of parameters from the wide model which are fixed in the narrow model, that is, the number of entries of <code>inds0</code> which are zero.</p>
</td></tr>
<tr><td><code id="fic.msm_+3A_focus">focus</code></td>
<td>
<p>An R function with:
</p>

<ul>
<li><p> first argument named <code>par</code>, denoting a vector of parameters, of the same length as in wide model
</p>
</li>
<li><p> other arguments defining alternative focuses.  These are supplied through the <code>...</code> argument to <code><a href="#topic+fic">fic</a></code>.  In the built-in examples, there is an argument named <code>X</code>, denoting alternative covariate values.  The required format is documented below. 
</p>
</li></ul>

<p>The function should return the focus quantity of interest.  If additional arguments are supplied which are vectors or matrices, e.g. <code>X</code>, then these are assumed to represent multiple focuses, and <code>focus</code> should return a vector giving the focus for <code>par</code> and each row of <code>X</code>.  Otherwise <code>focus</code> should return a scalar giving the focus value at <code>par</code>.
</p>
<p>Not required if <code>focus_deriv</code> is specified.
</p>
<p>Alternatively, <code>focus</code> can be a character string naming a built-in focus function supplied by the <span class="pkg">fic</span> package.  Currently these include:
</p>
<p><code>"prob_logistic"</code>, the probability of the outcome in a logistic regression model
</p>
<p><code>"mean_normal"</code> the mean outcome in a normal linear regression model
</p>
<p>See <code><a href="#topic+focus_fns">focus_fns</a></code> for the functions underlying these built-in focuses.</p>
</td></tr>
<tr><td><code id="fic.msm_+3A_focus_deriv">focus_deriv</code></td>
<td>
<p>Vector of partial derivatives of the focus function with respect to the parameters in the wide model.  This is not usually needed, as it can generally be computed automatically and accurately from the function supplied in <code>focus</code>, using numerical differentiation.</p>
</td></tr>
<tr><td><code id="fic.msm_+3A_wt">wt</code></td>
<td>
<p>Vector of weights to apply to different covariate values in <code>X</code>.  This should have length equal to the number of alternative values for the covariates, that is, the number of alternative focuses of interest.  The covariate-specific focused model comparison statistics are then supplemented by averaged statistics for a population defined by this distribution of covariate values.  If this argument is omitted, the values are assumed to have equal weight when computing the average.   The weights are not normalised, though the interpretation is unclear if the weights don't sum to one.</p>
</td></tr>
<tr><td><code id="fic.msm_+3A_sub">sub</code></td>
<td>
<p>List of objects returned by <code><a href="msm.html#topic+msm">msm</a></code> containing the submodels to be assessed.  Optional. Only required if you want the estimate of the focus
function under the submodel to be included in the results.</p>
</td></tr>
<tr><td><code id="fic.msm_+3A_b">B</code></td>
<td>
<p>If <code>B</code> is 0 (the default) the standard analytic formulae for the focused model comparison statistics are used with mean square error loss.   If <code>B</code>&gt;0, then a parametric bootstrap method is used with <code>B</code> bootstrap samples, and the loss specified in the <code>loss</code> argument. More details of this approach are given in the package vignette &quot;Focused model comparison with bootstrapping and alternative loss functions&quot;.</p>
</td></tr>
<tr><td><code id="fic.msm_+3A_loss">loss</code></td>
<td>
<p>A function returning an estimated loss for a submodel estimate under the sampling distribution of the wide model.  Only applicable when using bootstrapping.  This should have two arguments <code>sub</code> and <code>wide</code>.  <code>sub</code> should be a scalar giving the focus estimate from a submodel.  <code>wide</code> should be a vector with a sample of focus estimates from the wide model, e.g. generated by a bootstrap method.  By default this is a function calculating the root mean square error of the submodel estimate.   An example is given in the vignette  &quot;Focused model comparison with bootstrapping and alternative loss functions&quot;.</p>
</td></tr>
<tr><td><code id="fic.msm_+3A_...">...</code></td>
<td>
<p>Other arguments to the focus function can be supplied here.
</p>
<p>The built-in focus functions <code><a href="#topic+prob_logistic">prob_logistic</a></code> and <code><a href="#topic+mean_normal">mean_normal</a></code> take an argument <code>X</code> giving covariate values defining the focus. This can either be a matrix or a vector, or a list or data frame that can be coerced into a matrix. 
</p>
<p>If just one focus is needed, then <code>X</code> can be a vector of length equal to the number of parameters in the wide model.
</p>
<p>To compute focused model comparison statistics for multiple focuses defined by the same focus function evaluated at multiple covariate values, <code>X</code> should be a matrix, with number of columns equal to the number of parameters in the wide model, and number of rows equal to the number of alternative focuses.
</p>
<p>For a typical regression model, the first parameter will denote an intercept, so the first value of <code>X</code> should be 1, and the remaining values should correspond to covariates whose coefficients form parameters of the wide model.  See the examples in the vignette.
</p>
<p>Arguments to the focus function other than <code>X</code> can also be supplied as a matrix, vector, list or data frame in the same way. An exception is when the argument is supplied as a vector, this is assumed to refer to multiple focuses.   For example, suppose the focus function defines the quantile of a distribution, and takes an argument <code>focus_p</code>, then calling <code>fic(...,focus_p=c(0.1, 0.9))</code> indicates two alternative focuses defined by the 0.1 and 0.9 quantiles.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This might be used for covariate selection, or comparing models with different constraints on the covariate effects or intensities.   An example is given in the <span class="pkg">fic</span> package vignette &quot;Examples of focused model comparison: multi-state models&quot;.  Note in particular in this example how the parameters are ordered in the <code>inds</code> argument, and how the various <span class="pkg">msm</span> output functions can be used as focuses.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Covariate selection in psoriatic arthritis model.
## See the "fic" package vignette on multi-state models for
## more details and examples. 

if (requireNamespace("msm",quietly=TRUE)){

Qind &lt;- rbind(c(0, 1, 0, 0),
              c(0, 0, 1, 0),
              c(0, 0, 0, 1),
              c(0, 0, 0, 0))
psor.wide.msm &lt;- msm::msm(state ~ months, subject=ptnum, data=msm::psor, 
                     qmatrix = Qind,  gen.inits=TRUE,
                     covariates = ~ollwsdrt+hieffusn)
inds &lt;- rbind(
    c(1,1,1,0,0,0,0,0,0),
    c(1,1,1,0,0,0,0,0,1),
    c(1,1,1,0,0,0,0,1,1),
    c(1,1,1,0,0,0,1,1,1),
    c(1,1,1,0,0,1,1,1,1),
    c(1,1,1,0,1,1,1,1,1),
    c(1,1,1,1,1,1,1,1,1)
)
focus_tlos &lt;- function(par){
    x.new &lt;- msm::updatepars.msm(psor.wide.msm, par)
    msm::totlos.msm(x.new, covariates=0, tot=10)["State 4"]
}
fres &lt;- fic(wide=psor.wide.msm, inds=inds, focus=focus_tlos)
fres

}

</code></pre>

<hr>
<h2 id='fic.survreg'>Focused information criteria for parametric survival models</h2><span id='topic+fic.survreg'></span>

<h3>Description</h3>

<p>Focused information criteria for parametric survival models fitted with the <span class="pkg">survival</span> package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'survreg'
fic(wide, inds, inds0 = NULL, gamma0 = 0, focus = NULL,
  focus_deriv = NULL, wt = NULL, sub = NULL, B = 0, loss = loss_mse,
  ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fic.survreg_+3A_wide">wide</code></td>
<td>
<p>Object returned by the <code><a href="survival.html#topic+survreg">survreg</a></code> function, containing the wide model.</p>
</td></tr>
<tr><td><code id="fic.survreg_+3A_inds">inds</code></td>
<td>
<p>Matrix or vector of indicators for which parameters are included in the submodel or submodels to be assessed.
</p>
<p>A matrix should be supplied if there are multiple submodels.  This should have number of rows equal to the number of submodels, and number of columns equal to the total number of parameters in the wide model.  It contains 1s in the positions where the parameter is included in the submodel, and 0s in positions where the parameter is excluded.  This should always be 1 in the positions defining the narrow model, as specified in <code>inds0</code>.</p>
</td></tr>
<tr><td><code id="fic.survreg_+3A_inds0">inds0</code></td>
<td>
<p>Vector of indicators specifying the narrow model, in the same format as <code>inds</code>.  If this is omitted, the narrow model is assumed to be defined by the first row of <code>inds</code> (if <code>inds</code> is a matrix), or <code>inds</code> itself if this is a vector.</p>
</td></tr>
<tr><td><code id="fic.survreg_+3A_gamma0">gamma0</code></td>
<td>
<p>Vector of special values taken by the parameters <code class="reqn">gamma</code> which define the narrow model.
</p>
<p>This defaults to 0, as in covariate selection, where &quot;excluded&quot; coefficients are fixed to 0. 
</p>
<p>This should either be a scalar, assumed to be the same for all parameters fixed in the narrow model, or a vector of length equal to the number of parameters from the wide model which are fixed in the narrow model, that is, the number of entries of <code>inds0</code> which are zero.</p>
</td></tr>
<tr><td><code id="fic.survreg_+3A_focus">focus</code></td>
<td>
<p>An R function with:
</p>

<ul>
<li><p> first argument named <code>par</code>, denoting a vector of parameters, of the same length as in wide model
</p>
</li>
<li><p> other arguments defining alternative focuses.  These are supplied through the <code>...</code> argument to <code><a href="#topic+fic">fic</a></code>.  In the built-in examples, there is an argument named <code>X</code>, denoting alternative covariate values.  The required format is documented below. 
</p>
</li></ul>

<p>The function should return the focus quantity of interest.  If additional arguments are supplied which are vectors or matrices, e.g. <code>X</code>, then these are assumed to represent multiple focuses, and <code>focus</code> should return a vector giving the focus for <code>par</code> and each row of <code>X</code>.  Otherwise <code>focus</code> should return a scalar giving the focus value at <code>par</code>.
</p>
<p>Not required if <code>focus_deriv</code> is specified.
</p>
<p>Alternatively, <code>focus</code> can be a character string naming a built-in focus function supplied by the <span class="pkg">fic</span> package.  Currently these include:
</p>
<p><code>"prob_logistic"</code>, the probability of the outcome in a logistic regression model
</p>
<p><code>"mean_normal"</code> the mean outcome in a normal linear regression model
</p>
<p>See <code><a href="#topic+focus_fns">focus_fns</a></code> for the functions underlying these built-in focuses.</p>
</td></tr>
<tr><td><code id="fic.survreg_+3A_focus_deriv">focus_deriv</code></td>
<td>
<p>Vector of partial derivatives of the focus function with respect to the parameters in the wide model.  This is not usually needed, as it can generally be computed automatically and accurately from the function supplied in <code>focus</code>, using numerical differentiation.</p>
</td></tr>
<tr><td><code id="fic.survreg_+3A_wt">wt</code></td>
<td>
<p>Vector of weights to apply to different covariate values in <code>X</code>.  This should have length equal to the number of alternative values for the covariates, that is, the number of alternative focuses of interest.  The covariate-specific focused model comparison statistics are then supplemented by averaged statistics for a population defined by this distribution of covariate values.  If this argument is omitted, the values are assumed to have equal weight when computing the average.   The weights are not normalised, though the interpretation is unclear if the weights don't sum to one.</p>
</td></tr>
<tr><td><code id="fic.survreg_+3A_sub">sub</code></td>
<td>
<p>List of fitted model objects of class <code><a href="survival.html#topic+survreg">survreg</a></code> containing the submodels to be assessed.   Optional. Only required if you want the estimate of the focus
function under the submodels to be included in the results.</p>
</td></tr>
<tr><td><code id="fic.survreg_+3A_b">B</code></td>
<td>
<p>If <code>B</code> is 0 (the default) the standard analytic formulae for the focused model comparison statistics are used with mean square error loss.   If <code>B</code>&gt;0, then a parametric bootstrap method is used with <code>B</code> bootstrap samples, and the loss specified in the <code>loss</code> argument. More details of this approach are given in the package vignette &quot;Focused model comparison with bootstrapping and alternative loss functions&quot;.</p>
</td></tr>
<tr><td><code id="fic.survreg_+3A_loss">loss</code></td>
<td>
<p>A function returning an estimated loss for a submodel estimate under the sampling distribution of the wide model.  Only applicable when using bootstrapping.  This should have two arguments <code>sub</code> and <code>wide</code>.  <code>sub</code> should be a scalar giving the focus estimate from a submodel.  <code>wide</code> should be a vector with a sample of focus estimates from the wide model, e.g. generated by a bootstrap method.  By default this is a function calculating the root mean square error of the submodel estimate.   An example is given in the vignette  &quot;Focused model comparison with bootstrapping and alternative loss functions&quot;.</p>
</td></tr>
<tr><td><code id="fic.survreg_+3A_...">...</code></td>
<td>
<p>Other arguments to the focus function can be supplied here.
</p>
<p>The built-in focus functions <code><a href="#topic+prob_logistic">prob_logistic</a></code> and <code><a href="#topic+mean_normal">mean_normal</a></code> take an argument <code>X</code> giving covariate values defining the focus. This can either be a matrix or a vector, or a list or data frame that can be coerced into a matrix. 
</p>
<p>If just one focus is needed, then <code>X</code> can be a vector of length equal to the number of parameters in the wide model.
</p>
<p>To compute focused model comparison statistics for multiple focuses defined by the same focus function evaluated at multiple covariate values, <code>X</code> should be a matrix, with number of columns equal to the number of parameters in the wide model, and number of rows equal to the number of alternative focuses.
</p>
<p>For a typical regression model, the first parameter will denote an intercept, so the first value of <code>X</code> should be 1, and the remaining values should correspond to covariates whose coefficients form parameters of the wide model.  See the examples in the vignette.
</p>
<p>Arguments to the focus function other than <code>X</code> can also be supplied as a matrix, vector, list or data frame in the same way. An exception is when the argument is supplied as a vector, this is assumed to refer to multiple focuses.   For example, suppose the focus function defines the quantile of a distribution, and takes an argument <code>focus_p</code>, then calling <code>fic(...,focus_p=c(0.1, 0.9))</code> indicates two alternative focuses defined by the 0.1 and 0.9 quantiles.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Any situation where all models being compared are special cases of a single &quot;wide&quot; model are supported.  Examples include covariate selection, selection between models for the baseline hazard/survival with different levels of flexibility (e.g. comparing exponential and Weibull). An example of the latter is in the <span class="pkg">fic</span> package vignette &quot;Examples of focused model comparison: parametric survival models&quot;.
</p>
<p>Parameters <code>par</code> of the focus function should be on the scale reported by the <code>icoef</code> component of the results of <code>survreg</code>, that is, with any positive-valued parameters log transformed.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)

## Fit exponential and Weibull models and plot fitted survival curves
ex &lt;-  survreg(Surv(futime, fustat) ~ 1, data=ovarian, dist="exponential")
we &lt;-  survreg(Surv(futime, fustat) ~ 1, data=ovarian, dist="weibull")

## Plot fitted survival curves, highlighting 1 year survival 
plot(survfit(Surv(futime, fustat) ~ 1, data=ovarian))
t &lt;- seq(0, 1200)
lines(t, pweibull(q=t, shape=exp(we$icoef[2]),
                  scale=exp(we$icoef[1]), lower.tail=FALSE))
lines(t, pexp(q=t, rate=1/exp(ex$icoef[1]), lower.tail=FALSE), lty=2)
abline(v=365, col="gray")

## Focused model comparison for focus of 1-year survival probability
indmat &lt;- rbind(exp    = c(1,0),
                weib   = c(1,1))
surv1yr &lt;- function(par){
    pweibull(q=365, shape=exp(par[2]), scale=exp(par[1]), lower.tail=FALSE)
}
fic(we, inds=indmat, focus=surv1yr, sub=list(ex, we))

## Exponential model has lower expected error, given such a small dataset 

</code></pre>

<hr>
<h2 id='fit_submodels'>Fit submodels of a general linear wide model, defined by a matrix of indicators
for inclusion of covariates</h2><span id='topic+fit_submodels'></span>

<h3>Description</h3>

<p>Fit the submodels of a wide model <code>wide</code> which are defined by
<code>inds</code>.  This can only be used for covariate selection
problems, where the submodels contain different subsets of
covariates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_submodels(wide, inds, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fit_submodels_+3A_wide">wide</code></td>
<td>
<p>Fitted model object containing the wide model.</p>
</td></tr>
<tr><td><code id="fit_submodels_+3A_inds">inds</code></td>
<td>
<p>Matrix or vector of indicators for which parameters are included in the submodel or submodels to be assessed.
</p>
<p>A matrix should be supplied if there are multiple submodels.  This should have number of rows equal to the number of submodels, and number of columns equal to the total number of parameters in the wide model.  It contains 1s in the positions where the parameter is included in the submodel, and 0s in positions where the parameter is excluded.  This should always be 1 in the positions defining the narrow model, as specified in <code>inds0</code>.</p>
</td></tr>
<tr><td><code id="fit_submodels_+3A_...">...</code></td>
<td>
<p>Other arguments to the focus function can be supplied here.
</p>
<p>The built-in focus functions <code><a href="#topic+prob_logistic">prob_logistic</a></code> and <code><a href="#topic+mean_normal">mean_normal</a></code> take an argument <code>X</code> giving covariate values defining the focus. This can either be a matrix or a vector, or a list or data frame that can be coerced into a matrix. 
</p>
<p>If just one focus is needed, then <code>X</code> can be a vector of length equal to the number of parameters in the wide model.
</p>
<p>To compute focused model comparison statistics for multiple focuses defined by the same focus function evaluated at multiple covariate values, <code>X</code> should be a matrix, with number of columns equal to the number of parameters in the wide model, and number of rows equal to the number of alternative focuses.
</p>
<p>For a typical regression model, the first parameter will denote an intercept, so the first value of <code>X</code> should be 1, and the remaining values should correspond to covariates whose coefficients form parameters of the wide model.  See the examples in the vignette.
</p>
<p>Arguments to the focus function other than <code>X</code> can also be supplied as a matrix, vector, list or data frame in the same way. An exception is when the argument is supplied as a vector, this is assumed to refer to multiple focuses.   For example, suppose the focus function defines the quantile of a distribution, and takes an argument <code>focus_p</code>, then calling <code>fic(...,focus_p=c(0.1, 0.9))</code> indicates two alternative focuses defined by the 0.1 and 0.9 quantiles.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Requires <code>wide</code> to have a component named
<code>call</code> giving the function call used to produce <code>wide</code>.
This call should include a <code>formula</code> component, which this
function updates in order to define and fit the submodel.  This
should work for most standard linear-type models in common R packages.
</p>


<h3>Value</h3>

<p>List of all fitted submodel objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>bwt.glm &lt;- glm(low ~ lwtkg + age + smoke,
               data=birthwt, family="binomial")
inds &lt;- rbind(c(1,1,1,0), c(1,1,0,0))
fit_submodels(bwt.glm, inds=inds)

</code></pre>

<hr>
<h2 id='focus_fns'>Built-in focus functions and their derivatives</h2><span id='topic+focus_fns'></span><span id='topic+prob_logistic'></span><span id='topic+prob_logistic_deriv'></span><span id='topic+prob_logistic'></span><span id='topic+prob_logistic_deriv'></span><span id='topic+mean_normal'></span><span id='topic+mean_normal_deriv'></span>

<h3>Description</h3>

<p>Built-in focus functions and their derivatives
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prob_logistic(par, X)

prob_logistic_deriv(par, X)

mean_normal(par, X)

mean_normal_deriv(par, X)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="focus_fns_+3A_par">par</code></td>
<td>
<p>Vector of parameter estimates, including the intercept.</p>
</td></tr>
<tr><td><code id="focus_fns_+3A_x">X</code></td>
<td>
<p>Vector or matrix of covariate values, including the intercept. This can either be a vector of length <code class="reqn">p</code>, or a <code class="reqn">n x p</code> matrix, where <code class="reqn">p</code> is the number of covariate effects, and <code class="reqn">n</code> is the number of alternative sets of covariate values at which the focus function is to be evaluated.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>prob_logistic</code> returns the probability of the outcome in a logistic regression model, and <code>mean_normal</code> returns the mean outcome in a normal linear regression.   The <code>_deriv</code> functions return the vector of partial derivatives of the focus with respect to each parameter (or matrix, if there are multiple foci).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fic">fic</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Model and focus from the main vignette 
wide.glm &lt;- glm(low ~ lwtkg + age + smoke + ht + ui +
                smokeage + smokeui, data=birthwt, family=binomial)
vals.smoke &lt;-    c(1, 58.24, 22.95, 1, 0, 0, 22.95, 0)
vals.nonsmoke &lt;- c(1, 59.50, 23.43, 0, 0, 0, 0, 0)
X &lt;- rbind("Smokers" = vals.smoke, "Non-smokers" = vals.nonsmoke)
prob_logistic(coef(wide.glm), X=X)
prob_logistic_deriv(coef(wide.glm), X=X)


## Mean mpg for a particular covariate category in the Motor Trend data
## See the "fic" linear models vignette for more detail 

wide.lm &lt;- lm(mpg ~ am + wt + qsec + disp + hp, data=mtcars)
cmeans &lt;- colMeans(model.frame(wide.lm)[,c("wt","qsec","disp","hp")])
X &lt;- rbind(
  "auto"   = c(intercept=1, am=0, cmeans),
  "manual" = c(intercept=1, am=1, cmeans)
)
mean_normal(coef(wide.lm), X)
mean_normal_deriv(coef(wide.lm), X)

</code></pre>

<hr>
<h2 id='get_H0'>Interpolate cumulative hazard function from a fitted Cox model</h2><span id='topic+get_H0'></span>

<h3>Description</h3>

<p>Returns the baseline cumulative hazard, at the requested times,
from a Cox model fitted by <code><a href="survival.html#topic+coxph">coxph</a></code>.  Linear
interpolation is used, assuming the hazard is piecewise constant,
thus the cumulative hazard is piecewise linear.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_H0(H0, t)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_H0_+3A_h0">H0</code></td>
<td>
<p>output from <code><a href="survival.html#topic+basehaz">basehaz</a></code>, containing estimates of the baseline cumulative hazard at a series of times.</p>
</td></tr>
<tr><td><code id="get_H0_+3A_t">t</code></td>
<td>
<p>vector of times for which cumulative hazard estimates are required.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This does not extrapolate.  If <code>t</code> is outside the observed event times, then <code>NA</code> will be returned.
</p>


<h3>Value</h3>

<p>Fitted cumulative hazard at <code>t</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
wide &lt;- coxph(Surv(years, death==1) ~ sex + thick_centred +
              infilt + epith + ulcer + depth + age, data=melanoma)
basehaz(wide)
get_H0(basehaz(wide), c(0,1,5,10,100))


</code></pre>

<hr>
<h2 id='ggplot_fic'>Plot focused model comparison statistics: ggplot2 method</h2><span id='topic+ggplot_fic'></span>

<h3>Description</h3>

<p>This only works if the focus estimates are available. The focus estimates are
plotted against the root MSE.  One plot is made for each covariate
value defining different focuses.  If the wide model estimate is
available, this is illustrated as a solid line on the plot, and if
the narrow model estimate is available, this is showm as a dashed
line.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ggplot_fic(x, ci = TRUE, legend = TRUE, ylab = NULL, xlab = NULL,
  xlim = NULL, ylim = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ggplot_fic_+3A_x">x</code></td>
<td>
<p>Output from <code><a href="#topic+fic">fic</a></code>.</p>
</td></tr>
<tr><td><code id="ggplot_fic_+3A_ci">ci</code></td>
<td>
<p>Plot interval estimates? (<code>TRUE</code> or <code>FALSE</code>).  These are calculated as plus / minus twice the standard error of the submodel focus under the wide model.  These are rough estimates of uncertainty intended to illustrate the bias-variance tradeoff, and exclude any uncertainty associated with the choice between models.</p>
</td></tr>
<tr><td><code id="ggplot_fic_+3A_legend">legend</code></td>
<td>
<p>Show a legend, identifying
</p>
<p>a) the line types for the wide and narrow models
</p>
<p>b) the names of the terms of the wide model.  This is used when
the <code>inds</code> object supplied to <code><a href="#topic+fic">fic</a></code> was constructed by
<code><a href="#topic+all_inds">all_inds</a></code>, so has row names made out of a string
of 0s and 1s that identify the terms included in the submodel.
These strings are plotted as text labels against the estimate for
each submodel.  The legend identifies which 0s and 1s correspond
to which model terms.</p>
</td></tr>
<tr><td><code id="ggplot_fic_+3A_ylab">ylab</code></td>
<td>
<p>y-axis label.</p>
</td></tr>
<tr><td><code id="ggplot_fic_+3A_xlab">xlab</code></td>
<td>
<p>x-axis label.</p>
</td></tr>
<tr><td><code id="ggplot_fic_+3A_xlim">xlim</code></td>
<td>
<p>x-axis limits (pair of numbers)</p>
</td></tr>
<tr><td><code id="ggplot_fic_+3A_ylim">ylim</code></td>
<td>
<p>y-axis limits</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>plot.fic, summary.fic
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Example from the main vignette, see there for more details

wide.glm &lt;- glm(low ~ lwtkg + age + smoke + ht + ui + smokeage + smokeui,
                data=birthwt, family=binomial)
vals.smoke &lt;-    c(1, 58.24, 22.95, 1, 0, 0, 22.95, 0)
vals.nonsmoke &lt;- c(1, 59.50, 23.43, 0, 0, 0, 0, 0)
X &lt;- rbind("Smokers" = vals.smoke, "Non-smokers" = vals.nonsmoke)
inds0 &lt;- c(1,1,0,0,0,0,0,0)
combs &lt;- all_inds(wide.glm, inds0)
ficres &lt;- fic(wide = wide.glm, inds = combs, inds0 = inds0,
              focus = prob_logistic, X = X)
ggplot_fic(ficres)
summary(ficres)

</code></pre>

<hr>
<h2 id='melanoma'>Malignant melanoma survival data</h2><span id='topic+melanoma'></span>

<h3>Description</h3>

<p>Data originally analysed by Andersen et al (1993) on the survival of 205 patients in Denmark with malignant melanoma, and used by Claeskens and Hjort (2008) to illustrate focused model selection in Cox regression.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>melanoma
</code></pre>


<h3>Format</h3>

<p>A data frame with 205 rows and the following columns:
</p>

<dl>
<dt>ptno</dt><dd><p>Patient identification number</p>
</dd>
<dt>death</dt><dd><p>Survival status: 1 = dead from illness, 2 = censored, 4 = dead from other causes</p>
</dd>
<dt>days</dt><dd><p>Survival time in days</p>
</dd>
<dt>depth</dt><dd><p>Invasion depth: factor with levels 1, 2, 3</p>
</dd>
<dt>infilt</dt><dd><p>Infection infiltration level, a measure of resistance to the tumour: factor with levels 1 (high resistance), 2, 3, 4 (low resistance)</p>
</dd>
<dt>epith</dt><dd><p>Indicator for epithelioid cells present</p>
</dd>
<dt>ulcer</dt><dd><p>Indicator for ulceration</p>
</dd>
<dt>thick</dt><dd><p>Thickness of the tumour in 1/100 mm</p>
</dd>
<dt>sex</dt><dd><p>Sex. Factor with levels <code>"female","male"</code> and reference level <code>"female"</code></p>
</dd>
<dt>age</dt><dd><p>Age in years</p>
</dd>
<dt>years</dt><dd><p>Survival time in years (instead of days)</p>
</dd>
<dt>thick_centred</dt><dd><p>Version of <code>thick</code> centred around its mean and rescaled, defined as (<code>thick</code> - 292)/100. </p>
</dd>
</dl>


<h3>Source</h3>

<p>The supporting material from Claeskens and Hjort (2008), at <a href="https://feb.kuleuven.be/public/u0043181/modelselection/datasets/melanoma_data.txt">https://feb.kuleuven.be/public/u0043181/modelselection/datasets/melanoma_data.txt</a>.    Versions of this dataset are also given in the <span class="pkg">MASS</span> and <span class="pkg">boot</span> packages.
</p>


<h3>References</h3>

<p>Claeskens, G., &amp; Hjort, N. L. (2008). Model selection and model averaging (Vol. 330). Cambridge: Cambridge University Press.
</p>
<p>Andersen, P. K., Borgan, O., Gill, R. D., &amp; Keiding, N. (2012). Statistical models based on counting processes. Springer.
</p>

<hr>
<h2 id='newdata_to_X'>Convert data frame of covariate values to a design matrix</h2><span id='topic+newdata_to_X'></span>

<h3>Description</h3>

<p>Convert data frame of covariate values to a design matrix
</p>


<h3>Usage</h3>

<pre><code class='language-R'>newdata_to_X(newdata, wide, intercept = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="newdata_to_X_+3A_newdata">newdata</code></td>
<td>
<p>Data frame where each row is a vector of covariate values defining an alternative focus quantity.</p>
</td></tr>
<tr><td><code id="newdata_to_X_+3A_wide">wide</code></td>
<td>
<p>Wide model which includes these covariates.</p>
</td></tr>
<tr><td><code id="newdata_to_X_+3A_intercept">intercept</code></td>
<td>
<p>Include an intercept as the first column.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Numeric values can be supplied for factor levels that are character strings denoting numbers (like <code>"1"</code> or <code>"2"</code>).
</p>


<h3>Value</h3>

<p>&quot;Design&quot; matrix of covariate values defining alternative focuses, with factors expanded to their contrasts.  This is in the form required by the <code>X</code> argument of <code><a href="#topic+fic">fic</a></code>, with one row per alternative focus. The columns correspond to coefficients in a linear-type model.  For the built-in focus functions such as <code><a href="#topic+mean_normal">mean_normal</a></code> and <code><a href="#topic+prob_logistic">prob_logistic</a></code>, these coefficients include an intercept, but user-written focuses may be written in such a way as not to require an intercept (as in the example in the &quot;skew normal&quot; vignette).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>bwt.glm &lt;- glm(low ~ lwtkg + age + smoke + ftv, data=birthwt, family="binomial")
newdata &lt;- data.frame(lwtkg=1, age=60, smoke=0, ftv="2+")
newdata_to_X(newdata, bwt.glm)

## See the Cox regression section of the main package vignette for another example.

</code></pre>

<hr>
<h2 id='plot.fic'>Plot focused model comparison statistics: base graphics method</h2><span id='topic+plot.fic'></span>

<h3>Description</h3>

<p>Plot focused model comparison statistics: base graphics method
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'fic'
plot(x, ci = TRUE, xlab = NULL, ylab = NULL, xlim = NULL,
  ylim = NULL, pch = 19, mfrow = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.fic_+3A_x">x</code></td>
<td>
<p>Output from <code><a href="#topic+fic">fic</a></code>.</p>
</td></tr>
<tr><td><code id="plot.fic_+3A_ci">ci</code></td>
<td>
<p>Plot interval estimates? (<code>TRUE</code> or <code>FALSE</code>).  These are calculated as plus / minus twice the standard error of the submodel focus under the wide model.  These are rough estimates of uncertainty intended to illustrate the bias-variance tradeoff, and exclude any uncertainty associated with the choice between models.</p>
</td></tr>
<tr><td><code id="plot.fic_+3A_xlab">xlab</code></td>
<td>
<p>x-axis label.</p>
</td></tr>
<tr><td><code id="plot.fic_+3A_ylab">ylab</code></td>
<td>
<p>y-axis label.</p>
</td></tr>
<tr><td><code id="plot.fic_+3A_xlim">xlim</code></td>
<td>
<p>x-axis limits (pair of numbers)</p>
</td></tr>
<tr><td><code id="plot.fic_+3A_ylim">ylim</code></td>
<td>
<p>y-axis limits</p>
</td></tr>
<tr><td><code id="plot.fic_+3A_pch">pch</code></td>
<td>
<p>Plot point character, by default 19 (solid circle).</p>
</td></tr>
<tr><td><code id="plot.fic_+3A_mfrow">mfrow</code></td>
<td>
<p>Vector of two numbers giving the number of rows and number of columns respectively in the plot grid, if there are multiple focuses.</p>
</td></tr>
<tr><td><code id="plot.fic_+3A_...">...</code></td>
<td>
<p>Other options to pass to <code><a href="base.html#topic+plot">plot</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If the focus estimates are available, then the focus estimates are
plotted against the root MSE.  One plot is made for each covariate
value defining different focuses.  If the wide model estimate is
available, this is illustrated as a solid line on the plot, and if
the narrow model estimate is available, this is shown as a dashed
line.
</p>
<p>If the focus estimates are unavailable, then the standard errors
of the focus estimate are plotted against the corresponding bias.
The plot points are shaded with darkness proportional to the RMSE,
with the point of maximum RMSE in black.
</p>
<p>The <span class="pkg">ggplot2</span>-based plot method, <code><a href="#topic+ggplot_fic">ggplot_fic</a></code>, is
slightly nicer.
</p>


<h3>See Also</h3>

<p>ggplot_fic, summary.fic
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Example from the main vignette, see there for more details

wide.glm &lt;- glm(low ~ lwtkg + age + smoke + ht + ui + smokeage + smokeui,
                data=birthwt, family=binomial)
vals.smoke &lt;-    c(1, 58.24, 22.95, 1, 0, 0, 22.95, 0)
vals.nonsmoke &lt;- c(1, 59.50, 23.43, 0, 0, 0, 0, 0)
X &lt;- rbind("Smokers" = vals.smoke, "Non-smokers" = vals.nonsmoke)
inds0 &lt;- c(1,1,0,0,0,0,0,0)
combs &lt;- all_inds(wide.glm, inds0)
ficres &lt;- fic(wide = wide.glm, inds = combs, inds0 = inds0,
              focus = prob_logistic, X = X)
plot(ficres)

</code></pre>

<hr>
<h2 id='summary.fic'>Summarise focused model comparison results</h2><span id='topic+summary.fic'></span>

<h3>Description</h3>

<p>Summarise focused model comparison results
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'fic'
summary(object, tidy = TRUE, adj = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.fic_+3A_object">object</code></td>
<td>
<p>Object returned by <code><a href="#topic+fic">fic</a></code> representing focused model comparison statistics for a range of models, and potentially also multiple focus quantities.</p>
</td></tr>
<tr><td><code id="summary.fic_+3A_tidy">tidy</code></td>
<td>
<p>If <code>TRUE</code> (the default) then the results describing the optimal model (per focus) are returned as a data frame, with the names of the parameters in the optimal model collapsed into a single string.  If <code>FALSE</code>, the results are returned as a list, including a vector of parameter names.</p>
</td></tr>
<tr><td><code id="summary.fic_+3A_adj">adj</code></td>
<td>
<p>The optimal model is the one with the lowest root mean square error (RMSE). If <code>adj=TRUE</code> the RMSE is based on the adjusted bias estimator.  Otherwise the standard estimator is used.</p>
</td></tr>
<tr><td><code id="summary.fic_+3A_...">...</code></td>
<td>
<p>Other arguments, currently unused.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of two components, one for the optimal model per focus, and one for the range of focus and RMSE estimates over models.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ggplot_fic">ggplot_fic</a></code>, <code><a href="#topic+plot.fic">plot.fic</a></code> for a more detailed visual representation of the focused comparison
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Example from the main vignette, see there for more details

wide.glm &lt;- glm(low ~ lwtkg + age + smoke + ht + ui + smokeage + smokeui,
                data=birthwt, family=binomial)
vals.smoke &lt;-    c(1, 58.24, 22.95, 1, 0, 0, 22.95, 0)
vals.nonsmoke &lt;- c(1, 59.50, 23.43, 0, 0, 0, 0, 0)
X &lt;- rbind("Smokers" = vals.smoke, "Non-smokers" = vals.nonsmoke)
inds0 &lt;- c(1,1,0,0,0,0,0,0)
combs &lt;- all_inds(wide.glm, inds0)
ficres &lt;- fic(wide = wide.glm, inds = combs, inds0 = inds0,
              focus = prob_logistic, X = X)
ggplot_fic(ficres)
summary(ficres)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
