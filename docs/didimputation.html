<!DOCTYPE html><html lang="en"><head><title>Help for package didimputation</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {didimputation}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#+25+26gt+3B+25'><p>Pipe operator</p></a></li>
<li><a href='#df_het'><p>Simulated data with two treatment groups and heterogenous effects</p></a></li>
<li><a href='#df_hom'><p>Simulated data with two treatment groups and homogenous effects</p></a></li>
<li><a href='#did_imputation'><p>Borusyak, Jaravel, and Spiess (2021) Estimator</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Imputation Estimator from Borusyak, Jaravel, and Spiess (2021)</td>
</tr>
<tr>
<td>Version:</td>
<td>0.3.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Estimates Two-way Fixed Effects difference-in-differences/event-study models using the imputation-based approach proposed by Borusyak, Jaravel, and Spiess (2021).</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.1</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10), fixest (&ge; 0.10.0), data.table (&ge; 1.10.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>Matrix, magrittr, Rcpp, broom, dplyr, glue, stringr, purrr,
tidyr</td>
</tr>
<tr>
<td>Suggests:</td>
<td>haven, testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-08-25 19:31:28 UTC; kylebutts</td>
</tr>
<tr>
<td>Author:</td>
<td>Kyle Butts <a href="https://orcid.org/0000-0002-9048-8059"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Kyle Butts &lt;kyle.butts@colorado.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-08-25 20:02:33 UTC</td>
</tr>
</table>
<hr>
<h2 id='+25+26gt+3B+25'>Pipe operator</h2><span id='topic++25+3E+25'></span>

<h3>Description</h3>

<p>See <code>magrittr::<a href="magrittr.html#topic+pipe">%&gt;%</a></code> for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lhs %&gt;% rhs
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="+2B25+2B26gt+2B3B+2B25_+3A_lhs">lhs</code></td>
<td>
<p>A value or the magrittr placeholder.</p>
</td></tr>
<tr><td><code id="+2B25+2B26gt+2B3B+2B25_+3A_rhs">rhs</code></td>
<td>
<p>A function call using the magrittr semantics.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The result of calling <code>rhs(lhs)</code>.
</p>

<hr>
<h2 id='df_het'>Simulated data with two treatment groups and heterogenous effects</h2><span id='topic+df_het'></span>

<h3>Description</h3>

<p>Generated using the following call:
<code>did2s::gen_data(panel = c(1990, 2020),
  g1 = 2000, g2 = 2010, g3 = 0,
  te1 = 2, te2 = 1, te3 = 0,
  te_m1 = 0.05, te_m2 = 0.15, te_m3 = 0)</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>df_het
</code></pre>


<h3>Format</h3>

<p>A data frame with 31000 rows and 15 variables:
</p>

<dl>
<dt>unit</dt><dd><p>individual in panel data</p>
</dd>
<dt>year</dt><dd><p>time in panel data</p>
</dd>
<dt>g</dt><dd><p>the year that treatment starts</p>
</dd>
<dt>dep_var</dt><dd><p>outcome variable</p>
</dd>
<dt>treat</dt><dd><p>T/F variable for when treatment is on</p>
</dd>
<dt>rel_year</dt><dd><p>year relative to treatment start. Inf = never treated.</p>
</dd>
<dt>rel_year_binned</dt><dd><p>year relative to treatment start, but &lt;=-6 and &gt;=6
are binned.</p>
</dd>
<dt>unit_fe</dt><dd><p>Unit FE</p>
</dd>
<dt>year_fe</dt><dd><p>Year FE</p>
</dd>
<dt>error</dt><dd><p>Random error component</p>
</dd>
<dt>te</dt><dd><p>Static treatment effect = te</p>
</dd>
<dt>te_dynamic</dt><dd><p>Dynamic treatmet effect = te_m</p>
</dd>
<dt>state</dt><dd><p>State that unit is in</p>
</dd>
<dt>group</dt><dd><p>String name for group</p>
</dd>
</dl>


<hr>
<h2 id='df_hom'>Simulated data with two treatment groups and homogenous effects</h2><span id='topic+df_hom'></span>

<h3>Description</h3>

<p>Generated using the following call:
<code>did2s::gen_data(panel = c(1990, 2020),
  g1 = 2000, g2 = 2010, g3 = 0,
  te1 = 2, te2 = 2, te3 = 0,
  te_m1 = 0, te_m2 = 0, te_m3 = 0)</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>df_hom
</code></pre>


<h3>Format</h3>

<p>A data frame with 31000 rows and 15 variables:
</p>

<dl>
<dt>unit</dt><dd><p>individual in panel data</p>
</dd>
<dt>year</dt><dd><p>time in panel data</p>
</dd>
<dt>g</dt><dd><p>the year that treatment starts</p>
</dd>
<dt>dep_var</dt><dd><p>outcome variable</p>
</dd>
<dt>treat</dt><dd><p>T/F variable for when treatment is on</p>
</dd>
<dt>rel_year</dt><dd><p>year relative to treatment start. Inf = never treated.</p>
</dd>
<dt>rel_year_binned</dt><dd><p>year relative to treatment start, but &lt;=-6 and &gt;=6
are binned.</p>
</dd>
<dt>unit_fe</dt><dd><p>Unit FE</p>
</dd>
<dt>year_fe</dt><dd><p>Year FE</p>
</dd>
<dt>error</dt><dd><p>Random error component</p>
</dd>
<dt>te</dt><dd><p>Static treatment effect = te</p>
</dd>
<dt>te_dynamic</dt><dd><p>Dynamic treatmet effect = te_m</p>
</dd>
<dt>group</dt><dd><p>String name for group</p>
</dd>
<dt>state</dt><dd><p>State that unit is in</p>
</dd>
<dt>weight</dt><dd><p>Weight from runif()</p>
</dd>
</dl>


<hr>
<h2 id='did_imputation'>Borusyak, Jaravel, and Spiess (2021) Estimator</h2><span id='topic+did_imputation'></span>

<h3>Description</h3>

<p>Treatment effect estimation and pre-trend testing in staggered adoption
diff-in-diff designs with an imputation approach of Borusyak, Jaravel, and
Spiess (2021)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>did_imputation(
  data,
  yname,
  gname,
  tname,
  idname,
  first_stage = NULL,
  wname = NULL,
  wtr = NULL,
  horizon = NULL,
  pretrends = NULL,
  cluster_var = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="did_imputation_+3A_data">data</code></td>
<td>
<p>A <code>data.frame</code></p>
</td></tr>
<tr><td><code id="did_imputation_+3A_yname">yname</code></td>
<td>
<p>String. Variable name for outcome. Use <code>fixest</code> c() syntax
for multiple lhs.</p>
</td></tr>
<tr><td><code id="did_imputation_+3A_gname">gname</code></td>
<td>
<p>String. Variable name for unit-specific date of treatment
(never-treated should be zero or <code>NA</code>).</p>
</td></tr>
<tr><td><code id="did_imputation_+3A_tname">tname</code></td>
<td>
<p>String. Variable name for calendar period.</p>
</td></tr>
<tr><td><code id="did_imputation_+3A_idname">idname</code></td>
<td>
<p>String. Variable name for unique unit id.</p>
</td></tr>
<tr><td><code id="did_imputation_+3A_first_stage">first_stage</code></td>
<td>
<p>Formula for Y(0).
Formula following <code><a href="fixest.html#topic+feols">fixest::feols</a></code>.
Fixed effects specified after &quot;<code>|</code>&quot;.
If not specified, then just unit and time fixed effects will be used.</p>
</td></tr>
<tr><td><code id="did_imputation_+3A_wname">wname</code></td>
<td>
<p>String. Variable name for estimation weights of observations.
This is used in estimating Y(0) and also augments treatment effect weights.</p>
</td></tr>
<tr><td><code id="did_imputation_+3A_wtr">wtr</code></td>
<td>
<p>Character vector of treatment weight names
(see horizon for standard static and event-study weights)</p>
</td></tr>
<tr><td><code id="did_imputation_+3A_horizon">horizon</code></td>
<td>
<p>Integer vector of event_time or <code>TRUE</code>. This only applies if <code>wtr</code> is left
as <code>NULL</code>. if specified, weighted averages/sums of treatment effects will be
reported for each of these horizons separately (i.e. tau0 for the treatment
period, tau1 for one period after treatment, etc.).
If <code>TRUE</code>, all horizons are used.
If <code>wtr</code> and <code>horizon</code> are null, then the static treatment effect is calculated.</p>
</td></tr>
<tr><td><code id="did_imputation_+3A_pretrends">pretrends</code></td>
<td>
<p>Integer vector or <code>TRUE</code>. Which pretrends to estimate.
If <code>TRUE</code>, all <code>pretrends</code> are used.</p>
</td></tr>
<tr><td><code id="did_imputation_+3A_cluster_var">cluster_var</code></td>
<td>
<p>String. Varaible name for clustering groups. If not
supplied, then <code>idname</code> is used as default.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The imputation-based estimator is a method of calculating treatment effects
in a difference-in-differences framework. The method estimates a model for
Y(0) using untreated/not-yet-treated observations and predicts Y(0) for the
treated observations hat(Y_it(0)). The difference between treated and
predicted untreated outcomes Y_it(1) - hat(Y_it(0)) serves as an estimate
for the treatment effect for unit i in period t. These are then averaged to
form average treatment effects for groups of it.
</p>


<h3>Value</h3>

<p>A <code>data.frame</code> containing treatment effect term, estimate, standard
error and confidence interval. This is in <code>tidy</code> format.
</p>


<h3>Examples</h3>

<p>Load example dataset which has two treatment groups and homogeneous treatment effects
</p>
<div class="sourceCode r"><pre># Load Example Dataset
data("df_hom", package="did2s")
</pre></div>


<h4>Static TWFE</h4>

<p>You can run a static TWFE fixed effect model for a simple treatment indicator
</p>
<div class="sourceCode r"><pre>did_imputation(data = df_hom, yname = "dep_var", gname = "g",
               tname = "year", idname = "unit")
#&gt; # A tibble: 1 x 6
#&gt;   lhs     term  estimate std.error conf.low conf.high
#&gt;   &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
#&gt; 1 dep_var treat     2.00    0.0182     1.97      2.04
</pre></div>



<h4>Event Study</h4>

<p>Or you can use relative-treatment indicators to estimate an event study estimate
</p>
<div class="sourceCode r"><pre>did_imputation(data = df_hom, yname = "dep_var", gname = "g",
               tname = "year", idname = "unit", horizon=TRUE)
#&gt; # A tibble: 21 x 6
#&gt;    lhs     term  estimate std.error conf.low conf.high
#&gt;    &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
#&gt;  1 dep_var 0         1.97    0.0425     1.89      2.05
#&gt;  2 dep_var 1         2.05    0.0434     1.97      2.14
#&gt;  3 dep_var 2         2.03    0.0432     1.95      2.12
#&gt;  4 dep_var 3         1.97    0.0428     1.88      2.05
#&gt;  5 dep_var 4         1.97    0.0420     1.88      2.05
#&gt;  6 dep_var 5         2.03    0.0423     1.95      2.11
#&gt;  7 dep_var 6         2.04    0.0450     1.95      2.13
#&gt;  8 dep_var 7         2.00    0.0437     1.91      2.08
#&gt;  9 dep_var 8         2.02    0.0440     1.93      2.10
#&gt; 10 dep_var 9         1.96    0.0440     1.87      2.04
#&gt; # ... with 11 more rows
</pre></div>



<h4>Example from Cheng and Hoekstra (2013)</h4>

<p>Here's an example using data from Cheng and Hoekstra (2013)
</p>
<div class="sourceCode r"><pre># Castle Data
castle &lt;- haven::read_dta("https://github.com/scunning1975/mixtape/raw/master/castle.dta")

did_imputation(data = castle, yname = "c(l_homicide, l_assault)", gname = "effyear",
              first_stage = ~ 0 | sid + year,
              tname = "year", idname = "sid")
#&gt; # A tibble: 2 x 6
#&gt;   lhs        term  estimate std.error conf.low conf.high
#&gt;   &lt;chr&gt;      &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
#&gt; 1 l_homicide treat   0.0798    0.0609  -0.0395     0.199
#&gt; 2 l_assault  treat   0.0496    0.0513  -0.0510     0.150
</pre></div>


</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
