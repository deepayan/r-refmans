<!DOCTYPE html><html><head><title>Help for package wnl</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {wnl}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#wnl-package'><p>Minimization Tool for Pharmacokinetic-Pharmacodynamic Data Analysis</p></a></li>
<li><a href='#BasicUtil'><p>Internal Functions</p></a></li>
<li><a href='#cmpChi'><p>Compare model with Chi-square test</p></a></li>
<li><a href='#Comp1'><p>One compartment model - analytical</p></a></li>
<li><a href='#DAT'>
<p>An Example of Dosing History Table</p></a></li>
<li><a href='#dx'><p>Simplest diagnostic plot for minimization result</p></a></li>
<li><a href='#e'><p>environment for internal data</p></a></li>
<li><a href='#EnvObj'><p>Environment's Objects</p></a></li>
<li><a href='#ExpandDH'><p>Expand Dosing History Table</p></a></li>
<li><a href='#hSkew'><p>Hougaard Measure of Skewness</p></a></li>
<li><a href='#nComp'><p>Get Amounts of Each Compartments using Lambdas and Coefficients of Multi-compartment Model</p></a></li>
<li><a href='#nlr'><p>Nonlinear Regression in R</p></a></li>
<li><a href='#Objs'><p>Internal Obj Functions</p></a></li>
<li><a href='#pComp'><p>Plot Compartment Model Diagram</p></a></li>
<li><a href='#pProf'><p>Plot Likelihood or Objective Fnnction Value Profile</p></a></li>
<li><a href='#Secondary'><p>Get Secondary Parameter Estimates</p></a></li>
<li><a href='#SolComp2'><p>Get Lambdas and Coefficients of Two-compartment Model</p></a></li>
<li><a href='#SolComp3'><p>Get Lambdas and Coefficients of Three-compartment Model</p></a></li>
<li><a href='#wnl5'><p>Old type WinNonlin - Least Square not MLE</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Version:</td>
<td>0.8.0</td>
</tr>
<tr>
<td>Title:</td>
<td>Minimization Tool for Pharmacokinetic-Pharmacodynamic Data
Analysis</td>
</tr>
<tr>
<td>Description:</td>
<td>This is a set of minimization tools (maximum likelihood estimation and least square fitting) to solve examples in the Johan Gabrielsson and Dan Weiner's book "Pharmacokinetic and Pharmacodynamic Data Analysis - Concepts and Applications" 5th ed. (ISBN:9198299107). Examples include linear and nonlinear compartmental model, turn-over model, single or multiple dosing bolus/infusion/oral models, allometry, toxicokinetics, reversible metabolism, in-vitro/in-vivo extrapolation, enterohepatic circulation, metabolite modeling, Emax model, inhibitory model, tolerance model, oscillating response model, enantiomer interaction model, effect compartment model, drug-drug interaction model, receptor occupancy model, and rebound phenomena model. </td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0), numDeriv</td>
</tr>
<tr>
<td>Author:</td>
<td>Kyun-Seop Bae [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Kyun-Seop Bae &lt;k@acr.kr&gt;</td>
</tr>
<tr>
<td>Copyright:</td>
<td>2017-, Kyun-Seop Bae</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://cran.r-project.org/package=wnl">https://cran.r-project.org/package=wnl</a></td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-02-22 05:56:36 UTC; Kyun-SeopBae</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-02-22 06:20:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='wnl-package'>Minimization Tool for Pharmacokinetic-Pharmacodynamic Data Analysis</h2><span id='topic+wnl-package'></span><span id='topic+wnl'></span>

<h3>Description</h3>

<p>This is a minimization tool to solve the examples in the book Gabrielsson J, Weiner D. 'Pharmacokinetic and Pharmacodynamic Data Analysis - Concepts and Applications' 5th ed. 2016. (ISBN:9198299107).</p>


<h3>Details</h3>

<p>This is a set of minimization tools to solve all the examples in the book 'Pharmacokinetic and Pharmacodynamic Data Analysis - Concepts and Applications' 5th ed. 2016.
</p>


<h3>Author(s)</h3>

<p>Kyun-Seop Bae &lt;k@acr.kr&gt;</p>


<h3>References</h3>

<p>Gabrielsson J, Weiner D. Pharmacokinetic and Pharmacodynamic Data Analysis - Concepts and Applications. 5th ed. 2016.</p>


<h3>Examples</h3>

<pre><code class='language-R'>tData = Theoph
colnames(tData) = c("ID", "BWT", "DOSE", "TIME", "DV")

fPK = function(THETA)     # Prediction function
{
  DOSE = 320000           # in microgram
  TIME = e$DATA[,"TIME"]  # use data in e$DATA

  K    = THETA[1]
  Ka   = THETA[2]
  V    = THETA[3]

  Cp   = DOSE/V*Ka/(Ka - K)*(exp(-K*TIME) - exp(-Ka*TIME))
  return(Cp)
}

IDs = unique(tData[,"ID"])
nID = length(IDs)
for (i in 1:nID) {
  Data = tData[tData$ID == IDs[i],]
  Res = nlr(fPK, Data, pNames=c("k", "ka", "V"), IE=c(0.1, 3, 500), 
            SecNames=c("CL", "Thalf", "MRT"), SecForms=c(~V*k, ~log(2)/k, ~1/k))
  print(paste("## ID =", i, "##"))
  print(Res)
}
</code></pre>

<hr>
<h2 id='BasicUtil'>Internal Functions</h2><span id='topic+s2o'></span><span id='topic+prun'></span><span id='topic+run.test'></span><span id='topic+nGradient'></span><span id='topic+nHessian'></span><span id='topic+g2inv'></span><span id='topic+Hougaard'></span>

<h3>Description</h3>

<p>Internal functions</p>


<h3>Details</h3>

<p>These are not to be called by the user.</p>

<hr>
<h2 id='cmpChi'>Compare model with Chi-square test</h2><span id='topic+cmpChi'></span>

<h3>Description</h3>

<p>It performs chi-square test for two models comparison.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cmpChi(r1, r2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cmpChi_+3A_r1">r1</code></td>
<td>
<p>A result from <code>nlr</code></p>
</td></tr>
<tr><td><code id="cmpChi_+3A_r2">r2</code></td>
<td>
<p>Another result from <code>nlr</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>One model should include the other model.
</p>


<h3>Value</h3>

<p>Returns a p-value from <code>pchisq</code>
</p>


<h3>Author(s)</h3>

<p>Kyun-Seop Bae &lt;k@acr.kr&gt;</p>

<hr>
<h2 id='Comp1'>One compartment model - analytical</h2><span id='topic+Comp1'></span>

<h3>Description</h3>

<p>It calculates using one compartment model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Comp1(Ke, Ka=0, DH)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Comp1_+3A_ke">Ke</code></td>
<td>
<p>Elimination rate constant</p>
</td></tr>
<tr><td><code id="Comp1_+3A_ka">Ka</code></td>
<td>
<p>Absorption rate constant</p>
</td></tr>
<tr><td><code id="Comp1_+3A_dh">DH</code></td>
<td>
<p>Expanded dosing history table</p>
</td></tr>
</table>


<h3>Details</h3>

<p>First compartment is the gut compartment for oral dosing. IV bolus and infusion dosing should be done at the second compartment.
</p>


<h3>Value</h3>

<p>This returns a table with the gut and the central compartment columns
</p>


<h3>Author(s)</h3>

<p>Kyun-Seop Bae &lt;k@acr.kr&gt;</p>


<h3>Examples</h3>

<pre><code class='language-R'>DAT
DAT2 = ExpandDH(DAT)
X1 = Comp1(Ke=0.1, Ka=1, DAT2)
X1
matplot(DAT2[, "TIME"], X1, type="l")
</code></pre>

<hr>
<h2 id='DAT'>
An Example of Dosing History Table
</h2><span id='topic+DAT'></span>

<h3>Description</h3>

<p>This is a conventional NONMEM input data format. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>DAT</code></pre>


<h3>Format</h3>

<p>This data frame has 5 columns with 18 time-points for the simulation.
</p>

<dl>
<dt><code>TIME</code></dt><dd><p>Time</p>
</dd>
<dt><code>AMT</code></dt><dd><p>Amount given for the compartment of <code>CMT</code> column</p>
</dd>
<dt><code>RATE</code></dt><dd><p>Infusion rate</p>
</dd>
<dt><code>CMT</code></dt><dd><p>Compartment number, 1=gut, 2=central, 3=peripheral, etc.</p>
</dd>
<dt><code>DV</code></dt><dd><p>Currently blank and not used.</p>
</dd>
</dl>



<h3>Details</h3>

<p>To be used at <code>Comp1</code> or <code>nComp</code>, expand dosing history with <code>ExpandDH</code> function. 
</p>

<hr>
<h2 id='dx'>Simplest diagnostic plot for minimization result</h2><span id='topic+dx'></span>

<h3>Description</h3>

<p>It performs a simple diagnostic plot from the result of <code>nlr</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dx(r)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dx_+3A_r">r</code></td>
<td>
<p>a result from <code>nlr</code> or <code>wnl5</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>This plots 'Observation vs. Prediction' and 'Normalized Redisual vs. Prediction' only. Normalized residual are meant to be distributed as standard normal distribution, N(0, 1).
</p>


<h3>Value</h3>

<p>This just draws a plot.
</p>


<h3>Author(s)</h3>

<p>Kyun-Seop Bae &lt;k@acr.kr&gt;</p>

<hr>
<h2 id='e'>environment for internal data</h2><span id='topic+e'></span>

<h3>Description</h3>

<p>This is for the storage of intermediate data.</p>

<hr>
<h2 id='EnvObj'>Environment's Objects</h2><span id='topic+EnvObj'></span>

<h3>Description</h3>

<p>Get an environment's visible objects as a list.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  EnvObj(envir = e)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="EnvObj_+3A_envir">envir</code></td>
<td>
<p>environment to get its content</p>
</td></tr>
</table>


<h3>Details</h3>

<p>All the visible objects in the environment including functions and data will be returned.
</p>


<h3>Value</h3>

<p>All visible objects as a list
</p>


<h3>Author(s)</h3>

<p>Kyun-Seop Bae &lt;k@acr.kr&gt;</p>

<hr>
<h2 id='ExpandDH'>Expand Dosing History Table</h2><span id='topic+ExpandDH'></span>

<h3>Description</h3>

<p>It expands dosing history table.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ExpandDH(DH, Fo = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ExpandDH_+3A_dh">DH</code></td>
<td>
<p>Dosing history table of NONMEM type</p>
</td></tr>
<tr><td><code id="ExpandDH_+3A_fo">Fo</code></td>
<td>
<p>Bioavailability of the first (gut) compartment</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It expands dosing history table of conventional NONMEM data format. It calculate bioavailable amount, then add time points of non-differentiable, e.g. stopping points of infusion. 
</p>


<h3>Value</h3>

<p>Returns expanded dosing history table.
</p>


<h3>Author(s)</h3>

<p>Kyun-Seop Bae &lt;k@acr.kr&gt;</p>


<h3>Examples</h3>

<pre><code class='language-R'>DAT
ExpandDH(DAT) # One observation point is increased at the time of 27.
</code></pre>

<hr>
<h2 id='hSkew'>Hougaard Measure of Skewness</h2><span id='topic+hSkew'></span>

<h3>Description</h3>

<p>Hougaard measure of skewness with nonlinear regression
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  hSkew(rx)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hSkew_+3A_rx">rx</code></td>
<td>
<p>a result of nls function</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Hougaard measure of skewness can be used to check if the parameters of nonlinear regression behavior in linear fashion, i.e. symmetric confidence interval. Be cautious on the variable name conflict. All the variables in the nonlinear function should be able to be accessed by the function.
</p>


<h3>Value</h3>

<p>Hougaard estimate of skewness for each parameter
</p>
<table>
<tr><td><code>(0</code>, <code>0.1]</code></td>
<td>
<p>The estimate is very close-to-linear in behavior.</p>
</td></tr>
<tr><td><code>(0.1</code>, <code>0.25]</code></td>
<td>
<p>The estimate is reasonably close-to-linear in behavior.</p>
</td></tr>
<tr><td><code>(0.25</code>, <code>1]</code></td>
<td>
<p>The skweness is apparent.</p>
</td></tr>
<tr><td><code>&gt;1</code></td>
<td>
<p>The estimate is considerably nonlinear in behavior.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Kyun-Seop Bae k@acr.kr</p>


<h3>References</h3>

<p>EL-Shehawy SA. On Calculating the Hougaard Measure of Skewness in a Nonlinear Regression Model with Two Parameters. J Math &amp; Stat. 2009;5(4):360-364.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  r1 = nls(density ~ b1*conc/(b2 + conc), DNase[DNase$Run == 1, ], start=list(b1=3, b2=5))
  hSkew(r1)
</code></pre>

<hr>
<h2 id='nComp'>Get Amounts of Each Compartments using Lambdas and Coefficients of Multi-compartment Model</h2><span id='topic+nComp'></span>

<h3>Description</h3>

<p>It calculates using multi-compartment model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nComp(Sol, Ka=0, DH)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nComp_+3A_sol">Sol</code></td>
<td>
<p>Solution list of lambdas and coefficients</p>
</td></tr>
<tr><td><code id="nComp_+3A_ka">Ka</code></td>
<td>
<p>Absorption rate constant</p>
</td></tr>
<tr><td><code id="nComp_+3A_dh">DH</code></td>
<td>
<p>Expanded dosing history table</p>
</td></tr>
</table>


<h3>Details</h3>

<p>First compartment is the gut compartment for oral dosing. IV bolus and infusion dosing should be done at the second compartment.
If a bolus dose was given at time T, it is reflected at times of larger than T. This is more close to real observation. ADAPT does like this, but NONMEM does not.
</p>


<h3>Value</h3>

<p>This returns a table with the gut and the other compartment columns
</p>


<h3>Author(s)</h3>

<p>Kyun-Seop Bae &lt;k@acr.kr&gt;</p>


<h3>Examples</h3>

<pre><code class='language-R'>DAT
DAT2 = ExpandDH(DAT)
Sol = SolComp2(K10=0.1, K12=3, K21=1)
X2 = nComp(Sol, Ka=1, DAT2)
X2
matplot(DAT2[, "TIME"], X2, type="l")
</code></pre>

<hr>
<h2 id='nlr'>Nonlinear Regression in R</h2><span id='topic+nlr'></span>

<h3>Description</h3>

<p>It performs nonlinear regression usually for pharmacokinetic and pharmacodynamic models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nlr(Fx, Data, pNames, IE, LB, UB, Error="A", ObjFx=ObjDef, SecNames, SecForms, 
    Method="L-BFGS-B", Sx, conf.level=0.95, k, fix=0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nlr_+3A_fx">Fx</code></td>
<td>
<p>Function for structural model. It should return a vector of the same length to observations.</p>
</td></tr>
<tr><td><code id="nlr_+3A_data">Data</code></td>
<td>
<p>Data table which will be used in Fx. Fx should access this with <code>e$DATA</code>.</p>
</td></tr>
<tr><td><code id="nlr_+3A_pnames">pNames</code></td>
<td>
<p>Parameter names in the order of Fx arguments</p>
</td></tr>
<tr><td><code id="nlr_+3A_ie">IE</code></td>
<td>
<p>Initial estimates of parameters</p>
</td></tr>
<tr><td><code id="nlr_+3A_lb">LB</code></td>
<td>
<p>Lower bound for <code>optim</code> function. The default value is 0.</p>
</td></tr>
<tr><td><code id="nlr_+3A_ub">UB</code></td>
<td>
<p>Upper bound for <code>optim</code> function. The default value is 1e+06.</p>
</td></tr>
<tr><td><code id="nlr_+3A_error">Error</code></td>
<td>
<p>Error model. One of <code>"A"</code> for additive error, <code>"POIS"</code> for Poisson error, <code>"P"</code> for proportional error, <code>"C"</code> for combined error model, <code>"S"</code> for general error model. With Error=&quot;S&quot;, <code>Sx</code> should be provieded.</p>
</td></tr>
<tr><td><code id="nlr_+3A_objfx">ObjFx</code></td>
<td>
<p>Objective function to be minimized. The default is maximum likelihood estimation function(-2 log likelihood).</p>
</td></tr>
<tr><td><code id="nlr_+3A_secnames">SecNames</code></td>
<td>
<p>Names of secondary parameter estimates</p>
</td></tr>
<tr><td><code id="nlr_+3A_secforms">SecForms</code></td>
<td>
<p>Formula to calculate the secondary parameter estimates</p>
</td></tr>
<tr><td><code id="nlr_+3A_method">Method</code></td>
<td>
<p><code>"L-BFGS-B"</code> is default. See <code>optim</code> for more detail.</p>
</td></tr>
<tr><td><code id="nlr_+3A_sx">Sx</code></td>
<td>
<p>Scale function. This is usually the inverse of weight. It should return the same length(nrow) of Y. When Error=&quot;S&quot;, Scale function should be provided as <code>Sx</code>.</p>
</td></tr>
<tr><td><code id="nlr_+3A_conf.level">conf.level</code></td>
<td>
<p>Confidence level for confidence interval</p>
</td></tr>
<tr><td><code id="nlr_+3A_k">k</code></td>
<td>
<p>1/k likelihood interval(LI) will be provided. Currently recommended value is exp(qf(1 - alpha, 1, nRec-nPara)/2) + 1.</p>
</td></tr>
<tr><td><code id="nlr_+3A_fix">fix</code></td>
<td>
<p>indices of parameters to fix</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This uses scaled transformed parameters and environment <code>e</code> internally.
</p>


<h3>Value</h3>

<table>
<tr><td><code>Est</code></td>
<td>
<p>Point estimate(PE) with standard error(SE) and relative standard error(RSE)</p>
</td></tr>
<tr><td><code>LI</code></td>
<td>
<p>1/k likelihood interval, at which likelihood drops to 1/k of maximum likelihood. This reflects asymmetry better than confidence interval. This is estimated likelihood interval, not profile likelihood interval.</p>
</td></tr>
<tr><td><code>Skewness</code></td>
<td>
<p>Hougaard's skewness measure. This is printed only with additive error model. See also <code>hSkew</code></p>
</td></tr>
<tr><td><code>Cov</code></td>
<td>
<p>Variance-covariance matrix of the objective function at the value of point estimates</p>
</td></tr>
<tr><td><code>run$m</code></td>
<td>
<p>Count of positive residuals</p>
</td></tr>
<tr><td><code>run$n</code></td>
<td>
<p>Count of negative residuals</p>
</td></tr>
<tr><td><code>run$run</code></td>
<td>
<p>Count of runs of residuals</p>
</td></tr>
<tr><td><code>run$p.value</code></td>
<td>
<p>P value of run test with excluding zero points</p>
</td></tr>
<tr><td><code>Objective Function Value</code></td>
<td>
<p>Minimum value of the objective function</p>
</td></tr>
<tr><td><code>-2LL</code></td>
<td>
<p>-2 times log likelihood</p>
</td></tr>
<tr><td><code>AIC</code></td>
<td>
<p>Akaike Information Criterion</p>
</td></tr>
<tr><td><code>AICc</code></td>
<td>
<p>Corrected Akaike Information Criterion</p>
</td></tr>
<tr><td><code>BIC</code></td>
<td>
<p>Schwarz Bayesian Information Criterion</p>
</td></tr>
<tr><td><code>Convergence</code></td>
<td>
<p>Convergence code from <code>optim</code></p>
</td></tr>
<tr><td><code>Message</code></td>
<td>
<p>Message from <code>optim</code>.</p>
</td></tr>
<tr><td><code>Prediction</code></td>
<td>
<p>Fitted(predicted) values</p>
</td></tr>
<tr><td><code>Residuals</code></td>
<td>
<p>Residuals</p>
</td></tr>
<tr><td><code>Scale</code></td>
<td>
<p>Scales with Error=&quot;S&quot;. Variances for each points are scale vector multiplied by <code>ScaleErrVar</code> in <code>Est</code>.</p>
</td></tr>
<tr><td><code>Elapsed Time</code></td>
<td>
<p>Consumed time by minimization</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Kyun-Seop Bae &lt;k@acr.kr&gt;</p>


<h3>Examples</h3>

<pre><code class='language-R'>  tData = Theoph
  colnames(tData) = c("ID", "BWT", "DOSE", "TIME", "DV")

  fPK = function(THETA) # Prediction function
  {
    DOSE = 320000 # in microgram
    TIME = e$DATA[, "TIME"] # use data in e$DATA

    K    = THETA[1]
    Ka   = THETA[2]
    V    = THETA[3]

    P  = DOSE/V*Ka/(Ka - K) * (exp(-K*TIME) - exp(-Ka*TIME))
    return(P)
  }

  IDs = unique(tData[,"ID"])
  nID = length(IDs)
  for (i in 1:nID) {
    Data = tData[tData$ID == IDs[i],]
    Res = nlr(fPK, Data, pNames=c("k", "ka", "V"), IE=c(0.1, 3, 500), 
              SecNames=c("CL", "Thalf", "MRT"), SecForms=c(~V*k, ~log(2)/k, ~1/k))
    print(paste("## ID =", i, "##"))
    print(Res)
  }

  # Another example from radioimmunoassay(RIA)
  d1 = data.frame(conc = c(200, 100, 50, 25, 12.5, 6.25, 3.125, 0),
                  DV = c(1.78, 1.5, 1.17, 0.74, 0.51, 0.31, 0.19, 0.04))

  PRED = function(TH) TH[1] + TH[2]*d1$conc^TH[4]/(TH[3]^TH[4] + d1$conc^TH[4])
  Scale = function(TH) 1/(PRED(TH) - (TH[1] + TH[2])/2)^2

  nlr(PRED, d1, pNames=c("R0", "Rmax", "RC50", "Hill"), IE=c(0.1, 3, 50, 1), 
      Error="S", Sx=Scale)
</code></pre>

<hr>
<h2 id='Objs'>Internal Obj Functions</h2><span id='topic+ObjEst'></span><span id='topic+ObjDef'></span><span id='topic+ObjLS'></span><span id='topic+ObjNo'></span>

<h3>Description</h3>

<p>Internal Obj functions</p>


<h3>Details</h3>

<p>These are not to be called by the user.</p>

<hr>
<h2 id='pComp'>Plot Compartment Model Diagram</h2><span id='topic+pComp'></span>

<h3>Description</h3>

<p>It plots the diagrom of a comparment model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pComp(dComp, dRate, Shape="rect", Col=NA, Bx=0.3, By=0.2, Cex=1.0, Lwd=3, 
      Radius=0.3, thIn=pi/2, thOut=pi/2, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pComp_+3A_dcomp">dComp</code></td>
<td>
<p>data.frame for a compartment model. See the example.</p>
</td></tr>
<tr><td><code id="pComp_+3A_drate">dRate</code></td>
<td>
<p>data.frame for rate information. See the example.</p>
</td></tr>
<tr><td><code id="pComp_+3A_shape">Shape</code></td>
<td>
<p>rectangle or cricle</p>
</td></tr>
<tr><td><code id="pComp_+3A_col">Col</code></td>
<td>
<p>filling color</p>
</td></tr>
<tr><td><code id="pComp_+3A_bx">Bx</code></td>
<td>
<p>half width of compartment box</p>
</td></tr>
<tr><td><code id="pComp_+3A_by">By</code></td>
<td>
<p>half height of compartment box</p>
</td></tr>
<tr><td><code id="pComp_+3A_cex">Cex</code></td>
<td>
<p>character expansion</p>
</td></tr>
<tr><td><code id="pComp_+3A_lwd">Lwd</code></td>
<td>
<p>line width</p>
</td></tr>
<tr><td><code id="pComp_+3A_radius">Radius</code></td>
<td>
<p>radius of compartment circle</p>
</td></tr>
<tr><td><code id="pComp_+3A_thin">thIn</code></td>
<td>
<p>Input angle in radian</p>
</td></tr> 
<tr><td><code id="pComp_+3A_thout">thOut</code></td>
<td>
<p>Output angle in radian</p>
</td></tr>
<tr><td><code id="pComp_+3A_...">...</code></td>
<td>
<p>arguments to be passed to <code>plot</code> function</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Flow direction is from the top to bottom.
</p>


<h3>Value</h3>

<p>It plots.
</p>


<h3>Author(s)</h3>

<p>Kyun-Seop Bae &lt;k@acr.kr&gt;</p>


<h3>Examples</h3>

<pre><code class='language-R'>dA = data.frame(No = c(1, 2, 3, 4), Name=c("Gut Depot", "Skin Depot", "Central", "Peripheral"), 
                Level=c(1, 1, 2, 2), xPos=c(-0.5, 0.5, 0, 1))
dB = data.frame(From = c(1, 2, 3, 4, 3, 0, 0), To=c(3, 3, 4, 3, 5, 1, 2), 
                Name=c("KA", "KA2", "K12", "K21", "CL", "F1", "F2"))

pComp(dA, dB)
#par(oma=c(0, 0, 0, 0), mar=c(0, 0, 1, 0)) # If need, adjust margin before calling
pComp(dA, dB, "circ", main="Compartmental Model Diagram")

pComp(dA, dB, "circ", main="Compartmental Model Diagram", Col="#DDEEFF", asp=1)
</code></pre>

<hr>
<h2 id='pProf'>Plot Likelihood or Objective Fnnction Value Profile</h2><span id='topic+pProf'></span>

<h3>Description</h3>

<p>It plots estimated likelihood profile. This is not profile likelihood profile.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  pProf(Bag = e, Title = "", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pProf_+3A_bag">Bag</code></td>
<td>
<p>an environment or an object containing the objects of resultant environment e after nlr()</p>
</td></tr>
<tr><td><code id="pProf_+3A_title">Title</code></td>
<td>
<p>title for the plot</p>
</td></tr>
<tr><td><code id="pProf_+3A_...">...</code></td>
<td>
<p>arguments to pass to the plot function</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This plots likelihood profile from the result of nlr() function. Bag should contain the results of nlr().
</p>


<h3>Value</h3>

<p>No values but a plot.
</p>


<h3>Author(s)</h3>

<p>Kyun-Seop Bae &lt;k@acr.kr&gt;</p>

<hr>
<h2 id='Secondary'>Get Secondary Parameter Estimates</h2><span id='topic+Secondary'></span>

<h3>Description</h3>

<p>Get standard error and relative standard error (cv) of the secondary parameter estimate
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Secondary(Formula, PE, COV)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Secondary_+3A_formula">Formula</code></td>
<td>
<p>Formula to calculate the secondary parameter estimate</p>
</td></tr>
<tr><td><code id="Secondary_+3A_pe">PE</code></td>
<td>
<p>Point estimates of primary parameters with names</p>
</td></tr>
<tr><td><code id="Secondary_+3A_cov">COV</code></td>
<td>
<p>Variance-covariance matrix of primary estimates</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Variables within <code>Formula</code> should exist in the names of <code>PE</code> vector.
</p>


<h3>Value</h3>

<p>This returns point estimate, standard error, relative standard error of the secondary parameter estimate.
</p>


<h3>Author(s)</h3>

<p>Kyun-Seop Bae &lt;k@acr.kr&gt;</p>


<h3>Examples</h3>

<pre><code class='language-R'>tData = Theoph
colnames(tData) = c("ID", "BWT", "DOSE", "TIME", "DV") # Table requires DV column

fPK = function(THETA) # Prediction function
{
  AMT  = 320000 # in microgram
  TIME = e$DATA[,"TIME"]
  V  = THETA[1]
  K  = THETA[2]
  Ka = THETA[3]
  Cp = AMT/V*Ka/(Ka - K)*(exp(-K*TIME) - exp(-Ka*TIME))
  return(Cp)
}
Data = tData[tData$ID == 1,]
Res = nlr(fPK, Data, pNames=c("V", "K", "Ka"), IE=c(30000, 0.1, 2))
Secondary(~V*K, Res$Est["PE",1:e$nPara], Res$Cov)
</code></pre>

<hr>
<h2 id='SolComp2'>Get Lambdas and Coefficients of Two-compartment Model</h2><span id='topic+SolComp2'></span>

<h3>Description</h3>

<p>It calculates lambdas and coefficients for two-compartment model from K10, K12, and K21.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SolComp2(K10, K12, K21)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SolComp2_+3A_k10">K10</code></td>
<td>
<p>Ke, Elimination rate constant from central compartment</p>
</td></tr>
<tr><td><code id="SolComp2_+3A_k12">K12</code></td>
<td>
<p>Rate constant from the central to the peripheral compartment</p>
</td></tr>
<tr><td><code id="SolComp2_+3A_k21">K21</code></td>
<td>
<p>Rate constant from the peripheral to the central compartment</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It calculates lambdas and coefficients of two-compartment model from K10, K12, and K21. Lambdas should have no identical values.
</p>


<h3>Value</h3>

<p>This returns a list of lambdas and coefficients.
</p>


<h3>Author(s)</h3>

<p>Kyun-Seop Bae &lt;k@acr.kr&gt;</p>


<h3>Examples</h3>

<pre><code class='language-R'>DAT
DAT2 = ExpandDH(DAT)
Sol = SolComp2(K10=0.1, K12=3, K21=1)
X2 = nComp(Sol, Ka=1, DAT2)
X2
matplot(DAT2[, "TIME"], X2, type="l")
</code></pre>

<hr>
<h2 id='SolComp3'>Get Lambdas and Coefficients of Three-compartment Model</h2><span id='topic+SolComp3'></span>

<h3>Description</h3>

<p>It calculates lambdas and coefficients for three-compartment model from K10, K12, K21, K13, and K31.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SolComp3(K10, K12, K21, K13, K31)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SolComp3_+3A_k10">K10</code></td>
<td>
<p>Ke, Elimination rate constant from central compartment</p>
</td></tr>
<tr><td><code id="SolComp3_+3A_k12">K12</code></td>
<td>
<p>Rate constant from the central to the first peripheral compartment</p>
</td></tr>
<tr><td><code id="SolComp3_+3A_k21">K21</code></td>
<td>
<p>Rate constant from the first peripheral to the central compartment</p>
</td></tr>
<tr><td><code id="SolComp3_+3A_k13">K13</code></td>
<td>
<p>Rate constant from the central to the second peripheral compartment</p>
</td></tr>
<tr><td><code id="SolComp3_+3A_k31">K31</code></td>
<td>
<p>Rate constant from the second peripheral to the central compartment</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It calculates lambdas and coefficients of two-compartment model from K10, K12, and K21. Lambdas should have no identical values.
</p>


<h3>Value</h3>

<p>This returns a list of lambdas and coefficients.
</p>


<h3>Author(s)</h3>

<p>Kyun-Seop Bae &lt;k@acr.kr&gt;</p>


<h3>Examples</h3>

<pre><code class='language-R'>DAT
DAT2 = ExpandDH(DAT)
Sol = SolComp3(K10=0.1, K12=3, K21=1, K13=2, K31=0.5)
X3 = nComp(Sol, Ka=1, DAT2)
X3
matplot(DAT2[, "TIME"], X3, type="l")
</code></pre>

<hr>
<h2 id='wnl5'>Old type WinNonlin - Least Square not MLE</h2><span id='topic+wnl5'></span>

<h3>Description</h3>

<p>It performs old type Winnonlin regression.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wnl5(Fx, Data, pNames, IE, LB, UB, Error="A", ObjFx=ObjLS)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="wnl5_+3A_fx">Fx</code></td>
<td>
<p>Function for structural model. It should return a vector of the same length to observations.</p>
</td></tr>
<tr><td><code id="wnl5_+3A_data">Data</code></td>
<td>
<p>Data table which will be used in Fx. Fx should access this with <code>e$DATA</code>.</p>
</td></tr>
<tr><td><code id="wnl5_+3A_pnames">pNames</code></td>
<td>
<p>Parameter names in the order of Fx arguments</p>
</td></tr>
<tr><td><code id="wnl5_+3A_ie">IE</code></td>
<td>
<p>Initial estimates of parameters</p>
</td></tr>
<tr><td><code id="wnl5_+3A_lb">LB</code></td>
<td>
<p>Lower bound for <code>optim</code> function. The default value is 0.</p>
</td></tr>
<tr><td><code id="wnl5_+3A_ub">UB</code></td>
<td>
<p>Upper bound for <code>optim</code> function. The default value is 1e+06.</p>
</td></tr>
<tr><td><code id="wnl5_+3A_error">Error</code></td>
<td>
<p>Error model. One of <code>"POIS"</code> for Poisson error, <code>"P"</code> for proportional error, and others for additive error model.</p>
</td></tr>
<tr><td><code id="wnl5_+3A_objfx">ObjFx</code></td>
<td>
<p>Objective function to be minimized. The default is least square function.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This uses scaled transformed parameters and environment <code>e</code> internally. Here we do not provide standard error. If you want standard error, use <code>nlr</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>PE</code></td>
<td>
<p>Point estimates</p>
</td></tr>
<tr><td><code>WRSS</code></td>
<td>
<p>Weighted Residual Sum of Square</p>
</td></tr>
<tr><td><code>run$m</code></td>
<td>
<p>Count of positive residuals</p>
</td></tr>
<tr><td><code>run$n</code></td>
<td>
<p>Count of negative residuals</p>
</td></tr>
<tr><td><code>run$run</code></td>
<td>
<p>Count of runs of residuals</p>
</td></tr>
<tr><td><code>run$p.value</code></td>
<td>
<p>P value of run test with excluding zero points</p>
</td></tr>
<tr><td><code>Objective Function Value</code></td>
<td>
<p>Minimum value of the objective function</p>
</td></tr>
<tr><td><code>AIC</code></td>
<td>
<p>Akaike Information Criterion</p>
</td></tr>
<tr><td><code>SBC</code></td>
<td>
<p>Schwarz Bayesian Information Criterion</p>
</td></tr>
<tr><td><code>Condition Number</code></td>
<td>
<p>Condition number</p>
</td></tr>
<tr><td><code>Message</code></td>
<td>
<p>Message from <code>optim</code>.</p>
</td></tr>
<tr><td><code>Prediction</code></td>
<td>
<p>Fitted(predicted) values</p>
</td></tr>
<tr><td><code>Residuals</code></td>
<td>
<p>Residuals</p>
</td></tr>
<tr><td><code>Elapsed Time</code></td>
<td>
<p>Consumed time by minimization</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Kyun-Seop Bae &lt;k@acr.kr&gt;</p>


<h3>Examples</h3>

<pre><code class='language-R'>tData = Theoph
colnames(tData) = c("ID", "BWT", "DOSE", "TIME", "DV")

fPK = function(THETA) # Prediction function
{
  DOSE = 320000 # in microgram
  TIME = e$DATA[,"TIME"] # use data in e$DATA

  K  = THETA[1]
  Ka = THETA[2]
  V  = THETA[3]
  Cp  = DOSE/V*Ka/(Ka - K)*(exp(-K*TIME) - exp(-Ka*TIME))
  return(Cp)
}

IDs = unique(tData[,"ID"])
nID = length(IDs)
for (i in 1:nID) {
  Data = tData[tData$ID == IDs[i],]
  Res = wnl5(fPK, Data, pNames=c("k", "ka", "V"), IE=c(0.1, 3, 500))
  print(paste("## ID =", i, "##"))
  print(Res)
}

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
