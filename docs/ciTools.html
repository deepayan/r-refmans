<!DOCTYPE html><html lang="en"><head><title>Help for package ciTools</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ciTools}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#add_ci'><p>Add Confidence Intervals for Fitted Values to Data Frames</p></a></li>
<li><a href='#add_ci.glm'><p>Confidence Intervals for Generalized Linear Model Predictions</p></a></li>
<li><a href='#add_ci.glmerMod'><p>Confidence Intervals for Generalized Linear Mixed Model Predictions</p></a></li>
<li><a href='#add_ci.lm'><p>Confidence Intervals for Linear Model Predictions</p></a></li>
<li><a href='#add_ci.lmerMod'><p>Confidence Intervals for Linear Mixed Model Predictions</p></a></li>
<li><a href='#add_ci.negbin'><p>Confidence Intervals for Negative Binomial Linear Model Predictions</p></a></li>
<li><a href='#add_ci.survreg'><p>Confidence Intervals for the Mean Survival Time of Accelerated</p>
Failure Time Models.</a></li>
<li><a href='#add_pi'><p>Add Prediction Intervals to Data Frames</p></a></li>
<li><a href='#add_pi.glm'><p>Prediction Intervals for Generalized Linear Models</p></a></li>
<li><a href='#add_pi.glmerMod'><p>Prediction Intervals for Generalized Linear Mixed Model Predictions</p></a></li>
<li><a href='#add_pi.lm'><p>Prediction Intervals for Linear Model Predictions</p></a></li>
<li><a href='#add_pi.lmerMod'><p>Prediction Intervals for Linear Mixed Model Fitted Values</p></a></li>
<li><a href='#add_pi.negbin'><p>Prediction Intervals for Negative Binomial Linear Models</p></a></li>
<li><a href='#add_pi.survreg'><p>Prediction Intervals for Accelerated Failure Time Models</p></a></li>
<li><a href='#add_probs'><p>Add Regression Probabilities to Data Frames</p></a></li>
<li><a href='#add_probs.glm'><p>Response Probabilities for Generalized Linear Models</p></a></li>
<li><a href='#add_probs.glmerMod'><p>Response Probabilities for Generalized Linear Mixed Model Predictions</p></a></li>
<li><a href='#add_probs.lm'><p>Response Level Probabilities for Linear Models</p></a></li>
<li><a href='#add_probs.lmerMod'><p>Response Probabilities for Linear Mixed Models</p></a></li>
<li><a href='#add_probs.negbin'><p>Response Probabilities for Negative Binomial Models</p></a></li>
<li><a href='#add_probs.survreg'><p>Confidence Intervals for the Survivor Function of Accelerated</p>
Failure Time Models</a></li>
<li><a href='#add_quantile'><p>Add Regression Quantiles to Data Frames</p></a></li>
<li><a href='#add_quantile.glm'><p>Quantiles for the Response of a Generalized Linear Model</p></a></li>
<li><a href='#add_quantile.glmerMod'><p>Response Quantiles for Generalized Linear Mixed Model Predictions</p></a></li>
<li><a href='#add_quantile.lm'><p>Quantiles for the Response of a Linear Model</p></a></li>
<li><a href='#add_quantile.lmerMod'><p>Quantiles for the Response of a Linear Mixed Model</p></a></li>
<li><a href='#add_quantile.negbin'><p>Quantiles for the Response of a Negative Binomial Regression</p></a></li>
<li><a href='#add_quantile.survreg'><p>Confidence Intervals for Predicted Survival Time Quantiles of</p>
Accelerated Failure Time Models</a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Confidence or Prediction Intervals, Quantiles, and Probabilities
for Statistical Models</td>
</tr>
<tr>
<td>Version:</td>
<td>0.6.1</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>John Haman &lt;jhaman@ida.org&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Functions to append confidence intervals, prediction intervals,
    and other quantities of interest to data frames. All appended quantities
    are for the response variable, after conditioning on the model and covariates.
    This package has a data frame first syntax that allows for easy piping.
    Currently supported models include (log-) linear, (log-) linear mixed,
    generalized linear models, generalized linear mixed models, and
    accelerated failure time models.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.4.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>arm, boot, dplyr, lme4, MASS, methods, stats, survival, utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>here, ggplot2, knitr, rmarkdown, SPREDA</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>rmarkdown, knitr</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/jthaman/ciTools">https://github.com/jthaman/ciTools</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/jthaman/ciTools/issues">https://github.com/jthaman/ciTools/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-10-25 01:08:02 UTC; jhaman</td>
</tr>
<tr>
<td>Author:</td>
<td>John Haman [cre, aut],
  Matthew Avery [aut],
  Institute for Defense Analyses [cph]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-10-25 05:50:23 UTC</td>
</tr>
</table>
<hr>
<h2 id='add_ci'>Add Confidence Intervals for Fitted Values to Data Frames</h2><span id='topic+add_ci'></span>

<h3>Description</h3>

<p>This is a generic function to append confidence intervals for
predictions of a model fit to a data frame. A confidence interval
is generated for the fitted value of each observation in
<code>df</code>. These confidence intervals are then appended to
<code>df</code> and returned to the user as a data frame. The <code>fit</code> may
be a linear, log-linear, linear mixed, generalized linear model,
generalized linear mixed, or accelerated failure time model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_ci(df, fit, alpha = 0.05, names = NULL, yhatName = "pred", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_ci_+3A_df">df</code></td>
<td>
<p>A data frame of new data. <code>df</code> can be the
original data or new data.</p>
</td></tr>
<tr><td><code id="add_ci_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>lm</code>, <code>glm</code>,
<code>lmerMod</code>, <code>glmerMod</code>, or <code>survreg</code>. Predictions
are made with this object.</p>
</td></tr>
<tr><td><code id="add_ci_+3A_alpha">alpha</code></td>
<td>
<p>A real number between 0 and 1. Controls the confidence
level of the interval estimates.</p>
</td></tr>
<tr><td><code id="add_ci_+3A_names">names</code></td>
<td>
<p><code>NULL</code> or character vector of length two. If
<code>NULL</code>, confidence bounds automatically will be named by
<code>add_ci</code>, otherwise, the lower confidence bound will be
named <code>names[1]</code> and the upper confidence bound will be
named <code>names[2]</code>.</p>
</td></tr>
<tr><td><code id="add_ci_+3A_yhatname">yhatName</code></td>
<td>
<p>A character vector of length one. Name of the
vector of the predictions made for each observation in <code>df</code></p>
</td></tr>
<tr><td><code id="add_ci_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For more specific information about the arguments that are applicable
in each method, consult:
</p>

<ul>
<li> <p><code><a href="#topic+add_ci.lm">add_ci.lm</a></code> for linear model confidence intervals
</p>
</li>
<li> <p><code><a href="#topic+add_ci.glm">add_ci.glm</a></code> for generalized linear model confidence intervals
</p>
</li>
<li> <p><code><a href="#topic+add_ci.lmerMod">add_ci.lmerMod</a></code> for linear mixed model confidence intervals
</p>
</li>
<li> <p><code><a href="#topic+add_ci.glmerMod">add_ci.glmerMod</a></code> for generalized linear mixed model confidence intervals
</p>
</li>
<li> <p><code><a href="#topic+add_ci.survreg">add_ci.survreg</a></code> for accelerated failure time confidence intervals
</p>
</li></ul>

<p>Note that <code>add_ci</code> calculates confidence intervals for
<em>fitted values</em>, not model coefficients. For confidence
intervals of model coefficients, see <code>confint</code>.
</p>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted values, upper and lower
confidence bounds attached.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_pi">add_pi</a></code> for prediction intervals,
<code><a href="#topic+add_probs">add_probs</a></code> for response level probabilities, and
<code><a href="#topic+add_quantile">add_quantile</a></code> for quantiles of the conditional
response distribution.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Fit a linear model
fit &lt;- lm(dist ~ speed, data = cars)
# Make a confidence interval for each observation in cars, and
# append to the data frame
add_ci(cars, fit)

# Make new data
new_data &lt;- cars[sample(NROW(cars), 10), ]
add_ci(new_data, fit)

# Fit a Poisson model
fit2 &lt;- glm(dist ~ speed, family = "poisson", data = cars)
# Append CIs
add_ci(cars, fit2)

# Fit a linear mixed model using lme4
fit3 &lt;- lme4::lmer(Reaction ~ Days + (1|Subject), data = lme4::sleepstudy)
# Append CIs
# Generally, you should use more than 100 bootstrap replicates
add_ci(lme4::sleepstudy, fit3, nSims = 100)

# Fit a logistic model
fit4 &lt;- glm(I(dist &gt; 20) ~ speed, family = "binomial", data = cars)
# Append CIs
add_ci(cbind(cars, I(cars$dist &gt; 20)), fit4)


</code></pre>

<hr>
<h2 id='add_ci.glm'>Confidence Intervals for Generalized Linear Model Predictions</h2><span id='topic+add_ci.glm'></span>

<h3>Description</h3>

<p>This function is one of the methods for <code>add_ci</code>, and is
called automatically when <code>add_ci</code> is used on a <code>fit</code> of
class <code>glm</code>. The default method calculates confidence
intervals by making an interval on the scale of the linear
predictor, then applying the inverse link function from the model
fit to transform the linear level confidence intervals to the
response level. Alternatively, confidence intervals may be
calculated through a nonparametric bootstrap method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'glm'
add_ci(
  df,
  fit,
  alpha = 0.05,
  names = NULL,
  yhatName = "pred",
  response = TRUE,
  type = "parametric",
  nSims = 2000,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_ci.glm_+3A_df">df</code></td>
<td>
<p>A data frame of new data.</p>
</td></tr>
<tr><td><code id="add_ci.glm_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>glm</code>.</p>
</td></tr>
<tr><td><code id="add_ci.glm_+3A_alpha">alpha</code></td>
<td>
<p>A real number between 0 and 1. Controls the confidence
level of the interval estimates.</p>
</td></tr>
<tr><td><code id="add_ci.glm_+3A_names">names</code></td>
<td>
<p><code>NULL</code> or character vector of length two. If
<code>NULL</code>, confidence bounds automatically will be named by
<code>add_ci</code>, otherwise, the lower confidence bound will be
named <code>names[1]</code> and the upper confidence bound will be
named <code>names[2]</code>.</p>
</td></tr>
<tr><td><code id="add_ci.glm_+3A_yhatname">yhatName</code></td>
<td>
<p>A character vector of length one. Name of the
vector of predictions made for each observation in df</p>
</td></tr>
<tr><td><code id="add_ci.glm_+3A_response">response</code></td>
<td>
<p>A logical. The default is <code>TRUE</code>. If
<code>TRUE</code>, the confidence intervals will be determined for
the expected response; if <code>FALSE</code>, confidence intervals
will be made on the scale of the linear predictor.</p>
</td></tr>
<tr><td><code id="add_ci.glm_+3A_type">type</code></td>
<td>
<p>A character vector of length one. Must be <code>type =
"parametric"</code> or <code>type = "boot"</code>. <code>type</code> determines
the method used to compute the confidence intervals.</p>
</td></tr>
<tr><td><code id="add_ci.glm_+3A_nsims">nSims</code></td>
<td>
<p>An integer. Number of simulations to perform if the
bootstrap method is used.</p>
</td></tr>
<tr><td><code id="add_ci.glm_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted values, upper and lower
confidence bounds attached.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_pi.glm">add_pi.glm</a></code> for prediction intervals for
<code>glm</code> objects, <code><a href="#topic+add_probs.glm">add_probs.glm</a></code> for conditional
probabilities of <code>glm</code> objects, and
<code><a href="#topic+add_quantile.glm">add_quantile.glm</a></code> for response quantiles of
<code>glm</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Poisson regression
fit &lt;- glm(dist ~ speed, data = cars, family = "poisson")
add_ci(cars, fit)
# Try a different confidence level
add_ci(cars, fit, alpha = 0.5)
# Add custom names to the confidence bounds (may be useful for plotting)
add_ci(cars, fit, alpha = 0.5, names = c("lwr", "upr"))

# Logistic regression
fit2 &lt;- glm(I(dist &gt; 30) ~ speed, data = cars, family = "binomial")
dat &lt;- cbind(cars, I(cars$dist &gt; 30))
# Form 95% confidence intervals for the fit:
add_ci(dat, fit2)
# Form 50% confidence intervals for the fit:
add_ci(dat, fit2, alpha = 0.5)
# Make confidence intervals on the scale of the linear predictor
add_ci(dat, fit2, alpha = 0.5, response = FALSE)
# Add custom names to the confidence bounds
add_ci(dat, fit2, alpha = 0.5, names = c("lwr", "upr"))


</code></pre>

<hr>
<h2 id='add_ci.glmerMod'>Confidence Intervals for Generalized Linear Mixed Model Predictions</h2><span id='topic+add_ci.glmerMod'></span>

<h3>Description</h3>

<p>This function is one of the methods for <code>add_ci</code>, and is
called automatically when <code>add_ci</code> is used on a <code>fit</code> of
class <code>glmerMod</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'glmerMod'
add_ci(
  df,
  fit,
  alpha = 0.05,
  names = NULL,
  yhatName = "pred",
  response = TRUE,
  type = "boot",
  includeRanef = TRUE,
  nSims = 500,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_ci.glmerMod_+3A_df">df</code></td>
<td>
<p>A data frame of new data.</p>
</td></tr>
<tr><td><code id="add_ci.glmerMod_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>glmerMod</code>.</p>
</td></tr>
<tr><td><code id="add_ci.glmerMod_+3A_alpha">alpha</code></td>
<td>
<p>A real number between 0 and 1. Controls the confidence
level of the interval estimates.</p>
</td></tr>
<tr><td><code id="add_ci.glmerMod_+3A_names">names</code></td>
<td>
<p><code>NULL</code> or character vector of length two. If
<code>NULL</code>, confidence bounds automatically will be named by
<code>add_ci</code>, otherwise, the lower confidence bound will be
named <code>names[1]</code> and the upper confidence bound will be
named <code>names[2]</code>.</p>
</td></tr>
<tr><td><code id="add_ci.glmerMod_+3A_yhatname">yhatName</code></td>
<td>
<p><code>NULL</code> or a string. Name of the predictions
vector. If <code>NULL</code>, the predictions will be named
<code>pred</code>.</p>
</td></tr>
<tr><td><code id="add_ci.glmerMod_+3A_response">response</code></td>
<td>
<p>A logical. The default is <code>TRUE</code>. If
<code>TRUE</code>, the confidence intervals will be determined for the
expected response; if <code>FALSE</code>, confidence intervals will be
made on the scale of the linear predictor.</p>
</td></tr>
<tr><td><code id="add_ci.glmerMod_+3A_type">type</code></td>
<td>
<p>A string. If <code>type == "boot"</code> then bootstrap
intervals are formed. If <code>type == "parametric"</code> then
parametric intervals are formed. Currently only bootstrap
intervals are supported.</p>
</td></tr>
<tr><td><code id="add_ci.glmerMod_+3A_includeranef">includeRanef</code></td>
<td>
<p>A logical. Default is <code>TRUE</code>. Set whether
the predictions and intervals should be made conditional on the
random effects. If <code>FALSE</code>, random effects will not be
included.</p>
</td></tr>
<tr><td><code id="add_ci.glmerMod_+3A_nsims">nSims</code></td>
<td>
<p>A positive integer.  Controls the number of bootstrap
replicates if <code>type = "boot"</code>.</p>
</td></tr>
<tr><td><code id="add_ci.glmerMod_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The default and recommended method is bootstrap. The bootstrap
method can handle many types of models and we find it to be
generally reliable and robust as it is built on the <code>bootMer</code>
function from <code>lme4</code>. This function is experimental.
</p>
<p>If <code>IncludeRanef</code> is False, random slopes and intercepts are set to 0. Unlike in
'lmer' fits, settings random effects to 0 does not mean they are marginalized out. Consider
generalized estimating equations if this is desired.
</p>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted values, upper and lower
confidence bounds attached.
</p>


<h3>References</h3>

<p>For general information about GLMMs
http://bbolker.github.io/mixedmodels-misc/glmmFAQ.html
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_pi.glmerMod">add_pi.glmerMod</a></code> for prediction intervals
of <code>glmerMod</code> objects, <code><a href="#topic+add_probs.glmerMod">add_probs.glmerMod</a></code> for
conditional probabilities of <code>glmerMod</code> objects, and
<code><a href="#topic+add_quantile.glmerMod">add_quantile.glmerMod</a></code> for response quantiles of
<code>glmerMod</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>n &lt;- 300
x &lt;- runif(n)
f &lt;- factor(sample(1:5, size = n, replace = TRUE))
y &lt;- rpois(n, lambda = exp(1 - 0.05 * x * as.numeric(f) + 2 * as.numeric(f)))
df &lt;- data.frame(x = x, f = f, y = y)
fit &lt;- lme4::glmer(y ~ (1+x|f), data=df, family = "poisson")

## Not run: add_ci(df, fit, names = c("lcb", "ucb"), nSims = 300)

</code></pre>

<hr>
<h2 id='add_ci.lm'>Confidence Intervals for Linear Model Predictions</h2><span id='topic+add_ci.lm'></span>

<h3>Description</h3>

<p>This function is one of the methods in <code>add_ci</code> and
automatically is called when an object of class <code>lm</code> is passed
to <code>add_ci</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'lm'
add_ci(
  df,
  fit,
  alpha = 0.05,
  names = NULL,
  yhatName = "pred",
  log_response = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_ci.lm_+3A_df">df</code></td>
<td>
<p>A data frame.</p>
</td></tr>
<tr><td><code id="add_ci.lm_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>lm</code>. Predictions are made with this
object.</p>
</td></tr>
<tr><td><code id="add_ci.lm_+3A_alpha">alpha</code></td>
<td>
<p>A real number between 0 and 1. Controls the confidence
level of the interval estimates.</p>
</td></tr>
<tr><td><code id="add_ci.lm_+3A_names">names</code></td>
<td>
<p><code>NULL</code> or character vector of length two. If
<code>NULL</code>, confidence bounds automatically will be named by
<code>add_ci</code>, otherwise, the lower confidence bound will be
named <code>names[1]</code> and the upper confidence bound will be
named <code>names[2]</code>.</p>
</td></tr>
<tr><td><code id="add_ci.lm_+3A_yhatname">yhatName</code></td>
<td>
<p>A string. Name of the vector of the predictions
made for each observation in df</p>
</td></tr>
<tr><td><code id="add_ci.lm_+3A_log_response">log_response</code></td>
<td>
<p>Logical. Default is <code>FALSE</code>. If
<code>TRUE</code>, confidence intervals will be generated for the
<em>response level</em> of a log-linear model:  <code class="reqn">log(Y) =
X\beta + \epsilon</code>.</p>
</td></tr>
<tr><td><code id="add_ci.lm_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Confidence intervals for <code>lm</code> objects are calculated
parametrically. This function is essentially a wrapper for
<code>predict(fit, df, interval = "confidence")</code> if <code>fit</code> is a
linear model. If <code>log_response = TRUE</code>, confidence intervals
for the response are calculated using Wald's Method. See Meeker and
Escobar (1998) for details.
</p>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted values, upper and lower
confidence bounds attached.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_pi.lm">add_pi.lm</a></code> for prediction intervals for
<code>lm</code> objects, <code><a href="#topic+add_probs.lm">add_probs.lm</a></code> for conditional
probabilities of <code>lm</code> objects, and
<code><a href="#topic+add_quantile.lm">add_quantile.lm</a></code> for response quantiles of
<code>lm</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Fit a linear model
fit &lt;- lm(dist ~ speed, data = cars)
# Get fitted values for each observation in cars, and append
# confidence intervals
add_ci(cars, fit)
# Try a different confidence level
add_ci(cars, fit, alpha = 0.5)
# Try custom names for the confidence bounds
add_ci(cars, fit, alpha = 0.5, names = c("lwr", "upr"))

</code></pre>

<hr>
<h2 id='add_ci.lmerMod'>Confidence Intervals for Linear Mixed Model Predictions</h2><span id='topic+add_ci.lmerMod'></span>

<h3>Description</h3>

<p>This function is one of the methods for <code>add_ci</code>, and is
called automatically when <code>add_ci</code> is used on a <code>fit</code> of
class <code>lmerMod</code>. It is recommended that one use parametric
confidence intervals when modeling with a random intercept linear
mixed model (i.e. a fit with a formula such as <code>lmer(y ~ x +
(1|group))</code>). Otherwise, confidence intervals may be bootstrapped
via <code>lme4::bootMer</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'lmerMod'
add_ci(
  df,
  fit,
  alpha = 0.05,
  names = NULL,
  yhatName = "pred",
  type = "boot",
  includeRanef = TRUE,
  nSims = 500,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_ci.lmerMod_+3A_df">df</code></td>
<td>
<p>A data frame of new data.</p>
</td></tr>
<tr><td><code id="add_ci.lmerMod_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>lmerMod</code>.</p>
</td></tr>
<tr><td><code id="add_ci.lmerMod_+3A_alpha">alpha</code></td>
<td>
<p>A real number between 0 and 1. Controls the confidence
level of the interval estimates.</p>
</td></tr>
<tr><td><code id="add_ci.lmerMod_+3A_names">names</code></td>
<td>
<p><code>NULL</code> or character vector of length two. If
<code>NULL</code>, confidence bounds automatically will be named by
<code>add_ci</code>, otherwise, the lower confidence bound will be
named <code>names[1]</code> and the upper confidence bound will be
named <code>names[2]</code>.</p>
</td></tr>
<tr><td><code id="add_ci.lmerMod_+3A_yhatname">yhatName</code></td>
<td>
<p>A string. Name of the predictions vector.</p>
</td></tr>
<tr><td><code id="add_ci.lmerMod_+3A_type">type</code></td>
<td>
<p>A string. Must be <code>"parametric"</code> or <code>"boot"</code>,
If <code>type = "boot"</code>, then <code>add_ci</code> calls
<code>lme4::bootMer</code> to calculate the confidence
intervals. This method may be time consuming, but is applicable
with random slope and random intercept models. The parametric
method is fast, but currently only works well for random
intercept models.</p>
</td></tr>
<tr><td><code id="add_ci.lmerMod_+3A_includeranef">includeRanef</code></td>
<td>
<p>A logical. Default is <code>TRUE</code>. Set whether
the predictions and intervals should be made conditional on the
random effects. If <code>FALSE</code>, random effects will not be
included.</p>
</td></tr>
<tr><td><code id="add_ci.lmerMod_+3A_nsims">nSims</code></td>
<td>
<p>A positive integer.  Controls the number of bootstrap
replicates if <code>type = "boot"</code>.</p>
</td></tr>
<tr><td><code id="add_ci.lmerMod_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Bootstrapped intervals are slower to compute, but they are the
recommended method when working with any linear mixed models more
complicated than the random intercept model.
</p>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted values, upper and lower
confidence bounds attached.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_pi.lmerMod">add_pi.lmerMod</a></code> for prediction intervals
of <code>lmerMod</code> objects, <code><a href="#topic+add_probs.lmerMod">add_probs.lmerMod</a></code> for
conditional probabilities of <code>lmerMod</code> objects, and
<code><a href="#topic+add_quantile.lmerMod">add_quantile.lmerMod</a></code> for response quantiles of
<code>lmerMod</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
dat &lt;- lme4::sleepstudy
# Fit a linear mixed model (random intercept model)
fit &lt;- lme4::lmer(Reaction ~ Days + (1|Subject), data = lme4::sleepstudy)
# Get the fitted values for each observation in dat, and
# append CIs for those fitted values to dat
add_ci(dat, fit, alpha = 0.5)
# Try the parametric bootstrap method, and make prediction at the population level
add_ci(dat, fit, alpha = 0.5, type = "boot", includeRanef = FALSE, nSims = 100)

## End(Not run)
</code></pre>

<hr>
<h2 id='add_ci.negbin'>Confidence Intervals for Negative Binomial Linear Model Predictions</h2><span id='topic+add_ci.negbin'></span>

<h3>Description</h3>

<p>This function is one of the methods for <code>add_ci</code>, and is
called automatically when <code>add_ci</code> is used on a <code>fit</code> of
class <code>negbin</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'negbin'
add_ci(
  df,
  fit,
  alpha = 0.05,
  names = NULL,
  yhatName = "pred",
  response = TRUE,
  type = "parametric",
  nSims = 2000,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_ci.negbin_+3A_df">df</code></td>
<td>
<p>A data frame of new data.</p>
</td></tr>
<tr><td><code id="add_ci.negbin_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>negbin</code>.</p>
</td></tr>
<tr><td><code id="add_ci.negbin_+3A_alpha">alpha</code></td>
<td>
<p>A real number between 0 and 1. Controls the confidence
level of the interval estimates.</p>
</td></tr>
<tr><td><code id="add_ci.negbin_+3A_names">names</code></td>
<td>
<p><code>NULL</code> or character vector of length two. If
<code>NULL</code>, confidence bounds automatically will be named by
<code>add_ci</code>, otherwise, the lower confidence bound will be
named <code>names[1]</code> and the upper confidence bound will be
named <code>names[2]</code>.</p>
</td></tr>
<tr><td><code id="add_ci.negbin_+3A_yhatname">yhatName</code></td>
<td>
<p>A string. Name of the vector of predictions made
for each observation in df</p>
</td></tr>
<tr><td><code id="add_ci.negbin_+3A_response">response</code></td>
<td>
<p>A logical. The default is <code>TRUE</code>. If
<code>TRUE</code>, the confidence intervals will be determined for
the expected response; if <code>FALSE</code>, confidence intervals
will be made on the scale of the linear predictor.</p>
</td></tr>
<tr><td><code id="add_ci.negbin_+3A_type">type</code></td>
<td>
<p>A string. Must be <code>type = "parametric"</code> or
<code>type = "boot"</code>. <code>type</code> determines the method used to
compute the confidence intervals.</p>
</td></tr>
<tr><td><code id="add_ci.negbin_+3A_nsims">nSims</code></td>
<td>
<p>An integer. Number of simulations to perform if the
bootstrap method is used.</p>
</td></tr>
<tr><td><code id="add_ci.negbin_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The default link function is log-link. Confidence Intervals are
determined by making an interval on the scale of the linear
predictor, then applying the inverse link function from the model
fit to transform the linear level confidence intervals to the
response level. Alternatively, bootstrap confidence intervals may
be formed. The bootstrap intervals are formed by first resampling
cases from the data frame used to calculate <code>fit</code>, then bias
corrected and accelerated intervals are calculated. See
<code>boot::boot.ci</code> for more details.
</p>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted values, upper and lower
confidence bounds attached.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_pi.negbin">add_pi.negbin</a></code> for prediction intervals for
<code>negbin</code> objects, <code><a href="#topic+add_probs.negbin">add_probs.negbin</a></code> for conditional
probabilities of <code>negbin</code> objects, and
<code><a href="#topic+add_quantile.negbin">add_quantile.negbin</a></code> for response quantiles of
<code>negbin</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x1 &lt;- rnorm(300, mean = 1)
y &lt;- MASS::rnegbin(n = 300, mu = exp(5 + 0.5 * x1), theta = 2)
df &lt;- data.frame(x1 = x1, y = y)
fit &lt;- MASS::glm.nb(y ~ x1, data = df)
df &lt;- df[sample(100),]
add_ci(df, fit, names = c("lcb", "ucb"))

</code></pre>

<hr>
<h2 id='add_ci.survreg'>Confidence Intervals for the Mean Survival Time of Accelerated
Failure Time Models.</h2><span id='topic+add_ci.survreg'></span>

<h3>Description</h3>

<p>This function is one of the methods for <code>add_ci</code>, and is
called automatically when <code>add_ci</code> is used on a <code>fit</code> of
class <code>survreg</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'survreg'
add_ci(df, fit, alpha = 0.1, names = NULL, yhatName = "mean_pred", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_ci.survreg_+3A_df">df</code></td>
<td>
<p>A data frame of new data on which to form
predictions and confidence intervals.</p>
</td></tr>
<tr><td><code id="add_ci.survreg_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>survreg</code>. Predictions are made
with this object.</p>
</td></tr>
<tr><td><code id="add_ci.survreg_+3A_alpha">alpha</code></td>
<td>
<p>A number between 0 and 1. 1 - <code>alpha</code> is the
confidence level of the intervals.</p>
</td></tr>
<tr><td><code id="add_ci.survreg_+3A_names">names</code></td>
<td>
<p><code>NULL</code> or a string of length 2. If <code>NULL</code>, quantiles
automatically will be named by <code>add_quantile</code>, otherwise,
they will be named <code>names</code>.</p>
</td></tr>
<tr><td><code id="add_ci.survreg_+3A_yhatname">yhatName</code></td>
<td>
<p>A string. Name of the vector of predictions. The
default name is <code>mean_pred</code>.</p>
</td></tr>
<tr><td><code id="add_ci.survreg_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>add_ci.survreg</code> calculates confidence intervals for the mean
survival time of several accelerated failure time (AFT) models
including exponential, lognormal, weibull, and loglogistic
models. AFT models must be fit with the <code>survreg</code> function in
the <code>survival</code> package. Confidence intervals are formed
parametrically via the Delta method.
</p>
<p><code>add_ci.survreg</code> will compute confidence intervals for the
following mean survival time point estimates:
</p>
<p>Exponential: <code class="reqn">E[Y|X] = \exp{X\beta}</code>
</p>
<p>Weibull: <code class="reqn">E[Y|X] = \exp{X\beta}\Gamma(1 + \sigma)</code>
</p>
<p>Lognormal: <code class="reqn">E[Y|X] = \exp{X\beta + \frac{\sigma^2}{2}}</code>
</p>
<p>Loglogistic: <code class="reqn">E[Y|X] = \exp{X\beta}\Gamma(1 + \sigma)(1 - \sigma)</code>
</p>
<p>Traditionally, survival time predictions are made with the median
survival time. For forming confidence intervals for the median
survival time (or any quantile of the survival time distribution),
see <code><a href="#topic+add_quantile.survreg">add_quantile.survreg</a></code>.
</p>
<p>Note: The expected survival time of a loglogistic model with scale
&gt;= 1 does not exist. Otherwise, expected survival times exist for
each of the four AFT models considered in <code>add.ci_survreg</code>.
</p>
<p>Note: Due to a limitation, the <code>Surv</code> object must be specified in
<code>survreg</code> function call. See the examples section for one way
to do this.
</p>
<p>Note: <code>add_ci.survreg</code> cannot inspect the convergence of
<code>fit</code>. Poor maximum likelihood estimates will result in poor
confidence intervals. Inspect any warning messages given from
<code>survreg</code>.
</p>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted expected values and
level <em>1 - alpha</em> level confidence levels attached.
</p>


<h3>References</h3>

<p>For descriptions of the log-location scale models supported:
Meeker, William Q., and Luis A. Escobar. Statistical methods for reliability data. John Wiley &amp; Sons, 2014. (Chapter 4)
</p>
<p>For a description of the multivariate Delta method:
Meeker, William Q., and Luis A. Escobar. Statistical methods for reliability data. John Wiley &amp; Sons, 2014. (Appendix B.2)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_quantile.survreg">add_quantile.survreg</a></code> for quantiles of the
survival time distribution of <code>survreg</code> objects,
<code><a href="#topic+add_pi.survreg">add_pi.survreg</a></code> for prediction intervals of
<code>survreg</code> objects, and <code><a href="#topic+add_probs.survreg">add_probs.survreg</a></code> for
survival probabilities of <code>survreg</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Define a data set.
df &lt;- survival::stanford2
## remove a covariate with missing values.
df &lt;- df[, 1:4]
## next, create the Surv object inside the survreg call:
fit &lt;- survival::survreg(survival::Surv(time, status) ~ age + I(age^2),
                         data = df, dist = "lognormal")
add_ci(df, fit, alpha = 0.1, names = c("lwr", "upr"))

## Try a different model:
fit2 &lt;- survival::survreg(survival::Surv(time, status) ~ age + I(age^2),
                          data = df, dist = "weibull")
add_ci(df, fit2, alpha = 0.1, names = c("lwr", "upr"))

</code></pre>

<hr>
<h2 id='add_pi'>Add Prediction Intervals to Data Frames</h2><span id='topic+add_pi'></span>

<h3>Description</h3>

<p>This is a generic function to append prediction intervals to a data
frame. A prediction interval is made for each observation in
<code>df</code> with respect to the model <code>fit</code>. These intervals are
then appended to <code>df</code> and returned to the user as a
data frame. <code>fit</code> can be a linear, log-linear, linear mixed,
generalized linear, generalized linear mixed, or accelerated
failure time model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_pi(df, fit, alpha = 0.05, names = NULL, yhatName = "pred", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_pi_+3A_df">df</code></td>
<td>
<p>A data frame of new data.</p>
</td></tr>
<tr><td><code id="add_pi_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>lm</code>, <code>glm</code>, or
<code>lmerMod</code>. Predictions are made with this object.</p>
</td></tr>
<tr><td><code id="add_pi_+3A_alpha">alpha</code></td>
<td>
<p>A real number between 0 and 1. Controls the confidence
level of the interval estimates.</p>
</td></tr>
<tr><td><code id="add_pi_+3A_names">names</code></td>
<td>
<p><code>NULL</code> or character vector of length two. If
<code>NULL</code>, prediction bounds automatically will be named by
<code>add_pi</code>, otherwise, the lower prediction bound will be
named <code>piNames[1]</code> and the upper prediction bound will be
named <code>piNames[2]</code>.</p>
</td></tr>
<tr><td><code id="add_pi_+3A_yhatname">yhatName</code></td>
<td>
<p>A string. Name of the predictions vector.</p>
</td></tr>
<tr><td><code id="add_pi_+3A_...">...</code></td>
<td>
<p>Additional arguments</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For more specific information about the arguments that are applicable
in each method, consult:
</p>

<ul>
<li> <p><code><a href="#topic+add_pi.lm">add_pi.lm</a></code> for linear regression prediction intervals
</p>
</li>
<li> <p><code><a href="#topic+add_pi.glm">add_pi.glm</a></code> for generalized linear regression prediction intervals
</p>
</li>
<li> <p><code><a href="#topic+add_pi.lmerMod">add_pi.lmerMod</a></code> for linear mixed models prediction intervals
</p>
</li>
<li> <p><code><a href="#topic+add_pi.glmerMod">add_pi.glmerMod</a></code> for generalized linear mixed model prediction intervals
</p>
</li>
<li> <p><code><a href="#topic+add_pi.survreg">add_pi.survreg</a></code> for accelerated failure time model prediction intervals
</p>
</li></ul>



<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted values, upper and lower
prediction bounds attached.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_ci">add_ci</a></code> for confidence intervals,
<code><a href="#topic+add_probs">add_probs</a></code> for response level probabilities, and
<code><a href="#topic+add_quantile">add_quantile</a></code> for quantiles of the conditional
response distribution.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Fit a linear model
fit &lt;- lm(dist ~ speed, data = cars)
# Define some new data
new_data &lt;- cars[sample(NROW(cars), 10), ]
# Add fitted values and prediction intervals to new_data
add_pi(new_data, fit)

# Fit a Poisson model
fit2 &lt;- glm(dist ~ speed, family = "poisson", data = cars)
# Add approximate prediction intervals to the fitted values of
# new_data
add_pi(new_data, fit2)

# Fit a linear mixed model
fit3 &lt;- lme4::lmer(Reaction ~ Days + (1|Subject), data = lme4::sleepstudy)
# Add parametric prediction intervals for the fitted values to the
# original data
add_pi(lme4::sleepstudy, fit3, type = "parametric")


</code></pre>

<hr>
<h2 id='add_pi.glm'>Prediction Intervals for Generalized Linear Models</h2><span id='topic+add_pi.glm'></span>

<h3>Description</h3>

<p>This function is one of the methods for <code>add_pi</code>, and is
called automatically when <code>add_pi</code> is used on a <code>fit</code> of
class <code>glm</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'glm'
add_pi(
  df,
  fit,
  alpha = 0.05,
  names = NULL,
  yhatName = "pred",
  nSims = 2000,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_pi.glm_+3A_df">df</code></td>
<td>
<p>A data frame of new data.</p>
</td></tr>
<tr><td><code id="add_pi.glm_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>glm</code>.</p>
</td></tr>
<tr><td><code id="add_pi.glm_+3A_alpha">alpha</code></td>
<td>
<p>A real number between 0 and 1. Controls the confidence
level of the interval estimates.</p>
</td></tr>
<tr><td><code id="add_pi.glm_+3A_names">names</code></td>
<td>
<p><code>NULL</code> or character vector of length two. If
<code>NULL</code>, prediction bounds automatically will be named by
<code>add_pi</code>, otherwise, the lower prediction bound will be
named <code>names[1]</code> and the upper prediction bound will be
named <code>names[2]</code>.</p>
</td></tr>
<tr><td><code id="add_pi.glm_+3A_yhatname">yhatName</code></td>
<td>
<p>A string. Name of the predictions vector.</p>
</td></tr>
<tr><td><code id="add_pi.glm_+3A_nsims">nSims</code></td>
<td>
<p>A positive integer. Determines the number of
simulations to run.</p>
</td></tr>
<tr><td><code id="add_pi.glm_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Prediction intervals are generated through simulation with the aid
<code>arm::sim</code>, which simulates the uncertainty in the regression
coefficients. At the moment, only prediction intervals for Poisson,
Quasipoisson, Gaussian, and Gamma GLMs are supported. Note that if
the response is count data, prediction intervals are only
approximate. Simulation from the QuasiPoisson model is performed
with the negative binomial distribution, see Gelman and Hill
(2007).
</p>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted values, upper and lower
prediction bounds attached.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_ci.glm">add_ci.glm</a></code> for confidence intervals for
<code>glm</code> objects, <code><a href="#topic+add_probs.glm">add_probs.glm</a></code> for conditional
probabilities of <code>glm</code> objects, and
<code><a href="#topic+add_quantile.glm">add_quantile.glm</a></code> for response quantiles of
<code>glm</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Fit a Poisson model
fit &lt;- glm(dist ~ speed, data = cars, family = "poisson")
# Add prediction intervals and fitted values to the original data frame
add_pi(cars, fit)
# Try a different confidence level
add_pi(cars, fit, alpha = 0.5)
# Try custom names for the prediction bounds (may be useful for plotting)
add_pi(cars, fit, alpha = 0.5, names = c("lwr", "upr"))

</code></pre>

<hr>
<h2 id='add_pi.glmerMod'>Prediction Intervals for Generalized Linear Mixed Model Predictions</h2><span id='topic+add_pi.glmerMod'></span>

<h3>Description</h3>

<p>This function is one of the methods for <code>add_pi</code>, and is
called automatically when <code>add_pi</code> is used on a <code>fit</code> of
class <code>glmerMod</code>. This function is experimental.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'glmerMod'
add_pi(
  df,
  fit,
  alpha = 0.05,
  names = NULL,
  yhatName = "pred",
  type = "boot",
  includeRanef = TRUE,
  nSims = 10000,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_pi.glmerMod_+3A_df">df</code></td>
<td>
<p>A data frame of new data.</p>
</td></tr>
<tr><td><code id="add_pi.glmerMod_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>glmerMod</code>.</p>
</td></tr>
<tr><td><code id="add_pi.glmerMod_+3A_alpha">alpha</code></td>
<td>
<p>A real number between 0 and 1. Controls the confidence
level of the interval estimates.</p>
</td></tr>
<tr><td><code id="add_pi.glmerMod_+3A_names">names</code></td>
<td>
<p><code>NULL</code> or character vector of length two. If
<code>NULL</code>, prediction bounds automatically will be named by
<code>add_pi</code>, otherwise, the lower prediction bound will be
named <code>names[1]</code> and the upper prediction bound will be
named <code>names[2]</code>.</p>
</td></tr>
<tr><td><code id="add_pi.glmerMod_+3A_yhatname">yhatName</code></td>
<td>
<p><code>NULL</code> or a string. The name of the
predictions vector.</p>
</td></tr>
<tr><td><code id="add_pi.glmerMod_+3A_type">type</code></td>
<td>
<p>A string. Must be <code>"boot"</code>, If <code>type =
"boot"</code>, then <code>add_ci</code> calls <code>lme4::bootMer</code> to
calculate the confidence intervals.</p>
</td></tr>
<tr><td><code id="add_pi.glmerMod_+3A_includeranef">includeRanef</code></td>
<td>
<p>A logical. Default is <code>TRUE</code>. Set whether
the predictions and intervals should be made conditional on the
random effects. If <code>FALSE</code>, random effects will not be
included.</p>
</td></tr>
<tr><td><code id="add_pi.glmerMod_+3A_nsims">nSims</code></td>
<td>
<p>A positive integer.  Controls the number of bootstrap
replicates.</p>
</td></tr>
<tr><td><code id="add_pi.glmerMod_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Prediction intervals are approximate and determined by simulation
through the <code>simulate</code> function distributed with <code>lme4</code>.
</p>
<p>If <code>IncludeRanef</code> is False, random slopes and intercepts are set to 0. Unlike in
'lmer' fits, settings random effects to 0 does not mean they are marginalized out. Consider
generalized estimating equations if this is desired.
</p>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted values, upper and lower
prediction bounds attached.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_ci.glmerMod">add_ci.glmerMod</a></code> for confidence intervals
of <code>glmerMod</code> objects, <code><a href="#topic+add_probs.glmerMod">add_probs.glmerMod</a></code> for
conditional probabilities of <code>glmerMod</code> objects, and
<code><a href="#topic+add_quantile.glmerMod">add_quantile.glmerMod</a></code> for response quantiles of
<code>glmerMod</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>n &lt;- 300
x &lt;- runif(n)
f &lt;- factor(sample(1:5, size = n, replace = TRUE))
y &lt;- rpois(n, lambda = exp(1 - 0.05 * x * as.numeric(f) + 2 * as.numeric(f)))
df &lt;- data.frame(x = x, f = f, y = y)
fit &lt;- lme4::glmer(y ~ (1+x|f), data=df, family = "poisson")

add_pi(df, fit, names = c("LPB", "UPB"), nSims = 500)

</code></pre>

<hr>
<h2 id='add_pi.lm'>Prediction Intervals for Linear Model Predictions</h2><span id='topic+add_pi.lm'></span>

<h3>Description</h3>

<p>This function is one of the methods for <code>add_pi</code> and is
automatically called when an object of class <code>lm</code> is passed to
to <code>add_pi</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'lm'
add_pi(
  df,
  fit,
  alpha = 0.05,
  names = NULL,
  yhatName = "pred",
  log_response = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_pi.lm_+3A_df">df</code></td>
<td>
<p>A data frame of new data.</p>
</td></tr>
<tr><td><code id="add_pi.lm_+3A_fit">fit</code></td>
<td>
<p>An object of class lm. Predictions are made with this
object.</p>
</td></tr>
<tr><td><code id="add_pi.lm_+3A_alpha">alpha</code></td>
<td>
<p>A real number between 0 and 1. Controls the confidence
level of the interval estimates.</p>
</td></tr>
<tr><td><code id="add_pi.lm_+3A_names">names</code></td>
<td>
<p><code>NULL</code> or character vector of length two. If
<code>NULL</code>, prediction bounds automatically will be named by
<code>add_pi</code>, otherwise, the lower prediction bound will be
named <code>names[1]</code> and the upper prediction bound will be
named <code>names[2]</code>.</p>
</td></tr>
<tr><td><code id="add_pi.lm_+3A_yhatname">yhatName</code></td>
<td>
<p>A string. Name of the predictions vector.</p>
</td></tr>
<tr><td><code id="add_pi.lm_+3A_log_response">log_response</code></td>
<td>
<p>A logical. If TRUE, prediction intervals will be
generated at the <em>response level</em> of a log-linear model:
<code class="reqn">\log(Y) = X\beta + \epsilon</code>. Again, these intervals will
be on the scale of the original response, Y.</p>
</td></tr>
<tr><td><code id="add_pi.lm_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Prediction intervals for <code>lm</code> objects are calculated
parametrically. This function is essentially just a wrapper for
<code>predict(fit, df, interval = "prediction")</code> if <code>fit</code> is a
linear model. If <code>log_response = TRUE</code>, prediction intervals
for the response are calculated parametrically, then the
exponential function is applied to transform them to the original
scale.
</p>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted values, upper and lower
prediction bounds attached.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_ci.lm">add_ci.lm</a></code> for confidence intervals for
<code>lm</code> objects. <code><a href="#topic+add_probs.lm">add_probs.lm</a></code> for conditional
probabilities of <code>lm</code> objects, and
<code><a href="#topic+add_quantile.lm">add_quantile.lm</a></code> for response quantiles of
<code>lm</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Fit a linear model
fit &lt;- lm(dist ~ speed, data = cars)
# Add prediction intervals and fitted values to the original data
add_pi(cars, fit)

# Try to add predictions to a data frame of new data
new_data &lt;- cars[sample(NROW(cars), 10), ]
add_pi(new_data, fit)

# Try a different confidence level
add_pi(cars, fit, alpha = 0.5)

# Add custom names to the prediction bounds.
add_pi(cars, fit, alpha = 0.5, names = c("lwr", "upr"))
</code></pre>

<hr>
<h2 id='add_pi.lmerMod'>Prediction Intervals for Linear Mixed Model Fitted Values</h2><span id='topic+add_pi.lmerMod'></span>

<h3>Description</h3>

<p>This function is one of the methods in <code>add_pi</code>, and is
called automatically when <code>add_pi</code> is used on a <code>fit</code> of
class <code>lmerMod</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'lmerMod'
add_pi(
  df,
  fit,
  alpha = 0.05,
  names = NULL,
  yhatName = "pred",
  type = "parametric",
  includeRanef = TRUE,
  log_response = FALSE,
  nSims = 10000,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_pi.lmerMod_+3A_df">df</code></td>
<td>
<p>A data frame of new data</p>
</td></tr>
<tr><td><code id="add_pi.lmerMod_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>lmerMod</code>.</p>
</td></tr>
<tr><td><code id="add_pi.lmerMod_+3A_alpha">alpha</code></td>
<td>
<p>A real number between 0 and 1. Controls the confidence
level of the interval estimates.</p>
</td></tr>
<tr><td><code id="add_pi.lmerMod_+3A_names">names</code></td>
<td>
<p><code>NULL</code> or character vector of length two. If
<code>NULL</code>, prediction bounds automatically will be named by
<code>add_pi</code>, otherwise, the lower prediction bound will be
named <code>names[1]</code> and the upper prediction bound will be
named <code>names[2]</code>.</p>
</td></tr>
<tr><td><code id="add_pi.lmerMod_+3A_yhatname">yhatName</code></td>
<td>
<p>A string. Name of the predictions vector.</p>
</td></tr>
<tr><td><code id="add_pi.lmerMod_+3A_type">type</code></td>
<td>
<p>A string, either <code>"parametric"</code> or
<code>"boot"</code>. Determines the method used to calculate the
prediction intervals.</p>
</td></tr>
<tr><td><code id="add_pi.lmerMod_+3A_includeranef">includeRanef</code></td>
<td>
<p>A logical. Set whether the predictions and
intervals should be conditioned on the random effects. If
<code>FALSE</code>, random effects will not be included.</p>
</td></tr>
<tr><td><code id="add_pi.lmerMod_+3A_log_response">log_response</code></td>
<td>
<p>A logical, indicating if the response is on log
scale in the model fit. If <code>TRUE</code>, prediction intervals
will be returned on the response scale.</p>
</td></tr>
<tr><td><code id="add_pi.lmerMod_+3A_nsims">nSims</code></td>
<td>
<p>A positive integer. If <code>type = "boot"</code>,
<code>nSims</code> will determine the number of bootstrap simulations
to perform.</p>
</td></tr>
<tr><td><code id="add_pi.lmerMod_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It is recommended that one use parametric prediction intervals when
modeling with a random intercept linear mixed model. Otherwise,
prediction intervals may be simulated via a parametric bootstrap
using the function <code>lme4.simulate()</code>.
</p>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted values, upper and lower
prediction bounds attached.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_ci.lmerMod">add_ci.lmerMod</a></code> for confidence intervals
for <code>lmerMod</code> objects, <code><a href="#topic+add_probs.lmerMod">add_probs.lmerMod</a></code> for
conditional probabilities of <code>lmerMod</code> objects, and
<code><a href="#topic+add_quantile.lmerMod">add_quantile.lmerMod</a></code> for response quantiles of
<code>lmerMod</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dat &lt;- lme4::sleepstudy
# Fit a (random intercept) linear mixed model
fit &lt;- lme4::lmer(Reaction ~ Days + (1|Subject), data = lme4::sleepstudy)
# Add 50% prediction intervals to the original data using the default
# method.
add_pi(dat, fit, alpha = 0.5)

# Add 50% prediction intervals to the original data using the
# parametric bootstrap method. Form prediction intervals at the population
# level (unconditional on the random effects).
add_pi(dat, fit, alpha = 0.5, type = "boot", includeRanef = FALSE)

</code></pre>

<hr>
<h2 id='add_pi.negbin'>Prediction Intervals for Negative Binomial Linear Models</h2><span id='topic+add_pi.negbin'></span>

<h3>Description</h3>

<p>This function is one of the methods for <code>add_pi</code>, and is
called automatically when <code>add_pi</code> is used on a <code>fit</code> of
class <code>negbin</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'negbin'
add_pi(
  df,
  fit,
  alpha = 0.05,
  names = NULL,
  yhatName = "pred",
  nSims = 2000,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_pi.negbin_+3A_df">df</code></td>
<td>
<p>A data frame of new data.</p>
</td></tr>
<tr><td><code id="add_pi.negbin_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>negbin</code>.</p>
</td></tr>
<tr><td><code id="add_pi.negbin_+3A_alpha">alpha</code></td>
<td>
<p>A real number between 0 and 1. Controls the confidence
level of the interval estimates.</p>
</td></tr>
<tr><td><code id="add_pi.negbin_+3A_names">names</code></td>
<td>
<p><code>NULL</code> or character vector of length two. If
<code>NULL</code>, prediction bounds automatically will be named by
<code>add_pi</code>, otherwise, the lower prediction bound will be
named <code>names[1]</code> and the upper prediction bound will be
named <code>names[2]</code>.</p>
</td></tr>
<tr><td><code id="add_pi.negbin_+3A_yhatname">yhatName</code></td>
<td>
<p>A string. Name of the predictions vector.</p>
</td></tr>
<tr><td><code id="add_pi.negbin_+3A_nsims">nSims</code></td>
<td>
<p>A positive integer. Determines the number of
simulations to run.</p>
</td></tr>
<tr><td><code id="add_pi.negbin_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Prediction intervals for negative binomial fits are formed through
a two part simulation scheme:
</p>
<p>1. Model coefficients are generated through a parametric bootstrap
procedure that simulates the uncertainty in the regression
coefficients.
</p>
<p>2. Random draws from the negative binomial
distribution are taken with a mean that varies based on the model
coefficients determined in step (1) and over-dispersion parameter
that is taken from the original fitted model.
</p>
<p>Quantiles of the simulated responses are taken at the end to
produce intervals of the desired level.
</p>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted values, upper and lower
prediction bounds attached.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_ci.negbin">add_ci.negbin</a></code> for confidence intervals for
<code>negbin</code> objects, <code><a href="#topic+add_probs.negbin">add_probs.negbin</a></code> for conditional
probabilities of <code>negbin</code> objects, and
<code><a href="#topic+add_quantile.negbin">add_quantile.negbin</a></code> for response quantiles of
<code>negbin</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x1 &lt;- rnorm(100, mean = 1)
y &lt;- MASS::rnegbin(n = 100, mu = exp(1 + x1), theta = 5)
df &lt;- data.frame(x1 = x1, y = y)
fit &lt;- MASS::glm.nb(y ~ x1, data = df)
add_pi(df, fit, names = c("lpb", "upb"))

</code></pre>

<hr>
<h2 id='add_pi.survreg'>Prediction Intervals for Accelerated Failure Time Models</h2><span id='topic+add_pi.survreg'></span>

<h3>Description</h3>

<p>This function is one of the methods for <code>add_pi</code>, and is
called automatically when <code>add_pi</code> is used on a <code>fit</code> of
class <code>survreg</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'survreg'
add_pi(
  df,
  fit,
  alpha = 0.05,
  names = NULL,
  yhatName = "median_pred",
  nSims = 10000,
  method = "naive",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_pi.survreg_+3A_df">df</code></td>
<td>
<p>A data frame of new data.</p>
</td></tr>
<tr><td><code id="add_pi.survreg_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>survreg</code>.</p>
</td></tr>
<tr><td><code id="add_pi.survreg_+3A_alpha">alpha</code></td>
<td>
<p>A real number between 0 and 1. Controls the confidence
level of the interval estimates.</p>
</td></tr>
<tr><td><code id="add_pi.survreg_+3A_names">names</code></td>
<td>
<p><code>NULL</code> or character vector of length two. If
<code>NULL</code>, prediction bounds automatically will be named by
<code>add_pi</code>, otherwise, the lower prediction bound will be
named <code>names[1]</code> and the upper prediction bound will be
named <code>names[2]</code>.</p>
</td></tr>
<tr><td><code id="add_pi.survreg_+3A_yhatname">yhatName</code></td>
<td>
<p>A string. Name of the predictions vector.</p>
</td></tr>
<tr><td><code id="add_pi.survreg_+3A_nsims">nSims</code></td>
<td>
<p>A positive integer. Determines the number of bootstrap
replicates if <code>method = "boot"</code>.</p>
</td></tr>
<tr><td><code id="add_pi.survreg_+3A_method">method</code></td>
<td>
<p>A string. Determines the method used to calculate
prediction intervals. Must be one of either <code>"naive"</code> or
<code>"boot"</code>.</p>
</td></tr>
<tr><td><code id="add_pi.survreg_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>add_pi.survreg</code> creates prediction intervals for the survival
time $T$ conditioned on the covariates of the <code>survreg</code>
model. In simple terms, this function calculates error bounds
within which one can expect to observe a new survival time. Like
other parametric survival methods in <code>ciTools</code>, prediction
intervals are limited to unweighted lognormal, exponential,
weibull, and loglogistic AFT models.
</p>
<p>Two methods are available for creating prediction intervals, the
&quot;naive&quot; method (Meeker and Escobar, chapter 8) and a simulation
method that implements a parametric bootstrap routine. The &quot;naive&quot;
method calculates quantiles of the fitted survival time
distribution to determine prediction intervals. The parametric
bootstrap method simulates new survival times from the conditional
survival time distribution, taking into account the uncertainty in
the regression coefficients. The bootstrap method is similar to the
one implemented in <code>add_pi.glm</code>.
</p>
<p>Note: Due to a limitation, the <code>Surv</code> object must be specified in
<code>survreg</code> function call. See the examples section for one way
to do this.
</p>
<p>Note: <code>add_pi.survreg</code> cannot inspect the convergence of
<code>fit</code>. Poor maximum likelihood estimates will result in poor
prediction intervals. Inspect any warning messages given from
<code>survreg</code>.
</p>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted medians, upper and lower
prediction bounds attached.
</p>


<h3>References</h3>

<p>For a discussion prediction intervals of accelerated failure time models:
Meeker, William Q., and Luis A. Escobar. Statistical methods for reliability data. John Wiley &amp; Sons, 2014. (Chapter 8)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_ci.survreg">add_ci.survreg</a></code> for confidence intervals for
<code>survreg</code> objects, <code><a href="#topic+add_probs.survreg">add_probs.survreg</a></code> for
conditional survival probabilities of <code>survreg</code> objects, and
<code><a href="#topic+add_quantile.survreg">add_quantile.survreg</a></code> for survival time quantiles
of <code>survreg</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Define a data set.
df &lt;- survival::stanford2
## remove a covariate with missing values.
df &lt;- df[, 1:4]
## next, create the Surv object inside the survreg call:
fit &lt;- survival::survreg(survival::Surv(time, status) ~ age + I(age^2),
                         data = df, dist = "lognormal")
add_pi(df, fit, alpha = 0.1, names = c("lwr", "upr"))

## Try a different model:
fit2 &lt;- survival::survreg(survival::Surv(time, status) ~ age + I(age^2),
                          data = df, dist = "weibull")
add_pi(df, fit2, alpha = 0.1, names = c("lwr", "upr"))

</code></pre>

<hr>
<h2 id='add_probs'>Add Regression Probabilities to Data Frames</h2><span id='topic+add_probs'></span>

<h3>Description</h3>

<p>This is a generic function to append response level probabilities
to a data frame. A response level probability (conditioned on the
model and covariates), such as <code class="reqn">Pr(Response|Covariates &lt; 10)</code>,
is generated for the fitted value of each observation in
<code>df</code>. These probabilities are then appended to <code>df</code> and
returned to the user as a data frame.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_probs(df, fit, q, name = NULL, yhatName = "pred", comparison, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_probs_+3A_df">df</code></td>
<td>
<p>A data frame of new data.</p>
</td></tr>
<tr><td><code id="add_probs_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>lm</code>, <code>glm</code>, or
<code>lmerMod</code>. Predictions are made with this object.</p>
</td></tr>
<tr><td><code id="add_probs_+3A_q">q</code></td>
<td>
<p>A real number. A quantile of the conditional response
distribution.</p>
</td></tr>
<tr><td><code id="add_probs_+3A_name">name</code></td>
<td>
<p><code>NULL</code> or character vector of length one. If
<code>NULL</code>, probabilities automatically will be named by
<code>add_probs</code>, otherwise, the probabilities will be named
<code>name</code> in the returned data frame.</p>
</td></tr>
<tr><td><code id="add_probs_+3A_yhatname">yhatName</code></td>
<td>
<p>A character vector of length one. Names of the</p>
</td></tr>
<tr><td><code id="add_probs_+3A_comparison">comparison</code></td>
<td>
<p>A string. If <code>comparison = "&lt;"</code>, then
<code class="reqn">Pr(Y|x &lt; q)</code> is calculated for each observation in
<code>df</code>. Default is &quot;&lt;&quot;. Must be &quot;&lt;&quot; or &quot;&gt;&quot; for objects of
class <code>lm</code> or <code>lmerMod</code>. If <code>fit</code> is a
<code>glm</code>, then <code>comparison</code> also may be <code>"&lt;="</code> ,
<code>"&gt;="</code> , or <code>"="</code>.</p>
</td></tr>
<tr><td><code id="add_probs_+3A_...">...</code></td>
<td>
<p>Additional arguments</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For more specific information about the arguments that are useful
in each method, consult:
</p>

<ul>
<li> <p><code><a href="#topic+add_probs.lm">add_probs.lm</a></code> for linear regression response probabilities
</p>
</li>
<li> <p><code><a href="#topic+add_probs.glm">add_probs.glm</a></code> for generalized linear regression response probabilities
</p>
</li>
<li> <p><code><a href="#topic+add_probs.lmerMod">add_probs.lmerMod</a></code> for linear mixed models response probabilities
</p>
</li>
<li> <p><code><a href="#topic+add_probs.glmerMod">add_probs.glmerMod</a></code> for generalized linear mixed model response probabilities
</p>
</li>
<li> <p><code><a href="#topic+add_probs.survreg">add_probs.survreg</a></code> for accelerated failure time model response probabilities
</p>
</li></ul>

<p>Note: Except in <code>add_probs.survreg</code>, the probabilities
calculated by <code>add_probs</code> are on the distribution of
<code class="reqn">Y|x</code>, not <code class="reqn">E[Y|x]</code>. That is, they use the same
distribution from which a prediction interval is determined, not
the distribution that determines a confidence
interval. <code>add_probs.survreg</code> is an exception to this pattern
so that users of accelerated failure time models can obtain
estimates of the survivor function.
</p>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted values and
probabilities attached.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_ci">add_ci</a></code> for confidence intervals,
<code><a href="#topic+add_quantile">add_quantile</a></code> for response level quantiles, and
<code><a href="#topic+add_pi">add_pi</a></code> for prediction intervals.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Define a model
fit &lt;- lm(dist ~ speed, data = cars)

# Calculate the probability that the probability that a new
# dist is less than 20 (Given the model).
add_probs(cars, fit, q = 20)

# Calculate the probability that a new
# dist is greater than 20 (Given the model).
add_probs(cars, fit, q = 20, comparison = "&gt;")

# Try a different model fit.
fit2 &lt;- glm(dist ~ speed, family = "poisson", data = cars)
add_probs(cars, fit2, q = 20)

# Try a different model fit.
fit3 &lt;- lme4::lmer(Reaction ~ Days + (1|Subject), data = lme4::sleepstudy)
add_probs(lme4::sleepstudy, fit3, q = 300, type = "parametric")

# As above, but do not condition on the random effects.
add_probs(lme4::sleepstudy, fit3, q = 300, type = "parametric", includeRanef = FALSE)

</code></pre>

<hr>
<h2 id='add_probs.glm'>Response Probabilities for Generalized Linear Models</h2><span id='topic+add_probs.glm'></span>

<h3>Description</h3>

<p>This is the method <code>add_probs</code> uses if the model fit is an
object of class <code>glm</code>. Probabilities are determined through
simulation, using the same method as <code>add_pi.glm</code>. Currently,
only logistic, Poisson, Quasipoisson, and Gamma models are
supported.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'glm'
add_probs(
  df,
  fit,
  q,
  name = NULL,
  yhatName = "pred",
  comparison = "&lt;",
  nSims = 2000,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_probs.glm_+3A_df">df</code></td>
<td>
<p>A data frame of new data.</p>
</td></tr>
<tr><td><code id="add_probs.glm_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>glm</code>. Predictions are made with
this object.</p>
</td></tr>
<tr><td><code id="add_probs.glm_+3A_q">q</code></td>
<td>
<p>A double. A quantile of the response distribution.</p>
</td></tr>
<tr><td><code id="add_probs.glm_+3A_name">name</code></td>
<td>
<p><code>NULL</code> or a string. If <code>NULL</code>, probabilities
automatically will be named by <code>add_probs()</code>, otherwise,
the probabilities will be named <code>name</code> in the returned
dataframe.</p>
</td></tr>
<tr><td><code id="add_probs.glm_+3A_yhatname">yhatName</code></td>
<td>
<p>A string. Name of the vector of predictions.</p>
</td></tr>
<tr><td><code id="add_probs.glm_+3A_comparison">comparison</code></td>
<td>
<p>A character vector of length one. If
<code>comparison = "&lt;"</code>, then <code class="reqn">Pr(Y|X &lt; q)</code> is
calculated. Any comparison is allowed in Poisson regression,
but only certain comparisons may be made in Logistic
regression. See the Details section.</p>
</td></tr>
<tr><td><code id="add_probs.glm_+3A_nsims">nSims</code></td>
<td>
<p>A positive integer. Controls the number of simulated
draws to make if the model is Poisson.</p>
</td></tr>
<tr><td><code id="add_probs.glm_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Any of the five comparisons may be made for a Poisson,
quasipoisson, or Gamma model: <code>comparison = "&lt;"</code>, <code>"&gt;"</code>,
<code>"="</code>, <code>"&lt;="</code>, or <code>"&gt;="</code>. For logistic regression,
the comparison statement must be equivalent to <code class="reqn">Pr(Y|x = 0)</code> or
<code class="reqn">Pr(Y|x = 1)</code>.
</p>
<p>If <code>add_probs</code> is called on a Poisson, quasiPoisson or Gamma
model, a simulation is performed using <code>arm::sim</code>.
</p>
<p>If <code>add_probs</code> is called on a logistic model, the fitted
probabilities are used directly (no simulation is required).
</p>
<p>If <code>add_probs</code> is called on a Gaussian GLM, the returned
probabilities are identical to those given by
<code>add_probs.lm</code>. In this case, the comparisons <code>&lt;</code> and
<code>&lt;=</code> are identical (likewise for <code>&gt;</code> and <code>&gt;=</code>). If
the comparison <code>=</code> is used in the Gaussian GLM, an informative
error is returned.
</p>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted values and
probabilities attached.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_ci.glm">add_ci.glm</a></code> for confidence intervals for
<code>glm</code> objects, <code><a href="#topic+add_pi.glm">add_pi.glm</a></code> for prediction
intervals of <code>glm</code> objects, and
<code><a href="#topic+add_quantile.glm">add_quantile.glm</a></code> for response quantiles of
<code>glm</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Fit a Poisson model
fit &lt;- glm(dist ~ speed, data = cars, family = "poisson")

# Determine the probability that a new dist is less than 20, given
# the Poisson model.
add_probs(cars, fit, q = 20)

# Determine the probability that a new dist is greater than 20,
# given the Poisson model.
add_probs(cars, fit, q = 30, comparison = "&gt;")

# Determine the probability that a new dist is greater than or
# equal to 20, given the Poisson model.
add_probs(cars, fit, q = 30, comparison = "&gt;=")

# Fit a logistic model
fit2 &lt;- glm(I(dist &gt; 30) ~ speed, data = cars, family = "binomial")
add_probs(cars, fit2, q = 0, comparison = "=")
add_probs(cars, fit2, q = 1, comparison = "=")

</code></pre>

<hr>
<h2 id='add_probs.glmerMod'>Response Probabilities for Generalized Linear Mixed Model Predictions</h2><span id='topic+add_probs.glmerMod'></span>

<h3>Description</h3>

<p>This function is one of the methods for <code>add_probs</code>, and is
called automatically when <code>add_probs</code> is used on a <code>fit</code>
of class <code>glmerMod</code>. Probabilities are approximate and
determined via a simulation. This function is experimental.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'glmerMod'
add_probs(
  df,
  fit,
  q,
  name = NULL,
  yhatName = "pred",
  comparison = "&lt;",
  type = "boot",
  includeRanef = TRUE,
  nSims = 10000,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_probs.glmerMod_+3A_df">df</code></td>
<td>
<p>A data frame of new data.</p>
</td></tr>
<tr><td><code id="add_probs.glmerMod_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>glmerMod</code>.</p>
</td></tr>
<tr><td><code id="add_probs.glmerMod_+3A_q">q</code></td>
<td>
<p>A double. A quantile of the response distribution.</p>
</td></tr>
<tr><td><code id="add_probs.glmerMod_+3A_name">name</code></td>
<td>
<p><code>NULL</code> or character vector of length one. If
<code>NULL</code>, response probabilities automatically will be named
by <code>add_probs</code>,</p>
</td></tr>
<tr><td><code id="add_probs.glmerMod_+3A_yhatname">yhatName</code></td>
<td>
<p><code>NULL</code> or a string. Name of the predictions
vector.</p>
</td></tr>
<tr><td><code id="add_probs.glmerMod_+3A_comparison">comparison</code></td>
<td>
<p>A string. If <code>comparison = "&lt;"</code>, then
<code class="reqn">Pr(Y|x &lt; q)</code> is calculated for each observation in
<code>df</code>. Default is &quot;&lt;&quot;. Must be &quot;&lt;&quot; or &quot;&gt;&quot; for objects of
class <code>lm</code> or <code>lmerMod</code>. If <code>fit</code> is a
<code>glm</code> or <code>glmerMod</code>, then <code>comparison</code> also may
be <code>"&lt;="</code> , <code>"&gt;="</code> , or <code>"="</code>.</p>
</td></tr>
<tr><td><code id="add_probs.glmerMod_+3A_type">type</code></td>
<td>
<p>A string. Must be <code>"boot"</code>, If <code>type =
"boot"</code>, then <code>add_ci</code> calls <code>lme4::simulate</code> to
calculate the probabilities.</p>
</td></tr>
<tr><td><code id="add_probs.glmerMod_+3A_includeranef">includeRanef</code></td>
<td>
<p>A logical. Default is <code>TRUE</code>. Set whether
the predictions and intervals should be made conditional on the
random effects. If <code>FALSE</code>, random effects will not be
included.</p>
</td></tr>
<tr><td><code id="add_probs.glmerMod_+3A_nsims">nSims</code></td>
<td>
<p>A positive integer.  Controls the number of bootstrap
replicates if <code>type = "boot"</code>.</p>
</td></tr>
<tr><td><code id="add_probs.glmerMod_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>IncludeRanef</code> is False, random slopes and intercepts are set to 0. Unlike in
'lmer' fits, settings random effects to 0 does not mean they are marginalized out. Consider
generalized estimating equations if this is desired.
</p>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted values and estimated
probabilities attached.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_pi.glmerMod">add_pi.glmerMod</a></code> for prediction intervals
of <code>glmerMod</code> objects, <code><a href="#topic+add_ci.glmerMod">add_ci.glmerMod</a></code> for
confidence intervals of <code>glmerMod</code> objects, and
<code><a href="#topic+add_quantile.glmerMod">add_quantile.glmerMod</a></code> for response quantiles of
<code>glmerMod</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>n &lt;- 300
x &lt;- runif(n)
f &lt;- factor(sample(1:5, size = n, replace = TRUE))
y &lt;- rpois(n, lambda = exp(1 - 0.05 * x * as.numeric(f) + 2 * as.numeric(f)))
df &lt;- data.frame(x = x, f = f, y = y)
fit &lt;- lme4::glmer(y ~ (1+x|f), data=df, family = "poisson")

add_probs(df, fit, name = "p0.6", q = 0.6, nSims = 500)

</code></pre>

<hr>
<h2 id='add_probs.lm'>Response Level Probabilities for Linear Models</h2><span id='topic+add_probs.lm'></span>

<h3>Description</h3>

<p>This is the method <code>add_probs</code> uses if the model is of class
<code>lm</code>. Probabilities are calculated parametrically,
using a pivotal quantity.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'lm'
add_probs(
  df,
  fit,
  q,
  name = NULL,
  yhatName = "pred",
  comparison = "&lt;",
  log_response = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_probs.lm_+3A_df">df</code></td>
<td>
<p>A data frame of new data.</p>
</td></tr>
<tr><td><code id="add_probs.lm_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>lm</code>. Predictions are made with
this object.</p>
</td></tr>
<tr><td><code id="add_probs.lm_+3A_q">q</code></td>
<td>
<p>A real number. A quantile of the response distribution.</p>
</td></tr>
<tr><td><code id="add_probs.lm_+3A_name">name</code></td>
<td>
<p><code>NULL</code> or a string. If <code>NULL</code>, probabilities
automatically will be named by <code>add_probs</code>, otherwise, the
probabilities will be named <code>name</code> in the returned data frame.</p>
</td></tr>
<tr><td><code id="add_probs.lm_+3A_yhatname">yhatName</code></td>
<td>
<p>A character vector of length one. Names of the</p>
</td></tr>
<tr><td><code id="add_probs.lm_+3A_comparison">comparison</code></td>
<td>
<p><code>"&lt;"</code>, or <code>"&gt;"</code>. If <code>comparison =
"&lt;"</code>, then <code class="reqn">Pr(Y|x &lt; q)</code> is calculated for each observation in
<code>df</code>. Otherwise, <code class="reqn">Pr(Y|x &gt; q)</code> is calculated.</p>
</td></tr>
<tr><td><code id="add_probs.lm_+3A_log_response">log_response</code></td>
<td>
<p>A logical. Default is <code>FALSE</code>. Set to
<code>TRUE</code> if the model is log-linear: <code class="reqn">\log(Y) = X \beta
+ \epsilon</code>.</p>
</td></tr>
<tr><td><code id="add_probs.lm_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted values and
probabilities attached.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_ci.lm">add_ci.lm</a></code> for confidence intervals for
<code>lm</code> objects, <code><a href="#topic+add_pi.lm">add_pi.lm</a></code> for prediction
intervals of <code>lm</code> objects, and
<code><a href="#topic+add_quantile.lm">add_quantile.lm</a></code> for response quantiles of
<code>lm</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Fit a linear model
fit &lt;- lm(dist ~ speed, data = cars)

# Calculate the probability that a new dist will be less than 20,
# given the model.
add_probs(cars, fit, q = 20)

# Calculate the probability that a new dist will be greater than
# 30, given the model.
add_probs(cars, fit, q = 30, comparison = "&gt;")

</code></pre>

<hr>
<h2 id='add_probs.lmerMod'>Response Probabilities for Linear Mixed Models</h2><span id='topic+add_probs.lmerMod'></span>

<h3>Description</h3>

<p>This function is one of the methods of <code>add_probs</code>, and is
called automatically when <code>add_probs</code> is used on a <code>fit</code>
of class <code>lmerMod</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'lmerMod'
add_probs(
  df,
  fit,
  q,
  name = NULL,
  yhatName = "pred",
  comparison = "&lt;",
  type = "parametric",
  includeRanef = TRUE,
  nSims = 10000,
  log_response = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_probs.lmerMod_+3A_df">df</code></td>
<td>
<p>A data frame of new data.</p>
</td></tr>
<tr><td><code id="add_probs.lmerMod_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>lmerMod</code>.</p>
</td></tr>
<tr><td><code id="add_probs.lmerMod_+3A_q">q</code></td>
<td>
<p>A real number. A quantile of the conditional response
distribution.</p>
</td></tr>
<tr><td><code id="add_probs.lmerMod_+3A_name">name</code></td>
<td>
<p><code>NULL</code> or a string. If <code>NULL</code>, probabilities
automatically will be named by <code>add_probs</code>, otherwise, the
probabilities will be named <code>name</code> in the returned data frame.</p>
</td></tr>
<tr><td><code id="add_probs.lmerMod_+3A_yhatname">yhatName</code></td>
<td>
<p>A string. Name of the vector of predictions.</p>
</td></tr>
<tr><td><code id="add_probs.lmerMod_+3A_comparison">comparison</code></td>
<td>
<p>A character vector of length one. Must be either
<code>"&lt;"</code> or <code>"&gt;"</code>. If <code>comparison = "&lt;"</code>, then
<code class="reqn">Pr(Y|x &lt; q)</code> is calculated for each x in the new data,
<code>df</code>. Otherwise, <code class="reqn">Pr(Y|x &gt; q)</code> is calculated.</p>
</td></tr>
<tr><td><code id="add_probs.lmerMod_+3A_type">type</code></td>
<td>
<p>A string, either <code>"parametric"</code> or
<code>"boot"</code>. Determines the method used to determine the
probabilities.</p>
</td></tr>
<tr><td><code id="add_probs.lmerMod_+3A_includeranef">includeRanef</code></td>
<td>
<p>A logical. If <code>TRUE</code>, probabilities and
predictions will be calculated at the group level. If
<code>FALSE</code>, random effects will not be included, and
probabilities will be calculated at the population level.</p>
</td></tr>
<tr><td><code id="add_probs.lmerMod_+3A_nsims">nSims</code></td>
<td>
<p>A positive integer. If <code>type = "boot"</code>,
<code>nSims</code> will determine the number of bootstrap simulations to
perform.</p>
</td></tr>
<tr><td><code id="add_probs.lmerMod_+3A_log_response">log_response</code></td>
<td>
<p>A logical. Set to <code>TRUE</code> if your model is
a log-linear mixed model: <code class="reqn">log(Y) = X \beta + Z \gamma +
\epsilon</code>.</p>
</td></tr>
<tr><td><code id="add_probs.lmerMod_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It is recommended that one perform a parametric bootstrap to
determine these probabilities. To do so, use the option <code>type
= "boot"</code>.
</p>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predictions and probabilities
attached.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_ci.lmerMod">add_ci.lmerMod</a></code> for confidence intervals
for <code>lmerMod</code> objects, <code><a href="#topic+add_pi.lmerMod">add_pi.lmerMod</a></code> for
prediction intervals of <code>lmerMod</code> objects, and
<code><a href="#topic+add_quantile.lmerMod">add_quantile.lmerMod</a></code> for response quantiles of
<code>lmerMod</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dat &lt;- lme4::sleepstudy

# Fit a random intercept model
fit &lt;- lme4::lmer(Reaction ~ Days + (1|Subject), data = lme4::sleepstudy)

# What is the probability that a new reaction time will be less
# than 300? (given the random effects).
add_probs(dat, fit, q = 300)

# What is the probability that a new reaction time will be greater
# than 300? (ignoring the random effects).
add_probs(dat, fit, q = 300, includeRanef = FALSE, comparison = "&gt;")

</code></pre>

<hr>
<h2 id='add_probs.negbin'>Response Probabilities for Negative Binomial Models</h2><span id='topic+add_probs.negbin'></span>

<h3>Description</h3>

<p>This is the method <code>add_probs</code> uses if the model fit is an
object of class <code>negbin</code>. Probabilities are determined through
simulation, using the same method as <code>add_pi.negbin</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'negbin'
add_probs(
  df,
  fit,
  q,
  name = NULL,
  yhatName = "pred",
  comparison = "&lt;",
  nSims = 2000,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_probs.negbin_+3A_df">df</code></td>
<td>
<p>A data frame of new data.</p>
</td></tr>
<tr><td><code id="add_probs.negbin_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>negbin</code>. Predictions are made
with this object.</p>
</td></tr>
<tr><td><code id="add_probs.negbin_+3A_q">q</code></td>
<td>
<p>A double. A quantile of the response distribution.</p>
</td></tr>
<tr><td><code id="add_probs.negbin_+3A_name">name</code></td>
<td>
<p><code>NULL</code> or a string. If <code>NULL</code>, probabilities
automatically will be named by <code>add_probs()</code>, otherwise,
the probabilities will be named <code>name</code> in the returned
data frame.</p>
</td></tr>
<tr><td><code id="add_probs.negbin_+3A_yhatname">yhatName</code></td>
<td>
<p>A string. Name of the vector of predictions.</p>
</td></tr>
<tr><td><code id="add_probs.negbin_+3A_comparison">comparison</code></td>
<td>
<p>A character vector of length one. Permitted
arguments are <code>"="</code>, <code>"&lt;"</code>, <code>"&lt;="</code>, <code>"&gt;"</code>, or
<code>"&gt;="</code>. The default value is <code>"&lt;"</code>.</p>
</td></tr>
<tr><td><code id="add_probs.negbin_+3A_nsims">nSims</code></td>
<td>
<p>A positive integer. Controls the number of simulated
draws.</p>
</td></tr>
<tr><td><code id="add_probs.negbin_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted values and
probabilities attached.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_ci.negbin">add_ci.negbin</a></code> for confidence intervals for
<code>negbin</code> objects, <code><a href="#topic+add_pi.negbin">add_pi.negbin</a></code> for prediction
intervals of <code>negbin</code> objects, and
<code><a href="#topic+add_quantile.negbin">add_quantile.negbin</a></code> for response quantiles of
<code>negbin</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x1 &lt;- rnorm(100, mean = 1)
y &lt;- MASS::rnegbin(n = 100, mu = exp(1 + x1), theta = 5)
df &lt;- data.frame(x1 = x1, y = y)
fit &lt;- MASS::glm.nb(y ~ x1, data = df)
add_probs(df, fit, q = 50)

</code></pre>

<hr>
<h2 id='add_probs.survreg'>Confidence Intervals for the Survivor Function of Accelerated
Failure Time Models</h2><span id='topic+add_probs.survreg'></span>

<h3>Description</h3>

<p>This function is one of the methods of <code>add_probs</code> and is
automatically called when an object of class <code>survreg</code> is
passed to <code>add_probs</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'survreg'
add_probs(
  df,
  fit,
  q,
  name = NULL,
  yhatName = "median_pred",
  comparison = "&lt;",
  confint = TRUE,
  alpha = 0.05,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_probs.survreg_+3A_df">df</code></td>
<td>
<p>A data frame of new data.</p>
</td></tr>
<tr><td><code id="add_probs.survreg_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>survreg</code>. Predictions are made
with this object.</p>
</td></tr>
<tr><td><code id="add_probs.survreg_+3A_q">q</code></td>
<td>
<p>A double. A quantile of the survival time distribution. In
survival applications this is the time of event.</p>
</td></tr>
<tr><td><code id="add_probs.survreg_+3A_name">name</code></td>
<td>
<p><code>NULL</code> or a string. If <code>NULL</code>, probabilities
automatically will be named by <code>add_probs()</code>, otherwise,
the probabilities will be named <code>name</code> in the returned
data frame.</p>
</td></tr>
<tr><td><code id="add_probs.survreg_+3A_yhatname">yhatName</code></td>
<td>
<p>A string. Name of the vector of predictions.</p>
</td></tr>
<tr><td><code id="add_probs.survreg_+3A_comparison">comparison</code></td>
<td>
<p>A character vector of length one. If
<code>comparison = "&lt;"</code>, then <code class="reqn">Pr(Y|X &lt; q)</code> is
calculated. If <code>comparison = "&gt;"</code>, the survivor function
at time <code>q</code> is calculated.</p>
</td></tr>
<tr><td><code id="add_probs.survreg_+3A_confint">confint</code></td>
<td>
<p>A logical. If <code>TRUE</code>, confidence intervals for
the estimated probabilities will be calculated and appended to
<code>df</code>.</p>
</td></tr>
<tr><td><code id="add_probs.survreg_+3A_alpha">alpha</code></td>
<td>
<p>A number. Control the confidence level of the
confidence intervals if <code>confint = TRUE</code>.</p>
</td></tr>
<tr><td><code id="add_probs.survreg_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Confidence intervals may be produced for estimated probabilities of
accelerated failure time models. Presently, confidence intervals
may be computed for lognormal, weibull, exponential, and
loglogistic failure time models. If <code>comparison = "&lt;"</code>,
confidence intervals are made for the probability that a failure
will be observed before <code>q</code>. Similarly, if <code>comparison =
"&gt;"</code>, confidence intervals will be formed for the probability that
a unit fails after <code>q</code>. In the survival literature,
<code>comparison = "&gt;"</code> corresponds to estimating the survivor
function, <em>S(q)</em>.
</p>
<p>Confidence intervals are produced parametrically via the Delta
Method. Simulations show that under a mild
to moderate amount of censoring, this method performs
adequately.
</p>
<p>The logistic transformation is applied to ensure
that confidence interval bounds lie between <code class="reqn">0</code> and <code class="reqn">1</code>.
</p>
<p>Note: Due to a limitation, the <code>Surv</code> object must be specified in
<code>survreg</code> function call. See the examples section for one way
to do this.
</p>
<p>Note: <code>add_probs.survreg</code> cannot inspect the convergence of
<code>fit</code>. Poor maximum likelihood estimates will result in poor
confidence intervals. Inspect any warning messages given from
<code>survreg</code>.
</p>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted medians, probabilities,
and confidence intervals for predicted probabilities attached.
</p>


<h3>References</h3>

<p>For the logistic transformation of estimated probabilities and error bounds:
Meeker, William Q., and Luis A. Escobar. Statistical methods for reliability data. John Wiley &amp; Sons, 2014. (Chapter 8)
</p>
<p>For a discussion of forming confidence intervals for survival probabilities:
Harrell, Frank E. Regression modeling strategies. Springer, 2015. (Chapter 17)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_ci.survreg">add_ci.survreg</a></code> for confidence intervals for
<code>survreg</code> objects, <code><a href="#topic+add_pi.survreg">add_pi.survreg</a></code> for
prediction intervals of <code>survreg</code> objects, and
<code><a href="#topic+add_quantile.survreg">add_quantile.survreg</a></code> for response quantiles of
<code>survreg</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Define a data set.
df &lt;- survival::stanford2
## remove a covariate with missing values.
df &lt;- df[, 1:4]
## next, create the Surv object inside the survreg call:
fit &lt;- survival::survreg(survival::Surv(time, status) ~ age + I(age^2),
                         data = df, dist = "lognormal")
## Calculate the level 0.75 quantile wit CIs for that quantile
add_probs(df, fit, q = 500, name = c("Fhat", "lwr", "upr"))

## Try a weibull model for the same data:
fit2 &lt;- survival::survreg(survival::Surv(time, status) ~ age + I(age^2),
                          data = df, dist = "weibull")
## Calculate the level 0.75 quantile with CIs for the quantile
add_probs(df, fit2, q = 500, name = c("Fhat", "lwr", "upr"))


</code></pre>

<hr>
<h2 id='add_quantile'>Add Regression Quantiles to Data Frames</h2><span id='topic+add_quantile'></span>

<h3>Description</h3>

<p>This is a generic function to append regression quantiles to a data
frame. A regression quantile <em>q</em> is a point such that
<code class="reqn">Pr(Response | Covariates &lt; q) = p</code>. These quantiles are
generated for the fitted value of each observation in
<code>df</code>. Quantiles are then appended to <code>df</code> and returned to
the user as a data frame.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_quantile(df, fit, p = 0.5, name = NULL, yhatName = "pred", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_quantile_+3A_df">df</code></td>
<td>
<p>A data frame of new data.</p>
</td></tr>
<tr><td><code id="add_quantile_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>lm</code>, <code>glm</code>, or
<code>lmerMod</code>. Predictions are made with this object.</p>
</td></tr>
<tr><td><code id="add_quantile_+3A_p">p</code></td>
<td>
<p>A double. A probability that determines the quantile. Must
be between 0 and 1.</p>
</td></tr>
<tr><td><code id="add_quantile_+3A_name">name</code></td>
<td>
<p><code>NULL</code> or a string. If <code>NULL</code>,
quantiles automatically will be named by <code>add_quantile()</code>,
otherwise, the quantiles will be named <code>name</code> in the
returned data frame.</p>
</td></tr>
<tr><td><code id="add_quantile_+3A_yhatname">yhatName</code></td>
<td>
<p>A string. Name of the vector of predictions.</p>
</td></tr>
<tr><td><code id="add_quantile_+3A_...">...</code></td>
<td>
<p>Additional arguments</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For more specific information about the arguments that are applicable
for each type of model, consult:
</p>

<ul>
<li> <p><code><a href="#topic+add_quantile.lm">add_quantile.lm</a></code> for linear regression response quantiles
</p>
</li>
<li> <p><code><a href="#topic+add_quantile.glm">add_quantile.glm</a></code> for generalized linear regression response quantiles
</p>
</li>
<li> <p><code><a href="#topic+add_quantile.lmerMod">add_quantile.lmerMod</a></code> for linear mixed models response quantiles
</p>
</li>
<li> <p><code><a href="#topic+add_quantile.glmerMod">add_quantile.glmerMod</a></code> for generalized linear mixed models response quantiles
</p>
</li>
<li> <p><code><a href="#topic+add_quantile.survreg">add_quantile.survreg</a></code> for accelerated failure time response quantiles
</p>
</li></ul>

<p>Note: Except in <code>add_ci.survreg</code>, the quantiles that
<code>add_quantile</code> calculates are on the distribution of
<code class="reqn">Y|x</code>, not <code class="reqn">E[Y|x]</code>. That is, they use the same
distribution that determines a prediction interval, not the
distribution that determines a confidence interval.
</p>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted values and
level-<em>p</em> quantiles attached.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_ci">add_ci</a></code> for confidence intervals,
<code><a href="#topic+add_probs">add_probs</a></code> for response level probabilities, and
<code><a href="#topic+add_pi">add_pi</a></code> for prediction intervals
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Fit a linear model
fit &lt;- lm(dist ~ speed, data = cars)

# Find the 0.4 quantile (or 40th percentile) of new distances for
# each observations in cars, conditioned on the linear model.
add_quantile(cars, fit, p = 0.4)

# Fit a Poisson model
fit2 &lt;- glm(dist ~ speed, family = "poisson", data = cars)
# Find the 0.4 quantile (or 40th percentile) of new distances for
# each observation in cars, conditioned on the Poisson model.
add_quantile(cars, fit2, p = 0.4)

# Fit a random intercept linear mixed model
fit3 &lt;- lme4::lmer(Reaction ~ Days + (1|Subject), data = lme4::sleepstudy)
# Find the 0.4 quantile (or 40 percentile) of reaction times for
# each observation in the sleepstudy data. Condition on the model and random effects.
add_quantile(lme4::sleepstudy, fit3, p = 0.4, type = "parametric")


</code></pre>

<hr>
<h2 id='add_quantile.glm'>Quantiles for the Response of a Generalized Linear Model</h2><span id='topic+add_quantile.glm'></span>

<h3>Description</h3>

<p>This function is one of the methods of
<code>add_quantile</code>. Currently, you can only use this function to
compute the quantiles of the response of Poisson, Quasipoisson,
Gamma, or Gaussian regression models.  Quantile estimates for
Bernoulli response variables (i.e., logistic regression) are not
supported.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'glm'
add_quantile(df, fit, p, name = NULL, yhatName = "pred", nSims = 2000, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_quantile.glm_+3A_df">df</code></td>
<td>
<p>A data frame of new data.</p>
</td></tr>
<tr><td><code id="add_quantile.glm_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>glm</code>. Predictions are made with
this object.</p>
</td></tr>
<tr><td><code id="add_quantile.glm_+3A_p">p</code></td>
<td>
<p>A real number between 0 and 1. Sets the probability level
of the quantiles.</p>
</td></tr>
<tr><td><code id="add_quantile.glm_+3A_name">name</code></td>
<td>
<p><code>NULL</code> or a string. If <code>NULL</code>,
quantiles automatically will be named by <code>add_quantile</code>,
otherwise, they will be named <code>name</code>.</p>
</td></tr>
<tr><td><code id="add_quantile.glm_+3A_yhatname">yhatName</code></td>
<td>
<p>A string. Name of the vector of predictions.</p>
</td></tr>
<tr><td><code id="add_quantile.glm_+3A_nsims">nSims</code></td>
<td>
<p>A positive integer. Set the number of simulated draws
to use.</p>
</td></tr>
<tr><td><code id="add_quantile.glm_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Quantiles of generalized linear models are determined by
<code>add_quantile</code> through a simulation using <code>arm::sim</code>. If
a Quasipoisson regression model is fit, simulation using the
Negative Binomial distribution is performed, see Gelman and Hill
(2007).
</p>
<p>If <code>add_quantile.glm</code> is called on a Gaussian GLM with
identity link function, the returned quantiles are identical to
those of <code>add_quantile.lm</code>. If a different link function is
used, the appropriate inverse transformation is applied.
</p>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted values and level
<em>p</em> quantiles attached.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_ci.glm">add_ci.glm</a></code> for confidence intervals for
<code>glm</code> objects, <code><a href="#topic+add_pi.glm">add_pi.glm</a></code> for prediction
intervals of <code>glm</code> objects, and <code><a href="#topic+add_probs.glm">add_probs.glm</a></code>
for response probabilities of <code>glm</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Fit a Poisson GLM
fit &lt;- glm(dist ~ speed, data = cars, family = "poisson")

# What is the 0.3-quantile (or 30th percentile) of new distances,
# given the Poisson model?
add_quantile(cars, fit, p = 0.3)

# As above, but now find the 0.5-quantile (50th percentile), change
# the number of simulations to run, and give the vector of
# quantiles a custom name.
add_quantile(cars, fit, p = 0.5, name = "my_quantile", nSims = 300)


</code></pre>

<hr>
<h2 id='add_quantile.glmerMod'>Response Quantiles for Generalized Linear Mixed Model Predictions</h2><span id='topic+add_quantile.glmerMod'></span>

<h3>Description</h3>

<p>This function is one of the methods for <code>add_pi</code>, and is
called automatically when <code>add_pi</code> is used on a <code>fit</code> of
class <code>glmerMod</code>. This function is experimental.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'glmerMod'
add_quantile(
  df,
  fit,
  p,
  name = NULL,
  yhatName = "pred",
  type = "boot",
  includeRanef = TRUE,
  nSims = 10000,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_quantile.glmerMod_+3A_df">df</code></td>
<td>
<p>A data frame of new data.</p>
</td></tr>
<tr><td><code id="add_quantile.glmerMod_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>glmerMod</code>.</p>
</td></tr>
<tr><td><code id="add_quantile.glmerMod_+3A_p">p</code></td>
<td>
<p>A real number between 0 and 1. Sets the probability level
of the quantiles.</p>
</td></tr>
<tr><td><code id="add_quantile.glmerMod_+3A_name">name</code></td>
<td>
<p><code>NULL</code> or a string. If <code>NULL</code>, quantile
automatically will be named by <code>add_quantile</code></p>
</td></tr>
<tr><td><code id="add_quantile.glmerMod_+3A_yhatname">yhatName</code></td>
<td>
<p><code>NULL</code> or a string. Name of the predictions vector.</p>
</td></tr>
<tr><td><code id="add_quantile.glmerMod_+3A_type">type</code></td>
<td>
<p>A string. Must be <code>"boot"</code>, If <code>type =
"boot"</code>, then <code>add_ci</code> calls <code>lme4::simulate</code> to
calculate the confidence intervals. This method may be time
consuming, but is applicable with random slope and random
intercept models.</p>
</td></tr>
<tr><td><code id="add_quantile.glmerMod_+3A_includeranef">includeRanef</code></td>
<td>
<p>A logical. Default is <code>TRUE</code>. Set whether
the predictions and intervals should be made conditional on the
random effects. If <code>FALSE</code>, random effects will not be
included.</p>
</td></tr>
<tr><td><code id="add_quantile.glmerMod_+3A_nsims">nSims</code></td>
<td>
<p>A positive integer.  Controls the number of bootstrap
replicates.</p>
</td></tr>
<tr><td><code id="add_quantile.glmerMod_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>IncludeRanef</code> is False, random slopes and intercepts are set to 0. Unlike in
'lmer' fits, settings random effects to 0 does not mean they are marginalized out. Consider
generalized estimating equations if this is desired.
</p>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted values and quantiles attached.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_pi.glmerMod">add_pi.glmerMod</a></code> for prediction intervals
of <code>glmerMod</code> objects, <code><a href="#topic+add_probs.glmerMod">add_probs.glmerMod</a></code> for
conditional probabilities of <code>glmerMod</code> objects, and
<code><a href="#topic+add_ci.glmerMod">add_ci.glmerMod</a></code> for confidence intervals of
<code>glmerMod</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>n &lt;- 300
x &lt;- runif(n)
f &lt;- factor(sample(1:5, size = n, replace = TRUE))
y &lt;- rpois(n, lambda = exp(1 - 0.05 * x * as.numeric(f) + 2 * as.numeric(f)))
df &lt;- data.frame(x = x, f = f, y = y)
fit &lt;- lme4::glmer(y ~ (1+x|f), data=df, family = "poisson")

add_quantile(df, fit, name = "quant0.6", p = 0.6, nSims = 500)

</code></pre>

<hr>
<h2 id='add_quantile.lm'>Quantiles for the Response of a Linear Model</h2><span id='topic+add_quantile.lm'></span>

<h3>Description</h3>

<p>This function is one of the methods of <code>add_quantile</code>. It is
called automatically when <code>add_quantile</code> is called on objects
of class <code>lm</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'lm'
add_quantile(
  df,
  fit,
  p,
  name = NULL,
  yhatName = "pred",
  log_response = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_quantile.lm_+3A_df">df</code></td>
<td>
<p>A data frame of new data.</p>
</td></tr>
<tr><td><code id="add_quantile.lm_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>lm</code>. Predictions are made with
this object.</p>
</td></tr>
<tr><td><code id="add_quantile.lm_+3A_p">p</code></td>
<td>
<p>A real number between 0 and 1. Sets the level of the
quantiles.</p>
</td></tr>
<tr><td><code id="add_quantile.lm_+3A_name">name</code></td>
<td>
<p><code>NULL</code> or a string. If <code>NULL</code>,
quantiles automatically will be named by <code>add_quantile</code>,
otherwise, they will be named <code>name</code>.</p>
</td></tr>
<tr><td><code id="add_quantile.lm_+3A_yhatname">yhatName</code></td>
<td>
<p>A string. Name of the vector of predictions.</p>
</td></tr>
<tr><td><code id="add_quantile.lm_+3A_log_response">log_response</code></td>
<td>
<p>A logical. If TRUE, quantiles will be generated
for the prediction made with a log-linear model: <code class="reqn">\log(Y) =
X\beta + \epsilon</code>. These quantiles will be on the scale of the
original response, <code class="reqn">Y</code>.</p>
</td></tr>
<tr><td><code id="add_quantile.lm_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Quantiles for linear models are determined parametrically, by
applying a pivotal quantity to the distribution of <code class="reqn">Y|x</code>.
</p>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted values and level -
<em>p</em> quantiles attached.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_ci.lm">add_ci.lm</a></code> for confidence intervals for
<code>lm</code> objects, <code><a href="#topic+add_pi.lm">add_pi.lm</a></code> for prediction
intervals of <code>lm</code> objects, and <code><a href="#topic+add_probs.lm">add_probs.lm</a></code>
for response probabilities of <code>lm</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Fit a linear Model
fit &lt;- lm(dist ~ speed, data = cars)

# Find the 0.7-quantile (70th percentile) of new distances, given
# the linear model fit.
add_quantile(cars, fit, p = 0.7)

# As above, but with a custom name for the vector of quantiles
add_quantile(cars, fit, p = 0.7, name = "my_quantile")

</code></pre>

<hr>
<h2 id='add_quantile.lmerMod'>Quantiles for the Response of a Linear Mixed Model</h2><span id='topic+add_quantile.lmerMod'></span>

<h3>Description</h3>

<p>This function is one of the methods for <code>add_quantile</code> and
is called automatically when <code>add_quantile</code> is applied to an
object of class <code>lmerMod</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'lmerMod'
add_quantile(
  df,
  fit,
  p,
  name = NULL,
  yhatName = "pred",
  includeRanef = TRUE,
  type = "boot",
  nSims = 10000,
  log_response = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_quantile.lmerMod_+3A_df">df</code></td>
<td>
<p>A data frame of new data.</p>
</td></tr>
<tr><td><code id="add_quantile.lmerMod_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>lm</code>. Predictions are made with
this object.</p>
</td></tr>
<tr><td><code id="add_quantile.lmerMod_+3A_p">p</code></td>
<td>
<p>A real number between 0 and 1.  Determines the probability
level of the quantiles.</p>
</td></tr>
<tr><td><code id="add_quantile.lmerMod_+3A_name">name</code></td>
<td>
<p><code>NULL</code> or a string. If <code>NULL</code>, quantiles
automatically will be named by <code>add_quantile</code>, otherwise,
they will be named <code>name</code>.</p>
</td></tr>
<tr><td><code id="add_quantile.lmerMod_+3A_yhatname">yhatName</code></td>
<td>
<p>A string. Determines the name of the column of
predictions.</p>
</td></tr>
<tr><td><code id="add_quantile.lmerMod_+3A_includeranef">includeRanef</code></td>
<td>
<p>The random effects be included or not? If
<code>TRUE</code>, quantiles will be calculated at the
&quot;group level&quot;. Otherwise, quantiles will be calculated at the
&quot;population level&quot;, where random effects are set to <code class="reqn">0</code>.</p>
</td></tr>
<tr><td><code id="add_quantile.lmerMod_+3A_type">type</code></td>
<td>
<p>A string. Options are <code>"parametric"</code> or
<code>"boot"</code>.</p>
</td></tr>
<tr><td><code id="add_quantile.lmerMod_+3A_nsims">nSims</code></td>
<td>
<p>A positive integer. Set the number of bootstrap
simulations to perform. Only applied when <code>type = "boot"</code>.</p>
</td></tr>
<tr><td><code id="add_quantile.lmerMod_+3A_log_response">log_response</code></td>
<td>
<p>A logical. Set to <code>TRUE</code> if the model is a
log-linear mixed model: <code class="reqn">\log(Y) = X\beta + Z\gamma +
\epsilon</code>.</p>
</td></tr>
<tr><td><code id="add_quantile.lmerMod_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>add_qauntile.lmerMod</code> may use one of two different methods
for determining quantiles: a parametric method or a parametric
bootstrap method (via <code>lme4::simulate</code>). The parametric method
is the default. Only use the parametric method (<code>type =
"parametric"</code>) if <code>fit</code> is a random intercept model,
e.g. <code>fit = lmer(y ~ x + (1|group))</code>. If your model of
interest is random slope and random intercept, use the parametric
bootstrap method (<code>type = "boot"</code>).
</p>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted values and level-p
quantiles attached.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_ci.lmerMod">add_ci.lmerMod</a></code> for confidence intervals
for <code>lmerMod</code> objects, <code><a href="#topic+add_pi.lmerMod">add_pi.lmerMod</a></code> for
prediction intervals of <code>lmerMod</code> objects, and
<code><a href="#topic+add_probs.lmerMod">add_probs.lmerMod</a></code> for response probabilities of
<code>lmerMod</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dat &lt;- lme4::sleepstudy

# Fit a random intercept model
fit &lt;- lme4::lmer(Reaction ~ Days + (1|Subject), data = lme4::sleepstudy)

# Using the parametric method: given the model fit, what value
# of reaction time do we expect half of new reaction times to fall
# under?
add_quantile(dat, fit, p = 0.5)

# Using the parametric method:
# as above, but we ignore the random effects.
add_quantile(dat, fit, p = 0.5, includeRanef = FALSE)

</code></pre>

<hr>
<h2 id='add_quantile.negbin'>Quantiles for the Response of a Negative Binomial Regression</h2><span id='topic+add_quantile.negbin'></span>

<h3>Description</h3>

<p>This function is one of the methods of <code>add_quantile</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'negbin'
add_quantile(df, fit, p, name = NULL, yhatName = "pred", nSims = 2000, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_quantile.negbin_+3A_df">df</code></td>
<td>
<p>A data frame of new data.</p>
</td></tr>
<tr><td><code id="add_quantile.negbin_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>negbin</code>. Predictions are made with
this object.</p>
</td></tr>
<tr><td><code id="add_quantile.negbin_+3A_p">p</code></td>
<td>
<p>A real number between 0 and 1. Sets the probability level
of the quantiles.</p>
</td></tr>
<tr><td><code id="add_quantile.negbin_+3A_name">name</code></td>
<td>
<p><code>NULL</code> or a string. If <code>NULL</code>,
quantiles automatically will be named by <code>add_quantile</code>,
otherwise, they will be named <code>name</code>.</p>
</td></tr>
<tr><td><code id="add_quantile.negbin_+3A_yhatname">yhatName</code></td>
<td>
<p>A string. Name of the vector of predictions.</p>
</td></tr>
<tr><td><code id="add_quantile.negbin_+3A_nsims">nSims</code></td>
<td>
<p>A positive integer. Set the number of simulated draws
to use.</p>
</td></tr>
<tr><td><code id="add_quantile.negbin_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Quantiles of Negative Binomial linear models are determined by
<code>add_quantile</code> through a simulation using <code>arm::sim</code>.
</p>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted values and level
<em>p</em> quantiles attached.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_ci.negbin">add_ci.negbin</a></code> for confidence intervals for
<code>negbin</code> objects, <code><a href="#topic+add_pi.negbin">add_pi.negbin</a></code> for prediction
intervals of <code>negbin</code> objects, and <code><a href="#topic+add_probs.negbin">add_probs.negbin</a></code>
for response probabilities of <code>negbin</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x1 &lt;- rnorm(100, mean = 1)
y &lt;- MASS::rnegbin(n = 100, mu = exp(1 + x1), theta = 5)
df &lt;- data.frame(x1 = x1, y = y)
fit &lt;- MASS::glm.nb(y ~ x1, data = df)
add_quantile(df, fit, p = 0.3)

</code></pre>

<hr>
<h2 id='add_quantile.survreg'>Confidence Intervals for Predicted Survival Time Quantiles of
Accelerated Failure Time Models</h2><span id='topic+add_quantile.survreg'></span>

<h3>Description</h3>

<p>This function is one of the methods of <code>add_quantile</code> and is
automatically called when an object of class <code>survreg</code> is
passed to <code>add_quantile</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'survreg'
add_quantile(
  df,
  fit,
  p = 0.5,
  name = NULL,
  yhatName = "median_pred",
  confint = TRUE,
  alpha = 0.1,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="add_quantile.survreg_+3A_df">df</code></td>
<td>
<p>A data frame of new data.</p>
</td></tr>
<tr><td><code id="add_quantile.survreg_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>survreg</code>. Predictions are made
with this object.</p>
</td></tr>
<tr><td><code id="add_quantile.survreg_+3A_p">p</code></td>
<td>
<p>A real number between 0 and 1. Sets the probability level
of the quantiles.</p>
</td></tr>
<tr><td><code id="add_quantile.survreg_+3A_name">name</code></td>
<td>
<p><code>NULL</code> or a character vector of length 3. If
<code>NULL</code>, quantiles automatically will be named by
<code>add_quantile</code>, otherwise, they will be named <code>name</code>.</p>
</td></tr>
<tr><td><code id="add_quantile.survreg_+3A_yhatname">yhatName</code></td>
<td>
<p>A string. Name of the vector of predictions.</p>
</td></tr>
<tr><td><code id="add_quantile.survreg_+3A_confint">confint</code></td>
<td>
<p>A logical. If <code>TRUE</code>, confidence intervals for
the quantiles are also appended to <code>df</code>.</p>
</td></tr>
<tr><td><code id="add_quantile.survreg_+3A_alpha">alpha</code></td>
<td>
<p>A number. Controls the confidence level of the
confidence intervals if <code>confint = TRUE</code>.</p>
</td></tr>
<tr><td><code id="add_quantile.survreg_+3A_...">...</code></td>
<td>
<p>Additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>add_quantile.survreg</code> produces quantiles for the estimated
distribution of survival times from a survreg object. Estimated
quantiles (such as the median survival time) may be calculated for
a range of distributions including lognormal, exponential, weibull,
and loglogistic models. <code>add_quantile.survreg</code> can compute
quantiles through a parametric method based on the Delta
Method. Generally, this method performs well under a mild to
moderate amount of censoring. Parametric intervals are calculated
using a transformation of the confidence intervals produced by
<code>predict.survreg</code> and are mathematically identical to intervals
calculated by a manual Delta Method.
</p>
<p>Unlike other <code>add_quantile</code> methods,
<code>add_quantile.survreg</code> additionally produces confidence
intervals for predicted quantiles by default. This may optionally
be disabled by switching the <code>confint</code> argument.
</p>
<p>Note: Due to a limitation, the <code>Surv</code> object must be specified in
<code>survreg</code> function call. See the examples section for one way
to do this.
</p>
<p>Note: <code>add_quantile.survreg</code> cannot inspect the convergence of
<code>fit</code>. Poor maximum likelihood estimates will result in poor
confidence intervals. Inspect any warning messages given from
<code>survreg</code>.
</p>


<h3>Value</h3>

<p>A dataframe, <code>df</code>, with predicted medians, level <code class="reqn">p</code>
quantiles, and confidence intervals attached.
</p>


<h3>References</h3>

<p>For descriptions of the log-location scale models supported:
Meeker, William Q., and Luis A. Escobar. Statistical methods for reliability data. John Wiley &amp; Sons, 2014. (Chapter 4)
</p>
<p>For a description of the multivariate Delta method:
Meeker, William Q., and Luis A. Escobar. Statistical methods for reliability data. John Wiley &amp; Sons, 2014. (Appendix B.2)
</p>
<p>For a description of Delta Method Confidence Intervals:
Meeker, William Q., and Luis A. Escobar. Statistical methods for reliability data. John Wiley &amp; Sons, 2014. (Chapter 8)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+add_ci.survreg">add_ci.survreg</a></code> for confidence intervals
<code>survreg</code> objects, <code><a href="#topic+add_pi.survreg">add_pi.survreg</a></code> for
prediction intervals of <code>survreg</code> objects, and
<code><a href="#topic+add_probs.survreg">add_probs.survreg</a></code> for survival probabilities of
<code>survreg</code> objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Define a data set:
df &lt;- survival::stanford2
## remove a covariate with missing values:
df &lt;- df[, 1:4]
## next, create the Surv object inside the survreg call:
fit &lt;- survival::survreg(survival::Surv(time, status) ~ age + I(age^2),
                         data = df, dist = "lognormal")
## Calculate the level 0.75 quantile wit CIs for that quantile
add_quantile(df, fit, p = 0.75, name = c("quant", "lwr", "upr"))

## Try a weibull model for the same data:
fit2 &lt;- survival::survreg(survival::Surv(time, status) ~ age + I(age^2),
                          data = df, dist = "weibull")
## Calculate the level 0.75 quantile with CIs for the quantile
add_quantile(df, fit2, p = 0.75, name = c("quant", "lwr", "upr"))

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
