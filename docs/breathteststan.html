<!DOCTYPE html><html><head><title>Help for package breathteststan</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {breathteststan}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#sigma.breathteststanfit'><p>S3 method to exctract the residual standard deviation</p></a></li>
<li><a href='#stan_fit'><p>Bayesian Stan fit to 13C Breath Data</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Stan-Based Fit to Gastric Emptying Curves</td>
</tr>
<tr>
<td>Version:</td>
<td>0.8.5</td>
</tr>
<tr>
<td>Description:</td>
<td>Stan-based curve-fitting function
  for use with package 'breathtestcore' by the same author.
  Stan functions are refactored here for easier testing.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>ByteCompile:</td>
<td>true</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.0.0), methods, Rcpp (&ge; 1.0.6)</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr, purrr, rstan (&ge; 2.26.0), rstantools (&ge; 2.1.1),
stringr, tidyr, breathtestcore (&ge; 0.8.4)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>ggplot2, shinystan, igraph, bayesplot, testthat, covr, knitr,
parallelly, rmarkdown</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>StanHeaders (&ge; 2.26.0), rstan (&ge; 2.26.0), BH (&ge; 1.72),
Rcpp, RcppEigen</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/dmenne/breathteststan">https://github.com/dmenne/breathteststan</a>,
<a href="https://dmenne.github.io/breathteststan/">https://dmenne.github.io/breathteststan/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/dmenne/breathteststan/issues">https://github.com/dmenne/breathteststan/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>GNU make</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Config/testthat/parallel:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-01-13 16:47:09 UTC; Dieter</td>
</tr>
<tr>
<td>Author:</td>
<td>Dieter Menne [aut, cre],
  Menne Biomed Consulting Tuebingen [cph],
  Benjamin Misselwitz [fnd],
  Mark Fox [fnd],
  University Hospital of Zurich, Dep. Gastroenterology [fnd, dtc]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Dieter Menne &lt;dieter.menne@menne-biomed.de&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-01-13 17:20:06 UTC</td>
</tr>
</table>
<hr>
<h2 id='sigma.breathteststanfit'>S3 method to exctract the residual standard deviation</h2><span id='topic+sigma.breathteststanfit'></span>

<h3>Description</h3>

<p>Functions for S3 method defined in breathtestcore for
<code>stan_fit</code> and <code>stan_group fit</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'breathteststanfit'
sigma(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sigma.breathteststanfit_+3A_object">object</code></td>
<td>
<p>A Stan-based fit</p>
</td></tr>
<tr><td><code id="sigma.breathteststanfit_+3A_...">...</code></td>
<td>
<p>Not used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric value giving the sigma (= average residual standard deviation) term
from the Stan fit.
</p>

<hr>
<h2 id='stan_fit'>Bayesian Stan fit to 13C Breath Data</h2><span id='topic+stan_fit'></span>

<h3>Description</h3>

<p>Fits exponential beta curves to 13C breath test series data using
Bayesian Stan methods. See
<a href="https://menne-biomed.de/blog/breath-test-stan">https://menne-biomed.de/blog/breath-test-stan</a> for a comparision between
single curve, mixed-model population and Bayesian methods.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stan_fit(
  data,
  dose = 100,
  sample_minutes = 15,
  student_t_df = 10,
  chains = 2,
  iter = 1000,
  model = "breath_test_1",
  seed = 4711
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stan_fit_+3A_data">data</code></td>
<td>
<p>Data frame or tibble as created by <code><a href="breathtestcore.html#topic+cleanup_data">cleanup_data</a></code>,
with mandatory columns <code>patient_id, group, minute</code> and <code>pdr</code>.
It is recommended to run all data through <code><a href="breathtestcore.html#topic+cleanup_data">cleanup_data</a></code> which
will insert dummy columns for <code>patient_id</code> and <code>minute</code> if the
data are distinct, and report an error if not. Since the Bayesian method
is stabilized by priors, it is possible to fit single curves.</p>
</td></tr>
<tr><td><code id="stan_fit_+3A_dose">dose</code></td>
<td>
<p>Dose of acetate or octanoate. Currently, only one common dose
for all records is supported.</p>
</td></tr>
<tr><td><code id="stan_fit_+3A_sample_minutes">sample_minutes</code></td>
<td>
<p>If mean sampling interval is &lt; sampleMinutes, data are subsampled
using a spline algorithm</p>
</td></tr>
<tr><td><code id="stan_fit_+3A_student_t_df">student_t_df</code></td>
<td>
<p>When student_t_df &lt; 10, the student distribution is used to
model the residuals. Recommended values to model typical outliers are from 3 to 6.
When student_t_df &gt;= 10, the normal distribution is used.</p>
</td></tr>
<tr><td><code id="stan_fit_+3A_chains">chains</code></td>
<td>
<p>Number of chains for Stan</p>
</td></tr>
<tr><td><code id="stan_fit_+3A_iter">iter</code></td>
<td>
<p>Number of iterations for each Stan chain</p>
</td></tr>
<tr><td><code id="stan_fit_+3A_model">model</code></td>
<td>
<p>Name of model; use <code>names(stanmodels)</code> for other models.</p>
</td></tr>
<tr><td><code id="stan_fit_+3A_seed">seed</code></td>
<td>
<p>Optional seed for rstan</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of classes &quot;breathteststanfit&quot; and &quot;breathtestfit&quot; with elements
</p>

<ul>
<li> <p><code>coef</code> Estimated parameters as data frame in a key-value format with
columns <code>patient_id, group, parameter, method</code> and <code>value</code>.
Has an attribute AIC.
</p>
</li>
<li> <p><code>data</code>  The effectively analyzed data. If density of points
is too high, e.g. with BreathId devices, data are subsampled before fitting.
</p>
</li>
<li> <p><code>stan_fit</code> The Stan fit for use with <code>shinystan::launch_shiny</code>
or extraction of chains. 
</p>
</li></ul>



<h3>See Also</h3>

<p>Base methods <code>coef, plot, print</code>; methods from package
<code>broom: tidy, augment</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(breathtestcore)
suppressPackageStartupMessages(library(dplyr))
d = breathtestcore::simulate_breathtest_data(n_records = 3) # default 3 records
data = breathtestcore::cleanup_data(d$data)
# Use more than 80 iterations and 4 chains for serious fits
fit = stan_fit(data, chains = 1, iter = 80)
plot(fit) # calls plot.breathtestfit
# Extract coefficients and compare these with those
# used to generate the data
options(digits = 2)
cf = coef(fit)
cf %&gt;%
  filter(grepl("m|k|beta", parameter )) %&gt;%
  select(-method, -group) %&gt;%
  tidyr::spread(parameter, value) %&gt;%
  inner_join(d$record, by = "patient_id") %&gt;%
  select(patient_id, m_in = m.y, m_out = m.x,
         beta_in = beta.y, beta_out = beta.x,
         k_in = k.y, k_out = k.x)
# For a detailed analysis of the fit, use the shinystan library

library(shinystan)
# launch_shinystan(fit$stan_fit)

# The following plots are somewhat degenerate because
# of the few iterations in stan_fit
suppressPackageStartupMessages(library(rstan))
stan_plot(fit$stan_fit, pars = c("beta[1]","beta[2]","beta[3]"))
stan_plot(fit$stan_fit, pars = c("k[1]","k[2]","k[3]"))
stan_plot(fit$stan_fit, pars = c("m[1]","m[2]","m[3]"))

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
