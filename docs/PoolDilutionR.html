<!DOCTYPE html><html><head><title>Help for package PoolDilutionR</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {PoolDilutionR}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#frac_k_default'><p>Retrieve default k fractionation value for a pool</p></a></li>
<li><a href='#frac_P_default'><p>Retrieve default P fractionation value for a pool</p></a></li>
<li><a href='#Morris2023'><p>Example time series data from a methane dilution pool experiment.</p></a></li>
<li><a href='#pdr_cost'><p>Cost function between observed and predicted pools</p></a></li>
<li><a href='#pdr_estimate_k0'><p>Estimate initial k from heavy isotope concentration data</p></a></li>
<li><a href='#pdr_fractionation'><p>P and k fractionation values</p></a></li>
<li><a href='#pdr_optimize'><p>Optimize production and consumption parameters for pool dilution data</p></a></li>
<li><a href='#pdr_optimize_df'><p>Optimize production and consumption parameters for pool dilution data</p></a></li>
<li><a href='#pdr_predict'><p>Predict total pool, heavy isotope pool, and atom percent</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Calculate Gross Biogeochemical Flux Rates from Isotope Pool
Dilution Data</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Pool dilution is a isotope tracer technique wherein a 
    biogeochemical pool is artifically enriched with its heavy isotopologue 
    and the gross productive and consumptive fluxes of that pool are 
    quantified by the change in pool size and isotopic composition over time. 
    This package calculates gross production and consumption rates from
    closed-system isotopic pool dilution time series data. Pool size 
    concentrations and heavy isotope (e.g., 15N) content are measured over time 
    and the model optimizes production rate (P) and the first order rate 
    constant (k) by minimizing error in the model-predicted total pool size, 
    as well as the isotopic signature. The model optimizes rates by weighting 
    information against the signal:noise ratio of concentration and heavy-
    isotope signatures using measurement precision as well as the magnitude of 
    change over time. The calculations used here are based on von Fischer and 
    Hedin (2002) &lt;<a href="https://doi.org/10.1029%2F2001GB001448">doi:10.1029/2001GB001448</a>&gt; with some modifications.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 3.0.0), knitr, rmarkdown, ggplot2, tibble, tidyr</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-02-14 16:05:48 UTC; morr497</td>
</tr>
<tr>
<td>Author:</td>
<td>Kendalynn A. Morris
    <a href="https://orcid.org/0000-0002-0388-6965"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [cre, aut],
  Ben Bond-Lamberty <a href="https://orcid.org/0000-0001-9525-4633"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Kendalynn A. Morris &lt;kendalynn.morris@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-02-15 12:20:06 UTC</td>
</tr>
</table>
<hr>
<h2 id='frac_k_default'>Retrieve default k fractionation value for a pool</h2><span id='topic+frac_k_default'></span>

<h3>Description</h3>

<p>Retrieve default k fractionation value for a pool
</p>


<h3>Usage</h3>

<pre><code class='language-R'>frac_k_default(pool)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="frac_k_default_+3A_pool">pool</code></td>
<td>
<p>Name of pool, character</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The default entry for <code>pool</code> listed
in <code><a href="#topic+pdr_fractionation">pdr_fractionation</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>frac_k_default("CH4")
</code></pre>

<hr>
<h2 id='frac_P_default'>Retrieve default P fractionation value for a pool</h2><span id='topic+frac_P_default'></span>

<h3>Description</h3>

<p>Retrieve default P fractionation value for a pool
</p>


<h3>Usage</h3>

<pre><code class='language-R'>frac_P_default(pool)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="frac_P_default_+3A_pool">pool</code></td>
<td>
<p>Name of pool, character</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The default entry for <code>pool</code> listed
in <code><a href="#topic+pdr_fractionation">pdr_fractionation</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>frac_P_default("CH4")
</code></pre>

<hr>
<h2 id='Morris2023'>Example time series data from a methane dilution pool experiment.</h2><span id='topic+Morris2023'></span>

<h3>Description</h3>

<p>Sequential measurements of methane concentration and isotopic signature were taken using a Picarro G2920 with a Small Sample Introduction module.
This instrument provides gas concentrations in ppm and signatures in delta-13C, here we provide those data converted into volume of methane and atom percent.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Morris2023
</code></pre>


<h3>Format</h3>


<dl>
<dt>id</dt><dd><p>Sample ID, a factor</p>
</dd>
<dt>time_days</dt><dd><p>time in days between measurements, starting at 0</p>
</dd>
<dt>cal12CH4ml</dt><dd><p>ml of 12C-CH4 at each timestep</p>
</dd>
<dt>cal13CH4ml</dt><dd><p>ml of 13C-CH4 at each timestep</p>
</dd>
<dt>AP_obs</dt><dd><p>atom percent 13C-CH4 at each timestep</p>
</dd>
</dl>


<hr>
<h2 id='pdr_cost'>Cost function between observed and predicted pools</h2><span id='topic+pdr_cost'></span>

<h3>Description</h3>

<p>Cost function between observed and predicted pools
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pdr_cost(
  params,
  time,
  m,
  n,
  m_prec,
  ap_prec,
  P,
  k,
  pool = "CH4",
  frac_P = frac_P_default(pool),
  frac_k = frac_k_default(pool),
  log_progress = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pdr_cost_+3A_params">params</code></td>
<td>
<p>Named list holding optimizer-assigned values for parameters</p>
</td></tr>
<tr><td><code id="pdr_cost_+3A_time">time</code></td>
<td>
<p>Vector of numeric time values; first should be zero</p>
</td></tr>
<tr><td><code id="pdr_cost_+3A_m">m</code></td>
<td>
<p>Observed total pool size, same length as time</p>
</td></tr>
<tr><td><code id="pdr_cost_+3A_n">n</code></td>
<td>
<p>Observed pool size of heavy isotope, same length as time</p>
</td></tr>
<tr><td><code id="pdr_cost_+3A_m_prec">m_prec</code></td>
<td>
<p>Instrument precision for pool size, expressed as a standard deviation</p>
</td></tr>
<tr><td><code id="pdr_cost_+3A_ap_prec">ap_prec</code></td>
<td>
<p>Instrument precision for atom percent, expressed as a standard deviation</p>
</td></tr>
<tr><td><code id="pdr_cost_+3A_p">P</code></td>
<td>
<p>production rate, unit pool size/unit time</p>
</td></tr>
<tr><td><code id="pdr_cost_+3A_k">k</code></td>
<td>
<p>first-order rate constant for consumption, 1/unit time</p>
</td></tr>
<tr><td><code id="pdr_cost_+3A_pool">pool</code></td>
<td>
<p>Name of pool; see <code><a href="#topic+pdr_fractionation">pdr_fractionation</a></code></p>
</td></tr>
<tr><td><code id="pdr_cost_+3A_frac_p">frac_P</code></td>
<td>
<p>Fractionation value for production; see <code><a href="#topic+pdr_fractionation">pdr_fractionation</a></code></p>
</td></tr>
<tr><td><code id="pdr_cost_+3A_frac_k">frac_k</code></td>
<td>
<p>Fractionation value for consumption; see <code><a href="#topic+pdr_fractionation">pdr_fractionation</a></code></p>
</td></tr>
<tr><td><code id="pdr_cost_+3A_log_progress">log_progress</code></td>
<td>
<p>An optional logging function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a cost metric summarizing the difference between the
predicted and observed <code>m</code> (total pool size) and <code>AP</code> (atom percent).
</p>


<h3>Note</h3>

<p>This implements Equations 12-14 from von Fischer and Hedin (2002).
</p>


<h3>Author(s)</h3>

<p>K.A. Morris &amp; B. Bond-Lamberty
</p>


<h3>Examples</h3>

<pre><code class='language-R'>m &lt;- c(10, 8, 6, 5, 4, 3)
n &lt;- c(1, 0.7, 0.6, 0.4, 0.3, 0.2)
pdr_cost(params = list(P = 0.5, k = 0.3), time = 0:5, m, n, m_prec = 0.001, ap_prec = 0.01)
</code></pre>

<hr>
<h2 id='pdr_estimate_k0'>Estimate initial k from heavy isotope concentration data</h2><span id='topic+pdr_estimate_k0'></span>

<h3>Description</h3>

<p>Estimate initial k from heavy isotope concentration data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pdr_estimate_k0(time, n, frac_k, quiet = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pdr_estimate_k0_+3A_time">time</code></td>
<td>
<p>Vector of numeric time values (e.g. days); first should be zero</p>
</td></tr>
<tr><td><code id="pdr_estimate_k0_+3A_n">n</code></td>
<td>
<p>Observed heavy isotope (as a volume), same length as time</p>
</td></tr>
<tr><td><code id="pdr_estimate_k0_+3A_frac_k">frac_k</code></td>
<td>
<p>Fractionation: 13C consumption as a fraction of 12C consumption</p>
</td></tr>
<tr><td><code id="pdr_estimate_k0_+3A_quiet">quiet</code></td>
<td>
<p>Suppress output message, logical</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Initial estimate of k0 (consumption rate constant)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>pdr_estimate_k0(1:5, c(1, 0.9, 0.7, 0.65, 0.4), frac_k = 0.98)
</code></pre>

<hr>
<h2 id='pdr_fractionation'>P and k fractionation values</h2><span id='topic+pdr_fractionation'></span>

<h3>Description</h3>

<p>A compendium of possible production (P) and consumption (k) fractionation
values, by pool.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pdr_fractionation
</code></pre>


<h3>Format</h3>


<dl>
<dt>Pool</dt><dd><p>Name of pool (gas or solid)</p>
</dd>
<dt>frac_P</dt><dd><p>Fractionation value of production (P)</p>
</dd>
<dt>frac_k</dt><dd><p>Fractionation value of consumption (k)</p>
</dd>
<dt>Default</dt><dd><p>Default for this pool? Logical</p>
</dd>
<dt>Source</dt><dd><p>Source paper or URL</p>
</dd>
</dl>



<h3>Note</h3>

<p>Currently there is only one set of fractionation values available,
from von Fischer and Hedin (2002, 10.1029/2001GB001448).
</p>

<hr>
<h2 id='pdr_optimize'>Optimize production and consumption parameters for pool dilution data</h2><span id='topic+pdr_optimize'></span>

<h3>Description</h3>

<p>Optimize production and consumption parameters for pool dilution data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pdr_optimize(
  time,
  m,
  n,
  m_prec,
  ap_prec,
  P,
  k,
  params_to_optimize = c("P", "k"),
  pool = "CH4",
  frac_P = NULL,
  frac_k = NULL,
  other_params = list(),
  cost_fn = pdr_cost,
  prediction_fn = pdr_predict,
  include_progress = FALSE,
  quiet = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pdr_optimize_+3A_time">time</code></td>
<td>
<p>Vector of numeric time values (e.g. days); first should be zero</p>
</td></tr>
<tr><td><code id="pdr_optimize_+3A_m">m</code></td>
<td>
<p>Observed total pool size (as a volume), same length as time</p>
</td></tr>
<tr><td><code id="pdr_optimize_+3A_n">n</code></td>
<td>
<p>Observed heavy isotope (as a volume), same length as time</p>
</td></tr>
<tr><td><code id="pdr_optimize_+3A_m_prec">m_prec</code></td>
<td>
<p>Instrument precision for pool size, expressed as a standard deviation</p>
</td></tr>
<tr><td><code id="pdr_optimize_+3A_ap_prec">ap_prec</code></td>
<td>
<p>Instrument precision for atom percent, expressed as a standard deviation</p>
</td></tr>
<tr><td><code id="pdr_optimize_+3A_p">P</code></td>
<td>
<p>production rate, unit gas/unit time</p>
</td></tr>
<tr><td><code id="pdr_optimize_+3A_k">k</code></td>
<td>
<p>first-order rate constant for consumption, 1/unit time</p>
</td></tr>
<tr><td><code id="pdr_optimize_+3A_params_to_optimize">params_to_optimize</code></td>
<td>
<p>Named vector of parameters (&quot;P&quot;, &quot;k&quot;, &quot;frac_P&quot;,
and/or &quot;frac_k&quot;) to optimize against observations</p>
</td></tr>
<tr><td><code id="pdr_optimize_+3A_pool">pool</code></td>
<td>
<p>Name of pool to use when looking up fractionation values if they
are not supplied; see <code><a href="#topic+pdr_fractionation">pdr_fractionation</a></code></p>
</td></tr>
<tr><td><code id="pdr_optimize_+3A_frac_p">frac_P</code></td>
<td>
<p>Fractionation value for production; see <code><a href="#topic+pdr_fractionation">pdr_fractionation</a></code></p>
</td></tr>
<tr><td><code id="pdr_optimize_+3A_frac_k">frac_k</code></td>
<td>
<p>Fractionation value for consumption; see <code><a href="#topic+pdr_fractionation">pdr_fractionation</a></code></p>
</td></tr>
<tr><td><code id="pdr_optimize_+3A_other_params">other_params</code></td>
<td>
<p>Other parameters pass on to <code><a href="stats.html#topic+optim">optim</a></code></p>
</td></tr>
<tr><td><code id="pdr_optimize_+3A_cost_fn">cost_fn</code></td>
<td>
<p>Cost function to use; the default is <code><a href="#topic+pdr_cost">pdr_cost</a></code></p>
</td></tr>
<tr><td><code id="pdr_optimize_+3A_prediction_fn">prediction_fn</code></td>
<td>
<p>Prediction function that the cost function will use;
the default is <code><a href="#topic+pdr_predict">pdr_predict</a></code></p>
</td></tr>
<tr><td><code id="pdr_optimize_+3A_include_progress">include_progress</code></td>
<td>
<p>Include detailed optimizer progress data in output?</p>
</td></tr>
<tr><td><code id="pdr_optimize_+3A_quiet">quiet</code></td>
<td>
<p>Suppress output messages, logical</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The output of <code><a href="stats.html#topic+optim">optim</a></code>.
</p>


<h3>Note</h3>

<p>Currently there is only one set of fractionation values available in
<code><a href="#topic+pdr_fractionation">pdr_fractionation</a></code>, from von Fischer and Hedin
(2002, 10.1029/2001GB001448).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pdr_optimize_df">pdr_optimize_df</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>tm &lt;- 0:5
m &lt;- c(10, 8, 6, 5, 4, 3)
n &lt;- c(1, 0.7, 0.6, 0.4, 0.3, 0.2)
m_prec &lt;- 0.001
ap_prec &lt;- 0.01

# Optimize values for P (production) and k (consumption), provide starting values for P and k
pdr_optimize(time = tm, m, n, m_prec, ap_prec, P = 0.5, k = 0.3)
# If we don't provide a value for k, it can be estimated from the data
pdr_optimize(tm, m, n, m_prec, ap_prec, P = 0.5)
# Hold k and frac_k constant (ie., k = estimated k0, frac_k = default value), optimize P and frac_P
pdr_optimize(tm, m, n, m_prec, ap_prec, P = 0.5, params_to_optimize = c("P", "frac_P"))
# Optimize only k (provide P and exclude from params_to_optimize)
pdr_optimize(tm, m, n, m_prec, ap_prec, P = 0.5, params_to_optimize = "k")
# Optimize only k, bounding its possible values
op &lt;- list(lower = c("k" = 0.2), upper = c("k" = 0.3))
pdr_optimize(tm, m, n, m_prec, ap_prec, 0.5, 0.27, params_to_optimize = "k", other_params = op)
</code></pre>

<hr>
<h2 id='pdr_optimize_df'>Optimize production and consumption parameters for pool dilution data</h2><span id='topic+pdr_optimize_df'></span>

<h3>Description</h3>

<p>Optimize production and consumption parameters for pool dilution data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pdr_optimize_df(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pdr_optimize_df_+3A_...">...</code></td>
<td>
<p>Parameters to be passed on to <code><a href="#topic+pdr_optimize">pdr_optimize</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>The output of <code><a href="#topic+pdr_optimize">pdr_optimize</a></code> summarized in a data frame,
with one line per parameter estimates (<code>P</code>, <code>k</code>,
<code>frac_P</code>, and/or <code>frac_k</code>).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pdr_optimize">pdr_optimize</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>tm &lt;- 0:5
m &lt;- c(10, 8, 6, 5, 4, 3)
n &lt;- c(1, 0.7, 0.6, 0.4, 0.3, 0.2)
m_prec &lt;- 0.001
ap_prec &lt;- 0.01
# Optimize values for P (production) and k (consumption)
pdr_optimize_df(time = tm, m, n, m_prec, ap_prec, P = 0.5, k = 0.3)
</code></pre>

<hr>
<h2 id='pdr_predict'>Predict total pool, heavy isotope pool, and atom percent</h2><span id='topic+pdr_predict'></span>

<h3>Description</h3>

<p>Predict total pool, heavy isotope pool, and atom percent
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pdr_predict(
  time,
  m0,
  n0,
  P,
  k,
  pool = "CH4",
  frac_P = frac_P_default(pool),
  frac_k = frac_k_default(pool)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pdr_predict_+3A_time">time</code></td>
<td>
<p>Vector of numeric time values (e.g. days); first should be zero</p>
</td></tr>
<tr><td><code id="pdr_predict_+3A_m0">m0</code></td>
<td>
<p>total pool size at time zero, as a volume</p>
</td></tr>
<tr><td><code id="pdr_predict_+3A_n0">n0</code></td>
<td>
<p>pool size of heavy isotope at time zero, as a volume</p>
</td></tr>
<tr><td><code id="pdr_predict_+3A_p">P</code></td>
<td>
<p>production rate, unit gas/unit time</p>
</td></tr>
<tr><td><code id="pdr_predict_+3A_k">k</code></td>
<td>
<p>first-order rate constant for consumption, 1/unit time</p>
</td></tr>
<tr><td><code id="pdr_predict_+3A_pool">pool</code></td>
<td>
<p>Name of pool; see <code><a href="#topic+pdr_fractionation">pdr_fractionation</a></code></p>
</td></tr>
<tr><td><code id="pdr_predict_+3A_frac_p">frac_P</code></td>
<td>
<p>Fractionation value for production; see <code><a href="#topic+pdr_fractionation">pdr_fractionation</a></code></p>
</td></tr>
<tr><td><code id="pdr_predict_+3A_frac_k">frac_k</code></td>
<td>
<p>Fractionation value for consumption; see <code><a href="#topic+pdr_fractionation">pdr_fractionation</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a data frame with <code>mt</code>, <code>nt</code>, and <code>AP_pred</code> (atom percent) for each time step
</p>


<h3>Note</h3>

<p>This is Eq. 11 from von Fischer and Hedin 2002 with a few modifications.
</p>


<h3>Author(s)</h3>

<p>K.A. Morris &amp; B. Bond-Lamberty
</p>


<h3>Examples</h3>

<pre><code class='language-R'>pdr_predict(time = 0:5, m0 = 10, n0 = 1, P = 0.5, k = 0.3)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
