<!DOCTYPE html><html lang="en"><head><title>Help for package arcgisutils</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {arcgisutils}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#arc_agent'><p>Set user-agent for arcgisutils</p></a></li>
<li><a href='#arc_base_req'><p>Generate base request</p></a></li>
<li><a href='#arc_host'><p>Determines Portal Host</p></a></li>
<li><a href='#arc_self_meta'><p>Access the Self Resource</p></a></li>
<li><a href='#arc_token'><p>Manage authorization tokens</p></a></li>
<li><a href='#as_esri_geometry'><p>Create Esri JSON Geometry Objects</p></a></li>
<li><a href='#as_extent'><p>Convert an object to an extent</p></a></li>
<li><a href='#as_features'><p>Create Esri Features</p></a></li>
<li><a href='#as_featureset'><p>Create Esri FeatureSet Objects</p></a></li>
<li><a href='#as_layer'><p>Create Esri layer objects</p></a></li>
<li><a href='#auth_code'><p>Authorization</p></a></li>
<li><a href='#compact'><p>General utility functions</p></a></li>
<li><a href='#detect_errors'><p>Detect errors in parsed json response</p></a></li>
<li><a href='#determine_dims'><p>Determine the dimensions of a geometry object</p></a></li>
<li><a href='#determine_esri_geo_type'><p>Determine Esri Geometry type</p></a></li>
<li><a href='#fetch_layer_metadata'><p>Retrieve metadata</p></a></li>
<li><a href='#infer_esri_type'><p>Esri field type mapping</p></a></li>
<li><a href='#is_date'><p>Date handling</p></a></li>
<li><a href='#parse_esri_json'><p>Parse Esri JSON</p></a></li>
<li><a href='#rbind_results'><p>Combine multiple data.frames</p></a></li>
<li><a href='#validate_crs'><p>Validate CRS object</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>ArcGIS Utility Functions</td>
</tr>
<tr>
<td>Version:</td>
<td>0.3.1</td>
</tr>
<tr>
<td>Description:</td>
<td>Developer oriented utility functions designed to be used as
    the building blocks of R packages that work with ArcGIS Location
    Services. It provides functionality for authorization, Esri JSON
    construction and parsing, as well as other utilities pertaining to
    geometry and Esri type conversions. To support 'ArcGIS Pro' users,
    authorization can be done via 'arcgisbinding'. Installation
    instructions for 'arcgisbinding' can be found at
    <a href="https://r.esri.com/r-bridge-site/docs/installation.html">https://r.esri.com/r-bridge-site/docs/installation.html</a>.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License (&ge; 2)</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/R-ArcGIS/arcgisutils">https://github.com/R-ArcGIS/arcgisutils</a>,
<a href="https://r.esri.com/arcgisutils/">https://r.esri.com/arcgisutils/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/R-ArcGIS/arcgisutils/issues">https://github.com/R-ArcGIS/arcgisutils/issues</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>cli, dbplyr, httr2 (&ge; 1.0.5), RcppSimdJson, rlang, sf, utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>arcgisbinding, collapse (&ge; 2.0.0), data.table, vctrs,
testthat (&ge; 3.0.0), jsonify</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Language:</td>
<td>en</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>Config/rextendr/version:</td>
<td>0.3.1.9000</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>Cargo (Rust's package manager), rustc &gt;= 1.67</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-09-26 16:19:53 UTC; josiahparry</td>
</tr>
<tr>
<td>Author:</td>
<td>Josiah Parry <a href="https://orcid.org/0000-0001-9910-865X"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Kenneth Vernon <a href="https://orcid.org/0000-0003-0098-5092"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Martha Bass <a href="https://orcid.org/0009-0004-0268-5426"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Josiah Parry &lt;josiah.parry@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-09-26 22:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='arc_agent'>Set user-agent for arcgisutils</h2><span id='topic+arc_agent'></span>

<h3>Description</h3>

<p>Override the default user-agent set by httr2 to indicate that a request
came from arcgisutils.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>arc_agent(req)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="arc_agent_+3A_req">req</code></td>
<td>
<p>an httr2 request</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an httr2 request object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>req &lt;- httr2::request("http://example.com")
arc_agent(req)
</code></pre>

<hr>
<h2 id='arc_base_req'>Generate base request</h2><span id='topic+arc_base_req'></span>

<h3>Description</h3>

<p>This function takes a url and creates a basic httr2 request that
adds the user-agent and adds an authorization token to the
<code>X-Esri-Authorization</code> header.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>arc_base_req(
  url,
  token = NULL,
  path = NULL,
  query = NULL,
  error_call = rlang::caller_env()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="arc_base_req_+3A_url">url</code></td>
<td>
<p>a valid url that is passed to <code><a href="httr2.html#topic+request">httr2::request()</a></code></p>
</td></tr>
<tr><td><code id="arc_base_req_+3A_token">token</code></td>
<td>
<p>an object of class <code>httr2_token</code> as generated by <code><a href="#topic+auth_code">auth_code()</a></code>
or related function</p>
</td></tr>
<tr><td><code id="arc_base_req_+3A_path">path</code></td>
<td>
<p>a character vector of paths to be appended to url using <code><a href="httr2.html#topic+req_url">httr2::req_url_path_append()</a></code></p>
</td></tr>
<tr><td><code id="arc_base_req_+3A_query">query</code></td>
<td>
<p>a named vector or named list of query parameters to be appended to the url using <code><a href="httr2.html#topic+req_url">httr2::req_url_query()</a></code></p>
</td></tr>
<tr><td><code id="arc_base_req_+3A_error_call">error_call</code></td>
<td>
<p>the caller environment to be used when propagating errors.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>arc_base_req("https://arcgis.com")
</code></pre>

<hr>
<h2 id='arc_host'>Determines Portal Host</h2><span id='topic+arc_host'></span>

<h3>Description</h3>

<p>Returns a scalar character indicating the host to make requests to.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>arc_host()
</code></pre>


<h3>Details</h3>

<p>By default, the host is ArcGIS Online &lt;<code style="white-space: pre;">&#8288;https://www.arcgis.com&#8288;</code>&gt;. If the
environment variable <code>ARCGIS_HOST</code> is set, it will be returned.
</p>


<h3>Value</h3>

<p>A scalar character, <code>"https://www.arcgis.com"</code> by default.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>arc_host()
</code></pre>

<hr>
<h2 id='arc_self_meta'>Access the Self Resource</h2><span id='topic+arc_self_meta'></span>

<h3>Description</h3>

<p>The function returns the <a href="https://developers.arcgis.com/rest/users-groups-and-items/portal-self.htm"><code style="white-space: pre;">&#8288;/self&#8288;</code></a> resource from the ArcGIS REST API. The <code style="white-space: pre;">&#8288;/self&#8288;</code> endpoint
returns the view of the portal as seen by the current user, whether anonymous
or signed in.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>arc_self_meta(token = arc_token(), error_call = rlang::current_call())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="arc_self_meta_+3A_token">token</code></td>
<td>
<p>an object of class <code>httr2_token</code> as generated by <code><a href="#topic+auth_code">auth_code()</a></code>
or related function</p>
</td></tr>
<tr><td><code id="arc_self_meta_+3A_error_call">error_call</code></td>
<td>
<p>the caller environment to be used when propagating errors.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See the <a href="https://developers.arcgis.com/rest/users-groups-and-items/portal-self.htm">endpoint documentation</a> for more details.
</p>
<p>The Portal Self response can vary based on whether it's called by a user, an app, or both.
</p>
<p>The response includes user and appinfo properties, and the variations in responses are primarily related to these two properties. As the names indicate, the user property includes information about the user making the call, and the appinfo property includes information pertaining to the app that made the call.
</p>


<h3>Value</h3>

<p>A named list.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
set_arc_token(auth_code())
self &lt;- arc_self_meta()
names(self)

## End(Not run)
</code></pre>

<hr>
<h2 id='arc_token'>Manage authorization tokens</h2><span id='topic+arc_token'></span><span id='topic+set_arc_token'></span><span id='topic+unset_arc_token'></span><span id='topic+obj_check_token'></span><span id='topic+check_token_has_user'></span>

<h3>Description</h3>

<p>These functions are used to set, fetch, and check authorization tokens.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>arc_token(token = "ARCGIS_TOKEN")

set_arc_token(token, ...)

unset_arc_token(token = NULL)

obj_check_token(token, call = rlang::caller_env())

check_token_has_user(token, call = rlang::caller_env())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="arc_token_+3A_token">token</code></td>
<td>
<p>for <code>arc_token()</code>, the name of a token to fetch. For <code>set_arc_token()</code>,
it is an <code>httr2_token</code> that will be set. For <code>unset_arc_token()</code>, a character
vector of token names to be unset.</p>
</td></tr>
<tr><td><code id="arc_token_+3A_...">...</code></td>
<td>
<p>named arguments to set <code>httr2_token</code>. Must be valid names and must be an <code>httr2_token</code>.</p>
</td></tr>
<tr><td><code id="arc_token_+3A_call">call</code></td>
<td>
<p>The execution environment of a currently running
function, e.g. <code>call = caller_env()</code>. The corresponding function
call is retrieved and mentioned in error messages as the source
of the error.
</p>
<p>You only need to supply <code>call</code> when throwing a condition from a
helper function which wouldn't be relevant to mention in the
message.
</p>
<p>Can also be <code>NULL</code> or a <a href="rlang.html#topic+topic-defuse">defused function call</a> to
respectively not display any call or hard-code a code to display.
</p>
<p>For more information about error calls, see <a href="rlang.html#topic+topic-error-call">Including function calls in error messages</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It is possible to have multiple authorization tokens in one session. These
functions assist you in managing them.
</p>
<p><code>arc_token()</code> is used to fetch tokens by name. The default token is <code>ARCGIS_TOKEN</code>.
However, they can be any valid character scalar. <code>set_arc_token()</code> will create
store a token with the name <code>ARCGIS_TOKEN</code>. However, you can alternatively
set the tokens by name using a key-value pair. The key is what you would pass
to <code>arc_token()</code> to fetch the <code>httr2_token</code> object. To remove a token that has
been set, use <code>unset_arc_token()</code>.
</p>
<p><code>obj_check_token()</code> is a developer oriented function that can be used to check
if an object is indeed an <code>httr2_token</code>. To check if a token has expired,
<code><a href="#topic+validate_or_refresh_token">validate_or_refresh_token()</a></code> will do so.
</p>
<p><code>check_token_has_user()</code> is a developer oriented function that checks to see
if a token has a <code>username</code> field associated with it.
</p>
<p>For developers:
</p>
<p><code>set_arc_token()</code> uses a package level environment to store the tokens. The
tokens are fetched from the environment using <code>arc_token()</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># create fake tokens
token_a &lt;- httr2::oauth_token("1234", arcgis_host = arc_host())
token_b &lt;- httr2::oauth_token("abcd", arcgis_host = arc_host())

# set token to the default location
set_arc_token(token_a)

# fetch token from the default location
arc_token()

# set token by name
set_arc_token(org_a = token_a, org_b = token_b)

# fetch token by name
arc_token("org_a")
arc_token("org_b")

# unset tokens
unset_arc_token()
unset_arc_token(c("org_a", "org_b"))
</code></pre>

<hr>
<h2 id='as_esri_geometry'>Create Esri JSON Geometry Objects</h2><span id='topic+as_esri_geometry'></span>

<h3>Description</h3>

<p><code>as_esri_geometry()</code> converts an <code>sfg</code> object to a EsriJSON Geometry object as a string.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as_esri_geometry(x, crs = NULL, call = rlang::caller_env())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as_esri_geometry_+3A_x">x</code></td>
<td>
<p>an object of class <code>sfg</code>. Must be one of  <code>"POINT"</code>, <code>"MULTIPOINT"</code>, <code>"LINESTRING"</code>, <code>"MULTILINESTRING"</code>, <code>"POLYGON"</code>, or <code>"MULTIPOLYGON"</code>.</p>
</td></tr>
<tr><td><code id="as_esri_geometry_+3A_crs">crs</code></td>
<td>
<p>the coordinate reference system. It must be interpretable by <code><a href="sf.html#topic+st_crs">sf::st_crs()</a></code>.</p>
</td></tr>
<tr><td><code id="as_esri_geometry_+3A_call">call</code></td>
<td>
<p>The execution environment of a currently running
function, e.g. <code>call = caller_env()</code>. The corresponding function
call is retrieved and mentioned in error messages as the source
of the error.
</p>
<p>You only need to supply <code>call</code> when throwing a condition from a
helper function which wouldn't be relevant to mention in the
message.
</p>
<p>Can also be <code>NULL</code> or a <a href="rlang.html#topic+topic-defuse">defused function call</a> to
respectively not display any call or hard-code a code to display.
</p>
<p>For more information about error calls, see <a href="rlang.html#topic+topic-error-call">Including function calls in error messages</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code><a href="#topic+as_featureset">as_featureset()</a></code> and <code><a href="#topic+as_features">as_features()</a></code> for converting <code>sfc</code> and <code>sf</code> objects into EsriJSON.
</p>


<h3>Value</h3>

<p>a scalar string
</p>


<h3>References</h3>

<p><a href="https://developers.arcgis.com/documentation/common-data-types/geometry-objects.htm">API Reference</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(sf)
# POINT
# create sfg points
xy &lt;- st_point(c(1, 2))
xyz &lt;- st_point(c(1, 2, 3))
xym &lt;- st_point(c(1, 2, 3), dim = "XYM")
xyzm &lt;- st_point(c(1, 2, 3, 4))

as_esri_geometry(xy)
as_esri_geometry(xyz)
as_esri_geometry(xym)
as_esri_geometry(xyzm)

# MULTIPOINT
# vector to create matrix points
set.seed(0)
x &lt;- rnorm(12)

xy &lt;- st_multipoint(matrix(x, ncol = 2))
xyz &lt;- st_multipoint(matrix(x, ncol = 3))
xym &lt;- st_multipoint(matrix(x, ncol = 3), dim = "XYM")
xyzm &lt;- st_multipoint(matrix(x, ncol = 4), dim = "XYM")

as_esri_geometry(xy)
as_esri_geometry(xyz)
as_esri_geometry(xym)
as_esri_geometry(xyzm)

# LINESTRING
xy &lt;- st_linestring(matrix(x, ncol = 2))
xyz &lt;- st_linestring(matrix(x, ncol = 3))
xym &lt;- st_linestring(matrix(x, ncol = 3), dim = "XYM")
xyzm &lt;- st_linestring(matrix(x, ncol = 4), dim = "XYM")

as_esri_geometry(xy)
as_esri_geometry(xyz)
as_esri_geometry(xym)
as_esri_geometry(xyzm)

# MULTILINESTRING
as_esri_geometry(st_multilinestring(list(xy, xy)))
as_esri_geometry(st_multilinestring(list(xyz, xyz)))
as_esri_geometry(st_multilinestring(list(xym, xym)))
as_esri_geometry(st_multilinestring(list(xyzm, xyzm)))

# POLYGON
coords &lt;- rbind(
  c(0, 0, 0, 1),
  c(0, 1, 0, 1),
  c(1, 1, 1, 1),
  c(1, 0, 1, 1),
  c(0, 0, 0, 1)
)

xy &lt;- st_polygon(list(coords[, 1:2]))
xyz &lt;- st_polygon(list(coords[, 1:3]))
xym &lt;- st_polygon(list(coords[, 1:3]), dim = "XYM")
xyzm &lt;- st_polygon(list(coords))

as_esri_geometry(xy)
as_esri_geometry(xyz)
as_esri_geometry(xym)
as_esri_geometry(xyzm)

# MULTIPOLYGON
as_esri_geometry(st_multipolygon(list(xy, xy)))
as_esri_geometry(st_multipolygon(list(xyz, xyz)))
as_esri_geometry(st_multipolygon(list(xym, xym)))
as_esri_geometry(st_multipolygon(list(xyzm, xyzm)))
</code></pre>

<hr>
<h2 id='as_extent'>Convert an object to an extent</h2><span id='topic+as_extent'></span>

<h3>Description</h3>

<p>Given an sf or sfc object create a list that represents the extent of the
object. The result of this function can be parsed directly into json using
<code>jsonify::to_json(x, unbox = TRUE)</code> or included into a list as the extent
component that will be eventually converted into json using the above function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as_extent(x, crs = sf::st_crs(x), call = rlang::caller_env())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as_extent_+3A_x">x</code></td>
<td>
<p>an sf or sfc object</p>
</td></tr>
<tr><td><code id="as_extent_+3A_crs">crs</code></td>
<td>
<p>the CRS of the object. Must be parsable by <code>sf::st_crs()</code></p>
</td></tr>
<tr><td><code id="as_extent_+3A_call">call</code></td>
<td>
<p>The execution environment of a currently running
function, e.g. <code>call = caller_env()</code>. The corresponding function
call is retrieved and mentioned in error messages as the source
of the error.
</p>
<p>You only need to supply <code>call</code> when throwing a condition from a
helper function which wouldn't be relevant to mention in the
message.
</p>
<p>Can also be <code>NULL</code> or a <a href="rlang.html#topic+topic-defuse">defused function call</a> to
respectively not display any call or hard-code a code to display.
</p>
<p>For more information about error calls, see <a href="rlang.html#topic+topic-error-call">Including function calls in error messages</a>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An extent json object. Use <code>jsonify::to_json(x, unbox = TRUE)</code> to convert
to json.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>nc &lt;- sf::st_read(system.file("shape/nc.shp", package = "sf"), quiet = TRUE)
as_extent(nc)
</code></pre>

<hr>
<h2 id='as_features'>Create Esri Features</h2><span id='topic+as_features'></span><span id='topic+as_esri_features'></span>

<h3>Description</h3>

<p>These functions create an array of Esri Feature objects.
Each feature consists of a geometry and attribute field.
The result of <code>as_esri_features()</code> is a JSON array of Features whereas
<code>as_features()</code> is a list that represents the same JSON array. Using
<code>jsonify::to_json(as_features(x), unbox = TRUE)</code> will result in the same
JSON array.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as_features(x, crs = sf::st_crs(x), call = rlang::caller_env())

as_esri_features(x, crs = sf::st_crs(x), call = rlang::caller_env())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as_features_+3A_x">x</code></td>
<td>
<p>an object of class <code>sf</code>, <code>data.frame</code>, or <code>sfc</code>.</p>
</td></tr>
<tr><td><code id="as_features_+3A_crs">crs</code></td>
<td>
<p>the coordinate reference system. It must be interpretable by <code><a href="sf.html#topic+st_crs">sf::st_crs()</a></code>.</p>
</td></tr>
<tr><td><code id="as_features_+3A_call">call</code></td>
<td>
<p>The execution environment of a currently running
function, e.g. <code>call = caller_env()</code>. The corresponding function
call is retrieved and mentioned in error messages as the source
of the error.
</p>
<p>You only need to supply <code>call</code> when throwing a condition from a
helper function which wouldn't be relevant to mention in the
message.
</p>
<p>Can also be <code>NULL</code> or a <a href="rlang.html#topic+topic-defuse">defused function call</a> to
respectively not display any call or hard-code a code to display.
</p>
<p>For more information about error calls, see <a href="rlang.html#topic+topic-error-call">Including function calls in error messages</a>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Either a scalar string or a named list.
</p>


<h3>References</h3>

<p><a href="https://developers.arcgis.com/documentation/common-data-types/feature-object.htm">API Reference</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(sf)
# POINT
# create sfg points
xy &lt;- st_sfc(st_point(c(1, 2)))
xyz &lt;- st_sfc(st_point(c(1, 2, 3)))
xym &lt;- st_sfc(st_point(c(1, 2, 3), dim = "XYM"))

as_esri_features(xy)
as_esri_features(xyz)
as_esri_features(xym)

# MULTIPOINT
# vector to create matrix points
set.seed(0)
x &lt;- rnorm(12)

xy &lt;- st_sfc(st_multipoint(matrix(x, ncol = 2)))
xyz &lt;- st_sfc(st_multipoint(matrix(x, ncol = 3)))
xym &lt;- st_sfc(st_multipoint(matrix(x, ncol = 3), dim = "XYM"))

as_esri_features(xy)
as_esri_features(xyz)
as_esri_features(xym)

# LINESTRING
xy &lt;- st_sfc(st_linestring(matrix(x, ncol = 2)))
xyz &lt;- st_sfc(st_linestring(matrix(x, ncol = 3)))
xym &lt;- st_sfc(st_linestring(matrix(x, ncol = 3), dim = "XYM"))

as_esri_features(xy)
as_esri_features(xyz)
as_esri_features(xym)

# MULTILINESTRING
as_esri_features(st_sfc(st_multilinestring(list(xy[[1]], xy[[1]]))))
as_esri_features(st_sfc(st_multilinestring(list(xyz[[1]], xyz[[1]]))))
as_esri_features(st_sfc(st_multilinestring(list(xym[[1]], xym[[1]]))))

# POLYGON
coords &lt;- rbind(
  c(0, 0, 0, 1),
  c(0, 1, 0, 1),
  c(1, 1, 1, 1),
  c(1, 0, 1, 1),
  c(0, 0, 0, 1)
)

xy &lt;- st_sfc(st_polygon(list(coords[, 1:2])))
xyz &lt;- st_sfc(st_polygon(list(coords[, 1:3])))
xym &lt;- st_sfc(st_polygon(list(coords[, 1:3]), dim = "XYM"))

as_esri_features(xy)
as_esri_features(xyz)
as_esri_features(xym)

# MULTIPOLYGON
as_esri_features(st_sfc(st_multipolygon(list(xy[[1]], xy[[1]]))))
as_esri_features(st_sfc(st_multipolygon(list(xyz[[1]], xyz[[1]]))))
as_esri_features(st_sfc(st_multipolygon(list(xym[[1]], xym[[1]]))))
</code></pre>

<hr>
<h2 id='as_featureset'>Create Esri FeatureSet Objects</h2><span id='topic+as_featureset'></span><span id='topic+as_esri_featureset'></span>

<h3>Description</h3>

<p>These functions create an Esri FeatureSet object. A FeatureSet contains an inner array
of features as well as additional metadata about the the collection such as the
geometry type, spatial reference, and object ID field.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as_featureset(x, crs = sf::st_crs(x), call = rlang::caller_env())

as_esri_featureset(x, crs = sf::st_crs(x), call = rlang::caller_env())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as_featureset_+3A_x">x</code></td>
<td>
<p>an object of class <code>sf</code>, <code>data.frame</code>, or <code>sfc</code>.</p>
</td></tr>
<tr><td><code id="as_featureset_+3A_crs">crs</code></td>
<td>
<p>the coordinate reference system. It must be interpretable by <code><a href="sf.html#topic+st_crs">sf::st_crs()</a></code>.</p>
</td></tr>
<tr><td><code id="as_featureset_+3A_call">call</code></td>
<td>
<p>The execution environment of a currently running
function, e.g. <code>call = caller_env()</code>. The corresponding function
call is retrieved and mentioned in error messages as the source
of the error.
</p>
<p>You only need to supply <code>call</code> when throwing a condition from a
helper function which wouldn't be relevant to mention in the
message.
</p>
<p>Can also be <code>NULL</code> or a <a href="rlang.html#topic+topic-defuse">defused function call</a> to
respectively not display any call or hard-code a code to display.
</p>
<p>For more information about error calls, see <a href="rlang.html#topic+topic-error-call">Including function calls in error messages</a>.</p>
</td></tr>
</table>


<h3>References</h3>

<p><a href="https://developers.arcgis.com/documentation/common-data-types/featureset-object.htm">API Reference</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(sf)
# POINT
# create sfg points
xy &lt;- st_sfc(st_point(c(1, 2)))
xyz &lt;- st_sfc(st_point(c(1, 2, 3)))
xym &lt;- st_sfc(st_point(c(1, 2, 3), dim = "XYM"))

as_esri_featureset(xy)
as_esri_featureset(xyz)
as_esri_featureset(xym)

# MULTIPOINT
# vector to create matrix points
set.seed(0)
x &lt;- rnorm(12)

xy &lt;- st_sfc(st_multipoint(matrix(x, ncol = 2)))
xyz &lt;- st_sfc(st_multipoint(matrix(x, ncol = 3)))
xym &lt;- st_sfc(st_multipoint(matrix(x, ncol = 3), dim = "XYM"))

as_esri_featureset(xy)
as_esri_featureset(xyz)
as_esri_featureset(xym)

# LINESTRING
xy &lt;- st_sfc(st_linestring(matrix(x, ncol = 2)))
xyz &lt;- st_sfc(st_linestring(matrix(x, ncol = 3)))
xym &lt;- st_sfc(st_linestring(matrix(x, ncol = 3), dim = "XYM"))

as_esri_featureset(xy)
as_esri_featureset(xyz)
as_esri_featureset(xym)

# MULTILINESTRING
as_esri_featureset(st_sfc(st_multilinestring(list(xy[[1]], xy[[1]]))))
as_esri_featureset(st_sfc(st_multilinestring(list(xyz[[1]], xyz[[1]]))))
as_esri_featureset(st_sfc(st_multilinestring(list(xym[[1]], xym[[1]]))))

# POLYGON
coords &lt;- rbind(
  c(0, 0, 0, 1),
  c(0, 1, 0, 1),
  c(1, 1, 1, 1),
  c(1, 0, 1, 1),
  c(0, 0, 0, 1)
)

xy &lt;- st_sfc(st_polygon(list(coords[, 1:2])))
xyz &lt;- st_sfc(st_polygon(list(coords[, 1:3])))
xym &lt;- st_sfc(st_polygon(list(coords[, 1:3]), dim = "XYM"))

as_esri_featureset(xy)
as_esri_featureset(xyz)
as_esri_featureset(xym)

# MULTIPOLYGON
as_esri_featureset(st_sfc(st_multipolygon(list(xy[[1]], xy[[1]]))))
as_esri_featureset(st_sfc(st_multipolygon(list(xyz[[1]], xyz[[1]]))))
as_esri_featureset(st_sfc(st_multipolygon(list(xym[[1]], xym[[1]]))))
</code></pre>

<hr>
<h2 id='as_layer'>Create Esri layer objects</h2><span id='topic+as_layer'></span><span id='topic+as_layer_definition'></span><span id='topic+as_feature_collection'></span>

<h3>Description</h3>

<p>These functions are used to generate list objects that can be converted into
json objects that are used in REST API requests. Notably they are used for adding
R objects as items to a portal.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as_layer(
  x,
  name,
  title,
  layer_definition = as_layer_definition(x, name, "object_id", infer_esri_type(x)),
  id = NULL,
  layer_url = NULL,
  legend_url = NULL,
  popup_info = NULL,
  call = rlang::caller_env()
)

as_layer_definition(
  x,
  name,
  object_id_field,
  fields = infer_esri_type(x),
  display_field = NULL,
  drawing_info = NULL,
  has_attachments = FALSE,
  max_scale = 0,
  min_scale = 0,
  templates = NULL,
  type_id_field = NULL,
  types = NULL,
  call = rlang::caller_env()
)

as_feature_collection(
  layers = list(),
  show_legend = TRUE,
  call = rlang::caller_env()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as_layer_+3A_x">x</code></td>
<td>
<p>an object of class <code>data.frame</code>. This can be an <code>sf</code> object or <code>tibble</code> or
any other subclass of <code>data.frame</code>.</p>
</td></tr>
<tr><td><code id="as_layer_+3A_name">name</code></td>
<td>
<p>a scalar character of the name of the layer. Must be unique.</p>
</td></tr>
<tr><td><code id="as_layer_+3A_title">title</code></td>
<td>
<p>A user-friendly string title for the layer that can be used in
a table of contents.</p>
</td></tr>
<tr><td><code id="as_layer_+3A_layer_definition">layer_definition</code></td>
<td>
<p>a layer definition list as created by <code>as_layer_definition()</code>.
A default is derived from <code>x</code> and the <code>name</code> object.</p>
</td></tr>
<tr><td><code id="as_layer_+3A_id">id</code></td>
<td>
<p>A number indicating the index position of the layer in the WMS or map service.</p>
</td></tr>
<tr><td><code id="as_layer_+3A_layer_url">layer_url</code></td>
<td>
<p>default <code>NULL</code>. A string URL to a service that should be used for all queries
against the layer. Used with hosted tiled map services on ArcGIS Online when
there is an associated feature service that allows for queries.</p>
</td></tr>
<tr><td><code id="as_layer_+3A_legend_url">legend_url</code></td>
<td>
<p>default <code>NULL</code>. A string URL to a legend graphic for the layer.
Used with WMS layers. The URL usually contains a GetLegendGraphic request.</p>
</td></tr>
<tr><td><code id="as_layer_+3A_popup_info">popup_info</code></td>
<td>
<p>default <code>NULL</code>. A list that can be converted into a
<a href="https://developers.arcgis.com/documentation/common-data-types/popupinfo.htm">popupInfo</a>
object defining the pop-up window content for the layer. There is no helper for
popupInfo objects.</p>
</td></tr>
<tr><td><code id="as_layer_+3A_call">call</code></td>
<td>
<p>The execution environment of a currently running
function, e.g. <code>call = caller_env()</code>. The corresponding function
call is retrieved and mentioned in error messages as the source
of the error.
</p>
<p>You only need to supply <code>call</code> when throwing a condition from a
helper function which wouldn't be relevant to mention in the
message.
</p>
<p>Can also be <code>NULL</code> or a <a href="rlang.html#topic+topic-defuse">defused function call</a> to
respectively not display any call or hard-code a code to display.
</p>
<p>For more information about error calls, see <a href="rlang.html#topic+topic-error-call">Including function calls in error messages</a>.</p>
</td></tr>
<tr><td><code id="as_layer_+3A_object_id_field">object_id_field</code></td>
<td>
<p>a scalar character vector indicating the name of the
object ID field in the dataset.</p>
</td></tr>
<tr><td><code id="as_layer_+3A_fields">fields</code></td>
<td>
<p>a data.frame describing the fields in <code>x</code>. These values are inferred
by default via <code><a href="#topic+infer_esri_type">infer_esri_type()</a></code>.</p>
</td></tr>
<tr><td><code id="as_layer_+3A_display_field">display_field</code></td>
<td>
<p>default <code>NULL</code>. A scalar character containing the name of the field that
best summarizes the feature. Values from this field are used by default as
the titles for pop-up windows.</p>
</td></tr>
<tr><td><code id="as_layer_+3A_drawing_info">drawing_info</code></td>
<td>
<p>default <code>NULL</code>. See REST documentation in details for more.
There are no helpers or validators for <code>drawingInfo</code> objects.</p>
</td></tr>
<tr><td><code id="as_layer_+3A_has_attachments">has_attachments</code></td>
<td>
<p>default <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="as_layer_+3A_max_scale">max_scale</code></td>
<td>
<p>default <code>NULL</code>. A number representing the maximum scale at
which the layer definition will be applied. The number is the scale's
denominator; thus, a value of 2400 represents a scale of 1/2,400. A value
of 0 indicates that the layer definition will be applied regardless of
how far you zoom in.</p>
</td></tr>
<tr><td><code id="as_layer_+3A_min_scale">min_scale</code></td>
<td>
<p>default <code>NULL</code>. A number representing the minimum scale at which the layer definition will be applied.</p>
</td></tr>
<tr><td><code id="as_layer_+3A_templates">templates</code></td>
<td>
<p>default <code>NULL</code>. See REST documentation in details for more.</p>
</td></tr>
<tr><td><code id="as_layer_+3A_type_id_field">type_id_field</code></td>
<td>
<p>default <code>NULL</code>. See REST documentation in details for more.</p>
</td></tr>
<tr><td><code id="as_layer_+3A_types">types</code></td>
<td>
<p>An array of type objects available for the dataset.
This is used when the <code>type_id_field</code> is populated. NOTE there are no
helper functions to create type objects. Any type list objects must match the
json structure when passed to <code>jsonify::to_json(x, unbox = TRUE)</code>.</p>
</td></tr>
<tr><td><code id="as_layer_+3A_layers">layers</code></td>
<td>
<p>a list of layers as created by <code>as_layer()</code>.</p>
</td></tr>
<tr><td><code id="as_layer_+3A_show_legend">show_legend</code></td>
<td>
<p>default <code>FALSE</code>. Logical scalar indicating if this layer
should be shown in the legend in client applications.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A <code>featureCollection</code> defines a layer of features that will be stored on a web map.
It consists of an array of <code>layer</code>s. The <code>layer</code> contains the features
(attributes and geometries) as a <code>featureSet</code> (see <code><a href="#topic+as_esri_featureset">as_esri_featureset()</a></code>) and
additional metadata which is stored in the <code>layerDefinition</code>object. The
<code>layerDefinition</code> most importantly documents the fields in the object, the object ID,
and additional metadata such as name, title, and display scale.
</p>
<p>Additional documentation for these json object:
</p>

<ul>
<li> <p><a href="https://developers.arcgis.com/documentation/common-data-types/layer.htm"><code>layer</code></a>
</p>
</li>
<li> <p><a href="https://developers.arcgis.com/documentation/common-data-types/layerdefinition.htm"><code>layerDefinition</code></a>
</p>
</li>
<li> <p><a href="https://developers.arcgis.com/documentation/common-data-types/featurecollection.htm"><code>featureCollection</code></a>
</p>
</li></ul>



<h3>Value</h3>

<p>A list object containing the required fields for each respective json type.
The results can be converted to json using <code>jsonify::to_json(x, unbox = TRUE)</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ld &lt;- as_layer_definition(iris, "iris", "objectID")
l &lt;- as_layer(iris, "iris name", "Iris Title")
fc &lt;- as_feature_collection(layers = list(l))
</code></pre>

<hr>
<h2 id='auth_code'>Authorization</h2><span id='topic+auth_code'></span><span id='topic+auth_client'></span><span id='topic+auth_binding'></span><span id='topic+auth_user'></span><span id='topic+auth_key'></span><span id='topic+refresh_token'></span><span id='topic+validate_or_refresh_token'></span>

<h3>Description</h3>

<p>Authorize your R session to connect to an ArcGIS Portal. See details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>auth_code(client = Sys.getenv("ARCGIS_CLIENT"), host = arc_host())

auth_client(
  client = Sys.getenv("ARCGIS_CLIENT"),
  secret = Sys.getenv("ARCGIS_SECRET"),
  host = arc_host(),
  expiration = 120
)

auth_binding()

auth_user(
  username = Sys.getenv("ARCGIS_USER"),
  password = Sys.getenv("ARCGIS_PASSWORD"),
  host = arc_host(),
  expiration = 60
)

auth_key(api_key = Sys.getenv("ARCGIS_API_KEY"), host = arc_host())

refresh_token(token, client = Sys.getenv("ARCGIS_CLIENT"), host = arc_host())

validate_or_refresh_token(
  token,
  client = Sys.getenv("ARCGIS_CLIENT"),
  host = arc_host(),
  refresh_threshold = 0,
  call = rlang::caller_env()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="auth_code_+3A_client">client</code></td>
<td>
<p>an OAuth 2.0 developer application client ID. By default uses the
environment variable <code>ARCGIS_CLIENT</code>.</p>
</td></tr>
<tr><td><code id="auth_code_+3A_host">host</code></td>
<td>
<p>default <code>"https://www.arcgis.com"</code></p>
</td></tr>
<tr><td><code id="auth_code_+3A_secret">secret</code></td>
<td>
<p>an OAuth 2.0 developer application secret. By default uses the environment
variable <code>ARCGIS_SECRET</code>.</p>
</td></tr>
<tr><td><code id="auth_code_+3A_expiration">expiration</code></td>
<td>
<p>the duration of the token in minutes.</p>
</td></tr>
<tr><td><code id="auth_code_+3A_username">username</code></td>
<td>
<p>default <code>Sys.getenv("ARCGIS_USER")</code>.
Your username to login. <strong>Do not</strong> hard code this value.</p>
</td></tr>
<tr><td><code id="auth_code_+3A_password">password</code></td>
<td>
<p>default <code>Sys.getenv("ARCGIS_PASSWORD")</code>.
Your password to login. <strong>Do not</strong> hard code this value.</p>
</td></tr>
<tr><td><code id="auth_code_+3A_api_key">api_key</code></td>
<td>
<p>default <code>Sys.getenv("ARCGIS_API_KEY")</code>. A character scalar of an ArcGIS Developer API key.</p>
</td></tr>
<tr><td><code id="auth_code_+3A_token">token</code></td>
<td>
<p>an <code>httr2_token</code> as created by <code>auth_code()</code> or similar</p>
</td></tr>
<tr><td><code id="auth_code_+3A_refresh_threshold">refresh_threshold</code></td>
<td>
<p>default <code>0</code>. If token expiry is within this
threshold (in seconds) the token will be refreshed only if a
<code>refresh_token</code> is available. Token refreshing is only possible with
<code>auth_code()</code> flow.</p>
</td></tr>
<tr><td><code id="auth_code_+3A_call">call</code></td>
<td>
<p>The execution environment of a currently running
function, e.g. <code>call = caller_env()</code>. The corresponding function
call is retrieved and mentioned in error messages as the source
of the error.
</p>
<p>You only need to supply <code>call</code> when throwing a condition from a
helper function which wouldn't be relevant to mention in the
message.
</p>
<p>Can also be <code>NULL</code> or a <a href="rlang.html#topic+topic-defuse">defused function call</a> to
respectively not display any call or hard-code a code to display.
</p>
<p>For more information about error calls, see <a href="rlang.html#topic+topic-error-call">Including function calls in error messages</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>ArcGIS Online and Enterprise Portals utilize OAuth2 authorization via their REST APIs.
</p>

<ul>
<li> <p><code>auth_code()</code> is the recommend OAuth2 workflow for interactive sessions
</p>
</li>
<li> <p><code>auth_client()</code> is the recommended OAuth2 workflow for non-interactive sessions
</p>
</li>
<li> <p><code>auth_user()</code> uses legacy username and password authorization using the <code>generateToken</code> endpoint. It is only recommended for legacy systems that do not implement OAuth2.
</p>
</li>
<li> <p><code>auth_binding()</code> fetches a token from the active portal set by <code>arcgisbinding</code>. Uses <code>arcgisbinding::arc.check_portal()</code> to extract the authorization token. Recommended if using arcgisbinding.
</p>
</li></ul>



<h3>Value</h3>

<p>an <code>httr2_token</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
auth_code()
auth_client()
auth_user()
auth_key()
auth_binding()

## End(Not run)
</code></pre>

<hr>
<h2 id='compact'>General utility functions</h2><span id='topic+compact'></span><span id='topic++25+7C+7C+25'></span><span id='topic+check_dots_named'></span>

<h3>Description</h3>

<p>General utility functions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compact(.x)

a %||% b

check_dots_named(dots, call = rlang::caller_env())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="compact_+3A_.x">.x</code></td>
<td>
<p>a list</p>
</td></tr>
<tr><td><code id="compact_+3A_a">a</code></td>
<td>
<p>an R object</p>
</td></tr>
<tr><td><code id="compact_+3A_b">b</code></td>
<td>
<p>an R object</p>
</td></tr>
<tr><td><code id="compact_+3A_dots">dots</code></td>
<td>
<p>a list collected from dots via <code>rlang::list2(...)</code></p>
</td></tr>
<tr><td><code id="compact_+3A_call">call</code></td>
<td>
<p>default <code>rlang::caller_env()</code>. The caller environment passed to <code>cli::cli_abort()</code></p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li> <p><code>compact()</code> removes any <code>NULL</code> list elements
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;%||%&#8288;</code> is a special pipe operator that returns <code>b</code> if <code>a</code> is <code>NULL</code>
</p>
</li></ul>



<h3>Value</h3>


<ul>
<li> <p><code>compact()</code> a list
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;%||%&#8288;</code> the first non-null item or <code>NULL</code> if both are <code>NULL</code>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
# remove null elements
compact(list(a = NULL, b = 1))

# if NULL return rhs
NULL %||% 123

# if not NULL return lhs
123 %||% NULL

</code></pre>

<hr>
<h2 id='detect_errors'>Detect errors in parsed json response</h2><span id='topic+detect_errors'></span><span id='topic+catch_error'></span>

<h3>Description</h3>

<p>The requests responses from ArcGIS don't return the status code
in the response itself but rather from the body in the json.
This function checks for the existence of an error. If an error is found,
the contents of the error message are bubbled up.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>detect_errors(response, error_call = rlang::caller_env())

catch_error(response, error_call = rlang::caller_env())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="detect_errors_+3A_response">response</code></td>
<td>
<p>for <code>detect_errors()</code>, a list typically from <code>RcppSimdJson::fparse(httr2::resp_body_string(resp))</code>. For <code>catch_error()</code>, the string from <code>httr2::resp_body_string(resp)</code>.</p>
</td></tr>
<tr><td><code id="detect_errors_+3A_error_call">error_call</code></td>
<td>
<p>default <code><a href="rlang.html#topic+stack">rlang::caller_env()</a></code>. The environment from which
to throw the error from.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing. Used for it's side effect. If an error code is encountered in the
response an error is thrown with the error code and the error message.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
response &lt;- list(
  error = list(
    code = 400L,
    message = "Unable to generate token.",
    details = "Invalid username or password."
  )
)

detect_errors(response)

## End(Not run)
</code></pre>

<hr>
<h2 id='determine_dims'>Determine the dimensions of a geometry object</h2><span id='topic+determine_dims'></span><span id='topic+has_m'></span><span id='topic+has_z'></span>

<h3>Description</h3>

<p>Given an sfc or sfg object determine what dimensions are represented.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>determine_dims(x)

has_m(x)

has_z(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="determine_dims_+3A_x">x</code></td>
<td>
<p>an object of class <code>sfc</code> or <code>sfg</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>determine_dims()</code> returns a scalar character of the value <code>"xy"</code>, <code>"xyz"</code>, or <code>"xyzm"</code> depending
on what dimensions are represented.
</p>
<p><code>has_m()</code> and <code>has_z()</code> returns a logical scalar of <code>TRUE</code> or <code>FALSE</code> if the
geometry has a Z or M dimension.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
geo &lt;- sf::st_read(system.file("shape/nc.shp", package="sf"), quiet = TRUE)[["geometry"]]

determine_dims(geo)
has_z(geo)
has_m(geo)
</code></pre>

<hr>
<h2 id='determine_esri_geo_type'>Determine Esri Geometry type</h2><span id='topic+determine_esri_geo_type'></span>

<h3>Description</h3>

<p>Takes an <code>sf</code> or <code>sfc</code> object and returns the appropriate Esri geometry type.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>determine_esri_geo_type(x, call = rlang::caller_env())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="determine_esri_geo_type_+3A_x">x</code></td>
<td>
<p>an object of class <code>data.frame</code>, <code>sf</code>, <code>sfc</code>, or <code>sfg</code>.</p>
</td></tr>
<tr><td><code id="determine_esri_geo_type_+3A_call">call</code></td>
<td>
<p>The execution environment of a currently running
function, e.g. <code>call = caller_env()</code>. The corresponding function
call is retrieved and mentioned in error messages as the source
of the error.
</p>
<p>You only need to supply <code>call</code> when throwing a condition from a
helper function which wouldn't be relevant to mention in the
message.
</p>
<p>Can also be <code>NULL</code> or a <a href="rlang.html#topic+topic-defuse">defused function call</a> to
respectively not display any call or hard-code a code to display.
</p>
<p>For more information about error calls, see <a href="rlang.html#topic+topic-error-call">Including function calls in error messages</a>.</p>
</td></tr>
</table>


<h3>Details</h3>



<h4>Geometry type mapping</h4>


<ul>
<li> <p><code>POINT</code>:  <code>esriGeometryPoint</code>
</p>
</li>
<li> <p><code>MULTIPOINT</code>:  <code>esriGeometryMultipoint</code>
</p>
</li>
<li> <p><code>LINESTRING</code>:  <code>esriGeometryPolyline</code>
</p>
</li>
<li> <p><code>MULTILINESTRING</code>:  <code>esriGeometryPolyline</code>
</p>
</li>
<li> <p><code>POLYGON</code>:  <code>esriGeometryPolygon</code>
</p>
</li>
<li> <p><code>MULTIPOLYGON</code>:  <code>esriGeometryPolygon</code>
</p>
</li></ul>




<h3>Value</h3>

<p>returns a character scalar of the corresponding Esri geometry type
</p>


<h3>Examples</h3>

<pre><code class='language-R'>determine_esri_geo_type(sf::st_point(c(0, 0)))
</code></pre>

<hr>
<h2 id='fetch_layer_metadata'>Retrieve metadata</h2><span id='topic+fetch_layer_metadata'></span>

<h3>Description</h3>

<p>Utility functions for feature service metadata.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fetch_layer_metadata(url, token = NULL, call = rlang::caller_env())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fetch_layer_metadata_+3A_url">url</code></td>
<td>
<p>the url of the item.</p>
</td></tr>
<tr><td><code id="fetch_layer_metadata_+3A_token">token</code></td>
<td>
<p>an <code>httr2_token</code> from one of the provided <code>auth_</code> functions</p>
</td></tr>
<tr><td><code id="fetch_layer_metadata_+3A_call">call</code></td>
<td>
<p>default <code><a href="rlang.html#topic+stack">rlang::caller_env()</a></code>. The calling environment passed to <code>detect_errors()</code>.</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li> <p><code>fetch_layer_metadata()</code> given a request, fetches the metadata by setting
the query parameter <code>f=json</code>
</p>
</li></ul>



<h3>Value</h3>

<p>returns a list object
</p>


<h3>Examples</h3>

<pre><code class='language-R'># url is broken into parts to fit within 100 characters to avoid CRAN notes
url_parts &lt;- c(
  "https://services.arcgis.com/P3ePLMYs2RVChkJx/ArcGIS/rest/services",
  "/USA_Counties_Generalized_Boundaries/FeatureServer/0"
)

furl &lt;- paste0(url_parts, collapse = "")
meta &lt;- fetch_layer_metadata(furl)
head(names(meta))
</code></pre>

<hr>
<h2 id='infer_esri_type'>Esri field type mapping</h2><span id='topic+infer_esri_type'></span><span id='topic+get_ptype'></span><span id='topic+ptype_tbl'></span><span id='topic+remote_ptype_tbl'></span>

<h3>Description</h3>

<p>Infers Esri field types from R objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>infer_esri_type(
  .data,
  arg = rlang::caller_arg(.data),
  call = rlang::caller_env()
)

get_ptype(field_type, n = 1, call = rlang::caller_env())

ptype_tbl(fields, n = 0, call = rlang::caller_env())

remote_ptype_tbl(fields, call = rlang::caller_env())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="infer_esri_type_+3A_.data">.data</code></td>
<td>
<p>an object of class <code>data.frame</code>.</p>
</td></tr>
<tr><td><code id="infer_esri_type_+3A_arg">arg</code></td>
<td>
<p>An argument name in the current function.</p>
</td></tr>
<tr><td><code id="infer_esri_type_+3A_call">call</code></td>
<td>
<p>The execution environment of a currently running
function, e.g. <code>call = caller_env()</code>. The corresponding function
call is retrieved and mentioned in error messages as the source
of the error.
</p>
<p>You only need to supply <code>call</code> when throwing a condition from a
helper function which wouldn't be relevant to mention in the
message.
</p>
<p>Can also be <code>NULL</code> or a <a href="rlang.html#topic+topic-defuse">defused function call</a> to
respectively not display any call or hard-code a code to display.
</p>
<p>For more information about error calls, see <a href="rlang.html#topic+topic-error-call">Including function calls in error messages</a>.</p>
</td></tr>
<tr><td><code id="infer_esri_type_+3A_field_type">field_type</code></td>
<td>
<p>a character of a desired Esri field type. See details for more.</p>
</td></tr>
<tr><td><code id="infer_esri_type_+3A_n">n</code></td>
<td>
<p>the number of rows to create in the prototype table</p>
</td></tr>
<tr><td><code id="infer_esri_type_+3A_fields">fields</code></td>
<td>
<p>a data.frame containing, at least, the columns <code>type</code> and <code>name</code>.
Typically retrieved from the <code>field</code> metadata from a <code>FeatureLayer</code> or <code>Table</code>.
Also can use the output of <code>infer_esri_type()</code>.</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li> <p><code>get_ptype()</code> takes a scalar character containing the Esri field type and returns a prototype of the pertinent R type
</p>
</li>
<li> <p><code>infer_esri_type()</code> takes a data frame-like object and infers the Esri field type from it.
</p>
</li>
<li> <p><code>remote_ptype_tbl()</code> takes a data frame of fields as derived from <code>list_fields()</code> and
creates a lazy table proto type intended to be used with <code>dbplyr</code> integration
</p>
</li></ul>



<h4>Field type mapping:</h4>

<p>Esri field types are mapped as
</p>

<ul>
<li> <p><code>esriFieldTypeSmallInteger</code>: integer
</p>
</li>
<li> <p><code>esriFieldTypeSingle</code>: double
</p>
</li>
<li> <p><code>esriFieldTypeGUID</code>: integer
</p>
</li>
<li> <p><code>esriFieldTypeOID</code>: integer
</p>
</li>
<li> <p><code>esriFieldTypeInteger</code>: integer
</p>
</li>
<li> <p><code>esriFieldTypeBigInteger</code>: double
</p>
</li>
<li> <p><code>esriFieldTypeDouble</code>: double
</p>
</li>
<li> <p><code>esriFieldTypeString</code>: character
</p>
</li>
<li> <p><code>esriFieldTypeDate</code>: date
</p>
</li></ul>

<p>R types are mapped as
</p>

<ul>
<li> <p><code>double</code>: esriFieldTypeDouble
</p>
</li>
<li> <p><code>integer</code>: esriFieldTypeInteger
</p>
</li>
<li> <p><code>character</code>: esriFieldTypeString
</p>
</li>
<li> <p><code>date</code>: esriFieldTypeDate
</p>
</li>
<li> <p><code>raw</code>: esriFieldTypeBlob
</p>
</li></ul>




<h3>Value</h3>


<ul>
<li> <p><code>get_pytpe()</code> returns an object of the class of the prototype.
</p>
</li>
<li> <p><code>ptype_tbl()</code> takes a <code>data.frame</code> with columns <code>name</code> and <code>type</code> and creates an empty <code>data.frame</code> with the corresponding columns and R types
</p>
</li>
<li> <p><code>remote_ptype_tbl()</code> provides the results of <code>ptype_tbl()</code> as a lazy data frame from the <code>dbplyr</code> package.
</p>
</li>
<li> <p><code>infer_esri_ptype()</code> returns a <code>data.frame</code> with columns <code>name</code>, <code>type</code>, <code>alias</code>, <code>nullable</code>, and <code>editable</code> columns
</p>

<ul>
<li><p> This resembles that of the <code>fields</code> returned by a FeatureService
</p>
</li></ul>

</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
get_ptype("esriFieldTypeDouble")
inferred &lt;- infer_esri_type(iris)
ptype_tbl(inferred)

</code></pre>

<hr>
<h2 id='is_date'>Date handling</h2><span id='topic+is_date'></span><span id='topic+date_to_ms'></span><span id='topic+from_esri_date'></span>

<h3>Description</h3>

<p>Esri date fields are represented as milliseconds from the Unix Epoch.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_date(x, tz)

date_to_ms(x, tz = "UTC")

from_esri_date(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="is_date_+3A_x">x</code></td>
<td>
<p>an object of class <code>Date</code> or <code>POSIXt</code>. In the case of <code>is_date()</code>, any R object.</p>
</td></tr>
<tr><td><code id="is_date_+3A_tz">tz</code></td>
<td>
<p>a character string.  The time zone specification to be used
for the conversion, <em>if one is required</em>.  System-specific (see
<a href="base.html#topic+time+20zones">time zones</a>), but <code>""</code> is the current time zone, and
<code>"GMT"</code> is UTC (Universal Time, Coordinated).  Invalid values
are most commonly treated as UTC, on some platforms with a warning.</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li> <p><code>is_date()</code>: checks if an object is a <code>Date</code> or <code>POSIXt</code> class object.
</p>
</li>
<li> <p><code>date_to_ms()</code> converts a date object to milliseconds from the Unix Epoch in the specified time zone.
</p>
</li></ul>



<h3>Value</h3>


<ul>
<li> <p><code>is_date()</code> returns a logical scalar
</p>
</li>
<li> <p><code>date_to_ms()</code> returns a numeric vector of times in milliseconds from the Unix Epoch in the specified time zone.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
today &lt;- Sys.Date()

is_date(today)

date_to_ms(today)

</code></pre>

<hr>
<h2 id='parse_esri_json'>Parse Esri JSON</h2><span id='topic+parse_esri_json'></span>

<h3>Description</h3>

<p>Parses an Esri FeatureSet JSON object into an R object. If there is no
geometry present, a data.frame is returned. If there is geometry, an sf object is returned.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>parse_esri_json(string, ..., call = rlang::caller_env())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="parse_esri_json_+3A_string">string</code></td>
<td>
<p>the raw Esri JSON string.</p>
</td></tr>
<tr><td><code id="parse_esri_json_+3A_...">...</code></td>
<td>
<p>additional arguments passed to <code><a href="RcppSimdJson.html#topic+fparse">RcppSimdJson::fparse</a></code></p>
</td></tr>
<tr><td><code id="parse_esri_json_+3A_call">call</code></td>
<td>
<p>The execution environment of a currently running
function, e.g. <code>call = caller_env()</code>. The corresponding function
call is retrieved and mentioned in error messages as the source
of the error.
</p>
<p>You only need to supply <code>call</code> when throwing a condition from a
helper function which wouldn't be relevant to mention in the
message.
</p>
<p>Can also be <code>NULL</code> or a <a href="rlang.html#topic+topic-defuse">defused function call</a> to
respectively not display any call or hard-code a code to display.
</p>
<p>For more information about error calls, see <a href="rlang.html#topic+topic-error-call">Including function calls in error messages</a>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame. If geometry is found, returns an sf object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
esri_json &lt;- '{
    "geometryType": "esriGeometryPolygon",
    "spatialReference": {
        "wkid": 4326
    },
    "hasZ": false,
    "hasM": false,
    "features": [
        {
            "attributes": {
                "id": 1
            },
            "geometry": {
                "rings": [
                    [
                        [0.0, 0.0],
                        [1.0, 0.0],
                        [1.0, 1.0],
                        [0.0, 1.0],
                        [0.0, 0.0]
                    ]
                ]
            }
        }
    ]
}'

parse_esri_json(esri_json)

</code></pre>

<hr>
<h2 id='rbind_results'>Combine multiple data.frames</h2><span id='topic+rbind_results'></span>

<h3>Description</h3>

<p>A general function that takes a list of <code>data.frame</code>s and returns a single
and combines them into a single object. It will use the fastest method
available. In order this is <code><a href="collapse.html#topic+rowbind">collapse::rowbind()</a></code>, <code><a href="data.table.html#topic+rbindlist">data.table::rbindlist()</a></code>,
<code><a href="vctrs.html#topic+vec_chop">vctrs::list_unchop()</a></code>, then <code>do.call(rbind.data.frame, x)</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rbind_results(x, call = rlang::current_env(), .ptype = data.frame())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rbind_results_+3A_x">x</code></td>
<td>
<p>a list where each element is a <code>data.frame</code> or <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="rbind_results_+3A_call">call</code></td>
<td>
<p>The execution environment of a currently running
function, e.g. <code>call = caller_env()</code>. The corresponding function
call is retrieved and mentioned in error messages as the source
of the error.
</p>
<p>You only need to supply <code>call</code> when throwing a condition from a
helper function which wouldn't be relevant to mention in the
message.
</p>
<p>Can also be <code>NULL</code> or a <a href="rlang.html#topic+topic-defuse">defused function call</a> to
respectively not display any call or hard-code a code to display.
</p>
<p>For more information about error calls, see <a href="rlang.html#topic+topic-error-call">Including function calls in error messages</a>.</p>
</td></tr>
<tr><td><code id="rbind_results_+3A_.ptype">.ptype</code></td>
<td>
<p>currently unused. Reserved for a future release.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If all items in the list are <code>data.frame</code>s, then the result will be a <code>data.frame</code>.
If all elements are an <code>sf</code> object, then the result will be an <code>sf</code> object.
If the items are mixed, the result will be a <code>data.frame</code>.
</p>
<p>If any items are <code>NULL</code>, then an attribute <code>null_elements</code> will be attached
to the result. The attribute is an integer vector of the indices that
were <code>NULL</code>.
</p>


<h3>Value</h3>

<p>see details.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
x &lt;- head(iris)
res &lt;- rbind_results(list(x, NULL, x))
attr(res, "null_elements")
</code></pre>

<hr>
<h2 id='validate_crs'>Validate CRS object</h2><span id='topic+validate_crs'></span>

<h3>Description</h3>

<p>Takes a representation of a CRS and ensures that it is a valid one. The CRS
is validated using <code>sf::st_crs()</code> if it cannot be validated, a null CRS is returned.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>validate_crs(crs, arg = rlang::caller_arg(crs), call = rlang::caller_env())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="validate_crs_+3A_crs">crs</code></td>
<td>
<p>a representation of a coordinate reference system.</p>
</td></tr>
<tr><td><code id="validate_crs_+3A_arg">arg</code></td>
<td>
<p>An argument name in the current function.</p>
</td></tr>
<tr><td><code id="validate_crs_+3A_call">call</code></td>
<td>
<p>The execution environment of a currently running
function, e.g. <code>call = caller_env()</code>. The corresponding function
call is retrieved and mentioned in error messages as the source
of the error.
</p>
<p>You only need to supply <code>call</code> when throwing a condition from a
helper function which wouldn't be relevant to mention in the
message.
</p>
<p>Can also be <code>NULL</code> or a <a href="rlang.html#topic+topic-defuse">defused function call</a> to
respectively not display any call or hard-code a code to display.
</p>
<p>For more information about error calls, see <a href="rlang.html#topic+topic-error-call">Including function calls in error messages</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code><a href="sf.html#topic+st_crs">sf::st_crs()</a></code> for more details on valid representations.
</p>


<h3>Value</h3>

<p>Returns a list of length 1 with an element named <code>spatialReference</code> which is itself
a named list.
</p>
<p>If the provided CRS returns a valid well-known ID (WKID) <code>spatialReference</code> contains
a named element called <code>wkid</code> which is the integer value of the WKID. If the WKID
is not known but the CRS returned is a valid well-known text representation the <code>wkid</code> field
is <code>NA</code> and another field <code>wkt</code> contains the valid wkt.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# using epsg code integer or string representation
validate_crs(3857)
validate_crs("EPSG:4326")

# using a custom proj4 string
proj4string &lt;- "+proj=longlat +datum=WGS84 +no_defs"

crs &lt;- validate_crs(proj4string)

# using wkt2 (from above result)
crs &lt;- validate_crs(crs$spatialReference$wkt)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
