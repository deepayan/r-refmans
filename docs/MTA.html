<!DOCTYPE html><html><head><title>Help for package MTA</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {MTA}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#MTA'><p>Multiscalar Territorial Analysis</p></a></li>
<li><a href='#bidev'><p>Multiscalar Typology (2 deviations)</p></a></li>
<li><a href='#cardist'><p>Time Distance Matrix Between Communes</p></a></li>
<li><a href='#com'><p>Grand Paris Metropole Communes Data</p></a></li>
<li><a href='#ept'><p>Grand Paris Metropole EPTs</p></a></li>
<li><a href='#gdev'><p>General Deviation</p></a></li>
<li><a href='#map_bidev'><p>Map Multiscalar Typology (2 deviations)</p></a></li>
<li><a href='#map_mst'><p>Map Multiscalar Typology (3 deviations)</p></a></li>
<li><a href='#mas'><p>Multiscalar Absolute Synthesis</p></a></li>
<li><a href='#mst'><p>Multiscalar Typology (3 deviations)</p></a></li>
<li><a href='#plot_bidev'><p>Plot Multiscalar Typology (2 deviations)</p></a></li>
<li><a href='#plot_mst'><p>Plot Multiscalar Typology (3 deviations)</p></a></li>
<li><a href='#sdev'><p>Spatial Deviation</p></a></li>
<li><a href='#tdev'><p>Territorial Deviation</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Multiscalar Territorial Analysis</td>
</tr>
<tr>
<td>Version:</td>
<td>0.6.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Build multiscalar territorial analysis based on various contexts.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/riatelab/MTA/">https://github.com/riatelab/MTA/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/riatelab/MTA/issues/">https://github.com/riatelab/MTA/issues/</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5)</td>
</tr>
<tr>
<td>Imports:</td>
<td>methods, stats, graphics, igraph, sf</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, ineq, png, mapsf</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-10-31 10:26:55 UTC; tim</td>
</tr>
<tr>
<td>Author:</td>
<td>Ronan Ysebaert <a href="https://orcid.org/0000-0002-7344-5911"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Nicolas Lambert <a href="https://orcid.org/0000-0003-4976-6560"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Timothée Giraud <a href="https://orcid.org/0000-0002-1932-3323"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Timothée Giraud &lt;timothee.giraud@cnrs.fr&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-10-31 10:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='MTA'>Multiscalar Territorial Analysis</h2><span id='topic+MTA'></span><span id='topic+MTA-package'></span>

<h3>Description</h3>

<p>Build multiscalar territorial analysis based on various contexts for a given ratio defined by a numerator and a denominator.<br />
Main functions : 
</p>

<ul>
<li><p><code><a href="#topic+gdev">gdev</a></code>: general deviation of each territorial unit as regards  
to all the study area (or a reference value).
</p>
</li>
<li><p><code><a href="#topic+tdev">tdev</a></code>: territorial deviation of each territorial unit as regards  
to an intermediate territorial level of reference.
</p>
</li>
<li><p><code><a href="#topic+sdev">sdev</a></code>: spatial deviation of each territorial unit as regards  
to its geographical neighborhood.
#' </p>
</li>
<li><p><code><a href="#topic+bidev">bidev</a></code>: multiscalar typology based on 2 deviations.
</p>
</li>
<li><p><code><a href="#topic+mst">mst</a></code>: multiscalar typology based on the 3 deviations.
</p>
</li>
<li><p><code><a href="#topic+mas">mas</a></code>: multiscalar absolute synthesis, total amount of 
redistributions based on the three deviations. 
</p>
</li>
<li><p><code><a href="#topic+map_bidev">map_bidev</a></code>: creating bidev and parameters for producing 
a map based on it. 
</p>
</li>
<li><p><code><a href="#topic+map_mst">map_mst</a></code>: creating mst and parameters for producing 
a map based on it.
</p>
</li>
<li><p><code><a href="#topic+plot_bidev">plot_bidev</a></code>: creating a plot for visualizing bidev results. 
</p>
</li>
<li><p><code><a href="#topic+plot_mst">plot_mst</a></code>: creating a plot adapted for visualzing mst results.
</p>
</li></ul>



<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Timothée Giraud <a href="mailto:timothee.giraud@cnrs.fr">timothee.giraud@cnrs.fr</a> (<a href="https://orcid.org/0000-0002-1932-3323">ORCID</a>)
</p>
<p>Authors:
</p>

<ul>
<li><p> Ronan Ysebaert (<a href="https://orcid.org/0000-0002-7344-5911">ORCID</a>)
</p>
</li>
<li><p> Nicolas Lambert (<a href="https://orcid.org/0000-0003-4976-6560">ORCID</a>)
</p>
</li></ul>



<h3>References</h3>

<p>GRASLAND C., YSEBAERT R., ZANIN C., LAMBERT N., Spatial disparities in Europe  (Chapter 4)  
in GLOERSEN E., DUBOIS A. (coord.), 2007, Regional disparities and cohesion: What Strategies for the future?, DG-IPOL – European Parliament.
</p>


<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/riatelab/MTA/">https://github.com/riatelab/MTA/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/riatelab/MTA/issues/">https://github.com/riatelab/MTA/issues/</a>
</p>
</li></ul>


<hr>
<h2 id='bidev'>Multiscalar Typology (2 deviations)</h2><span id='topic+bidev'></span>

<h3>Description</h3>

<p>Compute a multiscalar typology according to two relative 
deviations relative.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bidev(x, dev1, dev2, breaks = c(25, 50, 100), xid = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bidev_+3A_x">x</code></td>
<td>
<p>a sf object including 2 deviations among gdev, tdev and sdev.</p>
</td></tr>
<tr><td><code id="bidev_+3A_dev1">dev1</code></td>
<td>
<p>column name of the first relative deviation in x.</p>
</td></tr>
<tr><td><code id="bidev_+3A_dev2">dev2</code></td>
<td>
<p>coumn name of the second relative deviation in x.</p>
</td></tr>
<tr><td><code id="bidev_+3A_breaks">breaks</code></td>
<td>
<p>Distance to the index 100 (average of the context), in
percentage. A vector of three values. Defaut c(25,50,100). 25 
to indexes 80 and 125. 50 
and 200.</p>
</td></tr>
<tr><td><code id="bidev_+3A_xid">xid</code></td>
<td>
<p>identifier field in x. Default the first column.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a column in x including a bidev column delivering the result of 
the typology. Values are classified in 13 classes according to their 
respective position on the two selected deviations and their
distance to the average.
</p>
<p>bidev typology values :
</p>
<ul>
<li><p>ZZ: Near the average for the two selected deviation
</p>
</li>
<li><p>A1: Above the average for dev1 and dev2, distance to the avarage : +
</p>
</li>
<li><p>A2: Above the average for dev1 and dev2, distance to the avarage : ++
</p>
</li>
<li><p>A3: Above the average for dev1 and dev2, distance to the avarage : +++
</p>
</li>
<li><p>B1: Above the average for dev1 and below for dev2, distance to the
avarage : +
</p>
</li>
<li><p>B2: Above the average for dev1 and below for dev2, distance to the
avarage : ++
</p>
</li>
<li><p>B3: Above the average for dev1 and below for dev2, distance to the
avarage : +++
</p>
</li>
<li><p>C1: Below the average for dev1 and dev2, distance to the avarage : +
</p>
</li>
<li><p>C2: Below the average for dev1 and dev2, distance to the avarage : ++
</p>
</li>
<li><p>C3: Below the average for dev1 and dev2, distance to the avarage : +++
</p>
</li>
<li><p>D1: Below the average for dev1 and above for dev2, distance to the
avarage : +
</p>
</li>
<li><p>D2: Below the average for dev1 and above for dev2, distance to the
avarage : ++
</p>
</li>
<li><p>D3: Below the average for dev1 and above for dev2, distance to the
avarage : +++
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># bidev synthesis on general and territorial deviation (income data)
# Load data
library(sf)
com &lt;- st_read(system.file("metroparis.gpkg", package = "MTA"), layer = "com", quiet = TRUE)

# Prerequisite  - Compute 2 deviations
com$gdev &lt;- gdev(x = com, var1 = "INC", var2 = "TH")
com$tdev &lt;- tdev(x = com, var1 = "INC", var2 = "TH", key = "EPT")

# Compute bidev
com$bidev &lt;- bidev(x = com, dev1 = "gdev", dev2 = "tdev")
</code></pre>

<hr>
<h2 id='cardist'>Time Distance Matrix Between Communes</h2><span id='topic+cardist'></span>

<h3>Description</h3>

<p>Travel time between Grand Paris Metropole communes' centroids by car, in minutes.<br />
Row names and column names match the DEPCOM field in <a href="#topic+com">com</a>.
</p>


<h3>Source</h3>

<p>The matrix is computed using the osrm package (<a href="https://cran.r-project.org/package=osrm">https://cran.r-project.org/package=osrm</a>). <br />
Data (c) OpenStreetMap contributors, ODbL 1.0. http://www.openstreetmap.org/copyright <br />
Routes: OSRM. http://project-osrm.org/ <br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cardist &lt;- read.table(system.file("cardist.txt", package = "MTA"), check.names = FALSE)
cardist &lt;- as.matrix(cardist)
cardist[1:10, 1:10]
</code></pre>

<hr>
<h2 id='com'>Grand Paris Metropole Communes Data</h2><span id='topic+com'></span>

<h3>Description</h3>

<p>Data on the Grand Paris Metropole communes, included in a sf object.
</p>


<h3>Format</h3>

<p>A data frame with 150 rows and 10 variables:
</p>

<dl>
<dt>DEPCOM</dt><dd><p>Commune identifiers</p>
</dd>
<dt>LIBCOM</dt><dd><p>Commune names</p>
</dd>
<dt>EPT</dt><dd><p>EPT identifiers of the commune</p>
</dd>
<dt>LIBEPT</dt><dd><p>EPT names of the commune</p>
</dd>
<dt>DEP</dt><dd><p>Identifiers of the departement</p>
</dd>
<dt>INC</dt><dd><p>Amount of income tax reference (in euros)</p>
</dd>
<dt>TH</dt><dd><p>Number of tax households</p>
</dd>
<dt>geometry</dt><dd><p>Commune geometry</p>
</dd>
</dl>



<h3>Source</h3>

<p>Direction générale des finances publiques, income tax 2014 (2013 incomes):<br />
<a href="https://www.impots.gouv.fr/statistiques">https://www.impots.gouv.fr/statistiques</a><br />
Atelier parisien d'urbanisme, Grand Paris communal composition (2015-12-17):<br />
<a href="https://www.apur.org/fr/nos-travaux/composition-12-territoires-metropole-grand-paris">https://www.apur.org/fr/nos-travaux/composition-12-territoires-metropole-grand-paris</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(sf)
com &lt;- st_read(system.file("metroparis.gpkg", package = "MTA"), layer = "com", quiet = TRUE)
</code></pre>

<hr>
<h2 id='ept'>Grand Paris Metropole EPTs</h2><span id='topic+ept'></span>

<h3>Description</h3>

<p>sf object. Grand Paris Metropole EPTs. 
EPTs (Etablissements Publics Territoriaux) are groups of communes.<br />
</p>


<h3>Format</h3>


<dl>
<dt>EPT</dt><dd><p>EPT identifiers</p>
</dd>
<dt>LIBEPT</dt><dd><p>EPT names</p>
</dd>
</dl>



<h3>Source</h3>

<p>Atelier parisien d'urbanisme, Grand Paris communal composition (2015-12-17):<br />
<a href="https://www.apur.org/fr/nos-travaux/composition-12-territoires-metropole-grand-paris">https://www.apur.org/fr/nos-travaux/composition-12-territoires-metropole-grand-paris</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(sf)
ept &lt;- st_read(system.file("metroparis.gpkg", package = "MTA"), layer = "ept", quiet = TRUE)
</code></pre>

<hr>
<h2 id='gdev'>General Deviation</h2><span id='topic+gdev'></span>

<h3>Description</h3>

<p>Compute the deviation of each territorial unit as regards  
to all the study area (or a reference value).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gdev(x, var1, var2, type = "rel", ref)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gdev_+3A_x">x</code></td>
<td>
<p>a data.frame or a sf object including var1 and var2.</p>
</td></tr>
<tr><td><code id="gdev_+3A_var1">var1</code></td>
<td>
<p>name of the numerator variable in x.</p>
</td></tr>
<tr><td><code id="gdev_+3A_var2">var2</code></td>
<td>
<p>name of the denominator variable in x.</p>
</td></tr>
<tr><td><code id="gdev_+3A_type">type</code></td>
<td>
<p>type of deviation; &quot;rel&quot; for relative deviation, &quot;abs&quot; for 
absolute deviation (see Details).</p>
</td></tr>
<tr><td><code id="gdev_+3A_ref">ref</code></td>
<td>
<p>ratio of reference; if missing, the ratio of reference is the one of 
the whole study area (<code>sum(var1) / sum(var2)</code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The relative global deviation is the ratio between var1/var2 and ref
(<code>100 * (var1 / var2) / ref</code>). Values greater than 100 indicate that the 
unit ratio is greater than the ratio of reference. Values lower than 100 
indicate that the unit ratio is lower than the ratio of reference.<br />
The absolute global deviation is the amount of numerator that could be moved 
to obtain the ratio of reference on all units. (<code>(var1 - (ref * var2)</code>).
</p>


<h3>Value</h3>

<p>A vector is returned.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Load data
library(sf)
com &lt;- st_read(system.file("metroparis.gpkg", package = "MTA"), layer = "com", quiet = TRUE)
ept &lt;- st_read(system.file("metroparis.gpkg", package = "MTA"), layer = "ept", quiet = TRUE)

if(require(mapsf)){
# compute absolute global deviation
com$gdevabs &lt;- gdev(x = com, var1 = "INC", var2 = "TH", type = "abs")
# compute relative global deviation
com$gdevrel &lt;- gdev(x = com, var1 = "INC", var2 = "TH", type = "rel")

# relative deviation map
# set breaks
bks &lt;- c(min(com$gdevrel), 50, 75, 100, 125, 150, max(com$gdevrel))
# plot a choropleth map of the relative global deviation
mf_map(x = com, var = "gdevrel", type = "choro", leg_pos = "topleft",
       leg_title = "Relative Deviation\n(100 = general average)",
       breaks = bks, border = NA,
       pal = c("#4575B4", "#91BFDB", "#E0F3F8", "#FEE090", "#FC8D59", "#D73027"))

# add EPT boundaries
mf_map(x = ept, col = NA, add = TRUE)

# layout
mf_layout(title = "General Deviation (reference: Grand Paris Metropole)",
          credits = paste0("Sources: GEOFLA® 2015 v2.1, Apur, impots.gouv.fr",
                           "\nMTA", packageVersion("MTA")),
          arrow = FALSE)

# absolute deviation map
com$sign &lt;- ifelse(test = com$gdevabs &lt; 0, yes = "Under-Income", no = "Over-Income")
mf_map(ept)

mf_map(x = com, var = c("gdevabs", "sign"), type = "prop_typo", inches = 0.2,
       leg_title = c("Absolute Deviation\n(Income redistribution, euros)",
                     "Redistribution direction"), 
       leg_pos = c("topleft", "topright"), leg_val_rnd = -2,
       val_order = c("Under-Income", "Over-Income"),
       pal =  c("#ff0000","#0000ff"), add = TRUE)

# layout
mf_layout(title = "General Deviation (reference: Grand Paris Metropole)",
          credits = paste0("Sources: GEOFLA® 2015 v2.1, Apur, impots.gouv.fr",
                           "\nMTA", packageVersion("MTA")),
          arrow = FALSE)
}
</code></pre>

<hr>
<h2 id='map_bidev'>Map Multiscalar Typology (2 deviations)</h2><span id='topic+map_bidev'></span>

<h3>Description</h3>

<p>Compute the multiscalar typology (2 deviations) and propose 
colors for mapping the results.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>map_bidev(x, dev1, dev2, breaks = c(25, 50, 100), xid = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="map_bidev_+3A_x">x</code></td>
<td>
<p>A sf object including a variable resulting from the mst function.</p>
</td></tr>
<tr><td><code id="map_bidev_+3A_dev1">dev1</code></td>
<td>
<p>column name of the first relative deviation in x.</p>
</td></tr>
<tr><td><code id="map_bidev_+3A_dev2">dev2</code></td>
<td>
<p>coumn name of the second relative deviation in x.</p>
</td></tr>
<tr><td><code id="map_bidev_+3A_breaks">breaks</code></td>
<td>
<p>Distance to the index 100 (average of the context), in
percentage. A vector of three values. Defaut c(25,50,100). 25 
to indexes 80 and 125. 50 
and 200.</p>
</td></tr>
<tr><td><code id="map_bidev_+3A_xid">xid</code></td>
<td>
<p>identifier field in x. Default the first column.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list including a ordered sf object for mapping mst column (geom) and 
a vector of suggested colors (cols). 
</p>
<p>bidev typology values :
</p>
<ul>
<li><p>ZZ: Near the average for the two selected deviation
</p>
</li>
<li><p>A1: Above the average for dev1 and dev2, distance to the avarage : +
</p>
</li>
<li><p>A2: Above the average for dev1 and dev2, distance to the avarage : ++
</p>
</li>
<li><p>A3: Above the average for dev1 and dev2, distance to the avarage : +++
</p>
</li>
<li><p>B1: Above the average for dev1 and below for dev2, distance to the
avarage : +
</p>
</li>
<li><p>B2: Above the average for dev1 and below for dev2, distance to the
avarage : ++
</p>
</li>
<li><p>B3: Above the average for dev1 and below for dev2, distance to the
avarage : +++
</p>
</li>
<li><p>C1: Below the average for dev1 and dev2, distance to the avarage : +
</p>
</li>
<li><p>C2: Below the average for dev1 and dev2, distance to the avarage : ++
</p>
</li>
<li><p>C3: Below the average for dev1 and dev2, distance to the avarage : +++
</p>
</li>
<li><p>D1: Below the average for dev1 and above for dev2, distance to the
avarage : +
</p>
</li>
<li><p>D2: Below the average for dev1 and above for dev2, distance to the
avarage : ++
</p>
</li>
<li><p>D3: Below the average for dev1 and above for dev2, distance to the
avarage : +++
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Focus on exceptional values (50, 100 and 200 % above-under the average)
# Load data
library(sf)
com &lt;- st_read(system.file("metroparis.gpkg", package = "MTA"), layer = "com", quiet = TRUE)
ept &lt;- st_read(system.file("metroparis.gpkg", package = "MTA"), layer = "ept", quiet = TRUE)

# Prerequisite  - Compute 2 deviations
com$gdev &lt;- gdev(x = com, var1 = "INC", var2 = "TH")
com$tdev &lt;- tdev(x = com, var1 = "INC", var2 = "TH", key = "EPT")

# Compute map_bidev
bidev &lt;- map_bidev(x = com, dev1 = "gdev", dev2 = "tdev", breaks = c(50, 100, 200))

# Unlist resulting function
com &lt;- bidev$geom
cols &lt;- bidev$cols

#Visualization
# One side for the map, another for the plot
opar &lt;- par(mfrow = c(1,2), mar = c(0,4,0,0))

if(require(mapsf)){
# Cartography
mf_map(x = com, var = "bidev", type = "typo", val_order = unique(com$bidev), 
       border = "grey50", pal = cols, lwd = 0.2, leg_pos = NA)
mf_map(ept, col = NA, add = TRUE)

# Label territories in the C3 category
mf_label(x = com[com$bidev == "C3",], var = "LIBCOM", halo = TRUE)

mf_layout(title = "2-Deviations synthesis : general and territorial contexts",
         credits = paste0("Sources: GEOFLA® 2015 v2.1, Apur, impots.gouv.fr",
                          "\nMTA", packageVersion("MTA")),
         arrow = FALSE)

# Add plot_bidev on the right side of the map
plot_bidev(x = com,  dev1 = "gdev",  dev2 = "tdev",
          dev1.lab = "General deviation (MGP Area)",
          dev2.lab = "Territorial deviation (EPT of belonging)",
          breaks = c(50, 100, 200),
          lib.var = "LIBCOM", lib.val = "Clichy-sous-Bois", cex.lab = 0.8)
par(opar)
}
</code></pre>

<hr>
<h2 id='map_mst'>Map Multiscalar Typology (3 deviations)</h2><span id='topic+map_mst'></span>

<h3>Description</h3>

<p>Compute the multiscalar typology (3 deviations) and propose 
labels and colours for mapping the results.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>map_mst(x, gdevrel, tdevrel, sdevrel, threshold, superior = FALSE, xid = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="map_mst_+3A_x">x</code></td>
<td>
<p>a sf object or a dataframe including 3 pre-calculated deviations.</p>
</td></tr>
<tr><td><code id="map_mst_+3A_gdevrel">gdevrel</code></td>
<td>
<p>name of the general relative deviation variable in x.</p>
</td></tr>
<tr><td><code id="map_mst_+3A_tdevrel">tdevrel</code></td>
<td>
<p>name of the territorial relative deviation variable in x.</p>
</td></tr>
<tr><td><code id="map_mst_+3A_sdevrel">sdevrel</code></td>
<td>
<p>name of the the spatial relative deviation variable in x.</p>
</td></tr>
<tr><td><code id="map_mst_+3A_threshold">threshold</code></td>
<td>
<p>defined to build the typology (100 is considered as the 
average)</p>
</td></tr>
<tr><td><code id="map_mst_+3A_superior">superior</code></td>
<td>
<p>if TRUE, deviation values must be greater than threshold. If 
FALSE, deviation values must be lower than threshold.</p>
</td></tr>
<tr><td><code id="map_mst_+3A_xid">xid</code></td>
<td>
<p>identifier field in x. Default the first column.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list including a ordered sf object for mapping mst column (geom), a 
vector of suggested colors (cols) and a vector of adatped labels for the 
legend (leg_labels). 
</p>
<p>Typology labels (which deviation is above/under the threshold):
</p>
<ul>
<li><p>0: none (mst value = 0)
</p>
</li>
<li><p>G: general only (mst value = 1) 
</p>
</li>
<li><p>T: territorial only (mst value = 2)
</p>
</li>
<li><p>G-T: general and Territorial (mst value = 3)
</p>
</li>
<li><p>S: spatial only (mst value = 4)
</p>
</li>
<li><p>G-S: general and Spatial (mst value = 5)
</p>
</li>
<li><p>T-S: territorial and Spatial (mst value = 6)
</p>
</li>
<li><p>G-T-S: all deviations (mst value = 7)
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Load data
library(sf)
com &lt;- st_read(system.file("metroparis.gpkg", package = "MTA"), layer = "com", quiet = TRUE)
ept &lt;- st_read(system.file("metroparis.gpkg", package = "MTA"), layer = "ept", quiet = TRUE)

# Prerequisites - Compute the 3 deviations
com$gdev &lt;- gdev(x = com, var1 = "INC", var2 = "TH")
com$tdev &lt;- tdev(x = com, var1 = "INC", var2 = "TH", key = "EPT")
com$sdev &lt;- sdev(x = com, var1 = "INC", var2 = "TH", order = 1)

#Example 1 - Wealthiest territorial units
# Compute map_mst
mst &lt;- map_mst(x = com, gdevrel = "gdev", tdevrel = "tdev", sdevrel = "sdev",
threshold = 125, superior = TRUE)

# Unlist outputs of the function
com &lt;- mst$geom
cols &lt;- mst$cols
leg_val &lt;- mst$leg_val

if(require(mapsf)){
# Cartography
mf_map(x = com, var = "mst", type = "typo", border = "white", lwd = 0.2,
       pal = cols, val_order = unique(com$mst), leg_pos = NA)
mf_map(ept, col = NA, border = "black", lwd = 1, add = TRUE)

mf_legend(type = "typo", val = leg_val, pal = cols, 
          title = "Situation on General (G)\nTerrorial (T) and\nSpatial (S) contexts",
          pos = "topleft")

mf_label(x = com[com$mst == 7,], var = "LIBCOM",
         cex = 0.6, halo = TRUE, overlap = FALSE)

mf_layout(title = "3-Deviations synthesis : Territorial units above index 125",
          credits = paste0("Sources: GEOFLA® 2015 v2.1, Apur, impots.gouv.fr",
                           "\nMTA", packageVersion("MTA")),
          arrow = FALSE)
}


# Example 2 - Lagging territorial units
# Compute map_mst
mst &lt;- map_mst(x = com, gdevrel = "gdev", tdevrel = "tdev", sdevrel = "sdev",
               threshold = 75, superior = FALSE)

# Unlist resulting function
com &lt;- mst$geom
cols &lt;- mst$cols
leg_val &lt;- mst$leg_val

if(require(mapsf)){
# Cartography
mf_map(x = com, var = "mst", type = "typo", border = "white", lwd = 0.2,
       pal = cols, val_order = unique(com$mst), leg_pos = NA)
mf_map(ept, col = NA, border = "black", lwd = 1, add = TRUE)

mf_legend(type = "typo", val = leg_val, pal = cols, 
          title = "Situation on General (G)\nTerrorial (T) and\nSpatial (S) contexts",
          pos = "topleft")

mf_label(x = com[com$mst == 7,], var = "LIBCOM",
         cex = 0.6, halo = TRUE, overlap = FALSE)

mf_layout(title = "3-Deviations synthesis : Territorial units below index 75",
          credits = paste0("Sources: GEOFLA® 2015 v2.1, Apur, impots.gouv.fr",
                           "\nMTA", packageVersion("MTA")),
          arrow = FALSE)

}
</code></pre>

<hr>
<h2 id='mas'>Multiscalar Absolute Synthesis</h2><span id='topic+mas'></span>

<h3>Description</h3>

<p>This function sums the total amount of redistributions according to the three absolute 
deviations (global, territorial, spatial).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mas(x, gdevabs, tdevabs, sdevabs, num)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mas_+3A_x">x</code></td>
<td>
<p>a sf object or a dataframe including gdevabs, tdevabs, sdevabs and num columns.</p>
</td></tr>
<tr><td><code id="mas_+3A_gdevabs">gdevabs</code></td>
<td>
<p>name of the general absolute deviation variable in x.</p>
</td></tr>
<tr><td><code id="mas_+3A_tdevabs">tdevabs</code></td>
<td>
<p>name of the territorial absolute deviation variable in x.</p>
</td></tr>
<tr><td><code id="mas_+3A_sdevabs">sdevabs</code></td>
<td>
<p>name of the spatial absolute deviation variable in x.</p>
</td></tr>
<tr><td><code id="mas_+3A_num">num</code></td>
<td>
<p>name of the numerator used for computing the 3 absolute deviations in x.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A dataframe including the mass of numerator to redistribue to reach a perfect equilibrium 
according to the 3 contexts, expressed in numerator measure unit and as a share of the numerator mass.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Load data
library(sf)
com &lt;- st_read(system.file("metroparis.gpkg", package = "MTA"), layer = "com", quiet = TRUE)

# general absolute deviation 
com$gdevabs &lt;- gdev(x = com, var1 = "INC",var2 = "TH", type = "abs")

# Territorial absolute deviation calculation
com$mdevabs &lt;- tdev(x = com,  var1 = "INC", var2 = "TH", type = "abs",
                    key = "LIBEPT")

# Local absolute deviation calculation redistribution 
com$ldevabs &lt;- sdev(x = com, xid = "DEPCOM", var1 = "INC", var2 = "TH",
                    order = 1, type = "abs")

# Compute the synthesis DataFrame (absolute deviations)
mas(x = com, 
    gdevabs = "gdevabs", 
    tdevabs = "mdevabs",
    sdevabs = "ldevabs",
    num = "INC") 
</code></pre>

<hr>
<h2 id='mst'>Multiscalar Typology (3 deviations)</h2><span id='topic+mst'></span>

<h3>Description</h3>

<p>Compute a multiscalar typology according to the three relative 
deviations (general: G, territorial: T and spatial: S). The elementary units are classified
in eight classes according to their three relative positions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mst(x, gdevrel, tdevrel, sdevrel, threshold, superior = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mst_+3A_x">x</code></td>
<td>
<p>a sf object or a dataframe including gdev, tdev and sdev columns.</p>
</td></tr>
<tr><td><code id="mst_+3A_gdevrel">gdevrel</code></td>
<td>
<p>name of the general relative deviation variable in x.</p>
</td></tr>
<tr><td><code id="mst_+3A_tdevrel">tdevrel</code></td>
<td>
<p>name of the territorial relative deviation variable in x.</p>
</td></tr>
<tr><td><code id="mst_+3A_sdevrel">sdevrel</code></td>
<td>
<p>name of the spatial relative deviation variable in x.</p>
</td></tr>
<tr><td><code id="mst_+3A_threshold">threshold</code></td>
<td>
<p>defined to build the typology (100 is considered as the average).</p>
</td></tr>
<tr><td><code id="mst_+3A_superior">superior</code></td>
<td>
<p>if TRUE, deviation values must be greater than threshold. If FALSE, deviation values must be lower than threshold.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a vector in x including the mst typology. Values are classified in 
8 classes following their respective position above/under the threshold:
</p>
<p>Typology (which deviation is above/under the threshold):
</p>
<ul>
<li><p>0: none
</p>
</li>
<li><p>1: G 
</p>
</li>
<li><p>2: T
</p>
</li>
<li><p>3: G and T
</p>
</li>
<li><p>4: S
</p>
</li>
<li><p>5: G and S
</p>
</li>
<li><p>6: T and S
</p>
</li>
<li><p>7: G, T and S
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Load data
library(sf)
com &lt;- st_read(system.file("metroparis.gpkg", package = "MTA"), layer = "com", quiet = TRUE)

# Prerequisite  - Compute the 3 deviations
com$gdev &lt;- gdev(x = com, var1 = "INC", var2 = "TH")
com$tdev &lt;- tdev(x = com, var1 = "INC", var2 = "TH", key = "EPT")
com$sdev &lt;- sdev(x = com, var1 = "INC", var2 = "TH", order = 1)

# Multiscalar typology - wealthiest territorial units
# Compute mst
com$mstW &lt;- mst(x = com, gdevrel = "gdev", tdevrel = "tdev", sdevrel = "sdev", 
                threshold = 125, superior = TRUE)

#Multiscalar typology - lagging territorial units
# Compute mst
com$mstP &lt;- mst(x = com, gdevrel = "gdev", tdevrel = "tdev", sdevrel = "sdev", 
                threshold = 75, superior = FALSE)
</code></pre>

<hr>
<h2 id='plot_bidev'>Plot Multiscalar Typology (2 deviations)</h2><span id='topic+plot_bidev'></span>

<h3>Description</h3>

<p>Vizualizing bidev and select some territorial units on it.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_bidev(
  x,
  dev1,
  dev2,
  breaks = c(25, 50, 100),
  dev1.lab = NULL,
  dev2.lab = NULL,
  lib.var = NULL,
  lib.val = NULL,
  cex.lab = 1,
  cex.axis = 0.7,
  cex.pt = 0.5,
  cex.names = 0.8,
  pos.names = 4
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_bidev_+3A_x">x</code></td>
<td>
<p>a sf object or a dataframe including 2 pre-calculated deviations.</p>
</td></tr>
<tr><td><code id="plot_bidev_+3A_dev1">dev1</code></td>
<td>
<p>column name of the first relative deviation in x.</p>
</td></tr>
<tr><td><code id="plot_bidev_+3A_dev2">dev2</code></td>
<td>
<p>coumn name of the second relative deviation in x.</p>
</td></tr>
<tr><td><code id="plot_bidev_+3A_breaks">breaks</code></td>
<td>
<p>distance to the index 100 (average of the context), in
percentage. A vector of three values. Defaut c(25,50,100). 25 
to indexes 80 and 125. 50 
and 200.</p>
</td></tr>
<tr><td><code id="plot_bidev_+3A_dev1.lab">dev1.lab</code></td>
<td>
<p>label to be put in x-axis of the scatter plot (default: NULL).</p>
</td></tr>
<tr><td><code id="plot_bidev_+3A_dev2.lab">dev2.lab</code></td>
<td>
<p>label to be put in y-axis of the scatter plot (default: NULL).</p>
</td></tr>
<tr><td><code id="plot_bidev_+3A_lib.var">lib.var</code></td>
<td>
<p>column name of x including territorial units name/code we
want to display on the plot.</p>
</td></tr>
<tr><td><code id="plot_bidev_+3A_lib.val">lib.val</code></td>
<td>
<p>a vector of territorial units included in lib.label we want
to display on the plot.</p>
</td></tr>
<tr><td><code id="plot_bidev_+3A_cex.lab">cex.lab</code></td>
<td>
<p>size of the axis label text (default = 1).</p>
</td></tr>
<tr><td><code id="plot_bidev_+3A_cex.axis">cex.axis</code></td>
<td>
<p>size of the tick label numbers (default = 0.7).</p>
</td></tr>
<tr><td><code id="plot_bidev_+3A_cex.pt">cex.pt</code></td>
<td>
<p>size of the dot used for extract specific territorial units 
(default 0.5).</p>
</td></tr>
<tr><td><code id="plot_bidev_+3A_cex.names">cex.names</code></td>
<td>
<p>size of the territorial units labels if selected 
(default 0.8).</p>
</td></tr>
<tr><td><code id="plot_bidev_+3A_pos.names">pos.names</code></td>
<td>
<p>position of territorial units labels (default 4, to the right).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A scatter-plot displaying the 13 bidev categories, which are the synthesis
of the position of territorial units according to 2 deviations and their
respective distance to the average. X-Y axis are expressed in logarithm 
(25 
being index 80). 
</p>
<p>bidev typology values :
</p>
<ul>
<li><p>ZZ: Near the average for the two selected deviation, in grey
</p>
</li>
<li><p>A1: Above the average for dev1 and dev2, distance to the avarage : +,
in light red
</p>
</li>
<li><p>A2: Above the average for dev1 and dev2, distance to the avarage : ++,
in red
</p>
</li>
<li><p>A3: Above the average for dev1 and dev2, distance to the avarage : +++,
in dark red
</p>
</li>
<li><p>B1: Above the average for dev1 and below for dev2, distance to the
avarage : +, in light yellow
</p>
</li>
<li><p>B2: Above the average for dev1 and below for dev2, distance to the
avarage : ++, in yellow
</p>
</li>
<li><p>B3: Above the average for dev1 and below for dev2, distance to the
avarage : +++, in dark yellow
</p>
</li>
<li><p>C1: Below the average for dev1 and dev2, distance to the avarage : +,
in light blue
</p>
</li>
<li><p>C2: Below the average for dev1 and dev2, distance to the avarage : ++,
in blue
</p>
</li>
<li><p>C3: Below the average for dev1 and dev2, distance to the avarage : +++,
in dark blue
</p>
</li>
<li><p>D1: Below the average for dev1 and above for dev2, distance to the
avarage : +, in light green
</p>
</li>
<li><p>D2: Below the average for dev1 and above for dev2, distance to the
avarage : ++, in green
</p>
</li>
<li><p>D3: Below the average for dev1 and above for dev2, distance to the
avarage : +++, in dark green
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Load data
library(sf)
com &lt;- st_read(system.file("metroparis.gpkg", package = "MTA"), layer = "com", quiet = TRUE)

# Prerequisite  - Compute 2 deviations
com$gdev &lt;- gdev(x = com, var1 = "INC", var2 = "TH")
com$tdev &lt;- tdev(x = com, var1 = "INC", var2 = "TH", key = "EPT")

# EX1 standard breaks with four labels
plot_bidev(x = com, 
           dev1 = "gdev", 
           dev2 = "tdev",
           dev1.lab = "General deviation (MGP Area)",
           dev2.lab = "Territorial deviation (EPT of belonging)",
           lib.var = "LIBCOM",
           lib.val =  c("Marolles-en-Brie", "Suresnes", 
                        "Clichy-sous-Bois", "Les Lilas"))

# EX2, change breaks, enlarge breaks 
plot_bidev(x = com,
           breaks = c(75, 150, 300),
           dev1 = "gdev", 
           dev2 = "tdev", 
           dev1.lab = "General deviation (MGP Area)",
           dev2.lab = "Territorial deviation (EPT of belonging)")
</code></pre>

<hr>
<h2 id='plot_mst'>Plot Multiscalar Typology (3 deviations)</h2><span id='topic+plot_mst'></span>

<h3>Description</h3>

<p>Vizualizing mst for selected territorial units.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_mst(
  x,
  gdevrel,
  tdevrel,
  sdevrel,
  legend.lab = NULL,
  lib.var,
  lib.val,
  cex.lab = 1,
  cex.axis = 0.8,
  cex.names = 0.8
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_mst_+3A_x">x</code></td>
<td>
<p>a sf object or a dataframe including 3 pre-calculated deviations.</p>
</td></tr>
<tr><td><code id="plot_mst_+3A_gdevrel">gdevrel</code></td>
<td>
<p>name of the general relative deviation variable in x.</p>
</td></tr>
<tr><td><code id="plot_mst_+3A_tdevrel">tdevrel</code></td>
<td>
<p>name of the territorial relative deviation variable in x.</p>
</td></tr>
<tr><td><code id="plot_mst_+3A_sdevrel">sdevrel</code></td>
<td>
<p>name of the the spatial relative deviation variable in x.</p>
</td></tr>
<tr><td><code id="plot_mst_+3A_legend.lab">legend.lab</code></td>
<td>
<p>label for explaining the plot (default = &quot;G: general, 
T: territorial, S: spatial (relative deviations, average = 100)&quot;.</p>
</td></tr>
<tr><td><code id="plot_mst_+3A_lib.var">lib.var</code></td>
<td>
<p>column name of x including territorial units name/code we
want to display on the plot.</p>
</td></tr>
<tr><td><code id="plot_mst_+3A_lib.val">lib.val</code></td>
<td>
<p>a vector of territorial units included in lib.label we want
to display on the plot.</p>
</td></tr>
<tr><td><code id="plot_mst_+3A_cex.lab">cex.lab</code></td>
<td>
<p>size of the axis legend label text (default = 1).</p>
</td></tr>
<tr><td><code id="plot_mst_+3A_cex.axis">cex.axis</code></td>
<td>
<p>size of the tick label numbers (default = 0.8).</p>
</td></tr>
<tr><td><code id="plot_mst_+3A_cex.names">cex.names</code></td>
<td>
<p>size of the territorial units labels if selected 
(default 0.8).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A barplot displaying the position for selected territorial units
on three territorial deviation. Y axis is expressed in logarithm 
(25 
being index 80).
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Load data
library(sf)
com &lt;- st_read(system.file("metroparis.gpkg", package = "MTA"), layer = "com", quiet = TRUE)

# Prerequisite  - Compute the 3 relative deviations
com$gdev &lt;- gdev(x = com, var1 = "INC", var2 = "TH")
com$tdev &lt;- tdev(x = com, var1 = "INC", var2 = "TH", key = "EPT")
com$sdev &lt;- sdev(x = com, var1 = "INC", var2 = "TH", order = 1)

# Synthesis barplot (3 territorial units)
plot_mst(x = com, gdevrel = "gdev", tdevrel = "tdev", sdevrel = "sdev", lib.var = "LIBCOM",
         lib.val = c("Neuilly-sur-Seine", "Clichy-sous-Bois", "Les Lilas"))
</code></pre>

<hr>
<h2 id='sdev'>Spatial Deviation</h2><span id='topic+sdev'></span>

<h3>Description</h3>

<p>Compute the deviation of each territorial unit as regards  
to its geographical neighborhood. Neighborhood is defined either
by contiguity order, by a distance value or by a personal matrix (travel time...)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sdev(x, var1, var2, type = "rel", xid, order, dist, mat)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sdev_+3A_x">x</code></td>
<td>
<p>a sf object including var1 and var2.</p>
</td></tr>
<tr><td><code id="sdev_+3A_var1">var1</code></td>
<td>
<p>name of the numerator variable in x.</p>
</td></tr>
<tr><td><code id="sdev_+3A_var2">var2</code></td>
<td>
<p>name of the denominator variable in x.</p>
</td></tr>
<tr><td><code id="sdev_+3A_type">type</code></td>
<td>
<p>type of deviation; &quot;rel&quot; for relative deviation, &quot;abs&quot; for 
absolute deviation (see Details).</p>
</td></tr>
<tr><td><code id="sdev_+3A_xid">xid</code></td>
<td>
<p>identifier field in x (to be used for importing a personal distance matrix). 
Default to the first column of x. (optional)</p>
</td></tr>
<tr><td><code id="sdev_+3A_order">order</code></td>
<td>
<p>contiguity order.</p>
</td></tr>
<tr><td><code id="sdev_+3A_dist">dist</code></td>
<td>
<p>distance threshold defining the contiguity. The cartesian 
distance between units centroids is used by default;
use mat to apply different metrics.</p>
</td></tr>
<tr><td><code id="sdev_+3A_mat">mat</code></td>
<td>
<p>a distance matrix (road distance, travel time...) between x units. 
Row and column names must fit xid identifiers. (optional)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The relative spatial deviation is the ratio between var1/var2 and 
var1/var2 in the specified neighborhood. Values greater than 100 indicate 
that the unit ratio is greater than the ratio in its neighborhood. Values 
lower than 100 indicate that the unit ratio is lower than the ratio in its 
neighborhood.<br />
The absolute spatial deviation is the amount of numerator that could be 
moved to obtain the same ratio in all units of its neighborhood.
</p>


<h3>Value</h3>

<p>A vector is returned.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Load data
library(sf)
com &lt;- st_read(system.file("metroparis.gpkg", package = "MTA"), layer = "com", quiet = TRUE)
ept &lt;- st_read(system.file("metroparis.gpkg", package = "MTA"), layer = "ept", quiet = TRUE)
cardist &lt;- read.table(system.file("cardist.txt", package = "MTA"), check.names = FALSE)
cardist &lt;- as.matrix(cardist)

# compute absolute spatial deviation in a neighborhood defined by a contiguity
# order of 1.
com$sdevabs &lt;- sdev(x = com, var1 = "INC", var2 = "TH", order = 1, type = "abs")

#compute relative spatial deviation in a neighborhood defined within a distance
# of 5km between communes' centroids
com$sdevrel &lt;- sdev(x = com, var1 = "INC", var2 = "TH", type = "rel", dist = 5000)

# compute absolute spatial deviation in a neighborhood defined within a road
# travel time of 10 minutes by car
com$scardevabs &lt;- sdev(x = com, var1 = "INC", var2 = "TH", type = "abs", dist = 10, mat = cardist)

# compute relative spatial deviation in a neighborhood defined within a road
# travel time of 10 minutes by car
com$scardevrel &lt;- sdev(x = com, var1 = "INC", var2 = "TH", type = "rel", dist = 10, mat = cardist)

if(require(mapsf)){
# relative deviation map
# set breaks
bks &lt;- c(min(com$scardevrel), 75, 100, 125, 150, max(com$scardevrel))
# plot a choropleth map of the relative spatial deviation
mf_map(x = com, var = "scardevrel", type = "choro", leg_pos = "topleft",
       leg_title = "Relative Deviation\n(100 = spatial average)",
       breaks = bks, border = NA,
       pal = c("#91BFDB", "#E0F3F8", "#FEE090", "#FC8D59", "#D73027"))

# add EPT boundaries
mf_map(x = ept, col = NA, add = TRUE)

# layout
mf_layout(title = "Spatial Deviation (neighborhood : 10 minutes by car)",
          credits = paste0("Sources: GEOFLA® 2015 v2.1, Apur, impots.gouv.fr",
                           "\nMTA", packageVersion("MTA")),
          arrow = FALSE)
}
</code></pre>

<hr>
<h2 id='tdev'>Territorial Deviation</h2><span id='topic+tdev'></span>

<h3>Description</h3>

<p>Compute the deviation of each territorial unit as regards  
to an intermediate territorial level of reference.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tdev(x, var1, var2, type = "rel", key)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tdev_+3A_x">x</code></td>
<td>
<p>a dataframe or a sf object including  var1 and var2 and an 
aggregation key field (territorial belonging).</p>
</td></tr>
<tr><td><code id="tdev_+3A_var1">var1</code></td>
<td>
<p>name of the numerator variable in x.</p>
</td></tr>
<tr><td><code id="tdev_+3A_var2">var2</code></td>
<td>
<p>name of the denominator variable in x.</p>
</td></tr>
<tr><td><code id="tdev_+3A_type">type</code></td>
<td>
<p>type of deviation; &quot;rel&quot; for relative deviation, &quot;abs&quot; for 
absolute deviation (see Details).</p>
</td></tr>
<tr><td><code id="tdev_+3A_key">key</code></td>
<td>
<p>aggregation key field for measuring the deviation (intermediate 
territorial level).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The relative territorial deviation is the ratio between var1/var2 and 
var1/var2 at the aggregated level. Values greater than 100 indicate that the 
unit ratio is greater than the ratio at the aggregated level. Values lower 
than 100 indicate that the unit ratio is lower than the ratio of the 
aggregated level.<br />
The absolute territorial deviation is the amount of numerator that could be 
moved to obtain the ratio of the aggregated level on all belonging units.
</p>


<h3>Value</h3>

<p>A vector is returned.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Load data
library(sf)
com &lt;- st_read(system.file("metroparis.gpkg", package = "MTA"), layer = "com", quiet = TRUE)
ept &lt;- st_read(system.file("metroparis.gpkg", package = "MTA"), layer = "ept", quiet = TRUE)

# compute absolute territorial deviation
com$tdevabs &lt;- tdev(x = com, var1 = "INC", var2 = "TH", key = "EPT", 
                    type = "abs")
# compute relative territorial deviation
com$tdevrel &lt;- tdev(x = com, var1 = "INC", var2 = "TH", key = "EPT", 
                    type = "rel")
if(require(mapsf)){
# relative deviation map
# set breaks
bks &lt;- c(min(com$tdevrel), 80, 91, 100, 110, 125, max(com$tdevrel))
# plot a choropleth map of the relative territorial deviation
mf_map(x = com, var = "tdevrel", type = "choro", leg_pos = "topleft",
       leg_title = "Relative Deviation\n(100 = general average)",
       breaks = bks, border = NA,
       pal = c("#4575B4", "#91BFDB", "#E0F3F8", "#FEE090", "#FC8D59", "#D73027"))

# add EPT boundaries
mf_map(x = ept, col = NA, add = TRUE)

# layout
mf_layout(title = "Territorial Deviation (reference: EPT of belonging)",
         credits = paste0("Sources: GEOFLA® 2015 v2.1, Apur, impots.gouv.fr",
                          "\nMTA", packageVersion("MTA")),
         arrow = FALSE)


# absolute deviation map
com$sign &lt;- ifelse(test = com$tdevabs &lt; 0, yes = "Under-Income", no = "Over-Income")
mf_map(ept)

mf_map(x = com, var = c("tdevabs", "sign"), type = "prop_typo", inches = 0.2,
      leg_title = c("Absolute Deviation\n(Income redistribution, euros)",
                    "Redistribution direction"), 
      leg_pos = c("topleft", "topright"), leg_val_rnd = -2,
      val_order = c("Under-Income", "Over-Income"),
      pal =  c("#ff0000","#0000ff"), add = TRUE)

# layout
mf_layout(title = "Territorial Deviation (reference: EPT of belonging)",
         credits = paste0("Sources: GEOFLA® 2015 v2.1, Apur, impots.gouv.fr",
                          "\nMTA", packageVersion("MTA")),
         arrow = FALSE)
}
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
