<!DOCTYPE html><html><head><title>Help for package trajmsm</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {trajmsm}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#build_traj'><p>Wrapper for flexmix</p></a></li>
<li><a href='#gendata'><p>Generate data trajectories for MSM</p></a></li>
<li><a href='#gformula'><p>Counterfactual means via G-Formula</p></a></li>
<li><a href='#ggtraj'><p>ggplot Trajectory</p></a></li>
<li><a href='#inverse_probability_weighting'><p>Inverse Probability Weighting</p></a></li>
<li><a href='#pltmle'><p>Counterfactual means for a Pooled LTMLE</p></a></li>
<li><a href='#predict_traj'><p>Predict trajectory groups for deterministic treatment regimes</p></a></li>
<li><a href='#split_data'><p>Split observed data into multiple subsets</p></a></li>
<li><a href='#trajhrmsm_gform'><p>History Restricted MSM and Latent Class of Growth Analysis estimated with G-formula.</p></a></li>
<li><a href='#trajhrmsm_ipw'><p>History Restricted MSM and Latent Class of Growth Analysis estimated with IPW.</p></a></li>
<li><a href='#trajhrmsm_pltmle'><p>History Restricted MSM and Latent Class of Growth Analysis estimated with a Pooled LTMLE.</p></a></li>
<li><a href='#trajmsm_gform'><p>Parametric g-formula</p></a></li>
<li><a href='#trajmsm_ipw'><p>Marginal Structural Model and Latent Class of Growth Analysis estimated with IPW</p></a></li>
<li><a href='#trajmsm_pltmle'><p>Pooled LTMLE</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Marginal Structural Models with Latent Class Growth Analysis of
Treatment Trajectories</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Awa Diop &lt;awa.diop.2@ulaval.ca&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Implements marginal structural models combined with a latent class growth analysis framework for assessing the causal effect of treatment trajectories. Based on the approach described in "Marginal Structural Models with Latent Class Growth Analysis of Treatment Trajectories" Diop, A., Sirois, C., Guertin, J.R., Schnitzer, M.E., Candas, B., Cossette, B., Poirier, P., Brophy, J., MÃ©sidor, M., Blais, C. and Hamel, D., (2023) &lt;<a href="https://doi.org/10.1177%2F09622802231202384">doi:10.1177/09622802231202384</a>&gt;. </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats, class, e1071, flexmix, geepack, ggplot2, survival,
sandwich, utils</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/awamaeva/R-package-trajmsm">https://github.com/awamaeva/R-package-trajmsm</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/awamaeva/R-package-trajmsm/issues">https://github.com/awamaeva/R-package-trajmsm/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-02-13 17:02:59 UTC; YaHawa</td>
</tr>
<tr>
<td>Author:</td>
<td>Awa Diop [aut, cre],
  Denis Talbot [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-02-14 17:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='build_traj'>Wrapper for flexmix</h2><span id='topic+build_traj'></span>

<h3>Description</h3>

<p>Call the package flexmix to build trajectory groups
</p>


<h3>Usage</h3>

<pre><code class='language-R'>build_traj(
  obsdata,
  formula,
  number_traj,
  identifier,
  family = "binomial",
  seed = 945,
  control = list(iter.max = 1000, minprior = 0),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="build_traj_+3A_obsdata">obsdata</code></td>
<td>
<p>Data to build trajectory groups in long format.</p>
</td></tr>
<tr><td><code id="build_traj_+3A_formula">formula</code></td>
<td>
<p>Designate the formula to model the longitudinal variable of interest.</p>
</td></tr>
<tr><td><code id="build_traj_+3A_number_traj">number_traj</code></td>
<td>
<p>An integer to fix the number of trajectory groups.</p>
</td></tr>
<tr><td><code id="build_traj_+3A_identifier">identifier</code></td>
<td>
<p>A string to designate the column name for the unique identifier.</p>
</td></tr>
<tr><td><code id="build_traj_+3A_family">family</code></td>
<td>
<p>Designate the type of distribution (&quot;gaussian&quot;, &quot;binomial&quot;, &quot;poisson&quot;, &quot;gamma&quot;).</p>
</td></tr>
<tr><td><code id="build_traj_+3A_seed">seed</code></td>
<td>
<p>Set a seed for replicability.</p>
</td></tr>
<tr><td><code id="build_traj_+3A_control">control</code></td>
<td>
<p>Object of class FLXcontrol.</p>
</td></tr>
<tr><td><code id="build_traj_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to the flexmix function.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the posterior probability matrix and the fitted trajectory model.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>obsdata_long = gendata(n = 1000,format = "long", total_followup = 6, seed = 945)
formula = as.formula(cbind(statins, 1 - statins) ~ time)
restraj = build_traj(obsdata = obsdata_long, number_traj = 3, formula = formula, identifier = "id")
</code></pre>

<hr>
<h2 id='gendata'>Generate data trajectories for MSM</h2><span id='topic+gendata'></span>

<h3>Description</h3>

<p>Provides datasets for running examples for LCGA-MSM and LCGA-HRMSM.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gendata(
  n,
  include_censor = FALSE,
  format = c("long", "wide"),
  start_year = 2011,
  total_followup,
  timedep_outcome = FALSE,
  seed
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gendata_+3A_n">n</code></td>
<td>
<p>Number of observations to generate.</p>
</td></tr>
<tr><td><code id="gendata_+3A_include_censor">include_censor</code></td>
<td>
<p>Logical, if TRUE, includes censoring.</p>
</td></tr>
<tr><td><code id="gendata_+3A_format">format</code></td>
<td>
<p>Character, either &quot;long&quot; or &quot;wide&quot; for the format of the output data frame.</p>
</td></tr>
<tr><td><code id="gendata_+3A_start_year">start_year</code></td>
<td>
<p>Baseline year.</p>
</td></tr>
<tr><td><code id="gendata_+3A_total_followup">total_followup</code></td>
<td>
<p>Number of measuring times.</p>
</td></tr>
<tr><td><code id="gendata_+3A_timedep_outcome">timedep_outcome</code></td>
<td>
<p>Logical, if TRUE, includes a time-dependent outcome.</p>
</td></tr>
<tr><td><code id="gendata_+3A_seed">seed</code></td>
<td>
<p>Use a specific seed value to ensure the simulated data is replicable.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with generated data trajectories.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>gendata(n = 100, include_censor = FALSE, format = "wide",total_followup = 3, seed = 945)
</code></pre>

<hr>
<h2 id='gformula'>Counterfactual means via G-Formula</h2><span id='topic+gformula'></span>

<h3>Description</h3>

<p>Calculates counterfactual means using the g-formula approach.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gformula(
  formula,
  baseline,
  covariates,
  treatment,
  outcome,
  ntimes_interval,
  obsdata
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gformula_+3A_formula">formula</code></td>
<td>
<p>Specification of the model for the outcome to be fitted.</p>
</td></tr>
<tr><td><code id="gformula_+3A_baseline">baseline</code></td>
<td>
<p>Names of the baseline covariates.</p>
</td></tr>
<tr><td><code id="gformula_+3A_covariates">covariates</code></td>
<td>
<p>Names of the time-varying covariates (should be a list).</p>
</td></tr>
<tr><td><code id="gformula_+3A_treatment">treatment</code></td>
<td>
<p>Names of the time-varying treatment.</p>
</td></tr>
<tr><td><code id="gformula_+3A_outcome">outcome</code></td>
<td>
<p>Name of the outcome variable.</p>
</td></tr>
<tr><td><code id="gformula_+3A_ntimes_interval">ntimes_interval</code></td>
<td>
<p>Length of a time-interval (s).</p>
</td></tr>
<tr><td><code id="gformula_+3A_obsdata">obsdata</code></td>
<td>
<p>Observed data in wide format.</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>list_gform_countermeans</code></td>
<td>
<p> List of counterfactual means obtained with g-formula.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Awa Diop, Denis Talbot
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
obsdata = gendata(n = 1000, format = "wide", total_followup = 6, seed = 945)
years &lt;- 2011:2016
baseline_var &lt;- c("age","sex")
variables &lt;- c("hyper", "bmi")
var_cov &lt;- c("statins","hyper", "bmi")
covariates &lt;- lapply(years, function(year) {
paste0(variables, year)})
treatment_var &lt;- paste0("statins", 2011:2016)
formula = paste0("y ~", paste0(treatment_var,collapse = "+"), "+",
                paste0(unlist(covariates), collapse = "+"),"+",
                paste0(baseline_var, collapse = "+"))
res_gform &lt;- gformula(formula = formula, baseline = baseline_var, covariates = covariates,
treatment = treatment_var, outcome = "y", ntimes_interval = 6, obsdata =   obsdata )

</code></pre>

<hr>
<h2 id='ggtraj'>ggplot Trajectory</h2><span id='topic+ggtraj'></span>

<h3>Description</h3>

<p>Use <code>"ggplot2"</code> to plot trajectory groups produced by the function <code>"build_traj"</code> using the observed treatment.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ggtraj(traj_data, treatment, time, identifier, class, FUN = mean, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ggtraj_+3A_traj_data">traj_data</code></td>
<td>
<p>Merged datasets containing observed data in long format and trajectory groups.</p>
</td></tr>
<tr><td><code id="ggtraj_+3A_treatment">treatment</code></td>
<td>
<p>Name of the time-varying treatment.</p>
</td></tr>
<tr><td><code id="ggtraj_+3A_time">time</code></td>
<td>
<p>Name of the time variable.</p>
</td></tr>
<tr><td><code id="ggtraj_+3A_identifier">identifier</code></td>
<td>
<p>Name of the identifier variable.</p>
</td></tr>
<tr><td><code id="ggtraj_+3A_class">class</code></td>
<td>
<p>Name of the trajectory groups.</p>
</td></tr>
<tr><td><code id="ggtraj_+3A_fun">FUN</code></td>
<td>
<p>Specify which statistics to display, by default calculate the mean.</p>
</td></tr>
<tr><td><code id="ggtraj_+3A_...">...</code></td>
<td>
<p>Additional arguments to be passed to ggplot functions.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggplot object representing the trajectory groups using the observed treatment.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
obsdata_long = gendata(n = 1000, format = "long", total_followup = 12, seed = 945)
restraj = build_traj(obsdata = obsdata_long, number_traj = 3,
formula = as.formula(cbind(statins, 1 - statins) ~ time), identifier = "id")
datapost = restraj$data_post
head(datapost)
traj_data_long &lt;- merge(obsdata_long, datapost, by = "id")
    AggFormula &lt;- as.formula(paste("statins", "~", "time", "+", "class"))
    Aggtraj_data &lt;- aggregate(AggFormula, data = traj_data_long, FUN = mean)
    Aggtraj_data
#Aggtraj_data with labels
traj_data_long[ , "traj_group"] &lt;- factor(ifelse(traj_data_long[ , "class"] == "3" ,"Group1" ,
ifelse (traj_data_long[ , "class"]== "1" , "Group2" ,"Group3")))
AggFormula &lt;- as.formula(paste("statins", "~", "time", "+", "traj_group"))
Aggtraj_data &lt;- aggregate(AggFormula, data = traj_data_long, FUN = mean)
ggtraj(traj_data =  Aggtraj_data,
treatment = "statins",time= "time",identifier="id",class = "traj_group", FUN = mean)

</code></pre>

<hr>
<h2 id='inverse_probability_weighting'>Inverse Probability Weighting</h2><span id='topic+inverse_probability_weighting'></span>

<h3>Description</h3>

<p>Compute stabilized and unstabilized weights, with or without censoring.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>inverse_probability_weighting(
  numerator = c("stabilized", "unstabilized"),
  identifier,
  baseline,
  covariates,
  treatment,
  include_censor = FALSE,
  censor,
  obsdata
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="inverse_probability_weighting_+3A_numerator">numerator</code></td>
<td>
<p>To choose between stabilized and unstabilized weights.</p>
</td></tr>
<tr><td><code id="inverse_probability_weighting_+3A_identifier">identifier</code></td>
<td>
<p>Name of the column of the unique identifier.</p>
</td></tr>
<tr><td><code id="inverse_probability_weighting_+3A_baseline">baseline</code></td>
<td>
<p>Name of the baseline covariates.</p>
</td></tr>
<tr><td><code id="inverse_probability_weighting_+3A_covariates">covariates</code></td>
<td>
<p>Name of the time-varying covariates.</p>
</td></tr>
<tr><td><code id="inverse_probability_weighting_+3A_treatment">treatment</code></td>
<td>
<p>Name of the time-varying treatment.</p>
</td></tr>
<tr><td><code id="inverse_probability_weighting_+3A_include_censor">include_censor</code></td>
<td>
<p>Logical value TRUE/FALSE to include or not a censoring variable.</p>
</td></tr>
<tr><td><code id="inverse_probability_weighting_+3A_censor">censor</code></td>
<td>
<p>Name of the censoring variable.</p>
</td></tr>
<tr><td><code id="inverse_probability_weighting_+3A_obsdata">obsdata</code></td>
<td>
<p>Observed data in wide format.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Inverse Probability Weights (Stabilized and Unstabilized) with and without censoring.
</p>


<h3>Author(s)</h3>

<p>Awa Diop, Denis Talbot
</p>


<h3>Examples</h3>

<pre><code class='language-R'>obsdata = gendata(n = 1000, format = "wide",total_followup = 3, seed = 945)
baseline_var &lt;- c("age","sex")
covariates &lt;- list(c("hyper2011", "bmi2011"),
c("hyper2012", "bmi2012"),c("hyper2013", "bmi2013"))
treatment_var &lt;- c("statins2011","statins2012","statins2013")
stabilized_weights = inverse_probability_weighting(numerator = "stabilized",
identifier = "id", covariates = covariates, treatment = treatment_var,
baseline = baseline_var, obsdata = obsdata)
</code></pre>

<hr>
<h2 id='pltmle'>Counterfactual means for a Pooled LTMLE</h2><span id='topic+pltmle'></span>

<h3>Description</h3>

<p>Function to estimate counterfactual means for a pooled LTMLE.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pltmle(
  formula,
  outcome,
  treatment,
  covariates,
  baseline,
  ntimes_interval,
  number_traj,
  time,
  time_values,
  identifier,
  obsdata,
  traj,
  total_followup,
  treshold = treshold
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pltmle_+3A_formula">formula</code></td>
<td>
<p>Specification of the model for the outcome to be fitted.</p>
</td></tr>
<tr><td><code id="pltmle_+3A_outcome">outcome</code></td>
<td>
<p>Name of the outcome variable.</p>
</td></tr>
<tr><td><code id="pltmle_+3A_treatment">treatment</code></td>
<td>
<p>Time-varying treatment.</p>
</td></tr>
<tr><td><code id="pltmle_+3A_covariates">covariates</code></td>
<td>
<p>Covariates.</p>
</td></tr>
<tr><td><code id="pltmle_+3A_baseline">baseline</code></td>
<td>
<p>Name of baseline covariates.</p>
</td></tr>
<tr><td><code id="pltmle_+3A_ntimes_interval">ntimes_interval</code></td>
<td>
<p>Length of a time-interval (s).</p>
</td></tr>
<tr><td><code id="pltmle_+3A_number_traj">number_traj</code></td>
<td>
<p>An integer to choose the number of trajectory groups.</p>
</td></tr>
<tr><td><code id="pltmle_+3A_time">time</code></td>
<td>
<p>Name of the time variable.</p>
</td></tr>
<tr><td><code id="pltmle_+3A_time_values">time_values</code></td>
<td>
<p>Measuring times.</p>
</td></tr>
<tr><td><code id="pltmle_+3A_identifier">identifier</code></td>
<td>
<p>Name of the column of the unique identifier.</p>
</td></tr>
<tr><td><code id="pltmle_+3A_obsdata">obsdata</code></td>
<td>
<p>Observed data in wide format.</p>
</td></tr>
<tr><td><code id="pltmle_+3A_traj">traj</code></td>
<td>
<p>Matrix of indicators for the trajectory groups.</p>
</td></tr>
<tr><td><code id="pltmle_+3A_total_followup">total_followup</code></td>
<td>
<p>Number of measuring times per interval.</p>
</td></tr>
<tr><td><code id="pltmle_+3A_treshold">treshold</code></td>
<td>
<p>For weight truncation.</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>list_pltmle_countermeans</code></td>
<td>
<p> Counterfactual means and influence functions with the pooled ltmle.</p>
</td></tr>
<tr><td><code>D</code></td>
<td>
<p>Influence functions</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Awa Diop, Denis Talbot
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
obsdata_long = gendata(n = 2000, format = "long",total_followup = 3, seed = 945)
baseline_var &lt;- c("age","sex")
covariates &lt;- list(c("hyper2011", "bmi2011"),
c("hyper2012", "bmi2012"),c("hyper2013", "bmi2013"))
treatment_var &lt;- c("statins2011","statins2012","statins2013")
time_values &lt;- c(2011,2012,2013)
formulaA = as.formula(cbind(statins, 1 - statins) ~ time)
restraj = build_traj(obsdata = obsdata_long, number_traj = 3,
formula = formulaA, identifier = "id")
datapost = restraj$data_post
trajmsm_long &lt;- merge(obsdata_long, datapost, by = "id")
    AggFormula &lt;- as.formula(paste("statins", "~", "time", "+", "class"))
    AggTrajData &lt;- aggregate(AggFormula, data = trajmsm_long, FUN = mean)
    AggTrajData
trajmsm_long[ , "traj_group"] &lt;- trajmsm_long[ , "class"]
obsdata= reshape(trajmsm_long, direction = "wide", idvar = "id",
v.names = c("statins","bmi","hyper"), timevar = "time", sep ="")
formula =  as.formula(" y ~ statins2011 + statins2012 + statins2013 +
hyper2011 + bmi2011 + hyper2012 + bmi2012 +
 hyper2013 + bmi2013 + age + sex ")
class = factor(predict_traj(identifier = "id", total_followup = 3,
        treatment = "statins", time = "time", time_values = time_values,
        trajmodel = restraj$traj_model)$post_class);
traj=t(sapply(1:8,function(x)sapply(1:3,function(i)ifelse(class[x]==i,1,0))))
traj[,1]=1
res_pltmle = pltmle(formula = formula, outcome = "y",treatment = treatment_var,
covariates = covariates, baseline = baseline_var, ntimes_interval = 3, number_traj = 3,
 time =  "time",time_values = time_values,identifier = "id",obsdata = obsdata,
traj=traj, treshold = 0.99)
res_pltmle$counter_means

</code></pre>

<hr>
<h2 id='predict_traj'>Predict trajectory groups for deterministic treatment regimes</h2><span id='topic+predict_traj'></span>

<h3>Description</h3>

<p>Function to predict trajectory groups for deterministic treatment regimes
used with gformula and pooled LTMLE.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predict_traj(
  identifier,
  total_followup,
  treatment,
  time,
  time_values,
  trajmodel
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict_traj_+3A_identifier">identifier</code></td>
<td>
<p>Name of the column of the unique identifier.</p>
</td></tr>
<tr><td><code id="predict_traj_+3A_total_followup">total_followup</code></td>
<td>
<p>Number of measuring times.</p>
</td></tr>
<tr><td><code id="predict_traj_+3A_treatment">treatment</code></td>
<td>
<p>Name of the time-varying treatment.</p>
</td></tr>
<tr><td><code id="predict_traj_+3A_time">time</code></td>
<td>
<p>Name of the variable time.</p>
</td></tr>
<tr><td><code id="predict_traj_+3A_time_values">time_values</code></td>
<td>
<p>Values of the time variable.</p>
</td></tr>
<tr><td><code id="predict_traj_+3A_trajmodel">trajmodel</code></td>
<td>
<p>Trajectory model built with the observed treatment.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame with the posterior probabilities.
</p>


<h3>Author(s)</h3>

<p>Awa Diop, Denis Talbot
</p>

<hr>
<h2 id='split_data'>Split observed data into multiple subsets</h2><span id='topic+split_data'></span>

<h3>Description</h3>

<p>Function to split the data into multiple subsets of size s each
one subset corresponding to one time-interval.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>split_data(
  obsdata,
  total_followup,
  ntimes_interval,
  time,
  time_values,
  identifier
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="split_data_+3A_obsdata">obsdata</code></td>
<td>
<p>Observed data in wide format.</p>
</td></tr>
<tr><td><code id="split_data_+3A_total_followup">total_followup</code></td>
<td>
<p>Total length of follow-up.</p>
</td></tr>
<tr><td><code id="split_data_+3A_ntimes_interval">ntimes_interval</code></td>
<td>
<p>Number of measuring times per interval.</p>
</td></tr>
<tr><td><code id="split_data_+3A_time">time</code></td>
<td>
<p>Name of the time variable.</p>
</td></tr>
<tr><td><code id="split_data_+3A_time_values">time_values</code></td>
<td>
<p>Measuring times.</p>
</td></tr>
<tr><td><code id="split_data_+3A_identifier">identifier</code></td>
<td>
<p>Identifier of individuals.</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>all_df</code></td>
<td>
<p> All subsets, list of time intervals.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Awa Diop Denis Talbot
</p>


<h3>Examples</h3>

<pre><code class='language-R'>obsdata = gendata(n = 1000, format = "long", total_followup = 8, seed = 945)
years &lt;- 2011:2018
res = split_data(obsdata = obsdata, total_followup = 8,
ntimes_interval = 6,time = "time", time_values = years,identifier = "id")
</code></pre>

<hr>
<h2 id='trajhrmsm_gform'>History Restricted MSM and Latent Class of Growth Analysis estimated with G-formula.</h2><span id='topic+trajhrmsm_gform'></span>

<h3>Description</h3>

<p>Estimate parameters of LCGA-HRMSM using g-formula.
and bootstrap to get standard errors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trajhrmsm_gform(
  degree_traj = c("linear", "quadratic", "cubic"),
  rep = 50,
  treatment,
  covariates,
  baseline,
  outcome,
  ntimes_interval,
  total_followup,
  time,
  time_values,
  identifier,
  var_cov,
  number_traj = 3,
  family = "poisson",
  obsdata
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="trajhrmsm_gform_+3A_degree_traj">degree_traj</code></td>
<td>
<p>To specify the polynomial degree for modelling the time-varying treatment.</p>
</td></tr>
<tr><td><code id="trajhrmsm_gform_+3A_rep">rep</code></td>
<td>
<p>Number of repetition for the bootstrap.</p>
</td></tr>
<tr><td><code id="trajhrmsm_gform_+3A_treatment">treatment</code></td>
<td>
<p>Name of the time-varying treatment.</p>
</td></tr>
<tr><td><code id="trajhrmsm_gform_+3A_covariates">covariates</code></td>
<td>
<p>Names of the time-varying covariates (should be a list).</p>
</td></tr>
<tr><td><code id="trajhrmsm_gform_+3A_baseline">baseline</code></td>
<td>
<p>Name of baseline covariates.</p>
</td></tr>
<tr><td><code id="trajhrmsm_gform_+3A_outcome">outcome</code></td>
<td>
<p>Name of the outcome variable.</p>
</td></tr>
<tr><td><code id="trajhrmsm_gform_+3A_ntimes_interval">ntimes_interval</code></td>
<td>
<p>Length of a time-interval (s).</p>
</td></tr>
<tr><td><code id="trajhrmsm_gform_+3A_total_followup">total_followup</code></td>
<td>
<p>Total length of follow-up.</p>
</td></tr>
<tr><td><code id="trajhrmsm_gform_+3A_time">time</code></td>
<td>
<p>Name of the time variable.</p>
</td></tr>
<tr><td><code id="trajhrmsm_gform_+3A_time_values">time_values</code></td>
<td>
<p>Measuring times.</p>
</td></tr>
<tr><td><code id="trajhrmsm_gform_+3A_identifier">identifier</code></td>
<td>
<p>Name of the column of the unique identifier.</p>
</td></tr>
<tr><td><code id="trajhrmsm_gform_+3A_var_cov">var_cov</code></td>
<td>
<p>Names of the time-varying covariates.</p>
</td></tr>
<tr><td><code id="trajhrmsm_gform_+3A_number_traj">number_traj</code></td>
<td>
<p>Number of trajectory groups.</p>
</td></tr>
<tr><td><code id="trajhrmsm_gform_+3A_family">family</code></td>
<td>
<p>Specification of the error distribution and link function to be used in the model.</p>
</td></tr>
<tr><td><code id="trajhrmsm_gform_+3A_obsdata">obsdata</code></td>
<td>
<p>Data in a long format.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following components:
</p>

<dl>
<dt>results_hrmsm_gform</dt><dd><p> Matrix of estimates for LCGA-MSM, obtained using the g-formula method.</p>
</dd>
<dt>result_coef_boot</dt><dd><p> Matrix of estimates obtained with bootstrap.</p>
</dd>
<dt>restraj</dt><dd><p> Fitted trajectory model.</p>
</dd>
<dt>mean_adh</dt><dd><p> Matrix of mean adherence per trajectory group.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Awa Diop Denis Talbot
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
obsdata_long = gendata(n = 1000, format = "long", total_followup = 8,
timedep_outcome = TRUE,  seed = 945)
baseline_var &lt;- c("age","sex")
years &lt;- 2011:2018
variables &lt;- c("hyper", "bmi")
covariates &lt;- lapply(years, function(year) {
paste0(variables, year)})
treatment_var &lt;- paste0("statins", 2011:2018)
var_cov &lt;- c("statins","hyper", "bmi")
reshrmsm_gform = trajhrmsm_gform(degree_traj = "linear", rep=5 ,
treatment = treatment_var,covariates = covariates, baseline = baseline_var,
outcome = "y",var_cov = var_cov, ntimes_interval = 6, total_followup = 8,
 time = "time",time_values = years, identifier = "id",
number_traj = 3, family = "poisson", obsdata = obsdata_long)
reshrmsm_gform$results_hrmsm_gform

</code></pre>

<hr>
<h2 id='trajhrmsm_ipw'>History Restricted MSM and Latent Class of Growth Analysis estimated with IPW.</h2><span id='topic+trajhrmsm_ipw'></span>

<h3>Description</h3>

<p>Estimate parameters of LCGA-HRMSM using IPW.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trajhrmsm_ipw(
  degree_traj = c("linear", "quadratic", "cubic"),
  numerator = c("stabilized", "unstabilized"),
  identifier,
  baseline,
  covariates,
  treatment,
  outcome,
  var_cov,
  include_censor = FALSE,
  ntimes_interval,
  total_followup,
  time,
  time_values,
  family = "poisson",
  censor = censor,
  number_traj,
  obsdata,
  weights = NULL,
  treshold = 0.999
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="trajhrmsm_ipw_+3A_degree_traj">degree_traj</code></td>
<td>
<p>To specify the polynomial degree for modelling the time-varying treatment.</p>
</td></tr>
<tr><td><code id="trajhrmsm_ipw_+3A_numerator">numerator</code></td>
<td>
<p>To choose between stabilized and unstabilized weights.</p>
</td></tr>
<tr><td><code id="trajhrmsm_ipw_+3A_identifier">identifier</code></td>
<td>
<p>Name of the column of the unique identifier.</p>
</td></tr>
<tr><td><code id="trajhrmsm_ipw_+3A_baseline">baseline</code></td>
<td>
<p>Names of the baseline covariates.</p>
</td></tr>
<tr><td><code id="trajhrmsm_ipw_+3A_covariates">covariates</code></td>
<td>
<p>Names of the time-varying covariates (should be a list).</p>
</td></tr>
<tr><td><code id="trajhrmsm_ipw_+3A_treatment">treatment</code></td>
<td>
<p>Name of the time-varying treatment.</p>
</td></tr>
<tr><td><code id="trajhrmsm_ipw_+3A_outcome">outcome</code></td>
<td>
<p>Name of the outcome variable.</p>
</td></tr>
<tr><td><code id="trajhrmsm_ipw_+3A_var_cov">var_cov</code></td>
<td>
<p>Names of the time-varying covariates.</p>
</td></tr>
<tr><td><code id="trajhrmsm_ipw_+3A_include_censor">include_censor</code></td>
<td>
<p>Logical, if TRUE, includes censoring.</p>
</td></tr>
<tr><td><code id="trajhrmsm_ipw_+3A_ntimes_interval">ntimes_interval</code></td>
<td>
<p>Length of a time-interval (s).</p>
</td></tr>
<tr><td><code id="trajhrmsm_ipw_+3A_total_followup">total_followup</code></td>
<td>
<p>Total length of follow-up.</p>
</td></tr>
<tr><td><code id="trajhrmsm_ipw_+3A_time">time</code></td>
<td>
<p>Name of the time variable.</p>
</td></tr>
<tr><td><code id="trajhrmsm_ipw_+3A_time_values">time_values</code></td>
<td>
<p>Values of the time variable.</p>
</td></tr>
<tr><td><code id="trajhrmsm_ipw_+3A_family">family</code></td>
<td>
<p>specification of the error distribution and link function to be used in the model.</p>
</td></tr>
<tr><td><code id="trajhrmsm_ipw_+3A_censor">censor</code></td>
<td>
<p>Name of the censoring variable.</p>
</td></tr>
<tr><td><code id="trajhrmsm_ipw_+3A_number_traj">number_traj</code></td>
<td>
<p>Number of trajectory groups.</p>
</td></tr>
<tr><td><code id="trajhrmsm_ipw_+3A_obsdata">obsdata</code></td>
<td>
<p>Data in a long format.</p>
</td></tr>
<tr><td><code id="trajhrmsm_ipw_+3A_weights">weights</code></td>
<td>
<p>A vector of estimated weights. If NULL, the weights are computed by the function.</p>
</td></tr>
<tr><td><code id="trajhrmsm_ipw_+3A_treshold">treshold</code></td>
<td>
<p>For weight truncation.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Provides a matrix of estimates for LCGA-HRMSM, obtained using IPW.
</p>


<h3>Author(s)</h3>

<p>Awa Diop, Denis Talbot
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
obsdata_long = gendata(n = 1000, format = "long", total_followup = 8,
timedep_outcome = TRUE,  seed = 945)
baseline_var &lt;- c("age","sex")
years &lt;- 2011:2018
variables &lt;- c("hyper", "bmi")
covariates &lt;- lapply(years, function(year) {
paste0(variables, year)})
treatment_var &lt;- paste0("statins", 2011:2018)
var_cov &lt;- c("statins","hyper", "bmi","y")
reshrmsm_ipw &lt;- trajhrmsm_ipw(degree_traj = "linear", numerator = "stabilized",
identifier = "id", baseline = baseline_var,
covariates = covariates, treatment = treatment_var,
outcome = "y", var_cov= var_cov,include_censor = FALSE,
 ntimes_interval = 6,total_followup = 8, time = "time", time_values = 2011:2018,
family = "poisson", number_traj = 3, obsdata = obsdata_long, treshold = 0.999)
reshrmsm_ipw$res_trajhrmsm_ipw

</code></pre>

<hr>
<h2 id='trajhrmsm_pltmle'>History Restricted MSM and Latent Class of Growth Analysis estimated with a Pooled LTMLE.</h2><span id='topic+trajhrmsm_pltmle'></span>

<h3>Description</h3>

<p>Estimate parameters of LCGA-HRMSM using a Pooled LTMLE.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trajhrmsm_pltmle(
  degree_traj = c("linear", "quadratic", "cubic"),
  treatment,
  covariates,
  baseline,
  outcome,
  ntimes_interval,
  total_followup,
  time,
  time_values,
  identifier,
  var_cov,
  number_traj = 3,
  family = "poisson",
  obsdata,
  treshold = 0.99
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="trajhrmsm_pltmle_+3A_degree_traj">degree_traj</code></td>
<td>
<p>To specify the polynomial degree for modelling the time-varying treatment.</p>
</td></tr>
<tr><td><code id="trajhrmsm_pltmle_+3A_treatment">treatment</code></td>
<td>
<p>Name of time-varying treatment.</p>
</td></tr>
<tr><td><code id="trajhrmsm_pltmle_+3A_covariates">covariates</code></td>
<td>
<p>Names of time-varying covariates (should be a list).</p>
</td></tr>
<tr><td><code id="trajhrmsm_pltmle_+3A_baseline">baseline</code></td>
<td>
<p>Names of baseline covariates.</p>
</td></tr>
<tr><td><code id="trajhrmsm_pltmle_+3A_outcome">outcome</code></td>
<td>
<p>Name of the outcome variable.</p>
</td></tr>
<tr><td><code id="trajhrmsm_pltmle_+3A_ntimes_interval">ntimes_interval</code></td>
<td>
<p>Length of a time-interval (s).</p>
</td></tr>
<tr><td><code id="trajhrmsm_pltmle_+3A_total_followup">total_followup</code></td>
<td>
<p>Total length of follow-up.</p>
</td></tr>
<tr><td><code id="trajhrmsm_pltmle_+3A_time">time</code></td>
<td>
<p>Name of the time variable.</p>
</td></tr>
<tr><td><code id="trajhrmsm_pltmle_+3A_time_values">time_values</code></td>
<td>
<p>Measuring times.</p>
</td></tr>
<tr><td><code id="trajhrmsm_pltmle_+3A_identifier">identifier</code></td>
<td>
<p>Name of the column for unique identifiant.</p>
</td></tr>
<tr><td><code id="trajhrmsm_pltmle_+3A_var_cov">var_cov</code></td>
<td>
<p>Names of the time-varying covariates.</p>
</td></tr>
<tr><td><code id="trajhrmsm_pltmle_+3A_number_traj">number_traj</code></td>
<td>
<p>Number of trajectory groups.</p>
</td></tr>
<tr><td><code id="trajhrmsm_pltmle_+3A_family">family</code></td>
<td>
<p>Specification of the error distribution and link function to be used in the model.</p>
</td></tr>
<tr><td><code id="trajhrmsm_pltmle_+3A_obsdata">obsdata</code></td>
<td>
<p>Data in a long format.</p>
</td></tr>
<tr><td><code id="trajhrmsm_pltmle_+3A_treshold">treshold</code></td>
<td>
<p>For weight truncation.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following components:
</p>

<dl>
<dt>results_hrmsm_pltmle</dt><dd><p> Matrix of estimates for LCGA-HRMSM, obtained using the pooled ltlmle method.</p>
</dd>
<dt>restraj</dt><dd><p> Fitted trajectory model.</p>
</dd>
<dt>mean_adh</dt><dd><p> Matrix of the mean adherence per trajectory group.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Awa Diop Denis Talbot
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
obsdata_long = gendata(n = 1000, format = "long",
total_followup = 8, timedep_outcome = TRUE,  seed = 945)
baseline_var &lt;- c("age","sex")
years &lt;- 2011:2018
variables &lt;- c("hyper", "bmi")
covariates &lt;- lapply(years, function(year) {
  paste0(variables, year)})
treatment_var &lt;- paste0("statins", 2011:2018)
var_cov &lt;- c("statins","hyper", "bmi","y")
respltmle = trajhrmsm_pltmle(degree_traj = "linear", treatment = treatment_var,
covariates = covariates, baseline = baseline_var,
outcome = paste0("y", 2016:2018),var_cov = var_cov, ntimes_interval = 6,
total_followup = 8, time = "time",time_values = years, identifier = "id",
number_traj = 3, family = "poisson", obsdata = obsdata_long)
respltmle$results_hrmsm_pltmle

</code></pre>

<hr>
<h2 id='trajmsm_gform'>Parametric g-formula</h2><span id='topic+trajmsm_gform'></span>

<h3>Description</h3>

<p>Estimate parameters of LCGA-MSM using g-formula
and bootstrap to get standard errors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trajmsm_gform(
  formula = formula,
  rep = 50,
  identifier,
  baseline,
  covariates,
  treatment,
  outcome,
  total_followup,
  time = time,
  time_values,
  var_cov,
  trajmodel,
  ref,
  obsdata
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="trajmsm_gform_+3A_formula">formula</code></td>
<td>
<p>Specification of the model for the outcome to be fitted.</p>
</td></tr>
<tr><td><code id="trajmsm_gform_+3A_rep">rep</code></td>
<td>
<p>Number of repetitions for the bootstrap.</p>
</td></tr>
<tr><td><code id="trajmsm_gform_+3A_identifier">identifier</code></td>
<td>
<p>Name of the column of the unique identifier.</p>
</td></tr>
<tr><td><code id="trajmsm_gform_+3A_baseline">baseline</code></td>
<td>
<p>Vector of names of the baseline covariates.</p>
</td></tr>
<tr><td><code id="trajmsm_gform_+3A_covariates">covariates</code></td>
<td>
<p>List of names of the time-varying covariates.</p>
</td></tr>
<tr><td><code id="trajmsm_gform_+3A_treatment">treatment</code></td>
<td>
<p>Vector of names of the time-varying treatment.</p>
</td></tr>
<tr><td><code id="trajmsm_gform_+3A_outcome">outcome</code></td>
<td>
<p>Name of the outcome of interest.</p>
</td></tr>
<tr><td><code id="trajmsm_gform_+3A_total_followup">total_followup</code></td>
<td>
<p>Total length of follow-up.</p>
</td></tr>
<tr><td><code id="trajmsm_gform_+3A_time">time</code></td>
<td>
<p>Name of the time variable.</p>
</td></tr>
<tr><td><code id="trajmsm_gform_+3A_time_values">time_values</code></td>
<td>
<p>Measuring times.</p>
</td></tr>
<tr><td><code id="trajmsm_gform_+3A_var_cov">var_cov</code></td>
<td>
<p>Names of the time-varying covariates.</p>
</td></tr>
<tr><td><code id="trajmsm_gform_+3A_trajmodel">trajmodel</code></td>
<td>
<p>Trajectory model built with the observed treatment.</p>
</td></tr>
<tr><td><code id="trajmsm_gform_+3A_ref">ref</code></td>
<td>
<p>The reference trajectory group.</p>
</td></tr>
<tr><td><code id="trajmsm_gform_+3A_obsdata">obsdata</code></td>
<td>
<p>Observed data in wide format.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Provides a matrix of estimates for LCGA-MSM, obtained using the g-formula method.
</p>


<h3>Author(s)</h3>

<p>Awa Diop Denis Talbot
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
obsdata_long = gendata(n = 1000, format = "long", total_followup = 6, seed = 945)
years &lt;- 2011:2016
baseline_var &lt;- c("age","sex")
variables &lt;- c("hyper", "bmi")
var_cov &lt;- c("statins","hyper", "bmi")
covariates &lt;- lapply(years, function(year) {
paste0(variables, year)})
treatment_var &lt;- paste0("statins", 2011:2016)
formula_treatment = as.formula(cbind(statins, 1 - statins) ~ time)
restraj = build_traj(obsdata = obsdata_long, number_traj = 3,
formula = formula_treatment, identifier = "id")
datapost = restraj$data_post
trajmsm_long &lt;- merge(obsdata_long, datapost, by = "id")
    AggFormula &lt;- as.formula(paste("statins", "~", "time", "+", "class"))
    AggTrajData &lt;- aggregate(AggFormula, data = trajmsm_long, FUN = mean)
    AggTrajData
obsdata = reshape(data = trajmsm_long, direction = "wide", idvar = "id",
v.names = c("statins","bmi","hyper"), timevar = "time", sep ="")
formula = paste0("y ~", paste0(treatment_var,collapse = "+"), "+",
                paste0(unlist(covariates), collapse = "+"),"+",
                paste0(baseline_var, collapse = "+"))
resmsm_gform &lt;- trajmsm_gform(formula = formula, identifier = "id",rep = 5,
baseline = baseline_var, covariates = covariates, var_cov = var_cov,
treatment = treatment_var, outcome = "y", total_followup = 6,time = "time",
time_values = years, trajmodel = restraj$traj_model,ref = "1", obsdata =   obsdata )
resmsm_gform

</code></pre>

<hr>
<h2 id='trajmsm_ipw'>Marginal Structural Model and Latent Class of Growth Analysis estimated with IPW</h2><span id='topic+trajmsm_ipw'></span>

<h3>Description</h3>

<p>Estimate parameters of LCGA-MSM using IPW.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trajmsm_ipw(
  formula1,
  formula2,
  family,
  identifier,
  treatment,
  covariates,
  baseline,
  obsdata,
  numerator = "stabilized",
  include_censor = FALSE,
  censor,
  weights = NULL,
  treshold = 0.99
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="trajmsm_ipw_+3A_formula1">formula1</code></td>
<td>
<p>Specification of the model for the outcome to be fitted for a binomial or gaussian distribution.</p>
</td></tr>
<tr><td><code id="trajmsm_ipw_+3A_formula2">formula2</code></td>
<td>
<p>Specification of the model for the outcome to be fitted for a survival outcome.</p>
</td></tr>
<tr><td><code id="trajmsm_ipw_+3A_family">family</code></td>
<td>
<p>Specification of the error distribution and link function to be used in the model.</p>
</td></tr>
<tr><td><code id="trajmsm_ipw_+3A_identifier">identifier</code></td>
<td>
<p>Name of the column of the unique identifier.</p>
</td></tr>
<tr><td><code id="trajmsm_ipw_+3A_treatment">treatment</code></td>
<td>
<p>Time-varying treatment.</p>
</td></tr>
<tr><td><code id="trajmsm_ipw_+3A_covariates">covariates</code></td>
<td>
<p>Names of the time-varying covariates (should be a list).</p>
</td></tr>
<tr><td><code id="trajmsm_ipw_+3A_baseline">baseline</code></td>
<td>
<p>Name of the baseline covariates.</p>
</td></tr>
<tr><td><code id="trajmsm_ipw_+3A_obsdata">obsdata</code></td>
<td>
<p>Dataset to be used in the analysis.</p>
</td></tr>
<tr><td><code id="trajmsm_ipw_+3A_numerator">numerator</code></td>
<td>
<p>Type of weighting (&quot;stabilized&quot; or &quot;unstabilized&quot;).</p>
</td></tr>
<tr><td><code id="trajmsm_ipw_+3A_include_censor">include_censor</code></td>
<td>
<p>Logical, if TRUE, includes censoring.</p>
</td></tr>
<tr><td><code id="trajmsm_ipw_+3A_censor">censor</code></td>
<td>
<p>Name of the censoring variable.</p>
</td></tr>
<tr><td><code id="trajmsm_ipw_+3A_weights">weights</code></td>
<td>
<p>A vector of estimated weights. If NULL, the weights are computed by the function <code>IPW</code>.</p>
</td></tr>
<tr><td><code id="trajmsm_ipw_+3A_treshold">treshold</code></td>
<td>
<p>For weight truncation.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Provides a matrix of estimates for LCGA-MSM, obtained using IPW.
</p>
<p>Provides a matrix of estimates for LCGA-MSM, obtained using IPW.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>obsdata_long = gendata(n = 1000, format = "long", total_followup = 6, seed = 945)
years &lt;- 2011:2016
baseline_var &lt;- c("age","sex")
variables &lt;- c("hyper", "bmi")
covariates &lt;- lapply(years, function(year) {
paste0(variables, year)})
treatment_var &lt;- paste0("statins", 2011:2016)
formula_treatment = as.formula(cbind(statins, 1 - statins) ~ time)
restraj = build_traj(obsdata = obsdata_long, number_traj = 3,
formula = formula_treatment, identifier = "id")
datapost = restraj$data_post
trajmsm_long &lt;- merge(obsdata_long, datapost, by = "id")
    AggFormula &lt;- as.formula(paste("statins", "~", "time", "+", "class"))
    AggTrajData &lt;- aggregate(AggFormula, data = trajmsm_long, FUN = mean)
    AggTrajData
trajmsm_long$ipw_group &lt;- relevel(trajmsm_long$class, ref = "1")
obsdata = reshape(data = trajmsm_long, direction = "wide", idvar = "id",
v.names = c("statins","bmi","hyper"), timevar = "time", sep ="")
formula = paste0("y ~", paste0(treatment_var,collapse = "+"), "+",
                paste0(unlist(covariates), collapse = "+"),"+",
                paste0(baseline_var, collapse = "+"))

resmsm_ipw = trajmsm_ipw(formula1 = as.formula("y ~ ipw_group"),
           identifier = "id", baseline = baseline_var, covariates = covariates,
           treatment = treatment_var, family = "binomial",
           obsdata = obsdata,numerator = "stabilized", include_censor = FALSE, treshold = 0.99)
resmsm_ipw
</code></pre>

<hr>
<h2 id='trajmsm_pltmle'>Pooled LTMLE</h2><span id='topic+trajmsm_pltmle'></span>

<h3>Description</h3>

<p>Estimate parameters of LCGA-MSM using pooled LTMLE
with influence functions to estimate standard errors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trajmsm_pltmle(
  formula = formula,
  identifier,
  baseline,
  covariates,
  treatment,
  outcome,
  number_traj,
  total_followup,
  time,
  time_values,
  trajmodel,
  ref,
  obsdata,
  treshold = 0.999
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="trajmsm_pltmle_+3A_formula">formula</code></td>
<td>
<p>Specification of the model for the outcome to be fitted.</p>
</td></tr>
<tr><td><code id="trajmsm_pltmle_+3A_identifier">identifier</code></td>
<td>
<p>Name of the column for unique identifiant.</p>
</td></tr>
<tr><td><code id="trajmsm_pltmle_+3A_baseline">baseline</code></td>
<td>
<p>Names of the baseline covariates.</p>
</td></tr>
<tr><td><code id="trajmsm_pltmle_+3A_covariates">covariates</code></td>
<td>
<p>Names of the time-varying covariates (should be a list).</p>
</td></tr>
<tr><td><code id="trajmsm_pltmle_+3A_treatment">treatment</code></td>
<td>
<p>Name of the time-varying treatment.</p>
</td></tr>
<tr><td><code id="trajmsm_pltmle_+3A_outcome">outcome</code></td>
<td>
<p>Name of the outcome variable.</p>
</td></tr>
<tr><td><code id="trajmsm_pltmle_+3A_number_traj">number_traj</code></td>
<td>
<p>An integer to choose the number of trajectory groups.</p>
</td></tr>
<tr><td><code id="trajmsm_pltmle_+3A_total_followup">total_followup</code></td>
<td>
<p>Total length of follow-up.</p>
</td></tr>
<tr><td><code id="trajmsm_pltmle_+3A_time">time</code></td>
<td>
<p>Name of the time variable.</p>
</td></tr>
<tr><td><code id="trajmsm_pltmle_+3A_time_values">time_values</code></td>
<td>
<p>Measuring times.</p>
</td></tr>
<tr><td><code id="trajmsm_pltmle_+3A_trajmodel">trajmodel</code></td>
<td>
<p>Trajectory model built with the observed treatment.</p>
</td></tr>
<tr><td><code id="trajmsm_pltmle_+3A_ref">ref</code></td>
<td>
<p>The reference group.</p>
</td></tr>
<tr><td><code id="trajmsm_pltmle_+3A_obsdata">obsdata</code></td>
<td>
<p>Observed data in wide format.</p>
</td></tr>
<tr><td><code id="trajmsm_pltmle_+3A_treshold">treshold</code></td>
<td>
<p>For weight truncation.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Provides a matrix of estimates for LCGA-MSM, obtained using the pooled ltlmle method.
</p>
<table>
<tr><td><code>results_msm_pooledltmle</code></td>
<td>
<p>Estimates of a LCGA-MSM with pooled LTMLE.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Awa Diop, Denis Talbot
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
obsdata_long = gendata(n = 1000, format = "long", total_followup = 6, seed = 945)
years &lt;- 2011:2016
baseline_var &lt;- c("age","sex")
variables &lt;- c("hyper", "bmi")
covariates &lt;- lapply(years, function(year) {
paste0(variables, year)})
treatment_var &lt;- paste0("statins", 2011:2016)
formula_treatment = as.formula(cbind(statins, 1 - statins) ~ time)
restraj = build_traj(obsdata = obsdata_long, number_traj = 3,
formula = formula_treatment, identifier = "id")
datapost = restraj$data_post
trajmsm_long &lt;- merge(obsdata_long, datapost, by = "id")
    AggFormula &lt;- as.formula(paste("statins", "~", "time", "+", "class"))
    AggTrajData &lt;- aggregate(AggFormula, data = trajmsm_long, FUN = mean)
    AggTrajData
trajmsm_wide = reshape(data = trajmsm_long, direction = "wide", idvar = "id",
v.names = c("statins","bmi","hyper"), timevar = "time", sep ="")
formula = paste0("y ~", paste0(treatment_var,collapse = "+"), "+",
                paste0(unlist(covariates), collapse = "+"),"+",
                paste0(baseline_var, collapse = "+"))
resmsm_pltmle &lt;- trajmsm_pltmle(formula = formula, identifier = "id", baseline = baseline_var,
 covariates = covariates, treatment = treatment_var, outcome = "y",
 time = "time", time_values = years, number_traj = 3, total_followup = 6,
 trajmodel = restraj$traj_model, ref = "1", obsdata = trajmsm_wide, treshold = 0.99)
 resmsm_pltmle
 
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
