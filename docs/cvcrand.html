<!DOCTYPE html><html><head><title>Help for package cvcrand</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {cvcrand}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#cptest'><p>Clustered permutation test for cluster randomized trials</p></a></li>
<li><a href='#cvcrand'><p>cvcrand: a package for efficient design and analysis of cluster randomized trials</p></a></li>
<li><a href='#cvrall'><p>Covariate-constrained randomization for cluster randomized trials</p></a></li>
<li><a href='#cvrcov'><p>Covariate-by-covariate constrained randomization for cluster randomized trials</p></a></li>
<li><a href='#Dickinson_design'><p>Raw county-level variables for study 1 in Dickinson et al (2015)</p></a></li>
<li><a href='#Dickinson_outcome'><p>Simulated individual-level binary outcome and baseline variables for study 1 in Dickinson et al (2015)</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Efficient Design and Analysis of Cluster Randomized Trials</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-09-16</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Hengshi Yu &lt;hengshi@umich.edu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Constrained randomization by Raab and Butcher (2001) &lt;<a href="https://doi.org/10.1002/1097-0258(20010215)20:3%3C351::AID-SIM797%3E3.0.CO;2-C">doi:10.1002/1097-0258(20010215)20:3%3C351::AID-SIM797%3E3.0.CO;2-C</a>&gt; 
            is suitable for cluster randomized trials (CRTs) with a
            small number of clusters (e.g., 20 or fewer). The procedure of
            constrained randomization is based on the baseline values of some
            cluster-level covariates specified. The intervention effect on
            the individual outcome can then be analyzed through
            clustered permutation test introduced by Gail, et al. (1996) &lt;<a href="https://doi.org/10.1002/(SICI)1097-0258(19960615)15:11%3C1069::AID-SIM220%3E3.0.CO;2-Q">doi:10.1002/(SICI)1097-0258(19960615)15:11%3C1069::AID-SIM220%3E3.0.CO;2-Q</a>&gt;. 
            Motivated from Li, et al. (2016) &lt;<a href="https://doi.org/10.1002%2Fsim.7410">doi:10.1002/sim.7410</a>&gt;, the package performs constrained randomization on the baseline
            values of cluster-level covariates and clustered permutation test on the individual-level outcomes for cluster randomized trials. </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>LazyData:</td>
<td>TRUE</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.4.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>tableone</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-09-17 00:14:46 UTC; hengshiyu</td>
</tr>
<tr>
<td>Author:</td>
<td>Hengshi Yu [aut, cre],
  Fan Li [aut],
  John A. Gallis [aut],
  Elizabeth L. Turner [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-09-17 02:20:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='cptest'>Clustered permutation test for cluster randomized trials</h2><span id='topic+cptest'></span>

<h3>Description</h3>

<p>cptest performs a clustered permutation test on the individual-level outcome data for cluster
randomized trials (CRTs). The type of the outcome can be specified by the user to be <code>"continuous"</code> or
<code>"binary"</code>.
</p>
<p>Linear regression (for outcome type <code>"continuous"</code>) or logistic regression (for outcome type <code>"binary"</code>) is applied to the outcome regressed on covariates specified. Cluster residual means are computed. Within the constrained space,
the contrast statistic between the treatment and control arms is created from the randomization schemes and the cluster residual means. The permutation test is then conducted by comparing the contrast statistic for the scheme actually utilized to all other schemes in the constrained space.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cptest(
  outcome,
  clustername,
  z = NULL,
  cspacedatname,
  outcometype,
  categorical = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cptest_+3A_outcome">outcome</code></td>
<td>
<p>a vector specifying the individual-level outcome.</p>
</td></tr>
<tr><td><code id="cptest_+3A_clustername">clustername</code></td>
<td>
<p>a vector specifying the identification variable of the cluster.</p>
</td></tr>
<tr><td><code id="cptest_+3A_z">z</code></td>
<td>
<p>a data frame of covariates to be adjusted for in the permutation analysis.</p>
</td></tr>
<tr><td><code id="cptest_+3A_cspacedatname">cspacedatname</code></td>
<td>
<p>gives the path of the csv dataset containing the saved randomization space. This dataset contains the permutation matrix, as well as an indicator variable in the first column indicating which row of the permutation matrix was selected as the final scheme to be implemented in practice.</p>
</td></tr>
<tr><td><code id="cptest_+3A_outcometype">outcometype</code></td>
<td>
<p>the type of regression model that should be run. Options are <code>"continuous"</code> for linear regression and <code>"binary"</code> for logistic regression.</p>
</td></tr>
<tr><td><code id="cptest_+3A_categorical">categorical</code></td>
<td>
<p>a vector specifying categorical (including binary) variables. This can be names of the columns or number indexes of columns, but cannot be both. Suppose there are <code>p</code> categories for a categorical variable, <code>cptest</code> function creates <code>(p-1)</code> dummy variables and drops the reference level if the variable is specified as a factor. Otherwise, the first level in the alphanumerical order will be dropped. If the user wants to specify a different level to drop for a <code>p</code>-level categorical variable, the user can create <code>p-1</code> dummy variables and these can instead be supplied as covariates to the <code>cptest</code> function. Then, the user needs to specify the dummy variables created themselves to be <code>categorical</code> when running <code>cptest</code>. In addition, the user could also set the variable as a factor with the specific reference level. The user must ensure that the same level of the categorical variable is excluded as was excluded when running <code>cvrall</code>, by coding the variables the same way as in the design phase. This is the only optional argument of the <code>cptest</code> function. All others are required.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>FinalScheme</code> the final scheme in the permutation matrix
</p>
<p><code>pvalue</code> the p-value of the intervention effect from the clustered permutation test
</p>
<p><code>pvalue_statement</code> the statement about the p-value of the intervention effect from the clustered permutation test
</p>


<h3>Author(s)</h3>

<p>Hengshi Yu &lt;hengshi@umich.edu&gt;, Fan Li &lt;fan.f.li@yale.edu&gt;, John A. Gallis &lt;john.gallis@duke.edu&gt;, Elizabeth L. Turner &lt;liz.turner@duke.edu&gt;
</p>


<h3>References</h3>

<p>Gail, M.H., Mark, S.D., Carroll, R.J., Green, S.B. and Pee, D., 1996. On design considerations and randomization based inference for community intervention trials. Statistics in medicine, 15(11), pp.1069-1092.
</p>
<p>Li, F., Lokhnygina, Y., Murray, D.M., Heagerty, P.J. and DeLong, E.R., 2016. An evaluation of constrained randomization for the design and analysis of group randomized trials. Statistics in medicine, 35(10), pp.1565-1579.
</p>
<p>Li, F., Turner, E. L., Heagerty, P. J., Murray, D. M., Vollmer, W. M., &amp; DeLong, E. R. (2017). An evaluation of constrained randomization for the design and analysis of group randomized trials with binary outcomes. Statistics in medicine, 36(24), 3791-3806.
</p>
<p>Gallis, J. A., Li, F., Yu, H., Turner, E. L. (In Press).  cvcrand and cptest: Efficient design and analysis of cluster randomized trials.  Stata Journal.
</p>
<p>Gallis, J. A., Li, Fl. Yu, H., Turner, E. L. (2017).  cvcrand and cptest: Efficient design and analysis of cluster randomized trials.  Stata Conference.  https://www.stata.com/meeting/baltimore17/slides/Baltimore17_Gallis.pdf.
</p>
<p>Dickinson, L. M., Beaty, B., Fox, C., Pace, W., Dickinson, W. P., Emsermann, C., &amp; Kempe, A. (2015). Pragmatic cluster randomized trials using covariate constrained randomization: A method for practice-based research networks (PBRNs). The Journal of the American Board of Family Medicine, 28(5), 663-672.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
Analysis_result &lt;- cptest(outcome = Dickinson_outcome$outcome,
                          clustername = Dickinson_outcome$county,
                          z = data.frame(Dickinson_outcome[ , c("location", "inciis",
                              "uptodateonimmunizations", "hispanic", "incomecat")]),
                          cspacedatname = "dickinson_constrained.csv",
                          outcometype = "binary",
                          categorical = c("location","incomecat"))

## End(Not run)

</code></pre>

<hr>
<h2 id='cvcrand'>cvcrand: a package for efficient design and analysis of cluster randomized trials</h2><span id='topic+cvcrand'></span><span id='topic+cvcrand-package'></span>

<h3>Description</h3>

<p>cvcrand: A Package for Covariate-constrained Randomization and the Clustered Permutation Test for
Cluster Randomized Trials
</p>


<h3>cvcrand functions</h3>

<p>The cvrall function performs constrained randomization on cluster randomized trials (CRTs)
The cvrcov function performs covariate-constrained randomization on cluster randomized trials (CRTs)
The cptest function performs permutation test on the outcome of cluster randomized trials (CRTs)
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Hengshi Yu <a href="mailto:hengshi@umich.edu">hengshi@umich.edu</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> Fan Li <a href="mailto:fan.f.li@yale.edu">fan.f.li@yale.edu</a>
</p>
</li>
<li><p> John A. Gallis <a href="mailto:john.gallis@duke.edu">john.gallis@duke.edu</a>
</p>
</li>
<li><p> Elizabeth L. Turner <a href="mailto:liz.turner@duke.edu">liz.turner@duke.edu</a>
</p>
</li></ul>


<hr>
<h2 id='cvrall'>Covariate-constrained randomization for cluster randomized trials</h2><span id='topic+cvrall'></span>

<h3>Description</h3>

<p><code>cvrall</code> performs constrained randomization for cluster randomized
trials (CRTs), especially suited for CRTs with a small number of clusters. In constrained randomization,
a randomization scheme is randomly sampled from a subset of all possible randomization schemes
based on the value of a balancing criterion called a balance score. The <code>cvrall</code> function has two choices of &quot;l1&quot; and &quot;l2&quot; metrics for balance score.
</p>
<p>The <code>cvrall</code> function enumerates all randomization schemes or chooses the unique ones among some simulated randomization schemes as specified by the user.
Some cluster-level continuous or categorical covariates are then used to calculate the balance scores for the unique schemes. A subset of the randomization schemes is chosen based on a user-specified cutoff at a certain quantile of the distribution of the balance scores or based on a fixed number of schemes with the smallest balance scores. The <code>cvrall</code> function
treats the subset as the constrained space of randomization schemes and samples one scheme from the constrained space as the final chosen scheme.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cvrall(
  clustername = NULL,
  x,
  categorical = NULL,
  weights = NULL,
  ntotal_cluster,
  ntrt_cluster,
  cutoff = 0.1,
  numschemes = NULL,
  size = 50000,
  stratify = NULL,
  seed = NULL,
  balancemetric = "l2",
  nosim = FALSE,
  savedata = NULL,
  bhist = TRUE,
  check_validity = FALSE,
  samearmhi = 0.75,
  samearmlo = 0.25
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cvrall_+3A_clustername">clustername</code></td>
<td>
<p>a vector specifying the identification variable of the cluster. If no cluster identification variable is specified, the default is to label the clusters based on the order in which they appear.</p>
</td></tr>
<tr><td><code id="cvrall_+3A_x">x</code></td>
<td>
<p>a data frame specifying the values of cluster-level covariates to balance. With K covariates and n clusters, it will be dimension of <code>n</code> by <code>K</code>.</p>
</td></tr>
<tr><td><code id="cvrall_+3A_categorical">categorical</code></td>
<td>
<p>a vector specifying categorical (including binary) variables. This can be names of the columns or number indexes of columns, but cannot be both. Suppose there are <code>p</code> categories for a categorical variable, <code>cvcrand</code> function creates <code>p-1</code> dummy variables and drops the reference level if the variable is specified as a factor. Otherwise, the first level in the alphanumerical order will be dropped. The results are sensitive to which level is excluded. If the user wants to specify a different level to drop for a <code>p</code>-level categorical variable, the user can create <code>p-1</code> dummy variables and these can instead be supplied as covariates to the <code>cvcrand</code> function. Then, the user needs to specify the dummy variables created to be <code>categorical</code> when running <code>cvcrand</code>. In addition, the user could also set the variable as a factor with the specific reference level. If the <code>weights</code> option is used, the weights for a categorical variable will be replicated on all the dummy variables created.</p>
</td></tr>
<tr><td><code id="cvrall_+3A_weights">weights</code></td>
<td>
<p>a vector of user-specified weights for the covariates to calculate the balance score. The weight for a categorical variable will be replicated for the dummy variables created. Note that the <code>weights</code> option can be used to conduct stratification on variables. For example, a variable with a relatively large weight like <code>1000</code> and all other variables with a weight of <code>1</code> will cause the randomization scheme chosen to be stratified by the variable with the large weight, assuming a low <code>cutoff</code> value is specified.</p>
</td></tr>
<tr><td><code id="cvrall_+3A_ntotal_cluster">ntotal_cluster</code></td>
<td>
<p>the total number of clusters to be randomized. It must be a positive integer and equal to the number of rows of the data.</p>
</td></tr>
<tr><td><code id="cvrall_+3A_ntrt_cluster">ntrt_cluster</code></td>
<td>
<p>the number of clusters that the researcher wants to assign to the treatment arm. It must be a positive integer less than the total number of clusters.</p>
</td></tr>
<tr><td><code id="cvrall_+3A_cutoff">cutoff</code></td>
<td>
<p>quantile cutoff of the distribution of balance score below which a randomization scheme is sampled. Its default is <code>0.1</code>, and it must be between 0 and 1. The <code>cutoff</code> option is overridden by the <code>numschemes</code> option.</p>
</td></tr>
<tr><td><code id="cvrall_+3A_numschemes">numschemes</code></td>
<td>
<p>number of randomization schemes to form the constrained space for the final randomization scheme to be selected. If specified, it overrides the option <code>cutoff</code> and the program will randomly sample the final randomization scheme from the constrained space of randomization schemes with the <code>numschemes</code> smallest balance scores. It must be a positive integer.</p>
</td></tr>
<tr><td><code id="cvrall_+3A_size">size</code></td>
<td>
<p>number of randomization schemes to simulate if the number of all possible randomization schemes is over <code>size</code>. Its default is <code>50,000</code>, and must be a positive integer. It can be overridden by the <code>nosim</code> option.</p>
</td></tr>
<tr><td><code id="cvrall_+3A_stratify">stratify</code></td>
<td>
<p>categorical variables on which to stratify the randomization. It overrides the option <code>weights</code> when specified. This list of categorical variables should be a subset of the <code>categorical</code> option if specified.</p>
</td></tr>
<tr><td><code id="cvrall_+3A_seed">seed</code></td>
<td>
<p>seed for simulation and random sampling. It is needed so that the randomization can be replicated. Its default is <code>12345</code>.</p>
</td></tr>
<tr><td><code id="cvrall_+3A_balancemetric">balancemetric</code></td>
<td>
<p>balance metric to use. Its choices are <code>"l1"</code> and <code>"l2"</code>. The default is <code>"l2"</code>.</p>
</td></tr>
<tr><td><code id="cvrall_+3A_nosim">nosim</code></td>
<td>
<p>if <code>TRUE</code>, it overrides the default procedure of simulating when the number of all possible randomization schemes is over the <code>size</code>, and the program enumerates all randomization schemes. Note: this may consume a lot of memory and cause R to crash</p>
</td></tr>
<tr><td><code id="cvrall_+3A_savedata">savedata</code></td>
<td>
<p>saves the data set of the constrained randomization space in a csv file if specified by <code>savedata</code>. The first column of the csv file is an indicator variable of the final randomization scheme in the constrained space. The constrained randomization space will be needed for analysis after the cluster randomized trial is completed if the clustered permutation test is used.</p>
</td></tr>
<tr><td><code id="cvrall_+3A_bhist">bhist</code></td>
<td>
<p>if <code>TRUE</code> of the default value, it produces the histogram of all balance scores with a red line on the graph indicating the selected cutoff.</p>
</td></tr>
<tr><td><code id="cvrall_+3A_check_validity">check_validity</code></td>
<td>
<p>boolean argument to check the randomization validity or not</p>
</td></tr>
<tr><td><code id="cvrall_+3A_samearmhi">samearmhi</code></td>
<td>
<p>clusters assigned to the same arm as least this often are displayed. The default is <code>0.75</code>.</p>
</td></tr>
<tr><td><code id="cvrall_+3A_samearmlo">samearmlo</code></td>
<td>
<p>clusters assigned to the same arm at most this often are displayed. The default is <code>0.25</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>balancemetric</code> the balance metric used
</p>
<p><code>allocation</code> the allocation scheme from constrained randomization
</p>
<p><code>bscores</code> the histogram of the balance score with respect to the balance metric
</p>
<p><code>assignment_message</code> the statement about how many clusters to be randomized to the intervention and the control arms respectively
</p>
<p><code>scheme_message</code> the statement about how to get the whole randomization space to use in constrained randomization
</p>
<p><code>cutoff_message</code> the statement about the cutoff in the constrained space
</p>
<p><code>choice_message</code> the statement about the selected scheme from constrained randomization
</p>
<p><code>data_CR</code> the data frame containing the allocation scheme, the <code>clustername</code>, and the original data frame of covariates
</p>
<p><code>baseline_table</code> the descriptive statistics for all the variables by the two arms from the selected scheme
</p>
<p><code>cluster_coincidence</code> cluster coincidence matrix
</p>
<p><code>cluster_coin_des</code> cluster coincidence descriptive
</p>
<p><code>clusters_always_pair</code> pairs of clusters always allocated to the same arm.
</p>
<p><code>clusters_always_not_pair</code> pairs of clusters always allocated to different arms.
</p>
<p><code>clusters_high_pair</code>  pairs of clusters randomized to the same arm at least <code>samearmhi</code> of the time.
</p>
<p><code>clusters_low_pair</code> pairs of clusters randomized to the same arm at most <code>samearmlo</code> of the time.
</p>
<p><code>overall_allocations</code> frequency of acceptable overall allocations.
</p>


<h3>Author(s)</h3>

<p>Hengshi Yu &lt;hengshi@umich.edu&gt;, Fan Li &lt;fan.f.li@yale.edu&gt;, John A. Gallis &lt;john.gallis@duke.edu&gt;, Elizabeth L. Turner &lt;liz.turner@duke.edu&gt;
</p>


<h3>References</h3>

<p>Raab, G.M. and Butcher, I., 2001. Balance in cluster randomized trials. Statistics in medicine, 20(3), pp.351-365.
</p>
<p>Li, F., Lokhnygina, Y., Murray, D.M., Heagerty, P.J. and DeLong, E.R., 2016. An evaluation of constrained randomization for the design and analysis of group randomized trials. Statistics in medicine, 35(10), pp.1565-1579.
</p>
<p>Li, F., Turner, E. L., Heagerty, P. J., Murray, D. M., Vollmer, W. M., &amp; DeLong, E. R. (2017). An evaluation of constrained randomization for the design and analysis of group randomized trials with binary outcomes. Statistics in medicine, 36(24), 3791-3806.
</p>
<p>Gallis, J.A., Li, F., Yu, H. and Turner, E.L., 2018. cvcrand and cptest: Commands for efficient design and analysis of cluster randomized trials using constrained randomization and permutation tests. The Stata Journal, 18(2), pp.357-378.
</p>
<p>Dickinson, L. M., Beaty, B., Fox, C., Pace, W., Dickinson, W. P., Emsermann, C., &amp; Kempe, A. (2015). Pragmatic cluster randomized trials using covariate constrained randomization: A method for practice-based research networks (PBRNs). The Journal of the American Board of Family Medicine, 28(5), 663-672.
</p>
<p>Bailey, R.A. and Rowley, C.A., 1987. Valid randomization. Proceedings of the Royal Society of London. A. Mathematical and Physical Sciences, 410(1838), pp.105-124.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

# cvrall examples

Design_result &lt;- cvrall(clustername = Dickinson_design$county,
                         balancemetric = "l2",
                         x = data.frame(Dickinson_design[ , c("location", "inciis",
                              "uptodateonimmunizations", "hispanic", "incomecat")]),
                         ntotal_cluster = 16,
                         ntrt_cluster = 8,
                         categorical = c("location", "incomecat"),
                         ###### Option to save the constrained space ######
                         # savedata = "dickinson_constrained.csv",
                         bhist = TRUE,
                         cutoff = 0.1,
                         seed = 12345, 
                         check_validity = TRUE)

# cvrall example with weights specified

Design_result &lt;- cvrall(clustername = Dickinson_design$county,
                         balancemetric = "l2",
                         x = data.frame(Dickinson_design[ , c("location", "inciis",
                             "uptodateonimmunizations", "hispanic", "incomecat")]),
                         ntotal_cluster = 16,
                         ntrt_cluster = 8,
                         categorical = c("location", "incomecat"),
                         weights = c(1, 1, 1, 1, 1),
                         cutoff = 0.1,
                         seed = 12345, 
                         check_validity = TRUE)

# Stratification on location, with constrained
# randomization on other specified covariates

 Design_stratified_result &lt;- cvrall(clustername = Dickinson_design$county,
                                     balancemetric = "l2",
                                     x = data.frame(Dickinson_design[ , c("location", "inciis",
                                         "uptodateonimmunizations", "hispanic", "incomecat")]),
                                     ntotal_cluster = 16,
                                     ntrt_cluster = 8,
                                     categorical = c("location", "incomecat"),
                                     weights = c(1000, 1, 1, 1, 1),
                                     cutoff = 0.1,
                                     seed = 12345)

 # An alternative and equivalent way to stratify on location

 Design_stratified_result &lt;- cvrall(clustername = Dickinson_design$county,
                                     balancemetric = "l2",
                                     x = data.frame(Dickinson_design[ , c("location", "inciis",
                                         "uptodateonimmunizations", "hispanic", "incomecat")]),
                                     ntotal_cluster = 16,
                                     ntrt_cluster = 8,
                                     categorical = c("location", "incomecat"),
                                     stratify = "location",
                                     cutoff = 0.1,
                                     seed = 12345)

 # Stratification on income category
 # Two of the income categories contain an odd number of clusters
 # Stratification is not strictly possible

 Design_stratified_inc_result &lt;- cvrall(clustername = Dickinson_design$county,
                                         balancemetric = "l2",
                                         x = data.frame(Dickinson_design[ , c("location", "inciis",
                                             "uptodateonimmunizations", "hispanic", "incomecat")]),
                                         ntotal_cluster = 16,
                                         ntrt_cluster = 8,
                                         categorical = c("location", "incomecat"),
                                         stratify = "incomecat",
                                         cutoff = 0.1,
                                         seed = 12345)


</code></pre>

<hr>
<h2 id='cvrcov'>Covariate-by-covariate constrained randomization for cluster randomized trials</h2><span id='topic+cvrcov'></span>

<h3>Description</h3>

<p><code>cvrcov</code> performs covariate-by-covariate constrained randomization for cluster randomized
trials (CRTs), especially suited for CRTs with a small number of clusters. In constrained randomization,
a randomization scheme is randomly sampled from a subset of all possible randomization schemes
based on the constraints on each covariate. 
</p>
<p>The <code>cvrcov</code> function enumerates all randomization schemes or simulates a fixed size of unique randomization schemes as specified by the user.
A subset of the randomization schemes is chosen based on user-specified covariate-by-covariate constraints.  <code>cvrcov</code> treats the subset as the constrained space 
of randomization schemes and samples one scheme from the constrained space as the final chosen scheme.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cvrcov(
  clustername = NULL,
  x,
  categorical = NULL,
  constraints,
  ntotal_cluster,
  ntrt_cluster,
  size = 50000,
  seed = NULL,
  nosim = FALSE,
  savedata = NULL,
  check_validity = FALSE,
  samearmhi = 0.75,
  samearmlo = 0.25
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cvrcov_+3A_clustername">clustername</code></td>
<td>
<p>a vector specifying the identification variable of the cluster. If no cluster identification variable is specified, the default is to label the clusters based on the order in which they appear.</p>
</td></tr>
<tr><td><code id="cvrcov_+3A_x">x</code></td>
<td>
<p>a data frame specifying the values of cluster-level covariates to balance. With K covariates and n clusters, it will be dimension of <code>n</code> by <code>K</code>.</p>
</td></tr>
<tr><td><code id="cvrcov_+3A_categorical">categorical</code></td>
<td>
<p>a vector specifying categorical (including binary) variables. This can be names of the columns or number indexes of columns, but cannot be both. Suppose there are <code>p</code> categories for a categorical variable, <code>cvcrand</code> function creates <code>p-1</code> dummy variables and drops the reference level if the variable is specified as a factor. Otherwise, the first level in the alphanumerical order will be dropped. The results are sensitive to which level is excluded. If the user wants to specify a different level to drop for a <code>p</code>-level categorical variable, the user can create <code>p-1</code> dummy variables and these can instead be supplied as covariates to the <code>cvcrand</code> function. Then, the user needs to specify the dummy variables created to be <code>categorical</code> when running <code>cvcrand</code>. In addition, the user could also set the variable as a factor with the specific reference level. If the <code>weights</code> option is used, the weights for a categorical variable will be replicated on all the dummy variables created.</p>
</td></tr>
<tr><td><code id="cvrcov_+3A_constraints">constraints</code></td>
<td>
<p>a vector of user-specified constraints for all covariates. <code>"any"</code> means no constraints. If not <code>"any"</code>, the first character letter of <code>"m"</code> denotes absolute mean difference, and <code>"s"</code> means absolute sum difference. If the second character is <code>"f"</code>, the previous metric is constrained to be smaller or equal to the fraction with the number followed of the overall mean for <code>"m"</code> or mean arm total for <code>"s"</code>. If not <code>"f"</code> at the second character, the metric is just constrained to be smaller or equal to the value following letter(s).</p>
</td></tr>
<tr><td><code id="cvrcov_+3A_ntotal_cluster">ntotal_cluster</code></td>
<td>
<p>the total number of clusters to be randomized. It must be a positive integer and equal to the number of rows of the data.</p>
</td></tr>
<tr><td><code id="cvrcov_+3A_ntrt_cluster">ntrt_cluster</code></td>
<td>
<p>the number of clusters that the researcher wants to assign to the treatment arm. It must be a positive integer less than the total number of clusters.</p>
</td></tr>
<tr><td><code id="cvrcov_+3A_size">size</code></td>
<td>
<p>number of randomization schemes to simulate if the number of all possible randomization schemes is over <code>size</code>. Its default is <code>50,000</code>, and must be a positive integer. It can be overriden by the <code>nosim</code> option.</p>
</td></tr>
<tr><td><code id="cvrcov_+3A_seed">seed</code></td>
<td>
<p>seed for simulation and random sampling. It is needed so that the randomization can be replicated. Its default is <code>12345</code>.</p>
</td></tr>
<tr><td><code id="cvrcov_+3A_nosim">nosim</code></td>
<td>
<p>if TRUE, it overrides the default procedure of simulating when the number of all possible randomization schemes is over <code>size</code>, and the program enumerates all randomization schemes. Note: this may consume a lot of memory and cause R to crash</p>
</td></tr>
<tr><td><code id="cvrcov_+3A_savedata">savedata</code></td>
<td>
<p>saves the data set of the constrained randomization space in a csv file if specified by <code>savedata</code>. The first column of the csv file is an indicator variable of the final randomization scheme in the constrained space. The constrained randomization space will be needed for analysis after the cluster randomized trial is completed if the clustered permutation test is used.</p>
</td></tr>
<tr><td><code id="cvrcov_+3A_check_validity">check_validity</code></td>
<td>
<p>boolean argument to check the randomization validity or not</p>
</td></tr>
<tr><td><code id="cvrcov_+3A_samearmhi">samearmhi</code></td>
<td>
<p>clusters assigned to the same arm as least this often are displayed. The default is <code>0.75</code>.</p>
</td></tr>
<tr><td><code id="cvrcov_+3A_samearmlo">samearmlo</code></td>
<td>
<p>clusters assigned to the same arm at most this often are displayed. The default is <code>0.25</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>allocation</code> the allocation scheme from constrained randomization
</p>
<p><code>assignment_message</code> the statement about how many clusters to be randomized to the intervention and the control arms respectively
</p>
<p><code>scheme_message</code> the statement about how to get the whole randomization space to use in constrained randomization
</p>
<p><code>data_CR</code> the data frame containing the allocation scheme, the <code>clustername</code>, and the original data frame of covariates
</p>
<p><code>baseline_table</code> the descriptive statistics for all the variables by the two arms from the selected scheme
</p>
<p><code>cluster_coincidence</code> cluster coincidence matrix
</p>
<p><code>cluster_coin_des</code> cluster coincidence descriptive
</p>
<p><code>clusters_always_pair</code> pairs of clusters always allocated to the same arm.
</p>
<p><code>clusters_always_not_pair</code> pairs of clusters always allocated to different arms.
</p>
<p><code>clusters_high_pair</code>  pairs of clusters randomized to the same arm at least <code>samearmhi</code> of the time.
</p>
<p><code>clusters_low_pair</code> pairs of clusters randomized to the same arm at most <code>samearmlo</code> of the time.
</p>
<p><code>overall_allocations</code> frequency of acceptable overall allocations.
</p>
<p><code>overall_summary</code> summary of covariates with constraints in the constrained space
</p>


<h3>Author(s)</h3>

<p>Hengshi Yu &lt;hengshi@umich.edu&gt;, Fan Li &lt;fan.f.li@yale.edu&gt;, John A. Gallis &lt;john.gallis@duke.edu&gt;, Elizabeth L. Turner &lt;liz.turner@duke.edu&gt;
</p>


<h3>References</h3>

<p>Raab, G.M. and Butcher, I., 2001. Balance in cluster randomized trials. Statistics in medicine, 20(3), pp.351-365.
</p>
<p>Li, F., Lokhnygina, Y., Murray, D.M., Heagerty, P.J. and DeLong, E.R., 2016. An evaluation of constrained randomization for the design and analysis of group randomized trials. Statistics in medicine, 35(10), pp.1565-1579.
</p>
<p>Li, F., Turner, E. L., Heagerty, P. J., Murray, D. M., Vollmer, W. M., &amp; DeLong, E. R. (2017). An evaluation of constrained randomization for the design and analysis of group randomized trials with binary outcomes. Statistics in medicine, 36(24), 3791-3806.
</p>
<p>Gallis, J.A., Li, F., Yu, H. and Turner, E.L., 2018. cvcrand and cptest: Commands for efficient design and analysis of cluster randomized trials using constrained randomization and permutation tests. The Stata Journal, 18(2), pp.357-378.
</p>
<p>Dickinson, L. M., Beaty, B., Fox, C., Pace, W., Dickinson, W. P., Emsermann, C., &amp; Kempe, A. (2015). Pragmatic cluster randomized trials using covariate constrained randomization: A method for practice-based research networks (PBRNs). The Journal of the American Board of Family Medicine, 28(5), 663-672.
</p>
<p>Bailey, R.A. and Rowley, C.A., 1987. Valid randomization. Proceedings of the Royal Society of London. A. Mathematical and Physical Sciences, 410(1838), pp.105-124.
</p>
<p>Greene, E.J., 2017. A SAS macro for covariate-constrained randomization of general cluster-randomized and unstratified designs. Journal of statistical software, 77(CS1).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

# cvrcov example

Dickinson_design_numeric &lt;- Dickinson_design
Dickinson_design_numeric$location = (Dickinson_design$location == "Rural") * 1
Design_cov_result &lt;- cvrcov(clustername = Dickinson_design_numeric$county,
                            x = data.frame(Dickinson_design_numeric[ , c("location", "inciis",
                                "uptodateonimmunizations", "hispanic", "income")]),
                            ntotal_cluster = 16,
                            ntrt_cluster = 8,
                            constraints = c("s5", "mf.5", "any", "mf0.2", "mf0.2"), 
                            categorical = c("location"),
                            ###### Option to save the constrained space ######
                            # savedata = "dickinson_cov_constrained.csv",
                            seed = 12345, 
                            check_validity = TRUE)


</code></pre>

<hr>
<h2 id='Dickinson_design'>Raw county-level variables for study 1 in Dickinson et al (2015)</h2><span id='topic+Dickinson_design'></span>

<h3>Description</h3>

<p>Two approaches (interventions) were compared for increasing the &quot;up-to-date&quot; immunization rate
in 19- to 35-month-old children. 16 counties in Colorado 1:1 were randomized 1:1 to either a
population-based approach or a practice-based approach. Ahead of randomization, several
county-level variables were collected, and a subset of them are used for covariate constrained
randomization. The continuous variable of average income is categorized into tertiles to illustrate the
use of cvcrand on multi-category variables. And the percentage in CIIS variable is truncated at 100
</p>


<h3>Format</h3>

<p>A data frame with 16 rows and 11 variables:
</p>

<dl>
<dt>county</dt><dd><p>the identification for the county</p>
</dd>
<dt>location</dt><dd><p>urban or rural</p>
</dd>
<dt>inciis</dt><dd><p>percentage of children aged 19-35 months in the Colorado Immunization Information System (CIIS)</p>
</dd>
<dt>numberofchildrenages1935months</dt><dd><p>number of children aged 19-35 months</p>
</dd>
<dt>uptodateonimmunizations</dt><dd><p>percentage of children already up-to-date on their immunization</p>
</dd>
<dt>africanamerican</dt><dd><p>percentage of population that is African American</p>
</dd>
<dt>hispanic</dt><dd><p>percentage of population that is Hispanic</p>
</dd>
<dt>income</dt><dd><p>average income</p>
</dd>
<dt>incomecat</dt><dd><p>average income categorized into tertiles</p>
</dd>
<dt>pediatricpracticetofamilymedicin</dt><dd><p>pediatric practice-to-family medicine practice ratio</p>
</dd>
<dt>communityhealthcenters</dt><dd><p>number of community health centers</p>
</dd>
</dl>



<h3>Source</h3>

<p><a href="https://www.jabfm.org/content/28/5/663/tab-figures-data">https://www.jabfm.org/content/28/5/663/tab-figures-data</a>
</p>


<h3>References</h3>

<p>Dickinson, L. M., B. Beaty, C. Fox, W. Pace, W. P. Dickinson, C. Emsermann,
and A. Kempe (2015): Pragmatic cluster randomized trials using covariate
constrained randomization: A method for practice-based research networks (PBRNs).
The Journal of the American Board of Family Medicine 28(5): 663-672
</p>

<hr>
<h2 id='Dickinson_outcome'>Simulated individual-level binary outcome and baseline variables for study 1 in Dickinson et al (2015)</h2><span id='topic+Dickinson_outcome'></span>

<h3>Description</h3>

<p>At the end of the study, the researchers will have ascertained the outcome in the
16 clusters. Suppose that the researchers were able to assess 300 children in each cluster.
We simulated correlated outcome data at the individual level using a generalized linear
mixed model (GLMM) to induce correlation by including a random effect. The intracluster
correlation (ICC) was set to be 0.01, using the latent response definition provided in
Eldrige et al. (2009). This is a reasonable value of the ICC for population health studies
(Hannan et al. 1994). We simulated one data set, with the outcome data dependent on the
county-level covariates used in the constrained randomization design and a positive treatment
effect so that the practice-based intervention increases up-to-date immunization rates more
than the community-based intervention. For each individual child, the outcome is equal to 1
if he or she is up-to-date on immunizations and 0 otherwise.
</p>
<p>Note that we still categorize the continuous variable of average income to illustrate
the use of cvcrand on multi-category variables, and we truncated the percentage
in CIIS variable at 100
</p>


<h3>Format</h3>

<p>A data frame with 4800 rows and 7 variables:
</p>

<dl>
<dt>county</dt><dd><p>the identification for the county</p>
</dd>
<dt>location</dt><dd><p>urban or rural</p>
</dd>
<dt>inciis</dt><dd><p>percentage of children ages 19-35 months in the Colorado Immunization Information System (CIIS)</p>
</dd>
<dt>uptodateonimmunizations</dt><dd><p>percentage of children already up-to-date on their immunization</p>
</dd>
<dt>hispanic</dt><dd><p>percentage of population that is Hispanic</p>
</dd>
<dt>incomecat</dt><dd><p>average income categorized into tertiles</p>
</dd>
<dt>outcome</dt><dd><p>the status of being up-to-date on immunizations</p>
</dd>
</dl>



<h3>References</h3>

<p>Dickinson, L. M., B. Beaty, C. Fox, W. Pace, W. P. Dickinson, C. Emsermann,
and A. Kempe (2015): Pragmatic cluster randomized trials using covariate
constrained randomization: A method for practice-based research networks (PBRNs).
The Journal of the American Board of Family Medicine 28(5): 663-672
</p>
<p>Eldridge, S. M., Ukoumunne, O. C., &amp; Carlin, J. B. (2009). The Intra Cluster
Correlation Coefficient in Cluster Randomized Trials: A Review of Definitions.
International Statistical Review, 77(3), 378-394.
</p>
<p>Hannan, P. J., Murray, D. M., Jacobs Jr, D. R., &amp; McGovern, P. G. (1994).
Parameters to aid in the design and analysis of community trials: intraclass
correlations from the Minnesota Heart Health Program. Epidemiology, 88-95. ISO 690
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
