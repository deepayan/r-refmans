<!DOCTYPE html><html><head><title>Help for package FindIt</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {FindIt}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#Carlson'><p>Data from conjoint analysis in Carlson (2015).</p></a></li>
<li><a href='#CausalANOVA'><p>Estimating the AMEs and AMIEs with the CausalANOVA.</p></a></li>
<li><a href='#ConditionalEffect'><p>Estimating the Conditional Effects with the CausalANOVA.</p></a></li>
<li><a href='#cv.CausalANOVA'><p>Cross validation for the CausalANOVA.</p></a></li>
<li><a href='#FindIt'><p>FindIt for Estimating Heterogeneous Treatment Effects</p></a></li>
<li><a href='#FindIt-package'><p>FindIt: Finding Heterogeneous Treatment Effects</p></a></li>
<li><a href='#GerberGreen'><p>Data from the 1998 New Haven Get-Out-the-Vote Experiment</p></a></li>
<li><a href='#LaLonde'><p>National Supported Work Study Experimental Data</p></a></li>
<li><a href='#plot.CausalANOVA'><p>Plotting CausalANOVA</p></a></li>
<li><a href='#plot.PredictFindIt'><p>Plot estimated treatment effects or predicted outcomes for each treatment</p>
combination.</a></li>
<li><a href='#predict.FindIt'><p>Computing predicted values for each sample in the data.</p></a></li>
<li><a href='#summary.CausalANOVA'><p>Summarizing CausalANOVA output</p></a></li>
<li><a href='#summary.FindIt'><p>Summarizing FindIt output</p></a></li>
<li><a href='#test.CausalANOVA'><p>Estimating the AMEs and AMIEs after Regularization with the CausalANOVA.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Version:</td>
<td>1.2.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2019-11-20</td>
</tr>
<tr>
<td>Title:</td>
<td>Finding Heterogeneous Treatment Effects</td>
</tr>
<tr>
<td>Author:</td>
<td>Naoki Egami, Marc Ratkovic, Kosuke Imai</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Naoki Egami &lt;negami@princeton.edu&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.1.0), arm</td>
</tr>
<tr>
<td>Imports:</td>
<td>glmnet, lars, Matrix, quadprog, glinternet, igraph, sandwich,
lmtest, stats, graphics, utils, limSolve</td>
</tr>
<tr>
<td>Description:</td>
<td>The heterogeneous treatment effect estimation procedure 
        proposed by Imai and Ratkovic (2013)&lt;<a href="https://doi.org/10.1214%2F12-AOAS593">doi:10.1214/12-AOAS593</a>&gt;.  
        The proposed method is applicable, for
        example, when selecting a small number of most (or least)
        efficacious treatments from a large number of alternative
        treatments as well as when identifying subsets of the
        population who benefit (or are harmed by) a treatment of
        interest. The method adapts the Support Vector Machine
        classifier by placing separate LASSO constraints over the
        pre-treatment parameters and causal heterogeneity parameters of
        interest. This allows for the qualitative distinction between
        causal and other parameters, thereby making the variable
        selection suitable for the exploration of causal heterogeneity. 	
        The package also contains a class of functions, CausalANOVA, 
        which estimates the average marginal interaction effects (AMIEs)
        by a regularized ANOVA as proposed by Egami and Imai (2019)&lt;<a href="https://doi.org/10.1080%2F01621459.2018.1476246">doi:10.1080/01621459.2018.1476246</a>&gt;. 
        It contains a variety of regularization techniques to facilitate 
	analysis of large factorial experiments. </td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>LazyData:</td>
<td>yes</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.0.0</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2019-11-20 20:50:23 UTC; negami</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2019-11-20 21:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='Carlson'>Data from conjoint analysis in Carlson (2015).</h2><span id='topic+Carlson'></span>

<h3>Description</h3>

<p>This data set gives the outcomes a well as treatment assignments of the
conjoint analysis in Carlson (2015). Please Carlson (2015) and Egami and
Imai (2019) for more details.
</p>


<h3>Format</h3>

<p>A data frame consisting of 7 columns (including a treatment
assignment vector) and 3232 observations.
</p>

<table>
<tr>
 <td style="text-align: left;"> outcome </td><td style="text-align: left;"> integer </td><td style="text-align: left;"> whether a profile is chosen </td><td style="text-align: left;">
0,1 </td>
</tr>
<tr>
 <td style="text-align: left;"> newRecordF </td><td style="text-align: left;"> factor </td><td style="text-align: left;"> record as a politician </td><td style="text-align: left;"> 7 levels </td>
</tr>
<tr>
 <td style="text-align: left;">
promise </td><td style="text-align: left;"> factor </td><td style="text-align: left;"> platform </td><td style="text-align: left;"> 3 levels (job, clinic, education) </td>
</tr>
<tr>
 <td style="text-align: left;">
coeth_voting </td><td style="text-align: left;"> factor </td><td style="text-align: left;"> whether a profile is coethnic to a respodent
</td><td style="text-align: left;"> Yes, No </td>
</tr>
<tr>
 <td style="text-align: left;"> Degree </td><td style="text-align: left;"> factor </td><td style="text-align: left;"> job whether a profile has relevant
degrees </td><td style="text-align: left;"> 4 Yes, No </td>
</tr>
<tr>
 <td style="text-align: left;"> </td>
</tr>

</table>


<h3>Source</h3>

<p>Data from Carlson (2015).
</p>


<h3>References</h3>

<p>Carlson, E. 2015. &ldquo;Ethnic voting and accountability in africa:
A choice experiment in uganda.&rdquo; World Politics 67, 02, 353&ndash;385.
</p>

<hr>
<h2 id='CausalANOVA'>Estimating the AMEs and AMIEs with the CausalANOVA.</h2><span id='topic+CausalANOVA'></span>

<h3>Description</h3>

<p><code>CausalANOVA</code> estimates coefficients of the specified ANOVA with
regularization. By taking differences in coefficients, the function recovers
the AMEs and AMIEs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CausalANOVA(
  formula,
  int2.formula = NULL,
  int3.formula = NULL,
  data,
  nway = 1,
  pair.id = NULL,
  diff = FALSE,
  screen = FALSE,
  screen.type = "fixed",
  screen.num.int = 3,
  collapse = FALSE,
  collapse.type = "fixed",
  collapse.cost = 0.3,
  family = "binomial",
  cluster = NULL,
  maxIter = 50,
  eps = 1e-05,
  fac.level = NULL,
  ord.fac = NULL,
  select.prob = FALSE,
  boot = 100,
  seed = 1234,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CausalANOVA_+3A_formula">formula</code></td>
<td>
<p>A formula that specifies outcome and treatment variables.</p>
</td></tr>
<tr><td><code id="CausalANOVA_+3A_int2.formula">int2.formula</code></td>
<td>
<p>(optional). A formula that specifies two-way
interactions.</p>
</td></tr>
<tr><td><code id="CausalANOVA_+3A_int3.formula">int3.formula</code></td>
<td>
<p>(optional). A formula that specifies three-way
interactions.</p>
</td></tr>
<tr><td><code id="CausalANOVA_+3A_data">data</code></td>
<td>
<p>An optional data frame, list or environment (or object coercible
by 'as.data.frame' to a data frame) containing the variables in the model.
If not found in 'data', the variables are taken from 'environment(formula)',
typically the environment from which 'CausalANOVA' is called.</p>
</td></tr>
<tr><td><code id="CausalANOVA_+3A_nway">nway</code></td>
<td>
<p>With <code>nway=1</code>, the function estimates the Average Marginal
Effects (AMEs) only. With <code>nway=2</code>, the function estimates the AMEs and
the two-way Average Marginal Interaction Effects (AMIEs). With
<code>nway=3</code>, the function estimates the AMEs, the two-way and three-way
AMIEs. Default is 1.</p>
</td></tr>
<tr><td><code id="CausalANOVA_+3A_pair.id">pair.id</code></td>
<td>
<p>(optional).Unique identifiers for each pair of comparison.
This option is used when <code>diff=TRUE</code>.</p>
</td></tr>
<tr><td><code id="CausalANOVA_+3A_diff">diff</code></td>
<td>
<p>A logical indicating whether the outcome is the choice between a
pair.  If <code>diff=TRUE</code>, <code>pair.id</code> should specify a pair of
comparison. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="CausalANOVA_+3A_screen">screen</code></td>
<td>
<p>A logical indicating whether select significant factor
interactions with <code>glinternet</code>.  When users specify interactions using
<code>int2.formula</code> or <code>int3.formula</code>, this option is ignored.
<code>screen</code> should be used only when users want data-driven selection of
factor-interactions. With <code>screen.type</code>, users can specify how to
screen factor interactions. We recommend to use this option when the number
of factors is large, e.g., more than 6. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="CausalANOVA_+3A_screen.type">screen.type</code></td>
<td>
<p>Type for screening factor interactions. (1)
<code>"fixed"</code> select the fixed number (specified by <code>screen.num.int</code>)
of factor interactions. (2) <code>"cv.min"</code> selects factor-interactions with
the tuning parameter giving the minimum cross-validation error. (3)
<code>"cv.1Std"</code> selects factor-interactions with the tuning parameter
giving a cross-validation error that is within 1 standard deviation of the
minimum cv error.</p>
</td></tr>
<tr><td><code id="CausalANOVA_+3A_screen.num.int">screen.num.int</code></td>
<td>
<p>(optional).The number of factor interactions to
select. This option is used when and <code>screen=TRUE</code> and
<code>screen.type="fixed"</code>. Default is 3.</p>
</td></tr>
<tr><td><code id="CausalANOVA_+3A_collapse">collapse</code></td>
<td>
<p>A logical indicating whether to collapse insignificant
levels within factors.  With <code>collapse.type</code>, users can specify how to
collapse levels within factors. We recommend to use this option when the
number of levels is large, e.g., more than 6. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="CausalANOVA_+3A_collapse.type">collapse.type</code></td>
<td>
<p>Type for collapsing levels within factors. (1)
<code>"fixed"</code> collapses levels with the fixed cost parameter (specified by
<code>collapse.cost</code>). (2) <code>"cv.min"</code> collapses levels with the cost
parameter giving the minimum cross-validation error. This option might take
time. (3) <code>"cv.1Std"</code> collapses with the cost parameter giving a
cross-validation error that is within 1 standard deviation of the minimum cv
error. This option might take time.</p>
</td></tr>
<tr><td><code id="CausalANOVA_+3A_collapse.cost">collapse.cost</code></td>
<td>
<p>(optional).A cost parameter ranging from 0 to 1. 1
corresponds to no collapsing. The closer to 0, the stronger regularization.
Default is 0.3.</p>
</td></tr>
<tr><td><code id="CausalANOVA_+3A_family">family</code></td>
<td>
<p>A family of outcome variables. <code>"gaussian"</code> when
continuous outcomes <code>"binomial"</code> when binary outcomes.  Default is
<code>"binomial"</code>.</p>
</td></tr>
<tr><td><code id="CausalANOVA_+3A_cluster">cluster</code></td>
<td>
<p>Unique identifies with which cluster standard errors are
computed.</p>
</td></tr>
<tr><td><code id="CausalANOVA_+3A_maxiter">maxIter</code></td>
<td>
<p>The number of maximum iteration for <code>glinternet</code>.</p>
</td></tr>
<tr><td><code id="CausalANOVA_+3A_eps">eps</code></td>
<td>
<p>A tolerance parameter in the internal optimization algorithm.</p>
</td></tr>
<tr><td><code id="CausalANOVA_+3A_fac.level">fac.level</code></td>
<td>
<p>(optional). A vector containing the number of levels in
each factor. The order of <code>fac.level</code> should match to the order of
columns in the data. For example, when the first and second columns of the
design matrix is &quot;Education&quot; and &quot;Race&quot;, the first and second element of
<code>fac.level</code> should be the number of levels in &quot;Education&quot; and &quot;Race&quot;,
respectively.</p>
</td></tr>
<tr><td><code id="CausalANOVA_+3A_ord.fac">ord.fac</code></td>
<td>
<p>(optional). Logical vectors indicating whether each factor
has ordered (<code>TRUE</code>) or unordered (<code>FALSE</code>) levels.  When levels
are ordered, the function uses the order given by function <code>levels()</code>.
If levels are ordered, the function places penalties on the differences
between adjacent levels.  If levels are unordered, the function places
penalties on the differences based on every pairwise comparison.</p>
</td></tr>
<tr><td><code id="CausalANOVA_+3A_select.prob">select.prob</code></td>
<td>
<p>(optional). A logical indicating whether selection
probabilities are computed. This option might take time.</p>
</td></tr>
<tr><td><code id="CausalANOVA_+3A_boot">boot</code></td>
<td>
<p>The number of bootstrap replicates for <code>select.prob</code>.
Default is 50.</p>
</td></tr>
<tr><td><code id="CausalANOVA_+3A_seed">seed</code></td>
<td>
<p>Seed for bootstrap.</p>
</td></tr>
<tr><td><code id="CausalANOVA_+3A_verbose">verbose</code></td>
<td>
<p>Whether it prints the value of a cost parameter used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><b>Regularization</b>: <code>screen</code> and <code>collapse</code>.
</p>
<p>Users can implement regularization in order to reduces false discovery rate
and facilitates interpretation. This is particularly useful when analyzing
factorial experiments with a large number of factors, each having many
levels.  </p>
 <ul>
<li><p> When <code>screen=TRUE</code>, the function selects
significant factor interactions with <code>glinternet</code> (Lim and Hastie 2015)
before estimating the AMEs and AMIEs. This option is recommended when there
are many factors, e.g., more than 6 factors. Alternatively, users can
pre-specify interactions of interest using <code>int2.formula</code> and
<code>int3.formula</code>. </p>
</li>
<li><p> When <code>collapse=TRUE</code>, the function collapses
insignificant levels within each factor by GashANOVA (Post and Bondell 2013)
before estimating the AMEs and AMIEs. This option is recommended when there
are many levels within some factors, e.g., more than 6 levels. </p>
</li></ul>

<p><b>Inference after Regularization</b>: </p>
 <ul>
<li><p> When <code>screen=TRUE</code> or
<code>collapse=TRUE</code>, in order to make valid inference after regularization,
we recommend to use <code>test.CausalANOVA</code> function. It takes the output
from <code>CausalANOVA</code> function and estimate the AMEs and AMIEs with
<code>newdata</code> and provide confidence intervals. Ideally, users should split
samples into two; use a half for regularization with <code>CausalANOVA</code>
function and use the other half for inference with <code>test.CausalANOVA</code>.
</p>
</li>
<li><p> If users do not need regularization, specify <code>screen=FALSE</code> and
<code>collapse=FALSE</code>. The function estimates the AMEs and AMIEs and compute
confidence intervals with the full sample. </p>
</li></ul>

<p><b>Suggested Workflow</b>: (See Examples below as well) </p>
 <ol>
<li><p> Specify
the order of levels within each factor using <code>levels()</code>.  When
<code>collapse=TRUE</code>, the function places penalties on the differences
between adjacent levels when levels are ordered, it is crucial to specify
the order of levels within each factor carefully. </p>
</li>
<li><p> Run
<code>CausalANOVA</code>. </p>
 <ol>
<li><p> Specify <code>formula</code> to indicate
outcomes and treatment variables and <code>nway</code> to indicate the order of
interactions. </p>
</li>
<li><p> Specify <code>diff=TRUE</code> and <code>pair.id</code> if the
outcome is the choice between a pair. </p>
</li>
<li><p> Specify <code>screen</code>.
<code>screen=TRUE</code> to implement data-driven selection of factor
interactions. <code>screen=FALSE</code> to specify interactions through
<code>int2.formula</code> and <code>int3.formula</code> by hand. </p>
</li>
<li><p> Specify
<code>collapse</code>. <code>collapse=TRUE</code> to implement data-driven collapsing of
insignificant levels. <code>collapse=FALSE</code> to use the original number of
levels.</p>
</li></ol>

</li>
<li><p> Run <code>test.CausalANOVA</code> when <code>select=TRUE</code> or
<code>collapse=TRUE</code>.  </p>
</li>
<li><p> Run <code>summary</code> and <code>plot</code> to explore
the AMEs and AMIEs. </p>
</li>
<li><p> Estimate conditional effects using
<code>ConditionalEffect</code> function and visualize them using <code>plot</code>
function. </p>
</li></ol>



<h3>Value</h3>

<table>
<tr><td><code>intercept</code></td>
<td>
<p>An intercept of the estimated ANOVA model.If
<code>diff=TRUE</code>, this should be close to 0.5.</p>
</td></tr> <tr><td><code>formula</code></td>
<td>
<p>The
<code>formula</code> used in the function.</p>
</td></tr> <tr><td><code>coefs</code></td>
<td>
<p>A named vector of
coefficients of the estimated ANOVA model.</p>
</td></tr> <tr><td><code>vcov</code></td>
<td>
<p>The
variance-covariance matrix for <code>coefs</code>. Only when <code>select=FALSE</code>
and <code>collapse=FALSE</code>.</p>
</td></tr> <tr><td><code>CI.table</code></td>
<td>
<p>The summary of AMEs and AMIEs
with confidence intervals. Only when <code>select=FALSE</code> and
<code>collapse=FALSE</code>.</p>
</td></tr> <tr><td><code>AME</code></td>
<td>
<p>The estimated AMEs with the grand-mean as
baselines.</p>
</td></tr> <tr><td><code>AMIE2</code></td>
<td>
<p>The estimated two-way AMIEs with the grand-mean as
baselines.</p>
</td></tr> <tr><td><code>AMIE3</code></td>
<td>
<p>The estimated three-way AMIEs with the grand-mean
as baselines.</p>
</td></tr> <tr><td><code>...</code></td>
<td>
<p>arguments passed to the function or arguments only
for the internal use.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Naoki Egami and Kosuke Imai.
</p>


<h3>References</h3>

<p>Egami, Naoki and Kosuke Imai. 2019. Causal Interaction in
Factorial Experiments: Application to Conjoint Analysis, Journal of the American Statistical Association.
<a href="http://imai.fas.harvard.edu/research/files/int.pdf">http://imai.fas.harvard.edu/research/files/int.pdf</a>
</p>
<p>Lim, M. and Hastie, T. 2015. Learning interactions via hierarchical
group-lasso regularization. Journal of Computational and Graphical
Statistics 24, 3, 627&ndash;654.
</p>
<p>Post, J. B. and Bondell, H. D. 2013. Factor selection and structural
identification in the interaction anova model. Biometrics 69, 1, 70&ndash;79.
</p>


<h3>See Also</h3>

<p><a href="#topic+cv.CausalANOVA">cv.CausalANOVA</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(Carlson)
## Specify the order of each factor
Carlson$newRecordF&lt;- factor(Carlson$newRecordF,ordered=TRUE,
                            levels=c("YesLC", "YesDis","YesMP",
                                     "noLC","noDis","noMP","noBusi"))
Carlson$promise &lt;- factor(Carlson$promise,ordered=TRUE,levels=c("jobs","clinic","education"))
Carlson$coeth_voting &lt;- factor(Carlson$coeth_voting,ordered=FALSE,levels=c("0","1"))
Carlson$relevantdegree &lt;- factor(Carlson$relevantdegree,ordered=FALSE,levels=c("0","1"))

## ####################################### 
## Without Screening and Collapsing
## ####################################### 
#################### only AMEs ####################
fit1 &lt;- CausalANOVA(formula=won ~ newRecordF + promise + coeth_voting + relevantdegree,
                    data=Carlson, pair.id=Carlson$contestresp, diff=TRUE,
                    cluster=Carlson$respcodeS, nway=1)
summary(fit1)
plot(fit1)

#################### AMEs and two-way AMIEs ####################
fit2 &lt;- CausalANOVA(formula=won ~ newRecordF + promise + coeth_voting + relevantdegree,
                    int2.formula = ~ newRecordF:coeth_voting,
                    data=Carlson, pair.id=Carlson$contestresp,diff=TRUE,
                    cluster=Carlson$respcodeS, nway=2)
summary(fit2)
plot(fit2, type="ConditionalEffect", fac.name=c("newRecordF","coeth_voting"))
ConditionalEffect(fit2, treat.fac="newRecordF", cond.fac="coeth_voting")

## Not run: 
#################### AMEs and two-way and three-way AMIEs ####################
## Note: All pairs within thee-way interactions should show up in int2.formula (Strong Hierarchy).
fit3 &lt;- CausalANOVA(formula=won ~ newRecordF + promise + coeth_voting + relevantdegree,
                    int2.formula = ~ newRecordF:promise + newRecordF:coeth_voting
                                       + promise:coeth_voting,
                    int3.formula = ~ newRecordF:promise:coeth_voting,
                    data=Carlson, pair.id=Carlson$contestresp,diff=TRUE,
                    cluster=Carlson$respcodeS, nway=3)
summary(fit3)
plot(fit3, type="AMIE", fac.name=c("newRecordF","promise", "coeth_voting"),space=25,adj.p=2.2)

## End(Not run)

## ####################################### 
## With Screening and Collapsing
## #######################################
## Sample Splitting
train.ind &lt;- sample(unique(Carlson$respcodeS), 272, replace=FALSE)
test.ind &lt;- setdiff(unique(Carlson$respcodeS), train.ind)
Carlson.train &lt;- Carlson[is.element(Carlson$respcodeS,train.ind), ]
Carlson.test &lt;- Carlson[is.element(Carlson$respcodeS,test.ind), ]
 
#################### AMEs and two-way AMIEs ####################
fit.r2 &lt;- CausalANOVA(formula=won ~ newRecordF + promise + coeth_voting + relevantdegree,
                      data=Carlson.train, pair.id=Carlson.train$contestresp,diff=TRUE,
                      screen=TRUE, collapse=TRUE,
                      cluster=Carlson.train$respcodeS, nway=2)
summary(fit.r2)

## refit with test.CausalANOVA
fit.r2.new &lt;- test.CausalANOVA(fit.r2, newdata=Carlson.test, diff=TRUE,
                               pair.id=Carlson.test$contestresp, cluster=Carlson.test$respcodeS)

summary(fit.r2.new)
plot(fit.r2.new)
plot(fit.r2.new, type="ConditionalEffect", fac.name=c("newRecordF","coeth_voting"))
ConditionalEffect(fit.r2.new, treat.fac="newRecordF", cond.fac="coeth_voting")

</code></pre>

<hr>
<h2 id='ConditionalEffect'>Estimating the Conditional Effects with the CausalANOVA.</h2><span id='topic+ConditionalEffect'></span>

<h3>Description</h3>

<p><code>ConditionalEffect</code> estimates a variety of conditional effects using
the ouput from <code>CausalANOVA</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ConditionalEffect(
  object,
  treat.fac = NULL,
  cond.fac = NULL,
  base.ind = 1,
  round = 3,
  inference = NULL,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ConditionalEffect_+3A_object">object</code></td>
<td>
<p>The output from <code>CausalANOAV</code> function.</p>
</td></tr>
<tr><td><code id="ConditionalEffect_+3A_treat.fac">treat.fac</code></td>
<td>
<p>The name of factor acting as the main treatment variable.</p>
</td></tr>
<tr><td><code id="ConditionalEffect_+3A_cond.fac">cond.fac</code></td>
<td>
<p>The name of factor acting as the conditioning (moderating)
variable.</p>
</td></tr>
<tr><td><code id="ConditionalEffect_+3A_base.ind">base.ind</code></td>
<td>
<p>An indicator for the baseline of the treatment factor.
Default is 1.</p>
</td></tr>
<tr><td><code id="ConditionalEffect_+3A_round">round</code></td>
<td>
<p>Digits to round estimates. Default is 3.</p>
</td></tr>
<tr><td><code id="ConditionalEffect_+3A_inference">inference</code></td>
<td>
<p>(optional). This argument is mainly for internal use. It
indicates whether <code>CausalANOVA</code> has done inference or not.</p>
</td></tr>
<tr><td><code id="ConditionalEffect_+3A_verbose">verbose</code></td>
<td>
<p>Whether it prints the progress.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See Details in <code>CausalANOVA</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>CondtionalEffects</code></td>
<td>
<p>The summary of estimated conditional
effects.</p>
</td></tr> <tr><td><code>...</code></td>
<td>
<p>Arguments for the internal use.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Naoki Egami and Kosuke Imai.
</p>


<h3>References</h3>

<p>Egami, Naoki and Kosuke Imai. 2019. Causal Interaction in
Factorial Experiments: Application to Conjoint Analysis, Journal of the American Statistical Association.
<a href="http://imai.fas.harvard.edu/research/files/int.pdf">http://imai.fas.harvard.edu/research/files/int.pdf</a>
</p>
<p>Lim, M. and Hastie, T. 2015. Learning interactions via hierarchical
group-lasso regularization. Journal of Computational and Graphical
Statistics 24, 3, 627&ndash;654.
</p>
<p>Post, J. B. and Bondell, H. D. 2013. &ldquo;Factor selection and structural
identification in the interaction anova model.&rdquo; Biometrics 69, 1, 70&ndash;79.
</p>


<h3>See Also</h3>

<p><a href="#topic+CausalANOVA">CausalANOVA</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(Carlson)
## Specify the order of each factor
Carlson$newRecordF&lt;- factor(Carlson$newRecordF,ordered=TRUE,
                            levels=c("YesLC", "YesDis","YesMP",
                                     "noLC","noDis","noMP","noBusi"))
Carlson$promise &lt;- factor(Carlson$promise,ordered=TRUE,levels=c("jobs","clinic","education"))
Carlson$coeth_voting &lt;- factor(Carlson$coeth_voting,ordered=FALSE,levels=c("0","1"))
Carlson$relevantdegree &lt;- factor(Carlson$relevantdegree,ordered=FALSE,levels=c("0","1"))

## ####################################### 
## Without Screening and Collapsing
## ####################################### 
#################### AMEs and two-way AMIEs ####################
fit2 &lt;- CausalANOVA(formula=won ~ newRecordF + promise + coeth_voting + relevantdegree,
                    int2.formula = ~ newRecordF:coeth_voting,
                    data=Carlson, pair.id=Carlson$contestresp,diff=TRUE,
                    cluster=Carlson$respcodeS, nway=2)
summary(fit2)
plot(fit2, type="ConditionalEffect", fac.name=c("newRecordF","coeth_voting"))
ConditionalEffect(fit2, treat.fac="newRecordF", cond.fac="coeth_voting")
</code></pre>

<hr>
<h2 id='cv.CausalANOVA'>Cross validation for the CausalANOVA.</h2><span id='topic+cv.CausalANOVA'></span><span id='topic+plot.cv.CausalANOVA'></span>

<h3>Description</h3>

<p><code>cv.CausalANOVA</code> implements cross-validation for <code>CausalANOVA</code> to
select the <code>collapse.cost</code> parameter.  <code>CausalANOVA</code> runs this
function internally when defaults when <code>collapse.type=cv.min</code> or
<code>collapse.type=cv.1Std</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cv.CausalANOVA(
  formula,
  int2.formula = NULL,
  int3.formula = NULL,
  data,
  nway = 1,
  pair.id = NULL,
  diff = FALSE,
  cv.collapse.cost = c(0.1, 0.3, 0.7),
  nfolds = 5,
  screen = FALSE,
  screen.type = "fixed",
  screen.num.int = 3,
  family = "binomial",
  cluster = NULL,
  maxIter = 50,
  eps = 1e-05,
  seed = 1234,
  fac.level = NULL,
  ord.fac = NULL,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cv.CausalANOVA_+3A_formula">formula</code></td>
<td>
<p>a formula that specifies outcome and treatment variables.</p>
</td></tr>
<tr><td><code id="cv.CausalANOVA_+3A_int2.formula">int2.formula</code></td>
<td>
<p>(optional). A formula that specifies two-way
interactions.</p>
</td></tr>
<tr><td><code id="cv.CausalANOVA_+3A_int3.formula">int3.formula</code></td>
<td>
<p>(optional). A formula that specifies three-way
interactions.</p>
</td></tr>
<tr><td><code id="cv.CausalANOVA_+3A_data">data</code></td>
<td>
<p>an optional data frame, list or environment (or object coercible
by 'as.data.frame' to a data frame) containing the variables in the model.
If not found in 'data', the variables are taken from 'environment(formula)',
typically the environment from which 'CausalANOVA' is called.</p>
</td></tr>
<tr><td><code id="cv.CausalANOVA_+3A_nway">nway</code></td>
<td>
<p>With <code>nway=1</code>, the function estimates the Average Marginal
Effects (AMEs) only.  With <code>nway=2</code>, the function estimates the AMEs
and the two-way Average Marginal Interaction Effects (AMIEs).  With
<code>nway=3</code>, the function estimates the AMEs, the two-way and three-way
AMIEs. Default is 1.</p>
</td></tr>
<tr><td><code id="cv.CausalANOVA_+3A_pair.id">pair.id</code></td>
<td>
<p>(optional).Unique identifiers for each pair of comparison.
This option is used when <code>diff=TRUE</code>.</p>
</td></tr>
<tr><td><code id="cv.CausalANOVA_+3A_diff">diff</code></td>
<td>
<p>A logical indicating whether the outcome is the choice between a
pair.  If <code>diff=TRUE</code>, <code>pair.id</code> should specify a pair of
comparison. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="cv.CausalANOVA_+3A_cv.collapse.cost">cv.collapse.cost</code></td>
<td>
<p>A vector containing candidates for a cost parameter
ranging from 0 to 1.  1 corresponds to no regularization and the smaller
value corresponds to the stronger regularization.  Default is
<code>c(0.1,0.3,0.7)</code>.</p>
</td></tr>
<tr><td><code id="cv.CausalANOVA_+3A_nfolds">nfolds</code></td>
<td>
<p>number of folds - default is 5. Although nfolds can be as
large as the sample size (leave-one-out CV), it is not recommended for large
datasets.</p>
</td></tr>
<tr><td><code id="cv.CausalANOVA_+3A_screen">screen</code></td>
<td>
<p>A logical indicating whether select significant factor
interactions with <code>glinternet</code>.  When users specify interactions using
<code>int2.formula</code> or <code>int3.formula</code>, this option is ignored.
<code>screen</code> should be used only when users want data-driven selection of
factor-interactions.  With <code>screen.type</code>, users can specify how to
screen factor interactions. We recommend to use this option when the number
of factors is large, e.g., more than 6. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="cv.CausalANOVA_+3A_screen.type">screen.type</code></td>
<td>
<p>Type for screening factor interactions. (1)
<code>"fixed"</code> select the fixed number (specified by <code>screen.num.int</code>)
of factor interactions. (2) <code>"cv.min"</code> selects factor-interactions with
the tuning parameter giving the minimum cross-validation error. (3)
<code>"cv.1Std"</code> selects factor-interactions with the tuning parameter
giving a cross-validation error that is within 1 standard deviation of the
minimum cv error.</p>
</td></tr>
<tr><td><code id="cv.CausalANOVA_+3A_screen.num.int">screen.num.int</code></td>
<td>
<p>(optional).The number of factor interactions to
select. This option is used when and <code>screen=TRUE</code> and
<code>screen.type="fixed"</code>. Default is 3.</p>
</td></tr>
<tr><td><code id="cv.CausalANOVA_+3A_family">family</code></td>
<td>
<p>A family of outcome variables. <code>"gaussian"</code> when
continuous outcomes <code>"binomial"</code> when binary outcomes.  Default is
<code>"binomial"</code>.</p>
</td></tr>
<tr><td><code id="cv.CausalANOVA_+3A_cluster">cluster</code></td>
<td>
<p>Unique identifies with which cluster standard errors are
computed.</p>
</td></tr>
<tr><td><code id="cv.CausalANOVA_+3A_maxiter">maxIter</code></td>
<td>
<p>The number of maximum iteration for <code>glinternet</code>.</p>
</td></tr>
<tr><td><code id="cv.CausalANOVA_+3A_eps">eps</code></td>
<td>
<p>A tolerance parameter in the internal optimization algorithm.</p>
</td></tr>
<tr><td><code id="cv.CausalANOVA_+3A_seed">seed</code></td>
<td>
<p>an argument for <code>set.seed()</code>.</p>
</td></tr>
<tr><td><code id="cv.CausalANOVA_+3A_fac.level">fac.level</code></td>
<td>
<p>optional. A vector containing the number of levels in each
factor. The order of <code>fac.level</code> should match to the order of columns
in the data. For example, when the first and second columns of the design
matrix is &quot;Education&quot; and &quot;Race&quot;, the first and second element of
<code>fac.level</code> should be the number of levels in &quot;Education&quot; and &quot;Race&quot;,
respectively.</p>
</td></tr>
<tr><td><code id="cv.CausalANOVA_+3A_ord.fac">ord.fac</code></td>
<td>
<p>optional. logical vectors indicating whether each factor has
ordered (<code>TRUE</code>) or unordered (<code>FALSE</code>) levels. When levels are
ordered, the function uses the order given by function <code>levels()</code>. If
levels are ordered, the function places penalties on the differences between
adjacent levels. If levels are unordered, the function places penalties on
the differences based on every pairwise comparison.</p>
</td></tr>
<tr><td><code id="cv.CausalANOVA_+3A_verbose">verbose</code></td>
<td>
<p>whether it prints the value of a cost parameter used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See Details in <code>CausalANOVA</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>cv.error</code></td>
<td>
<p>The mean cross-validated error - a vector of length
<code>length(cv.t)</code>.</p>
</td></tr> <tr><td><code>cv.min</code></td>
<td>
<p>A value of <code>t</code> that gives minimum
<code>cv.missclass</code>.</p>
</td></tr> <tr><td><code>cv.1Std</code></td>
<td>
<p>The largest value of <code>t</code> such that
error is within 1 standard error of the minimum.</p>
</td></tr> <tr><td><code>cv.each.mat</code></td>
<td>
<p>A
matrix containing cross-validation errors for each fold and cost parameter.</p>
</td></tr>
<tr><td><code>cv.cost</code></td>
<td>
<p>The <code>cv.collapse.cost</code> used in the function.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Naoki Egami and Kosuke Imai.
</p>


<h3>References</h3>

<p>Post, J. B. and Bondell, H. D. 2013. &ldquo;Factor selection and
structural identification in the interaction anova model.&rdquo; Biometrics 69,
1, 70&ndash;79.
</p>
<p>Egami, Naoki and Kosuke Imai. 2019. Causal Interaction in
Factorial Experiments: Application to Conjoint Analysis, Journal of the American Statistical Association.
<a href="http://imai.fas.harvard.edu/research/files/int.pdf">http://imai.fas.harvard.edu/research/files/int.pdf</a>
</p>


<h3>See Also</h3>

<p><a href="#topic+CausalANOVA">CausalANOVA</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(Carlson)
## Specify the order of each factor
Carlson$newRecordF&lt;- factor(Carlson$newRecordF,ordered=TRUE,
                            levels=c("YesLC", "YesDis","YesMP",
                                     "noLC","noDis","noMP","noBusi"))
Carlson$promise &lt;- factor(Carlson$promise,ordered=TRUE,levels=c("jobs","clinic","education"))
Carlson$coeth_voting &lt;- factor(Carlson$coeth_voting,ordered=FALSE,levels=c("0","1"))
Carlson$relevantdegree &lt;- factor(Carlson$relevantdegree,ordered=FALSE,levels=c("0","1"))

## ####################################### 
## Collapsing Without Screening
## ####################################### 
#################### AMEs and two-way AMIEs ####################
## We show a very small example for illustration.
## Recommended to use cv.collapse.cost=c(0.1,0.3,0.5) and nfolds=10 in practice.
fit.cv &lt;- cv.CausalANOVA(formula=won ~ newRecordF + promise + coeth_voting + relevantdegree,
                         int2.formula = ~ newRecordF:coeth_voting,
                         data=Carlson, pair.id=Carlson$contestresp,diff=TRUE,
                         cv.collapse.cost=c(0.1,0.3), nfolds=2,
                         cluster=Carlson$respcodeS, nway=2)
fit.cv

</code></pre>

<hr>
<h2 id='FindIt'>FindIt for Estimating Heterogeneous Treatment Effects</h2><span id='topic+FindIt'></span>

<h3>Description</h3>

<p><code>FindIt</code> returns a model with the most predictive treatment-treatment
interactions or treatment-covariate interactions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>FindIt(
  model.treat,
  model.main,
  model.int,
  data = NULL,
  type = "binary",
  treat.type = "multiple",
  nway,
  search.lambdas = TRUE,
  lambdas = NULL,
  make.twoway = TRUE,
  make.allway = TRUE,
  wts = 1,
  scale.c = 1,
  scale.int = 1,
  fit.glmnet = TRUE,
  make.reference = TRUE,
  reference.main = NULL,
  threshold = 0.999999
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="FindIt_+3A_model.treat">model.treat</code></td>
<td>
<p>A formula that specifies outcome and treatment variables.</p>
</td></tr>
<tr><td><code id="FindIt_+3A_model.main">model.main</code></td>
<td>
<p>An optional formula that specifies pre-treatment
covariates to be adjusted.</p>
</td></tr>
<tr><td><code id="FindIt_+3A_model.int">model.int</code></td>
<td>
<p>A formula specifying pre-treatment covariates to be
interacted with treatment assignments when <code>treat.type="single"</code>.</p>
</td></tr>
<tr><td><code id="FindIt_+3A_data">data</code></td>
<td>
<p>An optional data frame, list or environment (or object coercible
by 'as.data.frame' to a data frame) containing the variables in the model.
If not found in 'data', the variables are taken from 'environment(formula)',
typically the environment from which 'FindIt' is called.</p>
</td></tr>
<tr><td><code id="FindIt_+3A_type">type</code></td>
<td>
<p>&quot;binary&quot; for a binary outcome variable, which needs to be
<code>integer</code> class; &quot;continuous&quot; for a continuous outcome variable.</p>
</td></tr>
<tr><td><code id="FindIt_+3A_treat.type">treat.type</code></td>
<td>
<p>&quot;single&quot; for interactions between a single treatment
variable, which needs to be <code>integer</code> class, and multiple pre-treatment
covariates specified with <code>model.int</code>; &quot;multiple&quot; is used when
treatment-treatment interactions are of interest and <code>treat</code> is a
matrix of multiple treatments.</p>
</td></tr>
<tr><td><code id="FindIt_+3A_nway">nway</code></td>
<td>
<p>An argument passed to <code>makeallway</code> when
<code>treat.type="multiple"</code>. <code>FindIt</code> generates treatment-treatment
interactions up to the order specified with this argument. In general, it is
recommended to use the number of factorial treatments. The current version
covers up to four way interactions.</p>
</td></tr>
<tr><td><code id="FindIt_+3A_search.lambdas">search.lambdas</code></td>
<td>
<p>Whether to search for the tuning parameters for the
LASSO constraints. If <code>FALSE</code>, <code>lambdas</code> must be supplied.</p>
</td></tr>
<tr><td><code id="FindIt_+3A_lambdas">lambdas</code></td>
<td>
<p>Tuning parameters to be given to <code>FindIt</code>; only used if
<code>search.lambdas=FALSE</code>.</p>
</td></tr>
<tr><td><code id="FindIt_+3A_make.twoway">make.twoway</code></td>
<td>
<p>If <code>make.twoway=TRUE</code>, all possible two-way
interactions for the pre-treatment covariates specified in <code>model.main</code>
and <code>model.int</code> are generated within <code>FindIt</code>. The default is set
to be <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="FindIt_+3A_make.allway">make.allway</code></td>
<td>
<p>If <code>make.allway=TRUE</code>, all possible
treatment-treatment interactions for multiple treatments are generated when
<code>treat.type="multiple"</code>. Interactions of the order up to the value of
<code>nway</code> is computed.</p>
</td></tr>
<tr><td><code id="FindIt_+3A_wts">wts</code></td>
<td>
<p>An optional set of scaling weights. The default is 1.</p>
</td></tr>
<tr><td><code id="FindIt_+3A_scale.c">scale.c</code></td>
<td>
<p>A set of weights for recaling the pre-treatment covariates;
only used if <code>make.twoway=FALSE</code>. <code>maketwoway</code> is useful for
generating these.</p>
</td></tr>
<tr><td><code id="FindIt_+3A_scale.int">scale.int</code></td>
<td>
<p>A set of weights for recaling the covariates to be
interacted with treatment variables ; only used if <code>make.twoway=FALSE</code>.
<code>maketwoway</code> is useful for generating these.</p>
</td></tr>
<tr><td><code id="FindIt_+3A_fit.glmnet">fit.glmnet</code></td>
<td>
<p>Whether to fit using the coordinate descent method in
glmnet (TRUE) or the regularization path method of LARS (FALSE).</p>
</td></tr>
<tr><td><code id="FindIt_+3A_make.reference">make.reference</code></td>
<td>
<p>Whether to make a reference matrix to check which
columns are dropped when <code>makeallway=TRUE</code>.</p>
</td></tr>
<tr><td><code id="FindIt_+3A_reference.main">reference.main</code></td>
<td>
<p>If <code>make.allway=FALSE</code> and researchers generate a
matrix of all possible interactions between factorial treatments,
<code>reference</code> from <code>makeallway</code> function is better to be passed to
<code>FindIt</code> through this argument.</p>
</td></tr>
<tr><td><code id="FindIt_+3A_threshold">threshold</code></td>
<td>
<p>An argument passed to <code>makeallway</code> when
<code>treat.type="multiple"</code>. Threshold to drop correlated columns when
<code>makeallway</code> is used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Implements the alternating line search algorithm for estimating the tuning
parameters, as described in Imai and Ratkovic (2013).
</p>


<h3>Value</h3>

<table>
<tr><td><code>coefs</code></td>
<td>
<p>A named vector of scaled coefficients</p>
</td></tr>
<tr><td><code>coefs.orig</code></td>
<td>
<p>A vector of coefficients on the original scale, if scale.c
and scale.t was used</p>
</td></tr> <tr><td><code>fit</code></td>
<td>
<p>Fitted values on an SVM scale</p>
</td></tr>
<tr><td><code>names.out</code></td>
<td>
<p>Names of the coefficients</p>
</td></tr> <tr><td><code>y</code></td>
<td>
<p>A vector of observed
outcomes</p>
</td></tr> <tr><td><code>X.c</code></td>
<td>
<p>A matrix of pre-treatment covariates to be adjusted</p>
</td></tr>
<tr><td><code>X.t</code></td>
<td>
<p>A matrix of treatments and treatment-treatment interactions, or
treatment-covariate interactions</p>
</td></tr> <tr><td><code>GCV</code></td>
<td>
<p>GCV statistic at the minimum</p>
</td></tr>
<tr><td><code>ATE</code></td>
<td>
<p>When <code>treat.type="single"</code>, the estimated ATE. When
<code>treat.type="multiple"</code>, the estimated treatment effect of each unique
treatment combination</p>
</td></tr> <tr><td><code>lambdas</code></td>
<td>
<p>Tuning parameters used for the fit</p>
</td></tr>
<tr><td><code>reference</code></td>
<td>
<p>When <code>treat.type="multiple"</code>, after making all
interaction terms, columns with no variation or columns perfectly correlated
with one of other columns are automatically dropped. <code>reference</code> shows
which columns are kept and dropped.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Naoki Egami, Marc Ratkovic and Kosuke Imai.
</p>


<h3>References</h3>

<p>Imai, Kosuke and Marc Ratkovic. 2013.  &ldquo;Estimating Treatment
Effect Heterogeneity in Randomized Program Evaluation.&rdquo; Annals of Applied
Statistics, Vol.7, No.1(March), pp. 443-470.
<a href="http://imai.fas.harvard.edu/research/files/svm.pdf">http://imai.fas.harvard.edu/research/files/svm.pdf</a>
</p>
<p>Egami, Naoki and Kosuke Imai. 2019. Causal Interaction in 
Factorial Experiments: Application to Conjoint Analysis, Journal of the American Statistical Association.
<a href="http://imai.fas.harvard.edu/research/files/int.pdf">http://imai.fas.harvard.edu/research/files/int.pdf</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

################################################### 
## Example 1: Treatment-Covariate Interaction
################################################### 
data(LaLonde)

## The model includes a treatment variable, 
## nine covariates to be interacted with the treatment variable,
## and the same nine covariates to be adjusted.

## Not run: 

## Run to find the LASSO parameters
F1  &lt;-FindIt(model.treat= outcome ~ treat,
             model.main= ~ age+educ+black+hisp+white+
             marr+nodegr+log.re75+u75,
             model.int= ~ age+educ+black+hisp+white+
             marr+nodegr+log.re75+u75,
             data = LaLonde,  
             type="binary",
             treat.type="single") 

## End(Not run)

## Fit with uncovered lambda parameters.
F1  &lt;-FindIt(model.treat= outcome ~ treat,
             model.main= ~ age+educ+black+hisp+white+
             marr+nodegr+log.re75+u75,
             model.int= ~ age+educ+black+hisp+white+
             marr+nodegr+log.re75+u75,
             data = LaLonde, 
             type="binary",
             treat.type="single",
             search.lambdas=FALSE,
             lambdas = c(-3.8760,-4.0025) )

summary(F1)

## Returns all the estimated treatment effects. 
pred1 &lt;- predict(F1)
## Top10
head(pred1$data, n=10)
## Bottom 10
tail(pred1$data ,n=10)

## Visualize all the estimated treatment effects.
## Not run: 
plot(pred1)

## End(Not run)

################################################### 
## Example 2: Treatment-Treatment Interaction
################################################### 

## Not run: 
data(GerberGreen)

## The model includes four factorial treatments and 
## all two, three, four-way interactions between them.
## Four pre-treatment covariates are adjusted.

## Run to search for lambdas.
F2&lt;- FindIt(model.treat= voted98 ~ persngrp+phnscrpt+mailings+appeal,
             nway=4,
             model.main= ~ age+majorpty+vote96.1+vote96.0,
             data = GerberGreen,
             type="binary",
             treat.type="multiple")

## Fit, given selected lambdas.
F2&lt;- FindIt(model.treat= voted98 ~ persngrp+phnscrpt+mailings+appeal,
             nway=4,
             model.main= ~ age+majorpty+vote96.1+vote96.0,
             data = GerberGreen,
             type="binary",
             treat.type="multiple",
             search.lambdas=FALSE,
             lambdas=c(-15.000,-6.237))

## Returns coefficient estimates.
summary(F2)

## Returns predicted values for unique treatment combinations.
pred2 &lt;- predict(F2,unique=TRUE)
## Top 10
head(pred2$data, n=10)
## Bottom 10
tail(pred2$data, n=10)

## Visualize predicted values for each treatment combination.
plot(pred2)

## End(Not run)

</code></pre>

<hr>
<h2 id='FindIt-package'>FindIt: Finding Heterogeneous Treatment Effects</h2><span id='topic+FindIt-package'></span><span id='topic+CreateWeights'></span><span id='topic+CreatelevelIndex'></span><span id='topic+lengthSlack'></span><span id='topic+Lcombinefunction'></span><span id='topic+PsyConstraintCombine'></span><span id='topic+CreateANOVAconst'></span><span id='topic+Zcombinefunction'></span><span id='topic+Glsei'></span><span id='topic+CoefExtract'></span><span id='topic+rangeCausalANOVAFit'></span><span id='topic+CausalANOVAFit'></span><span id='topic+stab.CausalANOVA'></span><span id='topic+ScreenINT'></span><span id='topic+glinternet.cv'></span><span id='topic+indTwo2Three'></span><span id='topic+NoRegularization'></span><span id='topic+Collapsing'></span><span id='topic+FullVCOV'></span><span id='topic+cluster_se_glm'></span><span id='topic+makeallway'></span><span id='topic+maketwoway'></span>

<h3>Description</h3>


<table>
<tr>
 <td style="text-align: left;"> Package: </td><td style="text-align: left;"> factorEx</td>
</tr>
<tr>
 <td style="text-align: left;"> Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;"> Version: </td><td style="text-align: left;"> 1.1.5</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2019-11-19</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Naoki Egami, Marc Ratkovic and Kosuke Imai.
</p>
<p>Maintainer: Naoki Egami <a href="mailto:negami@princeton.edu">negami@princeton.edu</a>
</p>


<h3>References</h3>

<p>Imai, Kosuke and Marc Ratkovic. 2013.  &ldquo;Estimating Treatment
Effect Heterogeneity in Randomized Program Evaluation.&rdquo; Annals of Applied
Statistics, Vol.7, No.1(March), pp. 443-470.
<a href="http://imai.fas.harvard.edu/research/files/svm.pdf">http://imai.fas.harvard.edu/research/files/svm.pdf</a>
</p>
<p>Egami, Naoki and Kosuke Imai. 2019. Causal Interaction in Factorial Experiments: Application to Conjoint Analysis. Journal of the American Statistical Association, 
Vol.114, No.526 (June), pp. 529–540. <a href="http://imai.fas.harvard.edu/research/files/int.pdf">http://imai.fas.harvard.edu/research/files/int.pdf</a>
</p>

<hr>
<h2 id='GerberGreen'>Data from the 1998 New Haven Get-Out-the-Vote Experiment</h2><span id='topic+GerberGreen'></span>

<h3>Description</h3>

<p>This data set contains the most recent corrected data from the field
experiment analyzed in Gerber and Green (2000).
</p>


<h3>Format</h3>

<p>A data frame consisting of 9 columns and 29,380 observations.
</p>

<table>
<tr>
 <td style="text-align: left;"> voted98 </td><td style="text-align: left;"> integer </td><td style="text-align: left;"> voted in 1998 </td><td style="text-align: left;"> 0,1 </td>
</tr>
<tr>
 <td style="text-align: left;">
persngrp </td><td style="text-align: left;"> factor </td><td style="text-align: left;"> personal contact attempted </td><td style="text-align: left;"> 0,1 </td>
</tr>
<tr>
 <td style="text-align: left;"> phnscrpt
</td><td style="text-align: left;"> factor </td><td style="text-align: left;"> script read to phone respondents </td><td style="text-align: left;"> 7 levels </td>
</tr>
<tr>
 <td style="text-align: left;"> mailings
</td><td style="text-align: left;"> factor </td><td style="text-align: left;"> number of mailings sent </td><td style="text-align: left;"> 0 - 3 </td>
</tr>
<tr>
 <td style="text-align: left;"> appeal </td><td style="text-align: left;"> factor
</td><td style="text-align: left;"> content of message </td><td style="text-align: left;"> 3 levels </td>
</tr>
<tr>
 <td style="text-align: left;"> age </td><td style="text-align: left;"> integer </td><td style="text-align: left;"> age of
respondent </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;"> majorpty </td><td style="text-align: left;"> factor </td><td style="text-align: left;"> Democratic or Republican </td><td style="text-align: left;">
</td>
</tr>
<tr>
 <td style="text-align: left;"> voted96.1 </td><td style="text-align: left;"> factor </td><td style="text-align: left;"> voted in 1996 </td><td style="text-align: left;"> 0,1 </td>
</tr>
<tr>
 <td style="text-align: left;"> voted96.0 </td><td style="text-align: left;">
factor </td><td style="text-align: left;"> abstained in 1996 </td><td style="text-align: left;"> 0,1 </td>
</tr>
<tr>
 <td style="text-align: left;"> </td>
</tr>

</table>

<p>Note: The levels of phnscrpt and appeal are follows.
</p>
<p>phnscrpt: Script read to phone respondents </p>

<table>
<tr>
 <td style="text-align: left;"> 0 </td><td style="text-align: left;"> No phone </td>
</tr>
<tr>
 <td style="text-align: left;">
1 </td><td style="text-align: left;"> Civic-Blood </td>
</tr>
<tr>
 <td style="text-align: left;"> 2 </td><td style="text-align: left;"> Civic </td>
</tr>
<tr>
 <td style="text-align: left;"> 3 </td><td style="text-align: left;"> Civic or Blood-Civic </td>
</tr>
<tr>
 <td style="text-align: left;"> 4
</td><td style="text-align: left;"> Neighbor </td>
</tr>
<tr>
 <td style="text-align: left;"> 5 </td><td style="text-align: left;"> Neighbor or Civic-Neighbor </td>
</tr>
<tr>
 <td style="text-align: left;"> 6 </td><td style="text-align: left;"> Close </td>
</tr>

</table>

<p>appeal: Content of message </p>

<table>
<tr>
 <td style="text-align: left;"> 1 </td><td style="text-align: left;"> Civic Duty </td>
</tr>
<tr>
 <td style="text-align: left;"> 2 </td><td style="text-align: left;">
Neighborhood Solidarity </td>
</tr>
<tr>
 <td style="text-align: left;"> 3 </td><td style="text-align: left;"> Close Election </td>
</tr>

</table>


<h3>References</h3>

<p>Gerber, A. S. and Green, D. P. 2000 . &ldquo;The effects of
canvassing, telephone calls, and direct mail on voter turnout: A field
experiment.&rdquo; American Political Science Review, Vol.94, No.3, pp. 653-663.
</p>
<p>Imai, K. 2005 . &ldquo;Do get-out-the-vote calls reduce turnout?: The importance
of statistical methods for field experiments.&quot;&quot; American Political Science
Review, Vol.99, No.2, pp. 283-300.
</p>

<hr>
<h2 id='LaLonde'>National Supported Work Study Experimental Data</h2><span id='topic+LaLonde'></span>

<h3>Description</h3>

<p>This data set gives the outcomes a well as treatment assignments and
covariates for the National Supported Work Study, as analyzed in LaLonde
(1986).
</p>


<h3>Format</h3>

<p>A data frame consisting of 12 columns (including a treatment
assignment vector) and 2787 observations.
</p>

<table>
<tr>
 <td style="text-align: left;"> outcome </td><td style="text-align: left;"> integer </td><td style="text-align: left;"> whether earnings in 1978 are
larger than in 1975 </td><td style="text-align: left;"> 0,1 </td>
</tr>
<tr>
 <td style="text-align: left;"> treat </td><td style="text-align: left;"> integer </td><td style="text-align: left;"> whether the
individual received the treatment </td><td style="text-align: left;"> 0,1 </td>
</tr>
<tr>
 <td style="text-align: left;"> age </td><td style="text-align: left;"> numeric </td><td style="text-align: left;"> age in
years </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;"> educ </td><td style="text-align: left;"> numeric </td><td style="text-align: left;"> education in years </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;"> black </td><td style="text-align: left;">
factor </td><td style="text-align: left;"> black or not </td><td style="text-align: left;"> 0,1 </td>
</tr>
<tr>
 <td style="text-align: left;"> hisp </td><td style="text-align: left;"> factor </td><td style="text-align: left;"> hispanic or not
</td><td style="text-align: left;"> 0,1 </td>
</tr>
<tr>
 <td style="text-align: left;"> white </td><td style="text-align: left;"> factor </td><td style="text-align: left;"> white or not </td><td style="text-align: left;"> 0,1 </td>
</tr>
<tr>
 <td style="text-align: left;"> marr </td><td style="text-align: left;">
factor </td><td style="text-align: left;"> married or not </td><td style="text-align: left;"> 0,1 </td>
</tr>
<tr>
 <td style="text-align: left;"> nodegr </td><td style="text-align: left;"> factor </td><td style="text-align: left;"> an indicator
for no high school degree </td><td style="text-align: left;"> 0,1 </td>
</tr>
<tr>
 <td style="text-align: left;"> log.re75 </td><td style="text-align: left;"> numeric </td><td style="text-align: left;"> log of
earnings in 1975 </td><td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;"> u75 </td><td style="text-align: left;"> factor </td><td style="text-align: left;"> unemployed in 1975 </td><td style="text-align: left;"> 0,1
</td>
</tr>
<tr>
 <td style="text-align: left;"> wts.extrap </td><td style="text-align: left;"> numeric </td><td style="text-align: left;"> extrapolation weights to the 1978 Panel
Study for Income Dynamics dataset </td><td style="text-align: left;"> </td>
</tr>

</table>


<h3>Source</h3>

<p>Data from the National Supported Work Study.  A benchmark matching
dataset. 1975 earnings are pre-treatment.
</p>


<h3>References</h3>

<p>LaLonde, R.J. 1986. &ldquo;Evaluating the econometric evaulations of
training programs with experimental data.&quot;&quot; American Economic Review,
Vol.76, No.4, pp. 604-620.
</p>

<hr>
<h2 id='plot.CausalANOVA'>Plotting CausalANOVA</h2><span id='topic+plot.CausalANOVA'></span>

<h3>Description</h3>

<p>Plotting CausalANOVA
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'CausalANOVA'
plot(
  x,
  fac.name,
  treat.ind = 1,
  type = "ConditionalEffect",
  space = 15,
  xlim,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.CausalANOVA_+3A_x">x</code></td>
<td>
<p>An output from <code>CausalANOVA</code></p>
</td></tr>
<tr><td><code id="plot.CausalANOVA_+3A_fac.name">fac.name</code></td>
<td>
<p>Factor names to plot. Length should be 2.</p>
</td></tr>
<tr><td><code id="plot.CausalANOVA_+3A_treat.ind">treat.ind</code></td>
<td>
<p>Which factor serves as the main treatment. Should be 1 (the first element of <code>fac.name</code>) or 2 (the second element of <code>fac.name</code>).</p>
</td></tr>
<tr><td><code id="plot.CausalANOVA_+3A_type">type</code></td>
<td>
<p>What types of effects to plot. Should be one of <code>AME</code>, <code>AMIE</code> and <code>ConditionalEffect</code>.</p>
</td></tr>
<tr><td><code id="plot.CausalANOVA_+3A_space">space</code></td>
<td>
<p>Space on the left side of the plot.</p>
</td></tr>
<tr><td><code id="plot.CausalANOVA_+3A_xlim">xlim</code></td>
<td>
<p>Range for the x-axis</p>
</td></tr>
<tr><td><code id="plot.CausalANOVA_+3A_...">...</code></td>
<td>
<p>Other graphical parameters</p>
</td></tr>
</table>

<hr>
<h2 id='plot.PredictFindIt'>Plot estimated treatment effects or predicted outcomes for each treatment
combination.</h2><span id='topic+plot.PredictFindIt'></span>

<h3>Description</h3>

<p>Plot estimated treatment effects when <code>treat.type="single"</code> and
predicted outcomes for each treatment combination when
<code>treat.type="multiple"</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'PredictFindIt'
plot(x, main, xlab, ylab, interactive = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.PredictFindIt_+3A_x">x</code></td>
<td>
<p>output from <code>predict.FindIt</code>.</p>
</td></tr>
<tr><td><code id="plot.PredictFindIt_+3A_main">main</code></td>
<td>
<p>the argument specifying the main title of the plot.</p>
</td></tr>
<tr><td><code id="plot.PredictFindIt_+3A_xlab">xlab</code></td>
<td>
<p>the argument specifying the name of x axis.</p>
</td></tr>
<tr><td><code id="plot.PredictFindIt_+3A_ylab">ylab</code></td>
<td>
<p>the argument specifying the name of y axis.</p>
</td></tr>
<tr><td><code id="plot.PredictFindIt_+3A_interactive">interactive</code></td>
<td>
<p>whether to make a plot interactive; default is FALSE.</p>
</td></tr>
<tr><td><code id="plot.PredictFindIt_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Plot estimated treatment effects when <code>treat.type="single"</code> and
predicted outcomes for each treatment combination when
<code>treat.type="multiple"</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>plot</code></td>
<td>
<p>Plot estimated treatment effects when
<code>treat.type="single"</code> and predicted outcomes for each treatment
combination when <code>treat.type="multiple"</code>.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Naoki Egami, Marc Ratkovic and Kosuke Imai.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## See the help page for FindIt() for an example.
	
</code></pre>

<hr>
<h2 id='predict.FindIt'>Computing predicted values for each sample in the data.</h2><span id='topic+predict.FindIt'></span>

<h3>Description</h3>

<p><code>predict.FindIt</code> takes an output from <code>FindIt</code> and returns
estimated treatment effects when <code>treat.type="single"</code> and predicted
outcomes for each treatment combination when <code>treat.type="multiple"</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'FindIt'
predict(
  object,
  newdata,
  sort = TRUE,
  decreasing = TRUE,
  wts = 1,
  unique = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict.FindIt_+3A_object">object</code></td>
<td>
<p>An output object from <code>FindIt</code>.</p>
</td></tr>
<tr><td><code id="predict.FindIt_+3A_newdata">newdata</code></td>
<td>
<p>An optional data frame in which to look for variables with
which to predict. If omitted, the data used in <code>FindIt</code> is used.</p>
</td></tr>
<tr><td><code id="predict.FindIt_+3A_sort">sort</code></td>
<td>
<p>Whether to sort samples according to estimated treatment
effects.</p>
</td></tr>
<tr><td><code id="predict.FindIt_+3A_decreasing">decreasing</code></td>
<td>
<p>When <code>sort=TRUE</code>, whether to sort the output in
descending order or not.</p>
</td></tr>
<tr><td><code id="predict.FindIt_+3A_wts">wts</code></td>
<td>
<p>Weights.</p>
</td></tr>
<tr><td><code id="predict.FindIt_+3A_unique">unique</code></td>
<td>
<p>If <code>unique=TRUE</code>, <code>predict</code> returns estimated
treatment effects or predicted outcomes for unique samples.</p>
</td></tr>
<tr><td><code id="predict.FindIt_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Useful for computing estimated treatment effects or predicted outcomes for
each treatment combination. By using <code>newdata</code>, researchers can compute
them for any samples.
</p>


<h3>Value</h3>

<table>
<tr><td><code>data</code></td>
<td>
<p>A matrix of estimated treatment effects when
<code>treat.type="single"</code> and predicted outcomes for each treatment
combination when <code>treat.type="multiple"</code>.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Naoki Egami, Marc Ratkovic and Kosuke Imai.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## See the help page for FindIt() for an example.
	
</code></pre>

<hr>
<h2 id='summary.CausalANOVA'>Summarizing CausalANOVA output</h2><span id='topic+summary.CausalANOVA'></span>

<h3>Description</h3>

<p>Summarizing CausalANOVA output
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'CausalANOVA'
summary(object, digit = 4, verbose = TRUE, verbose.full = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.CausalANOVA_+3A_object">object</code></td>
<td>
<p>An object from <code>CausalANOVA</code></p>
</td></tr>
<tr><td><code id="summary.CausalANOVA_+3A_digit">digit</code></td>
<td>
<p>the number of digits</p>
</td></tr>
<tr><td><code id="summary.CausalANOVA_+3A_verbose">verbose</code></td>
<td>
<p>report additional summary results</p>
</td></tr>
<tr><td><code id="summary.CausalANOVA_+3A_verbose.full">verbose.full</code></td>
<td>
<p>report full summary results</p>
</td></tr>
<tr><td><code id="summary.CausalANOVA_+3A_...">...</code></td>
<td>
<p>Other parameters</p>
</td></tr>
</table>

<hr>
<h2 id='summary.FindIt'>Summarizing FindIt output</h2><span id='topic+summary.FindIt'></span>

<h3>Description</h3>

<p>Summarizing FindIt output
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'FindIt'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.FindIt_+3A_object">object</code></td>
<td>
<p>An object from <code>FindIt</code></p>
</td></tr>
<tr><td><code id="summary.FindIt_+3A_...">...</code></td>
<td>
<p>Other parameters</p>
</td></tr>
</table>

<hr>
<h2 id='test.CausalANOVA'>Estimating the AMEs and AMIEs after Regularization with the CausalANOVA.</h2><span id='topic+test.CausalANOVA'></span>

<h3>Description</h3>

<p><code>test.CausalANOVA</code> estimates the AMEs and AMIEs with confidence
intervals after regularization with <code>CausalANOVA</code>function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>test.CausalANOVA(
  fit,
  newdata,
  collapse.level = TRUE,
  diff = FALSE,
  pair.id = NULL,
  cluster = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="test.CausalANOVA_+3A_fit">fit</code></td>
<td>
<p>The output from <code>CausalANOAV</code> function.</p>
</td></tr>
<tr><td><code id="test.CausalANOVA_+3A_newdata">newdata</code></td>
<td>
<p>A data frame to use for re-estimating the AMEs and AMIEs with
confidence intervals.</p>
</td></tr>
<tr><td><code id="test.CausalANOVA_+3A_collapse.level">collapse.level</code></td>
<td>
<p>A logical indicating whether to collapse insignificant
levels within factors as suggested by the <code>CausalANOVA</code> output users
provide.</p>
</td></tr>
<tr><td><code id="test.CausalANOVA_+3A_diff">diff</code></td>
<td>
<p>A logical indicating whether the outcome is the choice between a
pair. If <code>diff=TRUE</code>, <code>pair.id</code> should specify a pair of
comparison. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="test.CausalANOVA_+3A_pair.id">pair.id</code></td>
<td>
<p>(optional).Unique identifiers for each pair of comparison.
This option is used when <code>diff=TRUE</code>.</p>
</td></tr>
<tr><td><code id="test.CausalANOVA_+3A_cluster">cluster</code></td>
<td>
<p>Unique identifies with which cluster standard errors are
computed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See Details in <code>CausalANOVA</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>fit</code></td>
<td>
<p>The output of class <code>CausalANOVA</code>.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Naoki Egami and Kosuke Imai.
</p>


<h3>References</h3>

<p>Egami, Naoki and Kosuke Imai. 2019. Causal Interaction in
Factorial Experiments: Application to Conjoint Analysis, Journal of the American Statistical Association.
<a href="http://imai.fas.harvard.edu/research/files/int.pdf">http://imai.fas.harvard.edu/research/files/int.pdf</a>
</p>
<p>Lim, M. and Hastie, T. 2015. Learning interactions via hierarchical
group-lasso regularization. Journal of Computational and Graphical
Statistics 24, 3, 627&ndash;654.
</p>
<p>Post, J. B. and Bondell, H. D. 2013. &ldquo;Factor selection and structural
identification in the interaction anova model.&rdquo; Biometrics 69, 1, 70&ndash;79.
</p>


<h3>See Also</h3>

<p><a href="#topic+CausalANOVA">CausalANOVA</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## ####################################### 
## With Screening and Collapsing
## #######################################
data(Carlson)
## Specify the order of each factor
Carlson$newRecordF&lt;- factor(Carlson$newRecordF,ordered=TRUE,
                            levels=c("YesLC", "YesDis","YesMP",
                                     "noLC","noDis","noMP","noBusi"))
Carlson$promise &lt;- factor(Carlson$promise,ordered=TRUE,levels=c("jobs","clinic","education"))
Carlson$coeth_voting &lt;- factor(Carlson$coeth_voting,ordered=FALSE,levels=c("0","1"))
Carlson$relevantdegree &lt;- factor(Carlson$relevantdegree,ordered=FALSE,levels=c("0","1"))

## Sample Splitting
train.ind &lt;- sample(unique(Carlson$respcodeS), 272, replace=FALSE)
test.ind &lt;- setdiff(unique(Carlson$respcodeS), train.ind)
Carlson.train &lt;- Carlson[is.element(Carlson$respcodeS,train.ind), ]
Carlson.test &lt;- Carlson[is.element(Carlson$respcodeS,test.ind), ]
 
#################### AMEs and two-way AMIEs ####################
fit.r2 &lt;- CausalANOVA(formula=won ~ newRecordF + promise + coeth_voting + relevantdegree,
                      data=Carlson.train, pair.id=Carlson.train$contestresp,diff=TRUE,
                      screen=TRUE, collapse=TRUE,
                      cluster=Carlson.train$respcodeS, nway=2)
summary(fit.r2)

## refit with test.CausalANOVA
fit.r2.new &lt;- test.CausalANOVA(fit.r2, newdata=Carlson.test, diff=TRUE,
                               pair.id=Carlson.test$contestresp, cluster=Carlson.test$respcodeS)

summary(fit.r2.new)
plot(fit.r2.new)
plot(fit.r2.new, type="ConditionalEffect", fac.name=c("newRecordF","coeth_voting"))
ConditionalEffect(fit.r2.new, treat.fac="newRecordF", cond.fac="coeth_voting")
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
