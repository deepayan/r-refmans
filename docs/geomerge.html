<!DOCTYPE html><html><head><title>Help for package geomerge</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {geomerge}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#ACLED'><p>Point dataset to illustrate the functionality of geomerge</p></a></li>
<li><a href='#AidData'><p>Point dataset to illustrate the functionality of geomerge</p></a></li>
<li><a href='#generateGrid'>
<p>Generates a grid in a given local CRS that is, by default, returned as SpatialPolygonsDataFrame in WGS84.</p></a></li>
<li><a href='#geoEPR'><p>Polygon dataset to illustrate the functionality of geomerge</p></a></li>
<li><a href='#geomerge'>
<p>Geospatial Data Integration</p></a></li>
<li><a href='#geomerge-package'>
<p>geomerge: Geospatial Data Integration</p></a></li>
<li><a href='#geomerge.assign'>
<p>Implements different assignment rules using SQL [Auxiliary Function]</p></a></li>
<li><a href='#geomerge.merge'>
<p>Performing dataset merger [Auxiliary Function]</p></a></li>
<li><a href='#geomerge.neighbor'>
<p>Returns first and second order spatial neighbors [Auxiliary Function]</p></a></li>
<li><a href='#gpw'><p>Raster dataset to illustrate the functionality of geomerge</p></a></li>
<li><a href='#plot.geomerge'>
<p>Plot function for objects of class 'geomerge'.</p></a></li>
<li><a href='#print.geomerge'>
<p>Print function for objects of class 'geomerge'.</p></a></li>
<li><a href='#states'><p>Polygon dataset to illustrate the functionality of geomerge</p></a></li>
<li><a href='#summary.geomerge'>
<p>Summary function for objects of class 'geomerge'.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Geospatial Data Integration</td>
</tr>
<tr>
<td>Version:</td>
<td>0.3.4</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-10-17</td>
</tr>
<tr>
<td>Author:</td>
<td>Karsten Donnay and Andrew M. Linke</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Karsten Donnay &lt;kdonnay@gmx.net&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Geospatial data integration framework that merges raster, spatial polygon, and (dynamic) spatial points data into a spatial (panel) data frame at any geographical resolution.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/LGPL-3">LGPL-3</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.21)</td>
</tr>
<tr>
<td>Imports:</td>
<td>sp, spdep, raster, terra, sf, geosphere, lubridate, methods,
stats, ggplot2, gridExtra, scales</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-10-19 16:23:24 UTC; donnay</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-10-20 12:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='ACLED'>Point dataset to illustrate the functionality of geomerge</h2><span id='topic+ACLED'></span>

<h3>Description</h3>

<p><em>ACLED</em> conflict events for Nigeria in 2011 used as example for a <code>SpatialPointsDataFrame</code> available from http://www.acleddata.com/data. The dataset contains timestamped and geo-coded information on individual conflict events.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(geomerge)</code></pre>


<h3>Format</h3>

<p>A <code>SpatialPointsDataFrame</code> containing observations.</p>


<h3>Details</h3>

<p>The original <em>ACLED</em> &quot;EVENT_DATE&quot; column has been relabeled as &quot;timestamp&quot; in accordance with <code>geomerge</code> conventions.
</p>


<h3>Author(s)</h3>

<p>Karsten Donnay and Andrew M. Linke
</p>


<h3>Source</h3>

<p>http://www.acleddata.com/data
</p>
<p>Citation:
Clionadh Raleigh, Andrew Linke, Havard Hegre and Joakim Karlsen. (2010). &quot;Introducing ACLED-Armed Conflict Location and Event Data.&quot; <em>Journal of Peace Research</em> 47(5): 651-660.
</p>


<h3>References</h3>

<p>Andrew M. Linke, Karsten Donnay. (2017). &quot;Scale Variability Misclassification: The Impact of Spatial Resolution on Effect Estimates in the Geographic Analysis of Foreign Aid and Conflict.&quot; Paper presented at the <em>International Studies Association Annual Meeting</em>, February 22-25 2017, Baltimore.
</p>

<hr>
<h2 id='AidData'>Point dataset to illustrate the functionality of geomerge</h2><span id='topic+AidData'></span>

<h3>Description</h3>

<p><em>AidData</em> aid project locations for projects in Nigeria with start date in 2011 used as example for a <code>SpatialPointsDataFrame</code>. The dataset is available from http://aiddata.org. The dataset contains timestamped and geo-coded information on individual aid projects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(geomerge)</code></pre>


<h3>Format</h3>

<p>A <code>SpatialPointsDataFrame</code> containing observations.</p>


<h3>Details</h3>

<p>The original <em>AidData</em> &quot;start_date&quot; column has been relabeled as &quot;timestamp&quot; in accordance with <code>geomerge</code> conventions.
</p>


<h3>Author(s)</h3>

<p>Karsten Donnay and Andrew M. Linke
</p>


<h3>Source</h3>

<p>http://aiddata.org
</p>
<p>Citation:
AidData. 2016. NigeriaAIMS_GeocodedResearchRelease_Level1_v1.3.1 geocoded dataset. Williamsburg, VA and Washington, DC: AidData. Accessed on August 23, 2017. http://aiddata.org/research-datasets.
</p>


<h3>References</h3>

<p>Andrew M. Linke, Karsten Donnay. (2017). &quot;Scale Variability Misclassification: The Impact of Spatial Resolution on Effect Estimates in the Geographic Analysis of Foreign Aid and Conflict.&quot; Paper presented at the <em>International Studies Association Annual Meeting</em>, February 22-25 2017, Baltimore.
</p>

<hr>
<h2 id='generateGrid'>
Generates a grid in a given local CRS that is, by default, returned as SpatialPolygonsDataFrame in WGS84.
</h2><span id='topic+generateGrid'></span>

<h3>Description</h3>

<p>Implementation of a simple grid generation function producing a <code>SpatialPolygonsDataFrame</code> to be used as <code>target</code> in <code>geomerge</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>generateGrid(extent, size, local.crs, makeWGS84 = TRUE, silent = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="generateGrid_+3A_extent">extent</code></td>
<td>

<p><code>SpatialPolygonsDataFrame</code> that defines the (minimum) extent of the grid to be generated.
</p>
</td></tr>
<tr><td><code id="generateGrid_+3A_size">size</code></td>
<td>

<p>size of the grid cells in m.
</p>
</td></tr>
<tr><td><code id="generateGrid_+3A_local.crs">local.crs</code></td>
<td>

<p>definition of the local (projected) CRS the grid is spanned in. Has to be class <kbd>"CRS"</kbd> (from <span class="pkg">sp</span>).
</p>
</td></tr>
<tr><td><code id="generateGrid_+3A_makewgs84">makeWGS84</code></td>
<td>

<p>Boolean switch indicating whether or not the grid is returned in WGS84. Default = <kbd>TRUE</kbd>.
</p>
</td></tr>
<tr><td><code id="generateGrid_+3A_silent">silent</code></td>
<td>

<p>Boolean switch to suppress any (non-critical) warnings and messages. Default = <kbd>FALSE</kbd>.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns an object of <code>SpatialPolygonsDataFrame</code> that spans the grid with spatial resolution given by <kbd>size</kbd>.
</p>


<h3>Author(s)</h3>

<p>Karsten Donnay and Andrew M. Linke.
</p>


<h3>References</h3>

<p>Andrew M. Linke, Karsten Donnay. (2017). &quot;Scale Variability Misclassification: The Impact of Spatial Resolution on Effect Estimates in the Geographic Analysis of Foreign Aid and Conflict.&quot; Paper presented at the <em>International Studies Association Annual Meeting</em>, February 22-25 2017, Baltimore.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+geomerge-package">geomerge-package</a></code>, <code><a href="#topic+geomerge">geomerge</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>require(sp)
data(geomerge)

# Generate grid with 10 km cell size in local CRS for Nigeria
states.grid &lt;- generateGrid(states,10000,local.crs=CRS("epsg:26391"),silent=TRUE)
</code></pre>

<hr>
<h2 id='geoEPR'>Polygon dataset to illustrate the functionality of geomerge</h2><span id='topic+geoEPR'></span>

<h3>Description</h3>

<p><em>geoEPR</em> Nigeria dataset used as example for a <code>SpatialPolygonsDataFrame</code> can be accessed and downloaded at https://icr.ethz.ch/data/epr/geoepr/. The dataset contains geo-locations for all politically relevant ethnic groups from the EPR-Core 2014 dataset. It assigns every politically relevant group one of six settlement patterns and provides polygons describing their location.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(geomerge)</code></pre>


<h3>Format</h3>

<p>A <code>SpatialPolygonsDataFrame</code> containing observations.</p>


<h3>Author(s)</h3>

<p>Karsten Donnay and Andrew M. Linke
</p>


<h3>Source</h3>

<p>https://icr.ethz.ch/data/epr/geoepr/
</p>
<p>Citation:
Julian Wucherpfennig, Nils B. Weidmann, Luc Girardin, Lars-Erik Cederman, and Andreas Wimmer. (2011). &quot;Politically Relevant Ethnic Groups Across Space and Time: Introducing the GeoEPR Dataset.&quot; <em>Conflict Management and Peace Science</em> 28(5): 423-437.</p>


<h3>References</h3>

<p>Andrew M. Linke, Karsten Donnay. (2017). &quot;Scale Variability Misclassification: The Impact of Spatial Resolution on Effect Estimates in the Geographic Analysis of Foreign Aid and Conflict.&quot; Paper presented at the <em>International Studies Association Annual Meeting</em>, February 22-25 2017, Baltimore.
</p>

<hr>
<h2 id='geomerge'>
Geospatial Data Integration
</h2><span id='topic+geomerge'></span>

<h3>Description</h3>

<p>This function conducts a series of spatial joins for Geographic Information Systems (GIS) data. It integrates three of R's most commonly used GIS data classes - polygons, points and rasters. With flexible options for assignment rules and including the calculation of spatial and temporal lags, <code>geomerge</code> returns a spatial (panel) dataset in the form of a <code>SpatialPolygonsDataFrame</code> that users may import into any predictive statistical analysis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>geomerge(...,target=NULL,time=NA,time.lag=TRUE,spat.lag=TRUE,
             zonal.fun=sum, assignment="max(area)",population.data = NA,
             point.agg = "cnt",t_unit="days",silent=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="geomerge_+3A_...">...</code></td>
<td>

<p>input datasets and, if provided, optional arguments. See Details.  
</p>
</td></tr>
<tr><td><code id="geomerge_+3A_target">target</code></td>
<td>

<p><code>SpatialPolygonsDataFrame</code> representing desired units of analysis. See Details. 
</p>
</td></tr>
<tr><td><code id="geomerge_+3A_time">time</code></td>
<td>

<p>temporal window for dynamic temporal binning of point data. Required format is <code>c(start_date, end_date, interval_length)</code>, each specified as String. Default = <kbd>NA</kbd>. See Details.
</p>
</td></tr>
<tr><td><code id="geomerge_+3A_time.lag">time.lag</code></td>
<td>

<p>Boolean indicating whether or not first and second order temporal lag values of all variables are returned. Only affects dynamic point data integration. Default = <kbd>TRUE</kbd>.
</p>
</td></tr>
<tr><td><code id="geomerge_+3A_spat.lag">spat.lag</code></td>
<td>

<p>Boolean indicating whether or not first and second order spatial lag values of all variables are returned. Default = <kbd>TRUE</kbd>.
</p>
</td></tr>
<tr><td><code id="geomerge_+3A_zonal.fun">zonal.fun</code></td>
<td>

<p>object of class <kbd>function</kbd> applied to values of <code>RasterLayer</code> when generating zonal statistics for each target polygon. Default = <kbd>sum</kbd>. See Details.
</p>
</td></tr>
<tr><td><code id="geomerge_+3A_assignment">assignment</code></td>
<td>

<p>identification of either population- or area-weighting assignment rules when handling <code>SpatialPolygonsDataFrame</code> joins to <code>target</code>. Default = <kbd>"max(area)"</kbd>. See Details.
</p>
</td></tr>
<tr><td><code id="geomerge_+3A_population.data">population.data</code></td>
<td>

<p>specifies data used for weighting if a population-based <code>assignment</code> rule is selected. See Details.
</p>
</td></tr>
<tr><td><code id="geomerge_+3A_point.agg">point.agg</code></td>
<td>

<p>specification of aggregation format for data of type <code>SpatialPointsDataFrame</code>. Default = <kbd>"cnt"</kbd>. See Details.
</p>
</td></tr>
<tr><td><code id="geomerge_+3A_t_unit">t_unit</code></td>
<td>

<p>temporal unit used for dynamic point aggregation. Default = <kbd>"days"</kbd>.
</p>
</td></tr>
<tr><td><code id="geomerge_+3A_silent">silent</code></td>
<td>

<p>Boolean switch to suppress any (non-critical) warnings and messages. Default = <kbd>FALSE</kbd>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>geomerge</code> accepts any number of data inputs of the most common spatial data classes in R - <code>SpatialPolygonsDataFrame</code>, <code>SpatialPointsDataFrame</code>, and <code>RasterLayer</code>. The <code>target</code> they are merged to may be of any shape but must be a <code>SpatialPolygonsDataFrame</code>. The extent of each data input should at least match the extent of the <code>target</code>; if not, the package returns a warning. In order to perform accurate area calculations at any scale, <code>geomerge</code> projects any data geometry into WGS84. Input data (including <code>target</code>) not in WGS84 are automatically re-projected.
</p>
<p><code>geomerge</code> assumes that all inputs of type <code>SpatialPolygonsDataFrame</code> and <code>RasterLayer</code> are static and contemporary. If polygons or raster are changing, we advise to simply rerun <code>geomerge</code> for each interval in which data are static and contemporary. The package allows for dynamic integration of all inputs that are a <code>SpatialPointsDataFrame</code>, i.e., one can, for example, automatically generate the counts of events that occur within a specific unit of <code>target</code> within a specific time period. Further details are given below.
</p>
<p>If <code>SpatialPolygonsDataFrame</code> data are joined to <code>target</code>, they must contain only one column with the data of interest. The package also accepts the short-hand variable specification using the standard &quot;$&quot; notation to denote the selection of a specific variable from the <code>SpatialPolygonsDataFrame</code>. <code>RasterLayer</code> are by default single-valued. These data may be of class <kbd>factor</kbd> or <kbd>numeric</kbd>.
</p>
<p>If <code>SpatialPointsDataFrame</code> are joined to <code>target</code> they must have one column coding the variable of interest and, if points carry timestamps, dates must be given in a second column <kbd>timestamp</kbd> and formatted as a UTC date string with format <kbd>"YYYY-MM-DD"</kbd> or <kbd>"YYYY-MM-DD hh:mm:ss"</kbd>.
</p>
<p>In practice, our input logic implies that if more than one variable of interest are to be merged to <code>target</code>, statically or dynamically, each has to be separately entered as argument. Note that variable names in <code>target</code> derive from the name of the input data and it is therefore advised to use meaningful labels for input data.
</p>
<p>In merging <code>SpatialPolygonsDataFrame</code> values to units of analysis given by <code>target</code>, users have a choice among a number of different <code>assignment</code> rules based on area overlap and population size. Area-based assignment generally can take the values <kbd>"max(area)"</kbd> or <kbd>"min(area)"</kbd>, i.e., the value assigned to a given unit in <code>target</code> comes from that polygon in the <code>SpatialPolygonsDataFrame</code> with maximal or minimal area overlap respectively. If the value of interest is of class <kbd>numeric</kbd>, the user may also choose <kbd>"weighted(area)"</kbd>, i.e., the values is assigned as the area-weighted average of the values in all polygons intersecting a given unit in <code>target</code>.
</p>
<p>The assignment rules <kbd>"max(pop)"</kbd>, <kbd>"min(pop)"</kbd> and <kbd>"weighted(pop)"</kbd> (the latter again for <kbd>numeric</kbd> variables only) analogously use the population value given by <code>population.data</code> in overlapping areas as basis for assignment. If any of them is selected in the <code>assignment</code> argument, users must provide <code>population.data</code> as a <code>RasterLayer</code>. The geographical resolution of <code>population.data</code> should be the same or better than that of <code>target</code>. The zonal statistic used for population within overlapping polygons is <code>sum</code>.
</p>
<p>When a <code>SpatialPointsDataFrame</code> is merged to <code>target</code>, one of two operations can be performed. For <code>point.agg = "cnt"</code> the function calculates the sum of the number of locations that fall within each unit of <code>target</code>. For numerical variables of interest, <code>point.agg = "sum"</code> returns  the sum across for all values associated with points within each unit of <code>target</code>. If different aggregation formats are to be applied to different <code>SpatialPointsDataFrame</code> inputs, these have to be specified as a character vector, i.e., <code>point.agg = c("sum", "cnt")</code>, in the order of inputs.
</p>
<p>Values for inputs of type <code>SpatialPointsDataFrame</code> are either calculated statically across the entire frame if <code>time = NA</code> or dynamically within a given time period that can be specified using <code>time = c(start_date, end_date, interval_length)</code>. All three inputs must be Strings where <code>interval_length</code> is defined in multiples of <code>t_unit</code>. The default value is <code>t_unit = "days"</code>, the package also accepts inputs of <kbd>"secs"</kbd>, <kbd>"mins"</kbd>, <kbd>"hours"</kbd>, <kbd>"months"</kbd> or <kbd>"years"</kbd>.
</p>
<p>Zonal statistics are applied to objects of class <code>RasterLayer</code> that are joined to <code>target</code>. The specific operations are defined in the function call using the argument <code>zonal.fun</code> and each is added into the result. Any zonal statistics compatible with the <code>extract</code> function in <span class="pkg">terra</span> is accepted. Note that <code>geomerge</code> does not accept raster stacks. If you have raster stacks they must be separated and the layers integrated separately into the function. 
</p>
<p>If <code>spat.lag = TRUE</code> spatial lags of all <kbd>numeric</kbd> variables from a <code>SpatialPolygonsDataFrame</code> or <code>RasterLayer</code> joined to <code>target</code> polygons are returned using first and also second order neighboring weights matrices. The package assigns <code>target</code> polygons the mean value of units within each neighborhood. When dynamic point aggregation is run and <code>time.lag = TRUE</code>, <code>geomerge</code> returns the values of every target polygon, as well as its first and second order neighboring unit averages, separately, at time t-1 and t-2 defined by <code>interval</code> in the argument <code>time</code>.
</p>


<h3>Value</h3>

<p>Returns an object of class <kbd>"geomerge"</kbd>.
</p>
<p>The functions <code>summary</code>, <code>print</code>, <code>plot</code> overload the standard outputs for objects of type <code>geomerge</code> providing summary information and and visualizations specific to the output object. An object of class <kbd>"geomerge"</kbd> is a list containing the following three components:
</p>
<table>
<tr><td><code>data</code></td>
<td>
<p><code>SpatialPolygonsDataFrame</code> that contains all information merged with the <code>target</code> layer. Column names are assigned the name of the input data object separated by &quot;.&quot; from a short description of the calculation, as well as modifiers such as &quot;.1st&quot; and &quot;.2nd&quot; for first- and second-order neighborhoods of <code>target</code>. In the case of dynamic point data aggregation, &quot;.t_1&quot; and &quot;.t_2&quot; are used to label first- and second-order temporal lags. For example, if <code>geomerge</code> is told to use a <code>SpatialPointsDataFrame</code> called <kbd>"vio"</kbd> to count incidents of conflict contained within units of <code>target</code>, the default output would include columns named <kbd>"vio.cnt"</kbd>, <kbd>"vio.cnt.t_1"</kbd>, <kbd>"vio.cnt.t_2"</kbd>, <kbd>"vio.cnt.1st"</kbd>, <kbd>"vio.cnt.1st.t_1"</kbd>, <kbd>"vio.cnt.1st.t_2"</kbd>, <kbd>"vio.cnt.2nd"</kbd>, <kbd>"vio.cnt.2nd.t_1"</kbd>, <kbd>"vio.cnt.2nd.t_2"</kbd>.
</p>
</td></tr>
<tr><td><code>inputData</code></td>
<td>
<p>List containing the spatial objects used as input.</p>
</td></tr>
<tr><td><code>parameters</code></td>
<td>
<p>List containing information on all input parameters used during integration.</p>
</td></tr>
</table>


<h3>Note</h3>

<p><code>geomerge</code> exclusively merges data using the global WGS84 coordinate reference system (CRS) to ensure that areal statistics are accurate at all scales. If data are entered that are using a different and/or projected CRS, the tool automatically first transforms the data. This on-the-fly transformation, however, may be very slow and it is advised to always enter inputs in WGS84.
</p>


<h3>Author(s)</h3>

<p>Karsten Donnay and Andrew M. Linke.
</p>


<h3>References</h3>

<p>Andrew M. Linke, Karsten Donnay. (2017). &quot;Scale Variability Misclassification: The Impact of Spatial Resolution on Effect Estimates in the Geographic Analysis of Foreign Aid and Conflict.&quot; Paper presented at the <em>International Studies Association Annual Meeting</em>, February 22-25 2017, Baltimore.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+geomerge-package">geomerge-package</a></code>, <code><a href="#topic+print.geomerge">print.geomerge</a></code>, <code><a href="#topic+plot.geomerge">plot.geomerge</a></code>, <code><a href="#topic+summary.geomerge">summary.geomerge</a></code>, <code><a href="#topic+generateGrid">generateGrid</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(geomerge)

# 1) Simple static integration of polygon data
output &lt;- geomerge(geoEPR,target=states,silent=TRUE)
summary (output)


# 2) Static integration for point, polygon, raster data
output &lt;- geomerge(ACLED$EVENT_TYPE,AidData$project_id,geoEPR,
		   gpw,na.rm=TRUE,target=states)
summary(output)
plot(output)

# 3) Dynamic point data integration for numeric variables
output &lt;- geomerge(ACLED$FATALITIES,AidData$commitme_1,geoEPR,
		   target=states,time=c("2011-01-01", "2011-12-31","1"),
		   t_unit='months',point.agg='sum')
summary(output)
plot(output)

# 4) Population weighted assignment
output &lt;- geomerge(geoEPR,target=states,assignment='max(pop)',
		   population.data = gpw)
summary(output)
plot(output)

</code></pre>

<hr>
<h2 id='geomerge-package'>
geomerge: Geospatial Data Integration
</h2><span id='topic+geomerge-package'></span>

<h3>Description</h3>

<p><code>geomerge</code> is a framework for geospatial data integration that merges raster, spatial polygon, and (dynamic) spatial points data into a spatial (panel) data frame at any geographical resolution.
</p>


<h3>Details</h3>

<p>The <code>geomerge</code> function conducts a series of spatial joins for Geographic Information Systems (GIS) data. It integrates three of R's most commonly used GIS data classes  - polygons, points and rasters. With flexible options for assignment rules and including the calculation of spatial and temporal lags, <code>geomerge</code> returns a time series <code>SpatialPolygonsDataFrame</code> that users may import into any predictive statistical analysis. 
</p>


<h3>Note</h3>

<p>The spatial resolution of the input datasets and scope of the area covered by the integration routine will influence the runtime of <code><a href="#topic+geomerge">geomerge</a></code>. Depending on the inputs, integration may therefore require some time.
</p>


<h3>Author(s)</h3>

<p>Karsten Donnay and Andrew M. Linke
</p>


<h3>References</h3>

<p>Andrew M. Linke, Karsten Donnay. (2017). &quot;Scale Variability Misclassification: The Impact of Spatial Resolution on Effect Estimates in the Geographic Analysis of Foreign Aid and Conflict.&quot; Paper presented at the <em>International Studies Association Annual Meeting</em>, February 22-25 2017, Baltimore.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+geomerge">geomerge</a></code>, <code><a href="#topic+geomerge.merge">geomerge.merge</a></code>,<code><a href="#topic+geomerge.neighbor">geomerge.neighbor</a></code>, <code><a href="#topic+geomerge.assign">geomerge.assign</a></code>,<code><a href="#topic+generateGrid">generateGrid</a></code>
</p>

<hr>
<h2 id='geomerge.assign'>
Implements different assignment rules using SQL [Auxiliary Function]
</h2><span id='topic+geomerge.assign'></span>

<h3>Description</h3>

<p>Implements assignment of polygon values to the <code>target</code> frame using different assignment rules. For efficient performance implemented using SQL.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>geomerge.assign(polygon_input,target,assignment,population.data,optional.inputs,silent)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="geomerge.assign_+3A_polygon_input">polygon_input</code></td>
<td>

<p>input <code>SpatialPolygonsDataFrame</code> parsed from <code>geomerge</code> main function.
</p>
</td></tr>
<tr><td><code id="geomerge.assign_+3A_target">target</code></td>
<td>

<p><code>SpatialPolygonsDataFrame</code> representing desired units of analysis. See Details of <code><a href="#topic+geomerge">geomerge</a></code>.
</p>
</td></tr>
<tr><td><code id="geomerge.assign_+3A_assignment">assignment</code></td>
<td>

<p>identification of either population- or area-weighting assignment rules when handling <code>SpatialPolygonsDataFrame</code> joins to <code>target</code>. Default = <kbd>"max(area)"</kbd>. See Details in <code><a href="#topic+geomerge">geomerge</a></code>.
</p>
</td></tr>
<tr><td><code id="geomerge.assign_+3A_population.data">population.data</code></td>
<td>

<p>specifies data used for weighting if a population-based <code>assignment</code> rule is selected. See Details in <code><a href="#topic+geomerge">geomerge</a></code>.
</p>
</td></tr>
<tr><td><code id="geomerge.assign_+3A_optional.inputs">optional.inputs</code></td>
<td>

<p>Any optional inputs compatible with the <code>extract</code> function in <span class="pkg">terra</span>.
</p>
</td></tr>
<tr><td><code id="geomerge.assign_+3A_silent">silent</code></td>
<td>

<p>Boolean switch to suppress any (non-critical) warnings and messages. Default = <kbd>FALSE</kbd>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For details on different input parameters, please refer to the detailed documentation in <code><a href="#topic+geomerge">geomerge</a></code>.
</p>


<h3>Value</h3>

<p>Returns an object of class <code>data.frame</code> that contains the column from <code>input</code>, after proper assignment, that is to be added to <code>target@data</code>.
</p>


<h3>Author(s)</h3>

<p>Karsten Donnay and Andrew M. Linke.
</p>


<h3>References</h3>

<p>Andrew M. Linke, Karsten Donnay. (2017). &quot;Scale Variability Misclassification: The Impact of Spatial Resolution on Effect Estimates in the Geographic Analysis of Foreign Aid and Conflict.&quot; Paper presented at the <em>International Studies Association Annual Meeting</em>, February 22-25 2017, Baltimore.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+geomerge-package">geomerge-package</a></code>, <code><a href="#topic+geomerge">geomerge</a></code>, <code><a href="#topic+generateGrid">generateGrid</a></code>
</p>

<hr>
<h2 id='geomerge.merge'>
Performing dataset merger [Auxiliary Function]
</h2><span id='topic+geomerge.merge'></span>

<h3>Description</h3>

<p>Auxiliary function that performs the actual integration of the <code>target</code> frame with specified input data. The routine proceeds on dataset at a time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>geomerge.merge(data,data.name,target,standard.CRS,outdata,wghts,
		time, time.lag,spat.lag,zonal.fun,assignment,
		population.data,point.agg, t_unit,silent,optional.inputs)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="geomerge.merge_+3A_data">data</code></td>
<td>

<p>input dataset. See Details in <code><a href="#topic+geomerge">geomerge</a></code>.
</p>
</td></tr>
<tr><td><code id="geomerge.merge_+3A_data.name">data.name</code></td>
<td>

<p>name of input dataset
</p>
</td></tr>
<tr><td><code id="geomerge.merge_+3A_target">target</code></td>
<td>

<p><code>SpatialPolygonsDataFrame</code> representing desired units of analysis. See Details in <code><a href="#topic+geomerge">geomerge</a></code>.
</p>
</td></tr>
<tr><td><code id="geomerge.merge_+3A_standard.crs">standard.CRS</code></td>
<td>

<p>Defines the CRS used. Default used in <code>geomerge</code> is WGS84.
</p>
</td></tr>
<tr><td><code id="geomerge.merge_+3A_outdata">outdata</code></td>
<td>

<p><code>data.frame</code> containing integrated data relative to the <code>SpatialPolygonsDataFrame</code> <code>target</code>.
</p>
</td></tr>
<tr><td><code id="geomerge.merge_+3A_wghts">wghts</code></td>
<td>

<p>spatial weights calculated by <code>link{geomerge.neighbor}</code>. 
</p>
</td></tr>
<tr><td><code id="geomerge.merge_+3A_time">time</code></td>
<td>

<p>specification of temporal window for temporal binning of point data by <code>c(start_date, end_date, interval_length)</code>. Default = <kbd>NA</kbd>. See Details in <code><a href="#topic+geomerge">geomerge</a></code>.
</p>
</td></tr>
<tr><td><code id="geomerge.merge_+3A_time.lag">time.lag</code></td>
<td>

<p>Boolean indicating whether or not first and second order temporal lag values of all variables are returned. Default = <kbd>TRUE</kbd>.
</p>
</td></tr>
<tr><td><code id="geomerge.merge_+3A_spat.lag">spat.lag</code></td>
<td>

<p>Boolean indicating whether or not first and second order spatial lag values of all variables are returned. Default = <kbd>TRUE</kbd>.
</p>
</td></tr>
<tr><td><code id="geomerge.merge_+3A_zonal.fun">zonal.fun</code></td>
<td>

<p>object of class <kbd>function</kbd> applied to values of <code>SpatRaster</code> when generating zonal statistics for each target polygon. Default = <kbd>sum</kbd>. See Details in <code><a href="#topic+geomerge">geomerge</a></code>.
</p>
</td></tr>
<tr><td><code id="geomerge.merge_+3A_assignment">assignment</code></td>
<td>

<p>identification of either population- or area-weighting assignment rules when handling <code>SpatialPolygonsDataFrame</code> joins to <code>target</code>. Default = <kbd>"area.assign"</kbd>. See Details in <code><a href="#topic+geomerge">geomerge</a></code>.
</p>
</td></tr>
<tr><td><code id="geomerge.merge_+3A_population.data">population.data</code></td>
<td>

<p>specifies data used for weighting if a population-based <code>assignment</code> rule is selected. See Details in <code><a href="#topic+geomerge">geomerge</a></code>.
</p>
</td></tr>
<tr><td><code id="geomerge.merge_+3A_point.agg">point.agg</code></td>
<td>

<p>specification of aggregation format for data of type <code>SpatialPointsDataFrame</code>. Default = <kbd>"cnt"</kbd>. See Details in <code><a href="#topic+geomerge">geomerge</a></code>.
</p>
</td></tr>
<tr><td><code id="geomerge.merge_+3A_t_unit">t_unit</code></td>
<td>

<p>temporal unit used for dynamic point aggregation. Default = <kbd>"days"</kbd>.
</p>
</td></tr>
<tr><td><code id="geomerge.merge_+3A_silent">silent</code></td>
<td>

<p>Boolean switch to suppress any (non-critical) warnings and messages. Default = <kbd>FALSE</kbd>.
</p>
</td></tr>
<tr><td><code id="geomerge.merge_+3A_optional.inputs">optional.inputs</code></td>
<td>

<p>Any optional inputs compatible with the <code>extract</code> function in <span class="pkg">terra</span>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For details on different input parameters, please refer to the detailed documentation in <code><a href="#topic+geomerge">geomerge</a></code>. 
</p>


<h3>Value</h3>

<p>Returns an object of class <code>data.frame</code> that contains all information from merger to <code>target</code> to be added to <code>target@data</code> in the main <code>geomerge</code> function. The documentation in <code><a href="#topic+geomerge">geomerge</a></code> provides a detailed overview over the columns returned and their naming conventions
</p>


<h3>Author(s)</h3>

<p>Karsten Donnay and Andrew M. Linke.
</p>


<h3>References</h3>

<p>Andrew M. Linke, Karsten Donnay. (2017). &quot;Scale Variability Misclassification: The Impact of Spatial Resolution on Effect Estimates in the Geographic Analysis of Foreign Aid and Conflict.&quot; Paper presented at the <em>International Studies Association Annual Meeting</em>, February 22-25 2017, Baltimore.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+geomerge-package">geomerge-package</a></code>, <code><a href="#topic+geomerge">geomerge</a></code>, <code><a href="#topic+generateGrid">generateGrid</a></code>
</p>

<hr>
<h2 id='geomerge.neighbor'>
Returns first and second order spatial neighbors [Auxiliary Function]
</h2><span id='topic+geomerge.neighbor'></span>

<h3>Description</h3>

<p>Auxiliary function that uses functionality from <span class="pkg">spdep</span> to retrieve first and second order neighbor weights.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>geomerge.neighbor(polygon_input)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="geomerge.neighbor_+3A_polygon_input">polygon_input</code></td>
<td>

<p>a <code>SpatialPolygonsDataFrame</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function serves as a wrapper for the <code>poly2nb</code>, <code>nblag</code> and <code>nb2listw</code> functions from <span class="pkg">spdep</span> and returns first and second order neighbor weights using <code>zero.policy = TRUE</code>.
</p>


<h3>Value</h3>

<p>Returns a list of lists of neighbor weights named &quot;wts1&quot; and &quot;wts2&quot;.
</p>


<h3>Author(s)</h3>

<p>Karsten Donnay and Andrew M. Linke.
</p>


<h3>References</h3>

<p>Andrew M. Linke, Karsten Donnay. (2017). &quot;Scale Variability Misclassification: The Impact of Spatial Resolution on Effect Estimates in the Geographic Analysis of Foreign Aid and Conflict.&quot; Paper presented at the <em>International Studies Association Annual Meeting</em>, February 22-25 2017, Baltimore.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+geomerge-package">geomerge-package</a></code>, <code><a href="#topic+geomerge">geomerge</a></code>, <code><a href="#topic+generateGrid">generateGrid</a></code>
</p>

<hr>
<h2 id='gpw'>Raster dataset to illustrate the functionality of geomerge</h2><span id='topic+gpw'></span>

<h3>Description</h3>

<p><em>gpw</em> population raster data for Nigeria for the year 2010 used as example for a <code>SpatRaster</code> available from http://sedac.ciesin.columbia.edu/data/collection/gpw-v4. The dataset (gpw-v4) provides population estimates at a grid resolution of about 4km.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(geomerge)</code></pre>


<h3>Format</h3>

<p>A <code>SpatRaster</code> containing observations.</p>


<h3>Author(s)</h3>

<p>Karsten Donnay and Andrew M. Linke
</p>


<h3>Source</h3>

<p>http://sedac.ciesin.columbia.edu/data/collection/gpw-v4
</p>
<p>Citation:
Center for International Earth Science Information Network - CIESIN - Columbia University. (2016). <em>Gridded Population of the World, Version 4 (GPWv4): Population Density</em>. Palisades, NY: NASA Socioeconomic Data and Applications Center (SEDAC).
</p>


<h3>References</h3>

<p>Andrew M. Linke, Karsten Donnay. (2017). &quot;Scale Variability Misclassification: The Impact of Spatial Resolution on Effect Estimates in the Geographic Analysis of Foreign Aid and Conflict.&quot; Paper presented at the <em>International Studies Association Annual Meeting</em>, February 22-25 2017, Baltimore.
</p>

<hr>
<h2 id='plot.geomerge'>
Plot function for objects of class 'geomerge'.
</h2><span id='topic+plot.geomerge'></span>

<h3>Description</h3>

<p>Overloads the default <code>plot</code> for objects of class 'geomerge'.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'geomerge'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.geomerge_+3A_x">x</code></td>
<td>

<p>object of class <code><a href="#topic+geomerge">geomerge</a></code>.
</p>
</td></tr>
<tr><td><code id="plot.geomerge_+3A_...">...</code></td>
<td>

<p>further optional arguments.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Returns a series of maps that visualizes numeric variables produced by <code>geomerge</code>. It returns a map for each unique numeric variable including first order spatially and temporally lagged values if <code>spat.lag=TRUE</code> and <code>time.lag=TRUE</code> when running <code>geomerge</code>. For spatial panels, the function by default returns values for the last period.
</p>
<p>Five optional arguments that are specific to this plotting function can be provided. The first is <kbd>period</kbd>, a numeric input that allows to specify a specific period to be plotted. <kbd>inputs</kbd> must be a sequence of character strings specifying select variables to be plotted only. These have to have been merged (with the same name) in <code>geomerge</code>. <kbd>time.lag</kbd> and <kbd>spat.lag</kbd> override the boolean values parsed automatically from the result of <code>geomerge</code>. They are mainly meant to switch off plotting of spatial and temporal lags as they are ignored if these lags were not generated in the first place. The last argument is <kbd>ncol</kbd>, a numeric input, which allows to specify the width of the panel of plotted maps. By default, always 2 maps are shown side-by-side.
</p>


<h3>Note</h3>

<p><code>plot</code> for objects of class 'geomerge' relies in many core aspects of its functionality on <span class="pkg">ggplot2</span>. If the target <code>SpatialPolygonsDataFrame</code> is very large it may reach or exceed the limits of what the plotting functionality from <span class="pkg">ggplot2</span> can handle and <code>plot</code> may be very slow or even stall.
</p>


<h3>Author(s)</h3>

<p>Karsten Donnay and Andrew M. Linke.
</p>


<h3>References</h3>

<p>Andrew M. Linke, Karsten Donnay. (2017). &quot;Scale Variability Misclassification: The Impact of Spatial Resolution on Effect Estimates in the Geographic Analysis of Foreign Aid and Conflict.&quot; Paper presented at the <em>International Studies Association Annual Meeting</em>, February 22-25 2017, Baltimore.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+geomerge">geomerge</a></code>
</p>

<hr>
<h2 id='print.geomerge'>
Print function for objects of class 'geomerge'. 
</h2><span id='topic+print.geomerge'></span>

<h3>Description</h3>

<p>Overloads the default <code>print</code> for objects of class 'geomerge'.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'geomerge'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.geomerge_+3A_x">x</code></td>
<td>

<p>object of class <code><a href="#topic+geomerge">geomerge</a></code>.</p>
</td></tr>
<tr><td><code id="print.geomerge_+3A_...">...</code></td>
<td>

<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Karsten Donnay and Andrew M. Linke.
</p>


<h3>References</h3>

<p>Andrew M. Linke, Karsten Donnay. (2017). &quot;Scale Variability Misclassification: The Impact of Spatial Resolution on Effect Estimates in the Geographic Analysis of Foreign Aid and Conflict.&quot; Paper presented at the <em>International Studies Association Annual Meeting</em>, February 22-25 2017, Baltimore.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+geomerge">geomerge</a></code>
</p>

<hr>
<h2 id='states'>Polygon dataset to illustrate the functionality of geomerge</h2><span id='topic+states'></span>

<h3>Description</h3>

<p>Nigeria administrative units (ADM1) dataset used as example for the target <code>SpatialPolygonsDataFrame</code> data are merged. The dataset is available at http://www.arcgis.com/home/item.html?id=0e58995046b74254911c1dc0eb756fa4.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(geomerge)</code></pre>


<h3>Format</h3>

<p>A <code>SpatialPolygonsDataFrame</code> containing observation and that data is merged to using <code>geomerge</code>.</p>


<h3>Details</h3>

<p>Note that the polygons in <code>states</code> have been simplified to reduce the size of the <code>SpatialPolygonsDataFrame</code> used as integration target for easier illustration. This applies, in particular, to the Niger Delta region of Nigeria.
</p>


<h3>Author(s)</h3>

<p>Karsten Donnay and Andrew M. Linke
</p>


<h3>Source</h3>

<p>http://www.arcgis.com/home/item.html?id=0e58995046b74254911c1dc0eb756fa4
</p>


<h3>References</h3>

<p>Andrew M. Linke, Karsten Donnay. (2017). &quot;Scale Variability Misclassification: The Impact of Spatial Resolution on Effect Estimates in the Geographic Analysis of Foreign Aid and Conflict.&quot; Paper presented at the <em>International Studies Association Annual Meeting</em>, February 22-25 2017, Baltimore.
</p>

<hr>
<h2 id='summary.geomerge'>
Summary function for objects of class 'geomerge'.
</h2><span id='topic+summary.geomerge'></span>

<h3>Description</h3>

<p>Overloads the default <code>summary</code> for objects of class 'geomerge'.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'geomerge'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.geomerge_+3A_object">object</code></td>
<td>

<p>object of class <code><a href="#topic+geomerge">geomerge</a></code>.
</p>
</td></tr>
<tr><td><code id="summary.geomerge_+3A_...">...</code></td>
<td>

<p>further arguments passed to or from other methods.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a number of summary statistics describing the results of the <code><a href="#topic+geomerge">geomerge</a></code> integration, including how many variables were integrated, which of those are numerical vs. non numerical and whether spatially and/or temporally lagged values are available.
</p>


<h3>Author(s)</h3>

<p>Karsten Donnay and Andrew M. Linke.
</p>


<h3>References</h3>

<p>Andrew M. Linke, Karsten Donnay. (2017). &quot;Scale Variability Misclassification: The Impact of Spatial Resolution on Effect Estimates in the Geographic Analysis of Foreign Aid and Conflict.&quot; Paper presented at the <em>International Studies Association Annual Meeting</em>, February 22-25 2017, Baltimore.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+geomerge">geomerge</a></code>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
