<!DOCTYPE html><html><head><title>Help for package fastLaplace</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {fastLaplace}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#fsglmm'><p>Fitting Projection Based Laplace Approximation for Spatial Generalized Linear Mixed Model</p></a></li>
<li><a href='#fsglmm.discrete'><p>Fitting Projection Based Laplace Approximation for Spatial Generalized Linear Mixed Model</p></a></li>
<li><a href='#pred.sglmm'><p>Model Predictions</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>A Fast Laplace Method for Spatial Generalized Linear Mixed Model</td>
</tr>
<tr>
<td>Version:</td>
<td>0.0.2</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Sangwan Lee &lt;sangwanlee@yonsei.ac.kr&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Fitting a fast Laplace approximation for Spatial Generalized Linear Mixed Model as
  described in Park and Lee (2021) <a href="https://github.com/sangwan93/fastLaplace/blob/main/FastLaplaceMain.pdf">https://github.com/sangwan93/fastLaplace/blob/main/FastLaplaceMain.pdf</a>.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>false</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat (&ge; 3.0.0), spelling, mgcv,
ngspatial, MASS</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>Imports:</td>
<td>RSpectra, bbmle, fields</td>
</tr>
<tr>
<td>URL:</td>
<td>&lt;<a href="https://www.naver.com/&amp;gt;">https://www.naver.com/&gt;</a></td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-06-25 02:57:54 UTC; samsung</td>
</tr>
<tr>
<td>Author:</td>
<td>Sangwan Lee [cre, aut],
  Jaewoo Park [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-06-28 08:20:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='fsglmm'>Fitting Projection Based Laplace Approximation for Spatial Generalized Linear Mixed Model</h2><span id='topic+fsglmm'></span>

<h3>Description</h3>

<p><code>fsglmm</code> is used to fit reduced-dimensional spatial generalized linear mixed models for continuous spatial domain.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fsglmm(
  formula,
  kappa,
  inits,
  data,
  coords,
  family,
  ntrial = 1,
  offset = NA,
  method.optim,
  method.integrate,
  rank = NULL,
  control = list()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fsglmm_+3A_formula">formula</code></td>
<td>
<p>an object of class &quot;formula.&quot;</p>
</td></tr>
<tr><td><code id="fsglmm_+3A_kappa">kappa</code></td>
<td>
<p>the smoothness parameter for the matern process (either 0.5, 1.5, 2.5 or 10).</p>
</td></tr>
<tr><td><code id="fsglmm_+3A_inits">inits</code></td>
<td>
<p>starting values for the parameters.</p>
</td></tr>
<tr><td><code id="fsglmm_+3A_data">data</code></td>
<td>
<p>a data frame containing variables in the model.</p>
</td></tr>
<tr><td><code id="fsglmm_+3A_coords">coords</code></td>
<td>
<p>a matrix of dimension <code class="reqn">N</code> x 2 representing the longitude and latitude of each observation.</p>
</td></tr>
<tr><td><code id="fsglmm_+3A_family">family</code></td>
<td>
<p>a character string of the error distribution and link function to be used in the model.</p>
</td></tr>
<tr><td><code id="fsglmm_+3A_ntrial">ntrial</code></td>
<td>
<p>a numeric vector for a binomial model.</p>
</td></tr>
<tr><td><code id="fsglmm_+3A_offset">offset</code></td>
<td>
<p>this is used to specify an a priori a known component to be included in the linear predictor during fitting.</p>
</td></tr>
<tr><td><code id="fsglmm_+3A_method.optim">method.optim</code></td>
<td>
<p>the method to be used for outer optimization. &quot;CG&quot; for Conjugate Gradient Method.</p>
</td></tr>
<tr><td><code id="fsglmm_+3A_method.integrate">method.integrate</code></td>
<td>
<p>the method to be used for inner optimization. &quot;NR&quot; for Newton Raphson Method.</p>
</td></tr>
<tr><td><code id="fsglmm_+3A_rank">rank</code></td>
<td>
<p>an integer of 'rank' to be used for projections. Default is 5 percent of observations.</p>
</td></tr>
<tr><td><code id="fsglmm_+3A_control">control</code></td>
<td>
<p>a list of control parameters.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list containing the following components:
</p>
<p><code>summary</code> a summary of the fitted model
</p>
<p><code>vcov</code> a symmetric matrix giving an estimate of the Hessian at the solution found.
</p>
<p><code>mle2</code> an object of class &quot;mle2&quot;
</p>
<p><code>family</code> the family used.
</p>
<p><code>kappa</code> the matern smoothness parameter used.
</p>
<p><code>Delta</code> a matrix containing the estimated random effects of the reduced dimensional model.
</p>
<p><code>U</code> a matrix whose columns contain the estimated eigenvectors of the reduced dimensional model.
</p>
<p><code>D</code> a matrix whose diagonal components contain the estimated eigenvalues of the reduced dimensional model.
</p>
<p><code>coords</code> the matrix of coordinates used.
</p>


<h3>References</h3>

<p>Jaewoo Park and Sangwan Lee - &quot;A Projection-based Laplace Approximation for Spatial Latent Variable Models&quot;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if(requireNamespace("mgcv")){
sigma2 = 1
phi = 0.2
beta.true = c(1,1)
n = 400
n.pred = 100
coords.all &lt;- matrix(runif((n+n.pred)*2),ncol=2,nrow=n+n.pred)
X.all &lt;- matrix(runif((n+n.pred)*2),ncol=2,nrow=(n+n.pred))
dist.all &lt;- fields::rdist(coords.all,coords.all)
V.all &lt;- sigma2*(1+sqrt(5)/phi*dist.all+5/(3*phi^2)*dist.all^2)*exp(-sqrt(5)/phi*dist.all)
set.seed(1)
r.e.all &lt;- mgcv::rmvn(1,rep(0,nrow(coords.all)),V.all)
pi.all &lt;- X.all%*%beta.true + r.e.all
p.all &lt;- exp(pi.all)/(1+exp(pi.all))
Y.all &lt;- sapply(p.all, function(x) sample(0:1, 1, prob = c(1-x, x)))
Y &lt;- as.matrix(Y.all[1:n],nrow = n)
X &lt;- X.all[1:n,]
coords &lt;- coords.all[1:n,]
data &lt;- data.frame(cbind(Y,X))
colnames(data) = c("Y","X1","X2")
mod.glm &lt;- glm(Y~-1+X1+X2,family="binomial",data=data)
mod.glm.esp &lt;- predict(mod.glm,data, type="response")
mod.glm.s2 &lt;- var(Y - mod.glm.esp)
mod.glm.phi &lt;- 0.1*max(dist(coords))
startinit &lt;- c(mod.glm$coef,log(mod.glm.s2),log(mod.glm.phi))
names(startinit) &lt;- c("X1","X2","logsigma2","logphi")
result.bin &lt;- fsglmm(Y~-1+X1+X2, kappa=2.5, inits = startinit,
 data = data,coords = coords, family = "binomial", ntrial = 1,
 offset = NA,method.optim = "CG", method.integrate = "NR",rank = 50)
}

</code></pre>

<hr>
<h2 id='fsglmm.discrete'>Fitting Projection Based Laplace Approximation for Spatial Generalized Linear Mixed Model</h2><span id='topic+fsglmm.discrete'></span>

<h3>Description</h3>

<p><code>fsglmm.discrete</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fsglmm.discrete(
  formula,
  inits,
  data,
  family,
  ntrial = 1,
  method.optim,
  method.integrate,
  rank = NULL,
  A,
  offset = NA
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fsglmm.discrete_+3A_formula">formula</code></td>
<td>
<p>an object of class &quot;formula.&quot;</p>
</td></tr>
<tr><td><code id="fsglmm.discrete_+3A_inits">inits</code></td>
<td>
<p>starting values for the parameters.</p>
</td></tr>
<tr><td><code id="fsglmm.discrete_+3A_data">data</code></td>
<td>
<p>a data frame containing variables in the model.</p>
</td></tr>
<tr><td><code id="fsglmm.discrete_+3A_family">family</code></td>
<td>
<p>a character string of the error distribution and link function to be used in the model.</p>
</td></tr>
<tr><td><code id="fsglmm.discrete_+3A_ntrial">ntrial</code></td>
<td>
<p>a numeric vector for binomial model.</p>
</td></tr>
<tr><td><code id="fsglmm.discrete_+3A_method.optim">method.optim</code></td>
<td>
<p>the method to be used for outer optimization. &quot;CG&quot; for Conjugate Gradient Method.</p>
</td></tr>
<tr><td><code id="fsglmm.discrete_+3A_method.integrate">method.integrate</code></td>
<td>
<p>the method to be used for inner optimization. &quot;NR&quot; for Newton Raphson Method.</p>
</td></tr>
<tr><td><code id="fsglmm.discrete_+3A_rank">rank</code></td>
<td>
<p>an integer of 'rank' to be used for projections. Default is 5 percent of observations.</p>
</td></tr>
<tr><td><code id="fsglmm.discrete_+3A_a">A</code></td>
<td>
<p>an adjacency matrix</p>
</td></tr>
<tr><td><code id="fsglmm.discrete_+3A_offset">offset</code></td>
<td>
<p>this is used to specify an a priori a known component to be included in the linear predictor during fitting.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list containing the following components:
</p>
<p><code>summary</code> a summary of the fitted model
</p>
<p><code>mle2</code> an object of class &quot;mle2&quot;
</p>
<p><code>Delta</code> a matrix containing the estimated random effects of the reduced dimensional model.
</p>
<p><code>M</code> the projection matrix used.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if(requireNamespace("ngspatial")&amp;
requireNamespace("mgcv")){
n = 30
A = ngspatial::adjacency.matrix(n)
Q = diag(rowSums(A),n^2) - A
x = rep(0:(n - 1) / (n - 1), times = n)
y = rep(0:(n - 1) / (n - 1), each = n)
X = cbind(x, y)
beta = c(1, 1)
P.perp = diag(1,n^2) - X%*%solve(t(X)%*%X)%*%t(X)
eig = eigen(P.perp %*% A %*% P.perp)
eigenvalues = eig$values
q = 400
M = eig$vectors[,c(1:q)]
Q.s = t(M) %*% Q %*% M
tau = 6
Sigma = solve(tau*Q.s)
set.seed(1)
delta.s = mgcv::rmvn(1, rep(0,q), Sigma)
lambda = exp( X%*%beta + M%*%delta.s )
Z = c()
for(j in 1:n^2){Z[j] = rpois(1,lambda[j])}
Y = as.matrix(Z,ncol=1)
data = data.frame("Y"=Y,"X"=X)
colnames(data) = c("Y","X1","X2")
linmod &lt;- glm(Y~-1+X1+X2,data=data,family="poisson") # Find starting values
linmod$coefficients
starting &lt;- c(linmod$coefficients,"logtau"=log(1/var(linmod$residuals)) )

result.pois.disc &lt;- fsglmm.discrete(Y~-1+X1+X2, inits = starting, data=data,
family="poisson",ntrial=1, method.optim="BFGS", method.integrate="NR",rank=50, A=A)
}



</code></pre>

<hr>
<h2 id='pred.sglmm'>Model Predictions</h2><span id='topic+pred.sglmm'></span>

<h3>Description</h3>

<p><code>pred.sglmm</code> is a function for predictions from the results of <code>fsglmm</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pred.sglmm(fit.sglmm, data, coords, ntrial = 1, offset = NA)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pred.sglmm_+3A_fit.sglmm">fit.sglmm</code></td>
<td>
<p>a list from <code>fsglmm</code></p>
</td></tr>
<tr><td><code id="pred.sglmm_+3A_data">data</code></td>
<td>
<p>a data frame to be predicted by the model.</p>
</td></tr>
<tr><td><code id="pred.sglmm_+3A_coords">coords</code></td>
<td>
<p>coordinates for prediction</p>
</td></tr>
<tr><td><code id="pred.sglmm_+3A_ntrial">ntrial</code></td>
<td>
<p>a numeric vector of the total number of trials ( binomial )</p>
</td></tr>
<tr><td><code id="pred.sglmm_+3A_offset">offset</code></td>
<td>
<p>a numeric vector indicating a known component to be included in the linear predictor for predictions.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a vector of predicted mean parameters. (e.g. probabilities for binomial case)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## the result from fsglmm, data to be predicted, and the coordinates for prediction is required.


result &lt;- fsglmm(Y~-1+X1+X2, kappa=2.5, inits = startinit, data = data,coords = coords,
family = "binomial", ntrial = 1, offset = NA,method.optim = "CG",method.integrate = "NR",rank = 50)
pred.sglmm(fit.sglmm=result,data=X.pred,)



</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
