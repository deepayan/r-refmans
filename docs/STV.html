<!DOCTYPE html><html><head><title>Help for package STV</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {STV}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#STV-package'><p>STV Vote Counting</p></a></li>
<li><a href='#ballots'><p>ballots data contains rankings of 44 candidates by 489 people.</p>
10 rows are black, which will prompt an error. This data follows the structure of a 2016 Yale faculty senate election, but vote choices have been permuted and candidate names have been removed.</a></li>
<li><a href='#cleanBallots'><p>Tries to Address <code>validateBallots()</code> Warning(s).</p></a></li>
<li><a href='#stv'><p>Implement STV Counting Systems</p></a></li>
<li><a href='#validateBallots'><p>Validates Input Data Format for <code>stv()</code>.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Single Transferable Vote Counting</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.2</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>John Emerson &lt;john.emerson@yale.edu&gt;</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/jayemerson/STV">https://github.com/jayemerson/STV</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/jayemerson/STV/issues">https://github.com/jayemerson/STV/issues</a></td>
</tr>
<tr>
<td>Description:</td>
<td>Implementations of the Single Transferable Vote counting 
    system. By default, it uses the Cambridge method for surplus allocation
    and Droop method for quota calculation.  Fractional surplus allocation
    and the Hare quota are available as options.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/LGPL-3">LGPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat, crayon</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.0</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-02-01 00:13:00 UTC; jay</td>
</tr>
<tr>
<td>Author:</td>
<td>John Emerson [cre, aut],
  Saksham Chandra [aut],
  Lilla Orr [aut],
  Efim Abrikosov [ctb],
  Shadie Khubba [ctb],
  William Meyerson [ctb],
  Shylee Ezroni [ctb],
  Junchao Ma [ctb]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-02-01 15:30:10 UTC</td>
</tr>
</table>
<hr>
<h2 id='STV-package'>STV Vote Counting</h2><span id='topic+STV-package'></span>

<h3>Description</h3>

<p>Functions in this package are designed to clean, validate, and count single transferable votes.
</p>


<h3>Author(s)</h3>

<p>Jay Emerson (expand this)
</p>

<hr>
<h2 id='ballots'>ballots data contains rankings of 44 candidates by 489 people.
10 rows are black, which will prompt an error. This data follows the structure of a 2016 Yale faculty senate election, but vote choices have been permuted and candidate names have been removed.</h2><span id='topic+ballots'></span>

<h3>Description</h3>

<p>ballots data contains rankings of 44 candidates by 489 people.
10 rows are black, which will prompt an error. This data follows the structure of a 2016 Yale faculty senate election, but vote choices have been permuted and candidate names have been removed.
</p>


<h3>Author(s)</h3>

<p>John W. Emerson <a href="mailto:john.emerson@yale.edu">john.emerson@yale.edu</a>
</p>

<hr>
<h2 id='cleanBallots'>Tries to Address <code>validateBallots()</code> Warning(s).</h2><span id='topic+cleanBallots'></span>

<h3>Description</h3>

<p>The <code>cleanBallots()</code> function tries to clean data for use in <code>stv()</code>. 
Some warnings from <code>validateBallots()</code> can only be addressed by the user.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cleanBallots(x, cand.names = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cleanBallots_+3A_x">x</code></td>
<td>
<p>a <code>data.frame</code> with rows as ballots and columns as candidates.</p>
</td></tr>
<tr><td><code id="cleanBallots_+3A_cand.names">cand.names</code></td>
<td>
<p>character vector of length equal to number of candidates
(needed when column names of <code>x</code> are missing or not unique).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>cleanBallots()</code> function assumes <code>x</code> contains rows and columns 
corresponding to ballots and candidates respectively. Formatting corrections 
are attempted in the following order:
</p>

<ol>
<li><p> If <code>x</code> is a <code>matrix</code> it is convered to a <code>data.frame</code>.
Otherwise, user must provide a <code>data.frame</code>.
</p>
</li>
<li><p> If <code>x</code> has non-numeric entries, user must
convert data to numeric type.
</p>
</li>
<li><p> If <code>cand.names</code> is specified, it is assigned as column names of <code>x</code>. 
All collumn names must be uniquely specified.
<code>x</code> already has valid column names, no need to specify <code>cand.names</code>.
If column names of <code>x</code> missing and <code>cand.names</code> not specified, returns
error message.
</p>
</li>
<li><p> Removes blank columns.
</p>
</li>
<li><p> Removes blank and/or non-sequentially ranked rows.
</p>
</li></ol>



<h3>Value</h3>

<p>a <code>data.frame</code> compatible for <code>stv()</code> function.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(ballots)
cballots &lt;- cleanBallots(ballots)
validateBallots(cballots)
</code></pre>

<hr>
<h2 id='stv'>Implement STV Counting Systems</h2><span id='topic+stv'></span>

<h3>Description</h3>

<p>Analyze a data frame of STV election ballot rankings and return
the elected voters and details of the steps in the election counting.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stv(
  x,
  seats = 1,
  file = "",
  surplusMethod = "Cambridge",
  quotaMethod = "Droop",
  quotaFloor = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stv_+3A_x">x</code></td>
<td>
<p>a data frame with rows of ballots and columns for each
candidate. <code>x</code> must pass all checks from
<code><a href="#topic+validateBallots">validateBallots</a></code>.</p>
</td></tr>
<tr><td><code id="stv_+3A_seats">seats</code></td>
<td>
<p>an integer (default = 1) indicating candidates to elect.</p>
</td></tr>
<tr><td><code id="stv_+3A_file">file</code></td>
<td>
<p>a character string naming a file; <code>""</code> (default) indicates 
output to the console only (default), otherwise a CSV file is created
(and thus <code>file</code> should end with <code>".csv"</code>).</p>
</td></tr>
<tr><td><code id="stv_+3A_surplusmethod">surplusMethod</code></td>
<td>
<p>a character string indicating which method to use for
surplus allocation. Currently supports <code>"Cambridge"</code> (default) and
<code>"Fractional"</code>.</p>
</td></tr>
<tr><td><code id="stv_+3A_quotamethod">quotaMethod</code></td>
<td>
<p>a character string indicating which method to use for
calculation of quota. Currently supports <code>"Droop"</code> (default) and 
<code>"Hare"</code>.</p>
</td></tr>
<tr><td><code id="stv_+3A_quotafloor">quotaFloor</code></td>
<td>
<p>a logical value indicating that candidates must reach
the integer part of the quota in order to be elected if <code>"TRUE"</code> 
(default) or that they must reach the exact quota which may be 
fractional if <code>"FALSE"</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Revise the details:
<code>stv()</code> first validates <code>x</code> by running the <code>validateBallots()</code> function.
Once validation is complete, it implements the selected single transferable vote
counting method. Each round of counting starts with idetification of active
ballots. Then a quota is calculated (currently only supports Droop method 
<code>floor(votes/(seats + 1)) + 1</code> and Hare method <code>floor(votes/seats)</code>)
with or without the <code>floor()</code> rounding. A tally of each candidate's vote share 
is obtained using top choices of active ballots, where a ballot stays active until it 
runs out of marked choices or gets removed during surplus reallocation. If a candidate 
reaches the quota, she/he is elected and associated surplus ballots are reallocated 
(currently only supports Cambridge and Fractional methods). If multiple candidates reach 
the quota, all of them are elected and their surpluses are all reallocated. If no candidate 
reaches the quota, then the candidate with the minimum number of votes is eliminated. 
If multiple candidates tie for minimum number of votes, one of them is selected at random 
and eliminated. The process is repeated until all of the seats are filled or the number of 
candidates still in race equals the number of unfilled seats. In the later case, 
all of the active candidates are elected.
</p>


<h3>Value</h3>

<p>The object returned is a list consisting of two components: a
vector of the elected candidates, and a data frame with rows containing
detailed results from each round of STV counting.
</p>
<p>For every round of vote counting, a row of the detailed information
contains: number of active ballots, seats to remaining to be filled,
the current quota, the maximum and minimum votes obtained by each
candidate, who was eliminated (if applicable), whether there was a
tie for elimination (indicated by how many tied), who was elected
(if applicable), the surplus if elected (or multiple surpluses if
multiple candidates were elected), and each candidate's votes tally
for that round.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(ballots)
cballots &lt;- cleanBallots(ballots)

set.seed(1)
result1 &lt;- stv(cballots, seats = 4)
names(result1)
result1$elected

set.seed(4)
result2 &lt;- stv(cballots, seats = 4)
result2$elected

## Not run: 
result3 &lt;- stv(cballots, seats = 4, surplusMethod = "Fractional")
result3$elected

result4 &lt;- stv(cballots, seats = 4, surplusMethod = "Fractional",
               quotaMethod = "Hare")
result4$elected

result5 &lt;- stv(cballots, seats = 4, surplusMethod = "Cambridge",
               quotaMethod = "Hare")
result5$elected

## End(Not run)

</code></pre>

<hr>
<h2 id='validateBallots'>Validates Input Data Format for <code>stv()</code>.</h2><span id='topic+validateBallots'></span>

<h3>Description</h3>

<p>The function <code>validateBallots</code> validates data format for <code>stv()</code> input.  
It assumes that each row corresponds to a ballot and each column corresponds to a 
candidate. If input data is in the correct format, <code>validateBallots</code> returns 
string: &quot;All tests passed. Please feel free to run <code>stv()</code> function.&quot; 
Otherwise, it prints a message corresponding to the formatting error.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>validateBallots(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="validateBallots_+3A_x">x</code></td>
<td>
<p>a <code>data.frame</code> with rows as ballots and columns as candidates.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>validateBallots</code> function should be run before <code>stv()</code> is called. 
Before any calculation, <code>stv()</code> calls this function and proceeds only 
if <code>x</code> passes all of the following tests.
</p>

<ol>
<li><p> If <code>x</code> is a <code>data.frame</code>.
</p>
</li>
<li><p> If <code>x</code> has unique column names.
</p>
</li>
<li><p> If <code>x</code> has numeric entries.
</p>
</li>
<li><p> If <code>x</code> doesn't have any blank columns.
</p>
</li>
<li><p> If <code>x</code> doesn't have any blank rows.
</p>
</li>
<li><p> If <code>x</code> doesn't have any rows with non-sequential ranks.
</p>
</li></ol>



<h3>Value</h3>

<p>string: &quot;All tests passed. Please feel free to run stv() function.&quot; if <code>x</code>
passes all tests. Otherwise, a message corresponding to the problem is retunred. 
NOTE: Some of the warnings can be fixed using <code>cleanBallots()</code> function. 
Other issues must be fixed by the user.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(ballots)
result &lt;- try(validateBallots(ballots), silent=TRUE)
print(result)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
