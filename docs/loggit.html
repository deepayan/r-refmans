<!DOCTYPE html><html><head><title>Help for package loggit</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {loggit}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#get_logfile'><p>Get Log File</p></a></li>
<li><a href='#get_timestamp_format'><p>Get Timestamp Format</p></a></li>
<li><a href='#handlers'><p>loggit's Exception Handlers</p></a></li>
<li><a href='#loggit'><p>Log entries to file</p></a></li>
<li><a href='#read_logs'><p>Return log file as an R data frame</p></a></li>
<li><a href='#read_ndjson'><p>Read ndJSON-formatted log file</p></a></li>
<li><a href='#rotate_logs'><p>Rotate log file</p></a></li>
<li><a href='#sanitizers'><p>Default sanitization for ndJSON.</p></a></li>
<li><a href='#set_logfile'><p>Set Log File</p></a></li>
<li><a href='#set_timestamp_format'><p>Set Timestamp Format</p></a></li>
<li><a href='#write_ndjson'><p>Write ndJSON-formatted log file</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Modern Logging for the R Ecosystem</td>
</tr>
<tr>
<td>Description:</td>
<td>
    An effortless 'ndjson' (newline-delimited 'JSON') logger, with two primary
    log-writing interfaces. It provides a set of wrappings for base R's
    message(), warning(), and stop() functions that maintain identical
    functionality, but also log the handler message to an 'ndjson' log file.
    'loggit' also exports its internal 'loggit()' function for powerful and
    configurable custom logging. No change in existing code is necessary to use
    this package, and should only require additions to fully leverage the power
    of the logging system. 'loggit' also provides a log reader for reading an
    'ndjson' log file into a data frame, log rotation, and live echo of the
    'ndjson' log messages to terminal 'stdout' for log capture by external
    systems (like containers). 'loggit' is ideal for Shiny apps, data pipelines,
    modeling work flows, and more. Please see the vignettes for detailed example
    use cases.</td>
</tr>
<tr>
<td>Version:</td>
<td>2.1.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2021-02-27</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.4.0)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr (&ge; 1.19), rmarkdown (&ge; 1.8), testthat (&ge; 2.0.0)</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/ryapric/loggit">https://github.com/ryapric/loggit</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/ryapric/loggit/issues">https://github.com/ryapric/loggit/issues</a></td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-02-28 02:37:41 UTC; ryan</td>
</tr>
<tr>
<td>Author:</td>
<td>Ryan Price [cre, aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Ryan Price &lt;ryapric@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-02-28 05:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='get_logfile'>Get Log File</h2><span id='topic+get_logfile'></span>

<h3>Description</h3>

<p>Return the log file that loggit will write to.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_logfile()
</code></pre>


<h3>Examples</h3>

<pre><code class='language-R'>get_logfile()

</code></pre>

<hr>
<h2 id='get_timestamp_format'>Get Timestamp Format</h2><span id='topic+get_timestamp_format'></span>

<h3>Description</h3>

<p>Get timestamp format for use in output logs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_timestamp_format()
</code></pre>


<h3>Examples</h3>

<pre><code class='language-R'>get_timestamp_format()

</code></pre>

<hr>
<h2 id='handlers'>loggit's Exception Handlers</h2><span id='topic+handlers'></span><span id='topic+message'></span><span id='topic+warning'></span><span id='topic+stop'></span>

<h3>Description</h3>

<p>These exception handlers are identical to base R's <a href="base.html#topic+message">message</a>,
<a href="base.html#topic+warning">warning</a>, and <a href="base.html#topic+stop">stop</a>, but with included logging
of the exception messages via <code>loggit()</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>message(..., domain = NULL, appendLF = TRUE, .loggit = TRUE, echo = TRUE)

warning(
  ...,
  call. = TRUE,
  immediate. = FALSE,
  noBreaks. = FALSE,
  domain = NULL,
  .loggit = TRUE,
  echo = TRUE
)

stop(..., call. = TRUE, domain = NULL, .loggit = TRUE, echo = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="handlers_+3A_...">...</code></td>
<td>
<p>zero or more objects which can be coerced to character
(and which are pasted together with no separator) or (for
<code>message</code> only) a single condition object.</p>
</td></tr>
<tr><td><code id="handlers_+3A_domain">domain</code></td>
<td>
<p>see <code><a href="base.html#topic+gettext">gettext</a></code>.  If <code>NA</code>, messages will
not be translated, see also the note in <code><a href="base.html#topic+stop">stop</a></code>.</p>
</td></tr>
<tr><td><code id="handlers_+3A_appendlf">appendLF</code></td>
<td>
<p>logical: should messages given as a character string
have a newline appended?</p>
</td></tr>
<tr><td><code id="handlers_+3A_.loggit">.loggit</code></td>
<td>
<p>Should loggit function execute? Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="handlers_+3A_echo">echo</code></td>
<td>
<p>Should loggit's log entry be echoed to the console, as well?
Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="handlers_+3A_call.">call.</code></td>
<td>
<p>logical, indicating if the call should become part of the
warning message.</p>
</td></tr>
<tr><td><code id="handlers_+3A_immediate.">immediate.</code></td>
<td>
<p>logical, indicating if the call should be output
immediately, even if <code><a href="base.html#topic+getOption">getOption</a>("warn") &lt;= 0</code>.</p>
</td></tr>
<tr><td><code id="handlers_+3A_nobreaks.">noBreaks.</code></td>
<td>
<p>logical, indicating as far as possible the message should
be output as a single line when <code>options(warn = 1)</code>.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>  if (2 &lt; 1) message("Don't say such silly things!")

  if (2 &lt; 1) warning("You may want to review that math, and so this is your warning")

  if (2 &lt; 1) stop("This is a completely false condition, which throws an error")

</code></pre>

<hr>
<h2 id='loggit'>Log entries to file</h2><span id='topic+loggit'></span>

<h3>Description</h3>

<p>This function executes immediately before the function definitions for the
base handler functions (<a href="base.html#topic+message">message</a>, <a href="base.html#topic+warning">warning</a>,
and <a href="base.html#topic+stop">stop</a>, and logs their timestamped output (a bit more
verbosely) to a log file. The log file is an
<a href="https://github.com/ndjson">ndjson</a> file, which is a portable, JSON-based
format that is easily parsed by many line-processing systems.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>loggit(log_lvl, log_msg, ..., echo = TRUE, custom_log_lvl = FALSE, sanitizer)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="loggit_+3A_log_lvl">log_lvl</code></td>
<td>
<p>Level of log output. In actual practice, one of &quot;DEBUG&quot;,
&quot;INFO&quot;, &quot;WARN&quot;, and &quot;ERROR&quot; are common, but any string may be supplied if
<code>custom_log_lvl</code> is TRUE. Will be coerced to class <code>character</code>.</p>
</td></tr>
<tr><td><code id="loggit_+3A_log_msg">log_msg</code></td>
<td>
<p>Main log message. Will be coerced to class <code>character</code>.</p>
</td></tr>
<tr><td><code id="loggit_+3A_...">...</code></td>
<td>
<p>A named <code>list</code> or named <code>vector</code> (each element of length one) of
other custom fields you wish to log. You do not need to explicitly provide
these fields as a formal list or vector, as shown in the example; R handles
the coercion.</p>
</td></tr>
<tr><td><code id="loggit_+3A_echo">echo</code></td>
<td>
<p>Should the log file entry be printed to the console as well?
Defaults to <code>TRUE</code>, and will print out the <code>ndjson</code> line to be logged. This
argument is passed as <code>FALSE</code> when called from <code>loggit</code>'s handlers, since
they still call base R's handlers at the end of execution, all of which
print to the console as well.</p>
</td></tr>
<tr><td><code id="loggit_+3A_custom_log_lvl">custom_log_lvl</code></td>
<td>
<p>Allow log levels other than &quot;DEBUG&quot;, &quot;INFO&quot;, &quot;WARN&quot;,
and &quot;ERROR&quot;? Defaults to <code>FALSE</code>, to prevent possible typos by the
developer, and to limit the variation in structured log contents. Overall,
setting this to 'TRUE&ldquo; is not recommended, but is an option for
consistency with other frameworks the user may work with.</p>
</td></tr>
<tr><td><code id="loggit_+3A_sanitizer">sanitizer</code></td>
<td>
<p>Sanitizer function to run over elements in log data. The
default sanitizer, if not specified, is <code><a href="#topic+default_ndjson_sanitizer">default_ndjson_sanitizer()</a></code>. See
the <a href="#topic+sanitizers">sanitizers</a> documentation for information on how to write your own
(un)sanitizer functions.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>  loggit("INFO", "This is a message", but_maybe = "you want more fields?",
  sure = "why not?", like = 2, or = 10, what = "ever")

</code></pre>

<hr>
<h2 id='read_logs'>Return log file as an R data frame</h2><span id='topic+read_logs'></span>

<h3>Description</h3>

<p>This function returns a <code>data.frame</code> containing all the logs in the provided
<code>ndjson</code> log file. If no explicit log file is provided, calling this function
will return a data frame of the log file currently pointed to by the <code>loggit</code>
functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_logs(logfile, unsanitizer)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="read_logs_+3A_logfile">logfile</code></td>
<td>
<p>Path to log file. Will default to currently-set log file.</p>
</td></tr>
<tr><td><code id="read_logs_+3A_unsanitizer">unsanitizer</code></td>
<td>
<p>Unsanitizer function to use. For more info on sanitizers,
please see the <a href="#topic+sanitizers">sanitizers</a> section of the package documentation.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>data.frame</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  set_logfile(file.path(tempdir(), "loggit.log"), confirm = FALSE)
  message("Test log message")
  read_logs()

</code></pre>

<hr>
<h2 id='read_ndjson'>Read ndJSON-formatted log file</h2><span id='topic+read_ndjson'></span>

<h3>Description</h3>

<p>Read ndJSON-formatted log file
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_ndjson(logfile, unsanitizer)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="read_ndjson_+3A_logfile">logfile</code></td>
<td>
<p>Log file to read from, and convert to a <code>data.frame</code>.</p>
</td></tr>
<tr><td><code id="read_ndjson_+3A_unsanitizer">unsanitizer</code></td>
<td>
<p>Unsanitizer function passed in from <code><a href="#topic+read_logs">read_logs()</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>data.frame</code>
</p>

<hr>
<h2 id='rotate_logs'>Rotate log file</h2><span id='topic+rotate_logs'></span>

<h3>Description</h3>

<p>Truncates the log file to the line count provided as <code>rotate_lines</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rotate_logs(rotate_lines = 1e+05, logfile)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rotate_logs_+3A_rotate_lines">rotate_lines</code></td>
<td>
<p>The number of log entries to keep in the logfile.
Defaults to 100,000.</p>
</td></tr>
<tr><td><code id="rotate_logs_+3A_logfile">logfile</code></td>
<td>
<p>Log file to truncate. Defaults to the currently-configured log
file.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>loggit</code> makes no assumptions nor enforcement of calling this function; that
is to say, the onus of log rotation is up to the developer. You
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  # Truncate "default" log file to 100 lines
  set_logfile()
  for (i in 1:150) {loggit("INFO", i, echo = FALSE)}
  rotate_logs(100)
  
  # Truncate a different log file to 250 lines
  another_log &lt;- file.path(tempdir(), "another.log")
  set_logfile(another_log)
  for (i in 1:300) {loggit("INFO", i, echo = FALSE)}
  set_logfile() # clears pointer to other log file
  rotate_logs(250, another_log)

</code></pre>

<hr>
<h2 id='sanitizers'>Default sanitization for ndJSON.</h2><span id='topic+sanitizers'></span><span id='topic+default_ndjson_sanitizer'></span><span id='topic+default_ndjson_unsanitizer'></span>

<h3>Description</h3>

<p>This is the default ndJSON sanitizer function for log data being read into
the R session by <code><a href="#topic+read_logs">read_logs()</a></code>. This type of function is needed because since
<code>loggit</code> reimplements its own string-based JSON parser, and not a fancy one
built from an AST or something, it's very easy to have bad patterns break
your logs. You may also specify your own sanitizer function to pass to
<code><a href="#topic+loggit">loggit()</a></code>, which takes a single string and returns an
(optionally-transformed) string, where each string is an individual element
of the log data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>default_ndjson_sanitizer(string, sanitize = TRUE)

default_ndjson_unsanitizer(string)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sanitizers_+3A_string">string</code></td>
<td>
<p>Each element of the log data to operate on. Note that this is
<em>each element</em>, not each line in the logs. For example, each entry in the
<code>log_msg</code> field across all logs will be sanitized/unsanitized individually.
This is important because if writing your own sanitizer function, it must
<em><strong>take and return a single string</strong></em> as its argument.</p>
</td></tr>
<tr><td><code id="sanitizers_+3A_sanitize">sanitize</code></td>
<td>
<p>Whether the operation will sanitize, or unsanitize the log
data. Defaults to <code>TRUE</code>, for sanitization on write.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The default string patterns and their replacements are currently mapped as
follows:</p>

<table>
<tr>
 <td style="text-align: left;">
   Character </td><td style="text-align: left;"> Replacement in log file </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code style="white-space: pre;">&#8288;{&#8288;</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288;__LEFTBRACE__&#8288;</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code style="white-space: pre;">&#8288;}&#8288;</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288;__RIGHTBRACE__&#8288;</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code style="white-space: pre;">&#8288;"&#8288;</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288;__DBLQUOTE__&#8288;</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code style="white-space: pre;">&#8288;,&#8288;</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288;__COMMA__&#8288;</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code style="white-space: pre;">&#8288;\r&#8288;</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288;__CR__&#8288;</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
   <code style="white-space: pre;">&#8288;\n&#8288;</code> </td><td style="text-align: left;"> <code style="white-space: pre;">&#8288;__LF__&#8288;</code> </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Value</h3>

<p>A single string.
</p>

<hr>
<h2 id='set_logfile'>Set Log File</h2><span id='topic+set_logfile'></span>

<h3>Description</h3>

<p>Set the log file that loggit will write to. No logs outside of a temporary
directory will be written until this is set explicitly, as per CRAN policy.
Therefore, the default behavior is to create a file named <code>loggit.log</code> in
your system's temporary directory.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_logfile(logfile = NULL, confirm = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_logfile_+3A_logfile">logfile</code></td>
<td>
<p>Full or relative path to log file. If not provided, will write
to <code style="white-space: pre;">&#8288;&lt;tmpdir&gt;/loggit.log&#8288;</code>.</p>
</td></tr>
<tr><td><code id="set_logfile_+3A_confirm">confirm</code></td>
<td>
<p>Print confirmation of log file setting? Defaults to <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A suggested use of this function would be to call it early, to log to the
current working directory, as follows: <code>set_logfile(paste0(getwd(), "/loggit.log"))</code>. If you are using <code>loggit</code> in your package, you can wrap
this function in <code>.onLoad()</code> so that the logfile is set when your package
loads.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set_logfile(file.path(tempdir(), "loggit.log"))

</code></pre>

<hr>
<h2 id='set_timestamp_format'>Set Timestamp Format</h2><span id='topic+set_timestamp_format'></span>

<h3>Description</h3>

<p>Set timestamp format for use in output logs. This function performs no time
format validations, but will echo out the current time in the provided format
for manual validation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_timestamp_format(ts_format = "%Y-%m-%dT%H:%M:%S%z", confirm = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_timestamp_format_+3A_ts_format">ts_format</code></td>
<td>
<p>ISO date format. Defaults to ISO-8601 (e.g.
&quot;2020-01-01T00:00:00+0000&quot;).</p>
</td></tr>
<tr><td><code id="set_timestamp_format_+3A_confirm">confirm</code></td>
<td>
<p>Print confirmation message of timestamp format? Defaults to
<code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function provides no means of setting a timezone, and instead relies on
the host system's time configuration to provide this. This is to enforce
consistency across software running on the host.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set_timestamp_format("%Y-%m-%d %H:%M:%S")

</code></pre>

<hr>
<h2 id='write_ndjson'>Write ndJSON-formatted log file</h2><span id='topic+write_ndjson'></span>

<h3>Description</h3>

<p>Write ndJSON-formatted log file
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_ndjson(log_df, logfile, echo = TRUE, overwrite = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="write_ndjson_+3A_log_df">log_df</code></td>
<td>
<p>Data frame of log data. Rows are converted to <code>ndjson</code> entries,
with the columns as the fields.</p>
</td></tr>
<tr><td><code id="write_ndjson_+3A_logfile">logfile</code></td>
<td>
<p>Log file to write to. Defaults to currently-configured log
file.</p>
</td></tr>
<tr><td><code id="write_ndjson_+3A_echo">echo</code></td>
<td>
<p>Echo the <code>ndjson</code> entry to the R console? Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="write_ndjson_+3A_overwrite">overwrite</code></td>
<td>
<p>Overwrite previous log file data? Defaults to <code>FALSE</code>, and
so will append new log entries to the log file.</p>
</td></tr>
</table>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
