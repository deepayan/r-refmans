<!DOCTYPE html><html lang="en"><head><title>Help for package changepoint.influence</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {changepoint.influence}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#changepoint.influence-package'>
<p>Package to Calculate the Influence of the Data on a Changepoint Segmentation</p></a></li>
<li><a href='#influence-methods'><p> ~~ Methods for Function influence  ~~</p></a></li>
<li><a href='#InfluenceMap'>
<p>Influence Map Graphic</p></a></li>
<li><a href='#LocationStability'>
<p>Location Stability Graphic</p></a></li>
<li><a href='#ParameterStability'>
<p>Parameter Stability Graphic</p></a></li>
<li><a href='#StabilityOverview'>
<p>Stability Overview Graphic</p></a></li>
<li><a href='#welldata'>
<p>Welllog data</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Package to Calculate the Influence of the Data on a Changepoint
Segmentation</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.2</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-02-19</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Rebecca Killick &lt;r.killick@lancs.ac.uk&gt;</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/rkillick/changepoint.influence/issues">https://github.com/rkillick/changepoint.influence/issues</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/rkillick/changepoint.influence/">https://github.com/rkillick/changepoint.influence/</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>data.table, ggplot2, gridExtra, reshape, graphics, methods</td>
</tr>
<tr>
<td>Depends:</td>
<td>R(&ge; 3.6), changepoint</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat, vdiffr</td>
</tr>
<tr>
<td>Description:</td>
<td>Allows users to input their data, segmentation and function used for the segmentation (and additional arguments) and the package calculates the influence of the data on the changepoint locations, see Wilms et al. (2022) &lt;<a href="https://doi.org/10.1080%2F10618600.2021.2000873">doi:10.1080/10618600.2021.2000873</a>&gt;.  Currently this can only be used with the changepoint package functions to identify changes, but we plan to extend this.  There are options for different types of graphics to assess the influence.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL]</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-02-19 21:16:48 UTC; killick</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Author:</td>
<td>Rebecca Killick [aut, cre],
  Ines Wilms [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-02-20 02:20:07 UTC</td>
</tr>
</table>
<hr>
<h2 id='changepoint.influence-package'>
Package to Calculate the Influence of the Data on a Changepoint Segmentation
</h2><span id='topic+changepoint.influence-package'></span><span id='topic+changepoint.influence'></span>

<h3>Description</h3>

<p>Allows users to input their data, segmentation and function used for the segmentation (and additional arguments) and the package calculates the influence of the data on the changepoint locations, see Wilms et al. (2022) &lt;doi:10.1080/10618600.2021.2000873&gt;.  Currently this can only be used with the changepoint package functions to identify changes, but we plan to extend this.  There are options for different types of graphics to assess the influence.
</p>


<h3>Details</h3>

<p>The DESCRIPTION file:
</p>

<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> changepoint.influence</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Title: </td><td style="text-align: left;"> Package to Calculate the Influence of the Data on a Changepoint Segmentation</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.0.2</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2024-02-19</td>
</tr>
<tr>
 <td style="text-align: left;">
Authors@R: </td><td style="text-align: left;"> c(person("Rebecca", "Killick", role=c("aut","cre"),email="r.killick@lancs.ac.uk"),
        person("Ines", "Wilms", role="aut"))</td>
</tr>
<tr>
 <td style="text-align: left;">
Maintainer: </td><td style="text-align: left;"> Rebecca Killick &lt;r.killick@lancs.ac.uk&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
BugReports: </td><td style="text-align: left;"> https://github.com/rkillick/changepoint.influence/issues</td>
</tr>
<tr>
 <td style="text-align: left;">
URL: </td><td style="text-align: left;"> https://github.com/rkillick/changepoint.influence/</td>
</tr>
<tr>
 <td style="text-align: left;">
Imports: </td><td style="text-align: left;"> data.table, ggplot2, gridExtra, reshape, graphics, methods</td>
</tr>
<tr>
 <td style="text-align: left;">
Depends: </td><td style="text-align: left;"> R(&gt;= 3.6), changepoint</td>
</tr>
<tr>
 <td style="text-align: left;">
Suggests: </td><td style="text-align: left;"> testthat, vdiffr</td>
</tr>
<tr>
 <td style="text-align: left;">
Description: </td><td style="text-align: left;"> Allows users to input their data, segmentation and function used for the segmentation (and additional arguments) and the package calculates the influence of the data on the changepoint locations, see Wilms et al. (2022) &lt;doi:10.1080/10618600.2021.2000873&gt;.  Currently this can only be used with the changepoint package functions to identify changes, but we plan to extend this.  There are options for different types of graphics to assess the influence.</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL</td>
</tr>
<tr>
 <td style="text-align: left;">
LazyData: </td><td style="text-align: left;"> true</td>
</tr>
<tr>
 <td style="text-align: left;">
Packaged: </td><td style="text-align: left;"> 2024-02-19 15:55:29 UTC; killick</td>
</tr>
<tr>
 <td style="text-align: left;">
Author: </td><td style="text-align: left;"> Rebecca Killick [aut, cre],
  Ines Wilms [aut]</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>


<p>Index of help topics:
</p>
<pre>
InfluenceMap            Influence Map Graphic
LocationStability       Location Stability Graphic
ParameterStability      Parameter Stability Graphic
StabilityOverview       Stability Overview Graphic
changepoint.influence-package
                        Package to Calculate the Influence of the Data
                        on a Changepoint Segmentation
welldata                Welllog data
</pre>
<p>The package allows users to input their data, segmentation and function used for the segmentation (and additional arguments) and the package calculates the influence of the data on the changepoint locations.
</p>
<p>The influence() function is the first port of call to calculate the influence.  We provide two methods for influence detection, via &quot;delete&quot; and &quot;outlier&quot; options which respectively consider the effect of deleting a data point or making it an outlier.  Currently we provide this method for cpt objects (as generated by the &quot;changepoint&quot; package) but plan to extend this to other objects in the future.  Please add requests for objects to include to our github issues.
</p>
<p>Users are encouraged to explore the documentation for the StabilityOverview() graphic, followed by the LocationStability() and ParameterStability() graphics for a more granual view, followed by the InfluenceMap() as the highest level of detail.
</p>


<h3>Author(s)</h3>

<p>Rebecca Killick [aut, cre],
  Ines Wilms [aut]
</p>
<p>Maintainer: Rebecca Killick &lt;r.killick@lancs.ac.uk&gt;
</p>


<h3>References</h3>

<p>Wilms I, Killick R, Matteson DS (2022) Graphical Influence Diagnostics for Changepoint Models, <em>Journal of Computational and Graphical Statistics</em>,  <b>31:3</b>, 753&ndash;765 <em>DOI: 10.1080/10618600.2021.2000873</em></p>


<h3>See Also</h3>

<p><code><a href="#topic+influence-methods">influence-methods</a></code>,<code><a href="#topic+StabilityOverview">StabilityOverview</a></code>,
<code><a href="#topic+LocationStability">LocationStability</a></code>, <code><a href="#topic+ParameterStability">ParameterStability</a></code>, <code><a href="#topic+InfluenceMap">InfluenceMap</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#### Load the data in the R package changepoint.influence ####
data("welldata")
welllog = welldata[1001:2000] # Extract the mid section of the data as analyzed in other papers
n = length(welllog)
var = NULL; for (i in 30:1000){var[i]=var(welllog[(i-29):i])} 
welllogs = welllog/sqrt(median(var, na.rm = TRUE)) 
# rescale the data to have unit variance across time, 
# note that there may still be changes in variance across the series.

#### Apply PELT to the welllog data ####
out.PELT = cpt.mean(welllogs, method = 'PELT')

#### Calculate the influence measures ####
welllogs.inf = influence(out.PELT) 
# the code extracts all the details of the original cpt.mean() function call 
# and uses these in the calculation of the influence for the modified data.

#### Stability Dashboards ####
StabilityOverview(welllogs, cpts(out.PELT), welllogs.inf, las = 1,ylab='Nuclear-Magnetic Response',
  legend.args=list(display=TRUE,x="bottomright",y=NULL,cex=1.5,bty="n",horiz=FALSE,xpd=FALSE))
# We can specify where the legend will sit in the graphic via the legend.args
# which are passed to the legend() function.  We can also include additional arguments
# to pass to the plotting such as las=1 here.

#### Location Stability plot ####
exp.seg=LocationStability(cpts(out.PELT), welllogs.inf, type = 'Difference', cpt.lwd = 4, las = 1)
# Note that if the expected segmentation is not provided, it will be calcuated and then
# returned so that the user can avoid calculating this again in other plot calls.

#### Parameter Stability plot ####
ParameterStability(welllogs.inf, original.mean = rep(param.est(out.PELT)$mean, 
  times=diff(c(0,out.PELT@cpts))), las = 1, ylab = 'Nuclear-Magnetic Response')
# Note that the original.mean argument is provided for each timepoint so is a length n vector.


#### Influence Map ####
## Not run: 
library(ggplot2)
welllogs.inf = influence(out.PELT, method = "delete")
InfluenceMap(cpts(out.PELT),welllogs.inf,data=welllogs,include.data=TRUE,
    ylab='Nuclear-Magnetic\n Response',
    ggops=theme(axis.text=element_text(size=15),axis.title=element_text(size=20),
      plot.title=element_text(size=25)))
# The InfluenceMap uses ggplot2 functions, thus you can add theme options via the ggops argument.
# Here we change the text sizes to ensure readable titles and labels for a report.

welllogs.inf = influence(out.PELT, method = "outlier")
InfluenceMap(cpts(out.PELT), welllogs.inf, data = welllogs, include.data = TRUE, 
    ylab='Nuclear-Magnetic\n Response')

## End(Not run)
</code></pre>

<hr>
<h2 id='influence-methods'> ~~ Methods for Function influence  ~~</h2><span id='topic+influence-methods'></span><span id='topic+influence+2Ccpt-method'></span>

<h3>Description</h3>

<p>~~ Methods for function <code>influence</code>  ~~
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'cpt'
influence(model,method=c("delete","outlier"),pos=TRUE,same=FALSE,sd=0.01)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="influence-methods_+3A_model">model</code></td>
<td>

<p>Depending on the class of <code>model</code> depends on the method used (and if one exists).  For <code>cpt</code> objects this is the original output from a call to the <code>cpt.*()</code> suite of functions in the &quot;changepoint&quot; package.
</p>
</td></tr>
<tr><td><code id="influence-methods_+3A_method">method</code></td>
<td>

<p>Either <code>"delete"</code> or <code>"outlier"</code>.  These control what happens to the individual observations when the data is perturbed. See details for further information on the difference between the two.
</p>
</td></tr>
<tr><td><code id="influence-methods_+3A_pos">pos</code></td>
<td>
<p>For <code>method="outlier"</code> this is whether the outlier is positive (TRUE) or negative (FALSE).</p>
</td></tr>
<tr><td><code id="influence-methods_+3A_same">same</code></td>
<td>
<p>For <code>method="outlier"</code> and multiple outliers, this is whether we want the outliers to have the same mean (TRUE) (takes the first outlier, adds 2*range(data), then jitters the others around this value) or whether we add 2*range(data) to the existing value of each datapoint (FALSE).</p>
</td></tr>
<tr><td><code id="influence-methods_+3A_sd">sd</code></td>
<td>
<p>For <code>method="outlier"</code>, the standard deviation of the jitter, see <code>same</code> argument.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Calculates the influence of the data on the observed segmentation.  There are currently two methods implemented for this <code>method="delete"</code> and <code>method="outlier"</code>.
</p>
<p>Both methods sequentially take each data point, modify it and then run the same changepoint algorithm on the modified data as the original data.  We record the new segmentations in an nxn matrix output of the segment number for each location 1,...,n for each of the 1,...,n data modifications.
</p>
<p>If a datapoint has no undue influence on the overall segmentation then the segmentation with that datapoint modified will be the same as the original segmentation.  We define undue influence as any unexpected variation in the segmentations when data points are modified.
</p>
<p>The <code>method="delete"</code> modifies a datapoint by deleting it.  This is recorded as an NA value in the returned nxn matrix to preserve indexing.  The <code>method="outlier"</code> modifies a datapoint by making it an outlier (+/- 2*range(data)).  When we make a datapoint an outlier we force it to be in its own segment and thus expect to introduce two new changepoints to the resulting segmentation.
</p>


<h3>Value</h3>

<p>A list containing the following elements:
</p>
<p>$delete, if the <code>modify="delete"</code>
$class.del, an nxn matrix of the class at each time point (NA along the diagonal) 
$param.del, an nxn matrix of the parameter at each time point (NA along the diagonal)
$outlier, if the <code>modify="outlier"</code>
$class.out, an nxn matrix of the class at each time point (NA along the diagonal) 
$param.out, an nxn matrix of the parameter at each time point (NA along the diagonal)
</p>


<h3>Methods</h3>


<dl>
<dt><code>signature(model = "cpt",method=c("delete","outlier"),pos=TRUE,same=FALSE,sd=0.01)</code></dt><dd>
<p>For <code>model="cpt"</code> objects this is the original output from a call to the <code>cpt.*()</code> suite of functions in the &quot;changepoint&quot; package.
</p>
</dd>
</dl>


<h3>See Also</h3>

<p><code><a href="#topic+StabilityOverview">StabilityOverview</a></code>, <code><a href="#topic+LocationStability">LocationStability</a></code>,<code><a href="#topic+ParameterStability">ParameterStability</a></code>,<code><a href="#topic+InfluenceMap">InfluenceMap</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#### Generate Simulated data example ####
set.seed(30)
x = c(rnorm(50), rnorm(50, mean = 5), rnorm(1, mean = 15), rnorm(49, mean = 5), rnorm(50, mean = 4))
xcpt = cpt.mean(x,method='PELT') # Get the changepoints via PELT

#### Get the influence for both delete and outlier options ####
x.inf = influence(xcpt)

#### Get the influence using delete method ####
x.inf = influence(xcpt, method="delete")

#### Get the influence using outlier method ####
x.inf = influence(xcpt, method="outlier", pos=FALSE,same=FALSE) 
# no sd required as no jitter used.

</code></pre>

<hr>
<h2 id='InfluenceMap'>
Influence Map Graphic
</h2><span id='topic+InfluenceMap'></span>

<h3>Description</h3>

<p>Plots the highest detail level of the changepoint location stability according to the influence measure.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>InfluenceMap(original.cpts, influence, resid=NULL,data=NULL,include.data=FALSE,
influence.col=c("#0C4479","white","#AB9783"),cpt.col=c("#009E73", "#E69F00", "#E41A1C"),
cpt.lty=c("dashed","dotdash","dotted"),ylab='',ggops=NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="InfluenceMap_+3A_original.cpts">original.cpts</code></td>
<td>

<p>An ordered vector of the changepoint locations found by your favourite changepoint method.
</p>
</td></tr>
<tr><td><code id="InfluenceMap_+3A_influence">influence</code></td>
<td>

<p>The influence as calculated the <code>influence()</code> function provided within this package.  This is a list object.
</p>
</td></tr>
<tr><td><code id="InfluenceMap_+3A_resid">resid</code></td>
<td>

<p>An nxn matrix containing the difference of the observed class (<code>influence</code>) from the expected class at each datapoint.  If this is left as <code>NULL</code>, it will be calculated and returned to the user.
</p>
</td></tr>
<tr><td><code id="InfluenceMap_+3A_data">data</code></td>
<td>

<p>A vector containing the data on which you have run your changepoint method.
</p>
</td></tr>
<tr><td><code id="InfluenceMap_+3A_include.data">include.data</code></td>
<td>

<p>Is a plot of the data to be included above the histogram.  Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="InfluenceMap_+3A_influence.col">influence.col</code></td>
<td>

<p>A length 3 vector giving the lower, middle (0) and upper bounds for the influence map colour grading.  Note that you should choose these colours to not conflict with the colours used for <code>cpt.col</code>.  We advise using &quot;white&quot; for the middle choice as this provides a clean (majority white) heatmap.
</p>
</td></tr>
<tr><td><code id="InfluenceMap_+3A_cpt.col">cpt.col</code></td>
<td>

<p>Colour of the <code>original.cpts</code> lines when plotted.  We need three colours specified here, corresponding to the &quot;stable&quot;, &quot;unstable&quot; and &quot;outlier&quot; categories respectively. These are plotted on the Influence Map as well as the original data if <code>include.data=TRUE</code>.  Any values accepted by the <code>col</code> plotting argument are allowed.
</p>
</td></tr>
<tr><td><code id="InfluenceMap_+3A_cpt.lty">cpt.lty</code></td>
<td>

<p>Line type of the <code>original.cpts</code> lines when plotted.  We need three line types specified here, corresponding to the &quot;stable&quot;, &quot;unstable&quot; and &quot;outlier&quot; categories respectively.  Any values accepted by the <code>lty</code> plotting argument are allowed. Only used if <code>include.data=TRUE</code>.
</p>
</td></tr>
<tr><td><code id="InfluenceMap_+3A_ylab">ylab</code></td>
<td>

<p>The label for the y-axis, character vector expected.
</p>
</td></tr>
<tr><td><code id="InfluenceMap_+3A_ggops">ggops</code></td>
<td>

<p>Any other settings to be passed to the <code>ggplot()</code> function.  Note that you will need to <code>library(ggplot2)</code> if calling ggplot functions in arguments. See examples.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function creates the highest detail graphic to display the results of a changepoint influence analysis on the location of the changepoints.  The graphic is an nxn heatmap of the difference between the observed segmentations under the &quot;delete&quot; or &quot;outlier&quot; Influence analysis and the expected segmentation.  Note that the expected segmentations take into account the fact that a changepoint at a timepoint, say 100, will move (to 99) when a timepoint prior to it is deleted and that adding an outlier will introduce new changepoints.
</p>
<p>Datapoints on  the  vertical  axis  without  a  single  coloured  co-ordinate  on  the  horizontal  axis  can  be considered as non-influential since they do not trigger any changepoint instability.  Rows with coloured pixels correspond to data points which are instability triggers.
</p>
<p>How to interpret the Influence Map (please also read the paper in the references for fuller details):
</p>

<dl>
<dt>colouring:</dt><dd><p>Colouring above the diagonal indicates that an al-teration of the corresponding data point (on the vertical axis) affects earlier data points,colouring below the diagonal indicates that subsequent data points are affected.</p>
</dd>
<dt>horizonal span:</dt><dd><p>A stop in colouring indicates that change-points have moved, while a continuation of colouring to the last data point indicates that, in  total,  fewer  or  additional  changepoints  are  detected.</p>
</dd>
<dt>local vs global:</dt><dd><p>Most colouring originates on the diagonal,thereby indicating that a data point's alteration mainly affects neighbouring data points that most often belong to the same segment.  By contrast, in some cases a coloured pixel may  originate  away  from  the  diagonal,  thereby  exercising  global  influence.</p>
</dd>
<dt>height:</dt><dd><p>All data points (on the vertical axis) that appear in the  coloured area are influential and assert influence over the corresponding data points on the horizontal axis.  The height can be seen as the extent to which instability arises in this influential region.</p>
</dd>
</dl>



<h3>Value</h3>

<p>The function returns a plot denoted the Influence Map. If <code>resid=NULL</code> then the residuals (observed class - expected class) are also returned.
</p>


<h3>Author(s)</h3>

<p>Rebecca Killick
</p>


<h3>References</h3>

<p>Wilms I, Killick R, Matteson DS (2022) Graphical Influence Diagnostics for Changepoint Models, <em>Journal of Computational and Graphical Statistics</em>,  <b>31:3</b>, 753&ndash;765 <em>DOI: 10.1080/10618600.2021.2000873</em></p>


<h3>See Also</h3>

<p><code><a href="#topic+influence-methods">influence-methods</a></code>, <code><a href="#topic+StabilityOverview">StabilityOverview</a></code>, <code><a href="#topic+ParameterStability">ParameterStability</a></code>, <code><a href="#topic+LocationStability">LocationStability</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#### Generate Simulated data example ####
set.seed(30)
x=c(rnorm(50),rnorm(50,mean=5),rnorm(1,mean=15),rnorm(49,mean=5),rnorm(50,mean=4))
xcpt = cpt.mean(x,method='PELT') # Get the changepoints via PELT


#### Influence Map ####
## Not run: 
library(ggplot2)
x.inf = influence(xcpt, method = "delete")
InfluenceMap(cpts(xcpt), x.inf, data = x, include.data = TRUE, 
   ggops = theme(axis.text = element_text(size=15), axis.title = element_text(size=20),
   plot.title = element_text(size=25)))


x.inf = influence(xcpt, method = "outlier")
InfluenceMap(cpts(xcpt), x.inf, data=x, include.data = TRUE,
    ggops = theme(axis.text = element_text(size=15), axis.title = element_text(size=20),
    plot.title = element_text(size=25)))

## End(Not run)
</code></pre>

<hr>
<h2 id='LocationStability'>
Location Stability Graphic
</h2><span id='topic+LocationStability'></span>

<h3>Description</h3>

<p>Plots the middle detail level of the changepoint location stability according to the influence measure.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>LocationStability(original.cpts, influence, expected.class=NULL,
  type=c("Difference","Global","Local"),data=NULL,include.data=FALSE,cpt.lwd=4,
  cpt.col=c("#009E73", "#E69F00", "#E41A1C"),cpt.lty=c("dashed","dotdash","dotted"),
  ylab='',xlab='Index',...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="LocationStability_+3A_original.cpts">original.cpts</code></td>
<td>

<p>An ordered vector of the changepoint locations found by your favourite changepoint method.
</p>
</td></tr>
<tr><td><code id="LocationStability_+3A_influence">influence</code></td>
<td>

<p>The influence as calculated the <code>influence()</code> function provided within this package.  This is a list object.
</p>
</td></tr>
<tr><td><code id="LocationStability_+3A_expected.class">expected.class</code></td>
<td>

<p>Only needed for <code>type="Difference"</code>.  An nxn matrix containing the expected class of each datapoint from the <code>original.cpts</code> segmentation under perturbation of each datapoint.  If this is left as <code>NULL</code> and <code>type="Difference"</code>, it will be calculated and returned to the user.
</p>
</td></tr>
<tr><td><code id="LocationStability_+3A_type">type</code></td>
<td>

<p>The type of Location Stability plot, can be <code>"Difference"</code>, <code>"Global"</code> or <code>"Local"</code>.  If all three are listed (as in the default) then three graphs will be plotted.  <code>type="Difference"</code> will histogram the difference between the observed and expected segmentations at each of the datapoints. <code>type="Global"</code> will histogram the observed segmentations. <code>type="Local"</code> will histogram the observed segmentations with the <code>original.cpts</code> locations removed.  See details for more description of the graphics.
</p>
</td></tr>
<tr><td><code id="LocationStability_+3A_data">data</code></td>
<td>

<p>A vector containing the data on which you have run your changepoint method.
</p>
</td></tr>
<tr><td><code id="LocationStability_+3A_include.data">include.data</code></td>
<td>

<p>Is a plot of the data to be included above the histogram.  Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="LocationStability_+3A_cpt.lwd">cpt.lwd</code></td>
<td>

<p>The line width to be used when plotting the <code>original.cpts</code> on the <code>data</code>. Standard <code>lwd</code> values allowed. A single value is expected.
</p>
</td></tr>
<tr><td><code id="LocationStability_+3A_cpt.col">cpt.col</code></td>
<td>

<p>Colour of the <code>original.cpts</code> lines when plotted.  We need three colours specified here, corresponding to the &quot;stable&quot;, &quot;unstable&quot; and &quot;outlier&quot; categories respectively. Any values accepted by the <code>col</code> plotting argument are allowed.
</p>
</td></tr>
<tr><td><code id="LocationStability_+3A_cpt.lty">cpt.lty</code></td>
<td>

<p>Line type of the <code>original.cpts</code> lines when plotted.  We need three line types specified here, corresponding to the &quot;stable&quot;, &quot;unstable&quot; and &quot;outlier&quot; categories respectively.  Any values accepted by the <code>lty</code> plotting argument are allowed.
</p>
</td></tr>
<tr><td><code id="LocationStability_+3A_ylab">ylab</code>, <code id="LocationStability_+3A_xlab">xlab</code></td>
<td>

<p>The labels for the x- and y-axis, character vector expected.
</p>
</td></tr>
<tr><td><code id="LocationStability_+3A_...">...</code></td>
<td>

<p>Any other arguments to be passed to the <code>plot()</code> or equivalently <code>hist()</code> function.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function creates a more granular graphic to display the results of a changepoint influence analysis on the location of the changepoints.  The graphic is a histogram of the observed segmentations under the &quot;delete&quot; or &quot;outlier&quot; Influence analysis.  The colour and line type of the bars at the <code>original.cpts</code> locations reflect their stability.  The first value of their arguments denotes a stable changepoint - which appears at the same location in all influence segmentations.  The second argument denotes an unstable changepoint - which doesn't appear at the same location in all influence segmentations, either it moves or is deleted. The third argument denotes changepoint locations which are deemed outliers as two changepoints occur at consecutive locations (surrounding the outlying observation).  Please note that the <code>type="Global"</code> only uses colour and not line type.
</p>
<p><code>type="Difference"</code> gives the difference between the observed and expected changepoint segmentations under the &quot;delete&quot; or &quot;outlier&quot; Influence analysis.  A positive value can only occur where a changepoint is contained in the observed segmentations but is not present in the expected (an additional changepoint time).  A negative value can only occur at the original changepoint location where the changepoint is not present in atleast one of the observed segmentations.  Note that the expected segmentations take into account the fact that a changepoint at a timepoint, say 100, will move (to 99) when a timepoint prior to it is deleted.
</p>
<p><code>type="Global"</code> histograms the observed segmentations.  Colour is added to the original changepoint locations and a horizontal (light grey) line is added to the plot to denote the maximum count.  Any original changepoint bars that do not meet this grey line indicates that the changepoint is unstable as it either moves or is deleted in atleast one of the observed segmentations.  For large datasets this can be difficult to view what is going on at any locations that appear as black bars as these are typically small counts.  Hence the inclusion of the &quot;Local&quot; option.
</p>
<p><code>type="Local"</code> histograms the observed segmentations with the original changepoint locations removed.  This is to allow users to see the smaller counts that can be masked in larger datasets.  These are the locations where either original changepoints move to or additional changepoints are added.
</p>


<h3>Value</h3>

<p>The function returns plot(s) and a list containing the labels of the <code>original.cpts</code> as either &quot;stable&quot;, &quot;unstable&quot;, or &quot;outlier&quot;.  If <code>type="Difference"</code> and <code>expected.class=NULL</code> then the expected class is also returned as the first element of the list.
</p>


<h3>Author(s)</h3>

<p>Rebecca Killick
</p>


<h3>References</h3>

<p>Wilms I, Killick R, Matteson DS (2022) Graphical Influence Diagnostics for Changepoint Models, <em>Journal of Computational and Graphical Statistics</em>,  <b>31:3</b>, 753&ndash;765 <em>DOI: 10.1080/10618600.2021.2000873</em></p>


<h3>See Also</h3>

<p><code><a href="#topic+influence-methods">influence-methods</a></code>, <code><a href="#topic+StabilityOverview">StabilityOverview</a></code>,<code><a href="#topic+ParameterStability">ParameterStability</a></code>,<code><a href="#topic+InfluenceMap">InfluenceMap</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#### Generate Simulated data example ####
set.seed(30)
x = c(rnorm(50), rnorm(50, mean = 5), rnorm(1, mean = 15), rnorm(49, mean = 5), rnorm(50, mean = 4))
xcpt = cpt.mean(x,method='PELT') # Get the changepoints via PELT

#### Get the influence for both delete and outlier options ####
x.inf = influence(xcpt)


#### Location Stability Difference plot ####
exp.class=LocationStability(cpts(xcpt), type = 'Difference', x.inf, cpt.lwd = 4, las = 1)
# note that the expected.class is also returned

#### Location Stability Global plot ####
exp.class=LocationStability(cpts(xcpt), type = 'Global', x.inf, cpt.lwd = 4, las = 1)

#### Location Stability Local plot ####
exp.class=LocationStability(cpts(xcpt), type = 'Local', x.inf, cpt.lwd = 4, las = 1)
</code></pre>

<hr>
<h2 id='ParameterStability'>
Parameter Stability Graphic
</h2><span id='topic+ParameterStability'></span>

<h3>Description</h3>

<p>Plots the middle detail level of the changepoint parameter stability according to the influence measure.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ParameterStability(influence,original.mean=NULL,digits=6,ylab='',xlab='Index',
  cpt.col='red',cpt.width=3,...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ParameterStability_+3A_influence">influence</code></td>
<td>

<p>The influence as calculated the <code>influence()</code> function provided within this package.  This is a list object.
</p>
</td></tr>
<tr><td><code id="ParameterStability_+3A_original.mean">original.mean</code></td>
<td>

<p>A vector, <em>length n</em>, of the mean under the original segmentation at each timepoint.
</p>
</td></tr>
<tr><td><code id="ParameterStability_+3A_digits">digits</code></td>
<td>

<p>The number of significant figures to round the mean values to before plotting.  (Purely to reduce the number of points plotted to make the graphics smaller for storage and loading)
</p>
</td></tr>
<tr><td><code id="ParameterStability_+3A_ylab">ylab</code>, <code id="ParameterStability_+3A_xlab">xlab</code></td>
<td>

<p>The labels for the x- and y-axis, character vector expected.
</p>
</td></tr>
<tr><td><code id="ParameterStability_+3A_cpt.col">cpt.col</code></td>
<td>

<p>Colour of the original parameter vector when plotted. Any values accepted by the <code>col</code> plotting argument are allowed.
</p>
</td></tr>
<tr><td><code id="ParameterStability_+3A_cpt.width">cpt.width</code></td>
<td>

<p>Width of the original parameter vector when plotted. Any values accepted by the <code>lwd</code> plotting argument are allowed.
</p>
</td></tr>
<tr><td><code id="ParameterStability_+3A_...">...</code></td>
<td>

<p>Any other arguments to be passed to the <code>plot()</code> function.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function creates a more granular graphic to display the results of a changepoint influence analysis on the estimated segment parameter.  The graphic depicts the observed segment parameters under the &quot;delete&quot; or &quot;outlier&quot; Influence analysis.  The intensity of the grey denotes how often that parameter values was seen across all segmentations.  We overlay this with the original segment parameters.
</p>


<h3>Value</h3>

<p>The function returns a plot (silently).
</p>


<h3>Author(s)</h3>

<p>Rebecca Killick
</p>


<h3>References</h3>

<p>Wilms I, Killick R, Matteson DS (2022) Graphical Influence Diagnostics for Changepoint Models, <em>Journal of Computational and Graphical Statistics</em>,  <b>31:3</b>, 753&ndash;765 <em>DOI: 10.1080/10618600.2021.2000873</em></p>


<h3>See Also</h3>

<p><code><a href="#topic+influence-methods">influence-methods</a></code>, <code><a href="#topic+StabilityOverview">StabilityOverview</a></code>,<code><a href="#topic+LocationStability">LocationStability</a></code>,<code><a href="#topic+InfluenceMap">InfluenceMap</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#### Generate Simulated data example ####
set.seed(30)
x=c(rnorm(50),rnorm(50,mean=5),rnorm(1,mean=15),rnorm(49,mean=5),rnorm(50,mean=4))
xcpt = cpt.mean(x,method='PELT') # Get the changepoints via PELT

#### Get the influence for both delete and outlier options ####
x.inf = influence(xcpt)


#### Parameter Stability plot ####
ParameterStability(x.inf, original.mean = rep(param.est(xcpt)$mean, 
  times=diff(c(0,xcpt@cpts))), las = 1)
# note that the original mean is an n length vector and you can use the above code 
# to get this from the original changepoint locations.
</code></pre>

<hr>
<h2 id='StabilityOverview'>
Stability Overview Graphic
</h2><span id='topic+StabilityOverview'></span>

<h3>Description</h3>

<p>Plots the overview of the stability according to the influence measure.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>StabilityOverview(data, original.cpts, influence,cpt.lwd=2,
  cpt.col=c("#009E73", "#E69F00", "#E41A1C"),cpt.lty=c("dashed","dotdash","dotted"),
  ylab=' ',xlab='Index', legend.args=list(display=TRUE,x="left",y=NULL,cex = 1,bty="n",
  horiz=TRUE,xpd=FALSE), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="StabilityOverview_+3A_data">data</code></td>
<td>

<p>A vector containing the data on which you have run your changepoint method.
</p>
</td></tr>
<tr><td><code id="StabilityOverview_+3A_original.cpts">original.cpts</code></td>
<td>

<p>An ordered vector of the changepoint locations found by your favourite changepoint method.
</p>
</td></tr>
<tr><td><code id="StabilityOverview_+3A_influence">influence</code></td>
<td>

<p>The influence as calculated the <code>influence()</code> function provided within this package.  This is a list object.
</p>
</td></tr>
<tr><td><code id="StabilityOverview_+3A_cpt.lwd">cpt.lwd</code></td>
<td>

<p>The line width to be used when plotting the <code>original.cpts</code> on the <code>data</code>. Standard <code>lwd</code> values allowed. A single value is expected.
</p>
</td></tr>
<tr><td><code id="StabilityOverview_+3A_cpt.col">cpt.col</code></td>
<td>

<p>Colour of the <code>original.cpts</code> lines when plotted.  We need three colours specified here, corresponding to the &quot;stable&quot;, &quot;unstable&quot; and &quot;outlier&quot; categories respectively. Any values accepted by the <code>col</code> plotting argument are allowed.
</p>
</td></tr>
<tr><td><code id="StabilityOverview_+3A_cpt.lty">cpt.lty</code></td>
<td>

<p>Line type of the <code>original.cpts</code> lines when plotted.  We need three line types specified here, corresponding to the &quot;stable&quot;, &quot;unstable&quot; and &quot;outlier&quot; categories respectively.  Any values accepted by the <code>lty</code> plotting argument are allowed.
</p>
</td></tr>
<tr><td><code id="StabilityOverview_+3A_ylab">ylab</code>, <code id="StabilityOverview_+3A_xlab">xlab</code></td>
<td>

<p>The labels for the x- and y-axis, character vector expected.
</p>
</td></tr>
<tr><td><code id="StabilityOverview_+3A_legend.args">legend.args</code></td>
<td>

<p>These arguments are passed to the <code>legend()</code> function to control the legend position etc..
</p>
</td></tr>
<tr><td><code id="StabilityOverview_+3A_...">...</code></td>
<td>

<p>Any other arguments to be passed to the <code>plot()</code> function.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function creates a first summary graphic to display the results of a changepoint influence analysis.  The graphic is a plot of the original data with the changepoints as vertical lines at their respective positions.  The colour and line type of the changepoint vertical lines reflect their stability.  The first value of their arguments denotes a stable changepoint - which appears at the same location in all influence segmentations.  The second argument denotes an unstable changepoint - which doesn't appear at the same location in all influence segmentations, either it moves or is deleted. The third argument denotes changepoint locations which are deemed outliers as two changepoints occur at consecutive locations (surrounding the outlying observation).
</p>


<h3>Value</h3>

<p>The function returns a plot and a list containing the labels of the <code>original.cpts</code> as either &quot;stable&quot;, &quot;unstable&quot;, or &quot;outlier&quot;.
</p>


<h3>Author(s)</h3>

<p>Rebecca Killick
</p>


<h3>References</h3>

<p>Wilms I, Killick R, Matteson DS (2022) Graphical Influence Diagnostics for Changepoint Models, <em>Journal of Computational and Graphical Statistics</em>,  <b>31:3</b>, 753&ndash;765 <em>DOI: 10.1080/10618600.2021.2000873</em></p>


<h3>See Also</h3>

<p><code><a href="#topic+influence-methods">influence-methods</a></code>, <code><a href="#topic+LocationStability">LocationStability</a></code>,<code><a href="#topic+ParameterStability">ParameterStability</a></code>,<code><a href="#topic+InfluenceMap">InfluenceMap</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#### Generate Simulated data example ####
set.seed(30)
x=c(rnorm(50),rnorm(50,mean=5),rnorm(1,mean=15),rnorm(49,mean=5),rnorm(50,mean=4))
xcpt = cpt.mean(x,method='PELT') # Get the changepoints via PELT

#### Get the influence for both delete and outlier options ####
x.inf = influence(xcpt)


#### Stability Dashboard ####
StabilityOverview(x,cpts(xcpt),x.inf,las=1,
  legend.args=list(display=TRUE,x="topright",y=NULL,cex=1.5,bty="n",horiz=FALSE,xpd=FALSE))


</code></pre>

<hr>
<h2 id='welldata'>
Welllog data
</h2><span id='topic+welldata'></span><span id='topic+welllog'></span>

<h3>Description</h3>

<p>This data has been used in previous changepoint papers and is described and provided in &quot;On-line inference for hidden Markov models via particle filters&quot; by Fearnhead and Clifford in 2003.
The data consists of measurements of the nuclear magnetic response of underground rocks.
</p>
<p>Please note that this is the original data.  The data analyzed in the majority of publications has been standardized and/or had the outliers removed.  Papers typically only analyze a portion of the 4050 vector too.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>welldata
</code></pre>


<h3>Format</h3>

<p>A vector of length 4050.
</p>


<h3>Source</h3>

<p>https://doi.org/10.1111/1467-9868.00421</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#### Load the data in the R package changepoint.influence ####
data("welldata")
welllog = welldata[1001:2000] 
# Extract the mid section of the data as analyzed in other papers
n = length(welllog)
var = NULL; for (i in 30:1000){var[i]=var(welllog[(i-29):i])} 
welllogs = welllog/sqrt(median(var, na.rm = TRUE)) 
# rescale the data to have unit variance across time, 
# note that there may still be changes in variance across the series.

#### Apply PELT to the welllog data ####
out.PELT = cpt.mean(welllogs, method = 'PELT')

#### Calculate the influence measures ####
welllogs.inf = influence(out.PELT) 
# the code extracts all the details of the original cpt.mean() function call
# and uses these in the calculation of the influence for the modified data.

#### Stability Dashboards ####
StabilityOverview(welllogs,cpts(out.PELT),welllogs.inf,las=1,ylab='Nuclear-Magnetic Response', 
    legend.args=list(display=TRUE,x="bottomright",y=NULL,cex=1.5,bty="n",horiz=FALSE,xpd=FALSE))
# We can specify where the legend will sit in the graphic via the legend.args 
# which are passed to the legend() function.  We can also include additional 
# arguments to pass to the plotting such as las=1 here.

#### Location Stability plot ####
exp.seg=LocationStability(cpts(out.PELT), welllogs.inf, type = 'Difference', cpt.lwd = 4, las = 1)
# Note that if the expected segmentation is not provided, it will be calcuated 
# and then returned so that the user can avoid calculating this again in other plot calls.

#### Parameter Stability plot ####
ParameterStability(welllogs.inf, original.mean = rep(param.est(out.PELT)$mean, 
  times=diff(c(0,out.PELT@cpts))), las = 1, ylab = 'Nuclear-Magnetic Response')
# Note that the original.mean argument is provided for each timepoint so is a length n vector.

#### Influence Map ####
welllogs.inf = influence(out.PELT, method = "delete")
inf.resid.del=InfluenceMap(cpts(out.PELT), welllogs.inf, data = welllogs, include.data = TRUE, 
  ylab = 'Nuclear-Magnetic\n Response')

welllogs.inf = influence(out.PELT, method = "outlier")
inf.resid.out=InfluenceMap(cpts(out.PELT), welllogs.inf, data = welllogs, include.data = TRUE, 
  ylab='Nuclear-Magnetic\n Response')

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
