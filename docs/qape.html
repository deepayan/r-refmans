<!DOCTYPE html><html><head><title>Help for package qape</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {qape}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#bootPar'>
<p>Parametric bootstrap estimators of prediction accuracy</p></a></li>
<li><a href='#bootParFuture'><p>Parametric bootstrap estimators of prediction accuracy - parallel computing.</p></a></li>
<li><a href='#bootParFutureCor'><p>Parametric bootstrap estimators of prediction accuracy - parallel computing using corrected covariance matrices</p></a></li>
<li><a href='#bootParMis'><p>Parametric bootstrap estimators of prediction accuracy under the misspecified model</p></a></li>
<li><a href='#bootRes'>
<p>Residual bootstrap estimators of prediction accuracy</p></a></li>
<li><a href='#bootResFuture'>
<p>Residual bootstrap estimators of prediction accuracy - parallel computing</p></a></li>
<li><a href='#bootResMis'><p>Residual bootstrap estimators of prediction accuracy under the misspecified model</p></a></li>
<li><a href='#correction'><p>Correction term for predicted random effects</p></a></li>
<li><a href='#corrRancomp'><p>Correction of predicted random components</p></a></li>
<li><a href='#corrRanef'><p>Correction of predicted random effects</p></a></li>
<li><a href='#doubleBoot'><p>Double bootstrap estimators of prediction accuracy</p></a></li>
<li><a href='#doubleBootFuture'><p>Double bootstrap estimators of prediction accuracy - parallel computing</p></a></li>
<li><a href='#doubleBootMis'><p>Double bootstrap estimators of prediction accuracy under the misspecified model</p></a></li>
<li><a href='#EBLUP'>
<p>Empirical Best Linear Unbiased Predictor</p></a></li>
<li><a href='#ebpLMMne'>
<p>Empirical Best Predictor based on the nested error linear mixed model</p></a></li>
<li><a href='#EmpCM'><p>Empirical covariance matrix of predicted random effects</p></a></li>
<li><a href='#EstCM'><p>Estimated covariance matrix of predicted random effects</p></a></li>
<li><a href='#invData'>
<p>Population data - investments in Poland at NUTS 4 level</p></a></li>
<li><a href='#mcBootMis'><p>Monte Carlo simulation study of accuracy of estimators of accuracy measures</p></a></li>
<li><a href='#mcLMMmis'><p>Monte Carlo simuation study of accuracy of predictors under the misspecified model</p></a></li>
<li><a href='#modifyDataset'><p>Modification of the values of the variables in the dataset</p></a></li>
<li><a href='#normCholTest'><p>Test of normality of the dependent variable</p></a></li>
<li><a href='#plugInLMM'>
<p>PLUG-IN predictor based on the linear mixed model</p></a></li>
<li><a href='#print.EBLUP'>
<p>print the value of EBLUP predictor</p></a></li>
<li><a href='#print.ebpLMMne'>
<p>print the value of ebpLMMne predictor</p></a></li>
<li><a href='#print.plugInLMM'>
<p>print the value of plugInLMM predictor</p></a></li>
<li><a href='#quantileNaN'><p>quantile NaN</p></a></li>
<li><a href='#realestData'>
<p>Population data - real estate in Poland at NUTS 4 level</p></a></li>
<li><a href='#srswrRe'><p>Bootstrap sample of predicted random effects</p></a></li>
<li><a href='#summary.EBLUP'>
<p>Summary of EBLUP prediction</p></a></li>
<li><a href='#summary.ebpLMMne'>
<p>Summary of ebpLMMne prediction</p></a></li>
<li><a href='#summary.plugInLMM'>
<p>Summary of plugInLMM prediction</p></a></li>
<li><a href='#Zfun'><p>Matrix Z creator</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Quantile of Absolute Prediction Errors</td>
</tr>
<tr>
<td>Version:</td>
<td>2.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-08-21</td>
</tr>
<tr>
<td>Author:</td>
<td>Alicja Wolny-Dominiak, Tomasz Zadlo</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Alicja Wolny-Dominiak &lt;alicja.wolny-dominiak@ue.katowice.pl&gt;</td>
</tr>
<tr>
<td>Imports:</td>
<td>lme4, Matrix, mvtnorm, plyr, dplyr, matrixcalc, future.apply,
reshape2</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Description:</td>
<td>Estimates QAPE using bootstrap procedures. The residual, parametric and double bootstrap is used. The test of normality using Cholesky decomposition is added. Y pop is defined.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-08-21 12:33:26 UTC; woali</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-08-21 14:10:12 UTC</td>
</tr>
</table>
<hr>
<h2 id='bootPar'>
Parametric bootstrap estimators of prediction accuracy
</h2><span id='topic+bootPar'></span>

<h3>Description</h3>

<p>The function computes values of parametric bootstrap estimators of RMSE and QAPE prediction accuracy measures.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bootPar(predictor, B, p)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bootPar_+3A_predictor">predictor</code></td>
<td>
<p>one of objects: EBLUP, ebpLMMne or plugInLMM.
</p>
</td></tr>
<tr><td><code id="bootPar_+3A_b">B</code></td>
<td>
<p>number of iterations in the bootstrap procedure.
</p>
</td></tr>
<tr><td><code id="bootPar_+3A_p">p</code></td>
<td>
<p>orders of quantiles in the QAPE.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We use bootstrap model presented by Chatterjee, Lahiri and  Li (2008) p. 1229 but assumed for all population elements. Vectors of random effects and random components are generated from the multivariate normal distribution where REML estimates of model parameters are used. Random effects are generated for all population elements even for subsets with zero sample sizes (for which random effects are not estimated). We use the MSE estimator defined as the mean of squared bootstrap errors considered by Rao and Molina (2015) p. 141 and given by equation (6.2.22). The QAPE is a quantile of absolute prediction error which means that at least p100% of realizations of absolute prediction errors are smaller or equal to QAPE. It is estimated as a quantile of absolute bootstrap errors as proposed by Zadlo (2017) in Section 2.  
</p>


<h3>Value</h3>

<table>
<tr><td><code>estQAPE</code></td>
<td>
<p>estimated value/s of QAPE - number of rows is equal to the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal to the number of predicted characteristics (declared in <em>thetaFun</em>).</p>
</td></tr>
<tr><td><code>estRMSE</code></td>
<td>
<p>estimated value/s of RMSE (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>summary</code></td>
<td>
<p>estimated accuracy measures for the predictor of characteristics defined in thetaFun.</p>
</td></tr>
<tr><td><code>predictorSim</code></td>
<td>
<p>bootstrapped values of the predictor/s.</p>
</td></tr>
<tr><td><code>thetaSim</code></td>
<td>
<p>bootstrapped values of the predicted population or subpopulation characteristic/s.</p>
</td></tr>
<tr><td><code>Ysim</code></td>
<td>
<p>simulated values of the (possibly tranformed) variable of interest.</p>
</td></tr>
<tr><td><code>error</code></td>
<td>
<p>differences between bootstrapped values of the predictor/s and bootstrapped values of the predicted characteristic/s.</p>
</td></tr>
<tr><td><code>positiveDefiniteEstG</code></td>
<td>
<p>logical indicating if the estimated covariance matrix of random effects, used to generate bootstrap realizations of the dependent variable, is positive definite.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alicja Wolny-Dominiak, Tomasz Zadlo</p>


<h3>References</h3>

<p>1. Butar, B. F., Lahiri, P. (2003) On measures of uncertainty of empirical Bayes small-area estimators, Journal of Statistical Planning and Inference, 112, 63-76.<br />
</p>
<p>2. Chatterjee, S., Lahiri, P. Li, H. (2008) Parametric bootstrap approximation to the distribution of EBLUP and related prediction intervals in linear mixed models, Annals of Statistics, Vol. 36 (3), 1221-1245.<br />
</p>
<p>3. Rao, J.N.K. and Molina, I. (2015) Small Area Estimation. Second edition, John Wiley &amp; Sons, New Jersey.<br />
</p>
<p>4. Zadlo T. (2017), On asymmetry of prediction errors in small area estimation, Statistics in Transition, 18 (3), 413-432. <br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(lme4)
library(Matrix)
library(mvtnorm)
library(matrixcalc) 


data(invData) 
# data from one period are considered: 
invData2018 &lt;- invData[invData$year == 2018,] 
attach(invData2018)

N &lt;- nrow(invData2018) # population size

con &lt;- rep(1,N) 
con[c(379,380)] &lt;- 0 # last two population elements are not observed 

YS &lt;- log(investments[con == 1]) # log-transformed values
backTrans &lt;- function(x) exp(x) # back-transformation of the variable of interest
fixed.part &lt;- 'log(newly_registered)'
random.part &lt;- '(1|NUTS2)'

reg &lt;- invData2018[, -which(names(invData2018) == 'investments')]
weights &lt;- rep(1,N) # homoscedastic random components

# Characteristics to be predicted:
# values of the variable for last two population elements  
thetaFun &lt;- function(x) {x[c(379,380)]}
set.seed(123456)

predictor &lt;- plugInLMM(YS, fixed.part, random.part, reg, con, weights, backTrans, thetaFun)
predictor$thetaP

### Estimation of prediction accuracy
est_accuracy &lt;- bootPar(predictor, 10, c(0.75,0.9))

# Estimation of prediction RMSE
est_accuracy$estRMSE

# Estimation of prediction QAPE
est_accuracy$estQAPE

#        [,1]     [,2]
# 75% 2888.291 115.6076
# 90% 5472.738 127.0623

####### Interpretations in case of prediction of investments 
####### for population element no. 379:
### It is estimated that at least 75% of absolute prediction errors are
# smaller or equal 2888.291 milion Polish zloty
# and at least 25% of absolute prediction errors are
# greater or equal 2888.291 milion Polish zloty. 
### It is estimated that at least 90% of absolute prediction errors are
# smaller or equal 5472.738 milion Polish zloty
# and at least 10% of absolute prediction errors are
# greater or equal 5472.738 milion Polish zloty. 

detach(invData2018)
</code></pre>

<hr>
<h2 id='bootParFuture'>Parametric bootstrap estimators of prediction accuracy - parallel computing.
</h2><span id='topic+bootParFuture'></span>

<h3>Description</h3>

<p>The function computes values of parametric bootstrap estimators of RMSE and QAPE prediction accuracy measures using parallel computing
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bootParFuture(predictor, B, p)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bootParFuture_+3A_predictor">predictor</code></td>
<td>
<p>one of objects: EBLUP, ebpLMMne or plugInLMM.
</p>
</td></tr>
<tr><td><code id="bootParFuture_+3A_b">B</code></td>
<td>
<p>number of iterations in the bootstrap procedure.
</p>
</td></tr>
<tr><td><code id="bootParFuture_+3A_p">p</code></td>
<td>
<p>orders of quantiles in the QAPE.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We use bootstrap model presented by Chatterjee, Lahiri and  Li (2008) p. 1229 but assumed for all population elements. Vectors of random effects and random components are generated from the multivariate normal distribution where REML estimates of model parameters are used. Random effects are generated for all population elements even for subsets with zero sample sizes (for which random effects are not estimated). We use the MSE estimator defined as the mean of squared bootstrap errors considered by Rao and Molina (2015) p. 141 and given by equation (6.2.22). The QAPE is a quantile of absolute prediction error which means that at least p100% of realizations of absolute prediction errors are smaller or equal to QAPE. It is estimated as a quantile of absolute bootstrap errors as proposed by Zadlo (2017) in Section 2.  The parallel processing is performed via the <em>future.apply</em> package.  
</p>


<h3>Value</h3>

<table>
<tr><td><code>estQAPE</code></td>
<td>
<p>estimated value/s of QAPE - number of rows is equal to the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal to the number of predicted characteristics (declared in <em>thetaFun</em>).</p>
</td></tr>
<tr><td><code>estRMSE</code></td>
<td>
<p>estimated value/s of RMSE (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>summary</code></td>
<td>
<p>estimated accuracy measures for the predictor of characteristics defined in thetaFun.</p>
</td></tr>
<tr><td><code>predictorSim</code></td>
<td>
<p>bootstrapped values of the predictor/s.</p>
</td></tr>
<tr><td><code>thetaSim</code></td>
<td>
<p>bootstrapped values of the predicted population or subpopulation characteristic/s.</p>
</td></tr>
<tr><td><code>Ysim</code></td>
<td>
<p>simulated values of the (possibly tranformed) variable of interest.</p>
</td></tr>
<tr><td><code>error</code></td>
<td>
<p>differences between bootstrapped values of the predictor/s and bootstrapped values of the predicted characteristic/s.</p>
</td></tr>
<tr><td><code>positiveDefiniteEstG</code></td>
<td>
<p>logical indicating if the estimated covariance matrix of random effects, used to generate bootstrap realizations of the dependent variable, is positive definite.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alicja Wolny-Dominiak, Tomasz Zadlo</p>


<h3>References</h3>

<p>1. Butar, B. F., Lahiri, P. (2003) On measures of uncertainty of empirical Bayes small-area estimators, Journal of Statistical Planning and Inference, Vol. 112, pp. 63-76.<br />
</p>
<p>2. Chatterjee, S., Lahiri, P. Li, H. (2008) Parametric bootstrap approximation to the distribution of EBLUP and related prediction intervals in linear mixed models, Annals of Statistics, Vol. 36 (3), pp. 1221?1245.<br />
</p>
<p>3. Rao, J.N.K. and Molina, I. (2015) Small Area Estimation. Second edition, John Wiley &amp; Sons, New Jersey.<br />
</p>
<p>4. Zadlo T. (2017), On asymmetry of prediction errors in small area estimation, Statistics in Transition, 18 (3), 413-432. <br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(lme4)
library(Matrix)
library(mvtnorm)
library(matrixcalc) 
library(future.apply)


data(invData) 
# data from one period are considered: 
invData2018 &lt;- invData[invData$year == 2018,] 
attach(invData2018)

N &lt;- nrow(invData2018) # population size

con &lt;- rep(1,N) 
con[c(379,380)] &lt;- 0 # last two population elements are not observed 

YS &lt;- log(investments[con == 1]) # log-transformed values
backTrans &lt;- function(x) exp(x) # back-transformation of the variable of interest
fixed.part &lt;- 'log(newly_registered)'
random.part &lt;- '(1|NUTS2)'

reg &lt;- invData2018[, -which(names(invData2018) == 'investments')]
weights &lt;- rep(1,N) # homoscedastic random components

# Characteristics to be predicted:
# values of the variable for last two population elements  
thetaFun &lt;- function(x) {x[c(379,380)]}
set.seed(123)

predictor &lt;- plugInLMM(YS, fixed.part, random.part, reg, con, weights, backTrans, thetaFun)
predictor$thetaP

### Estimation of prediction accuracy
est_accuracy &lt;- bootParFuture(predictor, 10, c(0.75,0.9))

# Estimation of prediction RMSE
est_accuracy$estRMSE

# Estimation of prediction QAPE
est_accuracy$estQAPE

#        [,1]     [,2]
# 75% 1370.823 180.0514
# 90% 1477.444 249.7517

####### Interpretations in case of prediction of investments 
####### for population element no. 379:
### It is estimated that at least 75% of absolute prediction errors are
# smaller or equal 1370.823 milion Polish zloty
# and at least 25% of absolute prediction errors are
# greater or equal 1370.823 milion Polish zloty. 
### It is estimated that at least 90% of absolute prediction errors are
# smaller or equal 1477.444 milion Polish zloty
# and at least 10% of absolute prediction errors are
# greater or equal 1477.444 milion Polish zloty. 

detach(invData2018)
</code></pre>

<hr>
<h2 id='bootParFutureCor'>Parametric bootstrap estimators of prediction accuracy - parallel computing using corrected covariance matrices
</h2><span id='topic+bootParFutureCor'></span>

<h3>Description</h3>

<p>The function computes values of parametric bootstrap estimators of RMSE and QAPE prediction accuracy measures using parallel computing under the misspecified model. The model misspecification is obtained by the modification of the covariance matrices of random effects and random components estimated based on sample data. The correction is made by the division of the diagonal elements of random effects and random components estimated based on sample data by values defined by users and then, the corrected covariance matrices are used to generate bootstrap realizations of the dependent variables.   
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bootParFutureCor(predictor, B, p, ratioR, ratioG)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bootParFutureCor_+3A_predictor">predictor</code></td>
<td>
<p>one of objects: EBLUP, ebpLMMne or plugInLMM.
</p>
</td></tr>
<tr><td><code id="bootParFutureCor_+3A_b">B</code></td>
<td>
<p>number of iterations in the bootstrap procedure.
</p>
</td></tr>
<tr><td><code id="bootParFutureCor_+3A_p">p</code></td>
<td>
<p>orders of quantiles in the QAPE.
</p>
</td></tr>
<tr><td><code id="bootParFutureCor_+3A_ratior">ratioR</code></td>
<td>
<p>the value by which the diagonal elements of the covariance matrix of random components estimated based on sample data are divided. Then, the corrected covariance matrix is used to generate bootstrap realizations of random components.
</p>
</td></tr>
<tr><td><code id="bootParFutureCor_+3A_ratiog">ratioG</code></td>
<td>
<p>the value by which the diagonal elements of the covariance matrix of random effects estimated based on sample data are divided. Then, the corrected covariance matrix, assuming that it is positive definite, is used to generate bootstrap realizations of random effects. If it is not positive definite, the alert is printed and the dependent variable is generated based on the model without random effects.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We use bootstrap model presented by Chatterjee, Lahiri and  Li (2008) p. 1229 but assumed for all population elements. Vectors of random effects and random components are generated from the multivariate normal distribution, where REML estimates of model parameters are used. Random effects are generated for all population elements, even for subsets with zero sample sizes (for which random effects are not estimated). We use the MSE estimator defined as the mean of squared bootstrap errors considered by Rao and Molina (2015) p. 141 and given by equation (6.2.22). The QAPE is a quantile of absolute prediction error, which means that at least p100% of realizations of absolute prediction errors are smaller or equal to QAPE. It is estimated as a quantile of absolute bootstrap errors, as proposed by Zadlo (2017) in Section 2.  The parallel processing is performed via the <em>future.apply</em> package. The dependent variable is generated based on the modified (misspecified) model with corrected covariance matrices of random effects and random components. The correction is made by the division of the diagonal elements of the covariance matrix of random components estimated based on sample data by <em>ratioR</em>, and by the division of the diagonal elements of the covariance matrix of random effects estimated based on sample data by <em>ratioG</em>. If the estimated covariance matrix of random effect after the correction is not positive definite, the alert is printed and the bootstrap realizations of dependent variable are generated based on the model without random effects.    
</p>


<h3>Value</h3>

<table>
<tr><td><code>estQAPE</code></td>
<td>
<p>estimated value/s of QAPE - number of rows is equal to the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal to the number of predicted characteristics (declared in <em>thetaFun</em>).</p>
</td></tr>
<tr><td><code>estRMSE</code></td>
<td>
<p>estimated value/s of RMSE (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>summary</code></td>
<td>
<p>estimated accuracy measures for the predictor of characteristics defined in thetaFun.</p>
</td></tr>
<tr><td><code>predictorSim</code></td>
<td>
<p>bootstrapped values of the predictor/s.</p>
</td></tr>
<tr><td><code>thetaSim</code></td>
<td>
<p>bootstrapped values of the predicted population or subpopulation characteristic/s.</p>
</td></tr>
<tr><td><code>Ysim</code></td>
<td>
<p>simulated values of the (possibly tranformed) variable of interest.</p>
</td></tr>
<tr><td><code>error</code></td>
<td>
<p>differences between bootstrapped values of the predictor/s and bootstrapped values of the predicted characteristic/s.</p>
</td></tr>
<tr><td><code>positiveDefiniteEstG</code></td>
<td>
<p>logical indicating if the estimated covariance matrix of random effects, used to generate bootstrap realizations of the dependent variable, is positive definite.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alicja Wolny-Dominiak, Tomasz Zadlo</p>


<h3>References</h3>

<p>1. Butar, B. F., Lahiri, P. (2003) On measures of uncertainty of empirical Bayes small-area estimators, Journal of Statistical Planning and Inference, Vol. 112, pp. 63-76.<br />
</p>
<p>2. Chatterjee, S., Lahiri, P. Li, H. (2008) Parametric bootstrap approximation to the distribution of EBLUP and related prediction intervals in linear mixed models, Annals of Statistics, Vol. 36 (3), pp. 1221?1245.<br />
</p>
<p>3. Rao, J.N.K. and Molina, I. (2015) Small Area Estimation. Second edition, John Wiley &amp; Sons, New Jersey.<br />
</p>
<p>4. Zadlo T. (2017), On asymmetry of prediction errors in small area estimation, Statistics in Transition, 18 (3), 413-432. <br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(lme4)
library(Matrix)
library(mvtnorm)
library(matrixcalc) 
library(future.apply)


data(invData) 
# data from one period are considered: 
invData2018 &lt;- invData[invData$year == 2018,] 
attach(invData2018)

N &lt;- nrow(invData2018) # population size

con &lt;- rep(1,N) 
con[c(379,380)] &lt;- 0 # last two population elements are not observed 

YS &lt;- log(investments[con == 1]) # log-transformed values
backTrans &lt;- function(x) exp(x) # back-transformation of the variable of interest
fixed.part &lt;- 'log(newly_registered)'
random.part &lt;- '(1|NUTS2)'

reg &lt;- invData2018[, -which(names(invData2018) == 'investments')]
weights &lt;- rep(1,N) # homoscedastic random components

# Characteristics to be predicted:
# values of the variable for last two population elements  
thetaFun &lt;- function(x) {x[c(379,380)]}
set.seed(123)

predictor &lt;- plugInLMM(YS, fixed.part, random.part, reg, con, weights, backTrans, thetaFun)
predictor$thetaP

### Estimation of prediction accuracy under the misspecified model
est_accuracy &lt;- bootParFutureCor(predictor, 10, c(0.75,0.9), 2, 0.01)

# Estimation of prediction RMSE under the misspecified model
est_accuracy$estRMSE

# Estimation of prediction QAPE under the misspecified model
est_accuracy$estQAPE

detach(invData2018)
</code></pre>

<hr>
<h2 id='bootParMis'>Parametric bootstrap estimators of prediction accuracy under the misspecified model
</h2><span id='topic+bootParMis'></span>

<h3>Description</h3>

<p>The function computes values of parametric bootstrap estimators of RMSE and QAPE prediction accuracy measures of two predictors under the model assumed for one of them.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bootParMis(predictorLMM, predictorLMMmis, B, p)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bootParMis_+3A_predictorlmm">predictorLMM</code></td>
<td>
<p>plugInLMM object, the first predictor used to define the bootstrap model.
</p>
</td></tr>
<tr><td><code id="bootParMis_+3A_predictorlmmmis">predictorLMMmis</code></td>
<td>
<p>plugInLMM object, the second predictor.
</p>
</td></tr>
<tr><td><code id="bootParMis_+3A_b">B</code></td>
<td>
<p>number of iterations in the bootstrap procedure.
</p>
</td></tr>
<tr><td><code id="bootParMis_+3A_p">p</code></td>
<td>
<p>orders of quantiles in the QAPE.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We use bootstrap model presented by Chatterjee, Lahiri and  Li (2008) p. 1229 but assumed for all population elements. We use model specification used in <em>predictorLMM</em>. Vectors of random effects and random components are generated from the multivariate normal distribution where REML estimates of model parameters are used. Random effects are generated for all population elements even for subsets with zero sample sizes (for which random effects are not estimated). We use the MSE estimator defined as the mean of squared bootstrap errors considered by Rao and Molina (2015) p. 141 and given by equation (6.2.22). The QAPE is a quantile of absolute prediction error which means that at least p100% of realizations of absolute prediction errors are smaller or equal to QAPE. It is estimated as a quantile of absolute bootstrap errors as proposed by Zadlo (2017) in Section 2. The prediction accuracy of two predictors <em>predictorLMM</em> and <em>predictorLMMmis</em> is estimated under the model specified in <em>predictorLMM</em>.   
</p>


<h3>Value</h3>

<table>
<tr><td><code>estQAPElmm</code></td>
<td>
<p>estimated value/s of QAPE of <em>predictorLMM</em> - number of rows is equal the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal the number of predicted characteristics (declared in <em>thetaFun</em>).</p>
</td></tr>
<tr><td><code>estRMSElmm</code></td>
<td>
<p>estimated value/s of RMSE of <em>predictorLMM</em> (more than one value is computed if in
<em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>estQAPElmmMis</code></td>
<td>
<p>estimated value/s of QAPE of <em>predictorLMMmis</em> - number of rows is equal the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal the number of predicted characteristics (declared in <em>thetaFun</em>).</p>
</td></tr>
<tr><td><code>estRMSElmmMis</code></td>
<td>
<p>estimated value/s of RMSE of <em>predictorLMMmis</em> (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>predictorLMMSim</code></td>
<td>
<p>bootstrapped values of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>predictorLMMmisSim</code></td>
<td>
<p>bootstrapped values of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>thetaSim</code></td>
<td>
<p>bootstrapped values of the predicted population or subpopulation characteristic/s.</p>
</td></tr>
<tr><td><code>Ysim</code></td>
<td>
<p>simulated values of the (possibly tranformed) variable of interest.</p>
</td></tr>
<tr><td><code>errorLMM</code></td>
<td>
<p>differences between bootstrapped values of <em>predictorLMM</em> and bootstrapped values of the predicted characteristic/s.</p>
</td></tr>
<tr><td><code>errorLMMmis</code></td>
<td>
<p>differences between bootstrapped values of <em>predictorLMMmis</em> and bootstrapped values of the predicted characteristic/s.</p>
</td></tr>
<tr><td><code>positiveDefiniteEstG</code></td>
<td>
<p>logical indicating if the estimated covariance matrix of random effects, used to generate bootstrap realizations of the dependent variable, is positive definite.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alicja Wolny-Dominiak, Tomasz Zadlo</p>


<h3>References</h3>

<p>1. Butar, B. F., Lahiri, P. (2003) On measures of uncertainty of empirical Bayes small-area estimators, Journal of Statistical Planning and Inference, Vol. 112, pp. 63-76.<br />
</p>
<p>2. Chatterjee, S., Lahiri, P. Li, H. (2008) Parametric bootstrap approximation to the distribution of EBLUP and related prediction intervals in linear mixed models, Annals of Statistics, Vol. 36 (3), pp. 1221?1245.<br />
</p>
<p>3. Rao, J.N.K. and Molina, I. (2015) Small Area Estimation. Second edition, John Wiley &amp; Sons, New Jersey.<br />
</p>
<p>4. Zadlo T. (2017), On asymmetry of prediction errors in small area estimation, Statistics in Transition, 18 (3), 413-432. <br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(lme4)
library(Matrix)
library(mvtnorm)
library(matrixcalc) 


data(invData) 
# data from one period are considered: 
invData2018 &lt;- invData[invData$year == 2018,] 
attach(invData2018)

N &lt;- nrow(invData2018) # population size

con &lt;- rep(1,N) 
con[c(379,380)] &lt;- 0 # last two population elements are not observed 

YS &lt;- log(investments[con == 1]) # log-transformed values
backTrans &lt;- function(x) exp(x) # back-transformation of the variable of interest
fixed.part &lt;- 'log(newly_registered)'
random.part &lt;- '(1|NUTS2)'
random.part.mis &lt;- '(1|NUTS4type)'

reg &lt;- invData2018[, -which(names(invData2018) == 'investments')]
weights &lt;- rep(1,N) # homoscedastic random components

# Characteristics to be predicted:
# values of the variable for last two population elements  
thetaFun &lt;- function(x) {x[c(379,380)]}


predictorLMM&lt;-plugInLMM(YS, fixed.part, random.part, reg, con, weights,backTrans,thetaFun)
predictorLMM$thetaP
predictorLMMmis &lt;- plugInLMM(YS, fixed.part, random.part.mis, reg, con,weights,backTrans,thetaFun)
predictorLMMmis$thetaP

set.seed(123456)
### Estimation of prediction accuracy under the model used to define predictorLMM
est_accuracy &lt;- bootParMis(predictorLMM, predictorLMMmis, 10, c(0.75,0.9))

# Estimation of prediction RMSE of predictorLMM 
est_accuracy$estRMSElmm

# Estimation of prediction RMSE of predictorLMMmis
est_accuracy$estRMSElmmMis

# Estimation of prediction QAPE of predictorLMM 
est_accuracy$estQAPElmm

# Estimation of prediction QAPE of predictorLMMmis
est_accuracy$estQAPElmmMis

detach(invData2018)
</code></pre>

<hr>
<h2 id='bootRes'>
Residual bootstrap estimators of prediction accuracy
</h2><span id='topic+bootRes'></span>

<h3>Description</h3>

<p>The function computes values of residual bootstrap estimators of RMSE and QAPE prediction accuracy measures.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bootRes(predictor, B, p, correction)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bootRes_+3A_predictor">predictor</code></td>
<td>
<p>one of objects: EBLUP, ebpLMMne or plugInLMM.
</p>
</td></tr>
<tr><td><code id="bootRes_+3A_b">B</code></td>
<td>
<p>number of iterations in the bootstrap procedure.
</p>
</td></tr>
<tr><td><code id="bootRes_+3A_p">p</code></td>
<td>
<p>orders of quantiles in the QAPE.
</p>
</td></tr>
<tr><td><code id="bootRes_+3A_correction">correction</code></td>
<td>
<p>logical. If TRUE, both bootstrapped random effects and random components are tranformed to avoid the problem of underdispersion of residual bootstrap distributions (see Details).
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Residual bootstrap considered by Carpener, Goldstein and Rasbash (2003), Chambers and Chandra (2013) and Thai et al. (2013) is used. To generate one bootstrap realization of the population vector of the variable of interest: (i) from the sample vector of predicted random components the simple random sample with replacement of population size is drawn at random, (ii) from the vector of predicted random effects the simple random sample with replacement of size equal to the number of random effects in the whole population is drawn at random. If <em>correction</em> is <em>TRUE</em>, then predicted random effects are transformed as described in Carpener, Goldstein and Rasbash (2003) in Section 3.2 and predicted random components as presented in Chambers and Chandra (2013) in Section 2.2. We use the MSE estimator defined as the mean of squared bootstrap errors considered by Rao and Molina (2015) p. 141 given by equation (6.2.22). The QAPE is a quantile of absolute prediction error which means that at least p100% of realizations of absolute prediction errors are smaller or equal to QAPE. It is estimated as a quantile of absolute bootstrap errors as proposed by Zadlo (2017) in Section 2.</p>


<h3>Value</h3>

<table>
<tr><td><code>estQAPE</code></td>
<td>
<p>estimated value/s of QAPE - number of rows is equal the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>).</p>
</td></tr>
<tr><td><code>estRMSE</code></td>
<td>
<p>estimated value/s of RMSE (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>summary</code></td>
<td>
<p>estimated accuracy measures for the predictor of characteristics defined in thetaFun.</p>
</td></tr>
<tr><td><code>summary</code></td>
<td>
<p>estimated accuracy measures for the predictor of characteristics defined in thetaFun.</p>
</td></tr>
<tr><td><code>predictorSim</code></td>
<td>
<p>bootstrapped values of the predictor/s.</p>
</td></tr>
<tr><td><code>thetaSim</code></td>
<td>
<p>bootstrapped values of the predicted population or subpopulation characteristic/s.</p>
</td></tr>
<tr><td><code>Ysim</code></td>
<td>
<p>simulated values of the (possibly tranformed) variable of interest.</p>
</td></tr>
<tr><td><code>error</code></td>
<td>
<p>differences between bootstrapped values of the predictor/s 
and bootstrapped values of the predicted characteristic/s.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alicja Wolny-Dominiak, Tomasz Zadlo</p>


<h3>References</h3>

<p>1. Carpenter, J.R., Goldstein, H. and Rasbash, J. (2003), A novel bootstrap procedure for assessing the relationship between class size and achievement. Journal of the Royal Statistical Society: Series C (Applied Statistics), 52, 431-443. <br /> 
</p>
<p>2. Chambers, R. and Chandra, H. (2013) A Random Effect Block Bootstrap for Clustered Data, Journal of Computational and Graphical Statistics, 22(2), 452-470. <br />
</p>
<p>3. Thai, H.-T., Mentre, F., Holford, N.H., Veyrat-Follet, C. and Comets, E. (2013), A comparison of bootstrap approaches for estimating uncertainty of parameters in linear mixed-effects models. Pharmaceutical Statistics, 12, 129-140. <br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(lme4)
library(Matrix)
library(mvtnorm)


data(invData) 
# data from one period are considered: 
invData2018 &lt;- invData[invData$year == 2018,] 
attach(invData2018)

N &lt;- nrow(invData2018) # population size

con &lt;- rep(1,N) 
con[c(379:380)] &lt;- 0 # last two population elements are not observed 

YS &lt;- log(investments[con == 1]) # log-transformed values
backTrans &lt;- function(x) exp(x) # back-transformation of the variable of interest
fixed.part &lt;- 'log(newly_registered)'
random.part &lt;- '(1|NUTS2)' 

reg &lt;- invData2018[, -which(names(invData2018) == 'investments')]
weights &lt;- rep(1,N) # homoscedastic random components

# Characteristics to be predicted:
# values of the variable for last two population elements  
thetaFun &lt;- function(x) {x[c(379:380)]}
set.seed(123456)

predictor &lt;- plugInLMM(YS, fixed.part, random.part, reg, con, weights, backTrans, thetaFun)
predictor$thetaP

### Estimation of prediction accuracy
est_accuracy &lt;- bootRes(predictor, 10, c(0.5,0.8), correction = TRUE)

# Estimation of prediction RMSE
est_accuracy$estRMSE

# Estimation of prediction QAPE
est_accuracy$estQAPE

#         [,1]      [,2]
#50%  612.6089  67.45543
#80% 1886.9269 120.16246
####### Interpretations in case of prediction of investments 
####### for population element no. 379:
### It is estimated that at least 50% of absolute prediction errors are
# smaller or equal 612.6089 milion Polish zloty 
# and at least 50% of absolute prediction errors are
# greater or equal 612.6089 milion Polish zloty. 
### It is estimated that at least 80% of absolute prediction errors are
# smaller or equal 1886.9269 milion Polish zloty
# and at least 20% of absolute prediction errors are
# greater or equal 1886.9269 milion Polish zloty. 

detach(invData2018)
</code></pre>

<hr>
<h2 id='bootResFuture'>
Residual bootstrap estimators of prediction accuracy - parallel computing
</h2><span id='topic+bootResFuture'></span>

<h3>Description</h3>

<p>The function computes values of residual bootstrap estimators of RMSE and QAPE prediction accuracy measures using parallel computing.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bootResFuture(predictor, B, p, correction)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bootResFuture_+3A_predictor">predictor</code></td>
<td>
<p>one of objects: EBLUP, ebpLMMne or plugInLMM.
</p>
</td></tr>
<tr><td><code id="bootResFuture_+3A_b">B</code></td>
<td>
<p>number of iterations in the bootstrap procedure.
</p>
</td></tr>
<tr><td><code id="bootResFuture_+3A_p">p</code></td>
<td>
<p>orders of quantiles in the QAPE.
</p>
</td></tr>
<tr><td><code id="bootResFuture_+3A_correction">correction</code></td>
<td>
<p>logical. If TRUE, both bootstrapped random effects and random components are tranformed to avoid the problem of underdispersion of residual bootstrap distributions (see Details).
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Residual bootstrap considered by Carpener, Goldstein and Rasbash (2003), Chambers and Chandra (2013) and Thai et al. (2013) is used. To generate one bootstrap realization of the population vector of the variable of interest: (i) from the sample vector of predicted random components the simple random sample with replacement of population size is drawn at random, (ii) from the vector of predicted random effects the simple random sample with replacement of size equal the number of random effects in the whole population is drawn at random. If <em>correction</em> is <em>TRUE</em>, then predicted random effects are transformed as described in Carpener, Goldstein and Rasbash (2003) in Section 3.2 and predicted random components as presented in Chambers and Chandra (2013) in Section 2.2. We use the MSE estimator defined as the mean of squared bootstrap errors considered by Rao and Molina (2015) p. 141 given by equation (6.2.22). The QAPE is a quantile of absolute prediction error which means that at least p100% of realizations of absolute prediction errors are smaller or equal to QAPE. It is estimated as a quantile of absolute bootstrap errors as proposed by Zadlo (2017) in Section 2. The parallel processing is performed via the <em>future.apply</em> package.</p>


<h3>Value</h3>

<table>
<tr><td><code>estQAPE</code></td>
<td>
<p>estimated value/s of QAPE - number of rows is equal the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal the number of predicted characteristics (declared in  in <em>thetaFun</em>).</p>
</td></tr>
<tr><td><code>estRMSE</code></td>
<td>
<p>estimated value/s of RMSE (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>summary</code></td>
<td>
<p>estimated accuracy measures for the predictor of characteristics defined in thetaFun.</p>
</td></tr>
<tr><td><code>predictorSim</code></td>
<td>
<p>bootstrapped values of the predictor/s.</p>
</td></tr>
<tr><td><code>thetaSim</code></td>
<td>
<p>bootstrapped values of the predicted population or subpopulation characteristic/s.</p>
</td></tr>
<tr><td><code>Ysim</code></td>
<td>
<p>simulated values of the (possibly tranformed) variable of interest.</p>
</td></tr>
<tr><td><code>error</code></td>
<td>
<p>differences between bootstrapped values of the predictor/s 
and bootstrapped values of the predicted characteristic/s.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alicja Wolny-Dominiak, Tomasz Zadlo</p>


<h3>References</h3>

<p>1. Carpenter, J.R., Goldstein, H. and Rasbash, J. (2003), A novel bootstrap procedure for assessing the relationship between class size and achievement. Journal of the Royal Statistical Society: Series C (Applied Statistics), 52, 431-443. <br /> 
</p>
<p>2. Chambers, R. and Chandra, H. (2013) A Random Effect Block Bootstrap for Clustered Data, Journal of Computational and Graphical Statistics, 22(2), 452-470. <br />
</p>
<p>3. Thai, H.-T., Mentre, F., Holford, N.H., Veyrat-Follet, C. and Comets, E. (2013), A comparison of bootstrap approaches for estimating uncertainty of parameters in linear mixed-effects models. Pharmaceutical Statistics, 12, 129-140. <br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(lme4)
library(Matrix)
library(mvtnorm)


data(invData) 
# data from one period are considered: 
invData2018 &lt;- invData[invData$year == 2018,] 
attach(invData2018)

N &lt;- nrow(invData2018) # population size

con &lt;- rep(1,N) 
con[c(379:380)] &lt;- 0 # last two population elements are not observed 

YS &lt;- log(investments[con == 1]) # log-transformed values
backTrans &lt;- function(x) exp(x) # back-transformation of the variable of interest
fixed.part &lt;- 'log(newly_registered)'
random.part &lt;- '(1|NUTS2)' 

reg &lt;- invData2018[, -which(names(invData2018) == 'investments')]
weights &lt;- rep(1,N) # homoscedastic random components

# Characteristics to be predicted:
# values of the variable for last two population elements  
thetaFun &lt;- function(x) {x[c(379:380)]}
set.seed(123456)

predictor &lt;- plugInLMM(YS, fixed.part, random.part, reg, con, weights, backTrans, thetaFun)
predictor$thetaP

### Estimation of prediction accuracy
est_accuracy &lt;- bootResFuture(predictor, 10, c(0.5,0.8), correction = TRUE)

# Estimation of prediction RMSE
est_accuracy$estRMSE

# Estimation of prediction QAPE
est_accuracy$estQAPE

#         [,1]      [,2]
#50%  612.6089  67.45543
#80% 1886.9269 120.16246
####### Interpretations in case of prediction of investments 
####### for population element no. 379:
### It is estimated that at least 50% of absolute prediction errors are
# smaller or equal 612.6089 milion Polish zloty 
# and at least 50% of absolute prediction errors are
# greater or equal 612.6089 milion Polish zloty. 
### It is estimated that at least 80% of absolute prediction errors are
# smaller or equal 1886.9269 milion Polish zloty
# and at least 20% of absolute prediction errors are
# greater or equal 1886.9269 milion Polish zloty. 

detach(invData2018)
</code></pre>

<hr>
<h2 id='bootResMis'>Residual bootstrap estimators of prediction accuracy under the misspecified model
</h2><span id='topic+bootResMis'></span>

<h3>Description</h3>

<p>The function computes values of residual bootstrap estimators of RMSE and QAPE prediction accuracy measures of two predictors under the model assumed for one of them.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bootResMis(predictorLMM, predictorLMMmis, B, p, correction)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bootResMis_+3A_predictorlmm">predictorLMM</code></td>
<td>
<p>plugInLMM object, the first predictor used to define the bootstrap model.
</p>
</td></tr>
<tr><td><code id="bootResMis_+3A_predictorlmmmis">predictorLMMmis</code></td>
<td>
<p>plugInLMM object, the second predictor.
</p>
</td></tr>
<tr><td><code id="bootResMis_+3A_b">B</code></td>
<td>
<p>number of iterations in the bootstrap procedure.
</p>
</td></tr>
<tr><td><code id="bootResMis_+3A_p">p</code></td>
<td>
<p>orders of quantiles in the QAPE.
</p>
</td></tr>
<tr><td><code id="bootResMis_+3A_correction">correction</code></td>
<td>
<p>logical. If TRUE, both bootstrapped random effects and random components are tranformed to avoid the problem of underdispersion of residual bootstrap distributions (see Details).
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Residual bootstrap considered by Carpener, Goldstein and Rasbash (2003), Chambers and Chandra (2013) and Thai et al. (2013) is used. We use model specification used in <em>predictorLMM</em>. To generate one bootstrap realization of the population vector of the variable of interest: (i) from the sample vector of predicted random components the simple random sample with replacement of population size is drawn at random, (ii) from the vector of predicted random effects the simple random sample with replacement of size equal the number of random effects in the whole population is drawn at random. If <em>correction</em> is <em>TRUE</em>, then predicted random effects are transformed as described in Carpener, Goldstein and Rasbash (2003) in Section 3.2 and predicted random components as presented in Chambers and Chandra (2013) in Section 2.2. We use the MSE estimator defined as the mean of squared bootstrap errors considered by Rao and Molina (2015) p. 141 given by equation (6.2.22). The QAPE is a quantile of absolute prediction error which means that at least p100% of realizations of absolute prediction errors are smaller or equal to QAPE. It is estimated as a quantile of absolute bootstrap errors as proposed by Zadlo (2017) in Section 2. The prediction accuracy of two predictors <em>predictorLMM</em> and <em>predictorLMMmis</em> is estimated under the model specified in <em>predictorLMM</em>.</p>


<h3>Value</h3>

<table>
<tr><td><code>estQAPElmm</code></td>
<td>
<p>estimated value/s of QAPE of <em>predictorLMM</em> - number of rows is equal the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal the number of predicted characteristics (declared in <em>thetaFun</em>).</p>
</td></tr>
<tr><td><code>estRMSElmm</code></td>
<td>
<p>estimated value/s of RMSE of <em>predictorLMM</em> (more than one value is computed if in
<em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>estQAPElmmMis</code></td>
<td>
<p>estimated value/s of QAPE of <em>predictorLMMmis</em> - number of rows is equal the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal the number of predicted characteristics (declared in <em>thetaFun</em>).</p>
</td></tr>
<tr><td><code>estRMSElmmMis</code></td>
<td>
<p>estimated value/s of RMSE of <em>predictorLMMmis</em> (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>predictorLMMSim</code></td>
<td>
<p>bootstrapped values of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>predictorLMMmisSim</code></td>
<td>
<p>bootstrapped values of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>thetaSim</code></td>
<td>
<p>bootstrapped values of the predicted population or subpopulation characteristic/s.</p>
</td></tr>
<tr><td><code>Ysim</code></td>
<td>
<p>simulated values of the (possibly tranformed) variable of interest.</p>
</td></tr>
<tr><td><code>errorLMM</code></td>
<td>
<p>differences between bootstrapped values of <em>predictorLMM</em> and bootstrapped values of the predicted characteristic/s.</p>
</td></tr>
<tr><td><code>errorLMMmis</code></td>
<td>
<p>differences between bootstrapped values of <em>predictorLMMmis</em> and bootstrapped values of the predicted characteristic/s.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alicja Wolny-Dominiak, Tomasz Zadlo</p>


<h3>References</h3>

<p>1. Carpenter, J.R., Goldstein, H. and Rasbash, J. (2003), A novel bootstrap procedure for assessing the relationship between class size and achievement. Journal of the Royal Statistical Society: Series C (Applied Statistics), 52, 431-443. <br /> 
</p>
<p>2. Chambers, R. and Chandra, H. (2013) A Random Effect Block Bootstrap for Clustered Data, Journal of Computational and Graphical Statistics, 22(2), 452-470. <br />
</p>
<p>3. Thai, H.-T., Mentre, F., Holford, N.H., Veyrat-Follet, C. and Comets, E. (2013), A comparison of bootstrap approaches for estimating uncertainty of parameters in linear mixed-effects models. Pharmaceutical Statistics, 12, 129-140. <br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(lme4)
library(Matrix)
library(mvtnorm)


data(invData) 
# data from one period are considered: 
invData2018 &lt;- invData[invData$year == 2018,] 
attach(invData2018)

N &lt;- nrow(invData2018) # population size

con &lt;- rep(1,N) 
con[c(379:380)] &lt;- 0 # last two population elements are not observed 

YS &lt;- log(investments[con == 1]) # log-transformed values
backTrans &lt;- function(x) exp(x) # back-transformation of the variable of interest
fixed.part &lt;- 'log(newly_registered)'
random.part &lt;- '(1|NUTS2)' 
random.part.mis &lt;- '(1|NUTS4type)'

reg &lt;- invData2018[, -which(names(invData2018) == 'investments')]
weights &lt;- rep(1,N) # homoscedastic random components

# Characteristics to be predicted:
# values of the variable for last two population elements  
thetaFun &lt;- function(x) {x[c(379:380)]}

predictorLMM &lt;- plugInLMM(YS, fixed.part, random.part, reg, con, weights, backTrans, thetaFun)
predictorLMM$thetaP

predictorLMMmis &lt;- plugInLMM(YS, fixed.part, random.part.mis, reg,con,weights,backTrans,thetaFun)
predictorLMMmis$thetaP

set.seed(123456)
### Estimation of prediction accuracy
est_accuracy &lt;- bootResMis(predictorLMM, predictorLMMmis, 10, c(0.5,0.8), correction = TRUE)

# Estimation of prediction RMSE of predictorLMM 
est_accuracy$estRMSElmm

# Estimation of prediction RMSE of predictorLMMmis
est_accuracy$estRMSElmmMis

# Estimation of prediction QAPE of predictorLMM 
est_accuracy$estQAPElmm

# Estimation of prediction QAPE of predictorLMMmis
est_accuracy$estQAPElmmMis

detach(invData2018)
</code></pre>

<hr>
<h2 id='correction'>Correction term for predicted random effects
</h2><span id='topic+correction'></span>

<h3>Description</h3>

<p>The function computes the list of matrices used to correct predicted random effects as presented in Carpenter, Goldstein and Rasbash (2003) in Section 3.2 to avoid the problem of underdispersion of residual bootstrap distributions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>correction(model)
</code></pre>


<h3>Arguments</h3>

 <table>
<tr><td><code id="correction_+3A_model">model</code></td>
<td>
 <p><em>lmer</em> object.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list of square matrices used to correct predicted random effects. The length of the list is equal the number of grouping variables used in case of random effects. Each matrix is of order equal the number of random effects at the considered level of grouping.
</p>


<h3>Author(s)</h3>

<p>Tomasz Zadlo</p>


<h3>References</h3>

<p>Carpenter, J.R., Goldstein, H. and Rasbash, J. (2003), A novel bootstrap procedure for assessing the relationship between class size and achievement. Journal of the Royal Statistical Society: Series C (Applied Statistics), 52, 431-443. <br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(lme4)
data(invData)
attach(invData)
model &lt;- lmer(investments ~ newly_registered + ((1|NUTS2) + 
((newly_registered - 1)|NUTS2) + ((newly_registered)|NUTS4)))
correction(model)

detach(invData)
</code></pre>

<hr>
<h2 id='corrRancomp'>Correction of predicted random components</h2><span id='topic+corrRancomp'></span>

<h3>Description</h3>

<p>The function computes the corrected predicted random components as presented in Chambers and Chandra (2013) in Section 2.2 to avoid the problem of underdispersion of residual bootstrap distributions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>corrRancomp(model)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="corrRancomp_+3A_model">model</code></td>
<td>
 <p><em>lmer</em> object.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the vector of corrected predicted random components.</p>


<h3>Author(s)</h3>

<p>Tomasz Zadlo</p>


<h3>References</h3>

<p>Chambers, R. and Chandra, H. (2013) A Random Effect Block Bootstrap for Clustered Data, Journal of Computational and Graphical Statistics, 22(2), 452-470.  <br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(lme4)
data(invData)
attach(invData)
model &lt;- lmer(investments ~ newly_registered + ((1|NUTS2) + 
((newly_registered - 1)|NUTS2) + ((newly_registered)|NUTS4)))
corrRancomp(model)
detach(invData)
</code></pre>

<hr>
<h2 id='corrRanef'>Correction of predicted random effects</h2><span id='topic+corrRanef'></span>

<h3>Description</h3>

<p>The function computes the corrected predicted random effects as presented in Carpenter, Goldstein and Rasbash (2003) in Section 3.2 to avoid the problem of underdispersion of residual bootstrap distributions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>corrRanef(model)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="corrRanef_+3A_model">model</code></td>
<td>
 <p><em>lmer</em> object.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list of corrected predicted random effects (of the same form as <em>ranef(model)</em>).</p>


<h3>Author(s)</h3>

<p>Tomasz Zadlo</p>


<h3>References</h3>

<p>Carpenter, J.R., Goldstein, H. and Rasbash, J. (2003), A novel bootstrap procedure for assessing the relationship between class size and achievement. Journal of the Royal Statistical Society: Series C (Applied Statistics), 52, 431-443. <br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(lme4)
data(invData)
attach(invData)
model &lt;- lmer(investments ~ newly_registered + ((1|NUTS2) + 
((newly_registered - 1)|NUTS2) + ((newly_registered)|NUTS4)))
corrRanef(model)
detach(invData)
</code></pre>

<hr>
<h2 id='doubleBoot'>Double bootstrap estimators of prediction accuracy
</h2><span id='topic+doubleBoot'></span>

<h3>Description</h3>

<p>The function computes values of double bootstrap estimators of the MSE and the QAPE prediction accuracy measures.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>doubleBoot(predictor, B1, B2, p, q)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="doubleBoot_+3A_predictor">predictor</code></td>
<td>
<p>one of objects: EBLUP, ebpLMMne or plugInLMM.
</p>
</td></tr>
<tr><td><code id="doubleBoot_+3A_b1">B1</code></td>
<td>
<p>number of first-level bootstrap iterations.
</p>
</td></tr>
<tr><td><code id="doubleBoot_+3A_b2">B2</code></td>
<td>

<p>number of second-level bootstrap iterations.
</p>
</td></tr>
<tr><td><code id="doubleBoot_+3A_p">p</code></td>
<td>

<p>orders of quantiles in the QAPE.
</p>
</td></tr>
<tr><td><code id="doubleBoot_+3A_q">q</code></td>
<td>

<p>estimator bounds assumed for <em>estMSE_db_1_EF</em> and <em>estMSE_db_telesc_EF</em> (which are corrected versions of <em>estMSE_db_1</em> and <em>estMSE_db_telesc</em>, respectively).
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Double-bootstrap method considered by Hall and Maiti (2006) and  Erciulescu and Fuller (2013) is used. Vectors of random effects and random components are generated from the multivariate normal distribution and REML estimates of model parameters are used. Random effects are generated for all population elements even for subsets with zero sample sizes (for which random effects are not estimated). Double-bootstrap MSE estimator presented in Hall and Maiti (2006) and  Erciulescu and Fuller (2013) are taken into account. The QAPE is a quantile of absolute prediction error which means that at least p100% of realizations of absolute prediction errors are smaller or equal to QAPE.  
</p>


<h3>Value</h3>

<table>
<tr><td><code>estMSE_param</code></td>
<td>
<p>value/s of the parametric bootstrap MSE estimator. More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_B2</code></td>
<td>
<p>value/s of the double bootstrap MSE estimator computed as the difference of doubled value of <em>estMSE_param</em> and the second-level MSE estimator based on B2 iterations. More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_B2_WDZ</code></td>
<td>
<p>value/s of the double bootstrap MSE estimator computed as the mean of squared first-level bootstraped errors, each corrected by the mean of squared second-level bootstraped errors based on B2 iterations (where correction is made only if their difference is non-negative). More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_B2_HM</code></td>
<td>
<p>value/s of the double bootstrap MSE estimator proposed by Hall and Maiti (2006) equation (2.17). More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_1</code></td>
<td>
<p>value/s of the double bootstrap MSE estimator computed as the difference of doubled value of <em>estMSE_param</em> and the second-level MSE estimator based on B2=1 iteration. More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_1_WDZ</code></td>
<td>
<p>value/s of the double bootstrap MSE estimator computed as the mean of squared first-level bootstraped errors, each corrected by the squared second-level bootstraped error based on 1 iteration (where correction is made only if their difference is non-negative). More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_1_EF</code></td>
<td>
<p>value/s of the double bootstrap MSE estimator proposed by Erciulescu and Fuller (2014) given by equation (13) with correction (17), where the bound for the correction is declared as <em>q</em>. More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_telesc</code></td>
<td>
<p>value/s of the telescoping double bootstrap MSE estimator proposed by Erciulescu and Fuller (2014) given by equation (15). More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_telesc_WDZ</code></td>
<td>
<p>value/s of the double bootstrap MSE estimator computed as the mean of the sums of the following elements: squared first-level bootstraped error, squared first-level bootstrap error for the next iteration and the opposite of second-level bootstraped error based on 1 iteration (but negative sums are replaced by squared first-level bootstraped error). More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_telesc_EF</code></td>
<td>
<p>value/s of the telescoping double bootstrap MSE estimator proposed by Erciulescu and Fuller (2014) given by equation (15) with correction (17), where the bound for the correction is declared as <em>q</em>. More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estQAPE_param</code></td>
<td>
<p>value/s of parametric bootstrap estimator of QAPE (Quantile of Absolute Prediction Error) given by a quantile of absolute parametric bootstrap errors. Number of rows is equal the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal the number of predicted characteristics (declared in  in <em>thetaFun</em>).
</p>
</td></tr>
<tr><td><code>estQAPE_db_B2</code></td>
<td>
<p>value/s of double-bootstrap estimator of QAPE (Quantile of Absolute Prediction Error) given by a quantile of square roots of squared first-level bootstraped errors, each corrected by the mean of squared second-level bootstraped errors based on B2 iterations (where correction is made only if their difference is non-negative). Number of rows is equal the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal the number of predicted characteristics (declared in  in <em>thetaFun</em>).
</p>
</td></tr>
<tr><td><code>estQAPE_db_1</code></td>
<td>
<p>value/s of double-bootstrap estimator of QAPE (Quantile of Absolute Prediction Error) given by a quantile of square roots of squared first-level bootstraped errors, each corrected by the squared second-level bootstraped error based on 1 iteration (where correction is made only if their difference is non-negative). Number of rows is equal the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal the number of predicted characteristics (declared in  in <em>thetaFun</em>).
</p>
</td></tr>
<tr><td><code>estQAPE_db_telesc</code></td>
<td>
<p>value/s of double-bootstrap estimator of QAPE (Quantile of Absolute Prediction Error) given by a quantile of square roots of the sums of the following elements: squared first-level bootstraped error, squared first-level bootstrap error for the next iteration and the opposite of second-level bootstraped error based on 1 iteration (but negative sums are replaced by squared first-level bootstraped error). Number of rows is equal to the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>).
</p>
</td></tr>
<tr><td><code>error1</code></td>
<td>
<p>the matrix of first-level bootstrap errors. Number of rows is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>), number of columns is equal to <em>B1</em>.
</p>
</td></tr>
<tr><td><code>error2</code></td>
<td>
<p>the list of matrices of second-level bootstrap errors. The length of list is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>), the number of rows of each matrix is equal to <em>B1</em>, the number of columns is equal to <em>B2</em>.
</p>
</td></tr>
<tr><td><code>corSquaredError1_db_B2</code></td>
<td>
<p>the matrix of corrected squared first-level bootstrap errors defined as doubled squared first-level bootstrap errors minus the mean of squared second-level bootstrap errors (computed for the approriate first-level bootstrap iterations). Number of rows is equal to <em>B1</em>, the number of columns is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>). Values can be negative.
</p>
</td></tr>
<tr><td><code>corSquaredError1_db_1</code></td>
<td>
<p>the matrix of corrected squared first-level bootstrap errors defined as doubled squared first-level bootstrap errors minus the squared second-level bootstrap error (computed once for each first-level bootstrap iteration). Number of rows is equal to <em>B1</em>, the number of columns is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>). Values can be negative.
</p>
</td></tr>
<tr><td><code>corSquaredError1_db_telesc</code></td>
<td>
<p>the matrix of corrected squared first-level bootstrap errors defined by elements from which the average given by equation (15) in Erciulescu and Fuller (2014) is counted. Number of rows is equal to <em>B1</em>, the number of columns is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>). Values can be negative.
</p>
</td></tr>
<tr><td><code>corSquaredError1_db_B2_WDZ</code></td>
<td>
<p>the matrix of squared first-level bootstraped errors, each corrected by the mean of squared second-level bootstraped errors based on B2 iterations (where correction is made only if their difference is non-negative). Number of rows is equal to <em>B1</em>, the number of columns is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>). Values are non-negative.</p>
</td></tr>
<tr><td><code>corSquaredError1_db_1_WDZ</code></td>
<td>
<p>the matrix of squared first-level bootstraped errors, each corrected by the squared second-level bootstraped error based on 1 iteration (where correction is made only if their difference is non-negative). Number of rows is equal to <em>B1</em>, the number of columns is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>). Values are non-negative.</p>
</td></tr>
<tr><td><code>corSquaredError1_db_telesc_WDZ</code></td>
<td>
<p>the matrix of corrected squared first-level bootstrap errors defined by sums of the following elements: squared first-level bootstraped error, squared first-level bootstrap error for the next iteration and the opposite of second-level bootstraped error based on 1 iteration (but negative sums are replaced by squared first-level bootstraped error).Number of rows is equal to <em>B1</em>, the number of columns is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>). Values are non-negative.</p>
</td></tr>
<tr><td><code>positiveDefiniteEstGlev1</code></td>
<td>
<p>logical indicating if the estimated covariance matrix of random effects, used to generate bootstrap realizations of the dependent variable at the first level of the double bootstrap, is positive definite.</p>
</td></tr> 
<tr><td><code>positiveDefiniteEstGlev2</code></td>
<td>
<p>number of cases ouf of B1 with positive definite estimated covariance matrix of random effects used to generate bootstrap realizations of the dependent variable at the second level of the double bootstrap.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alicja Wolny-Dominiak, Tomasz Zadlo</p>


<h3>References</h3>

<p>1. Erciulescu, A. L. and Fuller, W. A. (2013) Parametric Bootstrap Procedures for Small Area Prediction Variance. JSM 2014 - Survey Research Methods Section, 3307-3318.<br />
</p>
<p>2. Hall, P. and Maiti, T. (2006) On Parametric Bootstrap Methods for Small Area Prediction. Journal of the Royal Statistical Society. Series B, 68(2), 221-238.<br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

library(lme4)
library(Matrix)
library(mvtnorm)


data(invData) 
# data from one period are considered: 
invData2018 &lt;- invData[invData$year == 2018,] 
attach(invData2018)

N &lt;- nrow(invData2018) # population size

con &lt;- rep(1,N) 
con[c(379,380)] &lt;- 0 # last two population elements are not observed 

YS &lt;- log(investments[con == 1]) # log-transformed values
backTrans &lt;- function(x) exp(x) # back-transformation of the variable of interest
fixed.part &lt;- 'log(newly_registered)'
random.part &lt;- '(1|NUTS2)' 

reg &lt;- invData2018[, -which(names(invData2018) == 'investments')]
weights &lt;- rep(1,N) # homoscedastic random components

### Characteristics to be predicted:
# values of the variable for last two population elements  
thetaFun &lt;- function(x) {x[c(379,380)]}
set.seed(123456)

predictor &lt;- plugInLMM(YS, fixed.part, random.part, reg, con, weights, backTrans, thetaFun)
predictor$thetaP


### Estimation of prediction accuracy
# in the first column
# for the predictor of the value of the variable for population element no. 379,
# in the second column
# for the predictor of the value of the variable for population element no. 380:
doubleBoot(predictor, 3, 3, c(0.5,0.9), 0.77) 
#q=0.77 assumed as in Erciulescu and FUller (2014) eq. (17)

detach(invData2018)
</code></pre>

<hr>
<h2 id='doubleBootFuture'>Double bootstrap estimators of prediction accuracy - parallel computing
</h2><span id='topic+doubleBootFuture'></span>

<h3>Description</h3>

<p>The function computes values of double bootstrap estimators of the MSE and the QAPE prediction accuracy measures using parallel computing.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>doubleBootFuture(predictor, B1, B2, p, q)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="doubleBootFuture_+3A_predictor">predictor</code></td>
<td>
<p>one of objects: EBLUP, ebpLMMne or plugInLMM.
</p>
</td></tr>
<tr><td><code id="doubleBootFuture_+3A_b1">B1</code></td>
<td>
<p>number of first-level bootstrap iterations.
</p>
</td></tr>
<tr><td><code id="doubleBootFuture_+3A_b2">B2</code></td>
<td>
<p>number of second-level bootstrap iterations.
</p>
</td></tr>
<tr><td><code id="doubleBootFuture_+3A_p">p</code></td>
<td>
<p>orders of quantiles in the QAPE.
</p>
</td></tr>
<tr><td><code id="doubleBootFuture_+3A_q">q</code></td>
<td>
<p>estimator bounds assumed for <em>estMSE_db_1_EF</em> and <em>estMSE_db_telesc_EF</em> (which are corrected versions of <em>estMSE_db_1</em> and <em>estMSE_db_telesc</em>, respectively).
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Double-bootstrap method considered by Hall and Maiti (2006) and  Erciulescu and Fuller (2013) is used. Vectors of random effects and random components are generated from the multivariate normal distribution and REML estimates of model parameters are used. Random effects are generated for all population elements even for subsets with zero sample sizes (for which random effects are not estimated). Double-bootstrap MSE estimator presented in Hall and Maiti (2006) and  Erciulescu and Fuller (2013) are taken into account. The QAPE is a quantile of absolute prediction error which means that at least p100% of realizations of absolute prediction errors are smaller or equal to QAPE. The parallel processing is performed via the <em>future.apply</em> package.  
</p>


<h3>Value</h3>

<table>
<tr><td><code>estMSE_param</code></td>
<td>
<p>value/s of the parametric bootstrap MSE estimator. More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_B2</code></td>
<td>
<p>value/s of the double bootstrap MSE estimator computed as the difference of doubled value of <em>estMSE_param</em> and the second-level MSE estimator based on B2 iterations. More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_B2_WDZ</code></td>
<td>
<p>value/s of the double bootstrap MSE estimator computed as the mean of squared first-level bootstraped errors, each corrected by the mean of squared second-level bootstraped errors based on B2 iterations (where correction is made only if their difference is non-negative). More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_B2_HM</code></td>
<td>
<p>value/s of the double bootstrap MSE estimator proposed by Hall and Maiti (2006) equation (2.17). More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_1</code></td>
<td>
<p>value/s of the double bootstrap MSE estimator computed as the difference of doubled value of <em>estMSE_param</em> and the second-level MSE estimator based on B2=1 iteration. More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_1_WDZ</code></td>
<td>
<p>value/s of the double bootstrap MSE estimator computed as the mean of squared first-level bootstraped errors, each corrected by the squared second-level bootstraped error based on 1 iteration (where correction is made only if their difference is non-negative). More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_1_EF</code></td>
<td>
<p>value/s of the double bootstrap MSE estimator proposed by Erciulescu and Fuller (2014) given by equation (13) with correction (17), where the bound for the correction is declared as <em>q</em>. More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_telesc</code></td>
<td>
<p>value/s of the telescoping double bootstrap MSE estimator proposed by Erciulescu and Fuller (2014) given by equation (15). More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_telesc_WDZ</code></td>
<td>
<p>value/s of the double bootstrap MSE estimator computed as the mean of the sums of the following elements: squared first-level bootstraped error, squared first-level bootstrap error for the next iteration and the opposite of second-level bootstraped error based on 1 iteration (but negative sums are replaced by squared first-level bootstraped error). More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_telesc_EF</code></td>
<td>
<p>value/s of the telescoping double bootstrap MSE estimator proposed by Erciulescu and Fuller (2014) given by equation (15) with correction (17), where the bound for the correction is declared as <em>q</em>. More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estQAPE_param</code></td>
<td>
<p>value/s of parametric bootstrap estimator of QAPE (Quantile of Absolute Prediction Error) given by a quantile of absolute parametric bootstrap errors. Number of rows is equal the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal the number of predicted characteristics (declared in  in <em>thetaFun</em>).
</p>
</td></tr>
<tr><td><code>estQAPE_db_B2</code></td>
<td>
<p>value/s of double-bootstrap estimator of QAPE (Quantile of Absolute Prediction Error) given by a quantile of square roots of squared first-level bootstraped errors, each corrected by the mean of squared second-level bootstraped errors based on B2 iterations (where correction is made only if their difference is non-negative). Number of rows is equal the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal the number of predicted characteristics (declared in  in <em>thetaFun</em>).
</p>
</td></tr>
<tr><td><code>estQAPE_db_1</code></td>
<td>
<p>value/s of double-bootstrap estimator of QAPE (Quantile of Absolute Prediction Error) given by a quantile of square roots of squared first-level bootstraped errors, each corrected by the squared second-level bootstraped error based on 1 iteration (where correction is made only if their difference is non-negative). Number of rows is equal the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal the number of predicted characteristics (declared in  in <em>thetaFun</em>).
</p>
</td></tr>
<tr><td><code>estQAPE_db_telesc</code></td>
<td>
<p>value/s of double-bootstrap estimator of QAPE (Quantile of Absolute Prediction Error) given by a quantile of square roots of the sums of the following elements: squared first-level bootstraped error, squared first-level bootstrap error for the next iteration and the opposite of second-level bootstraped error based on 1 iteration (but negative sums are replaced by squared first-level bootstraped error). Number of rows is equal to the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>).
</p>
</td></tr>
<tr><td><code>error1</code></td>
<td>
<p>the matrix of first-level bootstrap errors. Number of rows is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>), number of columns is equal to <em>B1</em>.
</p>
</td></tr>
<tr><td><code>error2</code></td>
<td>
<p>the list of matrices of second-level bootstrap errors. The length of list is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>), the number of rows of each matrix is equal to <em>B1</em>, the number of columns is equal to <em>B2</em>.
</p>
</td></tr>
<tr><td><code>corSquaredError1_db_B2</code></td>
<td>
<p>the matrix of corrected squared first-level bootstrap errors defined as doubled squared first-level bootstrap errors minus the mean of squared second-level bootstrap errors (computed for the approriate first-level bootstrap iterations). Number of rows is equal to <em>B1</em>, the number of columns is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>). Values can be negative.
</p>
</td></tr>
<tr><td><code>corSquaredError1_db_1</code></td>
<td>
<p>the matrix of corrected squared first-level bootstrap errors defined as doubled squared first-level bootstrap errors minus the squared second-level bootstrap error (computed once for each first-level bootstrap iteration). Number of rows is equal to <em>B1</em>, the number of columns is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>). Values can be negative.
</p>
</td></tr>
<tr><td><code>corSquaredError1_db_telesc</code></td>
<td>
<p>the matrix of corrected squared first-level bootstrap errors defined by elements from which the average given by equation (15) in Erciulescu and Fuller (2014) is counted. Number of rows is equal to <em>B1</em>, the number of columns is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>). Values can be negative.
</p>
</td></tr>
<tr><td><code>corSquaredError1_db_B2_WDZ</code></td>
<td>
<p>the matrix of squared first-level bootstraped errors, each corrected by the mean of squared second-level bootstraped errors based on B2 iterations (where correction is made only if their difference is non-negative). Number of rows is equal to <em>B1</em>, the number of columns is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>). Values are non-negative.</p>
</td></tr>
<tr><td><code>corSquaredError1_db_1_WDZ</code></td>
<td>
<p>the matrix of squared first-level bootstraped errors, each corrected by the squared second-level bootstraped error based on 1 iteration (where correction is made only if their difference is non-negative). Number of rows is equal to <em>B1</em>, the number of columns is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>). Values are non-negative.</p>
</td></tr>
<tr><td><code>corSquaredError1_db_telesc_WDZ</code></td>
<td>
<p>the matrix of corrected squared first-level bootstrap errors defined by sums of the following elements: squared first-level bootstraped error, squared first-level bootstrap error for the next iteration and the opposite of second-level bootstraped error based on 1 iteration (but negative sums are replaced by squared first-level bootstraped error).Number of rows is equal to <em>B1</em>, the number of columns is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>). Values are non-negative.</p>
</td></tr>
<tr><td><code>positiveDefiniteEstGlev1</code></td>
<td>
<p>logical indicating if the estimated covariance matrix of random effects, used to generate bootstrap realizations of the dependent variable at the first level of the double bootstrap, is positive definite.</p>
</td></tr> 
<tr><td><code>positiveDefiniteEstGlev2</code></td>
<td>
<p>number of cases ouf of B1 with positive definite estimated covariance matrix of random effects used to generate bootstrap realizations of the dependent variable at the second level of the double bootstrap.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alicja Wolny-Dominiak, Tomasz Zadlo</p>


<h3>References</h3>

<p>1. Erciulescu, A. L. and Fuller, W. A. (2013) Parametric Bootstrap Procedures for Small Area Prediction Variance. JSM 2014 - Survey Research Methods Section, 3307-3318.<br />
</p>
<p>2. Hall, P. and Maiti, T. (2006) On Parametric Bootstrap Methods for Small Area Prediction. Journal of the Royal Statistical Society. Series B, 68(2), 221-238.<br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(lme4)
library(Matrix)
library(mvtnorm)


data(invData) 
# data from one period are considered: 
invData2018 &lt;- invData[invData$year == 2018,] 
attach(invData2018)

N &lt;- nrow(invData2018) # population size

con &lt;- rep(1,N) 
con[c(379,380)] &lt;- 0 # last two population elements are not observed 

YS &lt;- log(investments[con == 1]) # log-transformed values
backTrans &lt;- function(x) exp(x) # back-transformation of the variable of interest
fixed.part &lt;- 'log(newly_registered)'
random.part &lt;- '(1|NUTS2)' 

reg &lt;- invData2018[, -which(names(invData2018) == 'investments')]
weights &lt;- rep(1,N) # homoscedastic random components

### Characteristics to be predicted:
# values of the variable for last two population elements  
thetaFun &lt;- function(x) {x[c(379,380)]}
set.seed(123456)

predictor &lt;- plugInLMM(YS, fixed.part, random.part, reg, con, weights, backTrans, thetaFun)
predictor$thetaP


### Estimation of prediction accuracy
# in the first column
# for the predictor of the value of the variable for population element no. 379,
# in the second column
# for the predictor of the value of the variable for population element no. 380:
doubleBootFuture(predictor, 3, 3, c(0.5,0.9), 0.77) 
#q=0.77 assumed as in Erciulescu and FUller (2014) eq. (17)

detach(invData2018)
</code></pre>

<hr>
<h2 id='doubleBootMis'>Double bootstrap estimators of prediction accuracy under the misspecified model
</h2><span id='topic+doubleBootMis'></span>

<h3>Description</h3>

<p>The function computes values of double bootstrap estimators of the MSE and the QAPE prediction accuracy measures of two predictors under the model assumed for one of them.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>doubleBootMis(predictorLMM, predictorLMMmis, B1, B2, p, q)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="doubleBootMis_+3A_predictorlmm">predictorLMM</code></td>
<td>
<p>plugInLMM object, the first predictor used to define the bootstrap model.
</p>
</td></tr>
<tr><td><code id="doubleBootMis_+3A_predictorlmmmis">predictorLMMmis</code></td>
<td>
<p>plugInLMM object, the second predictor.
</p>
</td></tr>
<tr><td><code id="doubleBootMis_+3A_b1">B1</code></td>
<td>
<p>the number of first-level bootstrap iterations.
</p>
</td></tr>
<tr><td><code id="doubleBootMis_+3A_b2">B2</code></td>
<td>
<p>the number of second-level bootstrap iterations.
</p>
</td></tr>
<tr><td><code id="doubleBootMis_+3A_p">p</code></td>
<td>
<p>orders of quantiles in the QAPE.
</p>
</td></tr>
<tr><td><code id="doubleBootMis_+3A_q">q</code></td>
<td>

<p>estimator bounds assumed for <em>estMSE_db_1_EF</em> and <em>estMSE_db_telesc_EF</em> (which are corrected versions of <em>estMSE_db_1</em> and <em>estMSE_db_telesc</em>, respectively).
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Double-bootstrap method considered by Hall and Maiti (2006) and  Erciulescu and Fuller (2013) is used. We use model specification used in <em>predictorLMM</em>. Vectors of random effects and random components are generated from the multivariate normal distribution and REML estimates of model parameters are used. Random effects are generated for all population elements even for subsets with zero sample sizes (for which random effects are not estimated). Double-bootstrap MSE estimator presented in Hall and Maiti (2006) and  Erciulescu and Fuller (2013) are taken into account. The QAPE is a quantile of absolute prediction error which means that at least p100% of realizations of absolute prediction errors are smaller or equal to QAPE. The prediction accuracy of two predictors <em>predictorLMM</em> and <em>predictorLMMmis</em> is estimated under the model specified in <em>predictorLMM</em>.   
</p>


<h3>Value</h3>

<table>
<tr><td><code>estMSE_param_LMMmis</code></td>
<td>
<p>value/s of the parametric bootstrap MSE estimator of <em>predictorLMMmis</em>. More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_B2_LMMmis</code></td>
<td>
<p>value/s of the double bootstrap MSE estimator of <em>predictorLMMmis</em> computed as the difference of doubled value of <em>estMSE_param</em> and the second-level MSE estimator based on B2 iterations. More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_B2_WDZ_LMMmis</code></td>
<td>
<p>value/s of the double bootstrap MSE estimator of <em>predictorLMMmis</em> computed as the mean of squared first-level bootstraped errors, each corrected by the mean of squared second-level bootstraped errors based on B2 iterations (where correction is made only if their difference is non-negative). More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_B2_HM_LMMmis</code></td>
<td>
<p>value/s of the double bootstrap MSE estimator of <em>predictorLMMmis</em> proposed by Hall and Maiti (2006) equation (2.17). More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_1_LMMmis</code></td>
<td>
<p>value/s of the double bootstrap MSE estimator of <em>predictorLMMmis</em> computed as the difference of doubled value of <em>estMSE_param</em> and the second-level MSE estimator based on B2=1 iteration. More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_1_WDZ_LMMmis</code></td>
<td>
<p>value/s of the double bootstrap MSE estimator of <em>predictorLMMmis</em> computed as the mean of squared first-level bootstraped errors, each corrected by the squared second-level bootstraped error based on 1 iteration (where correction is made only if their difference is non-negative). More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_1_EF_LMMmis</code></td>
<td>
<p>value/s of the double bootstrap MSE estimator of <em>predictorLMMmis</em> proposed by Erciulescu and Fuller (2014) given by equation (13) with correction (17), where the bound for the correction is declared as <em>q</em>. More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_telesc_LMMmis</code></td>
<td>
<p>value/s of the telescoping double bootstrap MSE estimator of <em>predictorLMMmis</em> proposed by Erciulescu and Fuller (2014) given by equation (15). More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_telesc_WDZ_LMMmis</code></td>
<td>
<p>value/s of the double bootstrap MSE estimator of <em>predictorLMMmis</em> computed as the mean of the sums of the following elements: squared first-level bootstraped error, squared first-level bootstrap error for the next iteration and the opposite of second-level bootstraped error based on 1 iteration (but negative sums are replaced by squared first-level bootstraped error). More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estMSE_db_telesc_EF_LMMmis</code></td>
<td>
<p>value/s of the telescoping double bootstrap MSE estimator of <em>predictorLMMmis</em> proposed by Erciulescu and Fuller (2014) given by equation (15) with correction (17), where the bound for the correction is declared as <em>q</em>. More than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined.
</p>
</td></tr>
<tr><td><code>estQAPE_param_LMMmis</code></td>
<td>
<p>value/s of parametric bootstrap estimator of QAPE (Quantile of Absolute Prediction Error) of <em>predictorLMMmis</em> given by a quantile of absolute parametric bootstrap errors. Number of rows is equal the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal the number of predicted characteristics (declared in  in <em>thetaFun</em>).
</p>
</td></tr>
<tr><td><code>estQAPE_db_B2_LMMmis</code></td>
<td>
<p>value/s of double-bootstrap estimator of QAPE (Quantile of Absolute Prediction Error) of <em>predictorLMMmis</em> given by a quantile of square roots of squared first-level bootstraped errors, each corrected by the mean of squared second-level bootstraped errors based on B2 iterations (where correction is made only if their difference is non-negative). Number of rows is equal the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal the number of predicted characteristics (declared in  in <em>thetaFun</em>).
</p>
</td></tr>
<tr><td><code>estQAPE_db_1_LMMmis</code></td>
<td>
<p>value/s of double-bootstrap estimator of QAPE (Quantile of Absolute Prediction Error) of <em>predictorLMMmis</em> given by a quantile of square roots of squared first-level bootstraped errors, each corrected by the squared second-level bootstraped error based on 1 iteration (where correction is made only if their difference is non-negative). Number of rows is equal the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal the number of predicted characteristics (declared in  in <em>thetaFun</em>).
</p>
</td></tr>
<tr><td><code>estQAPE_db_telesc_LMMmis</code></td>
<td>
<p>value/s of double-bootstrap estimator of QAPE (Quantile of Absolute Prediction Error) of <em>predictorLMMmis</em> given by a quantile of square roots of the sums of the following elements: squared first-level bootstraped error, squared first-level bootstrap error for the next iteration and the opposite of second-level bootstraped error based on 1 iteration (but negative sums are replaced by squared first-level bootstraped error). Number of rows is equal to the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>).
</p>
</td></tr>
<tr><td><code>error1_LMMmis</code></td>
<td>
<p>the matrix of first-level bootstrap errors of <em>predictorLMMmis</em>. Number of rows is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>), number of columns is equal to <em>B1</em>.
</p>
</td></tr>
<tr><td><code>error2_LMMmis</code></td>
<td>
<p>the list of matrices of second-level bootstrap errors of <em>predictorLMMmis</em>. The length of list is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>), the number of rows of each matrix is equal to <em>B1</em>, the number of columns is equal to <em>B2</em>.
</p>
</td></tr>
<tr><td><code>corSquaredError1_db_B2_LMMmis</code></td>
<td>
<p>the matrix of corrected squared first-level bootstrap errors of <em>predictorLMMmis</em> defined as doubled squared first-level bootstrap errors minus the mean of squared second-level bootstrap errors (computed for the approriate first-level bootstrap iterations). Number of rows is equal to <em>B1</em>, the number of columns is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>). Values can be negative.
</p>
</td></tr>
<tr><td><code>corSquaredError1_db_1_LMMmis</code></td>
<td>
<p>the matrix of corrected squared first-level bootstrap errors of <em>predictorLMMmis</em> defined as doubled squared first-level bootstrap errors minus the squared second-level bootstrap error (computed once for each first-level bootstrap iteration). Number of rows is equal to <em>B1</em>, the number of columns is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>). Values can be negative.
</p>
</td></tr>
<tr><td><code>corSquaredError1_db_telesc_LMMmis</code></td>
<td>
<p>the matrix of corrected squared first-level bootstrap errors of <em>predictorLMMmis</em> defined by elements from which the average given by equation (15) in Erciulescu and Fuller (2014) is counted. Number of rows is equal to <em>B1</em>, the number of columns is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>). Values can be negative.
</p>
</td></tr>
<tr><td><code>corSquaredError1_db_B2_WDZ_LMMmis</code></td>
<td>
<p>the matrix of squared first-level bootstraped errors of <em>predictorLMMmis</em>, each corrected by the mean of squared second-level bootstraped errors based on B2 iterations (where correction is made only if their difference is non-negative). Number of rows is equal to <em>B1</em>, the number of columns is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>). Values are non-negative.</p>
</td></tr>
<tr><td><code>corSquaredError1_db_1_WDZ_LMMmis</code></td>
<td>
<p>the matrix of squared first-level bootstraped errors of <em>predictorLMMmis</em>, each corrected by the squared second-level bootstraped error based on 1 iteration (where correction is made only if their difference is non-negative). Number of rows is equal to <em>B1</em>, the number of columns is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>). Values are non-negative.</p>
</td></tr>
<tr><td><code>corSquaredError1_db_telesc_WDZ_LMMmis</code></td>
<td>
<p>the matrix of corrected squared first-level bootstrap errors of <em>predictorLMMmis</em> defined by sums of the following elements: squared first-level bootstraped error, squared first-level bootstrap error for the next iteration and the opposite of second-level bootstraped error based on 1 iteration (but negative sums are replaced by squared first-level bootstraped error).Number of rows is equal to <em>B1</em>, the number of columns is equal to the number of predicted characteristics (declared in  in <em>thetaFun</em>). Values are non-negative.</p>
</td></tr>
<tr><td><code>positiveDefiniteEstGlev1</code></td>
<td>
<p>logical indicating if the estimated covariance matrix of random effects, used to generate bootstrap realizations of the dependent variable at the first level of the double bootstrap, is positive definite.</p>
</td></tr> 
<tr><td><code>positiveDefiniteEstGlev2</code></td>
<td>
<p>number of cases ouf of B1 with positive definite estimated covariance matrix of random effects used to generate bootstrap realizations of the dependent variable at the second level of the double bootstrap</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alicja Wolny-Dominiak, Tomasz Zadlo</p>


<h3>References</h3>

<p>1. Erciulescu, A. L. and Fuller, W. A. (2013) Parametric Bootstrap Procedures for Small Area Prediction Variance. JSM 2014 - Survey Research Methods Section, 3307-3318.<br />
</p>
<p>2. Hall, P. and Maiti, T. (2006) On Parametric Bootstrap Methods for Small Area Prediction. Journal of the Royal Statistical Society. Series B, 68(2), 221-238.<br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(lme4)
library(Matrix)
library(mvtnorm)


data(invData) 
# data from one period are considered: 
invData2018 &lt;- invData[invData$year == 2018,] 
attach(invData2018)

N &lt;- nrow(invData2018) # population size

con &lt;- rep(1,N) 
con[c(379,380)] &lt;- 0 # last two population elements are not observed 

YS &lt;- log(investments[con == 1]) # log-transformed values
backTrans &lt;- function(x) exp(x) # back-transformation of the variable of interest
fixed.part &lt;- 'log(newly_registered)'
random.part.mis &lt;- '(1|NUTS4type)'
random.part &lt;- '(1|NUTS2)'

reg &lt;- invData2018[, -which(names(invData2018) == 'investments')]
weights &lt;- rep(1,N) # homoscedastic random components

### Characteristics to be predicted:
# values of the variable for last two population elements  
thetaFun &lt;- function(x) {x[c(379,380)]}
set.seed(123456)

predictorLMM &lt;- plugInLMM(YS, fixed.part, random.part, reg, con, weights, backTrans, thetaFun)
predictorLMM$thetaP

predictorLMMmis &lt;- plugInLMM(YS, fixed.part, random.part.mis, reg,con,weights,backTrans,thetaFun)
predictorLMMmis$thetaP

### Estimation of prediction accuracy
# in the first column
# for the predictor of the value of the variable for population element no. 379,
# in the second column
# for the predictor of the value of the variable for population element no. 380:
doubleBootMis(predictorLMM, predictorLMMmis, 3, 3, c(0.5,0.9), 0.77) 
#q=0.77 assumed as in Erciulescu and FUller (2014) eq. (17)

detach(invData2018)
</code></pre>

<hr>
<h2 id='EBLUP'>
Empirical Best Linear Unbiased Predictor
</h2><span id='topic+EBLUP'></span>

<h3>Description</h3>

<p>The function computes the value of the EBLUP of the linear combination of the variable of interest under the linear mixed model estimated using REML.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>EBLUP(YS, fixed.part, random.part, reg, con, gamma, weights, estMSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="EBLUP_+3A_ys">YS</code></td>
<td>
<p>values of the variable of interest observed in the sample.
</p>
</td></tr>
<tr><td><code id="EBLUP_+3A_fixed.part">fixed.part</code></td>
<td>
<p>fixed-effects terms declared as in <em>lmer</em> object. 
</p>
</td></tr>
<tr><td><code id="EBLUP_+3A_random.part">random.part</code></td>
<td>
<p>random-effects terms declared as in <em>lmer</em> object. 
</p>
</td></tr>
<tr><td><code id="EBLUP_+3A_reg">reg</code></td>
<td>
<p>the population matrix of auxiliary variables named in <em>fixed.part</em> and <em>random.part</em>.
</p>
</td></tr>
<tr><td><code id="EBLUP_+3A_con">con</code></td>
<td>
<p>the population 0-1 vector with 1s for elements in the sample and 0s for elements which are not in the sample.
</p>
</td></tr>
<tr><td><code id="EBLUP_+3A_gamma">gamma</code></td>
<td>
<p>the population vector which transpose multiplied by the population vector of the variable of interest gives the predicted characteristic. For example, if <em>gamma</em> is the population vector of 1s, the sum of the values of the variable of interest in the whole dataset is predicted.  
</p>
</td></tr>
<tr><td><code id="EBLUP_+3A_weights">weights</code></td>
<td>
<p>the population vector of weights, defined as in <em>lmer</em> object, allowing to include heteroscedasticity of random components in the mixed linear model.  
</p>
</td></tr>
<tr><td><code id="EBLUP_+3A_estmse">estMSE</code></td>
<td>
<p>logical. If TRUE, the naive MSE estimator and its components are computed.  
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function computes the value of the EBLUP of the linear combination of the variable of interest based on the formula (21) in Zadlo (2017) (see Remark 5.1 in the paper for further explanations). Predicted values for unsampled population elements in subsets for which random effects are not observed in the sample are computed based only on fixed effects. The naive MSE estimator of the EBLUP, which is the sum of two components given by equations (31) and (32) in Zadlo (2017) p. 8094, where unknown parameters are replaced by their REML estimates, is also computed. The naive MSE estimator ignores the variability of EBLUP resulting from the estimation of variance components.
</p>


<h3>Value</h3>

<p>The function returns a list with the following objects:
</p>
<table>
<tr><td><code>fixed.part</code></td>
<td>
<p>the fixed part of the formula of model.</p>
</td></tr>
<tr><td><code>random.part</code></td>
<td>
<p>the random part of the formula of model.</p>
</td></tr> 
<tr><td><code>thetaP</code></td>
<td>
<p>the value of the predictor.</p>
</td></tr>
<tr><td><code>beta</code></td>
<td>
<p>the estimated vector of fixed effects.</p>
</td></tr>
<tr><td><code>Xbeta</code></td>
<td>
<p>the product of two matrices: the population model matrix of auxiliary variables X and the estimated vector of fixed effects.</p>
</td></tr>
<tr><td><code>sigma2R</code></td>
<td>
<p>the estimated variance parameter of the distribution of random components.</p>
</td></tr>
<tr><td><code>R</code></td>
<td>
<p>the estimated covariance matrix of random components for sampled elements.</p>
</td></tr>
<tr><td><code>G</code></td>
<td>
<p>the estimated covariance matrix of random effects.</p>
</td></tr>
<tr><td><code>model</code></td>
<td>
<p>the formula of the model (as in <em>lmer</em> object).</p>
</td></tr>
<tr><td><code>mEst</code></td>
<td>
<p><em>lmer</em> object with the estimated model.</p>
</td></tr>
<tr><td><code>YS</code></td>
<td>
<p>the sample vector of the variable of interest.</p>
</td></tr>
<tr><td><code>reg</code></td>
<td>
<p>the population matrix of auxiliary variables named in <em>fixed.part</em> and <em>random.part</em>.</p>
</td></tr>
<tr><td><code>con</code></td>
<td>
<p>the population 0-1 vector with 1s for elements in the sample and 0s for elements which are not in the sample.</p>
</td></tr>
<tr><td><code>regS</code></td>
<td>
<p>the sample matrix of auxiliary variables named in <em>fixed.part</em> and <em>random.part</em>.</p>
</td></tr>
<tr><td><code>regR</code></td>
<td>
<p>the matrix of auxiliary variables named in <em>fixed.part</em> and <em>random.part</em> for population elements which are not observed in the sample.</p>
</td></tr>
<tr><td><code>gamma</code></td>
<td>
<p>the population vector which transpose multiplied by the population vector of the variable of interest gives the predicted characteristic.</p>
</td></tr>
<tr><td><code>gammaS</code></td>
<td>
<p>the subvector of <em>gamma</em> for sampled elements.</p>
</td></tr>
<tr><td><code>gammaR</code></td>
<td>
<p>the subvector of <em>gamma</em> for population elements which are not observed in the sample.</p>
</td></tr>
<tr><td><code>weights</code></td>
<td>
<p>the population vector of weights, defined as in <em>lmer</em> object, allowing to include the heteroscedasticity of random components in the mixed linear model.</p>
</td></tr>
<tr><td><code>Z</code></td>
<td>
<p>the population model matrix of auxiliary variables associated with random effects.</p>
</td></tr>
<tr><td><code>ZBlockNames</code></td>
<td>
<p>labels of blocks of random effects in Z matrix.</p>
</td></tr>
<tr><td><code>X</code></td>
<td>
<p>the population model matrix of auxiliary variables associated with fixed effects.</p>
</td></tr>
<tr><td><code>ZS</code></td>
<td>
<p>the submatrix of Z matrix where the number of rows equals the number of sampled elements and the number of columns equals the number of estimated random effects.</p>
</td></tr>
<tr><td><code>XR</code></td>
<td>
<p>the submatrix of X matrix (with the same number of columns) for population elements which are not observed in the sample.</p>
</td></tr>
<tr><td><code>ZR</code></td>
<td>
<p>the submatrix of Z matrix where the number of rows equals the number of population elements which are not observed in the sample and the number of columns equals the number of estimated random effects.</p>
</td></tr>
<tr><td><code>eS</code></td>
<td>
<p>the sample vector of estimated random components.</p>
</td></tr>
<tr><td><code>vS</code></td>
<td>
<p>the estimated vector of random effects.</p>
</td></tr>
<tr><td><code>g1</code></td>
<td>
<p>the first component of the naive MSE estimator 
(computed if <em>estMSE = TRUE</em>).</p>
</td></tr>
<tr><td><code>g2</code></td>
<td>
<p>the second component of the naive MSE estimator 
(computed if <em>estMSE = TRUE</em>).</p>
</td></tr>
<tr><td><code>neMSE</code></td>
<td>
<p>the naive MSE estimator (computed if <em>estMSE = TRUE</em>).</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alicja Wolny-Dominiak, Tomasz Zadlo</p>


<h3>References</h3>

<p>1. Henderson, C.R. (1950) Estimation of Genetic Parameters (Abstract). Annals of Mathematical Statistics 21, 309-310. <br />
2. Royall, R.M. (1976) The Linear Least Squares Prediction Approach to Two-Stage Sampling. Journal of the American Statistical Association 71, 657-473. <br />
3. Zadlo, T. (2017) On prediction of population and subpopulation characteristics for future periods, Communications in Statistics - Simulation and Computation 461(10), 8086-8104. <br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(lme4)
library(Matrix)


### Prediction of the subpopulation mean based on the cross-sectional data

data(invData) 
# data from one period are considered: 
invData2018 &lt;- invData[invData$year == 2018,] 
attach(invData2018)

N &lt;- nrow(invData2018) # population size
n &lt;- 100 # sample size
# subpopulation of interest: NUTS4type==2
Nd &lt;- sum(NUTS4type == 2) # subpopulation size

set.seed(123456)
sampled_elements &lt;- sample(N,n)
con &lt;- rep(0,N)
con[sampled_elements] &lt;- 1 # elements in the sample
YS &lt;- investments[sampled_elements]
fixed.part &lt;- 'newly_registered'
random.part &lt;- '(1| NUTS2)' 
reg = invData2018[, -which(names(invData2018) == 'investments')]

gamma &lt;- rep(0,N)
gamma[NUTS4type == 2] &lt;- 1/Nd

weights &lt;- rep(1,N) # homoscedastic random components
estMSE &lt;- TRUE 

# Predicted value of the mean in the following subpopulation: NUTS4type==2
EBLUP(YS, fixed.part, random.part, reg, con, gamma, weights, estMSE)$thetaP

# All results
EBLUP(YS, fixed.part, random.part, reg, con, gamma, weights, estMSE)

detach(invData2018)

##########################################################

### Prediction of the subpopulation total based on the longitudinal data

data(invData)
attach(invData)

N &lt;- nrow(invData[(year == 2013),]) # population size in the first period
n &lt;- 38 # sample size in the first period
# subpopulation and time period of interest: NUTS2 == '02' &amp; year == 2018
# subpopulation size in the period of interest:
Ndt &lt;- sum(NUTS2 == '02' &amp; year == 2018)

set.seed(123456)
sampled_elements_in_2013 &lt;- sample(N,n)
con2013 &lt;- rep(0,N)
con2013[sampled_elements_in_2013] &lt;- 1 # elements in the sample in 2013

# balanced panel sample - the same elements in all 6 periods:
con &lt;- rep(con2013,6)

YS &lt;- investments[con == 1]
fixed.part &lt;- 'newly_registered'
random.part &lt;- '(newly_registered  | NUTS4)' 
reg &lt;- invData[, -which(names(invData) == 'investments')]

gamma &lt;- rep(0,nrow(invData))
gamma[NUTS2 == '02' &amp; year == 2018] &lt;- 1

weights &lt;- rep(1,nrow(invData)) # homoscedastic random components
estMSE &lt;- TRUE 

# Predicted value of the total 
# in the following subpopulation: NUTS4type == 2 
# in the following time period: year == 2018
EBLUP(YS, fixed.part, random.part, reg, con, gamma, weights, estMSE)$thetaP

# All results
EBLUP(YS, fixed.part, random.part, reg, con, gamma, weights, estMSE)

detach(invData)

</code></pre>

<hr>
<h2 id='ebpLMMne'>
Empirical Best Predictor based on the nested error linear mixed model</h2><span id='topic+ebpLMMne'></span>

<h3>Description</h3>

<p>The function computes the value of the EBP under the nested error linear mixed model estimated using REML assumed for possibly transformed variable of interest. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ebpLMMne(YS, fixed.part, division, reg, con, backTrans, thetaFun, L)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ebpLMMne_+3A_ys">YS</code></td>
<td>
<p>values of the variable of interest (already transformed if necessary) observed in the sample and used in the model as the dependent variable.
</p>
</td></tr>
<tr><td><code id="ebpLMMne_+3A_fixed.part">fixed.part</code></td>
<td>
<p>fixed-effects terms declared as in <em>lmer</em> object.
</p>
</td></tr>
<tr><td><code id="ebpLMMne_+3A_division">division</code></td>
<td>
<p>the variable dividing the population dataset into subsets (the nested error linear mixed model with 'division'-specific random components is estimated).
</p>
</td></tr>
<tr><td><code id="ebpLMMne_+3A_reg">reg</code></td>
<td>
<p>the population matrix of auxiliary variables named in <em>fixed.part</em> and <em>division</em>.
</p>
</td></tr>
<tr><td><code id="ebpLMMne_+3A_con">con</code></td>
<td>
<p>the population 0-1 vector with 1s for elements in the sample and 0s for elements which are not in the sample.
</p>
</td></tr>
<tr><td><code id="ebpLMMne_+3A_backtrans">backTrans</code></td>
<td>
<p>back-transformation function of the variable of interest (e.g. if YS is log-tranformed, then backTrans &lt;- function(x) exp(x)).  
</p>
</td></tr>
<tr><td><code id="ebpLMMne_+3A_thetafun">thetaFun</code></td>
<td>
<p>the predictor function (e.g. mean or sd)
</p>
</td></tr>
<tr><td><code id="ebpLMMne_+3A_l">L</code></td>
<td>
<p>the number of iterations used to compute the value of the predictor.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function computes the value of the EBP based on the algorithm described in Molina and Rao (2010) in Section 4.
</p>


<h3>Value</h3>

<p>The function returns a list with the following objects:
</p>
<table>
<tr><td><code>thetaP</code></td>
<td>
<p>the value/s of the predictor (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>fixed.part</code></td>
<td>
<p>the fixed part of the formula of model.</p>
</td></tr>
<tr><td><code>random.part</code></td>
<td>
<p>the random part of the formula of model.</p>
</td></tr> 
<tr><td><code>division</code></td>
<td>
<p>the variable dividing the population dataset into subsets (the nested error linear mixed model with 'division'-specific random components is estimated).</p>
</td></tr>
<tr><td><code>thetaFun</code></td>
<td>
<p>the function of the population values of the variable of interest (on the original scale) which defines at least one population or subpopulation characteristic to be predicted.</p>
</td></tr>
<tr><td><code>backTrans</code></td>
<td>
<p>back-transformation function of the variable of interest (e.g. if YS is log-tranformed, then backTrans &lt;- function(x) exp(x).</p>
</td></tr>
<tr><td><code>L</code></td>
<td>
<p>the number of iterations used to compute the value of the predictor.</p>
</td></tr>
<tr><td><code>beta</code></td>
<td>
<p>the estimated vector of fixed effects.</p>
</td></tr>
<tr><td><code>Xbeta</code></td>
<td>
<p>the product of two matrices: the population model matrix of auxiliary variables X and the estimated vector of fixed effects.</p>
</td></tr>
<tr><td><code>sigma2R</code></td>
<td>
<p>the estimated variance parameter of the distribution of random components.</p>
</td></tr>
<tr><td><code>R</code></td>
<td>
<p>the estimated covariance matrix of random components for sampled elements.</p>
</td></tr>
<tr><td><code>G</code></td>
<td>
<p>the estimated covariance matrix of random effects.</p>
</td></tr>
<tr><td><code>model</code></td>
<td>
<p>the formula of the model (as in <em>lmer</em> object).</p>
</td></tr>
<tr><td><code>mEst</code></td>
<td>
<p><em>lmer</em> object with the estimated model.</p>
</td></tr>
<tr><td><code>YS</code></td>
<td>
<p>values of the variable of interest (already transformed if necessary) observed in the sample and used in the model as the dependent variable.</p>
</td></tr>
<tr><td><code>reg</code></td>
<td>
<p>the population matrix of auxiliary variables named in <em>fixed.part</em> and <em>random.part</em>.</p>
</td></tr>
<tr><td><code>con</code></td>
<td>
<p>the population 0-1 vector with 1s for elements in the sample and 0s for elements which are not in the sample.</p>
</td></tr>
<tr><td><code>regS</code></td>
<td>
<p>the sample matrix of auxiliary variables named in <em>fixed.part</em> and <em>random.part</em>.</p>
</td></tr>
<tr><td><code>regR</code></td>
<td>
<p>the matrix of auxiliary variables named in <em>fixed.part</em> and <em>random.part</em> for unsampled population elements.</p>
</td></tr>
<tr><td><code>weights</code></td>
<td>
<p>the population vector of weigts, defined as in <em>lmer</em> object, allowing to include the heteroscedasticity of random components in the mixed linear model.</p>
</td></tr>
<tr><td><code>Z</code></td>
<td>
<p>the population model matrix of auxiliary variables associated with random effects.</p>
</td></tr>
<tr><td><code>ZBlockNames</code></td>
<td>
<p>labels of blocks of random effects in Z matrix.</p>
</td></tr>
<tr><td><code>X</code></td>
<td>
<p>the population model matrix of auxiliary variables associated with fixed effects.</p>
</td></tr>
<tr><td><code>ZS</code></td>
<td>
<p>the submatrix of Z matrix where the number of rows equals the number of sampled elements and the number of columns equals the number of estimated random effects.</p>
</td></tr>
<tr><td><code>XR</code></td>
<td>
<p>the submatrix of X matrix (with the same number of columns) for unsampled population elements.</p>
</td></tr>
<tr><td><code>ZR</code></td>
<td>
<p>the submatrix of Z matrix where the number of rows equals the number of unsampled population elements and the number of columns equals the number of estimated random effects.</p>
</td></tr>
<tr><td><code>eS</code></td>
<td>
<p>the sample vector of estimated random components.</p>
</td></tr>
<tr><td><code>vS</code></td>
<td>
<p>the estimated vector of random effects.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alicja Wolny-Dominiak, Tomasz Zadlo</p>


<h3>References</h3>

<p>1. Chwila, A., Zadlo, T. (2022) On properties of empirical best predictors. Communications in Statistics - Simulation and Computation, 51(1), 220-253, https://doi.org/10.1080/03610918.2019.1649422 <br />
2. Molina, I., Rao, J.N.K. (2010) Small area estimation of poverty indicators. Canadian Journal of Statistics 38(3), 369-385. <br />  
3. Zadlo, T. (2017). On prediction of population and subpopulation characteristics for future periods, Communications in Statistics - Simulation and Computation 461(10), 8086-8104. <br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(lme4)
library(Matrix)


### Prediction of the subpopulation median 
### and the subpopulation standard deviation 
### based on the cross-sectional data

data(invData) 
# data from one period are considered: 
invData2018 &lt;- invData[invData$year == 2018,] 
attach(invData2018)

N &lt;- nrow(invData2018) # population size
n &lt;- 100 # sample size

set.seed(123456)
sampled_elements &lt;- sample(N,n)
con &lt;- rep(0,N)
con[sampled_elements] &lt;- 1 # elements in the sample
YS &lt;- log(investments[sampled_elements]) # log-transformed values
backTrans &lt;- function(x) exp(x) # back-transformation of the variable of interest
fixed.part &lt;- 'log(newly_registered)'
division &lt;- 'NUTS2' # NUTS2-specific random effects are taken into account
reg &lt;- invData2018[, -which(names(invData2018) == 'investments')]


# Characteristics to be predicted - the median and the standard deviation
# in the subpopulation of interest: NUTS4type==2
thetaFun &lt;- function(x) {c(median(x[NUTS4type == 2]), sd(x[NUTS4type == 2]))}

L &lt;- 5

# Predicted values of the median and the standard deviation
# in the following subpopulation: NUTS4type==2
set.seed(123456)
ebpLMMne(YS, fixed.part, division, reg, con, backTrans, thetaFun, L)$thetaP

set.seed(123456)
ebpLMMne(YS, fixed.part, division, reg, con, backTrans, thetaFun, L)

# All results
set.seed(123456)
str(ebpLMMne(YS, fixed.part, division, reg, con, backTrans, thetaFun, L))

detach(invData2018)

##########################################################

### Prediction of the subpopulation quartiles based on longitudinal data

data(invData)
attach(invData)

N &lt;- nrow(invData[(year == 2013),]) # population size in the first period
n &lt;- 38 # sample size in the first period

set.seed(123456)
sampled_elements_in_2013 &lt;- sample(N,n)
con2013 &lt;- rep(0,N)
con2013[sampled_elements_in_2013] &lt;- 1 # elements in the sample in 2013

# balanced panel sample - the same elements in all 6 periods:
con &lt;- rep(con2013,6)

YS &lt;- log(investments[con == 1]) # log-transformed values
backTrans &lt;- function(x) exp(x) # back-transformation of the variable of interest
fixed.part &lt;- 'log(newly_registered)'
division &lt;- 'NUTS4' # NUTS4-specific random effects are taken into account
reg &lt;- invData[, -which(names(invData) == 'investments')]
thetaFun &lt;- function(x) {quantile(x[NUTS2 == '02' &amp; year == 2018],probs = c(0.25,0.5,0.75))}

L &lt;- 5

# Predicted values of quartiles 
# in the following subpopulation: NUTS4type==2 
# in the following time period: year==2018
set.seed(123456)
ebpLMMne(YS, fixed.part, division, reg, con, backTrans, thetaFun, L)$thetaP

set.seed(123456)
ebpLMMne(YS, fixed.part, division, reg, con, backTrans, thetaFun, L)

# All results
str(ebpLMMne(YS, fixed.part, division, reg, con, backTrans, thetaFun, L))


detach(invData)
</code></pre>

<hr>
<h2 id='EmpCM'>Empirical covariance matrix of predicted random effects
</h2><span id='topic+EmpCM'></span>

<h3>Description</h3>

<p>A list of empirical covariance matrices of predicted random effects, where the length of the list equals the number of grouping variables used to define random effects as described in Carpenter, Goldstein and Rasbash (2003) in Section 3.2 and in Thai et al. (2013) in Section 2.3.3.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>EmpCM(model)
</code></pre>


<h3>Arguments</h3>

 <table>
<tr><td><code id="EmpCM_+3A_model">model</code></td>
<td>
 <p><em>lmer</em> object.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list of empirical covariance matrices of predicted random effects.</p>


<h3>Author(s)</h3>

<p>Tomasz Zadlo</p>


<h3>References</h3>

<p>1. Carpenter, J.R., Goldstein, H. and Rasbash, J. (2003), A novel bootstrap procedure for assessing the relationship between class size and achievement. Journal of the Royal Statistical Society: Series C (Applied Statistics), 52, 431-443. <br /> 
</p>
<p>2. Thai, H.-T., Mentre, F., Holford, N.H., Veyrat-Follet, C. and Comets, E. (2013), A comparison of bootstrap approaches for estimating uncertainty of parameters in linear mixed-effects models. Pharmaceutical Statistics, 12, 129-140. <br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(lme4)
data(invData)
attach(invData)
model &lt;- lmer(investments ~ newly_registered + ((1|NUTS2) + 
((newly_registered - 1)|NUTS2) + ((newly_registered)|NUTS4)))
EmpCM(model)
detach(invData)
</code></pre>

<hr>
<h2 id='EstCM'>Estimated covariance matrix of predicted random effects
</h2><span id='topic+EstCM'></span>

<h3>Description</h3>

<p>A list of estimated covariance matrices of predicted random effects, where the length of the list equals the number of grouping variables used to define random effects as described in Carpenter, Goldstein and Rasbash (2003) in Section 3.2 and in Thai et al. (2013) in Section 2.3.3.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>EstCM(model)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="EstCM_+3A_model">model</code></td>
<td>
 <p><em>lmer</em> object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list of estimated covariance matrices of predicted random effects.</p>


<h3>Author(s)</h3>

<p>Alicja Wolny-Dominiak, Tomasz Zadlo</p>


<h3>References</h3>

<p>1. Carpenter, J.R., Goldstein, H. and Rasbash, J. (2003), A novel bootstrap procedure for assessing the relationship between class size and achievement. Journal of the Royal Statistical Society: Series C (Applied Statistics), 52, 431-443. <br /> 
</p>
<p>2. Thai, H.-T., Mentre, F., Holford, N.H., Veyrat-Follet, C. and Comets, E. (2013), A comparison of bootstrap approaches for estimating uncertainty of parameters in linear mixed-effects models. Pharmaceutical Statistics, 12, 129-140. <br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(lme4)
data(invData)
attach(invData)
model &lt;- lmer(investments ~ newly_registered + ((1|NUTS2) + 
((newly_registered - 1)|NUTS2) + ((newly_registered)|NUTS4)))
EstCM(model)
detach(invData)
</code></pre>

<hr>
<h2 id='invData'>
Population data - investments in Poland at NUTS 4 level
</h2><span id='topic+invData'></span>

<h3>Description</h3>

<p>A data frame with 2280 observations on 6 variables presented below.</p>


<h3>Arguments</h3>

<table>
<tr><td><code id="invData_+3A_year">year</code></td>
<td>
<p>year.</p>
</td></tr> 
<tr><td><code id="invData_+3A_nuts4">NUTS4</code></td>
<td>
<p>NUTS 4 code (powiats).</p>
</td></tr>
<tr><td><code id="invData_+3A_nuts2">NUTS2</code></td>
<td>
<p>NUTS 2 code (voivodships).</p>
</td></tr>
<tr><td><code id="invData_+3A_nuts4type">NUTS4type</code></td>
<td>
<p>type of NUTS 4 (1 - land counties, 2 - city counties/cities with powiat status).</p>
</td></tr>
<tr><td><code id="invData_+3A_investments">investments</code></td>
<td>
<p>investment outlays in millions PLN, in current prices; data concern Polish economic entities, including independent health care facilities and cultural institutions with legal personalities in which the number of employed persons exceeds 9 (source of data: Annual survey of the economic activity of enterprises conducted by Statistics Poland).</p>
</td></tr>
<tr><td><code id="invData_+3A_newly_registered">newly_registered</code></td>
<td>
<p>newly registered entities of the national economy recorded in the REGON register (in thousands).</p>
</td></tr>
</table>


<h3>Source</h3>

<p>Statistics Poland, https://bdl.stat.gov.pl/eng
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(invData)
hist(invData$newly_registered[invData$year==2018])
boxplot(invData$investments~invData$year)
boxplot(invData$investments[invData$year==2018]~invData$NUTS2[invData$year==2018])
boxplot(invData$investments[invData$year==2018]~invData$NUTS4type[invData$year==2018])
</code></pre>

<hr>
<h2 id='mcBootMis'>Monte Carlo simulation study of accuracy of estimators of accuracy measures
</h2><span id='topic+mcBootMis'></span>

<h3>Description</h3>

<p>The function computes in the Monte Carlo simulation study values of accuracy measures of estimators of accuracy measures of two predictors under the model defined by the first of them.</p>


<h3>Usage</h3>

<pre><code class='language-R'>mcBootMis(Ypop, predictorLMM, predictorLMMmis, K, B1, B2, p, q)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mcBootMis_+3A_ypop">Ypop</code></td>
<td>
<p>population values of the variable of interest (already transformed if necessary) which are used as the dependent variable in the population model.
</p>
</td></tr>
<tr><td><code id="mcBootMis_+3A_predictorlmm">predictorLMM</code></td>
<td>
<p>plugInLMM object, the predictor used to define the model assumed in the simulation study.
</p>
</td></tr>
<tr><td><code id="mcBootMis_+3A_predictorlmmmis">predictorLMMmis</code></td>
<td>
<p>plugInLMM object, the second predictor, the properties of which are assessed under the misspecified model used in <em>predictorLMM</em>.
</p>
</td></tr>
<tr><td><code id="mcBootMis_+3A_k">K</code></td>
<td>
<p>the number of Monte Carlo iterations.
</p>
</td></tr>
<tr><td><code id="mcBootMis_+3A_b1">B1</code></td>
<td>
<p>the number of first-level bootstrap iterations.
</p>
</td></tr>
<tr><td><code id="mcBootMis_+3A_b2">B2</code></td>
<td>
<p>the number of second-level bootstrap iterations.
</p>
</td></tr>
<tr><td><code id="mcBootMis_+3A_p">p</code></td>
<td>
<p>orders of quantiles in the QAPE.
</p>
</td></tr>
<tr><td><code id="mcBootMis_+3A_q">q</code></td>
<td>
<p>estimator bounds assumed for <em>estMSE_db_1_EF</em> and <em>estMSE_db_telesc_EF</em> (which are corrected versions of <em>estMSE_db_1</em> and <em>estMSE_db_telesc</em>, respectively).
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In the model-based simulation study population values of the dependent variable are generated based on the (possibly transformed) Linear Mixed Model used in <em>predictorLMM</em> and the accuracy of predictors <em>predictorLMM</em> and <em>predictorLMMmis</em> is assessed. What is more, the the accuracy of parametric, residual and double bootstrap estimators of accuracy measures is studied under the model used in <em>predictorLMM</em>. Values of some MSE estimators can be negative, the number of negative values of MSE estimators obtained in the simulation study are presented in objects <em>neg_estMSE_LMM</em> and <em>neg_estMSE_LMMmis</em>. Hence, some RMSE estimators computed as square roots of MSE estimators can produce NaNs - see warnings.</p>


<h3>Value</h3>

<table>
<tr><td><code>QAPElmm</code></td>
<td>
<p>value/s of the QAPE of <em>predictorLMM</em> assessed in the Monte Carlo study - the number of rows is equal to the number of orders of quantiles to be considered (declared in <em>p</em>), the number of columns is equal to the number of predicted characteristics (declared in <em>thetaFun</em>).</p>
</td></tr>
<tr><td><code>RMSElmm</code></td>
<td>
<p>value/s of the RMSE of <em>predictorLMM</em> assessed in the Monte Carlo study (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rRMSElmm</code></td>
<td>
<p>value/s of the rRMSE (in percentages) of <em>predictorLMM</em> assessed in the Monte Carlo study (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rBlmm</code></td>
<td>
<p>value/s of the relative bias (in percentages) of <em>predictorLMM</em> assessed in the Monte Carlo study (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>QAPElmmMis</code></td>
<td>
<p>value/s of the QAPE of <em>predictorLMM2</em> assessed in the Monte Carlo study - the number of rows is equal to the number of orders of quantiles to be considered (declared in <em>p</em>), the number of columns is equal to the number of predicted characteristics (declared in <em>thetaFun</em>).</p>
</td></tr>
<tr><td><code>RMSElmmMis</code></td>
<td>
<p>value/s of the RMSE of <em>predictorLMM2</em> assessed in the Monte Carlo study (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rRMSElmmMis</code></td>
<td>
<p>value/s of the rRMSE (in percentages) of <em>predictorLMM2</em> assessed in the Monte Carlo study (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rBlmmMis</code></td>
<td>
<p>value/s of the relative bias (in percentages) of <em>predictorLMMmis</em> assessed in the Monte Carlo study (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rB.estRMSE_rbF_LMM</code></td>
<td>
<p>relative bias (in percentages) of estimated value/s of RMSE of <em>predictorLMM</em> without correction to avoid the problem of underdispersion of residual bootstrap distributions  (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rRMSE.estRMSE_rbF_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of estimated value/s of RMSE of <em>predictorLMM</em> without correction to avoid the problem of underdispersion of residual bootstrap distributions  (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rB.estRMSE_rbF_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of estimated value/s of RMSE of <em>predictorLMMmis</em> without correction to avoid the problem of underdispersion of residual bootstrap distributions  (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rRMSE.estRMSE_rbF_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of estimated value/s of RMSE of <em>predictorLMMmis</em> without correction to avoid the problem of underdispersion of residual bootstrap distributions  (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rB.estMSE_rbF_LMM</code></td>
<td>
<p>relative bias (in percentages) of estimated value/s of MSE of <em>predictorLMM</em> without correction to avoid the problem of underdispersion of residual bootstrap distributions  (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rRMSE.estMSE_rbF_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of estimated value/s of MSE of <em>predictorLMM</em> without correction to avoid the problem of underdispersion of residual bootstrap distributions  (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rB.estMSE_rbF_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of estimated value/s of MSE of <em>predictorLMMmis</em> without correction to avoid the problem of underdispersion of residual bootstrap distributions  (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rRMSE.estMSE_rbF_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of estimated value/s of MSE of <em>predictorLMMmis</em> without correction to avoid the problem of underdispersion of residual bootstrap distributions  (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rB.estQAPE_rbF_LMM</code></td>
<td>
<p>relative bias (in percentages) of estimated value/s of QAPE of <em>predictorLMM</em> without correction to avoid the problem of underdispersion of residual bootstrap distributions, the number of rows is equal to the number of orders of quantiles to be considered (declared in <em>p</em>), the number of columns is equal to the number of predicted characteristics (declared in <em>thetaFun</em>).</p>
</td></tr>
<tr><td><code>rRMSE.estQAPE_rbF_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of estimated value/s of QAPE of <em>predictorLMM</em> without correction to avoid the problem of underdispersion of residual bootstrap distributions, the number of rows is equal to the number of orders of quantiles to be considered (declared in <em>p</em>), the number of columns is equal to the number of predicted characteristics (declared in <em>thetaFun</em>).</p>
</td></tr>
<tr><td><code>rB.estQAPE_rbF_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of estimated value/s of QAPE of <em>predictorLMMmis</em> without correction to avoid the problem of underdispersion of residual bootstrap distributions, the number of rows is equal to the number of orders of quantiles to be considered (declared in <em>p</em>), the number of columns is equal to the number of predicted characteristics (declared in <em>thetaFun</em>).</p>
</td></tr>
<tr><td><code>rRMSE.estQAPE_rbF_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of estimated value/s of QAPE of <em>predictorLMMmis</em> without correction to avoid the problem of underdispersion of residual bootstrap distributions, the number of columns is equal to the number of predicted characteristics (declared in <em>thetaFun</em>) .</p>
</td></tr>
<tr><td><code>rB.estRMSE_rbT_LMM</code></td>
<td>
<p>relative bias (in percentages) of estimated value/s of RMSE of <em>predictorLMM</em> with correction to avoid the problem of underdispersion of residual bootstrap distributions  (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rRMSE.estRMSE_rbT_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of estimated value/s of RMSE of <em>predictorLMM</em> with correction to avoid the problem of underdispersion of residual bootstrap distributions  (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rB.estRMSE_rbT_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of estimated value/s of RMSE of <em>predictorLMMmis</em> with correction to avoid the problem of underdispersion of residual bootstrap distributions  (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rRMSE.estRMSE_rbT_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of estimated value/s of RMSE of <em>predictorLMMmis</em> with correction to avoid the problem of underdispersion of residual bootstrap distributions  (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rB.estMSE_rbT_LMM</code></td>
<td>
<p>relative bias (in percentages) of estimated value/s of MSE of <em>predictorLMM</em> with correction to avoid the problem of underdispersion of residual bootstrap distributions  (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rRMSE.estMSE_rbT_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of estimated value/s of MSE of <em>predictorLMM</em> with correction to avoid the problem of underdispersion of residual bootstrap distributions  (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rB.estMSE_rbT_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of estimated value/s of MSE of <em>predictorLMMmis</em> with correction to avoid the problem of underdispersion of residual bootstrap distributions  (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rRMSE.estMSE_rbT_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of estimated value/s of MSE of <em>predictorLMMmis</em> with correction to avoid the problem of underdispersion of residual bootstrap distributions  (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rB.estQAPE_rbT_LMM</code></td>
<td>
<p>relative bias (in percentages) of estimated value/s of QAPE of <em>predictorLMM</em> with correction to avoid the problem of underdispersion of residual bootstrap distributions  (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rRMSE.estQAPE_rbT_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of estimated value/s of QAPE of <em>predictorLMM</em> with correction to avoid the problem of underdispersion of residual bootstrap distributions  (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rB.estQAPE_rbT_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of estimated value/s of QAPE of <em>predictorLMMmis</em> with correction to avoid the problem of underdispersion of residual bootstrap distributions  (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rRMSE.estQAPE_rbT_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of estimated value/s of QAPE of <em>predictorLMMmis</em> with correction to avoid the problem of underdispersion of residual bootstrap distributions  (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>neg_estMSE_LMM</code></td>
<td>
<p>the number of negative values of MSE estimators of <em>predictorLMM</em> obtained in the simulaton study out of K iterations, the number of rows is equal to 10 - the number of considered parametric and double bootstrap MSE estimators, the number of columns is equal to the number of predicted characteristics (declared in <em>thetaFun</em>).</p>
</td></tr>
<tr><td><code>neg_estMSE_LMMmis</code></td>
<td>
<p>the number of negative values of MSE estimators of <em>predictorLMMmis</em> obtained in the simulaton study out of K iterations, the number of rows is equal to 10 - the number of considered parametric and double bootstrap MSE estimators, the number of columns is equal to the number of predicted characteristics (declared in <em>thetaFun</em>).</p>
</td></tr>
<tr><td><code>rB.estMSE_param_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of <em>estMSE_param</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estMSE_param_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estMSE_param</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rB.estMSE_db_B2_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of <em>estMSE_db_B2</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estMSE_db_B2_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estMSE_db_B2</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rB.estMSE_db_B2_WDZ_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of <em>estMSE_db_B2_WDZ</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estMSE_db_B2_WDZ_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estMSE_db_B2_WDZ</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rB.estMSE_db_B2_HM_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of <em>estMSE_db_B2_HM</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estMSE_db_B2_HM_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estMSE_db_B2_HM</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rB.estMSE_db_1_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of <em>estMSE_db_1</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estMSE_db_1_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estMSE_db_1</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rB.estMSE_db_1_WDZ_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of <em>estMSE_db_1_WDZ</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estMSE_db_1_WDZ_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estMSE_db_1_WDZ</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rB.estMSE_db_1_EF_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of <em>estMSE_db_1_EF</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estMSE_db_1_EF_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estMSE_db_1_EF</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rB.estMSE_db_telesc_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of <em>estMSE_db_telesc</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estMSE_db_telesc_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estMSE_db_telesc</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rB.estMSE_db_telesc_WDZ_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of <em>estMSE_db_telesc_WDZ</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estMSE_db_telesc_WDZ_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estMSE_db_telesc_WDZ</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rB.estMSE_db_telesc_EF_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of <em>estMSE_db_telesc_EF</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estMSE_db_telesc_EF_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estMSE_db_telesc_EF</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rB.estRMSE_param_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of <em>estRMSE_param</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estRMSE_param_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estRMSE_param</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rB.estRMSE_db_B2_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of <em>estRMSE_db_B2</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estRMSE_db_B2_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estRMSE_db_B2</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rB.estRMSE_db_B2_WDZ_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of <em>estRMSE_db_B2_WDZ</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estRMSE_db_B2_WDZ_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estRMSE_db_B2_WDZ</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rB.estRMSE_db_B2_HM_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of <em>estRMSE_db_B2_HM</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estRMSE_db_B2_HM_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estRMSE_db_B2_HM</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rB.estRMSE_db_1_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of <em>estRMSE_db_1</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estRMSE_db_1_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estRMSE_db_1</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rB.estRMSE_db_1_WDZ_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of <em>estRMSE_db_1_WDZ</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estRMSE_db_1_WDZ_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estRMSE_db_1_WDZ</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rB.estRMSE_db_1_EF_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of <em>estRMSE_db_1_EF</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estRMSE_db_1_EF_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estRMSE_db_1_EF</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rB.estRMSE_db_telesc_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of <em>estRMSE_db_telesc</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estRMSE_db_telesc_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estRMSE_db_telesc</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rB.estRMSE_db_telesc_WDZ_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of <em>estRMSE_db_telesc_WDZ</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estRMSE_db_telesc_WDZ_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estRMSE_db_telesc_WDZ</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rB.estRMSE_db_telesc_EF_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of <em>estRMSE_db_telesc_EF</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estRMSE_db_telesc_EF_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estRMSE_db_telesc_EF</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rB.estQAPE_param_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of <em>estQAPE_param</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estQAPE_param_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estQAPE_param</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>
<tr><td><code>rB.estQAPE_db_B2_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of <em>estQAPE_db_B2</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr> 
<tr><td><code>rRMSE.estQAPE_db_B2_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estQAPE_db_B2</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr> 
<tr><td><code>rB.estQAPE_db_1_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of <em>estQAPE_db_1</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>  
<tr><td><code>rRMSE.estQAPE_db_1_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estQAPE_db_1</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>  
<tr><td><code>rB.estQAPE_db_telesc_LMMmis</code></td>
<td>
<p>relative bias (in percentages) of <em>estQAPE_db_telesc</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>  
<tr><td><code>rRMSE.estQAPE_db_telesc_LMMmis</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estQAPE_db_telesc</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMMmis</em>.</p>
</td></tr>   
<tr><td><code>rB.estMSE_param_LMM</code></td>
<td>
<p>relative bias (in percentages) of <em>estMSE_param</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estMSE_param_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estMSE_param</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rB.estMSE_db_B2_LMM</code></td>
<td>
<p>relative bias (in percentages) of <em>estMSE_db_B2</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estMSE_db_B2_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estMSE_db_B2</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rB.estMSE_db_B2_WDZ_LMM</code></td>
<td>
<p>relative bias (in percentages) of <em>estMSE_db_B2_WDZ</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estMSE_db_B2_WDZ_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estMSE_db_B2_WDZ</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rB.estMSE_db_B2_HM_LMM</code></td>
<td>
<p>relative bias (in percentages) of <em>estMSE_db_B2_HM</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estMSE_db_B2_HM_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estMSE_db_B2_HM</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rB.estMSE_db_1_LMM</code></td>
<td>
<p>relative bias (in percentages) of <em>estMSE_db_1</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estMSE_db_1_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estMSE_db_1</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rB.estMSE_db_1_WDZ_LMM</code></td>
<td>
<p>relative bias (in percentages) of <em>estMSE_db_1_WDZ</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estMSE_db_1_WDZ_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estMSE_db_1_WDZ</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rB.estMSE_db_1_EF_LMM</code></td>
<td>
<p>relative bias (in percentages) of <em>estMSE_db_1_EF</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estMSE_db_1_EF_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estMSE_db_1_EF</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rB.estMSE_db_telesc_LMM</code></td>
<td>
<p>relative bias (in percentages) of <em>estMSE_db_telesc</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estMSE_db_telesc_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estMSE_db_telesc</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rB.estMSE_db_telesc_WDZ_LMM</code></td>
<td>
<p>relative bias (in percentages) of <em>estMSE_db_telesc_WDZ</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estMSE_db_telesc_WDZ_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estMSE_db_telesc_WDZ</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rB.estMSE_db_telesc_EF_LMM</code></td>
<td>
<p>relative bias (in percentages) of <em>estMSE_db_telesc_EF</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estMSE_db_telesc_EF_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estMSE_db_telesc_EF</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rB.estRMSE_param_LMM</code></td>
<td>
<p>relative bias (in percentages) of <em>estRMSE_param</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estRMSE_param_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estRMSE_param</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rB.estRMSE_db_B2_LMM</code></td>
<td>
<p>relative bias (in percentages) of <em>estRMSE_db_B2</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estRMSE_db_B2_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estRMSE_db_B2</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rB.estRMSE_db_B2_WDZ_LMM</code></td>
<td>
<p>relative bias (in percentages) of <em>estRMSE_db_B2_WDZ</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estRMSE_db_B2_WDZ_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estRMSE_db_B2_WDZ</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rB.estRMSE_db_B2_HM_LMM</code></td>
<td>
<p>relative bias (in percentages) of <em>estRMSE_db_B2_HM</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estRMSE_db_B2_HM_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estRMSE_db_B2_HM</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rB.estRMSE_db_1_LMM</code></td>
<td>
<p>relative bias (in percentages) of <em>estRMSE_db_1</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estRMSE_db_1_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estRMSE_db_1</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rB.estRMSE_db_1_WDZ_LMM</code></td>
<td>
<p>relative bias (in percentages) of <em>estRMSE_db_1_WDZ</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estRMSE_db_1_WDZ_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estRMSE_db_1_WDZ</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rB.estRMSE_db_1_EF_LMM</code></td>
<td>
<p>relative bias (in percentages) of <em>estRMSE_db_1_EF</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estRMSE_db_1_EF_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estRMSE_db_1_EF</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rB.estRMSE_db_telesc_LMM</code></td>
<td>
<p>relative bias (in percentages) of <em>estRMSE_db_telesc</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estRMSE_db_telesc_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estRMSE_db_telesc</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rB.estRMSE_db_telesc_WDZ_LMM</code></td>
<td>
<p>relative bias (in percentages) of <em>estRMSE_db_telesc_WDZ</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estRMSE_db_telesc_WDZ_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estRMSE_db_telesc_WDZ</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rB.estRMSE_db_telesc_EF_LMM</code></td>
<td>
<p>relative bias (in percentages) of <em>estRMSE_db_telesc_EF</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estRMSE_db_telesc_EF_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estRMSE_db_telesc_EF</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rB.estQAPE_param_LMM</code></td>
<td>
<p>relative bias (in percentages) of <em>estQAPE_param</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rRMSE.estQAPE_param_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estQAPE_param</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>
<tr><td><code>rB.estQAPE_db_B2_LMM</code></td>
<td>
<p>relative bias (in percentages) of <em>estQAPE_db_B2</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr> 
<tr><td><code>rRMSE.estQAPE_db_B2_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estQAPE_db_B2</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr> 
<tr><td><code>rB.estQAPE_db_1_LMM</code></td>
<td>
<p>relative bias (in percentages) of <em>estQAPE_db_1</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>  
<tr><td><code>rRMSE.estQAPE_db_1_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estQAPE_db_1</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>  
<tr><td><code>rB.estQAPE_db_telesc_LMM</code></td>
<td>
<p>relative bias (in percentages) of <em>estQAPE_db_telesc</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>  
<tr><td><code>rRMSE.estQAPE_db_telesc_LMM</code></td>
<td>
<p>relative RMSE (in percentages) of <em>estQAPE_db_telesc</em> estimator (see <em>doubleBoot</em> function) of <em>predictorLMM</em>.</p>
</td></tr>  
<tr><td><code>MCpositiveDefiniteEstGlev1</code></td>
<td>
<p>number of cases ouf of K with postive definite estimated covariance matrix of random effects used to generate bootstrap realizations of the dependent variable at the first level of the double bootstrap.</p>
</td></tr> 
<tr><td><code>MCpositiveDefiniteEstGlev2</code></td>
<td>
<p>number of cases ouf of K*B1 with positive definite estimated covariance matrix of random effects used to generate bootstrap realizations of the dependent variable at the second level of the double bootstrap.</p>
</td></tr> 
</table>


<h3>Author(s)</h3>

<p>Tomasz Zadlo</p>


<h3>References</h3>

<p>1. Chatterjee, S., Lahiri, P. Li, H. (2008) Parametric bootstrap approximation to the distribution of EBLUP and related prediction intervals in linear mixed models, Annals of Statistics, Vol. 36 (3), pp. 1221?1245.<br />
</p>
<p>2. Rao, J.N.K. and Molina, I. (2015) Small Area Estimation. Second edition, John Wiley &amp; Sons, New Jersey.<br />
</p>
<p>3. Zadlo T. (2017), On asymmetry of prediction errors in small area estimation, Statistics in Transition, 18 (3), 413-432. <br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(lme4)
library(Matrix)
library(mvtnorm)
library(matrixcalc) 
library(qape)

data(invData) 
# data from one period are considered: 
invData2018 &lt;- invData[invData$year == 2018,] 
attach(invData2018)

N &lt;- nrow(invData2018) # population size

con &lt;- rep(1,N) 
con[c(379,380)] &lt;- 0 # last two population elements are not observed 

YS &lt;- log(investments[con == 1]) # log-transformed values
backTrans &lt;- function(x) exp(x) # back-transformation of the variable of interest
fixed.part &lt;- 'log(newly_registered)'
random.part &lt;- '(1|NUTS2)'
random.part.mis &lt;- '(1|NUTS4type)'

reg &lt;- invData2018[, -which(names(invData2018) == 'investments')]
weights &lt;- rep(1,N) # homoscedastic random components

# Characteristics to be predicted:
# values of the variable for last two population elements  
thetaFun &lt;- function(x) {x[c(379,380)]}

predictorLMM &lt;- plugInLMM(YS, fixed.part, random.part, reg, con, weights, backTrans, thetaFun)
predictorLMMmis &lt;- plugInLMM(YS, fixed.part, random.part.mis, reg, con,weights,backTrans,thetaFun)

Ypop &lt;- log(invData2018$investments)

# Monte Carlo simulation study under the model defined in predictorLMM
# correctly specified for predictorLMM and misspecified for predictorLMMmis
set.seed(211)
mcBootMis(Ypop, predictorLMM, predictorLMMmis, 2, 2, 2, c(0.5, 0.9), 0.77) 

detach(invData2018)

</code></pre>

<hr>
<h2 id='mcLMMmis'>Monte Carlo simuation study of accuracy of predictors under the misspecified model
</h2><span id='topic+mcLMMmis'></span>

<h3>Description</h3>

<p>The function computes in the Monte Carlo simulation study values of accuracy measures of three predictors under the model assumed for one of them with possible modifications of covariance matrices of random effects and random components.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mcLMMmis(Ypop, predictorLMMmis, predictorLMM, predictorLMM2, K, p, ratioR, ratioG)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mcLMMmis_+3A_ypop">Ypop</code></td>
<td>
<p>population values of the variable of interest (already transformed if necessary) which are used as the dependent variable in the population model.
</p>
</td></tr>
<tr><td><code id="mcLMMmis_+3A_predictorlmmmis">predictorLMMmis</code></td>
<td>
<p>plugInLMM object, the predictor used to define the model assumed in the simulation study.
</p>
</td></tr>
<tr><td><code id="mcLMMmis_+3A_predictorlmm">predictorLMM</code></td>
<td>
<p>plugInLMM object, the first predictor, the accuracy of which is assessed in the simulation study.
</p>
</td></tr>
<tr><td><code id="mcLMMmis_+3A_predictorlmm2">predictorLMM2</code></td>
<td>
<p>plugInLMM object, the second predictor, the accuracy of which is assessed in the simulation study.
</p>
</td></tr>
<tr><td><code id="mcLMMmis_+3A_k">K</code></td>
<td>
<p>the number of Monte Carlo iterations.
</p>
</td></tr>
<tr><td><code id="mcLMMmis_+3A_p">p</code></td>
<td>
<p>orders of quantiles in the QAPE.
</p>
</td></tr>
<tr><td><code id="mcLMMmis_+3A_ratior">ratioR</code></td>
<td>
<p>the value by which the diagonal elements of the covariance matrix of random components of the model based on the whole population data and formulation used in <em>predictorLMMmis</em> are divided. Then, the corrected covariance matrix is used to generate bootstrap realizations of random components.
</p>
</td></tr>
<tr><td><code id="mcLMMmis_+3A_ratiog">ratioG</code></td>
<td>
<p>the value by which the diagonal elements of the covariance matrix of random effects of the model based on the whole population data and formulation used in <em>predictorLMMmis</em> are divided. Then, the corrected covariance matrix, assuming that it is positive definite, is used to generate bootstrap realizations of random effects. If it is not positive definite, the alert is printed and the dependent variable is generated based on the model without random effects.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In the model-based simulation study population values of the dependent variable are generated based on the (possibly transformed) Linear Mixed Model used in <em>predictorLMMmis</em> with possibly modified covariance matrices of random effects and random components by the usage of <em>ratioR</em> and <em>ratioG</em> arguments. In the simulation study accuracy of predictors <em>predictorLMM</em> and <em>predictorLMM2</em> is assessed. Although, all the predictors are <em>plugInLMM</em> objects, it should be noted that under the non-transformed Linear Mixed Model and in the case of the prediction of the linear combination of the dependent variable (e.g. the mean, the total, and one realization of the variable), the predictors are Empirical Best Linear Unbiased Predictors. What is more, if <em>predictorLMMmis</em> is defined as <em>predictorLMM</em>, the Monte Carlo simulation study of accuracy of <em>predictorLMM</em> under correctly specified model and of <em>predictorLMM2</em> under misspecified model is conducted.      
</p>


<h3>Value</h3>

<table>
<tr><td><code>errorLMM</code></td>
<td>
<p>Monte Carlo prediction errors of <em>predictorLMM</em> - number of rows is equal to the number of predicted characteristics (declared in <em>thetaFun</em>), number of columns is equal to <em>K</em>.</p>
</td></tr> 
<tr><td><code>errorLMM2</code></td>
<td>
<p>Monte Carlo prediction errors of <em>predictorLMM2</em> - number of rows is equal to the number of predicted characteristics (declared in <em>thetaFun</em>), number of columns is equal to <em>K</em>.</p>
</td></tr> 
<tr><td><code>QAPElmm</code></td>
<td>
<p>value/s of the QAPE of <em>predictorLMM</em> assessed in the Monte Carlo study - number of rows is equal the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal the number of predicted characteristics (declared in <em>thetaFun</em>).</p>
</td></tr>
<tr><td><code>RMSElmm</code></td>
<td>
<p>value/s of the RMSE of <em>predictorLMM</em> assessed in the Monte Carlo study (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rRMSElmm</code></td>
<td>
<p>value/s of the rRMSE (in percentages) of <em>predictorLMM</em> assessed in the Monte Carlo study (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rBlmm</code></td>
<td>
<p>value/s of the relative bias (in percentages) of <em>predictorLMM</em> assessed in the Monte Carlo study (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>QAPElmm2</code></td>
<td>
<p>value/s of the QAPE of <em>predictorLMM2</em> assessed in the Monte Carlo study - number of rows is equal the number of orders of quantiles to be considered (declared in <em>p</em>), number of columns is equal the number of predicted characteristics (declared in <em>thetaFun</em>).</p>
</td></tr>
<tr><td><code>RMSElmm2</code></td>
<td>
<p>value/s of the RMSE of <em>predictorLMM2</em> assessed in the Monte Carlo study (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rRMSElmm2</code></td>
<td>
<p>value/s of the rRMSE (in percentages) of <em>predictorLMM2</em> assessed in the Monte Carlo study (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>rBlmm2</code></td>
<td>
<p>value/s of the relative bias (in percentages) of <em>predictorLMM2</em> assessed in the Monte Carlo study (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>positiveDefiniteEstG</code></td>
<td>
<p>logical indicating if the estimated covariance matrix of random effects, used to generate Monte Carlo realizations of the dependent variable, is positive definite.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Tomasz Zadlo</p>


<h3>References</h3>

<p>1. Chatterjee, S., Lahiri, P. Li, H. (2008) Parametric bootstrap approximation to the distribution of EBLUP and related prediction intervals in linear mixed models, Annals of Statistics, Vol. 36 (3), 1221-1245.<br />
</p>
<p>2. Rao, J.N.K. and Molina, I. (2015) Small Area Estimation. Second edition, John Wiley &amp; Sons, New Jersey.<br />
</p>
<p>3. Zadlo T. (2017), On asymmetry of prediction errors in small area estimation, Statistics in Transition, 18 (3), 413-432. <br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(invData) 
# data from one period are considered: 
invData2018 &lt;- invData[invData$year == 2018,] 

invData2018$investments &lt;- invData2018$investments/1000
attach(invData2018)
N &lt;- nrow(invData2018) # population size

con &lt;- rep(0,N) 
set.seed(123456)
con[sample(N,50)] &lt;- 1 # sample size equals 50

YS &lt;- log((investments[con == 1])) # log-transformed values
backTrans &lt;- function(x) {exp(x)} # back-transformation of the variable of interest
fixed.part &lt;- 'log(newly_registered)'
random.part &lt;- '(1|NUTS2)'
random.part2 &lt;- '(1|NUTS4type)'

reg &lt;- invData2018[, -which(names(invData2018) == 'investments')]
weights &lt;- rep(1,N) # homoscedastic random components
weights.mis &lt;- sqrt(newly_registered)

# Characteristics to be predicted:
# the population mean and the population total  
thetaFun &lt;- function(x) {c(mean(x), median(x))}

predictorLMMmis &lt;- plugInLMM(YS, fixed.part, random.part, reg,con,weights.mis,backTrans,thetaFun)
predictorLMMmis$thetaP

predictorLMM &lt;- plugInLMM(YS, fixed.part, random.part, reg, con, weights, backTrans, thetaFun)
predictorLMM$thetaP

predictorLMM2 &lt;- plugInLMM(YS, fixed.part, random.part2, reg, con, weights, backTrans, thetaFun)
predictorLMM2$thetaP

Ypop &lt;- log(invData2018$investments)

# Monte Carlo simulation study under the misspecified model defined in predictorLMMmis 
# with modified covariance matrices R and G
set.seed(123456)
mcLMMmis(Ypop, predictorLMMmis, predictorLMM, predictorLMM2, 5, c(0.75,0.9), 2, 0.1)

# Monte Carlo simulation study under the model defined in predictorLMM
# correctly specified for predictorLMM and misspecified for predictorLMM2
set.seed(123456)
mcLMMmis(Ypop, predictorLMM, predictorLMM, predictorLMM2, 5, c(0.75,0.9), 1, 1)

detach(invData2018)
</code></pre>

<hr>
<h2 id='modifyDataset'>Modification of the values of the variables in the dataset</h2><span id='topic+modifyDataset'></span>

<h3>Description</h3>

<p>The function modifies the values of the declared variables used 
in the random part of the model if they are not unique. 
Unique values of the variables are required to 
build correct Z matrix for unsampled population elements.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>modifyDataset(data, names)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="modifyDataset_+3A_data">data</code></td>
<td>
<p>the population dataset.
</p>
</td></tr>
<tr><td><code id="modifyDataset_+3A_names">names</code></td>
<td>
<p>the vector of names of the dataset columns which values should 
be modified (names of the variables used to define the random part 
of the model).
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The dataset with modified values of the declared variables.
</p>


<h3>Author(s)</h3>

<p>Tomasz Zadlo</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(realestData)
# some values of "NUTS2" and "NUTS4type" are the same - we will modify them:
modifyDataset(realestData, c("NUTS2", "NUTS4type")) 
</code></pre>

<hr>
<h2 id='normCholTest'>Test of normality of the dependent variable</h2><span id='topic+normCholTest'></span>

<h3>Description</h3>

<p>The function conducts a test of normality of the depenedent 
variable based on residuals transformed using Cholesky decomposition of
the inverse of the estimated variance-covariance matrix of the variable.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>normCholTest(model, normTest)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="normCholTest_+3A_model">model</code></td>
<td>
<p>lmer object.
</p>
</td></tr>
<tr><td><code id="normCholTest_+3A_normtest">normTest</code></td>
<td>
<p>function which implements a normality test e.g. shapiro.test
(takes a vector of the values of the variable as an argument and 
conducts a test of normality of the variable).
</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>testResults</code></td>
<td>
<p>output of the normTest function chosen by the user.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Tomasz Zadlo</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(lme4)
mod &lt;- lmer(Reaction ~ Days + (Days | Subject), sleepstudy)
normCholTest(mod, shapiro.test)
</code></pre>

<hr>
<h2 id='plugInLMM'>
PLUG-IN predictor based on the linear mixed model
</h2><span id='topic+plugInLMM'></span>

<h3>Description</h3>

<p>The function computes the value of the plug-in predictor under the linear mixed model estimated using REML assumed for possibly transformed variable of interest. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plugInLMM(YS, fixed.part, random.part, reg, con, weights, backTrans, thetaFun)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plugInLMM_+3A_ys">YS</code></td>
<td>
<p>values of the variable of interest (already transformed if necessary) observed in the sample and used in the model as the dependent variable.</p>
</td></tr>
<tr><td><code id="plugInLMM_+3A_fixed.part">fixed.part</code></td>
<td>
<p>fixed-effects terms declared as in <em>lmer</em> object.
</p>
</td></tr>
<tr><td><code id="plugInLMM_+3A_random.part">random.part</code></td>
<td>
<p>random-effects terms declared as in <em>lmer</em> object.
</p>
</td></tr>
<tr><td><code id="plugInLMM_+3A_reg">reg</code></td>
<td>
<p>the population matrix of auxiliary variables named in <em>fixed.part</em> and <em>random.part</em>.
</p>
</td></tr>
<tr><td><code id="plugInLMM_+3A_con">con</code></td>
<td>
<p>the population 0-1 vector with 1s for elements in the sample and 0s for elements which are not in the sample.
</p>
</td></tr>
<tr><td><code id="plugInLMM_+3A_weights">weights</code></td>
<td>
<p>the population vector of weights, defined as in <em>lmer</em> object, allowing to include the heteroscedasticity of random components in the mixed linear model.
</p>
</td></tr>
<tr><td><code id="plugInLMM_+3A_backtrans">backTrans</code></td>
<td>
<p>back-transformation function of the variable of interest (e.g. if YS is log-tranformed, then backTrans &lt;- function(x) exp(x)). 
</p>
</td></tr>
<tr><td><code id="plugInLMM_+3A_thetafun">thetaFun</code></td>
<td>
<p>the predictor function (e.g. mean or sd).
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function computes the value of the plug-in estimator in two steps as presented by Chwila and Zadlo (2019) p. 20. Firstly, we build the population vector consisting of real values of the variable of interest for sampled elements and (possibly back-transformed) fitted values of the variable of interest based on the estimated model. Secondly, the value/s of <em>thetaFun</em> based on the population vector built in the first step is/are computed. Predicted values for unsampled population elements in subsets for which random effects are not observed in the sample are computed based only on fixed effects.
</p>


<h3>Value</h3>

<p>The function returns a list with the following objects:
</p>
<table>
<tr><td><code>thetaP</code></td>
<td>
<p>the value/s of the predictor (more than one value is computed if in <em>thetaFun</em> more than one population characteristic is defined).</p>
</td></tr>
<tr><td><code>fixed.part</code></td>
<td>
<p>the fixed part of the formula of model.</p>
</td></tr>
<tr><td><code>random.part</code></td>
<td>
<p>the random part of the formula of model.</p>
</td></tr> 
<tr><td><code>thetaFun</code></td>
<td>
<p>the function of the population values of the variable of interest (on the original scale) which defines at least one population or subpopulation characteristic to be predicted.</p>
</td></tr>
<tr><td><code>backTrans</code></td>
<td>
<p>back-transformation function of the variable of interest (e.g. if YS used in the model is log-tranformed, then backTrans &lt;- function(x) exp(x)).</p>
</td></tr>
<tr><td><code>YP</code></td>
<td>
<p>predicted values of the variable of interest for unsampled elements (without back-tranformation).</p>
</td></tr>
<tr><td><code>YbackTrans</code></td>
<td>
<p>population vector of the values of the variable of interest on the orignal scale for sampled elements and back-transformed predicted values of the variable of interest for unsampled elements.</p>
</td></tr>
<tr><td><code>YPbackTrans</code></td>
<td>
<p>back-transformed predicted values of the variable of interest for unsampled elements.</p>
</td></tr>
<tr><td><code>beta</code></td>
<td>
<p>the estimated vector of fixed effects.</p>
</td></tr>
<tr><td><code>Xbeta</code></td>
<td>
<p>the product of two matrices: the population model matrix of auxiliary variables X and the estimated vector of fixed effects.</p>
</td></tr>
<tr><td><code>sigma2R</code></td>
<td>
<p>the estimated variance parameter of the distribution of random components.</p>
</td></tr>
<tr><td><code>R</code></td>
<td>
<p>the estimated covariance matrix of random components for sampled elements.</p>
</td></tr>
<tr><td><code>G</code></td>
<td>
<p>the estimated covariance matrix of random effects.</p>
</td></tr>
<tr><td><code>model</code></td>
<td>
<p>the formula of the model (as in <em>lmer</em> object).</p>
</td></tr>
<tr><td><code>mEst</code></td>
<td>
<p><em>lmer</em> object with the estimated model.</p>
</td></tr>
<tr><td><code>YS</code></td>
<td>
<p>values of the variable of interest (already transformed if necessary) observed in the sample and used in the model as the dependent variable.</p>
</td></tr>
<tr><td><code>reg</code></td>
<td>
<p>the population matrix of auxiliary variables named in <em>fixed.part</em> and <em>random.part</em>.</p>
</td></tr>
<tr><td><code>con</code></td>
<td>
<p>the population 0-1 vector with 1s for elements in the sample and 0s for elements which are not in the sample.</p>
</td></tr>
<tr><td><code>regS</code></td>
<td>
<p>the sample matrix of auxiliary variables named in <em>fixed.part</em> and <em>random.part</em>.</p>
</td></tr>
<tr><td><code>regR</code></td>
<td>
<p>the matrix of auxiliary variables named in <em>fixed.part</em> and <em>random.part</em> for unsampled population elements.</p>
</td></tr>
<tr><td><code>weights</code></td>
<td>
<p>the population vector of weigts, defined as in <em>lmer</em> object, allowing to include the heteroscedasticity of random components in the mixed linear model.</p>
</td></tr>
<tr><td><code>Z</code></td>
<td>
<p>the population model matrix of auxiliary variables associated with random effects.</p>
</td></tr>     <tr><td><code>ZBlockNames</code></td>
<td>
<p>labels of blocks of random effects in Z matrix.</p>
</td></tr>
<tr><td><code>ZS</code></td>
<td>
<p>the submatrix of Z matrix where the number of rows equals the number of sampled elements and the number of columns equals the number of estimated random effects.</p>
</td></tr>
<tr><td><code>XR</code></td>
<td>
<p>the submatrix of X matrix (with the same number of columns) for unsampled population elements.</p>
</td></tr>
<tr><td><code>ZR</code></td>
<td>
<p>the submatrix of Z matrix where the number of rows equals the number of unsampled population elements and the number of columns equals the number of estimated random effects.</p>
</td></tr>
<tr><td><code>eS</code></td>
<td>
<p>the sample vector of estimated random components.</p>
</td></tr>
<tr><td><code>vS</code></td>
<td>
<p>the estimated vector of random effects.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alicja Wolny-Dominiak, Tomasz Zadlo</p>


<h3>References</h3>

<p>Chwila, A., Zadlo, T. (2022) On properties of empirical best predictors. Communications in Statistics - Simulation and Computation, 51(1), 220-253, https://doi.org/10.1080/03610918.2019.1649422
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(lme4)
library(Matrix)


### Prediction of the subpopulation median 
### and the subpopulation standard deviation 
### based on the cross-sectional data

data(invData) 
# data from one period are considered: 
invData2018 &lt;- invData[invData$year == 2018,] 
attach(invData2018)

N &lt;- nrow(invData2018) # population size
n &lt;- 100 # sample size

set.seed(123456)
sampled_elements &lt;- sample(N,n)
con &lt;- rep(0,N)
con[sampled_elements] &lt;- 1 # elements in the sample
YS &lt;- log(investments[sampled_elements]) # log-transformed values
backTrans &lt;- function(x) exp(x) # back-transformation of the variable of interest
fixed.part &lt;- 'log(newly_registered)'
random.part &lt;- '(log(newly_registered)  | NUTS2)' 
reg &lt;- invData2018[, -which(names(invData2018) == 'investments')]
weights &lt;- rep(1,N) # homoscedastic random components

# Characteristics to be predicted - the median and the standard deviation
# in following subpopulation: NUTS4type == 2
thetaFun &lt;- function(x) {c(median(x[NUTS4type == 2]),sd(x[NUTS4type == 2]))}

# Predicted values of the median and the standard deviation
# in the following subpopulation: NUTS4type == 2

plugInLMM(YS, fixed.part, random.part, reg, con, weights, backTrans, thetaFun)$thetaP
plugInLMM(YS, fixed.part, random.part, reg, con, weights, backTrans, thetaFun)

# All results
str(plugInLMM(YS, fixed.part, random.part, reg, con, weights, backTrans, thetaFun))

detach(invData2018)

##########################################################

### Prediction of the subpopulation quartiles based on longitudinal data

data(invData)
attach(invData)

N &lt;- nrow(invData[(year == 2013),]) # population size in the first period
n &lt;- 38 # sample size in the first period
# subpopulation and time period of interest: NUTS2 == '02' &amp; year == 2018
Ndt=sum(NUTS2=='02' &amp; year==2018) # subpopulation size in the period of interest

set.seed(123456)
sampled_elements_in_2013 &lt;- sample(N,n)
con2013 &lt;- rep(0,N)
con2013[sampled_elements_in_2013] &lt;- 1 # elements in the sample in 2013

# balanced panel sample - the same elements in all 6 periods:
con &lt;- rep(con2013,6)

YS &lt;- log(investments[con == 1]) # log-transformed values
backTrans &lt;- function(x) exp(x) # back-transformation of the variable of interest
fixed.part &lt;- 'log(newly_registered)'
random.part &lt;- '(0 + log(newly_registered) | NUTS4)' 
reg &lt;- invData[, -which(names(invData) == 'investments')]
weights &lt;- rep(1,nrow(invData)) # homoscedastic random components

# Characteristics to be predicted - quartiles in 2018 
# in the following subpopulation: NUTS4type == 2
thetaFun &lt;- function(x) {quantile(x[NUTS2 == '02' &amp; year == 2018],probs = c(0.25,0.5,0.75))}

# Predicted values of quartiles 
# in the following subpopulation: NUTS4type == 2 
# in the following time period: year == 2018
plugInLMM(YS, fixed.part, random.part, reg, con, weights, backTrans, thetaFun)$thetaP
plugInLMM(YS, fixed.part, random.part, reg, con, weights, backTrans, thetaFun)

# All results
str(plugInLMM(YS, fixed.part, random.part, reg, con, weights, backTrans, thetaFun))

detach(invData)

</code></pre>

<hr>
<h2 id='print.EBLUP'>
print the value of EBLUP predictor</h2><span id='topic+print.EBLUP'></span>

<h3>Description</h3>

<p>Print the value of EBLUP predictor.</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'EBLUP'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.EBLUP_+3A_x">x</code></td>
<td>
<p>the object of class 'EBLUP'.</p>
</td></tr>
<tr><td><code id="print.EBLUP_+3A_...">...</code></td>
<td>
<p>not used.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alicja Wolny-Dominiak</p>

<hr>
<h2 id='print.ebpLMMne'>
print the value of ebpLMMne predictor</h2><span id='topic+print.ebpLMMne'></span>

<h3>Description</h3>

<p>Print the value of ebpLMMne predictor.</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ebpLMMne'
print(x, ...)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.ebpLMMne_+3A_x">x</code></td>
<td>
<p>the object of class 'ebpLMMne'.</p>
</td></tr>
<tr><td><code id="print.ebpLMMne_+3A_...">...</code></td>
<td>
<p>not used.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alicja Wolny-Dominiak</p>

<hr>
<h2 id='print.plugInLMM'>
print the value of plugInLMM predictor</h2><span id='topic+print.plugInLMM'></span>

<h3>Description</h3>

<p>Print the value of plugInLMM predictor.</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'plugInLMM'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.plugInLMM_+3A_x">x</code></td>
<td>
<p>the object of class 'plugInLMM'.</p>
</td></tr>
<tr><td><code id="print.plugInLMM_+3A_...">...</code></td>
<td>
<p>not used.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alicja Wolny-Dominiak</p>

<hr>
<h2 id='quantileNaN'>quantile NaN</h2><span id='topic+quantileNaN'></span>

<h3>Description</h3>

<p>The function returns NaN when one of its arguments is NaN (instead of the error returned in this case by the classic quantile function)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>quantileNaN(x, probs)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="quantileNaN_+3A_x">x</code></td>
<td>
<p>numeric vector whose sample quantiles are wanted.</p>
</td></tr>
<tr><td><code id="quantileNaN_+3A_probs">probs</code></td>
<td>
<p>numeric vector of probabilities with values in [0,1].</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Tomasz Zadlo</p>

<hr>
<h2 id='realestData'>
Population data - real estate in Poland at NUTS 4 level
</h2><span id='topic+realestData'></span>

<h3>Description</h3>

<p>A data frame with 1504 observations on the following 7 variables (NUTS 4 units with masked values of the variables due to Statistical confidentiality has been removed).</p>


<h3>Arguments</h3>

<table>
<tr><td><code id="realestData_+3A_year">year</code></td>
<td>
<p>year.</p>
</td></tr> 
<tr><td><code id="realestData_+3A_nuts4">NUTS4</code></td>
<td>
<p>NUTS 4 code (powiats).</p>
</td></tr>
<tr><td><code id="realestData_+3A_nuts2">NUTS2</code></td>
<td>
<p>NUTS 2 code (voivodships).</p>
</td></tr>
<tr><td><code id="realestData_+3A_nuts4type">NUTS4type</code></td>
<td>
<p>type of NUTS 4 (1 - land counties, 2 - city counties/cities with powiat status).</p>
</td></tr>
<tr><td><code id="realestData_+3A_premises">premises</code></td>
<td>
<p>number of residential premises sold in market transactions (in thousands).</p>
</td></tr>
<tr><td><code id="realestData_+3A_area">area</code></td>
<td>
<p>usable floor area of residential premises sold in market transactions (in millions of square meters).</p>
</td></tr>
<tr><td><code id="realestData_+3A_price">price</code></td>
<td>
<p>sum of prices of residential premises sold (in billions of Polish zloty).</p>
</td></tr>
</table>


<h3>Source</h3>

<p>Statitics Poland, https://bdl.stat.gov.pl/eng
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(realestData)
hist(realestData$price[realestData$year==2018])
boxplot(realestData$price~realestData$year)
boxplot(realestData$price[realestData$year==2018]~realestData$NUTS2[realestData$year==2018])
boxplot(realestData$price[realestData$year==2018]~realestData$NUTS4type[realestData$year==2018])


library(lme4)
attach(realestData)

N &lt;- nrow(realestData[(year == 2015),]) # population size in the first period
n &lt;- 75 # sample size in the first period
set.seed(123456)
sampled_elements_in_2015 &lt;- sample(N,n) 
con2015 &lt;- rep(0,N)
con2015[sampled_elements_in_2015] &lt;- 1

sampled_elements_in_2016 &lt;- sample(N,n)
con2016 &lt;- rep(0,N)
con2016[sampled_elements_in_2016] &lt;- 1

sampled_elements_in_2017 &lt;- sample(N,n)
con2017 &lt;- rep(0,N)
con2017[sampled_elements_in_2017] &lt;- 1

sampled_elements_in_2018 &lt;- sample(N,n)
con2018 &lt;- rep(0,N)
con2018[sampled_elements_in_2018] &lt;- 1

con=as.logical(con2015, con2016, con2017, con2018)

model1 &lt;- lmer(price ~ premises + area + (1|NUTS2)+(0+premises|NUTS2) + 
(1|NUTS4type)+(0+area|NUTS4type), subset=con)
AIC(model1)
model2 &lt;- lmer(price ~ premises + area + (0+premises|NUTS2) + (0+area|NUTS4type), subset = con)
AIC(model2)

</code></pre>

<hr>
<h2 id='srswrRe'>Bootstrap sample of predicted random effects</h2><span id='topic+srswrRe'></span>

<h3>Description</h3>

<p>The function draws at random a simple random sample with replacement from predicted random effects, where the sample size is equal the number of random effects in the whole population.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>srswrRe(listRanef, reg)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="srswrRe_+3A_listranef">listRanef</code></td>
<td>
<p><em>ranef(model)</em> object where <em>model</em> is an  <em>lmer</em> object.</p>
</td></tr>
<tr><td><code id="srswrRe_+3A_reg">reg</code></td>
<td>
<p>the population matrix of auxiliary variables named in <em>fixed.part</em> and <em>random.part</em>.</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>tablsrswrRe</code></td>
<td>
<p>a vector of a simple random sample with replacement from predicted random effects, where the sample size is equal the number of random effects in the whole population.</p>
</td></tr>
<tr><td><code>lsrswrRe</code></td>
<td>
<p> a list of length equal the number of grouping variables taken into account in the random part of the model. Each list consists of 4 sublists: $raneftotal - a vector of a simple random sample with replacement from all predicted random effects under the cosidered grouping variable, $ranefname - a name of the grouping variable, $k - the number of random effects under the considered grouping variable, $df - a data frame of predicted random effects under the considered grouping variable, $dfsamp - a data frame of a simple random sample with replacement from predicted random effects under the considered grouping variable.</p>
</td></tr>  
</table>


<h3>Author(s)</h3>

<p>Alicja Wolny-Dominiak, Tomasz Zadlo</p>


<h3>References</h3>

<p>1. Carpenter, J.R., Goldstein, H. and Rasbash, J. (2003), A novel bootstrap procedure for assessing the relationship between class size and achievement. Journal of the Royal Statistical Society: Series C (Applied Statistics), 52, 431-443. <br /> 
</p>
<p>2. Chambers, R. and Chandra, H. (2013) A Random Effect Block Bootstrap for Clustered Data, Journal of Computational and Graphical Statistics, 22(2), 452-470. <br />
</p>
<p>3. Thai, H.-T., Mentre, F., Holford, N.H., Veyrat-Follet, C. and Comets, E. (2013), A comparison of bootstrap approaches for estimating uncertainty of parameters in linear mixed-effects models. Pharmaceutical Statistics, 12, 129-140. <br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(lme4)
data(invData)
# data from one period are considered: 
invData2018 &lt;- invData[invData$year == 2018,] 
attach(invData2018)
N &lt;- nrow(invData2018) # population size
n &lt;- 100 # sample size

set.seed(12345)
sampled_elements &lt;- sample(N,n)
reg &lt;- invData2018[, -which(names(invData2018) == 'investments')]

detach(invData2018)

invData2018sample &lt;- invData2018[sampled_elements,]
attach(invData2018sample)
model &lt;- lmer(investments ~ newly_registered + (1|NUTS2) + (1|NUTS4type))
srswrRe(ranef(model),reg)$tablsrswrRe
srswrRe(ranef(model),reg)$lsrswrRe

detach(invData2018sample)
</code></pre>

<hr>
<h2 id='summary.EBLUP'>
Summary of EBLUP prediction</h2><span id='topic+summary.EBLUP'></span>

<h3>Description</h3>

<p>Print the summary of EBLUP prediction and LMM model.</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'EBLUP'
summary(object, ...)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.EBLUP_+3A_object">object</code></td>
<td>
<p>the object of class 'EBLUP'.</p>
</td></tr>
<tr><td><code id="summary.EBLUP_+3A_...">...</code></td>
<td>
<p>not used.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alicja Wolny-Dominiak</p>

<hr>
<h2 id='summary.ebpLMMne'>
Summary of ebpLMMne prediction</h2><span id='topic+summary.ebpLMMne'></span>

<h3>Description</h3>

<p>Print the summary of ebpLMMne prediction and LMM.</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ebpLMMne'
summary(object, ...)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.ebpLMMne_+3A_object">object</code></td>
<td>
<p>the object of class 'ebpLMMne'.</p>
</td></tr>
<tr><td><code id="summary.ebpLMMne_+3A_...">...</code></td>
<td>
<p>not used.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alicja Wolny-Dominiak</p>

<hr>
<h2 id='summary.plugInLMM'>
Summary of plugInLMM prediction
</h2><span id='topic+summary.plugInLMM'></span>

<h3>Description</h3>

<p>Print the summary of ebpLMMne prediction and LMM model.</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'plugInLMM'
summary(object, ...)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.plugInLMM_+3A_object">object</code></td>
<td>
<p>the object of class 'plugInLMM'.</p>
</td></tr>
<tr><td><code id="summary.plugInLMM_+3A_...">...</code></td>
<td>
<p>not used.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alicja Wolny-Dominiak</p>

<hr>
<h2 id='Zfun'>Matrix Z creator</h2><span id='topic+Zfun'></span>

<h3>Description</h3>

<p>The function creates the Z matrix of auxiliary variables 
asscociatied with random effects. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Zfun(model, data)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Zfun_+3A_model">model</code></td>
<td>
<p>formula of model (use <em>formula()</em> function).
</p>
</td></tr>
<tr><td><code id="Zfun_+3A_data">data</code></td>
<td>
<p>data.
</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>Z</code></td>
<td>
<p>Z matrix.</p>
</td></tr>
<tr><td><code>vNames</code></td>
<td>
<p>labels of random effects.</p>
</td></tr>
<tr><td><code>ZBlockNames</code></td>
<td>
<p>labels of blocks of random effects.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Alicja Wolny-Dominiak</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(invData)
modelFormula &lt;- formula(investments~newly_registered + (newly_registered | NUTS2))
reg &lt;- invData

Zfun(modelFormula, reg)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
