<!DOCTYPE html><html lang="en"><head><title>Help for package SSNbler</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {SSNbler}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#SSNbler-package'><p>SSNbler: Assemble 'SSN' Objects</p></a></li>
<li><a href='#accum_edges'><p>Accumulate edge values downstream</p></a></li>
<li><a href='#afv_edges'><p>Calculate the additive function value for edges in a LSN</p></a></li>
<li><a href='#afv_sites'><p>Calculate additive function values for sites in a Landscape Network (LSN)</p></a></li>
<li><a href='#copy_streams_to_temp'><p>Copy streams data to temporary directory</p></a></li>
<li><a href='#lines_to_lsn'><p>Convert lines to a landscape network (LSN)</p></a></li>
<li><a href='#lines_to_lsn_temp'><p>Convert lines to a landscape network</p></a></li>
<li><a href='#MF_CapeHorn'><p>MF_CapeHorn: Prediction locations on Cape Horn Creek, in the Middle Fork Basin, Idaho.</p></a></li>
<li><a href='#MF_obs'><p>MF_obs: Water temperature observations in the Middle Fork Basin, Idaho in 2004.</p></a></li>
<li><a href='#MF_pred1km'><p>MF_pred1km: Prediction locations at 1km intervals throughout the Middle Fork Basin, Idaho.</p></a></li>
<li><a href='#MF_preds'><p>MF_preds: A small set of prediction locations found in the Middle Fork Basin, Idaho.</p></a></li>
<li><a href='#MF_streams'><p>MF_streams: Middle Fork streams</p></a></li>
<li><a href='#sites_to_lsn'><p>Incorporate sites into a Landscape Network</p></a></li>
<li><a href='#ssn_assemble'><p>Assemble an <code>SSN</code> object from an LSN</p></a></li>
<li><a href='#ssn_check'><p>Check an <code>SSN</code> object</p></a></li>
<li><a href='#updist_edges'><p>Get upstream distance for edges in a Landscape Network (LSN)</p></a></li>
<li><a href='#updist_sites'><p>Get upstream distance for sites in a Landscape Network (LSN)</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Assemble 'SSN' Objects</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.1</td>
</tr>
<tr>
<td>Description:</td>
<td>Import, create and assemble data needed to fit spatial-statistical stream-network models using the 'SSN2' package for 'R'. Streams, observations, and prediction locations are represented as simple features and specific tools provided to define topological relationships between features; calculate the hydrologic distances (with flow-direction preserved) and the spatial additive function used to weight converging stream segments; and export the topological, spatial, and attribute information to an &lsquo;SSN' (spatial stream network) object, which can be efficiently stored, accessed and analysed in &rsquo;R'. A detailed description of methods used to calculate and format the spatial data can be found in Peterson, E.E. and Ver Hoef, J.M., (2014) &lt;<a href="https://doi.org/10.18637%2Fjss.v056.i02">doi:10.18637/jss.v056.i02</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>sf, dplyr, pdist, stats, utils, igraph, RSQLite, withr, SSN2</td>
</tr>
<tr>
<td>Suggests:</td>
<td>ggplot2, knitr, rmarkdown, testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/pet221/SSNbler">https://github.com/pet221/SSNbler</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/pet221/SSNbler/issues">https://github.com/pet221/SSNbler/issues</a></td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-09-25 05:58:30 UTC; erin</td>
</tr>
<tr>
<td>Author:</td>
<td>Erin Peterson <a href="https://orcid.org/0000-0003-2992-0372"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Michael Dumelle <a href="https://orcid.org/0000-0002-3393-5529"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Alan Pearse <a href="https://orcid.org/0000-0002-4133-8548"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Dan Teleki [ctb],
  Jay M. Ver Hoef <a href="https://orcid.org/0000-0003-4302-6895"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Erin Peterson &lt;erin@peterson-consulting.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-09-25 10:20:12 UTC</td>
</tr>
</table>
<hr>
<h2 id='SSNbler-package'>SSNbler: Assemble 'SSN' Objects</h2><span id='topic+SSNbler'></span><span id='topic+SSNbler-package'></span>

<h3>Description</h3>

<p>Import, create and assemble data needed to fit spatial-statistical stream-network models using the 'SSN2' package for 'R'. Streams, observations, and prediction locations are represented as simple features and specific tools provided to define topological relationships between features; calculate the hydrologic distances (with flow-direction preserved) and the spatial additive function used to weight converging stream segments; and export the topological, spatial, and attribute information to an &lsquo;SSN' (spatial stream network) object, which can be efficiently stored, accessed and analysed in &rsquo;R'. A detailed description of methods used to calculate and format the spatial data can be found in Peterson, E.E. and Ver Hoef, J.M., (2014) <a href="https://doi.org/10.18637/jss.v056.i02">doi:10.18637/jss.v056.i02</a>.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Erin Peterson <a href="mailto:erin@peterson-consulting.com">erin@peterson-consulting.com</a> (<a href="https://orcid.org/0000-0003-2992-0372">ORCID</a>)
</p>
<p>Authors:
</p>

<ul>
<li><p> Michael Dumelle <a href="mailto:Dumelle.Michael@epa.gov">Dumelle.Michael@epa.gov</a> (<a href="https://orcid.org/0000-0002-3393-5529">ORCID</a>)
</p>
</li>
<li><p> Alan Pearse (<a href="https://orcid.org/0000-0002-4133-8548">ORCID</a>)
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> Dan Teleki [contributor]
</p>
</li>
<li><p> Jay M. Ver Hoef <a href="mailto:jay.verhoef@noaa.gov">jay.verhoef@noaa.gov</a> (<a href="https://orcid.org/0000-0003-4302-6895">ORCID</a>) [contributor]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/pet221/SSNbler">https://github.com/pet221/SSNbler</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/pet221/SSNbler/issues">https://github.com/pet221/SSNbler/issues</a>
</p>
</li></ul>


<hr>
<h2 id='accum_edges'>Accumulate edge values downstream</h2><span id='topic+accum_edges'></span>

<h3>Description</h3>

<p>Accumulate (sum) edge values downstream in a
Landscape Network (LSN)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>accum_edges(
  edges,
  lsn_path,
  sum_col,
  acc_col,
  save_local = TRUE,
  overwrite = FALSE,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="accum_edges_+3A_edges">edges</code></td>
<td>
<p>An <code>sf</code> object with LINESTING geometry created
using <code><a href="#topic+lines_to_lsn">lines_to_lsn</a></code>.</p>
</td></tr>
<tr><td><code id="accum_edges_+3A_lsn_path">lsn_path</code></td>
<td>
<p>Local pathname to a directory in character format
specifying where relationships.csv resides, which is created
using <code>link{lines_to_lsn}</code>.</p>
</td></tr>
<tr><td><code id="accum_edges_+3A_sum_col">sum_col</code></td>
<td>
<p>Name of an existing column in <code>edges</code>
(character format) that contains the value to sum downstream.</p>
</td></tr>
<tr><td><code id="accum_edges_+3A_acc_col">acc_col</code></td>
<td>
<p>Name of the new column in <code>edges</code> (character
format) where the accumulated <code>sum_col</code> values will be
stored (see details).</p>
</td></tr>
<tr><td><code id="accum_edges_+3A_save_local">save_local</code></td>
<td>
<p>Logical indicating whether the updated
<code>edges</code> should be saved to <code>lsn_path</code> in GeoPackage
format. Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="accum_edges_+3A_overwrite">overwrite</code></td>
<td>
<p>A logical indicating whether results should be
overwritten if <code>acc_col</code> already exists in <code>edges</code>
or edges.gpkg already exists in <code>lsn_path</code> and
<code>save_local = TRUE</code>.</p>
</td></tr>
<tr><td><code id="accum_edges_+3A_verbose">verbose</code></td>
<td>
<p>Logical. Indicates whether messages about the
function progress should be printed to the console. Defaults to
<code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>accum_edges</code> sums (i.e. accumulates) numeric
values in <code>edges</code> downstream, from headwater or source
features to each network outlet feature (i.e. most downstream
line feature in each sub-network). Missing values are not allowed in
<code>sum_col</code> and should be replaced with 0, or any other
meaningful numeric value, prior to running
<code>accum_edges</code>. The <code>acc_col</code> returned contains the
sum of <code>sum_col</code> found in upstream edges, in addition the
the <code>sum_col</code> for the edge itself. As such, <code>acc_col</code>
represents the cumulative upstream sum of <code>sum_col</code> for the
downstream node of each line feature in <code>edges</code>.
</p>


<h3>Value</h3>

<p>An <code>sf</code> object representing edges in the LSN, with a
new <code>acc_col</code> column. If <code>save_local = TRUE</code>,
<code>edges</code> is saved to <code>lsn_path</code> in GeoPackage (.gpkg)
format.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Get temporary directory, where the example LSN will be stored
# locally.
temp_dir &lt;- tempdir()

# Build the LSN. When working with your own data, lsn_path will be
# a local folder of your choice rather than a temporary directory.
edges &lt;- lines_to_lsn(
  streams = MF_streams,
  lsn_path = temp_dir,
  snap_tolerance = 1,
  check_topology = FALSE,
  overwrite = TRUE,
  verbose = FALSE
)

# Accumulate RCA area (rcaAreaKm2) downstream and store in a new
# column named WArea_km2
edges &lt;- accum_edges(
  edges = edges,
  lsn_path = temp_dir,
  sum_col = "rcaAreaKm2",
  acc_col = "WArea_km2",
  save_local = FALSE,
  overwrite = TRUE,
  verbose = FALSE
)

summary(edges$WArea_km2)
</code></pre>

<hr>
<h2 id='afv_edges'>Calculate the additive function value for edges in a LSN</h2><span id='topic+afv_edges'></span>

<h3>Description</h3>

<p>Calculate the additive function value for each edge
feature in a Landscape Network (LSN)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>afv_edges(
  edges,
  lsn_path,
  infl_col,
  segpi_col,
  afv_col,
  save_local = TRUE,
  overwrite = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="afv_edges_+3A_edges">edges</code></td>
<td>
<p>An <code>sf</code> object with LINESTING geometry created
using <code><a href="#topic+lines_to_lsn">lines_to_lsn</a></code>.</p>
</td></tr>
<tr><td><code id="afv_edges_+3A_lsn_path">lsn_path</code></td>
<td>
<p>Local pathname to a directory in character format
specifying where relationships.csv resides, which is created
using <code><a href="#topic+lines_to_lsn">lines_to_lsn</a></code>.</p>
</td></tr>
<tr><td><code id="afv_edges_+3A_infl_col">infl_col</code></td>
<td>
<p>Name of the existing column in the edges data.frame
that will be used to generate the segment proportional influence
(segment PI) for each line feature, in character format.</p>
</td></tr>
<tr><td><code id="afv_edges_+3A_segpi_col">segpi_col</code></td>
<td>
<p>Name of the new column created in <code>edges</code>
that will store the new segment proportional influence values for
each feature, in character format.</p>
</td></tr>
<tr><td><code id="afv_edges_+3A_afv_col">afv_col</code></td>
<td>
<p>Name of the new column created in <code>edges</code> to
store the additive function value for each feature, in character
format.</p>
</td></tr>
<tr><td><code id="afv_edges_+3A_save_local">save_local</code></td>
<td>
<p>Logical indicating whether the updated
<code>edges</code> should be saved to <code>lsn_path</code> in GeoPackage
format. Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="afv_edges_+3A_overwrite">overwrite</code></td>
<td>
<p>A logical indicating whether results should be
overwritten if <code>segpi_col</code> and/or <code>afv_col</code> already
exists in <code>edges</code>, or edges.gpkg already exists in
<code>lsn_path</code> and <code>save_local = TRUE</code>. Default = TRUE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Spatial weights are used when fitting statistical models
with 'SSN2' to split the tail-up covariance function upstream of
network confluences, which allows for the disproportionate
influence of one upstream edge over another (e.g., a large stream
channel converges with a smaller one) on downstream
values. Calculating the spatial weights is a four-step process:
</p>

<ol>
<li><p> calculating the segment proportional influence (PI) values for
the edges,
</p>
</li>
<li><p> calculating the additive function values (AFVs) for
the edges,
</p>
</li>
<li><p> calculating the AFVs for the
observed and prediction sites, and
</p>
</li>
<li><p> calculating the spatial
weights for observed and prediction sites.
</p>
</li></ol>

<p>Steps 1) and 2) are undertaken in <code>afv_edges</code>, Step 3) is
calculated in <code><a href="#topic+afv_sites">afv_sites()</a></code>, and Step 4) is calculated in the
package 'SSN2' when spatial stream-network models that include the
tail-up covariance function are fit using <code><a href="SSN2.html#topic+ssn_lm">ssn_lm</a></code>
or <code><a href="SSN2.html#topic+ssn_glm">ssn_glm</a></code>.
</p>
<p>The segment PI for each edge, <code class="reqn">\omega_j</code>, is defined as the
relative influence of the j-th edge feature on the edge directly
downstream.  <code class="reqn">\omega_j</code> is often based on
cumulative watershed area for the downstream node of each edge,
which is used as a surrogate for flow volume. However,
simpler measures could be used, such as Shreve's stream order
(Shreve 1966) or equal weighting, as long as a value exists for
every line feature in <code>edges</code> (i.e., missing data are not
allowed). It is also preferable to use a column that does not
contain values equal to zero, which is explained below.
</p>
<p>The segment PI values produced in <code>afv_edges()</code> are
ratios. Therefore, the sum of the PI values for edges directly
upstream of a single node always sum to one. Also note that
<code class="reqn">\omega_j=0</code> when <code class="reqn">A_j=0</code>.
</p>
<p>The AFVs for the j-th edge, <code class="reqn">AFV_j</code>, is equal to the product of
the segment PIs found in the path between the edge and the network
outlet (i.e., most downstream edge in the network), including edge
j itself. Therefore, <code class="reqn">0 \le AFV \le 1</code>. If <code class="reqn">\omega_j=0</code>,
the AFV values for edges upstream of the j-th edge will also be
equal to zero. This may not be problematic if the j-th edge is a
headwater segment without an observed site. However, it can have a
significant impact on the covariance structure of the tail-up model
when the j-th edge is found lower in the stream network.
</p>
<p>A more detailed description of the segment PIs and the steps used to
calculate AFVs are provided in Peterson and Ver Hoef (2010;
Appendix A).
</p>


<h3>Value</h3>

<p>An <code>sf</code> object representing edges in the LSN, with new
<code>segpi_col</code> and <code>afv_col</code> columns. If <code>save_local
  = TRUE</code>, the updated version of <code>edges</code> will be saved as
<code>edges.gpkg</code> in <code>lsn_path</code>.
</p>


<h3>References</h3>

<p>Peterson, E.E. and Ver Hoef, J.M. (2010) A
mixed-model moving-average approach to geostatistical modeling in
stream networks. Ecology 91(3), 644–651.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Get temporary directory, where the example LSN will be stored
# locally.
temp_dir &lt;- tempdir()

# Build the LSN. When working with your own data, lsn_path will be
# a local folder of your choice rather than a temporary directory.
edges &lt;- lines_to_lsn(
  streams = MF_streams,
  lsn_path = temp_dir,
  snap_tolerance = 1,
  check_topology = FALSE,
  overwrite = TRUE,
  verbose = FALSE
)

# Calculate the AFV for the edges using an existing column
# representing watershed area for the downstream node of each line
# feature (h2oAreaKm2).
edges &lt;- afv_edges(
  edges = edges,
  infl_col = "h2oAreaKm2",
  segpi_col = "areaPI",
  lsn_path = temp_dir,
  afv_col = "afvArea",
  overwrite = TRUE,
  save_local = FALSE
)

# Check AFVs stored in new column afvArea to ensure that 0 &lt;= AFV
# &lt;= 1 and that there are no NULL values.
summary(edges$afvArea)

</code></pre>

<hr>
<h2 id='afv_sites'>Calculate additive function values for sites in a Landscape Network (LSN)</h2><span id='topic+afv_sites'></span>

<h3>Description</h3>

<p>Calculate additive function values for sites in a Landscape Network (LSN)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>afv_sites(
  sites,
  edges,
  afv_col,
  save_local = TRUE,
  lsn_path = NULL,
  overwrite = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="afv_sites_+3A_sites">sites</code></td>
<td>
<p>A named list of one or more <code>sf</code> objects with
POINT geometry that have been snapped to the LSN using
<code><a href="#topic+sites_to_lsn">sites_to_lsn</a></code>.</p>
</td></tr>
<tr><td><code id="afv_sites_+3A_edges">edges</code></td>
<td>
<p><code>sf</code> object with LINESTING geometry created
using <code><a href="#topic+lines_to_lsn">lines_to_lsn</a></code>.</p>
</td></tr>
<tr><td><code id="afv_sites_+3A_afv_col">afv_col</code></td>
<td>
<p>Name of the column in <code>edges</code> containing
the additive function value for each feature, in character
format. Created using <code><a href="#topic+afv_edges">afv_edges</a></code>.</p>
</td></tr>
<tr><td><code id="afv_sites_+3A_save_local">save_local</code></td>
<td>
<p>Logical indicating whether the updated
<code>sites</code> should be saved to <code>lsn_path</code> in GeoPackage
format. File basenames are taken from the names assigned to the
<code>sites</code> list. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="afv_sites_+3A_lsn_path">lsn_path</code></td>
<td>
<p>Optional. Local pathname to a directory in
character format specifying where the LSN resides, which is
created using <code>link[SSNbler]{lines_to_lsn}</code>. Must be
specified if <code>save_local = TRUE</code>.</p>
</td></tr>
<tr><td><code id="afv_sites_+3A_overwrite">overwrite</code></td>
<td>
<p>A logical indicating whether results should be
overwritten if <code>afv_col</code> already exists in <code>sites</code>
or sites.gpkg already exists in <code>lsn_path</code> and
<code>save_local = TRUE</code>. Default = TRUE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Spatial weights are used when fitting statistical models
with 'SSN2' to split the tail up covariance function upstream of
network confluences, which allows for the disproportionate
influence of one upstream edge over another (e.g., a large stream
channel converges with a smaller one) on downstream
values. Calculating the spatial weights is a four step process:
</p>

<ol>
<li><p> calculating the segment proportional influence (PI) values for
the edges,
</p>
</li>
<li><p> calculating the additive function values (AFVs) for
the edges,
</p>
</li>
<li><p> calculating the AFVs for the
observed and prediction sites, and
</p>
</li>
<li><p> calculating the spatial
weights for observed and prediction sites.
</p>
</li></ol>

<p>Steps 1) and 2) are undertaken in <code><a href="#topic+afv_edges">afv_edges()</a></code>, Step 3) is
calculated in <code>afv_sites()</code>, and Step 4) is calculated in the
package 'SSN2' when spatial stream network models that include the
tail up covariance function are fit using <code><a href="SSN2.html#topic+ssn_lm">ssn_lm</a></code>
or <code><a href="SSN2.html#topic+ssn_glm">ssn_glm</a></code>.
</p>
<p>The additive function value (AFV) for an observed or
prediction site is equal to the AFV of the edge the site resides
on. Therefore, <code class="reqn">0 \le AFV \le 1</code>. See Peterson and Ver Hoef
(2010) for a more detailed description of AFVs, how they are
calculated, and how they are used in the tail up covariance function.
</p>


<h3>Value</h3>

<p>One or more <code>sf</code> object(s) with all the original data
from <code>sites</code>, along with a new <code>afv_col</code> column in each
<code>sites sf</code> object. A named list is returned. If
<code>save_local = TRUE</code>, a GeoPackage for each <code>sf</code> object
is saved in <code>lsn_path</code>. Output file names are assigned based
on the input <code>sites</code> attribute <code>names</code>.
</p>


<h3>References</h3>

<p>Peterson, E.E. and Ver Hoef, J.M. (2010) A
mixed model moving average approach to geostatistical modeling in
stream networks. Ecology 91(3), 644–651.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#' # Get temporary directory, where the example LSN will be stored
# locally.
temp_dir &lt;- tempdir()
# Build the LSN. When working with your own data, lsn_path will be
# a local folder of your choice rather than a temporary directory.
edges&lt;- lines_to_lsn(
   streams = MF_streams,
   lsn_path = temp_dir,
   snap_tolerance = 1,
   check_topology = FALSE,
   overwrite = TRUE,
   verbose = FALSE
)

# Incorporate observed sites into the LSN
obs&lt;- sites_to_lsn(
   sites = MF_obs,
   edges = edges,
   save_local = FALSE,
   snap_tolerance = 100,
   overwrite = TRUE,
   verbose = FALSE
)

# Incorporate the prediction dataset, preds, into the LSN
preds&lt;- sites_to_lsn(sites = MF_preds,
   edges = edges,
   save_local = FALSE,
   snap_tolerance = 1,
   overwrite = TRUE,
   verbose = FALSE
)

# Calculate the AFVs for the edges using a column representing
# watershed area (h2oAreaKm2) for the downstream node of each edge
# feature.
edges&lt;- afv_edges(
   edges=edges,
   infl_col = "h2oAreaKm2",
   segpi_col = "areaPI",
   lsn_path = temp_dir,
   afv_col = "afvArea",
   overwrite = TRUE,
   save_local = FALSE
)

# Calculate AFVs for observed sites (obs) and the prediction
# dataset, preds.
site.list&lt;- afv_sites(
   sites = list(obs = obs,
                preds = preds),
   edges=edges,
   afv_col = "afvArea",
   save_local = FALSE,
   overwrite = TRUE
)

# Get names of sites in site.list
names(site.list)

# Check AFVs stored in new column afvArea to ensure that 0 &lt;= AFV
# &lt;= 1 and that there are no NULL values.
summary(site.list$obs$afvArea)
summary(site.list$preds$afvArea)
</code></pre>

<hr>
<h2 id='copy_streams_to_temp'>Copy streams data to temporary directory</h2><span id='topic+copy_streams_to_temp'></span>

<h3>Description</h3>

<p>Copies the streams data directory to R's temporary
directory so the examples in SSNbler do not write to the local
library or any other places.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>copy_streams_to_temp()
</code></pre>


<h3>Details</h3>

<p>Copies the Middle Fork data to R's temporary directory
</p>


<h3>Value</h3>

<p>A copy of the Middle Fork streams data residing in R's temporary directory
</p>


<h3>Examples</h3>

<pre><code class='language-R'>copy_streams_to_temp()
# getwd()
# setwd(tempdir())
# getwd()
# if unix-alike, list temporary directory contents using: system('ls')
# if windows, list temporary directory contents using: shell('dir')
</code></pre>

<hr>
<h2 id='lines_to_lsn'>Convert lines to a landscape network (LSN)</h2><span id='topic+lines_to_lsn'></span>

<h3>Description</h3>

<p>Convert an <code>sf</code> object containing features with
LINESTRING geometry to a landscape network (LSN), which is a
topological data model of streams/rivers represented as a
directional graph embedded in 2-D geographic space. Relationship
tables are created and topological relationships are checked.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lines_to_lsn(
  streams,
  lsn_path,
  check_topology = TRUE,
  snap_tolerance = 0,
  topo_tolerance = 0,
  remove_ZM = FALSE,
  overwrite = FALSE,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="lines_to_lsn_+3A_streams">streams</code></td>
<td>
<p>An <code>sf</code> object with LINESTING geometry
representing streams.</p>
</td></tr>
<tr><td><code id="lines_to_lsn_+3A_lsn_path">lsn_path</code></td>
<td>
<p>Pathname to a directory in character format specifying
where to store the outputs. The directory will be created if it
does not already exist.</p>
</td></tr>
<tr><td><code id="lines_to_lsn_+3A_check_topology">check_topology</code></td>
<td>
<p>Logical. If <code>TRUE</code>, the edges will be
checked for topological errors and potential node errors will be
flagged in an output file called
<code>node_errors.gpkg</code>. Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="lines_to_lsn_+3A_snap_tolerance">snap_tolerance</code></td>
<td>
<p>Distance in map units &gt;= 0. Two nodes separated by
a distance less than or equal to <code>snap_tolerance</code> are
assumed to be connected. Defaults to 0.</p>
</td></tr>
<tr><td><code id="lines_to_lsn_+3A_topo_tolerance">topo_tolerance</code></td>
<td>
<p>Distance in map units &gt;= 0. Only used if
<code>check_topology = TRUE</code>. Two nodes on the network separated
by a distance less than or equal to <code>topo_tolerance</code> are
flagged as potential topological errors in the network. Defaults
to 0.</p>
</td></tr>
<tr><td><code id="lines_to_lsn_+3A_remove_zm">remove_ZM</code></td>
<td>
<p>Logical. If <code>TRUE</code>, Z and M dimensions are
removed from streams, if they exist. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="lines_to_lsn_+3A_overwrite">overwrite</code></td>
<td>
<p>Logical. If <code>TRUE</code>, output files will
overwrite existing files with the same names. If <code>FALSE</code> and
files sharing the same names as the outputs exist in the
<code>lsn_path</code>, the function will exit early with an error.</p>
</td></tr>
<tr><td><code id="lines_to_lsn_+3A_verbose">verbose</code></td>
<td>
<p>Logical. If <code>TRUE</code>, messages describing
function progress will be printed to the console. Default is
<code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>lines_to_lsn</code> converts an <code>sf</code> object
representing streams to a landscape network
(LSN), which is a directional graph used to represent
the topological and geographic relationships between line
features, along with additional attribute information.
<code>streams</code> must have LINESTRING geometry and a projected coordinate system, rather
than geographic coordinate system (i.e. not Longitude and Latitude).
</p>
<p>The LSN is saved to a local directory defined by <code>lsn_path</code> and has 5 components:
</p>

<ul>
<li><p> nodes.gpkg: A GeoPackage of features with POINT geometry representing topologic breaks in the stream network such as pseudonodes, confluences, stream sources, or stream outlets. A column containing a unique node identifier, pointid, is included. 
</p>
</li>
<li><p> edges.gpkg: A GeoPackage of features with LINESTRING geometry representing flow paths (i.e. line features) from node to node. A new column named rid is added that contains a unique identifier for each line feature. 
</p>
</li>
<li><p>nodexy.csv: a table with three columns: the pointid (unique node identifier), and the x-, y-coordinates for each node. 
</p>
</li>
<li><p>noderelationships.csv: a table describing the relationship between the nodes and their associated edges, as well as directionality in the LSN. The table contains three columns: the rid (for each edge), fromnode (pointid for the upstream node of each edge), and tonode (pointid for the downstream node of each edge). Directionality is defined based on the digitized direction of the line features. 
</p>
</li>
<li><p>relationships.csv: a table representing the downstream flow path from edge to edge. The table contains two columns: fromedge (upstream edge) and toedge (downstream edge). 
</p>
</li></ul>

<p>Topological errors are common in spatial data and must be corrected
to ensure that the LSN accurately represents direction and
connectivity within the stream network. When <code>check_topology =
TRUE</code>, the edges are checked for topological errors. Two nodes on
the network separated by a distance less than or equal to
<code>topo_tolerance</code> are flagged as potential topological errors
in the network saved in an output file called
<code>node_errors.gpkg</code>, which is also saved to <code>lsn_path</code>. In
addition to the pointid, <code>node_errors.gpkg</code> contains a column
containing the node class (nodecat), which can take on values of
Pseudonode, Confluence, Source, or Outlet. A second column (error)
defines the potential error type and can take on values of Complex
Confluence, Converging Node, Dangling Node, Intersection Without
Node, Downstream Divergence and Unsnapped Node. The nodecat column
is also added to nodes.gpkg. A node_errors.gpkg file is not
produced if no obvious errors are identified. There is no guarantee
that all topological errors will be identified and included in
node_errors.gpkg. Therefore, potential errors <em>and</em> node classes
found in node_errors.gpkg and nodes.gpkg must be checked in a GIS
and topological errors in <code>streams</code> corrected before
rebuilding the LSN using <code>lines_to_lsn()</code>. This process is
iterative and must continue until the LSN is free of topological
errors.
</p>
<p>The arguments <code>snap_tolerance</code> and <code>topo_tolerance</code> are
both provided in map units and must be &gt;= 0. It is generally a good
idea to set the <code>snap_tolerance</code> to a relatively small value
compared to the <code>topo_tolerance</code> argument. Nodes separated by
a Euclidean distance &lt;= <code>snap_tolerance</code> are assumed to be
connected.  If this distance &lt;= (snap_tolerance/10000), the nodes
are automatically snapped when <code>check_topology = TRUE</code>.  When
(snap_tolerance/10000) &lt;= distance &lt;= snap_tolerance, the nodes are
not snapped and are instead flagged as potential errors for the
user to check and correct. Similarly, when snap_tolerance &lt; distance &lt;=
topo_tolerance, nodes are flagged as potential errors.
</p>


<h3>Value</h3>

<p>An <code>sf</code> object representing edges in the LSN. The LSN, including edges.gpkg, nodes.gpkg, nodexy.csv, noderelationships.csv, and relationships.csv files, are saved locally to a directory defined by <code>lsn_path</code>. If <code>check_topology = TRUE</code> and topological errors are identified, then node_errors.gpkg is also saved to <code>lsn_path</code>.
</p>

<hr>
<h2 id='lines_to_lsn_temp'>Convert lines to a landscape network</h2><span id='topic+lines_to_lsn_temp'></span>

<h3>Description</h3>

<p>Convert an <code>sf</code> object containing features with
LINESTRING geometry to a landscape network (LSN), which is a
topological data model of streams/rivers represented as a
directional graph embedded in 2-D geographic space. Relationship
tables are created and topological relationships are checked.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lines_to_lsn_temp(
  streams,
  lsn_path,
  snap_tolerance = 0,
  topo_tolerance = 0,
  check_topology = TRUE,
  remove_ZM = FALSE,
  overwrite = FALSE,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="lines_to_lsn_temp_+3A_streams">streams</code></td>
<td>
<p>An <code>sf</code> object with LINESTING geometry
representing streams.</p>
</td></tr>
<tr><td><code id="lines_to_lsn_temp_+3A_lsn_path">lsn_path</code></td>
<td>
<p>Pathname to a directory in character format specifying
where to store the outputs. The directory will be created if it
does not already exist.</p>
</td></tr>
<tr><td><code id="lines_to_lsn_temp_+3A_snap_tolerance">snap_tolerance</code></td>
<td>
<p>Distance in map units. Two nodes separated by
a distance less than or equal to <code>snap_tolerance</code> are
assumed to be connected. Defaults to 0.</p>
</td></tr>
<tr><td><code id="lines_to_lsn_temp_+3A_topo_tolerance">topo_tolerance</code></td>
<td>
<p>Distance in map units. Only used if
<code>check_topology = TRUE</code>. Two nodes on the network separated
by a distance less than or equal to <code>topo_tolerance</code> are
flagged as potential topological errors in the network. Defaults
to 0.</p>
</td></tr>
<tr><td><code id="lines_to_lsn_temp_+3A_check_topology">check_topology</code></td>
<td>
<p>Logical. If <code>TRUE</code>, the edges will be
checked for topological errors and potential node errors will be
flagged in an output file called
<code>node_errors.gpkg</code>. Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="lines_to_lsn_temp_+3A_remove_zm">remove_ZM</code></td>
<td>
<p>Logical. If <code>TRUE</code>, Z and M dimensions are
removed from streams, if they exist. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="lines_to_lsn_temp_+3A_overwrite">overwrite</code></td>
<td>
<p>Logical. If <code>TRUE</code>, output files will
overwrite existing files with the same names. If <code>FALSE</code> and
files sharing the same names as the outputs exist in the
<code>lsn_path</code>, the function will exit early with an error.</p>
</td></tr>
<tr><td><code id="lines_to_lsn_temp_+3A_verbose">verbose</code></td>
<td>
<p>Logical. If <code>TRUE</code>, messages describing
function progress will be printed to the console. Default is
<code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>lines_to_lsn</code> converts an <code>sf</code> object
representing streams to a landscape network
(LSN), which is a directional graph used to represent
the topological and geographic relationships between line
features, along with additional attribute information.
<code>streams</code> must have LINESTRING geometry and a projected coordinate system, rather
than geographic coordinate system (i.e. not Longitude and Latitude).
</p>
<p>The LSN is saved to a local directory defined by <code>lsn_path</code> and has 5 components:
</p>

<ul>
<li><p> nodes.gpkg: A GeoPackage of features with POINT geometry representing topologic breaks in the stream network such as pseudonodes, confluences, stream sources, or stream outlets. A column containing a unique node identifier, pointid, is included. 
</p>
</li>
<li><p> edges.gpkg: A GeoPackage of features with LINESTRING geometry representing flow paths (i.e. line features) from node to node. A new column named rid is added that contains a unique identifier for each line feature. 
</p>
</li>
<li><p>nodexy.csv: a table with three columns: the pointid (unique node identifier), and the x-, y-coordinates for each node. 
</p>
</li>
<li><p>noderelationships.csv: a table describing the relationship between the nodes and their associated edges, as well as directionality in the LSN. The table contains three columns: the rid (for each edge), fromnode (pointid for the upstream node of each edge), and tonode (pointid for the downstream node of each edge). Directionality is defined based on the digitized direction of the line features. 
</p>
</li>
<li><p>relationships.csv: a table representing the downstream flow path from edge to edge. The table contains two columns: fromedge (upstream edge) and toedge (downstream edge). 
</p>
</li></ul>

<p>Topological errors are common in spatial data and must be corrected
to ensure that the LSN accurately represents direction and
connectivity within the stream network. When <code>check_topology =
TRUE</code>, the edges are checked for topological errors. Two nodes on
the network separated by a distance less than or equal to
<code>topo_tolerance</code> are flagged as potential topological errors
in the network saved in an output file called
<code>node_errors.gpkg</code>, which is also saved to <code>lsn_path</code>. In
addition to the pointid, <code>node_errors.gpkg</code> contains a column
containing the node class (nodecat), which can take on values of
Pseudonode, Confluence, Source, or Outlet. A second column (error)
defines the potential error type and can take on values of Complex
Confluence, Converging Node, Dangling Node, Intersection Without
Node, Downstream Divergence and Unsnapped Node. The nodecat column
is also added to nodes.gpkg. A node_errors.gpkg file is not
produced if no obvious errors are identified. There is no guarantee
that all topological errors will be identified and included in
node_errors.gpkg. Therefore, potential errors <em>and</em> node classes
found in node_errors.gpkg and nodes.gpkg must be checked in a GIS
and topological errors in <code>streams</code> corrected before
rebuilding the LSN using <code>lines_to_lsn()</code>. This process is
iterative and must continue until the LSN is free of topological
errors.
</p>


<h3>Value</h3>

<p>An <code>sf</code> object representing edges in the LSN. The LSN, including edges.gpkg, nodes.gpkg, nodexy.csv, noderelationships.csv, and relationships.csv files, are saved locally to a directory defined by <code>lsn_path</code>. If <code>check_topology = TRUE</code> and topological errors are identified, then node_errors.gpkg is also saved to <code>lsn_path</code>.
</p>

<hr>
<h2 id='MF_CapeHorn'>MF_CapeHorn: Prediction locations on Cape Horn Creek, in the Middle Fork Basin, Idaho.</h2><span id='topic+MF_CapeHorn'></span>

<h3>Description</h3>

<p><code>MF_CapeHorn</code> is an <code>sf</code> object with POINT geometry representing prediction locations and covariates on Cape Horn Creek, Middle Fork Basin, Idaho, USA.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MF_CapeHorn
</code></pre>


<h3>Format</h3>

<p>An object of class <code>sf</code> (inherits from <code>data.frame</code>) with 654 rows and 10 columns.
</p>


<h3>Details</h3>

<p>The <code style="white-space: pre;">&#8288;sf data.frame&#8288;</code> contains 654 point features and 9 columns:
</p>

<ul>
<li><p> COMID: Common identifier of an NHD feature or relationship
</p>
</li>
<li><p> AREAWTMAP: Area weighted mean annual precipitation (mm) at lowermost
location on the line segment where the site resides
</p>
</li>
<li><p> SLOPE: Slope of the line segment (cm/cm) where the site resides
</p>
</li>
<li><p> ELEV_DEM: Elevation at the site based on a 30m DEM
</p>
</li>
<li><p> Source: Source of the data - relates to the ID field of the source table
</p>
</li>
<li><p> FlowCMS: Average stream flow (cubic meters per sec) for August,
by year, from 1950-2010 across 9 USGS gauges in the region
</p>
</li>
<li><p> AirMEANc: Average mean air temperature (C) from July 15 - August 31,
from 1980-2009 across 10 COOP air stations within the domain
</p>
</li>
<li><p> AirMWMTc: Average maximum air temperature (C) from July 15 - August 31,
from 1980-2009 across 10 COOP air stations within the domain.
MWMT = maximum 7-day moving average of the maximum daily temperature
(i.e. maximum of all the 7-day maximums)
</p>
</li>
<li><p> rcaAreaKm2: Reach contributing area (km2) for the downstream node of the edge feature the site resides on. RCA area is the land area draining directly into each line segment.
</p>
</li>
<li><p> h2oAreaKm2: Watershed area (km2) for the downstream node of the edge feature the site resides on
</p>
</li></ul>



<h3>Source</h3>

<p><code>MF_CapeHorn</code> are unpublished United States Forest Service data.
</p>

<hr>
<h2 id='MF_obs'>MF_obs: Water temperature observations in the Middle Fork Basin, Idaho in 2004.</h2><span id='topic+MF_obs'></span>

<h3>Description</h3>

<p><code>MF_obs</code> is an <code>sf</code> object with POINT geometry representing water temperature observations and covariates in the Middle Fork Basin, Idaho, USA collected in 2004.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MF_obs
</code></pre>


<h3>Format</h3>

<p>An object of class <code>sf</code> (inherits from <code>data.frame</code>) with 45 rows and 17 columns.
</p>


<h3>Details</h3>

<p>The <code style="white-space: pre;">&#8288;sf data.frame&#8288;</code> contains 45 point features and 16 columns:
</p>

<ul>
<li><p> STREAMNAME: Stream name
</p>
</li>
<li><p> COMID: Common identifier of an NHD feature or relationship
</p>
</li>
<li><p> AREAWTMAP: Area weighted mean annual precipitation (mm) at lowermost
location on the line segment where the site resides
</p>
</li>
<li><p> SLOPE: Slope of the line segment (cm/cm) where the site resides
</p>
</li>
<li><p> ELEV_DEM: Elevation at the site based on a 30m DEM
</p>
</li>
<li><p> Source: Source of the data - relates to the ID field of the source table
</p>
</li>
<li><p> Summer_mn: Overall summer mean temperature (C) of the deployment
</p>
</li>
<li><p> MaxOver20: Binary variable: 1 represents the maximum summer temperature
was greater than 20C and 0 indicates that it was less than 20C
</p>
</li>
<li><p> C16: Number of times daily stream temperature exceeded 16C
</p>
</li>
<li><p> C20: Number of times daily stream temperature exceeded 20C
</p>
</li>
<li><p> C24: Number of times daily stream temperature exceeded 24C
</p>
</li>
<li><p> FlowCMS: Average stream flow (cubic meters per sec) for August,
by year, from 1950-2010 across 9 USGS gauges in the region
</p>
</li>
<li><p> AirMEANc: Average mean air temperature (C) from July 15 - August 31,
from 1980-2009 across 10 COOP air stations within the domain
</p>
</li>
<li><p> AirMWMTc: Average maximum air temperature (C) from July 15 - August 31,
from 1980-2009 across 10 COOP air stations within the domain.
MWMT = maximum 7-day moving average of the maximum daily temperature
(i.e. maximum of all the 7-day maximums)
</p>
</li>
<li><p> rcaAreaKm2: Reach contributing area (km2) for the downstream node of the edge feature the site resides on. RCA area is the land area draining directly into each line segment.
</p>
</li>
<li><p> h2oAreaKm2: Watershed area (km2) for the downstream node of the edge feature the site resides on
</p>
</li></ul>



<h3>Source</h3>

<p><code>MF_obs</code> are unpublished United States Forest Service data.
</p>

<hr>
<h2 id='MF_pred1km'>MF_pred1km: Prediction locations at 1km intervals throughout the Middle Fork Basin, Idaho.</h2><span id='topic+MF_pred1km'></span>

<h3>Description</h3>

<p><code>MF_pred1km</code> is an <code>sf</code> object with POINT geometry representing prediction locations and covariates distributed at 1km intervals throughout the Middle Fork Basin, Idaho, USA.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MF_pred1km
</code></pre>


<h3>Format</h3>

<p>An object of class <code>sf</code> (inherits from <code>data.frame</code>) with 175 rows and 10 columns.
</p>


<h3>Details</h3>

<p>The <code style="white-space: pre;">&#8288;sf data.frame&#8288;</code> contains 175 point features and 9 columns:
</p>

<ul>
<li><p> COMID: Common identifier of an NHD feature or relationship
</p>
</li>
<li><p> AREAWTMAP: Area weighted mean annual precipitation (mm) at lowermost
location on the line segment where the site resides
</p>
</li>
<li><p> SLOPE: Slope of the line segment (cm/cm) where the site resides
</p>
</li>
<li><p> ELEV_DEM: Elevation at the site based on a 30m DEM
</p>
</li>
<li><p> Source: Source of the data - relates to the ID field of the source table
</p>
</li>
<li><p> FlowCMS: Average stream flow (cubic meters per sec) for August,
by year, from 1950-2010 across 9 USGS gauges in the region
</p>
</li>
<li><p> AirMEANc: Average mean air temperature (C) from July 15 - August 31,
from 1980-2009 across 10 COOP air stations within the domain
</p>
</li>
<li><p> AirMWMTc: Average maximum air temperature (C) from July 15 - August 31,
from 1980-2009 across 10 COOP air stations within the domain.
MWMT = maximum 7-day moving average of the maximum daily temperature
(i.e. maximum of all the 7-day maximums)
</p>
</li>
<li><p> rcaAreaKm2: Reach contributing area (km2) for the downstream node of the edge feature the site resides on. RCA area is the land area draining directly into each line segment.
</p>
</li>
<li><p> h2oAreaKm2: Watershed area (km2) for the downstream node of the edge feature the site resides on
</p>
</li></ul>



<h3>Source</h3>

<p><code>MF_pred1km</code> are unpublished United States Forest Service data.
</p>

<hr>
<h2 id='MF_preds'>MF_preds: A small set of prediction locations found in the Middle Fork Basin, Idaho.</h2><span id='topic+MF_preds'></span>

<h3>Description</h3>

<p><code>MF_preds</code> is an <code>sf</code> object with POINT geometry representing prediction locations and covariates distributed at 1km intervals throughout the Middle Fork Basin, Idaho, USA.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MF_preds
</code></pre>


<h3>Format</h3>

<p>An object of class <code>sf</code> (inherits from <code>data.frame</code>) with 43 rows and 10 columns.
</p>


<h3>Details</h3>

<p>The <code style="white-space: pre;">&#8288;sf data.frame&#8288;</code> contains 43 point features and 9 columns:
</p>

<ul>
<li><p> COMID: Common identifier of an NHD feature or relationship
</p>
</li>
<li><p> AREAWTMAP: Area weighted mean annual precipitation (mm) at lowermost
location on the line segment where the site resides
</p>
</li>
<li><p> SLOPE: Slope of the line segment (cm/cm) where the site resides
</p>
</li>
<li><p> ELEV_DEM: Elevation at the site based on a 30m DEM
</p>
</li>
<li><p> FlowCMS: Average stream flow (cubic meters per sec) for August,
by year, from 1950-2010 across 9 USGS gauges in the region
</p>
</li>
<li><p> AirMEANc: Average mean air temperature (C) from July 15 - August 31,
from 1980-2009 across 10 COOP air stations within the domain
</p>
</li>
<li><p> AirMWMTc: Average maximum air temperature (C) from July 15 - August 31,
from 1980-2009 across 10 COOP air stations within the domain.
MWMT = maximum 7-day moving average of the maximum daily temperature
(i.e. maximum of all the 7-day maximums)
</p>
</li>
<li><p> rcaAreaKm2: Reach contributing area (km2) for the downstream node of the edge feature the site resides on. RCA area is the land area draining directly into each line segment.
</p>
</li>
<li><p> h2oAreaKm2: Watershed area (km2) for the downstream node of the edge feature the site resides on
</p>
</li></ul>



<h3>Source</h3>

<p><code>MF_preds</code> are unpublished United States Forest Service data.
</p>

<hr>
<h2 id='MF_streams'>MF_streams: Middle Fork streams</h2><span id='topic+MF_streams'></span>

<h3>Description</h3>

<p><code>MF_streams</code> is an <code>sf</code> object with LINESTRING geometry representing a subset of
streams and rivers in the Middle Fork Basin, Idaho, USA.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MF_streams
</code></pre>


<h3>Format</h3>

<p>An object of class <code>sf</code> (inherits from <code>data.frame</code>) with 163 rows and 10 columns.
</p>


<h3>Details</h3>

<p>The <code style="white-space: pre;">&#8288;sf data.frame&#8288;</code> contains a set of 163 features and 9 columns:
</p>

<ul>
<li><p> COMID: Common identifier of an NHD feature or relationship
</p>
</li>
<li><p> GNIS_NAME: Feature name as found in the Geographic Names Information System
</p>
</li>
<li><p> REACHCODE: Unique identifier for a reach. The first 8 digits contain the identifier for the HUC8 and the last 6 digits are a unique within-HUC8 identifier for the reach
</p>
</li>
<li><p> FTYPE: three-digit integer used to classify hydrography features in the NHD and define subtypes
</p>
</li>
<li><p> FCODE: Numeric code that contains the feature type and its attributes as found in the NHDFCode lookup table
</p>
</li>
<li><p> AREAWTMAP: Area weighted mean annual precipitation (mm) at the lowermost location on the edge
</p>
</li>
<li><p> SLOPE: Slope of the edge (cm/cm)
</p>
</li>
<li><p> rcaAreaKm2: Reach contributing area (km2), which is the land area draining directly into each line segment.
</p>
</li>
<li><p> h2oAreaKm2: Watershed area (km2) for the lowermost location (downstream end node) on the line segment
</p>
</li></ul>



<h3>Source</h3>

<p><code>MF_streams</code> are a modified version of the United States
National Hydrography Dataset
(http://nhd.usgs.gov/).
</p>

<hr>
<h2 id='sites_to_lsn'>Incorporate sites into a Landscape Network</h2><span id='topic+sites_to_lsn'></span>

<h3>Description</h3>

<p>Incorporates an <code>sf</code> object containing features
with POINT geometry into a landscape network (LSN), which is a
topological data model of streams/rivers represented as a
directional graph embedded in 2-D geographic space. Point
locations are 'snapped' to the closest edge location and new
information is generated describing the geographic and
topological location relative to other features in the LSN.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sites_to_lsn(
  sites,
  edges,
  snap_tolerance,
  save_local = TRUE,
  lsn_path = NULL,
  file_name = NULL,
  overwrite = FALSE,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sites_to_lsn_+3A_sites">sites</code></td>
<td>
<p>An <code>sf</code> object with POINT geometry, typically
representing observed data or prediction locations.</p>
</td></tr>
<tr><td><code id="sites_to_lsn_+3A_edges">edges</code></td>
<td>
<p>An <code>sf</code> object with LINESTING geometry created
using <code><a href="#topic+lines_to_lsn">lines_to_lsn</a></code>.</p>
</td></tr>
<tr><td><code id="sites_to_lsn_+3A_snap_tolerance">snap_tolerance</code></td>
<td>
<p>Numeric distance in map units &gt;= 0. Sites that
are &lt;= this distance from an edge feature will snapped to the
closest location on the edge. When the distance between the site
and all edges is &gt; <code>snap_tolerance</code>, the point feature is not
snapped or included in the lsn_path.</p>
</td></tr>
<tr><td><code id="sites_to_lsn_+3A_save_local">save_local</code></td>
<td>
<p>Logical indicating whether the outputs should be
saved to a local directory in GeoPackage format. Defaults to
<code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="sites_to_lsn_+3A_lsn_path">lsn_path</code></td>
<td>
<p>Pathname to the LSN. This is typically a directory created by
<code><a href="#topic+lines_to_lsn">lines_to_lsn</a></code>. Required if <code>save_local = TRUE</code>.</p>
</td></tr>
<tr><td><code id="sites_to_lsn_+3A_file_name">file_name</code></td>
<td>
<p>Filename for output sites, which are saved to <code>lsn_path</code>
in GeoPackage format (must include the .gpkg extension). Required if <code>save_local = TRUE</code>.</p>
</td></tr>
<tr><td><code id="sites_to_lsn_+3A_overwrite">overwrite</code></td>
<td>
<p>Logical indicating whether the outputs saved to
<code>lsn_path</code> should overwrite existing files if they
exist. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="sites_to_lsn_+3A_verbose">verbose</code></td>
<td>
<p>Logical indicating whether progress messages should
be printed to the console. Defaults to <code>TRUE</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>sites_to_lsn</code> function is used to incorporate
observed and prediction sites into the LSN. The output is an
<code>sf</code> object with POINT geometry, which contains only the
point features from <code>sites</code> that were found less than the
<code>snap_tolerance</code> distance from the closest edge
feature. When a <code>sites</code> point feature meets these
requirements, it is moved (i.e. snapped) to the closest location
on an edge feature. Three new columns are also added: rid, ratio,
and snapdist. The rid column contains the rid for the edge the
site has been snapped to. The second column, ratio,
represents the proportional length of the edge found between the
downstream end node for the edge and the updated/snapped site
location. The snapdist is the distance in map units that the site
was moved. If the distance between a point feature and the
closest edge is greater than or equal to the
<code>snap_tolerance</code>, the feature is not included in the output.
</p>
<p>The <code>snap_tolerance</code> must always be <code class="reqn">\ge 0</code> and must be large
enough to snap all of the point features to the edges. Using
<code>snap_tolerance = 0</code> is not recommended, even when the
<code>sites</code> features intersect the edge features. Instead, a
very small <code>snap_tolerance</code> value is recommended to ensure
that differences in the precision of the x and y coordinates and
the line location do not result in unsnapped point features.
</p>
<p>Note that the <code>sites</code> and <code>edges</code>
must have the same projection.
</p>


<h3>Value</h3>

<p>An <code>sf</code> object with POINT geometry containing the
features from <code>sites</code> that were found within the
<code>snap_tolerance</code> distance to the closest edge. In addition to
the original columns in <code>sites</code>, three new columns are
added: rid, ratio, and snapdist (see Details). If
<code>save_local = TRUE</code>, the <code>sf</code> object is also saved to
<code>lsn_path</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Get temporary directory, where the example LSN will be stored
# locally.
temp_dir &lt;- tempdir()
# Build the LSN. When working with your own data, lsn_path will be
# a local folder of your choice rather than a temporary directory.
edges&lt;- lines_to_lsn(
   streams = MF_streams,
   lsn_path = temp_dir,
   snap_tolerance = 1,
   check_topology = FALSE,
   overwrite = TRUE,
   verbose = FALSE
)

# # Incorporate observed sites, MF_obs, into LSN
obs&lt;- sites_to_lsn(
   sites = MF_obs,
   edges = edges,
   save_local = FALSE,
   snap_tolerance = 100,
   overwrite = TRUE,
   verbose = FALSE
)
# Notice that 3 new columns have been added to obs
names(obs)

# Incorporate prediction dataset, MF_preds, into LSN
preds&lt;- sites_to_lsn(sites = MF_preds,
   edges = edges,
   save_local = FALSE,
   snap_tolerance = 1,
   overwrite = TRUE,
   verbose = FALSE
)

</code></pre>

<hr>
<h2 id='ssn_assemble'>Assemble an <code>SSN</code> object from an LSN</h2><span id='topic+ssn_assemble'></span>

<h3>Description</h3>

<p>Create an <code>SSN</code> (spatial stream network) object from a Landscape Network (LSN).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ssn_assemble(
  edges,
  lsn_path = NULL,
  obs_sites = NULL,
  preds_list = NULL,
  ssn_path,
  import = TRUE,
  check = TRUE,
  afv_col = NULL,
  overwrite = FALSE,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ssn_assemble_+3A_edges">edges</code></td>
<td>
<p>An <code>sf</code> object with LINESTING geometry created
using <code><a href="#topic+lines_to_lsn">lines_to_lsn</a></code> (see Details).</p>
</td></tr>
<tr><td><code id="ssn_assemble_+3A_lsn_path">lsn_path</code></td>
<td>
<p>Local pathname to a directory in character format
specifying where relationships.csv resides, which is created
using <code>link{lines_to_lsn}</code>.</p>
</td></tr>
<tr><td><code id="ssn_assemble_+3A_obs_sites">obs_sites</code></td>
<td>
<p>Optional. A single <code>sf</code> object with POINT
geometry created using <code>link{sites_to_lsn}</code> that represents
the observation locations (i.e. where data were
collected). Default = NULL (see Details).</p>
</td></tr>
<tr><td><code id="ssn_assemble_+3A_preds_list">preds_list</code></td>
<td>
<p>Optional. A list of one or more <code>sf</code> objects
representing prediction sites.</p>
</td></tr>
<tr><td><code id="ssn_assemble_+3A_ssn_path">ssn_path</code></td>
<td>
<p>Pathname to an output directory where output files
will be stored. A .ssn extension will be added if it is not
included.</p>
</td></tr>
<tr><td><code id="ssn_assemble_+3A_import">import</code></td>
<td>
<p>Logical indicating whether the output files should be
returned as an <code>SSN</code> object. Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="ssn_assemble_+3A_check">check</code></td>
<td>
<p>Logical indicating whether the validity of the
<code>SSN</code> should be checked using <code>[ssn_check]</code> when both
<code>import = TRUE</code> and <code>verbose = TRUE</code>. Default = <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="ssn_assemble_+3A_afv_col">afv_col</code></td>
<td>
<p>Character vector containing the names of the
additive function value columns that will be checked when
<code>check = TRUE</code>. Columns must be present in <code>edges</code>,
<code>obs_sites</code> and <code>preds_list</code>, if all are
included. Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="ssn_assemble_+3A_overwrite">overwrite</code></td>
<td>
<p>Logical. If <code>TRUE</code> and <code>ssn_path</code>
already exists, the contents of <code>ssn_path</code> will be
overwritten. Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="ssn_assemble_+3A_verbose">verbose</code></td>
<td>
<p>Logical. Indicates whether messages about the
function progress and object validity check (when <code>check = TRUE</code> should be printed to the console. Defaults to
<code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>SSNbler</code> package is used to generate the
spatial, topological, and attribute information needed to fit
spatial stream-network models using the 'SSN2' package. The
<code>ssn_assemble</code> function will often be the final step in the
'SSNbler' data-processing workflow and it is important that
the previous processing steps have been followed. Prior to
running <code>ssn_assemble</code>, the <code>edges</code> must be processed
using <code>link{lines_to_lsn}</code>, <code>link{updist_edges}</code>, and
<code>link{afv_edges}</code>. The <code>obs_sites</code> and prediction site
datasets in <code>preds_list</code> must be processed with
<code>link{sites_to_lsn}</code>, <code>link{updist_sites}</code>, and
<code>link{afv_sites}</code>. In addition, the <code>edges</code>,
<code>obs_sites</code>, and all of the <code>sf</code> objects in
<code>preds_list</code> must be part of the same LSN.
</p>
<p>The <code>obs_sites</code> and <code>preds_list</code> are optional arguments,
with the Default = NULL. If <code>obs_sites = NULL</code>, an
<code>SSN</code> object will be returned with NA stored in
<code>ssn.object$obs</code> and a warning returned that
<code>ssn.object$obs</code> is required for fitting spatial statistical
models in 'SSN2'.
</p>
<p><code>ssn_assemble</code> stores the output locally in <code>ssn_path</code>. If
<code>ssn_path</code> does not include the .ssn extension, it is added
before the new directory is created. This directory contains:
</p>

<ul>
<li><p> edges.gpkg: edges in GeoPackage format. A new network identifier, netID, is added that is unique to each subnetwork.
</p>
</li>
<li><p> sites.gpkg: observed sites in GeoPackage format (if present). Three new ID columns are added that are unique to the measurement (pid), the location (locID), and the network (netID).
</p>
</li>
<li><p> prediction datasets in GeoPackage format (if present). The prediction sites also contain pid, locID, and netID. The naming convention is taken from the names provided in <code>preds_list</code>.
</p>
</li>
<li><p> netID.dat files for each distinct network, which store the binaryID values for line segments in edges.
</p>
</li></ul>

<p>A more detailed description of the .ssn directory and its contents is provided in Peterson and Ver Hoef (2014).
</p>


<h3>Value</h3>

<p>The components of an <code>SSN</code> object are written to
<code>ssn_path</code> (see Details). When <code>import = TRUE</code>, the
function also returns an object of class <code>SSN</code>. If
<code>check = TRUE</code> and <code>verbose = TRUE</code>, the validity of the returned <code>SSN</code>
object is checked using <code>[ssn_check]</code> and results are
printed to the console.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Get temporary directory, where the example LSN will be stored
# locally.
temp_dir &lt;- tempdir()
# Build the LSN. When working with your own data, lsn_path will be
# a local folder of your choice rather than a temporary directory.
edges&lt;- lines_to_lsn(
   streams = MF_streams,
   lsn_path = temp_dir,
   snap_tolerance = 1,
   check_topology = FALSE,
   overwrite = TRUE,
   verbose = FALSE
)

# Incorporate observed sites, MF_obs, into LSN
obs&lt;- sites_to_lsn(
   sites = MF_obs,
   edges = edges,
   save_local = FALSE,
   snap_tolerance = 100,
   overwrite = TRUE,
   verbose = FALSE
)

# Incorporate prediction dataset, MF_preds, into LSN
preds&lt;- sites_to_lsn(sites = MF_preds,
   edges = edges,
   save_local = FALSE,
   snap_tolerance = 1,
   overwrite = TRUE,
   verbose = FALSE
)

# Calculate the AFV for the edges using
# a column representing watershed area (h2oAreaKm2).
edges&lt;- afv_edges(
   edges=edges,
   infl_col = "h2oAreaKm2",
   segpi_col = "areaPI",
   lsn_path = temp_dir,
   afv_col = "afvArea",
   overwrite = TRUE,
   save_local = FALSE
)

# Calculate the AFV for observed sites (obs) and prediction
# dataset, preds.
site.list&lt;- afv_sites(
   sites = list(obs = obs,
                preds = preds),
   edges=edges,
   afv_col = "afvArea",
   save_local = FALSE,
   overwrite = TRUE
)

# Calculate upstream distance for edges
edges&lt;- updist_edges(
   edges = edges,
   lsn_path = temp_dir,
   calc_length = TRUE,
   length_col = "Length",
   overwrite = TRUE,
   save_local = FALSE,
   verbose = FALSE
)

# Calculate upstream distance for observed sites (obs) and one
# prediction dataset (preds)
site.list&lt;- updist_sites(
   sites = site.list,
   edges = edges,
   length_col= "Length",
   lsn_path = temp_dir,
   save_local = FALSE,
   overwrite = TRUE
)

# Assemble SSN object
ssn.obj&lt;- ssn_assemble(
   edges = edges,
   lsn_path = temp_dir,
   obs_sites = site.list[["obs"]],
   preds_list = site.list[c("preds")],
   ssn_path = paste0(temp_dir, "/example.ssn"),
   import = TRUE,
   overwrite = TRUE
)

# Summarise SSN object
summary(ssn.obj)

</code></pre>

<hr>
<h2 id='ssn_check'>Check an <code>SSN</code> object</h2><span id='topic+ssn_check'></span>

<h3>Description</h3>

<p>Check an <code>SSN</code> (spatial stream network) object to ensure that it contains valid spatial, topological, and attribute information needed to fit spatial statistical stream network models using the 'SSN2' package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ssn_check(ssn.object, check_obs = TRUE, afv_col = NULL, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ssn_check_+3A_ssn.object">ssn.object</code></td>
<td>
<p>An <code>SSN</code> object created using <code><a href="#topic+ssn_assemble">ssn_assemble</a></code> or imported using <code><a href="SSN2.html#topic+ssn_import">ssn_import</a></code>.</p>
</td></tr>
<tr><td><code id="ssn_check_+3A_check_obs">check_obs</code></td>
<td>
<p>A logical indicating whether the observations should be checked. Default = <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="ssn_check_+3A_afv_col">afv_col</code></td>
<td>
<p>Character vector containing  names of columns containing additive function values. The Default = <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="ssn_check_+3A_verbose">verbose</code></td>
<td>
<p>Logical <code>TRUE/FALSE</code> indicating whether details describing the checks are printed to the console. If <code>verbose = FALSE</code>, a logical <code>TRUE/FALSE</code> is returned indicating whether the <code>SSN</code> object passed all of the checks. Default = <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Boolean indicating whether the <code>SSN</code> object is valid. If <code>verbose = TRUE</code>, additional messages are printed to the console describing potential issues with the <code>SSN</code> object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Create local temporary copy of MiddleFork04.ssn found in
## the SSN2 package. Only necessary for this example.
SSN2::copy_lsn_to_temp()

# Import the SSN object with prediction points, pred1km
mf04 &lt;- SSN2::ssn_import(
  paste0(tempdir(), "/MiddleFork04.ssn"),
  predpts = c("pred1km"),
  overwrite = TRUE
)

# Check the SSN object, including the additive function column,
# afvArea
ssn_check(mf04, afv_col = "afvArea")

</code></pre>

<hr>
<h2 id='updist_edges'>Get upstream distance for edges in a Landscape Network (LSN)</h2><span id='topic+updist_edges'></span>

<h3>Description</h3>

<p>Calculate the distance from the stream outlet
(i.e. the most downstream location on the stream network) to the
upstream node of each edge feature (i.e. upstream distance) in
the Landscape Network (LSN)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>updist_edges(
  edges,
  lsn_path = NULL,
  calc_length = FALSE,
  length_col = NULL,
  save_local = TRUE,
  overwrite = TRUE,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="updist_edges_+3A_edges">edges</code></td>
<td>
<p>An <code>sf</code> object with LINESTING geometry created
using <code><a href="#topic+lines_to_lsn">lines_to_lsn</a></code>.</p>
</td></tr>
<tr><td><code id="updist_edges_+3A_lsn_path">lsn_path</code></td>
<td>
<p>Local pathname to a directory in character format
specifying where relationships.csv resides, which is created
using <code><a href="#topic+lines_to_lsn">lines_to_lsn</a></code>.</p>
</td></tr>
<tr><td><code id="updist_edges_+3A_calc_length">calc_length</code></td>
<td>
<p>A logical indicating whether a column
representing line length should be calculated and added to
<code>edges</code>. Default = <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="updist_edges_+3A_length_col">length_col</code></td>
<td>
<p>Optional. If <code>calc_length = FALSE</code>,
<code>length_col</code> is the name of the column in the <code>edges</code>
attribute table that contains the length of the edge
feature. When <code>calc_length = FALSE</code>, <code>length_col</code> is
required. If <code>calc_length = TRUE</code>, <code>length_col</code> is the
name of the new column created in <code>edges</code> that will store
the new length values for each feature, in character format.
When <code>calc_length = TRUE</code> and <code>length_col = NULL</code>, the default for <code>length_col</code>
is <code>"Length"</code>.</p>
</td></tr>
<tr><td><code id="updist_edges_+3A_save_local">save_local</code></td>
<td>
<p>Logical indicating whether the updated
<code>edges</code> should be saved to <code>lsn_path</code> in GeoPackage
format. Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="updist_edges_+3A_overwrite">overwrite</code></td>
<td>
<p>A logical indicating whether results should be
overwritten if the upDist column already exists in <code>edges</code>
or edges.gpkg already exists in <code>lsn_path</code> and
<code>save_local = TRUE</code>. Default = TRUE</p>
</td></tr>
<tr><td><code id="updist_edges_+3A_verbose">verbose</code></td>
<td>
<p>Logical. Indicates whether messages about the
function progress should be printed to the console. Defaults to
<code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>updist_edges()</code> calculates the total hydrologic distance from
the uppermost location on each edge feature (upstream node) to
the stream outlet (i.e. the most downstream location in the
stream network), when movement is restricted to the stream
network. We refer to this as the upstream distance. Upstream distances are
measured in the map projection units for the <code>sf</code> object edges and stored in
a new column in edges named <code>upDist</code>.
</p>
<p>The upstream distances stored in <code>upDist</code> are used to calculate the upstream distance for
sites in <code><a href="#topic+updist_sites">updist_sites()</a></code> and the pairwise hydrologic distances used to fit spatial stream network models in
the 'SSN2' package. Do not modify the name of the column in any way or the values the <code>upDist</code>
column contains.
</p>


<h3>Value</h3>

<p>An <code>sf</code> object representing edges in the LSN, with a new <code>upDist</code> column. When <code>calc_length = TRUE</code> an additional column named <code>length_col</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Get temporary directory, where the example LSN will be stored
# locally.
temp_dir &lt;- tempdir()
# Build the LSN. When working with your own data, lsn_path will be
# a local folder of your choice rather than a temporary directory.
edges&lt;- lines_to_lsn(
   streams = MF_streams,
   lsn_path = temp_dir,
   snap_tolerance = 1,
   check_topology = FALSE,
   overwrite = TRUE,
   verbose = FALSE
)

# Calculate upstream distance for edges
edges&lt;- updist_edges(
   edges = edges,
   lsn_path = temp_dir,
   calc_length = TRUE,
   length_col = "Length",
   overwrite = TRUE,
   save_local = FALSE,
   verbose = FALSE
)

# Notice that two new columns have been added to edges containing
# line feature length (Length) and the upstream distance (upDist)
names(edges)
summary(edges[,c("Length", "upDist")])

</code></pre>

<hr>
<h2 id='updist_sites'>Get upstream distance for sites in a Landscape Network (LSN)</h2><span id='topic+updist_sites'></span>

<h3>Description</h3>

<p>Get upstream distance for sites in a Landscape Network (LSN)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>updist_sites(
  sites,
  edges,
  length_col,
  lsn_path,
  save_local = TRUE,
  overwrite = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="updist_sites_+3A_sites">sites</code></td>
<td>
<p>A named list of one or more <code>sf</code> objects with
POINT geometry that have been snapped to the LSN using
<code><a href="#topic+sites_to_lsn">sites_to_lsn</a></code>.</p>
</td></tr>
<tr><td><code id="updist_sites_+3A_edges">edges</code></td>
<td>
<p>An <code>sf</code> object with LINESTING geometry created
using <code><a href="#topic+lines_to_lsn">lines_to_lsn</a></code> and
<code>link[SSNbler]{updist_edges}</code>.</p>
</td></tr>
<tr><td><code id="updist_sites_+3A_length_col">length_col</code></td>
<td>
<p>The name of the column in <code>edges</code> that
contains the length of each edge feature.</p>
</td></tr>
<tr><td><code id="updist_sites_+3A_lsn_path">lsn_path</code></td>
<td>
<p>Local pathname to a directory in
character format specifying where the LSN resides, which is
created using <code>link[SSNbler]{lines_to_lsn}</code>. Must be
specified if <code>save_local = TRUE</code>.</p>
</td></tr>
<tr><td><code id="updist_sites_+3A_save_local">save_local</code></td>
<td>
<p>Logical indicating whether the updated
<code>sites</code> should be saved to <code>lsn_path</code> in GeoPackage
format. File basenames are taken from the names assigned to the
<code>sites</code> list. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="updist_sites_+3A_overwrite">overwrite</code></td>
<td>
<p>A logical indicating whether results should be
overwritten if the upDist column already exists in <code>sites</code>
or sites.gpkg already exists in <code>lsn_path</code> and
<code>save_local = TRUE</code>. Default = TRUE.
</p>
<p>#' @details <code>updist_sites()</code> calculates the total hydrologic distance from
each observed or prediction point feature to
the stream outlet (i.e. the most downstream location in the
stream network), when movement is restricted to the stream
network. We refer to this as the upstream distance.
</p>
<p>Upstream distances are measured in the map projection units for the
<code>sf</code> object containing the point features and stored in a
new column named <code>upDist</code>.
</p>
<p>The upstream distances stored in <code>upDist</code> are used to
calculate the pairwise hydrologic distances used to fit spatial
stream network models in the 'SSN2' package. Do not modify the name
of the column in any way or the values the <code>upDist</code> column
contains.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>One or more <code>sf</code> object(s) with all the original
data from <code>sites</code>, along with a new <code>upDist</code> column in
each sites <code>sf</code> object. A named list is returned. If
<code>save_local = TRUE</code>, a GeoPackage for each <code>sf</code> object
is saved in <code>lsn_path</code>. Output file names are assigned based
on the input <code>sites</code> attribute <code>names</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Get temporary directory, where the example LSN will be stored
# locally.
temp_dir &lt;- tempdir()
# Build the LSN. When working with your own data, lsn_path will be
# a local folder of your choice rather than a temporary directory.
edges&lt;- lines_to_lsn(
   streams = MF_streams,
   lsn_path = temp_dir,
   snap_tolerance = 1,
   check_topology = FALSE,
   overwrite = TRUE,
   verbose = FALSE
)

# Incorporate observed sites, MF_obs, into LSN
obs&lt;- sites_to_lsn(
   sites = MF_obs,
   edges = edges,
   save_local = FALSE,
   snap_tolerance = 100,
   overwrite = TRUE,
   verbose = FALSE
)

# Incorporate prediction dataset, MF_preds, into LSN
preds&lt;- sites_to_lsn(
   sites = MF_preds,
   edges = edges,
   save_local = FALSE,
   snap_tolerance = 1,
   overwrite = TRUE,
   verbose = FALSE
)

# Calculate upstream distance for edges
edges&lt;- updist_edges(
   edges = edges,
   lsn_path = temp_dir,
   calc_length = TRUE,
   length_col = "Length",
   overwrite = TRUE,
   save_local = FALSE,
   verbose = FALSE
)

# Calculate upstream distance for observed sites (obs) and one
# prediction dataset (preds)
site.list&lt;- updist_sites(
   sites = list(obs = obs,
                preds = preds),
   edges = edges,
   length_col= "Length",
   lsn_path = temp_dir,
   save_local = FALSE,
   overwrite = TRUE
)

# Summarize the new column upDist in obs
summary(site.list$obs$upDist)

# Summarize the new column upDist in preds
summary(site.list$preds$upDist)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
