<!DOCTYPE html><html><head><title>Help for package DIDmultiplegtDYN</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {DIDmultiplegtDYN}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#did_multiplegt_dyn'><p>Core function for did_multiplegt_dyn</p></a></li>
<li><a href='#print.did_multiplegt_dyn'><p>A print method for did_multiplegt_dyn</p></a></li>
<li><a href='#summary.did_multiplegt_dyn'><p>A summary method for did_multiplegt_dyn</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Estimation in Difference-in-Difference Designs with Multiple
Groups and Periods</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.5</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Diego Ciccia &lt;diego.ciccia@sciencespo.fr&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Estimation of event-study Difference-in-Difference (DID) estimators in designs with multiple groups and periods, and with a potentially non-binary treatment that may increase or decrease multiple times. </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Author:</td>
<td>Diego Ciccia [aut, cre],
  Felix Knau [aut],
  Mélitine Malezieux [aut],
  Doulo Sow [aut],
  Clément de Chaisemartin [aut]</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Imports:</td>
<td>data.table, dplyr, ggplot2, magrittr, matlib, plm, rlang,
xlsx, stats, car, lmtest, sandwich, haven</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-03-01 15:41:14 UTC; 39380</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-03-01 16:32:36 UTC</td>
</tr>
</table>
<hr>
<h2 id='did_multiplegt_dyn'>Core function for did_multiplegt_dyn</h2><span id='topic+did_multiplegt_dyn'></span>

<h3>Description</h3>

<p>Estimation of event-study Difference-in-Difference (DID) estimators in designs with multiple groups and periods, with a potentially non-binary treatment that may increase or decrease multiple times.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>did_multiplegt_dyn(
  df,
  outcome,
  group,
  time,
  treatment,
  effects = 1,
  design = NULL,
  normalized = FALSE,
  normalized_weights = FALSE,
  effects_equal = FALSE,
  placebo = 0,
  controls = NULL,
  trends_nonparam = NULL,
  trends_lin = FALSE,
  continuous = NULL,
  weight = NULL,
  cluster = NULL,
  by = NULL,
  predict_het = NULL,
  date_first_switch = NULL,
  same_switchers = FALSE,
  same_switchers_pl = FALSE,
  switchers = "",
  ci_level = 95,
  graph_off = FALSE,
  save_results = NULL,
  save_sample = FALSE,
  less_conservative_se = FALSE,
  dont_drop_larger_lower = FALSE,
  drop_if_d_miss_before_first_switch = FALSE,
  bootstrap = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="did_multiplegt_dyn_+3A_df">df</code></td>
<td>
<p>(dataframe) the estimation dataset.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_outcome">outcome</code></td>
<td>
<p>(char) is the outcome variable.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_group">group</code></td>
<td>
<p>(char) is the group variable.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_time">time</code></td>
<td>
<p>(char) is the time period variable. The command assumes that the time variable is evenly spaced (e.g.: the panel is at the yearly level, and no year is missing for all groups). When it is not (e.g.: the panel is at the yearly level, but three consecutive years are missing for all groups), the command can still be used, though it requires a bit of tweaking, see FAQ section below.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_treatment">treatment</code></td>
<td>
<p>(char) is the treatment variable.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_effects">effects</code></td>
<td>
<p>(int) gives the number of event-study effects to be estimated. By default, the command estimates non-normalized event-study effects. Non-normalized event-study effects are averages, across all switchers, of the effect of having received their actual rather than their period-one treatment dose, for <code class="reqn">\ell</code> periods. While non-normalized event-study effects can be interpreted as average effects of being exposed to a weakly higher treatment dose for <code class="reqn">\ell</code> periods, the magnitude and timing of the incremental treatment doses can vary across groups.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_design">design</code></td>
<td>
<p>(2 args: float, char path) this option reports switchers' period-one and subsequent treatments, thus helping the analyst understand the treatment paths whose effect is aggregated in the non-normalized event-study effects. When the number of treatment paths is low, one may consider estimating treatment-path-specific event-study effects to facilitate interpretation, see footnote 10 of de Chaisemartin and D'Haultfoeuille (2024) for detailed instructions. When the number of treatment paths is large, one may specify a number included between 0 and 1 in the float argument. Then the command reports the treatment paths common to at least (<em>float</em>*100)% of switchers. Results can be printed in the Stata console specifying &quot;console&quot; as the string argument.  For example, <em>design = c(0.5, &quot;console&quot;)</em> reports the treatment paths experienced by at least 50% of the switchers and prints the output in the Stata console. Alternatively, the output can be stored in an Excel file providing a valid file path as the string argument.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_normalized">normalized</code></td>
<td>
<p>(logical) when this option is specified, the command estimates normalized event-study effects, that are equal to a weighted average of the effects of the current treatment and of its <code class="reqn">\ell-1</code> first lags on the outcome. See Sections 3.1 and 3.2 of de Chaisemartin and D'Haultfoeuille (2020a) for further details.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_normalized_weights">normalized_weights</code></td>
<td>
<p>(logical, requires normalized = TRUE) the command reports the weights that normalized effect <code class="reqn">\ell</code> puts on the effect of the current treatment, on the effect of the first treatment lag, etc.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_effects_equal">effects_equal</code></td>
<td>
<p>(logical) when this option is specified and the user requests that at least two effects be estimated, the command performs an F-test that all effects are equal. When the normalized option is specified, this test can be useful to assess if the current and lagged treatments all have the same effect on the outcome or if their effects differ, see Lemma 3 of de Chaisemartin and D'Haultfoeuille (2020a).</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_placebo">placebo</code></td>
<td>
<p>(int) gives the number of placebo estimators to be computed. Placebos compare the outcome evolution of switchers and of their controls, before switchers' treatment changes for the first time. Under the parallel trends and no-anticipation assumptions underlying the event-study estimators computed by <code>did_multiplegt_dyn()</code>, the expectation of the placebos is equal to zero. Thus, placebos can be used to test those assumptions, by testing the null that all placebos are equal to zero. If the user requests that at least two placebos be estimated, the command computes the p-value of a joint test of that null hypothesis. The number of placebos requested can be at most equal to the number of time periods in the data minus 2, though most often only a smaller number of placebos can be computed. Also, the number of placebos requested cannot be larger than the number of effects requested.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_controls">controls</code></td>
<td>
<p>(atomic char or vector of char) gives the names of the control variables to be included in the estimation. Estimators with controls are similar to those without controls, except that the first-difference of the outcome is replaced by residuals from regressions of the first-difference of the outcome on the first-differences of the controls and time fixed effects. Those regressions are estimated in the sample of control <code class="reqn">(g,t)</code>s: <code class="reqn">(g,t)</code>s such that group <code class="reqn">g</code>'s treatment has not changed yet at <code class="reqn">t</code>. Those regressions are also estimated separately for each value of the baseline treatment. Estimators with controls are unbiased even if groups experience differential trends, provided such differential trends can be fully explained by a linear model in covariates changes. To control for time-invariant covariates, one needs to interact them with the time variable <code class="reqn">T</code>, or with time fixed effects. See Section 1.2 of the Web Appendix of de Chaisemartin and D'Haultfoeuille (2020a) for further details.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_trends_nonparam">trends_nonparam</code></td>
<td>
<p>(atomic char or vector of char) when this option is specified, the DID estimators computed by the command only compare switchers to controls whose treatment has not changed yet, with the same baseline treatment, and with the same value of the varlist. Estimators with the trends_nonparam() option are unbiased even if groups experience differential trends, provided all groups with the same value of the varlist experience parallel trends. The vector can only include time-invariant variables, and the interaction of those variables has to be coarser than the group variable. For instance, if one works with a county <code class="reqn">\times</code> year data set and one wants to allow for state-specific trends, then one should write trends_nonparam(state), where state is the state identifier. See Section 1.4 of the Web Appendix of de Chaisemartin and D'Haultfoeuille (2024) for further details.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_trends_lin">trends_lin</code></td>
<td>
<p>(logical) when this option is specified, the estimation of the treatment effects allows for group-specific linear trends. Estimators with linear trends start by computing event-study effects on the outcome's first-difference, rather than on the outcome itself, thus allowing for group-specific linear trends. Then, to recover event-study effect <code class="reqn">\ell</code> on the outcome, event-study effects on the outcome's first-difference are summed from 1 to <code class="reqn">\ell</code>. See Section 1.3 of the Web Appendix of de Chaisemartin and D'Haultfoeuille (2024) for further details. When this option is specified, the estimated average total effect per unit of treatment is not computed.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_continuous">continuous</code></td>
<td>
<p>(int) allows to use the command even when groups' period-one treatment is continuous, meaning that all groups have a different period-one treatment value. With a discrete period-one treatment, the command compares the outcome evolution of switchers and non-switchers with the same period-one treatment.  But with a truly continuous period-one treatment, there will be no two groups with the same period-one treatment. The command assumes that group's status-quo outcome evolution is a polynomial in their period-one treatment. The user's chosen polynomial order is the option's int argument. See Section 1.10 of the Web Appendix of de Chaisemartin and D'Haultfoeuille (2024) for further details. Unlike the other variance estimators computed by the command, those computed when the continuous option is specified are not backed by a proven asymptotic normality result. Preliminary simulation evidence indicates that when the option is used with a correctly-specified polynomial order, those variance estimators are conservative. On the other hand, when the specified polynomial order is strictly larger than needed, those variance estimators can become liberal. Thus, when this option is specified, we recommend using the bootstrap for inference, by manually bootstrapping the command. At least, one should perform a robustness check where one compares the analytic variance computed by the command to a bootstrapped variance.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_weight">weight</code></td>
<td>
<p>(char) gives the name of a variable to be used to weight the data. For instance, if one works with a district <code class="reqn">\times</code> year data set and one wants to weight the estimation by each district <code class="reqn">\times</code> year's population, one should write weight(population), where population is the population of each district <code class="reqn">\times</code> year. If the data set is at a more disaggregated level than group <code class="reqn">\times</code> time, the command aggregates it at the group <code class="reqn">\times</code> time level internally, and weights the estimation by the number of observations in each group <code class="reqn">\times</code> time cell if the weight option is not specified, or by the sum of the weights of the observations in each group <code class="reqn">\times</code> time cell if the weight option is specified.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_cluster">cluster</code></td>
<td>
<p>(char) can be used to cluster the estimators' standard errors. Only one clustering variable is allowed. A common practice in DID analysis is to cluster standard errors at the group level. Such clustering is implemented by default by the command. Standard errors can be clustered at a more aggregated level than the group level, but they cannot be clustered at a more disaggregated level.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_by">by</code></td>
<td>
<p>(char) when this option is specified, the command estimates all the effects by the different levels of the specified variable. If the variable is a binary variable for example, then the estimation is carried out once for the sample of groups with var=0 and once for the sample of groups with var=1. Then, the command reports on a graph event-study plots for all values of the by() argument, thus allowing to assess effect heterogeneity by the specified variable.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_predict_het">predict_het</code></td>
<td>
<p>(list with 2 args: char or vector of char, -1 or vector of positive integers)  when this option is specified, the command outputs tables showing whether the group-level and time-invariant variables in the char varlist predict groups' estimated event-study effects. With the second argument set to -1, with this option the command produces one table per event-study effect estimated, each displaying the coefficients from regressions of the group-level estimate of the event-study effect on the variables in the char varlist. The p-value of a test on the null hypothesis that all heterogeneity estimates are equal to zero is shown below each table. If you are only interested in predicting a subset of the event-study effects estimated, you can specify those inside an integer vector as the second argument. This option cannot be specified with normalized = TRUE and when the controls option is specified. See Section 1.5 of the Web Appendix of de Chaisemartin and D'Haultfoeuille (2024) for further details.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_date_first_switch">date_first_switch</code></td>
<td>
<p>(2 args: char in (&quot;&quot;, &quot;by_baseline_treat&quot;), char path) the option reports the dates at which switchers experience their first treatment change, and how many groups experienced a first change at each date. The reference population are switchers for which the last event-study effect can be estimated. If &quot;by_baseline_treat&quot; is specified as the first argument, separate tables are displayed for each level of the period-one treatment. Results can be printed in the Stata console specifying &quot;console&quot; in the second argument. Alternatively, the output can be stored in an Excel file providing a valid file path in the second argument.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_same_switchers">same_switchers</code></td>
<td>
<p>(logical) if this option is specified and the user requests that at least two effects be estimated, the command will restrict the estimation of the event-study effects to switchers for which all effects can be estimated, to avoid compositional changes.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_same_switchers_pl">same_switchers_pl</code></td>
<td>
<p>(logical, requires same_switchers = TRUE) the command restricts the estimation of event-study and placebo effects to switchers for which all event-study and placebos effects can be estimated.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_switchers">switchers</code></td>
<td>
<p>(char in (&quot;&quot;, &quot;in&quot;, &quot;out&quot;)) one may be interested in estimating separately the treatment effect of switchers-in, whose average treatment after they switch is larger than their baseline treatment, and of switchers-out, whose average treatment after they switch is lower than their baseline treatment. In that case, one should run the command first with the switchers = &quot;in&quot; option, and then with the switchers = &quot;out&quot; option.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_ci_level">ci_level</code></td>
<td>
<p>(int) with this option you can change the level of the confidence intervals displayed in the output tables and the graphs. The default value is fixed at 95, yielding a 95% coverage.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_graph_off">graph_off</code></td>
<td>
<p>(logical) when this option is specified, the command does not print a graph. Regardless, a ggplot object will be still generated and stored in the did_multiplegt_dyn class object.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_save_results">save_results</code></td>
<td>
<p>(char) if this option is specified, the command saves the estimators requested, their standard error, their 95% confidence interval, and the number of observations used in the estimation in a separate data set, at the location specified in the char argument.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_save_sample">save_sample</code></td>
<td>
<p>(logical) if this option is specified, the command generates a (numeric) variable <em>did_sample</em>, tagging all <code class="reqn">(g,t)</code> cells used in the estimation. This variable may take on three non-missing values: 0 for <code class="reqn">(g,t)</code> cells used as controls, 1 for (g,t) cells used as switchers-in, and -1 for cells used as switchers-out. This variable is missing for all <code class="reqn">(g,t)</code> cells not used in the estimation. This option also generates a <em>did_effect</em> variable that indicates the number of the event-study effect for which the cell is used in the estimation.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_less_conservative_se">less_conservative_se</code></td>
<td>
<p>(logical) when groups' treatment can change multiple times, the standard errors reported by default by the command may be conservative. Then, less conservative standard errors can be obtained by specifying this option. See de Chaisemartin et al. (2024) for further details.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_dont_drop_larger_lower">dont_drop_larger_lower</code></td>
<td>
<p>(logical) by default, the command drops all the <code class="reqn">(g,t)</code> cells such that at <code class="reqn">t</code>, group <code class="reqn">g</code> has experienced both a strictly larger and a strictly lower treatment than its baseline treatment. de Chaisemartin and D'Haultfoeuille (2020a) recommend this procedure, if you are interested in more details you can see their Section 3.1. The option dont_drop_larger_lower allows to overwrite this procedure and keeps <code class="reqn">(g,t)</code> cells such that at <code class="reqn">t</code>, group <code class="reqn">g</code> has experienced both a strictly larger and a strictly lower treatment than its baseline treatment in the estimation sample.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_drop_if_d_miss_before_first_switch">drop_if_d_miss_before_first_switch</code></td>
<td>
<p>(logical) This option is relevant when the treatment of some groups is missing at some time periods. Then, the command imputes some of those missing treatments. Those imputations are detailed in Appendix A of de Chaisemartin et al (2024). In designs where groups' treatments can change at most once, all those imputations are justified by the design. In other designs, some of those imputations may be liberal. drop_if_d_miss_before_first_switch can be used to overrule the potentially liberal imputations that are not innocuous for the non-normalized event-study estimators. See Appendix A of de Chaisemartin et al (2024) for further details.</p>
</td></tr>
<tr><td><code id="did_multiplegt_dyn_+3A_bootstrap">bootstrap</code></td>
<td>
<p>(integer) This option allows to bootstrap the standard errors of the estimated coefficients. The integer argument is the number of bootstrap replications.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of class did_multiplegt_dyn containing the arguments used, the results for the estimation requested and a ggplot object with the event-study graph. If the by option is specified, the did_multiplegt_dyn object will contain the arguments, a list with the levels of the by option, a sublist for each of these levels with the results and ggplot objects from these by-estimations and a ggplot object for the combined event-study graph. The class did_multiplegt_dyn is assigned to enable customized print and summary methods.
</p>


<h3>Overview</h3>

<p><code>did_multiplegt_dyn()</code> estimates the effect of a treatment on an outcome, using group-(e.g. county- or state-) level panel data. The panel may be unbalanced: not all groups have to be observed at every period. The data may also be at a more disaggregated level than the group level (e.g. individual-level wage data to measure the effect of a regional-level minimum-wage on individuals' wages). The command computes the DID event-study estimators introduced in de Chaisemartin and D'Haultfoeuille (2024). It can be used with a binary and absorbing (staggered) treatment but it can also be used with a non-binary treatment (discrete or continuous) that can increase or decrease multiple times, even if lagged treatments affect the outcome, and if the current and lagged treatments have heterogeneous effects, across space and/or over time. The event-study estimators computed by the command rely on a no-anticipation and parallel trends assumptions.
</p>
<p>For all &quot;switchers&quot;, namely groups that experience a change of their treatment over the study period, let <code class="reqn">F_g</code> denote the first time period when g's treatment changes. The command computes the non-normalized event-study estimators <code class="reqn">\text{DID}_\ell</code>. <code class="reqn">\text{DID}_1</code> is the average, across all switchers, of DID estimators comparing the <code class="reqn">F_{g-1}</code> to <code class="reqn">F_g</code> outcome evolution of <code class="reqn">g</code> to that of groups with the same period-one treatment as <code class="reqn">g</code> but whose treatment has not changed yet at <code class="reqn">F_g</code>. More generally, <code class="reqn">\text{DID}_l</code> is the average, across all switchers, of DID estimators comparing the <code class="reqn">F_{g-1}</code> to <code class="reqn">F_{g-1+\ell}</code> outcome evolution of <code class="reqn">g</code> to that of groups with the same period-one treatment as <code class="reqn">g</code> but whose treatment has not changed yet at <code class="reqn">F_{g-1+\ell}</code>. Non-normalized event-study effects are average effects of having been exposed to a weakly higher treatment dose for <code class="reqn">\ell</code> periods, where the magnitude and timing of the incremental treatment doses can vary across groups. The command also computes the normalized event-study estimators <code class="reqn">\text{DID}^n_\ell</code>, that normalize <code class="reqn">\text{DID}_\ell</code> by the average total incremental treatment dose received by switchers from <code class="reqn">F_{g-1}</code> to <code class="reqn">F_{g-1+\ell}</code> with respect to their period-one treatment. This normalization ensures that <code class="reqn">DID^n_\ell</code> estimates a weighted average of the effects of the current treatment and of its <code class="reqn">\ell-1</code> first lags on the outcome. The command also computes an estimated average total effect per unit of treatment, where &quot;total effect&quot; refers to the sum of the effects of a treatment increment, at the time when it takes place and at later periods, see Section 3.3 of de Chaisemartin and D'Haultfoeuille (2024) for further details. Finally, the command also computes placebo estimators, that average DIDs comparing the outcome evolution of switcher <code class="reqn">g</code> and of its control groups, from <code class="reqn">F_{g-1}</code> to <code class="reqn">F_{g-1-\ell}</code>, namely before g's treatment changes for the first time. Those placebos can be used to test the parallel trends and no-anticipation assumptions under which the estimators computed by <code>did_multiplegt_dyn()</code> are unbiased.
</p>


<h3>FAQ</h3>

<p><strong><code>did_multiplegt_dyn()</code> does not output exactly the same results as <code>did_multiplegt()</code>, is this normal?</strong>
</p>
<p>Yes, the two commands can sometimes output different results. This is mostly due to different conventions in the way the two commands deal with missing values. See Appendix B of de Chaisemartin et al (2024) for further details.
</p>
<p><strong>Do I have to include group and time fixed effects as controls when using <code>did_multiplegt_dyn()</code>?</strong>
</p>
<p>No, you do not have to. Group and time fixed effects are automatically controlled for.
</p>
<p><strong>My group-level panel is unbalanced: some groups (e.g. counties) are not observed in every year. Can I still use the command?</strong>
</p>
<p>You can. A frequent case of unbalancedness is when some groups are not observed over the full duration of the panel. For instance, your data may be a yearly county-level panel from 1990 to 2000, where some counties appear after 1990 while some exit before 2000. Then, the command just redefines group's period-one treatment as their treatment at the first period when they are observed.
</p>
<p>It may also be that some groups enter and exit the data multiple times. For instance, you observe a county in 1990, 1991, 1994, 1996, and 2000. Then, the command may impute some of that county's missing treatments. Those imputations are detailed in Appendix A of de Chaisemartin et al (2024). In designs where groups' treatments can change at most once, all those imputations are justified by the design. In other designs, some of those imputations may be liberal.drop_if_d_miss_before_first_switch can be used to overrule the potentially liberal imputations that are not innocuous for the non-normalized event-study estimators. See Appendix A of de Chaisemartin et al (2024) for further details.
</p>
<p>Finally, it may also be the case that the data is fully missing at one or several time periods. For instance, you have data for 1990, 1991, and 1993, but 1992 is missing for every group. Then, it is important to fill the gap in the data, as otherwise the estimation will assume that 1991 and 1993 are as far apart as 1990 and 1991. There are two ways of doing so. First, you can append to your data a data set identical to your 1991 data, but with the year equal to 1992, and the outcome missing for every observation. This is a conservative solution, where no first treatment change occurring between 1991 and 1993 will be used in the estimation, which may be reasonable because the year in which the change occurred is effectively unknown. Second, you can append to your data a data set identical to your 1993 data, with the year equal to 1992, and the outcome missing for every observation. Then, treatment changes occurring between 1991 and 1993 will be used in the estimation, assuming they all took place between 1991 and 1992.
</p>
<p><strong>Related to imbalanced panels, my outcomes (and potentially the control variables) are measured less frequently than the treatment. For instance, the outcome is measured every two years, but I know the treatment of every group in every year. How should I proceed?</strong>
</p>
<p>To fix ideas, let us first assume that the outcome is measured every two years, but you know the treatment of every group in every year. Then, you should split the sample into two subsamples, and run the command twice, one time on each of the subsamples. In the first estimation, you should include all group <code class="reqn">\times</code> time cells <code class="reqn">(g,t)</code> such that at <code class="reqn">t</code>, <code class="reqn">g</code>'s treatment has never changed since the start of the panel, and all <code class="reqn">(g,t)</code>s such that i) <code class="reqn">g</code>'s treatment has changed at least once at <code class="reqn">t</code> and ii) the change occurred at a period where the outcome is observed. Since the outcome is measured every two years, in that subsample the first event-study effect (denoted effect_1) is the effect of being exposed to a higher treatment for one period, the second effect (effect_2) is the effect of being exposed to a higher treatment for three periods, etc. In the second estimation, you should include all group <code class="reqn">\times</code> time cells <code class="reqn">(g,t)</code> such that at <code class="reqn">t</code>, <code class="reqn">g</code>'s treatment has never changed since the start of the panel, and all <code class="reqn">(g,t)</code>s such that i) <code class="reqn">g</code>'s treatment has changed at least once at <code class="reqn">t</code> and ii) the change occurred at a period where the outcome is not observed. In that subsample, the first event-study effect (denoted effect_1) is the effect of being exposed to a higher treatment for two periods, the second effect (effect_2) is the effect of being exposed to a higher treatment for four periods, etc. You may then combine the two sets of estimated effects into one event-study graph, with the only caveat that the &quot;odd&quot; and &quot;even&quot; effects are estimated on different subsamples. Importantly, the two estimations have to be run on a dataset at the same bi-yearly level as the outcome variable: the yearly level treatment information should only be used to select the relevant subsamples.
</p>
<p>If the treatment is observed three times more often than the treatment, you can follow the same logic, splitting the sample into three subsamples and running the command three times, etc.
</p>
<p>A short do file with a simple example where the treatment status is observed in each period while the outcome is only observed every second period can be found <a href="https://drive.google.com/uc?export=download&amp;id=1NBwfsFeNltU3XSOsORdthUW49LIezm1z">here</a>.
</p>
<p><strong>What is the maximum number of event-study effects I can estimate?</strong>
</p>
<p>With a balanced panel of groups, the maximum number of event-study effects one can estimate can be determined as follows. For each value of the period-one treatment <code class="reqn">d</code>, start by computing the difference between the last period at which at least one group has had treatment <code class="reqn">d</code> since period 1, and the first period at which a group with treatment <code class="reqn">d</code> at period 1 changed its treatment. Add one to this difference. Then, the maximum number of event-study effects is equal to the maximum of the obtained values, across all values of the period-one treatment. With an unbalanced panel, this method can still be used to derive an upper bound of the maximum number of event-study effects one can estimate.
</p>
<p><strong>How many control variables can I include in the estimation?</strong>
</p>
<p>Estimators with control variables are similar to those without controls, except that the first-difference of the outcome is replaced by residuals from regressions of the first-difference of the outcome on the first-differences of the controls and time fixed effects. Those regressions are estimated in the sample of control <code class="reqn">(g,t)</code>s: <code class="reqn">(g,t)</code>s such that group <code class="reqn">g</code>'s treatment has not changed yet at period <code class="reqn">t</code>. Those regressions are also estimated separately for each value of the period-one treatment. If at period one, treatment takes values 0, 1, 2, 3, and 4, one regression is estimated for control <code class="reqn">(g,t)</code>s with a period-one treatment equal to 0, one regression is estimated for control <code class="reqn">(g,t)</code>s with a period-one treatment equal to 1, etc. The number of control variables needs to be significantly smaller than the number of control <code class="reqn">(g,t)</code>s in each of those regressions. Otherwise, those regressions will overfit and produce noisy estimates. If the number of observations is lower than the number of variables in one of those regressions, the command will run but will not take into account all the controls for all values of the period-one treatment. An error message will let the user know that they are encountering this situation, and may thus want to reduce their number of control variables.
</p>
<p><strong>My design is such that treatment is binary, and groups can enter the treatment, and then leave it once. Can I use the command to separately estimate the effect of joining and leaving the treatment?</strong>
</p>
<p>Yes you can. See Section 1.6 of the Web Appendix of de Chaisemartin and D'Haultfoeuille (2024) for further details.
</p>
<p><strong>My design has several treatments. Can I use the command to estimate the event-study effects of a treatment controlling for other treatments?</strong>
</p>
<p>Yes, if those treatments follow binary and staggered designs. See Section 3.2 of the Web Appendix of de Chaisemartin and D'Haultfoeuille (2023) for further details.
</p>
<p><strong>Can I perform triple difference-in-differences with the command?</strong>
</p>
<p>Yes. Suppose for instance your third difference is across men and women in the same <code class="reqn">(g,t)</code> cell. Then, for each <code class="reqn">(g,t)</code> cell, you just need to compute the difference between the average outcome of men and women in cell <code class="reqn">(g,t)</code>. Then, you simply run the command with this new outcome.
</p>
<p><strong>Is it possible to compute switchers' average counterfactual outcome at periods <code class="reqn">F_g</code>, <code class="reqn">F_{g+1}</code>, ..., <code class="reqn">F_{g-1+\ell}</code>, so as to then express the event-study effects in percentage points of the counterfactual outcome level?</strong>
</p>
<p>Yes. You just need to define a new outcome variable <code class="reqn">Y' = - 1{t &lt; F_g} Y</code>, where <code class="reqn">F_g</code> is the first date at which <code class="reqn">g</code>'s treatment has changed. Essentially, you replace the outcome by 0 after the treatment change, and by <code class="reqn">-Y</code> before the treatment change. Then, you compute non-normalized event-study  estimators with <code class="reqn">Y'</code> as the outcome.
</p>
<p><strong>Can the command be used in fuzzy designs, where the treatment varies within group <code class="reqn">\times</code> time cells?</strong>
</p>
<p>Yes it can, see Section 1.7 of the Web Appendix of de Chaisemartin and D'Haultfoeuille (2024) for further details.
</p>


<h3>References</h3>

<p>de Chaisemartin, C, D'Haultfoeuille, X (2024). <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3731856">Difference-in-Differences Estimators of Intertemporal Treatment Effects</a>. Forthcoming, Review of Economics and Statistics.
</p>
<p>de Chaisemartin, C, D'Haultfoeuille, X (2023). <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3751060">Two-way fixed effects regressions with several treatments</a>. Journal of Econometrics.
</p>
<p>de Chaisemartin, C, Ciccia, D, D'Haultfoeuille, X, Knau, F, Malézieux, M, Sow, D (2024). <a href="https://drive.google.com/file/d/1d23jtOT8tiHG3mpjD_cuJy3h4I2sYFEK/view?usp=drive_link">Estimators and Variance Estimators Computed by the did_multiplegt_dyn Command</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># In the following example, we use data from Favara and Imbs (2015). 
# The dataset can be downloaded from GitHub:
repo &lt;- "chaisemartinPackages/ApplicationData/main" 
file &lt;- "favara_imbs_did_multiplegt_dyn.dta"
url &lt;- paste("https://raw.githubusercontent.com", repo, file, sep = "/")
favara_imbs &lt;-  haven::read_dta(url)

# Estimating 3 non-normalized event-study effects and two placebo 
# effects of banking deregulations on loans volume:
summary(did_multiplegt_dyn(
    df = favara_imbs,
    outcome = "Dl_vloans_b",
    group = "county",
    time = "year",
    treatment = "inter_bra",
    effects = 2,
    placebo = 1,
    cluster = "state_n",
    graph_off = TRUE
))

# Please note that some of the standard errors displayed above could differ from those 
# reported in de Chaisemartin and D'Haultfoeuille (2020b) due to coverage-improving 
# changes to the variance estimator.

# See the did_multiplegt_dyn GitHub page for further examples and details.
</code></pre>

<hr>
<h2 id='print.did_multiplegt_dyn'>A print method for did_multiplegt_dyn</h2><span id='topic+print.did_multiplegt_dyn'></span>

<h3>Description</h3>

<p>A customized printed display for did_multiplegt_dyn output
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'did_multiplegt_dyn'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.did_multiplegt_dyn_+3A_x">x</code></td>
<td>
<p>A did_multiplegt_dyn object</p>
</td></tr>
<tr><td><code id="print.did_multiplegt_dyn_+3A_...">...</code></td>
<td>
<p>Undocumented</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return, custom print method for did_multiplegt_dyn objects. Estimation tables are fetched from the object and displayed in the same style as the Stata did_multiplegt_dyn command.
</p>

<hr>
<h2 id='summary.did_multiplegt_dyn'>A summary method for did_multiplegt_dyn</h2><span id='topic+summary.did_multiplegt_dyn'></span>

<h3>Description</h3>

<p>A customized summary display for did_multiplegt_dyn output
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'did_multiplegt_dyn'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.did_multiplegt_dyn_+3A_object">object</code></td>
<td>
<p>A did_multiplegt_dyn object</p>
</td></tr>
<tr><td><code id="summary.did_multiplegt_dyn_+3A_...">...</code></td>
<td>
<p>Undocumented</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return, custom summary method for did_multiplegt_dyn objects. Estimation tables are fetched from the object and displayed in the same style as the Stata did_multiplegt_dyn command.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
