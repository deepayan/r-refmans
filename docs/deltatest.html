<!DOCTYPE html><html lang="en-US"><head><title>Help for package deltatest</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {deltatest}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#DeltaMethodForRatio'><p>The Delta Method for Ratio</p></a></li>
<li><a href='#deltatest'><p>Two Sample Z-Test for Ratio Metrics Using the Delta Method</p></a></li>
<li><a href='#generate_dummy_data'><p>Generate Dummy Data</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Statistical Hypothesis Testing Using the Delta Method</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Statistical hypothesis testing using the Delta method as
    proposed by Deng et al. (2018) &lt;<a href="https://doi.org/10.1145%2F3219819.3219919">doi:10.1145/3219819.3219919</a>&gt;. This
    method replaces the standard variance estimation formula in the Z-test
    with an approximate formula derived via the Delta method, which can
    account for within-user correlation.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/hoxo-m/deltatest">https://github.com/hoxo-m/deltatest</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/hoxo-m/deltatest/issues">https://github.com/hoxo-m/deltatest/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.1.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>glue, R6, rlang, stats</td>
</tr>
<tr>
<td>Suggests:</td>
<td>dplyr, ggplot2, knitr, rmarkdown, testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-02-28 08:33:55 UTC; akagi</td>
</tr>
<tr>
<td>Author:</td>
<td>Koji Makiyama [aut, cre, cph],
  Shinichi Takayanagi [med]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Koji Makiyama &lt;hoxo.smile@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-03-03 12:10:15 UTC</td>
</tr>
</table>
<hr>
<h2 id='DeltaMethodForRatio'>The Delta Method for Ratio</h2><span id='topic+DeltaMethodForRatio'></span>

<h3>Description</h3>

<p>Applies the Delta method to the ratio of two random variables,
<code class="reqn">f(X,Y)=X/Y</code>, to estimate the expected value, variance, standard error,
and confidence interval.
</p>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-DeltaMethodForRatio-new"><code>DeltaMethodForRatio$new()</code></a>
</p>
</li>
<li> <p><a href="#method-DeltaMethodForRatio-get_expected_value"><code>DeltaMethodForRatio$get_expected_value()</code></a>
</p>
</li>
<li> <p><a href="#method-DeltaMethodForRatio-get_variance"><code>DeltaMethodForRatio$get_variance()</code></a>
</p>
</li>
<li> <p><a href="#method-DeltaMethodForRatio-get_squared_standard_error"><code>DeltaMethodForRatio$get_squared_standard_error()</code></a>
</p>
</li>
<li> <p><a href="#method-DeltaMethodForRatio-get_standard_error"><code>DeltaMethodForRatio$get_standard_error()</code></a>
</p>
</li>
<li> <p><a href="#method-DeltaMethodForRatio-get_confidence_interval"><code>DeltaMethodForRatio$get_confidence_interval()</code></a>
</p>
</li>
<li> <p><a href="#method-DeltaMethodForRatio-get_info"><code>DeltaMethodForRatio$get_info()</code></a>
</p>
</li>
<li> <p><a href="#method-DeltaMethodForRatio-compute_expected_value"><code>DeltaMethodForRatio$compute_expected_value()</code></a>
</p>
</li>
<li> <p><a href="#method-DeltaMethodForRatio-compute_variance"><code>DeltaMethodForRatio$compute_variance()</code></a>
</p>
</li>
<li> <p><a href="#method-DeltaMethodForRatio-compute_confidence_interval"><code>DeltaMethodForRatio$compute_confidence_interval()</code></a>
</p>
</li>
<li> <p><a href="#method-DeltaMethodForRatio-clone"><code>DeltaMethodForRatio$clone()</code></a>
</p>
</li></ul>


<hr>
<a id="method-DeltaMethodForRatio-new"></a>



<h4>Method <code>new()</code></h4>

<p>Initialize a new DeltaMethodForRatio object.
</p>


<h5>Usage</h5>

<div class="r"><pre>DeltaMethodForRatio$new(numerator, denominator, bias_correction = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>numerator, denominator</code></dt><dd><p>numeric vectors sampled from the
distributions of the random variables in the numerator and denominator
of the ratio.</p>
</dd>
<dt><code>bias_correction</code></dt><dd><p>logical value indicating whether correction to the
mean of the metric is performed using the second-order term of the
Taylor expansion. The default is <code>FALSE</code>.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-DeltaMethodForRatio-get_expected_value"></a>



<h4>Method <code>get_expected_value()</code></h4>

<p>Get the expected value.
</p>


<h5>Usage</h5>

<div class="r"><pre>DeltaMethodForRatio$get_expected_value()</pre></div>



<h5>Returns</h5>

<p>numeric estimate of the expected value of the ratio.
</p>


<hr>
<a id="method-DeltaMethodForRatio-get_variance"></a>



<h4>Method <code>get_variance()</code></h4>

<p>Get the variance.
</p>


<h5>Usage</h5>

<div class="r"><pre>DeltaMethodForRatio$get_variance()</pre></div>



<h5>Returns</h5>

<p>numeric estimate of the variance of the ratio.
</p>


<hr>
<a id="method-DeltaMethodForRatio-get_squared_standard_error"></a>



<h4>Method <code>get_squared_standard_error()</code></h4>

<p>Get the squared standard error.
</p>


<h5>Usage</h5>

<div class="r"><pre>DeltaMethodForRatio$get_squared_standard_error()</pre></div>



<h5>Returns</h5>

<p>numeric estimate of the squared standard error of the ratio.
</p>


<hr>
<a id="method-DeltaMethodForRatio-get_standard_error"></a>



<h4>Method <code>get_standard_error()</code></h4>

<p>Get the standard error.
</p>


<h5>Usage</h5>

<div class="r"><pre>DeltaMethodForRatio$get_standard_error()</pre></div>



<h5>Returns</h5>

<p>numeric estimate of the standard error of the ratio.
</p>


<hr>
<a id="method-DeltaMethodForRatio-get_confidence_interval"></a>



<h4>Method <code>get_confidence_interval()</code></h4>

<p>Get the confidence interval.
</p>


<h5>Usage</h5>

<div class="r"><pre>DeltaMethodForRatio$get_confidence_interval(
  alternative = c("two.sided", "less", "greater"),
  conf_level = 0.95
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>alternative</code></dt><dd><p>character string specifying the alternative
hypothesis, must be one of <code>"two.sided"</code> (default), <code>"greater"</code>, or
<code>"less"</code>. You can specify just the initial letter.</p>
</dd>
<dt><code>conf_level</code></dt><dd><p>numeric value specifying the confidence level of the
interval. The default is 0.95.</p>
</dd>
</dl>

</div>



<h5>Returns</h5>

<p>numeric estimates of the lower and upper bounds of the confidence
interval of the ratio.
</p>


<hr>
<a id="method-DeltaMethodForRatio-get_info"></a>



<h4>Method <code>get_info()</code></h4>

<p>Get statistical information.
</p>


<h5>Usage</h5>

<div class="r"><pre>DeltaMethodForRatio$get_info(
  alternative = c("two.sided", "less", "greater"),
  conf_level = 0.95
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>alternative</code></dt><dd><p>character string specifying the alternative
hypothesis, must be one of <code>"two.sided"</code> (default), <code>"greater"</code>, or
<code>"less"</code>. You can specify just the initial letter.</p>
</dd>
<dt><code>conf_level</code></dt><dd><p>numeric value specifying the confidence level of the
interval. The default is 0.95.</p>
</dd>
</dl>

</div>



<h5>Returns</h5>

<p>numeric estimates include the expected value, variance, standard
error, and confidence interval.
</p>


<hr>
<a id="method-DeltaMethodForRatio-compute_expected_value"></a>



<h4>Method <code>compute_expected_value()</code></h4>

<p>Class method to compute the expected value of the ratio using the Delta
method.
</p>


<h5>Usage</h5>

<div class="r"><pre>DeltaMethodForRatio$compute_expected_value(
  mean1,
  mean2,
  var2,
  cov = 0,
  bias_correction = FALSE
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>mean1</code></dt><dd><p>numeric value of the mean numerator of the ratio.</p>
</dd>
<dt><code>mean2</code></dt><dd><p>numeric value of the mean denominator of the ratio.</p>
</dd>
<dt><code>var2</code></dt><dd><p>numeric value of the variance of the denominator of the ratio.</p>
</dd>
<dt><code>cov</code></dt><dd><p>numeric value of the covariance between the numerator and
denominator of the ratio. The default is 0.</p>
</dd>
<dt><code>bias_correction</code></dt><dd><p>logical value indicating whether correction to the
mean of the metric is performed using the second-order term of the
Taylor expansion. The default is <code>FALSE</code>.</p>
</dd>
</dl>

</div>



<h5>Returns</h5>

<p>numeric estimate of the expected value of the ratio.
</p>


<hr>
<a id="method-DeltaMethodForRatio-compute_variance"></a>



<h4>Method <code>compute_variance()</code></h4>

<p>Class method to compute the variance of the ratio using the Delta method.
</p>


<h5>Usage</h5>

<div class="r"><pre>DeltaMethodForRatio$compute_variance(mean1, mean2, var1, var2, cov = 0)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>mean1</code></dt><dd><p>numeric value of the mean numerator of the ratio.</p>
</dd>
<dt><code>mean2</code></dt><dd><p>numeric value of the mean denominator of the ratio.</p>
</dd>
<dt><code>var1</code></dt><dd><p>numeric value of the variance of the numerator of the ratio.</p>
</dd>
<dt><code>var2</code></dt><dd><p>numeric value of the variance of the denominator of the ratio.</p>
</dd>
<dt><code>cov</code></dt><dd><p>numeric value of the covariance between the numerator and
denominator of the ratio. The default is 0.</p>
</dd>
</dl>

</div>



<h5>Returns</h5>

<p>numeric estimate of the variance of the ratio
</p>


<hr>
<a id="method-DeltaMethodForRatio-compute_confidence_interval"></a>



<h4>Method <code>compute_confidence_interval()</code></h4>

<p>Class method to compute the confidence interval of the ratio using the
Delta method.
</p>


<h5>Usage</h5>

<div class="r"><pre>DeltaMethodForRatio$compute_confidence_interval(
  mean,
  standard_error,
  alternative = c("two.sided", "less", "greater"),
  conf_level = 0.95
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>mean</code></dt><dd><p>numeric value of the estimated mean of the ratio.</p>
</dd>
<dt><code>standard_error</code></dt><dd><p>numeric value of the estimated standard error of
the mean of the ratio.</p>
</dd>
<dt><code>alternative</code></dt><dd><p>character string specifying the alternative
hypothesis, must be one of <code>"two.sided"</code> (default), <code>"greater"</code>, or
<code>"less"</code>. You can specify just the initial letter.</p>
</dd>
<dt><code>conf_level</code></dt><dd><p>numeric value specifying the confidence level of the
interval. The default is 0.95.</p>
</dd>
</dl>

</div>



<h5>Returns</h5>

<p>numeric estimates of the lower and upper bounds of the confidence
interval of the ratio.
</p>


<hr>
<a id="method-DeltaMethodForRatio-clone"></a>



<h4>Method <code>clone()</code></h4>

<p>The objects of this class are cloneable with this method.
</p>


<h5>Usage</h5>

<div class="r"><pre>DeltaMethodForRatio$clone(deep = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>deep</code></dt><dd><p>Whether to make a deep clone.</p>
</dd>
</dl>

</div>




<h3>References</h3>


<ul>
<li><p> id:sz_dr (2018). Calculating the mean and variance of the ratio of random
variables using the Delta method [in Japanese]. <em>If you are human, think
more now.</em> <a href="https://www.szdrblog.info/entry/2018/11/18/154952">https://www.szdrblog.info/entry/2018/11/18/154952</a>
</p>
</li></ul>


<hr>
<h2 id='deltatest'>Two Sample Z-Test for Ratio Metrics Using the Delta Method</h2><span id='topic+deltatest'></span>

<h3>Description</h3>

<p>Performs two sample Z-test to compare the ratio metrics between two groups
using the delta method. The Delta method is used to estimate the variance by
accounting for the correlation between the numerator and denominator of ratio
metrics.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>deltatest(
  data,
  formula,
  by,
  group_names = "auto",
  type = c("difference", "relative_change"),
  bias_correction = FALSE,
  alternative = c("two.sided", "less", "greater"),
  conf.level = 0.95,
  na.rm = FALSE,
  quiet = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="deltatest_+3A_data">data</code></td>
<td>
<p>data.frame containing the numerator and denominator columns of
the ratio metric, aggregated by randomization unit. It also includes a
column indicating the assigned group (control or treatment). For example,
if randomizing by user while the metric is click-through rate (CTR) per
page-view, the numerator is the number of clicks per user, and the
denominator is the number of page views per user.</p>
</td></tr>
<tr><td><code id="deltatest_+3A_formula">formula</code></td>
<td>
<p>expression representing the ratio metric. It can be written in
three styles: standard formula <code>x/y ~ group</code>, lambda formula <code>~ x/y</code>, or
NSE expression <code>x/y</code>.</p>
</td></tr>
<tr><td><code id="deltatest_+3A_by">by</code></td>
<td>
<p>character string or symbol that indicates the group column. If the
group column is specified in the <code>formula</code> argument, it is not required.</p>
</td></tr>
<tr><td><code id="deltatest_+3A_group_names">group_names</code></td>
<td>
<p>character vector of length 2 or <code>"auto"</code>. It specifies
which of the two strings contained in the group column is the control group
and which is the treatment group. The first string is considered the control
group, and the second string is considered the treatment group. If <code>"auto"</code>
is specified, it is interpreted as specifying the strings in the group
column sorted in lexicographical order. The default is <code>"auto"</code>.</p>
</td></tr>
<tr><td><code id="deltatest_+3A_type">type</code></td>
<td>
<p>character string specifying the test type. If <code>"difference"</code>
(default), the hypothesis test evaluates the difference in means of the
ratio metric between two groups. If <code>"relative_change"</code>, it evaluates the
relative change <code class="reqn">(\mu_2 - \mu_1) / \mu_1</code> instead. You can specify just
the initial letter.</p>
</td></tr>
<tr><td><code id="deltatest_+3A_bias_correction">bias_correction</code></td>
<td>
<p>logical value indicating whether correction to the
mean of the metric is performed using the second-order term of the Taylor
expansion. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="deltatest_+3A_alternative">alternative</code></td>
<td>
<p>character string specifying the alternative hypothesis,
must be one of <code>"two.sided"</code> (default), <code>"greater"</code>, or <code>"less"</code>. You can
specify just the initial letter.</p>
</td></tr>
<tr><td><code id="deltatest_+3A_conf.level">conf.level</code></td>
<td>
<p>numeric value specifying the confidence level of the
interval. The default is 0.95.</p>
</td></tr>
<tr><td><code id="deltatest_+3A_na.rm">na.rm</code></td>
<td>
<p>logical value. If <code>TRUE</code>, rows containing NA values in the data
will be excluded from the analysis. The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="deltatest_+3A_quiet">quiet</code></td>
<td>
<p>logical value indicating whether messages should be displayed
during the execution of the function. The default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with class <code>"htest"</code> containing following components:
</p>
<table role = "presentation">
<tr><td><code>statistic</code></td>
<td>
<p>the value of the Z-statistic.</p>
</td></tr>
<tr><td><code>p.value</code></td>
<td>
<p>the p-value for the test.</p>
</td></tr>
<tr><td><code>conf.int</code></td>
<td>
<p>a confidence interval for the difference or relative change
appropriate to the specified alternative hypothesis.</p>
</td></tr>
<tr><td><code>estimate</code></td>
<td>
<p>the estimated means of the two groups, and the difference
or relative change.</p>
</td></tr>
<tr><td><code>null.value</code></td>
<td>
<p>the hypothesized value of the difference or relative
change in means under the null hypothesis.</p>
</td></tr>
<tr><td><code>stderr</code></td>
<td>
<p>the standard error of the difference or relative change.</p>
</td></tr>
<tr><td><code>alternative</code></td>
<td>
<p>a character string describing the alternative hypothesis.</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p>a character string describing the method used.</p>
</td></tr>
<tr><td><code>data.name</code></td>
<td>
<p>the name of the data.</p>
</td></tr>
</table>


<h3>References</h3>


<ul>
<li><p> Deng, A., Knoblich, U., &amp; Lu, J. (2018). Applying the Delta
Method in Metric Analytics: A Practical Guide with Novel Ideas.
<em>Proceedings of the 24th ACM SIGKDD International Conference on Knowledge
Discovery &amp; Data Mining.</em> <a href="https://doi.org/10.1145/3219819.3219919">doi:10.1145/3219819.3219919</a>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
library(deltatest)

n_user &lt;- 2000

set.seed(314)
df &lt;- deltatest::generate_dummy_data(n_user) |&gt;
  group_by(user_id, group) |&gt;
  summarise(click = sum(metric), pageview = n(), .groups = "drop")

deltatest(df, click / pageview, by = group)

</code></pre>

<hr>
<h2 id='generate_dummy_data'>Generate Dummy Data</h2><span id='topic+generate_dummy_data'></span>

<h3>Description</h3>

<p>Generate random dummy data for simulation studies. For details, see Section
4.3 in Deng et al. (2017).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>generate_dummy_data(
  n_user,
  model = c("Bernoulli", "normal"),
  xi = 0,
  sigma = 0,
  random_unit = c("user", "session", "pageview"),
  treatment_ratio = 0.5
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="generate_dummy_data_+3A_n_user">n_user</code></td>
<td>
<p>integer value specifying the number of users included in the
generated data. Since multiple rows are generated for each user, the number
of rows in the data exceeds the number of users.</p>
</td></tr>
<tr><td><code id="generate_dummy_data_+3A_model">model</code></td>
<td>
<p>character string specifying the model that generates the
potential outcomes. It must be one of <code>"Bernoulli"</code> (default) or
<code>"normal"</code>. You can specify just the initial letter.</p>
</td></tr>
<tr><td><code id="generate_dummy_data_+3A_xi">xi</code></td>
<td>
<p>numeric value specifying the treatment effect variation (TEV) under
the Bernoulli model, where <code class="reqn">TEV = 2\xi</code>. This argument is ignored if
the <code>model</code> argument is set to <code>"normal"</code>. The default is 0.</p>
</td></tr>
<tr><td><code id="generate_dummy_data_+3A_sigma">sigma</code></td>
<td>
<p>numeric value specifying the treatment effect variation (TEV)
under the normal model, where <code class="reqn">TEV = \sigma</code>. This argument is ignored
if the <code>model</code> argument is set to <code>"Bernoulli"</code>. The default is 0.</p>
</td></tr>
<tr><td><code id="generate_dummy_data_+3A_random_unit">random_unit</code></td>
<td>
<p>character string specifying the randomization unit. It
must be one of <code>"user"</code> (default), <code>"session"</code>, or <code>"pageview"</code>. You can
specify just the initial letter. The default is 0.</p>
</td></tr>
<tr><td><code id="generate_dummy_data_+3A_treatment_ratio">treatment_ratio</code></td>
<td>
<p>numeric value specifying the ratio assigned to
treatment. The default value is 0.5.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame with the columns user_id, group, and metric, where each
row represents a metric value for a page-view.
</p>


<h3>References</h3>


<ul>
<li><p> Deng, A., Lu, J., &amp; Litz, J. (2017). Trustworthy Analysis of Online A/B
Tests: Pitfalls, challenges and solutions. <em>Proceedings of the Tenth ACM
International Conference on Web Search and Data Mining.</em>
<a href="https://doi.org/10.1145/3018661.3018677">doi:10.1145/3018661.3018677</a>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>library(deltatest)

set.seed(314)
generate_dummy_data(n_user = 2000)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
