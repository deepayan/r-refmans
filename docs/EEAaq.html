<!DOCTYPE html><html lang="en"><head><title>Help for package EEAaq</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {EEAaq}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#code_extr'><p>Code_extr</p></a></li>
<li><a href='#EEAaq_export'><p>Export and save an <code>EEAaq_df</code> class object</p></a></li>
<li><a href='#EEAaq_get_data'><p>Download air quality data at european level from the EEA download service</p></a></li>
<li><a href='#EEAaq_get_dataframe'><p>EEAaq_get_dataframe</p></a></li>
<li><a href='#EEAaq_get_stations'><p>Download EEA measurement station information dataset</p></a></li>
<li><a href='#EEAaq_idw_map'><p>Build a spatial interpolation map based on the Inverse Distance Weighting technique.</p></a></li>
<li><a href='#EEAaq_import'><p>Reverse function of <code>EEAaq_export</code>. Reads an <code>EEAaq_df</code> object</p></a></li>
<li><a href='#EEAaq_map_stations'><p>Create a map representing the stations based on the data given in input or</p>
the information specified in the parameters</a></li>
<li><a href='#EEAaq_summary'><p>Generate an <code>EEAaq_df</code> data summary</p></a></li>
<li><a href='#EEAaq_time_aggregate'><p>Time aggregation of an <code>EEAaq_df</code> class object.</p></a></li>
<li><a href='#get_LAU'><p>Get LAU data</p></a></li>
<li><a href='#get_NUTS'><p>Get NUTS</p></a></li>
<li><a href='#get_pollutants'><p>Get pollutant</p></a></li>
<li><a href='#get_stations'><p>Get Station Data</p></a></li>
<li><a href='#handle_dates'><p>Handle Dates based on Dataset Ranges</p></a></li>
<li><a href='#is_EEAaq_df'><p>Check if a given object is an <code>EEAaq_df</code> class object</p></a></li>
<li><a href='#my_summarise'><p>Aggregate data based on a specific statistic</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Handle Air Quality Data from the European Environment Agency
Data Portal</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.0</td>
</tr>
<tr>
<td>Description:</td>
<td>This software downloads and manages air quality data from the European Environmental Agency (EEA) dataflow (<a href="https://www.eea.europa.eu/data-and-maps/data/aqereporting-9">https://www.eea.europa.eu/data-and-maps/data/aqereporting-9</a>).
    See the web page <a href="https://eeadmz1-downloads-webapp.azurewebsites.net/">https://eeadmz1-downloads-webapp.azurewebsites.net/</a> for details on the EEA's Air Quality Download Service.
    The package allows dynamically mapping the stations, summarising and time aggregating the measurements and building spatial interpolation maps.
    See the web page <a href="https://www.eea.europa.eu/en">https://www.eea.europa.eu/en</a> for further information on EEA activities and history.
    Further details, as well as, an extended vignette of the main functions included in the package, are available at the GitHub web page dedicated to the project.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/PaoloMaranzano/EEAaq_R">https://github.com/PaoloMaranzano/EEAaq_R</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>Imports:</td>
<td>arrow, curl, dplyr, ggplot2, ggpubr, gifski, grDevices, gstat,
htmlwidgets, httr, leaflet, lubridate, raster, readr, sf,
stats, tibble, tidyr, utils</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, rvest, readxl, digest, gh, base64enc,
stringr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-02-05 14:43:18 UTC; paulm</td>
</tr>
<tr>
<td>Author:</td>
<td>Paolo Maranzano <a href="https://orcid.org/0000-0002-9228-2759"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre, cph],
  Riccardo Borgoni <a href="https://orcid.org/0000-0002-2520-3512"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cph],
  Samir Doghmi [aut, cph],
  Agostino Tassan Mazzocco [aut, cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Paolo Maranzano &lt;pmaranzano.ricercastatistica@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-02-06 19:30:06 UTC</td>
</tr>
</table>
<hr>
<h2 id='code_extr'>Code_extr</h2><span id='topic+code_extr'></span>

<h3>Description</h3>

<p>This function extracts the numerical value from NUTS-level strings.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>code_extr(level)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="code_extr_+3A_level">level</code></td>
<td>
<p>A character vector representing NUTS-level codes (e.g., <code>c("NUTS2", "NUTS3")</code>).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A sorted numeric vector containing the extracted NUTS levels.
</p>

<hr>
<h2 id='EEAaq_export'>Export and save an <code>EEAaq_df</code> class object</h2><span id='topic+EEAaq_export'></span>

<h3>Description</h3>

<p><code>EEAaq_export</code> saves an <code>EEAaq_df</code> class object as a <em>.csv</em> or a <em>.txt</em> file,
and exports the associated shapefile as well.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>EEAaq_export(data, filepath, format, shape = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="EEAaq_export_+3A_data">data</code></td>
<td>
<p>an <code>EEAaq_df</code> class object.</p>
</td></tr>
<tr><td><code id="EEAaq_export_+3A_filepath">filepath</code></td>
<td>
<p>character string giving the file path</p>
</td></tr>
<tr><td><code id="EEAaq_export_+3A_format">format</code></td>
<td>
<p>character string giving the format of the file. It must be one of 'csv' and 'txt'.</p>
</td></tr>
<tr><td><code id="EEAaq_export_+3A_shape">shape</code></td>
<td>
<p>logical value (T or F). If <code>TRUE</code> the shapefile associated to the <code>EEAaq_df</code> object
given in input is saved in the same directory specified in <code>filepath</code>. If <code>FALSE</code> (the default),
only the data frame containing the data is saved.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#Download a dataset with the function EEAaq_get_data, which generate an EEAaq_df object.
data &lt;- EEAaq_get_data(zone_name = "15146", NUTS_level = "LAU",
                       LAU_ISO = "IT", pollutants = "PM10",
                       from = "2023-01-01", to = "2023-05-31")
temp &lt;- tempdir()
filepath &lt;- paste0(temp, "/data.csv")
EEAaq_export(data = data, filepath = filepath, format = "csv", shape = TRUE)

</code></pre>

<hr>
<h2 id='EEAaq_get_data'>Download air quality data at european level from the EEA download service</h2><span id='topic+EEAaq_get_data'></span>

<h3>Description</h3>

<p>This function imports air quality datasets at european level, based on the zone, time and pollutant specifications.
This function generates an <code>EEAaq_df</code> object, or an <code>EEAaq_df_sfc</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>EEAaq_get_data(
  zone_name = NULL,
  NUTS_level = NULL,
  LAU_ISO = NULL,
  pollutants = NULL,
  from = NULL,
  to = NULL,
  quadrant = NULL,
  polygon = NULL,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="EEAaq_get_data_+3A_zone_name">zone_name</code></td>
<td>
<p>character vector specifying the names of the zones to consider. The reference is the NUTS and LAU nomenclature by Eurostat.
See <em>Details</em>.</p>
</td></tr>
<tr><td><code id="EEAaq_get_data_+3A_nuts_level">NUTS_level</code></td>
<td>
<p>character that specify the level of NUTS or LAU, to which <code>zone_name</code> belongs.
Allowed values are 'NUTS0', 'NUTS1', 'NUTS2', 'NUTS3', 'LAU'.
For further information see <em>Details</em>.</p>
</td></tr>
<tr><td><code id="EEAaq_get_data_+3A_lau_iso">LAU_ISO</code></td>
<td>
<p>a code to identify the corresponding ISO of the country since LAU_ID are not unique over Europe</p>
</td></tr>
<tr><td><code id="EEAaq_get_data_+3A_pollutants">pollutants</code></td>
<td>
<p>the pollutants for which to download data. It may be:
</p>

<ul>
<li><p>character vector representing the short names of the pollutants to analyse. The reference is the
variable <code>Notation</code> in the dataset <code>pollutants</code> provided by this package.
</p>
</li>
<li><p>numeric vector representing the codes of the pollutants to analyse. The reference is the variable <code>Code</code>
in the dataset <code>pollutants</code> provided by this package.
</p>
</li></ul>
</td></tr>
<tr><td><code id="EEAaq_get_data_+3A_from">from</code></td>
<td>
<p>the starting point of the time window to consider.
It may be:
</p>

<ul>
<li><p>character containing a specific day of the year in the format <code>yyyy-mm-dd</code>
</p>
</li></ul>
</td></tr>
<tr><td><code id="EEAaq_get_data_+3A_to">to</code></td>
<td>
<p>the ending point of the time window to consider.
It may be:
</p>

<ul>
<li><p>character containing a specific day of the year in the format <code>yyyy-mm-dd</code>
</p>
</li></ul>

<p>ID logic value (T or F). If <code>TRUE</code> (the default), the character specified in the parameter <code>zone_name</code>
is the unique identifier code provided by Eurostat. The reference is the <code>NUTS_ID</code>  column from the
<code>NUTS</code> dataset or the <code>LAU_ID</code> from the <code>LAU</code> dataset.
Also, in the case of using <code>LATN_NAME</code> from the <code>NUTS</code> dataset or <code>LAU_NAME</code> from the <code>LAU</code> dataset, TRUE must be specified.
If <code>FALSE</code> , it is used when <code>polygon</code> or <code>quadrant</code> are not null.</p>
</td></tr>
<tr><td><code id="EEAaq_get_data_+3A_quadrant">quadrant</code></td>
<td>
<p>a list of bidimensional numeric vectors containing the coordinates in <b>WGS84</b> format.
If the list has two elements, the function builds a square using the two coordinates as
opposite extremes. If the list contains three or more elements, every point is a vertex of a
polygon, in particular the convex hull of the specified points.</p>
</td></tr>
<tr><td><code id="EEAaq_get_data_+3A_polygon">polygon</code></td>
<td>
<p>A <code>sfc_POLYGON</code> or <code>sfc_MULTIPOLYGON</code> class object
The polygon can be imported via shapefile or other formats from the user.</p>
</td></tr>
<tr><td><code id="EEAaq_get_data_+3A_verbose">verbose</code></td>
<td>
<p>logic value (T or F). If <code>TRUE</code> (the default) information about
the function progress are printed. If <code>FALSE</code> no message is printed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Some specific notes:
</p>

<ul>
<li><p>If the parameter <code>zone_name</code> corresponds to a valid <code>CITY_NAME</code> (i.e., not NULL in the dataset), the function will return the corresponding data. If no valid <code>CITY_NAME</code> is associated with the <code>zone_name</code>, the function attempts to retrieve all available data for the entire country and subsequently filter for the specified zone_name.
</p>
</li>
<li><p>For very small towns or certain countries, such as Turkey or Albania, data may not currently be available in the dataset. This limitation reflects the data unavailability at the the EEA Air Quality Viewer <a href="https://discomap.eea.europa.eu/App/AQViewer/index.html?fqn=Airquality_Dissem.b2g.AirQualityStatistics">https://discomap.eea.europa.eu/App/AQViewer/index.html?fqn=Airquality_Dissem.b2g.AirQualityStatistics</a>.
</p>
</li>
<li><p>If the parameters used in the query include <code>polygon</code> or <code>quadrant</code>, the function returns a <code>EEAaq_df_sfc</code> object. Otherwise, it returns an <code>EEAaq_df</code> object, which is a tibble dataframe.
</p>
</li></ul>

<p>The NUTS classification (Nomenclature of territorial units for statistics) is a hierarchical system for dividing up the economic territory of the EU and the UK.
The levels are defined as in <a href="https://ec.europa.eu/eurostat/web/gisco/geodata/statistical-units/territorial-units-statistics">https://ec.europa.eu/eurostat/web/gisco/geodata/statistical-units/territorial-units-statistics</a>, that is,
</p>

<ul>
<li><p><strong>NUTS 0</strong>: the whole country
</p>
</li>
<li><p><strong>NUTS 1</strong>: major socio-economic regions
</p>
</li>
<li><p><strong>NUTS 2</strong>: basic regions for the application of regional policies
</p>
</li>
<li><p><strong>NUTS 3</strong>: small regions for specific diagnoses
</p>
</li></ul>



<h3>Value</h3>

<p>A data frame of class <code>EEAaq_df</code>, if <code>zone_name</code> is specified, and of class <code>EEAaq_df_sfc</code>
if whether the parameter <code>quadrant</code> or <code>polygon</code> is specified.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Download hourly NO2 concentration for Milan city (LAU = 15146) in 2023
data &lt;- EEAaq_get_data(zone_name = "15146", NUTS_level = "LAU",LAU_ISO = "IT",
pollutants = c("NO2","CO"), from = "2023-01-01", to = "2023-12-31",  verbose = TRUE)

</code></pre>

<hr>
<h2 id='EEAaq_get_dataframe'>EEAaq_get_dataframe</h2><span id='topic+EEAaq_get_dataframe'></span>

<h3>Description</h3>

<p>Retrieve one of the metadata (i.e., LAU, NUTS, stations, or pollutant) tables from the EEA
dataflow. This function downloads and loads one dataset at a time from a predefined list of available datasets.
Ensure that the dataset name is written correctly. See details for further details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>EEAaq_get_dataframe(dataframe = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="EEAaq_get_dataframe_+3A_dataframe">dataframe</code></td>
<td>
<p>name of the <code>data.frame</code> to retrieve. Select among:
</p>

<ul>
<li><p>'LAU': <code>data.frame</code> containing metadata information on all the local administrative units (i.e., municipalities) in Europe according to the NUTS nomenclature by Eurostat.
Information includes geometries.
</p>
</li>
<li><p>'NUTS: <code>data.frame</code> containing metadata information on all the major socio-economic regions in Europe according to the NUTS nomenclature by Eurostat.
Information includes geometries.
</p>
</li>
<li><p>'stations': <code>data.frame</code> containing metadata information on all the monitoring stations maintained (both currencly active and de-activated) by the EEA and available in <code>EEAaq</code>.
Information include: unique identifiers, extended descriptions, and technical details on operations and data collected.
</p>
</li>
<li><p>'pollutant': <code>data.frame</code> containing metadata information on all the available pollutants monitored by the EEA and available in <code>EEAaq</code>.
Information include: unique identifiers, extended descriptions, and unit of measure.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>The function retrieves from the EEAaq GitHub folder one of the following metadata:
since 2024, the data EEA air quality retrieving dataflow is undergoing a major re-organization. In particular, since January 2025, raw data are accessible only through an online platform/dashboard. While <code>EEAaq</code> is build to
explicitly deal with the automatic and constantly-updated system for raw data, the same process is not always possible for the metadata.
Indeed, most of the metadata information are updated and require relevant pre-processing (i.e., data manipulation and cleaning) steps to make them consistent with the main database on pollutants concentrations.
For this reasons, all the metadata files are periodically pre-processed and updated by the package maintainers. For issues with the data or code, please contact the development team at <a href="mailto:pmaranzano.ricercastatistica@gmail.com">pmaranzano.ricercastatistica@gmail.com</a>
</p>


<h3>Value</h3>

<p>a dataframe
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
LAU &lt;- EEAaq_get_dataframe(dataframe= "LAU")


</code></pre>

<hr>
<h2 id='EEAaq_get_stations'>Download EEA measurement station information dataset</h2><span id='topic+EEAaq_get_stations'></span>

<h3>Description</h3>

<p>Download the updated dataset from EEA, containing measurement station information. For further information about the variables
see <code>stations</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>EEAaq_get_stations(byStation = FALSE, complete = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="EEAaq_get_stations_+3A_bystation">byStation</code></td>
<td>
<p>Logic value (T or F). If <code>TRUE</code> the dataset is organized by station (one row for each measurement station).
If <code>FALSE</code> the dataset is organized by sampling point. Each station have multiple sampling points.</p>
</td></tr>
<tr><td><code id="EEAaq_get_stations_+3A_complete">complete</code></td>
<td>
<p>Logic value (T or F). If <code>TRUE</code>, the dataset contains all the variables given by the EEA.
If <code>FALSE</code> the dataset contains only a few variables, the most importants. For further details about the variables, see <code>stations</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note that, for very small towns or certain countries, such as Turkey or Albania, data may not currently be available in the dataset. This limitation reflects the data unavailability at the the EEA Air Quality Viewer <a href="https://discomap.eea.europa.eu/App/AQViewer/index.html?fqn=Airquality_Dissem.b2g.AirQualityStatistics">https://discomap.eea.europa.eu/App/AQViewer/index.html?fqn=Airquality_Dissem.b2g.AirQualityStatistics</a>.
</p>


<h3>Value</h3>

<p>A tibble containing the stations information. Further details available here <code>stations</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
EEAaq_get_stations(byStation = FALSE, complete = TRUE)

</code></pre>

<hr>
<h2 id='EEAaq_idw_map'>Build a spatial interpolation map based on the Inverse Distance Weighting technique.</h2><span id='topic+EEAaq_idw_map'></span>

<h3>Description</h3>

<p><code>EEAaq_idw_map</code> recieves as input a <code>EEAaq_taggr_df</code> or a <code>EEAaq_taggr_df_sfc</code> class object and produces a
spatial interpolation map. Depending on the time frequency of the aggregation, multiple maps are generated, one for
each timestamp.
It may be exported as pdf, jpeg, png, gif and html.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>EEAaq_idw_map(
  data = NULL,
  pollutant = NULL,
  aggr_fun,
  bounds_level = NULL,
  distinct = FALSE,
  gradient = TRUE,
  idp = 2,
  nmax = NULL,
  maxdist = NULL,
  dynamic = FALSE,
  fill_NUTS_level = NULL,
  tile = "Esri.WorldGrayCanvas",
  save = NULL,
  filepath = NULL,
  width = 1280,
  height = 720,
  res = 144,
  delay = 1,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="EEAaq_idw_map_+3A_data">data</code></td>
<td>
<p>an object of class <code>EEAaq_taggr_df</code> or <code>EEAaq_taggr_df_sfc</code>, which is the
output of the <code><a href="#topic+EEAaq_time_aggregate">EEAaq_time_aggregate</a></code> function.</p>
</td></tr>
<tr><td><code id="EEAaq_idw_map_+3A_pollutant">pollutant</code></td>
<td>
<p>vector containing the pollutant for which to build the map. It must be one of the pollutants
contained in <code>data</code>.</p>
</td></tr>
<tr><td><code id="EEAaq_idw_map_+3A_aggr_fun">aggr_fun</code></td>
<td>
<p>charachter containing the aggregation function to use for computing the interpolation. It must
be one of the statistics contained in <code>data</code>.</p>
</td></tr>
<tr><td><code id="EEAaq_idw_map_+3A_bounds_level">bounds_level</code></td>
<td>
<p>character containing the NUTS level or LAU for which draw internal boundaries.
Admissible values are 'NUTS0', 'NUTS1', 'NUTS2', 'NUTS3', 'LAU'.</p>
</td></tr>
<tr><td><code id="EEAaq_idw_map_+3A_distinct">distinct</code></td>
<td>
<p>logic value (T or F). If <code>TRUE</code>, each map generated is printed and saved in distinct pages
(for instance if <code>data</code> has a monthly frequency in a yearly time window, 12 distinct plots are generated).
If <code>FALSE</code> (the default), the maps are printed in a single page.</p>
</td></tr>
<tr><td><code id="EEAaq_idw_map_+3A_gradient">gradient</code></td>
<td>
<p>logic value (T or F). If <code>TRUE</code> (the default) the maps generated are colored with a
continuous color scale. If <code>FALSE</code>, the color scale is discrete.</p>
</td></tr>
<tr><td><code id="EEAaq_idw_map_+3A_idp">idp</code></td>
<td>
<p>numeric value that specify the inverse distance weighting power. For further information see
<code><a href="gstat.html#topic+idw">idw</a></code>.</p>
</td></tr>
<tr><td><code id="EEAaq_idw_map_+3A_nmax">nmax</code></td>
<td>
<p>numeric value; specify the number of nearest observations that should be
used for the inverse distance weighting computing, where nearest is defined in terms of the
space of the spatial locations. By default, all observations are used. For further information see
<code><a href="gstat.html#topic+idw">idw</a></code></p>
</td></tr>
<tr><td><code id="EEAaq_idw_map_+3A_maxdist">maxdist</code></td>
<td>
<p>numeric value; only observations within a distance of <code>maxdist</code> from the prediction location
are used for the idw computation. By default, all observations are used.
If combined with <code>nmax</code>, both criteria apply.</p>
</td></tr>
<tr><td><code id="EEAaq_idw_map_+3A_dynamic">dynamic</code></td>
<td>
<p>logic value (T or F). If <code>TRUE</code> the function creates a Leaflet map widget using
<b>htmlwidgets</b> (for further information see <code><a href="leaflet.html#topic+leaflet">leaflet</a></code>). If <code>FALSE</code> (the default)
the maps generated are static.</p>
</td></tr>
<tr><td><code id="EEAaq_idw_map_+3A_fill_nuts_level">fill_NUTS_level</code></td>
<td>
<p>character containing the NUTS level or LAU for which to aggregate the idw computing,
in order to obtain a uniform coloring inside each area at the specified level.
(For instance if <code>fill_NUTS_level = "LAU"</code>, each municipality is filled by the mean value of the pollutant
concentration, computed by the idw, of each pixel inside the respective municipality). Allowed values are
'NUTS0', 'NUTS1', 'NUTS2', 'NUTS3', 'LAU'.</p>
</td></tr>
<tr><td><code id="EEAaq_idw_map_+3A_tile">tile</code></td>
<td>
<p>character representing the name of the provider tile. To see the full list of the providers, run
<code><a href="leaflet.html#topic+providers">providers</a></code>. For further information see <code><a href="leaflet.html#topic+addProviderTiles">addProviderTiles</a></code>.</p>
</td></tr>
<tr><td><code id="EEAaq_idw_map_+3A_save">save</code></td>
<td>
<p>character representing in which extension to save the map. Allowed values are 'jpeg', 'png', 'pdf'
(if <code>dynamic = FALSE</code>), 'gif' (if <code>dynamic = FALSE &amp; distinct = TRUE</code>), 'html' (if <code>dynamic = TRUE</code>).</p>
</td></tr>
<tr><td><code id="EEAaq_idw_map_+3A_filepath">filepath</code></td>
<td>
<p>a character string giving the file path.</p>
</td></tr>
<tr><td><code id="EEAaq_idw_map_+3A_width">width</code>, <code id="EEAaq_idw_map_+3A_height">height</code></td>
<td>
<p>the width and the height of the plot, expressed in pixels (by default <code>width = 1280, height = 720</code>).
This parameters are available only for <code>save</code> 'jpeg', 'png' and 'gif'.
For further information see <code><a href="grDevices.html#topic+png">png</a></code> or <code><a href="grDevices.html#topic+jpeg">jpeg</a></code>.</p>
</td></tr>
<tr><td><code id="EEAaq_idw_map_+3A_res">res</code></td>
<td>
<p>the nominal resolution in ppi which will be recorded in the bitmap file, if a positive integer
(by default <code>res = 144</code>). This parameter is available only for <code>save</code> 'jpeg', 'png'.
For further information see <code><a href="grDevices.html#topic+png">png</a></code> or <code><a href="grDevices.html#topic+jpeg">jpeg</a></code>.</p>
</td></tr>
<tr><td><code id="EEAaq_idw_map_+3A_delay">delay</code></td>
<td>
<p>numeric value specifying the time to show each image in seconds, when <code>save = "gif"</code>.</p>
</td></tr>
<tr><td><code id="EEAaq_idw_map_+3A_verbose">verbose</code></td>
<td>
<p>logic value (T or F). If <code>TRUE</code> (the default) information about the function progress are printed.
If <code>FALSE</code> no message is printed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>EEAaq_idw_map</code> create a spatial interpolation map, based on the Inverse Distance Weighting method (Shepard 1968).
This method starts from the available georeferenced data and estimates the value of the variable in the points
where it's unknown as a weighted average of the known values, where weights are given by an inverse function of the
distance of every point from the fixed stations.
The greater the distance of a point from a station, the smaller the weight assigned to the values of the respective
station for the computing of that unknown point.
Given the sampling plan <code class="reqn">s_{i}</code> for <code class="reqn">i=1,...,n</code>, which represent the location of the air quality stations,
the pollutant concentration value <code class="reqn">Y(s_i)=Y_i</code> represents the value of the pollutant concentration detected
by the site <code class="reqn">s_i</code> and <code class="reqn">u</code> is the point for which the value of the concentration in unknown.
</p>
<p style="text-align: center;"><code class="reqn">\hat{Y}(u) = \sum_{i=1}^{n} Y_i \omega_i(u), </code>
</p>
<p> where
</p>
<p style="text-align: center;"><code class="reqn">\omega_i(u) = \frac{g(d(s_i,u))}{\sum_{i=1}^{n}g(d(s_i,u))} </code>
</p>

<p>represent the weights assigned to each location <code class="reqn">s_i</code> and <code class="reqn">d(s_i,u)</code> is the distance between <code class="reqn">u</code>
and <code class="reqn">s_i</code>.
</p>


<h3>Value</h3>

<p>cosa restituisce la funzione
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Download daily NO2 data in 2023 for Milan city (LAU)
data &lt;- EEAaq_get_data(zone_name = "15146", NUTS_level = "LAU",LAU_ISO = "IT",
pollutants = "NO2", from = "2023-01-01", to = "2023-12-31",  verbose = TRUE)
# Monthly aggregation
t_aggr &lt;- EEAaq_time_aggregate(data = data, frequency = "monthly",
aggr_fun = c("mean", "min", "max"))

# One map created
EEAaq_idw_map(data = t_aggr, pollutant = "NO2", aggr_fun = "mean",
distinct = TRUE, gradient = FALSE, dynamic = TRUE, fill_NUTS_level = "LAU")


# Let's try to change the parameters fill_NUTS_level and dynamic:
# now we are going to use a dataset containing PM10 concentrations
# in Milan province (NUTS 3), during 2023
data &lt;- EEAaq_get_data(zone_name = "Centro (IT)", NUTS_level = "NUTS1",
pollutant = "PM10", from = "2023-01-01", to = "2023-12-31")
# Yearly aggregation
t_aggr &lt;- EEAaq_time_aggregate(data = data, frequency = "yearly", aggr_fun = "mean")

# Let us generate one dynamic map, containing the municipalities inside the Milan province
# filled with the mean concentration value for 2023, computed via IDW:
EEAaq_idw_map(data = t_aggr, pollutant = "PM10", aggr_fun = "mean",
distinct = TRUE, gradient = FALSE, dynamic = TRUE, fill_NUTS_level = "NUTS3")

## End(Not run)

</code></pre>

<hr>
<h2 id='EEAaq_import'>Reverse function of <code>EEAaq_export</code>. Reads an <code>EEAaq_df</code> object</h2><span id='topic+EEAaq_import'></span>

<h3>Description</h3>

<p>Given the file containing the data saved with <code><a href="#topic+EEAaq_export">EEAaq_export</a></code>, and the
associated shapefile, <code>EEAaq_read</code> imports the <code>EEAaq_df</code> class object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>EEAaq_import(file_data, file_shape)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="EEAaq_import_+3A_file_data">file_data</code></td>
<td>
<p>file path of the 'csv' or 'txt' file containing the air quality data
to import.</p>
</td></tr>
<tr><td><code id="EEAaq_import_+3A_file_shape">file_shape</code></td>
<td>
<p>file path of the shapefile associated to the dataset used in <code>file_data</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#Download a dataset with the function EEAaq_get_data, which generate an EEAaq_df object.
data &lt;- EEAaq_get_data(zone_name = "15146", NUTS_level = "LAU",LAU_ISO = "IT",
pollutants = "PM10", from = "2023-01-01", to = "2023-05-31",  verbose = TRUE)

temp &lt;- tempdir()
filepath &lt;- paste0(temp, "/data.csv")
#Export the dataset and the associated shape
EEAaq_export(data = data, filepath = filepath, format = "csv", shape = TRUE)
#Import the EEAaq_df object saved in the previous code line
EEAaq_import(file_data = filepath, file_shape = paste0(temp, "/data.shp"))

</code></pre>

<hr>
<h2 id='EEAaq_map_stations'>Create a map representing the stations based on the data given in input or
the information specified in the parameters</h2><span id='topic+EEAaq_map_stations'></span>

<h3>Description</h3>

<p>Build static or dynamic maps, representing the location of the stations that detects the specified pollutants.
It recieves in input an <code>EEAaq_df</code> or an <code>EEAaq_df_sfc</code> class object, or, alternatively, it's possible to specify
the required zones and pollutants with the same nomenclature system of the <code><a href="#topic+EEAaq_get_data">EEAaq_get_data</a></code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>EEAaq_map_stations(
  data = NULL,
  pollutant = NULL,
  zone_name = NULL,
  NUTS_level = NULL,
  ID = FALSE,
  bounds_level = NULL,
  color = TRUE,
  dynamic = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="EEAaq_map_stations_+3A_data">data</code></td>
<td>
<p>an <code>EEAaq_df</code> or <code>EEAaq_df_sfc</code> class object, which is the output of the <code><a href="#topic+EEAaq_get_data">EEAaq_get_data</a></code> function.</p>
</td></tr>
<tr><td><code id="EEAaq_map_stations_+3A_pollutant">pollutant</code></td>
<td>
<p>character vector containing the short names of the pollutants for which locate the stations.</p>
</td></tr>
<tr><td><code id="EEAaq_map_stations_+3A_zone_name">zone_name</code></td>
<td>
<p>character vector specifying the names of the zones to consider.
The reference is the NUTS and LAU nomnclature by Eurostat.</p>
</td></tr>
<tr><td><code id="EEAaq_map_stations_+3A_nuts_level">NUTS_level</code></td>
<td>
<p>chracter that specify the level of NUTS or LAU, to which the <code>zone_name</code> belongs.</p>
</td></tr>
<tr><td><code id="EEAaq_map_stations_+3A_id">ID</code></td>
<td>
<p>logic value (T or F). If <code>TRUE</code> the character specified in the parameter
zone_name is the unique identifier code provided by Eurostat. If <code>FALSE</code> (the default) it indicates that
was specified the full name in latin characters.</p>
</td></tr>
<tr><td><code id="EEAaq_map_stations_+3A_bounds_level">bounds_level</code></td>
<td>
<p>character containing the NUTS level or LAU for which draw internal boundaries.
Admissible values are &quot;NUTS0&quot;, &quot;NUTS1&quot;, &quot;NUTS2&quot;, &quot;NUTS3&quot;, &quot;LAU&quot; and it must be of a lower level then
the one specified in the parameter <code>NUTS_level</code>.</p>
</td></tr>
<tr><td><code id="EEAaq_map_stations_+3A_color">color</code></td>
<td>
<p>logical value (T or F). If <code>TRUE</code> (the default) the points are colored based on the pollutant they are
able to detect. If <code>FALSE</code> the points have the same color.</p>
</td></tr>
<tr><td><code id="EEAaq_map_stations_+3A_dynamic">dynamic</code></td>
<td>
<p>logical value (T or F). If <code>TRUE</code> the map is interactive and dynamic. If <code>FALSE</code> (the default) the map is static.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A map representing the specified area and the points representing the location of the stations able to detect
the specified pollutants.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Using as example PM data in Lombardia (Italy) during the whole 2022,
# it's possible to map the stations in two ways.
# First of all specifying the zone information:
EEAaq_map_stations(pollutant = c("PM10", "PM2.5"),
zone_name = "Lombardia",NUTS_level = "NUTS2", ID = FALSE, color = FALSE)
#In this case each point have the same color.

# Alternatively, it is possible to use the data already downloaded in the parameter data,
# coloring the points based on the pollutants the respective station detects.
data &lt;- EEAaq_get_data(zone_name = "15146", NUTS_level = "LAU",LAU_ISO = "IT",
pollutants = "PM10", from = "2023-01-01", to = "2023-05-31",  verbose = TRUE)
EEAaq_map_stations(data = data, color = TRUE)


</code></pre>

<hr>
<h2 id='EEAaq_summary'>Generate an <code>EEAaq_df</code> data summary</h2><span id='topic+EEAaq_summary'></span>

<h3>Description</h3>

<p>This function, applied to an <code>EEAaq_df</code> or <code>EEAaq_df_sfc</code> class object, produces a list of data frames,
containing relevant information about the data, such as descriptive statistics, missing values statistics,
gap length and correlation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>EEAaq_summary(data = NULL, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="EEAaq_summary_+3A_data">data</code></td>
<td>
<p>an <code>EEAaq_df</code> or <code>EEAaq_df_sfc</code> class object, which is the output of the <code><a href="#topic+EEAaq_get_data">EEAaq_get_data</a></code> function.</p>
</td></tr>
<tr><td><code id="EEAaq_summary_+3A_verbose">verbose</code></td>
<td>
<p>logic value (T or F). If <code>TRUE</code> (the default) messages about the function progress are printed.
If <code>FALSE</code> no message is printed.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The function <code>EEAaq_summary</code> computes and return a list of summary statistics of the dataset given in
<code>data</code>. In particular the elements of the list are:
</p>

<ul>
<li><p><code>Summary</code> global missing count, missing rate, negative count, minimum, maximum,
mean and standard deviation, organized by pollutant.
</p>
</li>
<li><p><code>Summary_byStat</code> list of data frames, one for each different station, containing
the descriptive statistics (missing count, missing rate, negative count, minimum, maximum,
mean and standard deviation), organized by station.
</p>
</li>
<li><p><code>gap_length</code> one data frame for each pollutant, containing the gap length organized by station.
</p>
</li>
<li><p><code>Corr_Matrix</code> if <code>data</code> contains more than one pollutant, the correlation matrix between
pollutans is provided, organised by station.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
data &lt;- EEAaq_get_data(zone_name = "15146", NUTS_level = "LAU",LAU_ISO = "IT",
pollutants = "PM10", from = "2023-01-01", to = "2023-05-31",  verbose = TRUE)

EEAaq_summary(data)

</code></pre>

<hr>
<h2 id='EEAaq_time_aggregate'>Time aggregation of an <code>EEAaq_df</code> class object.</h2><span id='topic+EEAaq_time_aggregate'></span>

<h3>Description</h3>

<p><code>EEAaq_time_aggregate</code> compute a time aggregation of an <code>EEAaq_df</code> or <code>EEAaq_df_sfc</code> class object,
based on the specified <code>frequency</code> and the aggregation functions <code>aggr_fun</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>EEAaq_time_aggregate(
  data = NULL,
  frequency = "monthly",
  aggr_fun = c("mean", "min", "max")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="EEAaq_time_aggregate_+3A_data">data</code></td>
<td>
<p>an <code>EEAaq_df</code> or <code>EEAaq_df_sfc</code> class object, which is the output of the <code><a href="#topic+EEAaq_get_data">EEAaq_get_data</a></code> function.</p>
</td></tr>
<tr><td><code id="EEAaq_time_aggregate_+3A_frequency">frequency</code></td>
<td>
<p>vector containing the time frequency for which to aggregate the <code>data</code> object.
Admissible values are 'yearly', 'monthly', 'weekly', 'daily' 'hourly'.</p>
</td></tr>
<tr><td><code id="EEAaq_time_aggregate_+3A_aggr_fun">aggr_fun</code></td>
<td>
<p>character vector containing one or more agregation functions. Admissible values are 'mean', 'median',
'min', 'max', 'sd', 'var',
'quantile_pp' (where pp is a number in the range [0,1], representing the required percentile).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>EEAaq_taggr_df</code> or a <code>EEAaq_taggr_df_sfc</code> class object, which is a tibble containing the
required time aggregation.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data &lt;- EEAaq_get_data(zone_name = "15146", NUTS_level = "LAU",LAU_ISO = "IT", pollutants = "PM10",
from = "2023-01-01", to = "2023-12-31",  verbose = TRUE)
EEAaq_time_aggregate(data = data, frequency = "monthly", aggr_fun = c("mean", "min", "max"))
EEAaq_time_aggregate(data = data, frequency = "yearly", aggr_fun = "mean")


</code></pre>

<hr>
<h2 id='get_LAU'>Get LAU data</h2><span id='topic+get_LAU'></span>

<h3>Description</h3>

<p>Local Administrative Units (LAUs) are the building blocks of the NUTS classification and correspond to the municipalities and communes within the EU
To get the final dataframe we combine two dataset: one taken from Eurostat (https://ec.europa.eu/eurostat/web/nuts/local-administrative-units)that includes City names and City IDs, essential for querying and associations.
The other one taken from EEA which provides LAU information. The Latter dataset is updated automatically by selecting the most recent shapefile (SHP) available online.
While The Eurostat dataset URL needs to be manually updated with the latest download link to ensure the City-related data is current.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_LAU(year = "Null")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_LAU_+3A_year">year</code></td>
<td>
<p>expressed as four digit (YYYY)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble containing  LAUs  information with selected columns (e.g., ISO, LAU_ID, NUTS3_ID  and geometry ).
</p>

<hr>
<h2 id='get_NUTS'>Get NUTS</h2><span id='topic+get_NUTS'></span>

<h3>Description</h3>

<p>It automatically updates the dataset by identifying the most recent available file, accessing the corresponding page, and downloading the SHP file  at the 1:20 Million scale with the EPSG:4326 reference system from this website (https://gisco-services.ec.europa.eu/distribution/v2/nuts/)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_NUTS(year = "Null")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_NUTS_+3A_year">year</code></td>
<td>
<p>expressed as four digit (YYYY)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble containing  LAUs  information with selected columns (NUTS_ID, LEVL_CODE...)
</p>

<hr>
<h2 id='get_pollutants'>Get pollutant</h2><span id='topic+get_pollutants'></span>

<h3>Description</h3>

<p>Retrieve Pollutant Data from EEA Vocabulary (https://dd.eionet.europa.eu/vocabulary/aq/pollutant)
Downloads and processes pollutant data from the EEA (European Environment Agency) vocabulary database.
The data includes relevant information such as pollutant names, codes, and descriptions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_pollutants()
</code></pre>


<h3>Value</h3>

<p>A tibble containing pollutant information with selected columns (e.g., URI, notation, and extracted code).
</p>

<hr>
<h2 id='get_stations'>Get Station Data</h2><span id='topic+get_stations'></span>

<h3>Description</h3>

<p>This function downloads detailed information for each SamplingPointId. It performs a spatial join to merge the spatial information of LAU and NUTS (specifically, the geometries of LAU and the geometry of stations) and fills in the missing data for CITY_NAME and CITY_ID (retrieved from https://discomap.eea.europa.eu/App/AQViewer/index.html?fqn=Airquality_Dissem.b2g.AirQualityStatistics) through a left join based on the AirQualityStationEoICode column. These values are essential for querying the endpoint.
The missing_cities file was obtained manually (from 2000 to 2024) because the website did not allow downloading more than 100,000 rows at a time. The data was collected in multiple batches, filtering SamplingPoints using the following criteria:
</p>

<ul>
<li><p> Filter on data used in AQ Report: yes
</p>
</li>
<li><p> Filter on data coverage: yes
For each station, the column AirQualityStationEoICode (identical for all sensors at the same station) was used to select the first row containing unique values for CITY_NAME and CITY_ID. No station reported more than one value for this pair of columns.
To support future uploads, it is necessary to integrate updated AirQualityStationEoICode values.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>get_stations()
</code></pre>


<h3>Value</h3>

<p>a tibble
</p>

<hr>
<h2 id='handle_dates'>Handle Dates based on Dataset Ranges</h2><span id='topic+handle_dates'></span>

<h3>Description</h3>

<p>This function handles dates based on the respective dataset. According to the documentation:
</p>

<ul>
<li><p> Data from 2024 onwards corresponds to Unverified data transmitted continuously (Up-To-Date/UTD/E2a).
</p>
</li>
<li><p> Data from 2013 to the begin of 2023 corresponds to Verified data (E1a) reported by countries by 30 September each year for the previous year.
</p>
</li>
<li><p> Data delivered before 2012 corresponds to Historical Airbase data.
The range for E1 is extended until 31/12/2023 because the observations are already validated, and no data for 2023 is retrieved when considering E2.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>handle_dates(from, to)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="handle_dates_+3A_from">from</code></td>
<td>
<p>StartDate (in &quot;YYYY-MM-DD&quot; format).</p>
</td></tr>
<tr><td><code id="handle_dates_+3A_to">to</code></td>
<td>
<p>EndDate (in &quot;YYYY-MM-DD&quot; format).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of datasets with associated date ranges and descriptions.
</p>

<hr>
<h2 id='is_EEAaq_df'>Check if a given object is an <code>EEAaq_df</code> class object</h2><span id='topic+is_EEAaq_df'></span>

<h3>Description</h3>

<p>Given an object as input, <code>is_EEAaq_df</code> verify that the given object belongs
to the <code>EEAaq_df</code> class.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_EEAaq_df(data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="is_EEAaq_df_+3A_data">data</code></td>
<td>
<p>the object for which verify the if it belongs to the <code>EEAaq_df</code> class.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>logical value (T ot F). If <code>TRUE</code> the object given in input is an <code>EEAaq_df</code> object.
If <code>FALSE</code> the object doesn't belong to the <code>EEAaq_df</code> class.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#Download a dataset with the function EEAaq_get_data, which generate an EEAaq_df object.
data &lt;- EEAaq_get_data(zone_name = "15146", NUTS_level = "LAU",LAU_ISO = "IT",
pollutants = "PM10", from = "2023-01-01", to = "2024-08-29",  verbose = TRUE)

#Check if the imported object belongs to the EEAaq_df class
is_EEAaq_df(data = data)

</code></pre>

<hr>
<h2 id='my_summarise'>Aggregate data based on a specific statistic</h2><span id='topic+my_summarise'></span>

<h3>Description</h3>

<p>Given data and the aggregation function desired, this function compute a time aggregation of the data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>my_summarise(data, fun_aggr)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="my_summarise_+3A_data">data</code></td>
<td>
<p>An <code>EEAaq_df</code> or <code>EEAaq_df_sfc</code> class object, which is the output of the
<code><a href="#topic+EEAaq_get_data">EEAaq_get_data</a></code> function.</p>
</td></tr>
<tr><td><code id="my_summarise_+3A_fun_aggr">fun_aggr</code></td>
<td>
<p>Vector character containing the aggregation function for which to time aggregate.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble with the required aggregation.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
