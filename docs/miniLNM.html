<!DOCTYPE html><html lang="en"><head><title>Help for package miniLNM</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {miniLNM}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#ansi_aware_handler'><p>Pretty Printing</p></a></li>
<li><a href='#beta_mean'><p>LNM Posterior Mean</p></a></li>
<li><a href='#beta_samples'><p>LNM Posterior Samples</p></a></li>
<li><a href='#lnm'><p>Fit a logistic normal multinomial model using R's formula interface.</p></a></li>
<li><a href='#lnm_data'><p>Simulates data from a Logistic Normal Multinomial Model.</p></a></li>
<li><a href='#lnm-class'><p>S4 Class for a Logistic Normal Multinomial Model</p></a></li>
<li><a href='#phi_inverse'><p>Inverse log ratio transformation</p></a></li>
<li><a href='#predict+2Clnm-method'><p>LNM Fitted Probabilities</p></a></li>
<li><a href='#prepare_newdata'><p>Design Matrix for a Model</p></a></li>
<li><a href='#sample+2Clnm-method'><p>LNM Fitted Probabilities</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Miniature Logistic-Normal Multinomial Models</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Logistic-normal Multinomial (LNM) models are common in problems with multivariate count data. This package gives a simple implementation with a 30 line 'Stan' script. This lightweight implementation makes it an easy starting point for other projects, in particular for downstream tasks that require analysis of "compositional" data. It can be applied whenever a multinomial probability parameter is thought to depend linearly on inputs in a transformed, log ratio space. Additional utilities make it easy to inspect, create predictions, and draw samples using the fitted models. More about the LNM can be found in Xia et al. (2013) "A Logistic Normal Multinomial Regression Model for Microbiome Compositional Data Analysis" &lt;<a href="https://doi.org/10.1111%2Fbiom.12079">doi:10.1111/biom.12079</a>&gt; and Sankaran and Holmes (2023) "Generative Models: An Interdisciplinary Perspective" &lt;<a href="https://doi.org/10.1146%2Fannurev-statistics-033121-110134">doi:10.1146/annurev-statistics-033121-110134</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://creativecommons.org/publicdomain/zero/1.0/legalcode">CC0</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.0.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>Rcpp (&ge; 0.12.0), RcppParallel (&ge; 5.0.1), cli, dplyr, fansi,
formula.tools, glue, methods, posterior, rstan (&ge; 2.18.1),
rstantools (&ge; 2.4.0), tidyselect</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Biarch:</td>
<td>true</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>BH (&ge; 1.66.0), Rcpp (&ge; 0.12.0), RcppEigen (&ge; 0.3.3.3.0),
RcppParallel (&ge; 5.0.1), rstan (&ge; 2.18.1), StanHeaders (&ge;
2.18.0)</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>GNU make</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/krisrs1128/miniLNM/issues/">https://github.com/krisrs1128/miniLNM/issues/</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/krisrs1128/miniLNM/">https://github.com/krisrs1128/miniLNM/</a>,
<a href="https://krisrs1128.github.io/miniLNM/">https://krisrs1128.github.io/miniLNM/</a></td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-09-11 17:28:57 UTC; krissankaran</td>
</tr>
<tr>
<td>Author:</td>
<td>Kris Sankaran <a href="https://orcid.org/0000-0002-9415-1971"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Kris Sankaran &lt;ksankaran@wisc.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-09-13 18:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='ansi_aware_handler'>Pretty Printing</h2><span id='topic+ansi_aware_handler'></span>

<h3>Description</h3>

<p>Helper function for printing ANSI in Rmarkdown output. Use this at the start
of your Rmarkdown files to include colors in the printed object names in the
final compiled output.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ansi_aware_handler(x, options)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ansi_aware_handler_+3A_x">x</code></td>
<td>
<p>A character vector potentially including ANSI.</p>
</td></tr>
<tr><td><code id="ansi_aware_handler_+3A_options">options</code></td>
<td>
<p>Unused placeholder argument.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Taken from the post at
</p>
<p>https://blog.djnavarro.net/posts/2021-04-18_pretty-little-clis/
</p>


<h3>Value</h3>

<p>A string with HTML reformatted to ensure colors appear in printed
code blocks in rmarkdown output.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>knitr::knit_hooks$set(output = ansi_aware_handler)
options(crayon.enabled = TRUE)
</code></pre>

<hr>
<h2 id='beta_mean'>LNM Posterior Mean</h2><span id='topic+beta_mean'></span>

<h3>Description</h3>

<p>Average the samples for the beta parameter from the VB posterior mean. This
is used to get predicted compositions when using <code>predict</code> on an lnm model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>beta_mean(fit)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="beta_mean_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>lnm</code> whose estimate slot contains the 'rstan'
fitted logistic normal multinomial model.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix whose rows are predictors and columns are outcomes in the
beta parameter for the LNM model.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>example_data &lt;- lnm_data(N = 50, K = 10)
xy &lt;- dplyr::bind_cols(example_data[c("X", "y")])
fit &lt;- lnm(
    starts_with("y") ~ starts_with("x"), xy, 
    iter = 25, output_samples = 25
)
beta_mean(fit)
</code></pre>

<hr>
<h2 id='beta_samples'>LNM Posterior Samples</h2><span id='topic+beta_samples'></span>

<h3>Description</h3>

<p>Return multiple samples for the beta parameter from the VB posterior mean.
This is used to simulate new compositions when using <code>sample</code> on an lnm
model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>beta_samples(fit, size = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="beta_samples_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>lnm</code> whose estimate slot contains the 'rstan'
fitted logistic normal multinomial model.</p>
</td></tr>
<tr><td><code id="beta_samples_+3A_size">size</code></td>
<td>
<p>The number of draws from the posterior to return.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix whose rows are predictors and columns are outcomes in the
beta parameter for the LNM model.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>example_data &lt;- lnm_data(N = 50, K = 10)
xy &lt;- dplyr::bind_cols(example_data[c("X", "y")])
fit &lt;- lnm(
    starts_with("y") ~ starts_with("x"), xy, 
    iter = 25, output_samples = 25
)
beta_samples(fit, size = 2)
</code></pre>

<hr>
<h2 id='lnm'>Fit a logistic normal multinomial model using R's formula interface.</h2><span id='topic+lnm'></span>

<h3>Description</h3>

<p>This function fits a logistic normal multinomial (LNM) model to the data
using R's formula interface. The LNM model is a generalization of the
multinomial logistic regression model, allowing for correlated responses
within each category of the response variable. It can be used to learn the
relationship between experimental/environmental factors and community
composition. It is a statistical model that estimates the probabilities of
different outcomes in a multinomial distribution, given a set of covariates.
The LNM model assumes that a log-ratio of the outcome probabilities follow a
multivariate normal distribution. By fitting the LNM model to observed data,
we can infer the effects of the covariates on the outcome compositions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lnm(formula, data, sigma_b = 2, l1 = 10, l2 = 10, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="lnm_+3A_formula">formula</code></td>
<td>
<p>A formula specifying the model structure.</p>
</td></tr>
<tr><td><code id="lnm_+3A_data">data</code></td>
<td>
<p>A data frame containing the variables specified in the formula.</p>
</td></tr>
<tr><td><code id="lnm_+3A_sigma_b">sigma_b</code></td>
<td>
<p>The prior standard deviation of the beta coefficients in the
LNM model. See the 'Stan' code definition in inst/stan/lnm.stan for the
full model specification.</p>
</td></tr>
<tr><td><code id="lnm_+3A_l1">l1</code></td>
<td>
<p>The first inverse gamma hyperprior parameter for sigmas_mu.</p>
</td></tr>
<tr><td><code id="lnm_+3A_l2">l2</code></td>
<td>
<p>The first inverse gamma hyperprior parameter for sigmas_mu.</p>
</td></tr>
<tr><td><code id="lnm_+3A_...">...</code></td>
<td>
<p>Additional arguments to be passed to the underlying vb() call from
'rstan'.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class &quot;lnm&quot; representing the fitted LNM model.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>example_data &lt;- lnm_data(N = 50, K = 10)
xy &lt;- dplyr::bind_cols(example_data[c("X", "y")])
fit &lt;- lnm(
    starts_with("y") ~ starts_with("x"), xy, 
    iter = 25, output_samples = 25
)
</code></pre>

<hr>
<h2 id='lnm_data'>Simulates data from a Logistic Normal Multinomial Model.</h2><span id='topic+lnm_data'></span>

<h3>Description</h3>

<p>Simulates data from a Logistic Normal Multinomial Model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lnm_data(N = 100, D = 5, K = 10)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="lnm_data_+3A_n">N</code></td>
<td>
<p>The number of samples in the output data.</p>
</td></tr>
<tr><td><code id="lnm_data_+3A_d">D</code></td>
<td>
<p>The number of covariates, each of which can influence the response
composition vector (e.g., the timepoint or disease status).</p>
</td></tr>
<tr><td><code id="lnm_data_+3A_k">K</code></td>
<td>
<p>The number of output dimensions (e.g., number of taxa).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the following components:
</p>

<dl>
<dt>X</dt><dd><p>An N x D matrix of covariates.</p>
</dd>
<dt>y</dt><dd><p>The N x K simulated samples.</p>
</dd>
<dt>B</dt><dd><p>The D x K relationship between covariates and outputs.</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>lnm_data(5, 3, 3)
</code></pre>

<hr>
<h2 id='lnm-class'>S4 Class for a Logistic Normal Multinomial Model</h2><span id='topic+lnm-class'></span>

<h3>Description</h3>

<p>The Logistic Normal Multinomial (LNM) model is used to learn the relationship
between experimental/environmental factors and community composition. It is a
statistical model that estimates the probabilities of different outcomes in a
multinomial distribution, given a set of covariates. The LNM model assumes
that a log-ratio of the outcome probabilities follow a multivariate normal
distribution. By fitting the LNM model to observed data, we can infer the
effects of the covariates on the outcome compositions.
</p>


<h3>Details</h3>

<p>This class combines all information into three slots:
</p>


<h3>Slots</h3>


<dl>
<dt><code>estimate</code></dt><dd><p>The fitted logistic normal multinomial model, with parameter B
relating covariates to outcome compositions.</p>
</dd>
<dt><code>template</code></dt><dd><p>The data used to estimate the parameters in the estimate slot.</p>
</dd>
<dt><code>formula</code></dt><dd><p>The R formula representation of the relationship between output
compositions and input variables.</p>
</dd>
</dl>

<hr>
<h2 id='phi_inverse'>Inverse log ratio transformation</h2><span id='topic+phi_inverse'></span>

<h3>Description</h3>

<p>This function applies the inverse logistic function to a vector, which maps
the values of the vector to the range (0, 1).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phi_inverse(mu)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="phi_inverse_+3A_mu">mu</code></td>
<td>
<p>A numeric vector to transform using an inverse log ratio
transformation.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector with values mapped to the range (0, 1) and a
reference coordinate added.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>phi_inverse(c(-5, 0, 5))
</code></pre>

<hr>
<h2 id='predict+2Clnm-method'>LNM Fitted Probabilities</h2><span id='topic+predict+2Clnm-method'></span>

<h3>Description</h3>

<p>Given an input dataset, predict the output composition. Specifically, this
outputs <code class="reqn">\phi^{-1}(Bx)</code>, for the inverse log ratio transformation
<code class="reqn">\phi^{-1}</code> and fitted covariate matrix <code class="reqn">B</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'lnm'
predict(object, newdata = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict+2B2Clnm-method_+3A_object">object</code></td>
<td>
<p>An object of class lnm with fitted parameters <code class="reqn">\hat{B}</code> and
which we want to use to form predictions on new samples.</p>
</td></tr>
<tr><td><code id="predict+2B2Clnm-method_+3A_newdata">newdata</code></td>
<td>
<p>New samples on which to form predictions. Defaults to NULL, in
which case predictions are made at the same design points as those used
during the original training.</p>
</td></tr>
<tr><td><code id="predict+2B2Clnm-method_+3A_...">...</code></td>
<td>
<p>Additional keyword arguments, for consistency with R's predict
generic (never used).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix with predictions along rows and outcomes along columns. Rows
sum up to one.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>example_data &lt;- lnm_data(N = 50, K = 10)
xy &lt;- dplyr::bind_cols(example_data[c("X", "y")])
fit &lt;- lnm(
    starts_with("y") ~ starts_with("x"), xy, 
    iter = 25, output_samples = 25
)
head(predict(fit))
</code></pre>

<hr>
<h2 id='prepare_newdata'>Design Matrix for a Model</h2><span id='topic+prepare_newdata'></span>

<h3>Description</h3>

<p>This is a helper function to form the design matrix for an LNM regression
starting from a fitted model's formula object. It is an analog of
model.matrix for the multiresponse setting.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prepare_newdata(fit, newdata = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="prepare_newdata_+3A_fit">fit</code></td>
<td>
<p>An object of class <code>lnm</code> whose estimate slot contains the 'rstan'
fitted logistic normal multinomial model.</p>
</td></tr>
<tr><td><code id="prepare_newdata_+3A_newdata">newdata</code></td>
<td>
<p>A data.frame containing variables in the formula definition of
the fit, but which hasn't been converted into the matrix format needed for
internal prediction.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix containing the design matrix that can be multiplied with the
fitted Beta parameter to get fitted compositions.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>example_data &lt;- lnm_data(N = 10, K = 5)
xy &lt;- dplyr::bind_cols(example_data[c("X", "y")])
fit &lt;- lnm(
    starts_with("y") ~ starts_with("x"), xy,
    iter = 5, output_samples = 5
)
prepare_newdata(fit, example_data[["X"]])
</code></pre>

<hr>
<h2 id='sample+2Clnm-method'>LNM Fitted Probabilities</h2><span id='topic+sample+2Clnm-method'></span>

<h3>Description</h3>

<p>Given an input dataset, sample compositions that are consistent with the
input. Specifically, this samples from a multinomial with mean
<code class="reqn">\phi^{-1}(Bx)</code>. The default depth is 5e4. Modify the &quot;depth&quot; parameter
to change this.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'lnm'
sample(x, size = 1, depth = 50000, newdata = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sample+2B2Clnm-method_+3A_x">x</code></td>
<td>
<p>An object of class lnm with fitted parameters <code class="reqn">\hat{B}</code> and
which we want to use to form predictions on new samples.</p>
</td></tr>
<tr><td><code id="sample+2B2Clnm-method_+3A_size">size</code></td>
<td>
<p>The number of samples to generate.</p>
</td></tr>
<tr><td><code id="sample+2B2Clnm-method_+3A_depth">depth</code></td>
<td>
<p>The depth to use when sampling the multinomial for each
simulated element.</p>
</td></tr>
<tr><td><code id="sample+2B2Clnm-method_+3A_newdata">newdata</code></td>
<td>
<p>New samples on which to form predictions. Defaults to NULL, in
which case predictions are made at the same design points as those used
during the original training.</p>
</td></tr>
<tr><td><code id="sample+2B2Clnm-method_+3A_...">...</code></td>
<td>
<p>Additional keyword arguments, for consistency with R's predict
generic (never used).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix of dimension <code>size</code> x <code>n_outcomes</code>, where each row
represents one sample from the posterior predictive of the fitted
logistic-normal multinomial model. Each row sums up to the depth argument,
which defaults to 5e4.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>example_data &lt;- lnm_data(N = 50, K = 10)
xy &lt;- dplyr::bind_cols(example_data[c("X", "y")])
fit &lt;- lnm(
    starts_with("y") ~ starts_with("x"), xy, 
    iter = 25, output_samples = 25
)
head(sample(fit))
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
