<!DOCTYPE html><html lang="en-US"><head><title>Help for package metabodecon</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {metabodecon}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#align'><p>Align Spectra</p></a></li>
<li><a href='#as_metabodecon_class'><p>Convert to a Metabodecon Class</p></a></li>
<li><a href='#calculate_lorentz_curves'><p>Calculate lorentz curves for each analyzed spectrum</p></a></li>
<li><a href='#combine_peaks'><p>Combine Peaks</p></a></li>
<li><a href='#convert_pos'><p>Convert from unit A to unit B</p></a></li>
<li><a href='#datadir'><p>Return path to metabodecon's data directory</p></a></li>
<li><a href='#datadir_persistent'><p>Persistent Data Directory</p></a></li>
<li><a href='#datadir_temp'><p>Temporary Data Directory</p></a></li>
<li><a href='#deconvolute'><p>Deconvolute one or more NMR spectra</p></a></li>
<li><a href='#dohCluster'><p>Cluster Based Peak Alignment</p></a></li>
<li><a href='#download_example_datasets'><p>Download metabodecon Example Datasets</p></a></li>
<li><a href='#draw_spectrum'><p>Draw Spectrum</p></a></li>
<li><a href='#evalwith'><p>Evaluate an expression with predefined global state</p></a></li>
<li><a href='#gen_feat_mat'><p>Generate Feature Matrix.</p></a></li>
<li><a href='#get_data_dir'><p>Retrieve directory path of an example dataset</p></a></li>
<li><a href='#get_ppm_range'><p>Get PPM Range covered by Spectra</p></a></li>
<li><a href='#is_metabodecon_class'><p>Is an Object from a Metabodecon Class?</p></a></li>
<li><a href='#make_spectrum'><p>Create a Spectrum Object</p></a></li>
<li><a href='#metabodecon_classes'><p>Metabodecon Classes</p></a></li>
<li><a href='#metabodecon_file'><p>Return Path to File or Directory in metabodecon Package</p></a></li>
<li><a href='#MetaboDecon1D'><p>Deconvolute 1D NMR spectrum</p></a></li>
<li><a href='#plot_lorentz_curves_save_as_png'><p>Plot lorentz curves for variable range</p></a></li>
<li><a href='#plot_spectra'><p>Plot Spectra</p></a></li>
<li><a href='#plot_spectrum'><p>Plot Spectrum</p></a></li>
<li><a href='#plot_spectrum_superposition_save_as_png'><p>Plot spectrum approx for variable range</p></a></li>
<li><a href='#plot_triplets'><p>Plot peak triplets for variable range</p></a></li>
<li><a href='#print_methods'><p>S3 Methods for Printing Metabodecon Objects</p></a></li>
<li><a href='#read_spectra'><p>Read one or more spectra from Disk</p></a></li>
<li><a href='#read_spectrum'><p>Read one or more spectra from Disk</p></a></li>
<li><a href='#sap'><p>The SAP Dataset</p></a></li>
<li><a href='#sim'><p>The Sim Dataset</p></a></li>
<li><a href='#simulate_spectrum'><p>Simulate a 1D NMR Spectrum</p></a></li>
<li><a href='#speaq_align'><p>Align Signals using 'speaq'</p></a></li>
<li><a href='#tmpdir'><p>Temporary Session Directory</p></a></li>
<li><a href='#transp'><p>Make transparent</p></a></li>
<li><a href='#tree'><p>Print the Structure of a Directory Tree</p></a></li>
<li><a href='#width'><p>Calculate the Width of a Numeric Vector</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Deconvolution and Alignment of 1d NMR Spectra</td>
</tr>
<tr>
<td>Version:</td>
<td>1.2.6</td>
</tr>
<tr>
<td>Description:</td>
<td>A framework for deconvolution, alignment and postprocessing
    of 1-dimensional (1d) nuclear magnetic resonance (NMR) spectra, resulting in
    a data matrix of aligned signal integrals. The deconvolution part uses the
    algorithm described in Koh et al. (2009) &lt;<a href="https://doi.org/10.1016%2Fj.jmr.2009.09.003">doi:10.1016/j.jmr.2009.09.003</a>&gt;.
    The alignment part is based on functions from the 'speaq' package, described
    in Beirnaert et al. (2018) &lt;<a href="https://doi.org/10.1371%2Fjournal.pcbi.1006018">doi:10.1371/journal.pcbi.1006018</a>&gt; and Vu et al.
    (2011) &lt;<a href="https://doi.org/10.1186%2F1471-2105-12-405">doi:10.1186/1471-2105-12-405</a>&gt;. A detailed description and evaluation
    of an early version of the package, 'MetaboDecon1D v0.2.2', can be found in
    Haeckl et al. (2021) &lt;<a href="https://doi.org/10.3390%2Fmetabo11070452">doi:10.3390/metabo11070452</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/spang-lab/metabodecon/">https://github.com/spang-lab/metabodecon/</a>,
<a href="https://spang-lab.github.io/metabodecon/">https://spang-lab.github.io/metabodecon/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/spang-lab/metabodecon/issues">https://github.com/spang-lab/metabodecon/issues</a></td>
</tr>
<tr>
<td>biocViews:</td>
<td>NMR, Deconvolution</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>data.table, mathjaxr, readJDX, speaq, toscutil (&ge; 2.8.0),
withr</td>
</tr>
<tr>
<td>Suggests:</td>
<td>devtools, digest, knitr, lifecycle, microbenchmark, pkgload,
rmarkdown, usethis, vdiffr, testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Config/testthat/parallel:</td>
<td>true</td>
</tr>
<tr>
<td>Config/testthat/start-first:</td>
<td>read_spectrum, download_example_datasets,
cache_example_datasets, deconvolute_ispecs, mcmapply, datadir,
get_decon_params, generate_lorentz_curves, smooth_signals,
speaq_align</td>
</tr>
<tr>
<td>RdMacros:</td>
<td>mathjaxr</td>
</tr>
<tr>
<td>BuildManual:</td>
<td>TRUE</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-01-20 12:14:18 UTC; tschmidt</td>
</tr>
<tr>
<td>Author:</td>
<td>Tobias Schmidt [aut, cre, cph],
  Martina Haeckl [aut, cph],
  Yanren Linda Hu [ctb],
  Wolfram Gronwald [aut, cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Tobias Schmidt &lt;tobias.schmidt331@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-01-21 16:00:06 UTC</td>
</tr>
</table>
<hr>
<h2 id='align'>Align Spectra</h2><span id='topic+align'></span>

<h3>Description</h3>

<p>Align signals across  a  list  of  deconvoluted  spectra  using  the  'CluPA'
algorithm from the 'speaq' package, described  in  Beirnaert  et  al.  (2018)
<a href="doi:10.1371/journal.pcbi.1006018">doi:10.1371/journal.pcbi.1006018</a>     and     Vu     et      al.      (2011)
<a href="doi:10.1186/1471-2105-12-405">doi:10.1186/1471-2105-12-405</a> plus the additional peak combination described
in <code><a href="#topic+combine_peaks">combine_peaks()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>align(x, maxShift = 50, maxCombine = 5, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="align_+3A_x">x</code></td>
<td>
<p>An  object  of  type  <code>decons1</code>  or  <code>decons2</code>  as  described  in
<a href="#topic+metabodecon_classes">metabodecon_classes</a>. To align <code>decons0</code> objects
(as returned by the now deprecated <a href="#topic+MetaboDecon1D">MetaboDecon1D</a>), you can use
<code><a href="#topic+as_decons2">as_decons2()</a></code> to convert it to a <code>decons2</code> object first.</p>
</td></tr>
<tr><td><code id="align_+3A_maxshift">maxShift</code></td>
<td>
<p>Maximum number of points along the &quot;ppm-axis&quot; a value can  be  moved  by  the
'speaq' package. 50 is a suitable starting value for plasma  spectra  with  a
digital resolution of 128K. Note that this parameter has to  be  individually
optimized  depending  on  the  type  of  analyzed  spectra  and  the  digital
resolution. For urine which is more prone to chemical shift  variations  this
value most probably has to be increased. Passed  as  argument  <code>maxShift</code>  to
<code><a href="#topic+speaq_align">speaq_align()</a></code>.</p>
</td></tr>
<tr><td><code id="align_+3A_maxcombine">maxCombine</code></td>
<td>
<p>Amount of adjacent columns which may be combined for improving the alignment.
Passed as argument <code>range</code> to <code><a href="#topic+combine_peaks">combine_peaks()</a></code>.</p>
</td></tr>
<tr><td><code id="align_+3A_verbose">verbose</code></td>
<td>
<p>Whether to print additional information during the alignment process.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of type <code>align</code> as described in <a href="#topic+metabodecon_classes">metabodecon_classes</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sim_dir &lt;- metabodecon_file("bruker/sim")
spectra &lt;- read_spectra(sim_dir)
decons &lt;- deconvolute(spectra, sfr = c(3.55, 3.35))
aligned &lt;- align(decons)
aligned
</code></pre>

<hr>
<h2 id='as_metabodecon_class'>Convert to a Metabodecon Class</h2><span id='topic+as_metabodecon_class'></span><span id='topic+as_spectrum'></span><span id='topic+as_ispec'></span><span id='topic+as_idecon'></span><span id='topic+as_decon0'></span><span id='topic+as_decon1'></span><span id='topic+as_decon2'></span><span id='topic+as_spectra'></span><span id='topic+as_ispecs'></span><span id='topic+as_idecons'></span><span id='topic+as_decons0'></span><span id='topic+as_decons1'></span><span id='topic+as_decons2'></span>

<h3>Description</h3>

<p>Convert an object to a Metabodecon class.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as_spectrum(x, sf = c(1000, 1e+06))

as_ispec(x, sf = c(1000, 1e+06))

as_idecon(x)

as_decon0(x, sf = NULL, spectrum = NULL, optional = TRUE)

as_decon1(
  x,
  sf = c(1000, 1e+06),
  spectrum = NULL,
  sfr = NULL,
  wshw = NULL,
  bwc = 2
)

as_decon2(
  x,
  sf = c(1000, 1e+06),
  spectrum = NULL,
  sfr = NULL,
  wshw = NULL,
  bwc = 2
)

as_spectra(
  x,
  file_format = "bruker",
  expno = 10,
  procno = 10,
  raw = FALSE,
  silent = TRUE,
  force = FALSE
)

as_ispecs(x, sf = c(1000, 1e+06))

as_idecons(x)

as_decons0(x, sfs = list(c(1000, 1e+06)), spectra = list(NULL), nworkers = 1)

as_decons1(
  x,
  sfs = list(c(1000, 1e+06)),
  spectra = list(NULL),
  sfrs = list(NULL),
  wshws = list(NULL),
  bwc = 2,
  nworkers = 1
)

as_decons2(
  x,
  sfs = list(c(1000, 1e+06)),
  spectra = list(NULL),
  sfrs = list(NULL),
  wshws = list(NULL),
  bwc = 2,
  nworkers = 1
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="as_metabodecon_class_+3A_x">x</code></td>
<td>
<p>The object to convert.</p>
</td></tr>
<tr><td><code id="as_metabodecon_class_+3A_sf">sf</code></td>
<td>
<p>Scale factor. Only required if <code>x</code> is a decon0 object.</p>
</td></tr>
<tr><td><code id="as_metabodecon_class_+3A_spectrum">spectrum</code>, <code id="as_metabodecon_class_+3A_spectra">spectra</code></td>
<td>
<p>The <code>spectrum</code>/<code>spectra</code> object corresponding to <code>x</code> as returned by
<code><a href="#topic+read_spectrum">read_spectrum()</a></code> / <a href="#topic+read_spectra">read_spectra</a>. Only required if <code>x</code> is a decon0 object.</p>
</td></tr>
<tr><td><code id="as_metabodecon_class_+3A_optional">optional</code></td>
<td>
<p>Logical. If <code>TRUE</code>, the two optional elements <code>signal_free_region</code> and
<code>range_water_signal_ppm</code> are included in the returned <code>decon0</code> object.</p>
</td></tr>
<tr><td><code id="as_metabodecon_class_+3A_sfr">sfr</code>, <code id="as_metabodecon_class_+3A_sfrs">sfrs</code></td>
<td>
<p><code>sfr</code> should be a vector specifying the borders of the signal free region.
<code>sfrs</code> should be a list of such vectors. Only required if <code>x</code> is a <code>decon0</code>
object where element <code>signal_free_region</code> is missing (or a <code>decons0</code> objected
containing such <code>decon0</code> objects).</p>
</td></tr>
<tr><td><code id="as_metabodecon_class_+3A_wshw">wshw</code>, <code id="as_metabodecon_class_+3A_wshws">wshws</code></td>
<td>
<p><code>wshw</code> should specify the half width of the water signal region. <code>wshws</code>
should be a list of such values. Only required if <code>x</code> is a <code>decon0</code> object
where element <code>range_water_signal_ppm</code> is missing (or a <code>decons0</code> objected
containing such <code>decon0</code> objects).</p>
</td></tr>
<tr><td><code id="as_metabodecon_class_+3A_bwc">bwc</code></td>
<td>
<p>Level of backwards compatibility. If <code>bwc == 0</code>, bug fixes introduced after
version 0.2.2 of Metabodecon are not used. If <code>bwc == 1</code>, new features
introduced after version 0.2.2 of Metabodecon (e.g. faster algorithms) are
not used. If <code>bwc == 2</code>, all bug fixes and features introduced after version
0.2.2 are used. Support for <code>bwc == 0</code> will be removed in 'metabodecon v2.0'.</p>
</td></tr>
<tr><td><code id="as_metabodecon_class_+3A_file_format">file_format</code></td>
<td>
<p>The file_format of the spectrum file. E.g. <code>"bruker"</code> or <code>"jcampdx"</code>.</p>
</td></tr>
<tr><td><code id="as_metabodecon_class_+3A_expno">expno</code>, <code id="as_metabodecon_class_+3A_procno">procno</code></td>
<td>
<p>The experiment/processing number for the file. E.g. <code>"10"</code>. Only relevant if
<code>file_format</code> equals <code>"bruker"</code>. For details see section <a href="https://spang-lab.github.io/metabodecon/articles/FAQ.html#file-structure">File Structure</a> in
the metabodecon FAQ.</p>
</td></tr>
<tr><td><code id="as_metabodecon_class_+3A_raw">raw</code></td>
<td>
<p>If <code>FALSE</code>, scales the returned signal intensities based on information
available in the spectrum metadata, in particular <code>NC_proc</code>. For details see
<code>processing-reference.pdf</code>, available at <a href="https://www.bruker.com/en.html">https://www.bruker.com/en.html</a> at
section 'Services &amp; Support &gt; Documentation &amp; Manuals &gt; Magnetic Resonance &gt;
Acquisition &amp; Processing &gt; TopSpin Processing Commands and Parameters'
(requires login).</p>
</td></tr>
<tr><td><code id="as_metabodecon_class_+3A_silent">silent</code></td>
<td>
<p>If <code>TRUE</code>, no output will be printed to the console.</p>
</td></tr>
<tr><td><code id="as_metabodecon_class_+3A_force">force</code></td>
<td>
<p>If <code>TRUE</code>, try to continue when encountering errors and print info messages
instead. To hide these messages as well, set <code>silent = TRUE</code>.</p>
</td></tr>
<tr><td><code id="as_metabodecon_class_+3A_sfs">sfs</code></td>
<td>
<p>List of scale factors. Only required if <code>x</code> is a list of decon0
objects.</p>
</td></tr>
<tr><td><code id="as_metabodecon_class_+3A_nworkers">nworkers</code></td>
<td>
<p>Number of workers for parallel processing.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of the specified class.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dirpath &lt;- metabodecon_file("sim_subset")
spectra &lt;- read_spectra(dirpath)
spectrum &lt;- spectra[[1]]
decons1 &lt;- generate_lorentz_curves_sim(spectra)
decon1 &lt;- generate_lorentz_curves_sim(spectrum)
decon2 &lt;- as_decon2(decon1)
</code></pre>

<hr>
<h2 id='calculate_lorentz_curves'>Calculate lorentz curves for each analyzed spectrum</h2><span id='topic+calculate_lorentz_curves'></span>

<h3>Description</h3>

<p>Calculates the lorentz curves of each investigated spectrum.
</p>
<p>Martina Haeckl, 2021: Initial version.
Tobias Schmidt, 2024: Minor updates to pass CRAN checks
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_lorentz_curves(deconv_result, number_of_files = NA)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calculate_lorentz_curves_+3A_deconv_result">deconv_result</code></td>
<td>
<p>A list as returned by <code><a href="#topic+generate_lorentz_curves">generate_lorentz_curves()</a></code> or <a href="#topic+MetaboDecon1D">MetaboDecon1D</a>.</p>
</td></tr>
<tr><td><code id="calculate_lorentz_curves_+3A_number_of_files">number_of_files</code></td>
<td>
<p>Number of spectra to analyze</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If <code>deconv_result</code> holds the result of a single deconvolution, a matrix
containing the generated Lorentz curves is returned, where each row depicts
one Lorentz curve. If <code>deconv_result</code> is a list of deconvoluted spectra, a
list of such matrices is returned.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+MetaboDecon1D">MetaboDecon1D()</a></code>,
<code><a href="#topic+plot_triplets">plot_triplets()</a></code>,
<code><a href="#topic+plot_lorentz_curves_save_as_png">plot_lorentz_curves_save_as_png()</a></code>,
<code><a href="#topic+plot_spectrum_superposition_save_as_png">plot_spectrum_superposition_save_as_png()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## -~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-
## Deconvolute the spectra in folder "bruker/sim_subset" into a list of
## Lorentz Curves (specified via the parameters A, lambda and x_0).
## -~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-
sim &lt;- metabodecon_file("bruker/sim_subset")
decons &lt;- generate_lorentz_curves_sim(sim)
decon0 &lt;- decons[[1]]

## -~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-
## Calculate the corresponding y values at each ppm value for each Lorentz
## Curve. I.e. you get a matrix of dimension n x m for each deconvolution,
## where n is the number of Lorentz Curves and m is the number of ppm values.
## -~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-
yy &lt;- calculate_lorentz_curves(decons)
y1 &lt;- yy[[1]]
dim(y1)

## -~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-
## Visualize the 5th, 9th and 11th Lorentz curve.
## -~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-
nrs &lt;- c(5, 9, 11)
col &lt;- c("red", "blue", "orange")
desc &lt;- paste("Lorentz curve", nrs)
plot(decon0$x_values_ppm, decon0$y_values, type = "l", lty = 2)
for (i in 1:3) lines(decon0$x_values_ppm, y1[nrs[i], ], col = col[i])
legend("topright", legend = desc, col = col, lty = 1)

</code></pre>

<hr>
<h2 id='combine_peaks'>Combine Peaks</h2><span id='topic+combine_peaks'></span>

<h3>Description</h3>

<p>Even after calling <code>speaq_align()</code>, the alignment of individual signals is
not always perfect, as 'speaq' performs a segment-wise alignment i.e. groups
of signals are aligned. For further improvements, partly filled neighboring
columns are merged.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>combine_peaks(
  shifted_mat = speaq_align(),
  range = 5,
  lower_bound = 1,
  spectrum_data = NULL,
  data_path = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="combine_peaks_+3A_shifted_mat">shifted_mat</code></td>
<td>
<p>The matrix returned by <code>speaq_align()</code>.</p>
</td></tr>
<tr><td><code id="combine_peaks_+3A_range">range</code></td>
<td>
<p>Amount of adjacent columns which are permitted to be used for
improving the alignment.</p>
</td></tr>
<tr><td><code id="combine_peaks_+3A_lower_bound">lower_bound</code></td>
<td>
<p>Minimum amount of non-zero elements per column to trigger
the alignment improvement.</p>
</td></tr>
<tr><td><code id="combine_peaks_+3A_spectrum_data">spectrum_data</code></td>
<td>
<p>The list of deconvoluted spectra as returned by
<code>generate_lorentz_curves()</code> that was used to generate <code>shifted_mat</code>. No
longer required since version 1.2 of Metabodecon.</p>
</td></tr>
<tr><td><code id="combine_peaks_+3A_data_path">data_path</code></td>
<td>
<p>If not NULL, the returned dataframes <code>long</code> and <code>short</code> are
written to <code>data_path</code> as &quot;aligned_res_long.csv&quot; and &quot;aligned_res_short.csv&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Example of what the function does:
</p>
<div class="sourceCode txt"><pre>|            | 3.56 | 3.54 | 3.51 | 3.51 | 3.50 |
|----------- |------|------|------|------|------|
| Spectrum 1 | 0.13 | 0    | 0.11 | 0    | 0    |
| Spectrum 2 | 0.13 | 0    | 0.12 | 0    | 0    |
| Spectrum 3 | 0.07 | 0    | 0    | 0    | 0    |
| Spectrum 4 | 0.08 | 0    | 0    | 0.07 | 0    |
| Spectrum 5 | 0.04 | 0    | 0.04 | 0    | 0    |
</pre></div>
<p>becomes
</p>
<div class="sourceCode txt"><pre>|            | 3.56 | 3.54 | 3.51 | 3.50 |
|----------- |------|------|------|------|
| Spectrum 1 | 0.13 | 0    | 0.11 | 0    |
| Spectrum 2 | 0.13 | 0    | 0.12 | 0    |
| Spectrum 3 | 0.07 | 0    | 0    | 0    |
| Spectrum 4 | 0.08 | 0    | 0.07 | 0    |
| Spectrum 5 | 0.04 | 0    | 0.04 | 0    |
</pre></div>
<p>I.e. column 3 and 4 get merged, because they are in <code>range</code> of each other
and have no common non-zero entries.
</p>


<h3>Value</h3>

<p>A list containing two data frames <code>long</code> and <code>short</code>. The first data frame
contains one one column for each data point in the original spectrum. The
second data frame contains only columns where at least one entry is non-zero.
</p>


<h3>Author(s)</h3>

<p>Initial version from Wolfram Gronwald.
Refactored by Tobias Schmidt in 2024.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sim_subset &lt;- metabodecon_file("bruker/sim_subset")
spectrum_data &lt;- generate_lorentz_curves_sim(sim_subset)
shifted_mat &lt;- speaq_align(spectrum_data = spectrum_data, verbose = FALSE)
range &lt;- 5
lower_bound &lt;- 1
obj &lt;- combine_peaks(shifted_mat, range, lower_bound)
str(obj)
</code></pre>

<hr>
<h2 id='convert_pos'>Convert from unit A to unit B</h2><span id='topic+convert_pos'></span><span id='topic+convert_width'></span>

<h3>Description</h3>

<p>Converts positions/widths from unit A to unit B. If the direction of units  A
and B is reversed, the width's sign will be reversed as well. To keep  widths
strictly positive, wrap the result with <code>abs()</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>convert_pos(xa, ya, yb)

convert_width(xa, ya, yb)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="convert_pos_+3A_xa">xa</code></td>
<td>
<p>A numeric vector specifying widths/positions in unit A.</p>
</td></tr>
<tr><td><code id="convert_pos_+3A_ya">ya</code>, <code id="convert_pos_+3A_yb">yb</code></td>
<td>
<p>A numeric vector specifying the positions of at least two points in unit A /
unit B.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector of values converted from unit A to unit B.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ya &lt;- c(244, 246, 248, 250, 252)
yb &lt;- c(15, 10, 5, 0, -5)
convert_width(c(2, 4, 8), ya, yb)
convert_pos(c(247, 249), ya, yb)
</code></pre>

<hr>
<h2 id='datadir'>Return path to metabodecon's data directory</h2><span id='topic+datadir'></span>

<h3>Description</h3>

<p>Returns the path to the directory where
<code><a href="#topic+download_example_datasets">download_example_datasets()</a></code> stores metabodecon's example data sets or any
file within that directory. By default this directory is a subdirectory of
R's temporary session directory. If <code>persistent</code> is set to <code>TRUE</code>, the
directory equals the data directory returned by <code><a href="tools.html#topic+userdir">tools::R_user_dir()</a></code>
instead.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>datadir(file = NULL, warn = TRUE, persistent = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="datadir_+3A_file">file</code></td>
<td>
<p>Relative path to a file within the data directory.</p>
</td></tr>
<tr><td><code id="datadir_+3A_warn">warn</code></td>
<td>
<p>Print a warning message when the requested path does not yet
exist?</p>
</td></tr>
<tr><td><code id="datadir_+3A_persistent">persistent</code></td>
<td>
<p>Return the path to the persistent data directory instead of
the temporary one?</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The decision to use a temporary data dir as default and a persistent
one only optionally was made to conform to CRAN package policies, which state
that:
</p>
<div class="sourceCode"><pre>Packages should not write in the user's home filespace (including
clipboards), nor anywhere else on the file system apart from the R
session's temporary directory \[...\] Limited exceptions may be allowed
in interactive sessions if the package obtains confirmation from the
user. For R version 4.0 or later \[...\] packages may store user-specific
data, configuration and cache files in their respective user directories
obtained from [tools::R_user_dir()] \[...\].
</pre></div>
<p>Source:
<a href="https://cran.r-project.org/web/packages/policies.html">cran.r-project.org/web/packages/policies</a>.
</p>


<h3>Value</h3>

<p>Path to the data directory or a file within it.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+download_example_datasets">download_example_datasets()</a></code>,
<code><a href="#topic+datadir_persistent">datadir_persistent()</a></code>,
<code><a href="#topic+datadir_temp">datadir_temp()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Get temporary datadir and persistent datadir
datadir(persistent = FALSE, warn = FALSE)
datadir(persistent = TRUE,  warn = FALSE)

# Get persistent datadir if existing else temp datadir. Set `warn = TRUE`
# to raise a warning if none of the directories exist yet.
datadir(warn = FALSE)
if (interactive()) datadir()

# Get PERSISTENT_DATADIR/bruker if existing else TEMP_DATADIR/bruker
datadir(file = "bruker/urine", warn = FALSE)
</code></pre>

<hr>
<h2 id='datadir_persistent'>Persistent Data Directory</h2><span id='topic+datadir_persistent'></span>

<h3>Description</h3>

<p>Returns the path to the persistent data directory where
metabodecon's data sets are stored. This directory equals the data directory
returned by <code><a href="tools.html#topic+userdir">tools::R_user_dir()</a></code> plus additional path normalization.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>datadir_persistent()
</code></pre>


<h3>Value</h3>

<p>Path to the persistent data directory.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+datadir">datadir()</a></code>, <code><a href="#topic+datadir_temp">datadir_temp()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
datadir_persistent()
</code></pre>

<hr>
<h2 id='datadir_temp'>Temporary Data Directory</h2><span id='topic+datadir_temp'></span>

<h3>Description</h3>

<p>Returns the path to the temporary data directory where
metabodecon's data sets are stored. This directory equals subdirectory 'data'
of metabodecons temporary session directory <code><a href="#topic+tmpdir">tmpdir()</a></code> plus additional path
normalization.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>datadir_temp()
</code></pre>


<h3>Value</h3>

<p>Returns the path to the temporary data directory.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+tmpdir">tmpdir()</a></code>, <code><a href="#topic+datadir">datadir()</a></code>, <code><a href="#topic+datadir_persistent">datadir_persistent()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
datadir_temp()
</code></pre>

<hr>
<h2 id='deconvolute'>Deconvolute one or more NMR spectra</h2><span id='topic+deconvolute'></span><span id='topic+generate_lorentz_curves'></span><span id='topic+generate_lorentz_curves_sim'></span>

<h3>Description</h3>

<p>Deconvolutes NMR spectra by modeling each detected signal within
a spectrum as Lorentz Curve.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>deconvolute(
  x,
  nfit = 3,
  smopts = c(2, 5),
  delta = 6.4,
  sfr = NULL,
  wshw = 0,
  ask = FALSE,
  force = FALSE,
  verbose = FALSE,
  nworkers = 1
)

generate_lorentz_curves(
  data_path,
  file_format = "bruker",
  make_rds = FALSE,
  expno = 10,
  procno = 10,
  raw = TRUE,
  nfit = 10,
  smopts = c(2, 5),
  delta = 6.4,
  sfr = c(11.44494, -1.8828),
  wshw = 0.1527692,
  ask = TRUE,
  force = FALSE,
  verbose = TRUE,
  nworkers = 1
)

generate_lorentz_curves_sim(
  data_path,
  file_format = "bruker",
  make_rds = FALSE,
  expno = 10,
  procno = 10,
  raw = TRUE,
  nfit = 10,
  smopts = c(2, 5),
  delta = 6.4,
  sfr = c(3.55, 3.35),
  wshw = 0,
  ask = FALSE,
  force = FALSE,
  verbose = FALSE,
  nworkers = 1
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="deconvolute_+3A_x">x</code></td>
<td>
<p>A <code>spectrum</code> or <code>spectra</code> object as described in
<a href="#topic+metabodecon_classes">metabodecon_classes</a>.</p>
</td></tr>
<tr><td><code id="deconvolute_+3A_nfit">nfit</code></td>
<td>
<p>Integer. Number of iterations for approximating the parameters
for the Lorentz curves. See 'Details'.</p>
</td></tr>
<tr><td><code id="deconvolute_+3A_smopts">smopts</code></td>
<td>
<p>Numeric vector with two entries: the number of smoothing
iterations and the number of data points to use for smoothing (must be odd).
See 'Details'.</p>
</td></tr>
<tr><td><code id="deconvolute_+3A_delta">delta</code></td>
<td>
<p>Threshold for peak filtering. Higher values result in more peaks
being filtered out. A peak is filtered if its score is below <code class="reqn">\mu +
\sigma \cdot \delta</code>, where <code class="reqn">\mu</code> is the average
peak score in the signal-free region (SFR), and <code class="reqn">\sigma</code> is the
standard deviation of peak scores in the SFR. See 'Details'.</p>
</td></tr>
<tr><td><code id="deconvolute_+3A_sfr">sfr</code></td>
<td>
<p>Numeric vector with two entries: the ppm positions for the left
and right border of the signal-free region of the spectrum. See 'Details'.</p>
</td></tr>
<tr><td><code id="deconvolute_+3A_wshw">wshw</code></td>
<td>
<p>Half-width of the water artifact in ppm.  See 'Details'.</p>
</td></tr>
<tr><td><code id="deconvolute_+3A_ask">ask</code></td>
<td>
<p>Logical. Whether to ask for user input during the deconvolution
process. If FALSE, the provided default values will be used.</p>
</td></tr>
<tr><td><code id="deconvolute_+3A_force">force</code></td>
<td>
<p>If FALSE, the function stops with an error message if no peaks
are found in the signal free region (SFR), as these peaks are required as a
reference for peak filtering. If TRUE, the function instead proceeds without
peak filtering, potentially increasing runtime and memory usage
significantly.</p>
</td></tr>
<tr><td><code id="deconvolute_+3A_verbose">verbose</code></td>
<td>
<p>Logical. Whether to print log messages during the
deconvolution process.</p>
</td></tr>
<tr><td><code id="deconvolute_+3A_nworkers">nworkers</code></td>
<td>
<p>Number of workers to use for parallel processing. If
<code>"auto"</code>, the number of workers will be determined automatically. If a number
greater than 1, it will be limited to the number of spectra.</p>
</td></tr>
<tr><td><code id="deconvolute_+3A_data_path">data_path</code></td>
<td>
<p>Either the path to a directory containing measured NMR
spectra, a dataframe as returned by <code><a href="#topic+read_spectrum">read_spectrum()</a></code>, or a list of such
dataframes.</p>
</td></tr>
<tr><td><code id="deconvolute_+3A_file_format">file_format</code></td>
<td>
<p>The file_format of the spectrum file. E.g. <code>"bruker"</code> or <code>"jcampdx"</code>.</p>
</td></tr>
<tr><td><code id="deconvolute_+3A_make_rds">make_rds</code></td>
<td>
<p>Logical or character. If TRUE, stores results as an RDS file
on disk. If a character string, saves the RDS file with the specified name.
Should be set to TRUE if many spectra are evaluated to decrease computation
time.</p>
</td></tr>
<tr><td><code id="deconvolute_+3A_expno">expno</code>, <code id="deconvolute_+3A_procno">procno</code></td>
<td>
<p>The experiment/processing number for the file. E.g. <code>"10"</code>. Only relevant if
<code>file_format</code> equals <code>"bruker"</code>. For details see section <a href="https://spang-lab.github.io/metabodecon/articles/FAQ.html#file-structure">File Structure</a> in
the metabodecon FAQ.</p>
</td></tr>
<tr><td><code id="deconvolute_+3A_raw">raw</code></td>
<td>
<p>If <code>FALSE</code>, scales the returned signal intensities based on information
available in the spectrum metadata, in particular <code>NC_proc</code>. For details see
<code>processing-reference.pdf</code>, available at <a href="https://www.bruker.com/en.html">https://www.bruker.com/en.html</a> at
section 'Services &amp; Support &gt; Documentation &amp; Manuals &gt; Magnetic Resonance &gt;
Acquisition &amp; Processing &gt; TopSpin Processing Commands and Parameters'
(requires login).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>First, an automated curvature based signal selection is performed. Each
signal is represented by 3 data points to allow the determination of initial
Lorentz curves. These Lorentz curves are then iteratively adjusted to
optimally approximate the measured spectrum.
</p>
<p><code><a href="#topic+generate_lorentz_curves_sim">generate_lorentz_curves_sim()</a></code> is identical to <code><a href="#topic+generate_lorentz_curves">generate_lorentz_curves()</a></code>
except for the defaults, which are optimized for deconvoluting the 'Sim'
dataset, shipped with 'metabodecon'. The 'Sim' dataset is a simulated
dataset, which is much smaller than a real NMR spectra and lacks a water
signal. This makes it ideal for use in examples or as a default value for
functions. However, the default values for <code>sfr</code>, <code>wshw</code>, and <code>delta</code> in the
&quot;normal&quot; <code><a href="#topic+generate_lorentz_curves">generate_lorentz_curves()</a></code> function are not optimal for this
dataset. To avoid having to define the optimal parameters repeatedly in
examples, this function is provided to deconvolute the &quot;Sim&quot; dataset with
suitable parameters.
</p>
<p>In <code><a href="#topic+generate_lorentz_curves">generate_lorentz_curves()</a></code> the parameters <code>nfit</code>, <code>smopts</code>, <code>delta</code>,
<code>sfr</code> and <code>wshw</code> must be fully specified. In <code><a href="#topic+deconvolute">deconvolute()</a></code>, these
parameters can be set to <code>NULL</code> (the default value). In this case, the
function will try to determine the optimal values for these parameters
automatically. The values chosen are stored in field <code>args</code> of the returned
<code>decon2</code> object.
</p>


<h3>Value</h3>

<p>A 'decon2' object as described in <a href="#topic+metabodecon_classes">metabodecon_classes</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Define the paths to the example datasets we want to deconvolute:
## `sim_dir`: directory containing 16 simulated spectra
## `sim_01`: path to the first spectrum in the `sim` directory
## `sim_01_spec`: the first spectrum in the `sim` directory as a dataframe

sim_dir &lt;- metabodecon_file("sim_subset")
sim_1_dir &lt;- file.path(sim_dir, "sim_01")
sim_2_dir &lt;- file.path(sim_dir, "sim_02")
sim_1_spectrum &lt;- read_spectrum(sim_1_dir)
sim_2_spectrum &lt;- read_spectrum(sim_2_dir)
sim_spectra &lt;- read_spectra(sim_dir)


## Show that `generate_lorentz_curves()` and `generate_lorentz_curves_sim()`
## produce the same results:

sim_1_decon0 &lt;- generate_lorentz_curves(
    data_path = sim_1_dir, # Path to directory containing spectra
    sfr = c(3.55, 3.35), # Borders of signal free region (SFR) in ppm
    wshw = 0, # Half width of water signal (WS) in ppm
    ask = FALSE, # Don't ask for user input
    verbose = FALSE # Suppress status messages
)
sim_1_decon1 &lt;- generate_lorentz_curves_sim(sim_1_dir)
stopifnot(all.equal(sim_1_decon0, sim_1_decon1))


## Show that passing a spectrum produces the same results as passing the
## the corresponding directory:

decon_from_spectrum_dir &lt;- generate_lorentz_curves_sim(sim_1_dir)
decon_from_spectrum_obj &lt;- generate_lorentz_curves_sim(sim_1_spectrum)
decons_from_spectra_obj &lt;- generate_lorentz_curves_sim(sim_spectra)
decons_from_spectra_dir &lt;- generate_lorentz_curves_sim(sim_dir)

most.equal &lt;- function(x1, x2) {
    ignore &lt;- which(names(x1) %in% c("number_of_files", "filename"))
    equal &lt;- all.equal(x1[-ignore], x2[-ignore])
    invisible(stopifnot(isTRUE(equal)))
}

all.equal(  decon_from_spectrum_dir, decon_from_spectrum_obj     )
all.equal(  decons_from_spectra_dir, decons_from_spectra_obj     )
most.equal( decon_from_spectrum_dir, decons_from_spectra_obj[[1]])
most.equal( decon_from_spectrum_dir, decons_from_spectra_dir[[1]])
</code></pre>

<hr>
<h2 id='dohCluster'>Cluster Based Peak Alignment</h2><span id='topic+dohCluster'></span>

<h3>Description</h3>

<p>Rewrite of <code>speaq::dohCluster()</code>, compatible with the data format returned by
'generate_lorentz_curves()' and 'gen_feat_mat()'. The function name
&quot;dohCluster&quot; comes from &quot;Do Hierarchical Clustering&quot; which is part of the
Alignment algorithm proposed by Vu et al. (2011) in
<a href="doi:10.1186/1471-2105-12-405">doi:10.1186/1471-2105-12-405</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dohCluster(
  X,
  peakList,
  refInd = 0,
  maxShift = 100,
  acceptLostPeak = TRUE,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dohCluster_+3A_x">X</code></td>
<td>
<p>Dataframe of signal intensities from all spectra as returned by
<code><a href="#topic+gen_feat_mat">gen_feat_mat()</a></code>.</p>
</td></tr>
<tr><td><code id="dohCluster_+3A_peaklist">peakList</code></td>
<td>
<p>List of peak indices as returned <code><a href="#topic+gen_feat_mat">gen_feat_mat()</a></code>.</p>
</td></tr>
<tr><td><code id="dohCluster_+3A_refind">refInd</code></td>
<td>
<p>Number of the reference spectrum i.e. the spectrum to which all
signals will be aligned to.</p>
</td></tr>
<tr><td><code id="dohCluster_+3A_maxshift">maxShift</code></td>
<td>
<p>Maximum number of points a value can be moved.</p>
</td></tr>
<tr><td><code id="dohCluster_+3A_acceptlostpeak">acceptLostPeak</code></td>
<td>
<p>Whether to allow the the alignment algorithm to ignore
peaks that cannot easily be aligned with the reference spectrum.</p>
</td></tr>
<tr><td><code id="dohCluster_+3A_verbose">verbose</code></td>
<td>
<p>Whether to print additional information during the alignment
process.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing two data frames <code>Y</code> and <code>new_peakList</code>. The first one
contains the aligned spectra, the second one contains the aligned signals of
each spectrum.
</p>


<h3>Author(s)</h3>

<p>Initial version from Wolfram Gronwald.
Refactored by Tobias Schmidt in 2024.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sim_subset &lt;- metabodecon_file("bruker/sim_subset")
decons &lt;- generate_lorentz_curves_sim(sim_subset)
feat &lt;- gen_feat_mat(decons)
refObj &lt;- speaq::findRef(feat$peakList)
hclObj &lt;- dohCluster(
     X = feat$data_matrix,
     peakList = feat$peakList,
     refInd = refObj$refInd,
     maxShift = 100,
     acceptLostPeak = TRUE,
     verbose = TRUE
)
str(hclObj, 1)
</code></pre>

<hr>
<h2 id='download_example_datasets'>Download metabodecon Example Datasets</h2><span id='topic+download_example_datasets'></span>

<h3>Description</h3>

<p>Downloads example datasets that can be used to test the
functionality of the metabodecon package. These datasets are not included in
the package by default due to size constraints. The datasets are downloaded
as zip file and extracted automatically, unless extraction is disabled by the
user.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>download_example_datasets(
  dst_dir = NULL,
  extract = TRUE,
  persistent = NULL,
  overwrite = FALSE,
  silent = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="download_example_datasets_+3A_dst_dir">dst_dir</code></td>
<td>
<p>The destination directory where the downloaded datasets will be stored. If
NULL, the function will return the path to the cached zip file.</p>
</td></tr>
<tr><td><code id="download_example_datasets_+3A_extract">extract</code></td>
<td>
<p>Logical. If TRUE, the downloaded zip file will be extracted.</p>
</td></tr>
<tr><td><code id="download_example_datasets_+3A_persistent">persistent</code></td>
<td>
<p>Logical. If TRUE, the downloaded datasets will be cached at
<code><a href="#topic+datadir_persistent">datadir_persistent()</a></code> to speed up future calls to
<code>download_example_datasets()</code>. If FALSE, the datasets will be cached at
<code><a href="#topic+datadir_temp">datadir_temp()</a></code>. If NULL, the function will check both paths for the cached
datasets but will return <code><a href="#topic+datadir_temp">datadir_temp()</a></code> if the cached file does not yet
exist.</p>
</td></tr>
<tr><td><code id="download_example_datasets_+3A_overwrite">overwrite</code></td>
<td>
<p>Logical. If TRUE, existing files with the same name in the destination
directory will be overwritten.</p>
</td></tr>
<tr><td><code id="download_example_datasets_+3A_silent">silent</code></td>
<td>
<p>Logical. If TRUE, no output will be printed to the console.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The path to the downloaded (and possibly extracted) datasets.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+datadir">datadir()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if (interactive()) {
     zip &lt;- download_example_datasets(extract = FALSE, persistent = FALSE)
     dir &lt;- download_example_datasets(extract = TRUE)
}

</code></pre>

<hr>
<h2 id='draw_spectrum'>Draw Spectrum</h2><span id='topic+draw_spectrum'></span>

<h3>Description</h3>

<p>Draws a single spectrum.  Internally  used  by  <code><a href="#topic+plot_spectrum">plot_spectrum()</a></code>,  which  is
usually  the  recommended  way  to  plot  spectra.  For  usage  examples  see
<a href="https://github.com/spang-lab/metabodecon/blob/main/tests/testthat/test-draw_spectrum.R">test/testthat/test-draw_spectrum.R</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>draw_spectrum(
  obj,
  foc_rgn = NULL,
  foc_frac = NULL,
  foc_only = TRUE,
  add = FALSE,
  fig_rgn = NULL,
  main = NULL,
  show = TRUE,
  show_d2 = FALSE,
  truepar = NULL,
  mar = c(4.1, 5.1, 0.1, 0.1),
  si_line = list(),
  sm_line = list(),
  sp_line = list(),
  d2_line = list(),
  lc_lines = list(),
  tp_lines = list(),
  cent_pts = list(),
  bord_pts = list(),
  norm_pts = list(),
  bg_rect = list(),
  foc_rect = list(),
  lc_rects = list(),
  tp_rects = list(),
  bt_axis = list(),
  lt_axis = list(),
  tp_axis = list(),
  rt_axis = list(),
  tp_verts = list(),
  lc_verts = list(),
  lgd = list()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="draw_spectrum_+3A_obj">obj</code></td>
<td>
<p>An object of type <code>spectrum</code> or <code>decon2</code>. For details see
<a href="#topic+metabodecon_classes">metabodecon_classes</a>.</p>
</td></tr>
<tr><td><code id="draw_spectrum_+3A_foc_rgn">foc_rgn</code></td>
<td>
<p>Numeric vector specifying the start and end of focus region in ppm.</p>
</td></tr>
<tr><td><code id="draw_spectrum_+3A_foc_frac">foc_frac</code></td>
<td>
<p>Numeric vector specifying the start and end of focus region as fraction of
the full spectrum width.</p>
</td></tr>
<tr><td><code id="draw_spectrum_+3A_foc_only">foc_only</code></td>
<td>
<p>Logical. If TRUE, only the focused region is drawn. If FALSE, the full
spectrum is drawn.</p>
</td></tr>
<tr><td><code id="draw_spectrum_+3A_add">add</code></td>
<td>
<p>If TRUE, draw into the currently open figure. If FALSE, start a new figure.</p>
</td></tr>
<tr><td><code id="draw_spectrum_+3A_fig_rgn">fig_rgn</code></td>
<td>
<p>Drawing region in normalized device coordinates as vector of the form <code>c(x1, x2, y1, y2)</code>.</p>
</td></tr>
<tr><td><code id="draw_spectrum_+3A_main">main</code></td>
<td>
<p>Main title of the plot. Drawn via <code><a href="graphics.html#topic+title">title()</a></code>.</p>
</td></tr>
<tr><td><code id="draw_spectrum_+3A_show">show</code></td>
<td>
<p>Logical. If FALSE, the function returns without doing anything.</p>
</td></tr>
<tr><td><code id="draw_spectrum_+3A_show_d2">show_d2</code></td>
<td>
<p>Logical. If TRUE, the second derivative of the spectrum is drawn. Setting
this to TRUE changes most of the defaults for the drawing, e.g. by disabling
the drawing of anything related to signal intensities and by changing the
y-axis label to &quot;Second Derivative&quot;.</p>
</td></tr>
<tr><td><code id="draw_spectrum_+3A_truepar">truepar</code></td>
<td>
<p>Data frame with columns x0, A and lambda containing the true lorentzian that
were used to simulate the spectrum. Required if any <code style="white-space: pre;">&#8288;tp_*&#8288;</code> argument is set.</p>
</td></tr>
<tr><td><code id="draw_spectrum_+3A_mar">mar</code></td>
<td>
<p>Number of lines below/left-of/above/right-of plot region.</p>
</td></tr>
<tr><td><code id="draw_spectrum_+3A_si_line">si_line</code>, <code id="draw_spectrum_+3A_sm_line">sm_line</code>, <code id="draw_spectrum_+3A_lc_lines">lc_lines</code>, <code id="draw_spectrum_+3A_sp_line">sp_line</code>, <code id="draw_spectrum_+3A_d2_line">d2_line</code>, <code id="draw_spectrum_+3A_tp_lines">tp_lines</code></td>
<td>
<p>List  of  parameters  passed  to  <code><a href="graphics.html#topic+lines">lines()</a></code>  when  drawing  the  raw signal
intensities, smoothed signal intensities, lorentzian curves found by
deconvolution, superposition of lorentzian curves, second derivative and/or
true lorentzian curves.</p>
</td></tr>
<tr><td><code id="draw_spectrum_+3A_cent_pts">cent_pts</code>, <code id="draw_spectrum_+3A_bord_pts">bord_pts</code>, <code id="draw_spectrum_+3A_norm_pts">norm_pts</code></td>
<td>
<p>List of parameters passed to <code><a href="graphics.html#topic+points">points()</a></code> when drawing the peak center  points,
peak border points and non-peak points.</p>
</td></tr>
<tr><td><code id="draw_spectrum_+3A_bg_rect">bg_rect</code>, <code id="draw_spectrum_+3A_lc_rects">lc_rects</code>, <code id="draw_spectrum_+3A_foc_rect">foc_rect</code>, <code id="draw_spectrum_+3A_tp_rects">tp_rects</code></td>
<td>
<p>List of parameters passed to <code><a href="graphics.html#topic+rect">rect()</a></code> when drawing the background, lorentzian
curve substitutes, focus rectangle and/or true lorentzian curve substitutes.</p>
</td></tr>
<tr><td><code id="draw_spectrum_+3A_bt_axis">bt_axis</code>, <code id="draw_spectrum_+3A_lt_axis">lt_axis</code>, <code id="draw_spectrum_+3A_tp_axis">tp_axis</code>, <code id="draw_spectrum_+3A_rt_axis">rt_axis</code></td>
<td>
<p>List of parameters used to overwrite the default values  passed  to  <code><a href="graphics.html#topic+axis">axis()</a></code>
when drawing the bottom, left,  top  and  right  axis.  In  addition  to  the
parameters of <code><a href="graphics.html#topic+axis">axis()</a></code>, the following additional parameters are supported  as
well:
</p>

<ul>
<li> <p><code>text</code>:   Description for the axis. Drawn via <code><a href="graphics.html#topic+mtext">mtext()</a></code>.
</p>
</li>
<li> <p><code>n</code>:      Number of tickmarks.
</p>
</li>
<li> <p><code>digits</code>: Number of digits for rounding the labels. If a vector of numbers
is provided, all numbers are tried, until <code>n</code> unique labels are
found. See 'Details'.
</p>
</li>
<li> <p><code>sf</code>:     Scaling factor. Axis values are divided by this number before the
labels are calculated. If you set this to anything unequal 1, you
should also choose <code>text</code> in a way that reflects the scaling.
E.g. if you set <code>sf = 1e6</code> you could change the text from
<code>"Signal Intensity [au]"</code> to <code>"Signal Intensity [Mau]"</code> or
<code>"Signal Intensity [au] / 1e6"</code>, with <code>"Mau"</code> meaning
&quot;Mega-Arbitrary-Units&quot;.
</p>
</li></ul>
</td></tr>
<tr><td><code id="draw_spectrum_+3A_lc_verts">lc_verts</code>, <code id="draw_spectrum_+3A_tp_verts">tp_verts</code></td>
<td>
<p>List of parameters passed to <code><a href="graphics.html#topic+abline">abline()</a></code> when drawing vertical lines at the
centers of estimated lorentzian curves and/or true lorentzian curves. Setting
tp_verts$show to TRUE requires <code>truepar</code> to be set.</p>
</td></tr>
<tr><td><code id="draw_spectrum_+3A_lgd">lgd</code></td>
<td>
<p>List of parameters passed to <code><a href="graphics.html#topic+legend">legend()</a></code> when drawing the legend.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Parameters <code>bt_axis</code>, <code>lt_axis</code>, <code>tp_axis</code> and <code>rt_axis</code> all  support  option
<code>n</code> and <code>digits</code>, where <code>n = 5</code> means &quot;Draw 5 tickmarks over  the  full  axis
range&quot; and <code>digits = 3</code> means &quot;round the label shown beside each tickmark  to
3 digits&quot;. If <code>n</code> is omitted, a suitable value is chosen automatically using
<code><a href="graphics.html#topic+axTicks">axTicks()</a></code>. If <code>digits</code> is omitted, a default of <code>2:12</code> is used. Providing a
vector of <code>digits</code> causes each digit to be tried as argument  for  <code><a href="base.html#topic+round">round()</a></code>,
until a digit is encountered that results in <code>n</code> unique labels. Example:
</p>
<p>Assume we have <code>n = 4</code> and the corresponding  calculated  tickmark  positions
are: 1.02421, 1.02542, 1.02663 and 1.02784. If we provide <code>digits = 1:5</code>, the
following roundings are tried:</p>

<table>
<tr>
 <td style="text-align: left;">
   digit </td><td style="text-align: left;"> label 1 </td><td style="text-align: left;"> label 2 </td><td style="text-align: left;"> label 3 </td><td style="text-align: left;"> label 4 </td>
</tr>
<tr>
 <td style="text-align: left;">
   1 </td><td style="text-align: left;"> 1 </td><td style="text-align: left;"> 1 </td><td style="text-align: left;"> 1 </td><td style="text-align: left;"> 1 </td>
</tr>
<tr>
 <td style="text-align: left;">
   2 </td><td style="text-align: left;"> 1.02 </td><td style="text-align: left;"> 1.03 </td><td style="text-align: left;"> 1.03 </td><td style="text-align: left;"> 1.03 </td>
</tr>
<tr>
 <td style="text-align: left;">
   3 </td><td style="text-align: left;"> 1.024 </td><td style="text-align: left;"> 1.025 </td><td style="text-align: left;"> 1.027 </td><td style="text-align: left;"> 1.028 </td>
</tr>
<tr>
 <td style="text-align: left;">
   4 </td><td style="text-align: left;"> 1.0242 </td><td style="text-align: left;"> 1.0254 </td><td style="text-align: left;"> 1.0266 </td><td style="text-align: left;"> 1.0278 </td>
</tr>
<tr>
 <td style="text-align: left;">
   5 </td><td style="text-align: left;"> 1.02421 </td><td style="text-align: left;"> 1.02542 </td><td style="text-align: left;"> 1.02663 </td><td style="text-align: left;"> 1.02784 </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>In the above example the process would stop at <code>digit = 3</code>, because  at  this
point we have n = 4 unique labels (1.024, 1.025, 1.027 and 1.028).
</p>


<h3>Value</h3>

<p>NULL. Called for side effect of plotting.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>decon &lt;- deconvolute(sim[[1]], sfr = c(3.55, 3.35))
draw_spectrum(obj = decon)
draw_spectrum(obj = decon, lgd = list(x = "top", bg = NA))
draw_spectrum(obj = decon, foc_rgn = c(3.45, 3.37))
draw_spectrum(obj = decon, fig = c(0.1, 0.4, 0.30, 0.45), add = TRUE)
draw_spectrum(obj = decon, fig = c(0.1, 0.4, 0.05, 0.20), add = FALSE)
draw_spectrum(obj = decon, lc_lines = NULL, lc_rects = NULL, foc_only = FALSE)
</code></pre>

<hr>
<h2 id='evalwith'>Evaluate an expression with predefined global state</h2><span id='topic+evalwith'></span>

<h3>Description</h3>

<p>Evaluates an expression with a predefined global state, including the:
</p>

<ul>
<li><p> working directory (set via <code><a href="base.html#topic+setwd">setwd()</a></code>)
</p>
</li>
<li><p> global options (set via <code><a href="base.html#topic+options">options()</a></code>)
</p>
</li>
<li><p> graphical parameters (set via <code><a href="graphics.html#topic+par">par()</a></code>)
</p>
</li></ul>

<p>In addition to that, <code>evalwith</code> allows to:
</p>

<ul>
<li><p> Redirect or capture the output and/or message stream via <code><a href="base.html#topic+sink">sink()</a></code>
</p>
</li>
<li><p> Measure the runtime of the evaluated expression via <code><a href="base.html#topic+system.time">system.time()</a></code>
</p>
</li>
<li><p> Creating a temporary test directory (inside <code><a href="#topic+tmpdir">tmpdir()</a></code>) and populating it
with input files according to <code>inputs</code>
</p>
</li>
<li><p> Predefine answers for calls to <code><a href="base.html#topic+readline">readline()</a></code> happening during evaluation of
<code>expr</code>
</p>
</li>
<li><p> Caching the result of the expression
</p>
</li></ul>

<p>All changes to the global state are reverted after the expression has been
evaluated.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>evalwith(
  expr,
  testdir = NULL,
  answers = NULL,
  output = NULL,
  message = NULL,
  plot = NULL,
  datadir_temp = c("default", "missing", "empty", "filled")[1],
  datadir_persistent = c("default", "missing", "empty", "filled")[1],
  inputs = character(),
  opts = NULL,
  pars = NULL,
  cache = FALSE,
  overwrite = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="evalwith_+3A_expr">expr</code></td>
<td>
<p>Expression to be evaluated.</p>
</td></tr>
<tr><td><code id="evalwith_+3A_testdir">testdir</code></td>
<td>
<p>ID of the test directory. E.g. <code>"xyz/2"</code>. Will be created and
populated with <code>inputs</code>. To clear, use <code>clear(testdir("xyz/2"))</code>.</p>
</td></tr>
<tr><td><code id="evalwith_+3A_answers">answers</code></td>
<td>
<p>Answers to be returned by readline().</p>
</td></tr>
<tr><td><code id="evalwith_+3A_output">output</code></td>
<td>
<p>Path to the file where output stream should be redirected to.
Use <code>"captured"</code> to capture the output.</p>
</td></tr>
<tr><td><code id="evalwith_+3A_message">message</code></td>
<td>
<p>Path to the file where message stream be redirected to. Use
<code>"captured"</code> to capture the messages.</p>
</td></tr>
<tr><td><code id="evalwith_+3A_plot">plot</code></td>
<td>
<p>An expression opening a device, the string &quot;captured&quot; or a path
ending in &quot;.pdf&quot;, &quot;.svg&quot;, or &quot;.png&quot;. Examples: <code>svg("tmp.svg")</code>,
<code>quote(pdf("tmp.pdf"))</code>, <code>"captured"</code>, <code>"tmp.png"</code>. Passing <code>"captured"</code> is
equivalent to passing <code>tempfile(fileext = ".png")</code>.</p>
</td></tr>
<tr><td><code id="evalwith_+3A_datadir_temp">datadir_temp</code></td>
<td>
<p>State of the mocked temporary data directory. See details
section.</p>
</td></tr>
<tr><td><code id="evalwith_+3A_datadir_persistent">datadir_persistent</code></td>
<td>
<p>State of the mocked persistent data directory. See
details section.</p>
</td></tr>
<tr><td><code id="evalwith_+3A_inputs">inputs</code></td>
<td>
<p>Paths to be copied to the test directory before evaluating
<code>expr</code>.</p>
</td></tr>
<tr><td><code id="evalwith_+3A_opts">opts</code></td>
<td>
<p>Named list of options to be set. See <code><a href="base.html#topic+options">options()</a></code>.</p>
</td></tr>
<tr><td><code id="evalwith_+3A_pars">pars</code></td>
<td>
<p>Named list of parameters to be set. See <code><a href="graphics.html#topic+par">par()</a></code>.</p>
</td></tr>
<tr><td><code id="evalwith_+3A_cache">cache</code></td>
<td>
<p>Logical indicating whether to cache the result of the
expression.</p>
</td></tr>
<tr><td><code id="evalwith_+3A_overwrite">overwrite</code></td>
<td>
<p>Logical indicating whether to overwrite the cache file if it
already exists.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>datadir_temp</code> and <code>datadir_persistent</code> arguments accept values
&quot;missing&quot;, &quot;filled&quot; and &quot;empty&quot;. Setting a value unequal NULL causes the
functions <code><a href="#topic+datadir_temp">datadir_temp()</a></code> and/or <code><a href="#topic+datadir_persistent">datadir_persistent()</a></code> to be replaced with
mock functions pointing to fake directories. Functions depending on these
functions will then use the fake directories instead of the real ones. When
set to &quot;missing&quot; the returned mock directory does not exist. When set to
&quot;empty&quot; it exists and is guaranteed to be empty. When set to &quot;filled&quot;, it is
populated with example datasets.
</p>
<p>Attention: the mocked functions, i.e. <code><a href="#topic+datadir_temp">datadir_temp()</a></code> and
<code><a href="#topic+datadir_persistent">datadir_persistent()</a></code> cannot be used directly inside <code>expr</code> when called via
<code>devtools::test()</code>. I'm not sure why, but it seems as if devtools and/or
testthat have their own copies of the functions which are used when the
expression is evaluated.
</p>


<h3>Value</h3>

<p>A list containing with following elements:
</p>

<ul>
<li> <p><code>rv</code>: The return value of the expression.
</p>
</li>
<li> <p><code>runtime</code>: The &quot;elapsed&quot; runtime of the expression in seconds. Measured
with <code><a href="base.html#topic+system.time">system.time()</a></code>.
</p>
</li>
<li> <p><code>output</code>: The captured output.
</p>
</li>
<li> <p><code>message</code>: The captured messages.
</p>
</li>
<li> <p><code>plot</code>: The path to the saved plot.
</p>
</li>
<li> <p><code>testdir</code>: The path to the test directory.
</p>
</li>
<li> <p><code>inputs</code>: The paths to the copied input files.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>x1 &lt;- evalwith(output = "captured", cat("Helloworld\n"))
str(x1)

x2 &lt;- evalwith(datadir_persistent = "missing", message = "captured", datadir())
str(x2)

x3 &lt;- evalwith(testdir = "dummy", inputs = "bruker/urine/urine_1", dir())
str(x3)

x4 &lt;- evalwith(Sys.sleep(0.02))
str(x4)
</code></pre>

<hr>
<h2 id='gen_feat_mat'>Generate Feature Matrix.</h2><span id='topic+gen_feat_mat'></span>

<h3>Description</h3>

<p>Generate a feature matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gen_feat_mat(
  data_path,
  ppm_range = get_ppm_range(data_path),
  si_size_real_spectrum = length(data_path$y_values),
  scale_factor_x = 1000,
  warn = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gen_feat_mat_+3A_data_path">data_path</code></td>
<td>
<p>A list of deconvoluted spectra as returned by
<code>generate_lorentz_curves()</code>. In older versions, this could also be the path
passed to <code>generate_lorentz_curves()</code>, but this is deprecated and will
trigger a warning. See 'Details' for more information.</p>
</td></tr>
<tr><td><code id="gen_feat_mat_+3A_ppm_range">ppm_range</code></td>
<td>
<p>The ppm range over which your signals are distributed.</p>
</td></tr>
<tr><td><code id="gen_feat_mat_+3A_si_size_real_spectrum">si_size_real_spectrum</code></td>
<td>
<p>Number of data points in your spectra.</p>
</td></tr>
<tr><td><code id="gen_feat_mat_+3A_scale_factor_x">scale_factor_x</code></td>
<td>
<p>The x scale factor used during the deconvolution.</p>
</td></tr>
<tr><td><code id="gen_feat_mat_+3A_warn">warn</code></td>
<td>
<p>Whether to print a warning in case a file path is passed to
<code>data_path</code> instead of a list of deconvoluted spectra.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Before version 1.2 of 'metabodecon', the deconvolution functions
<code>generate_lorentz_curves</code> and <code>MetaboDecon1D</code> wrote their output partially as
txt files to their input folder. Back then, <code>gen_feat_mat()</code> used those txt
files as input to generate the feature matrix. Since version 1.2 these txt
files are no longer created by default, to prevent accidental modifications
of the input folders. Therefore, the recommended way to pass the required
information to <code>gen_feat_mat()</code> is to directly pass the output of
<code>generate_lorentz_curves()</code> to <code>gen_feat_mat()</code>. However, to stay backwards
compatible, the name of parameter <code>data_path</code> was not changed and passing an
actual path to <code>data_path</code> is still possible, but will result in a warning
(unless <code>warn</code> is set to <code>FALSE</code>).
</p>


<h3>Value</h3>

<p>A list with the following elements:
</p>
<p><code>data_matrix</code>: A data.frame where each row corresponds to one spectrum and
each column to one data point, i.e. for 10 input spectra
with 131072 data points each <code>data_matrix</code> would have
dimensions 10 x 131072.
</p>
<p><code>peakList</code>: A list of vectors, where each vector contains the indices of
the peaks in the corresponding spectrum. The indices increase
from left to right, i.e. the smallest index corresponds to the
highest ppm value, as the ppm values decrease from left to
right.
</p>
<p><code>w</code>: A list of vectors where each vector contains the &quot;position parameter&quot;
of the peaks in the corresponding spectrum.
</p>
<p><code>A</code>: A list of vectors where each vector contains the &quot;area parameter&quot; of
the peaks in the corresponding spectrum.
</p>
<p><code>lambda</code>: A list of vectors where each vector contains the &quot;width
parameter&quot; of the peaks in the corresponding spectrum.
</p>


<h3>Author(s)</h3>

<p>Initial version from Wolfram Gronwald.
Refactored by Tobias Schmidt in 2024.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sim_subset &lt;- metabodecon_file("sim_subset")
decons &lt;- generate_lorentz_curves_sim(sim_subset)
obj &lt;- gen_feat_mat(decons)
str(obj, 2, give.attr = FALSE)
</code></pre>

<hr>
<h2 id='get_data_dir'>Retrieve directory path of an example dataset</h2><span id='topic+get_data_dir'></span>

<h3>Description</h3>

<p>Returns the path to the directory storing the example files shipped with
metabodecon.
</p>
<p>Deprecated since metabodecon v1.2.0. Please use <code><a href="#topic+datadir">datadir()</a></code> instead. See
examples below for usage.
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_data_dir(dataset_name = c("", "blood", "test", "urine"), warn = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_data_dir_+3A_dataset_name">dataset_name</code></td>
<td>
<p>Either <code>""</code>, <code>"test"</code>, <code>"blood"</code> or <code>"urine"</code>.</p>
</td></tr>
<tr><td><code id="get_data_dir_+3A_warn">warn</code></td>
<td>
<p>Whether to print a warning message when the example folders do
not yet exist, i.e. <code><a href="#topic+download_example_datasets">download_example_datasets()</a></code> has not been called yet.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Path to the directory storing the example files.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+download_example_datasets">download_example_datasets()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- get_data_dir("urine")                     # Deprecated
y &lt;- datadir("example_datasets/bruker/urine")  # Preferred
cat(x, y, sep = "\n")
</code></pre>

<hr>
<h2 id='get_ppm_range'>Get PPM Range covered by Spectra</h2><span id='topic+get_ppm_range'></span>

<h3>Description</h3>

<p>Returns the ppm range across all peaks of the provided deconvoluted spectra.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_ppm_range(spectrum_data, full_range = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_ppm_range_+3A_spectrum_data">spectrum_data</code></td>
<td>
<p>A list of deconvoluted spectra as returned by <code><a href="#topic+generate_lorentz_curves">generate_lorentz_curves()</a></code>.</p>
</td></tr>
<tr><td><code id="get_ppm_range_+3A_full_range">full_range</code></td>
<td>
<p>If TRUE, the full range of the spectra is returned. If FALSE, only the range
from the lowest to the highest peak center is returned.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector containing the lowest and highest ppm value over all peaks of the
provided deconvoluted spectra.
</p>


<h3>Author(s)</h3>

<p>Wolfram Gronwald, 2023: initial version.
Tobias Schmidt, 2024: .
</p>


<h3>Examples</h3>

<pre><code class='language-R'>spectrum_data &lt;- generate_lorentz_curves(
    data_path = sim[1:2],
    nfit = 3,
    sfr = c(3.55, 3.35),
    wshw = 0,
    ask = FALSE,
    verbose = FALSE
)
ppm_rng &lt;- get_ppm_range(spectrum_data)
print(ppm_rng)
</code></pre>

<hr>
<h2 id='is_metabodecon_class'>Is an Object from a Metabodecon Class?</h2><span id='topic+is_metabodecon_class'></span><span id='topic+is_spectrum'></span><span id='topic+is_ispec'></span><span id='topic+is_idecon'></span><span id='topic+is_decon0'></span><span id='topic+is_decon1'></span><span id='topic+is_decon2'></span><span id='topic+is_align'></span><span id='topic+is_spectra'></span><span id='topic+is_ispecs'></span><span id='topic+is_idecons'></span><span id='topic+is_decons0'></span><span id='topic+is_decons1'></span><span id='topic+is_decons2'></span><span id='topic+is_aligns'></span>

<h3>Description</h3>

<p>Check if an object is an instance of a specific 'Metabodecon
Class'. See <a href="#topic+metabodecon_classes">metabodecon_classes</a> for a list of classes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_spectrum(x, check_class = TRUE, check_contents = FALSE)

is_ispec(x)

is_idecon(x)

is_decon0(x)

is_decon1(x)

is_decon2(x)

is_align(x)

is_spectra(
  x,
  check_class = TRUE,
  check_contents = FALSE,
  check_child_classes = FALSE
)

is_ispecs(x)

is_idecons(x)

is_decons0(x)

is_decons1(x)

is_decons2(x)

is_aligns(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="is_metabodecon_class_+3A_x">x</code></td>
<td>
<p>The object to check.</p>
</td></tr>
<tr><td><code id="is_metabodecon_class_+3A_check_class">check_class</code></td>
<td>
<p>Logical indicating whether to check the class of the object.</p>
</td></tr>
<tr><td><code id="is_metabodecon_class_+3A_check_contents">check_contents</code></td>
<td>
<p>Logical indicating whether to check the contents of the object.</p>
</td></tr>
<tr><td><code id="is_metabodecon_class_+3A_check_child_classes">check_child_classes</code></td>
<td>
<p>Logical indicating whether to check the class of each element of the object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>TRUE if the object is an instance of the specified class, otherwise FALSE.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ss &lt;- sim[1:2]
dd &lt;- deconvolute(ss, sfr = c(3.55, 3.35))
aa &lt;- align(dd)
s1 &lt;- sim[[1]]
d1 &lt;- dd[[1]]
a1 &lt;- aa[[1]]

is_spectrum(s1) # TRUE
is_spectrum(s1, check_contents = TRUE) # TRUE
is_decon0(d1) # FALSE
is_decon1(d1) # FALSE
is_decon2(d1) # TRUE
is_align(a1)  # TRUE

is_spectra(ss) # TRUE
is_decons0(dd) # FALSE
is_decons1(dd) # FALSE
is_decons2(dd) # TRUE
is_aligns(aa)  # TRUE

</code></pre>

<hr>
<h2 id='make_spectrum'>Create a Spectrum Object</h2><span id='topic+make_spectrum'></span>

<h3>Description</h3>

<p>Creates a spectrum object from the provided signal intensities, frequencies
and chemical shifts.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make_spectrum(
  si,
  cs_max,
  cs_width,
  fq_ref,
  fq_width = NULL,
  force = FALSE,
  silent = FALSE,
  name = NULL,
  path = NULL,
  type = NULL,
  simpar = NULL,
  mfs = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="make_spectrum_+3A_si">si</code></td>
<td>
<p>Numeric vector of signal intensities, ordered from highest to lowest
corresponding chemical shift.</p>
</td></tr>
<tr><td><code id="make_spectrum_+3A_cs_max">cs_max</code></td>
<td>
<p>The highest chemical shift value in ppm, usually shown as left end of the
spectrum.</p>
</td></tr>
<tr><td><code id="make_spectrum_+3A_cs_width">cs_width</code></td>
<td>
<p>The width of the spectrum in ppm.</p>
</td></tr>
<tr><td><code id="make_spectrum_+3A_fq_ref">fq_ref</code></td>
<td>
<p>The reference frequency in Hz.</p>
</td></tr>
<tr><td><code id="make_spectrum_+3A_fq_width">fq_width</code></td>
<td>
<p>The width of the spectrum in Hz. Only used to check whether the values
calculated from <code>cs_max</code>, <code>cs_width</code> and <code>fq_ref</code> match the provided value.
If <code>NULL</code>, this check will be skipped.</p>
</td></tr>
<tr><td><code id="make_spectrum_+3A_force">force</code></td>
<td>
<p>If <code>TRUE</code>, the function will not raise an error in case of
discrepancies between the calculated and the provided spectrum width in Hz,
but will print a info message instead. To hide this message as well, set
<code>silent = TRUE</code>.</p>
</td></tr>
<tr><td><code id="make_spectrum_+3A_silent">silent</code></td>
<td>
<p>If <code>TRUE</code>, no output will be printed to the console.</p>
</td></tr>
<tr><td><code id="make_spectrum_+3A_name">name</code></td>
<td>
<p>The name of the spectrum, e.g. &quot;Blood 1&quot; or &quot;Urine Mouse X23D&quot;.</p>
</td></tr>
<tr><td><code id="make_spectrum_+3A_path">path</code></td>
<td>
<p>The path to the spectrum file, e.g. &quot;/example_datasets/bruker/urine/urine_1&quot;.</p>
</td></tr>
<tr><td><code id="make_spectrum_+3A_type">type</code></td>
<td>
<p>The type of experiment, e.g. &quot;H1 CPMG&quot; or &quot;H1 NOESY&quot;.</p>
</td></tr>
<tr><td><code id="make_spectrum_+3A_simpar">simpar</code></td>
<td>
<p>The simulation parameters used to generate the spectrum.</p>
</td></tr>
<tr><td><code id="make_spectrum_+3A_mfs">mfs</code></td>
<td>
<p>The magnetic field strength in Tesla.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>spectrum</code> object as described in <a href="#topic+metabodecon_classes">metabodecon_classes</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>si &lt;- c(1, 1, 3, 7, 8, 3, 8, 5, 2, 1)
cs_max &lt;- 14.8
cs_width &lt;- 20.0
fq_ref &lt;- 600.25 * 1e6
fq_width &lt;- 12005
spectrum &lt;- make_spectrum(si, cs_max, cs_width, fq_ref, fq_width)
spectrum2 &lt;- make_spectrum(si, cs_max, cs_width, fq_ref, fq_width = 12010, force = FALSE)
</code></pre>

<hr>
<h2 id='metabodecon_classes'>Metabodecon Classes</h2><span id='topic+metabodecon_classes'></span>

<h3>Description</h3>

<p>Metabodecon introduces a set of classes to highlight the presence of  certain
elements in corresponding objects.
</p>
<p>The order of elements may vary between  different  versions  of  Metabodecon,
thus elements should always be accessed by name, for example, using <code>x$si</code> or
<code>x[["cs"]]</code>. A short description of each class is given in the listing below.
</p>

<ul>
<li> <p><code>spectrum</code>: One NMR spectrum
</p>
</li>
<li> <p><code>decon0</code>: One deconvoluted NMR spectrum stored in <code><a href="#topic+MetaboDecon1D">MetaboDecon1D()</a></code> format
</p>
</li>
<li> <p><code>decon1</code>: One deconvoluted NMR spectrum stored in <code><a href="#topic+generate_lorentz_curves">generate_lorentz_curves()</a></code> format
</p>
</li>
<li> <p><code>decon2</code>: One deconvoluted NMR spectrum stored in <code><a href="#topic+deconvolute">deconvolute()</a></code> format
</p>
</li>
<li> <p><code>align</code>: One aligned NMR spectrum
</p>
</li></ul>

<p>The classes mentioned above represent individual objects, such  as  a  single
spectrum, deconvolution,  or  alignment.  However,  it  is  often  useful  to
describe collections  of  these  objects,  such  as  a  list  of  spectra  or
deconvolutions.  Therefore,  for  each  individual  class,  a   corresponding
&quot;collection&quot;  class  is  provided.  These  collection  classes   are   named:
<code>spectra</code>, <code>decons0</code>, <code>decons1</code>, <code>decons2</code>, and <code>aligns</code>.
</p>
<p>More details can be found in Metabodecon's online documentation at
<a href="https://spang-lab.github.io/metabodecon/articles/Classes.html">spang-lab.github.io/metabodecon/articles/Metabodecon-Classes</a>.
</p>

<hr>
<h2 id='metabodecon_file'>Return Path to File or Directory in metabodecon Package</h2><span id='topic+metabodecon_file'></span>

<h3>Description</h3>

<p>Recursively searches for files or directories within the
'metabodecon' package that match the given name.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>metabodecon_file(name = "sim_01")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="metabodecon_file_+3A_name">name</code></td>
<td>
<p>The name to search for.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The file or directory path.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Unambiguous paths
metabodecon_file("urine_1")
metabodecon_file("urine_1.dx")
metabodecon_file("sim/sim_01")

# Ambiguous paths (i.e. multiple matches)
metabodecon_file("sim")
metabodecon_file("urine")

# Non-existing paths (i.e. a character vector of length zero gets returned)
metabodecon_file("asdfasdf")
</code></pre>

<hr>
<h2 id='MetaboDecon1D'>Deconvolute 1D NMR spectrum</h2><span id='topic+MetaboDecon1D'></span>

<h3>Description</h3>

<p>Automatic deconvolution of a 1D NMR spectrum into several Lorentz curves and
the integration of them. The NMR file needs to be in Bruker format or
jcamp-dx format.
</p>
<p>Deprecated since metabodecon v1.2.0. Please use <code><a href="#topic+generate_lorentz_curves">generate_lorentz_curves()</a></code>
instead. See examples below for usage.
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MetaboDecon1D(
  filepath,
  filename = NA,
  file_format = "bruker",
  number_iterations = 10,
  range_water_signal_ppm = 0.1527692,
  signal_free_region = c(11.44494, -1.8828),
  smoothing_param = c(2, 5),
  delta = 6.4,
  scale_factor = c(1000, 1e+06),
  debug = FALSE,
  store_results = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="MetaboDecon1D_+3A_filepath">filepath</code></td>
<td>
<p>Complete path of the file folder (Notice for Bruker format: filepath needs to
be the spectrum folder containing one or more different spectra
(e.g.&quot;C:/Users/Username/Desktop/spectra_from_bruker&quot;))</p>
</td></tr>
<tr><td><code id="MetaboDecon1D_+3A_filename">filename</code></td>
<td>
<p>Name of the NMR file. (Notice for Bruker format: filename need to be the name
of your spectrum which is also the name of the folder) (Default: filename =
NA to analyze more spectra at once)</p>
</td></tr>
<tr><td><code id="MetaboDecon1D_+3A_file_format">file_format</code></td>
<td>
<p>Format (bruker or jcampdx) of the NMR file. (Default: file_format = &quot;bruker&quot;)</p>
</td></tr>
<tr><td><code id="MetaboDecon1D_+3A_number_iterations">number_iterations</code></td>
<td>
<p>Number of iterations for the approximation of the parameters for the Lorentz
curves (Default: number_iterations=10)</p>
</td></tr>
<tr><td><code id="MetaboDecon1D_+3A_range_water_signal_ppm">range_water_signal_ppm</code></td>
<td>
<p>Half width of the water artefact in ppm (Default:
range_water_signal=0.1527692 (e.g. for urine NMR spectra))</p>
</td></tr>
<tr><td><code id="MetaboDecon1D_+3A_signal_free_region">signal_free_region</code></td>
<td>
<p>Row vector with two entries consisting of the ppm positions for the left and
right border of the signal free region of the spectrum. (Default:
signal_free_region=c(11.44494, -1.8828))</p>
</td></tr>
<tr><td><code id="MetaboDecon1D_+3A_smoothing_param">smoothing_param</code></td>
<td>
<p>Row vector with two entries consisting of the number of smoothing repeats for
the whole spectrum and the number of data points (uneven) for the mean
calculation (Default: smoothing_param=c(2,5))</p>
</td></tr>
<tr><td><code id="MetaboDecon1D_+3A_delta">delta</code></td>
<td>
<p>Defines the threshold value to distinguish between signal and noise (Default:
delta=6.4)</p>
</td></tr>
<tr><td><code id="MetaboDecon1D_+3A_scale_factor">scale_factor</code></td>
<td>
<p>Row vector with two entries consisting of the factor to scale the x-axis and
the factor to scale the y-axis (Default: scale_factor=c(1000,1000000))</p>
</td></tr>
<tr><td><code id="MetaboDecon1D_+3A_debug">debug</code></td>
<td>
<p>Logical value to activate the debug mode (Default: debug=FALSE)</p>
</td></tr>
<tr><td><code id="MetaboDecon1D_+3A_store_results">store_results</code></td>
<td>
<p>Specifies whether the lorentz curve parameters <code>A</code>, <code>lambda</code> and <code>x_0</code> and
the approximated spectrum should be stored on disk (in addition to returning
them). If <code>store_results</code> is <code>NULL</code> (default), the user is asked
interactively where the files should be stored. If FALSE, the results are not
stored. If TRUE, the results are stored in a subdirectory of R's per-session
temporary directory.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>decon0</code> object as described in <a href="#topic+metabodecon_classes">metabodecon_classes</a>.
</p>


<h3>Author(s)</h3>

<p>Martina Haeckl, 2021: Initial version.
Tobias Schmidt, 2024: Added parameters <code>debug</code> and <code>store_results</code>. Added
minor improvements to pass CRAN checks.
</p>


<h3>References</h3>

<p>Haeckl, M.; Tauber, P.; Schweda, F.; Zacharias, H.U.; Altenbuchinger, M.;
Oefner, P.J.; Gronwald, W. An R-Package for the Deconvolution and Integration
of 1D NMR Data: MetaboDecon1D. Metabolites 2021, 11, 452.
https://doi.org/10.3390/metabo11070452
</p>


<h3>See Also</h3>

<p><code><a href="#topic+calculate_lorentz_curves">calculate_lorentz_curves()</a></code>,
<code><a href="#topic+plot_triplets">plot_triplets()</a></code>,
<code><a href="#topic+plot_lorentz_curves_save_as_png">plot_lorentz_curves_save_as_png()</a></code>,
<code><a href="#topic+plot_spectrum_superposition_save_as_png">plot_spectrum_superposition_save_as_png()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## ATTENTION: using MetaboDecon1D() for deconvolution is deprecated. Please use
## generate_lorentz_curves() instead.

## The following example shows how a subset of the Sim dataset, consisting
## of two spectrum objects, can be deconvoluted using `MetaboDecon1D()`. The
## whole example code is wrapped into `evalwith()` to simulate user input.
## When using the function interactively, you should type in the answers to
## the questions manually.
expected_answers &lt;- c(
     "10",   # Subfolder of your filepath, i.e. the experiment number?
     "10",   # Subsubsubfolder of filepath, i.e. the processing number?
     "y",    # Use same parameters for all spectra?
     "1",    # File to adjust all parameters.
     "n",    # Signal free region borders correct selected?
     "3.55", # Left border.
     "3.35", # Right border.
     "y",    # Signal free region borders correct selected?
     "n",    # Water artefact fully inside red vertical lines?
     "0",    # Half width range (in ppm) for the water artefact.
     "y",    # Water artefact fully inside red vertical lines?
     "n"     # Save results as text documents?
)
sim &lt;- metabodecon_file("bruker/sim_subset")
evalwith(answers = expected_answers, {
     sim_decon &lt;- MetaboDecon1D(sim)
})

## Deconvolute only the first spectrum of the folder "bruker/sim_subset" into
evalwith(answers = expected_answers[-(3:4)], {
     sim_decon &lt;- MetaboDecon1D(sim, filename = "sim_01")
})

</code></pre>

<hr>
<h2 id='plot_lorentz_curves_save_as_png'>Plot lorentz curves for variable range</h2><span id='topic+plot_lorentz_curves_save_as_png'></span>

<h3>Description</h3>

<p>Plots the original spectrum and all generated Lorentz curves and save the
result as png under the filepath.
</p>
<p>Superseded by <code><a href="#topic+plot_spectrum">plot_spectrum()</a></code> since metabodecon v1.2.0. Will be replaced with
v2.<a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_lorentz_curves_save_as_png(
  deconv_result,
  x_range = c(),
  y_range = c(),
  out_dir = ".",
  ask = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_lorentz_curves_save_as_png_+3A_deconv_result">deconv_result</code></td>
<td>
<p>Saved result of the MetaboDecon1D() function</p>
</td></tr>
<tr><td><code id="plot_lorentz_curves_save_as_png_+3A_x_range">x_range</code></td>
<td>
<p>Row vector with two entries consisting of the ppm start and the ppm end value
to scale the range of the x-axis (optional)</p>
</td></tr>
<tr><td><code id="plot_lorentz_curves_save_as_png_+3A_y_range">y_range</code></td>
<td>
<p>Row vector with two entries consisting of the ppm start and the ppm end value
to scale the range of the y-axis (optional)</p>
</td></tr>
<tr><td><code id="plot_lorentz_curves_save_as_png_+3A_out_dir">out_dir</code></td>
<td>
<p>Path to the directory where the png files should be saved. Default is the
current working directory.</p>
</td></tr>
<tr><td><code id="plot_lorentz_curves_save_as_png_+3A_ask">ask</code></td>
<td>
<p>Logical value. Whether to ask for confirmation from the user before writing
files to disk. Default is TRUE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>NULL, called for side effects.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+MetaboDecon1D">MetaboDecon1D()</a></code>, <code><a href="#topic+plot_triplets">plot_triplets()</a></code>, <code><a href="#topic+plot_spectrum_superposition_save_as_png">plot_spectrum_superposition_save_as_png()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sim &lt;- metabodecon_file("bruker/sim_subset")
sim_decon &lt;- generate_lorentz_curves_sim(sim)
png_dir &lt;- tmpdir("sim_decon/pngs", create = TRUE)
plot_lorentz_curves_save_as_png(sim_decon, out_dir = png_dir, ask = FALSE)
dir(png_dir, full.names = TRUE)
</code></pre>

<hr>
<h2 id='plot_spectra'>Plot Spectra</h2><span id='topic+plot_spectra'></span>

<h3>Description</h3>

<p>Plot a set of deconvoluted spectra.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_spectra(
  obj,
  ...,
  sfy = 1e+06,
  xlab = "Chemical Shift [ppm]",
  ylab = paste("Signal Intensity [au] /", sfy),
  mar = c(4.1, 4.1, 1.1, 0.1)
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_spectra_+3A_obj">obj</code></td>
<td>
<p>An object of type <code>decons0</code>, <code>decons1</code> or <code>decons2</code>.
For details see <a href="#topic+metabodecon_classes">metabodecon_classes</a>.</p>
</td></tr>
<tr><td><code id="plot_spectra_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to the conversion function.</p>
</td></tr>
<tr><td><code id="plot_spectra_+3A_sfy">sfy</code></td>
<td>
<p>Scaling factor for the y-axis.</p>
</td></tr>
<tr><td><code id="plot_spectra_+3A_xlab">xlab</code></td>
<td>
<p>Label for the x-axis.</p>
</td></tr>
<tr><td><code id="plot_spectra_+3A_ylab">ylab</code></td>
<td>
<p>Label for the y-axis.</p>
</td></tr>
<tr><td><code id="plot_spectra_+3A_mar">mar</code></td>
<td>
<p>A numeric vector of length 4, which specifies the margins of the plot.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A plot of the deconvoluted spectra.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot_spectrum">plot_spectrum()</a></code> for a much more sophisticated plotting routine
suitable for plotting a single spectrum.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>obj &lt;- deconvolute(sim[1:4], sfr = c(3.55, 3.35))
plot_spectra(obj)
</code></pre>

<hr>
<h2 id='plot_spectrum'>Plot Spectrum</h2><span id='topic+plot_spectrum'></span>

<h3>Description</h3>

<p>Plot a spectrum and zoom in on a specific region.
<a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_spectrum(
  x,
  ...,
  obj = as_v2_obj(x),
  foc_frac = get_foc_frac(obj),
  foc_rgn = get_foc_rgn(obj, foc_frac),
  sub1 = TRUE,
  sub2 = FALSE,
  sub3 = width(foc_rgn) &lt; width(obj$cs),
  mar = NULL,
  frame = FALSE,
  con_lines = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_spectrum_+3A_x">x</code></td>
<td>
<p>An object of type <code>spectrum</code>, <code>decon0</code>, <code>decon1</code> or <code>decon2</code>. For details see
<a href="#topic+metabodecon_classes">metabodecon_classes</a>.</p>
</td></tr>
<tr><td><code id="plot_spectrum_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to <code><a href="#topic+draw_spectrum">draw_spectrum()</a></code> for <strong>every</strong> sub figure.
See 'Details'.</p>
</td></tr>
<tr><td><code id="plot_spectrum_+3A_obj">obj</code></td>
<td>
<p>An object of type <code>spectrum</code> or <code>decon2</code>. Usually auto  generated  from  <code>x</code>,
but can be set manually in case the default conversion is not sufficient.</p>
</td></tr>
<tr><td><code id="plot_spectrum_+3A_foc_frac">foc_frac</code></td>
<td>
<p>A numeric vector specifying the start and end of the focus region as fraction
of the full spectrum width. Only used if <code>foc_rgn</code> is set to NULL.</p>
</td></tr>
<tr><td><code id="plot_spectrum_+3A_foc_rgn">foc_rgn</code></td>
<td>
<p>A numeric vector specifying the start and end of the focus region in ppm.  If
set to NULL, <code>foc_frac</code> is used  to  determine  the  focus  region.  If  both
<code>foc_rgn</code>  and  are  set  to  NULL,  a  suitable  focus  region  is   chosen
automatically. Takes precedence over <code>foc_frac</code>.</p>
</td></tr>
<tr><td><code id="plot_spectrum_+3A_sub1">sub1</code>, <code id="plot_spectrum_+3A_sub2">sub2</code>, <code id="plot_spectrum_+3A_sub3">sub3</code></td>
<td>
<p>List of arguments passed to <code><a href="#topic+draw_spectrum">draw_spectrum()</a></code> when drawing sub figure
1-3. See 'Details'.</p>
</td></tr>
<tr><td><code id="plot_spectrum_+3A_mar">mar</code></td>
<td>
<p>A numeric vector of length 4 passed, which specifies the margins of the plot.
Passed to <code><a href="graphics.html#topic+par">par()</a></code>. If set to <code>NULL</code>, a suitable value is chosen automatically.</p>
</td></tr>
<tr><td><code id="plot_spectrum_+3A_frame">frame</code></td>
<td>
<p>A list of values passed to <code><a href="graphics.html#topic+box">box()</a></code> when drawing the frame around plot region.
If set to <code>NULL</code>, no frame is drawn.</p>
</td></tr>
<tr><td><code id="plot_spectrum_+3A_con_lines">con_lines</code></td>
<td>
<p>A list of values passed to <code><a href="graphics.html#topic+lines">lines()</a></code> when drawing the connecting lines between
sub figure 1 and the focus rectangle in sub figure 3. See 'Details'.
If set to <code>NULL</code>, the connecting lines are not drawn.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function first initializes a new plotting canvas.  After  that  it  calls
<code><a href="#topic+draw_spectrum">draw_spectrum()</a></code> multiple times to draw the following sub figures  onto  the
plotting canvas:
</p>

<ol>
<li><p> The signal intensities in the focus region
</p>
</li>
<li><p> The second derivative in the focus region
</p>
</li>
<li><p> The signal intensities over all datapoints
</p>
</li></ol>

<p>The  argument  lists  for  the  individual  calls  to  <code><a href="#topic+draw_spectrum">draw_spectrum()</a></code>  are
determined at runtime and depend on the arguments passed to <code><a href="#topic+plot_spectrum">plot_spectrum()</a></code>
as well as the currently active graphics device. To customize the  appearance
of the  individual  sub  plots,  you  can  overwrite  each  value  passed  to
<code><a href="#topic+draw_spectrum">draw_spectrum()</a></code> by providing  a  corresponding  named  element  in  <code>sub1</code>,
<code>sub2</code> or <code>sub3</code>.
</p>
<p>A sketch of the resulting figure is shown below.
</p>
<div class="sourceCode"><pre> __________________________________________
|        ______________1_____________      |
|       | Sub1: Signal Intensity in  |     |
|       | Focus Region               |     |
|       |             /\             |     |
|       |            /  \            |     |
|       |           /    \  /\       |     |
|     11|          /      \/  \      |7    |
|       |     /\  /            \     |     |
|       |    /  \/              \    |     |
|       |   /                    \   |     |
|       |__/___________0__________\__|     |
|       | Sub2: Second Derivative    |     |
|     11| in Focus Region            |7    |
|       |____________________________|     |
|                      3                   |
|    __________________3_________________  |
|   |  Sub3: Signal Intensity over all   | |
|   |  Datapoints     ________________   | |
| 5 |                | Focus Rectangle|  |1|
|   |     /\         |       /\       |  | |
|   |    /  \        |      /  \/\    |  | |
|   |   /    \   /\  |   /\/      \   |  | |
|   |__/______\_/__\_|__/__________\__|__| |
|______________________5___________________|
</pre></div>
<p>Note  that  the  figure  created  by  <code>plot_spectrum()</code>  can  be  part  of  a
multi-figure configuration as created when setting  <code>mfrow</code>  or  <code>mfcol</code>  via
<code><a href="graphics.html#topic+par">par()</a></code>. Example:
</p>
<div class="sourceCode"><pre>_______________________________________
| Plot Spectrum with   | Other Figure  |
| sub3 = TRUE          | Other Figure  |
|      ___________     |  ___________  |
|     | Sub Fig 1 |    | | x      x  | |
|     |___________|    | |      x    | |
|     |_Sub_Fig_2_|    | |      x    | |
|   _________________  | |   x     x | |
|  |    Sub Fig 3    | | |      x    | |
|  |_________________| | |___________| |
|______________________|_______________|
| Some other Figure    | Plot Spectrum |
|                      | sub3 = FALSE  |
|  _________________   |  ___________  |
| |     ___         |  | | Sub Fig 1 | |
| | ___/   \___     |  | |           | |
| |/           \____|  | |___________| |
| |                 |  | | Sub Fig 2 | |
| |_________________|  | |___________| |
|______________________|_______________|
</pre></div>


<h3>Value</h3>

<p>NULL. Called for side effect of plotting as sketched in 'Details'.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## 1. Prepare a deconvoluted spectrum as input

spec &lt;- read_spectrum(metabodecon_file("sim/sim_01"))
decon &lt;- generate_lorentz_curves_sim(spec)

## 2.1. Plot the full (non-deconvoluted) spectrum
## 2.2. Remove connecting lines, and focus on a specific region specified in ppm
## 2.3. Show second derivative and focus on a specific region specified as fraction
## 2.4. Change color of focus rectangle and margins of sub figure 1
## 2.5. Hide xlab and show second derivative
## 2.6. Change the figure region for sub figure 1

plot_spectrum(spec, sub1 = FALSE)
plot_spectrum(decon, foc_rgn = c(3.49, 3.45), con_lines = FALSE)
plot_spectrum(decon, sub2 = TRUE, foc_frac = c(0.40, 0.30))
plot_spectrum(decon,
    sub1 = list(mar = c(3, 6, 3, 6), lt_axis = list(col = "violet")),
    foc_rect = list(border = "violet", col = transp("violet")),
    con_lines = list(col = "violet")
)
plot_spectrum(decon,
    sub2 = TRUE,
    sub3 = list(bt_axis = list(text = "")),
    frame = TRUE,
    con_lines = FALSE
)
plot_spectrum(decon, sub1 = list(fig_rgn_npc = c(0,1,.3,1), mar = c(0,5,0,0)))

</code></pre>

<hr>
<h2 id='plot_spectrum_superposition_save_as_png'>Plot spectrum approx for variable range</h2><span id='topic+plot_spectrum_superposition_save_as_png'></span>

<h3>Description</h3>

<p>Plots the original spectrum and the superposition of all generated Lorentz
curves and saves the result as png under the specified filepath.
</p>
<p>Superseded by <code><a href="#topic+plot_spectrum">plot_spectrum()</a></code> since metabodecon v1.2.0. Will be replaced with v2.
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_spectrum_superposition_save_as_png(
  deconv_result,
  x_range = c(),
  y_range = c(),
  out_dir = ".",
  ask = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_spectrum_superposition_save_as_png_+3A_deconv_result">deconv_result</code></td>
<td>
<p>Saved result of the MetaboDecon1D() function</p>
</td></tr>
<tr><td><code id="plot_spectrum_superposition_save_as_png_+3A_x_range">x_range</code></td>
<td>
<p>Row vector with two entries consisting of the ppm start and the ppm end value
to scale the range of the x-axis (optional)</p>
</td></tr>
<tr><td><code id="plot_spectrum_superposition_save_as_png_+3A_y_range">y_range</code></td>
<td>
<p>Row vector with two entries consisting of the ppm start and the ppm end value
to scale the range of the y-axis (optional)</p>
</td></tr>
<tr><td><code id="plot_spectrum_superposition_save_as_png_+3A_out_dir">out_dir</code></td>
<td>
<p>Path to the directory where the png files should be saved. Default is the
current working directory.</p>
</td></tr>
<tr><td><code id="plot_spectrum_superposition_save_as_png_+3A_ask">ask</code></td>
<td>
<p>Logical value. Whether to ask for confirmation from the user before writing
files to disk.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>NULL, called for side effects.
</p>


<h3>Author(s)</h3>

<p>Martina Haeckl, 2021.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+MetaboDecon1D">MetaboDecon1D()</a></code>,
<code><a href="#topic+calculate_lorentz_curves">calculate_lorentz_curves()</a></code>,
<code><a href="#topic+plot_triplets">plot_triplets()</a></code>,
<code><a href="#topic+plot_lorentz_curves_save_as_png">plot_lorentz_curves_save_as_png()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sim &lt;- metabodecon_file("bruker/sim_subset")
sim_decon &lt;- generate_lorentz_curves_sim(sim)
png_dir &lt;- tmpdir("sim_decon/pngs", create = TRUE)
plot_spectrum_superposition_save_as_png(sim_decon, out_dir = png_dir, ask = FALSE)
dir(png_dir, full.names = TRUE)
</code></pre>

<hr>
<h2 id='plot_triplets'>Plot peak triplets for variable range</h2><span id='topic+plot_triplets'></span>

<h3>Description</h3>

<p>Plots the peak triplets for each peak detected by <code><a href="#topic+MetaboDecon1D">MetaboDecon1D()</a></code> and stores the plots as png at <code>outdir</code>.
</p>
<p>Superseded by <code><a href="#topic+plot_spectrum">plot_spectrum()</a></code> since metabodecon v1.2.0. Will be replaced with v2.
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_triplets(
  deconv_result,
  x_range = c(),
  y_range = c(),
  out_dir = ".",
  ask = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_triplets_+3A_deconv_result">deconv_result</code></td>
<td>
<p>Saved result of the MetaboDecon1D() function</p>
</td></tr>
<tr><td><code id="plot_triplets_+3A_x_range">x_range</code></td>
<td>
<p>Row vector with two entries consisting of the ppm start and the ppm end value
to scale the range of the x-axis (optional)</p>
</td></tr>
<tr><td><code id="plot_triplets_+3A_y_range">y_range</code></td>
<td>
<p>Row vector with two entries consisting of the ppm start and the ppm end value
to scale the range of the y-axis (optional)</p>
</td></tr>
<tr><td><code id="plot_triplets_+3A_out_dir">out_dir</code></td>
<td>
<p>Directory to save the png files (optional)</p>
</td></tr>
<tr><td><code id="plot_triplets_+3A_ask">ask</code></td>
<td>
<p>Logical value to ask the user if the png files should be saved in the
specified directory (optional)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for side effect of plotting.
</p>


<h3>Author(s)</h3>

<p>Martina Haeckl, 2021: Initial version.
Tobias Schmidt, 2024: Minor updates to pass CRAN checks.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+MetaboDecon1D">MetaboDecon1D()</a></code>, <code><a href="#topic+calculate_lorentz_curves">calculate_lorentz_curves()</a></code>, <code><a href="#topic+plot_lorentz_curves_save_as_png">plot_lorentz_curves_save_as_png()</a></code>,
<code><a href="#topic+plot_spectrum_superposition_save_as_png">plot_spectrum_superposition_save_as_png()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sim &lt;- metabodecon_file("bruker/sim_subset")
sim_decon &lt;- generate_lorentz_curves_sim(sim)
png_dir &lt;- tmpdir("sim_decon/pngs", create = TRUE)
plot_triplets(sim_decon, out_dir = png_dir, ask = FALSE)
dir(png_dir, full.names = TRUE)
</code></pre>

<hr>
<h2 id='print_methods'>S3 Methods for Printing Metabodecon Objects</h2><span id='topic+print_methods'></span><span id='topic+print.spectrum'></span><span id='topic+print.ispec'></span><span id='topic+print.idecon'></span><span id='topic+print.decon1'></span><span id='topic+print.decon2'></span><span id='topic+print.align'></span><span id='topic+print.spectra'></span><span id='topic+print.ispecs'></span><span id='topic+print.idecons'></span><span id='topic+print.decons1'></span><span id='topic+print.decons2'></span><span id='topic+print.aligns'></span>

<h3>Description</h3>

<p>S3 Methods for printing metabodecon objects as described in the <a href="https://spang-lab.github.io/metabodecon/articles/">Metabodecon Classes</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'spectrum'
print(x, name = FALSE, ...)

## S3 method for class 'ispec'
print(x, name = FALSE, ...)

## S3 method for class 'idecon'
print(x, name = FALSE, ...)

## S3 method for class 'decon1'
print(x, name = FALSE, ...)

## S3 method for class 'decon2'
print(x, name = FALSE, ...)

## S3 method for class 'align'
print(x, name = FALSE, ...)

## S3 method for class 'spectra'
print(x, ...)

## S3 method for class 'ispecs'
print(x, ...)

## S3 method for class 'idecons'
print(x, ...)

## S3 method for class 'decons1'
print(x, ...)

## S3 method for class 'decons2'
print(x, ...)

## S3 method for class 'aligns'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print_methods_+3A_x">x</code></td>
<td>
<p>The object to print.</p>
</td></tr>
<tr><td><code id="print_methods_+3A_name">name</code></td>
<td>
<p>Logical. If TRUE, the name of the object is printed before the object.</p>
</td></tr>
<tr><td><code id="print_methods_+3A_...">...</code></td>
<td>
<p>Not used. Only accepted to comply with generic <code><a href="base.html#topic+print">base::print()</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>NULL, called for side effect of printing to the standard output device.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>si &lt;- c(1, 1, 3, 7, 8, 3, 8, 5, 2, 1)
cs_max &lt;- 14.8
cs_width &lt;- 20.0
fq_ref &lt;- 600.25 * 1e6
fq_width &lt;- 12005
spectrum &lt;- read_spectrum()
print(spectrum)
</code></pre>

<hr>
<h2 id='read_spectra'>Read one or more spectra from Disk</h2><span id='topic+read_spectra'></span>

<h3>Description</h3>

<p><code>read_spectrum()</code> reads a single spectrum from disk and returns it as
<code>spectrum</code> object. <code>read_spectra()</code> can be used to read multiple spectra at
once and returns a <code>spectra</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_spectra(
  data_path = pkg_file("example_datasets/bruker/urine"),
  file_format = "bruker",
  expno = 10,
  procno = 10,
  raw = FALSE,
  silent = TRUE,
  force = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="read_spectra_+3A_data_path">data_path</code></td>
<td>
<p>The path of the file/folder containing the spectrum data. E.g.
<code>"example_datasets/jcampdx/urine/urine_1.dx"</code> or
<code>"example_datasets/bruker/urine/urine"</code>.</p>
</td></tr>
<tr><td><code id="read_spectra_+3A_file_format">file_format</code></td>
<td>
<p>The file_format of the spectrum file. E.g. <code>"bruker"</code> or <code>"jcampdx"</code>.</p>
</td></tr>
<tr><td><code id="read_spectra_+3A_expno">expno</code>, <code id="read_spectra_+3A_procno">procno</code></td>
<td>
<p>The experiment/processing number for the file. E.g. <code>"10"</code>. Only relevant if
<code>file_format</code> equals <code>"bruker"</code>. For details see section <a href="https://spang-lab.github.io/metabodecon/articles/FAQ.html#file-structure">File Structure</a> in
the metabodecon FAQ.</p>
</td></tr>
<tr><td><code id="read_spectra_+3A_raw">raw</code></td>
<td>
<p>If <code>FALSE</code>, scales the returned signal intensities based on information
available in the spectrum metadata, in particular <code>NC_proc</code>. For details see
<code>processing-reference.pdf</code>, available at <a href="https://www.bruker.com/en.html">https://www.bruker.com/en.html</a> at
section 'Services &amp; Support &gt; Documentation &amp; Manuals &gt; Magnetic Resonance &gt;
Acquisition &amp; Processing &gt; TopSpin Processing Commands and Parameters'
(requires login).</p>
</td></tr>
<tr><td><code id="read_spectra_+3A_silent">silent</code></td>
<td>
<p>If <code>TRUE</code>, no output will be printed to the console.</p>
</td></tr>
<tr><td><code id="read_spectra_+3A_force">force</code></td>
<td>
<p>If <code>TRUE</code>, try to continue when encountering errors and print info messages
instead. To hide these messages as well, set <code>silent = TRUE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>spectrum</code> object as described in <a href="#topic+metabodecon_classes">metabodecon_classes</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>relpath &lt;- "example_datasets/bruker/urine"
urine &lt;- system.file(relpath, package = "metabodecon")
urine_1 &lt;- file.path(urine, "urine_1")
urine_2 &lt;- file.path(urine, "urine_2")
x1 &lt;- read_spectrum(urine_1)
x2 &lt;- read_spectrum(urine_2)
xx &lt;- read_spectra(urine)
str(xx)
str(x1)
stopifnot(all.equal(x1, xx$urine_1))
</code></pre>

<hr>
<h2 id='read_spectrum'>Read one or more spectra from Disk</h2><span id='topic+read_spectrum'></span>

<h3>Description</h3>

<p><code>read_spectrum()</code> reads a single spectrum from disk and returns it as
<code>spectrum</code> object. <code>read_spectra()</code> can be used to read multiple spectra at
once and returns a <code>spectra</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_spectrum(
  data_path = metabodecon_file("bruker/sim/sim_01"),
  file_format = "bruker",
  expno = 10,
  procno = 10,
  raw = FALSE,
  silent = TRUE,
  force = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="read_spectrum_+3A_data_path">data_path</code></td>
<td>
<p>The path of the file/folder containing the spectrum data. E.g.
<code>"example_datasets/jcampdx/urine/urine_1.dx"</code> or
<code>"example_datasets/bruker/urine/urine"</code>.</p>
</td></tr>
<tr><td><code id="read_spectrum_+3A_file_format">file_format</code></td>
<td>
<p>The file_format of the spectrum file. E.g. <code>"bruker"</code> or <code>"jcampdx"</code>.</p>
</td></tr>
<tr><td><code id="read_spectrum_+3A_expno">expno</code>, <code id="read_spectrum_+3A_procno">procno</code></td>
<td>
<p>The experiment/processing number for the file. E.g. <code>"10"</code>. Only relevant if
<code>file_format</code> equals <code>"bruker"</code>. For details see section <a href="https://spang-lab.github.io/metabodecon/articles/FAQ.html#file-structure">File Structure</a> in
the metabodecon FAQ.</p>
</td></tr>
<tr><td><code id="read_spectrum_+3A_raw">raw</code></td>
<td>
<p>If <code>FALSE</code>, scales the returned signal intensities based on information
available in the spectrum metadata, in particular <code>NC_proc</code>. For details see
<code>processing-reference.pdf</code>, available at <a href="https://www.bruker.com/en.html">https://www.bruker.com/en.html</a> at
section 'Services &amp; Support &gt; Documentation &amp; Manuals &gt; Magnetic Resonance &gt;
Acquisition &amp; Processing &gt; TopSpin Processing Commands and Parameters'
(requires login).</p>
</td></tr>
<tr><td><code id="read_spectrum_+3A_silent">silent</code></td>
<td>
<p>If <code>TRUE</code>, no output will be printed to the console.</p>
</td></tr>
<tr><td><code id="read_spectrum_+3A_force">force</code></td>
<td>
<p>If <code>TRUE</code>, try to continue when encountering errors and print info messages
instead. To hide these messages as well, set <code>silent = TRUE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>spectrum</code> object as described in <a href="#topic+metabodecon_classes">metabodecon_classes</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>relpath &lt;- "example_datasets/bruker/urine"
urine &lt;- system.file(relpath, package = "metabodecon")
urine_1 &lt;- file.path(urine, "urine_1")
urine_2 &lt;- file.path(urine, "urine_2")
x1 &lt;- read_spectrum(urine_1)
x2 &lt;- read_spectrum(urine_2)
xx &lt;- read_spectra(urine)
str(xx)
str(x1)
stopifnot(all.equal(x1, xx$urine_1))
</code></pre>

<hr>
<h2 id='sap'>The SAP Dataset</h2><span id='topic+sap'></span>

<h3>Description</h3>

<p>The SAP Dataset consists of a single 'Simple-As-Possible' (SAP) spectrum. The
purpose of the SAP spectrum is to provide a straightforward example that can
be used to test and understand the deconvolution algorithm in detail.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sap
</code></pre>


<h3>Format</h3>

<p>An object of class <code>spectra</code> of length 1.
</p>


<h3>Details</h3>

<p>The first (and only) spectrum within the SAP dataset contains 128 datapoints
ranging from -6.4 to 6.4 ppm with four peaks. A rough sketch of the spectrum
is shown below:
</p>
<div class="sourceCode"><pre>-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
|      SFR      |               w               |     SFR      |
|               |  x           www       p      |              |
|~-~-~-~-~-~-~-~|~-|-|-~-~-~-~-~|~-~-~-~-|-~-~-~-~-~-~-~-~-~-~-~
|               |  | |          |        |      |
6.4             |  | 2.24       0.047    -2.22  -3.2
                |  2.61
                3.2
</pre></div>

<hr>
<h2 id='sim'>The Sim Dataset</h2><span id='topic+sim'></span>

<h3>Description</h3>

<p>A simulated dataset generated from the <a href="https://spang-lab.github.io/metabodecon/articles/Datasets.html#Blood">Blood</a>
dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim
</code></pre>


<h3>Format</h3>

<p>A <code>spectra</code> object consisting of 16 <code>spectrum</code> objects, where each spectrum
contains 2048 datapoints ranging from 3.60 to 3.29 ppm. For details about
<code>spectrum</code> and <code>spectra</code> objects see <a href="#topic+metabodecon_classes">metabodecon_classes</a>.
</p>

<hr>
<h2 id='simulate_spectrum'>Simulate a 1D NMR Spectrum</h2><span id='topic+simulate_spectrum'></span>

<h3>Description</h3>

<p>Simulates a 1D NMR spectrum based on the provided parameters.
<a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simulate_spectrum(
  name = "sim_00",
  seed = sum(utf8ToInt(name)),
  ndp = 2048,
  npk = 10,
  csres = 0.00015,
  cs = seq(from = 3.6, length.out = ndp, by = -csres),
  pkr = quantile(cs, c(0.25, 0.75)),
  fqref = 600252806.95,
  x0 = sort(runif(npk, pkr[1], pkr[2])),
  A = runif(npk, 2.5, 20) * 1000,
  lambda = runif(npk, 0.9, 1.3)/1000,
  noise = rnorm(length(cs), sd = 1200)
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="simulate_spectrum_+3A_name">name</code></td>
<td>
<p>The name of the spectrum.</p>
</td></tr>
<tr><td><code id="simulate_spectrum_+3A_seed">seed</code></td>
<td>
<p>The seed for the random number generator.</p>
</td></tr>
<tr><td><code id="simulate_spectrum_+3A_ndp">ndp</code></td>
<td>
<p>The number of data points in the spectrum.</p>
</td></tr>
<tr><td><code id="simulate_spectrum_+3A_npk">npk</code></td>
<td>
<p>The number of peaks in the spectrum.</p>
</td></tr>
<tr><td><code id="simulate_spectrum_+3A_csres">csres</code></td>
<td>
<p>The chemical shift resolution in PPM.</p>
</td></tr>
<tr><td><code id="simulate_spectrum_+3A_cs">cs</code></td>
<td>
<p>The vector of chemical shifts in PPM.</p>
</td></tr>
<tr><td><code id="simulate_spectrum_+3A_pkr">pkr</code></td>
<td>
<p>The start and stop of the peak region in PPM.</p>
</td></tr>
<tr><td><code id="simulate_spectrum_+3A_fqref">fqref</code></td>
<td>
<p>The reference frequency in Hz.</p>
</td></tr>
<tr><td><code id="simulate_spectrum_+3A_x0">x0</code></td>
<td>
<p>The peak center positions in PPM.</p>
</td></tr>
<tr><td><code id="simulate_spectrum_+3A_a">A</code></td>
<td>
<p>The peak area parameter.</p>
</td></tr>
<tr><td><code id="simulate_spectrum_+3A_lambda">lambda</code></td>
<td>
<p>The peak width parameter.</p>
</td></tr>
<tr><td><code id="simulate_spectrum_+3A_noise">noise</code></td>
<td>
<p>The noise to add to the spectrum.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>spectrum</code> object as described in <a href="#topic+metabodecon_classes">metabodecon_classes</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>simA &lt;- simulate_spectrum("simA")
simA_copy &lt;- simulate_spectrum("simA")
simB &lt;- simulate_spectrum("simB")
simC &lt;- simulate_spectrum("simC", npk = 20)
plot_spectrum(simC)
if (!identical(simA, simA_copy)) stop()
if ( identical(simA, simB     )) stop()
</code></pre>

<hr>
<h2 id='speaq_align'>Align Signals using 'speaq'</h2><span id='topic+speaq_align'></span>

<h3>Description</h3>

<p>Performs signal alignment across the individual spectra using the 'speaq'
package (Beirnaert C, Meysman P, Vu TN, Hermans N, Apers S, Pieters L, et al.
(2018) speaq 2.0: A complete workflow for high-throughput 1D NMRspectra
processing and quantification. PLoS Comput Biol 14(3): e1006018.
https://www.doi.org/10.1371/journal.pcbi.1006018). The spectra deconvolution
process yields the signals of all spectra. Due to slight changes in
measurement conditions, e.g. pH variations, signal positions may vary
slightly across spectra. As a consequence, prior to further analysis signals
belonging to the same compound have to be aligned across spectra. This is the
purpose of the 'speaq' package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>speaq_align(
  feat = gen_feat_mat(spectrum_data),
  maxShift = 50,
  spectrum_data = generate_lorentz_curves_sim(),
  si_size_real_spectrum = length(spectrum_data[[1]]$y_values),
  verbose = TRUE,
  show = FALSE,
  mfrow = c(2, 1)
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="speaq_align_+3A_feat">feat</code></td>
<td>
<p>Output of <code>gen_feat_mat()</code>.</p>
</td></tr>
<tr><td><code id="speaq_align_+3A_maxshift">maxShift</code></td>
<td>
<p>Maximum number of points along the &quot;ppm-axis&quot; which a value
can be moved by speaq package e.g. 50. 50 is a suitable starting value for
plasma spectra with a digital resolution of 128K. Note that this parameter
has to be individually optimized depending on the type of analyzed spectra
and the digital resolution. For urine which is more prone to chemical shift
variations this value most probably has to be increased.</p>
</td></tr>
<tr><td><code id="speaq_align_+3A_spectrum_data">spectrum_data</code></td>
<td>
<p>Output of <code>generate_lorentz_curves()</code>.</p>
</td></tr>
<tr><td><code id="speaq_align_+3A_si_size_real_spectrum">si_size_real_spectrum</code></td>
<td>
<p>Number of real data points in your original
spectra.</p>
</td></tr>
<tr><td><code id="speaq_align_+3A_verbose">verbose</code></td>
<td>
<p>Whether to print additional information during the alignment
process.</p>
</td></tr>
<tr><td><code id="speaq_align_+3A_show">show</code></td>
<td>
<p>Whether to plot the original and aligned spectra.</p>
</td></tr>
<tr><td><code id="speaq_align_+3A_mfrow">mfrow</code></td>
<td>
<p>Layout to use for the plot. Passed on to <code>par()</code>. Use <code>mfrow = NULL</code> if the plot layout should not be changed.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix containing the integral values of the spectra after alignment.
</p>
<p>There is one row per spectrum and one column per ppm value. The entry at
position <code style="white-space: pre;">&#8288;i, j&#8288;</code> holds the integral value of the signal from spectrum <code>i</code> that
has its center at position <code>j</code> after alignment by speaq. If there is no
signal with center <code>j</code> in spectrum <code>i</code>, entry <code style="white-space: pre;">&#8288;i, j&#8288;</code> is set to NA. The column
names of the matrix are the ppm values of the original spectra.
</p>
<p>Example return matrix:
</p>
<div class="sourceCode"><pre>    ...  3.59  3.55  3.57  3.56  3.55  3.54  3.53
  .----------------------------------------------&gt; PPM
1 | NA   NA    0.20  NA    NA    NA    0.25  NA
2 | NA   NA    0.15  NA    NA    NA    0.13  NA
3 | NA   NA    NA    0.2   NA    NA    0.18  NA
SpNr
</pre></div>


<h3>Author(s)</h3>

<p>Initial version from Wolfram Gronwald.
Refactored by Tobias Schmidt in 2024.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sim_subset &lt;- metabodecon_file("bruker/sim_subset")
spectrum_data &lt;- generate_lorentz_curves_sim(sim_subset)
feat &lt;- gen_feat_mat(spectrum_data)
maxShift &lt;- 200
M &lt;- speaq_align(feat, maxShift, spectrum_data, show = TRUE)
str(M)
</code></pre>

<hr>
<h2 id='tmpdir'>Temporary Session Directory</h2><span id='topic+tmpdir'></span>

<h3>Description</h3>

<p>Returns the path to metabodecon's temporary session directory. This directory
equals subdirectory 'metabodecon' of R's temporary session directory
<code><a href="base.html#topic+tempfile">base::tempdir()</a></code> plus additional path normalization.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tmpdir(subdir = NULL, create = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tmpdir_+3A_subdir">subdir</code></td>
<td>
<p>Optional subdirectory within the temporary session directory.</p>
</td></tr>
<tr><td><code id="tmpdir_+3A_create">create</code></td>
<td>
<p>Whether to create the directory if it does not yet exist.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns the path to the temporary session directory.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+datadir_temp">datadir_temp()</a></code>
<code><a href="#topic+datadir_persistent">datadir_persistent()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>tmpdir()
tmpdir("simulate_spectra")
</code></pre>

<hr>
<h2 id='transp'>Make transparent</h2><span id='topic+transp'></span>

<h3>Description</h3>

<p>Make a color transparent by adding an alpha channel.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>transp(col = "violet", alpha = 0.08)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="transp_+3A_col">col</code></td>
<td>
<p>Character string specifying the color to make transparent.</p>
</td></tr>
<tr><td><code id="transp_+3A_alpha">alpha</code></td>
<td>
<p>Numeric value between 0 and 1 specifying the transparency level.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A character string representing the color with an alpha channel.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>transp("violet", 0.08)
transp("black", 0.5)
</code></pre>

<hr>
<h2 id='tree'>Print the Structure of a Directory Tree</h2><span id='topic+tree'></span>

<h3>Description</h3>

<p>Prints the structure of a directory tree up to a specified maximum level of
depth. It lists all files and directories under the specified path,
displaying them in a tree-like structure.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tree(path, max.level = 2, level = 0, prefix = "")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tree_+3A_path">path</code></td>
<td>
<p>The root path from which to start listing the directory
structure.</p>
</td></tr>
<tr><td><code id="tree_+3A_max.level">max.level</code></td>
<td>
<p>The maximum depth of directories to list.</p>
</td></tr>
<tr><td><code id="tree_+3A_level">level</code></td>
<td>
<p>Internal parameter used for recursion, indicating the current
level of depth.</p>
</td></tr>
<tr><td><code id="tree_+3A_prefix">prefix</code></td>
<td>
<p>Internal parameter used for formatting the printed tree
structure.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>NULL, called for its side effect of printing the directory structure.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>metabodecon_dir &lt;- system.file(package = "metabodecon")
tree(metabodecon_dir, max.level = 1)
</code></pre>

<hr>
<h2 id='width'>Calculate the Width of a Numeric Vector</h2><span id='topic+width'></span>

<h3>Description</h3>

<p>Calculates the width of a numeric vector by computing the difference between
the maximum and minimum values in the vector.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>width(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="width_+3A_x">x</code></td>
<td>
<p>A numeric vector.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The width of the vector, calculated as the difference between its maximum and
minimum values.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>vec &lt;- c(1, 3, 5, 7, 9)
width(vec)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
