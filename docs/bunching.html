<!DOCTYPE html><html lang="en"><head><title>Help for package bunching</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {bunching}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#bin_data'><p>Bin the raw data</p></a></li>
<li><a href='#bunching'><p>bunching: Analyze bunching at a kink or notch</p></a></li>
<li><a href='#bunching_data'><p>Simulated data for bunching examples.</p></a></li>
<li><a href='#bunchit'><p>Bunching Estimator</p></a></li>
<li><a href='#do_bootstrap'><p>Bootstrap</p></a></li>
<li><a href='#do_correction'><p>Integration Constraint Correction</p></a></li>
<li><a href='#domregion'><p>Dominated Region</p></a></li>
<li><a href='#elasticity'><p>Elasticity</p></a></li>
<li><a href='#fit_bunching'><p>Fit Bunching</p></a></li>
<li><a href='#marginal_buncher'><p>Marginal Buncher</p></a></li>
<li><a href='#notch_equation'><p>Notch Equation</p></a></li>
<li><a href='#plot_bunching'><p>Bunching Plot</p></a></li>
<li><a href='#plot_hist'><p>Plot Histogram</p></a></li>
<li><a href='#prep_data_for_fit'><p>Data Preparation</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Estimate Bunching</td>
</tr>
<tr>
<td>Version:</td>
<td>0.8.6</td>
</tr>
<tr>
<td>Description:</td>
<td>Implementation of the bunching estimator for kinks and notches. 
        Allows for flexible estimation of counterfactual (e.g. controlling for round number bunching, accounting for other bunching masses within bunching window, fixing bunching point to be minimum, maximum or median value in its bin, etc.). 
        It produces publication-ready plots in the style followed since Chetty et al. (2011) &lt;<a href="https://doi.org/10.1093%2Fqje%2Fqjr013">doi:10.1093/qje/qjr013</a>&gt;, with lots of functionality to set plot options.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/mavpanos/bunching">https://github.com/mavpanos/bunching</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/mavpanos/bunching/issues">https://github.com/mavpanos/bunching/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Depends:</td>
<td>BB (&ge; 2014.10-1), dplyr (&ge; 0.8.1), ggplot2 (&ge; 3.1.1), R (&ge;
2.10), stats, tidyr (&ge; 0.8.2)</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.1</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr, rmarkdown</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-08-24 16:27:13 UTC; panos.m</td>
</tr>
<tr>
<td>Author:</td>
<td>Panos Mavrokonstantis [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Panos Mavrokonstantis &lt;mavpanos@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-08-24 16:52:34 UTC</td>
</tr>
</table>
<hr>
<h2 id='bin_data'>Bin the raw data</h2><span id='topic+bin_data'></span>

<h3>Description</h3>

<p>Create data frame of binned counts
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bin_data(z_vector, binv = "median", zstar, binwidth, bins_l, bins_r)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="bin_data_+3A_z_vector">z_vector</code></td>
<td>
<p>a numeric vector of (unbinned) data.</p>
</td></tr>
<tr><td><code id="bin_data_+3A_binv">binv</code></td>
<td>
<p>a string setting location of zstar within its bin (&quot;min&quot;, &quot;max&quot; or &quot;median&quot; value). Default is median.</p>
</td></tr>
<tr><td><code id="bin_data_+3A_zstar">zstar</code></td>
<td>
<p>a numeric value for the the bunching point.</p>
</td></tr>
<tr><td><code id="bin_data_+3A_binwidth">binwidth</code></td>
<td>
<p>a numeric value for the width of each bin.</p>
</td></tr>
<tr><td><code id="bin_data_+3A_bins_l">bins_l</code></td>
<td>
<p>number of bins to left of zstar to use in analysis.</p>
</td></tr>
<tr><td><code id="bin_data_+3A_bins_r">bins_r</code></td>
<td>
<p>number of bins to right of zstar to use in analysis.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>bin_data</code> returns a data frame with bins and corresponding frequencies (counts).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bunchit">bunchit</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(bunching_data)
binned_data &lt;- bin_data(z_vector = bunching_data$kink, zstar = 10000,
                        binwidth = 50, bins_l = 20, bins_r = 20)
head(binned_data)
</code></pre>

<hr>
<h2 id='bunching'>bunching: Analyze bunching at a kink or notch</h2><span id='topic+bunching'></span>

<h3>Description</h3>

<p>The <code>bunching</code> package implements the bunching estimator in settings with kinks or notches.
Given a numeric vector, it allows the user to estimate bunching at a particular location in the vector's distribution, and returns a rich set of results.
Important features include functionality for controlling for (different levels of) round numbers, controlling for other bunching points in the bunching bandwidth,
and splitting bins using the bunching point as the minimum, median or maximum in its bin for robustness analysis. It estimates standard errors using residual-based bootstrapping,
and returns estimated elasticities using both reduced-form and parametric specifications.
Besides estimation, it produces bunching plots in the style of Chetty et al. (2011) with lots of functionality for editing the plot's appearance.
</p>


<h3>Main functions</h3>

<p><code>bunching</code> has two main functions:
</p>

<dl>
<dt><code><a href="#topic+bunchit">bunchit</a></code></dt><dd><p>is the main function that runs all the analysis.</p>
</dd>
<dt><code><a href="#topic+plot_hist">plot_hist</a></code></dt><dd><p>is a tool for exploratory visualization prior to estimating bunching. It can be used to
decide how to choose the appropriate binwidth, bandwidth, the number around the bunching point to include in the bunching region,
the polynomial order, whether to control for round numbers and other fixed effects in the bandwidth.</p>
</dd>
</dl>



<h3>See Also</h3>

<p><code><a href="#topic+bunchit">bunchit</a></code>, <code><a href="#topic+plot_hist">plot_hist</a></code>
</p>

<hr>
<h2 id='bunching_data'>Simulated data for bunching examples.</h2><span id='topic+bunching_data'></span>

<h3>Description</h3>

<p>A dataset containing two simulated vectors of about 27,500 observations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bunching_data
</code></pre>


<h3>Format</h3>

<p>A data frame with 27510 rows and 2 variables:
</p>

<dl>
<dt>kink_vector</dt><dd><p>simulated earnings vector, suitable for examples of bunching at kinks</p>
</dd></dl>
<p>.
</p>
<dl>
<dt>notch_vector</dt><dd><p>simulated earnings vector, suitable for examples of bunching at notches</p>
</dd></dl>
<p>.

</p>


<h3>See Also</h3>

<p><code><a href="#topic+bunching">bunching</a></code>, <code><a href="#topic+bunchit">bunchit</a></code>
</p>

<hr>
<h2 id='bunchit'>Bunching Estimator</h2><span id='topic+bunchit'></span>

<h3>Description</h3>

<p>Implement the bunching estimator in a kink or notch setting.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bunchit(
  z_vector,
  binv = "median",
  zstar,
  binwidth,
  bins_l,
  bins_r,
  poly = 9,
  bins_excl_l = 0,
  bins_excl_r = 0,
  extra_fe = NA,
  rn = NA,
  n_boot = 100,
  correct = TRUE,
  correct_above_zu = FALSE,
  correct_iter_max = 200,
  t0,
  t1,
  notch = FALSE,
  force_notch = FALSE,
  e_parametric = FALSE,
  e_parametric_lb = 1e-04,
  e_parametric_ub = 3,
  seed = NA,
  p_title = "",
  p_xtitle = deparse(substitute(z_vector)),
  p_ytitle = "Count",
  p_title_size = 11,
  p_axis_title_size = 10,
  p_axis_val_size = 8.5,
  p_miny = 0,
  p_maxy = NA,
  p_ybreaks = NA,
  p_freq_color = "black",
  p_cf_color = "maroon",
  p_zstar_color = "red",
  p_grid_major_y_color = "lightgrey",
  p_freq_size = 0.5,
  p_freq_msize = 1,
  p_cf_size = 0.5,
  p_zstar_size = 0.5,
  p_b = FALSE,
  p_e = FALSE,
  p_b_e_xpos = NA,
  p_b_e_ypos = NA,
  p_b_e_size = 3,
  p_domregion_color = "blue",
  p_domregion_ltype = "longdash"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="bunchit_+3A_z_vector">z_vector</code></td>
<td>
<p>a numeric vector of (unbinned) data.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_binv">binv</code></td>
<td>
<p>a string setting location of zstar within its bin (&quot;min&quot;, &quot;max&quot; or &quot;median&quot; value). Default is median.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_zstar">zstar</code></td>
<td>
<p>a numeric value for the the bunching point.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_binwidth">binwidth</code></td>
<td>
<p>a numeric value for the width of each bin.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_bins_l">bins_l</code></td>
<td>
<p>number of bins to left of zstar to use in analysis.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_bins_r">bins_r</code></td>
<td>
<p>number of bins to right of zstar to use in analysis.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_poly">poly</code></td>
<td>
<p>a numeric value for the order of polynomial for counterfactual fit. Default is 9.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_bins_excl_l">bins_excl_l</code></td>
<td>
<p>number of bins to left of zstar to include in bunching region. Default is 0.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_bins_excl_r">bins_excl_r</code></td>
<td>
<p>number of bins to right of zstar to include in bunching region. Default is 0.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_extra_fe">extra_fe</code></td>
<td>
<p>a numeric vector of bin values to control for using fixed effects. Default includes no controls.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_rn">rn</code></td>
<td>
<p>a numeric vector of (up to 2) round numbers to control for. Default includes no controls.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_n_boot">n_boot</code></td>
<td>
<p>number of bootstrapped iterations. Default is 100.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_correct">correct</code></td>
<td>
<p>implements correction for integration constraint. Default is TRUE.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_correct_above_zu">correct_above_zu</code></td>
<td>
<p>if integration constraint correction is implemented, should counterfactual be shifted only above zu (upper bound of exclusion region)? Default is FALSE (i.e. shift from above zstar).</p>
</td></tr>
<tr><td><code id="bunchit_+3A_correct_iter_max">correct_iter_max</code></td>
<td>
<p>maximum iterations for integration constraint correction. Default is 200.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_t0">t0</code></td>
<td>
<p>numeric value setting the marginal (average) tax rate below zstar in a kink (notch) setting.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_t1">t1</code></td>
<td>
<p>numeric value setting the marginal (average) tax rate above zstar in a kink (notch) setting.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_notch">notch</code></td>
<td>
<p>whether analysis is for a kink or notch. Default is FALSE (kink).</p>
</td></tr>
<tr><td><code id="bunchit_+3A_force_notch">force_notch</code></td>
<td>
<p>whether to enforce user's choice of zu (upper limit of bunching region) in a notch setting. Default is FALSE (zu set by setting bunching equal to missing mass).</p>
</td></tr>
<tr><td><code id="bunchit_+3A_e_parametric">e_parametric</code></td>
<td>
<p>whether to estimate elasticity using parametric specification (quasi-linear and iso-elastic utility function). Default is FALSE (which estimates reduced-form approximation).</p>
</td></tr>
<tr><td><code id="bunchit_+3A_e_parametric_lb">e_parametric_lb</code></td>
<td>
<p>lower bound for elasticity estimate's solution using parametric specification in notch setting. Default is 1e-04.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_e_parametric_ub">e_parametric_ub</code></td>
<td>
<p>upper bound for elasticity estimate's solution using parametric specification in notch setting. Default is 3.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_seed">seed</code></td>
<td>
<p>a numeric value for bootstrap seed (random re-sampling of residuals). Default is NA.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_p_title">p_title</code></td>
<td>
<p>plot's title. Default is empty.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_p_xtitle">p_xtitle</code></td>
<td>
<p>plot's x_axis label. Default is the name of z_vector.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_p_ytitle">p_ytitle</code></td>
<td>
<p>plot's y_axis label. Default is &quot;Count&quot;.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_p_title_size">p_title_size</code></td>
<td>
<p>size of plot's title. Default is 11.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_p_axis_title_size">p_axis_title_size</code></td>
<td>
<p>size of plot's axes' title labels. Default is 10.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_p_axis_val_size">p_axis_val_size</code></td>
<td>
<p>size of plot's axes' numeric labels. Default is 8.5.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_p_miny">p_miny</code></td>
<td>
<p>plot's minimum y_axis value. Default is 0.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_p_maxy">p_maxy</code></td>
<td>
<p>plot's maximum y_axis value. Default is optimized internally.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_p_ybreaks">p_ybreaks</code></td>
<td>
<p>a numeric vector of y-axis values at which to add horizontal line markers in plot. Default is optimized internally.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_p_freq_color">p_freq_color</code></td>
<td>
<p>plot's frequency line color. Default is &quot;black&quot;.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_p_cf_color">p_cf_color</code></td>
<td>
<p>plot's counterfactual line color. Default is &quot;maroon&quot;.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_p_zstar_color">p_zstar_color</code></td>
<td>
<p>plot's bunching region marker lines color. Default is &quot;red&quot;.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_p_grid_major_y_color">p_grid_major_y_color</code></td>
<td>
<p>plot's y-axis major grid line color. Default is &quot;lightgrey&quot;.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_p_freq_size">p_freq_size</code></td>
<td>
<p>plot's frequency line thickness. Default is 0.5.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_p_freq_msize">p_freq_msize</code></td>
<td>
<p>plot's frequency line marker size. Default is 1.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_p_cf_size">p_cf_size</code></td>
<td>
<p>plot's counterfactual line thickness. Default is 0.5.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_p_zstar_size">p_zstar_size</code></td>
<td>
<p>plot's bunching region marker line thickness. Default is 0.5.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_p_b">p_b</code></td>
<td>
<p>whether plot should also include the bunching estimate. Default is FALSE.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_p_e">p_e</code></td>
<td>
<p>whether plot should also include the elasticity estimate. Only shown if p_b is TRUE. Default is FALSE.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_p_b_e_xpos">p_b_e_xpos</code></td>
<td>
<p>plot's x-axis coordinate of bunching/elasticity estimate. Default is set internally.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_p_b_e_ypos">p_b_e_ypos</code></td>
<td>
<p>plot's y-axis coordinate of bunching/elasticity estimate. Default is set internally.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_p_b_e_size">p_b_e_size</code></td>
<td>
<p>size of plot's printed bunching/elasticity estimate. Default is 3.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_p_domregion_color">p_domregion_color</code></td>
<td>
<p>plot's dominated region marker line color in notch setting. Default is &quot;blue&quot;.</p>
</td></tr>
<tr><td><code id="bunchit_+3A_p_domregion_ltype">p_domregion_ltype</code></td>
<td>
<p>line type for the vertical line type marking the dominated region (zD) in the plot for notch settings. Default is &quot;longdash&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>bunchit implements the bunching estimator in both kink and notch settings. It bins a given numeric vector, fits a counterfactual density, and estimates the bunching mass (normalized and not), the elasticity and the location of the marginal buncher. In the case of notches, it also finds the dominated region and estimates the fraction of observations located in it.
</p>


<h3>Value</h3>

<p><code>bunchit</code> returns a list of results, both for visualizing and for further analysis of the data underlying the estimates. These include:
</p>
<table role = "presentation">
<tr><td><code>plot</code></td>
<td>
<p>The bunching plot.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>The binned data used for estimation.</p>
</td></tr>
<tr><td><code>cf</code></td>
<td>
<p>The estimated counterfactuals.</p>
</td></tr>
<tr><td><code>B</code></td>
<td>
<p>The estimated excess mass (not normalized).</p>
</td></tr>
<tr><td><code>B_vector</code></td>
<td>
<p>The vector of bootstrapped B's.</p>
</td></tr>
<tr><td><code>B_sd</code></td>
<td>
<p>The standard deviation of B_vector.</p>
</td></tr>
<tr><td><code>b</code></td>
<td>
<p>The estimated excess mass (normalized).</p>
</td></tr>
<tr><td><code>b_vector</code></td>
<td>
<p>The vector of bootstrapped b's.</p>
</td></tr>
<tr><td><code>b_sd</code></td>
<td>
<p>The standard deviation of b_vector.</p>
</td></tr>
<tr><td><code>e</code></td>
<td>
<p>The estimated elasticity.</p>
</td></tr>
<tr><td><code>e_vector</code></td>
<td>
<p>The vector of bootstrapped elasticities (e).</p>
</td></tr>
<tr><td><code>e_sd</code></td>
<td>
<p>The standard deviation of e_vector.</p>
</td></tr>
<tr><td><code>alpha</code></td>
<td>
<p>The estimated fraction of bunchers in dominated region (notch case).</p>
</td></tr>
<tr><td><code>alpha_vector</code></td>
<td>
<p>The vector of bootstrapped alphas.</p>
</td></tr>
<tr><td><code>alpha_sd</code></td>
<td>
<p>The standard deviation of alpha_vector.</p>
</td></tr>
<tr><td><code>model_fit</code></td>
<td>
<p>The model fit on the actual (i.e. not bootstrapped) data.</p>
</td></tr>
<tr><td><code>zD</code></td>
<td>
<p>The value demarcating the dominated region (notch case).</p>
</td></tr>
<tr><td><code>zD_bin</code></td>
<td>
<p>The bin above zstar demarcating the dominated region (notch case).</p>
</td></tr>
<tr><td><code>zU_bin</code></td>
<td>
<p>The location of zU (upper range of excluded region) as estimated from notch setting by setting force_notch = FALSE.</p>
</td></tr>
<tr><td><code>marginal_buncher</code></td>
<td>
<p>The location (z value) of the marginal buncher.</p>
</td></tr>
<tr><td><code>marginal_buncher_vector</code></td>
<td>
<p>The vector of bootstrapped marginal_buncher values.</p>
</td></tr>
<tr><td><code>marginal_buncher_sd</code></td>
<td>
<p>The standard deviation of marginal_buncher_vector.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+plot_hist">plot_hist</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# First, load the example data
data(bunching_data)

# Example 1: Kink with integration constraint correction
kink1 &lt;- bunchit(z_vector = bunching_data$kink, zstar = 10000, binwidth = 50,
                 bins_l = 20, bins_r = 20, poly = 4, t0 = 0, t1 = .2,
                 p_b = TRUE, seed = 1)
kink1$plot
kink1$b
kink1$b_sd

# Example 2: Kink with diffuse bunching
bpoint &lt;- 10000; binwidth &lt;- 50
kink2_vector &lt;- c(bunching_data$kink_vector,
                 rep(bpoint - binwidth,80), rep(bpoint - 2*binwidth,190),
                 rep(bpoint + binwidth,80), rep(bpoint + 2*binwidth,80))
kink2 &lt;- bunchit(z_vector = kink2_vector, zstar = 10000, binwidth = 50,
                 bins_l = 20, bins_r = 20, poly = 4,  t0 = 0, t1 = .2,
                 bins_excl_l = 2, bins_excl_r = 2, correct = FALSE,
                 p_b = TRUE, seed = 1)
kink2$plot

# Example 3: Kink with further bunching at other level in bandwidth
kink3_vector &lt;- c(bunching_data$kink_vector, rep(10200,540))
kink3 &lt;- bunchit(kink3_vector, zstar = 10000, binwidth = 50,
                 bins_l = 40, bins_r = 40, poly = 6, t0 = 0, t1 = .2,
                 correct = FALSE, p_b = TRUE, extra_fe = 10200, seed = 1)
kink3$plot

# Example 4: Kink with round number bunching
rn1 &lt;- 500;  rn2 &lt;- 250
bpoint &lt;- 10000
kink4_vector &lt;- c(bunching_data$kink_vector,
                  rep(bpoint + rn1, 270),
                  rep(bpoint + 2*rn1,230),
                  rep(bpoint - rn1,260),
                  rep(bpoint - 2*rn1,275),
                  rep(bpoint + rn2, 130),
                  rep(bpoint + 3*rn2,140),
                  rep(bpoint - rn2,120),
                  rep(bpoint - 3*rn2,135))
kink4 &lt;- bunchit(z_vector = kink4_vector, zstar = bpoint, binwidth = 50,
                 bins_l = 20, bins_r = 20, poly = 6, t0 = 0, t1 = .2,
                 correct = FALSE, p_b = TRUE, p_e = TRUE, p_freq_msize = 1.5,
                 p_b_e_ypos = 880, rn = c(250,500), seed = 1)
kink4$plot

# Example 5: Notch
notch &lt;- bunchit(z_vector = bunching_data$notch_vector, zstar = 10000, binwidth = 50,
                 bins_l = 40, bins_r = 40, poly = 5, t0 = 0.18, t1 = .25,
                 correct = FALSE, notch = TRUE,p_b = TRUE, p_b_e_xpos = 8900,
                 n_boot = 0)
notch$plot

## End(Not run)
</code></pre>

<hr>
<h2 id='do_bootstrap'>Bootstrap</h2><span id='topic+do_bootstrap'></span>

<h3>Description</h3>

<p>Estimate bunching on bootstrapped samples, using residual-based bootstrapping with replacement.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>do_bootstrap(
  zstar,
  binwidth,
  firstpass_prep,
  residuals,
  n_boot = 100,
  correct = TRUE,
  correct_iter_max = 200,
  notch = FALSE,
  zD_bin = NA,
  seed = NA
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="do_bootstrap_+3A_zstar">zstar</code></td>
<td>
<p>a numeric value for the the bunching point.</p>
</td></tr>
<tr><td><code id="do_bootstrap_+3A_binwidth">binwidth</code></td>
<td>
<p>a numeric value for the width of each bin.</p>
</td></tr>
<tr><td><code id="do_bootstrap_+3A_firstpass_prep">firstpass_prep</code></td>
<td>
<p>(binned) data that includes all variables necessary for fitting the model.</p>
</td></tr>
<tr><td><code id="do_bootstrap_+3A_residuals">residuals</code></td>
<td>
<p>residuals from (first pass) fitted bunching model.</p>
</td></tr>
<tr><td><code id="do_bootstrap_+3A_n_boot">n_boot</code></td>
<td>
<p>number of bootstrapped iterations. Default is 100.</p>
</td></tr>
<tr><td><code id="do_bootstrap_+3A_correct">correct</code></td>
<td>
<p>implements correction for integration constraint. Default is TRUE.</p>
</td></tr>
<tr><td><code id="do_bootstrap_+3A_correct_iter_max">correct_iter_max</code></td>
<td>
<p>maximum iterations for integration constraint correction. Default is 200.</p>
</td></tr>
<tr><td><code id="do_bootstrap_+3A_notch">notch</code></td>
<td>
<p>whether analysis is for a kink or notch. Default is FALSE (kink).</p>
</td></tr>
<tr><td><code id="do_bootstrap_+3A_zd_bin">zD_bin</code></td>
<td>
<p>the bin marking the upper end of the dominated region (notch case).</p>
</td></tr>
<tr><td><code id="do_bootstrap_+3A_seed">seed</code></td>
<td>
<p>a numeric value for bootstrap seed (random re-sampling of residuals). Default is NA.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>do_bootstrap</code> returns a list with the following bootstrapped estimates:
</p>
<table role = "presentation">
<tr><td><code>b_vector</code></td>
<td>
<p>A vector with the bootstrapped normalized excess mass estimates.</p>
</td></tr>
<tr><td><code>b_sd</code></td>
<td>
<p>The standard deviation of the bootstrapped b_vector.</p>
</td></tr>
<tr><td><code>B_vector</code></td>
<td>
<p>A vector with the bootstrapped excess mass estimates (not normalized).</p>
</td></tr>
<tr><td><code>B_sd</code></td>
<td>
<p>The standard deviation of the bootstrapped B_vector.</p>
</td></tr>
<tr><td><code>marginal_buncher_vector</code></td>
<td>
<p>A vector with the bootstrapped estimates of the location (z value) of the marginal buncher.</p>
</td></tr>
<tr><td><code>marginal_buncher_sd</code></td>
<td>
<p>The standard deviation of the bootstrapped marginal_buncher_vector.</p>
</td></tr>
<tr><td><code>alpha_vector</code></td>
<td>
<p>A vector with the bootstrapped estimates of the fraction of bunchers in the dominated region (only in notch case).</p>
</td></tr>
<tr><td><code>alpha_vector_sd</code></td>
<td>
<p>The standard deviation of the bootstrapped alpha_vector.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+bunchit">bunchit</a></code>, <code><a href="#topic+prep_data_for_fit">prep_data_for_fit</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(bunching_data)
binned_data &lt;- bin_data(z_vector = bunching_data$kink, zstar = 10000,
                        binwidth = 50, bins_l = 20, bins_r = 20)
prepped_data &lt;- prep_data_for_fit(binned_data, zstar = 10000, binwidth = 50,
                                  bins_l = 20, bins_r = 20, poly = 4)
firstpass &lt;- fit_bunching(prepped_data$data_binned,
                          prepped_data$model_formula,
                          binwidth = 50)
residuals_for_boot &lt;- fit_bunching(prepped_data$data_binned,
                                   prepped_data$model_formula,
                                   binwidth = 50)$residuals
boot_results &lt;- do_bootstrap(zstar = 10000, binwidth = 50,
                             firstpass_prep = prepped_data,
                             residuals = residuals_for_boot,
                             seed = 1)
boot_results$b_sd
</code></pre>

<hr>
<h2 id='do_correction'>Integration Constraint Correction</h2><span id='topic+do_correction'></span>

<h3>Description</h3>

<p>Implements the correction for the integration constraint.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>do_correction(
  zstar,
  binwidth,
  data_prepped,
  firstpass_results,
  correct_iter_max = 200,
  notch = FALSE,
  zD_bin = NA
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="do_correction_+3A_zstar">zstar</code></td>
<td>
<p>a numeric value for the the bunching point.</p>
</td></tr>
<tr><td><code id="do_correction_+3A_binwidth">binwidth</code></td>
<td>
<p>a numeric value for the width of each bin.</p>
</td></tr>
<tr><td><code id="do_correction_+3A_data_prepped">data_prepped</code></td>
<td>
<p>(binned) data that includes all variables necessary for fitting the model.</p>
</td></tr>
<tr><td><code id="do_correction_+3A_firstpass_results">firstpass_results</code></td>
<td>
<p>initial bunching estimates without correction.</p>
</td></tr>
<tr><td><code id="do_correction_+3A_correct_iter_max">correct_iter_max</code></td>
<td>
<p>maximum iterations for integration constraint correction. Default is 200.</p>
</td></tr>
<tr><td><code id="do_correction_+3A_notch">notch</code></td>
<td>
<p>whether analysis is for a kink or notch. Default is FALSE (kink).</p>
</td></tr>
<tr><td><code id="do_correction_+3A_zd_bin">zD_bin</code></td>
<td>
<p>the bin marking the upper end of the dominated region (notch case).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>do_correction returns a list with the data and estimates after correcting for the integration constraint, as follows:
</p>
<table role = "presentation">
<tr><td><code>data</code></td>
<td>
<p>The dataset with the corrected counterfactual.</p>
</td></tr>
<tr><td><code>coefficients</code></td>
<td>
<p>The coefficients of the model fit on the corrected data.</p>
</td></tr>
<tr><td><code>b_corrected</code></td>
<td>
<p>The normalized excess mass, corrected for the integration constraint.</p>
</td></tr>
<tr><td><code>B_corrected</code></td>
<td>
<p>The excess mass (not normalized), corrected for the integration constraint.</p>
</td></tr>
<tr><td><code>c0_corrected</code></td>
<td>
<p>The counterfactual at zstar, corrected for the integration constraint.</p>
</td></tr>
<tr><td><code>marginal_buncher_corrected</code></td>
<td>
<p>The location (z value) of the marginal buncher, corrected for the integration constraint.</p>
</td></tr>
<tr><td><code>alpha_corrected</code></td>
<td>
<p>The estimated fraction of bunchers in the dominated region, corrected for the integration constraint (only in notch case).</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+bunchit">bunchit</a></code>, <code><a href="#topic+fit_bunching">fit_bunching</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(bunching_data)
binned_data &lt;- bin_data(z_vector = bunching_data$kink, zstar = 10000,
                        binwidth = 50, bins_l = 20, bins_r = 20)
prepped_data &lt;- prep_data_for_fit(binned_data, zstar = 10000, binwidth = 50,
                                  bins_l = 20, bins_r = 20, poly = 4)
firstpass &lt;- fit_bunching(prepped_data$data_binned,
                          prepped_data$model_formula,
                          binwidth = 50)
corrected &lt;- do_correction(zstar = 10000, binwidth = 50,
                           data_prepped = prepped_data$data_binned,
                           firstpass_results = firstpass)
paste0("Without correction, b = ", firstpass$b_estimate)
paste0("With correction, b = ", round(corrected$b_corrected,3))
</code></pre>

<hr>
<h2 id='domregion'>Dominated Region</h2><span id='topic+domregion'></span>

<h3>Description</h3>

<p>Estimate z (the value of z_vector) that demarcates the upper bound of the dominated region (in notch settings only).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>domregion(zstar, t0, t1, binwidth)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="domregion_+3A_zstar">zstar</code></td>
<td>
<p>a numeric value for the the bunching point.</p>
</td></tr>
<tr><td><code id="domregion_+3A_t0">t0</code></td>
<td>
<p>numeric value setting the marginal (average) tax rate below zstar in a kink (notch) setting.</p>
</td></tr>
<tr><td><code id="domregion_+3A_t1">t1</code></td>
<td>
<p>numeric value setting the marginal (average) tax rate above zstar in a kink (notch) setting.</p>
</td></tr>
<tr><td><code id="domregion_+3A_binwidth">binwidth</code></td>
<td>
<p>a numeric value for the width of each bin.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>domregion</code> returns a list with the following objects related to the dominated region (in notch settings only):
</p>
<table role = "presentation">
<tr><td><code>zD</code></td>
<td>
<p>The level of z that demarcates the upper bound of the dominated region.</p>
</td></tr>
<tr><td><code>zD_bin</code></td>
<td>
<p>The value of the bin which zD falls in.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+bunchit">bunchit</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>domregion(zstar = 10000, t0 = 0, t1 = 0.2, binwidth = 50)
</code></pre>

<hr>
<h2 id='elasticity'>Elasticity</h2><span id='topic+elasticity'></span>

<h3>Description</h3>

<p>Estimate elasticity from single normalized bunching observation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>elasticity(
  beta,
  binwidth,
  zstar,
  t0,
  t1,
  notch = FALSE,
  e_parametric = FALSE,
  e_parametric_lb = 1e-04,
  e_parametric_ub = 3
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="elasticity_+3A_beta">beta</code></td>
<td>
<p>normalized excess mass.</p>
</td></tr>
<tr><td><code id="elasticity_+3A_binwidth">binwidth</code></td>
<td>
<p>a numeric value for the width of each bin.</p>
</td></tr>
<tr><td><code id="elasticity_+3A_zstar">zstar</code></td>
<td>
<p>a numeric value for the the bunching point.</p>
</td></tr>
<tr><td><code id="elasticity_+3A_t0">t0</code></td>
<td>
<p>numeric value setting the marginal (average) tax rate below zstar in a kink (notch) setting.</p>
</td></tr>
<tr><td><code id="elasticity_+3A_t1">t1</code></td>
<td>
<p>numeric value setting the marginal (average) tax rate above zstar in a kink (notch) setting.</p>
</td></tr>
<tr><td><code id="elasticity_+3A_notch">notch</code></td>
<td>
<p>whether analysis is for a kink or notch. Default is FALSE (kink).</p>
</td></tr>
<tr><td><code id="elasticity_+3A_e_parametric">e_parametric</code></td>
<td>
<p>whether to estimate elasticity using parametric specification (quasi-linear and iso-elastic utility function). Default is FALSE (which estimates reduced-form approximation).</p>
</td></tr>
<tr><td><code id="elasticity_+3A_e_parametric_lb">e_parametric_lb</code></td>
<td>
<p>lower bound for elasticity estimate's solution using parametric specification in notch setting. Default is 1e-04.</p>
</td></tr>
<tr><td><code id="elasticity_+3A_e_parametric_ub">e_parametric_ub</code></td>
<td>
<p>upper bound for elasticity estimate's solution using parametric specification in notch setting. Default is 3.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>elasticity</code> returns the estimated elasticity. By default, this is based on the reduced-form approximation. To use the parametric equivalent, set e_parametric to TRUE.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bunchit">bunchit</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>elasticity(beta = 2, binwidth = 50, zstar = 10000, t0 = 0, t1 = 0.2)

</code></pre>

<hr>
<h2 id='fit_bunching'>Fit Bunching</h2><span id='topic+fit_bunching'></span>

<h3>Description</h3>

<p>Fit bunching model to (binned) data and estimate excess mass.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_bunching(thedata, themodelformula, binwidth, notch = FALSE, zD_bin = NA)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fit_bunching_+3A_thedata">thedata</code></td>
<td>
<p>(binned) data that includes all variables necessary for fitting the model.</p>
</td></tr>
<tr><td><code id="fit_bunching_+3A_themodelformula">themodelformula</code></td>
<td>
<p>formula to fit.</p>
</td></tr>
<tr><td><code id="fit_bunching_+3A_binwidth">binwidth</code></td>
<td>
<p>a numeric value for the width of each bin.</p>
</td></tr>
<tr><td><code id="fit_bunching_+3A_notch">notch</code></td>
<td>
<p>whether analysis is for a kink or notch. Default is FALSE (kink).</p>
</td></tr>
<tr><td><code id="fit_bunching_+3A_zd_bin">zD_bin</code></td>
<td>
<p>the bin marking the upper end of the dominated region (notch case).</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>fit_bunching</code> returns a list of the following results:
</p>
<table role = "presentation">
<tr><td><code>coefficients</code></td>
<td>
<p>The coefficients from the fitted model.</p>
</td></tr>
<tr><td><code>residuals</code></td>
<td>
<p>The residuals from the fitted model.</p>
</td></tr>
<tr><td><code>cf_density</code></td>
<td>
<p>The estimated counterfactual density.</p>
</td></tr>
<tr><td><code>bunchers_excess</code></td>
<td>
<p>The estimate of the excess mass (not normalized).</p>
</td></tr>
<tr><td><code>cf_bunchers</code></td>
<td>
<p>The counterfactual estimate of counts in the bunching region.</p>
</td></tr>
<tr><td><code>b_estimate</code></td>
<td>
<p>The estimate of the normalized excess mass.</p>
</td></tr>
<tr><td><code>bins_bunchers</code></td>
<td>
<p>The number of bins in the bunching region.</p>
</td></tr>
<tr><td><code>model_formula</code></td>
<td>
<p>The model formula used for fitting.</p>
</td></tr>
<tr><td><code>B_zl_zstar</code></td>
<td>
<p>The count of bunchers in the bunching region below and up to zstar.</p>
</td></tr>
<tr><td><code>B_zstar_zu</code></td>
<td>
<p>The count of bunchers in the bunching region above zstar.</p>
</td></tr>
<tr><td><code>alpha</code></td>
<td>
<p>The estimated fraction of bunchers in the dominated region (only in notch case.)</p>
</td></tr>
<tr><td><code>zD_bin</code></td>
<td>
<p>The value of the bin which zD falls in.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+bunchit">bunchit</a></code>, <code><a href="#topic+prep_data_for_fit">prep_data_for_fit</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(bunching_data)
binned_data &lt;- bin_data(z_vector = bunching_data$kink, zstar = 10000,
                        binwidth = 50, bins_l = 20, bins_r = 20)
prepped_data &lt;- prep_data_for_fit(binned_data, zstar = 10000, binwidth = 50,
                                  bins_l = 20, bins_r = 20, poly = 4)
fitted &lt;- fit_bunching(thedata = prepped_data$data_binned,
                       themodelformula = prepped_data$model_formula,
                       binwidth = 50)
# extract coefficients
fitted$coefficients
</code></pre>

<hr>
<h2 id='marginal_buncher'>Marginal Buncher</h2><span id='topic+marginal_buncher'></span>

<h3>Description</h3>

<p>Calculate location (value of z_vector) of marginal buncher.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>marginal_buncher(beta, binwidth, zstar, notch = FALSE, alpha = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="marginal_buncher_+3A_beta">beta</code></td>
<td>
<p>normalized excess mass.</p>
</td></tr>
<tr><td><code id="marginal_buncher_+3A_binwidth">binwidth</code></td>
<td>
<p>a numeric value for the width of each bin.</p>
</td></tr>
<tr><td><code id="marginal_buncher_+3A_zstar">zstar</code></td>
<td>
<p>a numeric value for the the bunching point.</p>
</td></tr>
<tr><td><code id="marginal_buncher_+3A_notch">notch</code></td>
<td>
<p>whether analysis is for a kink or notch. Default is FALSE (kink).</p>
</td></tr>
<tr><td><code id="marginal_buncher_+3A_alpha">alpha</code></td>
<td>
<p>the proportion of individuals in dominated region (in notch setting).</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>marginal_buncher</code> returns the location of the marginal buncher, i.e. zstar + Dzstar.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bunchit">bunchit</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>marginal_buncher(beta = 2, binwidth = 50, zstar = 10000)
</code></pre>

<hr>
<h2 id='notch_equation'>Notch Equation</h2><span id='topic+notch_equation'></span>

<h3>Description</h3>

<p>Defines indifference condition based on parametric utility function in notch setting. Used to parametrically solve for elasticity.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>notch_equation(e, t0, t1, zstar, dzstar)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="notch_equation_+3A_e">e</code></td>
<td>
<p>elasticity.</p>
</td></tr>
<tr><td><code id="notch_equation_+3A_t0">t0</code></td>
<td>
<p>numeric value setting the marginal (average) tax rate below zstar in a kink (notch) setting.</p>
</td></tr>
<tr><td><code id="notch_equation_+3A_t1">t1</code></td>
<td>
<p>numeric value setting the marginal (average) tax rate above zstar in a kink (notch) setting.</p>
</td></tr>
<tr><td><code id="notch_equation_+3A_zstar">zstar</code></td>
<td>
<p>a numeric value for the the bunching point.</p>
</td></tr>
<tr><td><code id="notch_equation_+3A_dzstar">dzstar</code></td>
<td>
<p>The distance of the marginal buncher from zstar.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>util_diff</code> returns the difference in utility between zstar and z_I in notch setting.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bunchit">bunchit</a></code>
</p>
<p><code><a href="#topic+elasticity">elasticity</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>notch_equation(e = .04, t0 = 0, t1 = .2, zstar = 10000, dzstar = 50)
</code></pre>

<hr>
<h2 id='plot_bunching'>Bunching Plot</h2><span id='topic+plot_bunching'></span>

<h3>Description</h3>

<p>Creates the bunching plot.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_bunching(
  z_vector,
  binned_data,
  cf,
  zstar,
  binwidth,
  bins_excl_l = 0,
  bins_excl_r = 0,
  p_title = "",
  p_xtitle = deparse(substitute(z_vector)),
  p_ytitle = "Count",
  p_miny = 0,
  p_maxy = NA,
  p_ybreaks = NA,
  p_title_size = 11,
  p_axis_title_size = 10,
  p_axis_val_size = 8.5,
  p_freq_color = "black",
  p_cf_color = "maroon",
  p_zstar_color = "red",
  p_grid_major_y_color = "lightgrey",
  p_freq_size = 0.5,
  p_freq_msize = 1,
  p_cf_size = 0.5,
  p_zstar_size = 0.5,
  p_b = FALSE,
  b = NA,
  b_sd = NA,
  p_e = FALSE,
  e = NA,
  e_sd = NA,
  p_b_e_xpos = NA,
  p_b_e_ypos = NA,
  p_b_e_size = 3,
  t0 = NA,
  t1 = NA,
  notch = FALSE,
  p_domregion_color = NA,
  p_domregion_ltype = NA
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_bunching_+3A_z_vector">z_vector</code></td>
<td>
<p>a numeric vector of (unbinned) data.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_binned_data">binned_data</code></td>
<td>
<p>binned data with frequency and estimated counterfactual.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_cf">cf</code></td>
<td>
<p>the counterfactual to be plotted.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_zstar">zstar</code></td>
<td>
<p>a numeric value for the the bunching point.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_binwidth">binwidth</code></td>
<td>
<p>a numeric value for the width of each bin.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_bins_excl_l">bins_excl_l</code></td>
<td>
<p>number of bins to left of zstar to include in bunching region. Default is 0.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_bins_excl_r">bins_excl_r</code></td>
<td>
<p>number of bins to right of zstar to include in bunching region. Default is 0.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_p_title">p_title</code></td>
<td>
<p>plot's title. Default is empty.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_p_xtitle">p_xtitle</code></td>
<td>
<p>plot's x_axis label. Default is the name of z_vector.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_p_ytitle">p_ytitle</code></td>
<td>
<p>plot's y_axis label. Default is &quot;Count&quot;.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_p_miny">p_miny</code></td>
<td>
<p>plot's minimum y_axis value. Default is 0.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_p_maxy">p_maxy</code></td>
<td>
<p>plot's maximum y_axis value. Default is optimized internally.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_p_ybreaks">p_ybreaks</code></td>
<td>
<p>a numeric vector of y-axis values at which to add horizontal line markers in plot. Default is optimized internally.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_p_title_size">p_title_size</code></td>
<td>
<p>size of plot's title. Default is 11.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_p_axis_title_size">p_axis_title_size</code></td>
<td>
<p>size of plot's axes' title labels. Default is 10.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_p_axis_val_size">p_axis_val_size</code></td>
<td>
<p>size of plot's axes' numeric labels. Default is 8.5.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_p_freq_color">p_freq_color</code></td>
<td>
<p>plot's frequency line color. Default is &quot;black&quot;.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_p_cf_color">p_cf_color</code></td>
<td>
<p>plot's counterfactual line color. Default is &quot;maroon&quot;.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_p_zstar_color">p_zstar_color</code></td>
<td>
<p>plot's bunching region marker lines color. Default is &quot;red&quot;.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_p_grid_major_y_color">p_grid_major_y_color</code></td>
<td>
<p>plot's y-axis major grid line color. Default is &quot;lightgrey&quot;.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_p_freq_size">p_freq_size</code></td>
<td>
<p>plot's frequency line thickness. Default is 0.5.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_p_freq_msize">p_freq_msize</code></td>
<td>
<p>plot's frequency line marker size. Default is 1.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_p_cf_size">p_cf_size</code></td>
<td>
<p>plot's counterfactual line thickness. Default is 0.5.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_p_zstar_size">p_zstar_size</code></td>
<td>
<p>plot's bunching region marker line thickness. Default is 0.5.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_p_b">p_b</code></td>
<td>
<p>whether plot should also include the bunching estimate. Default is FALSE.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_b">b</code></td>
<td>
<p>normalized bunching estimate.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_b_sd">b_sd</code></td>
<td>
<p>standard deviation of the normalized bunching estimate.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_p_e">p_e</code></td>
<td>
<p>whether plot should also include the elasticity estimate. Only shown if p_b is TRUE. Default is FALSE.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_e">e</code></td>
<td>
<p>elasticity estimate.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_e_sd">e_sd</code></td>
<td>
<p>standard deviation of the elasticity estimate.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_p_b_e_xpos">p_b_e_xpos</code></td>
<td>
<p>plot's x-axis coordinate of bunching/elasticity estimate. Default is set internally.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_p_b_e_ypos">p_b_e_ypos</code></td>
<td>
<p>plot's y-axis coordinate of bunching/elasticity estimate. Default is set internally.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_p_b_e_size">p_b_e_size</code></td>
<td>
<p>size of plot's printed bunching/elasticity estimate. Default is 3.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_t0">t0</code></td>
<td>
<p>numeric value setting the marginal (average) tax rate below zstar in a kink (notch) setting.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_t1">t1</code></td>
<td>
<p>numeric value setting the marginal (average) tax rate above zstar in a kink (notch) setting.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_notch">notch</code></td>
<td>
<p>whether analysis is for a kink or notch. Default is FALSE (kink).</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_p_domregion_color">p_domregion_color</code></td>
<td>
<p>plot's dominated region marker line color in notch setting. Default is &quot;blue&quot;.</p>
</td></tr>
<tr><td><code id="plot_bunching_+3A_p_domregion_ltype">p_domregion_ltype</code></td>
<td>
<p>line type for the vertical line type marking the dominated region (zD) in the plot for notch settings. Default is &quot;longdash&quot;.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>plot_bunching</code> returns a plot with the frequency, counterfactual and bunching region demarcated. Can also include the bunching and elasticity estimate if specified.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bunchit">bunchit</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(bunching_data)
binned_data &lt;- bin_data(z_vector = bunching_data$kink, zstar = 10000,
                        binwidth = 50, bins_l = 20, bins_r = 20)
prepped_data &lt;- prep_data_for_fit(binned_data, zstar = 10000, binwidth = 50,
                                  bins_l = 20, bins_r = 20, poly = 4)
fitted &lt;- fit_bunching(thedata = prepped_data$data_binned,
                       themodelformula = prepped_data$model_formula,
                       binwidth = 50)
plot_bunching(z_vector = bunching_data$kink_vector,
              binned_data = prepped_data$data_binned,
              cf = fitted$cf_density, zstar = 10000,
              binwidth = 50, bins_excl_l = 0 , bins_excl_r = 0,
              b = 1.989, b_sd = 0.005, p_b = TRUE)
</code></pre>

<hr>
<h2 id='plot_hist'>Plot Histogram</h2><span id='topic+plot_hist'></span>

<h3>Description</h3>

<p>Create a binned plot for quick exploration without estimating bunching mass.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_hist(
  z_vector,
  binv = "median",
  zstar,
  binwidth,
  bins_l,
  bins_r,
  p_title = "",
  p_xtitle = "z_name",
  p_ytitle = "Count",
  p_title_size = 11,
  p_axis_title_size = 10,
  p_axis_val_size = 8.5,
  p_miny = 0,
  p_maxy = NA,
  p_ybreaks = NA,
  p_grid_major_y_color = "lightgrey",
  p_freq_color = "black",
  p_zstar_color = "red",
  p_freq_size = 0.5,
  p_freq_msize = 1,
  p_zstar_size = 0.5,
  p_zstar = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_hist_+3A_z_vector">z_vector</code></td>
<td>
<p>a numeric vector of (unbinned) data.</p>
</td></tr>
<tr><td><code id="plot_hist_+3A_binv">binv</code></td>
<td>
<p>a string setting location of zstar within its bin (&quot;min&quot;, &quot;max&quot; or &quot;median&quot; value). Default is median.</p>
</td></tr>
<tr><td><code id="plot_hist_+3A_zstar">zstar</code></td>
<td>
<p>a numeric value for the the bunching point.</p>
</td></tr>
<tr><td><code id="plot_hist_+3A_binwidth">binwidth</code></td>
<td>
<p>a numeric value for the width of each bin.</p>
</td></tr>
<tr><td><code id="plot_hist_+3A_bins_l">bins_l</code></td>
<td>
<p>number of bins to left of zstar to use in analysis.</p>
</td></tr>
<tr><td><code id="plot_hist_+3A_bins_r">bins_r</code></td>
<td>
<p>number of bins to right of zstar to use in analysis.</p>
</td></tr>
<tr><td><code id="plot_hist_+3A_p_title">p_title</code></td>
<td>
<p>plot's title. Default is empty.</p>
</td></tr>
<tr><td><code id="plot_hist_+3A_p_xtitle">p_xtitle</code></td>
<td>
<p>plot's x_axis label. Default is the name of z_vector.</p>
</td></tr>
<tr><td><code id="plot_hist_+3A_p_ytitle">p_ytitle</code></td>
<td>
<p>plot's y_axis label. Default is &quot;Count&quot;.</p>
</td></tr>
<tr><td><code id="plot_hist_+3A_p_title_size">p_title_size</code></td>
<td>
<p>size of plot's title. Default is 11.</p>
</td></tr>
<tr><td><code id="plot_hist_+3A_p_axis_title_size">p_axis_title_size</code></td>
<td>
<p>size of plot's axes' title labels. Default is 10.</p>
</td></tr>
<tr><td><code id="plot_hist_+3A_p_axis_val_size">p_axis_val_size</code></td>
<td>
<p>size of plot's axes' numeric labels. Default is 8.5.</p>
</td></tr>
<tr><td><code id="plot_hist_+3A_p_miny">p_miny</code></td>
<td>
<p>plot's minimum y_axis value. Default is 0.</p>
</td></tr>
<tr><td><code id="plot_hist_+3A_p_maxy">p_maxy</code></td>
<td>
<p>plot's maximum y_axis value. Default is optimized internally.</p>
</td></tr>
<tr><td><code id="plot_hist_+3A_p_ybreaks">p_ybreaks</code></td>
<td>
<p>a numeric vector of y-axis values at which to add horizontal line markers in plot. Default is optimized internally.</p>
</td></tr>
<tr><td><code id="plot_hist_+3A_p_grid_major_y_color">p_grid_major_y_color</code></td>
<td>
<p>plot's y-axis major grid line color. Default is &quot;lightgrey&quot;.</p>
</td></tr>
<tr><td><code id="plot_hist_+3A_p_freq_color">p_freq_color</code></td>
<td>
<p>plot's frequency line color. Default is &quot;black&quot;.</p>
</td></tr>
<tr><td><code id="plot_hist_+3A_p_zstar_color">p_zstar_color</code></td>
<td>
<p>plot's bunching region marker lines color. Default is &quot;red&quot;.</p>
</td></tr>
<tr><td><code id="plot_hist_+3A_p_freq_size">p_freq_size</code></td>
<td>
<p>plot's frequency line thickness. Default is 0.5.</p>
</td></tr>
<tr><td><code id="plot_hist_+3A_p_freq_msize">p_freq_msize</code></td>
<td>
<p>plot's frequency line marker size. Default is 1.</p>
</td></tr>
<tr><td><code id="plot_hist_+3A_p_zstar_size">p_zstar_size</code></td>
<td>
<p>plot's bunching region marker line thickness. Default is 0.5.</p>
</td></tr>
<tr><td><code id="plot_hist_+3A_p_zstar">p_zstar</code></td>
<td>
<p>whether to show vertical line for zstar. Default is TRUE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>plot_hist</code> returns a list with the following:
</p>
<table role = "presentation">
<tr><td><code>plot</code></td>
<td>
<p>the plot of the density without estimating a counterfactual.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>the binned data used for the plot.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+bunchit">bunchit</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# visualize a distribution
data(bunching_data)
plot_hist(z_vector = bunching_data$kink_vector,
binv = "median", zstar = 10000,
binwidth = 50, bins_l = 40, bins_r = 40)$plot

</code></pre>

<hr>
<h2 id='prep_data_for_fit'>Data Preparation</h2><span id='topic+prep_data_for_fit'></span>

<h3>Description</h3>

<p>Prepare binned data and model for bunching estimation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prep_data_for_fit(
  data_binned,
  zstar,
  binwidth,
  bins_l,
  bins_r,
  poly = 9,
  bins_excl_l = 0,
  bins_excl_r = 0,
  rn = NA,
  extra_fe = NA,
  correct_above_zu = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="prep_data_for_fit_+3A_data_binned">data_binned</code></td>
<td>
<p>dataframe of counts per bin</p>
</td></tr>
<tr><td><code id="prep_data_for_fit_+3A_zstar">zstar</code></td>
<td>
<p>a numeric value for the the bunching point.</p>
</td></tr>
<tr><td><code id="prep_data_for_fit_+3A_binwidth">binwidth</code></td>
<td>
<p>a numeric value for the width of each bin.</p>
</td></tr>
<tr><td><code id="prep_data_for_fit_+3A_bins_l">bins_l</code></td>
<td>
<p>number of bins to left of zstar to use in analysis.</p>
</td></tr>
<tr><td><code id="prep_data_for_fit_+3A_bins_r">bins_r</code></td>
<td>
<p>number of bins to right of zstar to use in analysis.</p>
</td></tr>
<tr><td><code id="prep_data_for_fit_+3A_poly">poly</code></td>
<td>
<p>a numeric value for the order of polynomial for counterfactual fit. Default is 9.</p>
</td></tr>
<tr><td><code id="prep_data_for_fit_+3A_bins_excl_l">bins_excl_l</code></td>
<td>
<p>number of bins to left of zstar to include in bunching region. Default is 0.</p>
</td></tr>
<tr><td><code id="prep_data_for_fit_+3A_bins_excl_r">bins_excl_r</code></td>
<td>
<p>number of bins to right of zstar to include in bunching region. Default is 0.</p>
</td></tr>
<tr><td><code id="prep_data_for_fit_+3A_rn">rn</code></td>
<td>
<p>a numeric vector of (up to 2) round numbers to control for. Default includes no controls.</p>
</td></tr>
<tr><td><code id="prep_data_for_fit_+3A_extra_fe">extra_fe</code></td>
<td>
<p>a numeric vector of bin values to control for using fixed effects. Default includes no controls.</p>
</td></tr>
<tr><td><code id="prep_data_for_fit_+3A_correct_above_zu">correct_above_zu</code></td>
<td>
<p>if integration constraint correction is implemented, should counterfactual be shifted only above zu (upper bound of exclusion region)? Default is FALSE (i.e. shift from above zstar).</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>data_binned</code> returns a list with the following:
</p>
<table role = "presentation">
<tr><td><code>data_binned</code></td>
<td>
<p>The binned data with the extra columns necessary for model fitting, such as indicators for bunching region, fixed effects, etc.</p>
</td></tr>
<tr><td><code>model_formula</code></td>
<td>
<p>The formula used for model fitting.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+bunchit">bunchit</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(bunching_data)
binned_data &lt;- bin_data(z_vector = bunching_data$kink, zstar = 10000,
                        binwidth = 50, bins_l = 20, bins_r = 20)
prepped_data &lt;- prep_data_for_fit(binned_data, zstar = 10000, binwidth = 50,
                                  bins_l = 20, bins_r = 20, poly = 4,
                                  bins_excl_l = 2, bins_excl_r = 3,
                                  rn = c(250,500), extra_fe = 10200)
head(prepped_data$data_binned)
prepped_data$model_formula
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
