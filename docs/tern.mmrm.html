<!DOCTYPE html><html><head><title>Help for package tern.mmrm</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {tern.mmrm}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#a_mmrm_subgroups'><p>Formatted Analysis Function for MMRM Subgroups</p></a></li>
<li><a href='#build_formula'><p>Building Model Formula</p></a></li>
<li><a href='#extract_mmrm_subgroups'><p>Extraction of MMRM Subgroup Results based on Population Model Definition</p></a></li>
<li><a href='#fit_mmrm'><p><code>MMRM</code> Analysis</p></a></li>
<li><a href='#g_covariance'><p>Visualization of Covariance Matrix</p></a></li>
<li><a href='#g_mmrm_diagnostic'><p>Diagnostic Plots for <code>MMRM</code></p></a></li>
<li><a href='#g_mmrm_lsmeans'><p>Plot LS means for MMRM</p></a></li>
<li><a href='#get_mmrm_lsmeans'><p>Extract Least Square Means from <code>MMRM</code></p></a></li>
<li><a href='#h_assert_data'><p>Assertions for Datasets</p></a></li>
<li><a href='#h_get_covariate_parts'><p>Extraction of Covariate Parts from Character Vector</p></a></li>
<li><a href='#h_get_diagnostics'><p>Linear Mixed Model Diagnostics</p></a></li>
<li><a href='#h_get_timepoint_vars'><p>Time points helper for Covariance Plot</p></a></li>
<li><a href='#h_mmrm_subgroup_df'><p>Helper for Extraction and Formatting of MMRM Subgroups</p></a></li>
<li><a href='#h_vectorization'><p>Vectorization helper for Covariance Plot</p></a></li>
<li><a href='#labels'><p>Adding Labels To Variables For Model</p></a></li>
<li><a href='#lsmeans_helpers'><p>Helpers for Processing Least Square Means</p></a></li>
<li><a href='#mmrm_test_data'><p>Example dataset for <code>tern.mmrm</code> package.</p></a></li>
<li><a href='#reexports'><p>Objects exported from other packages</p></a></li>
<li><a href='#tabulate_mmrm'><p>Tabulation of <code>MMRM</code> Results</p></a></li>
<li><a href='#tabulate_mmrm_subgroups'><p>Tabulation of MMRM Subgroups Results</p></a></li>
<li><a href='#tern.mmrm-package'><p><code>tern.mmrm</code> Package</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Tables and Graphs for Mixed Models for Repeated Measures (MMRM)</td>
</tr>
<tr>
<td>Version:</td>
<td>0.3.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-12-08</td>
</tr>
<tr>
<td>Description:</td>
<td>Mixed models for repeated measures (MMRM) are a popular choice for 
  analyzing longitudinal continuous outcomes in randomized clinical trials and beyond;
  see for example Cnaan, Laird and Slasor (1997) 
  &lt;<a href="https://doi.org/10.1002/(SICI)1097-0258(19971030)16:20%3C2349::AID-SIM667%3E3.0.CO;2-E">doi:10.1002/(SICI)1097-0258(19971030)16:20%3C2349::AID-SIM667%3E3.0.CO;2-E</a>&gt;.
  This package provides an interface for fitting MMRM within the 
  'tern' <a href="https://cran.r-project.org/package=tern">https://cran.r-project.org/package=tern</a> framework by Zhu et al. (2023)
  and tabulate results easily using 'rtables' <a href="https://cran.r-project.org/package=rtables">https://cran.r-project.org/package=rtables</a>
  by Becker et al. (2023). It builds on 'mmrm' <a href="https://cran.r-project.org/package=mmrm">https://cran.r-project.org/package=mmrm</a> 
  by Sabanés Bové et al. (2023) for the actual MMRM computations.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License 2.0</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/insightsengineering/tern.mmrm">https://github.com/insightsengineering/tern.mmrm</a>,
<a href="https://insightsengineering.github.io/tern.mmrm/">https://insightsengineering.github.io/tern.mmrm/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/insightsengineering/tern.mmrm/issues">https://github.com/insightsengineering/tern.mmrm/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.6), tern (&ge; 0.9.3)</td>
</tr>
<tr>
<td>Imports:</td>
<td>checkmate, cowplot, dplyr, emmeans (&ge; 1.6), formatters (&ge;
0.5.5), generics, ggplot2, lifecycle, magrittr, mmrm (&ge;
0.3.5), parallelly, rlang, rtables (&ge; 0.6.6), stats, tidyr</td>
</tr>
<tr>
<td>Suggests:</td>
<td>broom, grid, knitr, maditr, Matrix, rmarkdown, testthat (&ge;
3.1), vdiffr</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Collate:</td>
<td>'utils.R' 'assert_data.R' 'covariance_plot.R' 'fit_mmrm.R'
'formula.R' 'g_mmrm.R' 'labels.R' 'lsmeans.R' 'subgroups.R'
'tabulate_mmrm.R' 'tern.mmrm-package.R'</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-12-14 08:52:51 UTC; sabanesd</td>
</tr>
<tr>
<td>Author:</td>
<td>Daniel Sabanés Bové [aut, cre],
  Godwin Yung [aut],
  Francois Collin [aut],
  Julia Dedic [aut],
  Jana Stoilova [aut],
  Joe Zhu [aut],
  F. Hoffmann-La Roche AG [cph, fnd]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Daniel Sabanés Bové &lt;daniel.sabanes_bove@roche.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-12-14 16:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='a_mmrm_subgroups'>Formatted Analysis Function for MMRM Subgroups</h2><span id='topic+a_mmrm_subgroups'></span>

<h3>Description</h3>

<p>Formatted Analysis Function for MMRM Subgroups
</p>


<h3>Usage</h3>

<pre><code class='language-R'>a_mmrm_subgroups(.formats)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="a_mmrm_subgroups_+3A_.formats">.formats</code></td>
<td>
<p>(named <code>list</code>)<br /> containing the formats for the statistics
to use in the MMRM subgroups table.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of formatted analysis functions to be used in
<code><a href="#topic+tabulate_mmrm_subgroups">tabulate_mmrm_subgroups()</a></code>.
</p>

<hr>
<h2 id='build_formula'>Building Model Formula</h2><span id='topic+build_formula'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>
<p>This builds the model formula which is used inside <code><a href="#topic+fit_mmrm">fit_mmrm()</a></code> and provided
to <code><a href="mmrm.html#topic+mmrm">mmrm::mmrm()</a></code> internally. It can be instructive to look at the resulting
formula directly sometimes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>build_formula(
  vars,
  cor_struct = c("unstructured", "toeplitz", "heterogeneous toeplitz", "ante-dependence",
    "heterogeneous ante-dependence", "auto-regressive", "heterogeneous auto-regressive",
    "compound symmetry", "heterogeneous compound symmetry")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="build_formula_+3A_vars">vars</code></td>
<td>
<p>(<code>list</code>)<br /> variables to use in the model.</p>
</td></tr>
<tr><td><code id="build_formula_+3A_cor_struct">cor_struct</code></td>
<td>
<p>(<code>string</code>)<br /> specify the covariance structure to use.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Formula to use in <code><a href="mmrm.html#topic+mmrm">mmrm::mmrm()</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>vars &lt;- list(
  response = "AVAL", covariates = c("RACE", "SEX"),
  id = "USUBJID", arm = "ARMCD", visit = "AVISIT"
)
build_formula(vars, "auto-regressive")
build_formula(vars)
</code></pre>

<hr>
<h2 id='extract_mmrm_subgroups'>Extraction of MMRM Subgroup Results based on Population Model Definition</h2><span id='topic+extract_mmrm_subgroups'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>
<p>This prepares LS mean estimates and contrasts for a specific visit and treatment
arm relative to the reference arm, along with a list of subgroup variables and corresponding
(grouped) factor levels.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_mmrm_subgroups(
  fit,
  visit,
  subgroups = NULL,
  groups_lists = list(),
  treatment_arm = fit$treatment_levels[1L],
  label_all = "All Patients"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract_mmrm_subgroups_+3A_fit">fit</code></td>
<td>
<p>(<code>tern_mmrm</code>)<br /> model fit on the total population.</p>
</td></tr>
<tr><td><code id="extract_mmrm_subgroups_+3A_visit">visit</code></td>
<td>
<p>(<code>string</code>)<br /> single visit or name of averages of visits (referring
to the averages specified when creating the <code>fit</code>).</p>
</td></tr>
<tr><td><code id="extract_mmrm_subgroups_+3A_subgroups">subgroups</code></td>
<td>
<p>(<code>character</code> or <code>NULL</code>)<br /> names of subgroup variables to use in the
forest plot, these need to be factors.</p>
</td></tr>
<tr><td><code id="extract_mmrm_subgroups_+3A_groups_lists">groups_lists</code></td>
<td>
<p>(named <code>list</code> of <code>list</code>)<br /> optionally contains for each
<code>subgroups</code> variable a list, which specifies groups of factor levels, see
details.</p>
</td></tr>
<tr><td><code id="extract_mmrm_subgroups_+3A_treatment_arm">treatment_arm</code></td>
<td>
<p>(<code>string</code>)<br /> single treatment arm to compare with the reference
arm.</p>
</td></tr>
<tr><td><code id="extract_mmrm_subgroups_+3A_label_all">label_all</code></td>
<td>
<p>(<code>string</code>)<br /> label for the total population analysis.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>groups_lists</code> argument is handy when you don't want to have
subgroups identical to the original levels of the factor variable. This might
be the case when you want to merge levels into a single subgroup, define
overlapping subgroups or omit levels completely. Then you insert an element into
<code>groups_lists</code> with the name of the <code>subgroups</code> variable and containing
as a named list the subgroup definitions. See the example below.
</p>


<h3>Value</h3>

<p>A list with two elements:
</p>

<ul>
<li> <p><code>estimates</code>: <code>data.frame</code> with columns <code>arm</code>, <code>n</code>, <code>lsmean</code>, <code>subgroup</code>,
<code>var</code>, <code>var_label</code>, <code>row_type</code>, containing the LS means results for
the overall population and the specified subgroups.
</p>
</li>
<li> <p><code>contrasts</code>: <code>data.frame</code> with columns <code>n_tot</code>, <code>diff</code>, <code>lcl</code>, <code>ucl</code>,
<code>pval</code>, <code>subgroup</code>, <code>var</code>, <code>var_label</code>, <code>row_type</code>. Note
that this has half the number of rows as <code>estimates</code>.
</p>
</li></ul>



<h3>Note</h3>

<p>If the original model <code>vars</code> include <code>covariates</code> which are used here in
<code>subgroups</code> then these are dropped from <code>covariates</code> before the corresponding
model is fitted.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>mmrm_results &lt;- fit_mmrm(
  vars = list(
    response = "FEV1",
    covariates = "RACE",
    id = "USUBJID",
    arm = "ARMCD",
    visit = "AVISIT"
  ),
  data = mmrm_test_data,
  cor_struct = "compound symmetry",
  weights_emmeans = "equal",
  averages_emmeans = list(
    "VIS1+2" = c("VIS1", "VIS2")
  )
)

extract_mmrm_subgroups(
  fit = mmrm_results,
  visit = "VIS3",
  subgroups = c("RACE", "SEX"),
  groups_lists = list(
    RACE = list(
      A = c("Asian", "White"),
      B = c("Black or African American", "White")
    )
  )
)
</code></pre>

<hr>
<h2 id='fit_mmrm'><code>MMRM</code> Analysis</h2><span id='topic+fit_mmrm'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>
<p>Does the <code>MMRM</code> analysis. Multiple other functions can be called on the result to produce
tables and graphs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_mmrm(
  vars = list(response = "AVAL", covariates = c(), id = "USUBJID", arm = "ARM", visit =
    "AVISIT"),
  data,
  conf_level = 0.95,
  cor_struct = "unstructured",
  weights_emmeans = "proportional",
  averages_emmeans = list(),
  parallel = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fit_mmrm_+3A_vars">vars</code></td>
<td>
<p>(named <code>list</code> of <code>string</code> or <code>character</code>)<br /> specifying the variables in the <code>MMRM</code>.
The following elements need to be included as character vectors and match corresponding columns
in <code>data</code>:
</p>

<ul>
<li> <p><code>response</code>: the response variable.
</p>
</li>
<li> <p><code>covariates</code>: the additional covariate terms (might also include interactions).
</p>
</li>
<li> <p><code>id</code>: the subject ID variable.
</p>
</li>
<li> <p><code>arm</code>: the treatment group variable (factor).
</p>
</li>
<li> <p><code>visit</code>: the visit variable (factor).
</p>
</li>
<li> <p><code>weights</code>: optional weights variable (if <code>NULL</code> or omitted then no weights will be used).
</p>
</li></ul>

<p>Note that the main effects and interaction of <code>arm</code> and <code>visit</code> are by default
included in the model.</p>
</td></tr>
<tr><td><code id="fit_mmrm_+3A_data">data</code></td>
<td>
<p>(<code>data.frame</code>)<br /> with all the variables specified in
<code>vars</code>. Records with missing values in any independent variables
will be excluded.</p>
</td></tr>
<tr><td><code id="fit_mmrm_+3A_conf_level">conf_level</code></td>
<td>
<p>(<code>proportion</code>)<br /> confidence level of the interval.</p>
</td></tr>
<tr><td><code id="fit_mmrm_+3A_cor_struct">cor_struct</code></td>
<td>
<p>(<code>string</code>)<br /> specifying the covariance structure, defaults to
<code>"unstructured"</code>. See the details.</p>
</td></tr>
<tr><td><code id="fit_mmrm_+3A_weights_emmeans">weights_emmeans</code></td>
<td>
<p>(<code>string</code>)<br /> argument from <code><a href="emmeans.html#topic+emmeans">emmeans::emmeans()</a></code>, <code>"proportional"</code> by default.</p>
</td></tr>
<tr><td><code id="fit_mmrm_+3A_averages_emmeans">averages_emmeans</code></td>
<td>
<p>(<code>list</code>)<br /> optional named list of visit levels which should be averaged
and reported along side the single visits.</p>
</td></tr>
<tr><td><code id="fit_mmrm_+3A_parallel">parallel</code></td>
<td>
<p>(<code>flag</code>)<br /> controls whether the optimizer search can use available free cores on the
machine (not default).</p>
</td></tr>
<tr><td><code id="fit_mmrm_+3A_...">...</code></td>
<td>
<p>additional arguments for <code><a href="mmrm.html#topic+mmrm">mmrm::mmrm()</a></code>, in particular <code>reml</code> and options listed in
<code><a href="mmrm.html#topic+mmrm_control">mmrm::mmrm_control()</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Multiple different degree of freedom adjustments are available via the <code>method</code> argument
for <code><a href="mmrm.html#topic+mmrm">mmrm::mmrm()</a></code>. In addition, covariance matrix adjustments are available via <code>vcov</code>.
Please see <code><a href="mmrm.html#topic+mmrm_control">mmrm::mmrm_control()</a></code> for details and additional useful options.
</p>
<p>For the covariance structure (<code>cor_struct</code>), the user can choose among the following options.
</p>

<ul>
<li> <p><code>unstructured</code>: Unstructured covariance matrix. This is the most flexible choice and default.
If there are <code>T</code> visits, then <code>T * (T+1) / 2</code> variance parameters are used.
</p>
</li>
<li> <p><code>toeplitz</code>: Homogeneous Toeplitz covariance matrix, which uses <code>T</code> variance parameters.
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;heterogeneous toeplitz&#8288;</code>: Heterogeneous Toeplitz covariance matrix,
which uses <code>2 * T - 1</code> variance parameters.
</p>
</li>
<li> <p><code>ante-dependence</code>: Homogeneous Ante-Dependence covariance matrix, which uses <code>T</code> variance parameters.
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;heterogeneous ante-dependence&#8288;</code>: Heterogeneous Ante-Dependence covariance matrix,
which uses <code>2 * T - 1</code> variance parameters.
</p>
</li>
<li> <p><code>auto-regressive</code>: Homogeneous Auto-Regressive (order 1) covariance matrix,
which uses 2 variance parameters.
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;heterogeneous auto-regressive&#8288;</code>: Heterogeneous Auto-Regressive (order 1) covariance matrix,
which uses <code>T + 1</code> variance parameters.
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;compound symmetry&#8288;</code>: Homogeneous Compound Symmetry covariance matrix, which uses 2
variance parameters.
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;heterogeneous compound symmetry&#8288;</code>: Heterogeneous Compound Symmetry covariance matrix, which uses
<code>T + 1</code> variance parameters.
</p>
</li></ul>



<h3>Value</h3>

<p>A <code>tern_mmrm</code> object which is a list with MMRM results:
</p>

<ul>
<li> <p><code>fit</code>: The <code>mmrm</code> object which was fitted to the data. Note that via <code>mmrm::component(fit, "optimizer")</code>
the finally used optimization algorithm can be obtained, which can be useful for refitting the model
later on.
</p>
</li>
<li> <p><code>cov_estimate</code>: The matrix with the covariance matrix estimate.
</p>
</li>
<li> <p><code>diagnostics</code>: A list with model diagnostic statistics (REML criterion, AIC, corrected AIC, BIC).
</p>
</li>
<li> <p><code>lsmeans</code>: This is a list with data frames <code>estimates</code> and <code>contrasts</code>.
The attributes <code>averages</code> and <code>weights</code> save the settings used
(<code>averages_emmeans</code> and <code>weights_emmeans</code>).
</p>
</li>
<li> <p><code>vars</code>: The variable list.
</p>
</li>
<li> <p><code>labels</code>: Corresponding list with variable labels extracted from <code>data</code>.
</p>
</li>
<li> <p><code>cor_struct</code>: input.
</p>
</li>
<li> <p><code>parallel</code>: input.
</p>
</li>
<li> <p><code>ref_level</code>: The reference level for the arm variable, which is always the first level.
</p>
</li>
<li> <p><code>treatment_levels</code>: The treatment levels for the arm variable.
</p>
</li>
<li> <p><code>conf_level</code>: The confidence level which was used to construct the <code>lsmeans</code> confidence intervals.
</p>
</li>
<li> <p><code>additional</code>: List with any additional inputs passed via <code>...</code>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
library(rtables)

mmrm_results &lt;- fit_mmrm(
  vars = list(
    response = "FEV1",
    covariates = c("RACE", "SEX"),
    id = "USUBJID",
    arm = "ARMCD",
    visit = "AVISIT"
  ),
  data = mmrm_test_data,
  cor_struct = "unstructured",
  weights_emmeans = "equal",
  averages_emmeans = list(
    "VIS1+2" = c("VIS1", "VIS2")
  )
)

</code></pre>

<hr>
<h2 id='g_covariance'>Visualization of Covariance Matrix</h2><span id='topic+g_covariance'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>
<p>Plot of covariance (or correlation) matrix as a function of lag or time.
The covariance structure is vectorized internally and lag or time distances
are computed and can be used for visualization.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>g_covariance(
  vcov_matrix,
  time_prefix = NULL,
  x_var = c("lag", "time_diff"),
  xlab = NULL,
  ylab = ""
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="g_covariance_+3A_vcov_matrix">vcov_matrix</code></td>
<td>
<p>(<code>matrix</code>)<br /> symmetric covariance matrix with identical
row and column names.</p>
</td></tr>
<tr><td><code id="g_covariance_+3A_time_prefix">time_prefix</code></td>
<td>
<p>(<code>string</code>)<br /> string in the names of <code>vcov_matrix</code> that
precedes the time point value.</p>
</td></tr>
<tr><td><code id="g_covariance_+3A_x_var">x_var</code></td>
<td>
<p>(<code>string</code>)<br /> can be <code>lag</code> or <code>time_diff</code> for lag
or time difference, respectively.</p>
</td></tr>
<tr><td><code id="g_covariance_+3A_xlab">xlab</code></td>
<td>
<p>(<code>string</code> or <code>NULL</code>)<br /> x-axis label, if <code>NULL</code> then automatically
determined from <code>x_var</code>.</p>
</td></tr>
<tr><td><code id="g_covariance_+3A_ylab">ylab</code></td>
<td>
<p>(<code>string</code>)<br /> y-axis label.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The default <code>time_prefix</code> value is <code>NULL</code>, which assumes that the names
of the input matrix don't have any character string other than time point
value. If a <code>time_prefix</code> is specified, this string should appear in front of
all the names in <code>vcov_matrix</code>.
</p>


<h3>Value</h3>

<p>The <code>ggplot</code> object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>vcov_matrix &lt;- matrix(
  c(49, 12, 12, 23),
  nrow = 2, ncol = 2,
  dimnames = list(
    c(1, 2),
    c(1, 2)
  )
)
g_covariance(vcov_matrix, x_var = "time_diff")
</code></pre>

<hr>
<h2 id='g_mmrm_diagnostic'>Diagnostic Plots for <code>MMRM</code></h2><span id='topic+g_mmrm_diagnostic'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>
<p>This function produces diagnostic plots.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>g_mmrm_diagnostic(
  object,
  type = c("fit-residual", "q-q-residual"),
  z_threshold = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="g_mmrm_diagnostic_+3A_object">object</code></td>
<td>
<p>(<code>tern_mmrm</code>)<br /> model result produced by <code><a href="#topic+fit_mmrm">fit_mmrm()</a></code>.</p>
</td></tr>
<tr><td><code id="g_mmrm_diagnostic_+3A_type">type</code></td>
<td>
<p>(<code>string</code>)<br /> specifying the type of diagnostic plot to be produced:
</p>

<ul>
<li> <p><code>fit-residual</code>: A fitted vs residuals plot, grouped by visits.
This allows to see if there is remaining
structure in the residuals that might be captured by adding additional
covariates to the model.
</p>
</li>
<li> <p><code>q-q-residual</code>: A Q-Q plot for the residuals (i.e. sorted standardized residuals
vs. normal quantiles), grouped by visits. Observations with an absolute
standardized residual above <code>z_threshold</code> will be labeled.
</p>
</li></ul>
</td></tr>
<tr><td><code id="g_mmrm_diagnostic_+3A_z_threshold">z_threshold</code></td>
<td>
<p>(<code>numeric</code>)<br /> optional number indicating the normal quantile threshold
for the Q-Q plot.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Here we use marginal fitted values and residuals. That is, we estimate fitted values,
and the difference of those fitted values vs. the observed data are
the residuals.
</p>


<h3>Value</h3>

<p>A <code>ggplot2</code> plot.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+g_mmrm_lsmeans">g_mmrm_lsmeans()</a></code> for plotting the least-squares means and contrasts.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>mmrm_results &lt;- fit_mmrm(
  vars = list(
    response = "FEV1",
    covariates = c("RACE", "SEX"),
    id = "USUBJID",
    arm = "ARMCD",
    visit = "AVISIT"
  ),
  data = mmrm_test_data,
  cor_struct = "unstructured",
  weights_emmeans = "equal"
)
g_mmrm_diagnostic(mmrm_results)
g_mmrm_diagnostic(mmrm_results, type = "q-q-residual")
</code></pre>

<hr>
<h2 id='g_mmrm_lsmeans'>Plot LS means for MMRM</h2><span id='topic+g_mmrm_lsmeans'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>
<p>This function summarizes adjusted <code>lsmeans</code> and standard error, as well as conducts
comparisons between groups' adjusted <code>lsmeans</code>, where the first level of the group
is the reference level.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>g_mmrm_lsmeans(
  object,
  select = c("estimates", "contrasts"),
  titles = c(estimates = paste("Adjusted mean of", object$labels$response,
    "by treatment at visits"), contrasts = paste0("Differences of ",
    object$labels$response, " adjusted means vs. control ('", object$ref_level, "')")),
  xlab = object$labels$visit,
  ylab = paste0("Estimates with ", round(object$conf_level * 100), "% CIs"),
  width = 0.6,
  show_pval = TRUE,
  show_lines = FALSE,
  constant_baseline = NULL,
  n_baseline = NA_integer_,
  table_stats = character(),
  table_formats = c(n = "xx.", estimate = "xx.x", se = "xx.x", ci = "(xx.xx, xx.xx)"),
  table_labels = c(n = "n", estimate = "LS mean", se = "Std. Error", ci =
    paste0(round(object$conf_level * 100), "% CI")),
  table_font_size = 3,
  table_rel_height = 0.5
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="g_mmrm_lsmeans_+3A_object">object</code></td>
<td>
<p>(<code>tern_mmrm</code>)<br /> model result produced by <code><a href="#topic+fit_mmrm">fit_mmrm()</a></code>.</p>
</td></tr>
<tr><td><code id="g_mmrm_lsmeans_+3A_select">select</code></td>
<td>
<p>(<code>character</code>)<br /> to select one or both of &quot;estimates&quot; and &quot;contrasts&quot; plots.
Note &quot;contrasts&quot; option is not applicable to model summaries excluding an arm variable.</p>
</td></tr>
<tr><td><code id="g_mmrm_lsmeans_+3A_titles">titles</code></td>
<td>
<p>(<code>character</code>)<br /> with elements <code>estimates</code> and <code>contrasts</code> containing the plot titles.</p>
</td></tr>
<tr><td><code id="g_mmrm_lsmeans_+3A_xlab">xlab</code></td>
<td>
<p>(<code>string</code>)<br /> the x axis label.</p>
</td></tr>
<tr><td><code id="g_mmrm_lsmeans_+3A_ylab">ylab</code></td>
<td>
<p>(<code>string</code>)<br /> the y axis label.</p>
</td></tr>
<tr><td><code id="g_mmrm_lsmeans_+3A_width">width</code></td>
<td>
<p>(<code>numeric</code>)<br /> width of the error bars.</p>
</td></tr>
<tr><td><code id="g_mmrm_lsmeans_+3A_show_pval">show_pval</code></td>
<td>
<p>(<code>flag</code>)<br /> should the p-values for the differences of
LS means vs. control be displayed (not default)?</p>
</td></tr>
<tr><td><code id="g_mmrm_lsmeans_+3A_show_lines">show_lines</code></td>
<td>
<p>(<code>flag</code>)<br /> should the visit estimates be connected by lines (not default)?</p>
</td></tr>
<tr><td><code id="g_mmrm_lsmeans_+3A_constant_baseline">constant_baseline</code></td>
<td>
<p>(named <code>number</code> or <code>NULL</code>)<br /> optional constant baseline for the
LS mean estimates. If specified then needs to be a named <code>number</code>, and the name will be used to
label the corresponding baseline visit. The differences of LS means will always be 0 at this
baseline visit.</p>
</td></tr>
<tr><td><code id="g_mmrm_lsmeans_+3A_n_baseline">n_baseline</code></td>
<td>
<p>(<code>int</code> or named <code>integer</code>)<br /> optional number of patients at baseline.
Since this can be visible in the optional table below the estimates plot, and we cannot
infer this from <code>object</code> (since that is then only fit without baseline data), we need
to allow the user to specify this. If <code>number</code> then assumed constant across potential
treatment arms, otherwise one number per treatment arm can be provided.</p>
</td></tr>
<tr><td><code id="g_mmrm_lsmeans_+3A_table_stats">table_stats</code></td>
<td>
<p>(<code>character</code>)<br /> names of the statistics that will be displayed in the
table below the estimates plot. Note that the table will only be added when selecting only the
&quot;estimates&quot; plot. Available statistics are <code>n</code>, <code>estimate</code>, <code>se</code>, and <code>ci</code>.</p>
</td></tr>
<tr><td><code id="g_mmrm_lsmeans_+3A_table_formats">table_formats</code></td>
<td>
<p>(named <code>character</code>)<br /> format patterns for descriptive statistics
used in the (optional) estimates table appended to the estimates plot.</p>
</td></tr>
<tr><td><code id="g_mmrm_lsmeans_+3A_table_labels">table_labels</code></td>
<td>
<p>(named <code>character</code>)<br />
labels for the statistics in the (optional) estimates table.</p>
</td></tr>
<tr><td><code id="g_mmrm_lsmeans_+3A_table_font_size">table_font_size</code></td>
<td>
<p>(<code>number</code>)<br />
controls the font size of values in the (optional) estimates table.</p>
</td></tr>
<tr><td><code id="g_mmrm_lsmeans_+3A_table_rel_height">table_rel_height</code></td>
<td>
<p>(<code>number</code>)<br />
controls the relative height of the (optional) estimates table compared to the estimates plot.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If variable labels are available in the original data set, then these are used. Otherwise
the variable names themselves are used for annotating the plot.
</p>
<p>The contrast plot is not going to be returned if treatment is not
considered in the <code>tern_mmrm</code> object input,
no matter if <code>select</code> argument contains the <code>contrasts</code> value.
</p>


<h3>Value</h3>

<p>A <code>ggplot2</code> plot.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)

mmrm_results &lt;- fit_mmrm(
  vars = list(
    response = "FEV1",
    covariates = c("RACE", "SEX"),
    id = "USUBJID",
    arm = "ARMCD",
    visit = "AVISIT"
  ),
  data = mmrm_test_data,
  cor_struct = "unstructured",
  weights_emmeans = "equal"
)
g_mmrm_lsmeans(mmrm_results, constant_baseline = c(BSL = 0))
g_mmrm_lsmeans(
  mmrm_results,
  select = "estimates",
  show_lines = TRUE,
  xlab = "Visit"
)
g_mmrm_lsmeans(
  mmrm_results,
  select = "contrasts",
  titles = c(contrasts = "Contrasts of FKSI-FWB means"),
  show_pval = TRUE,
  show_lines = TRUE,
  width = 0.8
)

mmrm_test_data2 &lt;- mmrm_test_data %&gt;%
  filter(ARMCD == "TRT")

mmrm_results_no_arm &lt;- fit_mmrm(
  vars = list(
    response = "FEV1",
    covariates = c("RACE", "SEX"),
    id = "USUBJID",
    visit = "AVISIT"
  ),
  data = mmrm_test_data2,
  cor_struct = "unstructured",
  weights_emmeans = "equal"
)

g_mmrm_lsmeans(mmrm_results_no_arm, select = "estimates")
g_mmrm_lsmeans(
  mmrm_results_no_arm,
  select = c("estimates", "contrasts"),
  titles = c(
    estimates = "Adjusted mean of FKSI-FWB",
    contrasts = "it will not be created"
  ),
  show_pval = TRUE,
  width = 0.8
)

g_mmrm_lsmeans(
  mmrm_results_no_arm,
  select = "estimates",
  titles = c(estimates = "Adjusted mean of FKSI-FWB"),
  show_pval = TRUE,
  width = 0.8,
  show_lines = TRUE
)

g_mmrm_lsmeans(
  mmrm_results,
  select = "estimates",
  titles = c(estimates = "Adjusted mean of FKSI-FWB"),
  table_stats = c("n", "ci")
)
</code></pre>

<hr>
<h2 id='get_mmrm_lsmeans'>Extract Least Square Means from <code>MMRM</code></h2><span id='topic+get_mmrm_lsmeans'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>
<p>Extracts the least square means from an <code>MMRM</code> fit.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_mmrm_lsmeans(fit, vars, conf_level, weights, averages = list())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_mmrm_lsmeans_+3A_fit">fit</code></td>
<td>
<p>(<code>mmrm</code>)<br /> result of <code><a href="mmrm.html#topic+mmrm">mmrm::mmrm()</a></code>.</p>
</td></tr>
<tr><td><code id="get_mmrm_lsmeans_+3A_vars">vars</code></td>
<td>
<p>(named <code>list</code> of <code>string</code> or <code>character</code>)<br /> specifying the variables in the <code>MMRM</code>.
The following elements need to be included as character vectors and match corresponding columns
in <code>data</code>:
</p>

<ul>
<li> <p><code>response</code>: the response variable.
</p>
</li>
<li> <p><code>covariates</code>: the additional covariate terms (might also include interactions).
</p>
</li>
<li> <p><code>id</code>: the subject ID variable.
</p>
</li>
<li> <p><code>arm</code>: the treatment group variable (factor).
</p>
</li>
<li> <p><code>visit</code>: the visit variable (factor).
</p>
</li>
<li> <p><code>weights</code>: optional weights variable (if <code>NULL</code> or omitted then no weights will be used).
</p>
</li></ul>

<p>Note that the main effects and interaction of <code>arm</code> and <code>visit</code> are by default
included in the model.</p>
</td></tr>
<tr><td><code id="get_mmrm_lsmeans_+3A_conf_level">conf_level</code></td>
<td>
<p>(<code>proportion</code>)<br /> confidence level of the interval.</p>
</td></tr>
<tr><td><code id="get_mmrm_lsmeans_+3A_weights">weights</code></td>
<td>
<p>(<code>string</code>)<br /> type of weights to be used for the least square means,
see <code><a href="emmeans.html#topic+emmeans">emmeans::emmeans()</a></code> for details.</p>
</td></tr>
<tr><td><code id="get_mmrm_lsmeans_+3A_averages">averages</code></td>
<td>
<p>(<code>list</code>)<br /> named list of visit levels which should be averaged
and reported along side the single visits.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with data frames <code>estimates</code> and <code>contrasts</code>.
The attributes <code>averages</code> and <code>weights</code> save the settings used.
</p>

<hr>
<h2 id='h_assert_data'>Assertions for Datasets</h2><span id='topic+h_assert_data'></span><span id='topic+h_assert_one_rec_pt_visit'></span><span id='topic+h_assert_rsp_var'></span><span id='topic+h_assert_visit_var'></span><span id='topic+h_assert_id_var'></span><span id='topic+h_assert_weights_var'></span>

<h3>Description</h3>

<p>We provide assertion functions to check the input dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>h_assert_one_rec_pt_visit(vars, data)

h_assert_rsp_var(vars, data)

h_assert_visit_var(vars, data)

h_assert_id_var(vars, data)

h_assert_weights_var(vars, data)

h_assert_data(vars, data)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="h_assert_data_+3A_vars">vars</code></td>
<td>
<p>(<code>list</code>)<br /> variables to use.</p>
</td></tr>
<tr><td><code id="h_assert_data_+3A_data">data</code></td>
<td>
<p>(<code>data.frame</code>)<br /> data to use.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing, only fails with an error if assertion does not hold.
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>h_assert_one_rec_pt_visit()</code>: asserts single record per patient and visit.
</p>
</li>
<li> <p><code>h_assert_rsp_var()</code>: assert numeric response variable.
</p>
</li>
<li> <p><code>h_assert_visit_var()</code>: assert factor visit variable.
</p>
</li>
<li> <p><code>h_assert_id_var()</code>: assert subject ID variable.
</p>
</li>
<li> <p><code>h_assert_weights_var()</code>: assert numeric weights variable.
</p>
</li>
<li> <p><code>h_assert_data()</code>: high-level assertion function to check the dataset.
</p>
</li></ul>

<hr>
<h2 id='h_get_covariate_parts'>Extraction of Covariate Parts from Character Vector</h2><span id='topic+h_get_covariate_parts'></span>

<h3>Description</h3>

<p>Extraction of Covariate Parts from Character Vector
</p>


<h3>Usage</h3>

<pre><code class='language-R'>h_get_covariate_parts(covariates)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="h_get_covariate_parts_+3A_covariates">covariates</code></td>
<td>
<p>(<code>character</code>)<br /> specification in the usual way, see examples.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Character vector of the covariates involved in <code>covariates</code> specification.
</p>

<hr>
<h2 id='h_get_diagnostics'>Linear Mixed Model Diagnostics</h2><span id='topic+h_get_diagnostics'></span>

<h3>Description</h3>

<p>Compute the model diagnostic statistics for a linear mixed model fit.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>h_get_diagnostics(fit)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="h_get_diagnostics_+3A_fit">fit</code></td>
<td>
<p>(<code>mmrm</code>)<br /> object fit with <code><a href="mmrm.html#topic+mmrm">mmrm::mmrm()</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the <code>REML</code> criterion, the <code>AIC</code>, <code>AICc</code> and <code>BIC</code>.
</p>

<hr>
<h2 id='h_get_timepoint_vars'>Time points helper for Covariance Plot</h2><span id='topic+h_get_timepoint_vars'></span>

<h3>Description</h3>

<p>Get the inputted symmetric matrices row and column labels as numeric time points.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>h_get_timepoint_vars(vcov_matrix, time_prefix = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="h_get_timepoint_vars_+3A_vcov_matrix">vcov_matrix</code></td>
<td>
<p>(<code>matrix</code>)<br /> symmetric covariance matrix with identical
row and column names.</p>
</td></tr>
<tr><td><code id="h_get_timepoint_vars_+3A_time_prefix">time_prefix</code></td>
<td>
<p>(<code>string</code>)<br /> string in the names of <code>vcov_matrix</code> that
precedes the time point value.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>This function returns a list with of two sets of numbers:
<code>row_time</code> and <code>col_time</code>, identifying the timepoints of the upper triangular
part of <code>vcov_matrix</code>.
</p>

<hr>
<h2 id='h_mmrm_subgroup_df'>Helper for Extraction and Formatting of MMRM Subgroups</h2><span id='topic+h_mmrm_subgroup_df'></span>

<h3>Description</h3>

<p>This is an internal helper to extract the correct LS mean estimates and
contrast for a specific visit and treatment arm relative to the reference
arm for one MMRM subgroup.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>h_mmrm_subgroup_df(
  lsmeans,
  overall_fit,
  is_in_subset,
  visit,
  treatment_arm,
  subgroup,
  var,
  label
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="h_mmrm_subgroup_df_+3A_lsmeans">lsmeans</code></td>
<td>
<p>(named <code>list</code> or <code>NULL</code>)<br /> LS mean estimates from <code><a href="#topic+fit_mmrm">fit_mmrm()</a></code>
on this subgroup.</p>
</td></tr>
<tr><td><code id="h_mmrm_subgroup_df_+3A_overall_fit">overall_fit</code></td>
<td>
<p>(<code>tern_mmrm</code>)<br /> result of <code><a href="#topic+fit_mmrm">fit_mmrm()</a></code> on overall data.</p>
</td></tr>
<tr><td><code id="h_mmrm_subgroup_df_+3A_is_in_subset">is_in_subset</code></td>
<td>
<p>(<code>logical</code>)<br /> specifying which row from the overall data
should be used for this subset.</p>
</td></tr>
<tr><td><code id="h_mmrm_subgroup_df_+3A_visit">visit</code></td>
<td>
<p>(<code>string</code>)<br /> which visit to extract.</p>
</td></tr>
<tr><td><code id="h_mmrm_subgroup_df_+3A_treatment_arm">treatment_arm</code></td>
<td>
<p>(<code>string</code>)<br /> which treatment arm to extract.</p>
</td></tr>
<tr><td><code id="h_mmrm_subgroup_df_+3A_subgroup">subgroup</code></td>
<td>
<p>(<code>string</code>)<br /> for labeling in the resulting <code>data.frame</code>.</p>
</td></tr>
<tr><td><code id="h_mmrm_subgroup_df_+3A_var">var</code></td>
<td>
<p>(<code>string</code>)<br /> specifies which variable was used to derive the subset,
if <code>ALL</code> then this means the overall data was used.</p>
</td></tr>
<tr><td><code id="h_mmrm_subgroup_df_+3A_label">label</code></td>
<td>
<p>(<code>string</code>)<br /> variable label.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List with <code>estimates</code> (with 2 rows) and <code>contrasts</code> (with 1 row) in the
format needed in <code><a href="#topic+extract_mmrm_subgroups">extract_mmrm_subgroups()</a></code>.
</p>

<hr>
<h2 id='h_vectorization'>Vectorization helper for Covariance Plot</h2><span id='topic+h_vectorization'></span>

<h3>Description</h3>

<p>This function vectorizes the upper-diagonal elements of a symmetric matrix
(e.g. the covariance matrix) and obtains the lag and time distance between
pairs of observations if the time values are part of the names or are part of
the matrix column and row names.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>h_vectorization(vcov_matrix, time_prefix = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="h_vectorization_+3A_vcov_matrix">vcov_matrix</code></td>
<td>
<p>(<code>matrix</code>)<br /> symmetric covariance matrix with identical
row and column names.</p>
</td></tr>
<tr><td><code id="h_vectorization_+3A_time_prefix">time_prefix</code></td>
<td>
<p>(<code>string</code>)<br /> string in the names of <code>vcov_matrix</code> that
precedes the time point value.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>data.frame</code> with the upper-diagonal elements of <code>vcov_matrix</code>.
In the context of repeated measures, this matrix contains the association between pairs
of measurements taken at different time points. It contains the following columns:
</p>

<ul>
<li> <p><code>Vect</code>: the upper-diagonal elements of <code>vcov_matrix</code>.
</p>
</li>
<li> <p><code>time_diff</code>: the difference between column and row times.
</p>
</li>
<li> <p><code>lag</code>: the lag, defined as the difference between column and row ranks.
</p>
</li>
<li> <p><code>rank_row</code>: the row rank.
</p>
</li>
<li> <p><code>rank_col</code>: the column rank.
</p>
</li></ul>


<hr>
<h2 id='labels'>Adding Labels To Variables For Model</h2><span id='topic+labels'></span><span id='topic+h_is_specified'></span><span id='topic+h_is_specified_and_in_data'></span><span id='topic+h_check_and_get_label'></span><span id='topic+h_labels'></span>

<h3>Description</h3>

<p>Adding Labels To Variables For Model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>h_is_specified(x, vars)

h_is_specified_and_in_data(x, vars, data)

h_check_and_get_label(x, vars, data)

h_labels(vars, data)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="labels_+3A_x">x</code></td>
<td>
<p>(<code>character</code>)<br /> an element in vars.</p>
</td></tr>
<tr><td><code id="labels_+3A_vars">vars</code></td>
<td>
<p>(<code>list</code>)<br /> variables to use.</p>
</td></tr>
<tr><td><code id="labels_+3A_data">data</code></td>
<td>
<p>(<code>data.frame</code>)<br /> data to use.</p>
</td></tr>
</table>


<h3>Functions</h3>


<ul>
<li> <p><code>h_is_specified()</code>: checks if element in <code>vars</code> is not <code>NULL</code> and not empty.
</p>
</li>
<li> <p><code>h_is_specified_and_in_data()</code>: checks if element in vars is not NULL and exists in dataset.
</p>
</li>
<li> <p><code>h_check_and_get_label()</code>: gets label for each element in vars.
</p>
</li>
<li> <p><code>h_labels()</code>: returns the list of variables with labels.
</p>
</li></ul>

<hr>
<h2 id='lsmeans_helpers'>Helpers for Processing Least Square Means</h2><span id='topic+lsmeans_helpers'></span><span id='topic+h_get_emmeans_res'></span><span id='topic+h_get_average_visit_specs'></span><span id='topic+h_get_spec_visit_estimates'></span><span id='topic+h_get_single_visit_estimates'></span><span id='topic+h_get_relative_reduc_df'></span><span id='topic+h_single_visit_contrast_specs'></span><span id='topic+h_average_visit_contrast_specs'></span>

<h3>Description</h3>

<p>Helpers for Processing Least Square Means
</p>


<h3>Usage</h3>

<pre><code class='language-R'>h_get_emmeans_res(fit, vars, weights)

h_get_average_visit_specs(emmeans_res, vars, averages, fit)

h_get_spec_visit_estimates(emmeans_res, specs, conf_level, tests = FALSE)

h_get_single_visit_estimates(emmeans_res, conf_level)

h_get_relative_reduc_df(estimates, vars)

h_single_visit_contrast_specs(emmeans_res, vars)

h_average_visit_contrast_specs(specs, averages)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="lsmeans_helpers_+3A_fit">fit</code></td>
<td>
<p>result of <code><a href="mmrm.html#topic+mmrm">mmrm::mmrm()</a></code>.</p>
</td></tr>
<tr><td><code id="lsmeans_helpers_+3A_vars">vars</code></td>
<td>
<p>(named <code>list</code> of <code>string</code> or <code>character</code>)<br /> specifying the variables in the <code>MMRM</code>.
The following elements need to be included as character vectors and match corresponding columns
in <code>data</code>:
</p>

<ul>
<li> <p><code>response</code>: the response variable.
</p>
</li>
<li> <p><code>covariates</code>: the additional covariate terms (might also include interactions).
</p>
</li>
<li> <p><code>id</code>: the subject ID variable.
</p>
</li>
<li> <p><code>arm</code>: the treatment group variable (factor).
</p>
</li>
<li> <p><code>visit</code>: the visit variable (factor).
</p>
</li>
<li> <p><code>weights</code>: optional weights variable (if <code>NULL</code> or omitted then no weights will be used).
</p>
</li></ul>

<p>Note that the main effects and interaction of <code>arm</code> and <code>visit</code> are by default
included in the model.</p>
</td></tr>
<tr><td><code id="lsmeans_helpers_+3A_weights">weights</code></td>
<td>
<p>(<code>string</code>)<br /> argument from <code><a href="emmeans.html#topic+emmeans">emmeans::emmeans()</a></code>, &quot;proportional&quot; by default.</p>
</td></tr>
<tr><td><code id="lsmeans_helpers_+3A_emmeans_res">emmeans_res</code></td>
<td>
<p>(<code>list</code>)<br /> initial <code>emmeans</code> result from <code><a href="#topic+h_get_emmeans_res">h_get_emmeans_res()</a></code>.</p>
</td></tr>
<tr><td><code id="lsmeans_helpers_+3A_averages">averages</code></td>
<td>
<p>(<code>list</code>)<br /> optional named list of visit levels which should be averaged
and reported along side the single visits.</p>
</td></tr>
<tr><td><code id="lsmeans_helpers_+3A_specs">specs</code></td>
<td>
<p>(<code>list</code>)<br /> list of least square means specifications, with
elements <code>coefs</code> (coefficient list) and <code>grid</code> (corresponding <code>data.frame</code>).</p>
</td></tr>
<tr><td><code id="lsmeans_helpers_+3A_conf_level">conf_level</code></td>
<td>
<p>(<code>proportion</code>)<br /> confidence level of the interval.</p>
</td></tr>
<tr><td><code id="lsmeans_helpers_+3A_tests">tests</code></td>
<td>
<p>(<code>flag</code>)<br /> whether to add test results to the estimates.</p>
</td></tr>
<tr><td><code id="lsmeans_helpers_+3A_estimates">estimates</code></td>
<td>
<p>(<code>data.frame</code>)<br /> single visit least square mean estimates.</p>
</td></tr>
</table>


<h3>Functions</h3>


<ul>
<li> <p><code>h_get_emmeans_res()</code>: returns a list with
<code>object</code> (<code>emmGrid</code> object containing <code>emmeans</code> results) and <code>grid</code>
(<code>data.frame</code> containing the potential arm and the visit variables
together with the sample size <code>n</code> for each combination).
</p>
</li>
<li> <p><code>h_get_average_visit_specs()</code>: constructs average of visits specifications.
</p>
</li>
<li> <p><code>h_get_spec_visit_estimates()</code>: estimates least square means as a <code>data.frame</code>
given specifications.
</p>
</li>
<li> <p><code>h_get_single_visit_estimates()</code>: estimates least square means for single visits.
</p>
</li>
<li> <p><code>h_get_relative_reduc_df()</code>: constructs <code>data.frame</code> with
relative reduction vs. reference arm based on single visit estimates.
</p>
</li>
<li> <p><code>h_single_visit_contrast_specs()</code>: constructs single visit contrast specifications.
</p>
</li>
<li> <p><code>h_average_visit_contrast_specs()</code>: constructs average visits contrast specifications,
given the <code>specs</code> for single visit contrasts and the averages required.
</p>
</li></ul>

<hr>
<h2 id='mmrm_test_data'>Example dataset for <code>tern.mmrm</code> package.</h2><span id='topic+mmrm_test_data'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>
<p>Measurements of <code>FEV1</code> (forced expired volume in one second) is a measure of how quickly the lungs can be emptied.
Low levels of <code>FEV1</code> may indicate chronic obstructive pulmonary disease (<code>COPD</code>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mmrm_test_data
</code></pre>


<h3>Format</h3>

<p>A <code>tibble</code> with 800 rows and 7 variables:
</p>

<ul>
<li> <p><code>USUBJID</code>: unique subject identifier.
</p>
</li>
<li> <p><code>AVISIT</code>: visit number.
</p>
</li>
<li> <p><code>ARMCD</code>: treatment, <code>TRT</code> or <code>PBO</code>.
</p>
</li>
<li> <p><code>RACE</code>: 3-category race.
</p>
</li>
<li> <p><code>SEX</code>: sex.
</p>
</li>
<li> <p><code>FEV1_BL</code>: <code>FEV1</code> at baseline (%).
</p>
</li>
<li> <p><code>FEV1</code>: <code>FEV1</code> at study visits.
</p>
</li></ul>


<hr>
<h2 id='reexports'>Objects exported from other packages</h2><span id='topic+reexports'></span><span id='topic+as.rtable'></span><span id='topic+tidy'></span>

<h3>Description</h3>

<p>These objects are imported from other packages. Follow the links
below to see their documentation.
</p>

<dl>
<dt>generics</dt><dd><p><code><a href="generics.html#topic+tidy">tidy</a></code></p>
</dd>
<dt>tern</dt><dd><p><code><a href="tern.html#topic+as.rtable">as.rtable</a></code></p>
</dd>
</dl>

<hr>
<h2 id='tabulate_mmrm'>Tabulation of <code>MMRM</code> Results</h2><span id='topic+tabulate_mmrm'></span><span id='topic+as.rtable.tern_mmrm'></span><span id='topic+h_mmrm_fixed'></span><span id='topic+h_mmrm_cov'></span><span id='topic+h_mmrm_diagnostic'></span><span id='topic+tidy.tern_mmrm'></span><span id='topic+s_mmrm_lsmeans'></span><span id='topic+a_mmrm_lsmeans'></span><span id='topic+s_mmrm_lsmeans_single'></span><span id='topic+a_mmrm_lsmeans_single'></span><span id='topic+summarize_lsmeans'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>
<p>These functions can be used to produce tables from a fitted <code>MMRM</code> produced with
<code><a href="#topic+fit_mmrm">fit_mmrm()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'tern_mmrm'
as.rtable(x, type = c("fixed", "cov", "diagnostic"), ...)

h_mmrm_fixed(x, format = "xx.xxxx")

h_mmrm_cov(x, format = "xx.xxxx")

h_mmrm_diagnostic(x, format = "xx.xxxx")

## S3 method for class 'tern_mmrm'
tidy(x, ...)

s_mmrm_lsmeans(df, .in_ref_col, show_relative = c("reduction", "increase"))

a_mmrm_lsmeans(df, .in_ref_col, show_relative = c("reduction", "increase"))

s_mmrm_lsmeans_single(df)

a_mmrm_lsmeans_single(df)

summarize_lsmeans(
  lyt,
  arms = TRUE,
  ...,
  table_names = "lsmeans_summary",
  .stats = NULL,
  .formats = NULL,
  .indent_mods = NULL,
  .labels = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tabulate_mmrm_+3A_x">x</code></td>
<td>
<p>(<code>tern_mmrm</code>)<br /> the original result from <code><a href="#topic+fit_mmrm">fit_mmrm()</a></code>.</p>
</td></tr>
<tr><td><code id="tabulate_mmrm_+3A_type">type</code></td>
<td>
<p>(<code>string</code>)<br /> type of table which should be returned.</p>
</td></tr>
<tr><td><code id="tabulate_mmrm_+3A_...">...</code></td>
<td>
<p>additional argument <code>format</code> for controlling the numeric format.</p>
</td></tr>
<tr><td><code id="tabulate_mmrm_+3A_format">format</code></td>
<td>
<p>(<code>string</code>)<br /> format for the numbers in the table.</p>
</td></tr>
<tr><td><code id="tabulate_mmrm_+3A_df">df</code></td>
<td>
<p>(<code style="white-space: pre;">&#8288;data frame&#8288;</code>)<br /> data set containing all analysis variables.</p>
</td></tr>
<tr><td><code id="tabulate_mmrm_+3A_.in_ref_col">.in_ref_col</code></td>
<td>
<p>(<code>logical</code>)<br /> <code>TRUE</code> when working with the reference level, <code>FALSE</code> otherwise.</p>
</td></tr>
<tr><td><code id="tabulate_mmrm_+3A_show_relative">show_relative</code></td>
<td>
<p>should the &quot;reduction&quot; (<code>control - treatment</code>, default) or the &quot;increase&quot;
(<code>treatment - control</code>) be shown for the relative change from baseline?</p>
</td></tr>
<tr><td><code id="tabulate_mmrm_+3A_lyt">lyt</code></td>
<td>
<p>(<code>layout</code>)<br /> input layout where analyses will be added to.</p>
</td></tr>
<tr><td><code id="tabulate_mmrm_+3A_arms">arms</code></td>
<td>
<p>(<code>flag</code>)<br />  should treatment variable be considered when using
<code>summarize_lsmeans</code> layout generating function.</p>
</td></tr>
<tr><td><code id="tabulate_mmrm_+3A_table_names">table_names</code></td>
<td>
<p>(<code>character</code>)<br /> this can be customized in case that the same <code>vars</code> are analyzed multiple times,
to avoid warnings from <code>rtables</code>.</p>
</td></tr>
<tr><td><code id="tabulate_mmrm_+3A_.stats">.stats</code></td>
<td>
<p>(<code>character</code>)<br /> statistics to select for the table.</p>
</td></tr>
<tr><td><code id="tabulate_mmrm_+3A_.formats">.formats</code></td>
<td>
<p>(named <code>character</code> or <code>list</code>)<br /> formats for the statistics.</p>
</td></tr>
<tr><td><code id="tabulate_mmrm_+3A_.indent_mods">.indent_mods</code></td>
<td>
<p>(named <code>integer</code>)<br /> indent modifiers for the labels.</p>
</td></tr>
<tr><td><code id="tabulate_mmrm_+3A_.labels">.labels</code></td>
<td>
<p>(named <code>character</code>)<br /> labels for the statistics (without indent).</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code><a href="#topic+as.rtable.tern_mmrm">as.rtable.tern_mmrm()</a></code> returns the fixed effects, covariance estimate or
diagnostic statistics tables.
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>as.rtable(tern_mmrm)</code>: Produce simple <code>MMRM</code> tables via the generic <code><a href="#topic+as.rtable">as.rtable()</a></code>.
</p>
</li>
<li> <p><code>h_mmrm_fixed()</code>: Helper function to produce fixed effects table.
</p>
</li>
<li> <p><code>h_mmrm_cov()</code>: Helper function to produce a covariance matrix table.
</p>
</li>
<li> <p><code>h_mmrm_diagnostic()</code>: Helper function to produce a diagnostic statistics table.
</p>
</li>
<li> <p><code>tidy(tern_mmrm)</code>: Helper method (for <code><a href="broom.html#topic+reexports">broom::tidy()</a></code>) to prepare a <code>data.frame</code> from an
<code>tern_mmrm</code> object containing the least-squares means and contrasts.
</p>
</li>
<li> <p><code>s_mmrm_lsmeans()</code>: Statistics function which is extracting estimates from a tidied least-squares means
data frame.
</p>
</li>
<li> <p><code>a_mmrm_lsmeans()</code>: Formatted Analysis function which can be further customized by calling
<code><a href="rtables.html#topic+make_afun">rtables::make_afun()</a></code> on it. It is used as <code>afun</code> in <code><a href="rtables.html#topic+analyze">rtables::analyze()</a></code>.
</p>
</li>
<li> <p><code>s_mmrm_lsmeans_single()</code>: Statistics function which is extracting estimates from a tidied least-squares means
data frame when <code>ARM</code> is not considered in the model.
</p>
</li>
<li> <p><code>a_mmrm_lsmeans_single()</code>: Formatted Analysis function (when <code>ARM</code> is not considered in the model)
which can be further customized by calling
<code><a href="rtables.html#topic+make_afun">rtables::make_afun()</a></code> on it. It is used as <code>afun</code> in <code><a href="rtables.html#topic+analyze">rtables::analyze()</a></code>.
</p>
</li>
<li> <p><code>summarize_lsmeans()</code>: Analyze function for tabulating least-squares means estimates from tidied <code>mmrm</code> results.
</p>
</li></ul>


<h3>Examples</h3>

<pre><code class='language-R'>result &lt;- fit_mmrm(
  vars = list(
    response = "FEV1",
    covariates = c("RACE", "SEX"),
    id = "USUBJID",
    arm = "ARMCD",
    visit = "AVISIT"
  ),
  data = mmrm_test_data,
  cor_struct = "unstructured",
  weights_emmeans = "equal"
)
as.rtable(result, type = "cov", format = "xx.x")

result_no_arm &lt;- fit_mmrm(
  vars = list(
    response = "FEV1",
    covariates = c("RACE", "SEX"),
    id = "USUBJID",
    visit = "AVISIT"
  ),
  data = mmrm_test_data,
  cor_struct = "unstructured",
  weights_emmeans = "equal"
)
as.rtable(result_no_arm, type = "cov", format = "xx.x")
df &lt;- broom::tidy(result)
df_no_arm &lt;- broom::tidy(result_no_arm)
s_mmrm_lsmeans(df[8, ], .in_ref_col = FALSE)
s_mmrm_lsmeans_single(df_no_arm[4, ])

library(dplyr)
dat_adsl &lt;- mmrm_test_data %&gt;%
  select(USUBJID, ARMCD) %&gt;%
  unique()
basic_table() %&gt;%
  split_cols_by("ARMCD", ref_group = result$ref_level) %&gt;%
  add_colcounts() %&gt;%
  split_rows_by("AVISIT") %&gt;%
  summarize_lsmeans(
    .stats = c("n", "adj_mean_se", "adj_mean_ci", "diff_mean_se", "diff_mean_ci"),
    .labels = c(adj_mean_se = "Adj. LS Mean (Std. Error)"),
    .formats = c(adj_mean_se = sprintf_format("%.1f (%.2f)"))
  ) %&gt;%
  build_table(
    df = broom::tidy(result),
    alt_counts_df = dat_adsl
  )

basic_table() %&gt;%
  split_rows_by("AVISIT") %&gt;%
  summarize_lsmeans(arms = FALSE) %&gt;%
  build_table(
    df = broom::tidy(result_no_arm),
    alt_counts_df = dat_adsl
  )
</code></pre>

<hr>
<h2 id='tabulate_mmrm_subgroups'>Tabulation of MMRM Subgroups Results</h2><span id='topic+tabulate_mmrm_subgroups'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>
<p>This function tabulates the results from <code><a href="#topic+extract_mmrm_subgroups">extract_mmrm_subgroups()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tabulate_mmrm_subgroups(
  lyt,
  df,
  vars = c("n_tot", "n", "lsmean", "diff", "ci"),
  .formats = list(n = "xx", n_tot = "xx", lsmean = "xx.x", diff = "xx.x", ci =
    "(xx.x, xx.x)", pval = "x.xxxx | (&lt;0.0001)"),
  .labels = list(n = "n", n_tot = "Total n", lsmean = "Mean", diff = "Mean Difference",
    ci = paste0(round(100 * df$contrasts$conf_level[1]), "% CI"), pval = "p-value")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tabulate_mmrm_subgroups_+3A_lyt">lyt</code></td>
<td>
<p>(<code>layout</code>)<br /> input layout where analyses will be added to.</p>
</td></tr>
<tr><td><code id="tabulate_mmrm_subgroups_+3A_df">df</code></td>
<td>
<p>(<code>list</code>)<br /> of data frames containing all analysis variables, is the
result from <code><a href="#topic+extract_mmrm_subgroups">extract_mmrm_subgroups()</a></code>.</p>
</td></tr>
<tr><td><code id="tabulate_mmrm_subgroups_+3A_vars">vars</code></td>
<td>
<p>(<code>character</code>)<br /> the name of statistics to be reported among
<code>n_tot</code> (total number of patients per group),
<code>n</code> (number of patients per treatment arm and group),
<code>lsmean</code> (least square mean point estimate),
<code>diff</code> (difference of least square mean estimates between treatment and reference arm),
<code>ci</code> (confidence interval of difference) and
<code>pval</code> (p value of the <code>diff</code>, not adjusted for multiple comparisons).
Note, the statistics <code>n_tot</code>, <code>diff</code> and <code>ci</code> are required.</p>
</td></tr>
<tr><td><code id="tabulate_mmrm_subgroups_+3A_.formats">.formats</code></td>
<td>
<p>(named <code>list</code>)<br /> containing the formats for the statistics.</p>
</td></tr>
<tr><td><code id="tabulate_mmrm_subgroups_+3A_.labels">.labels</code></td>
<td>
<p>(named <code>list</code>)<br /> containing the labels for the statistics.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The <code>rtables</code> object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>mmrm_results &lt;- fit_mmrm(
  vars = list(
    response = "FEV1",
    covariates = "RACE",
    id = "USUBJID",
    arm = "ARMCD",
    visit = "AVISIT"
  ),
  data = mmrm_test_data,
  cor_struct = "compound symmetry",
  weights_emmeans = "equal",
  averages_emmeans = list(
    "VIS1+2" = c("VIS1", "VIS2")
  )
)

df &lt;- extract_mmrm_subgroups(
  fit = mmrm_results,
  visit = "VIS3",
  subgroups = c("RACE", "SEX")
)

## Table with default columns.
basic_table() %&gt;%
  tabulate_mmrm_subgroups(df)

## Table with selected columns.
tab &lt;- basic_table() %&gt;%
  tabulate_mmrm_subgroups(
    df = df,
    vars = c("n_tot", "diff", "ci", "pval")
  )
tab

## Forest plot can be produced based on this very easily.
g_forest(tab, logx = FALSE, xlim = c(-10, 10), x_at = c(-10, -5, 0, 5, 10), vline = 0)
</code></pre>

<hr>
<h2 id='tern.mmrm-package'><code>tern.mmrm</code> Package</h2><span id='topic+tern.mmrm'></span><span id='topic+tern.mmrm-package'></span>

<h3>Description</h3>

<p><code>tern.mmrm</code> is an analysis package to create tables, listings and graphs to analyze clinical trials data.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Daniel Sabanés Bové <a href="mailto:daniel.sabanes_bove@roche.com">daniel.sabanes_bove@roche.com</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> Godwin Yung <a href="mailto:yungg@gene.com">yungg@gene.com</a>
</p>
</li>
<li><p> Francois Collin
</p>
</li>
<li><p> Julia Dedic <a href="mailto:julia.dedic@roche.com">julia.dedic@roche.com</a>
</p>
</li>
<li><p> Jana Stoilova <a href="mailto:jana.stoilova@roche.com">jana.stoilova@roche.com</a>
</p>
</li>
<li><p> Joe Zhu <a href="mailto:joe.zhu@roche.com">joe.zhu@roche.com</a>
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> F. Hoffmann-La Roche AG [copyright holder, funder]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/insightsengineering/tern.mmrm">https://github.com/insightsengineering/tern.mmrm</a>
</p>
</li>
<li> <p><a href="https://insightsengineering.github.io/tern.mmrm/">https://insightsengineering.github.io/tern.mmrm/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/insightsengineering/tern.mmrm/issues">https://github.com/insightsengineering/tern.mmrm/issues</a>
</p>
</li></ul>


</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
