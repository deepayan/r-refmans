<!DOCTYPE html><html><head><title>Help for package relsurv</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {relsurv}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#cmp.rel'><p>Compute crude probability of death</p></a></li>
<li><a href='#colrec'><p>Relative Survival Data</p></a></li>
<li><a href='#epa'><p>Excess hazard function smoothing</p></a></li>
<li><a href='#expprep2'><p>expprep2 function</p></a></li>
<li><a href='#invtime'><p>Inverse transforming of time in Relative Survival</p></a></li>
<li><a href='#joinrate'><p>Join ratetables</p></a></li>
<li><a href='#nessie'><p>Net Expected Sample Size Is Estimated</p></a></li>
<li><a href='#plot_f'><p>Plot the absolute risk (observed and population curve)</p></a></li>
<li><a href='#plot_years'><p>Plot the years measure</p></a></li>
<li><a href='#plot.cmp.rel'><p>Plot the crude probability of death</p></a></li>
<li><a href='#plot.rs.zph'><p>Graphical Inspection of Proportional Hazards Assumption in Relative Survival</p>
Models</a></li>
<li><a href='#rdata'><p>Survival Data</p></a></li>
<li><a href='#residuals.rsadd'><p>Calculate Residuals for a &quot;rsadd&quot; Fit</p></a></li>
<li><a href='#rs.br'><p>Test the Proportional Hazards Assumption for Relative Survival Regression</p>
Models</a></li>
<li><a href='#rs.diff'><p>Test Net Survival Curve Differences</p></a></li>
<li><a href='#rs.surv'><p>Compute a Relative Survival Curve</p></a></li>
<li><a href='#rs.surv.rsadd'><p>Compute a Relative Survival Curve from an additive relative survival model</p></a></li>
<li><a href='#rs.zph'><p>Behaviour of Covariates in Time for Relative Survival Regression Models</p></a></li>
<li><a href='#rsadd'><p>Fit an Additive model for Relative Survival</p></a></li>
<li><a href='#rsmul'><p>Fit Andersen et al Multiplicative Regression Model for Relative Survival</p></a></li>
<li><a href='#rstrans'><p>Fit Cox Proportional Hazards Model in Transformed Time</p></a></li>
<li><a href='#slopop'><p>Census Data Set for the Slovene Population</p></a></li>
<li><a href='#summary.cmp.rel'><p>Summary of the crude probability of death</p></a></li>
<li><a href='#survfit.rsadd'><p>Compute a Predicited Survival Curve</p></a></li>
<li><a href='#survsplit'><p>Split a Survival Data Set at Specified Times</p></a></li>
<li><a href='#transrate'><p>Reorganize Data into a Ratetable Object</p></a></li>
<li><a href='#transrate.hld'><p>Reorganize Data obtained from Human Life-Table Database into a Ratetable</p>
Object</a></li>
<li><a href='#transrate.hmd'><p>Reorganize Data obtained from Human Mortality Database into a Ratetable</p>
Object</a></li>
<li><a href='#years'><p>Compute one of the life years measures</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Relative Survival</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-12-21</td>
</tr>
<tr>
<td>Version:</td>
<td>2.2-9</td>
</tr>
<tr>
<td>Author:</td>
<td>Maja Pohar Perme [aut],
  Damjan Manevski [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Damjan Manevski &lt;damjan.manevski@mf.uni-lj.si&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Contains functions for analysing relative survival data, including nonparametric estimators of net (marginal relative) survival, relative survival ratio, crude mortality, methods for fitting  and checking additive and multiplicative regression models, transformation approach, methods for dealing with population mortality tables. Work has been described in Pohar Perme, Pavlic (2018) &lt;<a href="https://doi.org/10.18637%2Fjss.v087.i08">doi:10.18637/jss.v087.i08</a>&gt;.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0), survival (&ge; 2.42), date</td>
</tr>
<tr>
<td>Imports:</td>
<td>splines, ggplot2, pammtools, scales</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL]</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-12-22 13:09:50 UTC; dmanevski</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-12-22 13:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='cmp.rel'>Compute crude probability of death</h2><span id='topic+cmp.rel'></span><span id='topic+print.cmp.rel'></span>

<h3>Description</h3>

<p>Estimates the crude probability of death due to disease and due to
population reasons
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cmp.rel(
  formula = formula(data),
  data = parent.frame(),
  ratetable = relsurv::slopop,
  na.action,
  tau,
  conf.int = 0.95,
  precision = 1,
  add.times,
  rmap
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cmp.rel_+3A_formula">formula</code></td>
<td>
<p>a formula object, with the response as a <code>Surv</code> object
on the left of a <code>~</code> operator, and, if desired, terms separated by the
<code>+</code> operator on the right. If no strata are used, <code>~1</code> should be
specified.
</p>
<p>NOTE: The follow-up time must be in days.</p>
</td></tr>
<tr><td><code id="cmp.rel_+3A_data">data</code></td>
<td>
<p>a data.frame in which to interpret the variables named in the
<code>formula</code>.</p>
</td></tr>
<tr><td><code id="cmp.rel_+3A_ratetable">ratetable</code></td>
<td>
<p>a table of event rates, organized as a <code>ratetable</code>
object, such as <code>slopop</code>.</p>
</td></tr>
<tr><td><code id="cmp.rel_+3A_na.action">na.action</code></td>
<td>
<p>a missing-data filter function, applied to the model.frame,
after any subset argument has been used.  Default is
<code>options()$na.action</code>.</p>
</td></tr>
<tr><td><code id="cmp.rel_+3A_tau">tau</code></td>
<td>
<p>the maximum follow-up time of interest, all times larger than
<code>tau</code> shall be censored. Equals maximum observed time by default</p>
</td></tr>
<tr><td><code id="cmp.rel_+3A_conf.int">conf.int</code></td>
<td>
<p>the level for a two-sided confidence interval on the
survival curve(s). Default is 0.95.</p>
</td></tr>
<tr><td><code id="cmp.rel_+3A_precision">precision</code></td>
<td>
<p>the level of precision used in the numerical integration of
variance. Default is 1, which means that daily intervals are taken, the
value may be decreased to get a higher precision or increased to achieve a
faster calculation. The calculation intervals always include at least all
times of event and censoring as border points.</p>
</td></tr>
<tr><td><code id="cmp.rel_+3A_add.times">add.times</code></td>
<td>
<p>specific times at which the value of estimator and its
variance should be evaluated. Default is all the event and censoring times.</p>
</td></tr>
<tr><td><code id="cmp.rel_+3A_rmap">rmap</code></td>
<td>
<p>an optional list to be used if the variables are not organized
and named in the same way as in the <code>ratetable</code> object. See details
below.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>NOTE: The follow-up time must be specified in days. The <code>ratetable</code>
being used may have different variable names and formats than the user's
data set, this is dealt with by the <code>rmap</code> argument. For example, if
age is in years in the data set but in days in the <code>ratetable</code> object,
age=age*365.241 should be used. The calendar year can be in any date format
(date, Date and POSIXt are allowed), the date formats in the
<code>ratetable</code> and in the data may differ.
</p>
<p>Note that numerical integration is required to calculate the variance
estimator. The integration precision is set with argument <code>precision</code>,
which defaults to daily intervals, a default that should give enough
precision for any practical purpose.
</p>
<p>The area under the curve is calculated on the interval [0,<code>tau</code>].
</p>
<p>Function <code>summary</code> may be used to get the output at specific points in
time.
</p>


<h3>Value</h3>

<p>An object of class <code>cmp.rel</code>. Objects of this class have
methods for the functions <code>print</code> and <code>plot</code>. The <code>summary</code>
function can be used for printing output at required time points. An object
of class <code>cmp.rel</code> is composed of several lists, each pertaining the
cumulative hazard function for one risk and one strata. Each of the lists
contains the following objects: </p>
<table>
<tr><td><code>time</code></td>
<td>
<p>the time-points at which the
curves are estimated</p>
</td></tr> <tr><td><code>est</code></td>
<td>
<p>the estimate</p>
</td></tr> <tr><td><code>var</code></td>
<td>
<p>the variance of
the estimate</p>
</td></tr> <tr><td><code>lower</code></td>
<td>
<p>the lower limit of the confidence interval</p>
</td></tr>
<tr><td><code>upper</code></td>
<td>
<p>the upper limit of the confidence interval</p>
</td></tr> <tr><td><code>area</code></td>
<td>
<p>the
area under the curve calculated on the interval [0,<code>tau</code>]</p>
</td></tr>
<tr><td><code>index</code></td>
<td>
<p>indicator of event and censoring times among all the times in
the output. The times added via paramater <code>add.times</code> are also
included</p>
</td></tr> <tr><td><code>add.times</code></td>
<td>
<p>the times added via parameter <code>add.times</code></p>
</td></tr>
</table>


<h3>References</h3>

<p>Package: Pohar Perme, M., Pavlic, K. (2018) &quot;Nonparametric
Relative Survival Analysis with the R Package relsurv&quot;. Journal of
Statistical Software. 87(8), 1-27, doi: &quot;10.18637/jss.v087.i08&quot;
</p>


<h3>See Also</h3>

<p><code>rs.surv</code>, <code>summary.cmp.rel</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

data(slopop)
data(rdata)
#calculate the crude probability of death
#note that the variable year must be given in a date format and that 
#age must be multiplied by 365.241 in order to be expressed in days.
fit &lt;- cmp.rel(Surv(time,cens)~sex,rmap=list(age=age*365.241),
		ratetable=slopop,data=rdata,tau=3652.41)
fit
plot(fit,col=c(1,1,2,2),xscale=365.241,xlab="Time (years)")
#if no strata are desired:
fit &lt;- cmp.rel(Surv(time,cens)~1,rmap=list(age=age*365.241),
		ratetable=slopop,data=rdata,tau=3652.41)



</code></pre>

<hr>
<h2 id='colrec'>Relative Survival Data</h2><span id='topic+colrec'></span>

<h3>Description</h3>

<p>Survival of patients with colon and rectal cancer diagnosed in 1994-2000. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(colrec)</code></pre>


<h3>Format</h3>

<p>A data frame with 5971 observations on the following 7 variables:
</p>

<dl>
<dt>sex</dt><dd><p>sex (1=male, 2=female).</p>
</dd>    
<dt>age</dt><dd><p>age (in days).</p>
</dd>
<dt>diag</dt><dd><p>date of diagnosis (in date format).</p>
</dd>
<dt>time</dt><dd><p>survival time (in days).</p>
</dd>
<dt>stat</dt><dd><p>censoring indicator (0=censoring, 1=death).</p>
</dd>
<dt>stage</dt><dd><p>cancer stage. Values 1-3, code <code>99</code> stands for unknown.</p>
</dd>
<dt>site</dt><dd><p>cancer site. </p>
</dd>
</dl>



<h3>References</h3>

<p>Provided by Slovene Cancer Registry. The <code>age</code>, <code>time</code> and <code>diag</code> variables are randomly perturbed to make the identification of patients impossible.
</p>

<hr>
<h2 id='epa'>Excess hazard function smoothing</h2><span id='topic+epa'></span>

<h3>Description</h3>

<p>An Epanechnikov kernel function based smoother for smoothing the baseline excess hazard calculated by the <code>rsadd</code> function with the <code>EM</code> method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>epa(fit,bwin,times,n.bwin=16,left=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="epa_+3A_fit">fit</code></td>
<td>

<p>Fit from the additive relative survival model using the <code>EM</code> method.</p>
</td></tr>
<tr><td><code id="epa_+3A_bwin">bwin</code></td>
<td>

<p>The relative width of the smoothing window (default is 1).
</p>
</td></tr>
<tr><td><code id="epa_+3A_times">times</code></td>
<td>

<p>The times at which the smoother is to be evaluated. If missing, it is evaluated at all event times.
</p>
</td></tr>
<tr><td><code id="epa_+3A_n.bwin">n.bwin</code></td>
<td>

<p>Number of times that the window width may change.
</p>
</td></tr>
<tr><td><code id="epa_+3A_left">left</code></td>
<td>
<p>If <code>FALSE</code> (default) smoothing is performed symmetrically, if <code>TRUE</code> only leftside neighbours are considered. </p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function performs Epanechnikov kernel smoothing. The follow up time is divided (according to percentiles of event times) into several intervals (number of intervals defined by <code>n.bwin</code>) in which the width is calculated as a factor of the maximum span between event times. 
Boundary effects are also taken into account on both sides.
</p>


<h3>Value</h3>

<p>A list with two components:
</p>
<table>
<tr><td><code>lambda</code></td>
<td>
<p>the smoothed excess baseline hazard function</p>
</td></tr>
<tr><td><code>times</code></td>
<td>
<p>the times at which the smoothed excess baseline hazard is evaluated.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Package. Pohar M., Stare J. (2006) &quot;Relative survival analysis in R.&quot; Computer Methods and Programs in Biomedicine, <b>81</b>: 272&ndash;278
</p>
<p>Relative survival: Pohar, M., Stare, J. (2007) &quot;Making relative survival analysis relatively easy.&quot;
Computers in biology and medicine, <b>37</b>: 1741&ndash;1749.
</p>
<p>EM algorithm: Pohar Perme M., Henderson R., Stare, J. (2009) &quot;An approach to estimation in relative survival regression.&quot; Biostatistics, <b>10</b>: 136&ndash;146.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rsadd">rsadd</a></code>,
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(slopop)
data(rdata)
#fit an additive model with the EM method
fit &lt;- rsadd(Surv(time,cens)~sex+age,rmap=list(age=age*365.241),
		ratetable=slopop,data=rdata,int=5,method="EM")
sm &lt;- epa(fit)
plot(sm$times,sm$lambda)
</code></pre>

<hr>
<h2 id='expprep2'>expprep2 function</h2><span id='topic+expprep2'></span>

<h3>Description</h3>

<p>Helper calculation function using C code. Saved also as exp.prep (unexported function).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>     expprep2(x, y,ratetable,status,times,fast=FALSE,ys,prec,cmp=F,netweiDM=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="expprep2_+3A_x">x</code></td>
<td>
<p> matrix of demographic covariates - each individual has one line</p>
</td></tr>
<tr><td><code id="expprep2_+3A_y">y</code></td>
<td>
<p> follow-up time for each individual (same length as nrow(x))</p>
</td></tr>
<tr><td><code id="expprep2_+3A_ratetable">ratetable</code></td>
<td>
<p> rate table used for calculation</p>
</td></tr>
<tr><td><code id="expprep2_+3A_status">status</code></td>
<td>
<p> status for each individual (same length as nrow(x)!), not needed if we only need Spi, status needed for rs.surv</p>
</td></tr>
<tr><td><code id="expprep2_+3A_times">times</code></td>
<td>
<p> times at which we wish to evaluate the quantities, not needed if we only need Spi, times needed for rs.surv</p>
</td></tr>
<tr><td><code id="expprep2_+3A_fast">fast</code></td>
<td>
<p> for mpp method only</p>
</td></tr>
<tr><td><code id="expprep2_+3A_ys">ys</code></td>
<td>
<p> entry times (if empty, individuals are followed from time 0)</p>
</td></tr>
<tr><td><code id="expprep2_+3A_prec">prec</code></td>
<td>
<p> deprecated</p>
</td></tr>
<tr><td><code id="expprep2_+3A_cmp">cmp</code></td>
<td>
<p> should cmpfast.C be used</p>
</td></tr>
<tr><td><code id="expprep2_+3A_netweidm">netweiDM</code></td>
<td>
<p> should new netwei script be used</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Helper function used in rs.surv and other relsurv functions.
</p>


<h3>Value</h3>

<p>List containing the calculated hazards and probabilities using the population mortality tables.
</p>


<h3>See Also</h3>

<p>rs.surv</p>

<hr>
<h2 id='invtime'>Inverse transforming of time in Relative Survival </h2><span id='topic+invtime'></span>

<h3>Description</h3>

<p>This function can be used when predicting in Relative Survival using the transformed time regression
model (using <code>rstrans</code> function). It inverses the time from Y to T in relative survival using the
given ratetable. The times Y can be produced with the <code>rstrans</code> function, in which case, this is the reverse
function. This function does the transformation for one person at a time. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>invtime(y, age, sex, year, scale, ratetable, lower, upper)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="invtime_+3A_y">y</code></td>
<td>
<p>time in Y.</p>
</td></tr>
<tr><td><code id="invtime_+3A_age">age</code></td>
<td>
<p>age of the individual.  Must be in days.</p>
</td></tr>
<tr><td><code id="invtime_+3A_sex">sex</code></td>
<td>
<p>sex of the individual. Must be coded in the same way as in the <code>ratetable</code>.</p>
</td></tr>
<tr><td><code id="invtime_+3A_year">year</code></td>
<td>
<p>date of diagnosis. Must be in a date format</p>
</td></tr>
<tr><td><code id="invtime_+3A_scale">scale</code></td>
<td>

<p>numeric value to scale the results. If <code>ratetable</code> is in units/day, <code>scale = 365.241</code> causes the output
to be reported in years.
</p>
</td></tr>
<tr><td><code id="invtime_+3A_ratetable">ratetable</code></td>
<td>
<p>a table of event rates, such as <code>survexp.us</code>. </p>
</td></tr>
<tr><td><code id="invtime_+3A_lower">lower</code></td>
<td>
<p>the lower bound of interval where the result is expected. This argument is optional,
but, if given, can shorten the time the function needs to calculate the result. </p>
</td></tr>
<tr><td><code id="invtime_+3A_upper">upper</code></td>
<td>

<p>the upper bound of interval where the result is expected. See <code>lower</code> 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Works only with ratetables that are split by age, sex and year.
Transforming can be computationally intensive, use lower and/or upper to guess the interval of the result
and thus speed up the function.
</p>


<h3>Value</h3>

<p>A list of values
</p>
<table>
<tr><td><code>T</code></td>
<td>
<p>the original time</p>
</td></tr>
<tr><td><code>Y</code></td>
<td>
<p>the transformed time</p>
</td></tr>  
</table>


<h3>References</h3>

<p>Package: Pohar M., Stare J. (2006) &quot;Relative survival analysis in R.&quot;  Computer Methods and Programs in Biomedicine, <b>81</b>: 272-278.  
</p>
<p>Relative survival: Pohar, M., Stare, J. (2007) &quot;Making relative survival analysis relatively easy.&quot;
Computers in biology and medicine, <b>37</b>: 1741-1749.  
</p>


<h3>See Also</h3>

 <p><code><a href="#topic+rstrans">rstrans</a></code>  </p>


<h3>Examples</h3>

<pre><code class='language-R'>data(slopop)
invtime(y = 0.1, age = 23011, sex = 1, year = 9497, ratetable = slopop)
</code></pre>

<hr>
<h2 id='joinrate'>Join ratetables</h2><span id='topic+joinrate'></span>

<h3>Description</h3>

<p>The function joins two or more objects organized as <code>ratetable</code> by adding a new dimension. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>joinrate(tables,dim.name="country")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="joinrate_+3A_tables">tables</code></td>
<td>

<p>a list of ratetables. If names are given, they are included as <code>dimnames</code>. 
</p>
</td></tr>
<tr><td><code id="joinrate_+3A_dim.name">dim.name</code></td>
<td>

<p>the name of the added dimension.   </p>
</td></tr>
</table>


<h3>Details</h3>

 
<p>This function joins two or more <code>ratetable</code> objects by adding a new dimension. The cutpoints of all the
rate tables are compared and only the common intervals kept. If the intervals defined by the cutpoints are not of
the same length, a warning message is displayed.  Each rate table must have 3 dimensions, i.e. age, sex and year 
(the order is not important).
</p>


<h3>Value</h3>

<p>An object of class <code>ratetable</code>.</p>


<h3>References</h3>

<p>Package: Pohar M., Stare J. (2006) &quot;Relative survival analysis in R.&quot; Computer Methods and Programs in Biomedicine, <b>81</b>: 272-278.
</p>
<p>Relative survival: Pohar, M., Stare, J. (2007) &quot;Making relative survival analysis relatively easy.&quot; Computers in biology and medicine, <b>37</b>: 1741-1749.  
</p>


<h3>See Also</h3>

<p><code><a href="survival.html#topic+ratetable">ratetable</a></code>, <code><a href="#topic+transrate.hld">transrate.hld</a></code>, <code><a href="#topic+transrate.hmd">transrate.hmd</a></code>, <code><a href="#topic+transrate">transrate</a></code>.</p>


<h3>Examples</h3>

<pre><code class='language-R'>#newpop &lt;- joinrate(list(Arizona=survexp.az,Florida=survexp.fl,
#                   Minnesota=survexp.mn),dim.name="state")
</code></pre>

<hr>
<h2 id='nessie'>Net Expected Sample Size Is Estimated</h2><span id='topic+nessie'></span>

<h3>Description</h3>

<p>Calculates how the sample size decreases in time due to population mortality
</p>


<h3>Usage</h3>

<pre><code class='language-R'>     nessie(formula, data, ratetable = relsurv::slopop,times,rmap)  
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nessie_+3A_formula">formula</code></td>
<td>

<p>a formula object, same as in <code>rs.surv</code>. The right-hand side of the formula object includes the variable that defines the subgroups (a variable of type <code>factor</code>) by which the expected sample size is to be calculated.
</p>
</td></tr>
<tr><td><code id="nessie_+3A_data">data</code></td>
<td>

<p>a data.frame in which to interpret the variables named in the
<code>formula</code>. 
</p>
</td></tr>
<tr><td><code id="nessie_+3A_ratetable">ratetable</code></td>
<td>

<p>a table of event rates, organized as a <code>ratetable</code> object,
such as <code>slopop</code>.  
</p>
</td></tr>
<tr><td><code id="nessie_+3A_times">times</code></td>
<td>
<p>Times at which the calculation should be evaluated - in years!</p>
</td></tr> 
<tr><td><code id="nessie_+3A_rmap">rmap</code></td>
<td>
<p>an optional list to be used if the variables are not
organized and named in the same way as in the <code>ratetable</code> object. See details of the <code>rs.surv</code> function.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function calculates the sample size we can expect at a certain time point if the patients die only due to population causes (population survival * initial sample size in a certain category), i.e. the number of individuals that remains at risk at given timepoints after the individuals who die due to population causes are removed.
The result should be used as a guideline for the sensible length of follow-up interval when calculating the net survival.
</p>
<p>The first column of the output reports the number of individuals at time 0.
The last column of the output reports the conditional expected (population) survival time for each subgroup.
</p>


<h3>Value</h3>

<p>A list of values.
</p>


<h3>References</h3>

<p>Pohar Perme, M., Pavlic, K. (2018) &quot;Nonparametric Relative Survival Analysis with the R Package relsurv&quot;. Journal of Statistical Software. 87(8), 1-27,  doi: &quot;10.18637/jss.v087.i08&quot; 
</p>


<h3>See Also</h3>

<p><code>rs.surv</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(slopop)
data(rdata)
rdata$agegr &lt;-cut(rdata$age,seq(40,95,by=5))
nessie(Surv(time,cens)~agegr,rmap=list(age=age*365.241),
	ratetable=slopop,data=rdata,times=c(1,3,5,10,15))
</code></pre>

<hr>
<h2 id='plot_f'>Plot the absolute risk (observed and population curve)</h2><span id='topic+plot_f'></span>

<h3>Description</h3>

<p>Plots the estimated observed and population curve for the
life years difference (Manevski, Ruzic Gorenjec, Andersen, Pohar Perme, 2022).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_f(
  years,
  xlab = "Time interval",
  ylab = "Absolute risk",
  xbreak,
  ybreak,
  xlimits,
  ylimits,
  show.legend = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_f_+3A_years">years</code></td>
<td>
<p>the object obtained using function <code>years</code>.</p>
</td></tr>
<tr><td><code id="plot_f_+3A_xlab">xlab</code></td>
<td>
<p>a title for the x axis.</p>
</td></tr>
<tr><td><code id="plot_f_+3A_ylab">ylab</code></td>
<td>
<p>a title for the y axis.</p>
</td></tr>
<tr><td><code id="plot_f_+3A_xbreak">xbreak</code></td>
<td>
<p>the breaks on the x axis (this is supplied to <code>scale_x_continuous</code>).</p>
</td></tr>
<tr><td><code id="plot_f_+3A_ybreak">ybreak</code></td>
<td>
<p>the breaks on the y axis (this is supplied to <code>scale_y_continuous</code>).</p>
</td></tr>
<tr><td><code id="plot_f_+3A_xlimits">xlimits</code></td>
<td>
<p>define the limits on the x axis (this is supplied to <code>scale_x_continuous</code>).</p>
</td></tr>
<tr><td><code id="plot_f_+3A_ylimits">ylimits</code></td>
<td>
<p>define the limits on the y axis (this is supplied to <code>scale_y_continuous</code>).</p>
</td></tr>
<tr><td><code id="plot_f_+3A_show.legend">show.legend</code></td>
<td>
<p>if TRUE, the legend is shown on the graph.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A ggplot2 implementation for plotting the observed and population curves. The type of curves is
dependent upon the measure calculated using <code>years</code> function (argument <code>measure</code>).
</p>


<h3>Value</h3>

<p>A ggplot object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+years">years</a></code>, <code><a href="#topic+plot_years">plot_years</a></code>
</p>

<hr>
<h2 id='plot_years'>Plot the years measure</h2><span id='topic+plot_years'></span>

<h3>Description</h3>

<p>Plot the years measure obtained from the <code>years</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_years(
  years,
  xlab = "Time interval",
  ylab = "Years",
  xbreak,
  ybreak,
  xlimits,
  ylimits,
  conf.int = FALSE,
  ymirror = FALSE,
  yminus = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_years_+3A_years">years</code></td>
<td>
<p>the object obtained using function <code>years</code>.</p>
</td></tr>
<tr><td><code id="plot_years_+3A_xlab">xlab</code></td>
<td>
<p>a title for the x axis.</p>
</td></tr>
<tr><td><code id="plot_years_+3A_ylab">ylab</code></td>
<td>
<p>a title for the y axis.</p>
</td></tr>
<tr><td><code id="plot_years_+3A_xbreak">xbreak</code></td>
<td>
<p>the breaks on the x axis (this is supplied to <code>scale_x_continuous</code>).</p>
</td></tr>
<tr><td><code id="plot_years_+3A_ybreak">ybreak</code></td>
<td>
<p>the breaks on the y axis (this is supplied to <code>scale_y_continuous</code>).</p>
</td></tr>
<tr><td><code id="plot_years_+3A_xlimits">xlimits</code></td>
<td>
<p>define the limits on the x axis (this is supplied to <code>scale_x_continuous</code>).</p>
</td></tr>
<tr><td><code id="plot_years_+3A_ylimits">ylimits</code></td>
<td>
<p>define the limits on the y axis (this is supplied to <code>scale_y_continuous</code>).</p>
</td></tr>
<tr><td><code id="plot_years_+3A_conf.int">conf.int</code></td>
<td>
<p>if TRUE, the confidence interval is plotted.</p>
</td></tr>
<tr><td><code id="plot_years_+3A_ymirror">ymirror</code></td>
<td>
<p>mirror the y values (w.r.t. the x axis).</p>
</td></tr>
<tr><td><code id="plot_years_+3A_yminus">yminus</code></td>
<td>
<p>use function y -&gt; -y when plotting.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A ggplot2 implementation for plotting the years measure. The type of curve is
dependent upon the measure calculated using the <code>years</code> function (argument <code>measure</code>).
</p>


<h3>Value</h3>

<p>A ggplot object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+years">years</a></code>, <code><a href="#topic+plot_f">plot_f</a></code>
</p>

<hr>
<h2 id='plot.cmp.rel'>Plot the crude probability of death</h2><span id='topic+plot.cmp.rel'></span>

<h3>Description</h3>

<p>Plot method for cmp.rel. Plots the cumulative probability of death due to
disease and due to population reasons
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'cmp.rel'
plot(
  x,
  main = " ",
  curvlab,
  ylim = c(0, 1),
  xlim,
  wh = 2,
  xlab = "Time (days)",
  ylab = "Probability",
  lty = 1:length(x),
  xscale = 1,
  col = 1,
  lwd = par("lwd"),
  curves,
  conf.int,
  all.times = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.cmp.rel_+3A_x">x</code></td>
<td>
<p>a list, with each component representing one curve in the plot,
output of the function <code>cmp.rel</code>.</p>
</td></tr>
<tr><td><code id="plot.cmp.rel_+3A_main">main</code></td>
<td>
<p>the main title for the plot.</p>
</td></tr>
<tr><td><code id="plot.cmp.rel_+3A_curvlab">curvlab</code></td>
<td>
<p>Curve labels for the plot. Default is <code>names(x)</code>, or if
that is missing, <code>1:nc</code>, where <code>nc</code> is the number of curves in
<code>x</code>.</p>
</td></tr>
<tr><td><code id="plot.cmp.rel_+3A_ylim">ylim</code></td>
<td>
<p>yaxis limits for plot.</p>
</td></tr>
<tr><td><code id="plot.cmp.rel_+3A_xlim">xlim</code></td>
<td>
<p>xaxis limits for plot (default is 0 to the largest time in any
of the curves).</p>
</td></tr>
<tr><td><code id="plot.cmp.rel_+3A_wh">wh</code></td>
<td>
<p>if a vector of length 2, then the upper right coordinates of the
legend; otherwise the legend is placed in the upper right corner of the
plot.</p>
</td></tr>
<tr><td><code id="plot.cmp.rel_+3A_xlab">xlab</code></td>
<td>
<p>X axis label.</p>
</td></tr>
<tr><td><code id="plot.cmp.rel_+3A_ylab">ylab</code></td>
<td>
<p>y axis label.</p>
</td></tr>
<tr><td><code id="plot.cmp.rel_+3A_lty">lty</code></td>
<td>
<p>vector of line types. Default <code>1:nc</code> (<code>nc</code> is the
number of curves in <code>x</code>). For color displays, <code>lty=1</code>,
<code>color=1:nc</code>, might be more appropriate. If <code>length(lty)&lt;nc</code>, then
<code>lty[1]</code> is used for all.</p>
</td></tr>
<tr><td><code id="plot.cmp.rel_+3A_xscale">xscale</code></td>
<td>
<p>Scale of the X axis. Default is in days (1).</p>
</td></tr>
<tr><td><code id="plot.cmp.rel_+3A_col">col</code></td>
<td>
<p>vector of colors. If <code>length(col)&lt;nc</code>, then the
<code>col[1]</code> is used for all.</p>
</td></tr>
<tr><td><code id="plot.cmp.rel_+3A_lwd">lwd</code></td>
<td>
<p>vector of line widths. If <code>length(lwd)&lt;nc</code>, then
<code>lwd[1]</code> is used for all.</p>
</td></tr>
<tr><td><code id="plot.cmp.rel_+3A_curves">curves</code></td>
<td>
<p>Vector if integers, specifies which curves should be plotted.
May take values <code>1:nc</code>, where <code>nc</code> is the number of curves in
<code>x</code>. By default, all of the curves are plotted.</p>
</td></tr>
<tr><td><code id="plot.cmp.rel_+3A_conf.int">conf.int</code></td>
<td>
<p>Vector if integers, specifies which confidence intervals
should be plotted. May take values <code>1:nc</code>, where <code>nc</code> is the
number of curves in <code>x</code>. By default, no confidence intervals are
plotted.</p>
</td></tr>
<tr><td><code id="plot.cmp.rel_+3A_all.times">all.times</code></td>
<td>
<p>By default, the disease specific mortality estimate is
plotted as a step function between event or censoring times. If set to
<code>TRUE</code>, the graph is evaluated at all estimated times.</p>
</td></tr>
<tr><td><code id="plot.cmp.rel_+3A_...">...</code></td>
<td>
<p>additional arguments passed to the initial call of the plot
function.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>By default, the graph is plotted as a step function for the cause specific
mortality and as a piecewise linear function for the population mortality.
It is evaluated at all event and censoring times even though it constantly
changes also between these time points.
</p>
<p>If the argument <code>all.times</code> is set to <code>TRUE</code>, the plot is
evaluated at all times that were used for numerical integration in the
<code>cmp.rel</code> function (there, the default is set to daily intervals). If
only specific time points are to be added, this should be done via argument
<code>add.times</code> in <code>cmp.rel</code>.
</p>


<h3>Value</h3>

<p>No value is returned.
</p>


<h3>See Also</h3>

<p><code>rs.surv</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(slopop)
data(rdata)
fit &lt;- cmp.rel(Surv(time,cens)~sex,rmap=list(age=age*365.241),
		ratetable=slopop,data=rdata,tau=3652.41)
plot(fit,col=c(1,1,2,2),xscale=365.241,conf.int=c(1,3))

</code></pre>

<hr>
<h2 id='plot.rs.zph'>Graphical Inspection of Proportional Hazards Assumption in Relative Survival
Models</h2><span id='topic+plot.rs.zph'></span>

<h3>Description</h3>

<p>Displays a graph of the scaled partial residuals, along with a smooth curve.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'rs.zph'
plot(
  x,
  resid = TRUE,
  df = 4,
  nsmo = 40,
  var,
  cex = 1,
  add = FALSE,
  col = 1,
  lty = 1,
  xlab,
  ylab,
  xscale = 1,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.rs.zph_+3A_x">x</code></td>
<td>
<p>result of the <code>rs.zph</code> function.</p>
</td></tr>
<tr><td><code id="plot.rs.zph_+3A_resid">resid</code></td>
<td>
<p>a logical value, if <code>TRUE</code> the residuals are included on
the plot, as well as the smooth fit.</p>
</td></tr>
<tr><td><code id="plot.rs.zph_+3A_df">df</code></td>
<td>
<p>the degrees of freedom for the fitted natural spline, <code>df=2</code>
leads to a linear fit.</p>
</td></tr>
<tr><td><code id="plot.rs.zph_+3A_nsmo">nsmo</code></td>
<td>
<p>number of points used to plot the fitted spline.</p>
</td></tr>
<tr><td><code id="plot.rs.zph_+3A_var">var</code></td>
<td>
<p>the set of variables for which plots are desired.  By default,
plots are produced in turn for each variable of a model.  Selection of a
single variable allows other features to be added to the plot, e.g., a
horizontal line at zero or a main title.</p>
</td></tr>
<tr><td><code id="plot.rs.zph_+3A_cex">cex</code></td>
<td>
<p>a numerical value giving the amount by which plotting text and
symbols should be scaled relative to the default.</p>
</td></tr>
<tr><td><code id="plot.rs.zph_+3A_add">add</code></td>
<td>
<p>logical, if <code>TRUE</code> the plot is added to an existing plot</p>
</td></tr>
<tr><td><code id="plot.rs.zph_+3A_col">col</code></td>
<td>
<p>a specification for the default plotting color.</p>
</td></tr>
<tr><td><code id="plot.rs.zph_+3A_lty">lty</code></td>
<td>
<p>the line type.</p>
</td></tr>
<tr><td><code id="plot.rs.zph_+3A_xlab">xlab</code></td>
<td>
<p>x axis label.</p>
</td></tr>
<tr><td><code id="plot.rs.zph_+3A_ylab">ylab</code></td>
<td>
<p>y axis label.</p>
</td></tr>
<tr><td><code id="plot.rs.zph_+3A_xscale">xscale</code></td>
<td>
<p>units for x axis, default is 1, i.e. days.</p>
</td></tr>
<tr><td><code id="plot.rs.zph_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to the <code>plot</code> function.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Goodness of fit: Stare J.,Pohar Perme M., Henderson R. (2005)
&quot;Goodness of fit of relative survival models.&quot; Statistics in Medicine,
<b>24</b>: 3911-3925.
</p>
<p>Package: Pohar M., Stare J. (2006) &quot;Relative survival analysis in R.&quot;
Computer Methods and Programs in Biomedicine, <b>81</b>: 272-278.
</p>
<p>Relative survival: Pohar, M., Stare, J. (2007) &quot;Making relative survival
analysis relatively easy.&quot; Computers in biology and medicine, <b>37</b>:
1741-1749, 2007.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rs.zph">rs.zph</a></code>, <code><a href="survival.html#topic+plot.cox.zph">plot.cox.zph</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(slopop)
data(rdata)
fit &lt;- rsadd(Surv(time,cens)~sex+as.factor(agegr),rmap=list(age=age*365.241),
             ratetable=slopop,data=rdata,int=5)
rszph &lt;- rs.zph(fit)
plot(rszph)

</code></pre>

<hr>
<h2 id='rdata'>Survival Data</h2><span id='topic+rdata'></span>

<h3>Description</h3>

<p>Survival data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(rdata)</code></pre>


<h3>Format</h3>

<p>A data frame with 1040 observations on the following 6 variables:
</p>

<dl>
<dt>time</dt><dd><p>survival time (in days).</p>
</dd>
<dt>cens</dt><dd><p>censoring indicator (0=censoring, 1=death).</p>
</dd>
<dt>age</dt><dd><p>age (in years).</p>
</dd>
<dt>sex</dt><dd><p>sex (1=male, 2=female).</p>
</dd>
<dt>year</dt><dd><p>date of diagnosis (in date format).</p>
</dd>
<dt>agegr</dt><dd><p>age group.</p>
</dd>
</dl>



<h3>References</h3>

<p>Pohar M., Stare J. (2006) &quot;Relative survival analysis in R.&quot; Computer Methods and Programs in Biomedicine, <b>81</b>: 272-278.
</p>

<hr>
<h2 id='residuals.rsadd'>Calculate Residuals for a &quot;rsadd&quot; Fit</h2><span id='topic+residuals.rsadd'></span>

<h3>Description</h3>

<p>Calculates partial residuals for an additive relative survival model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'rsadd'
residuals(object, type = "schoenfeld", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="residuals.rsadd_+3A_object">object</code></td>
<td>
<p>an object inheriting from class <code>rsadd</code>, representing a
fitted additive relative survival model. Typically this is the output from
the <code>rsadd</code> function.</p>
</td></tr>
<tr><td><code id="residuals.rsadd_+3A_type">type</code></td>
<td>
<p>character string indicating the type of residual desired.
Currently only Schoenfeld residuals are implemented.</p>
</td></tr>
<tr><td><code id="residuals.rsadd_+3A_...">...</code></td>
<td>
<p>other arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of the following values is returned: </p>
<table>
<tr><td><code>res</code></td>
<td>
<p>a matrix
containing the residuals for each variable.</p>
</td></tr> <tr><td><code>varr</code></td>
<td>
<p>the variance for
each residual</p>
</td></tr> <tr><td><code>varr1</code></td>
<td>
<p>the sum of <code>varr</code>.</p>
</td></tr> <tr><td><code>kvarr</code></td>
<td>
<p>the
derivative of each residual, to be used in <code>rs.zph</code> function.</p>
</td></tr>
<tr><td><code>kvarr1</code></td>
<td>
<p>the sum of <code>kvarr</code>.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Package. Pohar M., Stare J. (2006) &quot;Relative survival analysis
in R.&quot; Computer Methods and Programs in Biomedicine, <b>81</b>: 272&ndash;278
</p>
<p>Relative survival: Pohar, M., Stare, J. (2007) &quot;Making relative survival
analysis relatively easy.&quot; Computers in biology and medicine, <b>37</b>:
1741&ndash;1749.
</p>
<p>Goodness of fit: Stare J.,Pohar Perme M., Henderson R. (2005) &quot;Goodness of
fit of relative survival models.&quot; Statistics in Medicine, <b>24</b>:
3911&ndash;3925.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rsadd">rsadd</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(slopop)
data(rdata)
fit &lt;- rsadd(Surv(time,cens)~sex,rmap=list(age=age*365.241),
       ratetable=slopop,data=rdata,int=5)
sresid &lt;- residuals.rsadd(fit)

</code></pre>

<hr>
<h2 id='rs.br'>Test the Proportional Hazards Assumption for Relative Survival Regression
Models</h2><span id='topic+rs.br'></span><span id='topic+plot.rs.br'></span><span id='topic+print.rs.br'></span>

<h3>Description</h3>

<p>Test the proportional hazards assumption for relative survival models
(<code>rsadd</code>, <code>rsmul</code> or <code>rstrans</code>) by forming a Brownian Bridge.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rs.br(fit, sc, rho = 0, test = "max", global = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rs.br_+3A_fit">fit</code></td>
<td>
<p>the result of fitting a relative survival model, using the
<code>rsadd</code>, <code>rsmul</code> or <code>rstrans</code> function.</p>
</td></tr>
<tr><td><code id="rs.br_+3A_sc">sc</code></td>
<td>
<p>partial residuals calculated by the <code>resid</code> function. This is
used to save time if several tests are to be calculated on these residuals
and can otherwise be omitted.</p>
</td></tr>
<tr><td><code id="rs.br_+3A_rho">rho</code></td>
<td>
<p>a number controlling the weigths of residuals. The weights are
the number of individuals at risk at each event time to the power
<code>rho</code>. The default is <code>rho=0</code>, which sets all weigths to 1.</p>
</td></tr>
<tr><td><code id="rs.br_+3A_test">test</code></td>
<td>
<p>a character string specifying the test to be performed on
Brownian bridge. Possible values are <code>"max"</code> (default), which tests the
maximum absolute value of the bridge, and <code>cvm</code>, which calculates the
Cramer Von Mises statistic.</p>
</td></tr>
<tr><td><code id="rs.br_+3A_global">global</code></td>
<td>
<p>should a global Brownian bridge test be performed, in addition
to the per-variable tests</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an object of class <code>rs.br</code>. This function would usually be
followed by both a print and a plot of the result. The plot gives a Brownian
bridge for each of the variables. The horizontal lines are the 95
confidence intervals for the maximum absolute value of the Brownian bridge
</p>


<h3>References</h3>

<p>Goodness of fit: Stare J.,Pohar Perme M., Henderson R. (2005)
&quot;Goodness of fit of relative survival models.&quot; Statistics in Medicine,
<b>24</b>: 3911&ndash;3925.
</p>
<p>Package. Pohar M., Stare J. (2006) &quot;Relative survival analysis in R.&quot;
Computer Methods and Programs in Biomedicine, <b>81</b>: 272&ndash;278
</p>
<p>Relative survival: Pohar, M., Stare, J. (2007) &quot;Making relative survival
analysis relatively easy.&quot; Computers in biology and medicine, <b>37</b>:
1741&ndash;1749.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rsadd">rsadd</a></code>, <code>rsmul</code>, <code>rstrans</code>,
<code><a href="stats.html#topic+resid">resid</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(slopop)
data(rdata)
fit &lt;- rsadd(Surv(time,cens)~sex,rmap=list(age=age*365.241),
		ratetable=slopop,data=rdata,int=5)
rsbr &lt;- rs.br(fit)
rsbr
plot(rsbr)

</code></pre>

<hr>
<h2 id='rs.diff'>Test Net Survival Curve Differences</h2><span id='topic+rs.diff'></span><span id='topic+print.rsdiff'></span>

<h3>Description</h3>

<p>Tests if there is a difference between two or more net survival curves using
a log-rank type test.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rs.diff(
  formula = formula(data),
  data = parent.frame(),
  ratetable = relsurv::slopop,
  na.action,
  precision = 1,
  rmap
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rs.diff_+3A_formula">formula</code></td>
<td>
<p>A formula expression as for other survival models, of the
form <code>Surv(time, status) ~ predictors</code>. Each combination of predictor
values defines a subgroup. A <code>strata</code> term may be used to produce a
stratified test.
</p>
<p>NOTE: The follow-up time must be in days.</p>
</td></tr>
<tr><td><code id="rs.diff_+3A_data">data</code></td>
<td>
<p>a data.frame in which to interpret the variables named in the
<code>formula</code>.</p>
</td></tr>
<tr><td><code id="rs.diff_+3A_ratetable">ratetable</code></td>
<td>
<p>a table of event rates, organized as a <code>ratetable</code>
object, such as <code>slopop</code>.</p>
</td></tr>
<tr><td><code id="rs.diff_+3A_na.action">na.action</code></td>
<td>
<p>a missing-data filter function, applied to the model.frame,
after any subset argument has been used.  Default is
<code>options()$na.action</code>.</p>
</td></tr>
<tr><td><code id="rs.diff_+3A_precision">precision</code></td>
<td>
<p>Precision for numerical integration. Default is 1, which
means that daily intervals are taken, the value may be decreased to get a
higher precision or increased to achieve a faster calculation. The
calculation intervals always include at least all times of event and
censoring as border points.</p>
</td></tr>
<tr><td><code id="rs.diff_+3A_rmap">rmap</code></td>
<td>
<p>an optional list to be used if the variables are not organized
and named in the same way as in the <code>ratetable</code> object. See details
below.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>NOTE: The follow-up time must be specified in days. The <code>ratetable</code>
being used may have different variable names and formats than the user's
data set, this is dealt with by the <code>rmap</code> argument. For example, if
age is in years in the data set but in days in the <code>ratetable</code> object,
age=age*365.241 should be used. The calendar year can be in any date format
(date, Date and POSIXt are allowed), the date formats in the
<code>ratetable</code> and in the data may differ.
</p>


<h3>Value</h3>

<p>a <code>rsdiff</code> object; can be printed with <code>print</code>.
</p>


<h3>References</h3>

<p>Package: Pohar Perme, M., Pavlic, K. (2018) &quot;Nonparametric
Relative Survival Analysis with the R Package relsurv&quot;. Journal of
Statistical Software. 87(8), 1-27, doi: &quot;10.18637/jss.v087.i08&quot; Theory:
Graffeo, N., Castell, F., Belot, A. and Giorgi, R. (2016) &quot;A log-rank-type
test to compare net survival distributions. Biometrics. doi:
10.1111/biom.12477&quot; Theory: Pavlic, K., Pohar Perme, M. (2017) &quot;On
comparison of net survival curves. BMC Med Res Meth. doi:
10.1186/s12874-017-0351-3&quot;
</p>


<h3>See Also</h3>

<p><code>rs.surv</code>, <code>survdiff</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(slopop)
data(rdata)
#calculate the relative survival curve
#note that the variable year is given in days since 01.01.1960 and that 
#age must be multiplied by 365.241 in order to be expressed in days.
rs.diff(Surv(time,cens)~sex,rmap=list(age=age*365.241),
		ratetable=slopop,data=rdata)

</code></pre>

<hr>
<h2 id='rs.surv'>Compute a Relative Survival Curve</h2><span id='topic+rs.surv'></span>

<h3>Description</h3>

<p>Computes an estimate of the relative survival curve using the Ederer I,
Ederer II method, Pohar-Perme method or the Hakulinen method
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rs.surv(
  formula = formula(data),
  data = parent.frame(),
  ratetable = relsurv::slopop,
  na.action,
  fin.date,
  method = "pohar-perme",
  conf.type = "log",
  conf.int = 0.95,
  type = "kaplan-meier",
  add.times,
  precision = 1,
  rmap
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rs.surv_+3A_formula">formula</code></td>
<td>
<p>a formula object, with the response as a <code>Surv</code> object
on the left of a <code>~</code> operator, and, if desired, terms separated by the
<code>+</code> operator on the right. If no strata are used, <code>~1</code> should be
specified.
</p>
<p>NOTE: The follow-up time must be in days.</p>
</td></tr>
<tr><td><code id="rs.surv_+3A_data">data</code></td>
<td>
<p>a data.frame in which to interpret the variables named in the
<code>formula</code>.</p>
</td></tr>
<tr><td><code id="rs.surv_+3A_ratetable">ratetable</code></td>
<td>
<p>a table of event rates, organized as a <code>ratetable</code>
object, such as <code>slopop</code>.</p>
</td></tr>
<tr><td><code id="rs.surv_+3A_na.action">na.action</code></td>
<td>
<p>a missing-data filter function, applied to the model.frame,
after any subset argument has been used.  Default is
<code>options()$na.action</code>.</p>
</td></tr>
<tr><td><code id="rs.surv_+3A_fin.date">fin.date</code></td>
<td>
<p>the date of the study ending, used for calculating the
potential follow-up times in the Hakulinen method. If missing, it is
calculated as <code>max(year+time)</code>.</p>
</td></tr>
<tr><td><code id="rs.surv_+3A_method">method</code></td>
<td>
<p>the method for calculating the relative survival. The options
are <code>pohar-perme</code>(default), <code>ederer1</code>, <code>ederer2</code> and
<code>hakulinen</code>.</p>
</td></tr>
<tr><td><code id="rs.surv_+3A_conf.type">conf.type</code></td>
<td>
<p>one of <code>plain</code>, <code>log</code> (the default), or
<code>log-log</code>. The first option causes the standard intervals curve +- k
*se(curve), where k is determined from conf.int. The log option calculates
intervals based on the cumulative hazard or log(survival). The last option
bases intervals on the log hazard or log(-log(survival)).</p>
</td></tr>
<tr><td><code id="rs.surv_+3A_conf.int">conf.int</code></td>
<td>
<p>the level for a two-sided confidence interval on the
survival curve(s). Default is 0.95.</p>
</td></tr>
<tr><td><code id="rs.surv_+3A_type">type</code></td>
<td>
<p>defines how survival estimates are to be calculated given the
hazards.  The default (<code>kaplan-meier</code>) calculates the product integral,
whereas the option <code>fleming-harrington</code> exponentiates the negative
cumulative hazard. Analogous to the usage in <code>survfit</code>.</p>
</td></tr>
<tr><td><code id="rs.surv_+3A_add.times">add.times</code></td>
<td>
<p>specific times at which the curve should be evaluated.</p>
</td></tr>
<tr><td><code id="rs.surv_+3A_precision">precision</code></td>
<td>
<p>Precision for numerical integration. Default is 1, which
means that daily intervals are taken, the value may be decreased to get a
higher precision or increased to achieve a faster calculation. The
calculation intervals always include at least all times of event and
censoring as border points.</p>
</td></tr>
<tr><td><code id="rs.surv_+3A_rmap">rmap</code></td>
<td>
<p>an optional list to be used if the variables are not organized
and named in the same way as in the <code>ratetable</code> object. See details
below.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>NOTE: The follow-up time must be specified in days. The <code>ratetable</code>
being used may have different variable names and formats than the user's
data set, this is dealt with by the <code>rmap</code> argument. For example, if
age is in years in the data set but in days in the <code>ratetable</code> object,
age=age*365.241 should be used. The calendar year can be in any date format
(date, Date and POSIXt are allowed), the date formats in the
<code>ratetable</code> and in the data may differ.
</p>
<p>The potential censoring times needed for the calculation of the expected
survival by the Hakulinen method are calculated automatically. The times of
censoring are left as they are, the times of events are replaced with
<code>fin.date - year</code>.
</p>
<p>The calculation of the Pohar-Perme estimate is more time consuming since
more data are needed from the population tables.  The old version of the
function, now named <code>rs.survo</code> can be used as a faster version for the
Hakulinen and Ederer II estimate.
</p>
<p>Numerical integration is required for Pohar-Perme estimate. The integration
precision is set with argument <code>precision</code>, which defaults to daily
intervals, a default that should give enough precision for any practical
purpose.
</p>
<p>Note that even though the estimate is always calculated using numerical
integration, only the values at event and censoring times are reported.
Hence, the function <code>plot</code> draws a step function in between and the
function <code>summary</code> reports the value at the last event or censoring
time before the specified time. If the output of the estimated values at
other points is required, this should be specified with argument
<code>add.times</code>.
</p>


<h3>Value</h3>

<p>a <code>survfit</code> object; see the help on <code>survfit.object</code> for
details.  The <code>survfit</code> methods are used for <code>print</code>,
<code>summary</code>, <code>plot</code>, <code>lines</code>, and <code>points</code>.
</p>


<h3>References</h3>

<p>Package: Pohar Perme, M., Pavlic, K. (2018) &quot;Nonparametric
Relative Survival Analysis with the R Package relsurv&quot;. Journal of
Statistical Software. 87(8), 1-27, doi: &quot;10.18637/jss.v087.i08&quot; Theory:
Pohar Perme, M., Esteve, J., Rachet, B. (2016) &quot;Analysing Population-Based
Cancer Survival - Settling the Controversies.&quot; BMC Cancer, 16 (933), 1-8.
doi:10.1186/s12885-016-2967-9. Theory: Pohar Perme, M., Stare, J., Esteve,
J. (2012) &quot;On Estimation in Relative Survival&quot;, Biometrics, 68(1), 113-120.
doi:10.1111/j.1541-0420.2011.01640.x.
</p>


<h3>See Also</h3>

<p><code>survfit</code>, <code>survexp</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(slopop)
data(rdata)
#calculate the relative survival curve
#note that the variable year must be given in a date format and that
#age must be multiplied by 365.241 in order to be expressed in days.
rs.surv(Surv(time,cens)~sex,rmap=list(age=age*365.241), ratetable=slopop,data=rdata)

</code></pre>

<hr>
<h2 id='rs.surv.rsadd'>Compute a Relative Survival Curve from an additive relative survival model</h2><span id='topic+rs.surv.rsadd'></span>

<h3>Description</h3>

<p>Computes the predicted relative survival function for an additive relative
survival model fitted with maximum likelihood.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rs.surv.rsadd(formula, newdata)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rs.surv.rsadd_+3A_formula">formula</code></td>
<td>
<p>a <code>rsadd</code> object (Implemented only for models fitted
with the codemax.lik (default) option.)</p>
</td></tr>
<tr><td><code id="rs.surv.rsadd_+3A_newdata">newdata</code></td>
<td>
<p>a data frame with the same variable names as those that
appear in the <code>rsadd</code> formula.  a predicted curve for each individual
in this data frame shall be calculated</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Does not work with factor variables - you have to form dummy variables
before calling the rsadd function.
</p>


<h3>Value</h3>

<p>a <code>survfit</code> object; see the help on <code>survfit.object</code> for
details.  The <code>survfit</code> methods are used for <code>print</code>, <code>plot</code>,
<code>lines</code>, and <code>points</code>.
</p>


<h3>References</h3>

<p>Package. Pohar M., Stare J. (2006) &quot;Relative survival analysis
in R.&quot; Computer Methods and Programs in Biomedicine, <b>81</b>: 272&ndash;278
</p>


<h3>See Also</h3>

<p><code>survfit</code>, <code>survexp</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(slopop)
data(rdata)
#fit a relative survival model
fit &lt;- rsadd(Surv(time,cens)~sex+age+year,rmap=list(age=age*365.241),
	ratetable=slopop,data=rdata,int=c(0:10,15))

#calculate the predicted curve for a male individual, aged 65, diagnosed in 1982
d &lt;- rs.surv.rsadd(fit,newdata=data.frame(sex=1,age=65,year=as.date("1Jul1982")))
#plot the curve (will result in a step function since the baseline is assumed piecewise constant)
plot(d,xscale=365.241)

#calculate the predicted survival curves for each individual in the data set
d &lt;- rs.surv.rsadd(fit,newdata=rdata)
#calculate the average over all predicted survival curves
p.surv &lt;- apply(d$surv,1,mean)
#plot the relative survival curve
plot(d$time/365.241,p.surv,type="b",ylim=c(0,1),xlab="Time",ylab="Relative survival")

</code></pre>

<hr>
<h2 id='rs.zph'>Behaviour of Covariates in Time for Relative Survival Regression Models</h2><span id='topic+rs.zph'></span>

<h3>Description</h3>

<p>Calculates the scaled partial residuals of a relative survival model
(<code>rsadd</code>, <code>rsmul</code> or <code>rstrans</code>)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rs.zph(fit, sc, transform = "identity", var.type = "sum")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rs.zph_+3A_fit">fit</code></td>
<td>
<p>the result of fitting an additive relative survival model, using
the <code>rsadd</code>, <code>rsmul</code> or <code>rstrans</code> function.
</p>
<p>In the case of multiplicative and transformation models the output is
identical to <code>cox.zph</code> function, except no test is performed.</p>
</td></tr>
<tr><td><code id="rs.zph_+3A_sc">sc</code></td>
<td>
<p>partial residuals calculated by the <code>resid</code> function. This is
used to save time if several tests are to be calculated on these residuals
and can otherwise be omitted.</p>
</td></tr>
<tr><td><code id="rs.zph_+3A_transform">transform</code></td>
<td>
<p>a character string specifying how the survival times should
be transformed. Possible values are <code>"km"</code>, <code>"rank"</code>,
<code>"identity"</code> and <code>log</code>. The default is <code>"identity"</code>.</p>
</td></tr>
<tr><td><code id="rs.zph_+3A_var.type">var.type</code></td>
<td>
<p>a character string specifying the variance used to scale the
residuals. Possible values are <code>"each"</code>, which estimates the variance
for each residual separately, and <code>sum</code>(default), which assumes the
same variance for all the residuals.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an object of class <code>rs.zph</code>. This function would usually be
followed by a plot of the result. The plot gives an estimate of the
time-dependent coefficient <code>beta(t)</code>. If the proportional hazards
assumption is true, <code>beta(t)</code> will be a horizontal line.
</p>


<h3>References</h3>

<p>Goodness of fit: Stare J.,Pohar Perme M., Henderson R. (2005)
&quot;Goodness of fit of relative survival models.&quot; Statistics in Medicine,
<b>24</b>: 3911&ndash;3925.
</p>
<p>Package. Pohar M., Stare J. (2006) &quot;Relative survival analysis in R.&quot;
Computer Methods and Programs in Biomedicine, <b>81</b>: 272&ndash;278
</p>
<p>Relative survival: Pohar, M., Stare, J. (2007) &quot;Making relative survival
analysis relatively easy.&quot; Computers in biology and medicine, <b>37</b>:
1741&ndash;1749.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rsadd">rsadd</a></code>, <code>rsmul</code>, <code>rstrans</code>,
<code><a href="stats.html#topic+resid">resid</a></code>, <code><a href="survival.html#topic+cox.zph">cox.zph</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(slopop)
data(rdata)
fit &lt;- rsadd(Surv(time,cens)~sex,rmap=list(age=age*365.241),
	ratetable=slopop,data=rdata,int=5)
rszph &lt;- rs.zph(fit)
plot(rszph)

</code></pre>

<hr>
<h2 id='rsadd'>Fit an Additive model for Relative Survival</h2><span id='topic+rsadd'></span>

<h3>Description</h3>

<p>The function fits an additive model to the data. The methods implemented are the maximum likelihood method, the semiparametric
method, a glm model with a <code>binomial</code> error and a glm model with a <code>poisson</code> error. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rsadd(formula, data=parent.frame(), ratetable = relsurv::slopop,
      int, na.action, method, init,bwin,centered,cause,control,rmap,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rsadd_+3A_formula">formula</code></td>
<td>

<p>a formula object, with the response as a <code>Surv</code> object on the
left of a <code>~</code> operator, and, if desired, terms separated  by
the <code>+</code> operator on the right. <code>Surv(start,stop,event)</code> 
outcomes are also possible for time-dependent covariates and 
left-truncation for <code>method='EM'</code>.
</p>
<p>NOTE: The follow-up time must be in days.
</p>
</td></tr>
<tr><td><code id="rsadd_+3A_data">data</code></td>
<td>

<p>a data.frame in which to interpret the variables named in
the <code>formula</code>.
</p>
</td></tr>
<tr><td><code id="rsadd_+3A_ratetable">ratetable</code></td>
<td>

<p>a table of event rates, organized as a <code>ratetable</code> object, such as <code>slopop</code>. 
</p>
</td></tr>
<tr><td><code id="rsadd_+3A_int">int</code></td>
<td>

<p>either a single value denoting the number of follow-up years or a vector
specifying the intervals (in years) in which the hazard is constant (the times that are
bigger than <code>max(int)</code> are censored. If missing, only one interval (from time 0 to maximum observation time) is assumed.
The EM method does not need the intervals,
only the maximum time can be specified (all times are censored after this time point).
</p>
</td></tr>
<tr><td><code id="rsadd_+3A_na.action">na.action</code></td>
<td>
<p>a missing-data filter function, applied to the model.frame,
after any subset argument has been used.  Default is
<code>options()$na.action</code>. </p>
</td></tr>
<tr><td><code id="rsadd_+3A_method">method</code></td>
<td>
<p><code>glm.bin</code> or <code>glm.poi</code> for a glm model, <code>EM</code> for the EM algorithm and <code>max.lik</code> for the maximum likelihood model (default). </p>
</td></tr>
<tr><td><code id="rsadd_+3A_init">init</code></td>
<td>
<p>vector of initial values of the iteration.  Default initial
value is zero for all variables. </p>
</td></tr>
<tr><td><code id="rsadd_+3A_bwin">bwin</code></td>
<td>
<p>controls the bandwidth used for smoothing in the EM algorithm. The follow-up time is divided into quartiles and
<code>bwin</code> specifies a factor by which the maximum between events time length on each interval is multiplied. The default
<code>bwin=-1</code> lets the function find an appropriate value. If <code>bwin=0</code>, no smoothing is applied.
</p>
</td></tr>
<tr><td><code id="rsadd_+3A_centered">centered</code></td>
<td>
<p>if <code>TRUE</code>, all the variables are centered before fitting and the baseline excess hazard
is calculated accordingly. Default is <code>FALSE</code>. </p>
</td></tr>
<tr><td><code id="rsadd_+3A_cause">cause</code></td>
<td>
<p>A vector of the same length as the number of cases. <code>0</code> for population deaths, <code>1</code> for disease specific
deaths, <code>2</code> (default) for unknown. Can only be used with the <code>EM</code> method. </p>
</td></tr>
<tr><td><code id="rsadd_+3A_control">control</code></td>
<td>
<p>a list of parameters for controlling the fitting process. 
See the documentation for <code>glm.control</code> for details.
</p>
</td></tr>
<tr><td><code id="rsadd_+3A_rmap">rmap</code></td>
<td>
<p>an optional list to be used if the variables are not
organized and named in the same way as in the <code>ratetable</code> object. See details below.</p>
</td></tr>
<tr><td><code id="rsadd_+3A_...">...</code></td>
<td>
<p>other arguments will be passed to <code>glm.control</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>NOTE: The follow-up time must be specified in days. The <code>ratetable</code> being used may have different variable names and formats than the user's data set, this is dealt with by the <code>rmap</code> argument. For example, if age is in years in the data set but in days in the <code>ratetable</code> object, age=age*365.241 should be used. The calendar year can be in any date format (date, Date and POSIXt are allowed), the date formats in the <code>ratetable</code> and in the data may differ. 
</p>
<p>The maximum likelihood method and both glm methods assume a fully parametric model with a piecewise constant baseline
excess hazard function. The intervals on which the baseline is assumed constant should be passed via argument <code>int</code>. The
EM method is semiparametric, i.e. no assumptions are made for the baseline hazard and therefore no intervals need to be specified.
</p>
<p>The methods using glm are methods for grouped data. The groups are formed according to the covariate values.
This should be taken into account when fitting a model. The  glm method returns life tables for groups specified by the covariates in <code>groups</code>.
</p>
<p>The EM method output includes the smoothed baseline excess hazard <code>lambda0</code>, the cumulative baseline excess hazard 
<code>Lambda0</code> and  <code>times</code> at which they are estimated. The individual probabilites of dying due to the excess risk
are returned as <code>Nie</code>. 
The EM method fitting procedure requires some local smoothing of the baseline excess hazard. The default <code>bwin=-1</code>
value lets the function find an appropriate value for the 
smoothing band width. While this ensures an unbiased estimate, the procedure time is much longer. As the value found by 
the function is independent of the covariates in the model, the value can be read from the output (<code>bwinfac</code>) and 
used for refitting different models to the same data to save time.
</p>


<h3>Value</h3>

<p>An object of class <code>rsadd</code>. In the case of <code>method="glm.bin"</code> and <code>method="glm.poi"</code> the class also
inherits from <code>glm</code> which  inherits from the class <code>lm</code>.
Objects of this class have methods for the functions <code>print</code> and <code>summary</code>.
An object of class <code>rsadd</code> is a list containing at least the following components:
</p>
<table>
<tr><td><code>data</code></td>
<td>
<p>the data as used in the model, along with the variables defined in the rate table</p>
</td></tr>
<tr><td><code>ratetable</code></td>
<td>
<p>the ratetable used.</p>
</td></tr>
<tr><td><code>int</code></td>
<td>
<p>the maximum time (in years) used. All the events at and after this value are censored.</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p>the fitting method that was used.</p>
</td></tr>
<tr><td><code>linear.predictors</code></td>
<td>
<p>the vector of linear predictors, one per subject.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Package. Pohar M., Stare J. (2006) &quot;Relative survival analysis in R.&quot; Computer Methods and Programs in Biomedicine, <b>81</b>: 272&ndash;278
</p>
<p>Relative survival: Pohar, M., Stare, J. (2007) &quot;Making relative survival analysis relatively easy.&quot;
Computers in biology and medicine, <b>37</b>: 1741&ndash;1749.
</p>
<p>EM algorithm: Pohar Perme M., Henderson R., Stare, J. (2009) &quot;An approach to estimation in relative survival regression.&quot; Biostatistics, <b>10</b>: 136&ndash;146.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rstrans">rstrans</a></code>,
<code><a href="#topic+rsmul">rsmul</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(slopop)
data(rdata)
#fit an additive model
#note that the variable year is given in days since 01.01.1960 and that
#age must be multiplied by 365.241 in order to be expressed in days.
fit &lt;- rsadd(Surv(time,cens)~sex+as.factor(agegr)+ratetable(age=age*365.241),
	    ratetable=slopop,data=rdata,int=5)

#check the goodness of fit
rs.br(fit)

#use the EM method and plot the smoothed baseline excess hazard
fit &lt;- rsadd(Surv(time,cens)~sex+age,rmap=list(age=age*365.241),
	 ratetable=slopop,data=rdata,int=5,method="EM")
sm &lt;- epa(fit)
plot(sm$times,sm$lambda,type="l")
</code></pre>

<hr>
<h2 id='rsmul'>Fit Andersen et al Multiplicative Regression Model for Relative Survival</h2><span id='topic+rsmul'></span>

<h3>Description</h3>

<p>Fits the Andersen et al multiplicative regression model in relative survival. An extension of the 
coxph function using relative survival.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rsmul(formula, data, ratetable = relsurv::slopop, int,na.action,init,
      method,control,rmap,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rsmul_+3A_formula">formula</code></td>
<td>

<p>a formula object, with the response as a <code>Surv</code> object on the
left of a <code>~</code> operator, and, if desired, terms separated  by
the <code>+</code> operator on the right. 
</p>
<p>NOTE: The follow-up time must be in days.
</p>
</td></tr>
<tr><td><code id="rsmul_+3A_data">data</code></td>
<td>

<p>a data.frame in which to interpret the variables named in
the <code>formula</code>.
</p>
</td></tr>
<tr><td><code id="rsmul_+3A_ratetable">ratetable</code></td>
<td>

<p>a table of event rates, such as <code>slopop</code>. 
</p>
</td></tr>
<tr><td><code id="rsmul_+3A_int">int</code></td>
<td>

<p>the number of follow-up years used for calculating survival(the data are censored after this time-point). If missing, it is set the 
the maximum observed follow-up time.
</p>
</td></tr>
<tr><td><code id="rsmul_+3A_na.action">na.action</code></td>
<td>
<p>a missing-data filter function, applied to the model.frame,
after any subset argument has been used.  Default is
<code>options()$na.action</code>. </p>
</td></tr>
<tr><td><code id="rsmul_+3A_init">init</code></td>
<td>
<p>vector of initial values of the iteration.  Default initial
value is zero for all variables. </p>
</td></tr>
<tr><td><code id="rsmul_+3A_method">method</code></td>
<td>
<p>the default method <code>mul</code> assumes hazard to be constant on yearly intervals. Method <code>mul1</code> uses the ratetable
to determine the time points when hazard changes. The <code>mul1</code> method is therefore more accurate, but at the same time can
be more computationally intensive.</p>
</td></tr>
<tr><td><code id="rsmul_+3A_control">control</code></td>
<td>
<p>a list of parameters for controlling the fitting process. 
See the documentation for <code>coxph.control</code> for details.
</p>
</td></tr>
<tr><td><code id="rsmul_+3A_rmap">rmap</code></td>
<td>
<p>an optional list to be used if the variables are not
organized and named in the same way as in the <code>ratetable</code> object. See details below.</p>
</td></tr>
<tr><td><code id="rsmul_+3A_...">...</code></td>
<td>
<p>Other arguments will be passed to <code>coxph.control</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>NOTE: The follow-up time must be specified in days. The <code>ratetable</code> being used may have different variable names and formats than the user's data set, this is dealt with by the <code>rmap</code> argument. For example, if age is in years in the data set but in days in the <code>ratetable</code> object, age=age*365.241 should be used. The calendar year can be in any date format (date, Date and POSIXt are allowed), the date formats in the <code>ratetable</code> and in the data may differ. 
</p>


<h3>Value</h3>

<p>an object of class <code>coxph</code> with an additional item:
</p>
<table>
<tr><td><code>basehaz</code></td>
<td>
<p>Cumulative baseline hazard (population values are seen as offset) at centered values of covariates.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Method: Andersen, P.K., Borch-Johnsen, K., Deckert, T., Green, A.,
Hougaard, P., Keiding, N. and Kreiner, S. (1985) &quot;A Cox regression
model for relative mortality and its application to diabetes
mellitus survival data.&quot;, Biometrics, <b>41</b>: 921&ndash;932.
</p>
<p>Package. Pohar M., Stare J. (2006) &quot;Relative survival analysis in R.&quot; Computer Methods and Programs in Biomedicine, <b>81</b>: 272&ndash;278
</p>
<p>Relative survival: Pohar, M., Stare, J. (2007) &quot;Making relative survival analysis relatively easy.&quot;
Computers in biology and medicine, <b>37</b>: 1741&ndash;1749.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rsadd">rsadd</a></code>, <code><a href="#topic+rstrans">rstrans</a></code>. </p>


<h3>Examples</h3>

<pre><code class='language-R'>data(slopop)
data(rdata)
#fit a multiplicative model
#note that the variable year is given in days since 01.01.1960 and that 
#age must be multiplied by 365.241 in order to be expressed in days.
fit &lt;- rsmul(Surv(time,cens)~sex+as.factor(agegr),rmap=list(age=age*365.241),
            ratetable=slopop,data=rdata)


#check the goodness of fit
rs.br(fit)

</code></pre>

<hr>
<h2 id='rstrans'>Fit Cox Proportional Hazards Model in Transformed Time</h2><span id='topic+rstrans'></span>

<h3>Description</h3>

<p>The function transforms each person's time to his/her probability
of dying at that time according to the ratetable. It then fits the
Cox proportional hazards model with the transformed times as a 
response. It can also be used for calculatin the transformed times (no covariates are needed in the formula for that purpose).  
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rstrans(formula, data, ratetable, int,na.action,init,control,rmap,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rstrans_+3A_formula">formula</code></td>
<td>

<p>a formula object, with the response as a <code>Surv</code> object on the
left of a <code>~</code> operator, and, if desired, terms separated  by
the <code>+</code> operator on the right. 
</p>
<p>NOTE: The follow-up time must be in days.
</p>
</td></tr>
<tr><td><code id="rstrans_+3A_data">data</code></td>
<td>

<p>a data.frame in which to interpret the variables named
in the <code>formula</code>.  
</p>
</td></tr>
<tr><td><code id="rstrans_+3A_ratetable">ratetable</code></td>
<td>

<p>a table of event rates, such as <code>slopop</code>. 
</p>
</td></tr>
<tr><td><code id="rstrans_+3A_int">int</code></td>
<td>
 
<p>the number of follow-up years used for calculating survival(the rest is censored). If missing, it is set the 
the maximum observed follow-up time.
</p>
</td></tr>
<tr><td><code id="rstrans_+3A_na.action">na.action</code></td>
<td>
<p>a missing-data filter function, applied to the model.frame,
after any subset argument has been used.  Default is
<code>options()$na.action</code>. </p>
</td></tr>
<tr><td><code id="rstrans_+3A_init">init</code></td>
<td>
<p>vector of initial values of the iteration.  Default initial
value is zero for all variables. </p>
</td></tr>
<tr><td><code id="rstrans_+3A_control">control</code></td>
<td>
<p>a list of parameters for controlling the fitting process. 
See the documentation for <code>coxph.control</code> for details.
</p>
</td></tr>
<tr><td><code id="rstrans_+3A_rmap">rmap</code></td>
<td>
<p>an optional list to be used if the variables are not
organized and named in the same way as in the <code>ratetable</code> object. See details below.</p>
</td></tr>
<tr><td><code id="rstrans_+3A_...">...</code></td>
<td>
<p>other arguments will be passed to <code>coxph.control</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>NOTE: The follow-up time must be specified in days. The <code>ratetable</code> being used may have different variable names and formats than the user's data set, this is dealt with by the <code>rmap</code> argument. For example, if age is in years in the data set but in days in the <code>ratetable</code> object, age=age*365.241 should be used. The calendar year can be in any date format (date, Date and POSIXt are allowed), the date formats in the <code>ratetable</code> and in the data may differ. 
A side product of this function are the transformed times - stored in teh <code>y</code> object of the output. To get these times, covariates are of course irrelevant.
</p>


<h3>Value</h3>

<p>an object of class <code>coxph</code>. See <code>coxph.object</code> and <code>coxph.detail</code> for details.  
</p>
<table>
<tr><td><code>y</code></td>
<td>

<p>an object of class <code>Surv</code> containing the transformed times (these times do not depend on covariates). 
</p>
</td></tr>
</table>


<h3>References</h3>

<p>Method: Stare J., Henderson R., Pohar M. (2005) &quot;An individual measure for relative survival.&quot; Journal
of the Royal Statistical Society: Series C, <b>54</b> 115&ndash;126.
</p>
<p>Package. Pohar M., Stare J. (2006) &quot;Relative survival analysis in R.&quot; Computer Methods and Programs in Biomedicine, <b>81</b>: 272&ndash;278
</p>
<p>Relative survival: Pohar, M., Stare, J. (2007) &quot;Making relative survival analysis relatively easy.&quot;
Computers in biology and medicine, <b>37</b>: 1741&ndash;1749.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rsmul">rsmul</a></code>, <code><a href="#topic+invtime">invtime</a></code>, <code><a href="#topic+rsadd">rsadd</a></code>, <code><a href="survival.html#topic+survexp">survexp</a></code>.</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(slopop)
data(rdata)

#fit a Cox model using the transformed times
#note that the variable year is given in days since 01.01.1960 and that 
#age must be multiplied by 365.241 in order to be expressed in days.
fit &lt;- rstrans(Surv(time,cens)~sex+as.factor(agegr),rmap=list(age=age*365.241,
        sex=sex,year=year),ratetable=slopop,data=rdata)


#check the goodness of fit
rs.br(fit)
</code></pre>

<hr>
<h2 id='slopop'>Census Data Set for the Slovene Population</h2><span id='topic+slopop'></span>

<h3>Description</h3>

<p>Census data set for the Slovene population.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(slopop)</code></pre>


<h3>Examples</h3>

<pre><code class='language-R'>data(slopop)
</code></pre>

<hr>
<h2 id='summary.cmp.rel'>Summary of the crude probability of death</h2><span id='topic+summary.cmp.rel'></span>

<h3>Description</h3>

<p>Returns a list containing the estimated values at required times. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>	## S3 method for class 'cmp.rel'
summary(object, times, scale = 365.241,area=FALSE,...) 

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.cmp.rel_+3A_object">object</code></td>
<td>
<p>output of the function <code>cmp.rel</code>.</p>
</td></tr>
<tr><td><code id="summary.cmp.rel_+3A_times">times</code></td>
<td>
<p>the times at which the output is required.</p>
</td></tr>
<tr><td><code id="summary.cmp.rel_+3A_scale">scale</code></td>
<td>
<p>The time scale in which the times are specified. The default value is <code>1</code>, i.e. days.</p>
</td></tr>
<tr><td><code id="summary.cmp.rel_+3A_area">area</code></td>
<td>
<p>Should area under the curves at time <code>tau</code> be printed out? Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="summary.cmp.rel_+3A_...">...</code></td>
<td>
<p>Additional arguments, currently not implemented</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The variance is calculated using numerical integration. If the required time is not a time at which the value was estimated, the value at the last time before it is reported. The density of the time points is set by the <code>precision</code> argument in the <code>cmp.rel</code> function.
</p>


<h3>Value</h3>

<p>A list of values is returned.
</p>


<h3>See Also</h3>

<p><code>cmp.rel</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(slopop)
data(rdata)
#calculate the crude probability of death and summarize it
fit &lt;- cmp.rel(Surv(time,cens)~sex,rmap=list(age=age*365),
      ratetable=slopop,data=rdata,tau=3652.41)
summary(fit,c(1,3),scale=365.241)
</code></pre>

<hr>
<h2 id='survfit.rsadd'>Compute a Predicited Survival Curve</h2><span id='topic+survfit.rsadd'></span>

<h3>Description</h3>

<p>Computes a predicted survival curve based on the additive model estimated by
rsadd function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'rsadd'
survfit(
  formula,
  newdata,
  se.fit = TRUE,
  conf.int = 0.95,
  individual = FALSE,
  conf.type = c("log", "log-log", "plain", "none"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="survfit.rsadd_+3A_formula">formula</code></td>
<td>
<p>a rsadd object</p>
</td></tr>
<tr><td><code id="survfit.rsadd_+3A_newdata">newdata</code></td>
<td>
<p>a data frame with the same variable names as those that
appear in the rsadd formula. The curve(s) produced will be representative of
a cohort who's covariates correspond to the values in newdata.</p>
</td></tr>
<tr><td><code id="survfit.rsadd_+3A_se.fit">se.fit</code></td>
<td>
<p>a logical value indicating whether standard errors should be
computed. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="survfit.rsadd_+3A_conf.int">conf.int</code></td>
<td>
<p>the level for a two-sided confidence interval on the
survival curve(s). Default is 0.95.</p>
</td></tr>
<tr><td><code id="survfit.rsadd_+3A_individual">individual</code></td>
<td>
<p>a logical value indicating whether the data frame
represents different time epochs for only one individual (T), or whether
multiple rows indicate multiple individuals (F, the default). If the former
only one curve will be produced; if the latter there will be one curve per
row in newdata.</p>
</td></tr>
<tr><td><code id="survfit.rsadd_+3A_conf.type">conf.type</code></td>
<td>
<p>One of <code>none</code>, <code>plain</code>, <code>log</code> (the default),
or <code>log-log</code>. The first option causes confidence intervals not to be
generated. The second causes the standard intervals curve +- k *se(curve),
where k is determined from conf.int. The log option calculates intervals
based on the cumulative hazard or log(survival). The last option bases
intervals on the log hazard or log(-log(survival)).</p>
</td></tr>
<tr><td><code id="survfit.rsadd_+3A_...">...</code></td>
<td>
<p>Currently not implemented</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When predicting the survival curve, the ratetable values for future years
will be equal to those of the last given year. The same ratetables will be
used for fitting and predicting. To predict a relative survival curve, use
<code>rs.surv.rsadd</code>.
</p>


<h3>Value</h3>

<p>a <code>survfit</code> object; see the help on <code>survfit.object</code> for
details.  The <code>survfit</code> methods are used for <code>print</code>, <code>plot</code>,
<code>lines</code>, and <code>points</code>.
</p>


<h3>References</h3>

<p>Package: Pohar M., Stare J. (2006) &quot;Relative survival analysis
in R.&quot; Computer Methods and Programs in Biomedicine,<b>81</b>: 272&ndash;278.
</p>
<p>Relative survival: Pohar, M., Stare, J. (2007) &quot;Making relative survival
analysis relatively easy.&quot; Computers in biology and medicine, <b>37</b>:
1741&ndash;1749.
</p>


<h3>See Also</h3>

<p><code>survfit</code>, <code>survexp</code>, <code><a href="#topic+rs.surv">rs.surv</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(slopop)
data(rdata)
#BTW: work on a smaller dataset here to run the example faster
fit &lt;- rsadd(Surv(time,cens)~sex,rmap=list(age=age*365.241),
	ratetable=slopop,data=rdata[1:500,],method="EM")
survfit.rsadd(fit,newdata=data.frame(sex=1,age=60,year=17000))


</code></pre>

<hr>
<h2 id='survsplit'>Split a Survival Data Set at Specified Times</h2><span id='topic+survsplit'></span>

<h3>Description</h3>

<p>Given a survival data set and a set of specified cut times, the function splits
each record into multiple records at each cut time. The new data 
set is be in <code>counting process</code> format, with a start time, stop
time, and event status for each record. More general than <code>survSplit</code>
as it also works with the data already in the <code>counting process</code> format.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>survsplit(data, cut, end, event, start, id = NULL, zero = 0,
          episode = NULL,interval=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="survsplit_+3A_data">data</code></td>
<td>
<p>data frame. </p>
</td></tr>
<tr><td><code id="survsplit_+3A_cut">cut</code></td>
<td>
<p>vector of timepoints to cut at.</p>
</td></tr>
<tr><td><code id="survsplit_+3A_end">end</code></td>
<td>
<p>character string with name of event time variable. </p>
</td></tr>
<tr><td><code id="survsplit_+3A_event">event</code></td>
<td>
<p>character string with name of censoring indicator. </p>
</td></tr>
<tr><td><code id="survsplit_+3A_start">start</code></td>
<td>
<p>character string with name of start variable (will be
created if it does not exist). </p>
</td></tr>
<tr><td><code id="survsplit_+3A_id">id</code></td>
<td>
<p>character string with name of new id variable to create
(optional). </p>
</td></tr>
<tr><td><code id="survsplit_+3A_zero">zero</code></td>
<td>
<p>If <code>start</code> doesn't already exist, this is the time
that the original records start. May be a vector or single value. </p>
</td></tr>
<tr><td><code id="survsplit_+3A_episode">episode</code></td>
<td>
<p>character string with name of new episode variable (optional).</p>
</td></tr>
<tr><td><code id="survsplit_+3A_interval">interval</code></td>
<td>
<p>this argument is used by <code>max.lik</code> function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>New, longer, data frame.</p>


<h3>See Also</h3>

<p><code><a href="survival.html#topic+survSplit">survSplit</a></code>.</p>

<hr>
<h2 id='transrate'>Reorganize Data into a Ratetable Object</h2><span id='topic+transrate'></span>

<h3>Description</h3>

<p>The function assists in reorganizing certain types of data
into a ratetable object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>transrate(men,women,yearlim,int.length=1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="transrate_+3A_men">men</code></td>
<td>

<p>a matrix containing the yearly (conditional) probabilities
of one year survival for men. Rows represent age (increasing
1 year per line,starting with 0), the columns represent cohort
years (the limits are in <code>yearlim</code>, the increase is in
<code>int.length</code>.
</p>
</td></tr>
<tr><td><code id="transrate_+3A_women">women</code></td>
<td>

<p>a matrix containing the yearly (conditional) probabilities
of one year survival for women.
</p>
</td></tr>
<tr><td><code id="transrate_+3A_yearlim">yearlim</code></td>
<td>
<p>the first and last cohort year given in the tables.</p>
</td></tr>
<tr><td><code id="transrate_+3A_int.length">int.length</code></td>
<td>
<p>the length of intervals in which cohort years are given.</p>
</td></tr>
</table>


<h3>Details</h3>

 
<p>This function only applies for ratetables that are
organized by age, sex and year.
</p>


<h3>Value</h3>

<p>An object of class <code>ratetable</code>.</p>


<h3>References</h3>

<p>Package. Pohar M., Stare J. (2006) &quot;Relative survival analysis in R.&quot; Computer Methods and Programs in Biomedicine, <b>81</b>: 272&ndash;278
</p>
<p>Relative survival: Pohar, M., Stare, J. (2007) &quot;Making relative survival analysis relatively easy.&quot;
Computers in biology and medicine, <b>37</b>: 1741&ndash;1749.
</p>


<h3>See Also</h3>

<p><code><a href="survival.html#topic+ratetable">ratetable</a></code>.</p>


<h3>Examples</h3>

<pre><code class='language-R'>men &lt;- cbind(exp(-365.241*exp(-14.5+.08*(0:100))),exp(-365*exp(-14.7+.085*(0:100))))
women &lt;- cbind(exp(-365.241*exp(-15.5+.085*(0:100))),exp(-365*exp(-15.7+.09*(0:100))))
table &lt;- transrate(men,women,yearlim=c(1980,1990),int.length=10)
</code></pre>

<hr>
<h2 id='transrate.hld'>Reorganize Data obtained from Human Life-Table Database into a Ratetable
Object</h2><span id='topic+transrate.hld'></span>

<h3>Description</h3>

<p>The function assists in reorganizing the .txt files obtained from Human
Life-Table Database (http://www.lifetable.de -&gt; Data by Country) into a
ratetable object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>transrate.hld(file, cut.year, race)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="transrate.hld_+3A_file">file</code></td>
<td>
<p>a vector of file names which the data are to be read from. Must
be in .tex format and in the same format as the files in Human Life-Table
Database.</p>
</td></tr>
<tr><td><code id="transrate.hld_+3A_cut.year">cut.year</code></td>
<td>
<p>a vector of cutpoints for years. Must be specified when the
year spans in the files are not consecutive.</p>
</td></tr>
<tr><td><code id="transrate.hld_+3A_race">race</code></td>
<td>
<p>a vector of race names for the input files.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function works with any table organised in the format provided by the
Human Life-Table Database, but currently only works with TypeLT 1 (i.e. age
intervals of length 1). The age must always start with value 0, but can end
at different values (when that happens, the last value is carried forward).
The rates between the cutpoints are taken to be constant.
</p>


<h3>Value</h3>

<p>An object of class <code>ratetable</code>.
</p>


<h3>References</h3>

<p>Package. Pohar M., Stare J. (2006) &quot;Relative survival analysis
in R.&quot; Computer Methods and Programs in Biomedicine, <b>81</b>: 272&ndash;278
</p>
<p>Relative survival: Pohar, M., Stare, J. (2007) &quot;Making relative survival
analysis relatively easy.&quot; Computers in biology and medicine, <b>37</b>:
1741&ndash;1749.
</p>


<h3>See Also</h3>

<p><code><a href="survival.html#topic+ratetable">ratetable</a></code>, <code><a href="#topic+transrate.hmd">transrate.hmd</a></code>,
<code><a href="#topic+joinrate">joinrate</a></code>, <code><a href="#topic+transrate">transrate</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
finpop &lt;- transrate.hld(c("FIN_1981-85.txt","FIN_1986-90.txt","FIN_1991-95.txt"))

## End(Not run)
## Not run: 
nzpop &lt;- transrate.hld(c("NZL_1980-82_Non-maori.txt","NZL_1985-87_Non-maori.txt",
	 "NZL_1980-82_Maori.txt","NZL_1985-87_Maori.txt"),
	 cut.year=c(1980,1985),race=rep(c("nonmaori","maori"),each=2))

## End(Not run)

</code></pre>

<hr>
<h2 id='transrate.hmd'>Reorganize Data obtained from Human Mortality Database into a Ratetable
Object</h2><span id='topic+transrate.hmd'></span>

<h3>Description</h3>

<p>The function assists in reorganizing the .txt files obtained from Human
Mortality Database (http://www.mortality.org) into a ratetable object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>transrate.hmd(male, female)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="transrate.hmd_+3A_male">male</code></td>
<td>
<p>a .txt file, containing the data on males.</p>
</td></tr>
<tr><td><code id="transrate.hmd_+3A_female">female</code></td>
<td>
<p>a .txt file, containing the data on females.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function works automatically with tables organised in the format
provided by the Human Mortality Database. Download Life Tables for Males and
Females separately from the column named 1x1 (period life tables, organized
by date of death, yearly cutpoints for age as well as calendar year).
</p>
<p>If you wish to provide the data in the required format by yourself, note
that the only two columns needed are calendar year (Year) and probability of
death (qx). Death probabilities must be calculated up to age 110 (in yearly
intervals).
</p>


<h3>Value</h3>

<p>An object of class <code>ratetable</code>.
</p>


<h3>References</h3>

<p>Package. Pohar M., Stare J. (2006) &quot;Relative survival analysis
in R.&quot; Computer Methods and Programs in Biomedicine, <b>81</b>: 272&ndash;278
</p>
<p>Relative survival: Pohar, M., Stare, J. (2007) &quot;Making relative survival
analysis relatively easy.&quot; Computers in biology and medicine, <b>37</b>:
1741&ndash;1749.
</p>


<h3>See Also</h3>

<p><code><a href="survival.html#topic+ratetable">ratetable</a></code>, <code><a href="#topic+transrate.hld">transrate.hld</a></code>,
<code><a href="#topic+joinrate">joinrate</a></code>, <code><a href="#topic+transrate">transrate</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
auspop &lt;- transrate.hmd("mltper_1x1.txt","fltper_1x1.txt")

## End(Not run)

</code></pre>

<hr>
<h2 id='years'>Compute one of the life years measures</h2><span id='topic+years'></span>

<h3>Description</h3>

<p>Provides an estimate for one of the following measures: years lost (Andersen, 2013), years lost/saved (Andersen, 2017), or
life years difference (Manevski, Ruzic Gorenjec, Andersen, Pohar Perme, 2022).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>years(
  formula = formula(data),
  data,
  measure = c("yd", "yl2017", "yl2013"),
  ratetable = relsurv::slopop,
  rmap,
  var.estimator = c("none", "bootstrap", "greenwood"),
  B = 100,
  precision = 30,
  add.times,
  na.action = stats::na.omit,
  conf.int = 0.95,
  timefix = FALSE,
  is.boot = FALSE,
  first.boot = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="years_+3A_formula">formula</code></td>
<td>
<p>a formula object, with the response as a <code>Surv</code> object
on the left of a <code>~</code> operator, and, <code>~1</code> specified on the right.
</p>
<p>NOTE: The follow-up time must be in days.</p>
</td></tr>
<tr><td><code id="years_+3A_data">data</code></td>
<td>
<p>a data.frame in which to interpret the variables named in the
<code>formula</code>.</p>
</td></tr>
<tr><td><code id="years_+3A_measure">measure</code></td>
<td>
<p>choose which measure is used: 'yd' (life years difference; Manevski, Ruzic Gorenjec, Andersen, Pohar Perme, 2022), 'yl2017' (years lost/saved; Andersen 2017),
'yl2013' (years lost/saved; Andersen 2013).</p>
</td></tr>
<tr><td><code id="years_+3A_ratetable">ratetable</code></td>
<td>
<p>a table of event rates, organized as a <code>ratetable</code>
object, such as <code>slopop</code>.</p>
</td></tr>
<tr><td><code id="years_+3A_rmap">rmap</code></td>
<td>
<p>an optional list to be used if the variables are not organized
and named in the same way as in the <code>ratetable</code> object. See details
below.</p>
</td></tr>
<tr><td><code id="years_+3A_var.estimator">var.estimator</code></td>
<td>
<p>Choose the estimator for the variance ('none', 'bootstrap', 'greenwood'). Default is 'none'.
The 'greenwood' option is possible only for <code>measure='yd'</code>.</p>
</td></tr>
<tr><td><code id="years_+3A_b">B</code></td>
<td>
<p>if <code>var.estimator</code> is 'bootstrap'. The number of bootstrap replications. Default is 100.</p>
</td></tr>
<tr><td><code id="years_+3A_precision">precision</code></td>
<td>
<p>precision for numerical integration of the population curve. Default is 30 (days).
The value may be decreased to get a
higher precision or increased to achieve a faster calculation.</p>
</td></tr>
<tr><td><code id="years_+3A_add.times">add.times</code></td>
<td>
<p>specific times at which the curves should be reported.</p>
</td></tr>
<tr><td><code id="years_+3A_na.action">na.action</code></td>
<td>
<p>a missing-data filter function. Default is <code>na.omit</code>.</p>
</td></tr>
<tr><td><code id="years_+3A_conf.int">conf.int</code></td>
<td>
<p>the confidence level for a two-sided confidence interval. Default is 0.95.</p>
</td></tr>
<tr><td><code id="years_+3A_timefix">timefix</code></td>
<td>
<p>the timefix argument in survival::survfit.formula. Default is FALSE.</p>
</td></tr>
<tr><td><code id="years_+3A_is.boot">is.boot</code></td>
<td>
<p>if TRUE, the function <code>years</code> has been called during a bootstrap replication.</p>
</td></tr>
<tr><td><code id="years_+3A_first.boot">first.boot</code></td>
<td>
<p>if TRUE, this is the first bootstrap replication.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The life years difference (<code>measure='yd'</code>) is taken by default. If other
measures are of interest, use the <code>measure</code> argument.
</p>
<p>The follow-up time must be specified in days. The <code>ratetable</code>
being used may have different variable names and formats than the user's
data set, this is dealt with the <code>rmap</code> argument. For example, if
age is in years in the data but in days in the <code>ratetable</code> object,
age=age*365.241 should be used. The calendar year can be in any date format
(date, Date and POSIXt are allowed), the date formats in the
<code>ratetable</code> and in the data may differ.
</p>
<p>Numerical integration is performed, argument
precision is set with argument <code>precision</code>, which defaults to 30-day
intervals for intergration. For higher accuracy take a smaller value (e.g. precision=1 makes
the integration on a daily basis).
</p>
<p>The observed curves are reported at event and censoring times. The
population curves are reported at all times used for the numerical integration.
Note that for the years lost (Andersen, 2013) measure, only the excess absolute risk is reported.
</p>


<h3>Value</h3>

<p>A list containing the years measure, the observed and population curves (or the excess curve for Andersen 2013).
The values are given as separate data.frames through time. Times are given in days, all areas are given in years.
For <code>measure='yl2017'</code> values are reported only at the last time point.
Functions <code>plot_f</code> and <code>plot_years</code> can be then used for plotting.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot_f">plot_f</a></code>, <code><a href="#topic+plot_years">plot_years</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(relsurv)
# Estimate the life years difference for the rdata dataset.
mod &lt;- years(Surv(time, cens)~1, data=rdata, measure='yd', ratetable=slopop,
             rmap=list(age=age*365.241), var.estimator = 'none')
# Plot the absolute risk (observed and population curve):
plot_f(mod)
# Plot the life years difference estimate:
plot_years(mod, conf.int=FALSE)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
