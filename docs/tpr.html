<!DOCTYPE html><html lang="en"><head><title>Help for package tpr</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {tpr}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#tpr-package'>
<p>Temporal Process Regression</p></a></li>
<li><a href='#ci.plot'><p> Confidence Interval Plot</p></a></li>
<li><a href='#dnase'><p> rhDNase Data</p></a></li>
<li><a href='#tpr'><p> Temporal Process Regression</p></a></li>
<li><a href='#tpr.pfit'><p> Constant fit of coefficients in a TPR model</p></a></li>
<li><a href='#tpr.test'><p> Significance and Goodness-of-fit Test of TPR</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Temporal Process Regression</td>
</tr>
<tr>
<td>Version:</td>
<td>0.3-3</td>
</tr>
<tr>
<td>Author:</td>
<td>Jun Yan &lt;jun.yan@uconn.edu&gt;</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jun Yan &lt;jun.yan@uconn.edu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Regression models for temporal process responses with
        time-varying coefficient.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.0), stats, lgtdl</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-10-17 00:50:48 UTC; junyan</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-10-17 07:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='tpr-package'>
Temporal Process Regression
</h2><span id='topic+tpr-package'></span>

<h3>Description</h3>

<p>Fit regression models for temporal process responses
with time-varying and time-independent coefficients.
</p>


<h3>Details</h3>

<p>An overview of how to use the package, including the most important
functions
</p>


<h3>Author(s)</h3>

<p>Jun Yan &lt;jun.yan@uconn.edu&gt;
</p>


<h3>References</h3>

<p>Fine, Yan, and Kosorok (2004): Temporal Process Regression. Biometrika.
</p>

<hr>
<h2 id='ci.plot'> Confidence Interval Plot </h2><span id='topic+ci.plot'></span>

<h3>Description</h3>

<p>Plotting time-varying coefficient with pointwise confidence.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ci.plot(x, y, se, level = 0.95, ylim = NULL, newplot = TRUE,
        fun = gaussian()$linkinv, dfun = gaussian()$mu.eta, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ci.plot_+3A_x">x</code></td>
<td>
<p> the x coordinate </p>
</td></tr>
<tr><td><code id="ci.plot_+3A_y">y</code></td>
<td>
<p> the y coordinate </p>
</td></tr>
<tr><td><code id="ci.plot_+3A_se">se</code></td>
<td>
<p> the standard error of y </p>
</td></tr>
<tr><td><code id="ci.plot_+3A_level">level</code></td>
<td>
<p> confidence level </p>
</td></tr>
<tr><td><code id="ci.plot_+3A_ylim">ylim</code></td>
<td>
<p> the range of y axis </p>
</td></tr>
<tr><td><code id="ci.plot_+3A_newplot">newplot</code></td>
<td>
<p> if TRUE, draw a new plot </p>
</td></tr>
<tr><td><code id="ci.plot_+3A_fun">fun</code></td>
<td>
<p> a transform function </p>
</td></tr>
<tr><td><code id="ci.plot_+3A_dfun">dfun</code></td>
<td>
<p> the derivative of the tranform function </p>
</td></tr>
<tr><td><code id="ci.plot_+3A_...">...</code></td>
<td>
<p> arguments to be passed to plot </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Jun Yan <a href="mailto:jun.yan@uconn.edu">jun.yan@uconn.edu</a> </p>

<hr>
<h2 id='dnase'> rhDNase Data </h2><span id='topic+dnase'></span>

<h3>Description</h3>

<p>Randomized trial of rhDNase for treatment of cystic fibrosis
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(dnase)</code></pre>


<h3>Format</h3>

<p>A data frame with 767 observations on the following 6 variables.
</p>

<dl>
<dt><code>id</code></dt><dd><p>subject id</p>
</dd>
<dt><code>rx</code></dt><dd><p>treatment arm: 0 = placebo, 1 = rhDNase</p>
</dd>
<dt><code>fev</code></dt><dd><p>forced expirotary volume, a measure of lung capacity</p>
</dd>
<dt><code>futime</code></dt><dd><p>follow time</p>
</dd>
<dt><code>iv1</code></dt><dd><p>IV start time</p>
</dd>
<dt><code>iv2</code></dt><dd><p>IV stop time</p>
</dd>
</dl>



<h3>Details</h3>

<p>During an exacerbation, patients received intravenous (IV) 
antibiotics and were considered unsusceptible until seven
exacerbation-free days beyond the end of IV therapy.
</p>
<p>A few subjects were infected at the time of enrollment,
for instance a subject has a first infection interval of
-21 to 7. We do not count this first infection as an &quot;event&quot;,
and the subject first enters the risk set at day 7.
</p>


<h3>Source</h3>

<p>Therneau and Grambsch (2000). Modeling Survival Data: Extending the
Cox model. Springer. 
http://www.mayo.edu/hsr/people/therneau/book/data/dnase.html
</p>


<h3>References</h3>

<p>Yan and Fine (2008). Analysis of Episodic Data with Application to
Recurrent Pulmonary Exacerbations in Cystic Fibrosis Patients. JASA.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## This example steps through how to set up for the tpr function.
## Three objects are needed:
##     1) response process (an object of "lgtdl")
##     2) data availability process (an object of "lgtdl")
##     3) a time-independent covariate matrix

data(dnase)

## extracting the unique id and subject level information
dat &lt;- unique(dnase[,c("id", "futime", "fev", "rx")])

## construct temporal process response for recurrent enent
rec &lt;- lapply(split(dnase[,c("id", "iv1", "futime")], dnase$id),
              function(x) {
                v &lt;- x$iv1
                maxfu &lt;- max(x$futime)
                ## iv1 may be negative!!!
                if (is.na(v[1])) c(0, maxfu + 1.0)
                else if (v[1] &lt; 0) c(v[1] - 1, v[!is.na(v)], maxfu + 1.0)
                else c(0, v[!is.na(v)], maxfu + 1.0)
              })

yrec &lt;- lapply(rec,
               function(x) {
                 dat &lt;- data.frame(time=x, cov=1:length(x)-1)
                 len &lt;- length(x)
                 dat$cov[len] &lt;- dat$cov[len - 1]
                 as.lgtdl(dat)
               })

## construct temporal process response for accumulative days exacerbation
do1.acc &lt;- function(x) {
  gap &lt;- x$iv2 - x$iv1 + 1
  if (all(is.na(gap))) yy &lt;- tt &lt;- NULL
  else {
    gap &lt;- na.omit(gap)
    yy &lt;- cumsum(rep(1, sum(gap)))
    tt &lt;- unlist(sapply(1:length(gap), function(i)
                        seq(x$iv1[i], x$iv2[i], by=1.0)))
  }
  yy &lt;- c(0, yy, rev(yy)[1])
  if (!is.null(tt[1]) &amp;&amp; tt[1] &lt; 0)
    tt &lt;- c(tt[1] - 1, tt, max(x$futime) + 1.0)
  else tt &lt;- c(0, tt, max(x$futime) + 1.0)
  as.lgtdl(data.frame(time=tt, cov=yy))
}

yacc &lt;- lapply(split(dnase[,c("id", "iv1", "iv2", "futime")], dnase$id),
              do1.acc)

## construct data availability (or at risk) indicator process
tu &lt;- max(dat$futime) + 0.001
rt &lt;- lapply(1:nrow(dat),
             function(i) {
               x &lt;- dat[i, "futime"]
               time &lt;- c(0, x, tu)
               cov &lt;- c(1, 0, 0)
               as.lgtdl(data.frame(time=time, cov=cov))
             })

## time-independent covariate matrix
xmat &lt;- model.matrix(~ rx + fev, data=dat)
## time-window in days
tlim &lt;- c(10, 168)
good &lt;- unlist(lapply(yrec, function(x) x$time[1] == 0))


## fully functional temporal process regression

## for recurrent event
m.rec &lt;- tpr(yrec, rt, xmat[,1:3], list(), xmat[,-(1:3),drop=FALSE], list(),
             tis=10:160, w = rep(1, 151), family = poisson(),
             evstr = list(link = 5, v = 3))
par(mfrow=c(1,3), mgp=c(2,1,0), mar=c(4,2,1,0), oma=c(0,2,0,0))
for(i in 1:3) ci.plot(m.rec$tis, m.rec$alpha[,i], sqrt(m.rec$valpha[,i]))
## hypothesis test of significance
## integral test, covariate index 2 and 3
sig.test.int.ff(m.rec, idx=2:3, ncut=2)
sig.test.boots.ff(m.rec, idx=2:3, nsim=1000)
## constant fit
cfit &lt;- cst.fit.ff(m.rec, idx=2:3)

## goodness-of-fit test for constant fit
gof.test.int.ff(m.rec, idx=2:3, ncut=2)
gof.test.boots.ff(m.rec, idx=2:3, nsim=1000)




## for cumulative days in exacerbation
m.acc &lt;- tpr(yacc, rt, xmat[,1:3], list(), xmat[,-(1:3),drop=FALSE], list(),
             tis=10:160, w = rep(1, 151), family = gaussian(),
             evstr = list(link = 1, v = 1))
par(mfrow=c(1,3), mgp=c(2,1,0), mar=c(4,2,1,0), oma=c(0,2,0,0))
for(i in 1:3) ci.plot(m.acc$tis, m.acc$alpha[,i], sqrt(m.acc$valpha[,i]))
</code></pre>

<hr>
<h2 id='tpr'> Temporal Process Regression </h2><span id='topic+tpr'></span>

<h3>Description</h3>

<p>Regression for temporal process responses and time-independent
covariate. Some covariates have time-varying coefficients while others
have time-independent coefficients.  
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tpr(y, delta, x, xtv=list(), z, ztv=list(), w, tis,
    family = poisson(),
    evstr = list(link = 5, v = 3),
    alpha = NULL, theta = NULL,
    tidx = 1:length(tis),
    kernstr = list(kern=1, poly=1, band=range(tis)/50),
    control = list(maxit=25, tol=0.0001, smooth=0, intsmooth=0))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tpr_+3A_y">y</code></td>
<td>
<p> Response, a list of &quot;lgtdl&quot; objects. </p>
</td></tr>
<tr><td><code id="tpr_+3A_delta">delta</code></td>
<td>
<p> Data availability indicator, a list of &quot;lgtdl&quot; objects.</p>
</td></tr>
<tr><td><code id="tpr_+3A_x">x</code></td>
<td>
<p> Covariate matrix for time-varying coefficients.</p>
</td></tr>
<tr><td><code id="tpr_+3A_xtv">xtv</code></td>
<td>
<p> A list of list of &quot;lgtdl&quot; for time-varying covariates with
time-varying coefficients.</p>
</td></tr>
<tr><td><code id="tpr_+3A_z">z</code></td>
<td>
<p> NOT READY YET; Covariate matrix for time-independent coefficients.</p>
</td></tr>
<tr><td><code id="tpr_+3A_ztv">ztv</code></td>
<td>
<p> NOT READY YET; A list of list of &quot;lgtdl&quot; for time-varying
covariates with time-independent coefficients.</p>
</td></tr>
<tr><td><code id="tpr_+3A_w">w</code></td>
<td>
<p> Weight vector with the same length of <code>tis</code>. </p>
</td></tr>
<tr><td><code id="tpr_+3A_tis">tis</code></td>
<td>
<p> A vector of time points at which the model is to be fitted.</p>
</td></tr>
<tr><td><code id="tpr_+3A_family">family</code></td>
<td>
<p> Specification of the response distribution; see
<code>family</code> for <code>glm</code>; this argument is used in getting
initial estimates.</p>
</td></tr>
<tr><td><code id="tpr_+3A_evstr">evstr</code></td>
<td>
<p> A list of two named components, link function and
variance function.
link: 1 = identity, 2 = logit, 3 = probit, 4 = cloglog, 5 = log;
v: 1 = gaussian, 2 = binomial, 3 = poisson
</p>
</td></tr>
<tr><td><code id="tpr_+3A_alpha">alpha</code></td>
<td>
<p> A matrix supplying initial values of alpha. </p>
</td></tr>
<tr><td><code id="tpr_+3A_theta">theta</code></td>
<td>
<p> A numeric vector supplying initial values of theta. </p>
</td></tr>
<tr><td><code id="tpr_+3A_tidx">tidx</code></td>
<td>
<p> indices for time points used to get initial values. </p>
</td></tr>
<tr><td><code id="tpr_+3A_kernstr">kernstr</code></td>
<td>
<p> A list of two names components:
kern: 1 = Epanechnikov, 2 = triangular, 0 = uniform;
band: bandwidth
</p>
</td></tr>
<tr><td><code id="tpr_+3A_control">control</code></td>
<td>
<p> A list of named components:
maxit: maximum number of iterations;
tol: tolerance level of iterations.
smooth: 1 = smoothing; 0 = no smoothing.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This rapper function can be made more user-friendly in the future. For
example, <code>evstr</code> can be determined from the <code>family</code> argument.
</p>


<h3>Value</h3>

<p>An object of class &quot;tpr&quot;:
</p>
<table role = "presentation">
<tr><td><code>tis</code></td>
<td>
<p>same as the input argument</p>
</td></tr>
<tr><td><code>alpha</code></td>
<td>
<p>estimate of time-varying coefficients</p>
</td></tr>
<tr><td><code>beta</code></td>
<td>
<p>estimate of time-independent coefficients</p>
</td></tr>
<tr><td><code>valpha</code></td>
<td>
<p>a matrix of variance of alpha at tis</p>
</td></tr>
<tr><td><code>vbeta</code></td>
<td>
<p>a matrix of variance of beta at tis</p>
</td></tr>
<tr><td><code>niter</code></td>
<td>
<p>the number of iterations used</p>
</td></tr>
<tr><td><code>infAlpha</code></td>
<td>
<p>a list of influence functions for alpha</p>
</td></tr>
<tr><td><code>infBeta</code></td>
<td>
<p>a matrix of influence functions for beta</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p> Jun Yan &lt;jun.yan@uconn.edu&gt; </p>


<h3>References</h3>

<p>Fine, Yan, and Kosorok (2004). Temporal Process
Regression. Biometrika.
</p>
<p>Yan and Huang (2009). Partly Functional Temporal Process Regression
with Semiparametric Profile Estimating Functions. Biometrics.
</p>

<hr>
<h2 id='tpr.pfit'> Constant fit of coefficients in a TPR model </h2><span id='topic+cst.fit.ff'></span>

<h3>Description</h3>

<p>Weighted least square estimate of a constant model for time-varying
coefficients in a TPR model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cst.fit.ff(fit, idx)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tpr.pfit_+3A_fit">fit</code></td>
<td>
<p> a fitted object from <code>tpr</code> </p>
</td></tr>
<tr><td><code id="tpr.pfit_+3A_idx">idx</code></td>
<td>
<p> the index of the </p>
</td></tr>
</table>


<h3>Value</h3>

<p>The estimated constant fit, standard error, z-value and p-value.
</p>


<h3>Author(s)</h3>

<p> Jun Yan <a href="mailto:jun.yan@uconn.edu">jun.yan@uconn.edu</a> </p>


<h3>References</h3>

<p>Fine, Yan, and Kosorok (2004). Temporal Process Regression. Biometrika.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+tpr.test">tpr.test</a> </code>
</p>

<hr>
<h2 id='tpr.test'> Significance and Goodness-of-fit Test of TPR </h2><span id='topic+tpr.test'></span><span id='topic+sig.test.int.ff'></span><span id='topic+sig.test.boots.ff'></span><span id='topic+gof.test.int.ff'></span><span id='topic+gof.test.boots.ff'></span><span id='topic+gof.test.boots.pf'></span>

<h3>Description</h3>

<p>Two kinds of tests are provided for inference on the coefficients in a
fully functional TRP model: integral test and bootstrap test.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sig.test.int.ff(fit, chypo = 0, idx, weight = TRUE, ncut = 2)
sig.test.boots.ff(fit, chypo = 0, idx, nsim = 1000, plot = FALSE)
gof.test.int.ff(fit, cfitList = NULL, idx, weight = TRUE, ncut = 2)
gof.test.boots.ff(fit, cfitList = NULL, idx, nsim = 1000, plot = FALSE)
gof.test.boots.pf(fit1, fit2, nsim, p = NULL, q = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tpr.test_+3A_fit">fit</code></td>
<td>
<p> a fitted object from <code>tpr</code> </p>
</td></tr>
<tr><td><code id="tpr.test_+3A_chypo">chypo</code></td>
<td>
<p> hypothesized value of coefficients </p>
</td></tr>
<tr><td><code id="tpr.test_+3A_idx">idx</code></td>
<td>
<p> the index of the coefficients to be tested </p>
</td></tr>
<tr><td><code id="tpr.test_+3A_weight">weight</code></td>
<td>
<p> whether or not use inverse variation weight </p>
</td></tr>
<tr><td><code id="tpr.test_+3A_ncut">ncut</code></td>
<td>
<p> the number of cuts of the interval of interest in
integral test </p>
</td></tr>
<tr><td><code id="tpr.test_+3A_cfitlist">cfitList</code></td>
<td>
<p> a list of fitted object from <code>cst.fit.ff</code> </p>
</td></tr>
<tr><td><code id="tpr.test_+3A_nsim">nsim</code></td>
<td>
<p> the number of bootstrap samples in bootstrap test </p>
</td></tr>
<tr><td><code id="tpr.test_+3A_plot">plot</code></td>
<td>
<p> whether or not plot </p>
</td></tr>
<tr><td><code id="tpr.test_+3A_fit1">fit1</code></td>
<td>
<p> fit of H0 model (reduced) </p>
</td></tr>
<tr><td><code id="tpr.test_+3A_fit2">fit2</code></td>
<td>
<p> fit of H1 model (full) </p>
</td></tr>
<tr><td><code id="tpr.test_+3A_p">p</code></td>
<td>
<p> the index of the time-varying estimation in fit2 </p>
</td></tr>
<tr><td><code id="tpr.test_+3A_q">q</code></td>
<td>
<p> the index of the time-independent estimation in fit1 </p>
</td></tr>
</table>


<h3>Value</h3>

<p>Test statistics and their p-values.
</p>


<h3>Author(s)</h3>

<p> Jun Yan <a href="mailto:jun.yan@uconn.edu">jun.yan@uconn.edu</a> </p>


<h3>References</h3>

<p>Fine, Yan, and Kosorok (2004). Temporal Process Regression. Biometrika.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+tpr">tpr</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## see ?tpr
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
