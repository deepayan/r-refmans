<!DOCTYPE html><html><head><title>Help for package nichevol</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {nichevol}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#bin_env'><p>Helper function to prepare bin tables</p></a></li>
<li><a href='#bin_ml_rec'><p>Maximum likelihood reconstruction of ancestral character states</p></a></li>
<li><a href='#bin_par_rec'><p>Maximum parsimony reconstruction of ancestral character states</p></a></li>
<li><a href='#bin_table'><p>Bin table of environmental conditions in M and for occurrences</p></a></li>
<li><a href='#bin_tables'><p>Bin tables of environmental conditions in M and for occurrences from objects</p></a></li>
<li><a href='#bin_tables0'><p>Bin tables of environmental conditions in M and for occurrences from data</p></a></li>
<li><a href='#character_table'><p>Example of character table for six species</p></a></li>
<li><a href='#hist_evalues'><p>Histograms of environmental conditions in M and for occurrences (one species)</p></a></li>
<li><a href='#histograms_env'><p>Histograms of environmental conditions in M and for occurrences</p></a></li>
<li><a href='#m'><p>Example of accessible areas for a species</p></a></li>
<li><a href='#map_nichevol'><p>Maps of niche reconstructions and changes detected</p></a></li>
<li><a href='#niche_bars'><p>PNG bar figures to represent ecological niches of distinct taxa</p></a></li>
<li><a href='#niche_labels'><p>Labels to represent niches of tips and ancestors</p></a></li>
<li><a href='#niche_legend'><p>Legends for niche labels in phylogenetic trees</p></a></li>
<li><a href='#nichevol'><p>nichevol: Assessment of Species’ Ecological Niche Evolution Considering</p>
Uncertainty in Reconstructions</a></li>
<li><a href='#nichevol_bars'><p>PNG bar figures for representing niche evolution</p></a></li>
<li><a href='#nichevol_labels'><p>Labels to represent changes of niche characteristics between ancestors and descendants</p></a></li>
<li><a href='#nichevol_legend'><p>Legends for niche evolution labels in phylogenetic trees</p></a></li>
<li><a href='#occ_list'><p>Example of occurrence records for six species</p></a></li>
<li><a href='#par_rec_table'><p>Example of table with results from parsimony reconstructions</p></a></li>
<li><a href='#pdf_histograms'><p>Helper function to create PDF files with histograms</p></a></li>
<li><a href='#read_bin_table'><p>Read tables of binary niche characters from directory</p></a></li>
<li><a href='#rename_tips'><p>Helper function to rename tips of trees for simulations</p></a></li>
<li><a href='#score_tip'><p>Helper function to calculate the median bin score for a given species</p></a></li>
<li><a href='#score_tree'><p>Helper function to assign bin scores to every tip in a given tree</p></a></li>
<li><a href='#set_uncertainty'><p>Set values of uncertainty towards one or both ends of the variable</p></a></li>
<li><a href='#sig_sq'><p>Helper function to get sigma squared values for a given dataset</p></a></li>
<li><a href='#smooth_rec'><p>Smooth character table values resulted from ancestral character state reconstructions</p></a></li>
<li><a href='#stats_eval'><p>Statistics of environmental conditions in M and for occurrences (one variable)</p></a></li>
<li><a href='#stats_evalues'><p>Statistics of environmental conditions in M and for occurrences (multiple variables)</p></a></li>
<li><a href='#temp'><p>Example of an environmental variable used in analysis</p></a></li>
<li><a href='#tree'><p>Example of a phylogenetic tree for six species</p></a></li>
<li><a href='#tree_data'><p>Example of a list containing a tree and a table of characters for six species</p></a></li>
<li><a href='#tree5'><p>Example of a phylogenetic tree for five species</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Tools for Ecological Niche Evolution Assessment Considering
Uncertainty</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.20</td>
</tr>
<tr>
<td>Author:</td>
<td>Marlon E. Cobos [aut, cre],
  Hannah L. Owens [aut],
  A. Townsend Peterson [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Marlon E. Cobos &lt;manubio13@gmail.com&gt;</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-03-09</td>
</tr>
<tr>
<td>Description:</td>
<td>A collection of tools that allow users to perform critical steps 
    in the process of assessing ecological niche evolution over phylogenies, with
    uncertainty incorporated explicitly in reconstructions. The method proposed
    here for ancestral reconstruction of ecological niches characterizes species'
    niches using a bin-based approach that incorporates uncertainty in estimations.
    Compared to other existing methods, the approaches presented here reduce risk
    of overestimation of amounts and rates of ecological niche evolution. The
    main analyses include: initial exploration of environmental data in occurrence
    records and accessible areas, preparation of data for phylogenetic analyses,
    executing comparative phylogenetic analyses of ecological niches, and plotting
    for interpretations. Details on the theoretical background and methods used 
    can be found in: Owens et al. (2020) &lt;<a href="https://doi.org/10.1002%2Fece3.6359">doi:10.1002/ece3.6359</a>&gt;,
    Peterson et al. (1999) &lt;<a href="https://doi.org/10.1126%2Fscience.285.5431.1265">doi:10.1126/science.285.5431.1265</a>&gt;,
    Soberón and Peterson (2005) &lt;<a href="https://doi.org/10.17161%2Fbi.v2i0.4">doi:10.17161/bi.v2i0.4</a>&gt;,
    Peterson (2011) &lt;<a href="https://doi.org/10.1111%2Fj.1365-2699.2010.02456.x">doi:10.1111/j.1365-2699.2010.02456.x</a>&gt;,
    Barve et al. (2011) &lt;<a href="https://doi.org/10.1111%2Fecog.02671">doi:10.1111/ecog.02671</a>&gt;, 
    Machado-Stredel et al. (2021) &lt;<a href="https://doi.org/10.21425%2FF5FBG48814">doi:10.21425/F5FBG48814</a>&gt;,
    Owens et al. (2013) &lt;<a href="https://doi.org/10.1016%2Fj.ecolmodel.2013.04.011">doi:10.1016/j.ecolmodel.2013.04.011</a>&gt;, 
    Saupe et al. (2018) &lt;<a href="https://doi.org/10.1093%2Fsysbio%2Fsyx084">doi:10.1093/sysbio/syx084</a>&gt;, and 
    Cobos et al. (2021) &lt;<a href="https://doi.org/10.1111%2Fjav.02868">doi:10.1111/jav.02868</a>&gt;.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/marlonecobos/nichevol">https://github.com/marlonecobos/nichevol</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/marlonecobos/nichevol/issues">https://github.com/marlonecobos/nichevol/issues</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>castor (&ge; 1.4), geiger (&ge; 2.0), graphics (&ge; 3.6), grDevices
(&ge; 3.6), stringr (&ge; 1.4), stats (&ge; 3.6), terra (&ge; 1.6),
utils (&ge; 3.6)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr(&ge; 1.25), phytools (&ge; 0.6)</td>
</tr>
<tr>
<td>Depends:</td>
<td>ape (&ge; 5.3), R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-03-10 19:28:24 UTC; marlon</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-03-10 23:20:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='bin_env'>Helper function to prepare bin tables</h2><span id='topic+bin_env'></span>

<h3>Description</h3>

<p>Helper function to prepare bin tables
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bin_env(overall_range, M_range, sp_range, bin_size)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bin_env_+3A_overall_range">overall_range</code></td>
<td>
<p>(numeric) minimum and maximum values of all species and
Ms to be analyzed.</p>
</td></tr>
<tr><td><code id="bin_env_+3A_m_range">M_range</code></td>
<td>
<p>matrix of ranges of environmental values in M for all species.
Columns must be minimum and maximum, and rows correspond to species.</p>
</td></tr>
<tr><td><code id="bin_env_+3A_sp_range">sp_range</code></td>
<td>
<p>matrix of ranges of environmental values in occurrences
for all species. Columns must be minimum and maximum, and rows correspond to
species.</p>
</td></tr>
<tr><td><code id="bin_env_+3A_bin_size">bin_size</code></td>
<td>
<p>(numeric) size of bins. Range of environmental values to
be considered when creating each character in bin tables. See details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The argument <code>bin_size</code> helps to create characters that represent not
only one value of an environmental variable, but a range of environmental
conditions. For instance, if a variable of precipitation in mm is used, a
value of 10 for <code>bin_size</code> indicates that each character will represent
a class that correspond to 10 continuous values of precipitation (e.g., from
100 to 110 mm).
</p>


<h3>Value</h3>

<p>A character matrix (table of characters) containing bins for a given variable
and for all species considered. See more details in <code><a href="#topic+bin_tables">bin_tables</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># example
o_range &lt;- c(1, 25)
m_range &lt;- rbind(c(5, 15), c(10, 23), c(4, 20))
s_range &lt;- rbind(c(7, 15), c(12, 21), c(3, 18))

# bin preparation
bins &lt;- bin_env(overall_range = o_range, M_range = m_range,
                sp_range = s_range, bin_size = 1)
</code></pre>

<hr>
<h2 id='bin_ml_rec'>Maximum likelihood reconstruction of ancestral character states</h2><span id='topic+bin_ml_rec'></span>

<h3>Description</h3>

<p>Maximum likelihood reconstruction of ancestral character states
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bin_ml_rec(tree_data, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bin_ml_rec_+3A_tree_data">tree_data</code></td>
<td>
<p>a list of two elements (phy and data) resulting from using the
function <code><a href="geiger.html#topic+treedata">treedata</a></code>.</p>
</td></tr>
<tr><td><code id="bin_ml_rec_+3A_...">...</code></td>
<td>
<p>other arguments from <code><a href="ape.html#topic+ace">ace</a></code>. Arguments <code>x</code>,
<code>phy</code>, <code>type</code>, and <code>method</code> are fixed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Reconstructions are done using the function <code><a href="ape.html#topic+ace">ace</a></code> from the
<code>ape</code> package. The argument method is set as &quot;ML&quot; and the type
of variable is &quot;discrete&quot;.
</p>


<h3>Value</h3>

<p>A table with columns representing bins, rows representing first tip
states and then reconstructed nodes.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># a simple tree
data("tree5", package = "nichevol")

# a matrix of niche charactes (1 = present, 0 = absent, ? = unknown)
dataTable &lt;- cbind("241" = rep("1", length(tree5$tip.label)),
                   "242" = rep("1", length(tree5$tip.label)),
                   "243" = c("1", "1", "0", "0", "0"),
                   "244" = c("1", "1", "0", "0", "0"),
                   "245" = c("1", "?", "0", "0", "0"))
rownames(dataTable) &lt;- tree5$tip.label

# list with two objects (tree and character table)
treeWdata &lt;- geiger::treedata(tree5, dataTable)

# Maximum likelihood reconstruction
ml_rec &lt;- bin_ml_rec(treeWdata)
</code></pre>

<hr>
<h2 id='bin_par_rec'>Maximum parsimony reconstruction of ancestral character states</h2><span id='topic+bin_par_rec'></span>

<h3>Description</h3>

<p>Maximum parsimony reconstruction of ancestral character states
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bin_par_rec(tree_data, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bin_par_rec_+3A_tree_data">tree_data</code></td>
<td>
<p>a list of two elements (phy and data) resulting from using
the function <code><a href="geiger.html#topic+treedata">treedata</a></code>.</p>
</td></tr>
<tr><td><code id="bin_par_rec_+3A_...">...</code></td>
<td>
<p>other arguments from <code><a href="castor.html#topic+asr_max_parsimony">asr_max_parsimony</a></code>.
Arguments <code>tree</code> and <code>tip_states</code> are fixed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Reconstructions are done using the <code><a href="castor.html#topic+asr_max_parsimony">asr_max_parsimony</a></code>
function from the <code>castor</code> package.
</p>


<h3>Value</h3>

<p>A table with columns representing bins, rows representing first tip
states and then reconstructed nodes.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># a simple tree
data("tree5", package = "nichevol")

# a matrix of niche charactes (1 = present, 0 = absent, ? = unknown)
dataTable &lt;- cbind("241" = rep("1", length(tree5$tip.label)),
                   "242" = rep("1", length(tree5$tip.label)),
                   "243" = c("1", "1", "0", "0", "0"),
                   "244" = c("1", "1", "0", "0", "0"),
                   "245" = c("1", "?", "0", "0", "0"))
rownames(dataTable) &lt;- tree5$tip.label

# list with two objects (tree and character table)
treeWdata &lt;- geiger::treedata(tree5, dataTable)

# Maximum parsimony reconstruction
par_rec &lt;- bin_par_rec(treeWdata)
</code></pre>

<hr>
<h2 id='bin_table'>Bin table of environmental conditions in M and for occurrences</h2><span id='topic+bin_table'></span>

<h3>Description</h3>

<p>bin_table helps in creating a bin table of environmental
conditions in accessible areas (M) and for species occurrence records
(i.e., table of characters).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bin_table(Ms, occurrences, species, longitude, latitude, variable,
          percentage_out = 5, n_bins = 20, bin_size, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bin_table_+3A_ms">Ms</code></td>
<td>
<p>a list of SpatVector objects representing the accessible area
(M) for all species to be analyzed. The order of species represented by each
object here must coincide with the one in <code>occurrences</code>. See details.</p>
</td></tr>
<tr><td><code id="bin_table_+3A_occurrences">occurrences</code></td>
<td>
<p>a list of data.frames of occurrence records for all species.
The order of species represented by each data.frame must coincide with the one
in <code>Ms</code>. See details.</p>
</td></tr>
<tr><td><code id="bin_table_+3A_species">species</code></td>
<td>
<p>(character) name of the column in occurrence data.frames that
contains the name of the species.</p>
</td></tr>
<tr><td><code id="bin_table_+3A_longitude">longitude</code></td>
<td>
<p>(character) name of the column in occurrence files containing
values of longitude.</p>
</td></tr>
<tr><td><code id="bin_table_+3A_latitude">latitude</code></td>
<td>
<p>(character) name of the column in occurrence files containing
values of latitude.</p>
</td></tr>
<tr><td><code id="bin_table_+3A_variable">variable</code></td>
<td>
<p>a single SpatRaster layer representing an environmental
variable of interest. See details.</p>
</td></tr>
<tr><td><code id="bin_table_+3A_percentage_out">percentage_out</code></td>
<td>
<p>(numeric) percentage of extreme environmental data in M
to be excluded in bin creation for further analyses. See details. Default = 5.</p>
</td></tr>
<tr><td><code id="bin_table_+3A_n_bins">n_bins</code></td>
<td>
<p>(numeric) number of bins to be created from the range of
environmental values considered when creating each character in bin tables.
Default = 20. See details.</p>
</td></tr>
<tr><td><code id="bin_table_+3A_bin_size">bin_size</code></td>
<td>
<p>(numeric) argument deprecated, use n_bins instead.</p>
</td></tr>
<tr><td><code id="bin_table_+3A_verbose">verbose</code></td>
<td>
<p>(logical) whether messages should be printed. Default = TRUE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Coordinates in <code>occurrences</code>, SpatVector objects in <code>Ms</code>, and
SpatRaster in <code>variable</code> must coincide in the geographic projection in
which they are represented. WGS84 with no planar projection is recommended.
</p>
<p>Accessible area (M) is understood as the geographic area that has been
accessible for a species for relevant periods of time. Defining M is usually
a hard task, but also a very important one, because it allows identifying
uncertainties about the ability of a species to maintain populations in
certain environmental conditions. For further details on this topic, see
Barve et al. (2011) <a href="doi:10.1016/j.ecolmodel.2011.02.011">doi:10.1016/j.ecolmodel.2011.02.011</a>
and Machado-Stredel et al. (2021) <a href="doi:10.21425/F5FBG48814">doi:10.21425/F5FBG48814</a>.
</p>
<p>The percentage to be defined in <code>percentage_out</code> excludes a percentage
of extreme environmental values to prevent from considering extremely rare
environmental values in the accessible area for the species (M). Being too
rare, these values may have never been explored by the species; therefore,
including them in the process of preparation of the table of characters
(bin table) is risky.
</p>
<p>The argument <code>n_bins</code> helps to define how many characters (bins) will be
considered for the range of values in each variable. This is, a value of 20
determines that a range of temperature (5-25) will be split approximately
every 1 degree. The argument <code>bin_size</code> has been deprecated.
</p>


<h3>Value</h3>

<p>A list containing a table of characters to represent ecological niches of the
species of interest.
</p>
<p>Potential values for characters are:
</p>

<ul>
<li><p> &quot;1&quot; = the species is present in those environmental conditions.
</p>
</li>
<li><p> &quot;0&quot; = the species is not present in those environmental conditions. This is,
those environmental conditions inside the accessible area (M) are more extreme
than the ones used for the species.
</p>
</li>
<li><p> &quot;?&quot; = there is no certainty about the species presence in those environmental
conditions. This happens in environmental combinations more extreme than the
ones found in the accessible area (M), when environmental conditions in
species records are as extreme as the most extreme ones in M.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># example data
## list of species records
data("occ_list", package = "nichevol")

## list of species accessible areas
m_files &lt;- list.files(system.file("extdata", package = "nichevol"),
                      pattern = "m\\d.gpkg", full.names = TRUE)

m_list &lt;- lapply(m_files, terra::vect)

## raster variable
temp &lt;- terra::rast(system.file("extdata", "temp.tif", package = "nichevol"))


# preparing bins
char_table &lt;- bin_table(Ms = m_list, occurrences = occ_list, species = "species",
                        longitude = "x", latitude = "y", variable = temp,
                        percentage_out = 5, n_bins = 20)
</code></pre>

<hr>
<h2 id='bin_tables'>Bin tables of environmental conditions in M and for occurrences from objects</h2><span id='topic+bin_tables'></span>

<h3>Description</h3>

<p>bin_tables helps in creating bin tables of environmental
conditions in accessible areas (M) and species occurrence records
(i.e., table of characters). This is done using results from previous
analyses, and can be applied to various species and multiple variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bin_tables(ranges, percentage_out = 5, n_bins = 20, bin_size, save = FALSE,
           output_directory, overwrite = FALSE, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bin_tables_+3A_ranges">ranges</code></td>
<td>
<p>list of ranges of environmental values in M and in species
occurrences derived from using the function <code><a href="#topic+histograms_env">histograms_env</a></code>.</p>
</td></tr>
<tr><td><code id="bin_tables_+3A_percentage_out">percentage_out</code></td>
<td>
<p>(numeric) percentage of extreme environmental data in M
to be excluded in bin creation for further analyses. See details. Default = 5.</p>
</td></tr>
<tr><td><code id="bin_tables_+3A_n_bins">n_bins</code></td>
<td>
<p>(numeric) number of bins to be created from the range of
environmental values considered when creating each character in bin tables.
Default = 20. See details.</p>
</td></tr>
<tr><td><code id="bin_tables_+3A_bin_size">bin_size</code></td>
<td>
<p>(numeric) argument deprecated, use n_bins instead.</p>
</td></tr>
<tr><td><code id="bin_tables_+3A_save">save</code></td>
<td>
<p>(logical) whether or not to save the results in working directory.
Default = FALSE.</p>
</td></tr>
<tr><td><code id="bin_tables_+3A_output_directory">output_directory</code></td>
<td>
<p>(character) name of the folder in which results will be
written.</p>
</td></tr>
<tr><td><code id="bin_tables_+3A_overwrite">overwrite</code></td>
<td>
<p>(logical) whether or not to overwrite existing results
in <code>output_directory</code>. Default = FALSE.</p>
</td></tr>
<tr><td><code id="bin_tables_+3A_verbose">verbose</code></td>
<td>
<p>(logical) whether messages should be printed. Default = TRUE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The percentage to be defined in <code>percentage_out</code> must correspond with
one of the confidence limits defined in <code><a href="#topic+histograms_env">histograms_env</a></code>
(argument <code>CL_lines</code>). For instance, if <code>CL_lines</code> = 95, then
<code>percentage_out</code> can only be either 5 (keeping data inside the 95 CL) or
0 (to avoid exclusion of extreme values in M).
</p>
<p>Excluding a certain percentage of extreme environmental values prevents the
algorithm from considering extremely rare environmental values in the
accessible area for the species (M). Being too rare, these values may have
never been explored by the species; therefore, including them in the process
of preparation of the table of characters (bin table) is risky.
</p>
<p>The argument <code>n_bins</code> helps to define how many characters (bins) will be
considered for the range of values in each variable. This is, a value of 20
determines that a range of temperature (5-25) will be split approximately
every 1 degree. The argument <code>bin_size</code> has been deprecated.
</p>


<h3>Value</h3>

<p>A list named as in <code>ranges</code> containing the table(s) of characters.
A folder named as in <code>output_directory</code> containing all resulting csv
files with the tables of characters will be created if <code>save</code> is set as
TRUE.
</p>
<p>Potential values for characters are:
</p>

<ul>
<li><p> &quot;1&quot; = the species is present in those environmental conditions.
</p>
</li>
<li><p> &quot;0&quot; = the species is not present in those environmental conditions. This is,
those environmental conditions inside the accessible area (M) are more extreme
than the ones used for the species.
</p>
</li>
<li><p> &quot;?&quot; = there is no certainty about the species presence in those environmental
conditions. This happens if environmental combinations are more extreme than
the ones found in the accessible area (M), when environmental conditions in
species records are as extreme as the most extreme ones in M.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># simple list of ranges
ranges &lt;- list(temp = data.frame(Species = c("sp1", "sp2", "sp3"),
                                 Species_lower = c(120, 56, 59.75),
                                 Species_upper = c(265, 333, 333),
                                 M_lower = c(93, 39, 56),
                                 M_upper = c(302, 333, 333),
                                 M_95_lowerCL = c(158, 91, 143),
                                 M_95_upperCL = c(292, 290, 326)),
               prec = data.frame(Species = c("sp1", "sp2", "sp3"),
                                 Species_lower = c(597, 3, 3),
                                 Species_upper = c(3492, 2673, 6171),
                                 M_lower = c(228, 3, 3),
                                 M_upper = c(6369, 7290, 6606),
                                 M_95_lowerCL = c(228, 3, 3),
                                 M_95_upperCL = c(3114, 2376, 2568)))

# bin preparation
bins &lt;- bin_tables(ranges, percentage_out = 5, n_bins = 20)

# see arguments save and output_directory to write results in local directory
</code></pre>

<hr>
<h2 id='bin_tables0'>Bin tables of environmental conditions in M and for occurrences from data</h2><span id='topic+bin_tables0'></span>

<h3>Description</h3>

<p>bin_tables0 helps in creating bin tables of environmental
conditions in accessible areas (M) and species occurrence records
(i.e., table of characters). This is done using data read directly from a
local directory, and can be applied to various species and multiple variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bin_tables0(M_folder, M_format, occ_folder, longitude,
            latitude, var_folder, var_format, round = FALSE,
            round_names, multiplication_factor = 1,
            percentage_out = 5, n_bins = 20, bin_size, save = FALSE,
            output_directory, overwrite = FALSE, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bin_tables0_+3A_m_folder">M_folder</code></td>
<td>
<p>(character) name of the folder containing files representing
the accessible area (M) for all species to be analyzed. See details.</p>
</td></tr>
<tr><td><code id="bin_tables0_+3A_m_format">M_format</code></td>
<td>
<p>format of files representing the accessible area (M) for the
species. Names of M files must match the ones for occurrence files in
<code>occ_folder</code>. Format options are: &quot;shp&quot;, &quot;gpkg&quot;, or any of the options
supported by <code><a href="terra.html#topic+rast">rast</a></code> (e.g., &quot;tif&quot; or &quot;asc&quot;).</p>
</td></tr>
<tr><td><code id="bin_tables0_+3A_occ_folder">occ_folder</code></td>
<td>
<p>(character) name of the folder containing csv files of
occurrence data for all species. Names of csv files must match the ones of M
files in <code>M_folder</code>.</p>
</td></tr>
<tr><td><code id="bin_tables0_+3A_longitude">longitude</code></td>
<td>
<p>(character) name of the column in occurrence files containing
values of longitude.</p>
</td></tr>
<tr><td><code id="bin_tables0_+3A_latitude">latitude</code></td>
<td>
<p>(character) name of the column in occurrence files containing
values of latitude.</p>
</td></tr>
<tr><td><code id="bin_tables0_+3A_var_folder">var_folder</code></td>
<td>
<p>(character) name of the folder containing layers to
represent environmental variables.</p>
</td></tr>
<tr><td><code id="bin_tables0_+3A_var_format">var_format</code></td>
<td>
<p>format of layers to represent environmental variables.
Format options are all the ones supported by <code><a href="terra.html#topic+rast">rast</a></code>
(e.g., &quot;tif&quot; or &quot;asc&quot;).</p>
</td></tr>
<tr><td><code id="bin_tables0_+3A_round">round</code></td>
<td>
<p>(logical) whether or not to round the values of one or more
variables after multiplying them times the value in <code>multiplication_factor</code>.
Default = FALSE. See details.</p>
</td></tr>
<tr><td><code id="bin_tables0_+3A_round_names">round_names</code></td>
<td>
<p>(character) names of the variables to be rounded.
Default = NULL. If <code>round</code> = TRUE, names must be defined.</p>
</td></tr>
<tr><td><code id="bin_tables0_+3A_multiplication_factor">multiplication_factor</code></td>
<td>
<p>(numeric) value to be used to multiply the
variables defined in <code>round_names</code>. Default = 1.</p>
</td></tr>
<tr><td><code id="bin_tables0_+3A_percentage_out">percentage_out</code></td>
<td>
<p>(numeric) percentage of extreme environmental data in M
to be excluded in bin creation for further analyses. See details. Default = 5.</p>
</td></tr>
<tr><td><code id="bin_tables0_+3A_n_bins">n_bins</code></td>
<td>
<p>(numeric) number of bins to be created from the range of
environmental values considered when creating each character in bin tables.
Default = 20. See details.</p>
</td></tr>
<tr><td><code id="bin_tables0_+3A_bin_size">bin_size</code></td>
<td>
<p>(numeric) argument deprecated, use n_bins instead.</p>
</td></tr>
<tr><td><code id="bin_tables0_+3A_save">save</code></td>
<td>
<p>(logical) whether or not to save the results in working directory.
Default = FALSE.</p>
</td></tr>
<tr><td><code id="bin_tables0_+3A_output_directory">output_directory</code></td>
<td>
<p>(character) name of the folder in which results will be
written.</p>
</td></tr>
<tr><td><code id="bin_tables0_+3A_overwrite">overwrite</code></td>
<td>
<p>(logical) whether or not to overwrite existing results in
<code>output_directory</code>. Default = FALSE.</p>
</td></tr>
<tr><td><code id="bin_tables0_+3A_verbose">verbose</code></td>
<td>
<p>(logical) whether messages should be printed. Default = TRUE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Coordinates in csv files in <code>occ_folder</code>, SpatVector-like files in
<code>M_folder</code>, and raster layers in <code>var_folder</code> must coincide in the
geographic projection in which they are represented. WGS84 with no planar
projection is recommended.
</p>
<p>Accessible area (M) is understood as the geographic area that has been
accessible for a species for relevant periods of time. Defining M is usually
a hard task, but also a very important one, because it allows identifying
uncertainties about the ability of a species to maintain populations in
certain environmental conditions. For further details on this topic, see
Barve et al. (2011) <a href="doi:10.1016/j.ecolmodel.2011.02.011">doi:10.1016/j.ecolmodel.2011.02.011</a>
and Machado-Stredel et al. (2021) <a href="doi:10.21425/F5FBG48814">doi:10.21425/F5FBG48814</a>.
</p>
<p>Rounding variables may be useful when multiple variables are considered and
the values of some or all of them are too small (e.g., when using principal
components). To round specific variables arguments <code>round</code>,
<code>round_names</code>, and <code>multiplication_factor</code>, must be used accordingly.
</p>
<p>The percentage to be defined in <code>percentage_out</code> excludes a percentage
of extreme environmental values to prevent from considering extremely rare
environmental values in the accessible area for the species (M). Being too
rare, these values may have never been explored by the species; therefore,
including them in the process of preparation of the table of characters
(bin table) is risky.
</p>
<p>The argument <code>n_bins</code> helps to define how many characters (bins) will be
considered for the range of values in each variable. This is, a value of 20
determines that a range of temperature (5-25) will be split approximately
every 1 degree. The argument <code>bin_size</code> has been deprecated.
</p>


<h3>Value</h3>

<p>A list named as the variables present in <code>var_folder</code>, containing all
tables of characters. A folder named as in <code>output_directory</code> containing
all resultant csv files with the tables of characters will be created if
<code>save</code> is set as TRUE.
</p>
<p>Potential values for characters are:
</p>

<ul>
<li><p> &quot;1&quot; = the species is present in those environmental conditions.
</p>
</li>
<li><p> &quot;0&quot; = the species is not present in those environmental conditions. This is,
those environmental conditions inside the accessible area (M) are more extreme
than the ones used for the species.
</p>
</li>
<li><p> &quot;?&quot; = there is no certainty about the species presence in those environmental
conditions. This happens in environmental combinations more extreme than the
ones found in the accessible area (M), when environmental conditions in
species records are as extreme as the most extreme ones in M.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># preparing data and directories for example
## directories
tempdir &lt;- file.path(tempdir(), "nevol_test")
dir.create(tempdir)

cvariables &lt;- paste0(tempdir, "/variables")
dir.create(cvariables)

records &lt;- paste0(tempdir, "/records")
dir.create(records)

m_areas &lt;- paste0(tempdir, "/M_areas")
dir.create(m_areas)

## data
data("occ_list", package = "nichevol")

temp &lt;- system.file("extdata", "temp.tif", package = "nichevol")

m_files &lt;- list.files(system.file("extdata", package = "nichevol"),
                      pattern = "m\\d.gpkg", full.names = TRUE)

## writing data in temporal directories
spnames &lt;- sapply(occ_list, function (x) as.character(x[1, 1]))
ocnames &lt;-  paste0(records, "/", spnames, ".csv")

occs &lt;- lapply(1:length(spnames), function (x) {
  write.csv(occ_list[[x]], ocnames[x], row.names = FALSE)
})

to_replace &lt;- paste0(system.file("extdata", package = "nichevol"), "/")

otemp &lt;- gsub(to_replace, "", temp)
file.copy(from = temp, to = paste0(cvariables, "/", otemp))

file.copy(from = m_files, to = paste0(m_areas, "/", spnames, ".gpkg"))

# preparing tables
tabs &lt;- bin_tables0(M_folder = m_areas, M_format = "gpkg", occ_folder = records,
                    longitude = "x", latitude = "y", var_folder = cvariables,
                    var_format = "tif")
</code></pre>

<hr>
<h2 id='character_table'>Example of character table for six species</h2><span id='topic+character_table'></span>

<h3>Description</h3>

<p>A character table representing species ecological niches derived from
previous preparation processes. Each row represents a species and each column
a binary character in which one or more values of the environmental variable
are categorized as used &quot;1&quot;, non used &quot;0&quot;, or uncertain &quot;?&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>character_table
</code></pre>


<h3>Format</h3>

<p>A character matrix with 6 rows and 28 columns.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("character_table", package = "nichevol")

head(character_table)
</code></pre>

<hr>
<h2 id='hist_evalues'>Histograms of environmental conditions in M and for occurrences (one species)</h2><span id='topic+hist_evalues'></span>

<h3>Description</h3>

<p>hist_evalues helps in creating histograms to explore environmental
conditions in M, lines for the confidence limits of values in M, and the
location of values in occurrence records, for one species at the time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hist_evalues(M, occurrences, species, longitude, latitude, variable,
             CL_lines = c(95, 99), col = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hist_evalues_+3A_m">M</code></td>
<td>
<p>a SpatVector object representing the accessible area (M)
for one species. See details.</p>
</td></tr>
<tr><td><code id="hist_evalues_+3A_occurrences">occurrences</code></td>
<td>
<p>a data.frame of occurrence records for one species. See
details.</p>
</td></tr>
<tr><td><code id="hist_evalues_+3A_species">species</code></td>
<td>
<p>(character) name of the column in <code>occurrences</code> that
contains the name of the species.</p>
</td></tr>
<tr><td><code id="hist_evalues_+3A_longitude">longitude</code></td>
<td>
<p>(character) name of the column in <code>occurrences</code> containing
values of longitude.</p>
</td></tr>
<tr><td><code id="hist_evalues_+3A_latitude">latitude</code></td>
<td>
<p>(character) name of the column in <code>occurrences</code> containing
values of latitude.</p>
</td></tr>
<tr><td><code id="hist_evalues_+3A_variable">variable</code></td>
<td>
<p>a single SpatRaster layer representing an environmental
variable of interest. See details.</p>
</td></tr>
<tr><td><code id="hist_evalues_+3A_cl_lines">CL_lines</code></td>
<td>
<p>(numeric) confidence limits of environmental values in M to
be plotted as lines in the histograms. See details. Default = c(95, 99).</p>
</td></tr>
<tr><td><code id="hist_evalues_+3A_col">col</code></td>
<td>
<p>colors for lines representing confidence limits. If NULL, colors
are selected from a gray palette. Default = NULL.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Coordinates in <code>occurrences</code>, SpatVector object in <code>M</code>, and
SpatRaster in <code>variable</code> must coincide in the geographic projection in
which they are represented. WGS84 with no planar projection is recommended.
</p>
<p>The accessible area (M) is understood as the geographic area that has been
accessible to a species over relevant periods of time. Defining M is usually
a hard task, but also a very important one because it allows identifying
uncertainties about the ability of a species to maintain populations under
certain environmental conditions. For further details on this topic, see
Barve et al. (2011) <a href="doi:10.1016/j.ecolmodel.2011.02.011">doi:10.1016/j.ecolmodel.2011.02.011</a>
and Machado-Stredel et al. (2021) <a href="doi:10.21425/F5FBG48814">doi:10.21425/F5FBG48814</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># example data
## list of species records
data("occ_list", package = "nichevol")

## list of species accessible areas
m_files &lt;- list.files(system.file("extdata", package = "nichevol"),
                      pattern = "m\\d.gpkg", full.names = TRUE)

m_list &lt;- lapply(m_files, terra::vect)

## raster variable
temp &lt;- terra::rast(system.file("extdata", "temp.tif", package = "nichevol"))

# running stats
hist_evalues(M = m_list[[1]], occurrences = occ_list[[1]], species = "species",
             longitude = "x", latitude = "y", variable = temp,
             CL_lines = c(95, 99), col = c("blue", "red"))
</code></pre>

<hr>
<h2 id='histograms_env'>Histograms of environmental conditions in M and for occurrences</h2><span id='topic+histograms_env'></span>

<h3>Description</h3>

<p>histograms_env creates PDF files with histogram plots of
environmental conditions in M, lines for the confidence limits of values in
M, and the location of values in occurrence records. This is done using data
read directly from a local directory, and can be applied to various species
and multiple variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>histograms_env(M_folder, M_format, occ_folder, longitude, latitude,
               var_folder, var_format, CL_lines = c(95, 99), col = NULL,
               round = FALSE, round_names = NULL, multiplication_factor = 1,
               save_ranges = FALSE, output_directory, overwrite = FALSE,
               verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="histograms_env_+3A_m_folder">M_folder</code></td>
<td>
<p>(character) name of the folder containing files representing
the accessible area (M) for all species to be analyzed. See details.</p>
</td></tr>
<tr><td><code id="histograms_env_+3A_m_format">M_format</code></td>
<td>
<p>format of files representing the accessible area (M) for the
species. Names of M files must match the ones for occurrence files in
<code>occ_folder</code>. Format options are: &quot;shp&quot;, &quot;gpkg&quot;, or any of the options
supported by <code><a href="terra.html#topic+rast">rast</a></code> (e.g., &quot;tif&quot; or &quot;asc&quot;).</p>
</td></tr>
<tr><td><code id="histograms_env_+3A_occ_folder">occ_folder</code></td>
<td>
<p>(character) name of the folder containing csv files of
occurrence data for all species. Names of csv files must match the ones of M
files in <code>M_folder</code>.</p>
</td></tr>
<tr><td><code id="histograms_env_+3A_longitude">longitude</code></td>
<td>
<p>(character) name of the column in occurrence files containing
values of longitude.</p>
</td></tr>
<tr><td><code id="histograms_env_+3A_latitude">latitude</code></td>
<td>
<p>(character) name of the column in occurrence files containing
values of latitude.</p>
</td></tr>
<tr><td><code id="histograms_env_+3A_var_folder">var_folder</code></td>
<td>
<p>(character) name of the folder containing layers to
represent environmental variables.</p>
</td></tr>
<tr><td><code id="histograms_env_+3A_var_format">var_format</code></td>
<td>
<p>format of layers to represent environmental variables.
Format options are all the ones supported by <code><a href="terra.html#topic+rast">rast</a></code>
(e.g., &quot;tif&quot; or &quot;asc&quot;).</p>
</td></tr>
<tr><td><code id="histograms_env_+3A_cl_lines">CL_lines</code></td>
<td>
<p>(numeric) confidence limits of environmental values in M to
be plotted as lines in the histograms. See details. Default = c(95, 99).</p>
</td></tr>
<tr><td><code id="histograms_env_+3A_col">col</code></td>
<td>
<p>colors for lines representing confidence limits. If NULL, colors
are selected from a gray palette. Default = NULL.</p>
</td></tr>
<tr><td><code id="histograms_env_+3A_round">round</code></td>
<td>
<p>(logical) whether or not to round values of one or more
variables after multiplying them times the value in <code>multiplication_factor</code>.
Default = FALSE. See details.</p>
</td></tr>
<tr><td><code id="histograms_env_+3A_round_names">round_names</code></td>
<td>
<p>(character) names of the variables to be rounded.
Default = NULL. If <code>round</code> = TRUE, names must be defined.</p>
</td></tr>
<tr><td><code id="histograms_env_+3A_multiplication_factor">multiplication_factor</code></td>
<td>
<p>(numeric) value to be used to multiply the
variables defined in <code>round_names</code>. Default = 1.</p>
</td></tr>
<tr><td><code id="histograms_env_+3A_save_ranges">save_ranges</code></td>
<td>
<p>(logical) whether or not to save the values identified as
ranges considering the whole set of values and confidence limits defined in
<code>CL_lines</code>. Default = FALSE.</p>
</td></tr>
<tr><td><code id="histograms_env_+3A_output_directory">output_directory</code></td>
<td>
<p>(character) name of the folder in which results will
be written.</p>
</td></tr>
<tr><td><code id="histograms_env_+3A_overwrite">overwrite</code></td>
<td>
<p>(logical) whether or not to overwrite existing results in
<code>output_directory</code>. Default = FALSE.</p>
</td></tr>
<tr><td><code id="histograms_env_+3A_verbose">verbose</code></td>
<td>
<p>(logical) whether messages should be printed. Default = TRUE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Coordinates in csv files in <code>occ_folder</code>, SpatVector-like files in
<code>M_folder</code>, and raster layers in <code>var_folder</code> must coincide in the
geographic projection in which they are represented. WGS84 with no planar
projection is recommended.
</p>
<p>Accessible area (M) is understood as the geographic area that has been
accessible for a species for relevant periods of time. Defining M is usually
a hard task, but also a very important one, because it allows identifying
uncertainties about the ability of a species to maintain populations under
certain environmental conditions. For further details on this topic, see
Barve et al. (2011) <a href="doi:10.1016/j.ecolmodel.2011.02.011">doi:10.1016/j.ecolmodel.2011.02.011</a>
and Machado-Stredel et al. (2021) <a href="doi:10.21425/F5FBG48814">doi:10.21425/F5FBG48814</a>.
</p>
<p>Rounding variables may be useful when multiple variables are considered and
the values of some or all of them are too small (e.g., when using principal
components). To round specific variables arguments <code>round</code>,
<code>round_names</code>, and <code>multiplication_factor</code>, must be used accordingly.
</p>


<h3>Value</h3>

<p>A list of data.frames containing intervals of environmental values in species
occurrences and accessible areas (M), as well as values corresponding to the
confidence limits defined in <code>CL_lines</code>. A folder named as
in <code>output_directory</code> containing all resulting PDF files (one per
variable) with histograms for all species. Files (csv) of ranges found during
the analyses will be also written in <code>output_directory</code> if
<code>save_ranges</code> is set as TRUE.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># preparing data and directories for examples
## directories
tempdir &lt;- file.path(tempdir(), "nevol_test")
dir.create(tempdir)

cvariables &lt;- paste0(tempdir, "/variables")
dir.create(cvariables)

records &lt;- paste0(tempdir, "/records")
dir.create(records)

m_areas &lt;- paste0(tempdir, "/M_areas")
dir.create(m_areas)

histdir &lt;- paste0(tempdir, "/Hists")

## data
data("occ_list", package = "nichevol")

temp &lt;- system.file("extdata", "temp.tif", package = "nichevol")

m_files &lt;- list.files(system.file("extdata", package = "nichevol"),
                      pattern = "m\\d.gpkg", full.names = TRUE)

## writing data in temporal directories
spnames &lt;- sapply(occ_list, function (x) as.character(x[1, 1]))
ocnames &lt;-  paste0(records, "/", spnames, ".csv")

occs &lt;- lapply(1:length(spnames), function (x) {
  write.csv(occ_list[[x]], ocnames[x], row.names = FALSE)
})

to_replace &lt;- paste0(system.file("extdata", package = "nichevol"), "/")

otemp &lt;- gsub(to_replace, "", temp)
file.copy(from = temp, to = paste0(cvariables, "/", otemp))

file.copy(from = m_files, to = paste0(m_areas, "/", spnames, ".gpkg"))

# running analysis to produce plots
hists &lt;- histograms_env(M_folder = m_areas, M_format = "gpkg",
                        occ_folder = records, longitude = "x",
                        latitude = "y", var_folder = cvariables,
                        var_format = "tif", output_directory = histdir)
</code></pre>

<hr>
<h2 id='m'>Example of accessible areas for a species</h2><span id='topic+m'></span><span id='topic+m1'></span><span id='topic+m2'></span><span id='topic+m3'></span><span id='topic+m4'></span><span id='topic+m5'></span><span id='topic+m6'></span>

<h3>Description</h3>

<p>A SpatVector object representing the accessible area for a species.
</p>


<h3>Format</h3>

<p>A SpatVector object.
</p>


<h3>Value</h3>

<p>No return value, used with function <code><a href="terra.html#topic+vect">vect</a></code> to
bring an example of an accessible area for a species.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>m1 &lt;- terra::vect(system.file("extdata", "m1.gpkg", package = "nichevol"))

terra::plot(m1)
</code></pre>

<hr>
<h2 id='map_nichevol'>Maps of niche reconstructions and changes detected</h2><span id='topic+map_nichevol'></span>

<h3>Description</h3>

<p>map_nichevol produces a SpatRaster layer representing
geographic areas corresponding to environmental bins of niche or events of
niche evolution detected in reconstructions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>map_nichevol(whole_rec_table, variable, return = "niche", from, to = NULL,
             id_unknown = TRUE, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="map_nichevol_+3A_whole_rec_table">whole_rec_table</code></td>
<td>
<p>matrix of environmental bins for all tips and nodes
derived from functions <code><a href="#topic+bin_par_rec">bin_par_rec</a></code> or <code><a href="#topic+bin_ml_rec">bin_ml_rec</a></code>.</p>
</td></tr>
<tr><td><code id="map_nichevol_+3A_variable">variable</code></td>
<td>
<p>a SpatRaster layer corresponding to the variable for which
the reconstruction was performed (represented in <code>whole_rec_table</code>).</p>
</td></tr>
<tr><td><code id="map_nichevol_+3A_return">return</code></td>
<td>
<p>(character) type of result to return. Options are: &quot;niche&quot;,
&quot;evolution&quot;, or &quot;nichevol&quot; (a combination of both). Default = &quot;niche&quot;. If
&quot;niche&quot;, values correspond to that defined in <code>from</code>. See Value.</p>
</td></tr>
<tr><td><code id="map_nichevol_+3A_from">from</code></td>
<td>
<p>(character) if <code>return</code> = &quot;niche&quot; tip or node for which layer
will be prepared, otherwise, initial node from which niche comparison will be
performed. See example.</p>
</td></tr>
<tr><td><code id="map_nichevol_+3A_to">to</code></td>
<td>
<p>(character) valid if <code>return</code> = &quot;evolution&quot; or &quot;nichevol&quot;.
Tip or node to compare against <code>from</code> to detected changes.
Default = NULL. See example.</p>
</td></tr>
<tr><td><code id="map_nichevol_+3A_id_unknown">id_unknown</code></td>
<td>
<p>(logical) whether to identify areas of unknown or uncertain
change. Default = TRUE. See details.</p>
</td></tr>
<tr><td><code id="map_nichevol_+3A_verbose">verbose</code></td>
<td>
<p>(logical) whether messages should be printed. Default = TRUE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Mapping is done following Cobos et al. (2021) <a href="doi:10.1111/jav.02868">doi:10.1111/jav.02868</a>.
This allows to represent geographic areas with environments where
niche expanded, retracted, or stayed stable (evolution). Niche is
represented as presence, absence, or unknown.
</p>
<p>Defining <code>id_unknown</code> = TRUE allows to map areas where niche or niche
change are uncertain. <code>id_unknown</code> = FALSE returns NA in areas with these
characteristics, hence they will not be visible when plotting the resulting
map.
</p>


<h3>Value</h3>

<p>A SpatRaster object classified according to values of niche in
<code>whole_rec_table</code>, and/or according to niche changes detected in
comparisons between an ancestor and a tip, or another more recent ancestor.
</p>
<p>Options of values resulting from classifications are as follow:
</p>
<p>If <code>return</code> = &quot;niche&quot;:</p>

<table>
<tr>
 <td style="text-align: left;">
   ID </td><td style="text-align: left;"> category </td>
</tr>
<tr>
 <td style="text-align: left;">
   0 </td><td style="text-align: left;"> Absent </td>
</tr>
<tr>
 <td style="text-align: left;">
   10 </td><td style="text-align: left;"> Unknown </td>
</tr>
<tr>
 <td style="text-align: left;">
   100 </td><td style="text-align: left;"> Present </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>If <code>return</code> = &quot;evolution&quot;:</p>

<table>
<tr>
 <td style="text-align: left;">
   ID </td><td style="text-align: left;"> category </td>
</tr>
<tr>
 <td style="text-align: left;">
   0 </td><td style="text-align: left;"> Stable </td>
</tr>
<tr>
 <td style="text-align: left;">
   1 </td><td style="text-align: left;"> Expansion low </td>
</tr>
<tr>
 <td style="text-align: left;">
   3 </td><td style="text-align: left;"> Expansion high </td>
</tr>
<tr>
 <td style="text-align: left;">
   2 </td><td style="text-align: left;"> Retraction high </td>
</tr>
<tr>
 <td style="text-align: left;">
   4 </td><td style="text-align: left;"> Retraction low </td>
</tr>
<tr>
 <td style="text-align: left;">
   10 </td><td style="text-align: left;"> Unknown </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>If <code>return</code> = &quot;nichevol&quot;:</p>

<table>
<tr>
 <td style="text-align: left;">
   ID </td><td style="text-align: left;"> category </td>
</tr>
<tr>
 <td style="text-align: left;">
   0 </td><td style="text-align: left;"> Stable </td>
</tr>
<tr>
 <td style="text-align: left;">
   1 </td><td style="text-align: left;"> Expansion low </td>
</tr>
<tr>
 <td style="text-align: left;">
   3 </td><td style="text-align: left;"> Expansion high </td>
</tr>
<tr>
 <td style="text-align: left;">
   10 </td><td style="text-align: left;"> Unknown </td>
</tr>
<tr>
 <td style="text-align: left;">
   100 </td><td style="text-align: left;"> Present </td>
</tr>
<tr>
 <td style="text-align: left;">
   102 </td><td style="text-align: left;"> Retraction high </td>
</tr>
<tr>
 <td style="text-align: left;">
   104 </td><td style="text-align: left;"> Retraction low </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Examples</h3>

<pre><code class='language-R'># a tree
data("tree", package = "nichevol")

# raster variable
temp &lt;- terra::rast(system.file("extdata", "temp.tif", package = "nichevol"))

# results from reconstruction
data("par_rec_table", package = "nichevol")

# rename tree tips
tree$tip.label &lt;- rownames(par_rec_table)[1:6]

# check in plot
plot.phylo(tree, label.offset = 0.02)
nodelabels()
nichevol_labels(tree, par_rec_table)

# mapping nichevol
nevol_map &lt;- map_nichevol(whole_rec_table = par_rec_table, variable = temp,
                          return = "nichevol", from = "9", to = "RD 6933")

terra::plot(nevol_map)
</code></pre>

<hr>
<h2 id='niche_bars'>PNG bar figures to represent ecological niches of distinct taxa</h2><span id='topic+niche_bars'></span>

<h3>Description</h3>

<p>niche_bars produces bar plots that represent species
ecological niches in one environmental variable. Bars are exported as png
figures to an output directory for posterior use.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>niche_bars(tree, whole_rec_table, present = "1", unknown = "?",
           present_col = "#e41a1c", unknown_col = "#969696",
           absent_col = "#377eb8", width = 50, height = 5, res = 300,
           output_directory, overwrite = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="niche_bars_+3A_tree">tree</code></td>
<td>
<p>an object of class &quot;phylo&quot;.</p>
</td></tr>
<tr><td><code id="niche_bars_+3A_whole_rec_table">whole_rec_table</code></td>
<td>
<p>matrix of environmental bins for all tips and nodes
derived from functions <code><a href="#topic+bin_par_rec">bin_par_rec</a></code> or <code><a href="#topic+bin_ml_rec">bin_ml_rec</a></code>.</p>
</td></tr>
<tr><td><code id="niche_bars_+3A_present">present</code></td>
<td>
<p>(character) code indicating environmental bins in which the
species is present. Default = &quot;1&quot;.</p>
</td></tr>
<tr><td><code id="niche_bars_+3A_unknown">unknown</code></td>
<td>
<p>(character) code indicating environmental bins in which the
species presence is unknown (uncertain). Default = &quot;?&quot;.</p>
</td></tr>
<tr><td><code id="niche_bars_+3A_present_col">present_col</code></td>
<td>
<p>color for area of the bar representing environments where
the species is present. Default = &quot;#e41a1c&quot;.</p>
</td></tr>
<tr><td><code id="niche_bars_+3A_unknown_col">unknown_col</code></td>
<td>
<p>color for area of the bar representing environments where
the species presence is unknown (uncertain). Default = &quot;#969696&quot;.</p>
</td></tr>
<tr><td><code id="niche_bars_+3A_absent_col">absent_col</code></td>
<td>
<p>color for area of the bar representing environments where
no change has been detected. Default = &quot;#377eb8&quot;.</p>
</td></tr>
<tr><td><code id="niche_bars_+3A_width">width</code></td>
<td>
<p>(numeric) width of the device in mm to be passed to the
<code><a href="grDevices.html#topic+png">png</a></code> function. Default = 50.</p>
</td></tr>
<tr><td><code id="niche_bars_+3A_height">height</code></td>
<td>
<p>(numeric) height of the device in mm to be passed to the
<code><a href="grDevices.html#topic+png">png</a></code> function. Default = 5.</p>
</td></tr>
<tr><td><code id="niche_bars_+3A_res">res</code></td>
<td>
<p>(numeric) nominal resolution in ppi to be passed to the
<code><a href="grDevices.html#topic+png">png</a></code> function. Default = 300.</p>
</td></tr>
<tr><td><code id="niche_bars_+3A_output_directory">output_directory</code></td>
<td>
<p>(character) name of the folder in which results will
be written. The directory will be created as part of the process.</p>
</td></tr>
<tr><td><code id="niche_bars_+3A_overwrite">overwrite</code></td>
<td>
<p>(logical) whether or not to overwrite existing results in
<code>output_directory</code>. Default = FALSE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Ecological niches are represented in one environmental dimension with vertical
bars that indicate if the species is present, absent, or if its presence is
uncertain in the range of environmental conditions. Lower values of
environmental variables are represented in the left part of the bar, and the
opposite part of the bar represents higher values.
</p>


<h3>Value</h3>

<p>A folder named as in <code>output_directory</code> containing all bar figures
produced, as well as a legend to describe what is plotted.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># a simple tree
data("tree5", package = "nichevol")

# a matrix of niche charactes (1 = present, 0 = absent, ? = unknown)
dataTable &lt;- cbind("241" = rep("1", length(tree5$tip.label)),
                   "242" = rep("1", length(tree5$tip.label)),
                   "243" = c("1", "1", "0", "0", "0"),
                   "244" = c("1", "1", "0", "0", "0"),
                   "245" = c("1", "?", "0", "0", "0"))
rownames(dataTable) &lt;- tree5$tip.label

# list with two objects (tree and character table)
treeWdata &lt;- geiger::treedata(tree5, dataTable)

# Maximum parsimony reconstruction
rec_tab &lt;- smooth_rec(bin_par_rec(treeWdata))

# the running (before running, define a working directory)
niche_bars(tree5, rec_tab, output_directory = file.path(tempdir(), "nichebars"))
</code></pre>

<hr>
<h2 id='niche_labels'>Labels to represent niches of tips and ancestors</h2><span id='topic+niche_labels'></span>

<h3>Description</h3>

<p>niche_labels helps in adding bar-type labels that represent
species ecological niches in one environmental variable.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>niche_labels(tree, whole_rec_table, label_type = "tip_node",
             tip_offset = 0.015, present = "1", unknown = "?",
             present_col = "#e41a1c", unknown_col = "#969696",
             absent_col = "#377eb8", width = 1, height = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="niche_labels_+3A_tree">tree</code></td>
<td>
<p>an object of class &quot;phylo&quot;.</p>
</td></tr>
<tr><td><code id="niche_labels_+3A_whole_rec_table">whole_rec_table</code></td>
<td>
<p>matrix of environmental bins for all tips and nodes
derived from functions <code><a href="#topic+bin_par_rec">bin_par_rec</a></code> or <code><a href="#topic+bin_ml_rec">bin_ml_rec</a></code>.</p>
</td></tr>
<tr><td><code id="niche_labels_+3A_label_type">label_type</code></td>
<td>
<p>(character) type of label; options are: &quot;tip&quot;, &quot;node&quot;, and
&quot;tip_node&quot;. Default = &quot;tip_node&quot;.</p>
</td></tr>
<tr><td><code id="niche_labels_+3A_tip_offset">tip_offset</code></td>
<td>
<p>(numeric) space between tips and the labels. Default = 0.015.</p>
</td></tr>
<tr><td><code id="niche_labels_+3A_present">present</code></td>
<td>
<p>(character) code indicating environmental bins in which the
species is present. Default = &quot;1&quot;.</p>
</td></tr>
<tr><td><code id="niche_labels_+3A_unknown">unknown</code></td>
<td>
<p>(character) code indicating environmental bins in which the
species presence is unknown (uncertain). Default = &quot;?&quot;.</p>
</td></tr>
<tr><td><code id="niche_labels_+3A_present_col">present_col</code></td>
<td>
<p>color for area of the bar representing environments where
the species is present. Default = &quot;#e41a1c&quot;.</p>
</td></tr>
<tr><td><code id="niche_labels_+3A_unknown_col">unknown_col</code></td>
<td>
<p>color for area of the bar representing environments where
the species presence is unknown (uncertain). Default = &quot;#969696&quot;.</p>
</td></tr>
<tr><td><code id="niche_labels_+3A_absent_col">absent_col</code></td>
<td>
<p>color for area of the bar representing environments where
no change has been detected. Default = &quot;#377eb8&quot;.</p>
</td></tr>
<tr><td><code id="niche_labels_+3A_width">width</code></td>
<td>
<p>value defining the width of niche bars; default = 1.</p>
</td></tr>
<tr><td><code id="niche_labels_+3A_height">height</code></td>
<td>
<p>value defining the height of niche bars; default = 1.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For the moment, only plots of type &quot;phylogram&quot; with &quot;rightwards&quot; or &quot;leftwards&quot;
directions, created with the function <code><a href="ape.html#topic+plot.phylo">plot.phylo</a></code> from the
package <code>ape</code> are supported.
</p>
<p>Ecological niches are represented in one environmental dimension with vertical
bars that indicate if the species is present, absent, or if its presence is
uncertain in the range of environmental conditions. Lower values of
environmental variables are represented in the lower part of the bar, and the
opposite part of the bar represents higher values.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># a simple tree
data("tree5", package = "nichevol")

# a matrix of niche charactes (1 = present, 0 = absent, ? = unknown)
dataTable &lt;- cbind("241" = rep("1", length(tree5$tip.label)),
                   "242" = rep("1", length(tree5$tip.label)),
                   "243" = c("1", "1", "0", "0", "0"),
                   "244" = c("1", "1", "0", "0", "0"),
                   "245" = c("1", "?", "0", "0", "0"))
rownames(dataTable) &lt;- tree5$tip.label

# list with two objects (tree and character table)
treeWdata &lt;- geiger::treedata(tree5, dataTable)

# Maximum parsimony reconstruction
rec_tab &lt;- smooth_rec(bin_par_rec(treeWdata))

# plotting and adding labels
ape::plot.phylo(tree5, label.offset = 0.04)
niche_labels(tree5, rec_tab, height = 0.6)
</code></pre>

<hr>
<h2 id='niche_legend'>Legends for niche labels in phylogenetic trees</h2><span id='topic+niche_legend'></span>

<h3>Description</h3>

<p>Legends for niche labels in phylogenetic trees
</p>


<h3>Usage</h3>

<pre><code class='language-R'>niche_legend(position, legend = c("Uncertain", "Present", "Not present"),
  pch = 22, pt.bg = c("#969696", "#e41a1c", "#377eb8"),
  col = "transparent", pt.cex = 2.2, bty = "n", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="niche_legend_+3A_position">position</code></td>
<td>
<p>(character or numeric) position of legend. If character,
part of the plot (e.g., &quot;topleft&quot;), see <code><a href="graphics.html#topic+legend">legend</a></code>. If
numeric, vector of two values indicating x and y position (e.g., c(0.1, 6)).</p>
</td></tr>
<tr><td><code id="niche_legend_+3A_legend">legend</code></td>
<td>
<p>(character) vector of length = three indicating the text to
identify environments with uncertain presence, presence, and absence of the
species. Default = c(&quot;Uncertain&quot;, &quot;Present&quot;, &quot;Not present&quot;).</p>
</td></tr>
<tr><td><code id="niche_legend_+3A_pch">pch</code></td>
<td>
<p>point type as in <code><a href="graphics.html#topic+points">points</a></code>. Default = 22.</p>
</td></tr>
<tr><td><code id="niche_legend_+3A_pt.bg">pt.bg</code></td>
<td>
<p>colors to represent what is in <code>legend</code>.
Default = c(&quot;#969696&quot;, &quot;#e41a1c&quot;, &quot;#377eb8&quot;).</p>
</td></tr>
<tr><td><code id="niche_legend_+3A_col">col</code></td>
<td>
<p>border of symbol (points). Default = &quot;transparent&quot;.</p>
</td></tr>
<tr><td><code id="niche_legend_+3A_pt.cex">pt.cex</code></td>
<td>
<p>size of symbol (points). Default = 2.2.</p>
</td></tr>
<tr><td><code id="niche_legend_+3A_bty">bty</code></td>
<td>
<p>legend border type. Default = &quot;n&quot;.</p>
</td></tr>
<tr><td><code id="niche_legend_+3A_...">...</code></td>
<td>
<p>Other arguments from function <code><a href="graphics.html#topic+legend">legend</a></code> other
than the ones described above.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'># a simple tree
data("tree5", package = "nichevol")

# a matrix of niche charactes (1 = present, 0 = absent, ? = unknown)
dataTable &lt;- cbind("241" = rep("1", length(tree5$tip.label)),
                   "242" = rep("1", length(tree5$tip.label)),
                   "243" = c("1", "1", "0", "0", "0"),
                   "244" = c("1", "1", "0", "0", "0"),
                   "245" = c("1", "?", "0", "0", "0"))
rownames(dataTable) &lt;- tree5$tip.label

# list with two objects (tree and character table)
treeWdata &lt;- geiger::treedata(tree5, dataTable)

# Maximum parsimony reconstruction
rec_tab &lt;- smooth_rec(bin_par_rec(treeWdata))

# plotting and adding labels and legend
ape::plot.phylo(tree5, label.offset = 0.04)
niche_labels(tree5, rec_tab, height = 0.6)
niche_legend(position = "topleft", cex = 0.7)
</code></pre>

<hr>
<h2 id='nichevol'>nichevol: Assessment of Species’ Ecological Niche Evolution Considering
Uncertainty in Reconstructions</h2><span id='topic+nichevol'></span>

<h3>Description</h3>

<p>nichevol is a collection of tools that allow users to perform critical steps
in the process of assessing ecological niche evolution over phylogenies, with
uncertainty incorporated explicitly in reconstructions. The method proposed
here for ancestral reconstruction of ecological niches characterizes species'
niches using a bin-based approach that incorporates uncertainty in estimations.
Compared to other existing methods, the approaches presented here reduce risk
of overestimation of amounts and rates of ecological niche evolution. The
main analyses include: initial exploration of environmental data in occurrence
records and accessible areas, preparation of data for phylogenetic analyses,
executing comparative phylogenetic analyses of ecological niches, and plotting
for interpretations.
</p>


<h3>Main functions in nichevol</h3>

<p><code><a href="#topic+bin_ml_rec">bin_ml_rec</a></code>, <code><a href="#topic+bin_par_rec">bin_par_rec</a></code>, <code><a href="#topic+bin_table">bin_table</a></code>,
<code><a href="#topic+bin_tables">bin_tables</a></code>, <code><a href="#topic+bin_tables0">bin_tables0</a></code>, <code><a href="#topic+hist_evalues">hist_evalues</a></code>,
<code><a href="#topic+histograms_env">histograms_env</a></code>, <code><a href="#topic+map_nichevol">map_nichevol</a></code>,
<code><a href="#topic+niche_bars">niche_bars</a></code>, <code><a href="#topic+nichevol_bars">nichevol_bars</a></code>,
<code><a href="#topic+niche_labels">niche_labels</a></code>, <code><a href="#topic+nichevol_labels">nichevol_labels</a></code>,
<code><a href="#topic+niche_legend">niche_legend</a></code>, <code><a href="#topic+nichevol_legend">nichevol_legend</a></code>,
<code><a href="#topic+set_uncertainty">set_uncertainty</a></code>, <code><a href="#topic+smooth_rec">smooth_rec</a></code>,
<code><a href="#topic+stats_eval">stats_eval</a></code>, <code><a href="#topic+stats_evalues">stats_evalues</a></code>
</p>
<p>Other functions (important helpers)
</p>
<p><code><a href="#topic+bin_env">bin_env</a></code>, <code><a href="#topic+pdf_histograms">pdf_histograms</a></code>,
<code><a href="#topic+rename_tips">rename_tips</a></code>, <code><a href="#topic+score_tip">score_tip</a></code>,
<code><a href="#topic+score_tree">score_tree</a></code>, <code><a href="#topic+sig_sq">sig_sq</a></code>
</p>

<hr>
<h2 id='nichevol_bars'>PNG bar figures for representing niche evolution</h2><span id='topic+nichevol_bars'></span>

<h3>Description</h3>

<p>nichevol_bars produces bar plots that represent how
species' niches (considering one environmental variable at a time) have evolved.
Bars are exported as png figures to an output directory for posterior use.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nichevol_bars(tree, whole_rec_table, ancestor_line = FALSE,
              present = "1", absent = "0", unknown = "?",
              present_col = "#252525", unknown_col = "#d9d9d9",
              no_change_col = "#b2df8a", retraction_col = "#984ea3",
              expansion_col = "#4daf4a", width = 50, height = 5,
              res = 300, output_directory, overwrite = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nichevol_bars_+3A_tree">tree</code></td>
<td>
<p>an object of class &quot;phylo&quot;.</p>
</td></tr>
<tr><td><code id="nichevol_bars_+3A_whole_rec_table">whole_rec_table</code></td>
<td>
<p>matrix of reconstructed bins for nodes and species
derived from a process of maximum parsimony reconstruction.</p>
</td></tr>
<tr><td><code id="nichevol_bars_+3A_ancestor_line">ancestor_line</code></td>
<td>
<p>controls whether ancestor line is plotted.
Default = FALSE.</p>
</td></tr>
<tr><td><code id="nichevol_bars_+3A_present">present</code></td>
<td>
<p>(character) code indicating environmental bins in which the
species is present. Default = &quot;1&quot;.</p>
</td></tr>
<tr><td><code id="nichevol_bars_+3A_absent">absent</code></td>
<td>
<p>(character) code indicating environmental bins in which the
species is absent. Default = &quot;0&quot;.</p>
</td></tr>
<tr><td><code id="nichevol_bars_+3A_unknown">unknown</code></td>
<td>
<p>(character) code indicating environmental bins in which the
species presence is unknown (uncertain). Default = &quot;?&quot;.</p>
</td></tr>
<tr><td><code id="nichevol_bars_+3A_present_col">present_col</code></td>
<td>
<p>color for line representing environments where the species
is present. Default = &quot;#252525&quot;.</p>
</td></tr>
<tr><td><code id="nichevol_bars_+3A_unknown_col">unknown_col</code></td>
<td>
<p>color for line representing environments where the species
presence is unknown (uncertain). Default = &quot;#d9d9d9&quot;.</p>
</td></tr>
<tr><td><code id="nichevol_bars_+3A_no_change_col">no_change_col</code></td>
<td>
<p>color for area of the bar representing environments where
no change has been detected. Default = &quot;#b2df8a&quot;.</p>
</td></tr>
<tr><td><code id="nichevol_bars_+3A_retraction_col">retraction_col</code></td>
<td>
<p>color for area of the bar representing environments where
niche retraction has been detected. Default = &quot;#984ea3&quot;.</p>
</td></tr>
<tr><td><code id="nichevol_bars_+3A_expansion_col">expansion_col</code></td>
<td>
<p>color for area of the bar representing environments where
niche expansion has been detected. Default = &quot;#4daf4a&quot;.</p>
</td></tr>
<tr><td><code id="nichevol_bars_+3A_width">width</code></td>
<td>
<p>(numeric) width of the device in mm to be passed to the
<code><a href="grDevices.html#topic+png">png</a></code> function. Default = 50.</p>
</td></tr>
<tr><td><code id="nichevol_bars_+3A_height">height</code></td>
<td>
<p>(numeric) height of the device in mm to be passed to the
<code><a href="grDevices.html#topic+png">png</a></code> function. Default = 5.</p>
</td></tr>
<tr><td><code id="nichevol_bars_+3A_res">res</code></td>
<td>
<p>(numeric) nominal resolution in ppi to be passed to the
<code><a href="grDevices.html#topic+png">png</a></code> function. Default = 300.</p>
</td></tr>
<tr><td><code id="nichevol_bars_+3A_output_directory">output_directory</code></td>
<td>
<p>(character) name of the folder in which results will
be written. The directory will be created as part of the process.</p>
</td></tr>
<tr><td><code id="nichevol_bars_+3A_overwrite">overwrite</code></td>
<td>
<p>(logical) whether or not to overwrite existing results in
<code>output_directory</code>. Default = FALSE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Evolution of ecological niches is represented in one environmental dimension
with horizontal bars indicating if the niche of the descendant has expanded,
retracted, or has not changed compared to its ancestor. Lower values of
environmental variables are represented in the left part of the bar, higher
values at the right.
</p>
<p>Changes in niches (evolution) are defined as follows:
</p>

<ul>
<li><p> if (ancestor == present &amp; descendant == absent) change &lt;- &quot;retraction&quot;
</p>
</li>
<li><p> if (ancestor == present &amp; descendant == present) change &lt;- &quot;no_change&quot;
</p>
</li>
<li><p> if (ancestor == present &amp; descendant == unknown) change &lt;- &quot;no_change&quot;
</p>
</li>
<li><p> if (ancestor == absent &amp; descendant == present) change &lt;- &quot;expansion&quot;
</p>
</li>
<li><p> if (ancestor == absent &amp; descendant == absent) change &lt;- &quot;no_change&quot;
</p>
</li>
<li><p> if (ancestor == absent &amp; descendant == unknown) change &lt;- &quot;no_change&quot;
</p>
</li>
<li><p> if (ancestor == unknown &amp; descendant == absent) change &lt;- &quot;no_change&quot;
</p>
</li>
<li><p> if (ancestor == unknown &amp; descendant == present) change &lt;- &quot;no_change&quot;
</p>
</li>
<li><p> if (ancestor == unknown &amp; descendant == unknown) change &lt;- &quot;no_change&quot;
</p>
</li></ul>

<p>If <code>ancestor_line</code> is TRUE, the ancestor line will be plotted on the bar
representing niche evolution. The line will represent where, in the range of
environmental conditions, the ancestor was present, and where its presence is
uncertain (unknown).
</p>


<h3>Value</h3>

<p>A folder named as in <code>output_directory</code> containing all bar figures
produced, as well as a legend to describe what is plotted.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># a simple tree
data("tree5", package = "nichevol")

# a matrix of niche charactes (1 = present, 0 = absent, ? = unknown)
dataTable &lt;- cbind("241" = rep("1", length(tree5$tip.label)),
                   "242" = rep("1", length(tree5$tip.label)),
                   "243" = c("1", "1", "0", "0", "0"),
                   "244" = c("1", "1", "0", "0", "0"),
                   "245" = c("1", "?", "0", "0", "0"))
rownames(dataTable) &lt;- tree5$tip.label

# list with two objects (tree and character table)
treeWdata &lt;- geiger::treedata(tree5, dataTable)

# Maximum parsimony reconstruction
rec_tab &lt;- smooth_rec(bin_par_rec(treeWdata))

# the running (before running, define a working directory)
nichevol_bars(tree5, rec_tab, output_directory = file.path(tempdir(), "evolbars"))
</code></pre>

<hr>
<h2 id='nichevol_labels'>Labels to represent changes of niche characteristics between ancestors and descendants</h2><span id='topic+nichevol_labels'></span>

<h3>Description</h3>

<p>nichevol_labels helps in adding bar-type labels that represent how
species' niches changed from ancestors to descendants.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nichevol_labels(tree, whole_rec_table, ancestor_line = FALSE,
  present = "1", absent = "0", unknown = "?",
  present_col = "#252525", unknown_col = "#d9d9d9",
  no_change_col = "#b2df8a", retraction_col = "#984ea3",
  expansion_col = "#4daf4a", width = 1, height = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nichevol_labels_+3A_tree">tree</code></td>
<td>
<p>an object of class &quot;phylo&quot;.</p>
</td></tr>
<tr><td><code id="nichevol_labels_+3A_whole_rec_table">whole_rec_table</code></td>
<td>
<p>matrix of reconstructed bins for nodes and species
derived from a process of maximum parsimony or maximum likelihood reconstruction.
See functions <code><a href="#topic+bin_par_rec">bin_par_rec</a></code> or <code><a href="#topic+bin_ml_rec">bin_ml_rec</a></code>.</p>
</td></tr>
<tr><td><code id="nichevol_labels_+3A_ancestor_line">ancestor_line</code></td>
<td>
<p>controls whether ancestor line is plotted.
Default = FALSE.</p>
</td></tr>
<tr><td><code id="nichevol_labels_+3A_present">present</code></td>
<td>
<p>(character) code indicating environmental bins in which the
species is present. Default = &quot;1&quot;.</p>
</td></tr>
<tr><td><code id="nichevol_labels_+3A_absent">absent</code></td>
<td>
<p>(character) code indicating environmental bins in which the
species is absent. Default = &quot;0&quot;.</p>
</td></tr>
<tr><td><code id="nichevol_labels_+3A_unknown">unknown</code></td>
<td>
<p>(character) code indicating environmental bins in which the
species presence is unknown (uncertain). Default = &quot;?&quot;.</p>
</td></tr>
<tr><td><code id="nichevol_labels_+3A_present_col">present_col</code></td>
<td>
<p>color for line representing environments where the species
is present. Default = &quot;#252525&quot;.</p>
</td></tr>
<tr><td><code id="nichevol_labels_+3A_unknown_col">unknown_col</code></td>
<td>
<p>color for line representing environments where the species
presence is unknown (uncertain). Default = &quot;#d9d9d9&quot;.</p>
</td></tr>
<tr><td><code id="nichevol_labels_+3A_no_change_col">no_change_col</code></td>
<td>
<p>color for area of the bar representing environments where
no change has been detected. Default = &quot;#b2df8a&quot;.</p>
</td></tr>
<tr><td><code id="nichevol_labels_+3A_retraction_col">retraction_col</code></td>
<td>
<p>color for area of the bar representing environments where
niche retraction has been detected. Default = &quot;#984ea3&quot;.</p>
</td></tr>
<tr><td><code id="nichevol_labels_+3A_expansion_col">expansion_col</code></td>
<td>
<p>color for area of the bar representing environments where
niche expansion has been detected. Default = &quot;#4daf4a&quot;.</p>
</td></tr>
<tr><td><code id="nichevol_labels_+3A_width">width</code></td>
<td>
<p>value defining the width of bars representing changes in niches;
default = 1.</p>
</td></tr>
<tr><td><code id="nichevol_labels_+3A_height">height</code></td>
<td>
<p>value defining the height of bars representing changes in niches;
default = 1.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For the moment, only plots of type &quot;phylogram&quot; with &quot;rightwards&quot; or &quot;leftwards&quot;
directions, created with the function <code><a href="ape.html#topic+plot.phylo">plot.phylo</a></code> from the
package <code>ape</code> are supported.
</p>
<p>Evolution of ecological niches is represented in one environmental dimension,
with vertical bars indicating if the niche of the descendant has expanded,
retracted, or has not changed compared to its ancestor's niche. Lower values of
environmental variables are represented in the lower part of the bar, and the
opposite part of the bar represents higher values.
</p>
<p>Changes in niches (evolution) are defined as follows:
</p>

<ul>
<li><p> if (ancestor == present &amp; descendant == absent) change &lt;- &quot;retraction&quot;
</p>
</li>
<li><p> if (ancestor == present &amp; descendant == present) change &lt;- &quot;no_change&quot;
</p>
</li>
<li><p> if (ancestor == present &amp; descendant == unknown) change &lt;- &quot;no_change&quot;
</p>
</li>
<li><p> if (ancestor == absent &amp; descendant == present) change &lt;- &quot;expansion&quot;
</p>
</li>
<li><p> if (ancestor == absent &amp; descendant == absent) change &lt;- &quot;no_change&quot;
</p>
</li>
<li><p> if (ancestor == absent &amp; descendant == unknown) change &lt;- &quot;no_change&quot;
</p>
</li>
<li><p> if (ancestor == unknown &amp; descendant == absent) change &lt;- &quot;no_change&quot;
</p>
</li>
<li><p> if (ancestor == unknown &amp; descendant == present) change &lt;- &quot;no_change&quot;
</p>
</li>
<li><p> if (ancestor == unknown &amp; descendant == unknown) change &lt;- &quot;no_change&quot;
</p>
</li></ul>

<p>If <code>ancestor_line</code> is TRUE, the ancestor line will be plotted on the bar
representing niche evolution. The line will represent where, in the range of
environmental conditions, the ancestor was present, and where its presence is
uncertain (unknown).
</p>


<h3>Examples</h3>

<pre><code class='language-R'># a simple tree
data("tree5", package = "nichevol")

# a matrix of niche charactes (1 = present, 0 = absent, ? = unknown)
dataTable &lt;- cbind("241" = rep("1", length(tree5$tip.label)),
                   "242" = rep("1", length(tree5$tip.label)),
                   "243" = c("1", "1", "0", "0", "0"),
                   "244" = c("1", "1", "0", "0", "0"),
                   "245" = c("1", "?", "0", "0", "0"))
rownames(dataTable) &lt;- tree5$tip.label

# list with two objects (tree and character table)
treeWdata &lt;- geiger::treedata(tree5, dataTable)

# Maximum parsimony reconstruction
rec_tab &lt;- smooth_rec(bin_par_rec(treeWdata))

# plotting and adding labels
ape::plot.phylo(tree5, label.offset = 0.04)
nichevol_labels(tree5, rec_tab, height = 0.6)
</code></pre>

<hr>
<h2 id='nichevol_legend'>Legends for niche evolution labels in phylogenetic trees</h2><span id='topic+nichevol_legend'></span>

<h3>Description</h3>

<p>Legends for niche evolution labels in phylogenetic trees
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nichevol_legend(position, ancestor_line = FALSE,
  ancestor_legend = c("Uncertain", "Present"),
  evol_legend = c("No change", "Retraction", "Expansion"),
  ancestor_col = c("#d9d9d9", "#252525"),
  evol_col = c("#b2df8a", "#984ea3", "#4daf4a"),
  pch = 22, pt.cex = 2.2, lty = 1, lwd = 1, cex = 1, bty = "n", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nichevol_legend_+3A_position">position</code></td>
<td>
<p>(character or numeric) position of legend. If character,
part of the plot (e.g., &quot;topleft&quot;), see <code><a href="graphics.html#topic+legend">legend</a></code>. If
numeric, vector of two values indicating x and y position (e.g., c(0.1, 6)).</p>
</td></tr>
<tr><td><code id="nichevol_legend_+3A_ancestor_line">ancestor_line</code></td>
<td>
<p>whether or not ancestor line was plotted.
Default = FALSE.</p>
</td></tr>
<tr><td><code id="nichevol_legend_+3A_ancestor_legend">ancestor_legend</code></td>
<td>
<p>(character) vector of length = two indicating the text
to identify environments with uncertain presence and true presence of the
species. Default = c(&quot;Uncertain&quot;, &quot;Present&quot;).</p>
</td></tr>
<tr><td><code id="nichevol_legend_+3A_evol_legend">evol_legend</code></td>
<td>
<p>(character) vector of length = three indicating the text
to identify environments where niches have not changed, have retracted or
expanded. Default = c(&quot;No change&quot;, &quot;Retraction&quot;, &quot;Expansion&quot;).</p>
</td></tr>
<tr><td><code id="nichevol_legend_+3A_ancestor_col">ancestor_col</code></td>
<td>
<p>vector of two colors to represent what is indicated in
<code>ancestor_legend</code>. Default = c(&quot;#d9d9d9&quot;, &quot;#252525&quot;).</p>
</td></tr>
<tr><td><code id="nichevol_legend_+3A_evol_col">evol_col</code></td>
<td>
<p>vector of three colors to represent what is indicated in
<code>evol_legend</code>. Default = c(&quot;#b2df8a&quot;, &quot;#984ea3&quot;, &quot;#4daf4a&quot;).</p>
</td></tr>
<tr><td><code id="nichevol_legend_+3A_pch">pch</code></td>
<td>
<p>point type as in <code><a href="graphics.html#topic+points">points</a></code>. Default = 22.</p>
</td></tr>
<tr><td><code id="nichevol_legend_+3A_pt.cex">pt.cex</code></td>
<td>
<p>size of symbol (points). Default = 2.2.</p>
</td></tr>
<tr><td><code id="nichevol_legend_+3A_lty">lty</code></td>
<td>
<p>line type see <code><a href="graphics.html#topic+par">par</a></code>. Default = 1.</p>
</td></tr>
<tr><td><code id="nichevol_legend_+3A_lwd">lwd</code></td>
<td>
<p>line width see <code><a href="graphics.html#topic+par">par</a></code>. Default = 1.</p>
</td></tr>
<tr><td><code id="nichevol_legend_+3A_cex">cex</code></td>
<td>
<p>size of all elements in legend see <code><a href="graphics.html#topic+par">par</a></code>.
Default = 1.</p>
</td></tr>
<tr><td><code id="nichevol_legend_+3A_bty">bty</code></td>
<td>
<p>legend border type. Default = &quot;n&quot;.</p>
</td></tr>
<tr><td><code id="nichevol_legend_+3A_...">...</code></td>
<td>
<p>Other arguments from function <code><a href="graphics.html#topic+legend">legend</a></code> other
than the ones described above.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'># a simple tree
data("tree5", package = "nichevol")

# a matrix of niche charactes (1 = present, 0 = absent, ? = unknown)
dataTable &lt;- cbind("241" = rep("1", length(tree5$tip.label)),
                   "242" = rep("1", length(tree5$tip.label)),
                   "243" = c("1", "1", "0", "0", "0"),
                   "244" = c("1", "1", "0", "0", "0"),
                   "245" = c("1", "?", "0", "0", "0"))
rownames(dataTable) &lt;- tree5$tip.label

# list with two objects (tree and character table)
treeWdata &lt;- geiger::treedata(tree5, dataTable)

# Maximum parsimony reconstruction
rec_tab &lt;- smooth_rec(bin_par_rec(treeWdata))

# plotting and adding labels and legend
ape::plot.phylo(tree5, label.offset = 0.04)
nichevol_labels(tree5, rec_tab, height = 0.6)
nichevol_legend(position = "bottomleft", cex = 0.7)
</code></pre>

<hr>
<h2 id='occ_list'>Example of occurrence records for six species</h2><span id='topic+occ_list'></span>

<h3>Description</h3>

<p>A list of 6 data.frames containing name and geographic coordinates for
6 species.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>occ_list
</code></pre>


<h3>Format</h3>

<p>A list of 6 data.frames:
</p>

<dl>
<dt>species</dt><dd><p>species name, a code in this example</p>
</dd>
<dt>x</dt><dd><p>longitude, longitude value</p>
</dd>
<dt>y</dt><dd><p>latitude, latitude value</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>data("occ_list", package = "nichevol")

str(occ_list)
</code></pre>

<hr>
<h2 id='par_rec_table'>Example of table with results from parsimony reconstructions</h2><span id='topic+par_rec_table'></span>

<h3>Description</h3>

<p>A character table representing species ecological niches derived from
previous preparation processes and reconstructed niches for ancestors.
Each row represents a species or a node and each column a binary
character in which one or more values of the environmental variable
are categorized as used &quot;1&quot;, non used &quot;0&quot;, or uncertain &quot;?&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>par_rec_table
</code></pre>


<h3>Format</h3>

<p>A character matrix with 11 rows and 20 columns.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("par_rec_table", package = "nichevol")

head(par_rec_table)
</code></pre>

<hr>
<h2 id='pdf_histograms'>Helper function to create PDF files with histograms</h2><span id='topic+pdf_histograms'></span>

<h3>Description</h3>

<p>Helper function to create PDF files with histograms
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pdf_histograms(env_data, occ_data, y_values, sp_names, variable_name,
               CL_lines, limits, col, output_directory)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pdf_histograms_+3A_env_data">env_data</code></td>
<td>
<p>list of environmental values in M for all species.</p>
</td></tr>
<tr><td><code id="pdf_histograms_+3A_occ_data">occ_data</code></td>
<td>
<p>list of environmental values in occurrences for all species.</p>
</td></tr>
<tr><td><code id="pdf_histograms_+3A_y_values">y_values</code></td>
<td>
<p>list of values for the y axis to be used to represent where
occurrences are distributed across the environmental values in M.</p>
</td></tr>
<tr><td><code id="pdf_histograms_+3A_sp_names">sp_names</code></td>
<td>
<p>(character) names of the species for which the process will
be performed.</p>
</td></tr>
<tr><td><code id="pdf_histograms_+3A_variable_name">variable_name</code></td>
<td>
<p>(character) name of the variable to be plotted.</p>
</td></tr>
<tr><td><code id="pdf_histograms_+3A_cl_lines">CL_lines</code></td>
<td>
<p>(numeric) confidence limits to be plotted in the histograms.</p>
</td></tr>
<tr><td><code id="pdf_histograms_+3A_limits">limits</code></td>
<td>
<p>numeric matrix containing the actual values for the confidence
limits of M.</p>
</td></tr>
<tr><td><code id="pdf_histograms_+3A_col">col</code></td>
<td>
<p>color for lines representing the confidence limits of M.</p>
</td></tr>
<tr><td><code id="pdf_histograms_+3A_output_directory">output_directory</code></td>
<td>
<p>(character) name of the folder in which results will be
written.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A PDF file written in the output directory containing all resulting figures.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># example data
e_data &lt;- list(rnorm(1000, 15, 7), rnorm(800, 20, 6), rnorm(1000, 12, 3))
o_data &lt;- list(sample(seq(5, 29, 0.1), 45), sample(seq(10, 33, 0.1), 40),
               sample(seq(1, 16, 0.1), 50))
for (i in 1:3) {
  names(e_data[[i]]) &lt;- e_data[[i]]
  names(o_data[[i]]) &lt;- o_data[[i]]
}
y_val &lt;- list(rep(3, length(o_data)), rep(4, length(o_data)),
              rep(2, length(o_data)))
s_names &lt;- c("sp1", "sp2", "sp3")
lims &lt;- rbind(c(3.5, 26.47), c(10.83, 29.66), c(6.92, 16.91))

tmpd &lt;- file.path(tempdir(), "Hist_to_check") # temporal directory
dir.create(tmpd)

# the running (before running, create output_directory in current directory)
bins &lt;- pdf_histograms(env_data = e_data, occ_data = o_data, y_values = y_val,
                       sp_names = s_names, variable_name = "Temperature",
                       CL_lines = 95, limits = lims, col = "green",
                       output_directory = tmpd)
</code></pre>

<hr>
<h2 id='read_bin_table'>Read tables of binary niche characters from directory</h2><span id='topic+read_bin_table'></span><span id='topic+read_bin_tables'></span>

<h3>Description</h3>

<p>Read one or multiple tables binary niche characters from
directory.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_bin_table(file)

read_bin_tables(directory)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="read_bin_table_+3A_file">file</code></td>
<td>
<p>(character) name of CSV file containing a table of binary niche
characters.</p>
</td></tr>
<tr><td><code id="read_bin_table_+3A_directory">directory</code></td>
<td>
<p>(character) name of directory where tables of binary niche
characters were written as CSV files.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix if <code>read_bin_table</code> is used.
</p>
<p>A list of matrices if <code>read_bin_tables</code> is used.
</p>

<hr>
<h2 id='rename_tips'>Helper function to rename tips of trees for simulations</h2><span id='topic+rename_tips'></span>

<h3>Description</h3>

<p>Helper function to rename tips of trees for simulations
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rename_tips(tree, names)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rename_tips_+3A_tree">tree</code></td>
<td>
<p>an object of class &quot;phylo&quot;.</p>
</td></tr>
<tr><td><code id="rename_tips_+3A_names">names</code></td>
<td>
<p>(character) vector of new names. Length must be equal to number
of tips. They will be assigned in the order given.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Tree of class &quot;phylo&quot; with specified names
</p>


<h3>Examples</h3>

<pre><code class='language-R'># a simple tree
data("tree5", package = "nichevol")

# renaming tips
renamedTree &lt;- rename_tips(tree5, c("a", "b", "c", "d", "e"))
</code></pre>

<hr>
<h2 id='score_tip'>Helper function to calculate the median bin score for a given species</h2><span id='topic+score_tip'></span>

<h3>Description</h3>

<p>Helper function to calculate the median bin score for a given species
</p>


<h3>Usage</h3>

<pre><code class='language-R'>score_tip(character_table, species_name, include_unknown = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="score_tip_+3A_character_table">character_table</code></td>
<td>
<p>data.frame containing bin scores for all species.
NOTE: row names must be species' names.</p>
</td></tr>
<tr><td><code id="score_tip_+3A_species_name">species_name</code></td>
<td>
<p>(character) name of the species to be analyzed.</p>
</td></tr>
<tr><td><code id="score_tip_+3A_include_unknown">include_unknown</code></td>
<td>
<p>(logical) whether or not unknown bin status should be
included.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Median bin value for a given species (for inferring sigma squared or
other comparative phylogenetic analyses requiring a single continuous variable).
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulate data for single number bin labels
dataTable &lt;- cbind("241" = rep("1", 5),
                   "242" = rep("1", 5),
                   "243" = c("1", "1", "0", "0", "0"),
                   "244" = c("1", "1", "0", "0", "0"),
                   "245" = c("1", "?", "0", "0", "0"))
 rownames(dataTable) &lt;- c("GadusMorhua", "GadusMacrocephalus",
                          "GadusChalcogrammus", "ArctogadusGlacials",
                          "BoreogadusSaida")
# Simulate data for bin labels as strings
dataTableStringLabel &lt;- cbind("241 to 244" = rep("1", 5),
                              "244 to 246" = c("1", "1", "0", "0", "0"),
                              "246 to 248" = c("1", "?", "0", "0", "0"))
rownames(dataTableStringLabel) &lt;- c("GadusMorhua", "GadusMacrocephalus",
                                    "GadusChalcogrammus", "ArctogadusGlacials",
                                    "BoreogadusSaida")
# Use function
score_tip(character_table = dataTable, species_name = "GadusMorhua",
          include_unknown = TRUE)
score_tip(character_table = dataTableStringLabel, species_name = "GadusMorhua",
          include_unknown = FALSE)
</code></pre>

<hr>
<h2 id='score_tree'>Helper function to assign bin scores to every tip in a given tree</h2><span id='topic+score_tree'></span>

<h3>Description</h3>

<p>Helper function to assign bin scores to every tip in a given tree
</p>


<h3>Usage</h3>

<pre><code class='language-R'>score_tree(tree_data, include_unknown = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="score_tree_+3A_tree_data">tree_data</code></td>
<td>
<p>a list of two elements (phy and data) resulting from using
the function <code><a href="geiger.html#topic+treedata">treedata</a></code>.</p>
</td></tr>
<tr><td><code id="score_tree_+3A_include_unknown">include_unknown</code></td>
<td>
<p>(logical) whether or not there are unknown tips.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list of two elements (phy and data). Data is the median bin scored
as present or present + unknown.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Simulate data table
dataTable &lt;- cbind("241" = rep("1", 5),
                   "242" = rep("1", 5),
                   "243" = c("1", "1", "0", "0", "0"),
                   "244" = c("1", "1", "0", "0", "0"),
                   "245" = c("1", "?", "0", "0", "0"))
rownames(dataTable) &lt;- c("GadusMorhua", "GadusMacrocephalus",
                         "GadusChalcogrammus", "ArctogadusGlacials",
                         "BoreogadusSaida")

# a simple tree
data("tree5", package = "nichevol")
tree5$tip.label &lt;- c("GadusMorhua", "GadusMacrocephalus",
                     "GadusChalcogrammus", "ArctogadusGlacials",
                     "BoreogadusSaida")

# Unite data
treeWithData &lt;- geiger::treedata(tree5, dataTable)

# Get a new tree with tips scored from median bin scores
score_tree(treeWithData, include_unknown = TRUE)
</code></pre>

<hr>
<h2 id='set_uncertainty'>Set values of uncertainty towards one or both ends of the variable</h2><span id='topic+set_uncertainty'></span>

<h3>Description</h3>

<p>set_uncertainty allows to define uncertainty (&quot;?&quot;) values
around values denoting presence (&quot;1&quot;) towards one or both ends of the
variable in a table of binary characters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_uncertainty(character_table, species, end)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_uncertainty_+3A_character_table">character_table</code></td>
<td>
<p>a matrix of characters to represent ecological niches
of the species of interest. A matrix containing values &quot;1&quot; = presence,
&quot;0&quot; = absence, and &quot;?&quot; = uncertain. See <code><a href="#topic+bin_table">bin_table</a></code>.</p>
</td></tr>
<tr><td><code id="set_uncertainty_+3A_species">species</code></td>
<td>
<p>(character) name of the species in the table for which values
of uncertainty will be set.</p>
</td></tr>
<tr><td><code id="set_uncertainty_+3A_end">end</code></td>
<td>
<p>(character) end towards which uncertainty values (&quot;?&quot;) will be set.
Options are: &quot;high&quot;, &quot;low&quot;, or &quot;both&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Values of characters around those denoting presence (&quot;1&quot;) are manually
transformed to uncertain (&quot;?&quot;) to help producing more conservative
reconstructions of ancestral ecological niches. This increases uncertainty in
reconstructions and further niche comparisons, which reduces the events of
niche change that can be detected. This may be especially useful when dealing
with species with one or just a few known records.
</p>


<h3>Value</h3>

<p>A modified matrix of characters to represent ecological niches of the
species of interest.
</p>
<p>Potential values for characters are:
</p>

<ul>
<li><p> &quot;1&quot; = the species is present in those environmental conditions.
</p>
</li>
<li><p> &quot;0&quot; = the species is not present in those environmental conditions. This is,
those environmental conditions inside the accessible area (M) are more extreme
than the ones used for the species.
</p>
</li>
<li><p> &quot;?&quot; = there is no certainty about the species presence in those environmental
conditions.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># a character table
data("character_table", package = "nichevol")

character_table[, 20:28]

# set values of uncertainty towards the lower end of the variable for species t3
char_tableu &lt;- set_uncertainty(character_table, species = "t2", end = "low")

char_tableu[, 20:28]
</code></pre>

<hr>
<h2 id='sig_sq'>Helper function to get sigma squared values for a given dataset</h2><span id='topic+sig_sq'></span>

<h3>Description</h3>

<p>Sigma squared values for a single niche summary statistic
are calculated using <code><a href="geiger.html#topic+fitContinuous">fitContinuous</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sig_sq(tree_data, model = "BM")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sig_sq_+3A_tree_data">tree_data</code></td>
<td>
<p>a list of two elements (phy and data) resulted from using
the function <code><a href="geiger.html#topic+treedata">treedata</a></code>. NOTE: data must be a single
vector (i.e., a single column).</p>
</td></tr>
<tr><td><code id="sig_sq_+3A_model">model</code></td>
<td>
<p>model to fit to comparative data; see
<code><a href="geiger.html#topic+fitContinuous">fitContinuous</a></code>. Default = &quot;BM&quot;.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the sigma squared value (evolutionary rate) for the data, given the
tree.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># a simple tree
data("tree5", package = "nichevol")

# simple data
data &lt;- rnorm(n = length(tree5$tip.label))
names(data) &lt;- tree5$tip.label
# tree with data
treeWdata &lt;- geiger::treedata(tree5, data)

# Estimating sigma squared for the dataset
sig_sq(treeWdata)
</code></pre>

<hr>
<h2 id='smooth_rec'>Smooth character table values resulted from ancestral character state reconstructions</h2><span id='topic+smooth_rec'></span>

<h3>Description</h3>

<p>Smooth character table values resulted from ancestral character state reconstructions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>smooth_rec(whole_rec_table)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="smooth_rec_+3A_whole_rec_table">whole_rec_table</code></td>
<td>
<p>matrix containing all reconstructed characters for all
tips and nodes. It results from using the functions <code><a href="#topic+bin_par_rec">bin_par_rec</a></code>
or <code><a href="#topic+bin_ml_rec">bin_ml_rec</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The matrix of reconstructed characters with smoothed values.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># a simple tree
data("tree5", package = "nichevol")

# simple matrix of data
dataTable &lt;- cbind("241" = rep("1", length(tree5$tip.label)),
                   "242" = rep("1", length(tree5$tip.label)),
                   "243" = c("1", "1", "0", "0", "0"),
                   "244" = c("1", "1", "0", "0", "0"),
                   "245" = c("1", "?", "0", "0", "0"))
rownames(dataTable) &lt;- tree5$tip.label
treeWdata &lt;- geiger::treedata(tree5, dataTable)

# ancestral reconstruction
parsimonyReconstruction &lt;- bin_par_rec(treeWdata)

# smoothing reconstructions
smooth_rec(parsimonyReconstruction)
</code></pre>

<hr>
<h2 id='stats_eval'>Statistics of environmental conditions in M and for occurrences (one variable)</h2><span id='topic+stats_eval'></span>

<h3>Description</h3>

<p>stats_eval helps in creating tables of descriptive statistics
of environmental conditions in accessible areas (M) and occurrence
records for one environmental variable at a time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stats_eval(stats = c("median", "range"), Ms, occurrences, species,
           longitude, latitude, variable, percentage_out = 0, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stats_eval_+3A_stats">stats</code></td>
<td>
<p>(character) name or vector of names of functions to be applied
to get basic statistics of environmental values.</p>
</td></tr>
<tr><td><code id="stats_eval_+3A_ms">Ms</code></td>
<td>
<p>a list of SpatVector objects representing the accessible area
(M) for each species to be analyzed. The order of species represented by each
object here must coincide with the one in <code>occurrences</code>. See details.</p>
</td></tr>
<tr><td><code id="stats_eval_+3A_occurrences">occurrences</code></td>
<td>
<p>a list of data.frames of occurrence records for all species.
The order of species represented by each data.frame must coincide with the one
in <code>Ms</code>. See details.</p>
</td></tr>
<tr><td><code id="stats_eval_+3A_species">species</code></td>
<td>
<p>(character) name of the column in occurrence data.frames that
contains the name of the species.</p>
</td></tr>
<tr><td><code id="stats_eval_+3A_longitude">longitude</code></td>
<td>
<p>(character) name of the column in occurrence files containing
values of longitude.</p>
</td></tr>
<tr><td><code id="stats_eval_+3A_latitude">latitude</code></td>
<td>
<p>(character) name of the column in occurrence files containing
values of latitude.</p>
</td></tr>
<tr><td><code id="stats_eval_+3A_variable">variable</code></td>
<td>
<p>a single SpatRaster layer of an environmental variable of
interest. See details.</p>
</td></tr>
<tr><td><code id="stats_eval_+3A_percentage_out">percentage_out</code></td>
<td>
<p>(numeric) percentage of extreme environmental data in M
to be excluded in bin creation for further analyses. See details. Default = 0.</p>
</td></tr>
<tr><td><code id="stats_eval_+3A_verbose">verbose</code></td>
<td>
<p>(logical) whether messages should be printed. Default = TRUE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Coordinates in <code>occurrences</code>, SpatVector objects in <code>Ms</code>, and
SpatRaster in <code>variable</code> must coincide in the geographic projection in
which they are represented. WGS84 with no planar projection is recommended.
</p>
<p>Accessible area (M) is understood as the geographic area that has been
accessible for a species for relevant periods of time. Defining M is usually
a hard task, but also a very important one, because it allows identifying
uncertainties about the ability of a species to maintain populations in
certain environmental conditions. For further details on this topic, see
Barve et al. (2011) <a href="doi:10.1016/j.ecolmodel.2011.02.011">doi:10.1016/j.ecolmodel.2011.02.011</a>
and Machado-Stredel et al. (2021) <a href="doi:10.21425/F5FBG48814">doi:10.21425/F5FBG48814</a>.
</p>
<p>The percentage to be defined in <code>percentage_out</code> excludes a percentage
of extreme environmental values to prevent from considering extremely rare
environmental values in the accessible area for the species (M). Being too
rare, these values may have never been explored by the species; therefore,
including them in the process of preparation of the table of characters
(bin table) is risky.
</p>


<h3>Value</h3>

<p>A list containing tables with statistics of the values in <code>variable</code>,
for the species M and occurrences.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># example data
## list of species records
data("occ_list", package = "nichevol")

## list of species accessible areas
m_files &lt;- list.files(system.file("extdata", package = "nichevol"),
                      pattern = "m\\d.gpkg", full.names = TRUE)

m_list &lt;- lapply(m_files, terra::vect)

## raster variable
temp &lt;- terra::rast(system.file("extdata", "temp.tif", package = "nichevol"))

# running stats
stat &lt;- stats_eval(stats = c("mean", "sd", "median", "range", "quantile"),
                   Ms = m_list, occurrences = occ_list, species = "species",
                   longitude = "x", latitude = "y", variable = temp,
                   percentage_out = 0)
</code></pre>

<hr>
<h2 id='stats_evalues'>Statistics of environmental conditions in M and for occurrences (multiple variables)</h2><span id='topic+stats_evalues'></span>

<h3>Description</h3>

<p>stats_evalues helps in creating csv files with statistics
of environmental conditions in accessible areas (M) and species occurrence
records. This is done using data read directly from a local directory, and
can be applied to various species and multiple variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stats_evalues(stats = c("median", "range"), M_folder, M_format, occ_folder,
              longitude, latitude, var_folder, var_format, round = FALSE,
              round_names, multiplication_factor = 1, percentage_out = 0,
              save = FALSE, output_directory, overwrite = FALSE,
              verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="stats_evalues_+3A_stats">stats</code></td>
<td>
<p>(character) name or vector of names of functions to be applied
to get basic statistics of environmental values.</p>
</td></tr>
<tr><td><code id="stats_evalues_+3A_m_folder">M_folder</code></td>
<td>
<p>(character) name of the folder containing files representing
the accessible area (M) for each species to be analyzed. See details.</p>
</td></tr>
<tr><td><code id="stats_evalues_+3A_m_format">M_format</code></td>
<td>
<p>format of files representing the accessible area (M) for the
species. Names of M files must match the ones for occurrence files in
<code>occ_folder</code>. Format options are: &quot;shp&quot;, &quot;gpkg&quot;, or any of the options
supported by <code><a href="terra.html#topic+rast">rast</a></code> (e.g., &quot;tif&quot; or &quot;asc&quot;).</p>
</td></tr>
<tr><td><code id="stats_evalues_+3A_occ_folder">occ_folder</code></td>
<td>
<p>(character) name of the folder containing csv files of
occurrence data for all species. Names of csv files must match the ones of M
files in <code>M_folder</code>.</p>
</td></tr>
<tr><td><code id="stats_evalues_+3A_longitude">longitude</code></td>
<td>
<p>(character) name of the column in occurrence files containing
values of longitude.</p>
</td></tr>
<tr><td><code id="stats_evalues_+3A_latitude">latitude</code></td>
<td>
<p>(character) name of the column in occurrence files containing
values of latitude.</p>
</td></tr>
<tr><td><code id="stats_evalues_+3A_var_folder">var_folder</code></td>
<td>
<p>(character) name of the folder containing layers to
represent environmental variables.</p>
</td></tr>
<tr><td><code id="stats_evalues_+3A_var_format">var_format</code></td>
<td>
<p>format of layers to represent environmental variables.
Format options are all the ones supported by <code><a href="terra.html#topic+rast">rast</a></code>
(e.g., &quot;tif&quot; or &quot;asc&quot;).</p>
</td></tr>
<tr><td><code id="stats_evalues_+3A_round">round</code></td>
<td>
<p>(logical) whether or not to round the values of one or more
variables after multiplying them times the value in <code>multiplication_factor</code>.
Default = FALSE. See details.</p>
</td></tr>
<tr><td><code id="stats_evalues_+3A_round_names">round_names</code></td>
<td>
<p>(character) names of the variables to be rounded.
Default = NULL. If <code>round</code> = TRUE, names must be defined.</p>
</td></tr>
<tr><td><code id="stats_evalues_+3A_multiplication_factor">multiplication_factor</code></td>
<td>
<p>(numeric) value to be used to multiply the
variables defined in <code>round_names</code>. Default = 1.</p>
</td></tr>
<tr><td><code id="stats_evalues_+3A_percentage_out">percentage_out</code></td>
<td>
<p>(numeric) percentage of extreme environmental data in M
to be excluded in bin creation for further analyses. See details. Default = 0.</p>
</td></tr>
<tr><td><code id="stats_evalues_+3A_save">save</code></td>
<td>
<p>(logical) whether or not to save the results in working directory.
Default = FALSE.</p>
</td></tr>
<tr><td><code id="stats_evalues_+3A_output_directory">output_directory</code></td>
<td>
<p>(character) name of the folder in which results will
be written.</p>
</td></tr>
<tr><td><code id="stats_evalues_+3A_overwrite">overwrite</code></td>
<td>
<p>(logical) whether or not to overwrite existing results in
<code>output_directory</code>. Default = FALSE.</p>
</td></tr>
<tr><td><code id="stats_evalues_+3A_verbose">verbose</code></td>
<td>
<p>(logical) whether messages should be printed. Default = TRUE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Coordinates in csv files in <code>occ_folder</code>, SpatVector-like files in
<code>M_folder</code>, and raster layers in <code>var_folder</code> must coincide in the
geographic projection in which they are represented. WGS84 with no planar
projection is recommended.
</p>
<p>Accessible area (M) is understood as the geographic area that has been
accessible for a species for relevant periods of time. Defining M is usually
a hard task, but also a very important one, because it allows identifying
uncertainties about the ability of a species to maintain populations in
certain environmental conditions. For further details on this topic, see
Barve et al. (2011) <a href="doi:10.1016/j.ecolmodel.2011.02.011">doi:10.1016/j.ecolmodel.2011.02.011</a>
and Machado-Stredel et al. (2021) <a href="doi:10.21425/F5FBG48814">doi:10.21425/F5FBG48814</a>.
</p>
<p>Rounding variables may be useful when multiple variables are considered and
the values of some or all of them are too small (e.g., when using principal
components). To round specific variables arguments <code>round</code>,
<code>round_names</code>, and <code>multiplication_factor</code>, must be used accordingly.
</p>
<p>The percentage to be defined in <code>percentage_out</code> excludes a percentage
of extreme environmental values to prevent the algorithm from considering
extremely rare environmental values in the accessible area for the species (M).
Being too rare, these values may have never been explored by the species;
therefore, including them in the process of preparation of the table of
characters (bin table) is risky.
</p>


<h3>Value</h3>

<p>A list named as the variables present in <code>var_folder</code>, containing all
tables with statistics of environmental values in M and in species records.
A folder named as in <code>output_directory</code> containing all resultant csv
files with the tables of statistics will be created if <code>save</code> is set as
TRUE.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># preparing data and directories for examples
## directories
tempdir &lt;- file.path(tempdir(), "nevol_test")
dir.create(tempdir)

cvariables &lt;- paste0(tempdir, "/variables")
dir.create(cvariables)

records &lt;- paste0(tempdir, "/records")
dir.create(records)

m_areas &lt;- paste0(tempdir, "/M_areas")
dir.create(m_areas)

## data
data("occ_list", package = "nichevol")

temp &lt;- system.file("extdata", "temp.tif", package = "nichevol")

m_files &lt;- list.files(system.file("extdata", package = "nichevol"),
                      pattern = "m\\d.gpkg", full.names = TRUE)

## writing data in temporal directories
spnames &lt;- sapply(occ_list, function (x) as.character(x[1, 1]))
ocnames &lt;-  paste0(records, "/", spnames, ".csv")

occs &lt;- lapply(1:length(spnames), function (x) {
  write.csv(occ_list[[x]], ocnames[x], row.names = FALSE)
})

to_replace &lt;- paste0(system.file("extdata", package = "nichevol"), "/")

otemp &lt;- gsub(to_replace, "", temp)
file.copy(from = temp, to = paste0(cvariables, "/", otemp))

file.copy(from = m_files, to = paste0(m_areas, "/", spnames, ".gpkg"))
stats &lt;- stats_evalues(stats = c("median", "range"), M_folder = m_areas,
                       M_format = "gpkg", occ_folder = records,
                       longitude = "x", latitude = "y",
                       var_folder = cvariables, var_format = "tif",
                       percentage_out = 5)
</code></pre>

<hr>
<h2 id='temp'>Example of an environmental variable used in analysis</h2><span id='topic+temp'></span>

<h3>Description</h3>

<p>A SpatRaster object representing the variable temperature.
</p>


<h3>Format</h3>

<p>A SpatRaster object.
</p>


<h3>Value</h3>

<p>No return value, used with function <code><a href="terra.html#topic+rast">rast</a></code> to
bring an example of an environmental variable used in analysis.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>temp &lt;- terra::rast(system.file("extdata", "temp.tif", package = "nichevol"))

terra::plot(temp)
</code></pre>

<hr>
<h2 id='tree'>Example of a phylogenetic tree for six species</h2><span id='topic+tree'></span>

<h3>Description</h3>

<p>A phylogenetic tree with 6 species and their relationships.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tree
</code></pre>


<h3>Format</h3>

<p>An object of class phylo for 6 species.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("tree", package = "nichevol")

str(tree)
</code></pre>

<hr>
<h2 id='tree_data'>Example of a list containing a tree and a table of characters for six species</h2><span id='topic+tree_data'></span>

<h3>Description</h3>

<p>A list of 2 elements (phy and data) resulting from using the function
<code><a href="geiger.html#topic+treedata">treedata</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tree_data
</code></pre>


<h3>Format</h3>

<p>A list of 2 elements:
</p>

<dl>
<dt>phy</dt><dd><p>object of class phylo for 6 species</p>
</dd>
<dt>data</dt><dd><p>matrix of 6 rows and 28 columns</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>data("tree_data", package = "nichevol")

str(tree_data)
</code></pre>

<hr>
<h2 id='tree5'>Example of a phylogenetic tree for five species</h2><span id='topic+tree5'></span>

<h3>Description</h3>

<p>A phylogenetic tree with 5 species and their relationships.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tree5
</code></pre>


<h3>Format</h3>

<p>An object of class phylo for 5 species.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("tree5", package = "nichevol")

str(tree5)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
