<!DOCTYPE html><html lang="en"><head><title>Help for package CaseCohortCoxSurvival</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {CaseCohortCoxSurvival}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#CaseCohortCoxSurvival-package'>
<p>Case-Cohort Cox Survival Inference</p></a></li>
<li><a href='#auxiliary.construction'><p>auxiliary.construction</p></a></li>
<li><a href='#calibration'><p>calibration</p></a></li>
<li><a href='#caseCohortCoxSurvival'><p>Parameter and variance estimation for case-cohort analyses under the Cox model</p></a></li>
<li><a href='#dataexample'>
<p>[Deprecated] Data for examples</p></a></li>
<li><a href='#dataexample.missingdata'>
<p>[Deprecated] Data for examples with missing data</p></a></li>
<li><a href='#dataexample.missingdata.stratified'>
<p>Example of case-cohort with stratified sampling of the subcohort and missing covariate information in phase-two data</p></a></li>
<li><a href='#dataexample.missingdata.unstratified'>
<p>Example of case-cohort with unstratified sampling of the subcohort and missing covariate information in phase-two data</p></a></li>
<li><a href='#dataexample.stratified'>
<p>Example of case-cohort with stratified sampling of the subcohort, and set of auxiliary variables</p></a></li>
<li><a href='#dataexample.unstratified'>
<p>Example of case-cohort with unstratified sampling of the subcohort, and set of auxiliary variables</p></a></li>
<li><a href='#deprecateddata'>
<p>Deprecated data sets in CaseCohortCoxSurvival</p></a></li>
<li><a href='#estimatePureRisk'><p>estimatePureRisk</p></a></li>
<li><a href='#estimation'><p>estimation</p></a></li>
<li><a href='#estimation.CumBH'><p>estimation.CumBH</p></a></li>
<li><a href='#estimation.PR'><p>estimation.PR</p></a></li>
<li><a href='#estimation.weights.phase3'><p>estimation.weights.phase3</p></a></li>
<li><a href='#influences'><p>influences</p></a></li>
<li><a href='#influences.CumBH'><p>influences.CumBH</p></a></li>
<li><a href='#influences.CumBH.missingdata'><p>influences.CumBH.missingdata</p></a></li>
<li><a href='#influences.missingdata'><p>influences.missingdata</p></a></li>
<li><a href='#influences.PR'><p>influences.PR</p></a></li>
<li><a href='#influences.PR.missingdata'><p>influences.PR.missingdata</p></a></li>
<li><a href='#influences.RH'><p>influences.RH</p></a></li>
<li><a href='#influences.RH.missingdata'><p>influences.RH.missingdata</p></a></li>
<li><a href='#product.covar.weight'><p>product.covar.weight</p></a></li>
<li><a href='#robustvariance'><p>robustvariance</p></a></li>
<li><a href='#variance'><p>variance</p></a></li>
<li><a href='#variance.missingdata'><p>variance.missingdata</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Case-Cohort Cox Survival Inference</td>
</tr>
<tr>
<td>Version:</td>
<td>0.0.36</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-09-23</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Lola Etievant &lt;lola.etievant@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Cox model inference for relative hazard and covariate-specific pure risk estimated 
             from stratified and unstratified case-cohort data as described in 
             Etievant, L., Gail, M.H. (Lifetime Data Analysis, 2024) &lt;<a href="https://doi.org/10.1007%2Fs10985-024-09621-2">doi:10.1007/s10985-024-09621-2</a>&gt;.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0), survival</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>nnet</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Author:</td>
<td>Lola Etievant [cre, aut],
  Mitchell H. Gail [aut],
  Bill Wheeler [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-09-23 15:36:29 UTC; etievantle</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-09-23 22:00:25 UTC</td>
</tr>
</table>
<hr>
<h2 id='CaseCohortCoxSurvival-package'>
Case-Cohort Cox Survival Inference
</h2><span id='topic+CaseCohortCoxSurvival'></span><span id='topic+CaseCohortCoxSurvival-package'></span>

<h3>Description</h3>

<p>This package uses case-cohort data to estimate log-relative hazard,
baseline hazards at each unique event time,
cumulative baseline hazard in a given time interval and pure risk on the time interval and for a given
covariate profile, under the Cox model. For the corresponding variance estimation,
it relies on influence functions and follows the
complete variance decomposition, to enable correct analysis of case-cohort data
with and without stratification,
weight calibration or missing phase-two covariate data.
</p>


<h3>Details</h3>

<p>The package provides functions implementing the methods described in Etievant and Gail (2024). More
precisely, it includes
</p>

<ul>
<li><p> a main driver function, <code><a href="#topic+caseCohortCoxSurvival">caseCohortCoxSurvival</a></code>.
</p>
</li>
<li><p> one function, <code><a href="#topic+estimatePureRisk">estimatePureRisk</a></code>, to estimate pure risks and the corresponding variances with additional covariate profiles.
</p>
</li>
<li><p> three functions, <code><a href="#topic+estimation">estimation</a></code>, <code><a href="#topic+estimation.CumBH">estimation.CumBH</a></code> and 
<code><a href="#topic+estimation.PR">estimation.PR</a></code>, for parameters estimation.
</p>
</li>
<li><p> four functions, <code><a href="#topic+influences">influences</a></code>, <code><a href="#topic+influences.RH">influences.RH</a></code>, 
<code><a href="#topic+influences.CumBH">influences.CumBH</a></code> and  <code><a href="#topic+influences.PR">influences.PR</a></code>, for influence functions
derivation when estimation is with design or calibrated weights and from a 
case-cohort consisting of the subcohort and cases not in the subcohort 
(i.e., case-cohort obtained from two phases of sampling).
</p>
</li>
<li><p> four functions, <code><a href="#topic+influences.missingdata">influences.missingdata</a></code>, <code><a href="#topic+influences.RH.missingdata">influences.RH.missingdata</a></code>, 
<code><a href="#topic+influences.CumBH.missingdata">influences.CumBH.missingdata</a></code> and <code><a href="#topic+influences.PR.missingdata">influences.PR.missingdata</a></code>,
for influence functions derivation when estimation is with design
weights and from a case-cohort when covariate information was missing for 
certain individuals in the phase-two data 
(i.e., case-cohort obtained from three phases of sampling).
</p>
</li>
<li><p> two functions, <code><a href="#topic+variance">variance</a></code> and <code><a href="#topic+variance.missingdata">variance.missingdata</a></code>,
for variance estimation following complete variance
decomposition (with design or calibrated weights and without missing 
phase-two data, or with design weights and missing phase-two covariate data).
</p>
</li>
<li><p> one function, <code><a href="#topic+robustvariance">robustvariance</a></code>, for robust variance estimation.
</p>
</li>
<li><p> one function, <code><a href="#topic+auxiliary.construction">auxiliary.construction</a></code>, to compute the auxiliary
variables proposed by Breslow et al. (Stat. Biosci., 2009), Breslow and Lumley (IMS, 2013), and Shin et al. (Biometrics, 2020),.
</p>
</li>
<li><p> one function, <code><a href="#topic+calibration">calibration</a></code>, for weight calibration.
</p>
</li>
<li><p> one function, <code><a href="#topic+estimation.weights.phase3">estimation.weights.phase3</a></code>, for estimating the phase-three weights.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Lola Etievant, Mitchell H. Gail</p>


<h3>References</h3>

<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>
<p>Etievant, L., Gail, M. H. (2024). Software Application Profile: CaseCohortCoxSurvival: an R package for case-cohort inference for relative hazard and pure risk under the Cox model. Submitted.
</p>

<hr>
<h2 id='auxiliary.construction'>auxiliary.construction</h2><span id='topic+auxiliary.construction'></span>

<h3>Description</h3>

<p>Creates the auxiliary variables proposed by Breslow et al. (Stat. Biosci., 2009),
Breslow and Lumley (IMS, 2013), and proposed by Shin et al. (Biometrics, 2020).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>auxiliary.construction(mod, Tau1 = NULL, Tau2 = NULL, method = "Breslow",
time.on.study = NULL, casecohort = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="auxiliary.construction_+3A_mod">mod</code></td>
<td>
<p>A cox model object, result of function coxph run on the cohort data with imputed covariate values.</p>
</td></tr>
<tr><td><code id="auxiliary.construction_+3A_tau1">Tau1</code></td>
<td>
<p>Left bound of the time interval considered for the cumulative baseline hazard.
Default is the first event time.</p>
</td></tr>
<tr><td><code id="auxiliary.construction_+3A_tau2">Tau2</code></td>
<td>
<p>Right bound of the time interval considered for the cumulative baseline hazard.
Default is the last event time.</p>
</td></tr>
<tr><td><code id="auxiliary.construction_+3A_method">method</code></td>
<td>
<p>&quot;Breslow&quot;, &quot;Breslow2013&quot; or &quot;Shin&quot; to specify the algorithm to construct
the auxiliary variables. The default is &quot;Breslow&quot;.</p>
</td></tr>
<tr><td><code id="auxiliary.construction_+3A_time.on.study">time.on.study</code></td>
<td>
<p>Total folow-up time in <code>[Tau1, Tau2]</code>.
Required for <code>method</code> = &quot;Shin&quot;.</p>
</td></tr>
<tr><td><code id="auxiliary.construction_+3A_casecohort">casecohort</code></td>
<td>
<p>Data frame containing the casecohort data.
It must include columns &quot;weights&quot; containing
the design weights and &quot;id&quot; as an id variable.
Required for <code>method</code> = &quot;Shin&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Construction of the auxiliary variables can follow Breslow et al. (2009),
Breslow and Lumley (2013), or Shin et al. (2020) (method).
It relies on predictions of the phase-two covariates for all members of the cohort.
The auxiliary variables are given by (i) the influences for the log-relative hazard parameters
estimated from the Cox model with imputed cohort data;
(ii) the influences for the cumulative baseline parameter estimated from the Cox model with
imputed cohort data;
(iii) the products of total follow-up time (on the time interval for which pure risk is to be estimated)
with the estimated relative hazard for the imputed cohort data,
where the log-relative hazard parameters are estimated from the Cox model with case-cohort data and
weights calibrated with (i).
When method = Breslow, calibration of the design weights is against (i),
as proposed by Breslow et al. (2009) to improve efficiency of case-cohort estimates of relative hazard.
When method = Breslow2013, calibration of the design weights is against (i) and (ii),
as proposed by Breslow and Lumley (2013) to also improve efficiency of case-cohort estimates
of cumulative baseline hazard.
When method = Shin, calibration is against (i) and (iii), as proposed by Shin et al. (2020)
to improve efficiency of relative hazard and pure risk estimates under the nested case-control design.
See Etievant and Gail (2024).
</p>
<p>Following Etievant and Gail (2024), in function <code><a href="#topic+caseCohortCoxSurvival">caseCohortCoxSurvival</a></code>
we only provide calibration
of the design weight as proposed by Breslow et al. (2009) or Shin et al. (2020).
</p>


<h3>Value</h3>

<p><code>A.RH.Breslow</code>: matrix with the influences on the log-relative hazard,
estimated from the cohort with imputed phase-two covariate
values for <code>method</code> = &quot;Breslow&quot; and
<code>method</code> = &quot;Breslow2013&quot;.
</p>
<p><code>A.CumBH.Breslow</code>: matrix with the influences on the cumulative baseline
hazard in <code>[Tau1, Tau2]</code>,
estimated from the cohort with imputed phase-two
covariate values for <code>method</code> = &quot;Breslow2013&quot;.
</p>
<p><code>A.RH.Shin</code>: matrix with the influences on the log-relative hazard,
estimated from the cohort with imputed phase-two covariate
values for <code>method</code> = &quot;Shin&quot;.
</p>
<p><code>A.PR.Shin</code>: matrix with the products of total follow-up times in
<code>[Tau1, Tau2]</code> and estimated relative hazards,
estimated from the cohort with imputed phase-two
covariate values for <code>method</code> = &quot;Shin&quot;.
</p>


<h3>References</h3>

<p>Breslow, N.E. and Lumley, T. (2013). Semiparametric models and two-phase samples: Applications to Cox
regression. From Probability to Statistics and Back: High-Dimensional Models and Processes, 9, 65-78.
</p>
<p>Breslow, N.E., Lumley, T., Ballantyne, C.M., Chambless, L.E. and Kulich, M. (2009). Improved Horvitz-Thompson Estimation of Model Parameters from Two-phase Stratified Samples: Applications in Epidemiology.
Statistics in Biosciences, 1, 32-49.
</p>
<p>Shin Y.E., Pfeiffer R.M., Graubard B.I., Gail M.H. (2020) Weight calibration to improve
the efficiency of pure risk estimates from case-control samples nested in a cohort.
Biometrics, 76, 1087-1097.
</p>
<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>


<h3>See Also</h3>

 <p><code><a href="#topic+calibration">calibration</a></code>, <code><a href="#topic+influences">influences</a></code>, <code><a href="#topic+influences.RH">influences.RH</a></code>,
<code><a href="#topic+influences.CumBH">influences.CumBH</a></code> and <code><a href="#topic+influences.PR">influences.PR</a></code>. </p>


<h3>Examples</h3>

<pre><code class='language-R'>
  data(dataexample.stratified, package="CaseCohortCoxSurvival")
  cohort &lt;- dataexample.stratified$cohort
  Tau1   &lt;- 0
  Tau2   &lt;- 8

  # Running the coxph model on the imputed cohort data
  mod.imputedcohort &lt;- coxph(Surv(event.time, status) ~ X1.pred + X2 + X3.pred,
                             data = cohort, robust = TRUE)

  # method = Breslow
  ret &lt;- auxiliary.construction(mod.imputedcohort)
  # print auxiliary variables based on the log-relative hazard influences
  ret$A.RH.Breslow[1:5,]

  # Example for method = Shin, variables names must match with fitted model
  casecohort &lt;- cohort[which(cohort$status == 1 |
                       cohort$subcohort == 1),] # the stratified case-cohort
  casecohort$weights &lt;- casecohort$strata.n / casecohort$strata.m
  casecohort$weights[which(casecohort$status == 1)] &lt;- 1
  casecohort[, "X1.pred"] &lt;- casecohort[, "X1"]
  casecohort[, "X3.pred"] &lt;- casecohort[, "X3"]

  time.on.study &lt;- pmax(pmin(Tau2, cohort$event.time) - Tau1, 0)
  ret &lt;- auxiliary.construction(mod.imputedcohort, method = "Shin",
                                time.on.study = time.on.study, casecohort = casecohort)
  ret$A.PR.Shin[1:5]

</code></pre>

<hr>
<h2 id='calibration'>calibration</h2><span id='topic+calibration'></span>

<h3>Description</h3>

<p>Calibrates the design weights using the raking procedure.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calibration(A.phase2, design.weights, total, eta0 = NULL, niter.max = NULL,
epsilon.stop = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calibration_+3A_a.phase2">A.phase2</code></td>
<td>
<p>matrix with the values of the q auxiliary variables to be used for
the calibration of the weights in the case-cohort (phase-two data).</p>
</td></tr>
<tr><td><code id="calibration_+3A_design.weights">design.weights</code></td>
<td>
<p>design weights to be calibrated.</p>
</td></tr>
<tr><td><code id="calibration_+3A_total">total</code></td>
<td>
<p>vector of length q with un-weighted auxiliary variable totals in the whole cohort.</p>
</td></tr>
<tr><td><code id="calibration_+3A_eta0">eta0</code></td>
<td>
<p>vector of length q with initial values for <code>eta</code> (the Lagrangian multipliers),
to be used as seed in the iterative procedure. Default is (0, ... ,0).</p>
</td></tr>
<tr><td><code id="calibration_+3A_niter.max">niter.max</code></td>
<td>
<p>maximum number of iterations for the iterative optimization algorithm.
Default is 10^4 iterations.</p>
</td></tr>
<tr><td><code id="calibration_+3A_epsilon.stop">epsilon.stop</code></td>
<td>
<p>threshold for the difference between the estimated weighted total
and the total in the whole cohort.
If this difference is less than the value of epsilon.stop,
no more iterations will be performed.
Default is 10^(-10).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Calibration matches the weighted total of the auxiliary variables in the case-cohort
(with calibrated weights), to the un-weighted auxiliary variables total in the whole cohort.
In other words, it solves in <code class="reqn">\eta</code>
<code class="reqn">\sum_{j=1}^J \sum_{i=1}^{n^{(j)}} \lbrace \xi_{i,j} w_{i,j}
      \text{exp}(\eta' A_{i,j}) A_{i,j} - A_{i,j} \rbrace = 0</code>,
with <code class="reqn">\xi_{i,j}</code> the sampling indicator and <code class="reqn">w_{i,j}</code> the design weight of
individual <code class="reqn">i</code> in stratum <code class="reqn">j</code>, and with
<code class="reqn">\sum_{j=1}^J \sum_{i=1}^{n^{(j)}} A_{i,j}</code>
the total in the whole cohort. See Etievant and Gail (2024). The Newton Raphson method is used to solve the optimization problem.
In the end, the calibrated weights of the case-cohort individuals are given by
<code class="reqn">w_{i,j} \text{exp}(\hat \eta' A_{i,j})</code>, and
<code class="reqn">\sum_{j=1}^J \sum_{i=1}^{n^{(j)}} \lbrace \xi_{i,j} w_{i,j}
     \text{exp}(\hat \eta' A_{i,j}) A_{i,j} \rbrace</code>
gives the estimated total.
</p>


<h3>Value</h3>

<p><code>eta.hat</code>: vector of length q with final eta values.
</p>
<p><code>calibrated.weights</code>: vector with the calibrated weights for the individuals
in the case-cohort (phase-two data), computed from <code>design.weights</code>,
<code>A.phase2</code> and <code>eta.hat</code>.
</p>
<p><code>estimated.total</code>: vector with the estimated totals, computed from the
<code>calibrated.weights</code> and <code>A.phase2</code>.
</p>


<h3>References</h3>

<p>Deville, J.C. and Sarndal, C.E. (1992). Calibration Estimators in Survey Sampling.
Journal of the American Statistical Association, 87, 376-382.
</p>
<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>


<h3>See Also</h3>

 <p><code><a href="#topic+auxiliary.construction">auxiliary.construction</a></code>, <code><a href="#topic+influences">influences</a></code>, <code><a href="#topic+influences.RH">influences.RH</a></code>, <code><a href="#topic+influences.CumBH">influences.CumBH</a></code> and <code><a href="#topic+influences.PR">influences.PR</a></code>. </p>


<h3>Examples</h3>

<pre><code class='language-R'>
  data(dataexample.stratified, package="CaseCohortCoxSurvival")
  cohort &lt;- dataexample.stratified$cohort
  casecohort &lt;- cohort[which(cohort$status == 1 |
                       cohort$subcohort == 1),] # the stratified case-cohort
  casecohort$weight &lt;- casecohort$strata.n / casecohort$strata.m
  casecohort$weight[which(casecohort$status == 1)] &lt;- 1

  A &lt;- dataexample.stratified$A # auxiliary variables values in the cohort
  indiv.phase2 &lt;- casecohort$id
  q &lt;- ncol(A)
  total &lt;- colSums(A)
  A.phase2 &lt;- A[indiv.phase2,]
  calib &lt;- calibration(A.phase2 = A[indiv.phase2,], design.weights = casecohort$weight,
                       total = total, eta0 = rep(0, q), niter.max = 10^3, epsilon.stop = 10^(-10))
  #calib$calibrated.weights # print calibrated weights

</code></pre>

<hr>
<h2 id='caseCohortCoxSurvival'>Parameter and variance estimation for case-cohort analyses under the Cox model</h2><span id='topic+caseCohortCoxSurvival'></span>

<h3>Description</h3>

<p>Function for estimating parameters (log-relative hazard, baseline hazards,
cumulative baseline hazard, pure risks) and their variance
(robust or the one accounting for sampling features) from cohort or case-cohort data,
under the Cox model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>caseCohortCoxSurvival(data, status, time, cox.phase1 = NULL, cox.phase2 = NULL,
other.covars = NULL, strata = NULL, weights.phase2 = NULL, calibrated = FALSE,
subcohort = NULL, subcohort.strata.counts = NULL, predict = TRUE,
predicted.cox.phase2 = NULL, predictors.cox.phase2 = NULL, aux.vars = NULL,
aux.method = "Shin", phase3 = NULL, strata.phase3 = NULL, weights.phase3 = NULL,
weights.phase3.type = "both", Tau1 = NULL, Tau2 = NULL, x = NULL,
weights.op = NULL, print = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="caseCohortCoxSurvival_+3A_data">data</code></td>
<td>
<p>Data frame containing the cohort and all variables needed for the analysis.</p>
</td></tr>
<tr><td><code id="caseCohortCoxSurvival_+3A_status">status</code></td>
<td>
<p>Column name in <code>data</code> giving the case status for each
individual in the cohort. This variable
must be coded as 0 for non-cases and 1 for cases.</p>
</td></tr>
<tr><td><code id="caseCohortCoxSurvival_+3A_time">time</code></td>
<td>
<p>Column name(s) in <code>data</code> giving the time to event for each individual
in the case-cohort. One variable
is required for a time-on-study time scale, two variables for age-scale,
with the first variable as the start age and second as the end age.</p>
</td></tr>
<tr><td><code id="caseCohortCoxSurvival_+3A_cox.phase1">cox.phase1</code></td>
<td>
<p>Column name(s) in <code>data</code> giving the Cox model covariates
measured on the entire cohort.
See covariates and prediction in details.</p>
</td></tr>
<tr><td><code id="caseCohortCoxSurvival_+3A_cox.phase2">cox.phase2</code></td>
<td>
<p>Column name(s) in <code>data</code> giving the Cox model covariates
measured only on phase-two individuals.
See covariates and prediction in details.</p>
</td></tr>
<tr><td><code id="caseCohortCoxSurvival_+3A_other.covars">other.covars</code></td>
<td>
<p>Column name(s) in data giving other covariates
measured on the entire cohort that might be useful,
alone or in combination with <code>cox.phase1</code>,
if predicted values of the phase-two covariates (<code>cox.phase2</code>)
need to be obtained on the whole cohort for the weight calibration.</p>
</td></tr>
<tr><td><code id="caseCohortCoxSurvival_+3A_strata">strata</code></td>
<td>
<p>NULL or column name in data with the stratum value for each
individual in the cohort. The number of strata used for the
sampling of the subcohort equals the number of different stratum values.
For example, a stratum variable might take values 0,1,2,3 or 4.
The default is NULL.</p>
</td></tr>
<tr><td><code id="caseCohortCoxSurvival_+3A_weights.phase2">weights.phase2</code></td>
<td>
<p>NULL or column name in data giving the phase-two design
weights for each individual in the cohort.
For a whole cohort analysis (see <code>subcohort</code> below),
weights are not used in the <code><a href="survival.html#topic+coxph">coxph</a></code> call.
If NULL but subcohort is not NULL, <code>subcohort.strata.counts</code>
will be used to estimate <code>weights.phase2</code>.
The default is NULL.</p>
</td></tr>
<tr><td><code id="caseCohortCoxSurvival_+3A_calibrated">calibrated</code></td>
<td>
<p>TRUE or FALSE to calibrate the <code>weights</code>.
Calibrated weights will be computed using the function
<code><a href="#topic+calibration">calibration</a></code>.
If TRUE, then <code>phase3</code> (below) will be set to NULL.
See calibration in details.
The default is FALSE.</p>
</td></tr>
<tr><td><code id="caseCohortCoxSurvival_+3A_subcohort">subcohort</code></td>
<td>
<p>NULL or column name in <code>data</code> giving the indicators
of membership in the subcohort.
The indicators are 1 if the individual belongs to the subcohort
and 0 otherwise. Some cases might be in the subcohort and others not.
If NULL, then a whole cohort analysis will be performed.
The default is NULL.</p>
</td></tr>
<tr><td><code id="caseCohortCoxSurvival_+3A_subcohort.strata.counts">subcohort.strata.counts</code></td>
<td>
<p>NULL or a list of the number of individuals sampled
into the subcohort from each stratum of strata.
The names in the list must be the strata values and the length of the
list must be equal to the number of strata.
If NULL, then the count for each stratum is estimated by the number of
subcohort individuals in each stratum.
The default is NULL.</p>
</td></tr>
<tr><td><code id="caseCohortCoxSurvival_+3A_predict">predict</code></td>
<td>
<p>TRUE or FALSE to predict the phase-two covariates using
<code>predictors.cox.phase2</code>. This option is not used if
<code>calibrated=FALSE</code>. If <code>calibrated=TRUE</code>, <code>aux.vars=NULL</code>
and <code>predict=FALSE</code>, then <code>predicted.cox.phase2</code> must be specified.
See covariates and prediction in details.
This option is only used when <code>calibrated=TRUE</code>, <code>aux.vars=NULL</code>
and <code>predicted.cox.phase2=NULL</code>.
The default is TRUE.</p>
</td></tr>
<tr><td><code id="caseCohortCoxSurvival_+3A_predicted.cox.phase2">predicted.cox.phase2</code></td>
<td>
<p>NULL or a named list giving the predicted values of the
phase-two covariates (<code>cox.phase2</code>) on the whole cohort. For example,
if the phase-two covariates are <code>X1</code> and <code>X2</code>, then the list is
of the form <code>list(X1=X1.pred, X2=X2.pred)</code>, where <code>X1.pred</code> and
<code>X2.pred</code> are the predictions of <code>X1</code> and <code>X2</code> respectively.
This option is only used when <code>calibrated=TRUE</code> and <code>aux.vars=NULL</code>.
If <code>calibrated=TRUE</code>, <code>aux.vars=NULL</code> and <code>predict=FALSE</code>,
then <code>predicted.cox.phase2</code> must be specified and must not contain missing values.
The default is NULL.</p>
</td></tr>
<tr><td><code id="caseCohortCoxSurvival_+3A_predictors.cox.phase2">predictors.cox.phase2</code></td>
<td>
<p>NULL, a vector, or a list specifying the columns in data
to use as predictor variables for obtaining the predicted values
on the whole cohort for the phase-two covariates (<code>cox.phase2</code>).
A list allows for different proxy variables to be used for the different
phase-two covariates. The selected predictor variables must be from among
<code>cox.phase1</code> and <code>other.covars</code>.
See examples and covariates and prediction in details.
If NULL, then the phase-two covariates will be predicted using <code>cox.phase1</code>
and <code>other.covars</code>. If NULL, <code>cox.phase1=NULL</code> and <code>other.covars=NULL</code>,
then the calibrated analysis will not be performed.
This option is only used when <code>calibrated=TRUE</code>, <code>aux.vars=NULL</code>, <br />
<code>predicted.cox.phase2=NULL</code> and <code>predict=TRUE</code>. The default is NULL.</p>
</td></tr>
<tr><td><code id="caseCohortCoxSurvival_+3A_aux.vars">aux.vars</code></td>
<td>
<p>NULL or column name(s) in data giving the auxiliary variables for
each individual in the cohort. This option is only used when
<code>calibrated=TRUE</code>. If NULL, then auxiliary variables will be constructed
using method Breslow or Shin and predicted values on the whole cohort for the
phase-two covariates (see <code>aux.method</code>, <code>predict</code>, <code>predicted.cox.phase2</code>
and <code>predictors.cox.phase2</code>). <code>aux.vars</code> must not contain missing values.
The default is NULL.</p>
</td></tr>
<tr><td><code id="caseCohortCoxSurvival_+3A_aux.method">aux.method</code></td>
<td>
<p>&quot;Breslow&quot;, or &quot;Shin&quot; to specify the algorithm to construct the
auxiliary variables. This option is only used if <code>aux.vars=NULL</code> and
<code>calibrated=TRUE</code>.
The default is &quot;Shin&quot;.</p>
</td></tr>
<tr><td><code id="caseCohortCoxSurvival_+3A_phase3">phase3</code></td>
<td>
<p>NULL or column name in data giving the indicators of membership in the in
the phase-three sample. The indicators are 1 if the individual belongs to the
phase-three sample and 0 otherwise. All individuals in the phase-three sample
must also belong to the phase-two sample.
This option is not used if <code>calibrated=TRUE</code>.
The default is NULL.</p>
</td></tr>
<tr><td><code id="caseCohortCoxSurvival_+3A_strata.phase3">strata.phase3</code></td>
<td>
<p>NULL or column name in <code>data</code> giving the phase-three stratification
for each individual in phase-two. The number of strata used for the third phase
of sampling equals the number of different stratum values.
The default is NULL.</p>
</td></tr>
<tr><td><code id="caseCohortCoxSurvival_+3A_weights.phase3">weights.phase3</code></td>
<td>
<p>NULL or column name in <code>data</code> giving the phase-three design weights
for each individual in phase-two.
If NULL but <code>phase3</code> is not NULL, then <code>phase3</code> and <code>subcohort</code>
will be used to estimate <code>weights.phase3</code> (see details in
<code><a href="#topic+estimation.weights.phase3">estimation.weights.phase3</a></code>).
The default is NULL.</p>
</td></tr>
<tr><td><code id="caseCohortCoxSurvival_+3A_weights.phase3.type">weights.phase3.type</code></td>
<td>
<p>One of NULL, &quot;design&quot;, &quot;estimated&quot;, or &quot;both&quot; to specify whether
the phase-three weights are design weights (known), or
to be estimated. The variance estimation differs for estimated
and design weights. If set to &quot;both&quot;, then both variance estimates
will be computed. If not NULL, then only the first letter is matched for this option.
The default is &quot;both&quot;.</p>
</td></tr>
<tr><td><code id="caseCohortCoxSurvival_+3A_tau1">Tau1</code></td>
<td>
<p>NULL or left bound of the time interval considered for the cumulative
baseline hazard and the pure risk.
If NULL, then the first event time is used.</p>
</td></tr>
<tr><td><code id="caseCohortCoxSurvival_+3A_tau2">Tau2</code></td>
<td>
<p>NULL or right bound of the time interval considered for the cumulative
baseline hazard and the pure risk.
If NULL, then the last event time is used.</p>
</td></tr>
<tr><td><code id="caseCohortCoxSurvival_+3A_x">x</code></td>
<td>
<p>Data frame containing <code>cox.phase1</code> and <code>cox.phase2</code>
variables for which pure risk is estimated.
The default is NULL so that no pure risk estimates will be computed.</p>
</td></tr>
<tr><td><code id="caseCohortCoxSurvival_+3A_weights.op">weights.op</code></td>
<td>
<p>NULL or a list of options for calibration of phase-two design weights
or estimating phase-three design weights.
The available options are <code>niter.max</code>, and
<code>epsilon.stop</code> (see <code><a href="#topic+calibration">calibration</a></code> or
<code><a href="#topic+estimation.weights.phase3">estimation.weights.phase3</a></code>).
The default is NULL.</p>
</td></tr>
<tr><td><code id="caseCohortCoxSurvival_+3A_print">print</code></td>
<td>
<p>0-3 to print information as the analysis is performed.
The larger the value, the more information will be printed. To not
print any information, set <code>print = 0</code>.
The default is 1.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The different scenarios covered by the function are:<br />
1) Whole cohort (<code>subcohort = NULL</code>)<br />
</p>
<p>2) (stratified) case-cohort (= stratified phase-two sample with no missing covariate data)<br />
a. With design weights (<code>subcohort</code>, <code>strata</code>, <code>calibrated = FALSE</code>)<br />
b. With calibrated weights and proxies to predict phase-two covariates and the
auxiliary variables (<code>subcohort</code>, <code>strata</code>, <code>calibrated=TRUE</code>,
<code>predict=TRUE</code>, <code>predictors.cox.phase2</code>, <code>aux.method</code>) <br />
c. With calibrated weights and externally supplied predicted values of phase-two covariates
(<code>calibrated=TRUE</code>, <code>strata</code>, <code>predict=FALSE</code>, <code>predicted.cox.phase2</code>) <br />
</p>
<p>3) (unstratified) case-cohort (= unstratified phase-two sample with no missing covariate data)<br />
a. With design weights (<code>subcohort</code>, <code>strata=NULL</code>, <code>calibrated=FALSE</code>)<br />
b. With calibrated weights and proxies to predict phase-two covariates and obtain the
auxiliary variables (<code>subcohort</code>, <code>strata=NULL</code>, <code>calibrated=TRUE</code>,
<code>predict=TRUE</code>, <code>predictors.cox.phase2</code>, <code>aux.method</code>) <br />
c. With calibrated weights and externally supplied predicted values of phase-two covariates
(<code>calibrated=TRUE</code>, <code>strata=NULL</code>, <code>predict=FALSE</code>, <code>predicted.cox.phase2</code>) <br />
</p>
<p>4) Case-cohort (= phase-three sample, because of missing covariate information in phase-two
data, with stratified or unstratified phase-two sampling)<br />
a. With known phase-three design weights (<code>subcohort</code>, <code>strata</code>, <code>phase3</code>,
<code>strata.phase3</code>, <br />
<code>weights.phase3.type="design"</code>) <br />
b. With estimated phase-three design weights (<code>subcohort</code>, <code>strata</code>, <code>phase3</code>,
<code>strata.phase3</code>, <br />
<code>weights.phase3.type="estimated"</code>)<br />
</p>
<p>covariates and prediction <br />
Prediction of phase-two covariates is performed when <code>calibrated = TRUE</code>, <code>predict = TRUE</code>,
<code>aux.vars = NULL</code> and <code>predicted.cox.phase2 = NULL</code>. If <code>predictors.cox.phase2 = NULL</code>,
all the covariates measured on the entire cohort will be used for the prediction
(see <code>cox.phase1</code> and <code>other.covars</code>).
Prediction of phase-two covariates is performed by linear regression for a continuous variable,
logistic regression for a binary variable and the function <code><a href="nnet.html#topic+multinom">multinom</a></code> for a
categorical variable. Dummy variables should not be used for categorical covariates,
because independent logistic (or linear) regressions will be performed using the dummy variables. <br />
Alternatively, predicted values of phase-two covariates on the whole cohort can be specified with
<code>predicted.cox.phase2</code>.
</p>
<p>calibration <br />
Calibrating the design weights against some informative auxiliary variables,
measured on all cohort members, can increase efficiency.
When <code>calibrated = TRUE</code>, the user can either provide the auxiliary variables
(<code>aux.vars</code>), or let the driver function build the auxiliary variables (<code>aux.method</code>).
Construction of the auxiliary variables follows Breslow et al. (2009) or Shin et al. (2020)
(see <code>aux.method</code>), and relies on predictions of the phase-two covariates for all members
of the cohort (see covariates and prediction above).
The auxiliary variables are given by (i) the influences for the log-relative hazard parameters
estimated from the Cox model with imputed cohort data; and (ii) the products of total
follow-up time (on the time interval for which pure risk is to be estimated) with the estimated
relative hazard for the imputed cohort data, where the log-relative hazard parameters are
estimated from the Cox model with case-cohort data and weights calibrated with (i).
When <code>aux.method = Breslow</code>, calibration of the design weights is against (i),
as proposed by Breslow et al. (2009) to improve efficiency of case-cohort estimates
of relative hazard. When <code>aux.method = Shin</code>, calibration is against (i) and (ii),
as proposed by Shin et al. (2020) to improve efficiency of relative hazard and pure risk
estimates under the nested case-control design.
</p>
<p>Note <br />
If <code>subcohort = NULL</code>, then a whole cohort analysis will be run and only robust variance estimates
will be computed.<br />
</p>


<h3>Value</h3>

<p>A list with class <code>casecohortcoxsurv</code> containing:
</p>

<ul>
<li> <p><code>beta</code> Estimated log-relative hazard estimates
</p>
</li>
<li> <p><code>Lambda0</code> Cumulative baseline hazard estimate in [Tau1, Tau2]
</p>
</li>
<li> <p><code>beta.var</code> Influence-based variance estimate for <code>beta</code>
</p>
</li>
<li> <p><code>Lambda0.var</code> Influence-based variance estimate for <code>Lambda0</code>
</p>
</li>
<li> <p><code>beta.var.estimated</code> Influence-based variance estimate for <code>beta</code> with estimated
phase-three weights
</p>
</li>
<li> <p><code>Lambda0.var.estimated</code> Influence-based variance estimate for <code>Lambda0</code> with estimated
phase-three weights
</p>
</li>
<li> <p><code>beta.var.design</code> Influence-based variance estimate for <code>beta</code> with design
phase-three weights
</p>
</li>
<li> <p><code>Lambda0.var.design</code> Influence-based variance estimate for <code>Lambda0</code> with design
phase-three weights
</p>
</li>
<li> <p><code>beta.robustvar</code> Robust variance estimate for <code>beta</code>
</p>
</li>
<li> <p><code>Lambda0.robustvar</code> Robust variance estimate for <code>Lambda0</code>
</p>
</li>
<li> <p><code>beta.robustvar.estimated</code> Robust variance estimate for <code>beta</code> with estimated
phase-three weights
</p>
</li>
<li> <p><code>Lambda0.robustvar.estimated</code> Robust variance estimate for <code>Lambda0</code> with estimated
phase-three weights
</p>
</li>
<li> <p><code>beta.robustvar.design</code> Robust variance estimate for <code>beta</code> with design
phase-three weights
</p>
</li>
<li> <p><code>Lambda0.robustvar.design</code> Robust variance estimate for <code>Lambda0</code> with design
phase-three weights
</p>
</li>
<li> <p><code>Pi.var</code> Matrix of pure risk estimates in [Tau1, Tau2] and variance estimates
</p>
</li>
<li> <p><code>Pi.var.estimated</code> Matrix of pure risk estimates in [Tau1, Tau2] and variance estimates
with estimated phase-three weights
</p>
</li>
<li> <p><code>Pi.var.design</code> Matrix of pure risk estimates in [Tau1, Tau2] and variance estimates
with design phase-three weights
</p>
</li>
<li> <p><code>coxph.fit</code> Return object from <code><a href="survival.html#topic+coxph">coxph</a></code> of the model fit
</p>
</li>
<li> <p><code>changed.times</code> Matrix of original and new event times for individuals who had their event times
changed due to ties. Will be NULL if event times were not changed.
</p>
</li>
<li> <p><code>args</code> List containing the values of the input arguments (except <code>data</code>)
</p>
</li>
<li> <p><code>risk.obj</code> List containing objects needed to compute pure risk estimates and variances
for a different set of data
</p>
</li></ul>



<h3>References</h3>

<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>
<p>Etievant, L., Gail, M. H. (2024). Software Application Profile: CaseCohortCoxSurvival: an R package for case-cohort inference for relative hazard and pure risk under the Cox model. Submitted.
</p>
<p>Shin Y.E., Pfeiffer R.M., Graubard B.I., Gail M.H. (2020) Weight calibration to improve
the efficiency of pure risk estimates from case-control samples nested in a cohort.
Biometrics, 76, 1087-1097.
</p>
<p>Breslow, N.E., Lumley, T., Ballantyne, C.M., Chambless, L.E. and Kulich, M. (2009).
Improved Horvitz-Thompson Estimation of Model Parameters from Two-phase Stratified Samples:
Applications in Epidemiology. Statistics in Biosciences, 1, 32-49.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  data(dataexample.missingdata.stratified, package="CaseCohortCoxSurvival")
  data &lt;- dataexample.missingdata.stratified$cohort
  cov1 &lt;- "X2"
  cov2 &lt;- c("X1", "X3")

  # Whole cohort, get pure risk estimate for every individual's profile in the
  # cohort. Only robust variance estimates are computed for a whole cohort analysis
  caseCohortCoxSurvival(data = data, status = "status", time = "event.time",
                        cox.phase1 = cov1, x = data)

  # Stratified case-cohort analysis with missing covariate information in the
  # phase-two data, and with phase-three strata based on W3
  caseCohortCoxSurvival(data = data, status = "status", time = "event.time",
                        cox.phase1 = cov1, cox.phase2 = cov2, strata = "W",
                        subcohort = "subcohort", phase3 = "phase3",
                        strata.phase3 = "W3")


  # Stratified case-cohort (phase-two) analysis with weight calibration specifying
  # a different set of proxy variables to predict each phase-two covariate
  data(dataexample.stratified, package="CaseCohortCoxSurvival")
  data &lt;- dataexample.stratified$cohort
  cov1 &lt;- "X2"
  cov2 &lt;- c("X1", "X3")

  caseCohortCoxSurvival(data = data, status = "status", time = "event.time",
                        cox.phase1 = cov1, cox.phase2 = cov2, strata = "W",
                        subcohort = "subcohort", calibrated = TRUE,
                        predictors.cox.phase2 = list(X1 = c("X1.proxy", "W"),
                                                     X3 = c("X1.proxy", "X3.proxy", "X2")))

  # Stratified case-cohort (phase-two) analysis with weight calibration, get pure
  # risk estimate for one given covariate profile
  est &lt;- caseCohortCoxSurvival(data = data, status = "status", time = "event.time",
                               cox.phase1 = cov1, cox.phase2 = cov2, strata = "W",
                               subcohort = "subcohort", calibrated = TRUE,
                               predictors.cox.phase2 = list(X1 = c("X1.proxy", "W"),
                                                            X3 = c("X1.proxy", "X3.proxy", "X2")),
                               x = list(X1 = 1, X2 = -1, X3 = 0.6), Tau1 = 0, Tau2 = 8)

  est$Pi.var

  # Stratified case-cohort (phase-two) analysis with weight calibration, get pure
  # risk estimate for two given covariate profiles
  pr1 &lt;- as.data.frame(cbind(X1 = -1, X2 = 1, X3 = -0.6))
  pr2 &lt;- as.data.frame(cbind(X1 = 1, X2 = -1, X3 = 0.6))

  est &lt;- caseCohortCoxSurvival(data = data, status = "status", time = "event.time",
                               cox.phase1 = cov1, cox.phase2 = cov2, strata = "W",
                               subcohort = "subcohort", calibrated = TRUE,
                               predictors.cox.phase2 = list(X1 = c("X1.proxy", "W"),
                                                            X3 = c("X1.proxy", "X3.proxy", "X2")),
                               x = rbind(pr1, pr2), Tau1 = 0, Tau2 = 8)

  est$Pi.var

  # Stratified case-cohort (phase-two) analysis with design weights, get pure
  # risk estimate for one given covariate profile
  est &lt;- caseCohortCoxSurvival(data = data, status = "status", time = "event.time",
                        cox.phase1 = cov1, cox.phase2 = cov2, strata = "W",
                        subcohort = "subcohort",
                        x = list(X1 = 1, X2 = -1, X3 = 0.6), Tau1 = 0, Tau2 = 8)
  est$beta
  est$Pi.var

  # Set the correct sampling counts in phase-two for each level of strata.
  # The strata variable W has levels 0-3.
  est &lt;- caseCohortCoxSurvival(data = data, status = "status", time = "event.time",
                               cox.phase1 = cov1, cox.phase2 = cov2, strata = "W",
                               subcohort = "subcohort",
                               subcohort.strata.counts = list("0" = 97, "1" = 294,
                                                              "2" = 300, "3" = 380))

  est$beta
</code></pre>

<hr>
<h2 id='dataexample'>
[Deprecated] Data for examples
</h2><span id='topic+dataexample'></span>

<h3>Description</h3>

<p>[<code>dataexample</code> is deprecated and will be removed in the next version of the package].
</p>
<p>Simulated cohort, case-cohort and set of auxiliary variables for examples.
The case-cohort is a stratified phase-two sample with no missing covariate data.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dataexample.stratified">dataexample.stratified</a></code>, <code><a href="#topic+dataexample.unstratified">dataexample.unstratified</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'> data(dataexample, package="CaseCohortCoxSurvival")

 # Display some of the data
 dataexample$cohort[1:5, ]

 dataexample$A[1:5, ] # auxiliary variable values in the cohort
</code></pre>

<hr>
<h2 id='dataexample.missingdata'>
[Deprecated] Data for examples with missing data
</h2><span id='topic+dataexample.missingdata'></span>

<h3>Description</h3>

<p>[<code>dataexample.missingdata</code> is deprecated and will be removed in the next version of the package].
</p>
<p>Simulated cohort and case-cohort for examples.
The case-cohort is a stratified phase-three sample, because of missing covariate
information in the stratified phase-two data.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dataexample.missingdata.stratified">dataexample.missingdata.stratified</a></code>, <code><a href="#topic+dataexample.missingdata.unstratified">dataexample.missingdata.unstratified</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'> data(dataexample.missingdata, package="CaseCohortCoxSurvival")

 # Display some of the data
 dataexample.missingdata$cohort[1:5, ]
</code></pre>

<hr>
<h2 id='dataexample.missingdata.stratified'>
Example of case-cohort with stratified sampling of the subcohort and missing covariate information in phase-two data
</h2><span id='topic+dataexample.missingdata.stratified'></span>

<h3>Description</h3>

<p>List with <code>cohort</code>.
</p>
<p><code>cohort</code> is a simulated cohort with 20 000 subjects. It contains:
</p>
<p><code>id</code> is the subject identifier.
</p>
<p><code>X1</code> is a continuous baseline covariate. Its measurements are only available for subjects in the case-cohort, i.e., with <code>phase3 = 1</code>.
</p>
<p><code>X2</code> is a categorical baseline covariate, with categories 0, 1, and 2. It is measured on all cohort subjects.
</p>
<p><code>X3</code> is a continuous baseline covariate. Its measurements are only available for subjects in the case-cohort.
</p>
<p><code>W</code> is a baseline categorical variable,  with categories 0, 1, 2, and 3. It depends on predictors of <code>X1</code> and <code>X2</code>. It is measured on all cohort subjects.
</p>
<p><code>status</code> indicates case status.
</p>
<p><code>event.time</code> gives the event or censoring time. <code>status</code> indicates whether the subject experienced the event of interest or was censored.
</p>
<p>The stratified sampling of the subcohort was based on the 4 strata defined by <code>W</code>. 97, 294, 300, and 380 subjects were sampled (independently of case status) from the 4 strata, respectively. <code>subcohort</code> indicates all these subjects included in the subcohort.
</p>
<p>The phase-two sample consisted of the subcohort and any other cases not in the subcohort. <code>phase2</code> indicates all these subjects included in the phase-two sample.
</p>
<p><code>W3</code> is a baseline binary variable, based on case status. It is measured on all cohort subjects.
</p>
<p>The third phase of sampling was stratified based on the 2 strata defined by <code>W3</code>. Subjects were sampled from the 2 strata with sampling probabilities 0.9 and 0.8. <code>phase3</code> indicates all these subjects included in the case-cohort (phase-three sample).
</p>
<p><code>strata.n</code> gives the number of subjects in the stratum in the cohort.
</p>
<p><code>strata.m</code> gives the number of subjects sampled from each of the 4 phase-two strata to be included in the subcohort (i.e., 97, 294, 300, or 380).
</p>
<p><code>strata.m</code> and <code>strata.n</code> would be used to compute the phase-two design weights of non-cases. Because all the cases were included in the phase-two sample, they would be assigned a phase-two design weight of 1.
</p>
<p><code>strata.n.cases</code> gives the number of cases in each of the 4 phase-two strata in the cohort.
</p>
<p><code>n.cases</code> gives the number of cases in the entire cohort.
</p>
<p><code>strata.proba.missing</code> gives the the sampling probablity for the 2 phase-three strata based on <code>W3</code> and that were used for the third phase of sampling.
</p>
<p><code>weight.true</code> gives the true design weight (i.e., product of the phase-two and true phase-three design weight).
</p>
<p><code>weight.p2.true</code> gives true phase-two design weight. They are stratum-specific based on <code>W</code>.
</p>
<p><code>weight.p3.true</code> gives the true phase-three design weight. They are stratum-specific based on <code>W3</code>. <code>weight.p3.true</code> can be used with argument <code>weights.phase3</code> of function <code>caseCohortCoxSurvival</code>, along with argument <code>weights.phase3.type = "design"</code>.
</p>
<p><code>weight.p3.est</code> gives the estimated phase-three design weight. They were obtained from <code>W3</code>, <code>phase2</code> and <code>phase3</code>. <code>weight.p3.est</code> can be used with argument <code>weights.phase3</code> of function <code>caseCohortCoxSurvival</code>, along with argument <code>weights.phase3.type = "estimated"</code>. If in function <code>caseCohortCoxSurvival</code> <code>weights.phase3 = NULL</code> but <code>weights.phase3.type = "estimated"</code>, the phase-three design weights will be estimated from <code>W3</code>, <code>phase2</code> and <code>phase3</code> and should be identical.
</p>
<p><code>weight.est</code> gives the estimated design weight (i.e., product of the phase-two and estimated phase-three design weight).
</p>


<h3>References</h3>

<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>
<p>Etievant, L., Gail, M. H. (2024). Software Application Profile: CaseCohortCoxSurvival: an R package for case-cohort inference for relative hazard and pure risk under the Cox model. Submitted.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 data(dataexample.missingdata.stratified, package="CaseCohortCoxSurvival")

 # Display some of the data
 dataexample.missingdata.stratified$cohort[1:5, ]
</code></pre>

<hr>
<h2 id='dataexample.missingdata.unstratified'>
Example of case-cohort with unstratified sampling of the subcohort and missing covariate information in phase-two data
</h2><span id='topic+dataexample.missingdata.unstratified'></span>

<h3>Description</h3>

<p>List with <code>cohort</code>.
</p>
<p><code>cohort</code> is a simulated cohort with 20 000 subjects. It contains:
</p>
<p><code>id</code> is the subject identifier.
</p>
<p><code>X1</code> is a continuous baseline covariate. Its measurements are only available for subjects in the case-cohort, i.e., with <code>phase3 = 1</code>.
</p>
<p><code>X2</code> is a categorical baseline covariate, with categories 0, 1, and 2. It is measured on all cohort subjects.
</p>
<p><code>X3</code> is a continuous baseline covariate. Its measurements are only available for subjects in the case-cohort.
</p>
<p><code>status</code> indicates case status.
</p>
<p><code>event.time</code> gives the event or censoring time. <code>status</code> indicates whether the subject experienced the event of interest or was censored.
</p>
<p>The sampling of the subcohort was not stratified. 1053 subjects were sampled (independently of case status) from the cohort. <code>subcohort</code> indicates all these subjects included in the subcohort.
</p>
<p>The phase-two sample consisted of the subcohort and any other cases not in the subcohort. <code>phase2</code> indicates all these subjects included in the phase-two sample.
</p>
<p><code>W3</code> is a baseline binary variable, based on case status. It is measured on all cohort subjects.
</p>
<p>The third phase of sampling was stratified based on the 2 strata defined by <code>W3</code>. Subjects were sampled from the 2 strata with sampling probabilities 0.9 and 0.8. <code>phase3</code> indicates all these subjects included in the case-cohort (phase-three sample).
</p>
<p><code>n</code> gives the number of subjects in the cohort.
</p>
<p><code>m</code> gives the number of subjects sampled from the cohort (i.e., 1053).
</p>
<p><code>m</code> and <code>n</code> would be used to compute the design weights of non-cases. Because all the cases were included in the case-cohort, they would be assigned a design weight of 1.
</p>
<p><code>n.cases</code> gives the number of cases in the entire cohort.
</p>
<p><code>W3</code> is a baseline binary variable, based on case status. It is measured on all cohort subjects.
</p>
<p><code>strata.proba.missing</code> gives the the sampling probablity for the 2 phase-three strata based on <code>W3</code> and that were used for the third phase of sampling.
</p>
<p><code>weight.true</code> gives the true design weight (i.e., product of the phase-two and true phase-three design weight).
</p>
<p><code>weight.p2.true</code> gives true phase-two design weight. They are stratum-specific based on <code>W</code>.
</p>
<p><code>weight.p3.true</code> gives the true phase-three design weight. They are stratum-specific based on <code>W3</code>. <code>weight.p3.true</code> can be used with argument <code>weights.phase3</code> of function <code>caseCohortCoxSurvival</code>, along with argument <code>weights.phase3.type = "design"</code>.
</p>
<p><code>weight.p3.est</code> gives the estimated phase-three design weight. They were obtained from <code>W3</code>, <code>phase2</code> and <code>phase3</code>. <code>weight.p3.est</code> can be used with argument <code>weights.phase3</code> of function <code>caseCohortCoxSurvival</code>, along with argument <code>weights.phase3.type = "estimated"</code>. If in function <code>caseCohortCoxSurvival</code> <code>weights.phase3 = NULL</code> but <code>weights.phase3.type = "estimated"</code>, the phase-three design weights will be estimated from <code>W3</code>, <code>phase2</code> and <code>phase3</code> and should be identical.
</p>
<p><code>weight.est</code> gives the estimated design weight (i.e., product of the phase-two and estimated phase-three design weight).
</p>


<h3>References</h3>

<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>
<p>Etievant, L., Gail, M. H. (2024). Software Application Profile: CaseCohortCoxSurvival: an R package for case-cohort inference for relative hazard and pure risk under the Cox model. Submitted.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 data(dataexample.missingdata.unstratified, package="CaseCohortCoxSurvival")

 # Display some of the data
 dataexample.missingdata.unstratified$cohort[1:5, ]
</code></pre>

<hr>
<h2 id='dataexample.stratified'>
Example of case-cohort with stratified sampling of the subcohort, and set of auxiliary variables
</h2><span id='topic+dataexample.stratified'></span>

<h3>Description</h3>

<p>List with <code>cohort</code> and <code>A</code>.
</p>
<p><code>cohort</code> is a simulated cohort with 20 000 subjects. It contains:
</p>
<p><code>id</code> is the subject identifier.
</p>
<p><code>X1</code> is a continuous baseline covariate. Its measurements are only available for subjects in the case-cohort, i.e., on subjects with <code>subcohort = 1</code> and/or <code>status = 1</code>.
</p>
<p><code>X2</code> is a categorical baseline covariate, with categories 0, 1, and 2. It is measured on all cohort subjects.
</p>
<p><code>X3</code> is a continuous baseline covariate. Its measurements are only available for subjects in the case-cohort.
</p>
<p><code>W</code> is a baseline categorical variable,  with categories 0, 1, 2, and 3. It depends on predictors of <code>X1</code> and <code>X2</code>. It is measured on all cohort subjects. The stratified sampling of the subcohort was based on the 4 strata defined by <code>W</code>.
</p>
<p><code>status</code> indicates case status.
</p>
<p><code>event.time</code> gives the event or censoring time. <code>status</code> indicates whether the subject experienced the event of interest or was censored.
</p>
<p>97, 294, 300, and 380 subjects were sampled (independently of case status) from the 4 strata, respectively. <code>subcohort</code> indicates all these subjects included in the subcohort. The stratified case-cohort (phase-two sample) consists of the subcohort and any other cases not in the subcohort.
</p>
<p><code>strata.n</code> gives the number of subjects in the stratum in the cohort.
</p>
<p><code>strata.m</code> gives the number of subjects sampled from each of the 4 strata (i.e., 97, 294, 300, or 380).
<code>strata.m</code> and <code>strata.n</code> would be used to compute the stratum-specific design weights of non-cases. Because all the cases were included in the case-cohort, they would be assigned a design weight of 1.
</p>
<p><code>strata.n.cases</code> gives the number of cases in each of the 4 strata.
</p>
<p><code>n.cases</code> gives the number of cases in the entire cohort.
</p>
<p><code>X1.proxy</code> is a continuous baseline covariate. It is a proxy of <code>X1</code>, with 0.8 correlation. It is measured on all cohort subjects. It can be used for design weights calibration in the argument <code>predictors.cox.phase2</code> of function <code>caseCohortCoxSurvival</code>, as one would need to predict <code>X1</code> on the entire cohort.
</p>
<p><code>X3.proxy</code> is a continuous baseline covariate. It is a proxy of <code>X3</code>, with 0.8 correlation. It is measured on all cohort subjects. It can be used for design weights calibration in the argument <code>predictors.cox.phase2</code> of function <code>caseCohortCoxSurvival</code>, as one would need to predict <code>X3</code> on the entire cohort.
</p>
<p><code>X1.pred</code> is a prediction of <code>X1</code>, available for all cohort subjects. The predictions were obtained by weighted linear regression on <code>X1.proxy</code> and <code>W</code>, with the design weights.
</p>
<p><code>X3.pred</code> is a prediction of <code>X3</code>, available for all cohort subjects. The predictions were obtained by weighted linear regression on <code>X1.proxy</code>,  <code>X2</code>, and <code>X3.proxy</code>, with the design weights.
</p>
<p><code>A</code> contains auxiliary variables, obtained as proposed by Breslow et al. (2009) and Shin et al. (2020). <code>A</code> can be used with argument <code>aux.var</code> of function <code>caseCohortCoxSurvival</code>.
</p>
<p>Predictions of <code>X1</code> were obtained by weighted linear regression on <code>X1.proxy</code> and <code>W</code>, with the design weights. Predictions of <code>X3</code> were obtained by weighted linear regression on <code>X1.proxy</code>,  <code>X2</code>, and <code>X3.proxy</code>, with the design weights. Then the Cox model with <code>X2</code> and the predicted values of <code>X1</code> and <code>X3</code> (available for all cohort subjects) was run. <code>A.X1</code>, <code>A.X2</code>, and <code>A.X3</code> contain the influences on the estimated log-RHs (available for all cohort subjects).
</p>
<p>Second, design weights were then calibrated based on <code>A.1</code>, <code>A.X1</code>, <code>A.X2</code>, and <code>A.X3</code>, with <code>A.1</code> that is identically equal to 1. The log-RH parameter was then estimated from the case-cohort data with these calibrated weights. Finally, the log-RH estimate was used with <code>X2</code> and the predicted values of <code>X1</code> and <code>X3</code> (available for all cohort subjects), and exponentiated. <code>A.Shin</code> contains the product of this quantity with the total follow-up time on interval (0,8].
</p>


<h3>References</h3>

<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>
<p>Etievant, L., Gail, M. H. (2024). Software Application Profile: CaseCohortCoxSurvival: an R package for case-cohort inference for relative hazard and pure risk under the Cox model. Submitted.
</p>
<p>Shin Y.E., Pfeiffer R.M., Graubard B.I., Gail M.H. (2020) Weight calibration to improve
the efficiency of pure risk estimates from case-control samples nested in a cohort.
Biometrics, 76, 1087-1097
</p>
<p>Breslow, N.E., Lumley, T., Ballantyne, C.M., Chambless, L.E. and Kulich, M. (2009).
Improved Horvitz-Thompson Estimation of Model Parameters from Two-phase Stratified Samples:
Applications in Epidemiology. Statistics in Biosciences, 1, 32-49.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 data(dataexample.stratified, package="CaseCohortCoxSurvival")

 # Display some of the data
 dataexample.stratified$cohort[1:5, ]

 dataexample.stratified$A[1:5, ] # auxiliary variable values in the cohort
</code></pre>

<hr>
<h2 id='dataexample.unstratified'>
Example of case-cohort with unstratified sampling of the subcohort, and set of auxiliary variables
</h2><span id='topic+dataexample.unstratified'></span>

<h3>Description</h3>

<p>List with <code>cohort</code> and <code>A</code>.
</p>
<p><code>cohort</code> is a simulated cohort with 20 000 subjects. It contains:
</p>
<p><code>id</code> is the subject identifier.
</p>
<p><code>X1</code> is a continuous baseline covariate. Its measurements are only available for subjects in the case-cohort, i.e., on subjects with <code>subcohort = 1</code> and/or <code>status = 1</code>.
</p>
<p><code>X2</code> is a categorical baseline covariate, with categories 0, 1, and 2. It is measured on all cohort subjects.
</p>
<p><code>X3</code> is a continuous baseline covariate. Its measurements are only available for subjects in the case-cohort.
</p>
<p><code>status</code> indicates case status.
</p>
<p><code>event.time</code> gives the event or censoring time. <code>status</code> indicates whether the subject experienced the event of interest or was censored.
</p>
<p>1053 subjects were sampled (independently of case status) from the cohort. <code>subcohort</code> indicates all these subjects included in the subcohort. The case-cohort (phase-two sample) consists of the subcohort and any other cases not in the subcohort.
</p>
<p><code>n</code> gives the number of subjects in the cohort.
</p>
<p><code>m</code> gives the number of subjects sampled from the cohort (i.e., 1053).
</p>
<p><code>m</code> and <code>n</code> would be used to compute the design weights of non-cases. Because all the cases were included in the case-cohort, they would be assigned a design weight of 1.
</p>
<p><code>n.cases</code> gives the number of cases in the entire cohort.
</p>
<p><code>X1.proxy</code> is a continuous baseline covariate. It is a proxy of <code>X1</code>, with 0.8 correlation. It is measured on all cohort subjects. It can be used for design weights calibration in the argument <code>predictors.cox.phase2</code> of function <code>caseCohortCoxSurvival</code>, as one would need to predict <code>X1</code> on the entire cohort.
</p>
<p><code>X3.proxy</code> is a continuous baseline covariate. It is a proxy of <code>X3</code>, with 0.8 correlation. It is measured on all cohort subjects. It can be used for design weights calibration in the argument <code>predictors.cox.phase2</code> of function <code>caseCohortCoxSurvival</code>, as one would need to predict <code>X3</code> on the entire cohort.
</p>
<p><code>X1.pred</code> is a prediction of <code>X1</code>, available for all cohort subjects. The predictions were obtained by weighted linear regression on <code>X1.proxy</code>, with the design weights.
</p>
<p><code>X3.pred</code> is a prediction of <code>X3</code>, available for all cohort subjects. The predictions were obtained by weighted linear regression on <code>X1.proxy</code>,  <code>X2</code>, and <code>X3.proxy</code>, with the design weights.
</p>
<p><code>A</code> contains auxiliary variables, obtained as proposed by Breslow et al. (2009) and Shin et al. (2020). <code>A</code> can be used with argument <code>aux.var</code> of function <code>caseCohortCoxSurvival</code>.
</p>
<p>Predictions of <code>X1</code> were obtained by weighted linear regression on <code>X1.proxy</code> and <code>X2</code>, with the design weights. Predictions of <code>X3</code> were obtained by weighted linear regression on <code>X1.proxy</code>,  <code>X2</code>, and <code>X3.proxy</code>, with the design weights. Then the Cox model with <code>X2</code> and the predicted values of <code>X1</code> and <code>X3</code> (available for all cohort subjects) was run. <code>A.X1</code>, <code>A.X2</code>, and <code>A.X3</code> contain the influences on the estimated log-RHs (available for all cohort subjects).
</p>
<p>Second, design weights were then calibrated based on <code>A.1</code>, <code>A.X1</code>, <code>A.X2</code>, and <code>A.X3</code>, with <code>A.1</code> that is identically equal to 1. The log-RH parameter was then estimated from the case-cohort data with these calibrated weights. Finally, the log-RH estimate was used with <code>X2</code> and the predicted values of <code>X1</code> and <code>X3</code> (available for all cohort subjects), and exponentiated. <code>A.Shin</code> contains the product of this quantity with the total follow-up time on interval (0,8].
</p>


<h3>References</h3>

<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>
<p>Etievant, L., Gail, M. H. (2024). Software Application Profile: CaseCohortCoxSurvival: an R package for case-cohort inference for relative hazard and pure risk under the Cox model. Submitted.
</p>
<p>Shin Y.E., Pfeiffer R.M., Graubard B.I., Gail M.H. (2020) Weight calibration to improve
the efficiency of pure risk estimates from case-control samples nested in a cohort.
Biometrics, 76, 1087-1097
</p>
<p>Breslow, N.E., Lumley, T., Ballantyne, C.M., Chambless, L.E. and Kulich, M. (2009).
Improved Horvitz-Thompson Estimation of Model Parameters from Two-phase Stratified Samples:
Applications in Epidemiology. Statistics in Biosciences, 1, 32-49.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 data(dataexample.unstratified, package="CaseCohortCoxSurvival")

 # Display some of the data
 dataexample.unstratified$cohort[1:5, ]

 dataexample.unstratified$A[1:5, ] # auxiliary variable values in the cohort
</code></pre>

<hr>
<h2 id='deprecateddata'>
Deprecated data sets in CaseCohortCoxSurvival
</h2><span id='topic+deprecateddata'></span>

<h3>Description</h3>

<p>These data sets still work but will be removed (defuncted) in the next version of the package.
</p>
<p><code>dataexample</code> is deprecated and will be removed in the next version of the package.
</p>
<p><code>dataexample.missingdata</code> is deprecated and will be removed in the next version of the package.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dataexample.stratified">dataexample.stratified</a></code>, <code><a href="#topic+dataexample.unstratified">dataexample.unstratified</a></code>, <code><a href="#topic+dataexample.missingdata.stratified">dataexample.missingdata.stratified</a></code>, <code><a href="#topic+dataexample.missingdata.unstratified">dataexample.missingdata.unstratified</a></code></p>

<hr>
<h2 id='estimatePureRisk'>estimatePureRisk</h2><span id='topic+estimatePureRisk'></span>

<h3>Description</h3>

<p>Computes pure risk estimates and variances for new covariate values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimatePureRisk(obj, x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="estimatePureRisk_+3A_obj">obj</code></td>
<td>
<p>Return object from <code><a href="#topic+caseCohortCoxSurvival">caseCohortCoxSurvival</a></code>.</p>
</td></tr>
<tr><td><code id="estimatePureRisk_+3A_x">x</code></td>
<td>
<p>Data frame or a list containing values of the covariates that were used
when <code><a href="#topic+caseCohortCoxSurvival">caseCohortCoxSurvival</a></code> was called,
and for which the pure risk is to be estimated.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing:
</p>

<ul>
<li> <p><code>var</code> Matrix of pure risk estimates in [Tau1, Tau2] and variance estimates
</p>
</li>
<li> <p><code>var.estimated</code> Matrix of pure risk estimates in [Tau1, Tau2] and variance estimates
when the phase-three weights are estimated
</p>
</li>
<li> <p><code>var.design</code> Matrix of pure risk estimates in [Tau1, Tau2] and variance estimates
when the phase-three weights are known
</p>
</li></ul>

<p>Depending on the analysis run, some of the above objects will be NULL.
</p>


<h3>References</h3>

<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>


<h3>See Also</h3>

 <p><code><a href="#topic+caseCohortCoxSurvival">caseCohortCoxSurvival</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'>
  data(dataexample.stratified, package="CaseCohortCoxSurvival")

  data &lt;- dataexample.stratified$cohort
  cov1 &lt;- "X2"
  cov2 &lt;- c("X1", "X3")

  obj &lt;- caseCohortCoxSurvival(data = data, status = "status",
                               time = "event.time", cox.phase1 = cov1,
                               cox.phase2 = cov2, strata = "W",
                               subcohort = "subcohort", Tau1 = 0, Tau2 = 8)

  # get pure risk estimate for every individual's profile in the cohort
  ret &lt;- estimatePureRisk(obj, data)

  # get pure risk estimate for one given covariate profile
  ret &lt;- estimatePureRisk(obj, list(X1 = 1, X2 = -1, X3 = 0.6))

  # get pure risk estimates for two given covariate profiles
  pr1 &lt;- as.data.frame(cbind(X1 = -1, X2 = 1, X3 = -0.6))
  pr2 &lt;- as.data.frame(cbind(X1 = 1, X2 = -1, X3 = 0.6))
  ret &lt;- estimatePureRisk(obj, rbind(pr1, pr2))
  ret$var
</code></pre>

<hr>
<h2 id='estimation'>estimation</h2><span id='topic+estimation'></span>

<h3>Description</h3>

<p>Estimates the log-relative hazard, baseline hazards at each unique event time,
cumulative baseline hazard in a given time interval [Tau1, Tau2] and pure risk
in [Tau1, Tau2] and for a given covariate profile x.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimation(mod, Tau1 = NULL, Tau2 = NULL, x = NULL, missing.data = NULL,
riskmat.phase2 = NULL, dNt.phase2 = NULL, status.phase2 = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="estimation_+3A_mod">mod</code></td>
<td>
<p>a Cox model object, result of function <code>coxph</code>.</p>
</td></tr>
<tr><td><code id="estimation_+3A_tau1">Tau1</code></td>
<td>
<p>left bound of the time interval considered for the cumulative
baseline hazard and pure risk. Default is the first event time.</p>
</td></tr>
<tr><td><code id="estimation_+3A_tau2">Tau2</code></td>
<td>
<p>right bound of the time interval considered for the cumulative
baseline hazard and pure risk. Default is the last event time.</p>
</td></tr>
<tr><td><code id="estimation_+3A_x">x</code></td>
<td>
<p>vector of length <code class="reqn">p</code>, specifying the covariate profile considered for the
pure risk. Default is (0,...,0).</p>
</td></tr>
<tr><td><code id="estimation_+3A_missing.data">missing.data</code></td>
<td>
<p>was data on the <code class="reqn">p</code> covariates missing for certain individuals
in the phase-two data (i.e., was a third phase of sampling performed)? If
<code>missing.data = TRUE</code>, the arguments below need to be provided. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="estimation_+3A_riskmat.phase2">riskmat.phase2</code></td>
<td>
<p>at risk matrix for the phase-two data at all of the case
event times, even those with missing covariate data. Needs to be provided if
<code>missing.data = TRUE</code>.</p>
</td></tr>
<tr><td><code id="estimation_+3A_dnt.phase2">dNt.phase2</code></td>
<td>
<p>counting process matrix for failures in the phase-two data.
Needs to be provided if <code>missing.data = TRUE</code> and <code>status.phase2 = NULL</code>.</p>
</td></tr>
<tr><td><code id="estimation_+3A_status.phase2">status.phase2</code></td>
<td>
<p>vector indicating the case status in the phase-two data.
Needs to be provided if <code>missing.data = TRUE</code> and <code>dNt.phase2 = NULL</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>estimation</code> returns the log-relative hazard estimates provided by
<code>mod</code>, and estimates the baseline hazard point mass at any event time
non-parametrically.
</p>
<p><code>estimation</code> works for estimation from a case-cohort with design weights
or calibrated weights, when the case-cohort consists of the subcohort and cases
not in the subcohort (i.e., case-cohort obtained from two phases of sampling),
as well as with design weights when covariate data was missing for certain
individuals in the phase-two data (i.e., case-cohort obtained from three phases
of sampling).
</p>


<h3>Value</h3>

<p><code>beta.hat</code>: vector of length <code class="reqn">p</code> with log-relative hazard estimates.
</p>
<p><code>lambda0.t.hat</code>: vector with baseline hazards estimates at each unique event time.
</p>
<p><code>Lambda0.Tau1Tau2.hat</code>: cumulative baseline hazard estimate in [Tau1, Tau2].
</p>
<p><code>Pi.x.Tau1Tau2.hat</code>: pure risk estimate in [Tau1, Tau2] and for covariate profile <code>x</code>.
</p>


<h3>References</h3>

<p>Breslow, N. (1974). Covariance Analysis of Censored Survival Data. Biometrics, 30, 89-99.
</p>
<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+estimation.CumBH">estimation.CumBH</a></code>, <code><a href="#topic+estimation.PR">estimation.PR</a></code>, <code><a href="#topic+influences">influences</a></code>, <code><a href="#topic+influences.RH">influences.RH</a></code>,
<code><a href="#topic+influences.CumBH">influences.CumBH</a></code>, <code><a href="#topic+influences.PR">influences.PR</a></code>,
<code><a href="#topic+influences.missingdata">influences.missingdata</a></code>, <code><a href="#topic+influences.RH.missingdata">influences.RH.missingdata</a></code>, <code><a href="#topic+influences.CumBH.missingdata">influences.CumBH.missingdata</a></code>,
and <code><a href="#topic+influences.PR.missingdata">influences.PR.missingdata</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  data(dataexample.missingdata.stratified, package="CaseCohortCoxSurvival")

  cohort &lt;- dataexample.missingdata.stratified$cohort
  phase2 &lt;- cohort[which(cohort$phase2 == 1),] # the phase-two sample
  casecohort &lt;- cohort[which(cohort$phase3 == 1),] # the stratified case-cohort

  B.phase2 &lt;- cbind(1 * (phase2$W3 == 0), 1 * (phase2$W3 == 1))
  rownames(B.phase2)  &lt;- cohort[cohort$phase2 == 1, "id"]
  B.phase3 &lt;- cbind(1 * (casecohort$W3 == 0), 1 * (casecohort$W3 == 1))
  rownames(B.phase3)  &lt;- cohort[cohort$phase3 == 1, "id"]
  total.B.phase2 &lt;- colSums(B.phase2)
  J3 &lt;- ncol(B.phase3)
  n &lt;- nrow(cohort)

  # Quantities needed for estimation of the cumulative baseline hazard when
  # covariate data is missing
  mod.cohort &lt;- coxph(Surv(event.time, status) ~ X2, data = cohort,
                      robust = TRUE) # X2 is available on all cohort members
  mod.cohort.detail &lt;- coxph.detail(mod.cohort, riskmat = TRUE)

  riskmat.phase2 &lt;- with(cohort, mod.cohort.detail$riskmat[phase2 == 1,])
  rownames(riskmat.phase2) &lt;- cohort[cohort$phase2 == 1, "id"]
  observed.times.phase2 &lt;- apply(riskmat.phase2, 1,
                                 function(v) {which.max(cumsum(v))})
  dNt.phase2 &lt;- matrix(0, nrow(riskmat.phase2), ncol(riskmat.phase2))
  dNt.phase2[cbind(1:nrow(riskmat.phase2), observed.times.phase2)] &lt;- 1
  dNt.phase2 &lt;- sweep(dNt.phase2, 1, phase2$status, "*")
  colnames(dNt.phase2) &lt;- colnames(riskmat.phase2)
  rownames(dNt.phase2) &lt;- rownames(riskmat.phase2)

  Tau1 &lt;- 0 # given time interval for the pure risk
  Tau2 &lt;- 8
  x &lt;- c(-1, 1, -0.6) # given covariate profile for the pure risk

  # Estimation using the stratified case cohort with true known design weights
  mod.true &lt;- coxph(Surv(event.time, status) ~ X1 + X2 + X3, data = casecohort,
                    weight = weight.true, id = id, robust = TRUE)

  est.true &lt;- estimation(mod.true, Tau1 = Tau1, Tau2 = Tau2, x = x,
                                      missing.data = TRUE,
                                      riskmat.phase2 = riskmat.phase2,
                                      dNt.phase2 = dNt.phase2)

  # print the vector with log-relative hazard estimates
  est.true$beta.hat

  # print the cumulative baseline hazard estimate
  est.true$Lambda0.Tau1Tau2.hat

  # print the pure risk estimate
  est.true$Pi.x.Tau1Tau2.hat

</code></pre>

<hr>
<h2 id='estimation.CumBH'>estimation.CumBH</h2><span id='topic+estimation.CumBH'></span>

<h3>Description</h3>

<p>Estimates the log-relative hazard, baseline hazards at each unique event time
and cumulative baseline hazard in a given time interval [Tau1, Tau2].
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimation.CumBH(mod, Tau1 = NULL, Tau2 = NULL, missing.data = FALSE,
riskmat.phase2 = NULL, dNt.phase2 = NULL, status.phase2 = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="estimation.CumBH_+3A_mod">mod</code></td>
<td>
<p>a Cox model object, result of function coxph.</p>
</td></tr>
<tr><td><code id="estimation.CumBH_+3A_tau1">Tau1</code></td>
<td>
<p>left bound of the time interval considered for the cumulative
baseline hazard. Default is the first event time.</p>
</td></tr>
<tr><td><code id="estimation.CumBH_+3A_tau2">Tau2</code></td>
<td>
<p>right bound of the time interval considered for the cumulative
baseline hazard. Default is the last event time.</p>
</td></tr>
<tr><td><code id="estimation.CumBH_+3A_missing.data">missing.data</code></td>
<td>
<p>was data on the <code class="reqn">p</code> covariates missing for certain individuals
in the phase-two data (i.e., was a third phase of sampling performed)? If
<code>missing.data = TRUE</code>, the arguments below need to be provided.
Default is FALSE.</p>
</td></tr>
<tr><td><code id="estimation.CumBH_+3A_riskmat.phase2">riskmat.phase2</code></td>
<td>
<p>at risk matrix for the phase-two data at all of the case
event times, even those with missing covariate data. Needs to be provided if
<code>missing.data = TRUE</code>.</p>
</td></tr>
<tr><td><code id="estimation.CumBH_+3A_dnt.phase2">dNt.phase2</code></td>
<td>
<p>counting process matrix for failures in the phase-two data.
Needs to be provided if <code>missing.data = TRUE</code> and <code>status.phase2 = NULL</code>.</p>
</td></tr>
<tr><td><code id="estimation.CumBH_+3A_status.phase2">status.phase2</code></td>
<td>
<p>vector indicating the case status in the phase-two data.
Needs to be provided if <code>missing.data = TRUE</code> and <code>dNt.phase2 = NULL</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>estimation.CumBH</code> returns the log-relative hazard estimates provided by
<code>mod</code>, and estimates the baseline hazard point mass at any event time
non-parametrically.
</p>
<p><code>estimation.CumBH</code> works for estimation from a case-cohort with design weights
or calibrated weights, when the case-cohort consists of the subcohort and cases
not in the subcohort (i.e., case-cohort obtained from two phases of sampling),
as well as with design weights when covariate data was missing for certain
individuals in the phase-two data (i.e., case-cohort obtained from three phases
of sampling).
</p>


<h3>Value</h3>

<p><code>beta.hat</code>: vector of length <code class="reqn">p</code> with log-relative hazard estimates.
</p>
<p><code>lambda0.t.hat</code>: vector with baseline hazards estimates at each unique event time.
</p>
<p><code>Lambda0.Tau1Tau2.hat</code>: cumulative baseline hazard estimate in [Tau1, Tau2].
</p>


<h3>References</h3>

<p>Breslow, N. (1974). Covariance Analysis of Censored Survival Data. Biometrics, 30, 89-99.
</p>
<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+estimation">estimation</a></code>, <code><a href="#topic+estimation.PR">estimation.PR</a></code>, <code><a href="#topic+influences">influences</a></code>, <code><a href="#topic+influences.RH">influences.RH</a></code>,
<code><a href="#topic+influences.CumBH">influences.CumBH</a></code>, <code><a href="#topic+influences.PR">influences.PR</a></code>,
<code><a href="#topic+influences.missingdata">influences.missingdata</a></code>, <code><a href="#topic+influences.RH.missingdata">influences.RH.missingdata</a></code>, <code><a href="#topic+influences.CumBH.missingdata">influences.CumBH.missingdata</a></code>,
and <code><a href="#topic+influences.PR.missingdata">influences.PR.missingdata</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  data(dataexample.missingdata.stratified, package="CaseCohortCoxSurvival")

  cohort &lt;- dataexample.missingdata.stratified$cohort
  phase2 &lt;- cohort[which(cohort$phase2 == 1),] # the phase-two sample
  casecohort &lt;- cohort[which(cohort$phase3 == 1),] # the stratified case-cohort

  B.phase2 &lt;- cbind(1 * (phase2$W3 == 0), 1 * (phase2$W3 == 1))
  rownames(B.phase2)  &lt;- cohort[cohort$phase2 == 1, "id"]
  B.phase3 &lt;- cbind(1 * (casecohort$W3 == 0), 1 * (casecohort$W3 == 1))
  rownames(B.phase3)  &lt;- cohort[cohort$phase3 == 1, "id"]
  total.B.phase2 &lt;- colSums(B.phase2)
  J3 &lt;- ncol(B.phase3)
  n &lt;- nrow(cohort)

  # Quantities needed for estimation of the cumulative baseline hazard when
  # covariate data is missing
  mod.cohort &lt;- coxph(Surv(event.time, status) ~ X2, data = cohort,
                      robust = TRUE) # X2 is available on all cohort members
  mod.cohort.detail &lt;- coxph.detail(mod.cohort, riskmat = TRUE)

  riskmat.phase2 &lt;- with(cohort, mod.cohort.detail$riskmat[phase2 == 1,])
  rownames(riskmat.phase2) &lt;- cohort[cohort$phase2 == 1, "id"]
  observed.times.phase2 &lt;- apply(riskmat.phase2, 1,
                                 function(v) {which.max(cumsum(v))})
  dNt.phase2 &lt;- matrix(0, nrow(riskmat.phase2), ncol(riskmat.phase2))
  dNt.phase2[cbind(1:nrow(riskmat.phase2), observed.times.phase2)] &lt;- 1
  dNt.phase2 &lt;- sweep(dNt.phase2, 1, phase2$status, "*")
  colnames(dNt.phase2) &lt;- colnames(riskmat.phase2)
  rownames(dNt.phase2) &lt;- rownames(riskmat.phase2)

  Tau1 &lt;- 0 # given time interval for the pure risk
  Tau2 &lt;- 8
  x &lt;- c(-1, 1, -0.6) # given covariate profile for the pure risk

  # Estimation using the stratified case cohort with true known design weights
  mod.true &lt;- coxph(Surv(event.time, status) ~ X1 + X2 + X3, data = casecohort,
                    weight = weight.true, id = id, robust = TRUE)

  est.true &lt;- estimation(mod.true, Tau1 = Tau1, Tau2 = Tau2, x = x,
                         missing.data = TRUE,
                         riskmat.phase2 = riskmat.phase2,
                         dNt.phase2 = dNt.phase2)

  est.true &lt;- estimation.CumBH(mod.true, Tau1 = Tau1, Tau2 = Tau2,
                                            missing.data = TRUE,
                                            riskmat.phase2 = riskmat.phase2,
                                            dNt.phase2 = dNt.phase2)

  # print the cumulative baseline hazard estimate
  est.true$Lambda0.Tau1Tau2.hat
</code></pre>

<hr>
<h2 id='estimation.PR'>estimation.PR</h2><span id='topic+estimation.PR'></span>

<h3>Description</h3>

<p>Estimates the pure risk in the time interval [Tau1, Tau2] and for a covariate
profile x, from the log-relative hazard and cumulative baseline hazard values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimation.PR(beta, Lambda0.Tau1Tau2, x = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="estimation.PR_+3A_beta">beta</code></td>
<td>
<p>vector of length <code class="reqn">p</code> with log-relative hazard values.</p>
</td></tr>
<tr><td><code id="estimation.PR_+3A_lambda0.tau1tau2">Lambda0.Tau1Tau2</code></td>
<td>
<p>cumulative baseline hazard in [Tau1, Tau2].</p>
</td></tr>
<tr><td><code id="estimation.PR_+3A_x">x</code></td>
<td>
<p>vector of length <code class="reqn">p</code>, specifying the covariate profile considered for the
pure risk. Default is (0,...,0).</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>Pi.x.Tau1Tau2.hat</code>: pure risk estimate in [Tau1, Tau2] and for covariate profile <code class="reqn">x</code>.
</p>


<h3>References</h3>

<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+estimation">estimation</a></code>, <code><a href="#topic+estimation.CumBH">estimation.CumBH</a></code>, <code><a href="#topic+influences">influences</a></code>, <code><a href="#topic+influences.RH">influences.RH</a></code>,
<code><a href="#topic+influences.CumBH">influences.CumBH</a></code>, <code><a href="#topic+influences.PR">influences.PR</a></code>,
<code><a href="#topic+influences.missingdata">influences.missingdata</a></code>, <code><a href="#topic+influences.RH.missingdata">influences.RH.missingdata</a></code>, <code><a href="#topic+influences.CumBH.missingdata">influences.CumBH.missingdata</a></code>,
and <code><a href="#topic+influences.PR.missingdata">influences.PR.missingdata</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  estimation.PR(beta = c(-0.2, 0.25, -0.3), Lambda0.Tau1Tau2 = 0.03,
                x = c(-1, 1, -0.6))

</code></pre>

<hr>
<h2 id='estimation.weights.phase3'>estimation.weights.phase3</h2><span id='topic+estimation.weights.phase3'></span>

<h3>Description</h3>

<p>Estimates the weights for the third phase of sampling (due to missingness in phase two).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimation.weights.phase3(B.phase3, total.phase2, gamma0 = NULL, niter.max = NULL,
epsilon.stop = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="estimation.weights.phase3_+3A_b.phase3">B.phase3</code></td>
<td>
<p>matrix for the case-cohort (phase-three data), with phase-three
sampling strata indicators. It should have as many columns as phase-three strata
(<code class="reqn">J^{(3)}</code>), with one 1 per row, to indicate the phase-three stratum position.</p>
</td></tr>
<tr><td><code id="estimation.weights.phase3_+3A_total.phase2">total.phase2</code></td>
<td>
<p>vector of length <code class="reqn">J^{(3)}</code> with un-weighted column totals
for <code>B</code> in the phase-two data (i.e.,
using all the individuals, even the ones with missing covariate data).</p>
</td></tr>
<tr><td><code id="estimation.weights.phase3_+3A_gamma0">gamma0</code></td>
<td>
<p>vector of length <code class="reqn">J^{(3)}</code> with initial values for <code class="reqn">\gamma</code>
(Lagrangian multipliers), to be used as seed in the iterative procedure. Default
is (0,...,0).</p>
</td></tr>
<tr><td><code id="estimation.weights.phase3_+3A_niter.max">niter.max</code></td>
<td>
<p>maximum number of iterations for the iterative optimization
algorithm. Default is <code>10^4</code> iterations.</p>
</td></tr>
<tr><td><code id="estimation.weights.phase3_+3A_epsilon.stop">epsilon.stop</code></td>
<td>
<p>threshold for the difference between the estimated weighted
total and the total in the whole cohort. If this difference is less than the
value of <code>epsilon.stop</code>, no more iterations will be performed. Default is <code>10^(-10)</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>estimation.weights.phase3</code> estimates the phase-three sampling weights by solving in
<code class="reqn">\gamma</code>
</p>
<p style="text-align: center;"><code class="reqn">\sum_{j=1}^J \sum_{i=1}^{n^{(j)}} \lbrace \xi_{i,j} V_{i,j}
      \text{exp}( \gamma' B_{i,j}) B_{i,j} - \xi_{i,j} B_{i,j} \rbrace = 0,</code>
</p>

<p>with <code class="reqn">\xi_{i,j}</code> the phase-two sampling indicator and <code class="reqn">V_{i,j}</code> the phase-three
sampling indicator of individual <code class="reqn">i</code> in stratum <code class="reqn">j</code>, and with
<code class="reqn">\sum_{j=1}^J \sum_{i=1}^{n^{(j)}} \xi_{i,j} B_{i,j}</code> the total in the
phase-two data. See Etievant and Gail (2024).
The Newton Raphson method is used to solve the optimization problem.
</p>
<p>In the end, the estimated weights are given by <code class="reqn">\text{exp}(\hat \gamma' B_{i,j})</code>,
and <code class="reqn">\sum_{j=1}^J \sum_{i=1}^{n^{(j)}} \xi_{i,j} V_{i,j} \text{exp}(\hat \gamma' B_{i,j}) B_{i,j}</code>
gives the estimated total.
</p>


<h3>Value</h3>

<p><code>gamma.hat</code>: vector of length <code class="reqn">J^{(3)}</code> with final gamma values.
</p>
<p><code>estimated.weights</code>: vector with the estimated phase-three weights for the
individuals in the case-cohort (phase-three data), computed from <code>B.phase3</code>
and <code>gamma.hat</code>.
</p>
<p><code>estimated.total</code>: vector with the estimated totals, computed from the
<code>estimated.weights</code> and <code>B.phase3</code>.
</p>


<h3>References</h3>

<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+influences.missingdata">influences.missingdata</a></code>, <code><a href="#topic+influences.RH.missingdata">influences.RH.missingdata</a></code>,<code><a href="#topic+influences.CumBH.missingdata">influences.CumBH.missingdata</a></code> and <code><a href="#topic+influences.PR.missingdata">influences.PR.missingdata</a></code>.</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  data(dataexample.missingdata.stratified, package="CaseCohortCoxSurvival")

  cohort &lt;- dataexample.missingdata.stratified$cohort
  phase2 &lt;- cohort[which(cohort$phase2 == 1),] # the phase-two sample
  casecohort &lt;- cohort[which(cohort$phase3 == 1),] # the stratified case-cohort

  B.phase2 &lt;- cbind(1 * (phase2$W3 == 0), 1 * (phase2$W3 == 1))
  rownames(B.phase2) &lt;- cohort[cohort$phase2 == 1, "id"]
  B.phase3 &lt;- cbind(1 * (casecohort$W3 == 0), 1 * (casecohort$W3 == 1))
  rownames(B.phase3) &lt;- cohort[cohort$phase3 == 1, "id"]
  total.B.phase2 &lt;- colSums(B.phase2)
  J3 &lt;- ncol(B.phase3)

  estimation.weights.p3 &lt;- estimation.weights.phase3(B.phase3 = B.phase3,
                                                  total.phase2 = total.B.phase2,
                                                  gamma0 = rep(0, J3),
                                                  niter.max = 10^(4),
                                                  epsilon.stop = 10^(-10))
</code></pre>

<hr>
<h2 id='influences'>influences</h2><span id='topic+influences'></span>

<h3>Description</h3>

<p>Computes the influences on the log-relative hazard, baseline hazards at each
unique event time, cumulative baseline hazard in a given time interval
[Tau1, Tau2] and on the pure risk in [Tau1, Tau2] and for a given covariate
profile x. Can take calibration of the design weights into account.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>influences(mod, Tau1 = NULL, Tau2 = NULL, x = NULL, calibrated = NULL,
A = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="influences_+3A_mod">mod</code></td>
<td>
<p>a cox model object, result of function coxph.</p>
</td></tr>
<tr><td><code id="influences_+3A_tau1">Tau1</code></td>
<td>
<p>left bound of the time interval considered for the cumulative
baseline hazard and pure risk. Default is the first event time.</p>
</td></tr>
<tr><td><code id="influences_+3A_tau2">Tau2</code></td>
<td>
<p>right bound of the time interval considered for the cumulative
baseline hazard and pure risk. Default is the last event time.</p>
</td></tr>
<tr><td><code id="influences_+3A_x">x</code></td>
<td>
<p>vector of length <code class="reqn">p</code>, specifying the covariate profile considered for the
pure risk. Default is (0,...,0).</p>
</td></tr>
<tr><td><code id="influences_+3A_calibrated">calibrated</code></td>
<td>
<p>are calibrated weights used for the estimation of the
parameters? If <code>calibrated = TRUE</code>, the argument below needs to be
provided. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="influences_+3A_a">A</code></td>
<td>
<p><code class="reqn">n \times q</code> matrix with the values of the auxiliary variables used for
the calibration of the weights in the whole cohort. Needs to be provided if
<code>calibrated = TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>influences</code> works for estimation from a case-cohort with design weights
or calibrated weights (case-cohort consisting of the subcohort and cases not in
the subcohort, i.e., case-cohort obtained from two phases of sampling).
</p>
<p>If covariate information is missing for certain individuals in the phase-two data
(i.e., case-cohort obtained from three phases of sampling), use <code><a href="#topic+influences.missingdata">influences.missingdata</a></code>.
</p>
<p><code>influences</code> uses the influence formulas provided in Etievant and Gail
(2024).
</p>
<p>If <code>calibrated = FALSE</code>, the infuences are only provided for the individuals
in the case-cohort. If <code>calibrated = TRUE</code>, the influences are provided for
all the individuals in the cohort.
</p>


<h3>Value</h3>

<p><code>infl.beta</code>: matrix with the overall influences on the log-relative hazard estimates.
</p>
<p><code>infl.lambda0.t</code>: matrix with the overall influences on the baseline hazards estimates at each unique event time.
</p>
<p><code>infl.Lambda0.Tau1Tau2.hat</code>: vector with the overall influences on the cumulative baseline hazard estimate in [Tau1, Tau2].
</p>
<p><code>infl.Pi.x.Tau1Tau2.hat</code>: vector with the overall influences on the pure risk estimate in [Tau1, Tau2] and for covariate profile <code>x</code>.
</p>
<p><code>infl2.beta</code>: matrix with the phase-two influences on the log-relative hazard estimates. Returned if <code>calibrated = TRUE</code>.
</p>
<p><code>infl2.lambda0.t</code>: matrix with the phase-two influences on the baseline hazards estimates at each unique event time. Returned if <code>calibrated = TRUE</code>.
</p>
<p><code>infl2.Lambda0.Tau1Tau2.hat</code>: vector with the phase-two influences on the cumulative baseline hazard estimate in [Tau1, Tau2]. Returned if <code>calibrated = TRUE</code>.
</p>
<p><code>infl2.Pi.x.Tau1Tau2.hat</code>: vector with the phase-two influences on the pure risk estimate in [Tau1, Tau2] and for covariate profile <code>x</code>. Returned if <code>calibrated = TRUE</code>.
</p>
<p><code>beta.hat</code>: vector of length <code class="reqn">p</code> with log-relative hazard estimates.
</p>
<p><code>lambda0.t.hat</code>: vector with baseline hazards estimates at each unique event time.
</p>
<p><code>Lambda0.Tau1Tau2.hat</code>: cumulative baseline hazard estimate in [Tau1, Tau2].
</p>
<p><code>Pi.x.Tau1Tau2.hat</code>: pure risk estimate in [Tau1, Tau2] and for covariate profile <code>x</code>.
</p>


<h3>References</h3>

<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+estimation">estimation</a></code>, <code><a href="#topic+estimation.CumBH">estimation.CumBH</a></code>, <code><a href="#topic+estimation.PR">estimation.PR</a></code>,
<code><a href="#topic+influences.RH">influences.RH</a></code>, <code><a href="#topic+influences.CumBH">influences.CumBH</a></code>, <code><a href="#topic+influences.PR">influences.PR</a></code>,
<code><a href="#topic+influences.missingdata">influences.missingdata</a></code>, <code><a href="#topic+influences.RH.missingdata">influences.RH.missingdata</a></code>,
<code><a href="#topic+influences.CumBH.missingdata">influences.CumBH.missingdata</a></code>,
<code><a href="#topic+influences.PR.missingdata">influences.PR.missingdata</a></code>, <code><a href="#topic+robustvariance">robustvariance</a></code> and  <code><a href="#topic+variance">variance</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  data(dataexample.stratified, package="CaseCohortCoxSurvival")
  cohort &lt;- dataexample.stratified$cohort
  casecohort &lt;- cohort[which(cohort$status == 1 |
                       cohort$subcohort == 1),] # the stratified case-cohort
  casecohort$weights &lt;- casecohort$strata.n / casecohort$strata.m
  casecohort$weights[which(casecohort$status == 1)] &lt;- 1

  Tau1 &lt;- 0
  Tau2 &lt;- 8
  x &lt;- c(-1, 1, -0.6) # given covariate profile for the pure risk

  # Estimation using the stratified case cohort with design weights
  mod &lt;- coxph(Surv(event.time, status) ~ X1 + X2 + X3, data = casecohort,
               weight = weights, id = id, robust = TRUE)
  est &lt;- influences(mod, Tau1 = Tau1, Tau2 = Tau2, x = x)

  # print the vector with log-relative hazard estimates
  est$beta.hat

  # print the cumulative baseline hazard estimate
  est$Lambda0.Tau1Tau2.hat

  # print the pure risk estimate
  est$Pi.x.Tau1Tau2.hat

  # print the influences on the log-relative hazard estimates
  # est$infl.beta

  # print the influences on the cumulative baseline hazard estimate
  # est$infl.Lambda0.Tau1Tau2

  # print the influences on the pure risk estimate
  # est$infl.Pi.x.Tau1Tau2
</code></pre>

<hr>
<h2 id='influences.CumBH'>influences.CumBH</h2><span id='topic+influences.CumBH'></span>

<h3>Description</h3>

<p>Computes the influences on the log-relative hazard, baseline hazards at each
unique event time, and on the cumulative baseline hazard in a given time interval
[Tau1, Tau2]. Can take calibration of the design weights into account.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>influences.CumBH(mod, Tau1 = NULL, Tau2 = NULL, A=NULL, calibrated = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="influences.CumBH_+3A_mod">mod</code></td>
<td>
<p>a cox model object, result of function coxph.</p>
</td></tr>
<tr><td><code id="influences.CumBH_+3A_tau1">Tau1</code></td>
<td>
<p>left bound of the time interval considered for the cumulative
baseline hazard and pure risk. Default is the first event time.</p>
</td></tr>
<tr><td><code id="influences.CumBH_+3A_tau2">Tau2</code></td>
<td>
<p>right bound of the time interval considered for the cumulative
baseline hazard and pure risk. Default is the last event time.</p>
</td></tr>
<tr><td><code id="influences.CumBH_+3A_a">A</code></td>
<td>
<p><code class="reqn">n \times q</code> matrix with the values of the auxiliary variables used for
the calibration of the weights in the whole cohort. Needs to be provided if
<code>calibrated = TRUE</code>.</p>
</td></tr>
<tr><td><code id="influences.CumBH_+3A_calibrated">calibrated</code></td>
<td>
<p>are calibrated weights used for the estimation of the
parameters? If <code>calibrated = TRUE</code>, the argument below needs to be
provided. Default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>influences.CumBH</code> works for estimation from a case-cohort with design weights
or calibrated weights (case-cohort consisting of the subcohort and cases not in
the subcohort, i.e., case-cohort obtained from two phases of sampling).
</p>
<p>If covariate information is missing for certain individuals in the phase-two data
(i.e., case-cohort obtained from three phases of sampling), use <code><a href="#topic+influences.CumBH.missingdata">influences.CumBH.missingdata</a></code>.
</p>
<p><code>influences.CumBH</code> uses the influence formulas provided in Etievant and Gail
(2024).
</p>
<p>If <code>calibrated = FALSE</code>, the infuences are only provided for the individuals
in the case-cohort. If <code>calibrated = TRUE</code>, the influences are provided for
all the individuals in the cohort.
</p>


<h3>Value</h3>

<p><code>infl.beta</code>: matrix with the overall influences on the log-relative hazard
estimates.
</p>
<p><code>infl.lambda0.t</code>: matrix with the overall influences on the baseline hazards
estimates at each unique event time.
</p>
<p><code>infl.Lambda0.Tau1Tau2.hat</code>: vector with the overall influences on the
cumulative baseline hazard estimate in [Tau1, Tau2].
</p>
<p><code>infl2.beta</code>: matrix with the phase-two influences on the log-relative
hazard estimates. Returned if <code>calibrated = TRUE</code>.
</p>
<p><code>infl2.lambda0.t</code>: matrix with the phase-two influences on the baseline
hazards estimates at each unique event time. Returned if <code>calibrated = TRUE</code>.
</p>
<p><code>infl2.Lambda0.Tau1Tau2.hat</code>: vector with the phase-two influences on the
cumulative baseline hazard estimate in [Tau1, Tau2]. Returned if
<code>calibrated = TRUE</code>.
</p>
<p><code>beta.hat</code>: vector of length <code class="reqn">p</code> with log-relative hazard estimates.
</p>
<p><code>lambda0.t.hat</code>: vector with baseline hazards estimates at each unique event
time.
</p>
<p><code>Lambda0.Tau1Tau2.hat</code>: cumulative baseline hazard estimate in [Tau1, Tau2].
</p>


<h3>References</h3>

<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+estimation">estimation</a></code>, <code><a href="#topic+estimation.CumBH">estimation.CumBH</a></code>, <code><a href="#topic+estimation.PR">estimation.PR</a></code>,
<code><a href="#topic+influences">influences</a></code>, <code><a href="#topic+influences.RH">influences.RH</a></code>, <code><a href="#topic+influences.PR">influences.PR</a></code>,
<code><a href="#topic+influences.missingdata">influences.missingdata</a></code>, <code><a href="#topic+influences.RH.missingdata">influences.RH.missingdata</a></code>,
<code><a href="#topic+influences.CumBH.missingdata">influences.CumBH.missingdata</a></code>,<br />
<code><a href="#topic+influences.PR.missingdata">influences.PR.missingdata</a></code>, <code><a href="#topic+robustvariance">robustvariance</a></code> and  <code><a href="#topic+variance">variance</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  data(dataexample.stratified, package="CaseCohortCoxSurvival")
  cohort &lt;- dataexample.stratified$cohort
  casecohort &lt;- cohort[which(cohort$status == 1 |
                       cohort$subcohort == 1),] # the stratified case-cohort
  casecohort$weights &lt;- casecohort$strata.n / casecohort$strata.m
  casecohort$weights[which(casecohort$status == 1)] &lt;- 1

  Tau1 &lt;- 0
  Tau2 &lt;- 8
  x &lt;- c(-1, 1, -0.6) # given covariate profile for the pure risk

  # Estimation using the stratified case cohort with design weights
  mod &lt;- coxph(Surv(event.time, status) ~ X1 + X2 + X3, data = casecohort,
               weight = weights, id = id, robust = TRUE)
  est &lt;- influences(mod, Tau1 = Tau1, Tau2 = Tau2, x = x)

  # print the influences on the cumulative baseline hazard estimate
  # est$infl.Lambda0.Tau1Tau2

</code></pre>

<hr>
<h2 id='influences.CumBH.missingdata'>influences.CumBH.missingdata</h2><span id='topic+influences.CumBH.missingdata'></span>

<h3>Description</h3>

<p>Computes the influences on the log-relative hazard, baseline hazards at each
unique event time, and on the cumulative baseline hazard in a given time
interval [Tau1, Tau2], when covariate data is missing for certain individuals
in the phase-two data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>influences.CumBH.missingdata(mod, riskmat.phase2, dNt.phase2 = NULL,
status.phase2 = NULL, Tau1 = NULL, Tau2 = NULL, estimated.weights = FALSE,
B.phase2 = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="influences.CumBH.missingdata_+3A_mod">mod</code></td>
<td>
<p>a cox model object, result of function coxph.</p>
</td></tr>
<tr><td><code id="influences.CumBH.missingdata_+3A_riskmat.phase2">riskmat.phase2</code></td>
<td>
<p>at risk matrix for the phase-two data at all of the cases
event times, even those with missing covariate data.</p>
</td></tr>
<tr><td><code id="influences.CumBH.missingdata_+3A_dnt.phase2">dNt.phase2</code></td>
<td>
<p>counting process matrix for failures in the phase-two data.
Needs to be provided if <code>status.phase2 = NULL</code>.</p>
</td></tr>
<tr><td><code id="influences.CumBH.missingdata_+3A_status.phase2">status.phase2</code></td>
<td>
<p>vector indicating the case status in the phase-two data.
Needs to be provided if <code>dNt.phase2 = NULL</code>.</p>
</td></tr>
<tr><td><code id="influences.CumBH.missingdata_+3A_tau1">Tau1</code></td>
<td>
<p>left bound of the time interval considered for the cumulative
baseline hazard and pure risk. Default is the first event time.</p>
</td></tr>
<tr><td><code id="influences.CumBH.missingdata_+3A_tau2">Tau2</code></td>
<td>
<p>right bound of the time interval considered for the cumulative
baseline hazard and pure risk. Default is the last event time.</p>
</td></tr>
<tr><td><code id="influences.CumBH.missingdata_+3A_estimated.weights">estimated.weights</code></td>
<td>
<p>are the weights for the third phase of sampling (due to
missingness) estimated? If <code>estimated.weights = TRUE</code>, the argument below
needs to be provided. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="influences.CumBH.missingdata_+3A_b.phase2">B.phase2</code></td>
<td>
<p>matrix for the phase-two data, with phase-three sampling strata
indicators. It should have as many columns as phase-three strata (<code class="reqn">J^{(3)}</code>),
with one 1 per row, to indicate the phase-three stratum position. Needs to be
provided if <code>estimated.weights = TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>influences.CumBH.missingdata</code> works for estimation from a case-cohort with design
weights and when covariate data was missing for certain individuals in the
phase-two data (i.e., case-cohort obtained from three phases of sampling).
</p>
<p>If there are no missing covariates in the phase-two sample, use <code><a href="#topic+influences.CumBH">influences.CumBH</a></code>
with either design weights or calibrated weights.
</p>
<p><code>influences.CumBH.missingdata</code> uses the influence formulas provided in Etievant
and Gail (2024).
</p>


<h3>Value</h3>

<p><code>infl.beta</code>: matrix with the overall influences on the log-relative hazard estimates.
</p>
<p><code>infl.lambda0.t</code>: matrix with the overall influences on the baseline hazards estimates at each unique event time.
</p>
<p><code>infl.Lambda0.Tau1Tau2.hat</code>: vector with the overall influences on the cumulative baseline hazard estimate in [Tau1, Tau2].
</p>
<p><code>infl2.beta</code>: matrix with the phase-two influences on the log-relative hazard estimates.
</p>
<p><code>infl2.lambda0.t</code>: matrix with the phase-two influences on the baseline hazards estimates at each unique event time.
</p>
<p><code>infl2.Lambda0.Tau1Tau2.hat</code>: vector with the phase-two influences on the cumulative baseline hazard estimate in [Tau1, Tau2].
</p>
<p><code>infl3.beta</code>: matrix with the phase-three influences on the log-relative hazard estimates.
</p>
<p><code>infl3.lambda0.t</code>: matrix with the phase-three influences on the baseline hazards estimates at each unique event time.
</p>
<p><code>infl3.Lambda0.Tau1Tau2.hat</code>: vector with the phase-three influences on the cumulative baseline hazard estimate in [Tau1, Tau2].
</p>
<p><code>beta.hat</code>: vector of length <code class="reqn">p</code> with log-relative hazard estimates.
</p>
<p><code>lambda0.t.hat</code>: vector with baseline hazards estimates at each unique event time.
</p>
<p><code>Lambda0.Tau1Tau2.hat</code>: cumulative baseline hazard estimate in [Tau1, Tau2].
</p>


<h3>References</h3>

<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+estimation">estimation</a></code>, <code><a href="#topic+estimation.CumBH">estimation.CumBH</a></code>, <code><a href="#topic+estimation.PR">estimation.PR</a></code>,
<code><a href="#topic+influences.missingdata">influences.missingdata</a></code>, <code><a href="#topic+influences.RH.missingdata">influences.RH.missingdata</a></code>,
<code><a href="#topic+influences.PR.missingdata">influences.PR.missingdata</a></code>, <code><a href="#topic+influences">influences</a></code>, <code><a href="#topic+influences.RH">influences.RH</a></code>, <code><a href="#topic+influences.CumBH">influences.CumBH</a></code>,
<code><a href="#topic+influences.PR">influences.PR</a></code>, <code><a href="#topic+robustvariance">robustvariance</a></code> and <code><a href="#topic+variance">variance</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  data(dataexample.missingdata.stratified, package="CaseCohortCoxSurvival")

  cohort &lt;- dataexample.missingdata.stratified$cohort
  phase2 &lt;- cohort[which(cohort$phase2 == 1),] # the phase-two sample
  casecohort &lt;- cohort[which(cohort$phase3 == 1),] # the stratified case-cohort

  B.phase2 &lt;- cbind(1 * (phase2$W3 == 0), 1 * (phase2$W3 == 1))
  rownames(B.phase2)  &lt;- cohort[cohort$phase2 == 1, "id"]
  B.phase3 &lt;- cbind(1 * (casecohort$W3 == 0), 1 * (casecohort$W3 == 1))
  rownames(B.phase3)  &lt;- cohort[cohort$phase3 == 1, "id"]
  total.B.phase2 &lt;- colSums(B.phase2)
  J3 &lt;- ncol(B.phase3)
  n &lt;- nrow(cohort)

  # Quantities needed for estimation of the cumulative baseline hazard when
  # covariate data is missing
  mod.cohort &lt;- coxph(Surv(event.time, status) ~ X2, data = cohort,
                      robust = TRUE) # X2 is available on all cohort members
  mod.cohort.detail &lt;- coxph.detail(mod.cohort, riskmat = TRUE)

  riskmat.phase2 &lt;- with(cohort, mod.cohort.detail$riskmat[phase2 == 1,])
  rownames(riskmat.phase2) &lt;- cohort[cohort$phase2 == 1, "id"]
  observed.times.phase2 &lt;- apply(riskmat.phase2, 1,
                                 function(v) {which.max(cumsum(v))})
  dNt.phase2 &lt;- matrix(0, nrow(riskmat.phase2), ncol(riskmat.phase2))
  dNt.phase2[cbind(1:nrow(riskmat.phase2), observed.times.phase2)] &lt;- 1
  dNt.phase2 &lt;- sweep(dNt.phase2, 1, phase2$status, "*")
  colnames(dNt.phase2) &lt;- colnames(riskmat.phase2)
  rownames(dNt.phase2) &lt;- rownames(riskmat.phase2)

  Tau1 &lt;- 0 # given time interval for the pure risk
  Tau2 &lt;- 8
  x &lt;- c(-1, 1, -0.6) # given covariate profile for the pure risk

  # Estimation using the stratified case cohort with true known design weights
  mod.true &lt;- coxph(Surv(event.time, status) ~ X1 + X2 + X3, data = casecohort,
                    weight = weight.true, id = id, robust = TRUE)

  est.true &lt;- influences.missingdata(mod = mod.true, riskmat.phase2 = riskmat.phase2,
                                     dNt.phase2 = dNt.phase2, Tau1 = Tau1,
                                     Tau2 = Tau2, x = x)

  # print the influences on the cumulative baseline hazard estimate
  # est.true$infl.Lambda0.Tau1Tau2
  # print the phase-two influences on the cumulative baseline hazard estimate
  # est.true$infl2.Lambda0.Tau1Tau2
  # print the phase-three influences on the cumulative baseline hazard estimate
  # est.true$infl3.Lambda0.Tau1Tau2

  # Estimation using the stratified case cohort with estimated weights, and
  # accounting for the estimation through the influences
  mod.estimated &lt;- coxph(Surv(event.time, status) ~ X1 + X2 + X3,
                         data = casecohort, weight = weight.est, id = id,
                         robust = TRUE)

  est.estimated  &lt;- influences.missingdata(mod.estimated,
                                           riskmat.phase2 = riskmat.phase2,
                                           dNt.phase2 = dNt.phase2,
                                           estimated.weights = TRUE,
                                           B.phase2 = B.phase2, Tau1 = Tau1,
                                           Tau2 = Tau2, x = x)

  # print the influences on the cumulative baseline hazard estimate
  # est.estimated$infl.Lambda0.Tau1Tau2
  # print the phase-two influences on the cumulative baseline hazard estimate
  # est.estimated$infl2.Lambda0.Tau1Tau2
  # print the phase-three influences on the cumulative baseline hazard estimate
  # est.estimated$infl3.Lambda0.Tau1Tau2

</code></pre>

<hr>
<h2 id='influences.missingdata'>influences.missingdata</h2><span id='topic+influences.missingdata'></span>

<h3>Description</h3>

<p>Computes the influences on the log-relative hazard, baseline hazards at each
unique event time, cumulative baseline hazard in a given time interval
[Tau1, Tau2] and on the pure risk in [Tau1, Tau2] and for a given covariate
profile x, when covariate data is missing for certain individuals
in the phase-two data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>influences.missingdata(mod, riskmat.phase2, dNt.phase2 = NULL,
status.phase2 = NULL, Tau1 = NULL, Tau2 = NULL, x = NULL,
estimated.weights = FALSE, B.phase2 = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="influences.missingdata_+3A_mod">mod</code></td>
<td>
<p>a cox model object, result of function coxph.</p>
</td></tr>
<tr><td><code id="influences.missingdata_+3A_riskmat.phase2">riskmat.phase2</code></td>
<td>
<p>at risk matrix for the phase-two data at all of the cases
event times, even those with missing covariate data.</p>
</td></tr>
<tr><td><code id="influences.missingdata_+3A_dnt.phase2">dNt.phase2</code></td>
<td>
<p>counting process matrix for failures in the phase-two data.
Needs to be provided if <code>status.phase2 = NULL</code>.</p>
</td></tr>
<tr><td><code id="influences.missingdata_+3A_status.phase2">status.phase2</code></td>
<td>
<p>vector indicating the case status in the phase-two data.
Needs to be provided if <code>dNt.phase2 = NULL</code>.</p>
</td></tr>
<tr><td><code id="influences.missingdata_+3A_tau1">Tau1</code></td>
<td>
<p>left bound of the time interval considered for the cumulative
baseline hazard and pure risk. Default is the first event time.</p>
</td></tr>
<tr><td><code id="influences.missingdata_+3A_tau2">Tau2</code></td>
<td>
<p>right bound of the time interval considered for the cumulative
baseline hazard and pure risk. Default is the last event time.</p>
</td></tr>
<tr><td><code id="influences.missingdata_+3A_x">x</code></td>
<td>
<p>vector of length <code class="reqn">p</code>, specifying the covariate profile considered for the
pure risk. Default is (0,...,0).</p>
</td></tr>
<tr><td><code id="influences.missingdata_+3A_estimated.weights">estimated.weights</code></td>
<td>
<p>are the weights for the third phase of sampling (due to
missingness) estimated? If <code>estimated.weights = TRUE</code>, the argument below
needs to beprovided. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="influences.missingdata_+3A_b.phase2">B.phase2</code></td>
<td>
<p>matrix for the phase-two data, with phase-three sampling strata
indicators. It should have as many columns as phase-three strata (<code class="reqn">J^{(3)}</code>),
with one 1 per row, to indicate the phase-three stratum position. Needs to be
provided if <code>estimated.weights = TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>influences.missingdata</code> works for estimation from a case-cohort with design
weights and when covariate data was missing for certain individuals in the
phase-two data (i.e., case-cohort obtained from three phases of sampling).
</p>
<p>If there are no missing covariates in the phase- two sample, use <code><a href="#topic+influences">influences</a></code>
with either design weights or calibrated weights.
</p>
<p>When covariate information was missing for certain individuals in the phase-two data
(i.e., case-cohort obtained from three phases of sampling), use <code>influences.missingdata</code>.
</p>
<p><code>influences.missingdata</code> uses the influence formulas provided in Etievant
and Gail (2024).
</p>


<h3>Value</h3>

<p><code>infl.beta</code>: matrix with the overall influences on the log-relative hazard estimates.
</p>
<p><code>infl.lambda0.t</code>: matrix with the overall influences on the baseline hazards estimates at each unique event time.
</p>
<p><code>infl.Lambda0.Tau1Tau2.hat</code>: vector with the overall influences on the cumulative baseline hazard estimate in [Tau1, Tau2].
</p>
<p><code>infl.Pi.x.Tau1Tau2.hat</code>: vector with the overall influences on the pure risk estimate in
[Tau1, Tau2] and for covariate profile <code>x</code>.
</p>
<p><code>infl2.beta</code>: matrix with the phase-two influences on the log-relative hazard estimates.
</p>
<p><code>infl2.lambda0.t</code>: matrix with the phase-two influences on the baseline hazards estimates at each unique event time.
</p>
<p><code>infl2.Lambda0.Tau1Tau2.hat</code>: vector with the phase-two influences on the cumulative baseline hazard estimate in [Tau1, Tau2].
</p>
<p><code>infl2.Pi.x.Tau1Tau2.hat</code>: vector with the phase-two influences on the pure risk estimate in
[Tau1, Tau2] and for covariate profile <code>x</code>.
</p>
<p><code>infl3.beta</code>: matrix with the phase-three influences on the log-relative hazard estimates.
</p>
<p><code>infl3.lambda0.t</code>: matrix with the phase-three influences on the baseline hazards estimates at each unique event time.
</p>
<p><code>infl3.Lambda0.Tau1Tau2.hat</code>: vector with the phase-three influences on the cumulative baseline hazard estimate in [Tau1, Tau2].
</p>
<p><code>infl3.Pi.x.Tau1Tau2.hat</code>: vector with the phase-three influences on the pure risk estimate in
[Tau1, Tau2] and for covariate profile <code>x</code>.
</p>
<p><code>beta.hat</code>: vector of length <code class="reqn">p</code> with log-relative hazard estimates.
</p>
<p><code>lambda0.t.hat</code>: vector with baseline hazards estimates at each unique event time.
</p>
<p><code>Lambda0.Tau1Tau2.hat</code>: cumulative baseline hazard estimate in [Tau1, Tau2].
</p>
<p><code>Pi.x.Tau1Tau2.hat</code>: pure risk estimate in [Tau1, Tau2] and for covariate profile <code>x</code>.
</p>


<h3>References</h3>

<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+estimation">estimation</a></code>, <code><a href="#topic+estimation.CumBH">estimation.CumBH</a></code>, <code><a href="#topic+estimation.PR">estimation.PR</a></code>,
<code><a href="#topic+influences.RH.missingdata">influences.RH.missingdata</a></code>, <code><a href="#topic+influences.CumBH.missingdata">influences.CumBH.missingdata</a></code>,
<code><a href="#topic+influences.PR.missingdata">influences.PR.missingdata</a></code>, <code><a href="#topic+influences">influences</a></code>, <code><a href="#topic+influences.RH">influences.RH</a></code>, <code><a href="#topic+influences.CumBH">influences.CumBH</a></code>,
<code><a href="#topic+influences.PR">influences.PR</a></code>, <code><a href="#topic+robustvariance">robustvariance</a></code> and <code><a href="#topic+variance">variance</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  data(dataexample.missingdata.stratified, package="CaseCohortCoxSurvival")

  cohort &lt;- dataexample.missingdata.stratified$cohort
  phase2 &lt;- cohort[which(cohort$phase2 == 1),] # the phase-two sample
  casecohort &lt;- cohort[which(cohort$phase3 == 1),] # the stratified case-cohort

  B.phase2 &lt;- cbind(1 * (phase2$W3 == 0), 1 * (phase2$W3 == 1))
  rownames(B.phase2)  &lt;- cohort[cohort$phase2 == 1, "id"]
  B.phase3 &lt;- cbind(1 * (casecohort$W3 == 0), 1 * (casecohort$W3 == 1))
  rownames(B.phase3)  &lt;- cohort[cohort$phase3 == 1, "id"]
  total.B.phase2 &lt;- colSums(B.phase2)
  J3 &lt;- ncol(B.phase3)
  n &lt;- nrow(cohort)

  # Quantities needed for estimation of the cumulative baseline hazard when
  # covariate data is missing
  mod.cohort &lt;- coxph(Surv(event.time, status) ~ X2, data = cohort,
                      robust = TRUE) # X2 is available on all cohort members
  mod.cohort.detail &lt;- coxph.detail(mod.cohort, riskmat = TRUE)

  riskmat.phase2 &lt;- with(cohort, mod.cohort.detail$riskmat[phase2 == 1,])
  rownames(riskmat.phase2) &lt;- cohort[cohort$phase2 == 1, "id"]
  observed.times.phase2 &lt;- apply(riskmat.phase2, 1,
                                 function(v) {which.max(cumsum(v))})
  dNt.phase2 &lt;- matrix(0, nrow(riskmat.phase2), ncol(riskmat.phase2))
  dNt.phase2[cbind(1:nrow(riskmat.phase2), observed.times.phase2)] &lt;- 1
  dNt.phase2 &lt;- sweep(dNt.phase2, 1, phase2$status, "*")
  colnames(dNt.phase2) &lt;- colnames(riskmat.phase2)
  rownames(dNt.phase2) &lt;- rownames(riskmat.phase2)

  Tau1 &lt;- 0 # given time interval for the pure risk
  Tau2 &lt;- 8
  x &lt;- c(-1, 1, -0.6) # given covariate profile for the pure risk

  # Estimation using the stratified case cohort with true known design weights
  mod.true &lt;- coxph(Surv(event.time, status) ~ X1 + X2 + X3, data = casecohort,
                    weight = weight.true, id = id, robust = TRUE)

  est.true &lt;- influences.missingdata(mod = mod.true,
                                     riskmat.phase2 = riskmat.phase2,
                                     dNt.phase2 = dNt.phase2, Tau1 = Tau1,
                                     Tau2 = Tau2, x = x)

  # print the influences on the log-relative hazard estimates
  # est.true$infl.beta
  # print the phase-two influences on the log-relative hazard estimates
  # est.true$infl2.beta
  # print the phase-three influences on the log-relative hazard estimates
  # est.true$infl3.beta

  # print the influences on the cumulative baseline hazard estimate
  # est.true$infl.Lambda0.Tau1Tau2
  # print the phase-two influences on the cumulative baseline hazard estimate
  # est.true$infl2.Lambda0.Tau1Tau2
  # print the phase-three influences on the cumulative baseline hazard estimate
  # est.true$infl3.Lambda0.Tau1Tau2

  # print the influences on the pure risk estimate
  # est.true$infl.Pi.x.Tau1Tau2
  # print the phase-two influences on the pure risk estimate
  # est.true$infl2.Pi.x.Tau1Tau2
  # print the phase-three influences on the pure risk estimate
  # est.true$infl3.Pi.x.Tau1Tau2

  # Estimation using the stratified case cohort with estimated weights, and
  # accounting for the estimation through the influences
  mod.estimated &lt;- coxph(Surv(event.time, status) ~ X1 + X2 + X3,
                         data = casecohort, weight = weight.est, id = id,
                         robust = TRUE)

  est.estimated  &lt;- influences.missingdata(mod.estimated,
                                           riskmat.phase2 = riskmat.phase2,
                                           dNt.phase2 = dNt.phase2,
                                           estimated.weights = TRUE,
                                           B.phase2 = B.phase2, Tau1 = Tau1,
                                           Tau2 = Tau2, x = x)

  # print the influences on the log-relative hazard estimates
  # est.estimated$infl.beta
  # print the phase-two influences on the log-relative hazard estimates
  # est.estimated$infl2.beta
  # print the phase-three influences on the log-relative hazard estimates
  # est.estimated$infl3.beta

  # print the influences on the cumulative baseline hazard estimate
  # est.estimated$infl.Lambda0.Tau1Tau2
  # print the phase-two influences on the cumulative baseline hazard estimate
  # est.estimated$infl2.Lambda0.Tau1Tau2
  # print the phase-three influences on the cumulative baseline hazard estimate
  # est.estimated$infl3.Lambda0.Tau1Tau2

  # print the influences on the pure risk estimate
  # est.estimated$infl.Pi.x.Tau1Tau2
  # print the phase-two influences on the pure risk estimate
  # est.estimated$infl2.Pi.x.Tau1Tau2
  # print the phase-three influences on the pure risk estimate
  # est.estimated$infl3.Pi.x.Tau1Tau2

</code></pre>

<hr>
<h2 id='influences.PR'>influences.PR</h2><span id='topic+influences.PR'></span>

<h3>Description</h3>

<p>Computes the influences on the pure risk in the time interval [Tau1, Tau2] and
for a given covariate profile x, from that on the log-relative hazard and
cumulative baseline hazard. Can take calibration of the design weights into
account.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>influences.PR(beta, Lambda0.Tau1Tau2, x = NULL, infl.beta,
infl.Lambda0.Tau1Tau2, calibrated = NULL, infl2.beta = NULL,
infl2.Lambda0.Tau1Tau2 = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="influences.PR_+3A_beta">beta</code></td>
<td>
<p>vector of length <code class="reqn">p</code> with log-relative hazard values.</p>
</td></tr>
<tr><td><code id="influences.PR_+3A_lambda0.tau1tau2">Lambda0.Tau1Tau2</code></td>
<td>
<p>cumulative baseline hazard in [Tau1, Tau2].</p>
</td></tr>
<tr><td><code id="influences.PR_+3A_x">x</code></td>
<td>
<p>vector of length <code class="reqn">p</code>, specifying the covariate profile considered for the
pure risk. Default is (0,...,0).</p>
</td></tr>
<tr><td><code id="influences.PR_+3A_infl.beta">infl.beta</code></td>
<td>
<p>matrix with the overall influences on the log-relative hazard
estimates.</p>
</td></tr>
<tr><td><code id="influences.PR_+3A_infl.lambda0.tau1tau2">infl.Lambda0.Tau1Tau2</code></td>
<td>
<p>vector with the overall influences on the
cumulative baseline hazard estimate in [Tau1, Tau2].</p>
</td></tr>
<tr><td><code id="influences.PR_+3A_calibrated">calibrated</code></td>
<td>
<p>are calibrated weights used for the estimation of the
parameters? If <code>calibrated = TRUE</code>, the arguments below need to be
provided. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="influences.PR_+3A_infl2.beta">infl2.beta</code></td>
<td>
<p>matrix with the phase-two influences on the log-relative
hazard estimates. Needs to be provided if <code>missing.data = TRUE</code>.</p>
</td></tr>
<tr><td><code id="influences.PR_+3A_infl2.lambda0.tau1tau2">infl2.Lambda0.Tau1Tau2</code></td>
<td>
<p>vector with the phase-two influences on the
cumulative baseline hazard estimate in [Tau1, Tau2]. Needs to be provided
if <code>missing.data = TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>influences.PR</code> works for estimation from a case-cohort with design weights
or calibrated weights (case-cohort consisting of the subcohort and cases not in
the subcohort, i.e., case-cohort obtained from two phases of sampling).
</p>
<p>If covariate information is missing for certain individuals in the phase-two data
(i.e., case-cohort obtained from three phases of sampling), use <code><a href="#topic+influences.PR.missingdata">influences.PR.missingdata</a></code>.
</p>
<p><code>influences</code> uses the influence formulas provided in Etievant and Gail
(2024).
</p>
<p>If <code>calibrated = FALSE</code>, the infuences are only provided for the individuals
in the case-cohort. If <code>calibrated = TRUE</code>, the influences are provided for
all the individuals in the cohort.
</p>


<h3>Value</h3>

<p><code>infl.Pi.x.Tau1Tau2.hat</code>: vector with the overall influences on the pure risk estimate in [Tau1, Tau2] and for covariate profile <code>x</code>.
</p>
<p><code>infl2.Pi.x.Tau1Tau2.hat</code>: vector with the phase-two influences on the pure risk estimate in [Tau1, Tau2] and for covariate profile <code>x</code>.
Returned if <code>calibrated = TRUE</code>.
</p>
<p><code>Pi.x.Tau1Tau2.hat</code>: pure risk estimate in [Tau1, Tau2] and for covariate profile <code>x</code>.
</p>


<h3>References</h3>

<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+estimation">estimation</a></code>, <code><a href="#topic+estimation.CumBH">estimation.CumBH</a></code>, <code><a href="#topic+estimation.PR">estimation.PR</a></code>,
<code><a href="#topic+influences">influences</a></code>, <code><a href="#topic+influences.RH">influences.RH</a></code>, <code><a href="#topic+influences.CumBH">influences.CumBH</a></code>,
<code><a href="#topic+influences.missingdata">influences.missingdata</a></code>, <code><a href="#topic+influences.RH.missingdata">influences.RH.missingdata</a></code>,
<code><a href="#topic+influences.CumBH.missingdata">influences.CumBH.missingdata</a></code>, <code><a href="#topic+influences.PR.missingdata">influences.PR.missingdata</a></code>,
<code><a href="#topic+robustvariance">robustvariance</a></code> and  <code><a href="#topic+variance">variance</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  data(dataexample.stratified, package="CaseCohortCoxSurvival")
  cohort &lt;- dataexample.stratified$cohort
  casecohort &lt;- cohort[which(cohort$status == 1 |
                       cohort$subcohort == 1),] # the stratified case-cohort
  casecohort$weights &lt;- casecohort$strata.n / casecohort$strata.m
  casecohort$weights[which(casecohort$status == 1)] &lt;- 1

  Tau1 &lt;- 0
  Tau2 &lt;- 8
  x &lt;- c(-1, 1, -0.6) # given covariate profile for the pure risk

  # Estimation using the stratified case cohort with design weights
  mod &lt;- coxph(Surv(event.time, status) ~ X1 + X2 + X3, data = casecohort,
               weight = weights, id = id, robust = TRUE)
  est &lt;- influences(mod, Tau1 = Tau1, Tau2 = Tau2, x = x)

  # print the influences on the pure risk estimate
  # est$infl.Pi.x.Tau1Tau2
</code></pre>

<hr>
<h2 id='influences.PR.missingdata'>influences.PR.missingdata</h2><span id='topic+influences.PR.missingdata'></span>

<h3>Description</h3>

<p>Computes the influences on the pure risk in the time interval [Tau1, Tau2] and
for a given covariate profile x, from that on the log-relative hazard and
cumulative baseline hazard, when covariate data is missing for certain individuals
in the phase-two data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>influences.PR.missingdata(beta, Lambda0.Tau1Tau2, x = NULL, infl2.beta,
infl2.Lambda0.Tau1Tau2, infl3.beta, infl3.Lambda0.Tau1Tau2)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="influences.PR.missingdata_+3A_beta">beta</code></td>
<td>
<p>vector of length <code class="reqn">p</code> with log-relative hazard values.</p>
</td></tr>
<tr><td><code id="influences.PR.missingdata_+3A_lambda0.tau1tau2">Lambda0.Tau1Tau2</code></td>
<td>
<p>cumulative baseline hazard in [Tau1, Tau2].</p>
</td></tr>
<tr><td><code id="influences.PR.missingdata_+3A_x">x</code></td>
<td>
<p>vector of length <code class="reqn">p</code>, specifying the covariate profile considered for
the pure risk. Default is (0,...,0).</p>
</td></tr>
<tr><td><code id="influences.PR.missingdata_+3A_infl2.beta">infl2.beta</code></td>
<td>
<p>matrix with the overall influences on the log-relative hazard
estimates.</p>
</td></tr>
<tr><td><code id="influences.PR.missingdata_+3A_infl2.lambda0.tau1tau2">infl2.Lambda0.Tau1Tau2</code></td>
<td>
<p>vector with the overall influences on the
cumulative baseline hazard estimate in [Tau1, Tau2].</p>
</td></tr>
<tr><td><code id="influences.PR.missingdata_+3A_infl3.beta">infl3.beta</code></td>
<td>
<p>matrix with the phase-three influences on the log-relative
hazard estimates. </p>
</td></tr>
<tr><td><code id="influences.PR.missingdata_+3A_infl3.lambda0.tau1tau2">infl3.Lambda0.Tau1Tau2</code></td>
<td>
<p>vector with the phase-three influences on the
cumulative baseline hazard estimate in [Tau1, Tau2]. </p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>influences.PR.missingdata</code> works for estimation from a case-cohort with design
weights and when covariate data was missing for certain individuals in the
phase-two data (i.e., case-cohort obtained from three phases of sampling).
</p>
<p>If there are no missing covariates in the phase- two sample, use <code><a href="#topic+influences.PR">influences.PR</a></code>
with either design weights or calibrated weights.
</p>
<p><code>influences.PR.missingdata</code> uses the influence formulas provided in Etievant
and Gail (2024).
</p>


<h3>Value</h3>

<p><code>infl.Pi.x.Tau1Tau2.hat</code>: vector with the overall influences on the pure risk estimate
in [Tau1, Tau2] and for covariate profile <code>x</code>.
</p>
<p><code>infl2.Pi.x.Tau1Tau2.hat</code>: vector with the phase-two influences on the pure risk estimate
in [Tau1, Tau2] and for covariate profile <code>x</code>.
</p>
<p><code>infl3.Pi.x.Tau1Tau2.hat</code>: vector with the phase-three influences on the pure risk estimate
in [Tau1, Tau2] and for covariate profile <code>x</code>.
</p>
<p><code>Pi.x.Tau1Tau2.hat</code>: pure risk estimate in [Tau1, Tau2] and for covariate profile <code>x</code>.
</p>


<h3>References</h3>

<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+estimation">estimation</a></code>, <code><a href="#topic+estimation.CumBH">estimation.CumBH</a></code>, <code><a href="#topic+estimation.PR">estimation.PR</a></code>,
<code><a href="#topic+influences.missingdata">influences.missingdata</a></code>, <code><a href="#topic+influences.RH.missingdata">influences.RH.missingdata</a></code>,
<code><a href="#topic+influences.CumBH.missingdata">influences.CumBH.missingdata</a></code>, <code><a href="#topic+influences">influences</a></code>, <code><a href="#topic+influences.RH">influences.RH</a></code>, <code><a href="#topic+influences.CumBH">influences.CumBH</a></code>,
<code><a href="#topic+influences.PR">influences.PR</a></code>, <code><a href="#topic+robustvariance">robustvariance</a></code> and <code><a href="#topic+variance">variance</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  data(dataexample.missingdata.stratified, package="CaseCohortCoxSurvival")

  cohort &lt;- dataexample.missingdata.stratified$cohort
  phase2 &lt;- cohort[which(cohort$phase2 == 1),] # the phase-two sample
  casecohort &lt;- cohort[which(cohort$phase3 == 1),] # the stratified case-cohort

  B.phase2 &lt;- cbind(1 * (phase2$W3 == 0), 1 * (phase2$W3 == 1))
  rownames(B.phase2)  &lt;- cohort[cohort$phase2 == 1, "id"]
  B.phase3 &lt;- cbind(1 * (casecohort$W3 == 0), 1 * (casecohort$W3 == 1))
  rownames(B.phase3)  &lt;- cohort[cohort$phase3 == 1, "id"]
  total.B.phase2 &lt;- colSums(B.phase2)
  J3 &lt;- ncol(B.phase3)
  n &lt;- nrow(cohort)

  # Quantities needed for estimation of the cumulative baseline hazard when
  # covariate data is missing
  mod.cohort &lt;- coxph(Surv(event.time, status) ~ X2, data = cohort,
                      robust = TRUE) # X2 is available on all cohort members
  mod.cohort.detail &lt;- coxph.detail(mod.cohort, riskmat = TRUE)

  riskmat.phase2 &lt;- with(cohort, mod.cohort.detail$riskmat[phase2 == 1,])
  rownames(riskmat.phase2) &lt;- cohort[cohort$phase2 == 1, "id"]
  observed.times.phase2 &lt;- apply(riskmat.phase2, 1,
                                 function(v) {which.max(cumsum(v))})
  dNt.phase2 &lt;- matrix(0, nrow(riskmat.phase2), ncol(riskmat.phase2))
  dNt.phase2[cbind(1:nrow(riskmat.phase2), observed.times.phase2)] &lt;- 1
  dNt.phase2 &lt;- sweep(dNt.phase2, 1, phase2$status, "*")
  colnames(dNt.phase2) &lt;- colnames(riskmat.phase2)
  rownames(dNt.phase2) &lt;- rownames(riskmat.phase2)

  Tau1 &lt;- 0 # given time interval for the pure risk
  Tau2 &lt;- 8
  x &lt;- c(-1, 1, -0.6) # given covariate profile for the pure risk
  v &lt;- c(1, -1, 0.6) # over covariate profile

  # Estimation using the stratified case cohort with true known design weights
  mod.true &lt;- coxph(Surv(event.time, status) ~ X1 + X2 + X3, data = casecohort,
                    weight = weight.true, id = id, robust = TRUE)

  est.true &lt;- influences.missingdata(mod = mod.true,
                                     riskmat.phase2 = riskmat.phase2,
                                     dNt.phase2 = dNt.phase2, Tau1 = Tau1,
                                     Tau2 = Tau2, x = x)

  beta.true &lt;- est.true$beta.hat
  Lambda0.true &lt;- est.true$Lambda0.Tau1Tau2.hat
  infl2.beta.true &lt;- est.true$infl2.beta
  infl2.Lambda0.true &lt;- est.true$infl2.Lambda0.Tau1Tau2
  infl3.beta.true &lt;- est.true$infl3.beta
  infl3.Lambda0.true &lt;- est.true$infl3.Lambda0.Tau1Tau2

  est.PR2.true &lt;- influences.PR.missingdata(beta = beta.true,
                                            Lambda0.Tau1Tau2 = Lambda0.true,
                                            x = v,
                                            infl2.beta = infl2.beta.true,
                                            infl2.Lambda0.Tau1Tau2 = infl2.Lambda0.true,
                                            infl3.beta = infl3.beta.true,
                                            infl3.Lambda0.Tau1Tau2 = infl3.Lambda0.true)

  # print the influences on the pure risk estimate
  # est.PR2.true$infl.Pi.x.Tau1Tau2
  # print the phase-two influences on the pure risk estimate
  # est.PR2.true$infl2.Pi.x.Tau1Tau2
  # print the phase-three influences on the pure risk estimate
  # est.PR2.true$infl3.Pi.x.Tau1Tau2

  # Estimation using the stratified case cohort with estimated weights, and
  # accounting for the estimation through the influences
  mod.estimated &lt;- coxph(Surv(event.time, status) ~ X1 + X2 + X3,
                         data = casecohort, weight = weight.est, id = id,
                         robust = TRUE)

  est.estimated  &lt;- influences.missingdata(mod.estimated,
                                           riskmat.phase2 = riskmat.phase2,
                                           dNt.phase2 = dNt.phase2,
                                           estimated.weights = TRUE,
                                           B.phase2 = B.phase2, Tau1 = Tau1,
                                           Tau2 = Tau2, x = x)

  beta.estimated &lt;- est.estimated$beta.hat
  Lambda0.estimated &lt;- est.estimated$Lambda0.Tau1Tau2.hat
  infl2.beta.estimated &lt;- est.estimated$infl2.beta
  infl2.Lambda0.estimated &lt;- est.estimated$infl2.Lambda0.Tau1Tau2
  infl3.beta.estimated &lt;- est.estimated$infl3.beta
  infl3.Lambda0.estimated &lt;- est.estimated$infl3.Lambda0.Tau1Tau2

  est.PR2.estimated &lt;- influences.PR.missingdata(beta = beta.estimated,
                                                 Lambda0.Tau1Tau2 = Lambda0.estimated,
                                                 x = v,
                                                 infl2.beta = infl2.beta.estimated,
                                                 infl2.Lambda0.Tau1Tau2 = infl2.Lambda0.estimated,
                                                 infl3.beta = infl3.beta.estimated,
                                                 infl3.Lambda0.Tau1Tau2 = infl3.Lambda0.estimated)

  # print the influences on the pure risk estimate
  # est.PR2.estimated$infl.Pi.x.Tau1Tau2
  # print the phase-two influences on the pure risk estimate
  # est.PR2.estimated$infl2.Pi.x.Tau1Tau2
  # print the phase-three influences on the pure risk estimate
  # est.PR2.estimated$infl3.Pi.x.Tau1Tau2

</code></pre>

<hr>
<h2 id='influences.RH'>influences.RH</h2><span id='topic+influences.RH'></span>

<h3>Description</h3>

<p>Computes the influences on the log-relative hazard. Can take calibration of the
design weights into account.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>influences.RH(mod, calibrated = NULL, A = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="influences.RH_+3A_mod">mod</code></td>
<td>
<p>a cox model object, result of function coxph.</p>
</td></tr>
<tr><td><code id="influences.RH_+3A_calibrated">calibrated</code></td>
<td>
<p>are calibrated weights used for the estimation of the
parameters? If <code>calibrated = TRUE</code>, the argument below needs to be
provided. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="influences.RH_+3A_a">A</code></td>
<td>
<p><code class="reqn">n \times q</code> matrix with the values of the auxiliary variables used for
the calibration of the weights in the whole cohort. Needs to be provided if
<code>calibrated = TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>influences.RH</code> works for estimation from a case-cohort with design weights
or calibrated weights (case-cohort consisting of the subcohort and cases not in
the subcohort, i.e., case-cohort obtained from two phases of sampling).
</p>
<p>If covariate information is missing for certain individuals in the phase-two data
(i.e., case-cohort obtained from three phases of sampling), use <code><a href="#topic+influences.RH.missingdata">influences.RH.missingdata</a></code>.
</p>
<p><code>influence.RH</code> uses the influence formulas provided in Etievant and Gail
(2024).
</p>
<p>If <code>calibrated = FALSE</code>, the infuences are only provided for the individuals
in the case-cohort. If <code>calibrated = TRUE</code>, the influences are provided for
all the individuals in the cohort.
</p>


<h3>Value</h3>

<p><code>infl.beta</code>: matrix with the overall influences on the log-relative hazard estimates.
</p>
<p><code>infl2.beta</code>: matrix with the phase-two influences on the log-relative hazard estimates. Returned if <code>calibrated = TRUE</code>.
</p>
<p><code>beta.hat</code>: vector of length <code class="reqn">p</code> with log-relative hazard estimates.
</p>


<h3>References</h3>

<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+estimation">estimation</a></code>, <code><a href="#topic+estimation.CumBH">estimation.CumBH</a></code>, <code><a href="#topic+estimation.PR">estimation.PR</a></code>,
<code><a href="#topic+influences">influences</a></code>, <code><a href="#topic+influences.CumBH">influences.CumBH</a></code>, <code><a href="#topic+influences.PR">influences.PR</a></code>,
<code><a href="#topic+influences.missingdata">influences.missingdata</a></code>, <code><a href="#topic+influences.RH.missingdata">influences.RH.missingdata</a></code>,
<code><a href="#topic+influences.CumBH.missingdata">influences.CumBH.missingdata</a></code>,<br />
<code><a href="#topic+influences.PR.missingdata">influences.PR.missingdata</a></code>, <code><a href="#topic+robustvariance">robustvariance</a></code> and  <code><a href="#topic+variance">variance</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  data(dataexample.stratified, package="CaseCohortCoxSurvival")
  cohort &lt;- dataexample.stratified$cohort
  casecohort &lt;- cohort[which(cohort$status == 1 |
                       cohort$subcohort == 1),] # the stratified case-cohort
  casecohort$weights &lt;- casecohort$strata.n / casecohort$strata.m
  casecohort$weights[which(casecohort$status == 1)] &lt;- 1

  Tau1 &lt;- 0
  Tau2 &lt;- 8
  x &lt;- c(-1, 1, -0.6) # given covariate profile for the pure risk

  # Estimation using the stratified case cohort with design weights
  mod &lt;- coxph(Surv(event.time, status) ~ X1 + X2 + X3, data = casecohort,
               weight = weights, id = id, robust = TRUE)
  est &lt;- influences(mod, Tau1 = Tau1, Tau2 = Tau2, x = x)

  # print the influences on the log-relative hazard estimates
  # est$infl.beta

</code></pre>

<hr>
<h2 id='influences.RH.missingdata'>influences.RH.missingdata</h2><span id='topic+influences.RH.missingdata'></span>

<h3>Description</h3>

<p>Computes the influences on the log-relative hazard, when covariate data is
missing for certain individuals in the phase-two data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>influences.RH.missingdata(mod, riskmat.phase2, dNt.phase2 = NULL,
status.phase2 = NULL, estimated.weights = FALSE, B.phase2 = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="influences.RH.missingdata_+3A_mod">mod</code></td>
<td>
<p>a cox model object, result of function coxph.</p>
</td></tr>
<tr><td><code id="influences.RH.missingdata_+3A_riskmat.phase2">riskmat.phase2</code></td>
<td>
<p>at risk matrix for the phase-two data at all of the cases
event times, even those with missing covariate data.</p>
</td></tr>
<tr><td><code id="influences.RH.missingdata_+3A_dnt.phase2">dNt.phase2</code></td>
<td>
<p>counting process matrix for failures in the phase-two data.
Needs to be provided if <code>status.phase2 = NULL</code>. </p>
</td></tr>
<tr><td><code id="influences.RH.missingdata_+3A_status.phase2">status.phase2</code></td>
<td>
<p>vector indicating the case status in the phase-two data.
Needs to be provided if <code>dNt.phase2 = NULL</code>.</p>
</td></tr>
<tr><td><code id="influences.RH.missingdata_+3A_estimated.weights">estimated.weights</code></td>
<td>
<p>are the weights for the third phase of sampling (due to
missingness) estimated? If <code>estimated.weights = TRUE</code>, the argument below
needs to beprovided. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="influences.RH.missingdata_+3A_b.phase2">B.phase2</code></td>
<td>
<p>matrix for the phase-two data, with phase-three sampling strata
indicators. It should have as many columns as phase-three strata (<code class="reqn">J^{(3)}</code>),
with one 1 per row, to indicate the phase-three stratum position. Needs to be
provided if <code>estimated.weights = TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>influences.RH.missingdata</code> works for estimation from a case-cohort with design
weights and when covariate data was missing for certain individuals in the
phase-two data (i.e., case-cohort obtained from three phases of sampling and
consisting of individuals in the phase-two data without missing covariate information).
</p>
<p>If there are no missing covariates in the phase- two sample, use <code>influences.RH</code>
with either design weights or calibrated weights.
</p>
<p><code>influences.RH.missingdata</code> uses the influence formulas provided in Etievant
and Gail (2024).
</p>


<h3>Value</h3>

<p><code>infl.beta</code>: matrix with the overall influences on the log-relative hazard estimates.
</p>
<p><code>infl2.beta</code>: matrix with the phase-two influences on the log-relative hazard estimates.
</p>
<p><code>infl3.beta</code>: matrix with the phase-three influences on the log-relative hazard estimates.
</p>
<p><code>beta.hat</code>: vector of length <code class="reqn">p</code> with log-relative hazard estimates.
</p>


<h3>References</h3>

<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+estimation">estimation</a></code>, <code><a href="#topic+estimation.CumBH">estimation.CumBH</a></code>, <code><a href="#topic+estimation.PR">estimation.PR</a></code>,
<code><a href="#topic+influences.missingdata">influences.missingdata</a></code>, <code><a href="#topic+influences.CumBH.missingdata">influences.CumBH.missingdata</a></code>,
<code><a href="#topic+influences.PR.missingdata">influences.PR.missingdata</a></code>, <code><a href="#topic+influences">influences</a></code>, <code><a href="#topic+influences.RH">influences.RH</a></code>, <code><a href="#topic+influences.CumBH">influences.CumBH</a></code>,
<code><a href="#topic+influences.PR">influences.PR</a></code>, <code><a href="#topic+robustvariance">robustvariance</a></code> and <code><a href="#topic+variance">variance</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  data(dataexample.missingdata.stratified, package="CaseCohortCoxSurvival")

  cohort &lt;- dataexample.missingdata.stratified$cohort
  phase2 &lt;- cohort[which(cohort$phase2 == 1),] # the phase-two sample
  casecohort &lt;- cohort[which(cohort$phase3 == 1),] # the stratified case-cohort

  B.phase2 &lt;- cbind(1 * (phase2$W3 == 0), 1 * (phase2$W3 == 1))
  rownames(B.phase2)  &lt;- cohort[cohort$phase2 == 1, "id"]
  B.phase3 &lt;- cbind(1 * (casecohort$W3 == 0), 1 * (casecohort$W3 == 1))
  rownames(B.phase3)  &lt;- cohort[cohort$phase3 == 1, "id"]
  total.B.phase2 &lt;- colSums(B.phase2)
  J3 &lt;- ncol(B.phase3)
  n &lt;- nrow(cohort)

  # Quantities needed for estimation of the cumulative baseline hazard when
  # covariate data is missing
  mod.cohort &lt;- coxph(Surv(event.time, status) ~ X2, data = cohort,
                      robust = TRUE) # X2 is available on all cohort members
  mod.cohort.detail &lt;- coxph.detail(mod.cohort, riskmat = TRUE)

  riskmat.phase2 &lt;- with(cohort, mod.cohort.detail$riskmat[phase2 == 1,])
  rownames(riskmat.phase2) &lt;- cohort[cohort$phase2 == 1, "id"]
  observed.times.phase2 &lt;- apply(riskmat.phase2, 1,
                                 function(v) {which.max(cumsum(v))})
  dNt.phase2 &lt;- matrix(0, nrow(riskmat.phase2), ncol(riskmat.phase2))
  dNt.phase2[cbind(1:nrow(riskmat.phase2), observed.times.phase2)] &lt;- 1
  dNt.phase2 &lt;- sweep(dNt.phase2, 1, phase2$status, "*")
  colnames(dNt.phase2) &lt;- colnames(riskmat.phase2)
  rownames(dNt.phase2) &lt;- rownames(riskmat.phase2)

  Tau1 &lt;- 0 # given time interval for the pure risk
  Tau2 &lt;- 8
  x &lt;- c(-1, 1, -0.6) # given covariate profile for the pure risk

  # Estimation using the stratified case cohort with true known design weights
  mod.true &lt;- coxph(Surv(event.time, status) ~ X1 + X2 + X3, data = casecohort,
                    weight = weight.true, id = id, robust = TRUE)

  est.true &lt;- influences.missingdata(mod = mod.true, riskmat.phase2 = riskmat.phase2,
                                     dNt.phase2 = dNt.phase2, Tau1 = Tau1,
                                     Tau2 = Tau2, x = x)

  # print the influences on the log-relative hazard estimates
  # est.true$infl.beta
  # print the phase-two influences on the log-relative hazard estimates
  # est.true$infl2.beta
  # print the phase-three influences on the log-relative hazard estimates
  # est.true$infl3.beta

  # Estimation using the stratified case cohort with estimated weights, and
  # accounting for the estimation through the influences
  mod.estimated &lt;- coxph(Surv(event.time, status) ~ X1 + X2 + X3,
                         data = casecohort, weight = weight.est, id = id,
                         robust = TRUE)

  est.estimated  &lt;- influences.missingdata(mod.estimated,
                                           riskmat.phase2 = riskmat.phase2,
                                           dNt.phase2 = dNt.phase2,
                                           estimated.weights = TRUE,
                                           B.phase2 = B.phase2, Tau1 = Tau1,
                                           Tau2 = Tau2, x = x)

  # print the influences on the log-relative hazard estimates
  # est.estimated$infl.beta
  # print the phase-two influences on the log-relative hazard estimates
  # est.estimated$infl2.beta
  # print the phase-three influences on the log-relative hazard estimates
  # est.estimated$infl3.beta

</code></pre>

<hr>
<h2 id='product.covar.weight'>product.covar.weight</h2><span id='topic+product.covar.weight'></span>

<h3>Description</h3>

<p>Computes the product of joint design weights and joint sampling indicators
covariances, needed for the phase-two component of the variance (with design or
calibrated weights).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>product.covar.weight(casecohort, stratified = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="product.covar.weight_+3A_casecohort">casecohort</code></td>
<td>
<p>if <code>stratified = TRUE</code>, data frame with <code>status</code> (case
status), <code>W</code> (the <code class="reqn">J</code> strata), <code>strata.m</code> (vector of length <code class="reqn">J</code> with the
numbers of sampled individuals in the strata) and <code>strata.n</code> (vector of length
<code class="reqn">J</code> with the strata sizes), for each individual in the stratified case-cohort
data. If <code>stratified = FALSE</code>, data frame with <code>status</code> (case status),
<code>m</code> (number of sampled individuals) and <code>n</code> (cohort size), for each
individual in the un-stratified case-cohort data.</p>
</td></tr>
<tr><td><code id="product.covar.weight_+3A_stratified">stratified</code></td>
<td>
<p>was the sampling of the case-cohort stratified on <code>W</code>?
Default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>product.covar.weight</code> creates the matrix with the products of joint design
weights and joint sampling indicator covariances, for the non-cases in the case
cohort. In other words, it has as many rows and columns as non-cases in the case
cohort, and contains the <code class="reqn">w_{i,k,j} \sigma_{i,k,j}</code>, with
</p>
<p><code class="reqn">w_{i,k,j} = \frac{n^{(j)}(n^{(j)} -1)}{m^{(j)}(m^{(j)} -1)}</code> if individuals
<code class="reqn">i</code> and <code class="reqn">k</code> in stratum <code class="reqn">j</code> are both non-cases, and
<code class="reqn">w_{i,k,j} = \left( \frac{n^{(j)}}{m^{(j)}} \right)^2</code> otherwise,
<code class="reqn">i \neq k \in \lbrace 1, \dots, n^{(j)} \rbrace</code>,
<code class="reqn">j \in \lbrace 1, \dots, J \rbrace</code>.
</p>
<p><code class="reqn">w_{i,i,j} = \frac{n^{(j)}}{m^{(j)}}</code> if individuals <code class="reqn">i</code> in stratum <code class="reqn">j</code>
is a non-case, <code class="reqn">i \in \lbrace 1, \dots, n^{(j)} \rbrace</code>,
<code class="reqn">j \in \lbrace 1, \dots, J \rbrace</code>.
</p>
<p><code class="reqn">\sigma_{i,k,j} = \frac{m^{(j)}(m^{(j)} -1)}{n^{(j)}(n^{(j)} -1)} -
    \left( \frac{m^{(j)}}{n^{(j)}} \right)^2</code> if individuals <code class="reqn">i</code> and
<code class="reqn">k</code> in stratum <code class="reqn">j</code> are both non-cases,
<code class="reqn">i \neq k \in \lbrace 1, \dots, n^{(j)} \rbrace</code>,
<code class="reqn">j \in \lbrace 1, \dots, J \rbrace</code>.
</p>
<p><code class="reqn">\sigma_{i,i,j} = \frac{m^{(j)}}{n^{(j)}} - \left(1 - \frac{m^{(j)}}{n^{(j)}} \right)</code>
if individuals <code class="reqn">i</code> in stratum <code class="reqn">j</code> is a non-case,
<code class="reqn">i \in \lbrace 1, \dots, n^{(j)} \rbrace</code>,
<code class="reqn">j \in \lbrace 1, \dots, J \rbrace</code>.
</p>
<p>See Etievant and Gail (2024).
</p>


<h3>Value</h3>

<p><code>product.covar.weight</code>: matrix with the products of joint design weights and
joint sampling indicator covariances, for the non-cases in the case-cohort.
</p>


<h3>References</h3>

<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+variance">variance</a></code>, that uses <code>product.covar.weight</code> to compute the variance
estimate that follows the complete variance decomposition (superpopulation and
phase-two variance components).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  data(dataexample.stratified, package="CaseCohortCoxSurvival")
  cohort &lt;- dataexample.stratified$cohort
  casecohort &lt;- cohort[which(cohort$status == 1 |
                       cohort$subcohort == 1),] # the stratified case-cohort

  prod.covar.weight &lt;- product.covar.weight(casecohort, stratified = TRUE)

  sum(casecohort$status == 0) # number of non-cases in the case-cohort

</code></pre>

<hr>
<h2 id='robustvariance'>robustvariance</h2><span id='topic+robustvariance'></span>

<h3>Description</h3>

<p>Computes the robust variance estimate, i.e., the sum of the squared influence
functions, for a parameter such as log-relative hazard, cumulative baseline
hazard or covariate specific pure-risk.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>robustvariance(infl)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="robustvariance_+3A_infl">infl</code></td>
<td>
<p>overall influences on a parameter such as log-relative hazard,
cumulative baseline hazard or covariate specific pure-risk.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>robustvariance</code> works for estimation with design or calibrated weights from
a case cohort obtained from two phases of sampling (i.e., case cohort consisting
of the subcohort and cases not in the subcohort), or when covariate information
was missing for certain individuals in the phase-two data (i.e., case cohort
obtained from three phases of sampling and consisting of individuals in the
phase-two data without missing covariate information).
</p>


<h3>Value</h3>

<p><code>robust.var</code>: robust variance estimate.
</p>


<h3>References</h3>

<p>Barlow W. (1994). Robust Variance Estimation for the Case-Cohort Design. Biometrics, 50, 1064-1072.
</p>
<p>Langholz B., Jiao J. (2007). Computational methods for case-cohort studies.
Computational Statistics &amp; Data Analysis, 51, 3737-37.
</p>
<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+influences.RH">influences.RH</a></code>, <code><a href="#topic+influences.CumBH">influences.CumBH</a></code>, <code><a href="#topic+influences.PR">influences.PR</a></code>,
<code><a href="#topic+influences.missingdata">influences.missingdata</a></code>, <code><a href="#topic+influences.RH.missingdata">influences.RH.missingdata</a></code>,
<code><a href="#topic+influences.CumBH.missingdata">influences.CumBH.missingdata</a></code>, <code><a href="#topic+influences.PR.missingdata">influences.PR.missingdata</a></code> and <code><a href="#topic+variance">variance</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  data(dataexample.stratified, package="CaseCohortCoxSurvival")
  cohort &lt;- dataexample.stratified$cohort
  casecohort &lt;- cohort[which(cohort$status == 1 |
                       cohort$subcohort == 1),] # the stratified case-cohort
  casecohort$weights &lt;- casecohort$strata.n / casecohort$strata.m
  casecohort$weights[which(casecohort$status == 1)] &lt;- 1

  Tau1 &lt;- 0
  Tau2 &lt;- 8
  x &lt;- c(-1, 1, -0.6) # given covariate profile for the pure risk

  # Estimation using the stratified case cohort with design weights
  mod &lt;- coxph(Surv(event.time, status) ~ X1 + X2 + X3, data = casecohort,
                     weight = weights, id = id, robust = TRUE)
  est &lt;- influences(mod, Tau1 = Tau1, Tau2 = Tau2, x = x)

  # robust variance estimate for the log-relative hazard
  robustvariance(est$infl.beta)

  # robust variance estimate for the cumulative baseline hazard estimate
  robustvariance(est$infl.Lambda0.Tau1Tau2)

  # robust variance estimate for the pure risk estimate
  robustvariance(est$infl.Pi.x.Tau1Tau2)

</code></pre>

<hr>
<h2 id='variance'>variance</h2><span id='topic+variance'></span>

<h3>Description</h3>

<p>Computes the variance estimate that follows the complete
variance decomposition, for a parameter such as log-relative hazard, cumulative
baseline hazard or covariate specific pure-risk.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>variance(n, casecohort, weights = NULL, infl, calibrated = NULL,
infl2 = NULL, cohort = NULL, stratified = NULL,
variance.phase2 = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="variance_+3A_n">n</code></td>
<td>
<p>number of individuals in the whole cohort.</p>
</td></tr>
<tr><td><code id="variance_+3A_casecohort">casecohort</code></td>
<td>
<p>If <code>stratified = TRUE</code>, data frame with <code>status</code>
(case status), <code>weights</code> (design, if they are not
provided in the argument below), <code>W</code> (the <code class="reqn">J</code> strata), <code>strata.m</code>
(vector of length <code class="reqn">J</code> with the numbers of sampled individuals in the strata) and
<code>strata.n</code> (vector of length <code class="reqn">J</code> with the strata sizes in the cohort), for
each individual in the stratified case-cohort data. If <code>stratified = FALSE</code>,
data frame with <code>weights</code> (design, if they are not
provided in the argument below), <code>m</code> (number of sampled individuals) and
<code>n</code> (cohort size), for each individual in the unstratified case-cohort data.</p>
</td></tr>
<tr><td><code id="variance_+3A_weights">weights</code></td>
<td>
<p>vector with design weights for the individuals
in the case-cohort data.</p>
</td></tr>
<tr><td><code id="variance_+3A_infl">infl</code></td>
<td>
<p>matrix with the overall influences on the parameter.</p>
</td></tr>
<tr><td><code id="variance_+3A_calibrated">calibrated</code></td>
<td>
<p>are calibrated weights used for the estimation of the
parameters? If <code>calibrated = TRUE</code>, the arguments below need to be
provided. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="variance_+3A_infl2">infl2</code></td>
<td>
<p>matrix with the phase-two influences on the parameter. Needs to be
provided if <code>calibrated = TRUE</code>.</p>
</td></tr>
<tr><td><code id="variance_+3A_cohort">cohort</code></td>
<td>
<p>If <code>stratified = TRUE</code>, data frame with <code>status</code> (case
status) and <code>subcohort</code> (subcohort sampling indicators) for each individual
in the stratified case-cohort data. If <code>stratified = FALSE</code>, data frame with
<code>status</code> (case status) and <code>unstrat.subcohort</code> (subcohort unstratified
sampling indicators) for each individual in the unstratified case-cohort data.
Needs to be provided if <code>calibrated = TRUE</code>.</p>
</td></tr>
<tr><td><code id="variance_+3A_stratified">stratified</code></td>
<td>
<p>was the sampling of the case-cohort stratified on <code>W</code>?
Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="variance_+3A_variance.phase2">variance.phase2</code></td>
<td>
<p>should the phase-two variance component also be returned?
Default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>variance</code> works for estimation from a case-cohort with design weights
or calibrated weights (case-cohort consisting of the subcohort and cases not in
the subcohort, i.e., case-cohort obtained from two phases of sampling).
</p>
<p>If covariate information is missing for certain individuals in the phase-two data
(i.e., case-cohort obtained from three phases of sampling), use <code><a href="#topic+variance.missingdata">variance.missingdata</a></code>.
</p>
<p><code>variance</code> uses the variance formulas provided in Etievant and Gail
(2024).
</p>


<h3>Value</h3>

<p><code>variance</code>: variance estimate.
</p>
<p><code>variance.phase2</code>: phase-two variance component.
</p>


<h3>References</h3>

<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+influences">influences</a></code>, <code><a href="#topic+influences.RH">influences.RH</a></code>, <code><a href="#topic+influences.CumBH">influences.CumBH</a></code>,
<code><a href="#topic+influences.PR">influences.PR</a></code>, <code><a href="#topic+robustvariance">robustvariance</a></code> and <code><a href="#topic+variance.missingdata">variance.missingdata</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  data(dataexample.stratified, package="CaseCohortCoxSurvival")
  cohort &lt;- dataexample.stratified$cohort
  casecohort &lt;- cohort[which(cohort$status == 1 |
                       cohort$subcohort == 1),] # the stratified case-cohort
  casecohort$weights &lt;- casecohort$strata.n / casecohort$strata.m
  casecohort$weights[which(casecohort$status == 1)] &lt;- 1

  Tau1 &lt;- 0
  Tau2 &lt;- 8
  x &lt;- c(-1, 1, -0.6) # given covariate profile for the pure risk
  n &lt;- nrow(cohort)

  # Estimation using the stratified case-cohort with design weights
  mod &lt;- coxph(Surv(event.time, status) ~ X1 + X2 + X3, data = casecohort,
               weight = weights, id = id, robust = TRUE)

  # parameters and influences estimation
  est           &lt;- influences(mod, Tau1 = Tau1, Tau2 = Tau2, x = x)
  beta.hat      &lt;- est$beta.hat
  Lambda0.hat   &lt;- est$Lambda0.Tau1Tau2.hat
  Pi.x.hat      &lt;- est$Pi.x.Tau1Tau2.hat
  infl.beta     &lt;- est$infl.beta
  infl.Lambda0  &lt;- est$infl.Lambda0.Tau1Tau2
  infl.Pi.x     &lt;- est$infl.Pi.x.Tau1Tau2

  # variance estimate for the log-relative hazard estimate
  variance(n = n, casecohort = casecohort, infl = infl.beta, stratified = TRUE)

  # variance estimate for the cumulative baseline hazard estimate
  variance(n = n, casecohort = casecohort, infl = infl.Lambda0,
           stratified = TRUE)

  # variance estimate for the pure risk estimate
  variance(n = n, casecohort = casecohort, infl = infl.Pi.x, stratified = TRUE)

</code></pre>

<hr>
<h2 id='variance.missingdata'>variance.missingdata</h2><span id='topic+variance.missingdata'></span>

<h3>Description</h3>

<p>Computes the variance estimate that follows the complete variance decomposition,
for a parameter such as log-relative hazard, cumulative baseline hazard or
covariate specific pure-risk, when covariate information is missing for
individuals in the phase-two sample.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>variance.missingdata(n, casecohort, casecohort.phase2, weights,
weights.phase2, weights.p2.phase2, infl2, infl3, stratified.p2 = NULL,
estimated.weights = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="variance.missingdata_+3A_n">n</code></td>
<td>
<p>number of individuals in the whole cohort.</p>
</td></tr>
<tr><td><code id="variance.missingdata_+3A_casecohort">casecohort</code></td>
<td>
<p>If <code>stratified = TRUE</code>, data frame with <code>W</code>
(the <code class="reqn">J</code> phase-two strata), <code>strata.m</code> (vector of length <code class="reqn">J</code> with the numbers of
sampled individuals in the strata in the second phase of sampling) and
<code>strata.n</code> (vector of length <code class="reqn">J</code> with the strata sizes in the cohort), for
each individual in the stratified case cohort data. If <code>stratified = FALSE</code>,
data frame with <code>m</code> (number of sampled individuals in the second phase of
sampling) and <code>n</code> (cohort size), for each individual in the unstratified
case cohort data.</p>
</td></tr>
<tr><td><code id="variance.missingdata_+3A_casecohort.phase2">casecohort.phase2</code></td>
<td>
<p>If <code>stratified = TRUE</code>, data frame with <code>W</code>
(the <code class="reqn">J</code> phase-two strata), <code>strata.m</code> (vector of length <code class="reqn">J</code> with the
numbers of sampled individuals in the strata in the second phase of sampling),
<code>strata.n</code> (vector of length <code class="reqn">J</code> with the strata sizes in the cohort) and
<code>phase3</code> (phase-three sampling indicator), for each individual in the
phase-two sample. If <code>stratified = FALSE</code>, data frame with  <code>m</code> (number
of sampled individuals in the second phase of sampling), <code>n</code> (cohort size)
and unstrat.phase3 (phase-three sampling indicator), for each individual in the
phase-two sample.</p>
</td></tr>
<tr><td><code id="variance.missingdata_+3A_weights">weights</code></td>
<td>
<p>vector with design weights for the individuals
in the case cohort data.</p>
</td></tr>
<tr><td><code id="variance.missingdata_+3A_weights.phase2">weights.phase2</code></td>
<td>
<p>vector with design weights for the individuals in the
phase-two sample.</p>
</td></tr>
<tr><td><code id="variance.missingdata_+3A_weights.p2.phase2">weights.p2.phase2</code></td>
<td>
<p>vector with phase-two design weights for the individuals
in the phase-two sample.</p>
</td></tr>
<tr><td><code id="variance.missingdata_+3A_infl2">infl2</code></td>
<td>
<p>matrix with the phase-two influences on the parameter.</p>
</td></tr>
<tr><td><code id="variance.missingdata_+3A_infl3">infl3</code></td>
<td>
<p>matrix with the phase-three influences on the parameter.</p>
</td></tr>
<tr><td><code id="variance.missingdata_+3A_stratified.p2">stratified.p2</code></td>
<td>
<p>was the second phase of sampling stratified on <code>W</code>?
Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="variance.missingdata_+3A_estimated.weights">estimated.weights</code></td>
<td>
<p>were the phase-three weights estimated? Default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>variance.missingdata</code> works for estimation from a case cohort with design
weights and when covariate information was missing for certain individuals in the
phase-two data (i.e., case cohort obtained from three phases of sampling and
consisting of individuals in the phase-two data without missing covariate
information).
</p>
<p>If there are no missing covariates in the phase- two sample, use <code><a href="#topic+variance">variance</a></code>
with either design weights or calibrated weights.
</p>
<p><code>variance.missingdata</code> uses the variance formulas provided in Etievant and
Gail (2024).
</p>


<h3>Value</h3>

<p><code>variance</code>: variance estimate.
</p>


<h3>References</h3>

<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+influences.missingdata">influences.missingdata</a></code>, <code><a href="#topic+influences.RH.missingdata">influences.RH.missingdata</a></code>, <code><a href="#topic+influences.CumBH.missingdata">influences.CumBH.missingdata</a></code>,
</p>
<p><code><a href="#topic+influences.PR.missingdata">influences.PR.missingdata</a></code>, <code><a href="#topic+robustvariance">robustvariance</a></code> and <code><a href="#topic+variance">variance</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  data(dataexample.missingdata.stratified, package="CaseCohortCoxSurvival")

  cohort &lt;- dataexample.missingdata.stratified$cohort
  phase2 &lt;- cohort[which(cohort$phase2 == 1),] # the phase-two sample
  casecohort &lt;- cohort[which(cohort$phase3 == 1),] # the stratified case-cohort

  B.phase2 &lt;- cbind(1 * (phase2$W3 == 0), 1 * (phase2$W3 == 1))
  rownames(B.phase2)  &lt;- cohort[cohort$phase2 == 1, "id"]
  B.phase3 &lt;- cbind(1 * (casecohort$W3 == 0), 1 * (casecohort$W3 == 1))
  rownames(B.phase3)  &lt;- cohort[cohort$phase3 == 1, "id"]
  total.B.phase2 &lt;- colSums(B.phase2)
  J3 &lt;- ncol(B.phase3)
  n &lt;- nrow(cohort)

  # Quantities needed for estimation of the cumulative baseline hazard when
  # covariate data is missing
  mod.cohort &lt;- coxph(Surv(event.time, status) ~ X2, data = cohort,
                      robust = TRUE) # X2 is available on all cohort members
  mod.cohort.detail &lt;- coxph.detail(mod.cohort, riskmat = TRUE)

  riskmat.phase2 &lt;- with(cohort, mod.cohort.detail$riskmat[phase2 == 1,])
  rownames(riskmat.phase2) &lt;- cohort[cohort$phase2 == 1, "id"]
  observed.times.phase2 &lt;- apply(riskmat.phase2, 1,
                                 function(v) {which.max(cumsum(v))})
  dNt.phase2 &lt;- matrix(0, nrow(riskmat.phase2), ncol(riskmat.phase2))
  dNt.phase2[cbind(1:nrow(riskmat.phase2), observed.times.phase2)] &lt;- 1
  dNt.phase2 &lt;- sweep(dNt.phase2, 1, phase2$status, "*")
  colnames(dNt.phase2) &lt;- colnames(riskmat.phase2)
  rownames(dNt.phase2) &lt;- rownames(riskmat.phase2)

  Tau1 &lt;- 0 # given time interval for the pure risk
  Tau2 &lt;- 8
  x &lt;- c(-1, 1, -0.6) # given covariate profile for the pure risk

  # Estimation using the stratified case cohort with true known design weights

  mod.true &lt;- coxph(Surv(event.time, status) ~ X1 + X2 + X3, data = casecohort,
                    weight = weight.true, id = id, robust = TRUE)

  est.true &lt;- influences.missingdata(mod = mod.true,
                                     riskmat.phase2 = riskmat.phase2,
                                     dNt.phase2 = dNt.phase2, Tau1 = Tau1,
                                     Tau2 = Tau2, x = x)
  infl.beta.true &lt;- est.true$infl.beta
  infl.Lambda0.true &lt;- est.true$infl.Lambda0.Tau1Tau2
  infl.Pi.x.true &lt;- est.true$infl.Pi.x.Tau1Tau2
  infl2.beta.true &lt;- est.true$infl2.beta
  infl2.Lambda0.true &lt;- est.true$infl2.Lambda0.Tau1Tau2
  infl2.Pi.x.true &lt;- est.true$infl2.Pi.x.Tau1Tau2
  infl3.beta.true &lt;- est.true$infl3.beta
  infl3.Lambda0.true &lt;- est.true$infl3.Lambda0.Tau1Tau2
  infl3.Pi.x.true &lt;- est.true$infl3.Pi.x.Tau1Tau2

  # variance estimate for the log-relative hazard estimate
  variance.missingdata(n = n, casecohort = casecohort,
                       casecohort.phase2 = phase2,
                       weights = casecohort$weight.true,
                       weights.phase2 = phase2$weight.true,
                       weights.p2.phase2 = phase2$weight.p2.true,
                       infl2 = infl2.beta.true, infl3 = infl3.beta.true,
                       stratified.p2 = TRUE)

  # variance estimate for the cumulative baseline hazard estimate
  variance.missingdata(n = n, casecohort = casecohort,
                       casecohort.phase2 = phase2,
                       weights = casecohort$weight.true,
                       weights.phase2 = phase2$weight.true,
                       weights.p2.phase2 = phase2$weight.p2.true,
                       infl2 = infl2.Lambda0.true, infl3 = infl3.Lambda0.true,
                       stratified.p2 = TRUE)

  # variance estimate for the pure risk estimate
  variance.missingdata(n = n, casecohort = casecohort,
                       casecohort.phase2 = phase2,
                       weights = casecohort$weight.true,
                       weights.phase2 = phase2$weight.true,
                       weights.p2.phase2 = phase2$weight.p2.true,
                       infl2 = infl2.Pi.x.true, infl3 = infl3.Pi.x.true,
                       stratified.p2 = TRUE)


  # Estimation using the stratified case cohort with estimated weights, and
  # accounting for the estimation through the influences

  mod.estimated &lt;- coxph(Surv(event.time, status) ~ X1 + X2 + X3,
                         data = casecohort, weight = weight.est, id = id,
                         robust = TRUE)

  est.estimated  &lt;- influences.missingdata(mod.estimated,
                                           riskmat.phase2 = riskmat.phase2,
                                           dNt.phase2 = dNt.phase2,
                                           estimated.weights = TRUE,
                                           B.phase2 = B.phase2, Tau1 = Tau1,
                                           Tau2 = Tau2, x = x)

  infl.beta.estimated &lt;- est.estimated$infl.beta
  infl.Lambda0.estimated &lt;- est.estimated$infl.Lambda0.Tau1Tau2
  infl.Pi.x.estimated &lt;- est.estimated$infl.Pi.x.Tau1Tau2
  infl2.beta.estimated &lt;- est.estimated$infl2.beta
  infl2.Lambda0.estimated &lt;- est.estimated$infl2.Lambda0.Tau1Tau2
  infl2.Pi.x.estimated &lt;- est.estimated$infl2.Pi.x.Tau1Tau2
  infl3.beta.estimated &lt;- est.estimated$infl3.beta
  infl3.Lambda0.estimated &lt;- est.estimated$infl3.Lambda0.Tau1Tau2
  infl3.Pi.x.estimated &lt;- est.estimated$infl3.Pi.x.Tau1Tau2

  # variance estimate for the log-relative hazard
  variance.missingdata(n = n, casecohort = casecohort,
                       casecohort.phase2 = phase2,
                       weights = casecohort$weight.est,
                       weights.phase2 = phase2$weight.est,
                       weights.p2.phase2 = phase2$weight.p2.true,
                       infl2 = infl2.beta.estimated,
                       infl3 = infl3.beta.estimated,
                       stratified.p2 = TRUE, estimated.weights = TRUE)

  # variance estimate for the cumulative baseline hazard estimate
  variance.missingdata(n = n, casecohort = casecohort,
                       casecohort.phase2 = phase2,
                       weights = casecohort$weight.est,
                       weights.phase2 = phase2$weight.est,
                       weights.p2.phase2 = phase2$weight.p2.true,
                       infl2 = infl2.Lambda0.estimated,
                       infl3 = infl3.Lambda0.estimated,
                       stratified.p2 = TRUE, estimated.weights = TRUE)

  # variance estimate for the pure risk estimate
  variance.missingdata(n = n, casecohort = casecohort,
                       casecohort.phase2 = phase2,
                       weights = casecohort$weight.est,
                       weights.phase2 = phase2$weight.est,
                       weights.p2.phase2 = phase2$weight.p2.true,
                       infl2 = infl2.Pi.x.estimated,
                       infl3 = infl3.Pi.x.estimated,
                       stratified.p2 = TRUE, estimated.weights = TRUE)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
