<!DOCTYPE html><html><head><title>Help for package bumbl</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {bumbl}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#autoplot.bumbldf'><p>Plot observed and fitted results from bumbl()</p></a></li>
<li><a href='#bombus'><p><em>Bombus vosnesenskii</em> colony growth and estimated floral resources</p></a></li>
<li><a href='#brkpt'><p>Fit breakpoint model to individual colony</p></a></li>
<li><a href='#bumbl'><p>Estimate colony growth, switch point, and decay parameters</p></a></li>
<li><a href='#bumbl-package'><p>bumbl: Tools for Modeling Bumblebee Colony Growth and Decline</p></a></li>
<li><a href='#plot.bumbldf'><p>Plot observed and fitted results from bumbl()</p></a></li>
<li><a href='#test_df'><p>Simulated colony growth data for internal tests</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Tools for Modeling Bumblebee Colony Growth and Decline</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.3</td>
</tr>
<tr>
<td>Description:</td>
<td>Bumblebee colonies grow during worker production, then decline after switching to production of reproductive individuals (drones and gynes).  This package provides tools for modeling and visualizing this pattern by identifying a switchpoint with a growth rate before and a decline rate after the switchpoint. The mathematical models fit by bumbl are described in Crone and Williams (2016) &lt;<a href="https://doi.org/10.1111%2Fele.12581">doi:10.1111/ele.12581</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://creativecommons.org/licenses/by/4.0">CC BY 4.0</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/Aariq/bumbl">https://github.com/Aariq/bumbl</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/Aariq/bumbl/issues">https://github.com/Aariq/bumbl/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.0)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 2.1.0), knitr, rmarkdown, covr, car, rsq</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr, rlang, tidyr (&ge; 1.0.0), purrr, broom, glue, MASS,
ggplot2, lifecycle</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-03-08 19:18:13 UTC; ericscott</td>
</tr>
<tr>
<td>Author:</td>
<td>Eric R. Scott <a href="https://orcid.org/0000-0002-7430-7879"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Eric R. Scott &lt;scottericr@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-03-08 19:40:09 UTC</td>
</tr>
</table>
<hr>
<h2 id='autoplot.bumbldf'>Plot observed and fitted results from bumbl()</h2><span id='topic+autoplot.bumbldf'></span>

<h3>Description</h3>

<p>Plots observed (points) and fitted (red line) values from the model implemented by <code>bumbl()</code>, faceted by colony.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bumbldf'
autoplot(object, ..., colony = NULL, x = deprecated())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="autoplot.bumbldf_+3A_object">object</code></td>
<td>
<p>a dataframe produced by <code><a href="#topic+bumbl">bumbl()</a></code></p>
</td></tr>
<tr><td><code id="autoplot.bumbldf_+3A_...">...</code></td>
<td>
<p>other arguments passed to <code>autoplot()</code></p>
</td></tr>
<tr><td><code id="autoplot.bumbldf_+3A_colony">colony</code></td>
<td>
<p>a character vector of colony IDs to plot</p>
</td></tr>
<tr><td><code id="autoplot.bumbldf_+3A_x">x</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a> <code>x</code> has been re-named to <code>object</code>
for consistency with other <code>autoplot()</code> functions</p>
</td></tr>
</table>


<h3>Value</h3>

<p>invisibly returns a ggplot object
</p>


<h3>Examples</h3>

<pre><code class='language-R'>bombus_subset &lt;- bombus[bombus$colony %in% c("17", "104", "20", "24"), ]
results &lt;- bumbl(bombus_subset, colonyID = colony, t = week,
                 formula = mass ~ week)
library(ggplot2)
autoplot(results)
</code></pre>

<hr>
<h2 id='bombus'><em>Bombus vosnesenskii</em> colony growth and estimated floral resources</h2><span id='topic+bombus'></span>

<h3>Description</h3>

<p>This is a subset of the data from Crone and Williams, 2016.  <em>Bombus
vosnesenskii</em> colonies were placed in sites in a mixed agricultural&ndash;natural
area in California, USA and weighed weekly.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bombus
</code></pre>


<h3>Format</h3>

<p>A data frame with 178 rows and 10 columns
</p>

<dl>
<dt>site</dt><dd><p>The site ID</p>
</dd>
<dt>colony</dt><dd><p>The colony ID</p>
</dd>
<dt>wild</dt><dd><p>The proportion of the habitat for that site classified as wild using GIS</p>
</dd>
<dt>habitat</dt><dd><p>The habitat type. Either wild (W), organic agriculture (O),
or conventional agriculture (C)</p>
</dd>
<dt>date</dt><dd><p>The calendar date the measurements were taken on</p>
</dd>
<dt>week</dt><dd><p>Number of weeks since the initial mass was taken</p>
</dd>
<dt>mass</dt><dd><p>Colony mass, in grams</p>
</dd>
<dt>d.mass</dt><dd><p>Difference in mass from the smallest mass for each colony, in grams</p>
</dd>
<dt>floral_resources</dt><dd><p>Floral density in millions of flowers within a 2km
radius around the colony, weighted as a function of distance from colony</p>
</dd>
<dt>cum_floral</dt><dd><p>Cumulative floral resources from the start of the study</p>
</dd>
</dl>



<h3>Details</h3>

<p>Floral resources (<em>e</em>) are weighted using the equation <em>w</em> =
<em>e</em>^(<em>-D/a</em>) where <em>D</em> is the distance in meters between the resources and
the colony and <em>a</em> is the typical flight distance for the species. This is
described in further detail in Williams et al. 2012.
</p>


<h3>References</h3>

<p>Crone, E. E., and Williams, N. M. (2016). Bumble bee colony dynamics:
quantifying the importance of land use and floral resources for colony growth
and queen production. Ecol. Lett. 19, 460–468. doi:10.1111/ele.12581.
</p>
<p>Williams, N. M., Regetz, J., and Kremen, C. (2012). Landscape-scale resources
promote colony growth but not reproductive performance of bumble bees.
Ecology 93, 1049–1058. doi:10.1890/11-1006.1.
</p>

<hr>
<h2 id='brkpt'>Fit breakpoint model to individual colony</h2><span id='topic+brkpt'></span>

<h3>Description</h3>

<p>Fits models using a range of taus and picks the best one using maximum
likelihood. Typically only used internally by <code><a href="#topic+bumbl">bumbl()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>brkpt(
  data,
  t,
  formula,
  family = gaussian(link = "log"),
  tau_optim_maxit = 100,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="brkpt_+3A_data">data</code></td>
<td>
<p>a dataframe or tibble</p>
</td></tr>
<tr><td><code id="brkpt_+3A_t">t</code></td>
<td>
<p>the unquoted column name for the time variable in <code>data</code></p>
</td></tr>
<tr><td><code id="brkpt_+3A_formula">formula</code></td>
<td>
<p>a formula passed to <code><a href="stats.html#topic+glm">glm()</a></code> or <code><a href="MASS.html#topic+glm.nb">MASS::glm.nb()</a></code>.  This should
include the time variable supplied to <code>t</code></p>
</td></tr>
<tr><td><code id="brkpt_+3A_family">family</code></td>
<td>
<p>a description of the error distribution and link function.
This is passed to <code><a href="stats.html#topic+glm">glm()</a></code> except in the case of <code>family = "negbin"</code>, which
causes <code><a href="MASS.html#topic+glm.nb">MASS::glm.nb()</a></code> to be used to fit a negative binomial GLM.</p>
</td></tr>
<tr><td><code id="brkpt_+3A_tau_optim_maxit">tau_optim_maxit</code></td>
<td>
<p>passed to <code>optim()</code> which is used to find the optimal
change point, tau.  Mostly used for testing purposes (to force convergence
errors), but could be increased if optimal switchpoint doesn't converge.</p>
</td></tr>
<tr><td><code id="brkpt_+3A_...">...</code></td>
<td>
<p>additional arguments passed to <code><a href="stats.html#topic+glm">glm()</a></code> or <code><a href="MASS.html#topic+glm.nb">glm.nb()</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>a tibble with a column for the winning tau and a column for the
winning model
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bumbl">bumbl()</a></code>
</p>

<hr>
<h2 id='bumbl'>Estimate colony growth, switch point, and decay parameters</h2><span id='topic+bumbl'></span>

<h3>Description</h3>

<p>Fits generalized linear models that assume bumblebee colonies will switch
from growth to gyne production at some point, <code class="reqn">\tau</code>. This allows for a
different switchpoint (<code class="reqn">\tau</code>) for each colony, chosen by maximum
likelihood methods.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bumbl(
  data,
  t,
  formula,
  family = gaussian(link = "log"),
  colonyID = NULL,
  augment = FALSE,
  keep.model = FALSE,
  tau_optim_maxit = 100,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bumbl_+3A_data">data</code></td>
<td>
<p>a dataframe or tibble with a column for colony ID (as a
<code>character</code> or <code>factor</code>), a column for some measure of time (<code>numeric</code>),
and a column for some measure of colony growth (<code>numeric</code>), at minimum.</p>
</td></tr>
<tr><td><code id="bumbl_+3A_t">t</code></td>
<td>
<p>the unquoted column name of the time variable.</p>
</td></tr>
<tr><td><code id="bumbl_+3A_formula">formula</code></td>
<td>
<p>a formula with the form <code>response ~ time + covariates</code> where
response is your measure of colony growth, time is whatever measure of time
you have (date, number of weeks, etc.) and covariates are any optional
co-variates you want to fit at the colony level.</p>
</td></tr>
<tr><td><code id="bumbl_+3A_family">family</code></td>
<td>
<p>a description of the error distribution and link function.
This is passed to <code><a href="stats.html#topic+glm">glm()</a></code> except in the case of <code>family = "negbin"</code>, which
causes <code><a href="MASS.html#topic+glm.nb">MASS::glm.nb()</a></code> to be used to fit a negative binomial GLM.</p>
</td></tr>
<tr><td><code id="bumbl_+3A_colonyid">colonyID</code></td>
<td>
<p>the unquoted column name of the colony ID variable. This is
required, so to run <code>bumbl()</code> on a single colony, you must create a dummy
column with a colony ID.</p>
</td></tr>
<tr><td><code id="bumbl_+3A_augment">augment</code></td>
<td>
<p>when FALSE, <code>bumbl</code> returns a summary dataframe with one row
for each colonyID.  When TRUE, it returns the original data with additional
columns containing model coefficients. Cannot be used in conjunction with
<code>keep.model = TRUE</code>.</p>
</td></tr>
<tr><td><code id="bumbl_+3A_keep.model">keep.model</code></td>
<td>
<p>If TRUE, then the output will contain a list-column with
the models for each colony. This may be useful for extracting statistics
and performing model diagnostics not provided by <code>bumbl()</code>. Learn more
about working with list columns with <code>vignette("nest", package = "tidyr")</code>.</p>
</td></tr>
<tr><td><code id="bumbl_+3A_tau_optim_maxit">tau_optim_maxit</code></td>
<td>
<p>passed to <code>optim()</code> which is used to find the optimal
change point, tau.  Mostly used for testing purposes (to force convergence
errors), but could be increased if optimal switchpoint doesn't converge.</p>
</td></tr>
<tr><td><code id="bumbl_+3A_...">...</code></td>
<td>
<p>additional arguments passed to <code><a href="stats.html#topic+glm">glm()</a></code> or <code><a href="MASS.html#topic+glm.nb">MASS::glm.nb()</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Colony growth is modeled as increasing exponentially until the
colony switches from producing workers to producing reproductive
individuals (drones and gynes), at which time the workers die and gynes
leave the colony, causing the colony to decline. The switch point,
<code class="reqn">\tau</code>, may vary among colonies. <code>bumbl()</code> finds the value of
<code class="reqn">\tau</code> that maximizes likelihood and this &quot;winning&quot; model is used to
calculate statistics returned in the output. This function works by fitting
generalized linear models (GLMs) to modified colony growth data. Because of
this, the assumptions for GLMs apply, namely independence and homogeneity
of variance. See <code>vignette("bumbl", package = "bumbl")</code> for more details on
the underlying math of the model.
</p>


<h3>Value</h3>

<p>A <code>data.frame</code> with the additional class <code>bumbldf</code> containing a
summary of the data with a row for every colony and the following columns:
</p>

<ul>
<li><p><code>converged</code> indicates whether the winning model converged.
</p>
</li>
<li><p><code>tau</code> is the switchpoint, in the same units as <code>t</code>, for
each <code>colonyID</code>.  The colony grows for <code class="reqn">\tau</code> weeks, then begins to
decline in week <code class="reqn">\tau + 1</code>.
</p>
</li>
<li><p><code>logN0</code> is the intercept of the
growth function.  It reflects actual initial colony size, if the colony
initially grows exponentially.  It would also be lower if there were a few
weeks lag before growth started in the field.
</p>
</li>
<li><p><code>logLam</code> is the
average (log-scale) colony growth rate (i.e., rate of weight gain per unit
<code>t</code>) during the growth period.
</p>
</li>
<li><p><code>decay</code> reflects the rate of decline during the decline period.
Equivalent to ln(<code class="reqn">\delta</code>) - ln(<code class="reqn">\lambda</code>) (see vignette for more
in-depth explanation).
</p>
</li>
<li><p><code>logNmax</code> is the maximum weight reached by each colony.  It is a
function of <code>tau</code>, <code>logN0</code> and <code>logLam</code>
</p>
</li>
<li><p>Additional columns are
coefficients for any covariates supplied in the <code>formula</code>
</p>
</li></ul>

<p>When <code>augment = TRUE</code>, the original data are returned with these columns as
well as fitted values (<code>.fitted</code>) residuals (<code>.resid</code>) and standard error
(<code>.se.fit</code>).  When <code>keep.model = TRUE</code> a list-column with the <code>glm</code> models
for each colony is returned as well.
</p>


<h3>Note</h3>

<p>This function <em>assumes</em> there is a switchpoint and does not test
whether the switchpoint model is significantly better than a log-linear
model. As a result, it may estimate a switchpoint even if the data do not
represent a true switchpoint. See the vignette for an example of how to
extract the GLMs&mdash;you could compare them to a simpler log-linear model
without the switchpoint by AIC or a likelihood ratio test to test the
significance of the switchpoint.
</p>


<h3>References</h3>

<p>Crone EE, Williams NM (2016) Bumble bee colony dynamics:
quantifying the importance of land use and floral resources for colony
growth and queen production. Ecology Letters 19:460–468.
https://doi.org/10.1111/ele.12581
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.bumbldf">plot.bumbldf()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
bumbl(bombus, colonyID = colony, t = week, formula = d.mass ~ week)

</code></pre>

<hr>
<h2 id='bumbl-package'>bumbl: Tools for Modeling Bumblebee Colony Growth and Decline</h2><span id='topic+bumbl-package'></span><span id='topic+_PACKAGE'></span>

<h3>Description</h3>

<p>Bumblebee colonies grow during worker production, then decline after switching to production of reproductive individuals (drones and gynes). This package provides tools for modeling and visualizing this pattern by identifying a switchpoint with a growth rate before and a decline rate after the switchpoint. The mathematical models fit by bumbl are described in Crone and Williams (2016) <a href="https://doi.org/10.1111/ele.12581">doi:10.1111/ele.12581</a>.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Eric R. Scott <a href="mailto:scottericr@gmail.com">scottericr@gmail.com</a> (<a href="https://orcid.org/0000-0002-7430-7879">ORCID</a>)
</p>


<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/Aariq/bumbl">https://github.com/Aariq/bumbl</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/Aariq/bumbl/issues">https://github.com/Aariq/bumbl/issues</a>
</p>
</li></ul>


<hr>
<h2 id='plot.bumbldf'>Plot observed and fitted results from bumbl()</h2><span id='topic+plot.bumbldf'></span>

<h3>Description</h3>

<p>Creates one plot per level of colonyID showing the observed (points) and fitted (red line) values from the model implemented by <code>bumbl()</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'bumbldf'
plot(x, ..., colony = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.bumbldf_+3A_x">x</code></td>
<td>
<p>a dataframe produced by <code><a href="#topic+bumbl">bumbl()</a></code>.</p>
</td></tr>
<tr><td><code id="plot.bumbldf_+3A_...">...</code></td>
<td>
<p>other arguments not used by this method.</p>
</td></tr>
<tr><td><code id="plot.bumbldf_+3A_colony">colony</code></td>
<td>
<p>optional vector of colony ID's (character) or indexes (numeric) to plot.  If not supplied, all colonies will be plotted.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>invisibly returns a list of dataframes used for building the plots.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bumbl">bumbl()</a></code>, <code><a href="#topic+autoplot.bumbldf">autoplot.bumbldf()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(687)
colonyID_subset &lt;- sample(bombus$colony, 10)
colony_subset &lt;- bombus[bombus$colony %in% colonyID_subset, ]
results &lt;- bumbl(colony_subset, colonyID = colony, t = week,
                 formula = mass ~ week)
plot(results)
</code></pre>

<hr>
<h2 id='test_df'>Simulated colony growth data for internal tests</h2><span id='topic+test_df'></span>

<h3>Description</h3>

<p>Simulated data including two colonies (6 and 7) that should always cause errors for <code>bumbl()</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>test_df
</code></pre>


<h3>Format</h3>

<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 140 rows and 4 columns.
</p>


<h3>Details</h3>

<p>Colonies 1-5 are generated with <code>sim_colony()</code> using the following parameters:</p>

<table>
<tr>
 <td style="text-align: right;">
   colony </td><td style="text-align: right;"> tau </td><td style="text-align: right;"> n0 </td><td style="text-align: right;"> lambda </td><td style="text-align: right;"> delta </td>
</tr>
<tr>
 <td style="text-align: right;">
   1 </td><td style="text-align: right;"> 11.0 </td><td style="text-align: right;"> 30 </td><td style="text-align: right;"> 1.42 </td><td style="text-align: right;"> 0.30 </td>
</tr>
<tr>
 <td style="text-align: right;">
   2 </td><td style="text-align: right;"> 11.5 </td><td style="text-align: right;"> 24 </td><td style="text-align: right;"> 1.35 </td><td style="text-align: right;"> 0.31 </td>
</tr>
<tr>
 <td style="text-align: right;">
   3 </td><td style="text-align: right;"> 9.0 </td><td style="text-align: right;"> 49 </td><td style="text-align: right;"> 1.40 </td><td style="text-align: right;"> 0.29 </td>
</tr>
<tr>
 <td style="text-align: right;">
   4 </td><td style="text-align: right;"> 12.0 </td><td style="text-align: right;"> 37 </td><td style="text-align: right;"> 1.34 </td><td style="text-align: right;"> 0.48 </td>
</tr>
<tr>
 <td style="text-align: right;">
   5 </td><td style="text-align: right;"> 10.6 </td><td style="text-align: right;"> 29 </td><td style="text-align: right;"> 1.37 </td><td style="text-align: right;"> 0.32 </td>
</tr>
<tr>
 <td style="text-align: right;">
</td>
</tr>

</table>

<p>Colonies 6 and 7 are generated manually.  Colony 6 contains negative numbers
and should result in the warning &quot;Warning, cannot find valid starting values:
please specify some for colonyID '6' Omitting from results.&quot;  Colony 7 has
all the data pushed up to week 25 and therefore should result in a
convergence error when searching for the optimal switchpoint and the warning,
&quot;Warning: search for optimal switchpoint did not converge for colonyID '6'.
Omitting from results.&quot;
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
