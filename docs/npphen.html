<!DOCTYPE html><html><head><title>Help for package npphen</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {npphen}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#npphen'><p>npphen</p></a></li>
<li><a href='#ExtremeAnom'><p>ExtremeAnom</p></a></li>
<li><a href='#ExtremeAnoMap'><p>ExtremeAnoMap</p></a></li>
<li><a href='#modis_dates'><p>A vector with dates for both RasterStack datasets: Mega drought and Blooming Desert, with 929 dates</p></a></li>
<li><a href='#Phen'><p>Phen</p></a></li>
<li><a href='#PhenKplot'><p>PhenKplot</p></a></li>
<li><a href='#PhenMap'><p>PhenMap</p></a></li>
<li><a href='#phents'><p>A dataframe with 8-days MODIS NDVI of a pixel with deciduous Nothofagus macrocarpa forest, Central Chile,</p>
using MOD13Q1/MYD13Q1 combined</a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Vegetation Phenological Cycle and Anomaly Detection using Remote
Sensing Data</td>
</tr>
<tr>
<td>Version:</td>
<td>2.0.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-10-10</td>
</tr>
<tr>
<td>Author:</td>
<td>Roberto O. Chávez [cre, aut], Sergio A. Estay [cre, aut], José A. Lastra [cre,ctb] &amp; Carlos G. Riquelme [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>José A. Lastra &lt;jose.lastra@pucv.cl&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Calculates phenological cycle and anomalies using a non-parametric
    approach applied to time series of vegetation indices derived from remote sensing data 
    or field measurements. The package implements basic and high-level functions for 
    manipulating vector data (numerical series) and raster data (satellite derived products).
    Processing of very large raster files is supported. For more information, please check 
    the following paper:
    Chávez et al. (2023) &lt;<a href="https://doi.org/10.3390%2Frs15010073">doi:10.3390/rs15010073</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.6.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>terra (&ge; 1.5-17), ks, methods, graphics, stats, lubridate</td>
</tr>
<tr>
<td>Suggests:</td>
<td>parallel, tcltk, leaflet, sf</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/labGRS/npphen">https://github.com/labGRS/npphen</a>, <a href="https://labgrs.github.io/npphen/">https://labgrs.github.io/npphen/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/labGRS/npphen/issues">https://github.com/labGRS/npphen/issues</a></td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-10-10 15:20:23 UTC; josel</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-10-12 14:30:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='npphen'>npphen</h2><span id='topic+npphen'></span><span id='topic+npphen-package'></span>

<h3>Description</h3>

<p>The functions in this package estimate the expected annual phenological cycle from time series or raster stack of vegetation (greenness) indexes. The algorithm to estimate the annual phenological cycle (used by the functions in npphen) uses a bivariate kernel density estimator in the index-time space. In this space, the x-axis corresponds to days of the growing season (1-365) and the y-axis to the vegetation index values, which range's values are set using the rge argument (see each function's vignette for details). The expected value of the index for each day of the growing season (the expected phenology) is approximated by the maximum value of the kernel at that day. Anomalies are calculated as deviations from the expected values at given days. The package implements basic and high-level functions for manipulating vector data (numerical series) and raster data (satellite derived products). Processing of very large raster files is supported. For methodological details of kernel density estimation see Wand &amp; Jones (1994).
</p>


<h3>Author(s)</h3>

<p>Roberto O. Chávez  <a href="mailto:roberto.chavez.o@pucv.cl">roberto.chavez.o@pucv.cl</a>
<br />
Sergio A. Estay  <a href="mailto:sergio.estay@uach.cl">sergio.estay@uach.cl</a>
<br />
José A. Lastra  <a href="mailto:jose.lastra@pucv.cl">jose.lastra@pucv.cl</a>
<br />
Carlos G. Riquelme  <a href="mailto:carlosriquelmemv@gmail.com">carlosriquelmemv@gmail.com</a>
</p>


<h3>References</h3>

<p>Wand, M.P. &amp; Jones, M.C. (1994) Kernel smoothing. Crc Press.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Phen">Phen</a></code>, <code><a href="#topic+PhenMap">PhenMap</a></code>, <code><a href="#topic+ExtremeAnom">ExtremeAnom</a></code>, <code><a href="#topic+ExtremeAnoMap">ExtremeAnoMap</a></code>, <code><a href="#topic+PhenKplot">PhenKplot</a></code>
</p>

<hr>
<h2 id='ExtremeAnom'>ExtremeAnom</h2><span id='topic+ExtremeAnom'></span>

<h3>Description</h3>

<p>Based on the annual reference frequency distribution (rfd) of a vegetation index time series (e.g. a numeric vector of NDVI), calculates anomalies and how extreme these anomalies are (rfd position ranging from 0 to 100)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ExtremeAnom(x, dates, h, refp, anop, rge, output = "both", rfd = 0.9)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ExtremeAnom_+3A_x">x</code></td>
<td>
<p>Numeric vector. A time series of a vegetation index (e.g. LAI, NDVI, EVI) or any other variable with seasonal behavior. The code has been optimized to work with integer values. Please re-scale the input values if necessary (e.g. NDVI ranging from 0.0000 to 1.0000, multiply by 10,000</p>
</td></tr>
<tr><td><code id="ExtremeAnom_+3A_dates">dates</code></td>
<td>
<p>A date vector. The number of dates must be equal to the number of &quot;x&quot; values (numeric input vector).</p>
</td></tr>
<tr><td><code id="ExtremeAnom_+3A_h">h</code></td>
<td>
<p>Numeric. Indicates the geographic hemisphere. This argument defines the starting date of the growing season. h = 1 for the Northern Hemisphere (season starting on January 1st), h = 2 for the Southern Hemisphere (season starting on July 1st).</p>
</td></tr>
<tr><td><code id="ExtremeAnom_+3A_refp">refp</code></td>
<td>
<p>Numeric vector with the correlative number of dates to be used as reference period. For example, refp = c(1:388) for MODIS Vegetation Index 16-days composites MOD13Q1 (18/02/2000 – 18/12/2016)</p>
</td></tr>
<tr><td><code id="ExtremeAnom_+3A_anop">anop</code></td>
<td>
<p>Numeric vector with the correlative number of dates for the period in which the anomalies and rfd position (how extreme the anomalies are) will be calculated. For example anop = c(389:411) for the complete 2017 of MODIS Vegetation Index 16-days composites MOD13Q1 (01/01/2017 – 19/12/2017). anop y refp can be overlapped.</p>
</td></tr>
<tr><td><code id="ExtremeAnom_+3A_rge">rge</code></td>
<td>
<p>Numeric vector with two values setting the minimum and maximum values of the response variable (e.g. NDVI) used in the analysis. We suggest the use of theoretically based limits. For example in the case of MODIS NDVI or EVI, it ranges from 0 to 10,000, so rge = c(0,10000)</p>
</td></tr>
<tr><td><code id="ExtremeAnom_+3A_output">output</code></td>
<td>
<p>Character string. Defines the output values. 'both' (default) returns both anomalies and rfd position together as a single numeric vector, 'anomalies' returns only anomalies, 'rfd' returns only rfd values (how extreme the anomalies are) and 'clean' returns only extreme anomalies, i.e. anomalies at which a given rfd is overpass (e.g. 0.90). This critical threshold is set by the users using the rfd argument.</p>
</td></tr>
<tr><td><code id="ExtremeAnom_+3A_rfd">rfd</code></td>
<td>
<p>Numeric. This argument only applies when the argument output = 'clean'. It defines the percentile (from 0 to 0.99) of the reference frequency distribution, for which anomalies are not flagged as extreme anomalies. For example, if 'rfd = 0.90' only anomalies falling outside the '0.90 rfd' (default value) will be flagged as extreme anomalies while the rest will be neglected (NA values). Please notice that 'rfd = 0.90' implies that the 5% of the most extreme positive and 5% of the most extreme negative anomalies will be considered.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Calculates anomalies and a probabilistic measure of how extreme the anomalies are using a numeric vector of vegetation canopy greenness, e.g. satellite based Normalized Difference Vegetation Index (NDVI) or Enhanced Vegetation Index (EVI). For this purpose, it divides the time series (numeric vector) of vegetation greenness into 2: the reference period, from which the annual phenological reference is calculated (same as <code><a href="#topic+Phen">Phen</a></code> function), and the observation period, for which we want to calculate anomalies. This anomalies can be filtered by the position of the observation within the historical rfd. Users can, for example, set 'rfd = 0.95' to consider only anomalies that outside the 95% rfd of historical records.
</p>


<h3>Value</h3>

<p>numerical vector
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ExtremeAnoMap">ExtremeAnoMap</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


library(lubridate)
library(terra)
## Testing raster data from Central Chile (NDVI), h=2##
# Load data
f &lt;- system.file("extdata/MegaDrought_spatRast.rda", package = "npphen")
MegaDrought &lt;- readRDS(f)
# Dates
data("modis_dates")

# Generate a Raster time series using a raster stack and a date database from Central Chile
# Obtain data from a particular pixel generating a time series
md_pixel &lt;- cellFromXY(MegaDrought, cbind(313395, 6356610))
md_pixelts &lt;- as.numeric(MegaDrought[md_pixel])
plot(modis_dates, md_pixelts, type = "l")

# Anomaly detection for the given pixel
anomRFD_MD &lt;- ExtremeAnom(
  x = md_pixelts, dates = modis_dates,
  h = 2, refp = c(1:423), anop = c(884:929), rfd = 0.9, output = "both", rge = c(0, 10000)
)

# Basic plot

selection &lt;- which(anomRFD_MD[47:92] &gt; 90)

barplot(
  names = format.Date(modis_dates[884:929], format = "%Y-%m"),
  anomRFD_MD[1:46], col = ifelse(anomRFD_MD[1:46] &lt; 0, "red", "blue"),
  main = "Anomalies whit rfd &gt; 0.90"
)
abline(h = 0)

## Testing with the Bdesert_stack from the Atacama Desert, Northern Chile (NDVI),
# showing extreme positive anomalies (greening)##

# Load data
# SparRaster
f &lt;- system.file("extdata/Bdesert_spatRast.rda", package = "npphen")
Bdesert &lt;- readRDS(f)

# Generate a Raster time series using a raster stack and a date database from Northern Chile
# Obtain data from a particular pixel generating a time series
bd_pixel &lt;- cellFromXY(Bdesert, cbind(286638, 6852107))
bd_pixelts &lt;- as.numeric(Bdesert[bd_pixel])
plot(modis_dates, bd_pixelts, type = "l")

# Anomaly detection for the given pixel
anomRFD_BD &lt;- ExtremeAnom(
  x = bd_pixelts, dates = modis_dates,
  h = 2, refp = c(1:423), anop = c(723:768), rfd = 0.9, output = "both", rge = c(0, 10000)
)

# Basic plot

selection &lt;- which(anomRFD_BD[47:92] &gt; 95)

# basic plot
barplot(
  names = format.Date(modis_dates[723:768], format = "%Y-%m"),
  anomRFD_BD[1:46], col = ifelse(anomRFD_BD[1:46] &lt; 0, "red", "blue"),
  main = "Anomalies whit rfd &gt; 0.95"
)
abline(h = 0)

</code></pre>

<hr>
<h2 id='ExtremeAnoMap'>ExtremeAnoMap</h2><span id='topic+ExtremeAnoMap'></span>

<h3>Description</h3>

<p>Based on the annual reference frequency distribution (RFD) of a vegetation index time series (e.g. a raster stack of NDVI), calculates anomalies and how extreme these anomalies are (RFD position ranging from 0 to 100).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ExtremeAnoMap(s, dates, h, refp, anop, rge, output = "both", rfd = 0.9,
  nCluster, outname, datatype)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ExtremeAnoMap_+3A_s">s</code></td>
<td>
<p>SpatRaster. A time series of a vegetation index (e.g. LAI, NDVI, EVI) or any other variable with seasonal behavior.The code has been optimized to work with integer values. Please re-scale the input SpatRaster if necessary (e.g. NDVI ranging from 0.0000 to 1.0000, multiply by 10,000).</p>
</td></tr>
<tr><td><code id="ExtremeAnoMap_+3A_dates">dates</code></td>
<td>
<p>A date vector. The number of dates must be equal to the number of layers of the vegetation index SpatRaster.</p>
</td></tr>
<tr><td><code id="ExtremeAnoMap_+3A_h">h</code></td>
<td>
<p>Numeric. Indicates the geographic hemisphere to define the starting date of the growing season. h = 1 if the vegetation is in the Northern Hemisphere (season starting on January 1st), h = 2 if it is in the Southern Hemisphere (season starting on July 1st).</p>
</td></tr>
<tr><td><code id="ExtremeAnoMap_+3A_refp">refp</code></td>
<td>
<p>Numeric vector with the correlative number of dates to be used as reference period. For example, refp = c(1:393) for MODIS Vegetation Index 16-days composites (18/02/2000 – 06/06/2017)</p>
</td></tr>
<tr><td><code id="ExtremeAnoMap_+3A_anop">anop</code></td>
<td>
<p>Numeric vector with the correlative number of dates for the period in which the anomalies will be calculated. For example refp = c(21:43) for the first complete year for MODIS Vegetation Index 16-days composites (01/01/2001 – 19/12/2001). anop y refp can overlap</p>
</td></tr>
<tr><td><code id="ExtremeAnoMap_+3A_rge">rge</code></td>
<td>
<p>Numeric vector with the minimum and maximum values of the vegetation index used in the analysis. We suggest the use of theoretically based limits. For example in the case of MODIS NDVI or EVI, it ranges from 0 to 10,000, so rge = c(0,10000).</p>
</td></tr>
<tr><td><code id="ExtremeAnoMap_+3A_output">output</code></td>
<td>
<p>Character string. Defines the outputs. output = 'both' (default) returns both the vegetation index anomalies and rfd position together as a single numeric vector, output = 'anomalies' returns only anomalies, output = 'rfd' returns only rfd values (how extreme the anomalies are) and output = 'clean' returns only anomalies at which a given rfd is overpass (e.g. 0.90). This critical threshold is set by the users using the rfd argument.</p>
</td></tr>
<tr><td><code id="ExtremeAnoMap_+3A_rfd">rfd</code></td>
<td>
<p>Numeric. This argument only applies when the argument output = 'clean'. It defines the percentile (from 0 to 0.99) of the reference frequency distribution, for which anomalies are not flagged as extreme anomalies. For example, if 'rfd = 0.90' only anomalies falling outside the '0.90 rfd' (default value) will be flagged as extreme anomalies while the rest will be neglected (NA values). Please notice that'rfd = 0.90' implies that the 5% of the most extreme positive and 5% of the most extreme negative anomalies will be considered.</p>
</td></tr>
<tr><td><code id="ExtremeAnoMap_+3A_ncluster">nCluster</code></td>
<td>
<p>Numeric. Number of CPU cores to be used for computational calculations</p>
</td></tr>
<tr><td><code id="ExtremeAnoMap_+3A_outname">outname</code></td>
<td>
<p>Character vector with the output directory path and filename with extension or only the filename and extension if the working directory was set. For example outname = &quot;output_anom.tif&quot;. See <code><a href="terra.html#topic+writeRaster">writeRaster</a></code></p>
</td></tr>
<tr><td><code id="ExtremeAnoMap_+3A_datatype">datatype</code></td>
<td>
<p>Character. Output data type. For example datatype = &quot;INT2S&quot; for signed integer values. See <code><a href="terra.html#topic+writeRaster">writeRaster</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Similar to <code><a href="#topic+ExtremeAnom">ExtremeAnom</a></code>, it calculates phenological anomalies but using a raster stack instead of a numeric vector of vegetation canopy greenness values (e.g. Leaf Area Index, LAI) or satellite based greenness proxies such as the Normalized Difference Vegetation Index (NDVI) or Enhanced Vegetation Index (EVI). For this purpose, it divides the time series (raster stack) of vegetation greenness into 2: the reference period, from which the annual phenological cycle is calculated (same as <code><a href="#topic+PhenMap">PhenMap</a></code> function), and the observation period, for which we want to calculate anomalies with respect to the annual phenological cycle. Negative anomalies correspond to observed values lower than the reference and positive anomalies to values higher than the reference. his anomalies can be filtered by the position of the observation within the historical rfd. Users can, for example, set 'rfd = 0.95' to consider only anomalies that outside the 95% rfd of historical records.
</p>


<h3>Value</h3>

<p>SpatRaster
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ExtremeAnom">ExtremeAnom</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
## DEPENDING ON HARDWARE, THIS PROCESS CAN BE HIGHLY TIME CONSUMING##

## Testing with the MegaDrought_stack from Central Chile (NDVI),
# showing extreme negative anomalies (browning)##

# Load data

# SpatRaster
library(terra)
f &lt;- system.file("extdata/MegaDrought_spatRast.rda", package = "npphen")
MegaDrought &lt;- readRDS(f)
# Dates
data("modis_dates")

# Define the number of cores to be use. In this example we use 1
nc1 &lt;- 1
ExtremeAnoMap(
  s = MegaDrought, dates = modis_dates, h = 2, refp = c(1:423),
  anop = c(884:929), rfd = 0.9, output = "both", nCluster = nc1, outname = "anomRFD_MD.tif",
  datatype = "INT2S", rge = c(0, 10000)
)
# map_an1 &lt;- rast("anomRFD_MD.tif")#run only for load anomaly brick
# plot(map_an1)

## Testing with the Bdesert_stack from the Atacama Desert, Northern Chile (NDVI),
# showing extreme positive anomalies (greening)##

# Load data
SpatRaster
f &lt;- system.file("extdata/Bdesert_spatRast.rda", package = "npphen")
Bdesert &lt;- readRDS(f)
# Dates
data("modis_dates")

# Define the number of cores to be use. In this example we use 1
nc1 &lt;- 1

ExtremeAnoMap(
  s = Bdesert, dates = modis_dates, h = 2, refp = c(1:423),
  anop = c(723:768), rfd = 0.9, output = "both", nCluster = nc1, outname = "anomRFD_BD.tif",
  datatype = "INT2S", rge = c(0, 10000)
)
# map_an1 &lt;- rast("anomRFD_BD.tif")#run only for load anomaly brick
# plot(map_an1)

## End(Not run)
</code></pre>

<hr>
<h2 id='modis_dates'>A vector with dates for both RasterStack datasets: Mega drought and Blooming Desert, with 929 dates</h2><span id='topic+modis_dates'></span>

<h3>Description</h3>

<p>A vector with dates for both RasterStack datasets: Mega drought and Blooming Desert, with 929 dates
</p>


<h3>Usage</h3>

<pre><code class='language-R'>modis_dates
</code></pre>


<h3>Format</h3>

<p>Vector of dates
</p>


<h3>Source</h3>

<p><a href="https://lpdaac.usgs.gov/">https://lpdaac.usgs.gov/</a>
</p>

<hr>
<h2 id='Phen'>Phen</h2><span id='topic+Phen'></span>

<h3>Description</h3>

<p>Estimates the annual phenological cycle from a time series of vegetation greenness.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Phen(x, dates, h, frequency = "16-days", rge, plot = T)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Phen_+3A_x">x</code></td>
<td>
<p>Numeric vector. A time series of a vegetation index (e.g. LAI, NDVI, EVI) or any other variable with seasonal behavior. The code has been optimized to work with integer values. Please re-scale the input values if necessary (e.g. NDVI ranging from 0.0000 to 1.0000, multiply by 10,000</p>
</td></tr>
<tr><td><code id="Phen_+3A_dates">dates</code></td>
<td>
<p>A date vector. The number of dates must be equal to the number of &quot;x&quot; values (numeric input vector).</p>
</td></tr>
<tr><td><code id="Phen_+3A_h">h</code></td>
<td>
<p>Numeric. Indicates the geographic hemisphere to define the starting date of the growing season. h = 1 if the vegetation is in the Northern Hemisphere (season starting at January 1st), h = 2 if it is in the Southern Hemisphere (season starting at July 1st)</p>
</td></tr>
<tr><td><code id="Phen_+3A_frequency">frequency</code></td>
<td>
<p>Character string. Defines the number of samples for the output phenology and must be one of the following options: 'daily' giving output vector of length 365, '8-days' giving output vector of length 46 (i.e MOD13Q1 and MYD13Q1), 'monthly' giving output vector of length 12,'bi-weekly' giving output vector of length 24 (i.e. GIMMS) or '16-days' (default) giving output vector of length 23 (i.e MOD13Q1 or MYD13Q1).</p>
</td></tr>
<tr><td><code id="Phen_+3A_rge">rge</code></td>
<td>
<p>Numeric vector with two values setting the minimum and maximum values of the response variable (e.g. NDVI) used in the analysis. We suggest the use of theoretically based limits. For example in the case of MODIS NDVI or EVI, it ranges from 0 to 10,000, so rge = c(0,10000)</p>
</td></tr>
<tr><td><code id="Phen_+3A_plot">plot</code></td>
<td>
<p>Logical. Set TRUE (default) or FALSE to show the phenology curve plot.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Derives the annual phenological cycle for a standard growing season using a numeric vector of vegetation canopy greenness values (e.g. Leaf Area Index, LAI) or satellite based greenness proxies such as the Normalized Difference Vegetation Index (NDVI) or Enhanced Vegetation Index (EVI). A vector with dates for the greenness values is also required.
</p>


<h3>Value</h3>

<p>A numeric vector, where each value represents the expected greeness at that date
</p>


<h3>See Also</h3>

<p><code><a href="#topic+PhenMap">PhenMap</a></code>,<code><a href="#topic+PhenKplot">PhenKplot</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

library(lubridate)
library(terra)
## Testing raster data from Central Chile (NDVI), h=2##
# Load data
f &lt;- system.file("extdata/MegaDrought_spatRast.rda", package = "npphen")
MegaDrought &lt;- readRDS(f)
# Dates
data("modis_dates")

# Generate a Raster time series using a raster stack and a date database from Central Chile
# Obtain data from a particular pixel generating a time series
md_pixel &lt;- cellFromXY(MegaDrought, cbind(313395, 6356610))
md_pixelts &lt;- as.numeric(MegaDrought[md_pixel])
plot(modis_dates, md_pixelts, type = "l")

# Phenology for the given pixel
Phen(x = md_pixelts, dates = modis_dates, h = 2, frequency = "16-days", rge = c(0, 10000))

## Testing with the Bdesert_stack from the Atacama Desert, Northern Chile (NDVI), h=2 ##

# Load data
# SparRaster
f &lt;- system.file("extdata/Bdesert_spatRast.rda", package = "npphen")
Bdesert &lt;- readRDS(f)

# Generate a Raster time series using a raster stack and a date database from Northern Chile
# Obtain data from a particular pixel generating a time series
bd_pixel &lt;- cellFromXY(Bdesert, cbind(286638, 6852107))
bd_pixelts &lt;- as.numeric(Bdesert[bd_pixel])
plot(modis_dates, bd_pixelts, type = "l")

# Phenology for the given pixel
Phen(x = bd_pixelts, dates = modis_dates, h = 2, frequency = "16-days", rge = c(0, 10000))

</code></pre>

<hr>
<h2 id='PhenKplot'>PhenKplot</h2><span id='topic+PhenKplot'></span>

<h3>Description</h3>

<p>Plot the most probable vegetation greenness values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PhenKplot(x, dates, h, xlab, ylab, rge)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="PhenKplot_+3A_x">x</code></td>
<td>
<p>Numeric vector. A time series of a vegetation index (e.g. LAI, NDVI, EVI) or any other variable with seasonal behavior. The code has been optimized to work with integer values. Please re-scale the input values if necessary (e.g. NDVI ranging from 0.0000 to 1.0000, multiply by 10,000)</p>
</td></tr>
<tr><td><code id="PhenKplot_+3A_dates">dates</code></td>
<td>
<p>A date vector. The number of dates must be equal to the number of &quot;x&quot; values (numeric input vector).</p>
</td></tr>
<tr><td><code id="PhenKplot_+3A_h">h</code></td>
<td>
<p>Numeric. Indicates the geographic hemisphere to define the starting date of the growing season. h = 1 if the vegetation is in the Northern Hemisphere (season starting on January 1st), h = 2 if it is in the Southern Hemisphere (season starting on July 1st)</p>
</td></tr>
<tr><td><code id="PhenKplot_+3A_xlab">xlab</code></td>
<td>
<p>Character vector (or expression) giving plot title in x axis label (e.g. xlab = &quot;day of the growing season&quot;)</p>
</td></tr>
<tr><td><code id="PhenKplot_+3A_ylab">ylab</code></td>
<td>
<p>Character vector (or expression) giving plot title in y axis label (e.g. ylab = &quot;NDVI&quot;)</p>
</td></tr>
<tr><td><code id="PhenKplot_+3A_rge">rge</code></td>
<td>
<p>Numeric vector with the minimum and maximum values of the vegetation index (e.g. NDVI) used in the analysis. We suggest the use of theoretically based limits. For example in the case of MODIS NDVI or EVI, it ranges from 0 to 10,000, so rge = c(0,10000)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It is a &quot;heatmap&quot; of the annual phenological variability of the <code><a href="#topic+Phen">Phen</a></code> output. It calculates and plot a likelihood map of the vegetation-index–time space using a numeric vector of greenness proxies such as the Normalized Difference Vegetation Index (NDVI) or Enhanced Vegetation Index (EVI). Also a vector with dates for the vegetation index values is required. This function is partially based on the ci2d function on package <a href="https://CRAN.R-project.org/package=gplots">gplots</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Phen">Phen</a></code>, <code><a href="#topic+PhenMap">PhenMap</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

library(lubridate)
library(terra)
## Testing raster data from Central Chile (NDVI), h=2##
# Load data
f &lt;- system.file("extdata/MegaDrought_spatRast.rda", package = "npphen")
MegaDrought &lt;- readRDS(f)
# Dates
data("modis_dates")

# Generate a Raster time series from a particular pixel 
# using a SpatRaster and a date for Central Chile
md_pixel &lt;- cellFromXY(MegaDrought, cbind(313395, 6356610))
md_pixelts &lt;- as.numeric(MegaDrought[md_pixel])
plot(modis_dates, md_pixelts, type = "l")

# Variability of the annual phenology for the given pixel
PhenKplot(x = md_pixelts, dates = modis_dates,
h = 2, xlab = "DGS", ylab = "NDVI", rge = c(0, 10000))


## Testing with the Bdesert_spatRast from 
## the Atacama Desert, Northern Chile (NDVI), h=2 ##

# Load data
# SparRaster
f &lt;- system.file("extdata/Bdesert_spatRast.rda", package = "npphen")
Bdesert &lt;- readRDS(f)

# Generate a Raster time series from a particular pixel 
# using a SpatRaster and a date for Northern Chile
bd_pixel &lt;- cellFromXY(Bdesert, cbind(286638, 6852107))
bd_pixelts &lt;- as.numeric(Bdesert[bd_pixel])
plot(modis_dates, bd_pixelts, type = "l")

# Variability of the annual phenology for the given pixel
PhenKplot(x = bd_pixelts, dates = modis_dates, 
h = 2, xlab = "DGS", ylab = "NDVI", rge = c(0, 10000))

</code></pre>

<hr>
<h2 id='PhenMap'>PhenMap</h2><span id='topic+PhenMap'></span>

<h3>Description</h3>

<p>Estimates annual Land Surface Phenology (LSP) using time series of a vegetation greenness raster stack.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PhenMap(s, dates, h, frequency = "16-days", nCluster, outname, datatype, rge)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="PhenMap_+3A_s">s</code></td>
<td>
<p>SpatRaster of a vegetation index (e.g. LAI, NDVI, EVI) or any other variable with seasonal behavior. The code has been optimized to work with integer values. Please re-scale the input SpatRaster if necessary (e.g. NDVI ranging from 0.0000 to 1.0000, multiply by 10,000)</p>
</td></tr>
<tr><td><code id="PhenMap_+3A_dates">dates</code></td>
<td>
<p>A date vector. The number of dates must be equal to the number of layers of the vegetation index SpatRaster.</p>
</td></tr>
<tr><td><code id="PhenMap_+3A_h">h</code></td>
<td>
<p>Numeric. Indicates the geographic hemisphere to define the starting date of the growing season. h = 1 if the vegetation is in the Northern Hemisphere (season starting on January 1st), h = 2 if it is in the Southern Hemisphere (season starting on July 1st)</p>
</td></tr>
<tr><td><code id="PhenMap_+3A_frequency">frequency</code></td>
<td>
<p>Character string. Defines the number of samples for the output phenology and must be one of the following options: 'daily' with an output vector of length 365, '8-days' with an output vector of length 46 (e.g. MOD13Q1 and MYD13Q1 combined), 'monthly' with an output vector of length 12,'bi-weekly' with an output vector of length 24 (i.e. GIMMS) or '16-days' (default) with an output vector of length 23 (i.e MOD13Q1 or MYD13Q1)</p>
</td></tr>
<tr><td><code id="PhenMap_+3A_ncluster">nCluster</code></td>
<td>
<p>Numeric. Number of CPU cores to be used for computational calculations</p>
</td></tr>
<tr><td><code id="PhenMap_+3A_outname">outname</code></td>
<td>
<p>Character vector with the output directory path and filename with extension or only the filename and extension if working directory was set. For example outname = &quot;output_phen.tif&quot;. See <code><a href="terra.html#topic+writeRaster">writeRaster</a></code></p>
</td></tr>
<tr><td><code id="PhenMap_+3A_datatype">datatype</code></td>
<td>
<p>Character. Output data type. For example datatype = &quot;INT2S&quot; for signed integer values. See <code><a href="terra.html#topic+writeRaster">writeRaster</a></code></p>
</td></tr>
<tr><td><code id="PhenMap_+3A_rge">rge</code></td>
<td>
<p>A vector containing minimum and maximum values of the vegetation index used in the analysis. We suggest the use of theoretically based limits. For example in the case of MODIS NDVI or EVI, it ranges from 0 to 10,000, so rge = c(0,10000)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Per pixel, it derives the most recurrent annual Land Surface Phenology (LSP) for a reference period  using time series of satellite based greenness values such as the Normalized Difference Vegetation Index (NDVI) or Enhanced Vegetation Index (EVI). The annual LSP is calculated for all pixels of the input SpatRaster in the same way as for the <code><a href="#topic+Phen">Phen</a></code> function. The output is a multiband raster where every band is the expected greenness value at a given time step of the growing season. For example, for MODIS Vegetation Index 16-days composites the number of time steps of the growing season is 23 (frequency = &quot;16-days&quot;), and therefore, the output raster will have 23 bands. A vector with dates for the greenness values is also required
</p>


<h3>Value</h3>

<p>SpatRaster
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Phen">Phen</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
## DEPENDING ON HARDWARE, THIS PROCESS CAN BE HIGHLY TIME CONSUMING##

## Testing with an NDVI spatRast from Central Chile, h = 2##

# Load data
# SpatRaster
library(terra)
f &lt;- system.file("extdata/MegaDrought_spatRast.rda", package = "npphen")
MegaDrought &lt;- readRDS(f)
# Dates
data("modis_dates")

# Making the LSP output raster, n bands = 23

# Define the number of cores to be use. In this example we use 1
nc1 &lt;- 1

PhenMap(
  s = MegaDrought, dates = modis_dates, h = 2,
  frequency = "16-days", nCluster = nc1, outname = "phen_MD.tif",
  datatype = "INT2S", rge = c(0, 10000)
)
# map1 &lt;- rast("phen_MD.tif")#run only for load phenology brick
# plot(map1)

## Testing with an NDVI spatRast from the Atacama Desert, Northern Chile, h=2 ##

# Load data
SpatRaster
f &lt;- system.file("extdata/Bdesert_spatRast.rda", package = "npphen")
Bdesert &lt;- readRDS(f)
# Dates
data("modis_dates")

# Making the LSP output raster, n bands = 23
# Define the number of cores to be use. In this example we use 1
nc1 &lt;- 1

PhenMap(
  s = Bdesert, dates = modis_dates, h = 2,
  frequency = "16-days", nCluster = 1, outname = "phen_BD.tif",
  datatype = "INT2S", rge = c(0, 10000)
)
# map2 &lt;- rast("phen_BD.tif") #run only for loading the multiband LSP spatRaster
# plot(map2)

## End(Not run)
</code></pre>

<hr>
<h2 id='phents'>A dataframe with 8-days MODIS NDVI of a pixel with deciduous Nothofagus macrocarpa forest, Central Chile,
using MOD13Q1/MYD13Q1 combined</h2><span id='topic+phents'></span>

<h3>Description</h3>

<p>A dataframe with 8-days MODIS NDVI of a pixel with deciduous Nothofagus macrocarpa forest, Central Chile,
using MOD13Q1/MYD13Q1 combined
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phents
</code></pre>


<h3>Format</h3>

<p>A data frame with 929 rows and 2 variables:
</p>

<dl>
<dt>dates</dt><dd><p>dates for each record</p>
</dd>
<dt>NDVI</dt><dd><p>NDVI value for a pixel of deciduous N. macrocarpa forest</p>
</dd>
</dl>



<h3>Source</h3>

<p><a href="https://lpdaac.usgs.gov/">https://lpdaac.usgs.gov/</a>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
