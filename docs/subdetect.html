<!DOCTYPE html><html><head><title>Help for package subdetect</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {subdetect}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#sample_size'><p>Calculate Required Sample Size for the Test on Subgroup Existence.</p></a></li>
<li><a href='#subdetect-package'><p>Detect Subgroup with an Enhanced Treatment Effect.</p></a></li>
<li><a href='#subgroup_detect'><p>Test for and Identify a Subgroup with an Enhanced Treatment Effect.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Detect Subgroup with an Enhanced Treatment Effect</td>
</tr>
<tr>
<td>Version:</td>
<td>1.2</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-06-05</td>
</tr>
<tr>
<td>Author:</td>
<td>Ailin Fan and Shannon T. Holloway</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Shannon T. Holloway &lt;shannon.t.holloway@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>A test for the existence of a subgroup with enhanced treatment 
    effect. And, a sample size calculation procedure for the subgroup 
    detection test.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>methods, stats</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-06-05 19:19:14 UTC; 19194</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-06-06 23:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='sample_size'>Calculate Required Sample Size for the Test on Subgroup Existence.</h2><span id='topic+sample_size'></span>

<h3>Description</h3>

<p>Estimation of the required sample size for the 
test on subgroup existence. With a pre-specified 
significance level of the test <code class="reqn">\alpha</code> and a 
desired power <code class="reqn">1-\beta</code> at a treatment effect 
<code class="reqn">\tau</code>, and other information about data, the 
required sample size that achieves power <code class="reqn">1-\beta</code> 
can be estimated.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sample_size(outcome, theta0, sigma2, tau, N = 1000L, prob = 0.5, 
            alpha = 0.05, power = 0.9, K = 1000L, M = 1000L, seed = NULL,
            precision = 0.01, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sample_size_+3A_outcome">outcome</code></td>
<td>
<p>A formula object.
The model of the indicator function. 
The model must include an intercept.                     
Any lhs variable will be ignored.</p>
</td></tr>
<tr><td><code id="sample_size_+3A_theta0">theta0</code></td>
<td>
<p>A named numeric vector.
The true parameters of the indicator model.</p>
</td></tr>
<tr><td><code id="sample_size_+3A_sigma2">sigma2</code></td>
<td>
<p>A numeric object.
The variance of the random error.</p>
</td></tr>
<tr><td><code id="sample_size_+3A_tau">tau</code></td>
<td>
<p>A numeric object.
The desired treatment effect.</p>
</td></tr>
<tr><td><code id="sample_size_+3A_n">N</code></td>
<td>
<p>An integer object. 
The number of random samples to draw.
Default value is 1000.</p>
</td></tr>
<tr><td><code id="sample_size_+3A_prob">prob</code></td>
<td>
<p>A numeric object.
The probability of assigning individuals treatment 1.
<code>0&lt;=prob&lt;=1</code>.</p>
</td></tr>
<tr><td><code id="sample_size_+3A_alpha">alpha</code></td>
<td>
<p>A numeric object.
The significance level of the test, <code>0&lt;alpha&lt;1</code>.</p>
</td></tr>
<tr><td><code id="sample_size_+3A_power">power</code></td>
<td>
<p>A numeric object.
The desired power of the test, <code>0&lt;power&lt;1</code></p>
</td></tr>
<tr><td><code id="sample_size_+3A_k">K</code></td>
<td>
<p>An integer object. 
The number of random sampled points on the unit ball 
surface <code class="reqn">\{\theta:||\theta||^2=1\}</code>. 
These randomly sampled points are used for approximating 
the Gaussian process in the null and local alternative       
distributions of the test statistic with multivariate    
normal distributions.                                    
It is recommended that K be set to 10^p, where p is the  
number of parameters in theta0.                          
Note that it is recommended that the number of covariates
be less than 10 for this implementation.                 
Default value is 1000.</p>
</td></tr>
<tr><td><code id="sample_size_+3A_m">M</code></td>
<td>
<p>An integer object. 
The number of resamplings of the perturbed test statistic.
This sample is used to calculate the critical value of the
test.
Default and minimum values are 1000.</p>
</td></tr>
<tr><td><code id="sample_size_+3A_seed">seed</code></td>
<td>
<p>An integer object or NULL. 
If set, the seed for generating random values set at
the onset of the calculation.
If NULL, current seed in R environment is used.</p>
</td></tr>
<tr><td><code id="sample_size_+3A_precision">precision</code></td>
<td>
<p>A numeric object.
The precision tolerance for estimating the power from the
calculated sample size.
Specifically, the power of the sample size returned, P,
will be (power - precision) &lt; P &lt; (power + precision).</p>
</td></tr>
<tr><td><code id="sample_size_+3A_...">...</code></td>
<td>
<p>For each covariate in outcome, user must provide a list
object indicating the distribution function to be sampled
and any parameters to be set when calling that function.
Each list contains &quot;FUN&quot;, the function name of the
random generator of the distribution, and any formal
arguments of that function. For example:
x1 = list(&quot;FUN&quot; = rnorm, sd = 2.0, mean = 10.0)          
x2 = list(&quot;FUN&quot; = rbinom, size = 1, prob = 0.5)          
The number of points generated is determined by input N. 
Most distributions available through R's stats package   
can be used. Exceptions are: rhyper, rsignrank, rwilcox. 
Specifically, any random generator that passes the
the number of observations to generate through formal
argument 'n' can be used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The sample size calculation is based on the asymptotic null 
and local alternative distributions of the test statistic. 
More details can be  found in the reference paper.
</p>
<p>The difference between true baseline mean 
function and posited mean function, <code class="reqn">\mu(X)-h(X,\beta_0)</code>, 
is set to zero when calculating the sample size.
</p>
<p>Because the calculated sample size is based on simulated 
data following the null and local alternative distributions 
of the test statistic, the results can be different with 
different choices of <code>M</code> and <code>K</code>, as well as 
different seeds. When the signal <code>tau</code> to noise 
<code>sigma2</code> ratio is large, the calculated sample size 
can be more robust.
</p>


<h3>Value</h3>

<p>A list consisting of
</p>
<table>
<tr><td><code>n</code></td>
<td>
<p>An integer object.
The estimated sample size.</p>
</td></tr>
<tr><td><code>power</code></td>
<td>
<p>A numeric object.
The estimated power.</p>
</td></tr>
<tr><td><code>seed</code></td>
<td>
<p>If seed was provided as input, the user specified 
integer seed. If seed was not provided, not present. </p>
</td></tr>
</table>


<h3>References</h3>

<p>Ailin Fan, Rui Song, and Wenbin Lu, (2016).
Change-plane analysis for subgroup detection and sample size calculation, 
Journal of the American Statistical Association, in press.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>model &lt;- ~ x1
theta0 &lt;- c("(Intercept)" = 0.0, "x1" = 1.0)
sample_size(outcome = ~ x1,
            theta0 = theta0,
            N = 1000,
            sigma2 = 0.25,
            tau = 0.25,
            K = 100, 
            M = 1000,
            x1 = list(FUN=runif, min = -1, max = 1))
</code></pre>

<hr>
<h2 id='subdetect-package'>Detect Subgroup with an Enhanced Treatment Effect.</h2><span id='topic+subdetect'></span><span id='topic+subdetect-package'></span>

<h3>Description</h3>

<p>A test for the existence of a subgroup with enhanced treatment effect and estimation of the subgroup if it exists. In addition, a sample size calculation procedure for this subgroup detection test.
</p>


<h3>Details</h3>


<ul>
<li><p><code><a href="#topic+subgroup_detect">subgroup_detect</a></code>: test for the existence of a subgroup and estimation of the subgroup.
</p>
</li>
<li><p><code><a href="#topic+sample_size">sample_size</a></code>:estimate of the required sample size for subgroup detection test.
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Ailin Fan and Shannon T. Holloway,
</p>
<p>Maintainer: Shannon T. Holloway <a href="mailto:shannon.t.holloway@gmail.com">shannon.t.holloway@gmail.com</a>
</p>


<h3>References</h3>

<p>Ailin Fan, Rui Song, and Wenbin Lu, (2016).
Change-plane analysis for subgroup detection and sample size calculation, 
Journal of the American Statistical Association, in press.
</p>

<hr>
<h2 id='subgroup_detect'>Test for and Identify a Subgroup with an Enhanced Treatment Effect.</h2><span id='topic+subgroup_detect'></span>

<h3>Description</h3>

<p>Tests for the existence of a subgroup with an enhanced 
treatment effect. The subgroup of interest is represented 
by <code class="reqn">\{\theta:\theta^T X\ge 0\}</code>. The test returns a 
p-value for <code class="reqn">H_0:\tau=0</code>, where <code class="reqn">\tau</code> is the 
treatment effect in this subgroup. If <code class="reqn">H_0</code> is 
rejected, estimates for <code class="reqn">\theta</code> can be used to 
obtain the estimated subgroup.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>subgroup_detect(outcome, propen, data, 
                K = 1000L, M = 1000L, seed = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="subgroup_detect_+3A_outcome">outcome</code></td>
<td>
<p>A formula object.
The linear model for the outcome regression. 
The left-hand-side variable must be the response.
R function lm will be used to estimate model parameters.
The response must be continuous.</p>
</td></tr>
<tr><td><code id="subgroup_detect_+3A_propen">propen</code></td>
<td>
<p>A formula object.
The model for the propensity score.
The left-hand-side variable must be the treatment variable.
R function glm will be used with input option
family = binomial(link=&quot;logit&quot;) to estimate model parameters.
The treatment must be binary.</p>
</td></tr>
<tr><td><code id="subgroup_detect_+3A_data">data</code></td>
<td>
<p>A data.frame object.
All covariates, treatment, and response variables.
Note that the treatment must be binary and that the
response must be continuous.</p>
</td></tr>
<tr><td><code id="subgroup_detect_+3A_k">K</code></td>
<td>
<p>An integer object. 
The number of random sampled points on the unit ball
surface <code class="reqn">\{\theta:||\theta||^2=1\}</code>.
These randomly sampled points are used for approximating
the Gaussian process in the null and local alternative
distributions of the test statistic with multivariate
normal distributions.
It is recommended that K be set to 10^p, where p is the
number of parameters in the outcome model.
Note that it is recommended that the number of covariates
be less than 10 for this implementation.
Default value is 1000. </p>
</td></tr>
<tr><td><code id="subgroup_detect_+3A_m">M</code></td>
<td>
<p>An integer object. 
The number of resamplings of the perturbed test statistic.
This sample is used to calculate the critical value of the
test. 
Default and minimum values are 1000.</p>
</td></tr>
<tr><td><code id="subgroup_detect_+3A_seed">seed</code></td>
<td>
<p>An integer object or NULL.
If integer, the seed for random number generation,
set at the onset of the calculation.
If NULL, current seed in R environment is used. </p>
</td></tr>
</table>


<h3>Details</h3>

<p>In this function, a linear model with least squares 
estimate is used for fitting the baseline model <code class="reqn">\mu(X)</code>, 
and a logistic model with maximum likelihood estimate is 
used for fitting the propensity score model <code class="reqn">P(a=1|X)</code>.
These settings cannot be changed by the user.
</p>


<h3>Value</h3>

<p>A list consisting of
</p>
<table>
<tr><td><code>outcome</code></td>
<td>
<p>An lm object.
The object returned by the lm fit of the outcome.</p>
</td></tr>
<tr><td><code>propen</code></td>
<td>
<p>A glm object.
The object returned by the glm fit of the propensity.</p>
</td></tr>
<tr><td><code>p_value</code></td>
<td>
<p>A numeric object.
The p-value of the test.</p>
</td></tr>
<tr><td><code>theta</code></td>
<td>
<p>A named numeric vector.
The change-plane parameter estimates for subgroup.</p>
</td></tr>
<tr><td><code>prop</code></td>
<td>
<p>A numeric object.
The proportion of sampled points on <code class="reqn">\theta</code> unit
ball surface that are used for calculating test
statistic. For some values of <code class="reqn">theta</code>, the
subgroup contains no samples or all samples. These
are discarded.</p>
</td></tr>
<tr><td><code>seed</code></td>
<td>
<p>If seed was provided as input, the user specified 
integer seed. If seed was not provided, not present. </p>
</td></tr>
</table>


<h3>References</h3>

<p>Ailin Fan, Rui Song, and Wenbin Lu, (2016).
Change-plane analysis for subgroup detection and sample size calculation, 
Journal of the American Statistical Association, in press.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#set parameters
tau &lt;- 0.5
theta_t &lt;- c(-0.15,0.3,sqrt(1-(-0.15)^2-(0.3)^2))
beta &lt;- c(1,1,1)
sigma &lt;- 0.5
n &lt;- 50
p &lt;- 2

#generate data
x1 &lt;- rbinom(n,size=1,prob=0.5)
x2 &lt;- runif(n,min=-1,max=1)
X &lt;- cbind(1,x1,x2)
a &lt;- rbinom(n,1,prob=0.5)
y &lt;- drop(X%*%beta) + tau*a*(drop(X%*%theta_t)&gt;=0) + rnorm(n,0,sigma)

data &lt;- data.frame(X[,2:3], a, y)

subgroup_detect(outcome = y~x1+x2,
                propen = a~x1+x2,
                data = data)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
