<!DOCTYPE html><html lang="en"><head><title>Help for package plumberDeploy</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {plumberDeploy}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#do_configure_https'><p>Add HTTPS to a plumber Droplet</p></a></li>
<li><a href='#do_deploy_api'><p>Deploy or Update an API</p></a></li>
<li><a href='#do_forward'><p>Forward Root Requests to an API</p></a></li>
<li><a href='#do_provision'><p>Provision a DigitalOcean plumber server</p></a></li>
<li><a href='#do_remove_api'><p>Remove an API from the server</p></a></li>
<li><a href='#do_remove_forward'><p>Remove the forwarding rule</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Plumber Deployment</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.1</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Description:</td>
<td>Gives the ability to automatically deploy a plumber API
    from R functions on 'DigitalOcean' and other cloud-based servers.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>Imports:</td>
<td>analogsea (&ge; 0.9.4), ssh, jsonlite, lifecycle, utils</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/meztez/plumberDeploy/issues">https://github.com/meztez/plumberDeploy/issues</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/meztez/plumberDeploy">https://github.com/meztez/plumberDeploy</a></td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>libssh &gt;= 0.6.0 (the original, not libssh2)</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-03-19 15:04:03 UTC; johnmuschelli</td>
</tr>
<tr>
<td>Author:</td>
<td>Bruno Tremblay [cre, ctb],
  Jeff Allen [aut, ccp],
  John Muschelli <a href="https://orcid.org/0000-0001-6469-1750"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Barret Schloerke [ctb],
  Trestle Technology, LLC [cph, fnd]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Bruno Tremblay &lt;cran@neoxone.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-03-22 09:40:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='do_configure_https'>Add HTTPS to a plumber Droplet</h2><span id='topic+do_configure_https'></span>

<h3>Description</h3>

<p>Adds TLS/SSL (HTTPS) to a droplet created using <code><a href="#topic+do_provision">do_provision()</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>do_configure_https(
  droplet,
  domain,
  email,
  termsOfService = FALSE,
  force = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="do_configure_https_+3A_droplet">droplet</code></td>
<td>
<p>The droplet on which to act. See <code><a href="analogsea.html#topic+droplet">analogsea::droplet()</a></code>.</p>
</td></tr>
<tr><td><code id="do_configure_https_+3A_domain">domain</code></td>
<td>
<p>The domain name associated with this instance. Used to obtain a
TLS/SSL certificate.</p>
</td></tr>
<tr><td><code id="do_configure_https_+3A_email">email</code></td>
<td>
<p>Your email address; given only to letsencrypt when requesting a
certificate to enable them to contact you about issues with renewal or
security.</p>
</td></tr>
<tr><td><code id="do_configure_https_+3A_termsofservice">termsOfService</code></td>
<td>
<p>Set to <code>TRUE</code> to agree to the letsencrypt subscriber
agreement. At the time of writing, the current version is available
<a href="https://letsencrypt.org/documents/LE-SA-v1.1.1-August-1-2016.pdf">here</a>.
Must be set to true to obtain a certificate through letsencrypt.</p>
</td></tr>
<tr><td><code id="do_configure_https_+3A_force">force</code></td>
<td>
<p>If <code>FALSE</code>, will abort if it believes that the given domain name
is not yet pointing at the appropriate IP address for this droplet. If
<code>TRUE</code>, will ignore this check and attempt to proceed regardless.</p>
</td></tr>
<tr><td><code id="do_configure_https_+3A_...">...</code></td>
<td>
<p>additional arguments to pass to <code><a href="analogsea.html#topic+droplet_ssh">analogsea::droplet_ssh()</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>In order to get a TLS/SSL certificate, you need to point a domain name to the
IP address associated with your droplet. If you don't already have a domain
name, you can register one <a href="https://www.name.com/">here</a>. Point a (sub)domain
to the IP address associated with your plumber droplet before calling this
function. These changes may take a few minutes or hours to propagate around
the Internet, but once complete you can then execute this function with the
given domain to be granted a TLS/SSL certificate for that domain.
</p>
<p>Obtains a free TLS/SSL certificate from
<a href="https://letsencrypt.org/">letsencrypt</a> and installs it in nginx. It also
configures nginx to route all unencrypted HTTP traffic (port 80) to HTTPS.
Your TLS certificate will be automatically renewed and deployed. It also
opens port 443 in the firewall to allow incoming HTTPS traffic.
</p>
<p>Historically, HTTPS certificates required payment in advance. If you
appreciate this service, consider <a href="https://letsencrypt.org/donate/">donating to the letsencrypt project</a>.
</p>


<h3>Value</h3>

<p>The DigitalOcean droplet
</p>

<hr>
<h2 id='do_deploy_api'>Deploy or Update an API</h2><span id='topic+do_deploy_api'></span>

<h3>Description</h3>

<p>Deploys an API from your local machine to make it available on the remote
plumber server.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>do_deploy_api(
  droplet,
  path,
  localPath,
  port,
  forward = FALSE,
  docs = FALSE,
  preflight,
  overwrite = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="do_deploy_api_+3A_droplet">droplet</code></td>
<td>
<p>The droplet on which to act. It's expected that this droplet
was provisioned using <code><a href="#topic+do_provision">do_provision()</a></code>.  See <code><a href="analogsea.html#topic+droplet">analogsea::droplet()</a></code> to
obtain a reference to a running droplet.</p>
</td></tr>
<tr><td><code id="do_deploy_api_+3A_path">path</code></td>
<td>
<p>The remote path/name of the application</p>
</td></tr>
<tr><td><code id="do_deploy_api_+3A_localpath">localPath</code></td>
<td>
<p>The local path to the API that you want to deploy. The
entire directory referenced will be deployed, and the <code>plumber.R</code> file
inside of that directory will be used as the root plumber file. The
directory MUST contain a <code>plumber.R</code> file.</p>
</td></tr>
<tr><td><code id="do_deploy_api_+3A_port">port</code></td>
<td>
<p>The internal port on which this service should run. This will not
be user visible, but must be unique and point to a port that is available
on your server. If unsure, try a number around <code>8000</code>.</p>
</td></tr>
<tr><td><code id="do_deploy_api_+3A_forward">forward</code></td>
<td>
<p>If <code>TRUE</code>, will setup requests targeting the root URL on the
server to point to this application. See the <code><a href="#topic+do_forward">do_forward()</a></code> function for
more details.</p>
</td></tr>
<tr><td><code id="do_deploy_api_+3A_docs">docs</code></td>
<td>
<p>If <code>TRUE</code>, will enable the documentation interface for the remotely
deployed API. By default, the interface is disabled.</p>
</td></tr>
<tr><td><code id="do_deploy_api_+3A_preflight">preflight</code></td>
<td>
<p>R commands to run after <code>plumb()</code>ing the <code>plumber.R</code> file,
but before <code>run()</code>ing the plumber service. This is an opportunity to e.g.
add new filters. If you need to specify multiple commands, they should be
semi-colon-delimited.</p>
</td></tr>
<tr><td><code id="do_deploy_api_+3A_overwrite">overwrite</code></td>
<td>
<p>if an application is already running for this <code>path</code> name,
and <code>overwrite = TRUE</code>, then <code>do_remove_api</code> will be run.</p>
</td></tr>
<tr><td><code id="do_deploy_api_+3A_...">...</code></td>
<td>
<p>additional arguments to pass to <code><a href="analogsea.html#topic+droplet_ssh">analogsea::droplet_ssh()</a></code> or
<code><a href="analogsea.html#topic+droplet_ssh">analogsea::droplet_upload()</a></code>, such as <code>keyfile</code>.
Cannot contain <code>remote</code>, <code>local</code> as named arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The DigitalOcean droplet, but called for side effects
</p>

<hr>
<h2 id='do_forward'>Forward Root Requests to an API</h2><span id='topic+do_forward'></span>

<h3>Description</h3>

<p>Forward Root Requests to an API
</p>


<h3>Usage</h3>

<pre><code class='language-R'>do_forward(droplet, path, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="do_forward_+3A_droplet">droplet</code></td>
<td>
<p>The droplet on which to act. It's expected that this droplet
was provisioned using <code><a href="#topic+do_provision">do_provision()</a></code>.</p>
</td></tr>
<tr><td><code id="do_forward_+3A_path">path</code></td>
<td>
<p>The path to which root requests should be forwarded</p>
</td></tr>
<tr><td><code id="do_forward_+3A_...">...</code></td>
<td>
<p>additional arguments to pass to <code><a href="analogsea.html#topic+droplet_ssh">analogsea::droplet_upload()</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>The DigitalOcean droplet
</p>

<hr>
<h2 id='do_provision'>Provision a DigitalOcean plumber server</h2><span id='topic+do_provision'></span><span id='topic+do_install_plumber'></span><span id='topic+do_ip'></span>

<h3>Description</h3>

<p>Create (if required), install the necessary prerequisites, and
deploy a sample plumber application on a DigitalOcean virtual machine.
You may sign up for a Digital Ocean account
<a href="https://www.digitalocean.com/?refcode=add0b50f54c4&amp;utm_campaign=Referral_Invite&amp;utm_medium=Referral_Program&amp;utm_source=CopyPaste">here</a>.
You should configure an account ssh key with <code><a href="analogsea.html#topic+key-crud">analogsea::key_create()</a></code> prior to using this method.
This command is idempotent, so feel free to run it on a single server multiple times.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>do_provision(droplet, unstable = FALSE, example = TRUE, ...)

do_install_plumber(droplet, unstable, ...)

do_ip(droplet, path)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="do_provision_+3A_droplet">droplet</code></td>
<td>
<p>The DigitalOcean droplet that you want to provision
(see <code><a href="analogsea.html#topic+droplet">analogsea::droplet()</a></code>).</p>
</td></tr>
<tr><td><code id="do_provision_+3A_unstable">unstable</code></td>
<td>
<p>If <code>FALSE</code>, will install plumber from CRAN. If <code>TRUE</code>, will
install the unstable version of plumber from GitHub.</p>
</td></tr>
<tr><td><code id="do_provision_+3A_example">example</code></td>
<td>
<p>If <code>TRUE</code>, will deploy an example API named <code>hello</code>
to the server on port 8000.</p>
</td></tr>
<tr><td><code id="do_provision_+3A_...">...</code></td>
<td>
<p>Arguments passed into the <code><a href="analogsea.html#topic+droplet_create">analogsea::droplet_create()</a></code> function.</p>
</td></tr>
<tr><td><code id="do_provision_+3A_path">path</code></td>
<td>
<p>path to attach to the IP address before browsing.  Should likely
start with a <code>/</code> or <code>:</code> (as in <code style="white-space: pre;">&#8288;:8080&#8288;</code>), otherwise <code>/</code> will be added.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Provisions a Ubuntu 20.04-x64 droplet with the following customizations:
</p>

<ul>
<li><p> A recent version of R installed
</p>
</li>
<li><p> plumber installed globally in the system library
</p>
</li>
<li><p> An example plumber API deployed at <code style="white-space: pre;">&#8288;/var/plumber&#8288;</code>
</p>
</li>
<li><p> A systemd definition for the above plumber API which will ensure that the plumber
API is started on machine boot and respawned if the R process ever crashes. On the
server you can use commands like <code style="white-space: pre;">&#8288;systemctl restart plumber&#8288;</code> to manage your API, or
<code style="white-space: pre;">&#8288;journalctl -u plumber&#8288;</code> to see the logs associated with your plumber process.
</p>
</li>
<li><p> The 'nginx&ldquo; web server installed to route web traffic from port 80 (HTTP) to your plumber
process.
</p>
</li>
<li> <p><code>ufw</code> installed as a firewall to restrict access on the server. By default it only
allows incoming traffic on port 22 (SSH) and port 80 (HTTP).
</p>
</li>
<li><p> A 4GB swap file is created to ensure that machines with little RAM (the default) are
able to get through the necessary R package compilations.
</p>
</li></ul>



<h3>Value</h3>

<p>The DigitalOcean droplet
</p>
<p>The URL to be browsed
</p>


<h3>Note</h3>

<p>Please see <a href="https://github.com/sckott/analogsea/issues/205">https://github.com/sckott/analogsea/issues/205</a> in case
of an error by default <code>do_provision</code> and an error of
<code>"Error: Size is not available in this region."</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  auth = try(analogsea::do_oauth())
  if (!inherits(auth, "try-error") &amp;&amp;
      inherits(auth, "request")) {
    analogsea::droplets()
    droplet = do_provision(region = "sfo3", example = FALSE)
    analogsea::droplets()
    analogsea::install_r_package(droplet, c("readr", "remotes"))
    do_deploy_api(droplet, "hello",
                  system.file("plumber", "10-welcome", package = "plumber"),
                  port=8000, forward=TRUE)
    if (interactive()) {
        utils::browseURL(do_ip(droplet, "/hello"))
    }
    analogsea::droplet_delete(droplet)
  }

## End(Not run)
</code></pre>

<hr>
<h2 id='do_remove_api'>Remove an API from the server</h2><span id='topic+do_remove_api'></span>

<h3>Description</h3>

<p>Removes all services and routing rules associated with a particular service.
Optionally purges the associated API directory from disk.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>do_remove_api(droplet, path, delete = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="do_remove_api_+3A_droplet">droplet</code></td>
<td>
<p>The droplet on which to act. It's expected that this droplet
was provisioned using <code><a href="#topic+do_provision">do_provision()</a></code>. See <code><a href="analogsea.html#topic+droplet">analogsea::droplet()</a></code> to
obtain a reference to a running droplet.</p>
</td></tr>
<tr><td><code id="do_remove_api_+3A_path">path</code></td>
<td>
<p>The path/name of the plumber service</p>
</td></tr>
<tr><td><code id="do_remove_api_+3A_delete">delete</code></td>
<td>
<p>If <code>TRUE</code>, will also delete the associated directory
(<code style="white-space: pre;">&#8288;/var/plumber/whatever&#8288;</code>) from the server.</p>
</td></tr>
<tr><td><code id="do_remove_api_+3A_...">...</code></td>
<td>
<p>additional arguments to pass to <code><a href="analogsea.html#topic+droplet_ssh">analogsea::droplet_ssh()</a></code> or
<code><a href="analogsea.html#topic+droplet_ssh">analogsea::droplet_upload()</a></code>, such as <code>keyfile</code>.
Cannot contain <code>remote</code>, <code>local</code> as named arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The DigitalOcean droplet, but called for side effects
</p>

<hr>
<h2 id='do_remove_forward'>Remove the forwarding rule</h2><span id='topic+do_remove_forward'></span>

<h3>Description</h3>

<p>Removes the forwarding rule from the root path on the server. The server will
no longer forward requests for <code>/</code> to an application.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>do_remove_forward(droplet, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="do_remove_forward_+3A_droplet">droplet</code></td>
<td>
<p>The droplet on which to act. It's expected that this droplet
was provisioned using <code><a href="#topic+do_provision">do_provision()</a></code>. See <code><a href="analogsea.html#topic+droplet">analogsea::droplet()</a></code> to obtain a reference to a running droplet.</p>
</td></tr>
<tr><td><code id="do_remove_forward_+3A_...">...</code></td>
<td>
<p>additional arguments to pass to <code><a href="analogsea.html#topic+droplet_ssh">analogsea::droplet_ssh()</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>The DigitalOcean droplet, but called for side effects
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
