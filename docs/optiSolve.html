<!DOCTYPE html><html lang="en"><head><title>Help for package optiSolve</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {optiSolve}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#optiSolve-package'>
<p>Linear, Quadratic, and Rational Optimization</p></a></li>
<li><a href='#adjust'><p>Adjust Constraints and Objective Functions</p></a></li>
<li><a href='#cop'><p>Constrained Optimization Problem</p></a></li>
<li><a href='#lbcon'><p>Lower Bounds</p></a></li>
<li><a href='#lincon'><p>Linear Constraints</p></a></li>
<li><a href='#linfun'><p>Linear Objective Function</p></a></li>
<li><a href='#myQ'><p>Kinship Matrix</p></a></li>
<li><a href='#myQ1'><p>Kinship Matrix</p></a></li>
<li><a href='#myQ2'><p>Kinship Matrix</p></a></li>
<li><a href='#phenotype'><p>Phenotypes of Genotyped Cattle</p></a></li>
<li><a href='#print.copValidation'><p>Print Validation of a Solution</p></a></li>
<li><a href='#quadcon'><p>Quadratic Constraint</p></a></li>
<li><a href='#quadfun'><p>Quadratic Objective Function</p></a></li>
<li><a href='#ratiocon'><p>Rational Constraint</p></a></li>
<li><a href='#ratiofun'><p>Rational Objective Function</p></a></li>
<li><a href='#solvecop'><p>Solve a Constrained Optimization Problem</p></a></li>
<li><a href='#ubcon'><p>Upper Bounds</p></a></li>
<li><a href='#validate'><p>Validate a Solution</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Linear, Quadratic, and Rational Optimization</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2021-10-13</td>
</tr>
<tr>
<td>Author:</td>
<td>Robin Wellmann</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Robin Wellmann &lt;r.wellmann@uni-hohenheim.de&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.4)</td>
</tr>
<tr>
<td>Description:</td>
<td>Solver for linear, quadratic, and rational programs with linear, quadratic, and rational constraints. A unified interface to different R packages is provided. Optimization problems are transformed into equivalent formulations and solved by the respective package. For example, quadratic programming problems with linear, quadratic and rational constraints can be solved by augmented Lagrangian minimization using package 'alabama', or by sequential quadratic programming using solver 'slsqp'.  Alternatively, they can be reformulated as optimization problems with second order cone constraints and solved with package 'cccp'.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>Matrix, shapes, alabama, cccp, nloptr, MASS, methods, plyr,
stringr, stats, Rcpp (&ge; 0.12.4)</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-10-13 11:55:24 UTC; Robin</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-10-13 12:32:04 UTC</td>
</tr>
</table>
<hr>
<h2 id='optiSolve-package'>
Linear, Quadratic, and Rational Optimization
</h2><span id='topic+optiSolve-package'></span><span id='topic+optiSolve'></span>

<h3>Description</h3>

<p>Solver for linear, quadratic, and rational programs with linear, quadratic, and rational constraints. A unified interface to different R packages is provided. Optimization problems are transformed into equivalent formulations and solved by the respective package. For example, quadratic programming problems with linear, quadratic and rational constraints can be solved by augmented Lagrangian minimization using package 'alabama', or by sequential quadratic programming using solver 'slsqp'.  Alternatively, they can be reformulated as optimization problems with second order cone constraints and solved with package 'cccp'.
</p>


<h3>Details</h3>

<p>The following steps are included in solving a constrained optimization problem (cop):
</p>
<p><b>1)</b> Define the objective with one of the following functions:
</p>

<table>
<tr>
 <td style="text-align: left;">
<a href="#topic+linfun">linfun</a>    </td><td style="text-align: left;">  defines a linear objective function,</td>
</tr>
<tr>
 <td style="text-align: left;"> 
<a href="#topic+quadfun">quadfun</a>   </td><td style="text-align: left;">  defines a quadratic objective function,</td>
</tr>
<tr>
 <td style="text-align: left;">
<a href="#topic+ratiofun">ratiofun</a>  </td><td style="text-align: left;">  defines a rational objective function.</td>
</tr>
<tr>
 <td style="text-align: left;"> 
</td>
</tr>

</table>

<p><b>2)</b> Define the constraints by using the following functions:
</p>

<table>
<tr>
 <td style="text-align: left;">
<a href="#topic+lincon">lincon</a>    </td><td style="text-align: left;">  defines linear equality and inequality constraints,</td>
</tr>
<tr>
 <td style="text-align: left;"> 
<a href="#topic+quadcon">quadcon</a>   </td><td style="text-align: left;">  defines quadratic constraints,</td>
</tr>
<tr>
 <td style="text-align: left;">
<a href="#topic+ratiocon">ratiocon</a>  </td><td style="text-align: left;">  defines rational constraints,</td>
</tr>
<tr>
 <td style="text-align: left;"> 
<a href="#topic+lbcon">lbcon</a>    </td><td style="text-align: left;">  defines lower bounds for the variables,</td>
</tr>
<tr>
 <td style="text-align: left;">
<a href="#topic+ubcon">ubcon</a>    </td><td style="text-align: left;">  defines upper bounds for the variables.</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p><b>3)</b> Put the objective function and the constraints together to define the optimization problem:
</p>

<table>
<tr>
 <td style="text-align: left;">
<a href="#topic+cop">cop</a>    </td><td style="text-align: left;">  defines a constrained optimization problem.</td>
</tr>
<tr>
 <td style="text-align: left;"> 
</td>
</tr>

</table>

<p><b>4)</b> Solve the optimization problem:
</p>

<table>
<tr>
 <td style="text-align: left;">
<a href="#topic+solvecop">solvecop</a>    </td><td style="text-align: left;">  solves a constrained optimization problem.</td>
</tr>
<tr>
 <td style="text-align: left;"> 
</td>
</tr>

</table>

<p><b>5)</b> Check if the solution fulfils all constraints:
</p>

<table>
<tr>
 <td style="text-align: left;">
<a href="#topic+validate">validate</a>    </td><td style="text-align: left;">  checks if the solution fulfils all constraints, and calculates the values of the constraints.</td>
</tr>
<tr>
 <td style="text-align: left;"> 
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Robin Wellmann
</p>
<p>Maintainer: Robin Wellmann &lt;r.wellmann@uni-hohenheim.de&gt;
</p>


<h3>References</h3>

<p>Kraft, D. (1988). A software package for sequential quadratic programming, Technical Report DFVLR-FB 88-28, Institut fuer Dynamik der Flugsysteme, Oberpfaffenhofen, July 1988.
</p>
<p>Lange K, Optimization, 2004, Springer.
</p>
<p>Madsen K, Nielsen HB, Tingleff O, Optimization With Constraints, 2004, IMM, Technical University of Denmark.
</p>

<hr>
<h2 id='adjust'>Adjust Constraints and Objective Functions</h2><span id='topic+adjust'></span>

<h3>Description</h3>

<p>Constraints and objective functions are adjusted so that they refer to a larger or smaller set of variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>adjust(x, ids)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="adjust_+3A_x">x</code></td>
<td>
<p>Constraint or objective function of class <code>"linFun"</code>, <code>"linCon"</code>, <code>"quadFun"</code>, <code>"quadCon"</code>, <code>"ratioFun"</code>, and <code>"ratioCon"</code>.</p>
</td></tr>
<tr><td><code id="adjust_+3A_ids">ids</code></td>
<td>
<p>Vector with ids of the variables.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Constraints and objective functions are adjusted so that they refer to a larger or smaller set of variables. Additional variables do not affect the value of the constraint or objective function.
</p>


<h3>Value</h3>

<p>A data frame (invisible) containing values and bounds of the constraints, the value of the objective function, and column <code>valid</code> which is TRUE if all constraints are fulfilled. 
</p>


<h3>See Also</h3>

<p>The main function for solving constrained programming problems is <a href="#topic+solvecop">solvecop</a>.
</p>

<hr>
<h2 id='cop'>Constrained Optimization Problem</h2><span id='topic+cop'></span>

<h3>Description</h3>

<p>Define a constrained optimization problem with a linear, quadratic, or rational objective function, and linear, quadratic, rational, and boundary constraints.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cop(f, max=FALSE, lb=NULL, ub=NULL, lc=NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cop_+3A_f">f</code></td>
<td>
<p>Objective function, defined with function <a href="#topic+linfun">linfun</a>, <a href="#topic+quadfun">quadfun</a>, or <a href="#topic+ratiofun">ratiofun</a>.</p>
</td></tr>
<tr><td><code id="cop_+3A_max">max</code></td>
<td>
<p>Logical value. Should the function be maximized? This is possible only for linear objective functions.</p>
</td></tr>
<tr><td><code id="cop_+3A_lb">lb</code></td>
<td>
<p>Lower bounds for the variables, defined with function <a href="#topic+lbcon">lbcon</a>.</p>
</td></tr>
<tr><td><code id="cop_+3A_ub">ub</code></td>
<td>
<p>Upper bounds for the variables, defined with function <a href="#topic+ubcon">ubcon</a>.</p>
</td></tr>
<tr><td><code id="cop_+3A_lc">lc</code></td>
<td>
<p>Linear inequality and equality constraints, defined with function <a href="#topic+lincon">lincon</a>.</p>
</td></tr>
<tr><td><code id="cop_+3A_...">...</code></td>
<td>
<p>Quadratic and rational inequality constraints, defined with functions <a href="#topic+quadcon">quadcon</a> and <a href="#topic+ratiocon">ratiocon</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Define a constrained optimization problem with a linear, quadratic, or rational objective function, and linear, quadratic, rational, and boundary constraints. The optimization problem can be solved with function <a href="#topic+solvecop">solvecop</a>.
</p>


<h3>Value</h3>

<p>An object of class <code>COP</code>, which may contain the following components
</p>
<table role = "presentation">
<tr><td><code>f</code></td>
<td>
<p>List with S3-class &quot;linFun&quot;, &quot;quadFun&quot;, or &quot;ratioFun&quot;, defining the objective function</p>
</td></tr>
<tr><td><code>max</code></td>
<td>
<p>Logical value. Should the objective function be maximized?</p>
</td></tr>
<tr><td><code>lb</code></td>
<td>
<p>List with S3-class &quot;lbCon&quot;, defining lower bounds.</p>
</td></tr>
<tr><td><code>ub</code></td>
<td>
<p>List with S3-class &quot;ubCon&quot;, defining upper bounds.</p>
</td></tr>
<tr><td><code>lc</code></td>
<td>
<p>List with S3-class &quot;linCon&quot;, defining linear constraints</p>
</td></tr>
<tr><td><code>qc</code></td>
<td>
<p>List with S3-class &quot;quadCon&quot;, defining quadratic constraints</p>
</td></tr>
<tr><td><code>rc</code></td>
<td>
<p>List with S3-class &quot;ratioCon&quot;, defining rational constraints</p>
</td></tr>
<tr><td><code>x</code></td>
<td>
<p>Vector with NAs</p>
</td></tr>
<tr><td><code>id</code></td>
<td>
<p>Vector with names of the variables that are to be optimized</p>
</td></tr>
<tr><td><code>madeDefinite</code></td>
<td>
<p>Logical variable indicating whether non-positive-semidefinite matrices have already been approximated by positive-definite matrices.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Robin Wellmann</p>


<h3>See Also</h3>

<p>The main function for solving constrained programming problems is <a href="#topic+solvecop">solvecop</a>.
</p>

<hr>
<h2 id='lbcon'>Lower Bounds</h2><span id='topic+lbcon'></span>

<h3>Description</h3>

<p>Define lower bounds for the variables of the form </p>
<p style="text-align: center;"><code class="reqn">val &lt;= x.</code>
</p>
 


<h3>Usage</h3>

<pre><code class='language-R'>lbcon(val=numeric(0), id=seq_along(val))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="lbcon_+3A_val">val</code></td>
<td>
<p>Numeric vector with lower bounds for the variables. If <code>val</code> is a single value, then this value will be used for all variables in vector <code>id</code>.</p>
</td></tr>
<tr><td><code id="lbcon_+3A_id">id</code></td>
<td>
<p>Vector defining the names of the variables to which the constraint applies. Each variable name corresponds to one component of <code>x</code>. Variable names must be consistent across constraints. 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Define lower bounds for the variables of the form </p>
<p style="text-align: center;"><code class="reqn">val &lt;= x.</code>
</p>
<p> Vector <code>x</code> contains only the variables included in argument <code>id</code>.
</p>


<h3>Value</h3>

<p>An object of class <code>lbCon</code>.
</p>


<h3>See Also</h3>

<p>The main function for solving constrained programming problems is <a href="#topic+solvecop">solvecop</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
### Linear programming with linear and quadratic constraints ###
### Example from animal breeding                             ###
### The mean breeding value BV is maximized whereas the      ###
### mean kinship in the offspring x'Qx+d is restricted       ###
### Lower and upper bounds for females are identical, so     ###
### their contributions are not optimized.                   ###
### Lower and upper bounds for some males are defined.       ###

data(phenotype)
data(myQ)

A   &lt;- t(model.matrix(~Sex-1, data=phenotype))
A[,1:5]
val &lt;- c(0.5,  0.5)
dir &lt;- c("==","==")
Nf  &lt;- sum(phenotype$Sex=="female")
id  &lt;- phenotype$Indiv

lbval &lt;- setNames(rep(0,  length(id)), id)
ubval &lt;- setNames(rep(NA, length(id)), id)
lbval[phenotype$Sex=="female"] &lt;- 1/(2*Nf)
ubval[phenotype$Sex=="female"] &lt;- 1/(2*Nf)
lbval["276000102379430"] &lt;- 0.02
ubval["276000121507437"] &lt;- 0.03

mycop &lt;- cop(f  = linfun(a=phenotype$BV, id=id, name="BV"),
             max= TRUE,
             lb = lbcon(lbval, id=id), 
             ub = ubcon(ubval, id=id),
             lc = lincon(A=A, dir=dir, val=val, id=id),
             qc = quadcon(Q=myQ, d=0.001, val=0.045, 
                          name="Kinship", id=rownames(myQ)))

res &lt;- solvecop(mycop, solver="cccp2", quiet=FALSE)

Evaluation &lt;- validate(mycop, res)

#            valid solver  status
#             TRUE  cccp2 optimal
#
#   Variable     Value      Bound    OK?
#   -------------------------------------
#   BV           0.5502 max        :      
#   -------------------------------------
#   lower bounds all x  &gt;=  lb     : TRUE 
#   upper bounds all x  &lt;=  ub     : TRUE 
#   Sexfemale    0.5    ==  0.5    : TRUE 
#   Sexmale      0.5    ==  0.5    : TRUE 
#   Kinship      0.045  &lt;=  0.045  : TRUE 
#   -------------------------------------

res$x["276000102379430"]

res$x["276000121507437"]

</code></pre>

<hr>
<h2 id='lincon'>Linear Constraints</h2><span id='topic+lincon'></span>

<h3>Description</h3>

<p>Define linear equality and inequality constraints of the form </p>
<p style="text-align: center;"><code class="reqn">A x + d dir val</code>
</p>
 


<h3>Usage</h3>

<pre><code class='language-R'>lincon(A, d=rep(0, nrow(A)), dir=rep("==",nrow(A)), val=rep(0, nrow(A)), 
   id=1:ncol(A), use=rep(TRUE,nrow(A)), name=rownames(A))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="lincon_+3A_a">A</code></td>
<td>
<p>Numeric matrix of the constraint coefficients.</p>
</td></tr>
<tr><td><code id="lincon_+3A_d">d</code></td>
<td>
<p>Numeric vector.</p>
</td></tr>
<tr><td><code id="lincon_+3A_dir">dir</code></td>
<td>
<p>Character vector with the directions of the constraints. Each element must be one of  <code>"&lt;="</code>, <code>"=="</code>, and <code>"&gt;="</code>.</p>
</td></tr>
<tr><td><code id="lincon_+3A_val">val</code></td>
<td>
<p>Numeric vector with threshold values.</p>
</td></tr>
<tr><td><code id="lincon_+3A_id">id</code></td>
<td>
<p>Vector (if present), defining the names of the variables to which the constraint applies. Each variable name corresponds to one component of <code>x</code>. Variable names must be consistent across constraints. 
</p>
</td></tr>
<tr><td><code id="lincon_+3A_use">use</code></td>
<td>
<p>Logical vector indicating the constraints to be included in the optimization problem. If <code>use[i]=FALSE</code>, then linear constraint <code>i</code> does not affect the result, but the value of the linear function <code>A[i,] x + d[i]</code> will be reported by function <a href="#topic+validate">validate</a>.</p>
</td></tr>
<tr><td><code id="lincon_+3A_name">name</code></td>
<td>
<p>Vector with names of the constraints.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Define linear  inequality and equality constraints of the form 
</p>
<p style="text-align: center;"><code class="reqn">A x + d dir val</code>
</p>
 
<p>(component wise). If parameter <code>id</code> is specified, then vector <code>x</code> contains only the indicated variables.
</p>


<h3>Value</h3>

<p>An object of class <code>linCon</code>.
</p>


<h3>See Also</h3>

<p>The main function for solving constrained programming problems is <code><a href="#topic+solvecop">solvecop</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
### Quadratic programming with linear constraints       ###
### Example from animal breeding                        ###
### The mean kinship in the offspring x'Qx+d is minized ###
### and the mean breeding value is restricted.          ###

data(phenotype)
data(myQ)

A   &lt;- t(model.matrix(~Sex+BV-1, data=phenotype))
A[,1:5]
val &lt;- c(0.5, 0.5, 0.40)
dir &lt;- c("==","==","&gt;=")

mycop &lt;- cop(f  = quadfun(Q=myQ, d=0.001, name="Kinship", id=rownames(myQ)), 
             lb = lbcon(0,  id=phenotype$Indiv), 
             ub = ubcon(NA, id=phenotype$Indiv),
             lc = lincon(A=A, dir=dir, val=val, id=phenotype$Indiv))

res &lt;- solvecop(mycop, solver="cccp", quiet=FALSE)

validate(mycop, res)

#            valid solver  status
#             TRUE   cccp optimal
#
#   Variable     Value      Bound    OK?
#   -------------------------------------
#   Kinship      0.0322 min        :      
#   -------------------------------------
#   lower bounds all x  &gt;=  lb     : TRUE 
#   Sexfemale    0.5    ==  0.5    : TRUE 
#   Sexmale      0.5    ==  0.5    : TRUE 
#   BV           0.4    &gt;=  0.4    : TRUE 
#   -------------------------------------


</code></pre>

<hr>
<h2 id='linfun'>Linear Objective Function</h2><span id='topic+linfun'></span>

<h3>Description</h3>

<p>Define a linear objective function of the form </p>
<p style="text-align: center;"><code class="reqn">f(x) = a' x + d</code>
</p>
<p>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>linfun(a, d=0, id=1:length(a), name="lin.fun")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="linfun_+3A_a">a</code></td>
<td>
<p>Numeric vector of the coefficients.</p>
</td></tr>
<tr><td><code id="linfun_+3A_d">d</code></td>
<td>
<p>Numeric value.</p>
</td></tr>
<tr><td><code id="linfun_+3A_id">id</code></td>
<td>
<p>Vector defining the names of the variables to which the function applies. Each variable name corresponds to one component of <code>x</code>. Variable names must be consistent across constraints.</p>
</td></tr>
<tr><td><code id="linfun_+3A_name">name</code></td>
<td>
<p>Name for the objective function.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Define linear objective function of the form </p>
<p style="text-align: center;"><code class="reqn">f(x) = a' x + d</code>
</p>
<p>.
</p>


<h3>Value</h3>

<p>An object of class <code>linFun</code>.
</p>


<h3>See Also</h3>

<p>The main function for solving constrained programming problems is <code><a href="#topic+solvecop">solvecop</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
### Linear programming with linear and quadratic constraints ###
### Example from animal breeding                             ###
### The mean breeding value BV is maximized whereas the      ###
### mean kinship in the offspring x'Qx+d is restricted       ###

data(phenotype)
data(myQ)

A   &lt;- t(model.matrix(~Sex-1, data=phenotype))
A[,1:5]
val &lt;- c(0.5, 0.5)
dir &lt;- c("==","==")

mycop &lt;- cop(f  = linfun(a=phenotype$BV, id=phenotype$Indiv, name="BV"),
             max= TRUE,
             lb = lbcon(0,  id=phenotype$Indiv), 
             ub = ubcon(NA, id=phenotype$Indiv),
             lc = lincon(A=A, dir=dir, val=val, id=phenotype$Indiv),
             qc = quadcon(Q=myQ, d=0.001, val=0.035, name="Kinship", id=rownames(myQ)))

res &lt;- solvecop(mycop, solver="cccp2", quiet=FALSE)

validate(mycop, res)

#            valid solver  status
#             TRUE  cccp2 optimal
#
#   Variable     Value      Bound    OK?
#   -------------------------------------
#   BV           0.7667 max        :      
#   -------------------------------------
#   lower bounds all x  &gt;=  lb     : TRUE 
#   Sexfemale    0.5    ==  0.5    : TRUE 
#   Sexmale      0.5    ==  0.5    : TRUE 
#   Kinship      0.035  &lt;=  0.035  : TRUE 
#   -------------------------------------


</code></pre>

<hr>
<h2 id='myQ'>Kinship Matrix</h2><span id='topic+myQ'></span>

<h3>Description</h3>

<p>Kinship matrix of the cattle listed in data frame <a href="#topic+phenotype">phenotype</a>. This is an (almost) positive semidefinite matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(myQ)</code></pre>


<h3>Format</h3>

<p>Matrix</p>

<hr>
<h2 id='myQ1'>Kinship Matrix</h2><span id='topic+myQ1'></span>

<h3>Description</h3>

<p>Matrix needed to compute kinship at native alleles for the cattle listed in data frame <a href="#topic+phenotype">phenotype</a>. This is an (almost) positive semidefinite matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(myQ1)</code></pre>


<h3>Format</h3>

<p>Matrix</p>

<hr>
<h2 id='myQ2'>Kinship Matrix</h2><span id='topic+myQ2'></span>

<h3>Description</h3>

<p>Matrix needed to compute kinship at native alleles for the cattle listed in data frame <a href="#topic+phenotype">phenotype</a>. This is an (almost) positive semidefinite matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(myQ2)</code></pre>


<h3>Format</h3>

<p>Matrix</p>

<hr>
<h2 id='phenotype'>Phenotypes of Genotyped Cattle</h2><span id='topic+phenotype'></span>

<h3>Description</h3>

<p>Phenotypes of cattle.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(phenotype)</code></pre>


<h3>Format</h3>

<p>Data frame containing information on genotyped cattle. The columns contain the IDs of the individuals (<code>Indiv</code>), simulated breeding values (<code>BV</code>), simulated sexes (<code>Sex</code>), and genetic contributions from other breeds (<code>MC</code>).
</p>

<hr>
<h2 id='print.copValidation'>Print Validation of a Solution</h2><span id='topic+print.copValidation'></span><span id='topic+print'></span>

<h3>Description</h3>

<p>Print the validation results for the solution of an optimization problem. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'copValidation'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.copValidation_+3A_x">x</code></td>
<td>
<p>The result of function <a href="#topic+validate">validate</a>.</p>
</td></tr>
<tr><td><code id="print.copValidation_+3A_...">...</code></td>
<td>
<p>Unused additional arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Print the validation results for the solution of an optimization problem.
</p>


<h3>Value</h3>

<p>A list of class <code>copValidation</code> (invisible) with components:
</p>
<table role = "presentation">
<tr><td><code>summary</code></td>
<td>
<p>Data frame containing one row for each constraint with the value of the constraint in column <code>Val</code>, the bound for the constraint in column <code>Bound</code>, and column <code>OK</code> states if the constraint is fulfilled.  The value of the objective function is shown in the first row.  Additional rows contain the values of disabled constraints.</p>
</td></tr>
<tr><td><code>info</code></td>
<td>
<p>Data frame with component <code>valid</code> indicating if all constraints are fulfilled, component <code>solver</code> containing the name of the solver used for optimization, and component <code>status</code> describing the solution as reported by the solver.</p>
</td></tr>
<tr><td><code>var</code></td>
<td>
<p>Data frame with the values of the objective function and constraints at the optimum.</p>
</td></tr>
<tr><td><code>obj.fun</code></td>
<td>
<p>Named numeric value with value and name of the objective function at the optimum.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>The main function for solving constrained programming problems is <a href="#topic+solvecop">solvecop</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
### Quadratic programming with linear constraints      ###
### Example from animal breeding                       ###
### where the mean kinship in the offspring is minized ###

data(phenotype)
data(myQ)

A   &lt;- t(model.matrix(~Sex+BV-1, data=phenotype))
rownames(A) &lt;- c("male.cont","female.cont", "Breeding.Value")
val &lt;- c(0.5, 0.5, 0.40)
dir &lt;- c("==","==","&gt;=")

mycop &lt;- cop(f  = quadfun(Q=myQ, d=0.001, name="Kinship", id=rownames(myQ)), 
             lb = lbcon(0,  id=phenotype$Indiv), 
             ub = ubcon(NA, id=phenotype$Indiv),
             lc = lincon(A=A, dir=dir, val=val, id=phenotype$Indiv))

res &lt;- solvecop(mycop, solver="cccp", quiet=FALSE, trace=FALSE)

head(res$x)

Evaluation &lt;- validate(mycop, res, quiet=TRUE)

print(Evaluation)

#            valid solver  status
#             TRUE   cccp optimal
#
#   Variable       Value      Bound    OK?
#   ---------------------------------------
#   Kinship        0.0322 min        :      
#   ---------------------------------------
#   lower bounds   all x  &gt;=  lb     : TRUE 
#   male.cont      0.5    ==  0.5    : TRUE 
#   female.cont    0.5    ==  0.5    : TRUE 
#   Breeding.Value 0.4    &gt;=  0.4    : TRUE 
#   ---------------------------------------

</code></pre>

<hr>
<h2 id='quadcon'>Quadratic Constraint</h2><span id='topic+quadcon'></span>

<h3>Description</h3>

<p>Define a quadratic constraint of the form 
</p>
<p style="text-align: center;"><code class="reqn">x'Qx + a' x + d \leq val</code>
</p>



<h3>Usage</h3>

<pre><code class='language-R'>quadcon(Q, a=rep(0, nrow(Q)), d=0, dir="&lt;=", val, 
   id=1:nrow(Q), name="quadratic", use=TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="quadcon_+3A_q">Q</code></td>
<td>
<p>Numeric symmetric matrix of the constraint coefficients.</p>
</td></tr>
<tr><td><code id="quadcon_+3A_a">a</code></td>
<td>
<p>Numeric vector.</p>
</td></tr>
<tr><td><code id="quadcon_+3A_d">d</code></td>
<td>
<p>Numeric value.</p>
</td></tr>
<tr><td><code id="quadcon_+3A_dir">dir</code></td>
<td>
<p>Character string <code>"&lt;="</code>.</p>
</td></tr>
<tr><td><code id="quadcon_+3A_val">val</code></td>
<td>
<p>Numeric threshold value, which is the upper bound for the quadratic function.</p>
</td></tr>
<tr><td><code id="quadcon_+3A_id">id</code></td>
<td>
<p>Vector defining the names of the variables to which the constraint applies. Each variable name corresponds to one component of <code>x</code>. Variable names must be consistent across constraints. </p>
</td></tr>
<tr><td><code id="quadcon_+3A_name">name</code></td>
<td>
<p>Name for the constraint.</p>
</td></tr>
<tr><td><code id="quadcon_+3A_use">use</code></td>
<td>
<p>Logical value indicating if the constraint should be included in the optimization problem. If <code>use=FALSE</code>, then  constraint  does not affect the result, but the value of the quadratic function will be reported by function <a href="#topic+validate">validate</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Define a quadratic inequality constraint of the form 
</p>
<p style="text-align: center;"><code class="reqn">x'Qx + a' x + d \leq val.</code>
</p>

<p>Vector <code>x</code> contains only the variables included in argument <code>id</code>.
</p>


<h3>Value</h3>

<p>An object of class <code>quadCon</code>.
</p>


<h3>See Also</h3>

<p>The main function for solving constrained programming problems is <code><a href="#topic+solvecop">solvecop</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
### Linear programming with linear and quadratic constraints ###
### Example from animal breeding                             ###
### The mean breeding value BV is maximized whereas the      ###
### mean kinship in the offspring x'Qx+d is restricted       ###

data(phenotype)
data(myQ)

A   &lt;- t(model.matrix(~Sex-1, data=phenotype))
A[,1:5]
val &lt;- c(0.5, 0.5)
dir &lt;- c("==","==")

mycop &lt;- cop(f  = linfun(a=phenotype$BV, id=phenotype$Indiv, name="BV"),
             max= TRUE,
             lb = lbcon(0,  id=phenotype$Indiv), 
             ub = ubcon(NA, id=phenotype$Indiv),
             lc = lincon(A=A, dir=dir, val=val, id=phenotype$Indiv),
             qc = quadcon(Q=myQ, d=0.001, val=0.035, name="Kinship", id=rownames(myQ)))

res &lt;- solvecop(mycop, solver="cccp2", quiet=FALSE)

validate(mycop, res)

#            valid solver  status
#             TRUE  cccp2 optimal
#
#   Variable     Value      Bound    OK?
#   -------------------------------------
#   BV           0.7667 max        :      
#   -------------------------------------
#   lower bounds all x  &gt;=  lb     : TRUE 
#   Sexfemale    0.5    ==  0.5    : TRUE 
#   Sexmale      0.5    ==  0.5    : TRUE 
#   Kinship      0.035  &lt;=  0.035  : TRUE 
#   -------------------------------------

</code></pre>

<hr>
<h2 id='quadfun'>Quadratic Objective Function</h2><span id='topic+quadfun'></span>

<h3>Description</h3>

<p>Define a quadratic objective function of the form </p>
<p style="text-align: center;"><code class="reqn">f(x) = x^T Qx + a^T x + d</code>
</p>



<h3>Usage</h3>

<pre><code class='language-R'>quadfun(Q, a=rep(0, nrow(Q)), d=0, id=1:nrow(Q), name="quad.fun")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="quadfun_+3A_q">Q</code></td>
<td>
<p>Numeric symmetric matrix of the constraint coefficients.</p>
</td></tr>
<tr><td><code id="quadfun_+3A_a">a</code></td>
<td>
<p>Numeric vector.</p>
</td></tr>
<tr><td><code id="quadfun_+3A_d">d</code></td>
<td>
<p>Numeric value.</p>
</td></tr>
<tr><td><code id="quadfun_+3A_id">id</code></td>
<td>
<p>Vector (if present), defining the names of the variables to which the function applies. Each variable name corresponds to one component of <code>x</code>. Variable names must be consistent across constraints. </p>
</td></tr>
<tr><td><code id="quadfun_+3A_name">name</code></td>
<td>
<p>Name for the objective function.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Define a quadratic objective function of the form </p>
<p style="text-align: center;"><code class="reqn">f(x) = x^T Qx + a^T x + d</code>
</p>



<h3>Value</h3>

<p>An object of class <code>quadFun</code>.
</p>


<h3>See Also</h3>

<p>The main function for solving constrained programming problems is <code><a href="#topic+solvecop">solvecop</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
### Quadratic programming with linear constraints       ###
### Example from animal breeding                        ###
### The mean kinship in the offspring x'Qx+d is minized ###
### and the mean breeding value is restricted.          ###

data(phenotype)
data(myQ)

A   &lt;- t(model.matrix(~Sex+BV-1, data=phenotype))
A[,1:5]
val &lt;- c(0.5, 0.5, 0.40)
dir &lt;- c("==","==","&gt;=")

mycop &lt;- cop(f  = quadfun(Q=myQ, d=0.001, name="Kinship", id=rownames(myQ)), 
             lb = lbcon(0,  id=phenotype$Indiv), 
             ub = ubcon(NA, id=phenotype$Indiv),
             lc = lincon(A=A, dir=dir, val=val, id=phenotype$Indiv))

res &lt;- solvecop(mycop, solver="cccp", quiet=FALSE)

validate(mycop, res)

#            valid solver  status
#             TRUE   cccp optimal
#
#   Variable     Value      Bound    OK?
#   -------------------------------------
#   Kinship      0.0322 min        :      
#   -------------------------------------
#   lower bounds all x  &gt;=  lb     : TRUE 
#   Sexfemale    0.5    ==  0.5    : TRUE 
#   Sexmale      0.5    ==  0.5    : TRUE 
#   BV           0.4    &gt;=  0.4    : TRUE 
#   -------------------------------------
</code></pre>

<hr>
<h2 id='ratiocon'>Rational Constraint</h2><span id='topic+ratiocon'></span>

<h3>Description</h3>

<p>Define a rational constraint of the form </p>
<p style="text-align: center;"><code class="reqn">\frac{x^T Q_1 x + a_1^T x + d_1}{x^T Q_2 x + a_2^T x + d_2} \leq val</code>
</p>



<h3>Usage</h3>

<pre><code class='language-R'>ratiocon(Q1, a1=rep(0, nrow(Q1)), d1=0, Q2, a2=rep(0, nrow(Q2)), d2=0, dir="&lt;=", val, 
   id=1:nrow(Q1), name="rational", use=TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ratiocon_+3A_q1">Q1</code></td>
<td>
<p>Numeric quadratic matrix.</p>
</td></tr>
<tr><td><code id="ratiocon_+3A_a1">a1</code></td>
<td>
<p>Numeric vector.</p>
</td></tr>
<tr><td><code id="ratiocon_+3A_d1">d1</code></td>
<td>
<p>Numeric value.</p>
</td></tr>
<tr><td><code id="ratiocon_+3A_q2">Q2</code></td>
<td>
<p>Numeric quadratic matrix.</p>
</td></tr>
<tr><td><code id="ratiocon_+3A_a2">a2</code></td>
<td>
<p>Numeric vector.</p>
</td></tr>
<tr><td><code id="ratiocon_+3A_d2">d2</code></td>
<td>
<p>Numeric value.</p>
</td></tr>
<tr><td><code id="ratiocon_+3A_dir">dir</code></td>
<td>
<p>Character string <code>"&lt;="</code>.</p>
</td></tr>
<tr><td><code id="ratiocon_+3A_val">val</code></td>
<td>
<p>Numeric threshold value, which is the upper bound for the rational function.</p>
</td></tr>
<tr><td><code id="ratiocon_+3A_id">id</code></td>
<td>
<p>Vector defining the names of the variables to which the constraint applies. Each variable name corresponds to one component of <code>x</code>. Variable names must be consistent across constraints.</p>
</td></tr>
<tr><td><code id="ratiocon_+3A_name">name</code></td>
<td>
<p>Name for the constraint.</p>
</td></tr>
<tr><td><code id="ratiocon_+3A_use">use</code></td>
<td>
<p>Logical value indicating if the constraint should be included in the optimization problem. If <code>use=FALSE</code>, then the constraint  does not affect the result, but the value of the rational function will be reported by function <a href="#topic+validate">validate</a>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Define a rational inequality constraint of the form </p>
<p style="text-align: center;"><code class="reqn">\frac{x^T Q_1 x + a_1^T x + d_1}{x^T Q_2 x + a_2^T x + d_2} \leq val.</code>
</p>

<p>Vector <code>x</code> contains only the variables included in argument <code>id</code>.
</p>
<p>For rational constraints it is required that there is a linear constraint ensuring that <code>sum(x)</code> is a constant. Furthermore, the denominator must be non-negative.
</p>


<h3>Value</h3>

<p>An object of class <code>ratioCon</code>.
</p>


<h3>See Also</h3>

<p>The main function for solving constrained programming problems is <code><a href="#topic+solvecop">solvecop</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
### Constrained optimization with rational objective                  ### 
### function and linear and quadratic constraints                     ###
### Example from animal breeding                                      ###
### The mean kinship at native alleles in the offspring is minimized  ###
### The mean breeding value and the mean kinship are constrained      ###

data(phenotype)
data(myQ)
data(myQ1)
data(myQ2)

A &lt;- t(model.matrix(~Sex+BV+MC-1, data=phenotype))
A[,1:5]
val &lt;- c(0.5,  0.5,  0.4,  0.5 )
dir &lt;- c("==", "==", "&gt;=", "&lt;=")

mycop &lt;- cop(f  = quadfun(Q=myQ, d=0.001, name="Kinship", id=rownames(myQ)),
             lb = lbcon(0,  id=phenotype$Indiv), 
             ub = ubcon(NA, id=phenotype$Indiv),
             lc = lincon(A=A, dir=dir, val=val, id=phenotype$Indiv),
             rc = ratiocon(Q1=myQ1, Q2=myQ2, d1=0.0004, d2=0.00025, val=0.040, 
                           id=rownames(myQ1), name="nativeKinship")
             )

res &lt;- solvecop(mycop, solver="slsqp", quiet=FALSE)

validate(mycop, res)

#            valid solver                status
#             TRUE  slsqp successful completion
#
#   Variable      Value      Bound    OK?
#   --------------------------------------
#   Kinship       0.0324 min        :      
#   --------------------------------------
#   lower bounds  all x  &gt;=  lb     : TRUE 
#   Sexfemale     0.5    ==  0.5    : TRUE 
#   Sexmale       0.5    ==  0.5    : TRUE 
#   BV            0.4    &gt;=  0.4    : TRUE 
#   MC            0.4668 &lt;=  0.5    : TRUE 
#   nativeKinship 0.04   &lt;=  0.04   : TRUE 
#   --------------------------------------

</code></pre>

<hr>
<h2 id='ratiofun'>Rational Objective Function</h2><span id='topic+ratiofun'></span>

<h3>Description</h3>

<p>Define a rational objective function of the form </p>
<p style="text-align: center;"><code class="reqn">f(x) = \frac{x^T Q_1 x + a_1 x + d_1}{x^T Q_2 x + a_2 x + d_2}</code>
</p>



<h3>Usage</h3>

<pre><code class='language-R'>ratiofun(Q1, a1=rep(0, nrow(Q1)), d1=0, Q2, a2=rep(0, nrow(Q2)), d2=0, 
   id=1:nrow(Q1), name="ratio.fun")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ratiofun_+3A_q1">Q1</code></td>
<td>
<p>Numeric quadratic matrix.</p>
</td></tr>
<tr><td><code id="ratiofun_+3A_a1">a1</code></td>
<td>
<p>Numeric vector.</p>
</td></tr>
<tr><td><code id="ratiofun_+3A_d1">d1</code></td>
<td>
<p>Numeric value.</p>
</td></tr>
<tr><td><code id="ratiofun_+3A_q2">Q2</code></td>
<td>
<p>Numeric quadratic matrix.</p>
</td></tr>
<tr><td><code id="ratiofun_+3A_a2">a2</code></td>
<td>
<p>Numeric vector.</p>
</td></tr>
<tr><td><code id="ratiofun_+3A_d2">d2</code></td>
<td>
<p>Numeric value.</p>
</td></tr>
<tr><td><code id="ratiofun_+3A_id">id</code></td>
<td>
<p>Vector defining the names of the variables to which the constraint applies. Each variable name corresponds to one component of <code>x</code>. Variable names must be consistent across constraints.</p>
</td></tr>
<tr><td><code id="ratiofun_+3A_name">name</code></td>
<td>
<p>Name for the constraint.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Define a rational ofjective function of the form </p>
<p style="text-align: center;"><code class="reqn">f(x) = \frac{x^T Q_1 x + a_1 x + d_1}{x^T Q_2 x + a_2 x + d_2}</code>
</p>

<p>Reasonable bounds for the variables should be provided because the function can have several local optima. Solvers <code>'slsqp'</code> (the default) and <code>'alabama'</code> are recommended.
</p>


<h3>Value</h3>

<p>An object of class <code>ratioFun</code>.
</p>


<h3>See Also</h3>

<p>The main function for solving constrained programming problems is <code><a href="#topic+solvecop">solvecop</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
### Constrained optimization with rational objective                  ### 
### function and linear and quadratic constraints                     ###
### Example from animal breeding                                      ###
### The mean kinship at native alleles in the offspring is minimized  ###
### The mean breeding value and the mean kinship are constrained      ###

data(phenotype)
data(myQ)
data(myQ1)
data(myQ2)

Ax &lt;- t(model.matrix(~Sex+BV+MC-1, data=phenotype))
Ax[,1:5]
val &lt;- c(0.5,  0.5,  0.4,  0.5 )
dir &lt;- c("==", "==", "&gt;=", "&lt;=")

mycop &lt;- cop(f  = ratiofun(Q1=myQ1, Q2=myQ2, d1=0.0004, d2=0.00025, 
                           id=rownames(myQ1), name="nativeKinship"),
             lb = lbcon(0,  id=phenotype$Indiv), 
             ub = ubcon(NA, id=phenotype$Indiv),
             lc = lincon(A=Ax, dir=dir, val=val, id=phenotype$Indiv),
             qc = quadcon(Q=myQ, d=0.001, val=0.035, 
                          name="Kinship", id=rownames(myQ)))

res &lt;- solvecop(mycop, quiet=FALSE)

validate(mycop, res)

#            valid solver                status
#             TRUE  slsqp successful completion
#
#   Variable      Value      Bound    OK?
#   --------------------------------------
#   nativeKinship 0.0366 min        :      
#   --------------------------------------
#   lower bounds  all x  &gt;=  lb     : TRUE 
#   Sexfemale     0.5    ==  0.5    : TRUE 
#   Sexmale       0.5    ==  0.5    : TRUE 
#   BV            0.4    &gt;=  0.4    : TRUE 
#   MC            0.4963 &lt;=  0.5    : TRUE 
#   Kinship       0.035  &lt;=  0.035  : TRUE 
#   --------------------------------------

</code></pre>

<hr>
<h2 id='solvecop'>Solve a Constrained Optimization Problem</h2><span id='topic+solvecop'></span>

<h3>Description</h3>

<p>Solve a constrained optimization problem with a linear, quadratic, or rational objective function, and linear, quadratic, rational, and boundary constraints.</p>


<h3>Usage</h3>

<pre><code class='language-R'>solvecop(op, solver="default", make.definite=FALSE, X=NULL, quiet=FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="solvecop_+3A_op">op</code></td>
<td>
<p>An optimization problem, usually created with function <a href="#topic+cop">cop</a>.</p>
</td></tr>
<tr><td><code id="solvecop_+3A_solver">solver</code></td>
<td>
<p>Character string with the name of the solver. Available solvers are <code>"alabama"</code>, <code>"cccp"</code>, <code>"cccp2"</code>, and <code>"slsqp"</code>. Solver <code>"csdp"</code> is temporarily disabled because the package Rcsdp has been removed from Cran. The default means that the solver is chosen automatically. The solvers are described in the Details section.
</p>
</td></tr>
<tr><td><code id="solvecop_+3A_make.definite">make.definite</code></td>
<td>
<p>Logical variable indicating whether non-positive-semidefinite matrices should be approximated by positive-definite matrices. This is always done for solvers that are known not to convergue otherwise.
</p>
</td></tr>
<tr><td><code id="solvecop_+3A_x">X</code></td>
<td>
<p>Starting vector of parameter values (not needed). Any initial vector, even those violating linear inequality constraints, may be specified. Ignored by solvers <code>"cccp"</code> and <code>"csdp"</code>. For <code>"slsqp"</code> the lower and upper bounds must not be violated.</p>
</td></tr>
<tr><td><code id="solvecop_+3A_quiet">quiet</code></td>
<td>
<p>Logical variable indicating whether output to console should be switched off.</p>
</td></tr>
<tr><td><code id="solvecop_+3A_...">...</code></td>
<td>
<p>Tuning parameters of the solver. The available parameters depend on the solver and will be printed when the function is used with <code>quiet=FALSE</code>. In section Details it is mentioned where descriptions of these parameters can be found.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Solve a constrained optimization problem with a linear, quadratic, or rational objective function, and linear, quadratic, rational, and boundary constraints.
</p>
<p><b>Solver</b>
</p>
<p><code>"alabama"</code>: The augmented lagrangian minimization algorithm <a href="alabama.html#topic+auglag">auglag</a> from package <code>alabama</code> is called.
The method combines the objective function and a penalty for each constraint  into a single function. This modified objective function is then passed to another optimization algorithm with no constraints. If the constraints are violated by the solution of this sub-problem, then the size of the penalties is increased and the process is repeated. The default methods for the uncontrained optimization in the inner loop is the quasi-Newton method called <code>BFGS</code>.
Tuning parameters used for the outer loop are described in the details section of the help page of function <a href="alabama.html#topic+auglag">auglag</a>. Tuning parameters used for the inner loop are described in the details section of the help page of function <a href="stats.html#topic+optim">optim</a>.
</p>
<p><code>"cccp"</code> and <code>"cccp2"</code>: Function <a href="cccp.html#topic+cccp">cccp</a> from package <code>cccp</code> for solving cone constrained convex programs is called. For solver <code>"cccp"</code>, quadratic constraints are converted into second order cone constraints, which requires to approximate non-positive-semidefinite matrices by positive-definite matrices. For solver <code>"cccp2"</code>, quadratic constraints are defined by functions. The implemented algorithms are partially ported from CVXOPT. Tuning parameters  are those from function <a href="cccp.html#topic+ctrl">ctrl</a>. 
</p>
<p><code>"slsqp"</code>: The sequential (least-squares) quadratic programming (SQP) algorithm <a href="nloptr.html#topic+slsqp">slsqp</a> for  gradient-based optimization from package <code>nloptr</code>. The algorithm optimizes successive second-order (quadratic/least-squares) approximations of the objective function, with first-order (affine) approximations of the constraints.  Available parameters are described in <a href="nloptr.html#topic+nl.opts">nl.opts</a>
</p>


<h3>Value</h3>

<p>A list with the following components:
</p>
<table role = "presentation">
<tr><td><code>x</code></td>
<td>
<p>Named numeric vector with parameters optimizing the objective function while satisfying constraints, if convergence is successful.</p>
</td></tr>
<tr><td><code>solver</code></td>
<td>
<p>Name of the solver used for optimization.</p>
</td></tr>
<tr><td><code>status</code></td>
<td>
<p>Message indicating type of convergence as reported by the solver.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Robin Wellmann</p>


<h3>Examples</h3>

<pre><code class='language-R'>
### Quadratic programming with linear constraints      ###
### Example from animal breeding                       ###
### where the mean kinship in the offspring is minized ###

data(phenotype)
data(myQ)

A   &lt;- t(model.matrix(~Sex+BV-1, data=phenotype))
rownames(A) &lt;- c("male.cont","female.cont", "Breeding.Value")
val &lt;- c(0.5, 0.5, 0.40)
dir &lt;- c("==","==","&gt;=")

mycop &lt;- cop(f  = quadfun(Q=myQ, d=0.001, name="Kinship", id=rownames(myQ)), 
             lb = lbcon(0,  id=phenotype$Indiv), 
             ub = ubcon(NA, id=phenotype$Indiv),
             lc = lincon(A=A, dir=dir, val=val, id=phenotype$Indiv))

res &lt;- solvecop(mycop, solver="cccp", quiet=FALSE, trace=FALSE)

head(res$x)

hist(res$x,breaks=50,xlim=c(0,0.5))

Evaluation &lt;- validate(mycop, res)

Evaluation$summary

Evaluation$info

Evaluation$obj.fun

Evaluation$var

Evaluation$var$Breeding.Value

</code></pre>

<hr>
<h2 id='ubcon'>Upper Bounds</h2><span id='topic+ubcon'></span>

<h3>Description</h3>

<p>Define upper bounds for the variables of the form </p>
<p style="text-align: center;"><code class="reqn">x &lt;= val.</code>
</p>
 


<h3>Usage</h3>

<pre><code class='language-R'>ubcon(val=numeric(0), id=seq_along(val))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ubcon_+3A_val">val</code></td>
<td>
<p>Numeric vector with upper bounds for the variables. If <code>val</code> is a single value, then this value will be used for all variables in vector <code>id</code>.</p>
</td></tr>
<tr><td><code id="ubcon_+3A_id">id</code></td>
<td>
<p>Vector defining the names of the variables to which the constraint applies. Each variable name corresponds to one component of <code>x</code>. Variable names must be consistent across constraints. 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Define upper bounds for the variables of the form </p>
<p style="text-align: center;"><code class="reqn">x &lt;= val.</code>
</p>
<p> Vector <code>x</code> contains only the variables included in argument <code>id</code>.
</p>


<h3>Value</h3>

<p>An object of class <code>ubCon</code>.
</p>


<h3>See Also</h3>

<p>The main function for solving constrained programming problems is <a href="#topic+solvecop">solvecop</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

### Linear programming with linear and quadratic constraints ###
### Example from animal breeding                             ###
### The mean breeding value BV is maximized whereas the      ###
### mean kinship in the offspring x'Qx+d is restricted       ###
### Lower and upper bounds for females are identical, so     ###
### their contributions are not optimized.                   ###
### Lower and upper bounds for some males are defined.       ###

data(phenotype)
data(myQ)

A   &lt;- t(model.matrix(~Sex-1, data=phenotype))
A[,1:5]
val &lt;- c(0.5,  0.5)
dir &lt;- c("==","==")
Nf  &lt;- sum(phenotype$Sex=="female")
id  &lt;- phenotype$Indiv

lbval &lt;- setNames(rep(0,  length(id)), id)
ubval &lt;- setNames(rep(NA, length(id)), id)
lbval[phenotype$Sex=="female"] &lt;- 1/(2*Nf)
ubval[phenotype$Sex=="female"] &lt;- 1/(2*Nf)
lbval["276000102379430"] &lt;- 0.02
ubval["276000121507437"] &lt;- 0.03

mycop &lt;- cop(f  = linfun(a=phenotype$BV, id=id, name="BV"),
             max= TRUE,
             lb = lbcon(lbval, id=id), 
             ub = ubcon(ubval, id=id),
             lc = lincon(A=A, dir=dir, val=val, id=id),
             qc = quadcon(Q=myQ, d=0.001, val=0.045, 
                          name="Kinship", id=rownames(myQ)))

res &lt;- solvecop(mycop, solver="cccp2", quiet=FALSE)

Evaluation &lt;- validate(mycop, res)

#            valid solver  status
#             TRUE  cccp2 optimal
#
#   Variable     Value      Bound    OK?
#   -------------------------------------
#   BV           0.5502 max        :      
#   -------------------------------------
#   lower bounds all x  &gt;=  lb     : TRUE 
#   upper bounds all x  &lt;=  ub     : TRUE 
#   Sexfemale    0.5    ==  0.5    : TRUE 
#   Sexmale      0.5    ==  0.5    : TRUE 
#   Kinship      0.045  &lt;=  0.045  : TRUE 
#   -------------------------------------

</code></pre>

<hr>
<h2 id='validate'>Validate a Solution</h2><span id='topic+validate'></span>

<h3>Description</h3>

<p>Validate a solution of an optimization problem. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>validate(op, sol, quiet=FALSE, tol=0.0001)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="validate_+3A_op">op</code></td>
<td>
<p>The constrained optimization problem defined with function <a href="#topic+cop">cop</a>.</p>
</td></tr>
<tr><td><code id="validate_+3A_sol">sol</code></td>
<td>
<p>The solution of the optimization problem obtained with function <a href="#topic+solvecop">solvecop</a>.</p>
</td></tr>
<tr><td><code id="validate_+3A_quiet">quiet</code></td>
<td>
<p>Logical variable indicating whether output to console should be switched off.</p>
</td></tr>
<tr><td><code id="validate_+3A_tol">tol</code></td>
<td>
<p>The tolerance. A constraint is considered fulfilled even if the value exceeds (falls below) the thresshold value by <code>tol</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Validate a solution of an optimization problem by checking if the constraints are fulfilled.
</p>
<p>Values and bounds of the constraints are printed.
</p>


<h3>Value</h3>

<p>A list of class <code>copValidation</code> with components:
</p>
<table role = "presentation">
<tr><td><code>summary</code></td>
<td>
<p>Data frame containing one row for each constraint with the value of the constraint in column <code>Val</code>, the bound for the constraint in column <code>Bound</code>, and column <code>OK</code> states if the constraint is fulfilled.  The value of the objective function is shown in the first row.  Additional rows contain the values of disabled constraints.</p>
</td></tr>
<tr><td><code>info</code></td>
<td>
<p>Data frame with component <code>valid</code> indicating if all constraints are fulfilled, component <code>solver</code> containing the name of the solver used for optimization, and component <code>status</code> describing the solution as reported by the solver.</p>
</td></tr>
<tr><td><code>var</code></td>
<td>
<p>Data frame with the values of the objective function and constraints at the optimum.</p>
</td></tr>
<tr><td><code>obj.fun</code></td>
<td>
<p>Named numeric value with value and name of the objective function at the optimum.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Robin Wellmann</p>


<h3>See Also</h3>

<p>The main function for solving constrained programming problems is <a href="#topic+solvecop">solvecop</a>.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
