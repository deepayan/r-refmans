<!DOCTYPE html><html lang="en"><head><title>Help for package RFplus</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {RFplus}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#BD_Insitu'>
<p>Precipitation Station Measurement Dataset</p></a></li>
<li><a href='#Cords_Insitu'>
<p>Precipitation Station Coordinates Dataset</p></a></li>
<li><a href='#RFplus'><p>Machine learning algorithm for fusing ground and satellite precipitation data.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Machine Learning for Merging Satellite and Ground Precipitation
Data</td>
</tr>
<tr>
<td>Version:</td>
<td>1.4-0</td>
</tr>
<tr>
<td>Date:</td>
<td>2025-03-15</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jonnathan Augusto Landi Bermeo &lt;jonnathan.landi@outlook.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>A machine learning algorithm that merges satellite and ground precipitation data using Random Forest for spatial prediction, residual modeling for bias correction, and quantile mapping for adjustment, ensuring accurate estimates across temporal scales and regions.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.4.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>terra, randomForest, data.table, pbapply, qmap, hydroGOF</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/Jonnathan-Landi/RFplus">https://github.com/Jonnathan-Landi/RFplus</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/Jonnathan-Landi/RFplus/issues">https://github.com/Jonnathan-Landi/RFplus/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-03-10 15:10:02 UTC</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat (&ge; 3.0.0), covr</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-03-10 14:54:04 UTC; Jonna</td>
</tr>
<tr>
<td>Author:</td>
<td>Jonnathan Augusto Landi Bermeo
    <a href="https://orcid.org/0009-0003-3162-6647"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut, cre,
    cph],
  Alex Avilés <a href="https://orcid.org/0000-0001-9278-5738"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Darío Zhiña <a href="https://orcid.org/0000-0001-9556-4025"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Marco Mogro <a href="https://orcid.org/0009-0007-1802-9417"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Anthony Guamán <a href="https://orcid.org/0009-0005-0204-7536"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut]</td>
</tr>
</table>
<hr>
<h2 id='BD_Insitu'>
Precipitation Station Measurement Dataset
</h2><span id='topic+BD_Insitu'></span>

<h3>Description</h3>

<p>This dataset contains daily measurements from several precipitation stations. The first column represents the measurement date, and the following columns correspond to the measurements from each station on that date. The station columns are labeled with unique identifiers for each station, and the number of stations may vary depending on the dataset configuration.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("BD_Insitu")</code></pre>


<h3>Format</h3>

<p>A 'data.table' object with station measurements. The dataset includes the following columns:
</p>

<dl>
<dt><code>Date</code></dt><dd><p>The measurement date (type <code>Date</code>).</p>
</dd>
<dt><code>Station_ID_1, Station_ID_2, ...</code></dt><dd><p>Measurements from the stations (numeric values). Each column after <code>Date</code> represents the measurements of a precipitation station for the corresponding date. The columns are labeled with unique identifiers (e.g., <code>Station_ID_1</code>, <code>Station_ID_2</code>, etc.) for each station, and the number of stations (columns) may vary.</p>
</dd>
</dl>



<h3>Details</h3>

<p>The data represents daily measurements taken from several precipitation stations. The first column contains the measurement dates, and the following columns represent the measurements of each station on those dates. The number of stations may vary depending on the dataset, and each station is uniquely identified by its column name (e.g., <code>Station_ID_1</code>, <code>Station_ID_2</code>, etc.).
</p>


<h3>Source</h3>

<p>The data was generated for use in the bias correction model for satellite products, RFplus.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(BD_Insitu)
## You can use str(BD_Insitu) to get a description of the structure
## or view some of the first rows using head(BD_Insitu)
</code></pre>

<hr>
<h2 id='Cords_Insitu'>
Precipitation Station Coordinates Dataset
</h2><span id='topic+Cords_Insitu'></span>

<h3>Description</h3>

<p>This dataset contains the coordinates (in UTM format) of several precipitation stations. Each station is uniquely identified by the <code>Cod</code> column, which corresponds to the station identifiers used in the <code>BD_Insitu</code> dataset. The coordinates of each station are provided in two columns: <code>X</code> for the Easting (longitude) and <code>Y</code> for the Northing (latitude).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("Cords_Insitu")</code></pre>


<h3>Format</h3>

<p>A 'data.table' object with station coordinates. The dataset includes the following columns:
</p>

<dl>
<dt><code>Cod</code></dt><dd><p>The unique identifier for each station. This should correspond to the station columns in the <code>BD_Insitu</code> dataset.</p>
</dd>
<dt><code>X</code></dt><dd><p>The Easting (X-coordinate) of the station in UTM format (numeric).</p>
</dd>
<dt><code>Y</code></dt><dd><p>The Northing (Y-coordinate) of the station in UTM format (numeric).</p>
</dd>
</dl>



<h3>Details</h3>

<p>The data represents the geographic coordinates of precipitation stations used in the analysis. The first column, <code>Cod</code>, contains the unique identifiers of the stations, which should match the column names in the <code>BD_Insitu</code> dataset. The subsequent columns, <code>X</code> and <code>Y</code>, contain the UTM coordinates for each station, representing the station's location on the Earth's surface.
</p>


<h3>Source</h3>

<p>The data was generated for use in the bias correction model for satellite products, RFplus.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Cords_Insitu)
## You can use str(Cords_Insitu) to get a description of the structure
## or view some of the first rows using head(Cords_Insitu)
</code></pre>

<hr>
<h2 id='RFplus'>Machine learning algorithm for fusing ground and satellite precipitation data.</h2><span id='topic+RFplus'></span><span id='topic+RFplus.default'></span><span id='topic+RFplus.data.table'></span>

<h3>Description</h3>

<p>MS-GOP is a machine learning algorithm for merging satellite-based and ground precipitation data.
It combines Random Forest for spatial prediction, residual modeling for bias correction, and quantile mapping for final adjustment, ensuring accurate precipitation estimates across different temporal scales
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RFplus(BD_Insitu, Cords_Insitu, Covariates, ...)

## Default S3 method:
RFplus(
  BD_Insitu,
  Cords_Insitu,
  Covariates,
  n_round = NULL,
  wet.day = FALSE,
  ntree = 2000,
  seed = 123,
  training = 1,
  Rain_threshold = list(no_rain = c(0, 1)),
  method = c("RQUANT", "QUANT", "none"),
  ratio = 15,
  save_model = FALSE,
  name_save = NULL,
  ...
)

## S3 method for class 'data.table'
RFplus(
  BD_Insitu,
  Cords_Insitu,
  Covariates,
  n_round = NULL,
  wet.day = FALSE,
  ntree = 2000,
  seed = 123,
  training = 1,
  Rain_threshold = list(no_rain = c(0, 1)),
  method = c("RQUANT", "QUANT", "none"),
  ratio = 15,
  save_model = FALSE,
  name_save = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RFplus_+3A_bd_insitu">BD_Insitu</code></td>
<td>
<p>'data.table' containing the ground truth measurements (dependent variable) used to train the RFplus model.
Each column represents a ground station, and station identifiers are stored as column names. The class of 'BD_Insitu'
must be 'data.table'. Each row represents a time step with measurements of the corresponding station.</p>
</td></tr>
<tr><td><code id="RFplus_+3A_cords_insitu">Cords_Insitu</code></td>
<td>
<p>'data.table' containing metadata for the ground stations. Must include the following columns:
- 'Cod': Unique identifier for each ground station.
- 'X': Latitude of the station in UTM format.
- 'Y': Longitude of the station in UTM format.</p>
</td></tr>
<tr><td><code id="RFplus_+3A_covariates">Covariates</code></td>
<td>
<p>A list of covariates used as independent variables in the RFplus model. Each covariate should be a
'SpatRaster' object (from the 'terra' package) and can represent satellite-derived weather variables or a Digital
Elevation Model (DEM). All covariates should have the same number of layers (bands), except for the DEM, which must have only one layer.</p>
</td></tr>
<tr><td><code id="RFplus_+3A_...">...</code></td>
<td>
<p>Additional arguments to pass to the underlying methods (e.g., for model tuning or future extensions).</p>
</td></tr>
<tr><td><code id="RFplus_+3A_n_round">n_round</code></td>
<td>
<p>Numeric indicating the number of decimal places to round the corrected values. If 'n_round' is set to 'NULL', no rounding is applied.</p>
</td></tr>
<tr><td><code id="RFplus_+3A_wet.day">wet.day</code></td>
<td>
<p>Numeric value indicating the threshold for wet day correction. Values below this threshold will be set to zero.
- 'wet.day = FALSE': No correction is applied (default).
- For wet day correction, provide a numeric threshold (e.g., 'wet.day = 0.1').</p>
</td></tr>
<tr><td><code id="RFplus_+3A_ntree">ntree</code></td>
<td>
<p>Numeric indicating the maximum number trees to grow in the Random Forest algorithm. The default value is set to 2000. This should not be set to too small a number, to ensure that every input row gets predicted at least a few times. If this value is too low, the prediction may be biased.</p>
</td></tr>
<tr><td><code id="RFplus_+3A_seed">seed</code></td>
<td>
<p>Integer for setting the random seed to ensure reproducibility of results (default: 123).</p>
</td></tr>
<tr><td><code id="RFplus_+3A_training">training</code></td>
<td>
<p>Numerical value between 0 and 1 indicating the proportion of data used for model training. The remaining data are used for validation. Note that if you enter, for example, 0.8 it means that 80 
If you do not want to perform validation, set training = 1. (Default training = 1).</p>
</td></tr>
<tr><td><code id="RFplus_+3A_rain_threshold">Rain_threshold</code></td>
<td>
<p>A list of numeric vectors that define the precipitation thresholds for classifying rainfall events into different categories based on intensity.
Each element of the list should represent a category, with the category name as the list element's name and a numeric vector specifying the lower and upper bounds for that category.
</p>
<p><strong>Note:</strong> See the &quot;Notes&quot; section for additional details on how to define categories, use this parameter for validation, and example configurations.</p>
</td></tr>
<tr><td><code id="RFplus_+3A_method">method</code></td>
<td>
<p>A character string specifying the quantile mapping method used for distribution adjustment. Options are:
</p>
<p>- <code>"RQUANT"</code>:
Robust quantile mapping to adjust satellite data distribution to observed data.
</p>
<p>- <code>"QUANT"</code>:
Standard quantile mapping.
</p>
<p>- <code>"none"</code>:
No distribution adjustment is applied. Only Random Forest-based bias correction and residual correction are performed.</p>
</td></tr>
<tr><td><code id="RFplus_+3A_ratio">ratio</code></td>
<td>
<p>integer Maximum search radius (in kilometers) for the quantile mapping setting using the nearest station. (default = 15 km)</p>
</td></tr>
<tr><td><code id="RFplus_+3A_save_model">save_model</code></td>
<td>
<p>Logical value indicating whether the corrected raster layers should be saved to disk. The default is 'FALSE'.
If set to 'TRUE', make sure to set the working directory beforehand using 'setwd(path)' to specify where the files should be saved.</p>
</td></tr>
<tr><td><code id="RFplus_+3A_name_save">name_save</code></td>
<td>
<p>Character string. Base name for output file (default: NULL). The output file will be saved as &quot;Model_RFplus.nc&quot;.
If you set a different name, make sure you do not set the &quot;.nc&quot; format,
as the code will internally assign it.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The 'RFplus' method implements a three-step approach:
</p>
<p>- <strong>Base Prediction</strong>:
Random Forest model is trained using satellite data and covariates.
</p>
<p>- <strong>Residual Correction</strong>:
A second Random Forest model is used to correct the residuals from the base prediction.
</p>
<p>- <strong>Distribution Adjustment</strong>:
Quantile mapping (QUANT or RQUANT) is applied to adjust the distribution of satellite data to match the observed data distribution.
</p>
<p>The final result combines all three steps, correcting the biases while preserving the outliers, and improving the accuracy of satellite-derived data such as precipitation and temperature.
</p>


<h3>Value</h3>

<p>A list containing two elements:
</p>
<p><strong>Ensamble:</strong>
A 'SpatRaster' object containing the bias-corrected layers for each time step. The number of layers
corresponds to the number of dates for which the correction is applied. This represents the corrected satellite data adjusted for bias.
</p>
<p><strong>Validation:</strong>
A list containing the statistical results obtained from the validation process. This list includes:
</p>
<p>- <code>gof</code>:
A data table with goodness-of-fit metrics such as Kling-Gupta Efficiency (KGE), Nash-Sutcliffe Efficiency (NSE), Percent Bias (PBIAS), Root Mean Square Error (RMSE), and Pearson Correlation Coefficient (CC). These metrics assess the overall performance of the bias correction process.
</p>
<p>- <code>categorical_metrics</code>:
A data frame containing categorical evaluation metrics such as Probability of Detection (POD), Success Ratio (SR), False Alarm Rate (FAR), Critical Success Index (CSI), and Hit Bias (HB). These metrics evaluate the classification performance of rainfall event predictions based on user-defined precipitation thresholds.
</p>


<h3>Notes</h3>

<p>The 'Rain_threshold' parameter is used to classify precipitation events based on intensity into different categories. For example:
</p>
<p><code>Rain_threshold = list(
  no_rain = c(0, 1),
  light_rain = c(1, 5),
  moderate_rain = c(5, 20),
  heavy_rain = c(20, 40),
  violent_rain = c(40, 100)
)</code>
</p>
<p>Precipitation values will be classified into these categories based on their intensity.
Users can define as many categories as necessary, or just two (e.g., &quot;rain&quot; vs. &quot;no rain&quot;).
</p>
<p>This parameter is required only when 'training' is not equal to 1, as it is needed to calculate performance metrics such as the Probability of Detection (POD), False Alarm Rate (FAR), and Critical Success Index (CSI).
</p>


<h3>Author(s)</h3>

<p>Jonnathan Augusto landi Bermeo, jonnathan.landi@outlook.com
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load the libraries
library(terra)
library(data.table)

# Load the data
 data("BD_Insitu", package = "RFplus")
 data("Cords_Insitu", package = "RFplus")

# Load the covariates
Covariates &lt;- list(
 MSWEP = terra::rast(system.file("extdata/MSWEP.nc", package = "RFplus")),
 CHIRPS = terra::rast(system.file("extdata/CHIRPS.nc", package = "RFplus")),
 DEM = terra::rast(system.file("extdata/DEM.nc", package = "RFplus"))
 )

 # Apply the RFplus bias correction model
model = RFplus(BD_Insitu, Cords_Insitu, Covariates, n_round = 1, wet.day = 0.1,
        ntree = 2000, seed = 123, training = 1, Rain_threshold = 0.1, method = "RQUANT",
        ratio = 5, save_model = FALSE, name_save = NULL)
# Visualize the results
# Precipitation results within the study area
modelo_rainfall = model$Ensamble
# Validation statistic results
# goodness-of-fit metrics
metrics_gof = model$Validation$gof

# categorical metrics
metrics_cat = model$Validation$categorical_metrics
# Note: In the above example we used 80% of the data for training and 20% for # model validation.


</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
