<!DOCTYPE html><html lang="en"><head><title>Help for package shelter</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {shelter}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#key_delete'><p>Delete a key from a keyring</p></a></li>
<li><a href='#key_exists'><p>Does a given key exist in a keyring</p></a></li>
<li><a href='#key_get'><p>Get a secret from a keyring.</p></a></li>
<li><a href='#key_list'><p>Returns vector of keys in a keyring.</p></a></li>
<li><a href='#key_set'><p>Set a key secret in a keyring</p></a></li>
<li><a href='#keyring_create'><p>Create a new empty keyring.</p></a></li>
<li><a href='#keyring_delete'><p>Delete a given keyring</p></a></li>
<li><a href='#keyring_exists'><p>Check if a keyring exists.</p></a></li>
<li><a href='#keyring_list'><p>Provides a 'data.frame' of information on available keyrings.</p></a></li>
<li><a href='#keyring_lock'><p>Locks a given keyring</p></a></li>
<li><a href='#keyring_locked'><p>Is a keyring unlocked for key operations and reading</p></a></li>
<li><a href='#keyring_unlock'><p>Unlock a keyring.</p></a></li>
<li><a href='#unlockKeys'><p>Open an API key and use it build a connection.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Support for Secure API Key Management</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.1</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Shawn Garbett &lt;Shawn.Garbett@vumc.org&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Secure handling of API keys can be difficult. This package provides
    secure convenience functions for 
    entering / handling API keys and opening connections via inversion of control
    on those keys. Works seamlessly between production and developer environments.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.1.0)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Imports:</td>
<td>checkmate, getPass, yaml, filelock, rappdirs, sodium</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 3.0.0), rstudioapi, mockery</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/vubiostat/shelter">https://github.com/vubiostat/shelter</a></td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/vubiostat/shelter/issues">https://github.com/vubiostat/shelter/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-11-05 21:06:37 UTC; garbetsp</td>
</tr>
<tr>
<td>Author:</td>
<td>Benjamin Nutter [ctb, aut],
  Shawn Garbett <a href="https://orcid.org/0000-0003-4079-5621"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [cre, ctb],
  Hui Wu [aut],
  Cole Beck [aut],
  Savannah Obregon [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-11-07 18:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='key_delete'>Delete a key from a keyring</h2><span id='topic+key_delete'></span>

<h3>Description</h3>

<p>Delete a key from an unlocked keyring.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>key_delete(keyring, key)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="key_delete_+3A_keyring">keyring</code></td>
<td>
<p>character(1); Name of keyring</p>
</td></tr>
<tr><td><code id="key_delete_+3A_key">key</code></td>
<td>
<p>character(1); Name of key</p>
</td></tr>
</table>


<h3>Value</h3>

<p>logical(1); Success of operation
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
key_delete('mypersonalkeyring', 'key1')

## End(Not run)

</code></pre>

<hr>
<h2 id='key_exists'>Does a given key exist in a keyring</h2><span id='topic+key_exists'></span>

<h3>Description</h3>

<p>In an unlocked keyring return if a key exists.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>key_exists(keyring, key)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="key_exists_+3A_keyring">keyring</code></td>
<td>
<p>character(1); Name of keyring</p>
</td></tr>
<tr><td><code id="key_exists_+3A_key">key</code></td>
<td>
<p>character(1); Name of key</p>
</td></tr>
</table>


<h3>Value</h3>

<p>logical(1); Existance of key in keyring
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
key_exists('mypersonalkeyring', 'key1')

## End(Not run)
</code></pre>

<hr>
<h2 id='key_get'>Get a secret from a keyring.</h2><span id='topic+key_get'></span>

<h3>Description</h3>

<p>Get a secret from an unlocked keyring given it's key.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>key_get(keyring, key)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="key_get_+3A_keyring">keyring</code></td>
<td>
<p>character(1); Name of keyring</p>
</td></tr>
<tr><td><code id="key_get_+3A_key">key</code></td>
<td>
<p>character(1); Name of key</p>
</td></tr>
</table>


<h3>Value</h3>

<p>character(1); The requested secret
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
key_get('mypersonalkeyring', 'key1')

## End(Not run)

</code></pre>

<hr>
<h2 id='key_list'>Returns vector of keys in a keyring.</h2><span id='topic+key_list'></span>

<h3>Description</h3>

<p>Return vector key names in a keyring that is unlocked.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>key_list(keyring)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="key_list_+3A_keyring">keyring</code></td>
<td>
<p>character(1); Name of keyring</p>
</td></tr>
</table>


<h3>Value</h3>

<p>character; Key names
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
key_list('mypersonalkeyring')

## End(Not run)
</code></pre>

<hr>
<h2 id='key_set'>Set a key secret in a keyring</h2><span id='topic+key_set'></span>

<h3>Description</h3>

<p>Sets a key secret in a keyring
</p>


<h3>Usage</h3>

<pre><code class='language-R'>key_set(keyring, key, secret)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="key_set_+3A_keyring">keyring</code></td>
<td>
<p>character(1); Name of keyring</p>
</td></tr>
<tr><td><code id="key_set_+3A_key">key</code></td>
<td>
<p>character(1); Name of key to store in keyring</p>
</td></tr>
<tr><td><code id="key_set_+3A_secret">secret</code></td>
<td>
<p>character(1); The secret to store in keyring</p>
</td></tr>
</table>


<h3>Value</h3>

<p>logical(1); Status of operation
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
key_set('mypersonalkeyring','key1','a secret')

## End(Not run)
</code></pre>

<hr>
<h2 id='keyring_create'>Create a new empty keyring.</h2><span id='topic+keyring_create'></span>

<h3>Description</h3>

<p>Create a new empty keyring with of a given name with the specified password.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>keyring_create(keyring, password)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="keyring_create_+3A_keyring">keyring</code></td>
<td>
<p>character(1); Name of keyring</p>
</td></tr>
<tr><td><code id="keyring_create_+3A_password">password</code></td>
<td>
<p>character(1); Password for keyring</p>
</td></tr>
</table>


<h3>Value</h3>

<p>logical(1); Success or failure of operation
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
keyring_create('mypersonalkeyring', '&lt;PASSWORD&gt;')

## End(Not run)

</code></pre>

<hr>
<h2 id='keyring_delete'>Delete a given keyring</h2><span id='topic+keyring_delete'></span>

<h3>Description</h3>

<p>Given the name of a keyring, delete it and remove all cached information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>keyring_delete(keyring)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="keyring_delete_+3A_keyring">keyring</code></td>
<td>
<p>character(1); Name of keyring</p>
</td></tr>
</table>


<h3>Value</h3>

<p>logical(1); Success or failure of operation
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
keyring_delete('mypersonalkeyring')

## End(Not run)

</code></pre>

<hr>
<h2 id='keyring_exists'>Check if a keyring exists.</h2><span id='topic+keyring_exists'></span>

<h3>Description</h3>

<p>Given a keyring name will check if the keyring file exists.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>keyring_exists(keyring)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="keyring_exists_+3A_keyring">keyring</code></td>
<td>
<p>character(1); Name of the keyring.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>logical(1); Keyring file store existence status.
</p>

<hr>
<h2 id='keyring_list'>Provides a 'data.frame' of information on available keyrings.</h2><span id='topic+keyring_list'></span>

<h3>Description</h3>

<p>Looks in a local directory where keyrings are stored for the
current user and returns information about keyrings found.
Keyrings are stored in 'rappdirs::user_config_dir(&quot;r-shelter&quot;)'
and end in '.keyring.RDS'
</p>


<h3>Usage</h3>

<pre><code class='language-R'>keyring_list()
</code></pre>


<h3>Value</h3>

<p>data.frame of (keyring, secrets, locked)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>keyring_list()

</code></pre>

<hr>
<h2 id='keyring_lock'>Locks a given keyring</h2><span id='topic+keyring_lock'></span>

<h3>Description</h3>

<p>Given the name of a keyring lock it.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>keyring_lock(keyring)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="keyring_lock_+3A_keyring">keyring</code></td>
<td>
<p>character(1); Name of keyring</p>
</td></tr>
</table>


<h3>Value</h3>

<p>logical(1); Success or failure of operation
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
keyring_lock('mypersonalkeyring')

## End(Not run)

</code></pre>

<hr>
<h2 id='keyring_locked'>Is a keyring unlocked for key operations and reading</h2><span id='topic+keyring_locked'></span>

<h3>Description</h3>

<p>Query if a keyring is unlocked
</p>


<h3>Usage</h3>

<pre><code class='language-R'>keyring_locked(keyring)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="keyring_locked_+3A_keyring">keyring</code></td>
<td>
<p>character(1); Name of keyring</p>
</td></tr>
</table>


<h3>Value</h3>

<p>logical(1); Success or failure of operation
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
keyring_locked('mypersonalkeyring')

## End(Not run)

</code></pre>

<hr>
<h2 id='keyring_unlock'>Unlock a keyring.</h2><span id='topic+keyring_unlock'></span>

<h3>Description</h3>

<p>Unlock a given keyring using the specified password. Secrets exist
in plain text in memory while a keyring is unlocked.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>keyring_unlock(keyring, password)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="keyring_unlock_+3A_keyring">keyring</code></td>
<td>
<p>character(1); Name of keyring</p>
</td></tr>
<tr><td><code id="keyring_unlock_+3A_password">password</code></td>
<td>
<p>character(1); Password for keyring</p>
</td></tr>
</table>


<h3>Value</h3>

<p>logical(1); Success or failure of operation
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: keyring_unlock('mypersonalkeyring', '&lt;PASSWORD&gt;')

</code></pre>

<hr>
<h2 id='unlockKeys'>Open an API key and use it build a connection.</h2><span id='topic+unlockKeys'></span>

<h3>Description</h3>

<p>Opens a set of connections  from API keys stored in an encrypted keyring.
If the keyring does not exist, it will ask for password to this keyring to use on
later requests. Next it
will ask for the API keyss specified in 'connections'. If an API key does not
work, it will request again. On later executions it will use an open keyring
to retrieve all API_KEYs or for a password if the keyring is currently
locked.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>unlockKeys(
  connections,
  keyring,
  connectFUN = NULL,
  envir = NULL,
  passwordFUN = .default_pass(),
  service = "shelter",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="unlockKeys_+3A_connections">connections</code></td>
<td>
<p>character vector. A list of strings that define the
connections with associated API_KEYs to load into environment. Each
name should correspond to a REDCap project for traceability, but
it can be named anything one desires.
The name in the returned list is this name.</p>
</td></tr>
<tr><td><code id="unlockKeys_+3A_keyring">keyring</code></td>
<td>
<p>character. Potential keyring, not used by default.</p>
</td></tr>
<tr><td><code id="unlockKeys_+3A_connectfun">connectFUN</code></td>
<td>
<p>function or list(function). A function that takes a key and returns a connection.
the function should call 'stop' if the key is invalid in some manner. The
first argument of the function is the API key. The validation of the
key via a connection test is important for the full user interaction
algorithm to work properly. If one wished to just retrieve an API key
and not test the connection this would work 'function(x, ...) x', but
be aware that if the key is invalid it will not query the user as
the validity is not tested.</p>
</td></tr>
<tr><td><code id="unlockKeys_+3A_envir">envir</code></td>
<td>
<p>environment. The target environment for the connections. Defaults to NULL
which returns the keys as a list. Use [globalenv()] to assign in the
global environment. Will accept a number such a '1' for global as well.</p>
</td></tr>
<tr><td><code id="unlockKeys_+3A_passwordfun">passwordFUN</code></td>
<td>
<p>function. Function to get the password for the keyring. Usually defaults 'getPass::getPass'.
On MacOS it will use rstudioapi::askForPassword if available.</p>
</td></tr>
<tr><td><code id="unlockKeys_+3A_service">service</code></td>
<td>
<p>character(1). The keyring service. Defaults to package name.</p>
</td></tr>
<tr><td><code id="unlockKeys_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to 'connectFUN()'.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If one forgets the password to this keyring, or wishes to start over:
'keyring_delete(&quot;&lt;NAME_OF_KEY_RING_HERE&gt;&quot;)'
</p>
<p>For production servers where the password must be stored in a readable
plain text file, it will search for '../&lt;basename&gt;.yml'. DO NOT USE
this unless one is a sysadmin on a production hardened system, as this defeats the security and purpose of
a local encrypted file. The expected structure of this yaml file is
as follows:
</p>
<pre>
other-config-stuff1: blah blah
shelter:
  keys:
    intake: THIS_IS_THE_INTAKE_DATABASE_APIKEY
    details: THIS_IS_THE_DETAILS_DATABASE_APIKEY
other-config-stuff2: blah blah
other-config-stuff3: blah blah
</pre>
<p>For production servers the use of ENV variables is also supported. The connection
string is converted to upper case for the search of ENV. If a YAML file
and ENV definitions both exist, the YAML will take precedence.
</p>
<p>IMPORTANT: Make sure that R is set to NEVER save workspace to .RData
as this *is* writing the API_KEY to a local file in clear text because
connection objects contain the unlocked key in memory. One can use the
following in .Rprofile, 'usethis::edit_r_profile()':
</p>
<pre>
newfun &lt;- function (save = "no", status = 0, runLast = TRUE)
  .Internal(quit(save, status, runLast))
pkg &lt;- 'base'
oldfun &lt;- 'q'
pkgenv &lt;- as.environment(paste0("package:", pkg))
unlockBinding(oldfun, pkgenv)
utils::assignInNamespace(oldfun, newfun, ns = pkg, envir = pkgenv)
assign(oldfun, newfun, pkgenv)
lockBinding(oldfun, pkgenv)
</pre>


<h3>Value</h3>

<p>If 'envir' is NULL returns a list of opened connections. Otherwise
connections are assigned into the specified 'envir'.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
unlockKeys(c(test_conn    = 'Testshelter',
             sandbox_conn = 'SandboxAPI'),
             keyring      = '&lt;NAME_OF_KEY_RING_HERE&gt;',
             envir        = globalenv(),
             passwordFUN  = function(x, ...) x)

## End(Not run)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
