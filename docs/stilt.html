<!DOCTYPE html><html lang="en"><head><title>Help for package stilt</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {stilt}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#stilt-package'>
<p>Separable Gaussian Process Emulator</p></a></li>
<li><a href='#Data.1D.model'>
<p>Synthetic model output for a simple 1-parameter ensemble example</p></a></li>
<li><a href='#Data.1D.par'>
<p>Parameter settings for 1-parameter ensemble model output in Data.1D.model</p></a></li>
<li><a href='#Data.AR1Korea.model'>
<p>Korean modelled temperature variability and future change</p></a></li>
<li><a href='#Data.AR1Korea.par'>
<p>Korean temperature variability parameters</p></a></li>
<li><a href='#Data.Sicopolis.model'>
<p>SICOPOLIS model ensemble output</p></a></li>
<li><a href='#Data.Sicopolis.par'>
<p>SICOPOLIS model ensemble parameter settings</p></a></li>
<li><a href='#Data.UVic.model'>
<p>UVic ESCM climate model ensemble output</p></a></li>
<li><a href='#Data.UVic.par'>
<p>UVic ESCM climate model ensemble parameter settings</p></a></li>
<li><a href='#emul.1D'>
<p>Emulator of model for the 1-parameter example</p></a></li>
<li><a href='#emul.predict'>
<p>To predict using an emulator (Deprecated)</p></a></li>
<li><a href='#emul.Sicopolis'>
<p>SICOPOLIS ice sheet model emulator</p></a></li>
<li><a href='#emulator'>
<p>Function to fit an emulator to ensemble model output</p></a></li>
<li><a href='#predict.emul'>
<p>Predict Method for an Emulator</p></a></li>
<li><a href='#rsurface.plot'>
<p>To produce a response surface plot of the emulator</p></a></li>
<li><a href='#sep.cov'>
<p>Construct time and parameter covariance matrices</p></a></li>
<li><a href='#stilt-internal'><p>Internal Stilt Functions</p></a></li>
<li><a href='#test.all'>
<p>To test an emulator using leave-one-out cross-validation</p></a></li>
<li><a href='#test.csv'>
<p>To cross-validate a Gaussian Process emulator</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Separable Gaussian Process Interpolation (Emulation)</td>
</tr>
<tr>
<td>Version:</td>
<td>1.3.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2018-08-15</td>
</tr>
<tr>
<td>Author:</td>
<td>Roman Olson, Won Chang, Klaus Keller, and Murali Haran </td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Kelsey Ruckert &lt;datamgmt@scrim.psu.edu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Functions for simplified emulation of time series computer model output in model parameter space using Gaussian processes. Stilt can be used more generally for Kriging of spatio-temporal fields. There are functions to predict at new parameter settings, to test the emulator using cross-validation (which includes information on 95% confidence interval empirical coverage), and to produce contour plots over 2D slices in model parameter space.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.2.4)</td>
</tr>
<tr>
<td>Imports:</td>
<td>fields</td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2018-08-15 13:39:02 UTC; klr324</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2018-08-15 15:20:02 UTC</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>6.0.1</td>
</tr>
</table>
<hr>
<h2 id='stilt-package'>
Separable Gaussian Process Emulator
</h2><span id='topic+stilt-package'></span><span id='topic+stilt'></span>

<h3>Description</h3>

<p>'Stilt' is used for interpolating multivariate data in multivariate
space. It is tailored to the case of interpolating (&quot;emulating&quot;) regularly
spaced time-series of computer model output between the model input
parameters, but can be also used more broadly (e.g., for output in the form of
regularly-spaced spatial 1D transects, or for interpolating time-series
between locations on the Earth's surface). The interpolation technique
relies on a separable Gaussian Process emulator. Package consists of functions to
fit the Gaussian Process emulator, to interpolate to (predict at) a
given model input setting, and to validate the emulator using
cross-validation. In addition, a function is provided to plot model
response surface as generated by the emulator as a function of two model
parameters. The package works both on one and multi-parameter ensembles,
with an exception of the 'rsurface.plot' function, which by definition is
restricted to 2+ parameter ensembles. The emulator is restricted to
multivariate model output and is not designed to work on interpolating a
single scalar.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> stilt</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.3.0</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2017-08-15</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL-3</td>
</tr>
<tr>
 <td style="text-align: left;">
LazyLoad: </td><td style="text-align: left;"> no</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Disclaimer</h3>

<p>This package is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details. In addition, the authors
maintain no responsibility for any possible code errors or bugs.</p>


<h3>Summary of main functions</h3>


<dl>
<dt>emulator</dt><dd><p>Fits a separable Gaussian Process emulator to ensemble model
output</p>
</dd>
<dt>predict.emul</dt><dd><p>Predicts using a Gaussian Process emulator</p>
</dd>
<dt>rsurface.plot</dt><dd><p>Plots a 2D model response surface</p>
</dd>
<dt>test.csv</dt><dd><p>Cross-validates an emulator by removing one or many
model runs, training the emulator on the remaining runs, and then
predicting at the withheld model runs</p>
</dd>
<dt>test.all</dt><dd><p>Tests an emulator using leave-one-out cross validation</p>
</dd>
<dt>sep.cov</dt><dd><p>Constructs time and parameter covariance matrices</p>
</dd>
</dl>



<h3>Summary of datasets</h3>


<dl>
<dt>Data.1D.model and Data.1D.par</dt><dd><p>Model output and parameter
settings for a simple 1-parameter ensemble example</p>
</dd>
<dt>emul.1D</dt><dd><p>Gaussian Process emulator that has been fit to the
aforementioned model ensemble output</p>
</dd>
<dt>Data.AR1.Korea.model and Data.AR1.Korea.par</dt><dd><p>Temperature variability and
future change for 29 CMIP5 global climate models</p>
</dd>
<dt>Data.UVic.model and Data.UVic.par</dt><dd><p>Model output and parameter
settings for temperature anomaly output from 3-parameter ensemble of
climate model UVic ESCM</p>
</dd>
<dt>Data.Sicopolis.model and Data.Sicopolis.par</dt><dd><p>Model output and
parameter settings for ice mass loss output from a 5-parameter
ensemble of ice sheet model SICOPOLIS</p>
</dd>
<dt>emul.Sicopolis</dt><dd><p>A Gaussian Process emulator that has been fit
to the SICOPOLIS ensemble output</p>
</dd>
</dl>



<h3>Limitations and Caveats</h3>


<ol>
<li><p> The emulator (like any other available software packages)
will not work well for 'jagged' model response
surfaces (high nugget): predictive uncertainty will be too high. 
</p>
</li>
<li><p> The emulator is restricted to output at regular intervals in
time and space
</p>
</li>
<li><p> The code has not been tested under conditions of extreme high
/ extreme low input parameter range, output time(space) coordinates
range, and output range (an example would be model output ranging
from -1E20 to 1E20, etc.). In such cases it is recommended to
re-scale the time(space) coordinates vector, the input parameters,
and/or the model output.
</p>
</li>
<li><p> The emulator will not work on scalar model output &ndash; it
requires multivariate data
</p>
</li>
<li><p> The emulator assumes a separable covariance function, and
stationarity of the covariance part of the Gaussian process.
</p>
</li>
<li><p> The optimization of the emulator parameters degrades
dramatically (and increases in time) as a function of number of
free parameters. Hence, the emulator might be of limited use for
large parameter ensembles
</p>
</li>
<li><p> The emulator authors are not responsible for any code errors
and/or bugs
</p>
</li></ol>



<h3>Author(s)</h3>

<p>Roman Olson, Won Chang, Klaus Keller and Murali Haran
</p>
<p>Maintainer: Kelsey Ruckert &lt;datamgmt@scrim.psu.edu&gt; 
</p>


<h3>References</h3>

<p>R. Olson and W. Chang (2013): Mathematical framework for a separable
Gaussian Process Emulator. Tech. Rep., available from <br />
<a href="http://www.scrimhub.org/resources/stilt/Olson_and_Chang_2013_Stilt_Emulator_Technical_Report.pdf">www.scrimhub.org/resources/stilt/Olson_and_Chang_2013_Stilt_Emulator_Technical_Report.pdf</a>.
</p>
<p>C. E. Rasmussen and C. K. I. Williams (2006): Gaussian Processes for
machine learning, the MIT press, available from <a href="www.gaussianprocess.org/gpml/">www.gaussianprocess.org/gpml/</a>
</p>

<hr>
<h2 id='Data.1D.model'>
Synthetic model output for a simple 1-parameter ensemble example
</h2><span id='topic+Data.1D.model'></span>

<h3>Description</h3>

<p>Synthetic model output for a simple 1-parameter ensemble example
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(Data.1D.model)</code></pre>


<h3>Format</h3>

<p>The format is a list containing five elements
</p>

<dl>
<dt>$ t</dt><dd><p>       : 11-element time vector: (0, 1, ..., 10)</p>
</dd>
<dt>$ tunits</dt><dd><p>  : Time units=&quot;Year&quot;</p>
</dd>
<dt>$ out</dt><dd><p>     : [1:11, 1:21] matrix of model response, [row,col]
= [time index, parameter index]. The corresponding vector of
parameters for columns is in the $par component of Data.1D.par.Rd ...</p>
</dd>
<dt>$ outname</dt><dd><p> : Output name=&quot;Sample Output&quot;</p>
</dd>
<dt>$ outunits</dt><dd><p>: Output units=&quot;Unitless&quot;</p>
</dd>
</dl>



<h3>Details</h3>

<p>Model response <code class="reqn">Y</code> is a function of time and parameter setting
<code class="reqn">\Theta</code> as follows: <code class="reqn">Y=sin(\Theta)(1 + 2t+t^2)</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Fit an emulator to the 1-parameter ensemble data
data(Data.1D.model)
data(Data.1D.par)
emulator(Data.1D.par, Data.1D.model, FALSE, FALSE, 1, 1)
</code></pre>

<hr>
<h2 id='Data.1D.par'>
Parameter settings for 1-parameter ensemble model output in Data.1D.model
</h2><span id='topic+Data.1D.par'></span>

<h3>Description</h3>

<p>Parameter settings for 1-parameter ensemble model output in Data.1D.model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(Data.1D.par)</code></pre>


<h3>Format</h3>

<p>The format is list containing three elements:
</p>

<dl>
<dt>$par</dt><dd><p> [1, 1:21] matrix of parameter settings. The columns
correspond to columns of $out in Data.1D.model. The parameter settings
are (0, 1, ..., 20)</p>
</dd>
<dt>$parnames</dt><dd><p> Parameter name = &quot;Parameter 1&quot;</p>
</dd>
<dt>$parunits</dt><dd><p> Parameter units = &quot;Unitless&quot;</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'># Fit an emulator to the 1-parameter ensemble data
data(Data.1D.model)
data(Data.1D.par)
emulator(Data.1D.par, Data.1D.model, FALSE, FALSE, 1, 1)

</code></pre>

<hr>
<h2 id='Data.AR1Korea.model'>
Korean modelled temperature variability and future change
</h2><span id='topic+Data.AR1Korea.model'></span>

<h3>Description</h3>

<p>Future 2081-2100 RCP8.5 emissions scenario change in summer mean maximum temperature compared to present (1973-2005) over Korea as a function of present-day (1973-2005) variability (innovation standard deviation and autocorrelation from CMIP5 GCMs)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(Data.AR1Korea.model)</code></pre>


<h3>Format</h3>

<p>The format is a list containing five elements:
</p>

<dl>
<dt>$t</dt><dd><p>Time vector for model output: (2081, 2082, ... 2100)</p>
</dd> 
<dt>$tunits</dt><dd><p>Time units = &quot;Year&quot;</p>
</dd>
<dt>$out</dt><dd><p>[1:20, 1:29] matrix of GCM temperature change
output. [row, col] = [time, model index]. The variability parameters 
corresponding to columns of $out are in the $par element
of Data.AR1Korea.par</p>
</dd>
<dt>$outname</dt><dd><p> Output name =  &quot;Temp Change 1973-2005 to 2081-2100&quot;</p>
</dd>
<dt>$outunits</dt><dd><p> Output units = &quot;K&quot;</p>
</dd>
</dl>



<h3>Details</h3>

<p>The CMIP5 GCM output was analysed by Jong-Soo Shin and Roman Olson at
Yonsei University. The variability properties were found by maximum likelihood. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Fit an emulator to the CMIP5 GCM Korean temperature variability and change
# data with innovation standard deviation and time as covariates
data(Data.AR1Korea.model)
data(Data.AR1Korea.par)
emulator(Data.AR1Korea.par, Data.AR1Korea.model, c(TRUE, FALSE), TRUE, 3, 3)
</code></pre>

<hr>
<h2 id='Data.AR1Korea.par'>
Korean temperature variability parameters
</h2><span id='topic+Data.AR1Korea.par'></span>

<h3>Description</h3>

<p>Korean summer mean maximum temperature 1973-2005 interannual variability parameters (innovation standard deviation and autocorrelation) for 29 CMIP5 GCMs. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(Data.AR1Korea.par)</code></pre>


<h3>Format</h3>

<p>The format is a list containing three variables
</p>

<dl>
<dt>$par</dt><dd><p>Variability settings for 29 CMIP5 GCMs. [1:2, 1:29]
matrix. Rows are: sigma (innovation std) and rho (autocorrelation).
The columns of $par correspond to columns of $out in
Data.AR1Korea.model. </p>
</dd>
<dt>$parnames</dt><dd><p>Parameter names for rows of $par</p>
</dd>
<dt>$parunits</dt><dd><p>Parameter units for rows of $par</p>
</dd>
</dl>



<h3>Details</h3>

<p>The CMIP5 GCM output was analysed by Jong-Soo Shin and Roman Olson at
Yonsei University. The variability properties were found by maximum likelihood.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Fit an emulator to the CMIP5 GCM Korean temperature variability and change
# data with innovation standard deviation and time as covariates
data(Data.AR1Korea.model)
data(Data.AR1Korea.par)
emulator(Data.AR1Korea.par, Data.AR1Korea.model, c(TRUE, FALSE), TRUE, 3, 3)
</code></pre>

<hr>
<h2 id='Data.Sicopolis.model'>
SICOPOLIS model ensemble output
</h2><span id='topic+Data.Sicopolis.model'></span>

<h3>Description</h3>

<p>Ice mass loss output from a 5-parameter ensemble of SICOPOLIS ice sheet model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(Data.Sicopolis.model)</code></pre>


<h3>Format</h3>

<p>The format is a list containing five elements
</p>

<dl>
<dt>$t</dt><dd><p> 661-element time vector for model output: (1840, 1841, ...,
2500)</p>
</dd>
<dt>$tunits</dt><dd><p>Time units = &quot;Year&quot;</p>
</dd>
<dt>$out</dt><dd><p> [1:661, 1:100] matrix of Greenland Ice Sheet mass anomaly
with respect to year 2003. [row, col] = [time index, parameter
index]. The vector of parameter values for columns of $out is in the $par
element of Data.Sicopolis.par.</p>
</dd>
<dt>$outname</dt><dd><p> Output name = &quot;GIS Mass Anomaly wrt 2003&quot;</p>
</dd>
<dt>$outunits</dt><dd><p> Output units &quot;Gt&quot;</p>
</dd>
</dl>



<h3>Details</h3>

<p>The ensemble was generated by Patrick Applegate. The ensemble varies
five important ice sheet model parameters: Flow Enhancement Factor,
Basal Sliding Factor, Geothermal Heat Flux, Snow PDD Factor, and Ice PDD Factor
</p>


<h3>Source</h3>

<p>Applegate, P. J., Kirchner, N., Stone, E. J., Keller, K., and Greve, R.,
2012, An assessment of key model parametric uncertainties in projections
of Greenland Ice Sheet behavior: The Cryosphere 6, 589-606.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Fit an emulator to the SICOPOLIS ensemble data
data(Data.Sicopolis.par)
data(Data.Sicopolis.model)
## Not run: emulator(Data.Sicopolis.par, Data.Sicopolis.model, c(FALSE, FALSE,
FALSE, FALSE, FALSE), FALSE, 200000, 20000)
## End(Not run)
</code></pre>

<hr>
<h2 id='Data.Sicopolis.par'>
SICOPOLIS model ensemble parameter settings
</h2><span id='topic+Data.Sicopolis.par'></span>

<h3>Description</h3>

<p>Parameter settings corresponding to SICOPOLIS ensemble model output in Data.Sicopolis.model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(Data.Sicopolis.par)</code></pre>


<h3>Format</h3>

<p>The format is a list containing three elements
</p>

<dl>
<dt>$par</dt><dd><p> [1:5, 1:100] matrix of parameter settings for the
SICOPOLIS model ensemble. [row, col] = [parameter number,
ensemble run number]. The columns match the columns of $out element
of Data.Sicopolis.model</p>
</dd>
<dt>$par</dt><dd><p> Parameter names for rows of $par</p>
</dd> 
<dt>$parunits</dt><dd><p>Parameter units for rows of $par</p>
</dd>
</dl>



<h3>Details</h3>

<p>The ensemble was generated by Patrick Applegate. The ensemble varies
five important ice sheet model parameters: Flow Enhancement Factor,
Basal Sliding Factor, Geothermal Heat Flux, Snow PDD Factor, and Ice PDD Factor
</p>


<h3>Source</h3>

<p>Applegate, P. J., Kirchner, N., Stone, E. J., Keller, K., and Greve, R.,
2012, An assessment of key model parametric uncertainties in projections
of Greenland Ice Sheet behavior: The Cryosphere 6, 589-606.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Fit an emulator to the SICOPOLIS ensemble data
data(Data.Sicopolis.par)
data(Data.Sicopolis.model)
## Not run: emulator(Data.Sicopolis.par, Data.Sicopolis.model, c(FALSE, FALSE,
FALSE, FALSE, FALSE), FALSE, 200000, 20000)
## End(Not run)
</code></pre>

<hr>
<h2 id='Data.UVic.model'>
UVic ESCM climate model ensemble output
</h2><span id='topic+Data.UVic.model'></span>

<h3>Description</h3>

<p>Temperature anomaly output from UVic ESCM climate model ensemble
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(Data.UVic.model)</code></pre>


<h3>Format</h3>

<p>The format is a list containing five elements:
</p>

<dl>
<dt>$t</dt><dd><p>Time vector for model output: (1850, 1851, ... 2009)</p>
</dd> 
<dt>$tunits</dt><dd><p>Time units = &quot;Year&quot;</p>
</dd>
<dt>$out</dt><dd><p>[1:160, 1:250] matrix of UVic ESCM temperature
output. [row, col] = [time, run index]. The parameter settings
corresponding to runs in columns of $out are in the $par element
of Data.UVic.par</p>
</dd>
<dt>$outname</dt><dd><p> Output name =  &quot;Temperature Anomaly from 1850-1899&quot;</p>
</dd>
<dt>$outunits</dt><dd><p> Output units = &quot;[K]&quot;</p>
</dd>
</dl>



<h3>Details</h3>

<p>The ensemble was run by Roman Olson at Penn State University. The
ensemble varies key parameters that affect decadal- and century-scale
climate response to external climate forcings: vertical ocean
diffusivity, climate sensitivity, and anthropogenic sulfate aerosol
scaling factor.
</p>


<h3>Source</h3>

<p>Olson, R., R. Sriver, M. Goes, N. M. Urban, H. D. Matthews, M. Haran and
K. Keller (2012): A climate sensitivity estimate using Bayesian fusion
of instrumental observations and an Earth System model. Journal of
Geosphysical Research - Atmospheres, 117(D04103),
doi:10.1029/2011JD016620
</p>


<h3>References</h3>

<p>Olson, R., R. Sriver, W. Chang, M. Haran, N. M. Urban and K. Keller
(2013): What is the effect of unresolved internal climate variability on
climate sensitivity estimates? Journal of Geophysical Research -
Atmospheres, 118, doi:10.1002/jgrd.50390
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Fit an emulator to the UVic ESCM ensemble data using all parameter and
#time covariates
data(Data.UVic.model)
data(Data.UVic.par)
## Not run: emulator(Data.UVic.par, Data.UVic.model, c(TRUE, TRUE, TRUE), TRUE, 1, 1)
</code></pre>

<hr>
<h2 id='Data.UVic.par'>
UVic ESCM climate model ensemble parameter settings
</h2><span id='topic+Data.UVic.par'></span>

<h3>Description</h3>

<p>Parameter settings for the UVic ESCM climate model ensemble output in Data.UVic.model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(Data.UVic.par)</code></pre>


<h3>Format</h3>

<p>The format is a list containing three variables
</p>

<dl>
<dt>$par</dt><dd><p>Parameter settings for the temperature output from the
UVic ESCM ensemble in Data.UVic.model. [1:3, 1:250]
matrix. [row, col] = [parameter number, run number]. The columns
of $par correspond to columns of $out in Data.UVic.model. </p>
</dd>
<dt>$parnames</dt><dd><p>Parameter names for rows of $par</p>
</dd>
<dt>$parunits</dt><dd><p>Parameter units for rows of $par</p>
</dd>
</dl>



<h3>Details</h3>

<p>The ensemble was run by Roman Olson at Penn State University. The
ensemble varies key parameters that affect decadal- and century-scale
climate response to external climate forcings: vertical ocean
diffusivity, climate sensitivity, and anthropogenic sulfate aerosol
scaling factor.
</p>


<h3>Source</h3>

<p>Olson, R., R. Sriver, M. Goes, N. M. Urban, H. D. Matthews, M. Haran and
K. Keller (2012): A climate sensitivity estimate using Bayesian fusion
of instrumental observations and an Earth System model. Journal of
Geosphysical Research - Atmospheres, 117(D04103),
doi:10.1029/2011JD016620
</p>


<h3>References</h3>

<p>Olson, R., R. Sriver, W. Chang, M. Haran, N. M. Urban and K. Keller
(2013): What is the effect of unresolved internal climate variability on
climate sensitivity estimates? Journal of Geophysical Research -
Atmospheres, 118, doi:10.1002/jgrd.50390
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Fit an emulator to the UVic ESCM ensemble data using all parameter and
# time covariates
data(Data.UVic.par)
data(Data.UVic.model)
## Not run: emulator(Data.UVic.par, Data.UVic.model, c(TRUE, TRUE, TRUE), TRUE, 1, 1)
</code></pre>

<hr>
<h2 id='emul.1D'>
Emulator of model for the 1-parameter example
</h2><span id='topic+emul.1D'></span>

<h3>Description</h3>

<p>Gaussian Process emulator object fitted to the 1-parameter example given
in Data.1D.par and Data.1D.model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(emul.1D)</code></pre>


<h3>Format</h3>

<p>This is a standard emulator list object, containing standard emulator
components as described in 'emulator' function
</p>


<h3>Details</h3>

<p>The emulator was fit with both the parameter and time covariates,
with a relative tolerance of 1E-9, with two optimization attempts. The
regression coefficients were estimated during the optimization process.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Cross-validate the 1-parameter model emulator and plot the results at
# time index 5
data(emul.1D)
test.all(emul.1D, 5)
</code></pre>

<hr>
<h2 id='emul.predict'>
To predict using an emulator (Deprecated)
</h2><span id='topic+emul.predict'></span>

<h3>Description</h3>

<p>To predict using an emulator. This function is deprecated. Use <code><a href="#topic+predict.emul">predict.emul</a></code> instead.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>emul.predict(emul, theta.star)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="emul.predict_+3A_emul">emul</code></td>
<td>

<p>Standard emulator object, as output, for example, by the 'emulator'
function.
</p>
</td></tr>
<tr><td><code id="emul.predict_+3A_theta.star">theta.star</code></td>
<td>

<p>Parameter setting at which to predict. Must have the same number of
elements as there are columns in the <code>emul$Theta.mat</code>. Vector (or,
for a 1 parameter ensemble, a single numeric value).
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Emulator prediction follows standard formulation in Gaussian Process
theory. For more details, see References.
</p>


<h3>Value</h3>

<p>Prediction at the parameter setting <code>theta.star</code> for all times
specified by <code>emul$t.vec</code>. List with components
</p>
<table role = "presentation">
<tr><td><code>mean</code></td>
<td>
<p>Posterior mean. n*1 matrix. Rows correspond to the times of <code>emul$t.vec</code>.</p>
</td></tr>
<tr><td><code>covariance</code></td>
<td>
<p> Posterior covariance matrix. n*n matrix. Diagonal
elements represent variances at each time in <code>emul$t.vec</code>.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Prediction outside the emulator range (&quot;extrapolation&quot;) is currently not allowed.
</p>


<h3>References</h3>

<p>R. Olson and W. Chang (2013): Mathematical framework for a separable
Gaussian Process Emulator. Tech. Rep., available from <br />
<a href="http://www.scrimhub.org/resources/stilt/Olson_and_Chang_2013_Stilt_Emulator_Technical_Report.pdf">www.scrimhub.org/resources/stilt/Olson_and_Chang_2013_Stilt_Emulator_Technical_Report.pdf</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rsurface.plot">rsurface.plot</a></code>, <code><a href="#topic+test.csv">test.csv</a></code>, <code><a href="#topic+emulator">emulator</a></code>, <code><a href="#topic+predict.emul">predict.emul</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Predict using the SICOPOLIS model at a mid-range parameter setting, and plot
# the prediction and associated uncertainty
data(emul.Sicopolis)
pred &lt;- emul.predict(emul.Sicopolis, c(3, 10, 50, 3, 12.5))
plot.default(NA, xlim=range(emul.Sicopolis$t.vec),
     ylim=range(pred$mean), xlab="Year",
     ylab="Ice Mass Loss relative to year 2003")
lines(emul.Sicopolis$t.vec, pred$mean, col="brown", lwd=3)
std &lt;- sqrt(diag(pred$covariance))
lines(emul.Sicopolis$t.vec, pred$mean + std, col="brown", lty=2)
lines(emul.Sicopolis$t.vec, pred$mean - std, col="brown", lty=2)


# Fit an emulator to the 1-parameter test ensemble data, predict at
# Theta*=8, and plot the prediction
data(Data.1D.par)
data(Data.1D.model)
emul.1D &lt;- emulator(Data.1D.par, Data.1D.model, TRUE, TRUE, 100, 0.1)
pred.1D &lt;- emul.predict(emul.1D, 8)
plot(emul.1D$t.vec, pred.1D$mean, xlab="Year",
     ylab="Sample Model Output at Theta*=8")

## End(Not run)
</code></pre>

<hr>
<h2 id='emul.Sicopolis'>
SICOPOLIS ice sheet model emulator
</h2><span id='topic+emul.Sicopolis'></span>

<h3>Description</h3>

<p>Sample emulator for ice mass loss from the 5-parameter SICOPOLIS ice
sheet model ensemble output 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(emul.Sicopolis)</code></pre>


<h3>Format</h3>

<p>This is a standard emulator list object, containing standard emulator
components as described in 'emulator' function. The emulated quantity
is Greenland ice mass loss relative to year 2003 (Gt).
</p>


<h3>Details</h3>

<p>The emulator was fit using all five parameter covariates, and the time
covariate. The beta parameters are the multiple linear regression
estimates. The model ensemble was generated by Patrick Applegate. The ensemble varies
five important ice sheet model parameters: Flow Enhancement Factor,
Basal Sliding Factor, Geothermal Heat Flux, Snow PDD Factor, and Ice PDD Factor.
</p>


<h3>Source</h3>

<p>Applegate, P. J., Kirchner, N., Stone, E. J., Keller, K., and Greve, R.,
2012, An assessment of key model parametric uncertainties in projections
of Greenland Ice Sheet behavior: The Cryosphere 6, 589-606.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Plot the response surface as a function of snow PDD factor, and ice
# PDD factor at year 2500 (time index 661), while keeping other parameters
# at mid-range values
data(emul.Sicopolis)
## Not run: 
  rsurface.plot(emul=emul.Sicopolis, parind=c(4,5), parvals=c(3, 10, 50, NA, NA),
      tind=661, n1=5, n2=5)

## End(Not run)
</code></pre>

<hr>
<h2 id='emulator'>
Function to fit an emulator to ensemble model output
</h2><span id='topic+emulator'></span>

<h3>Description</h3>

<p>Fits a Gaussian Process emulator to regularly spaced time-series (or 1D spatial)
model output. This emulator can later be used to interpolate the model
output across model parameter settings. The emulator is fit by
maximizing the emulator likelihood using a PORT local optimization
routine. The emulator has a flexible structure which can be chosen by
the user (see Details). 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>emulator(mpars, moutput, par.reg, time.reg, kappa0, zeta0, myrel.tol =
NULL, twice = FALSE, fix.betas = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="emulator_+3A_mpars">mpars</code></td>
<td>

<p>Model ensemble parameter settings. A list with components:
</p>

<dl>
<dt>$par</dt><dd><p>Matrix of ensemble parameter settings. [row, column] =
[parameter index, run index]. Columns should correspond to
columns of the model output matrix <code>moutput$out</code>.</p>
</dd>
<dt>$parnames</dt><dd><p>Parameter names for rows of $par (character vector)</p>
</dd>
<dt>$parunits</dt><dd><p>Units for parameters in rows of $par (character vector)</p>
</dd>
</dl>
 
</td></tr>
<tr><td><code id="emulator_+3A_moutput">moutput</code></td>
<td>

<p>Model output. A list with components:
</p>

<dl>
<dt>$t</dt><dd><p> Time vector for rows of $out (vector)</p>
</dd>
<dt>$tunits</dt><dd><p>Time units (character)</p>
</dd>
<dt>$out</dt><dd><p> Model output matrix [row, col] = [time, run
index]. The run indices should match with the <code>mpars$par</code> argument.</p>
</dd> 
<dt>$outname</dt><dd><p> name (character)</p>
</dd>
<dt>$outunits</dt><dd><p> units (character</p>
</dd>
</dl>

</td></tr>
<tr><td><code id="emulator_+3A_par.reg">par.reg</code></td>
<td>
<p> Logical vector specifying which parameters to include into the
regression matrix. Elements refer to rows of <code>mpars$par</code>.
Note that if nothing is included into the regression matrix, the mean is
still optimized.
</p>
</td></tr>
<tr><td><code id="emulator_+3A_time.reg">time.reg</code></td>
<td>
<p>Logical specifying whether to include time into the
regression matrix.
</p>
</td></tr>
<tr><td><code id="emulator_+3A_kappa0">kappa0</code></td>
<td>
<p> Initial guess for the parameter covariance scaling factor. Larger values
lead to higher parameter covariance.
</p>
</td></tr>
<tr><td><code id="emulator_+3A_zeta0">zeta0</code></td>
<td>
<p>Initial guess for the nugget.
</p>
</td></tr>
<tr><td><code id="emulator_+3A_myrel.tol">myrel.tol</code></td>
<td>
<p>Relative tolerance for optimization. If you want to
use the defaults, assign it to NULL. The optimization stops if it thinks the true likelihood is
within this fraction of current likelihood. The higher the
number the sooner the optimization stops, but the emulator
is 'worse'.
</p>
</td></tr>
<tr><td><code id="emulator_+3A_twice">twice</code></td>
<td>

<p>Logical. If <code>TRUE</code>, the optimization is done twice with different
initial parameter values, and then the best of the two is chosen as
final emulator. Default is <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="emulator_+3A_fix.betas">fix.betas</code></td>
<td>

<p>Logical. If <code>TRUE</code>, beta regression coefficients are fixed, and if <code>FALSE</code>,
they are estimated. Default is <code>TRUE</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The emulator parameters are optimized using a local optimization
method, to within the specified relative tolerance. The optimization maximizes
emulator likelihood. Optionally, if <code>twice=TRUE</code>, the optimization is done twice with
different initial parameter settings, and the emulator with the highest
likelihood is selected. Depending on the value of <code>fix.betas</code>, the regression
beta parameters can either be fixed at their multiple linear regression
estimates, or estimated together with other
emulator parameters. Mean structure is flexible, and user can choose which
parameter and time dimensions to use as regressors via the
<code>time.reg</code> and <code>par.reg</code> parameters
</p>


<h3>Value</h3>

<p>Emulator returns an object of <code><a href="base.html#topic+class">class</a></code> &quot;emul&quot; and is a list with components 
(see also Reference in the References Section).
</p>
<table role = "presentation">
<tr><td><code>$Theta.mat</code></td>
<td>
<p>Theta matrix. [row, col] = [run number, parameter
number]</p>
</td></tr>
<tr><td><code>$t.vec</code></td>
<td>
<p>Time vector</p>
</td></tr>
<tr><td><code>$Y.mat</code></td>
<td>
<p>Data matrix Y</p>
</td></tr>
<tr><td><code>$X.mat</code></td>
<td>
<p>Regression matrix</p>
</td></tr>
<tr><td><code>$beta.vec</code></td>
<td>
<p>A vector of regression parameters</p>
</td></tr>
<tr><td><code>$kappa</code></td>
<td>
<p> Parameter covariance scaling factor</p>
</td></tr>
<tr><td><code>$phi.vec</code></td>
<td>
<p>A vector of range parameters phi</p>
</td></tr>
<tr><td><code>$zeta</code></td>
<td>
<p>Nugget</p>
</td></tr>
<tr><td><code>$n</code></td>
<td>
<p>Length of time dimension</p>
</td></tr>
<tr><td><code>$rho</code></td>
<td>
<p>Time AR(1) parameter</p>
</td></tr>
<tr><td><code>$p</code></td>
<td>
<p>Number of model runs in the ensemble</p>
</td></tr>
<tr><td><code>$vecC</code></td>
<td>
<p>Data matrix Y minus the mean vector</p>
</td></tr>
<tr><td><code>$par.reg</code></td>
<td>
<p> Logical vector specifying which parameters to include
in the regression matrix</p>
</td></tr>
<tr><td><code>$time.reg</code></td>
<td>
<p>Logical, specifies whether to include time into the
regression matrix</p>
</td></tr>
<tr><td><code>$Sigma.mats</code></td>
<td>
<p>List of two precomputed matrices that may be useful:
<code>$Sigma.t.mat</code> and <code>$Sigma.theta.mat</code> (see References)</p>
</td></tr>
<tr><td><code>$Sigma.theta.inv.mat</code></td>
<td>
<p>Inverse of <code>$Sigma.mats$Sigma.theta.mat</code></p>
</td></tr>
</table>


<h3>Note</h3>

<p>Evaluation of this function (especially for large datasets and many parameters) might take a long time.
</p>


<h3>Limitations and Caveats</h3>


<ol>
<li><p> The emulator will not work well for 'jagged' model response
surfaces (high nugget)
</p>
</li>
<li><p> The emulator is restricted to output at regular intervals in
time and space
</p>
</li>
<li><p> The code has not been tested under conditions of extreme high
/ extreme low input parameter range, output time(space) coordinates
range, and output range (an example would be model output ranging
from -1E20 to 1E20, etc.). In such cases it is recommended to
re-scale the time(space) coordinates vector, the input parameters,
and/or the model output.
</p>
</li>
<li><p> The emulator will not work on scalar model output &ndash; it
requires multivariate data
</p>
</li>
<li><p> The emulator assumes a separable covariance function, and
stationarity of the covariance part of the Gaussian process.
</p>
</li>
<li><p> The optimization of the emulator parameters degrades
dramatically (and increases in time) as a function of number of
free parameters. Hence, the emulator might be of limited use for
large parameter ensembles
</p>
</li>
<li><p> The emulator authors are not responsible for any code errors
and/or bugs
</p>
</li></ol>



<h3>Note</h3>

<p>If the final emulator performs poorly, try adjusting the
settings, especially the initial <code>kappa0</code> and <code>zeta0</code> values.
</p>


<h3>References</h3>

<p>R. Olson and W. Chang (2013): Mathematical framework for a separable
Gaussian Process Emulator. Tech. Rep., available from <br />
<a href="http://www.scrimhub.org/resources/stilt/Olson_and_Chang_2013_Stilt_Emulator_Technical_Report.pdf">www.scrimhub.org/resources/stilt/Olson_and_Chang_2013_Stilt_Emulator_Technical_Report.pdf</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+emul.lik">emul.lik</a></code>, <code><a href="#topic+optimize.emul">optimize.emul</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Fit an emulator to the example 1D parameter ensemble data
# Do not use any covariates, use standard settings
data(Data.1D.model)
data(Data.1D.par)
emul.1D &lt;- emulator(Data.1D.par, Data.1D.model, FALSE, FALSE, 1, 1)

# Take a look at the range and regression parameters
cat("Range parameters are:", emul.1D$phi.vec, "\n")
cat("Regression parameters are:", emul.1D$beta.vec, "\n")

# Predict using the emulator at Theta*=3
pred.1D &lt;- predict(emul.1D, 3)

# Plot the prediction
plot(emul.1D$t.vec, pred.1D$mean, xlab="Year", ylab="Sample Output")


## Not run: 
    # Fit an emulator to the UVic ESCM 3-parameter ensemble temperature
    # output Use time and aerosol scaling covariates (parameter 3), run
    # the optimization twice with relative tolerance of 0.1, keep
    # regression parameters at their multiple linear regression
    # estimates data(Data.UVic.model) data(Data.UVic.par) UVic.emul &lt;-
    # emulator(mpars=Data.UVic.par, moutput=Data.UVic.model,
    # par.reg=c(FALSE, FALSE, TRUE), time.reg=TRUE, kappa0=1, zeta0=1,
    # myrel.tol=0.1, twice=TRUE, fix.betas=TRUE)
   
## End(Not run)
</code></pre>

<hr>
<h2 id='predict.emul'>
Predict Method for an Emulator
</h2><span id='topic+predict.emul'></span><span id='topic+predict'></span>

<h3>Description</h3>

<p>To predict using an emulator
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'emul'
predict(object, theta.star, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict.emul_+3A_object">object</code></td>
<td>

<p>Standard emulator object of class &quot;emul&quot;, as output, for example, by the <code><a href="#topic+emulator">emulator</a></code>
function.
</p>
</td></tr>
<tr><td><code id="predict.emul_+3A_theta.star">theta.star</code></td>
<td>

<p>Parameter setting at which to predict. Must have the same number of
elements as there are columns in the <code>object$Theta.mat</code>. Vector (or,
for a 1 parameter ensemble, a single numeric value).
</p>
</td></tr>
<tr><td><code id="predict.emul_+3A_...">...</code></td>
<td>

<p>Additional optional arguments. At present no optional arguments are used.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Emulator prediction follows standard formulation in Gaussian Process
theory. For more details, see References.
</p>


<h3>Value</h3>

<p>Prediction at the parameter setting <code>theta.star</code> for all times
specified by <code>object$t.vec</code>. List with components
</p>
<table role = "presentation">
<tr><td><code>mean</code></td>
<td>
<p>Posterior mean. n*1 matrix. Rows correspond to the times of <code>object$t.vec</code>.</p>
</td></tr>
<tr><td><code>covariance</code></td>
<td>
<p> Posterior covariance matrix. n*n matrix. Diagonal
elements represent variances at each time in <code>object$t.vec</code>.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Prediction outside the emulator range (&quot;extrapolation&quot;) is currently not allowed.
</p>


<h3>References</h3>

<p>R. Olson and W. Chang (2013): Mathematical framework for a separable
Gaussian Process Emulator. Tech. Rep., available from <br />
<a href="http://www.scrimhub.org/resources/stilt/Olson_and_Chang_2013_Stilt_Emulator_Technical_Report.pdf">www.scrimhub.org/resources/stilt/Olson_and_Chang_2013_Stilt_Emulator_Technical_Report.pdf</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rsurface.plot">rsurface.plot</a></code>, <code><a href="#topic+test.csv">test.csv</a></code>, <code><a href="#topic+emulator">emulator</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Predict using the SICOPOLIS model at a mid-range parameter setting, and plot
# the prediction and associated uncertainty
data(emul.Sicopolis)
pred &lt;- predict(emul.Sicopolis, c(3, 10, 50, 3, 12.5))
plot.default(NA, xlim=range(emul.Sicopolis$t.vec),
     ylim=range(pred$mean), xlab="Year",
     ylab="Ice Mass Loss relative to year 2003")
lines(emul.Sicopolis$t.vec, pred$mean, col="brown", lwd=3)
std &lt;- sqrt(diag(pred$covariance))
lines(emul.Sicopolis$t.vec, pred$mean + std, col="brown", lty=2)
lines(emul.Sicopolis$t.vec, pred$mean - std, col="brown", lty=2)


# Fit an emulator to the 1-parameter test ensemble data, predict at
# Theta*=8, and plot the prediction
data(Data.1D.par)
data(Data.1D.model)
emul.1D &lt;- emulator(Data.1D.par, Data.1D.model, TRUE, TRUE, 100, 0.1)
pred.1D &lt;- predict(emul.1D, 8)
plot(emul.1D$t.vec, pred.1D$mean, xlab="Year",
     ylab="Sample Model Output at Theta*=8")
</code></pre>

<hr>
<h2 id='rsurface.plot'>
To produce a response surface plot of the emulator
</h2><span id='topic+rsurface.plot'></span>

<h3>Description</h3>

<p>To produce a response surface plot of the emulator
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rsurface.plot(emul, parind, parvals, tind, n1, n2, zlim = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rsurface.plot_+3A_emul">emul</code></td>
<td>

<p>A standard emulator object, as output, for example, by the
'emulator' function
</p>
</td></tr>
<tr><td><code id="rsurface.plot_+3A_parind">parind</code></td>
<td>

<p>Vector of parameter indices (x and y) (columns of <code>emul$Theta.mat</code>) for
which the response surface is desired. Should contain only two
elements. <code>parind[2]</code> can be less or more than <code>parind[1]</code>.
</p>
</td></tr>
<tr><td><code id="rsurface.plot_+3A_parvals">parvals</code></td>
<td>

<p>A vector of parameter values to use for the rest of the
parameters (that are kept at constant values). Must be the same length as
the number of columns in <code>emul$Theta.mat</code>. The columns corresponding
to <code>parind</code> should be NA.
</p>
</td></tr>
<tr><td><code id="rsurface.plot_+3A_tind">tind</code></td>
<td>

<p>Time index at which to predict
</p>
</td></tr>
<tr><td><code id="rsurface.plot_+3A_n1">n1</code></td>
<td>

<p>X direction grid size
</p>
</td></tr>
<tr><td><code id="rsurface.plot_+3A_n2">n2</code></td>
<td>

<p>Y direction grid size
</p>
</td></tr>
<tr><td><code id="rsurface.plot_+3A_zlim">zlim</code></td>
<td>

<p>Vector of z-limits for the filled.contour function. Default is the range
of data plotted.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Produces a response surface plot of the emulator as a function of
selected parameters, while the rest of the parameters are fixed at
their values set by <code>parvals</code>. Use <code>n1</code> and <code>n2</code> to
specify X and Y grid size. Optionally, plot limits can be specified
through <code>zlim</code>. The code relies on the filled.contour function.
</p>


<h3>Value</h3>

<p>None
</p>


<h3>Note</h3>

<p>Evaluation of this function (especially for large datasets and grid
sizes) might take a long time. This is because in current specification, 
the 'predict.emul' function predicts the entire time-series (or space 
transect) at once.
</p>


<h3>References</h3>

<p>R. Olson and W. Chang (2013): Mathematical framework for a separable
Gaussian Process Emulator. Tech. Rep., available from <br />
<a href="http://www.scrimhub.org/resources/stilt/Olson_and_Chang_2013_Stilt_Emulator_Technical_Report.pdf">www.scrimhub.org/resources/stilt/Olson_and_Chang_2013_Stilt_Emulator_Technical_Report.pdf</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+emulator">emulator</a></code>, <code><a href="#topic+predict.emul">predict.emul</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Plot the SICOPOLIS ice mass loss in year 2500 as a function of Snow
# PDD Factor and Ice PDD Factor, at mid-range values of other parameters
data(emul.Sicopolis)
## Not run: 
  rsurface.plot(emul=emul.Sicopolis, parind=c(4,5), parvals=c(3, 10, 50, NA, NA),
      tind=661, n1=5, n2=5)
  
## End(Not run)
</code></pre>

<hr>
<h2 id='sep.cov'>
Construct time and parameter covariance matrices
</h2><span id='topic+sep.cov'></span>

<h3>Description</h3>

<p>Construct time and parameter covariance matrices. The time matrix
follows standard AR(1) covariance. The parameter covariance is squared
exponential, separable between the parameters, with an extra nugget term. While
not directly related to other functions in this
package, this function can be re-used if someone wants to build a
new/different Gaussian Process emulator code.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sep.cov(Theta.mat, t.vec, rho, kappa, phi.vec, zeta)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sep.cov_+3A_theta.mat">Theta.mat</code></td>
<td>

<p>Parameter matrix of the ensemble. [row, col] = [run number, parameter
number]. See References for more information on this and other arguments.
</p>
</td></tr>
<tr><td><code id="sep.cov_+3A_t.vec">t.vec</code></td>
<td>

<p>Evenly spaced vector of times for model output (can also be a coordinate
vector for a regularly spaced spatial transect)
</p>
</td></tr>
<tr><td><code id="sep.cov_+3A_rho">rho</code></td>
<td>

<p>Lag-1 time autocorrelation parameter <code class="reqn">\rho</code>
</p>
</td></tr>
<tr><td><code id="sep.cov_+3A_kappa">kappa</code></td>
<td>

<p>Parameter covariance scaling factor <code class="reqn">\kappa</code>
</p>
</td></tr>
<tr><td><code id="sep.cov_+3A_phi.vec">phi.vec</code></td>
<td>

<p>Vector of range parameters. Must have the same length as
number of columns in <code>Theta.mat</code>. All elements should be positive.
</p>
</td></tr>
<tr><td><code id="sep.cov_+3A_zeta">zeta</code></td>
<td>

<p>Nugget <code class="reqn">\zeta</code>. Should be positive.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The time covariance is an n*n matrix (where n is the length of time
dimension). Its (j,k) element is specified by <code class="reqn">\varsigma_{t,jk} =
  \frac{\rho^{|t_j-t_k|}}{1-\rho^2}</code>. The parameter covariance is a p*p matrix (where p
is the number of runs in the model ensemble). Specifically,
<code class="reqn">\Sigma_{\theta,ij} = \kappa*exp(-A) + \zeta*1(i=j)</code> where
<code class="reqn">A=\sum\limits_{k=1}^{m}{\frac{(\theta_{k,i} -
      \theta_{k,j})^2}{\phi_k^2}}</code>. Here <code class="reqn">k</code> refers to parameter index.
For more details on the time and parameter covariance matrices produced by
this function, see References.
</p>


<h3>Value</h3>

<p>List with components
</p>
<table role = "presentation">
<tr><td><code>$Sigma.t.mat</code></td>
<td>
<p> Time covariance matrix</p>
</td></tr>
<tr><td><code>$Sigma.theta.mat</code></td>
<td>
<p>Parameter covariance matrix</p>
</td></tr>
</table>


<h3>References</h3>

<p>R. Olson and W. Chang (2013): Mathematical framework for a separable
Gaussian Process Emulator. Tech. Rep., available from <br />
<a href="http://www.scrimhub.org/resources/stilt/Olson_and_Chang_2013_Stilt_Emulator_Technical_Report.pdf">www.scrimhub.org/resources/stilt/Olson_and_Chang_2013_Stilt_Emulator_Technical_Report.pdf</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+predict.emul">predict.emul</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Construct time AR(1) and square exponential separable parameter
# covariance matrix for a simple 1D parameter ensemble output example
data(Data.1D.par)
data(Data.1D.model)

Theta.mat.1D &lt;- t(Data.1D.par$par)
t.vec.1D     &lt;- Data.1D.model$t

# Use lag-1 time autocorrelation of 0.9, nugget and parameter covariance
# scaling factor of 100, and range of 3.
cov &lt;- sep.cov(Theta.mat.1D, t.vec.1D, 0.9, 100, 3, 100)

# Find the covariance between second parameter setting (Theta=1) and
# ninth parameter setting (Theta=8)
cov.2.9 &lt;- cov$Sigma.theta.mat[2,9]
cat("Covariance between Theta=1 and Theta=8 is:", cov.2.9, "\n")

# Plot the time covariance matrix [for fun]
# Note how covariance is high between similar years, but is low for markedly
# different years. Produces a pretty plot.
filled.contour(t.vec.1D, t.vec.1D, cov$Sigma.t.mat, xlab="Year", ylab="Year")
</code></pre>

<hr>
<h2 id='stilt-internal'>Internal Stilt Functions</h2><span id='topic+design.mat'></span><span id='topic+emul.lik'></span><span id='topic+emul.minus.lik'></span><span id='topic+emul.subset'></span><span id='topic+initialize.emul'></span><span id='topic+make.emulator'></span><span id='topic+make.parvec'></span><span id='topic+make.ranges'></span><span id='topic+mymessage'></span><span id='topic+optimize.emul'></span>

<h3>Description</h3>

<p>Internal Stilt functions
</p>


<h3>Details</h3>

<p>These functions are not to be called by the user.
</p>

<hr>
<h2 id='test.all'>
To test an emulator using leave-one-out cross-validation
</h2><span id='topic+test.all'></span>

<h3>Description</h3>

<p>To test an emulator using the leave-one-out cross validation analysis, whereby
each ensemble run is first excluded from an emulator, and the emulator is then used to predict at
the parameter settings of the excluded run. The process is repeated for
all runs within the ensemble. The function also makes a plot of emulator
predictions vs. actual model output, and a plot
of normalized prediction errors for each excluded run.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>test.all(final.emul, t.plot)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="test.all_+3A_final.emul">final.emul</code></td>
<td>

<p>Standard emulator object, that can be generated, for example, by
'emulator' function
</p>
</td></tr>
<tr><td><code id="test.all_+3A_t.plot">t.plot</code></td>
<td>

<p>Time index of the emulator to analyze
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For a perfect emulator, emulator
predictions vs. actual model output will fall exactly on a 1:1 line.
If a withheld run is at the corner of parameter space, prediction gives
a warning. Such runs are omitted from the plot.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+test.csv">test.csv</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Cross-validate the 1D-parameter ensemble emulator at the first time index
data(emul.1D)
test.all(emul.1D, 1)
</code></pre>

<hr>
<h2 id='test.csv'>
To cross-validate a Gaussian Process emulator
</h2><span id='topic+test.csv'></span>

<h3>Description</h3>

<p>To test an emulator using cross-validation. Any reasonable number of runs can be
excluded from the emulator for testing. Then, the emulator is used to
predict at the excluded parameter settings, and the results can be
plotted. Optionally, prediction standard deviation can also be
plotted. The program is reproducible if the seed number is specified.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>test.csv(final.emul, num.test, plot.std, theseed = NULL, test.runind =
NULL, make.plot = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="test.csv_+3A_final.emul">final.emul</code></td>
<td>

<p>A standard emulator object. It can be generated by, for example, the
'emulator' function.
</p>
</td></tr>
<tr><td><code id="test.csv_+3A_num.test">num.test</code></td>
<td>

<p>Number of test runs to withhold at random from the emulator. Can not be
more than half of the ensemble.
</p>
</td></tr>
<tr><td><code id="test.csv_+3A_plot.std">plot.std</code></td>
<td>

<p>If <code>TRUE</code>, prediction std. is plotted around the emulator prediction
</p>
</td></tr>
<tr><td><code id="test.csv_+3A_theseed">theseed</code></td>
<td>

<p>Seed for random number generator. Default is <code>NULL</code>.
</p>
</td></tr>
<tr><td><code id="test.csv_+3A_test.runind">test.runind</code></td>
<td>

<p>If not <code>NULL</code>, a monotonically increasing vector of run indices at which
to test the emulator. Has to contain <code>num.test</code> number of elements.
If <code>NULL</code>, run indices are generated at random. Default is <code>NULL</code>.
</p>
</td></tr>
<tr><td><code id="test.csv_+3A_make.plot">make.plot</code></td>
<td>

<p>If <code>TRUE</code> (the default) produced a cross-validation plot. 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function withholds model runs from the emulator, and then uses the
withheld emulator to predict at the excluded parameter settings. Any
reasonable number of runs up to 1/2 of the ensemble can be excluded. If
<code>make.plot=TRUE</code> the plot of model output and emulator prediction
at the excluded setting is produced. Setting <code>plot.std=TRUE</code> adds
the prediction standard deviation to the plot. If <code>plot.std=TRUE</code>
but <code>make.plot=FALSE</code> a warning is given and nothing is plotted.
The default setting is to
exclude <code>num.test</code> runs at random. If <code>theseed</code> is specified
the results become reproducible as the seed passed on to the R random
number
generator is fixed. Optionally, the excluded run indices can be
specified explicitly via the vector <code>test.runind</code>. If both
<code>theseed</code> and <code>test.runind</code> arguments are specified, then
<code>theseed</code> is ignored.
</p>
<p>The function prints out the excluded run
indices and outputs some basic guidance. The function handles runs which
are at parameter space boundaries by passing NA to the relevant rows of
output matrices. If prediction at a particular withheld run gives error
(most likely due to the fact that extrapolation is not allowed and the
excluded run is at the corner of parameter space) that particular run is
not plotted. Model output is beige, and emulator output is brown.
</p>
<p>By 'withholding' runs from an emulator it is meant that the emulator
statistical parameters are kept the same, whereas the withheld runs are
eliminated from all relevant emulator components. The ensemble size <code>final.emul$p</code> is reduced
accordingly. 
</p>


<h3>Value</h3>

<p>List with components
</p>
<table role = "presentation">
<tr><td><code>$model.out.test</code></td>
<td>
<p> Model output at test parameter settings [row,col] =
[test run index, time index]</p>
</td></tr>
<tr><td><code>$emul.out.test</code></td>
<td>
<p>Emulator output at test parameter settings [row,col] =
[test run index, time index]</p>
</td></tr>
<tr><td><code>$emul.std.test</code></td>
<td>
<p>Emulator prediction standard deviation at test parameter
settings [row,col] = [test run index, time index]</p>
</td></tr>
<tr><td><code>$coverage</code></td>
<td>
<p>Empirical 95% coverage, expressed as a fraction </p>
</td></tr>
</table>
<p>The time vector for columns of all matrix components is
<code>final.emul$t.vec</code>
</p>


<h3>References</h3>

<p>R. Olson and W. Chang (2013): Mathematical framework for a separable
Gaussian Process Emulator. Tech. Rep., available from <br />
<a href="http://www.scrimhub.org/resources/stilt/Olson_and_Chang_2013_Stilt_Emulator_Technical_Report.pdf">www.scrimhub.org/resources/stilt/Olson_and_Chang_2013_Stilt_Emulator_Technical_Report.pdf</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+test.all">test.all</a></code>, <code><a href="#topic+predict.emul">predict.emul</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Test the 1D emulator by withholding the second parameter
# setting, and then predicting at the withheld run
data(emul.1D)
test.1D &lt;- test.csv(final.emul=emul.1D, num.test=1, plot.std=FALSE,
                    test.runind=2, make.plot=FALSE)

# Create a custom plot
plot.default(NA, xlim=range(emul.1D$t.vec), ylim=range(test.1D$model.out.test),
             xlab="Year", ylab="Sample Output", main="Emulator Test at Theta=1",
             cex.lab=1.3, cex.axis=1.3, cex.main=1.3)
lines(emul.1D$t.vec, test.1D$model.out.test, lwd=4, lty=2, col="green")
# The emulator prediction is close to perfect! Yay!
lines(emul.1D$t.vec, test.1D$emul.out.test, lwd=2, col="yellow")

# Produce a legend
model.max &lt;- max(test.1D$model.out.test)
# We already know that time ranges from 0 to 10 so figuring out x placement
# for the legend is not hard
legend(1, model.max, c("Model Output", "Emulator Predictions"),
       col=c("green", "yellow"), lty=c(2,1), lwd=c(4,2), cex=1.3)



# Test SICOPOLIS emulator at three pre-selected parameter settings
# specified by theseed=1234321
data(emul.Sicopolis)
# Plot the standard deviation in all three cases
test.csv(final.emul=emul.Sicopolis, num.test=3, plot.std=TRUE, theseed=1234321,
         make.plot=TRUE)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
