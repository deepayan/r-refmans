<!DOCTYPE html><html><head><title>Help for package PWEALL</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {PWEALL}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#cp'><p>Conditional power given observed log hazard ratio</p></a></li>
<li><a href='#cpboundary'><p>The stopping boundary based on the conditional power criteria</p></a></li>
<li><a href='#cpstop'><p>The stopping probability based on the stopping boundary</p></a></li>
<li><a href='#fourhr'><p>A utility functon</p></a></li>
<li><a href='#hxbeta'><p>A function to calculate the beta-smoothed hazard rate</p></a></li>
<li><a href='#innercov'><p>A utility function to calculate the inner integration of the overall covariance</p></a></li>
<li><a href='#innervar'><p>A utility function to calculate the inner integration of the overall variance</p></a></li>
<li><a href='#instudyfindt'><p>calculate the timeline in study when some or all subjects have entered</p></a></li>
<li><a href='#ovbeta'><p>calculate the overall log hazard ratio</p></a></li>
<li><a href='#overallcov'><p>calculate the overall covariance</p></a></li>
<li><a href='#overallcovp1'><p>calculate the first part of the overall covariance</p></a></li>
<li><a href='#overallcovp2'><p>calculate the other parts of the overall covariance</p></a></li>
<li><a href='#overallvar'><p>calculate the overall variance</p></a></li>
<li><a href='#pwe'><p>Piecewise exponential distribution: hazard, cumulative hazard, density, distribution, survival</p></a></li>
<li><a href='#PWEALL-package'>
<p>Design and Monitoring of Survival Trials Accounting for Complex</p>
Situations</a></li>
<li><a href='#pwecx'><p>Various function for piecewise exponential distribution with crossover effect</p></a></li>
<li><a href='#pwecxcens'><p>Integration of the density of piecewise exponential distribution with crossover effect and the censoring  function</p></a></li>
<li><a href='#pwecxpwu'><p>Integration of the density of piecewise exponential distribution with crossover effect, censoring and recruitment function</p></a></li>
<li><a href='#pwecxpwufindt'><p>calculate the timeline when certain number of events accumulates</p></a></li>
<li><a href='#pwecxpwuforvar'><p>calculate the utility function used for varaince calculation</p></a></li>
<li><a href='#pwefv2'><p>A utility function</p></a></li>
<li><a href='#pwefvplus'><p>A utility functon</p></a></li>
<li><a href='#pwepower'><p>Calculating the powers of various the test statistics for superiority trials</p></a></li>
<li><a href='#pwepowereq'><p>Calculating the powers of various the test statistics for equivalence trials</p></a></li>
<li><a href='#pwepowerfindt'><p>Calculating the timepoint where a certain power of the specified test statistics is obtained</p></a></li>
<li><a href='#pwepowerni'><p>Calculating the powers of various the test statistics for non-inferiority trials</p></a></li>
<li><a href='#pwesim'><p>simulating the test statistics</p></a></li>
<li><a href='#pwu'><p>Piecewise uniform distribution: distribution</p></a></li>
<li><a href='#qpwe'><p>Piecewise exponential distribution: quantile function</p></a></li>
<li><a href='#qpwu'><p>Piecewise uniform distribution: quantile function</p></a></li>
<li><a href='#rmstcov'><p>Calculation of the variance and covariance of estimated restricted mean survival time</p></a></li>
<li><a href='#rmsth'><p>Estimate the restricted mean survival time (RMST) and its variance from data</p></a></li>
<li><a href='#rmstpower'><p>Calculate powers at different cut-points based on difference of restricted mean survival times (RMST)</p></a></li>
<li><a href='#rmstpowerfindt'><p>Calculating the timepoint where a certain power of mean difference of RMSTs is obtained</p></a></li>
<li><a href='#rmstsim'><p>simulating the restricted mean survival times</p></a></li>
<li><a href='#rmstutil'><p>A utility function to calculate the true restricted mean survival time (RMST) and its variance</p>
account for delayed treatment, discontinued treatment and non-uniform entry</a></li>
<li><a href='#rpwe'><p>Piecewise exponential distribution: random number generation</p></a></li>
<li><a href='#rpwecx'><p>Piecewise exponential distribution with crossover effect: random number generation</p></a></li>
<li><a href='#rpwu'><p>Piecewise uniform distribution: random number generation</p></a></li>
<li><a href='#spf'><p>A utility function</p></a></li>
<li><a href='#wlrcal'><p>A utility function to calculate the weighted log-rank statistics and their varainces given the weights</p></a></li>
<li><a href='#wlrcom'><p>A function to calculate the various weighted log-rank statistics and their varainces</p></a></li>
<li><a href='#wlrutil'><p>A utility function to calculate some common functions in contructing weights</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Version:</td>
<td>1.3.0.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2018-10-18</td>
</tr>
<tr>
<td>Title:</td>
<td>Design and Monitoring of Survival Trials Accounting for Complex
Situations</td>
</tr>
<tr>
<td>Description:</td>
<td>Calculates various functions needed for design and monitoring survival trials
    accounting for complex situations such as delayed treatment effect, treatment crossover, non-uniform accrual,
    and different censoring distributions between groups. The event time distribution is assumed to be
    piecewise exponential (PWE) distribution and the entry time is assumed to be piecewise uniform distribution.
    As compared with Version 1.2.1, two more types of hybrid crossover are added. 
    A bug is corrected in the function "pwecx" that calculates the crossover-adjusted survival, distribution, 
    density, hazard and cumulative hazard functions. 
    Also, to generate the crossover-adjusted event time random variable,  a more efficient 
    algorithm is used and the output includes crossover indicators. </td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.1.2)</td>
</tr>
<tr>
<td>Imports:</td>
<td>survival, stats</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>5.0.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-08-09 04:22:22 UTC; ripley</td>
</tr>
<tr>
<td>Author:</td>
<td>Xiaodong Luo [aut, cre],
  Xuezhou Mao [ctb],
  Xun Chen [ctb],
  Hui Quan [ctb],
  Sanofi [cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Xiaodong Luo &lt;Xiaodong.Luo@sanofi.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-08-09 04:33:51 UTC</td>
</tr>
</table>
<hr>
<h2 id='cp'>Conditional power given observed log hazard ratio</h2><span id='topic+cp'></span>

<h3>Description</h3>

<p>This will calculate the conditional power given the observed log hazard ratio based on Cox model</p>


<h3>Usage</h3>

<pre><code class='language-R'>cp(Dplan=300,alpha=0.05,two.sided=1,pi1=0.5,Obsbeta=log(seq(1,0.6,by=-0.01)),
   BetaD=log(0.8),Beta0=log(1),prop=seq(0.1,0.9,by=0.1))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cp_+3A_dplan">Dplan</code></td>
<td>
<p>Planned number of events at study end</p>
</td></tr>
<tr><td><code id="cp_+3A_alpha">alpha</code></td>
<td>
<p>Type 1 error rate</p>
</td></tr>
<tr><td><code id="cp_+3A_two.sided">two.sided</code></td>
<td>
<p>=1 two-sided test and =0 one-sided test</p>
</td></tr>
<tr><td><code id="cp_+3A_pi1">pi1</code></td>
<td>
<p>Allocation probability for the treatment group</p>
</td></tr>
<tr><td><code id="cp_+3A_obsbeta">Obsbeta</code></td>
<td>
<p>observed log hazard ratio</p>
</td></tr>
<tr><td><code id="cp_+3A_betad">BetaD</code></td>
<td>
<p>designed log hazard ratio, i.e. under alternative hypothesis</p>
</td></tr>
<tr><td><code id="cp_+3A_beta0">Beta0</code></td>
<td>
<p>null log hazard ratio, i.e. under null hypothesis</p>
</td></tr>
<tr><td><code id="cp_+3A_prop">prop</code></td>
<td>
<p>proportion of <code>Dplan</code> observed</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is to calculated conditional power at time point when certain percent of target number of event has been observed and an observed log hazard ratio is provided.
</p>


<h3>Value</h3>

<table>
<tr><td><code>CPT</code></td>
<td>
<p>Conditional power under current trend</p>
</td></tr>
<tr><td><code>CPN</code></td>
<td>
<p>Conditional power under null hypothesis</p>
</td></tr>
<tr><td><code>CPD</code></td>
<td>
<p>Conditional power according to design, i.e. under alternative hypothesis</p>
</td></tr>
</table>


<h3>Note</h3>

<p>This will calculate the conditional power given the observed log hazard ratio based on Cox model</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Halperin, Lan, Ware, Johnson and DeMets (1982). Controlled Clinical Trials.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+cpboundary">cpboundary</a></code>,<code><a href="#topic+cpstop">cpstop</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>###Calculate the CP at 10-90 percent of the target 300 events when the observed HR 
###are seq(1,0.6,by=-0.01) with 2:1 allocation 
###ratio between the treatment group and the control group
cp(pi1=2/3)
</code></pre>

<hr>
<h2 id='cpboundary'>The stopping boundary based on the conditional power criteria</h2><span id='topic+cpboundary'></span>

<h3>Description</h3>

<p>This will calculate the stopping boundary based on the conditional power criteria, i.e. if observed HR is above the boundary, the conditional power will be lower than the designated level. All the calculation is based on the proportional hazards assumption and the Cox model.</p>


<h3>Usage</h3>

<pre><code class='language-R'>cpboundary(Dplan=300,alpha=0.05,two.sided=1,pi1=0.5,cpcut=c(0.2,0.3,0.4),
            BetaD=log(0.8),Beta0=log(1),prop=seq(0.1,0.9,by=0.1))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cpboundary_+3A_dplan">Dplan</code></td>
<td>
<p>Planned number of events at study end</p>
</td></tr>
<tr><td><code id="cpboundary_+3A_alpha">alpha</code></td>
<td>
<p>Type 1 error rate</p>
</td></tr>
<tr><td><code id="cpboundary_+3A_two.sided">two.sided</code></td>
<td>
<p>=1 two-sided test and =0 one-sided test</p>
</td></tr>
<tr><td><code id="cpboundary_+3A_pi1">pi1</code></td>
<td>
<p>Allocation probability for the treatment group</p>
</td></tr>
<tr><td><code id="cpboundary_+3A_cpcut">cpcut</code></td>
<td>
<p>the designated conditional power level</p>
</td></tr>
<tr><td><code id="cpboundary_+3A_betad">BetaD</code></td>
<td>
<p>designed log hazard ratio, i.e. under alternative hypothesis</p>
</td></tr>
<tr><td><code id="cpboundary_+3A_beta0">Beta0</code></td>
<td>
<p>null log hazard ratio, i.e. under null hypothesis</p>
</td></tr>
<tr><td><code id="cpboundary_+3A_prop">prop</code></td>
<td>
<p>proportion of <code>Dplan</code> observed</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This will calculate the stopping boundary based on the conditional power criteria, i.e. if observed HR is above the boundary, the conditional power will be lower than the designated level. All the calculation is based on the proportional hazards assumption and the Cox model.
</p>


<h3>Value</h3>

<table>
<tr><td><code>CPTbound</code></td>
<td>
<p>Boundary based on the conditional power under current trend</p>
</td></tr>
<tr><td><code>CPNbound</code></td>
<td>
<p>Boundary based on the conditional power under null hypothesis</p>
</td></tr>
<tr><td><code>CPDbound</code></td>
<td>
<p>Boundary based on the conditional power according to design, i.e. under alternative hypothesis</p>
</td></tr>
</table>


<h3>Note</h3>

<p>This will calculate the stopping boundary based on the conditional power criteria</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Halperin, Lan, Ware, Johnson and DeMets (1982). Controlled Clinical Trials.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+cp">cp</a></code>,<code><a href="#topic+cpstop">cpstop</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>###Calculate the stopping boundary at 10-90 percent of the target 300 events 
###when the condition power are c(0.2,0.3,0.4) with 
###2:1 allocation ratio between the treatment group and the control group
cpboundary(pi1=2/3)
</code></pre>

<hr>
<h2 id='cpstop'>The stopping probability based on the stopping boundary</h2><span id='topic+cpstop'></span>

<h3>Description</h3>

<p>This will calculate the stopping probability given the stopping boundary. All the calculation is based on the proportional hazards assumption and the Cox model.</p>


<h3>Usage</h3>

<pre><code class='language-R'>cpstop(Dplan=300,pi1=0.5,Beta1=log(0.8),Beta0=log(1),
        prop=seq(0.1,0.9,by=0.1),HRbound=rep(0.85,length(prop)))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cpstop_+3A_dplan">Dplan</code></td>
<td>
<p>Planned number of events at study end</p>
</td></tr>
<tr><td><code id="cpstop_+3A_pi1">pi1</code></td>
<td>
<p>Allocation probability for the treatment group</p>
</td></tr>
<tr><td><code id="cpstop_+3A_beta1">Beta1</code></td>
<td>
<p>designed log hazard ratio, i.e. under alternative hypothesis</p>
</td></tr>
<tr><td><code id="cpstop_+3A_beta0">Beta0</code></td>
<td>
<p>null log hazard ratio, i.e. under null hypothesis</p>
</td></tr>
<tr><td><code id="cpstop_+3A_prop">prop</code></td>
<td>
<p>proportion of <code>Dplan</code> observed</p>
</td></tr>
<tr><td><code id="cpstop_+3A_hrbound">HRbound</code></td>
<td>
<p>the stopping boundary</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This will calculate the stopping probability given the stopping boundary. All the calculation is based on the proportional hazards assumption and the Cox model.
</p>


<h3>Value</h3>

<table>
<tr><td><code>pstop0</code></td>
<td>
<p>Stopping probability under null hypothesis</p>
</td></tr>
<tr><td><code>pstop1</code></td>
<td>
<p>Stopping probability under alternative hypothesis</p>
</td></tr>
</table>


<h3>Note</h3>

<p>This will calculate the stopping probability given the stopping boundary</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Halperin, Lan, Ware, Johnson and DeMets (1982). Controlled Clinical Trials.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+cp">cp</a></code>,<code><a href="#topic+cpboundary">cpboundary</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>###Calculate the stopping boundary at 10-90 percent of the target 300 events 
###when the condition power are c(0.2,0.3,0.4) with 2:1 allocation ratio 
###between the treatment group and the control group, we pick the boundary 
###based on 20 percent conditional power according to design, i.e. under alternative
targetD&lt;-800 ###target number of events at study end
#############Allocation prob for the treatment group#############
pi1&lt;-2/3
propevent&lt;-seq(0.1,0.9,by=0.1) ###proportion of events at interim
HRbound&lt;-cpboundary(Dplan=targetD,pi1=pi1,prop=propevent)$CPDbound[,1]  ###picking a boundary
pa&lt;-cpstop(pi1=pi1,HRbound=HRbound)    ###stopping probabilities under null and alternative  
pa

###Calculate the stopping probability under non-constant hazard ratio
n1&lt;-length(propevent)

####time point at which hazard rates and hazard ratios change
tchange&lt;-c(0,6,12,24)                       
###annual event rates=0.09(1st yr), 0.07(2nd yr) and 0.05(2+yr) for control
ratet&lt;-c(0.09/12,0.09/12,0.07/12,0.05/12)   
###annual censoring rate=0%(1st yr) and 1.5%(after) for control and treatment
ratec0&lt;-c(0/12,0/12,0.015/12,0.015/12)      
ratec1&lt;-ratec0                              
###annual treatment discontinuation rate=4% (1st yr) and 3% (after)
rate31&lt;-c(0.04/12,0.04/12,0.03/12,0.03/12)  
rate30&lt;-rep(0,length(tchange))              

############Recruitment curve##################
oa&lt;-c(100,200,300,300,400,400,400,400,400,400,400,400,300,200)
ntotal&lt;-sum(oa)
ntotal

taur&lt;-length(oa)
ut&lt;-seq(1,taur,by=1)
u&lt;-oa/ntotal


#############Type-1 error rate#############
alpha&lt;-0.05

####null hypothesis
eta0&lt;-log(1)

####constant HR
etac&lt;-log(0.8)

####non-constant HR
eta&lt;-c(log(1),log(0.75),log(0.75),log(0.75)) ###6-m delayed 


####target number of events where calculations are performed##############
sevent&lt;-propevent*targetD
nse&lt;-length(sevent)
xtimeline&lt;-xbeta&lt;-xvar&lt;-pxstop&lt;-matrix(0,ncol=2,nrow=nse)
xtimeline[,1]&lt;-xbeta[,1]&lt;-xvar[,1]&lt;-pxstop[,1]&lt;-sevent
i&lt;-1
tbegin&lt;-proc.time()
for (i in 1:nse){
###find timeline
xtimeline[i,2]&lt;-pwecxpwufindt(target=sevent[i],ntotal=ntotal,
                taur=taur,u=u,ut=ut,pi1=0.5,
                rate11=exp(eta)*ratet,rate21=exp(eta)*ratet,rate31=rate31,ratec1=ratec1,
                rate10=ratet,rate20=ratet,rate30=rate30,ratec0=ratec0,
                tchange=tchange,eps=0.001,init=taur,epsilon=0.000001,maxiter=100)$tau1

#Overall hazard ratio and varaince
xbeta[i,2]&lt;-ovbeta(tfix=xtimeline[i,2],taur=taur,u=u,ut=ut,pi1=pi1,
                rate11=exp(eta)*ratet,rate21=exp(eta)*ratet,rate31=rate31,ratec1=ratec1,
                rate10=ratet,rate20=ratet,rate30=rate30,ratec0=ratec0,
                tchange=tchange,eps=0.001,veps=0.001,epsbeta=1.0e-10)$b1
xvar[i,2]&lt;-overallvar(tfix=xtimeline[i,2],taur=taur,u=u,ut=ut,pi1=pi1,
                rate11=exp(eta)*ratet,rate21=exp(eta)*ratet,rate31=rate31,ratec1=ratec1,
                rate10=ratet,rate20=ratet,rate30=rate30,ratec0=ratec0,
                tchange=tchange,eps=0.001,veps=0.001,beta=xbeta[i,2])$vbeta
}
##stopping prob
pxstop[,2]&lt;-1-pnorm(sqrt(ntotal)*(log(HRbound)-xbeta[,2])/sqrt(xvar[,2]))
tend&lt;-proc.time()

xout&lt;-cbind(xtimeline[,1],xtimeline[,2],xbeta[,2],xvar[,2]/ntotal,
            1/pi1/(1-pi1)/xtimeline[,1],pxstop[,2],pa$pstop0,pa$pstop1)
xnames&lt;-c("# of events", "Time", "Estbeta", "TrueV", "ApproxV", "NCHR", "Null", "CHR")
colnames(xout)&lt;-xnames
options(digits=2)
xout
</code></pre>

<hr>
<h2 id='fourhr'>A utility functon</h2><span id='topic+fourhr'></span>

<h3>Description</h3>

<p>This will calculate the more complex integration</p>


<h3>Usage</h3>

<pre><code class='language-R'>fourhr(t=seq(0,5,by=0.5),rate1=c(0,5,0.8),rate2=rate1,
                   rate3=c(0.1,0.2),rate4=rate2,tchange=c(0,3),eps=1.0e-2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fourhr_+3A_t">t</code></td>
<td>
<p>A vector of time points</p>
</td></tr>
<tr><td><code id="fourhr_+3A_rate1">rate1</code></td>
<td>
<p>piecewise constant event rate</p>
</td></tr>
<tr><td><code id="fourhr_+3A_rate2">rate2</code></td>
<td>
<p>piecewise constant event rate</p>
</td></tr>
<tr><td><code id="fourhr_+3A_rate3">rate3</code></td>
<td>
<p>piecewise constant event rate</p>
</td></tr>
<tr><td><code id="fourhr_+3A_rate4">rate4</code></td>
<td>
<p>additional piecewise constant</p>
</td></tr>
<tr><td><code id="fourhr_+3A_tchange">tchange</code></td>
<td>
<p>a strictly increasing sequence of time points starting from zero at which event rate changes. The first element of tchange must be zero. The above rates and tchange must have the same length.</p>
</td></tr>
<tr><td><code id="fourhr_+3A_eps">eps</code></td>
<td>
<p>tolerance</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Let <code class="reqn">h_1,\ldots,h_4</code> correspond to <code>rate1</code>,...,<code>rate4</code>, and <code class="reqn">H_1,\ldots,H_4</code> be the corresponding survival functions. 
We calculate
</p>
<p style="text-align: center;"><code class="reqn">\int_0^t h_1(s)H_2(s)h_3(t-s)H_4(t-s)ds.</code>
</p>



<h3>Value</h3>

<table>
<tr><td><code>fx</code></td>
<td>
<p>values</p>
</td></tr>
</table>


<h3>Note</h3>

<p>This provides the result of the complex integration</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo et al. (2018) Design and monitoring of survival trials in complex scenarios, Statistics in Medicine &lt;doi: https://doi.org/10.1002/sim.7975&gt;.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rpwe">rpwe</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>r1&lt;-c(0.6,0.3)
r2&lt;-c(0.6,0.6)
r3&lt;-c(0.1,0.2)
r4&lt;-c(0.5,0.4)
tchange&lt;-c(0,1.75)
fourhrfun&lt;-fourhr(t=seq(0,5,by=0.5),rate1=r1,rate2=r2,rate3=r3,
                 rate4=r4,tchange=c(0,3),eps=1.0e-2)
fourhrfun
</code></pre>

<hr>
<h2 id='hxbeta'>A function to calculate the beta-smoothed hazard rate</h2><span id='topic+hxbeta'></span>

<h3>Description</h3>

<p>A function to calculate the beta-smoothed hazard rate</p>


<h3>Usage</h3>

<pre><code class='language-R'>hxbeta(x=c(0.5,1),y=seq(.1,1,by=0.01),d=rep(1,length(y)),
           tfix=2,K=20,eps=1.0e-06)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hxbeta_+3A_x">x</code></td>
<td>
<p>time points where the estimated hazards are calculated</p>
</td></tr>
<tr><td><code id="hxbeta_+3A_y">y</code></td>
<td>
<p>observed times</p>
</td></tr>
<tr><td><code id="hxbeta_+3A_d">d</code></td>
<td>
<p>non-censoring indicators</p>
</td></tr>
<tr><td><code id="hxbeta_+3A_tfix">tfix</code></td>
<td>
<p>maximum time point at which the hazard function is estimated</p>
</td></tr>
<tr><td><code id="hxbeta_+3A_k">K</code></td>
<td>
<p>smooth parameter for the hazard estimate</p>
</td></tr>
<tr><td><code id="hxbeta_+3A_eps">eps</code></td>
<td>
<p>the error tolerance when comparing event times</p>
</td></tr>
</table>


<h3>Details</h3>

<p>V1:3/21/2018</p>


<h3>Value</h3>

<table>
<tr><td><code>lambda</code></td>
<td>
<p>estimated hazard at points <code>x</code></p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>Examples</h3>

<pre><code class='language-R'>n&lt;-200
taur&lt;-2.8
u&lt;-c(1/taur,1/taur)
ut&lt;-c(taur/2,taur)
tfix&lt;-taur+2
tseq&lt;-seq(0,tfix,by=0.1)
r11&lt;-c(1,0.5)
r21&lt;-c(0.5,0.8)
r31&lt;-c(0.7,0.4)
r41&lt;-r51&lt;-r21
rc1&lt;-c(0.5,0.6)
tchange&lt;-c(0,1.873)

E&lt;-T&lt;-C&lt;-d&lt;-rep(0,n)
E&lt;-rpwu(nr=n,u=u,ut=ut)$r
C&lt;-rpwe(nr=n,rate=rc1,tchange=tchange)$r
T&lt;-rpwecx(nr=n,rate1=r11,rate2=r21,rate3=r31,
               rate4=r41,rate5=r51,tchange=tchange,type=1)$r
y&lt;-pmin(pmin(T,C),tfix-E)
y1&lt;-pmin(C,tfix-E)
d[T&lt;=y]&lt;-1

lambda=hxbeta(x=tseq,y=y,d=d,tfix=tfix,K=20,eps=1.0e-06)$lambda
lambda
</code></pre>

<hr>
<h2 id='innercov'>A utility function to calculate the inner integration of the overall covariance</h2><span id='topic+innercov'></span>

<h3>Description</h3>

<p>This will calculate the inner integration of the overall covariance accouting for staggered entry, delayed treatment effect,  treatment crossover and loss to follow-up.</p>


<h3>Usage</h3>

<pre><code class='language-R'>innercov(tupp=seq(0,10,by=0.5),tlow=tupp-0.1,taur=5,
                   u=c(1/taur,1/taur),ut=c(taur/2,taur),pi1=0.5,
                   rate11=c(1,0.5),rate21=rate11,rate31=c(0.7,0.4),
                   rate41=rate21,rate51=rate21,ratec1=c(0.5,0.6),
                   rate10=rate11,rate20=rate10,rate30=rate31,
                   rate40=rate20,rate50=rate20,ratec0=ratec1,
                   tchange=c(0,1),type1=1,type0=1,
                   rp21=0.5,rp20=0.5,
                   eps=1.0e-2,veps=1.0e-2,beta=0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="innercov_+3A_tupp">tupp</code></td>
<td>
<p>A vector of upper bounds</p>
</td></tr>
<tr><td><code id="innercov_+3A_tlow">tlow</code></td>
<td>
<p>A vector of lower bounds</p>
</td></tr>
<tr><td><code id="innercov_+3A_taur">taur</code></td>
<td>
<p>recruitment time</p>
</td></tr>
<tr><td><code id="innercov_+3A_u">u</code></td>
<td>
<p>Piecewise constant recuitment rate</p>
</td></tr>
<tr><td><code id="innercov_+3A_ut">ut</code></td>
<td>
<p>Recruitment intervals</p>
</td></tr>
<tr><td><code id="innercov_+3A_pi1">pi1</code></td>
<td>
<p>Allocation probability for the treatment group</p>
</td></tr>
<tr><td><code id="innercov_+3A_rate11">rate11</code></td>
<td>
<p>Hazard before crossover for the treatment group</p>
</td></tr>
<tr><td><code id="innercov_+3A_rate21">rate21</code></td>
<td>
<p>Hazard after crossover for the treatment group</p>
</td></tr>
<tr><td><code id="innercov_+3A_rate31">rate31</code></td>
<td>
<p>Hazard for time to crossover for the treatment group</p>
</td></tr>
<tr><td><code id="innercov_+3A_rate41">rate41</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="innercov_+3A_rate51">rate51</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="innercov_+3A_ratec1">ratec1</code></td>
<td>
<p>Hazard for time to censoring for the treatment group</p>
</td></tr>
<tr><td><code id="innercov_+3A_rate10">rate10</code></td>
<td>
<p>Hazard before crossover for the control group</p>
</td></tr>
<tr><td><code id="innercov_+3A_rate20">rate20</code></td>
<td>
<p>Hazard after crossover for the control group</p>
</td></tr>
<tr><td><code id="innercov_+3A_rate30">rate30</code></td>
<td>
<p>Hazard for time to crossover for the control group</p>
</td></tr>
<tr><td><code id="innercov_+3A_rate40">rate40</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="innercov_+3A_rate50">rate50</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="innercov_+3A_ratec0">ratec0</code></td>
<td>
<p>Hazard for time to censoring for the control group</p>
</td></tr>
<tr><td><code id="innercov_+3A_tchange">tchange</code></td>
<td>
<p>A strictly increasing sequence of time points at which the event rates changes. The first element of tchange                 must be zero. It must have the same length as <code>rate11</code>, <code>rate21</code>, <code>rate31</code>, etc.</p>
</td></tr>
<tr><td><code id="innercov_+3A_type1">type1</code></td>
<td>
<p>Type of crossover in the treatment group</p>
</td></tr>
<tr><td><code id="innercov_+3A_type0">type0</code></td>
<td>
<p>Type of crossover in the control group</p>
</td></tr>
<tr><td><code id="innercov_+3A_rp21">rp21</code></td>
<td>
<p>re-randomization prob for the treatment group</p>
</td></tr>
<tr><td><code id="innercov_+3A_rp20">rp20</code></td>
<td>
<p>re-randomization prob for the control group</p>
</td></tr>
<tr><td><code id="innercov_+3A_eps">eps</code></td>
<td>
<p>A small number representing the error tolerance when calculating the utility function
</p>
<p style="text-align: center;"><code class="reqn">\Phi_l(x)=\frac{\int_0^x s^l e^{-s}ds}{x^{l+1}}</code>
</p>
<p> with <code class="reqn">l=0,1,2</code>.</p>
</td></tr>
<tr><td><code id="innercov_+3A_veps">veps</code></td>
<td>
<p>A small number representing the error tolerance when calculating the integrations.</p>
</td></tr>
<tr><td><code id="innercov_+3A_beta">beta</code></td>
<td>
<p>The value at which the inner part of the covaraince is computed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The hazard functions corresponding to <code>rate11</code>,...,<code>rate51</code>,<code>ratec1</code>, <code>rate10</code>,...,<code>rate50</code>,<code>ratec0</code> are all piecewise constant function taking the form  <code class="reqn">\lambda(t)=\sum_{j=1}^m \lambda_j I(t_{j-1}\le t&lt;t_j)</code>, where <code class="reqn">\lambda_1,\ldots,\lambda_m</code> are the corresponding elements of the rates and <code class="reqn">t_0,\ldots,t_{m-1}</code> are the corresponding elements of <cite>tchange</cite>, <code class="reqn">t_m=\infty</code>. Note that all the rates must have the same <code>tchange</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>qf1</code></td>
<td>
<p>The first part of the inner integration</p>
</td></tr>
<tr><td><code>qf2</code></td>
<td>
<p>The second part of the inner integration</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Version 1.0 (7/19/2016)</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo et al. (2018) Design and monitoring of survival trials in complex scenarios, Statistics in Medicine &lt;doi: https://doi.org/10.1002/sim.7975&gt;.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pwe">pwe</a></code>,<code><a href="#topic+rpwe">rpwe</a></code>,<code><a href="#topic+qpwe">qpwe</a></code>,<code><a href="#topic+pwecx">pwecx</a></code>,<code><a href="#topic+ovbeta">ovbeta</a></code>,<code><a href="#topic+innervar">innervar</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>taur&lt;-1.2
u&lt;-c(1/taur,1/taur)
ut&lt;-c(taur/2,taur)
r11&lt;-c(1,0.5)
r21&lt;-c(0.5,0.8)
r31&lt;-c(0.7,0.4)
r41&lt;-r51&lt;-r21
rc1&lt;-c(0.5,0.6)
r10&lt;-c(1,0.7)
r20&lt;-c(0.5,1)
r30&lt;-c(0.3,0.4)
r40&lt;-r50&lt;-r20
rc0&lt;-c(0.2,0.4)
getinner&lt;-innercov(tupp=rep(5,times=11),tlow=seq(0,5,by=0.5),taur=taur,u=u,ut=ut,pi1=0.5,
                     rate11=r11,rate21=r21,rate31=r31,
                     rate41=r41,rate51=r51,ratec1=rc1,
                     rate10=r10,rate20=r20,rate30=r30,
                     rate40=r40,rate50=r50,ratec0=rc0,
                     tchange=c(0,1),type1=1,type0=1,
                     eps=1.0e-2,veps=1.0e-2,beta=0.5)
cbind(getinner$qf1,getinner$qf0)
</code></pre>

<hr>
<h2 id='innervar'>A utility function to calculate the inner integration of the overall variance</h2><span id='topic+innervar'></span>

<h3>Description</h3>

<p>This will calculate the inner integration of the overall variance accouting for staggered entry, delayed treatment effect,  treatment crossover and loss to follow-up.</p>


<h3>Usage</h3>

<pre><code class='language-R'>innervar(t=seq(0,10,by=0.5),taur=5,u=c(1/taur,1/taur),ut=c(taur/2,taur),pi1=0.5,
                     rate11=c(1,0.5),rate21=rate11,rate31=c(0.7,0.4),
                     rate41=rate21,rate51=rate21,ratec1=c(0.5,0.6),
                     rate10=rate11,rate20=rate10,rate30=rate31,
                     rate40=rate20,rate50=rate20,ratec0=c(0.6,0.5),
                     tchange=c(0,1),type1=1,type0=1,
                     rp21=0.5,rp20=0.5,
                     eps=1.0e-2,veps=1.0e-2,beta=0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="innervar_+3A_t">t</code></td>
<td>
<p>A vector of time points where the integration is calculated.</p>
</td></tr>
<tr><td><code id="innervar_+3A_taur">taur</code></td>
<td>
<p>Recruitment time</p>
</td></tr>
<tr><td><code id="innervar_+3A_u">u</code></td>
<td>
<p>Piecewise constant recuitment rate</p>
</td></tr>
<tr><td><code id="innervar_+3A_ut">ut</code></td>
<td>
<p>Recruitment intervals</p>
</td></tr>
<tr><td><code id="innervar_+3A_pi1">pi1</code></td>
<td>
<p>Allocation probability for the treatment group</p>
</td></tr>
<tr><td><code id="innervar_+3A_rate11">rate11</code></td>
<td>
<p>Hazard before crossover for the treatment group</p>
</td></tr>
<tr><td><code id="innervar_+3A_rate21">rate21</code></td>
<td>
<p>Hazard after crossover for the treatment group</p>
</td></tr>
<tr><td><code id="innervar_+3A_rate31">rate31</code></td>
<td>
<p>Hazard for time to crossover for the treatment group</p>
</td></tr>
<tr><td><code id="innervar_+3A_rate41">rate41</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="innervar_+3A_rate51">rate51</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="innervar_+3A_ratec1">ratec1</code></td>
<td>
<p>Hazard for time to censoring for the treatment group</p>
</td></tr>
<tr><td><code id="innervar_+3A_rate10">rate10</code></td>
<td>
<p>Hazard before crossover for the control group</p>
</td></tr>
<tr><td><code id="innervar_+3A_rate20">rate20</code></td>
<td>
<p>Hazard after crossover for the control group</p>
</td></tr>
<tr><td><code id="innervar_+3A_rate30">rate30</code></td>
<td>
<p>Hazard for time to crossover for the control group</p>
</td></tr>
<tr><td><code id="innervar_+3A_rate40">rate40</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="innervar_+3A_rate50">rate50</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="innervar_+3A_ratec0">ratec0</code></td>
<td>
<p>Hazard for time to censoring for the control group</p>
</td></tr>
<tr><td><code id="innervar_+3A_tchange">tchange</code></td>
<td>
<p>A strictly increasing sequence of time points at which the event rates changes. The first element of tchange                 must be zero. It must have the same length as <code>rate11</code>, <code>rate21</code>, <code>rate31</code>, etc.</p>
</td></tr>
<tr><td><code id="innervar_+3A_type1">type1</code></td>
<td>
<p>Type of crossover in the treatment group</p>
</td></tr>
<tr><td><code id="innervar_+3A_type0">type0</code></td>
<td>
<p>Type of crossover in the control group</p>
</td></tr>
<tr><td><code id="innervar_+3A_rp21">rp21</code></td>
<td>
<p>re-randomization prob for the treatment group</p>
</td></tr>
<tr><td><code id="innervar_+3A_rp20">rp20</code></td>
<td>
<p>re-randomization prob for the control group</p>
</td></tr>
<tr><td><code id="innervar_+3A_eps">eps</code></td>
<td>
<p>A small number representing the error tolerance when calculating the utility function
</p>
<p style="text-align: center;"><code class="reqn">\Phi_l(x)=\frac{\int_0^x s^l e^{-s}ds}{x^{l+1}}</code>
</p>
<p> with <code class="reqn">l=0,1,2</code>.</p>
</td></tr>
<tr><td><code id="innervar_+3A_veps">veps</code></td>
<td>
<p>A small number representing the error tolerance when calculating the Fisher information.</p>
</td></tr>
<tr><td><code id="innervar_+3A_beta">beta</code></td>
<td>
<p>The value at which the varaince is computed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The hazard functions corresponding to <code>rate11</code>,...,<code>rate51</code>,<code>ratec1</code>, <code>rate10</code>,...,<code>rate50</code>,<code>ratec0</code> are all piecewise constant function taking the form  <code class="reqn">\lambda(t)=\sum_{j=1}^m \lambda_j I(t_{j-1}\le t&lt;t_j)</code>, where <code class="reqn">\lambda_1,\ldots,\lambda_m</code> are the corresponding elements of the rates and <code class="reqn">t_0,\ldots,t_{m-1}</code> are the corresponding elements of <cite>tchange</cite>, <code class="reqn">t_m=\infty</code>. Note that all the rates must have the same <code>tchange</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>qf1</code></td>
<td>
<p>The first part of the inner integration</p>
</td></tr>
<tr><td><code>qf2</code></td>
<td>
<p>The second part of the inner integration</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Version 1.0 (7/19/2016)</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo et al. (2018) Design and monitoring of survival trials in complex scenarios, Statistics in Medicine &lt;doi: https://doi.org/10.1002/sim.7975&gt;.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pwe">pwe</a></code>,<code><a href="#topic+rpwe">rpwe</a></code>,<code><a href="#topic+qpwe">qpwe</a></code>,<code><a href="#topic+pwecx">pwecx</a></code>,<code><a href="#topic+ovbeta">ovbeta</a></code>,<code><a href="#topic+innervar">innervar</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>taur&lt;-1.2
u&lt;-c(1/taur,1/taur)
ut&lt;-c(taur/2,taur)
r11&lt;-c(1,0.5)
r21&lt;-c(0.5,0.8)
r31&lt;-c(0.7,0.4)
r41&lt;-r51&lt;-r21
rc1&lt;-c(0.5,0.6)
r10&lt;-c(1,0.7)
r20&lt;-c(0.5,1)
r30&lt;-c(0.3,0.4)
r40&lt;-r50&lt;-r20
rc0&lt;-c(0.2,0.4)
getinner&lt;-innervar(t=seq(0,10,by=0.5),taur=taur,u=u,ut=ut,pi1=0.5,
                     rate11=r11,rate21=r21,rate31=r31,
                     rate41=r41,rate51=r51,ratec1=rc1,
                     rate10=r10,rate20=r20,rate30=r30,
                     rate40=r40,rate50=r50,ratec0=rc0,
                     tchange=c(0,1),type1=1,type0=1,
                     eps=1.0e-2,veps=1.0e-2,beta=0.5)
cbind(getinner$qf1,getinner$qf0)
</code></pre>

<hr>
<h2 id='instudyfindt'>calculate the timeline in study when some or all subjects have entered</h2><span id='topic+instudyfindt'></span>

<h3>Description</h3>

<p>This will calculate the timeline from some timepoint in study when some/all subjects have entered accouting for staggered entry, delayed treatment effect,  treatment crossover and loss to follow-up.</p>


<h3>Usage</h3>

<pre><code class='language-R'>instudyfindt(target=400,y=exp(rnorm(300)),z=rbinom(300,1,0.5),
                  d=rep(c(0,1,2),each=100),
                  tcut=2,blinded=1,type0=1,type1=type0,
                  rp20=0.5,rp21=0.5,tchange=c(0,1),
                  rate10=c(1,0.7),rate20=c(0.9,0.7),rate30=c(0.4,0.6),rate40=rate20,
                  rate50=rate20,ratec0=c(0.3,0.3),
                  rate11=rate10,rate21=rate20,rate31=rate30,
                  rate41=rate40,rate51=rate50,ratec1=ratec0,
                  withmorerec=1,
                  ntotal=1000,taur=5,u=c(1/taur,1/taur),ut=c(taur/2,taur),pi1=0.5,
                  ntype0=1,ntype1=1,
                  nrp20=0.5,nrp21=0.5,ntchange=c(0,1),
                  nrate10=rate10,nrate20=rate20,nrate30=rate30,nrate40=rate40,
                  nrate50=rate50,nratec0=ratec0,
                  nrate11=rate10,nrate21=rate20,nrate31=rate30,nrate41=rate40,
                  nrate51=rate50,nratec1=ratec0,
                  eps=1.0e-2,init=tcut*1.1,epsilon=0.001,maxiter=100)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="instudyfindt_+3A_target">target</code></td>
<td>
<p>target number of events</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_y">y</code></td>
<td>
<p>observed times</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_z">z</code></td>
<td>
<p>observed treatment indicator when <code>blinded</code>=0, z=1 denotes the treatment group and 0 the control group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_d">d</code></td>
<td>
<p>event indicator, 1=event, 0=censored, 2=no event or censored up to <code>tcut</code>, the data cut-point</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_tcut">tcut</code></td>
<td>
<p>the data cut-point</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_blinded">blinded</code></td>
<td>
<p>blinded=1 if the data is blinded,=0 if it is unblinded</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_type0">type0</code></td>
<td>
<p>type of the crossover for the observed data in the control group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_type1">type1</code></td>
<td>
<p>type of the crossover for the observed data in the treatment group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_rp20">rp20</code></td>
<td>
<p>re-randomization prob for the observed data in the control group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_rp21">rp21</code></td>
<td>
<p>re-randomization prob for the observed data in the treatment group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_tchange">tchange</code></td>
<td>
<p>A strictly increasing sequence of time points at which the event rates changes. The first element of tchange                 must be zero. It must have the same length as <code>ratejk</code>, j=1,2,3,4,5,c; k=0,1</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_rate10">rate10</code></td>
<td>
<p>Hazard before crossover for the old subjects in the control group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_rate20">rate20</code></td>
<td>
<p>Hazard after crossover for the old subjects in the control group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_rate30">rate30</code></td>
<td>
<p>Hazard for time to crossover for the old subjects in the control group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_rate40">rate40</code></td>
<td>
<p>Hazard after crossover for the old subjects in the control group for complex case</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_rate50">rate50</code></td>
<td>
<p>Hazard after crossover for the old subjects in the control group for complex case</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_ratec0">ratec0</code></td>
<td>
<p>Hazard for time to censoring for the old subjects in the control group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_rate11">rate11</code></td>
<td>
<p>Hazard before crossover for the old subjects in the treatment group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_rate21">rate21</code></td>
<td>
<p>Hazard after crossover for the old subjects in the treatment group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_rate31">rate31</code></td>
<td>
<p>Hazard for time to crossover for the old subjects in the treatment group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_rate41">rate41</code></td>
<td>
<p>Hazard after crossover for the old subjects in the treatment group for complex case</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_rate51">rate51</code></td>
<td>
<p>Hazard after crossover for the old subjects in the treatment group for complex case</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_ratec1">ratec1</code></td>
<td>
<p>Hazard for time to censoring for the old subjects in the treatment group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_withmorerec">withmorerec</code></td>
<td>
<p>withmorerec=1 if more subjects are needed to be recruited; =0 otherwise</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_ntotal">ntotal</code></td>
<td>
<p>total number of the potential new subjects</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_taur">taur</code></td>
<td>
<p>recruitment time for the potential new subjects</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_u">u</code></td>
<td>
<p>Piecewise constant recuitment rate for the potential new subjects</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_ut">ut</code></td>
<td>
<p>Recruitment intervals for the potential new subjects</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_pi1">pi1</code></td>
<td>
<p>Allocation probability to the treatment group for the potential new subjects</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_ntype0">ntype0</code></td>
<td>
<p>type of the crossover for the potential new subjects in the control group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_ntype1">ntype1</code></td>
<td>
<p>type of the crossover for the potential new subjects in the treatment group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_nrp20">nrp20</code></td>
<td>
<p>re-randomization prob for the potential new subjects in the control group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_nrp21">nrp21</code></td>
<td>
<p>re-randomization prob for the potential new subjects in the treatment group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_ntchange">ntchange</code></td>
<td>
<p>A strictly increasing sequence of time points at which the event rates changes. The first element of ntchange must be zero. It must have the same length as <code>nratejk</code>, j=1,2,3,4,5,c; k=0,1</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_nrate10">nrate10</code></td>
<td>
<p>Hazard before crossover for the potential new subjects in the control group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_nrate20">nrate20</code></td>
<td>
<p>Hazard after crossover for the potential new subjects in the control group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_nrate30">nrate30</code></td>
<td>
<p>Hazard for time to crossover for the potential new subjects in the control group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_nrate40">nrate40</code></td>
<td>
<p>Hazard after crossover for the potential new subjects in the control group for complex case</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_nrate50">nrate50</code></td>
<td>
<p>Hazard after crossover for the potential new subjects in the control group for complex case</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_nratec0">nratec0</code></td>
<td>
<p>Hazard for time to censoring for the potential new subjects in the control group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_nrate11">nrate11</code></td>
<td>
<p>Hazard before crossover for the potential new subjects in the treatment group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_nrate21">nrate21</code></td>
<td>
<p>Hazard after crossover for the potential new subjects in the treatment group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_nrate31">nrate31</code></td>
<td>
<p>Hazard for time to crossover for the potential new subjects in the treatment group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_nrate41">nrate41</code></td>
<td>
<p>Hazard after crossover for the potential new subjects in the treatment group for complex case</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_nrate51">nrate51</code></td>
<td>
<p>Hazard after crossover for the potential new subjects in the treatment group for complex case</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_nratec1">nratec1</code></td>
<td>
<p>Hazard for time to censoring for the potential new subjects in the treatment group</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_eps">eps</code></td>
<td>
<p>A small number representing the error tolerance when calculating the utility function
</p>
<p style="text-align: center;"><code class="reqn">\Phi_l(x)=\frac{\int_0^x s^l e^{-s}ds}{x^{l+1}}</code>
</p>
<p> with <code class="reqn">l=0,1,2</code>.</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_init">init</code></td>
<td>
<p>initital value of the timeline estimate</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_epsilon">epsilon</code></td>
<td>
<p>A small number representing the error tolerance when calculating the timeline.</p>
</td></tr>
<tr><td><code id="instudyfindt_+3A_maxiter">maxiter</code></td>
<td>
<p>Maximum number of iterations when calculating the timeline</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The hazard functions corresponding to <code>rate11</code>,...,<code>rate51</code>,<code>ratec1</code>, <code>rate10</code>,...,<code>rate50</code>,<code>ratec0</code> are all piecewise constant function taking the form  <code class="reqn">\lambda(t)=\sum_{j=1}^m \lambda_j I(t_{j-1}\le t&lt;t_j)</code>, where <code class="reqn">\lambda_1,\ldots,\lambda_m</code> are the corresponding elements of the rates and <code class="reqn">t_0,\ldots,t_{m-1}</code> are the corresponding elements of <cite>tchange</cite>, <code class="reqn">t_m=\infty</code>. Note that all the rates must have the same <code>tchange</code>.
The hazard functions corresponding to <code>nrate11</code>,...,<code>nrate51</code>,<code>nratec1</code>, <code>nrate10</code>,...,<code>nrate50</code>,<code>nratec0</code> are all piecewise constant functions and all must have the same <code>ntchange</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>t1</code></td>
<td>
<p>the calculated timeline</p>
</td></tr>
<tr><td><code>dvalue</code></td>
<td>
<p>the number of events</p>
</td></tr>
<tr><td><code>dvprime</code></td>
<td>
<p>the derivative of the event cummulative function at time <code>t1</code></p>
</td></tr>
<tr><td><code>tvar</code></td>
<td>
<p>the variance of the timeline estimator</p>
</td></tr>
<tr><td><code>ny</code></td>
<td>
<p>total number of subjects that could be in the study</p>
</td></tr>
<tr><td><code>eps</code></td>
<td>
<p>final tolerance</p>
</td></tr>
<tr><td><code>iter</code></td>
<td>
<p>Number of iterations performed</p>
</td></tr>
<tr><td><code>t1hist</code></td>
<td>
<p>the history of the iteration for timeline</p>
</td></tr>
<tr><td><code>dvaluehist</code></td>
<td>
<p>the history of the iteration for the event count</p>
</td></tr>
<tr><td><code>dvprimehist</code></td>
<td>
<p>the history of the iteration for the derivative of event count with respect to time</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Version 1.0 (7/19/2016)</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pwe">pwe</a></code>,<code><a href="#topic+rpwe">rpwe</a></code>,<code><a href="#topic+qpwe">qpwe</a></code>,<code><a href="#topic+pwecxpwufindt">pwecxpwufindt</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>n&lt;-1000
target&lt;-550
ntotal&lt;-1000
pi1&lt;-0.5
taur&lt;-2.8
u&lt;-c(1/taur,1/taur)
ut&lt;-c(taur/2,taur)
r11&lt;-c(1,0.5)
r21&lt;-c(0.5,0.8)
r31&lt;-c(0.7,0.4)
r41&lt;-r51&lt;-r21
rc1&lt;-c(0.5,0.6)
r10&lt;-c(1,0.7)
r20&lt;-c(0.5,1)
r30&lt;-c(0.3,0.4)
r40&lt;-r50&lt;-r20
rc0&lt;-c(0.2,0.4)
tchange&lt;-c(0,1.873)
tcut&lt;-2

####generate the data
E&lt;-T&lt;-C&lt;-Z&lt;-delta&lt;-rep(0,n)
E&lt;-rpwu(nr=n,u=u,ut=ut)$r
Z&lt;-rbinom(n,1,pi1)
n1&lt;-sum(Z)
n0&lt;-sum(1-Z)
C[Z==1]&lt;-rpwe(nr=n1,rate=rc1,tchange=tchange)$r
C[Z==0]&lt;-rpwe(nr=n0,rate=rc0,tchange=tchange)$r
T[Z==1]&lt;-rpwecx(nr=n1,rate1=r11,rate2=r21,rate3=r31,
                rate4=r41,rate5=r51,tchange=tchange,type=1)$r
T[Z==0]&lt;-rpwecx(nr=n0,rate1=r10,rate2=r20,rate3=r30,
                rate4=r40,rate5=r50,tchange=tchange,type=1)$r
y&lt;-pmin(pmin(T,C),tcut-E)
y1&lt;-pmin(C,tcut-E)
delta[T&lt;=y]&lt;-1
delta[C&lt;=y]&lt;-0
delta[tcut-E&lt;=y &amp; tcut-E&gt;0]&lt;-2
delta[tcut-E&lt;=y &amp; tcut-E&lt;=0]&lt;--1

ys&lt;-y[delta&gt;-1]
Zs&lt;-Z[delta&gt;-1]
ds&lt;-delta[delta&gt;-1]

nplus&lt;-sum(delta==-1)
nd0&lt;-sum(ds==0)
nd1&lt;-sum(ds==1)
nd2&lt;-sum(ds==2)


ntaur&lt;-taur-tcut
nu&lt;-c(1/ntaur,1/ntaur)
nut&lt;-c(ntaur/2,ntaur)

###calculate the timeline at baseline
xt&lt;-pwecxpwufindt(target=target,ntotal=n,taur=taur,u=u,ut=ut,pi1=pi1,
              rate11=r11,rate21=r21,rate31=r31,ratec1=rc1,
              rate10=r10,rate20=r20,rate30=r30,ratec0=rc0,
              tchange=tchange,eps=0.001,init=taur,epsilon=0.000001,maxiter=100)
###calculate the timeline in study
yt&lt;-instudyfindt(target=target,y=ys,z=Zs,d=ds,
                       tcut=tcut,blinded=0,type1=1,type0=1,tchange=tchange,
                       rate10=r10,rate20=r20,rate30=r30,ratec0=rc0,
                       rate11=r11,rate21=r21,rate31=r31,ratec1=rc1,
                       withmorerec=1,
                       ntotal=nplus,taur=ntaur,u=nu,ut=nut,pi1=pi1,
                       ntype1=1,ntype0=1,ntchange=tchange,
                       nrate10=r10,nrate20=r20,nrate30=r30,nratec0=rc0,
                       nrate11=r11,nrate21=r21,nrate31=r31,nratec1=rc1,
                       eps=1.0e-2,init=2,epsilon=0.001,maxiter=100)
##timelines                       
c(yt$t1,xt$t1)
##standard errors of the timeline estimators 
c(sqrt(yt$tvar/yt$ny),sqrt(xt$tvar/n))
###95 percent CIs
c(yt$t1-1.96*sqrt(yt$tvar/yt$ny),yt$t1+1.96*sqrt(yt$tvar/yt$ny))
c(xt$t1-1.96*sqrt(xt$tvar/n),xt$t1+1.96*sqrt(xt$tvar/n))

</code></pre>

<hr>
<h2 id='ovbeta'>calculate the overall log hazard ratio</h2><span id='topic+ovbeta'></span>

<h3>Description</h3>

<p>This will calculate the overall (log) hazard ratio accouting for staggered entry, delayed treatment effect,  treatment crossover and loss to follow-up.</p>


<h3>Usage</h3>

<pre><code class='language-R'>ovbeta(tfix=2.0,taur=5,u=c(1/taur,1/taur),ut=c(taur/2,taur),pi1=0.5,
       rate11=c(1,0.5),rate21=rate11,rate31=c(0.7,0.4),rate41=rate21,
       rate51=rate21,ratec1=c(0.5,0.6),
       rate10=rate11,rate20=rate10,rate30=rate31,rate40=rate20,
       rate50=rate20,ratec0=c(0.4,0.3),
       tchange=c(0,1),type1=1,type0=1,
       rp21=0.5,rp20=0.5,
       eps=1.0e-2,veps=1.0e-2,
       beta0=0,epsbeta=1.0e-4,iterbeta=25)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ovbeta_+3A_tfix">tfix</code></td>
<td>
<p>The time point where the overall log hazard ratio is computed.</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_taur">taur</code></td>
<td>
<p>Recruitment time</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_u">u</code></td>
<td>
<p>Piecewise constant recuitment rate</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_ut">ut</code></td>
<td>
<p>Recruitment intervals</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_pi1">pi1</code></td>
<td>
<p>Allocation probability for the treatment group</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_rate11">rate11</code></td>
<td>
<p>Hazard before crossover for the treatment group</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_rate21">rate21</code></td>
<td>
<p>Hazard after crossover for the treatment group</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_rate31">rate31</code></td>
<td>
<p>Hazard for time to crossover for the treatment group</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_rate41">rate41</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_rate51">rate51</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_ratec1">ratec1</code></td>
<td>
<p>Hazard for time to censoring for the treatment group</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_rate10">rate10</code></td>
<td>
<p>Hazard before crossover for the control group</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_rate20">rate20</code></td>
<td>
<p>Hazard after crossover for the control group</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_rate30">rate30</code></td>
<td>
<p>Hazard for time to crossover for the control group</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_rate40">rate40</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_rate50">rate50</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_ratec0">ratec0</code></td>
<td>
<p>Hazard for time to censoring for the control group</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_tchange">tchange</code></td>
<td>
<p>A strictly increasing sequence of time points at which the event rates changes. The first element of tchange                 must be zero. It must have the same length as <code>rate11</code>, <code>rate21</code>, <code>rate31</code>, etc.</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_type1">type1</code></td>
<td>
<p>Type of crossover in the treatment group</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_type0">type0</code></td>
<td>
<p>Type of crossover in the control group</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_rp21">rp21</code></td>
<td>
<p>re-randomization prob in the treatment group</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_rp20">rp20</code></td>
<td>
<p>re-randomization prob in the control group</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_eps">eps</code></td>
<td>
<p>A small number representing the error tolerance when calculating the utility function
</p>
<p style="text-align: center;"><code class="reqn">\Phi_l(x)=\frac{\int_0^x s^l e^{-s}ds}{x^{l+1}}</code>
</p>
<p> with <code class="reqn">l=0,1,2</code>.</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_veps">veps</code></td>
<td>
<p>A small number representing the error tolerance when calculating the Fisher information.</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_beta0">beta0</code></td>
<td>
<p>The starting value of the Newton-Raphson iterative procedure.</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_epsbeta">epsbeta</code></td>
<td>
<p>Absolute tolerance when calculating the overall log hazard ratio.</p>
</td></tr>
<tr><td><code id="ovbeta_+3A_iterbeta">iterbeta</code></td>
<td>
<p>Maximum number of iterations when calculating the overall log hazard ratio.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The hazard functions corresponding to <code>rate11</code>,...,<code>rate51</code>,<code>ratec1</code>, <code>rate10</code>,...,<code>rate50</code>,<code>ratec0</code> are all piecewise constant function taking the form  <code class="reqn">\lambda(t)=\sum_{j=1}^m \lambda_j I(t_{j-1}\le t&lt;t_j)</code>, where <code class="reqn">\lambda_1,\ldots,\lambda_m</code> are the corresponding elements of the rates and <code class="reqn">t_0,\ldots,t_{m-1}</code> are the corresponding elements of <cite>tchange</cite>, <code class="reqn">t_m=\infty</code>. Note that all the rates must have the same <code>tchange</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>b1</code></td>
<td>
<p>The overall log hazard ratio</p>
</td></tr>
<tr><td><code>hr</code></td>
<td>
<p>The overall hazard ratio</p>
</td></tr>
<tr><td><code>err</code></td>
<td>
<p>Error at the last iterative step</p>
</td></tr>
<tr><td><code>iter</code></td>
<td>
<p>Number of iterations performed</p>
</td></tr>
<tr><td><code>bhist</code></td>
<td>
<p>The overall log hazard ratio at each step</p>
</td></tr>
<tr><td><code>xnum</code></td>
<td>
<p>The expected score function at each step</p>
</td></tr>
<tr><td><code>xdenom</code></td>
<td>
<p>The Fisher information at each step</p>
</td></tr>
<tr><td><code>atsupp</code></td>
<td>
<p>The grids used to cut the interval [0,<code>tfix</code>] in order to approximate the Fisher information</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Version 1.0 (7/19/2016)</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pwe">pwe</a></code>,<code><a href="#topic+rpwe">rpwe</a></code>,<code><a href="#topic+qpwe">qpwe</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>taur&lt;-1.2
u&lt;-c(1/taur,1/taur)
ut&lt;-c(taur/2,taur)
r11&lt;-c(1,0.5)
r21&lt;-c(0.5,0.8)
r31&lt;-c(0.7,0.4)
r41&lt;-r51&lt;-r21
rc1&lt;-c(0.5,0.6)
r10&lt;-c(1,0.7)
r20&lt;-c(0.5,1)
r30&lt;-c(0.3,0.4)
r40&lt;-r50&lt;-r20
rc0&lt;-c(0.2,0.4)
getbeta&lt;-ovbeta(tfix=2.0,taur=taur,u=u,ut=ut,pi1=0.5,
       rate11=r11,rate21=r21,rate31=r31,rate41=r41,rate51=r51,ratec1=rc1,
       rate10=r10,rate20=r20,rate30=r30,rate40=r40,rate50=r50,ratec0=rc0,
       tchange=c(0,1),type1=1,type0=1,eps=1.0e-2,veps=1.0e-2,beta0=0,epsbeta=1.0e-4,iterbeta=25)
getbeta$b1
</code></pre>

<hr>
<h2 id='overallcov'>calculate the overall covariance</h2><span id='topic+overallcov'></span>

<h3>Description</h3>

<p>This will calculate the overall covariance accouting for staggered entry, delayed treatment effect,  treatment crossover and loss to follow-up.</p>


<h3>Usage</h3>

<pre><code class='language-R'>overallcov(tfix=2.0,tfix0=1.0,taur=5,u=c(1/taur,1/taur),ut=c(taur/2,taur),pi1=0.5,
              rate11=c(1,0.5),rate21=rate11,rate31=c(0.7,0.4),
              rate41=rate21,rate51=rate21,ratec1=c(0.5,0.6),
              rate10=c(1,0.7),rate20=rate10,rate30=rate31,
              rate40=rate20,rate50=rate20,ratec0=ratec1,
              tchange=c(0,1),type1=1,type0=1,
              rp21=0.5,rp20=0.5,
              eps=1.0e-2,veps=1.0e-2,beta=0,beta0=0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="overallcov_+3A_tfix">tfix</code></td>
<td>
<p>The upper point where the overall covariance is computed.</p>
</td></tr>
<tr><td><code id="overallcov_+3A_tfix0">tfix0</code></td>
<td>
<p>The lower point where the overall covariance is computed.</p>
</td></tr>
<tr><td><code id="overallcov_+3A_taur">taur</code></td>
<td>
<p>Recruitment time</p>
</td></tr>
<tr><td><code id="overallcov_+3A_u">u</code></td>
<td>
<p>Piecewise constant recuitment rate</p>
</td></tr>
<tr><td><code id="overallcov_+3A_ut">ut</code></td>
<td>
<p>Recruitment intervals</p>
</td></tr>
<tr><td><code id="overallcov_+3A_pi1">pi1</code></td>
<td>
<p>Allocation probability for the treatment group</p>
</td></tr>
<tr><td><code id="overallcov_+3A_rate11">rate11</code></td>
<td>
<p>Hazard before crossover for the treatment group</p>
</td></tr>
<tr><td><code id="overallcov_+3A_rate21">rate21</code></td>
<td>
<p>Hazard after crossover for the treatment group</p>
</td></tr>
<tr><td><code id="overallcov_+3A_rate31">rate31</code></td>
<td>
<p>Hazard for time to crossover for the treatment group</p>
</td></tr>
<tr><td><code id="overallcov_+3A_rate41">rate41</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="overallcov_+3A_rate51">rate51</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="overallcov_+3A_ratec1">ratec1</code></td>
<td>
<p>Hazard for time to censoring for the treatment group</p>
</td></tr>
<tr><td><code id="overallcov_+3A_rate10">rate10</code></td>
<td>
<p>Hazard before crossover for the control group</p>
</td></tr>
<tr><td><code id="overallcov_+3A_rate20">rate20</code></td>
<td>
<p>Hazard after crossover for the control group</p>
</td></tr>
<tr><td><code id="overallcov_+3A_rate30">rate30</code></td>
<td>
<p>Hazard for time to crossover for the control group</p>
</td></tr>
<tr><td><code id="overallcov_+3A_rate40">rate40</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="overallcov_+3A_rate50">rate50</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="overallcov_+3A_ratec0">ratec0</code></td>
<td>
<p>Hazard for time to censoring for the control group</p>
</td></tr>
<tr><td><code id="overallcov_+3A_tchange">tchange</code></td>
<td>
<p>A strictly increasing sequence of time points at which the event rates changes. The first element of tchange                 must be zero. It must have the same length as <code>rate11</code>, <code>rate21</code>, <code>rate31</code>, etc.</p>
</td></tr>
<tr><td><code id="overallcov_+3A_type1">type1</code></td>
<td>
<p>Type of crossover in the treatment group</p>
</td></tr>
<tr><td><code id="overallcov_+3A_type0">type0</code></td>
<td>
<p>Type of crossover in the control group</p>
</td></tr>
<tr><td><code id="overallcov_+3A_rp21">rp21</code></td>
<td>
<p>re-randomization prob in the treatment group</p>
</td></tr>
<tr><td><code id="overallcov_+3A_rp20">rp20</code></td>
<td>
<p>re-randomization prob in the control group</p>
</td></tr>
<tr><td><code id="overallcov_+3A_eps">eps</code></td>
<td>
<p>A small number representing the error tolerance when calculating the utility function
</p>
<p style="text-align: center;"><code class="reqn">\Phi_l(x)=\frac{\int_0^x s^l e^{-s}ds}{x^{l+1}}</code>
</p>
<p> with <code class="reqn">l=0,1,2</code>.</p>
</td></tr>
<tr><td><code id="overallcov_+3A_veps">veps</code></td>
<td>
<p>A small number representing the error tolerance when calculating the Fisher information.</p>
</td></tr>
<tr><td><code id="overallcov_+3A_beta">beta</code></td>
<td>
<p>The value at which the covaraince is computed, upper bound</p>
</td></tr>
<tr><td><code id="overallcov_+3A_beta0">beta0</code></td>
<td>
<p>The value at which the covaraince is computed, lower bound</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The hazard functions corresponding to <code>rate11</code>,...,<code>rate51</code>,<code>ratec1</code>, <code>rate10</code>,...,<code>rate50</code>,<code>ratec0</code> are all piecewise constant function taking the form  <code class="reqn">\lambda(t)=\sum_{j=1}^m \lambda_j I(t_{j-1}\le t&lt;t_j)</code>, where <code class="reqn">\lambda_1,\ldots,\lambda_m</code> are the corresponding elements of the rates and <code class="reqn">t_0,\ldots,t_{m-1}</code> are the corresponding elements of <cite>tchange</cite>, <code class="reqn">t_m=\infty</code>. Note that all the rates must have the same <code>tchange</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>covbeta</code></td>
<td>
<p>The covariance the score functions</p>
</td></tr>
<tr><td><code>covbeta1</code></td>
<td>
<p>The first part of the cov</p>
</td></tr>
<tr><td><code>covbeta2</code></td>
<td>
<p>The second part of the cov</p>
</td></tr>
<tr><td><code>covbeta3</code></td>
<td>
<p>The third part of the cov</p>
</td></tr>
<tr><td><code>covbeta4</code></td>
<td>
<p>The fourth part of the cov</p>
</td></tr>
<tr><td><code>EA1</code></td>
<td>
<p>The first score function</p>
</td></tr>
<tr><td><code>EA2</code></td>
<td>
<p>The second score function</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Version 1.0 (7/19/2016)</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pwe">pwe</a></code>,<code><a href="#topic+rpwe">rpwe</a></code>,<code><a href="#topic+qpwe">qpwe</a></code>,<code><a href="#topic+ovbeta">ovbeta</a></code>,<code><a href="#topic+innervar">innervar</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>taur&lt;-1.2
u&lt;-c(1/taur,1/taur)
ut&lt;-c(taur/2,taur)
r11&lt;-c(1,0.5)
r21&lt;-c(0.5,0.8)
r31&lt;-c(0.7,0.4)
r41&lt;-r51&lt;-r21
rc1&lt;-c(0.5,0.6)
r10&lt;-c(1,0.7)
r20&lt;-c(0.5,1)
r30&lt;-c(0.3,0.4)
r40&lt;-r50&lt;-r20
rc0&lt;-c(0.2,0.4)
getcov&lt;-overallcov(tfix=2.0,tfix0=1.0,taur=taur,u=u,ut=ut,pi1=0.5,
              rate11=r11,rate21=r21,rate31=r31,
              rate41=r41,rate51=r51,ratec1=rc1,
              rate10=r10,rate20=r20,rate30=r30,
              rate40=r40,rate50=r50,ratec0=rc0,
              tchange=c(0,1),type1=1,type0=1,
              eps=1.0e-2,veps=1.0e-2,beta=0,beta0=0)
getcov$covbeta
</code></pre>

<hr>
<h2 id='overallcovp1'>calculate the first part of the overall covariance</h2><span id='topic+overallcovp1'></span>

<h3>Description</h3>

<p>This will calculate the first part of the overall covariance accouting for staggered entry, delayed treatment effect,  treatment crossover and loss to follow-up.</p>


<h3>Usage</h3>

<pre><code class='language-R'>overallcovp1(tfix=2.0,tfix0=1.0,taur=5,u=c(1/taur,1/taur),ut=c(taur/2,taur),pi1=0.5,
                    rate11=c(1,0.5),rate21=rate11,rate31=c(0.7,0.4),
                    rate41=rate21,rate51=rate51,ratec1=c(0.5,0.6),
                    rate10=rate11,rate20=rate10,rate30=rate31,
                    rate40=rate20,rate50=rate20,ratec0=ratec1,
                    tchange=c(0,1),type1=1,type0=1,
                    rp21=0.5,rp20=0.5,
                    eps=1.0e-2,veps=1.0e-2,beta=0,beta0=0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="overallcovp1_+3A_tfix">tfix</code></td>
<td>
<p>The upper point where the overall covariance is computed.</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_tfix0">tfix0</code></td>
<td>
<p>The lower point where the overall covariance is computed.</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_taur">taur</code></td>
<td>
<p>Recruitment time</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_u">u</code></td>
<td>
<p>Piecewise constant recuitment rate</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_ut">ut</code></td>
<td>
<p>Recruitment intervals</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_pi1">pi1</code></td>
<td>
<p>Allocation probability for the treatment group</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_rate11">rate11</code></td>
<td>
<p>Hazard before crossover for the treatment group</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_rate21">rate21</code></td>
<td>
<p>Hazard after crossover for the treatment group</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_rate31">rate31</code></td>
<td>
<p>Hazard for time to crossover for the treatment group</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_rate41">rate41</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_rate51">rate51</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_ratec1">ratec1</code></td>
<td>
<p>Hazard for time to censoring for the treatment group</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_rate10">rate10</code></td>
<td>
<p>Hazard before crossover for the control group</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_rate20">rate20</code></td>
<td>
<p>Hazard after crossover for the control group</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_rate30">rate30</code></td>
<td>
<p>Hazard for time to crossover for the control group</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_rate40">rate40</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_rate50">rate50</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_ratec0">ratec0</code></td>
<td>
<p>Hazard for time to censoring for the control group</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_tchange">tchange</code></td>
<td>
<p>A strictly increasing sequence of time points at which the event rates changes. The first element of tchange                 must be zero. It must have the same length as <code>rate11</code>, <code>rate21</code>, <code>rate31</code>, etc.</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_type1">type1</code></td>
<td>
<p>Type of crossover in the treatment group</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_type0">type0</code></td>
<td>
<p>Type of crossover in the control group</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_rp21">rp21</code></td>
<td>
<p>re-randomization prob in the treatment group</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_rp20">rp20</code></td>
<td>
<p>re-randomization prob in the control group</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_eps">eps</code></td>
<td>
<p>A small number representing the error tolerance when calculating the utility function
</p>
<p style="text-align: center;"><code class="reqn">\Phi_l(x)=\frac{\int_0^x s^l e^{-s}ds}{x^{l+1}}</code>
</p>
<p> with <code class="reqn">l=0,1,2</code>.</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_veps">veps</code></td>
<td>
<p>A small number representing the error tolerance when calculating the Fisher information.</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_beta">beta</code></td>
<td>
<p>The value at which the covaraince is computed, upper bound</p>
</td></tr>
<tr><td><code id="overallcovp1_+3A_beta0">beta0</code></td>
<td>
<p>The value at which the covaraince is computed, lower bound</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The hazard functions corresponding to <code>rate11</code>,...,<code>rate51</code>,<code>ratec1</code>, <code>rate10</code>,...,<code>rate50</code>,<code>ratec0</code> are all piecewise constant function taking the form  <code class="reqn">\lambda(t)=\sum_{j=1}^m \lambda_j I(t_{j-1}\le t&lt;t_j)</code>, where <code class="reqn">\lambda_1,\ldots,\lambda_m</code> are the corresponding elements of the rates and <code class="reqn">t_0,\ldots,t_{m-1}</code> are the corresponding elements of <cite>tchange</cite>, <code class="reqn">t_m=\infty</code>. Note that all the rates must have the same <code>tchange</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>covbeta1</code></td>
<td>
<p>The first part of the covariance</p>
</td></tr>
<tr><td><code>EA1</code></td>
<td>
<p>The first score function</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Version 1.0 (7/19/2016)</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pwe">pwe</a></code>,<code><a href="#topic+rpwe">rpwe</a></code>,<code><a href="#topic+qpwe">qpwe</a></code>,<code><a href="#topic+ovbeta">ovbeta</a></code>,<code><a href="#topic+innervar">innervar</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>taur&lt;-1.2
u&lt;-c(1/taur,1/taur)
ut&lt;-c(taur/2,taur)
r11&lt;-c(1,0.5)
r21&lt;-c(0.5,0.8)
r31&lt;-c(0.7,0.4)
r41&lt;-r51&lt;-r21
rc1&lt;-c(0.5,0.6)
r10&lt;-c(1,0.7)
r20&lt;-c(0.5,1)
r30&lt;-c(0.3,0.4)
r40&lt;-r50&lt;-r20
rc0&lt;-c(0.2,0.4)
getcov1&lt;-overallcovp1(tfix=2.0,tfix0=1.0,taur=taur,u=u,ut=ut,pi1=0.5,
              rate11=r11,rate21=r21,rate31=r31,
              rate41=r41,rate51=r51,ratec1=rc1,
              rate10=r10,rate20=r20,rate30=r30,
              rate40=r40,rate50=r50,ratec0=rc0,
              tchange=c(0,1),type1=1,type0=1,
              eps=1.0e-2,veps=1.0e-2,beta=0,beta0=0)
getcov1$covbeta1
</code></pre>

<hr>
<h2 id='overallcovp2'>calculate the other parts of the overall covariance</h2><span id='topic+overallcovp2'></span>

<h3>Description</h3>

<p>This will calculate the other parts of the overall covariance accouting for staggered entry, delayed treatment effect,  treatment crossover and loss to follow-up.</p>


<h3>Usage</h3>

<pre><code class='language-R'>overallcovp2(tfix=2.0,tfix0=1.0,taur=5,u=c(1/taur,1/taur),ut=c(taur/2,taur),pi1=0.5,
                    rate11=c(1,0.5),rate21=rate11,rate31=c(0.7,0.4),
                    rate41=rate21,rate51=rate51,ratec1=c(0.5,0.6),
                    rate10=rate11,rate20=rate10,rate30=rate31,
                    rate40=rate20,rate50=rate20,ratec0=ratec1,
                    tchange=c(0,1),type1=1,type0=1,
                    rp21=0.5,rp20=0.5,
                    eps=1.0e-2,veps=1.0e-2,beta=0,beta0=0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="overallcovp2_+3A_tfix">tfix</code></td>
<td>
<p>The upper point where the overall covariance is computed.</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_tfix0">tfix0</code></td>
<td>
<p>The lower point where the overall covariance is computed.</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_taur">taur</code></td>
<td>
<p>Recruitment time</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_u">u</code></td>
<td>
<p>Piecewise constant recuitment rate</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_ut">ut</code></td>
<td>
<p>Recruitment intervals</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_pi1">pi1</code></td>
<td>
<p>Allocation probability for the treatment group</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_rate11">rate11</code></td>
<td>
<p>Hazard before crossover for the treatment group</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_rate21">rate21</code></td>
<td>
<p>Hazard after crossover for the treatment group</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_rate31">rate31</code></td>
<td>
<p>Hazard for time to crossover for the treatment group</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_rate41">rate41</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_rate51">rate51</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_ratec1">ratec1</code></td>
<td>
<p>Hazard for time to censoring for the treatment group</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_rate10">rate10</code></td>
<td>
<p>Hazard before crossover for the control group</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_rate20">rate20</code></td>
<td>
<p>Hazard after crossover for the control group</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_rate30">rate30</code></td>
<td>
<p>Hazard for time to crossover for the control group</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_rate40">rate40</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_rate50">rate50</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_ratec0">ratec0</code></td>
<td>
<p>Hazard for time to censoring for the control group</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_tchange">tchange</code></td>
<td>
<p>A strictly increasing sequence of time points at which the event rates changes. The first element of tchange                 must be zero. It must have the same length as <code>rate11</code>, <code>rate21</code>, <code>rate31</code>, etc.</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_type1">type1</code></td>
<td>
<p>Type of crossover in the treatment group</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_type0">type0</code></td>
<td>
<p>Type of crossover in the control group</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_rp21">rp21</code></td>
<td>
<p>re-randomization prob in the treatment group</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_rp20">rp20</code></td>
<td>
<p>re-randomization prob in the control group</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_eps">eps</code></td>
<td>
<p>A small number representing the error tolerance when calculating the utility function
</p>
<p style="text-align: center;"><code class="reqn">\Phi_l(x)=\frac{\int_0^x s^l e^{-s}ds}{x^{l+1}}</code>
</p>
<p> with <code class="reqn">l=0,1,2</code>.</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_veps">veps</code></td>
<td>
<p>A small number representing the error tolerance when calculating the Fisher information.</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_beta">beta</code></td>
<td>
<p>The value at which the covaraince is computed, upper bound</p>
</td></tr>
<tr><td><code id="overallcovp2_+3A_beta0">beta0</code></td>
<td>
<p>The value at which the covaraince is computed, lower bound</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The hazard functions corresponding to <code>rate11</code>,...,<code>rate51</code>,<code>ratec1</code>, <code>rate10</code>,...,<code>rate50</code>,<code>ratec0</code> are all piecewise constant function taking the form  <code class="reqn">\lambda(t)=\sum_{j=1}^m \lambda_j I(t_{j-1}\le t&lt;t_j)</code>, where <code class="reqn">\lambda_1,\ldots,\lambda_m</code> are the corresponding elements of the rates and <code class="reqn">t_0,\ldots,t_{m-1}</code> are the corresponding elements of <cite>tchange</cite>, <code class="reqn">t_m=\infty</code>. Note that all the rates must have the same <code>tchange</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>cov234</code></td>
<td>
<p>The other part of the covariance</p>
</td></tr>
<tr><td><code>covbeta2</code></td>
<td>
<p>The second part of the covariance</p>
</td></tr>
<tr><td><code>covbeta3</code></td>
<td>
<p>The third part of the covariance</p>
</td></tr>
<tr><td><code>covbeta4</code></td>
<td>
<p>The fourth part of the covariance</p>
</td></tr>
<tr><td><code>EA2</code></td>
<td>
<p>The second score function</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Version 1.0 (7/19/2016)</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pwe">pwe</a></code>,<code><a href="#topic+rpwe">rpwe</a></code>,<code><a href="#topic+qpwe">qpwe</a></code>,<code><a href="#topic+ovbeta">ovbeta</a></code>,<code><a href="#topic+innervar">innervar</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>taur&lt;-1.2
u&lt;-c(1/taur,1/taur)
ut&lt;-c(taur/2,taur)
r11&lt;-c(1,0.5)
r21&lt;-c(0.5,0.8)
r31&lt;-c(0.7,0.4)
r41&lt;-r51&lt;-r21
rc1&lt;-c(0.5,0.6)
r10&lt;-c(1,0.7)
r20&lt;-c(0.5,1)
r30&lt;-c(0.3,0.4)
r40&lt;-r50&lt;-r20
rc0&lt;-c(0.2,0.4)
getcov2&lt;-overallcovp2(tfix=2.0,tfix0=1.0,taur=taur,u=u,ut=ut,pi1=0.5,
              rate11=r11,rate21=r21,rate31=r31,
              rate41=r41,rate51=r51,ratec1=rc1,
              rate10=r10,rate20=r20,rate30=r30,
              rate40=r40,rate50=r50,ratec0=rc0,
              tchange=c(0,1),type1=1,type0=1,
              eps=1.0e-2,veps=1.0e-2,beta=0,beta0=0)
getcov2
</code></pre>

<hr>
<h2 id='overallvar'>calculate the overall variance</h2><span id='topic+overallvar'></span>

<h3>Description</h3>

<p>This will calculate the overall variance accouting for staggered entry, delayed treatment effect,  treatment crossover and loss to follow-up.</p>


<h3>Usage</h3>

<pre><code class='language-R'>overallvar(tfix=2.0,taur=5,u=c(1/taur,1/taur),ut=c(taur/2,taur),pi1=0.5,
                     rate11=c(1,0.5),rate21=rate11,rate31=c(0.7,0.4),
                     rate41=rate21,rate51=rate21,ratec1=c(0.5,0.6),
                     rate10=rate11,rate20=rate10,rate30=rate31,
                     rate40=rate20,rate50=rate20,ratec0=c(0.6,0.5),
                     tchange=c(0,1),type1=1,type0=1,
                     rp21=0.5,rp20=0.5,
                     eps=1.0e-2,veps=1.0e-2,beta=0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="overallvar_+3A_tfix">tfix</code></td>
<td>
<p>The time point where the overall variance is computed.</p>
</td></tr>
<tr><td><code id="overallvar_+3A_taur">taur</code></td>
<td>
<p>Recruitment time</p>
</td></tr>
<tr><td><code id="overallvar_+3A_u">u</code></td>
<td>
<p>Piecewise constant recuitment rate</p>
</td></tr>
<tr><td><code id="overallvar_+3A_ut">ut</code></td>
<td>
<p>Recruitment intervals</p>
</td></tr>
<tr><td><code id="overallvar_+3A_pi1">pi1</code></td>
<td>
<p>Allocation probability for the treatment group</p>
</td></tr>
<tr><td><code id="overallvar_+3A_rate11">rate11</code></td>
<td>
<p>Hazard before crossover for the treatment group</p>
</td></tr>
<tr><td><code id="overallvar_+3A_rate21">rate21</code></td>
<td>
<p>Hazard after crossover for the treatment group</p>
</td></tr>
<tr><td><code id="overallvar_+3A_rate31">rate31</code></td>
<td>
<p>Hazard for time to crossover for the treatment group</p>
</td></tr>
<tr><td><code id="overallvar_+3A_rate41">rate41</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="overallvar_+3A_rate51">rate51</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="overallvar_+3A_ratec1">ratec1</code></td>
<td>
<p>Hazard for time to censoring for the treatment group</p>
</td></tr>
<tr><td><code id="overallvar_+3A_rate10">rate10</code></td>
<td>
<p>Hazard before crossover for the control group</p>
</td></tr>
<tr><td><code id="overallvar_+3A_rate20">rate20</code></td>
<td>
<p>Hazard after crossover for the control group</p>
</td></tr>
<tr><td><code id="overallvar_+3A_rate30">rate30</code></td>
<td>
<p>Hazard for time to crossover for the control group</p>
</td></tr>
<tr><td><code id="overallvar_+3A_rate40">rate40</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="overallvar_+3A_rate50">rate50</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="overallvar_+3A_ratec0">ratec0</code></td>
<td>
<p>Hazard for time to censoring for the control group</p>
</td></tr>
<tr><td><code id="overallvar_+3A_tchange">tchange</code></td>
<td>
<p>A strictly increasing sequence of time points at which the event rates changes. The first element of tchange                 must be zero. It must have the same length as <code>rate11</code>, <code>rate21</code>, <code>rate31</code>, etc.</p>
</td></tr>
<tr><td><code id="overallvar_+3A_type1">type1</code></td>
<td>
<p>Type of crossover in the treatment group</p>
</td></tr>
<tr><td><code id="overallvar_+3A_type0">type0</code></td>
<td>
<p>Type of crossover in the control group</p>
</td></tr>
<tr><td><code id="overallvar_+3A_rp21">rp21</code></td>
<td>
<p>re-randomization prob in the treatment group</p>
</td></tr>
<tr><td><code id="overallvar_+3A_rp20">rp20</code></td>
<td>
<p>re-randomization prob in the control group</p>
</td></tr>
<tr><td><code id="overallvar_+3A_eps">eps</code></td>
<td>
<p>A small number representing the error tolerance when calculating the utility function
</p>
<p style="text-align: center;"><code class="reqn">\Phi_l(x)=\frac{\int_0^x s^l e^{-s}ds}{x^{l+1}}</code>
</p>
<p> with <code class="reqn">l=0,1,2</code>.</p>
</td></tr>
<tr><td><code id="overallvar_+3A_veps">veps</code></td>
<td>
<p>A small number representing the error tolerance when calculating the Fisher information.</p>
</td></tr>
<tr><td><code id="overallvar_+3A_beta">beta</code></td>
<td>
<p>The value at which the varaince is computed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The hazard functions corresponding to <code>rate11</code>,...,<code>rate51</code>,<code>ratec1</code>, <code>rate10</code>,...,<code>rate50</code>,<code>ratec0</code> are all piecewise constant function taking the form  <code class="reqn">\lambda(t)=\sum_{j=1}^m \lambda_j I(t_{j-1}\le t&lt;t_j)</code>, where <code class="reqn">\lambda_1,\ldots,\lambda_m</code> are the corresponding elements of the rates and <code class="reqn">t_0,\ldots,t_{m-1}</code> are the corresponding elements of <cite>tchange</cite>, <code class="reqn">t_m=\infty</code>. Note that all the rates must have the same <code>tchange</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>vbeta</code></td>
<td>
<p>The variance of the overall log hazard ratio at the specified beta</p>
</td></tr>
<tr><td><code>vs</code></td>
<td>
<p>The variance of the score function at the specified beta</p>
</td></tr>
<tr><td><code>xdenom</code></td>
<td>
<p>Fisher information at the specified beta</p>
</td></tr>
<tr><td><code>EA</code></td>
<td>
<p>value of the score function</p>
</td></tr>
<tr><td><code>EA2</code></td>
<td>
<p>The first part of the variance</p>
</td></tr>
<tr><td><code>AB</code></td>
<td>
<p>Half of the second part of the variance</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Version 1.0 (7/19/2016)</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pwe">pwe</a></code>,<code><a href="#topic+rpwe">rpwe</a></code>,<code><a href="#topic+qpwe">qpwe</a></code>,<code><a href="#topic+ovbeta">ovbeta</a></code>,<code><a href="#topic+innervar">innervar</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>taur&lt;-1.2
u&lt;-c(1/taur,1/taur)
ut&lt;-c(taur/2,taur)
r11&lt;-c(1,0.5)
r21&lt;-c(0.5,0.8)
r31&lt;-c(0.7,0.4)
r41&lt;-r51&lt;-r21
rc1&lt;-c(0.5,0.6)
r10&lt;-c(1,0.7)
r20&lt;-c(0.5,1)
r30&lt;-c(0.3,0.4)
r40&lt;-r50&lt;-r20
rc0&lt;-c(0.2,0.4)
###variance with beta=0, calculate log-rank variance under the alternative
vbeta0&lt;-overallvar(tfix=2.0,taur=taur,u=u,ut=ut,pi1=0.5,
        rate11=r11,rate21=r21,rate31=r31,rate41=r41,rate51=r51,ratec1=rc1,
        rate10=r10,rate20=r20,rate30=r30,rate40=r40,rate50=r50,ratec0=rc0,
        tchange=c(0,1),type1=1,type0=1,eps=1.0e-2,veps=1.0e-2,beta=0)

###variance with beta=0, calculate log-rank variance under the alternative
###Estimate the overall beta
getbeta&lt;-ovbeta(tfix=2.0,taur=taur,u=u,ut=ut,pi1=0.5,
        rate11=r11,rate21=r21,rate31=r31,rate41=r41,rate51=r51,ratec1=rc1,
        rate10=r10,rate20=r20,rate30=r30,rate40=r40,rate50=r50,ratec0=rc0,
        tchange=c(0,1),type1=1,type0=1,eps=1.0e-2,veps=1.0e-2,beta0=0,
        epsbeta=1.0e-4,iterbeta=25)
vbeta&lt;-overallvar(tfix=2.0,taur=taur,u=u,ut=ut,pi1=0.5,
        rate11=r11,rate21=r21,rate31=r31,rate41=r41,rate51=r51,ratec1=rc1,
        rate10=r10,rate20=r20,rate30=r30,rate40=r40,rate50=r50,ratec0=rc0,
      tchange=c(0,1),type1=1,type0=1,eps=1.0e-2,veps=1.0e-2,beta=getbeta$b1)
cbind(vbeta0$vs,vbeta$vs)
</code></pre>

<hr>
<h2 id='pwe'>Piecewise exponential distribution: hazard, cumulative hazard, density, distribution, survival</h2><span id='topic+pwe'></span>

<h3>Description</h3>

<p>This will provide the related functions of the specified piecewise exponential distribution.</p>


<h3>Usage</h3>

<pre><code class='language-R'>pwe(t=seq(0,5,by=0.5),rate=c(0,5,0.8),tchange=c(0,3))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pwe_+3A_t">t</code></td>
<td>
<p>A vector of time points.</p>
</td></tr>
<tr><td><code id="pwe_+3A_rate">rate</code></td>
<td>
<p>A vector of event rates</p>
</td></tr>
<tr><td><code id="pwe_+3A_tchange">tchange</code></td>
<td>
<p>A strictly increasing sequence of time points at which the event rate changes. The first element of tchange must be zero. It must have the same length as <code>rate</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Let <code class="reqn">\lambda(t)=\sum_{j=1}^m \lambda_j I(t_{j-1}\le t&lt;t_j)</code> be the hazard function, where <code class="reqn">\lambda_1,\ldots,\lambda_m</code> are the corresponding elements of <cite>rate</cite> and <code class="reqn">t_0,\ldots,t_{m-1}</code> are the corresponding elements of <cite>tchange</cite>, <code class="reqn">t_m=\infty</code>. The cumulative hazard function
</p>
<p style="text-align: center;"><code class="reqn">\Lambda(t)=\sum_{j=1}^m \lambda_j(t\wedge t_j-t\wedge t_{j-1}),</code>
</p>

<p>the survival function <code class="reqn">S(t)=\exp\{-\Lambda(t)\}</code>, the distribution function <code class="reqn">F(t)=1-S(t)</code> and the density function
<code class="reqn">f(t)=\lambda(t)S(t)</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>hazard</code></td>
<td>
<p>Hazard function</p>
</td></tr>
<tr><td><code>cumhazard</code></td>
<td>
<p>Cumulative hazard function</p>
</td></tr>
<tr><td><code>density</code></td>
<td>
<p>Density function</p>
</td></tr>
<tr><td><code>dist</code></td>
<td>
<p>Distribution function</p>
</td></tr>
<tr><td><code>surv</code></td>
<td>
<p>Survival function</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Version 1.0 (7/19/2016)</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rpwe">rpwe</a></code>,<code><a href="#topic+qpwe">qpwe</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>t&lt;-seq(0,3,by=0.1)
rate&lt;-c(0.6,0.3)
tchange&lt;-c(0,1.75)
pwefun&lt;-pwe(t=t,rate=rate,tchange=tchange)
pwefun
</code></pre>

<hr>
<h2 id='PWEALL-package'>
Design and Monitoring of Survival Trials Accounting for Complex
Situations
</h2><span id='topic+PWEALL-package'></span><span id='topic+PWEALL'></span>

<h3>Description</h3>

<p>Calculates various functions needed for design and monitoring survival trials
    accounting for complex situations such as delayed treatment effect, treatment crossover, non-uniform accrual,
    and different censoring distributions between groups. The event time distribution is assumed to be
    piecewise exponential (PWE) distribution and the entry time is assumed to be piecewise uniform distribution.
    As compared with Version 1.2.1, two more types of hybrid crossover are added. 
    A bug is corrected in the function &quot;pwecx&quot; that calculates the crossover-adjusted survival, distribution, 
    density, hazard and cumulative hazard functions. 
    Also, to generate the crossover-adjusted event time random variable,  a more efficient 
    algorithm is used and the output includes crossover indicators. 
</p>


<h3>Details</h3>

<p>The DESCRIPTION file:
</p>

<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> PWEALL</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.3.0.1</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2018-10-18</td>
</tr>
<tr>
 <td style="text-align: left;">
Title: </td><td style="text-align: left;"> Design and Monitoring of Survival Trials Accounting for Complex
Situations</td>
</tr>
<tr>
 <td style="text-align: left;">
Description: </td><td style="text-align: left;"> Calculates various functions needed for design and monitoring survival trials
    accounting for complex situations such as delayed treatment effect, treatment crossover, non-uniform accrual,
    and different censoring distributions between groups. The event time distribution is assumed to be
    piecewise exponential (PWE) distribution and the entry time is assumed to be piecewise uniform distribution.
    As compared with Version 1.2.1, two more types of hybrid crossover are added. 
    A bug is corrected in the function "pwecx" that calculates the crossover-adjusted survival, distribution, 
    density, hazard and cumulative hazard functions. 
    Also, to generate the crossover-adjusted event time random variable,  a more efficient 
    algorithm is used and the output includes crossover indicators. </td>
</tr>
<tr>
 <td style="text-align: left;">
Authors@R: </td><td style="text-align: left;"> c(
    person(given="Xiaodong", family="Luo", email = "Xiaodong.Luo@sanofi.com", role =c("aut", "cre")),
    person(given="Xuezhou", family="Mao",  role = "ctb"),
    person(given="Xun", family="Chen",  role = "ctb"),
    person(given="Hui", family="Quan",  role = "ctb"),
    person("Sanofi", role = "cph"))</td>
</tr>
<tr>
 <td style="text-align: left;">
Depends: </td><td style="text-align: left;"> R (&gt;= 3.1.2)</td>
</tr>
<tr>
 <td style="text-align: left;">
Imports: </td><td style="text-align: left;"> survival, stats</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL (&gt;= 2)</td>
</tr>
<tr>
 <td style="text-align: left;">
RoxygenNote: </td><td style="text-align: left;"> 5.0.1</td>
</tr>
<tr>
 <td style="text-align: left;">
LazyData: </td><td style="text-align: left;"> true</td>
</tr>
<tr>
 <td style="text-align: left;">
NeedsCompilation: </td><td style="text-align: left;"> yes</td>
</tr>
<tr>
 <td style="text-align: left;">
Packaged: </td><td style="text-align: left;"> 2018-10-18 03:31:00 UTC; Administrator</td>
</tr>
<tr>
 <td style="text-align: left;">
Author: </td><td style="text-align: left;"> Xiaodong Luo [aut, cre],
  Xuezhou Mao [ctb],
  Xun Chen [ctb],
  Hui Quan [ctb],
  Sanofi [cph]</td>
</tr>
<tr>
 <td style="text-align: left;">
Maintainer: </td><td style="text-align: left;"> Xiaodong Luo &lt;Xiaodong.Luo@sanofi.com&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
Repository: </td><td style="text-align: left;"> CRAN</td>
</tr>
<tr>
 <td style="text-align: left;">
Date/Publication: </td><td style="text-align: left;"> 2018-10-18 11:30:13 UTC</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>


<p>Index of help topics:
</p>
<pre>
PWEALL-package          Design and Monitoring of Survival Trials
                        Accounting for Complex Situations
cp                      Conditional power given observed log hazard
                        ratio
cpboundary              The stopping boundary based on the conditional
                        power criteria
cpstop                  The stopping probability based on the stopping
                        boundary
fourhr                  A utility functon
hxbeta                  A function to calculate the beta-smoothed
                        hazard rate
innercov                A utility function to calculate the inner
                        integration of the overall covariance
innervar                A utility function to calculate the inner
                        integration of the overall variance
instudyfindt            calculate the timeline in study when some or
                        all subjects have entered
ovbeta                  calculate the overall log hazard ratio
overallcov              calculate the overall covariance
overallcovp1            calculate the first part of the overall
                        covariance
overallcovp2            calculate the other parts of the overall
                        covariance
overallvar              calculate the overall variance
pwe                     Piecewise exponential distribution: hazard,
                        cumulative hazard, density, distribution,
                        survival
pwecx                   Various function for piecewise exponential
                        distribution with crossover effect
pwecxcens               Integration of the density of piecewise
                        exponential distribution with crossover effect
                        and the censoring function
pwecxpwu                Integration of the density of piecewise
                        exponential distribution with crossover effect,
                        censoring and recruitment function
pwecxpwufindt           calculate the timeline when certain number of
                        events accumulates
pwecxpwuforvar          calculate the utility function used for
                        varaince calculation
pwefv2                  A utility function
pwefvplus               A utility functon
pwepower                Calculating the powers of various the test
                        statistics for superiority trials
pwepowereq              Calculating the powers of various the test
                        statistics for equivalence trials
pwepowerfindt           Calculating the timepoint where a certain power
                        of the specified test statistics is obtained
pwepowerni              Calculating the powers of various the test
                        statistics for non-inferiority trials
pwesim                  simulating the test statistics
pwu                     Piecewise uniform distribution: distribution
qpwe                    Piecewise exponential distribution: quantile
                        function
qpwu                    Piecewise uniform distribution: quantile
                        function
rmstcov                 Calculation of the variance and covariance of
                        estimated restricted mean survival time
rmsth                   Estimate the restricted mean survival time
                        (RMST) and its variance from data
rmstpower               Calculate powers at different cut-points based
                        on difference of restricted mean survival times
                        (RMST)
rmstpowerfindt          Calculating the timepoint where a certain power
                        of mean difference of RMSTs is obtained
rmstsim                 simulating the restricted mean survival times
rmstutil                A utility function to calculate the true
                        restricted mean survival time (RMST) and its
                        variance account for delayed treatment,
                        discontinued treatment and non-uniform entry
rpwe                    Piecewise exponential distribution: random
                        number generation
rpwecx                  Piecewise exponential distribution with
                        crossover effect: random number generation
rpwu                    Piecewise uniform distribution: random number
                        generation
spf                     A utility function
wlrcal                  A utility function to calculate the weighted
                        log-rank statistics and their varainces given
                        the weights
wlrcom                  A function to calculate the various weighted
                        log-rank statistics and their varainces
wlrutil                 A utility function to calculate some common
                        functions in contructing weights
</pre>
<p>There are 5 types of crossover considered in the package: (1) Markov crossover, (2) Semi-Markov crosover, (3) Hybrid crossover-1, (4) Hybrid crossover-2 and (5) Hybrid crossover-3. The first 3 types are described in Luo et al. (2018). The fourth and fifth types are added for Version 1.3.0. The crossover type is determined by the hazard function after crossover <code class="reqn">\lambda_2^{\bf x}(t\mid u)</code>. For Type (1), the Markov crossover,
</p>
<p style="text-align: center;"><code class="reqn">\lambda_2^{\bf x}(t\mid u)=\lambda_2(t).</code>
</p>
 
<p>For Type (2), the Semi-Markov crossover,
</p>
<p style="text-align: center;"><code class="reqn">\lambda_2^{\bf x}(t\mid u)=\lambda_2(t-u).</code>
</p>

<p>For Type (3), the hybrid crossover-1,
</p>
<p style="text-align: center;"><code class="reqn">\lambda_2^{\bf x}(t\mid u)=\pi_2\lambda_2(t-u)+(1-\pi_2)\lambda_4(t).</code>
</p>

<p>For Type (4), the hazard after crossover is 
</p>
<p style="text-align: center;"><code class="reqn">\lambda_2^{\bf x}(t\mid u)=\frac{\pi_2\lambda_2(t-u)S_2(t-u)+(1-\pi_2)\lambda_4(t)S_4(t)/S_4(u)}{\pi_2 S_2(t-u)+(1-\pi_2)S_4(t)/S_4(u)}.</code>
</p>

<p>For Type (5), the hazard after crossover is 
</p>
<p style="text-align: center;"><code class="reqn">\lambda_2^{\bf x}(t\mid u)=\frac{\pi_2\lambda_2(t-u)S_2(t-u)+(1-\pi_2)\lambda_4(t-u)S_4(t-u)}{\pi_2 S_2(t-u)+(1-\pi_2)S_4(t-u)}.</code>
</p>

<p>The types (4) and (5) are more closely related to &quot;re-randomization&quot;, i.e. when a patient crosses, (s)he will have probability <code class="reqn">\pi_2</code> to have hazard <code class="reqn">\lambda_2</code> and probability <code class="reqn">1-\pi_2</code> to have hazard <code class="reqn">\lambda_4</code>. The types (4) and (5) differ in having <code class="reqn">\lambda_4</code> as Markov or Semi-markov.  
</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo [aut, cre],
  Xuezhou Mao [ctb],
  Xun Chen [ctb],
  Hui Quan [ctb],
  Sanofi [cph]
</p>
<p>Maintainer: Xiaodong Luo &lt;Xiaodong.Luo@sanofi.com&gt;
</p>


<h3>References</h3>

<p>Luo et al. (2018) Design and monitoring of survival trials in complex scenarios, Statistics in Medicine &lt;doi: https://doi.org/10.1002/sim.7975&gt;.
</p>

<hr>
<h2 id='pwecx'>Various function for piecewise exponential distribution with crossover effect</h2><span id='topic+pwecx'></span>

<h3>Description</h3>

<p>This will calculate the functions according to the piecewise exponential distribution with crossover</p>


<h3>Usage</h3>

<pre><code class='language-R'>pwecx(t=seq(0,10,by=0.5),rate1=c(1,0.5),rate2=rate1,rate3=c(0.7,0.4),
      rate4=rate2,rate5=rate2,tchange=c(0,1),type=1,rp2=0.5,eps=1.0e-2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pwecx_+3A_t">t</code></td>
<td>
<p>a vector of time points</p>
</td></tr>
<tr><td><code id="pwecx_+3A_rate1">rate1</code></td>
<td>
<p>piecewise constant event rate before crossover</p>
</td></tr>
<tr><td><code id="pwecx_+3A_rate2">rate2</code></td>
<td>
<p>piecewise constant event rate after crossover</p>
</td></tr>
<tr><td><code id="pwecx_+3A_rate3">rate3</code></td>
<td>
<p>piecewise constant event rate for crossover</p>
</td></tr>
<tr><td><code id="pwecx_+3A_rate4">rate4</code></td>
<td>
<p>additional piecewise constant event rate for more complex crossover</p>
</td></tr>
<tr><td><code id="pwecx_+3A_rate5">rate5</code></td>
<td>
<p>additional piecewise constant event rate for more complex crossover</p>
</td></tr>
<tr><td><code id="pwecx_+3A_tchange">tchange</code></td>
<td>
<p>a strictly increasing sequence of time points starting from zero at which event rate changes. The first element of tchange must be zero. The above rates <code>rate1</code> to <code>rate5</code> and tchange must have the same length.</p>
</td></tr>
<tr><td><code id="pwecx_+3A_type">type</code></td>
<td>
<p>type of crossover, i.e. 1: markov, 2: semi-markov, 3: hybrid case 1(as indicated in the reference), 4: hybrid case 2, 5: hybrid case 3.</p>
</td></tr>
<tr><td><code id="pwecx_+3A_rp2">rp2</code></td>
<td>
<p>re-randomization prob</p>
</td></tr>
<tr><td><code id="pwecx_+3A_eps">eps</code></td>
<td>
<p>tolerance</p>
</td></tr>
</table>


<h3>Details</h3>

<p>More details</p>


<h3>Value</h3>

<table>
<tr><td><code>hazard</code></td>
<td>
<p>Hazard function</p>
</td></tr>
<tr><td><code>cumhazard</code></td>
<td>
<p>Cumulative hazard function</p>
</td></tr>
<tr><td><code>density</code></td>
<td>
<p>Density function</p>
</td></tr>
<tr><td><code>dist</code></td>
<td>
<p>Distribution function</p>
</td></tr>
<tr><td><code>surv</code></td>
<td>
<p>Survival function</p>
</td></tr>
</table>


<h3>Note</h3>

<p>This provides a random number generator of the piecewise exponetial distribution with crossover</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo et al. (2018) Design and monitoring of survival trials in complex scenarios, Statistics in Medicine &lt;doi: https://doi.org/10.1002/sim.7975&gt;.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rpwe">rpwe</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>r1&lt;-c(0.6,0.3)
r2&lt;-c(0.6,0.6)
r3&lt;-c(0.1,0.2)
r4&lt;-c(0.5,0.4)
r5&lt;-c(0.4,0.5)
pwecxfun&lt;-pwecx(t=seq(0,10,by=0.5),rate1=r1,rate2=r2,rate3=r3,rate4=r4,
                rate5=r5,tchange=c(0,1),type=1,eps=1.0e-2)
pwecxfun$surv
</code></pre>

<hr>
<h2 id='pwecxcens'>Integration of the density of piecewise exponential distribution with crossover effect and the censoring  function</h2><span id='topic+pwecxcens'></span>

<h3>Description</h3>

<p>This will calculate the functions according to the piecewise exponential distribution with crossover</p>


<h3>Usage</h3>

<pre><code class='language-R'>pwecxcens(t=seq(0,10,by=0.5),rate1=c(1,0.5),rate2=rate1,
                rate3=c(0.7,0.4),rate4=rate2,rate5=rate2,ratec=c(0.2,0.3),
                tchange=c(0,1),type=1,rp2=0.5,eps=1.0e-2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pwecxcens_+3A_t">t</code></td>
<td>
<p>a vector of time points</p>
</td></tr>
<tr><td><code id="pwecxcens_+3A_rate1">rate1</code></td>
<td>
<p>piecewise constant event rate before crossover</p>
</td></tr>
<tr><td><code id="pwecxcens_+3A_rate2">rate2</code></td>
<td>
<p>piecewise constant event rate after crossover</p>
</td></tr>
<tr><td><code id="pwecxcens_+3A_rate3">rate3</code></td>
<td>
<p>piecewise constant event rate for crossover</p>
</td></tr>
<tr><td><code id="pwecxcens_+3A_rate4">rate4</code></td>
<td>
<p>additional piecewise constant event rate for more complex crossover</p>
</td></tr>
<tr><td><code id="pwecxcens_+3A_rate5">rate5</code></td>
<td>
<p>additional piecewise constant event rate for more complex crossover</p>
</td></tr>
<tr><td><code id="pwecxcens_+3A_ratec">ratec</code></td>
<td>
<p>censoring piecewise constant event rate</p>
</td></tr>
<tr><td><code id="pwecxcens_+3A_tchange">tchange</code></td>
<td>
<p>a strictly increasing sequence of time points starting from zero at which event rate changes. The first element of tchange must be zero. The above rates <code>rate1</code> to <code>ratec</code> and tchange must have the same length.</p>
</td></tr>
<tr><td><code id="pwecxcens_+3A_type">type</code></td>
<td>
<p>type of crossover, i.e. markov, semi-markov and hybrid</p>
</td></tr>
<tr><td><code id="pwecxcens_+3A_rp2">rp2</code></td>
<td>
<p>re-randomization prob</p>
</td></tr>
<tr><td><code id="pwecxcens_+3A_eps">eps</code></td>
<td>
<p>tolerance</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is to calculate the function (and its derivative)
</p>
<p style="text-align: center;"><code class="reqn">\xi(t)=\int_0^t \widetilde{f}(s)S_C(s)ds,</code>
</p>

<p>where <code class="reqn">S_C</code> is the piecewise exponential survival function of the censoring time, defined by <code>tchange</code> and <code>ratec</code>, and <code class="reqn">\widetilde{f}</code> is the density for the event distribution subject to crossover defined by <code>tchange</code>, <code>rate1</code> to <code>rate5</code> and <code>type</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>du</code></td>
<td>
<p>the function</p>
</td></tr>
<tr><td><code>duprime</code></td>
<td>
<p>its derivative</p>
</td></tr>
<tr><td><code>s</code></td>
<td>
<p>the survival function of <code class="reqn">\widetilde{f}</code></p>
</td></tr>
<tr><td><code>sc</code></td>
<td>
<p>the survival function <code class="reqn">S_C</code></p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rpwe">rpwe</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>r1&lt;-c(0.6,0.3)
r2&lt;-c(0.6,0.6)
r3&lt;-c(0.1,0.2)
r4&lt;-c(0.5,0.4)
r5&lt;-c(0.4,0.5)
rc&lt;-c(0.5,0.6)
exu&lt;-pwecxcens(t=seq(0,10,by=0.5),rate1=r1,rate2=r2,
               rate3=r3,rate4=r4,rate5=r5,ratec=rc,
               tchange=c(0,1),type=1,eps=1.0e-2)
c(exu$du,exu$duprime)
</code></pre>

<hr>
<h2 id='pwecxpwu'>Integration of the density of piecewise exponential distribution with crossover effect, censoring and recruitment function</h2><span id='topic+pwecxpwu'></span>

<h3>Description</h3>

<p>This will calculate the functions according to the piecewise exponential distribution with crossover</p>


<h3>Usage</h3>

<pre><code class='language-R'>pwecxpwu(t=seq(0,10,by=0.5),taur=5,
        u=c(1/taur,1/taur),ut=c(taur/2,taur),
        rate1=c(1,0.5),rate2=rate1,rate3=c(0.7,0.4),
        rate4=rate2,rate5=rate2,ratec=c(0.5,0.6),
        tchange=c(0,1),type=1,rp2=0.5,eps=1.0e-2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pwecxpwu_+3A_t">t</code></td>
<td>
<p>a vector of time points</p>
</td></tr>
<tr><td><code id="pwecxpwu_+3A_taur">taur</code></td>
<td>
<p>recruitment time</p>
</td></tr>
<tr><td><code id="pwecxpwu_+3A_u">u</code></td>
<td>
<p>recruitment rate</p>
</td></tr>
<tr><td><code id="pwecxpwu_+3A_ut">ut</code></td>
<td>
<p>recruitment interval, must have the same length as <code>u</code></p>
</td></tr>
<tr><td><code id="pwecxpwu_+3A_rate1">rate1</code></td>
<td>
<p>piecewise constant event rate before crossover</p>
</td></tr>
<tr><td><code id="pwecxpwu_+3A_rate2">rate2</code></td>
<td>
<p>piecewise constant event rate after crossover</p>
</td></tr>
<tr><td><code id="pwecxpwu_+3A_rate3">rate3</code></td>
<td>
<p>piecewise constant event rate for crossover</p>
</td></tr>
<tr><td><code id="pwecxpwu_+3A_rate4">rate4</code></td>
<td>
<p>additional piecewise constant event rate for more complex crossover</p>
</td></tr>
<tr><td><code id="pwecxpwu_+3A_rate5">rate5</code></td>
<td>
<p>additional piecewise constant event rate for more complex crossover</p>
</td></tr>
<tr><td><code id="pwecxpwu_+3A_ratec">ratec</code></td>
<td>
<p>censoring piecewise constant event rate</p>
</td></tr>
<tr><td><code id="pwecxpwu_+3A_tchange">tchange</code></td>
<td>
<p>a strictly increasing sequence of time points starting from zero at which event rate changes. The first element of tchange must be zero. The above rates <code>rate1</code> to <code>ratec</code> and tchange must have the same length.</p>
</td></tr>
<tr><td><code id="pwecxpwu_+3A_type">type</code></td>
<td>
<p>type of crossover, i.e. markov, semi-markov and hybrid</p>
</td></tr>
<tr><td><code id="pwecxpwu_+3A_rp2">rp2</code></td>
<td>
<p>re-randomization prob</p>
</td></tr>
<tr><td><code id="pwecxpwu_+3A_eps">eps</code></td>
<td>
<p>tolerance</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is to calculate the function (and its derivative)
</p>
<p style="text-align: center;"><code class="reqn">\xi(t)=\int_0^t G_E(t-s)\widetilde{f}(s)S_C(s)ds,</code>
</p>

<p>where <code class="reqn">G_E</code> is the accrual function defined by <code>taur</code>, <code>u</code> and <code>ut</code>, <code class="reqn">S_C</code> is the piecewise exponential survival function of the censoring time, defined by <code>tchange</code> and <code>ratec</code>, and <code class="reqn">\widetilde{f}</code> is the density for the event distribution subject to crossover defined by <code>tchange</code>, <code>rate1</code> to <code>rate5</code> and <code>type</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>du</code></td>
<td>
<p>the function</p>
</td></tr>
<tr><td><code>duprime</code></td>
<td>
<p>its derivative</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rpwe">rpwe</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>taur&lt;-2
u&lt;-c(0.6,0.4)
ut&lt;-c(1,2)
r1&lt;-c(0.6,0.3)
r2&lt;-c(0.6,0.6)
r3&lt;-c(0.1,0.2)
r4&lt;-c(0.5,0.4)
r5&lt;-c(0.4,0.5)
rc&lt;-c(0.5,0.6)
exu&lt;-pwecxpwu(t=seq(0,10,by=0.5),taur=taur,u=u,ut=ut,
        rate1=r1,rate2=r2,rate3=r3,rate4=r4,rate5=r5,ratec=rc,
        tchange=c(0,1),type=1,eps=1.0e-2)
c(exu$du,exu$duprime)
</code></pre>

<hr>
<h2 id='pwecxpwufindt'>calculate the timeline when certain number of events accumulates</h2><span id='topic+pwecxpwufindt'></span>

<h3>Description</h3>

<p>This will calculate the timeline from study inception accouting for staggered entry, delayed treatment effect,  treatment crossover and loss to follow-up.</p>


<h3>Usage</h3>

<pre><code class='language-R'>pwecxpwufindt(target=400,ntotal=1000,taur=5,u=c(1/taur,1/taur),ut=c(taur/2,taur),pi1=0.5,
                         rate11=c(1,0.5),rate21=c(0.8,0.9),rate31=c(0.7,0.4),
                         rate41=rate21,rate51=rate21,ratec1=c(0.5,0.6),
                         rate10=c(1,0.7),rate20=c(0.9,0.7),rate30=c(0.4,0.6),
                         rate40=rate20,rate50=rate20,ratec0=c(0.3,0.3),
                         tchange=c(0,1),type1=1,type0=1,
                         rp21=0.5,rp20=0.5,eps=1.0e-2,
                         init=taur,epsilon=0.000001,maxiter=100)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pwecxpwufindt_+3A_target">target</code></td>
<td>
<p>target number of events</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_ntotal">ntotal</code></td>
<td>
<p>total number of subjects</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_taur">taur</code></td>
<td>
<p>recruitment time</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_u">u</code></td>
<td>
<p>Piecewise constant recuitment rate</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_ut">ut</code></td>
<td>
<p>Recruitment intervals</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_pi1">pi1</code></td>
<td>
<p>Allocation probability for the treatment group</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_rate11">rate11</code></td>
<td>
<p>Hazard before crossover for the treatment group</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_rate21">rate21</code></td>
<td>
<p>Hazard after crossover for the treatment group</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_rate31">rate31</code></td>
<td>
<p>Hazard for time to crossover for the treatment group</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_rate41">rate41</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_rate51">rate51</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_ratec1">ratec1</code></td>
<td>
<p>Hazard for time to censoring for the treatment group</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_rate10">rate10</code></td>
<td>
<p>Hazard before crossover for the control group</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_rate20">rate20</code></td>
<td>
<p>Hazard after crossover for the control group</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_rate30">rate30</code></td>
<td>
<p>Hazard for time to crossover for the control group</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_rate40">rate40</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_rate50">rate50</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_ratec0">ratec0</code></td>
<td>
<p>Hazard for time to censoring for the control group</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_tchange">tchange</code></td>
<td>
<p>A strictly increasing sequence of time points at which the event rates changes. The first element of tchange                 must be zero. It must have the same length as <code>rate11</code>, <code>rate21</code>, <code>rate31</code>, etc.</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_type1">type1</code></td>
<td>
<p>Type of crossover in the treatment group</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_type0">type0</code></td>
<td>
<p>Type of crossover in the control group</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_rp21">rp21</code></td>
<td>
<p>re-randomization prob in the treatment group</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_rp20">rp20</code></td>
<td>
<p>re-randomization prob in the control group</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_eps">eps</code></td>
<td>
<p>A small number representing the error tolerance when calculating the utility function
</p>
<p style="text-align: center;"><code class="reqn">\Phi_l(x)=\frac{\int_0^x s^l e^{-s}ds}{x^{l+1}}</code>
</p>
<p> with <code class="reqn">l=0,1,2</code>.</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_init">init</code></td>
<td>
<p>initital value of the timeline estimate</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_epsilon">epsilon</code></td>
<td>
<p>A small number representing the error tolerance when calculating the timeline.</p>
</td></tr>
<tr><td><code id="pwecxpwufindt_+3A_maxiter">maxiter</code></td>
<td>
<p>Maximum number of iterations when calculating the timeline</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The hazard functions corresponding to <code>rate11</code>,...,<code>rate51</code>,<code>ratec1</code>, <code>rate10</code>,...,<code>rate50</code>,<code>ratec0</code> are all piecewise constant function taking the form  <code class="reqn">\lambda(t)=\sum_{j=1}^m \lambda_j I(t_{j-1}\le t&lt;t_j)</code>, where <code class="reqn">\lambda_1,\ldots,\lambda_m</code> are the corresponding elements of the rates and <code class="reqn">t_0,\ldots,t_{m-1}</code> are the corresponding elements of <cite>tchange</cite>, <code class="reqn">t_m=\infty</code>. Note that all the rates must have the same <code>tchange</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>t1</code></td>
<td>
<p>the calculated timeline</p>
</td></tr>
<tr><td><code>tvar</code></td>
<td>
<p>the true variance of the timeline estimator</p>
</td></tr>
<tr><td><code>eps</code></td>
<td>
<p>final tolerance</p>
</td></tr>
<tr><td><code>iter</code></td>
<td>
<p>Number of iterations performed</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Version 1.0 (7/19/2016)</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo et al. (2018) Design and monitoring of survival trials in complex scenarios, Statistics in Medicine &lt;doi: https://doi.org/10.1002/sim.7975&gt;.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pwe">pwe</a></code>,<code><a href="#topic+rpwe">rpwe</a></code>,<code><a href="#topic+qpwe">qpwe</a></code>,<code><a href="#topic+instudyfindt">instudyfindt</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>target&lt;-400
ntotal&lt;-2000
taur&lt;-1.2
u&lt;-c(1/taur,1/taur)
ut&lt;-c(taur/2,taur)
r11&lt;-c(1,0.5)
r21&lt;-c(0.5,0.8)
r31&lt;-c(0.7,0.4)
r41&lt;-r51&lt;-r21
rc1&lt;-c(0.5,0.6)
r10&lt;-c(1,0.7)
r20&lt;-c(0.5,1)
r30&lt;-c(0.3,0.4)
r40&lt;-r50&lt;-r20
rc0&lt;-c(0.2,0.4)
gettimeline&lt;-pwecxpwufindt(target=target,ntotal=ntotal,
                taur=5,u=c(1/taur,1/taur),ut=c(taur/2,taur),pi1=0.5,
                rate11=r11,rate21=r21,rate31=r31,rate41=r41,rate51=r51,ratec1=rc1,
                rate10=r10,rate20=r20,rate30=r30,rate40=r40,rate50=r50,ratec0=rc0,
                tchange=c(0,1),type1=1,type0=1,eps=1.0e-2,init=taur,epsilon=0.000001,maxiter=100)
gettimeline$t1
</code></pre>

<hr>
<h2 id='pwecxpwuforvar'>calculate the utility function used for varaince calculation</h2><span id='topic+pwecxpwuforvar'></span>

<h3>Description</h3>

<p>This is a utility function to calculate the overall variance accouting for staggered entry, delayed treatment effect,  treatment crossover and loss to follow-up.</p>


<h3>Usage</h3>

<pre><code class='language-R'>pwecxpwuforvar(tfix=10,t=seq(0,10,by=0.5),taur=5,u=c(1/taur,1/taur),ut=c(taur/2,taur),
    rate1=c(1,0.5),rate2=rate1,rate3=c(0.7,0.4),rate4=rate2,rate5=rate2,ratec=c(0.5,0.6),
         tchange=c(0,1),type=1,rp2=0.5,eps=1.0e-2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pwecxpwuforvar_+3A_tfix">tfix</code></td>
<td>
<p>The upper point where the integral is computed.</p>
</td></tr>
<tr><td><code id="pwecxpwuforvar_+3A_t">t</code></td>
<td>
<p>A vector of lower bounds where the integral is computed.</p>
</td></tr>
<tr><td><code id="pwecxpwuforvar_+3A_taur">taur</code></td>
<td>
<p>Recruitment time</p>
</td></tr>
<tr><td><code id="pwecxpwuforvar_+3A_u">u</code></td>
<td>
<p>Piecewise constant recuitment rate</p>
</td></tr>
<tr><td><code id="pwecxpwuforvar_+3A_ut">ut</code></td>
<td>
<p>Recruitment intervals</p>
</td></tr>
<tr><td><code id="pwecxpwuforvar_+3A_rate1">rate1</code></td>
<td>
<p>Hazard before crossover</p>
</td></tr>
<tr><td><code id="pwecxpwuforvar_+3A_rate2">rate2</code></td>
<td>
<p>Hazard after crossover</p>
</td></tr>
<tr><td><code id="pwecxpwuforvar_+3A_rate3">rate3</code></td>
<td>
<p>Hazard for time to crossover</p>
</td></tr>
<tr><td><code id="pwecxpwuforvar_+3A_rate4">rate4</code></td>
<td>
<p>Hazard after crossover for complex case</p>
</td></tr>
<tr><td><code id="pwecxpwuforvar_+3A_rate5">rate5</code></td>
<td>
<p>Hazard after crossover for complex case</p>
</td></tr>
<tr><td><code id="pwecxpwuforvar_+3A_ratec">ratec</code></td>
<td>
<p>Hazard for time to censoring</p>
</td></tr>
<tr><td><code id="pwecxpwuforvar_+3A_tchange">tchange</code></td>
<td>
<p>A strictly increasing sequence of time points at which the event rates changes. The first element of tchange                 must be zero. It must have the same length as <code>rate1</code>, <code>rate2</code>, <code>rate3</code>, etc.</p>
</td></tr>
<tr><td><code id="pwecxpwuforvar_+3A_type">type</code></td>
<td>
<p>Type of crossover</p>
</td></tr>
<tr><td><code id="pwecxpwuforvar_+3A_rp2">rp2</code></td>
<td>
<p>re-randomization prob</p>
</td></tr>
<tr><td><code id="pwecxpwuforvar_+3A_eps">eps</code></td>
<td>
<p>A small number representing the error tolerance when calculating the utility function
</p>
<p style="text-align: center;"><code class="reqn">\Phi_l(x)=\frac{\int_0^x s^l e^{-s}ds}{x^{l+1}}</code>
</p>
<p> with <code class="reqn">l=0,1,2</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is to calculate the function
</p>
<p style="text-align: center;"><code class="reqn">B_l(t,s)=\int_0^s x^l G_E(t-x)\widetilde{f}(x)S_C(x)dx,</code>
</p>

<p>where <code class="reqn">G_E</code> is the accrual function defined by <code>taur</code>, <code>u</code> and <code>ut</code>, <code class="reqn">S_C</code> is the piecewise exponential survival function of the censoring time, defined by <code>tchange</code> and <code>ratec</code>, and <code class="reqn">\widetilde{f}</code> is the density for the event distribution subject to crossover defined by <code>tchange</code>, <code>rate1</code> to <code>rate5</code> and <code>type</code>. This function is useful when calculating the overall varaince and covariance.
</p>


<h3>Value</h3>

<table>
<tr><td><code>f0</code></td>
<td>
<p>the integral when <code class="reqn">l=0</code></p>
</td></tr>
<tr><td><code>f1</code></td>
<td>
<p>the integral when <code class="reqn">l=1</code></p>
</td></tr>
</table>


<h3>Note</h3>

<p>Version 1.0 (7/19/2016)</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pwe">pwe</a></code>,<code><a href="#topic+rpwe">rpwe</a></code>,<code><a href="#topic+qpwe">qpwe</a></code>,<code><a href="#topic+ovbeta">ovbeta</a></code>,<code><a href="#topic+innervar">innervar</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>taur&lt;-1.2
u&lt;-c(1/taur,1/taur)
ut&lt;-c(taur/2,taur)
r11&lt;-c(1,0.5)
r21&lt;-c(0.5,0.8)
r31&lt;-c(0.7,0.4)
r41&lt;-r51&lt;-r21
rc1&lt;-c(0.5,0.6)
getf&lt;-pwecxpwuforvar(tfix=3,t=seq(0,3,by=1),taur=taur,u=u,ut=ut,
                 rate1=r11,rate2=r21,rate3=r31,rate4=r41,rate5=r51,ratec=rc1,
                 tchange=c(0,1),type=1,eps=1.0e-2)
getf
</code></pre>

<hr>
<h2 id='pwefv2'>A utility function</h2><span id='topic+pwefv2'></span>

<h3>Description</h3>

<p>This will $int_0^t s^k lambda_1(s)S_2(s)ds$ where k=0,1,2
and rate1=lambda_1 and S_2 has hazard rate2</p>


<h3>Usage</h3>

<pre><code class='language-R'>pwefv2(t=seq(0,5,by=0.5),rate1=c(0,5,0.8),
      rate2=rate1,tchange=c(0,3),eps=1.0e-2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pwefv2_+3A_t">t</code></td>
<td>
<p>A vector of time points</p>
</td></tr>
<tr><td><code id="pwefv2_+3A_rate1">rate1</code></td>
<td>
<p>piecewise constant event rate</p>
</td></tr>
<tr><td><code id="pwefv2_+3A_rate2">rate2</code></td>
<td>
<p>piecewise constant event rate</p>
</td></tr>
<tr><td><code id="pwefv2_+3A_tchange">tchange</code></td>
<td>
<p>a strictly increasing sequence of time points starting from zero at which event rate changes. The first element of tchange must be zero. The above rates and tchange must have the same length.</p>
</td></tr>
<tr><td><code id="pwefv2_+3A_eps">eps</code></td>
<td>
<p>tolerance</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Let <code class="reqn">h_1,h_2</code> correspond to <code>rate1</code>,<code>rate2</code>, and <code class="reqn">H_1,H_2</code> be the corresponding survival functions. 
This function will calculate
</p>
<p style="text-align: center;"><code class="reqn">\int_0^t s^k h_1(s)H_2(s)ds,\hspace{1cm} k=0,1,2.</code>
</p>



<h3>Value</h3>

<table>
<tr><td><code>f0</code></td>
<td>
<p>values when <code class="reqn">k=0</code></p>
</td></tr>
<tr><td><code>f1</code></td>
<td>
<p>values when <code class="reqn">k=1</code></p>
</td></tr>
<tr><td><code>f2</code></td>
<td>
<p>values when <code class="reqn">k=2</code></p>
</td></tr>
</table>


<h3>Note</h3>

<p>This will provide the number of events.</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo et al. (2018) Design and monitoring of survival trials in complex scenarios, Statistics in Medicine &lt;doi: https://doi.org/10.1002/sim.7975&gt;.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rpwe">rpwe</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>r1&lt;-c(0.6,0.3)
r2&lt;-c(0.6,0.6)
tchange&lt;-c(0,1.75)
pwefun&lt;-pwefv2(t=seq(0,5,by=0.5),rate1=r1,rate2=r2,
              tchange=tchange,eps=1.0e-2)
pwefun
</code></pre>

<hr>
<h2 id='pwefvplus'>A utility functon</h2><span id='topic+pwefvplus'></span>

<h3>Description</h3>

<p>This will calculate the more complex integration accounting for crossover</p>


<h3>Usage</h3>

<pre><code class='language-R'>pwefvplus(t=seq(0,5,by=0.5),rate1=c(0,5,0.8),rate2=rate1,
                   rate3=c(0.1,0.2),rate4=rate2,rate5=rate2,
                   rate6=c(0.5,0.3),tchange=c(0,3),type=1,
                   rp2=0.5,eps=1.0e-2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pwefvplus_+3A_t">t</code></td>
<td>
<p>A vector of time points</p>
</td></tr>
<tr><td><code id="pwefvplus_+3A_rate1">rate1</code></td>
<td>
<p>piecewise constant event rate</p>
</td></tr>
<tr><td><code id="pwefvplus_+3A_rate2">rate2</code></td>
<td>
<p>piecewise constant event rate</p>
</td></tr>
<tr><td><code id="pwefvplus_+3A_rate3">rate3</code></td>
<td>
<p>piecewise constant event rate</p>
</td></tr>
<tr><td><code id="pwefvplus_+3A_rate4">rate4</code></td>
<td>
<p>additional piecewise constant</p>
</td></tr>
<tr><td><code id="pwefvplus_+3A_rate5">rate5</code></td>
<td>
<p>additional piecewise constant</p>
</td></tr>
<tr><td><code id="pwefvplus_+3A_rate6">rate6</code></td>
<td>
<p>piecewise constant event rate for censoring</p>
</td></tr>
<tr><td><code id="pwefvplus_+3A_tchange">tchange</code></td>
<td>
<p>a strictly increasing sequence of time points starting from zero at which event rate changes. The first element of tchange must be zero. The above rates and tchange must have the same length.</p>
</td></tr>
<tr><td><code id="pwefvplus_+3A_type">type</code></td>
<td>
<p>type of the crossover, markov, semi-markov and hybrid</p>
</td></tr>
<tr><td><code id="pwefvplus_+3A_rp2">rp2</code></td>
<td>
<p>re-randomization prob</p>
</td></tr>
<tr><td><code id="pwefvplus_+3A_eps">eps</code></td>
<td>
<p>tolerance</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Let <code class="reqn">h_1,\ldots,h_6</code> correspond to <code>rate1</code>,...,<code>rate6</code>, and <code class="reqn">H_1,\ldots,H_6</code> be the corresponding survival functions. Also let <code class="reqn">\pi_2=\code{rp2}</code>.
when <code>type</code>=1, we calculate
</p>
<p style="text-align: center;"><code class="reqn">\int_0^t s^k h_2(s)H_2(s)H_6(s)\int_0^s h_3(u)H_1(u)H_3(u)/H_2(u)duds;</code>
</p>

<p>when <code>type</code>=2, we calculate
</p>
<p style="text-align: center;"><code class="reqn">\int_0^t s^kH_6(s)\int_0^s h_3(u)H_1(u)H_3(u)h_2(s-u)H_2(s-u)duds;</code>
</p>

<p>when <code>type</code>=3, we calculate the sum of 
</p>
<p style="text-align: center;"><code class="reqn">\pi_2\int_0^t s^kH_4^{1-\pi_2}(s)H_6(s)\int_0^s h_3(u)H_1(u)H_3(u)h_2(s-u)H_2^{\pi_2}(s-u)/H_4^{1-\pi_2}(u)duds</code>
</p>

<p>and 
</p>
<p style="text-align: center;"><code class="reqn">(1-\pi_2)\int_0^t s^kh_4(s)H_4^{1-\pi_2}(s)H_6(s)\int_0^s h_3(u)H_1(u)H_3(u)H_2^{\pi_2}(s-u)/H_4^{1-\pi_2}(u)duds;</code>
</p>

<p>when <code>type</code>=4, we calculate the sum of 
</p>
<p style="text-align: center;"><code class="reqn">\pi_2\int_0^t s^kH_6(s)\int_0^s h_3(u)H_1(u)H_3(u)h_2(s-u)H_2(s-u)duds</code>
</p>

<p>and
</p>
<p style="text-align: center;"><code class="reqn">(1-\pi_2)\int_0^t s^kh_4(s)H_4(s)H_6(s)\int_0^s h_3(u)H_1(u)H_3(u)/H_4(u)duds;</code>
</p>

<p>when <code>type</code>=5, we calculate the sum of
</p>
<p style="text-align: center;"><code class="reqn">\pi_2\int_0^t s^kH_6(s)\int_0^s h_3(u)H_1(u)H_3(u)h_2(s-u)H_2(s-u)duds</code>
</p>

<p>and
</p>
<p style="text-align: center;"><code class="reqn">(1-\pi_2)\int_0^t s^kH_6(s)\int_0^s h_3(u)H_1(u)H_3(u)h_4(s-u)H_4(s-u)duds.</code>
</p>



<h3>Value</h3>

<table>
<tr><td><code>f0</code></td>
<td>
<p>values when <code class="reqn">k=0</code></p>
</td></tr>
<tr><td><code>f1</code></td>
<td>
<p>values when <code class="reqn">k=1</code></p>
</td></tr>
<tr><td><code>f2</code></td>
<td>
<p>values when <code class="reqn">k=2</code></p>
</td></tr>
</table>


<h3>Note</h3>

<p>This provides the result of the complex integration</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo et al. (2018) Design and monitoring of survival trials in complex scenarios, Statistics in Medicine &lt;doi: https://doi.org/10.1002/sim.7975&gt;.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rpwe">rpwe</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>r1&lt;-c(0.6,0.3)
r2&lt;-c(0.6,0.6)
r3&lt;-c(0.1,0.2)
r4&lt;-c(0.5,0.4)
r5&lt;-c(0.4,0.5)
r6&lt;-c(0.4,0.5)
tchange&lt;-c(0,1.75)
pwefun&lt;-pwefvplus(t=seq(0,5,by=0.5),rate1=r1,rate2=r2,rate3=r3,
                 rate4=r4,rate5=r5,rate6=r6,
                 tchange=c(0,3),type=1,eps=1.0e-2)
pwefun
</code></pre>

<hr>
<h2 id='pwepower'>Calculating the powers of various the test statistics for superiority trials</h2><span id='topic+pwepower'></span>

<h3>Description</h3>

<p>This will calculate the powers for the test statistics accouting for staggered entry, delayed treatment effect,  treatment crossover and loss to follow-up.</p>


<h3>Usage</h3>

<pre><code class='language-R'>pwepower(t=seq(0.1,3,by=0.5),alpha=0.05,twosided=1,taur=1.2,
             u=c(1/taur,1/taur),ut=c(taur/2,taur),pi1=0.5,
             rate11=c(1,0.5),rate21=rate11,rate31=c(0.7,0.4),
             rate41=rate21,rate51=rate21,ratec1=c(0.5,0.6),
             rate10=rate11,rate20=rate10,rate30=rate31,
             rate40=rate20,rate50=rate20,ratec0=c(0.6,0.5),
             tchange=c(0,1),type1=1,type0=1,rp21=0.5,rp20=0.5,
             eps=1.0e-2,veps=1.0e-2,epsbeta=1.0e-4,iterbeta=25,
             n=1000)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pwepower_+3A_t">t</code></td>
<td>
<p>a vector of time points at which power is calculated, <code>t</code> must be positive</p>
</td></tr>
<tr><td><code id="pwepower_+3A_alpha">alpha</code></td>
<td>
<p>type-1 error rate</p>
</td></tr>
<tr><td><code id="pwepower_+3A_twosided">twosided</code></td>
<td>
<p>twosided test or not</p>
</td></tr>
<tr><td><code id="pwepower_+3A_taur">taur</code></td>
<td>
<p>Recruitment time</p>
</td></tr>
<tr><td><code id="pwepower_+3A_u">u</code></td>
<td>
<p>Piecewise constant recuitment rate</p>
</td></tr>
<tr><td><code id="pwepower_+3A_ut">ut</code></td>
<td>
<p>Recruitment intervals</p>
</td></tr>
<tr><td><code id="pwepower_+3A_pi1">pi1</code></td>
<td>
<p>Allocation probability for the treatment group</p>
</td></tr>
<tr><td><code id="pwepower_+3A_rate11">rate11</code></td>
<td>
<p>Hazard before crossover for the treatment group</p>
</td></tr>
<tr><td><code id="pwepower_+3A_rate21">rate21</code></td>
<td>
<p>Hazard after crossover for the treatment group</p>
</td></tr>
<tr><td><code id="pwepower_+3A_rate31">rate31</code></td>
<td>
<p>Hazard for time to crossover for the treatment group</p>
</td></tr>
<tr><td><code id="pwepower_+3A_rate41">rate41</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="pwepower_+3A_rate51">rate51</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="pwepower_+3A_ratec1">ratec1</code></td>
<td>
<p>Hazard for time to censoring for the treatment group</p>
</td></tr>
<tr><td><code id="pwepower_+3A_rate10">rate10</code></td>
<td>
<p>Hazard before crossover for the control group</p>
</td></tr>
<tr><td><code id="pwepower_+3A_rate20">rate20</code></td>
<td>
<p>Hazard after crossover for the control group</p>
</td></tr>
<tr><td><code id="pwepower_+3A_rate30">rate30</code></td>
<td>
<p>Hazard for time to crossover for the control group</p>
</td></tr>
<tr><td><code id="pwepower_+3A_rate40">rate40</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="pwepower_+3A_rate50">rate50</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="pwepower_+3A_ratec0">ratec0</code></td>
<td>
<p>Hazard for time to censoring for the control group</p>
</td></tr>
<tr><td><code id="pwepower_+3A_tchange">tchange</code></td>
<td>
<p>A strictly increasing sequence of time points at which the event rates changes. The first element of tchange                 must be zero. It must have the same length as <code>rate11</code>, <code>rate21</code>, <code>rate31</code>, etc.</p>
</td></tr>
<tr><td><code id="pwepower_+3A_type1">type1</code></td>
<td>
<p>Type of crossover in the treatment group</p>
</td></tr>
<tr><td><code id="pwepower_+3A_type0">type0</code></td>
<td>
<p>Type of crossover in the control group</p>
</td></tr>
<tr><td><code id="pwepower_+3A_rp21">rp21</code></td>
<td>
<p>re-randomization prob for the treatment group</p>
</td></tr>
<tr><td><code id="pwepower_+3A_rp20">rp20</code></td>
<td>
<p>re-randomization prob for the control group</p>
</td></tr>
<tr><td><code id="pwepower_+3A_eps">eps</code></td>
<td>
<p>error tolerence</p>
</td></tr>
<tr><td><code id="pwepower_+3A_veps">veps</code></td>
<td>
<p>error tolenrence for calculating variance</p>
</td></tr>
<tr><td><code id="pwepower_+3A_epsbeta">epsbeta</code></td>
<td>
<p>error tolerance for calculating overall log HR</p>
</td></tr>
<tr><td><code id="pwepower_+3A_iterbeta">iterbeta</code></td>
<td>
<p>maximum number of iterations for calculating overall log HR</p>
</td></tr>
<tr><td><code id="pwepower_+3A_n">n</code></td>
<td>
<p>total number of subjects</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The hazard functions corresponding to <code>rate11</code>,...,<code>rate51</code>,<code>ratec1</code>, <code>rate10</code>,...,<code>rate50</code>,<code>ratec0</code> are all piecewise constant function taking the form  <code class="reqn">\lambda(t)=\sum_{j=1}^m \lambda_j I(t_{j-1}\le t&lt;t_j)</code>, where <code class="reqn">\lambda_1,\ldots,\lambda_m</code> are the corresponding elements of the rates and <code class="reqn">t_0,\ldots,t_{m-1}</code> are the corresponding elements of <cite>tchange</cite>, <code class="reqn">t_m=\infty</code>. Note that all the rates must have the same <code>tchange</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>power</code></td>
<td>
<p>powers for various test statistics. Columns 2-6 are for log-rank and columns 12-16 are for cox model. Column 2 is the exact power based on log-rank/score test; column 3 uses variance approximated by Fisher information, i.e. Lakatos's method; column 4 uses approximated Fisher info by number of events i.e. 4/D(t); column 5 uses approximated Fisher info by assuming exp dist. 1/D1(t)+1/D0(t); column 6 uses Fisher information at beta. Column 12 is the exact power based on Wald test;  column 13 uses variance approximated by Fisher information; column 14 uses approximated Fisher info by number of events i.e. 4/D(t); column 15 uses approximated Fisher info by assuming exp dist. 1/D1(t)+1/D0(t); column 16 uses Fisher information at beta=0.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Version 1.0 (7/19/2016)</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pwe">pwe</a></code>,<code><a href="#topic+rpwe">rpwe</a></code>,<code><a href="#topic+qpwe">qpwe</a></code>,<code><a href="#topic+ovbeta">ovbeta</a></code>,<code><a href="#topic+innervar">innervar</a></code>,
<code><a href="#topic+pwepowerni">pwepowerni</a></code>,<code><a href="#topic+pwepowereq">pwepowereq</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>t&lt;-seq(3,6,by=1)
taur&lt;-1.2
u&lt;-c(1/taur,1/taur)
ut&lt;-c(taur/2,taur)
r11&lt;-c(0.2,0.1)
r21&lt;-r11
r31&lt;-c(0.03,0.02)
r41&lt;-r51&lt;-r21
rc1&lt;-c(0.01,0.02)
r10&lt;-c(0.2,0.2)
r20&lt;-r10
r30&lt;-c(0.02,0.01)
r40&lt;-r50&lt;-r20
rc0&lt;-c(0.02,0.01)
getpower&lt;-pwepower(t=t,alpha=0.05,twosided=1,taur=taur,u=u,ut=ut,pi1=0.5,
                   rate11=r11,rate21=r21,rate31=r31,rate41=r41,rate51=r51,ratec1=rc1,
                   rate10=r10,rate20=r20,rate30=r30,rate40=r40,rate50=r50,ratec0=rc0,
                   tchange=c(0,1),type1=1,type0=1,n=1000)
###powers at each time point
cbind(t,getpower$power[,c(2:4,12:14)])
</code></pre>

<hr>
<h2 id='pwepowereq'>Calculating the powers of various the test statistics for equivalence trials</h2><span id='topic+pwepowereq'></span>

<h3>Description</h3>

<p>This will calculate the powers for the test statistics accouting for staggered entry, delayed treatment effect,  treatment crossover and loss to follow-up.</p>


<h3>Usage</h3>

<pre><code class='language-R'>pwepowereq(t=seq(0.1,3,by=0.5),uppermargin=1.3,lowermargin=1/uppermargin,
           alpha=0.05,taur=1.2,u=c(1/taur,1/taur),ut=c(taur/2,taur),pi1=0.5,
             rate11=c(1,0.5),rate21=rate11,rate31=c(0.7,0.4),
             rate41=rate21,rate51=rate21,ratec1=c(0.5,0.6),
             rate10=rate11,rate20=rate10,rate30=rate31,
             rate40=rate20,rate50=rate20,ratec0=c(0.6,0.5),
             tchange=c(0,1),type1=1,type0=1,
             rp21=0.5,rp20=0.5,eps=1.0e-2,veps=1.0e-2,
             epsbeta=1.0e-4,iterbeta=25,n=1000)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pwepowereq_+3A_t">t</code></td>
<td>
<p>a vector of time points at which power is calculated, <code>t</code> must be positive</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_uppermargin">uppermargin</code></td>
<td>
<p>the upper margin for the hazard ratio</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_lowermargin">lowermargin</code></td>
<td>
<p>the lower margin for the hazard ratio</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_alpha">alpha</code></td>
<td>
<p>type-1 error rate</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_taur">taur</code></td>
<td>
<p>Recruitment time</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_u">u</code></td>
<td>
<p>Piecewise constant recuitment rate</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_ut">ut</code></td>
<td>
<p>Recruitment intervals</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_pi1">pi1</code></td>
<td>
<p>Allocation probability for the treatment group</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_rate11">rate11</code></td>
<td>
<p>Hazard before crossover for the treatment group</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_rate21">rate21</code></td>
<td>
<p>Hazard after crossover for the treatment group</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_rate31">rate31</code></td>
<td>
<p>Hazard for time to crossover for the treatment group</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_rate41">rate41</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_rate51">rate51</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_ratec1">ratec1</code></td>
<td>
<p>Hazard for time to censoring for the treatment group</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_rate10">rate10</code></td>
<td>
<p>Hazard before crossover for the control group</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_rate20">rate20</code></td>
<td>
<p>Hazard after crossover for the control group</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_rate30">rate30</code></td>
<td>
<p>Hazard for time to crossover for the control group</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_rate40">rate40</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_rate50">rate50</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_ratec0">ratec0</code></td>
<td>
<p>Hazard for time to censoring for the control group</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_tchange">tchange</code></td>
<td>
<p>A strictly increasing sequence of time points at which the event rates changes. The first element of tchange                 must be zero. It must have the same length as <code>rate11</code>, <code>rate21</code>, <code>rate31</code>, etc.</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_type1">type1</code></td>
<td>
<p>Type of crossover in the treatment group</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_type0">type0</code></td>
<td>
<p>Type of crossover in the control group</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_rp21">rp21</code></td>
<td>
<p>re-randomization prob in the treatment group</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_rp20">rp20</code></td>
<td>
<p>re-randomization prob in the control group</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_eps">eps</code></td>
<td>
<p>error tolerence</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_veps">veps</code></td>
<td>
<p>error tolenrence for calculating variance</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_epsbeta">epsbeta</code></td>
<td>
<p>error tolerance for calculating overall log HR</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_iterbeta">iterbeta</code></td>
<td>
<p>maximum number of iterations for calculating overall log HR</p>
</td></tr>
<tr><td><code id="pwepowereq_+3A_n">n</code></td>
<td>
<p>total number of subjects</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The hazard functions corresponding to <code>rate11</code>,...,<code>rate51</code>,<code>ratec1</code>, <code>rate10</code>,...,<code>rate50</code>,<code>ratec0</code> are all piecewise constant function taking the form  <code class="reqn">\lambda(t)=\sum_{j=1}^m \lambda_j I(t_{j-1}\le t&lt;t_j)</code>, where <code class="reqn">\lambda_1,\ldots,\lambda_m</code> are the corresponding elements of the rates and <code class="reqn">t_0,\ldots,t_{m-1}</code> are the corresponding elements of <cite>tchange</cite>, <code class="reqn">t_m=\infty</code>. Note that all the rates must have the same <code>tchange</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>power</code></td>
<td>
<p>powers for cox model. First column is the more accurate power, second column is the power assuming the Fisher information equal to the varaince of beta</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Version 1.0 (7/19/2016)</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pwe">pwe</a></code>,<code><a href="#topic+rpwe">rpwe</a></code>,<code><a href="#topic+qpwe">qpwe</a></code>,<code><a href="#topic+ovbeta">ovbeta</a></code>,<code><a href="#topic+innervar">innervar</a></code>,
<code><a href="#topic+pwepower">pwepower</a></code>,<code><a href="#topic+pwepowerni">pwepowerni</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>t&lt;-seq(3,6,by=1)
taur&lt;-1.2
u&lt;-c(1/taur,1/taur)
ut&lt;-c(taur/2,taur)
r11&lt;-c(0.2,0.1)
r21&lt;-r11
r31&lt;-c(0.03,0.02)
r41&lt;-r51&lt;-r21
rc1&lt;-c(0.01,0.02)
r10&lt;-c(0.2,0.2)
r20&lt;-r10
r30&lt;-c(0.02,0.01)
r40&lt;-r50&lt;-r20
rc0&lt;-c(0.02,0.01)
getpowereq&lt;-pwepowereq(t=t,uppermargin=1.3,lowermargin=0.8,alpha=0.05,taur=taur,
            u=u,ut=ut,pi1=0.5,rate11=r11,rate21=r21,rate31=r31,
            rate41=r41,rate51=r51,ratec1=rc1,
            rate10=r10,rate20=r20,rate30=r30,rate40=r40,rate50=r50,ratec0=rc0,
            tchange=c(0,1),type1=1,type0=1,n=1000)
###powers at each time point
cbind(t,getpowereq$power[,1:3])
</code></pre>

<hr>
<h2 id='pwepowerfindt'>Calculating the timepoint where a certain power of the specified test statistics is obtained</h2><span id='topic+pwepowerfindt'></span>

<h3>Description</h3>

<p>This will calculate the timepoint where a certain power of the specified test statistics is obtained accouting for staggered entry, delayed treatment effect,  treatment crossover and loss to follow-up.</p>


<h3>Usage</h3>

<pre><code class='language-R'>pwepowerfindt(power=0.9,alpha=0.05,twosided=1,tupp=5,tlow=1,taur=1.2,
                     u=c(1/taur,1/taur),ut=c(taur/2,taur),pi1=0.5,
                     rate11=c(1,0.5),rate21=rate11,rate31=c(0.7,0.4),
                     rate41=rate21,rate51=rate21,ratec1=c(0.5,0.6),
                     rate10=rate11,rate20=rate10,rate30=rate31,
                     rate40=rate20,rate50=rate20,ratec0=c(0.6,0.5),
                     tchange=c(0,1),type1=1,type0=1,
                     rp21=0.5,rp20=0.5,eps=1.0e-2,veps=1.0e-2,
                     epsbeta=1.0e-04,iterbeta=25,
                     n=1000,testtype=1,maxiter=20,itereps=0.001)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pwepowerfindt_+3A_power">power</code></td>
<td>
<p>the desired power</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_alpha">alpha</code></td>
<td>
<p>type-1 error</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_twosided">twosided</code></td>
<td>
<p>twoside test or not</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_tupp">tupp</code></td>
<td>
<p>an upper time point where the power should be larger than <code>power</code></p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_tlow">tlow</code></td>
<td>
<p>a lower time point where the power should be smaller than <code>power</code></p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_taur">taur</code></td>
<td>
<p>recruitment time</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_u">u</code></td>
<td>
<p>Piecewise constant recuitment rate</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_ut">ut</code></td>
<td>
<p>Recruitment intervals</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_pi1">pi1</code></td>
<td>
<p>Allocation probability for the treatment group</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_rate11">rate11</code></td>
<td>
<p>Hazard before crossover for the treatment group</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_rate21">rate21</code></td>
<td>
<p>Hazard after crossover for the treatment group</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_rate31">rate31</code></td>
<td>
<p>Hazard for time to crossover for the treatment group</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_rate41">rate41</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_rate51">rate51</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_ratec1">ratec1</code></td>
<td>
<p>Hazard for time to censoring for the treatment group</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_rate10">rate10</code></td>
<td>
<p>Hazard before crossover for the control group</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_rate20">rate20</code></td>
<td>
<p>Hazard after crossover for the control group</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_rate30">rate30</code></td>
<td>
<p>Hazard for time to crossover for the control group</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_rate40">rate40</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_rate50">rate50</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_ratec0">ratec0</code></td>
<td>
<p>Hazard for time to censoring for the control group</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_tchange">tchange</code></td>
<td>
<p>A strictly increasing sequence of time points at which the event rates changes. The first element of tchange                 must be zero. It must have the same length as <code>rate11</code>, <code>rate21</code>, <code>rate31</code>, etc.</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_type1">type1</code></td>
<td>
<p>Type of crossover in the treatment group</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_type0">type0</code></td>
<td>
<p>Type of crossover in the control group</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_rp21">rp21</code></td>
<td>
<p>re-randomization prob in the treatment group</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_rp20">rp20</code></td>
<td>
<p>re-randomization prob in the control group</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_eps">eps</code></td>
<td>
<p>error tolerence</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_veps">veps</code></td>
<td>
<p>error tolenrence for calculating variance</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_epsbeta">epsbeta</code></td>
<td>
<p>error tolerance for calculating overall log HR</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_iterbeta">iterbeta</code></td>
<td>
<p>maximum number of iterations for calculating overall log HR</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_n">n</code></td>
<td>
<p>total number of subjects</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_testtype">testtype</code></td>
<td>
<p>test statistics, =1 log-rank;=2 Cox model; =3 log-rank with robust variance</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_maxiter">maxiter</code></td>
<td>
<p>maximum number of bi-section iterations</p>
</td></tr>
<tr><td><code id="pwepowerfindt_+3A_itereps">itereps</code></td>
<td>
<p>error tolerance of <code>power</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The hazard functions corresponding to <code>rate11</code>,...,<code>rate51</code>,<code>ratec1</code>, <code>rate10</code>,...,<code>rate50</code>,<code>ratec0</code> are all piecewise constant function taking the form  <code class="reqn">\lambda(t)=\sum_{j=1}^m \lambda_j I(t_{j-1}\le t&lt;t_j)</code>, where <code class="reqn">\lambda_1,\ldots,\lambda_m</code> are the corresponding elements of the rates and <code class="reqn">t_0,\ldots,t_{m-1}</code> are the corresponding elements of <cite>tchange</cite>, <code class="reqn">t_m=\infty</code>. Note that all the rates must have the same <code>tchange</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>testtype</code></td>
<td>
<p>type of statistic, =1 log-rank;=2 Cox model; =3 log-rank with robust variance</p>
</td></tr>
<tr><td><code>time</code></td>
<td>
<p>time calculated when the iterations stop</p>
</td></tr>
<tr><td><code>power</code></td>
<td>
<p>the power at <code>time</code></p>
</td></tr>
<tr><td><code>err</code></td>
<td>
<p>distance from the desired power</p>
</td></tr>
<tr><td><code>k</code></td>
<td>
<p>number of bi-section iterations performed</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Version 1.0 (7/19/2016)</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pwe">pwe</a></code>,<code><a href="#topic+rpwe">rpwe</a></code>,<code><a href="#topic+qpwe">qpwe</a></code>,<code><a href="#topic+ovbeta">ovbeta</a></code>,<code><a href="#topic+innervar">innervar</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>t&lt;-seq(3,6,by=1)
taur&lt;-1.2
u&lt;-c(1/taur,1/taur)
ut&lt;-c(taur/2,taur)
r11&lt;-c(0.2,0.1)
r21&lt;-r11
r31&lt;-c(0.03,0.02)
r41&lt;-r51&lt;-r21
rc1&lt;-c(0.01,0.02)
r10&lt;-c(0.2,0.2)
r20&lt;-r10
r30&lt;-c(0.02,0.01)
r40&lt;-r50&lt;-r20
rc0&lt;-c(0.02,0.01)
getpower&lt;-pwepower(t=t,alpha=0.05,twosided=1,taur=taur,u=u,ut=ut,pi1=0.5,
                   rate11=r11,rate21=r21,rate31=r31,rate41=r41,rate51=r51,ratec1=rc1,
                   rate10=r10,rate20=r20,rate30=r30,rate40=r40,rate50=r50,ratec0=rc0,
                   tchange=c(0,1),type1=1,type0=1,n=1000)
###powers at each time point
cbind(t,getpower$power[,1:3])

###90% power should be in (3,3.5)
getpwtime&lt;-pwepowerfindt(power=0.9,alpha=0.05,twosided=1,tupp=3.5,tlow=3,taur=taur,
        u=u,ut=ut,pi1=0.5,rate11=r11,rate21=r21,rate31=r31,rate41=r41,rate51=r51,ratec1=rc1,
        rate10=r10,rate20=r20,rate30=r30,rate40=r40,rate50=r50,ratec0=rc0,
        tchange=c(0,1),type1=1,type0=1,n=1000,testtype=1,maxiter=30)
getpwtime
</code></pre>

<hr>
<h2 id='pwepowerni'>Calculating the powers of various the test statistics for non-inferiority trials</h2><span id='topic+pwepowerni'></span>

<h3>Description</h3>

<p>This will calculate the powers for the test statistics accouting for staggered entry, delayed treatment effect,  treatment crossover and loss to follow-up.</p>


<h3>Usage</h3>

<pre><code class='language-R'>pwepowerni(t=seq(0.1,3,by=0.5),nimargin=1.3,alpha=0.05,twosided=0,taur=1.2,
           u=c(1/taur,1/taur),ut=c(taur/2,taur),pi1=0.5,
           rate11=c(1,0.5),rate21=rate11,rate31=c(0.7,0.4),
           rate41=rate21,rate51=rate21,ratec1=c(0.5,0.6),
           rate10=rate11,rate20=rate10,rate30=rate31,
           rate40=rate20,rate50=rate20,ratec0=c(0.6,0.5),
           tchange=c(0,1),type1=1,type0=1,
           rp21=0.5,rp20=0.5,eps=1.0e-2,veps=1.0e-2,
           epsbeta=1.0e-4,iterbeta=25,n=1000)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pwepowerni_+3A_t">t</code></td>
<td>
<p>a vector of time points at which power is calculated, <code>t</code> must be positive</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_nimargin">nimargin</code></td>
<td>
<p>the non-inferiority margin for the hazard ratio</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_alpha">alpha</code></td>
<td>
<p>type-1 error rate</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_twosided">twosided</code></td>
<td>
<p>twosided test or not</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_taur">taur</code></td>
<td>
<p>Recruitment time</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_u">u</code></td>
<td>
<p>Piecewise constant recuitment rate</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_ut">ut</code></td>
<td>
<p>Recruitment intervals</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_pi1">pi1</code></td>
<td>
<p>Allocation probability for the treatment group</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_rate11">rate11</code></td>
<td>
<p>Hazard before crossover for the treatment group</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_rate21">rate21</code></td>
<td>
<p>Hazard after crossover for the treatment group</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_rate31">rate31</code></td>
<td>
<p>Hazard for time to crossover for the treatment group</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_rate41">rate41</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_rate51">rate51</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_ratec1">ratec1</code></td>
<td>
<p>Hazard for time to censoring for the treatment group</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_rate10">rate10</code></td>
<td>
<p>Hazard before crossover for the control group</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_rate20">rate20</code></td>
<td>
<p>Hazard after crossover for the control group</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_rate30">rate30</code></td>
<td>
<p>Hazard for time to crossover for the control group</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_rate40">rate40</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_rate50">rate50</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_ratec0">ratec0</code></td>
<td>
<p>Hazard for time to censoring for the control group</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_tchange">tchange</code></td>
<td>
<p>A strictly increasing sequence of time points at which the event rates changes. The first element of tchange                 must be zero. It must have the same length as <code>rate11</code>, <code>rate21</code>, <code>rate31</code>, etc.</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_type1">type1</code></td>
<td>
<p>Type of crossover in the treatment group</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_type0">type0</code></td>
<td>
<p>Type of crossover in the control group</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_rp21">rp21</code></td>
<td>
<p>re-randomization prob in the treatment group</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_rp20">rp20</code></td>
<td>
<p>re-randomization prob in the control group</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_eps">eps</code></td>
<td>
<p>error tolerence</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_veps">veps</code></td>
<td>
<p>error tolenrence for calculating variance</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_epsbeta">epsbeta</code></td>
<td>
<p>error tolerance for calculating overall log HR</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_iterbeta">iterbeta</code></td>
<td>
<p>maximum number of iterations for calculating overall log HR</p>
</td></tr>
<tr><td><code id="pwepowerni_+3A_n">n</code></td>
<td>
<p>total number of subjects</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The hazard functions corresponding to <code>rate11</code>,...,<code>rate51</code>,<code>ratec1</code>, <code>rate10</code>,...,<code>rate50</code>,<code>ratec0</code> are all piecewise constant function taking the form  <code class="reqn">\lambda(t)=\sum_{j=1}^m \lambda_j I(t_{j-1}\le t&lt;t_j)</code>, where <code class="reqn">\lambda_1,\ldots,\lambda_m</code> are the corresponding elements of the rates and <code class="reqn">t_0,\ldots,t_{m-1}</code> are the corresponding elements of <cite>tchange</cite>, <code class="reqn">t_m=\infty</code>. Note that all the rates must have the same <code>tchange</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>power</code></td>
<td>
<p>powers for cox model. First column is the more accurate power, second column is the power assuming the Fisher information equal to the varaince of beta</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Version 1.0 (7/19/2016)</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pwe">pwe</a></code>,<code><a href="#topic+rpwe">rpwe</a></code>,<code><a href="#topic+qpwe">qpwe</a></code>,<code><a href="#topic+ovbeta">ovbeta</a></code>,<code><a href="#topic+innervar">innervar</a></code>,
<code><a href="#topic+pwepower">pwepower</a></code>,<code><a href="#topic+pwepowereq">pwepowereq</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>t&lt;-seq(3,6,by=1)
taur&lt;-1.2
u&lt;-c(1/taur,1/taur)
ut&lt;-c(taur/2,taur)
r11&lt;-c(0.2,0.1)
r21&lt;-r11
r31&lt;-c(0.03,0.02)
r41&lt;-r51&lt;-r21
rc1&lt;-c(0.01,0.02)
r10&lt;-c(0.2,0.2)
r20&lt;-r10
r30&lt;-c(0.02,0.01)
r40&lt;-r50&lt;-r20
rc0&lt;-c(0.02,0.01)
getpowerni&lt;-pwepowerni(t=t,nimargin=1.3,alpha=0.05,twosided=1,taur=taur,u=u,ut=ut,pi1=0.5,
                   rate11=r11,rate21=r21,rate31=r31,rate41=r41,rate51=r51,ratec1=rc1,
                   rate10=r10,rate20=r20,rate30=r30,rate40=r40,rate50=r50,ratec0=rc0,
                   tchange=c(0,1),type1=1,type0=1,n=1000)
###powers at each time point
cbind(t,getpowerni$power[,1:3])
</code></pre>

<hr>
<h2 id='pwesim'>simulating the test statistics</h2><span id='topic+pwesim'></span>

<h3>Description</h3>

<p>This will simulate the test statistics accouting for staggered entry, delayed treatment effect,  treatment crossover and loss to follow-up.</p>


<h3>Usage</h3>

<pre><code class='language-R'>pwesim(t=seq(1,2,by=0.1),taur=1.2,u=c(1/taur,1/taur),ut=c(taur/2,taur),pi1=0.5,
                     rate11=c(1,0.5),rate21=rate11,rate31=c(0.7,0.4),
                     rate41=rate21,rate51=rate21,ratec1=c(0.5,0.6),
                     rate10=rate11,rate20=rate10,rate30=rate31,
                     rate40=rate20,rate50=rate20,ratec0=c(0.6,0.5),
                     tchange=c(0,1),type1=1,type0=1,
                     rp21=0.5,rp20=0.5,
                     n=1000,rn=200,testtype=c(1,2,3,4))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pwesim_+3A_t">t</code></td>
<td>
<p>a vector of time points</p>
</td></tr>
<tr><td><code id="pwesim_+3A_taur">taur</code></td>
<td>
<p>Recruitment time</p>
</td></tr>
<tr><td><code id="pwesim_+3A_u">u</code></td>
<td>
<p>Piecewise constant recuitment rate</p>
</td></tr>
<tr><td><code id="pwesim_+3A_ut">ut</code></td>
<td>
<p>Recruitment intervals</p>
</td></tr>
<tr><td><code id="pwesim_+3A_pi1">pi1</code></td>
<td>
<p>Allocation probability for the treatment group</p>
</td></tr>
<tr><td><code id="pwesim_+3A_rate11">rate11</code></td>
<td>
<p>Hazard before crossover for the treatment group</p>
</td></tr>
<tr><td><code id="pwesim_+3A_rate21">rate21</code></td>
<td>
<p>Hazard after crossover for the treatment group</p>
</td></tr>
<tr><td><code id="pwesim_+3A_rate31">rate31</code></td>
<td>
<p>Hazard for time to crossover for the treatment group</p>
</td></tr>
<tr><td><code id="pwesim_+3A_rate41">rate41</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="pwesim_+3A_rate51">rate51</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="pwesim_+3A_ratec1">ratec1</code></td>
<td>
<p>Hazard for time to censoring for the treatment group</p>
</td></tr>
<tr><td><code id="pwesim_+3A_rate10">rate10</code></td>
<td>
<p>Hazard before crossover for the control group</p>
</td></tr>
<tr><td><code id="pwesim_+3A_rate20">rate20</code></td>
<td>
<p>Hazard after crossover for the control group</p>
</td></tr>
<tr><td><code id="pwesim_+3A_rate30">rate30</code></td>
<td>
<p>Hazard for time to crossover for the control group</p>
</td></tr>
<tr><td><code id="pwesim_+3A_rate40">rate40</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="pwesim_+3A_rate50">rate50</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="pwesim_+3A_ratec0">ratec0</code></td>
<td>
<p>Hazard for time to censoring for the control group</p>
</td></tr>
<tr><td><code id="pwesim_+3A_tchange">tchange</code></td>
<td>
<p>A strictly increasing sequence of time points at which the event rates changes. The first element of tchange                 must be zero. It must have the same length as <code>rate11</code>, <code>rate21</code>, <code>rate31</code>, etc.</p>
</td></tr>
<tr><td><code id="pwesim_+3A_type1">type1</code></td>
<td>
<p>Type of crossover in the treatment group</p>
</td></tr>
<tr><td><code id="pwesim_+3A_type0">type0</code></td>
<td>
<p>Type of crossover in the control group</p>
</td></tr>
<tr><td><code id="pwesim_+3A_rp21">rp21</code></td>
<td>
<p>re-randomization prob in the treatment group</p>
</td></tr>
<tr><td><code id="pwesim_+3A_rp20">rp20</code></td>
<td>
<p>re-randomization prob in the control group</p>
</td></tr>
<tr><td><code id="pwesim_+3A_n">n</code></td>
<td>
<p>number of subjects</p>
</td></tr>
<tr><td><code id="pwesim_+3A_rn">rn</code></td>
<td>
<p>number of simulations</p>
</td></tr>
<tr><td><code id="pwesim_+3A_testtype">testtype</code></td>
<td>
<p>types of test statistics.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The hazard functions corresponding to <code>rate11</code>,...,<code>rate51</code>,<code>ratec1</code>, <code>rate10</code>,...,<code>rate50</code>,<code>ratec0</code> are all piecewise constant function taking the form  <code class="reqn">\lambda(t)=\sum_{j=1}^m \lambda_j I(t_{j-1}\le t&lt;t_j)</code>, where <code class="reqn">\lambda_1,\ldots,\lambda_m</code> are the corresponding elements of the rates and <code class="reqn">t_0,\ldots,t_{m-1}</code> are the corresponding elements of <cite>tchange</cite>, <code class="reqn">t_m=\infty</code>. Note that all the rates must have the same <code>tchange</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>outr</code></td>
<td>
<p>test statistics at each time point and each simulation run</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Version 1.0 (7/19/2016)</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pwe">pwe</a></code>,<code><a href="#topic+rpwe">rpwe</a></code>,<code><a href="#topic+qpwe">qpwe</a></code>,<code><a href="#topic+ovbeta">ovbeta</a></code>,<code><a href="#topic+innervar">innervar</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>taur&lt;-1.2
u&lt;-c(1/taur,1/taur)
ut&lt;-c(taur/2,taur)
r11&lt;-c(1,0.5)
r21&lt;-c(0.5,0.8)
r31&lt;-c(0.7,0.4)
r41&lt;-r51&lt;-r21
rc1&lt;-c(0.5,0.6)
r10&lt;-c(1,0.7)
r20&lt;-c(0.5,1)
r30&lt;-c(0.3,0.4)
r40&lt;-r50&lt;-r20
rc0&lt;-c(0.2,0.4)
ar&lt;-pwesim(t=seq(1,2,by=0.1),taur=taur,u=u,ut=ut,pi1=0.5,
        rate11=r11,rate21=r21,rate31=r31,rate41=r41,rate51=r51,ratec1=rc1,
        rate10=r10,rate20=r20,rate30=r30,rate40=r40,rate50=r50,ratec0=rc0,
        tchange=c(0,1),type1=1,type0=1,
        n=300,rn=10)
</code></pre>

<hr>
<h2 id='pwu'>Piecewise uniform distribution: distribution</h2><span id='topic+pwu'></span>

<h3>Description</h3>

<p>This will calculate the distribution function of the piecewise uniform distribution</p>


<h3>Usage</h3>

<pre><code class='language-R'>pwu(t=seq(0,1,by=0.1),u=c(0,5,0.5),ut=c(1,2))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pwu_+3A_t">t</code></td>
<td>
<p>a vector of time points</p>
</td></tr>
<tr><td><code id="pwu_+3A_u">u</code></td>
<td>
<p>piecewise constant density</p>
</td></tr>
<tr><td><code id="pwu_+3A_ut">ut</code></td>
<td>
<p>a strictly increasing sequence of time points defining the pieces. The first element must be strictly greater than zero. <code>u</code> and <code>ut</code> must have the same length.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Let <code class="reqn">f(t)=\sum_{j=1}^m u_j I(t_{j-1}&lt;t\le t_j)</code> be the density function, where <code class="reqn">u_1,\ldots,u_m</code> are the corresponding elements of <cite>u</cite> and <code class="reqn">t_1,\ldots,t_{m}</code> are the corresponding elements of <cite>ut</cite> and <code class="reqn">t_0=0</code>.
The distribution function </p>
<p style="text-align: center;"><code class="reqn">F(t)=\sum_{j=1}^m u_j(t\wedge t_j-t\wedge t_{j-1}). </code>
</p>

<p>User must make sure that <code class="reqn">\sum_{j=1}^m u_j (t_j-t_{j-1})=1</code> before using this function.
</p>


<h3>Value</h3>

<table>
<tr><td><code>dist</code></td>
<td>
<p>distribution</p>
</td></tr>
</table>


<h3>Note</h3>

<p>This provides distribution of the piecewise uniform distribution</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pwe">pwe</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>t&lt;-seq(-1,3,by=0.5)
u&lt;-c(0.6,0.4)
ut&lt;-c(1,2)
pwud&lt;-pwu(t=t,u=u,ut=ut)
pwud
</code></pre>

<hr>
<h2 id='qpwe'>Piecewise exponential distribution: quantile function</h2><span id='topic+qpwe'></span>

<h3>Description</h3>

<p>This will provide the quantile function of the specified piecewise exponential distribution</p>


<h3>Usage</h3>

<pre><code class='language-R'>qpwe(p=seq(0,1,by=0.1),rate=c(0,5,0.8),tchange=c(0,3))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="qpwe_+3A_p">p</code></td>
<td>
<p>a vector of probabilities</p>
</td></tr>
<tr><td><code id="qpwe_+3A_rate">rate</code></td>
<td>
<p>piecewise constant event rate</p>
</td></tr>
<tr><td><code id="qpwe_+3A_tchange">tchange</code></td>
<td>
<p>time points at which event rate changes. This must be an strictly increasing sequence starting from zero. rate and tchange must have the same length.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>More details</p>


<h3>Value</h3>

<table>
<tr><td><code>q</code></td>
<td>
<p>quantiles</p>
</td></tr>
</table>


<h3>Note</h3>

<p>This provides the quantile function related to the piecewise exponetial distribution</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>See Also</h3>

<p>piecewise exponential</p>


<h3>Examples</h3>

<pre><code class='language-R'>p&lt;-seq(0,1,by=0.1)
rate&lt;-c(0.6,0.3)
tchange&lt;-c(0,1.75)
pweq&lt;-qpwe(p=p,rate=rate,tchange=tchange)
pweq
</code></pre>

<hr>
<h2 id='qpwu'>Piecewise uniform distribution: quantile function</h2><span id='topic+qpwu'></span>

<h3>Description</h3>

<p>This will provide the quantile function of the specified piecewise uniform distribution</p>


<h3>Usage</h3>

<pre><code class='language-R'>qpwu(p=seq(0,1,by=0.1),u=c(0,5,0.5),ut=c(1,2))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="qpwu_+3A_p">p</code></td>
<td>
<p>a vector of probabilities</p>
</td></tr>
<tr><td><code id="qpwu_+3A_u">u</code></td>
<td>
<p>piecewise constant density</p>
</td></tr>
<tr><td><code id="qpwu_+3A_ut">ut</code></td>
<td>
<p>time points at which event rate changes. This must be an strictly increasing sequence. <code>ut</code> and <code>u</code> must have the same length.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Let <code class="reqn">f(t)=\sum_{j=1}^m u_j I(t_{j-1}&lt;t\le t_j)</code> be the density function, where <code class="reqn">u_1,\ldots,u_m</code> are the corresponding elements of <cite>u</cite> and <code class="reqn">t_1,\ldots,t_{m}</code> are the corresponding elements of <cite>ut</cite> and <code class="reqn">t_0=0</code>.
The distribution function </p>
<p style="text-align: center;"><code class="reqn">F(t)=\sum_{j=1}^m u_j(t\wedge t_j-t\wedge t_{j-1}). </code>
</p>

<p>User must make sure that <code class="reqn">\sum_{j=1}^m u_j (t_j-t_{j-1})=1</code> before using this function.</p>


<h3>Value</h3>

<table>
<tr><td><code>q</code></td>
<td>
<p>quantiles</p>
</td></tr>
</table>


<h3>Note</h3>

<p>This provides the quantile function related to the piecewise uniform distribution</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>See Also</h3>

<p>piecewise uniform</p>


<h3>Examples</h3>

<pre><code class='language-R'>p&lt;-seq(0,1,by=0.1)
u&lt;-c(0.6,0.4)
ut&lt;-c(1,2)
pwuq&lt;-qpwu(p=p,u=u,ut=ut)
pwuq
</code></pre>

<hr>
<h2 id='rmstcov'>Calculation of the variance and covariance of estimated restricted mean survival time</h2><span id='topic+rmstcov'></span>

<h3>Description</h3>

<p>A function to calculate the variance and covariance of estimated restricted mean survival time 
using data from different cut-off points accounting for delayed treatment, discontinued treatment and non-uniform entry</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmstcov(t1cut=2.0,t1study=2.5,t2cut=3.0,t2study=3.5,taur=5,
        u=c(1/taur,1/taur),ut=c(taur/2,taur),
        rate1=c(1,0.5),rate2=rate1,rate3=c(0.7,0.4),
        rate4=rate2,rate5=rate2,ratec=c(0.5,0.6),
        tchange=c(0,1),type=1,rp2=0.5,
        eps=1.0e-2,veps=1.0e-2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rmstcov_+3A_t1cut">t1cut</code></td>
<td>
<p>time point at which rmst is calculated</p>
</td></tr>
<tr><td><code id="rmstcov_+3A_t1study">t1study</code></td>
<td>
<p>the study time point from first patient in, it must be larger than <code>t1cut</code>. This will be used for study monitoring.</p>
</td></tr>
<tr><td><code id="rmstcov_+3A_t2cut">t2cut</code></td>
<td>
<p>time point at which rmst is calculated. <code>t2cut</code> must be not smaller than <code>t1cut</code>.</p>
</td></tr>
<tr><td><code id="rmstcov_+3A_t2study">t2study</code></td>
<td>
<p>the study time point from first patient in, it must be larger than <code>t2cut</code>. This will be used for study monitoring.</p>
</td></tr>
<tr><td><code id="rmstcov_+3A_taur">taur</code></td>
<td>
<p>Recruitment time</p>
</td></tr>
<tr><td><code id="rmstcov_+3A_u">u</code></td>
<td>
<p>Piecewise constant recuitment rate</p>
</td></tr>
<tr><td><code id="rmstcov_+3A_ut">ut</code></td>
<td>
<p>Recruitment intervals</p>
</td></tr>
<tr><td><code id="rmstcov_+3A_rate1">rate1</code></td>
<td>
<p>piecewise constant event rate before crossover</p>
</td></tr>
<tr><td><code id="rmstcov_+3A_rate2">rate2</code></td>
<td>
<p>piecewise constant event rate after crossover</p>
</td></tr>
<tr><td><code id="rmstcov_+3A_rate3">rate3</code></td>
<td>
<p>piecewise constant event rate for crossover</p>
</td></tr>
<tr><td><code id="rmstcov_+3A_rate4">rate4</code></td>
<td>
<p>additional piecewise constant event rate for more complex crossover</p>
</td></tr>
<tr><td><code id="rmstcov_+3A_rate5">rate5</code></td>
<td>
<p>additional piecewise constant event rate for more complex crossover</p>
</td></tr>
<tr><td><code id="rmstcov_+3A_ratec">ratec</code></td>
<td>
<p>Hazard for time to censoring</p>
</td></tr>
<tr><td><code id="rmstcov_+3A_tchange">tchange</code></td>
<td>
<p>a strictly increasing sequence of time points starting from zero at which event rate changes. The first element of tchange must be zero. The above rates <code>rate1</code> to <code>ratec</code> and tchange must have the same length.</p>
</td></tr>
<tr><td><code id="rmstcov_+3A_type">type</code></td>
<td>
<p>type of crossover, 1=markov, 2=semi-markov, 3=hybrid</p>
</td></tr>
<tr><td><code id="rmstcov_+3A_rp2">rp2</code></td>
<td>
<p>re-randomization probability to receive the rescue treatment when semi-markov crossover occurs.
When it happens, the overall hazard will be pi2*r2(t-s)+(1-pi2)*r4(t), where r2 is the hazard 
for the semi-markov rescue treatment and r4 is hazard for the markov rescue treatment.</p>
</td></tr> 
<tr><td><code id="rmstcov_+3A_eps">eps</code></td>
<td>
<p>A small number representing the error tolerance when calculating the utility function
</p>
<p style="text-align: center;"><code class="reqn">\Phi_l(x)=\frac{\int_0^x s^l e^{-s}ds}{x^{l+1}}</code>
</p>
<p> with <code class="reqn">l=0,1,2</code>.</p>
</td></tr>
<tr><td><code id="rmstcov_+3A_veps">veps</code></td>
<td>
<p>A small number representing the error tolerance when calculating the variance.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>More details</p>


<h3>Value</h3>

<table>
<tr><td><code>t1cut</code></td>
<td>
<p>time point at which rmst is calculated</p>
</td></tr>
<tr><td><code>t1study</code></td>
<td>
<p>the study time point from first patient in, it must be larger than <code>t1cut</code>. This will be used for study monitoring.</p>
</td></tr>
<tr><td><code>t2cut</code></td>
<td>
<p>time point at which rmst is calculated. <code>t2cut</code> must be not smaller than <code>t1cut</code>.</p>
</td></tr>
<tr><td><code>t2study</code></td>
<td>
<p>the study time point from first patient in, it must be larger than <code>t2cut</code>. This will be used for study monitoring.</p>
</td></tr>
<tr><td><code>rmst</code></td>
<td>
<p>rmst at cut-point <code>t1cut</code> with study time <code>t1study</code></p>
</td></tr>
<tr><td><code>rmst1</code></td>
<td>
<p>rmst at cut-point <code>t2cut</code> with study time <code>t2study</code></p>
</td></tr>
<tr><td><code>rmstx</code></td>
<td>
<p>rmst at cut-point <code>t1cut</code> with study time <code>t2study</code>, which should be the same as <code>rmst</code>.</p>
</td></tr>
<tr><td><code>v</code></td>
<td>
<p>the variance of <code>rmst</code></p>
</td></tr>
<tr><td><code>v1</code></td>
<td>
<p>the variance of <code>rmst1</code></p>
</td></tr>
<tr><td><code>cov</code></td>
<td>
<p>the covariance of <code>rmst</code> and <code>rmst1</code></p>
</td></tr>
<tr><td><code>cov1</code></td>
<td>
<p>another covariance of <code>rmst</code> and <code>rmst1</code>, should be the same as <code>cov</code></p>
</td></tr>
</table>


<h3>Note</h3>

<p>This calculates the &quot;true&quot; variance and covariance of restricted mean survival times</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo et al. (2018) Design and monitoring of survival trials in complex scenarios, Statistics in Medicine &lt;doi: https://doi.org/10.1002/sim.7975&gt;.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>r1&lt;-c(0.6,0.3)
r2&lt;-c(0.6,0.6)
r3&lt;-c(0.1,0.2)
r4&lt;-c(0.5,0.4)
r5&lt;-c(0.4,0.5)
rc&lt;-c(0.1,0.1)
rmcov&lt;-rmstcov(t1cut=2.0,t1study=2.5,t2cut=3.0,t2study=3.5,taur=5,
        rate1=r1,rate2=r2,rate3=r3,rate4=r4,rate5=r5,ratec=rc,
        tchange=c(0,1),type=1)
rmcov
</code></pre>

<hr>
<h2 id='rmsth'>Estimate the restricted mean survival time (RMST) and its variance from data</h2><span id='topic+rmsth'></span>

<h3>Description</h3>

<p>A function to estimate the restricted mean survival time (RMST) and its variance from data</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmsth(y=c(1,2,3),d=c(1,1,0),tcut=2.0,eps=1.0e-08)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rmsth_+3A_y">y</code></td>
<td>
<p>observed times</p>
</td></tr>
<tr><td><code id="rmsth_+3A_d">d</code></td>
<td>
<p>non-censoring indicators</p>
</td></tr>
<tr><td><code id="rmsth_+3A_tcut">tcut</code></td>
<td>
<p>time point at which rmst is calculated</p>
</td></tr>
<tr><td><code id="rmsth_+3A_eps">eps</code></td>
<td>
<p>A small number representing the error tolerance when comparing the event times</p>
</td></tr>
</table>


<h3>Details</h3>

<p>More details</p>


<h3>Value</h3>

<table>
<tr><td><code>tcut</code></td>
<td>
<p>time point at which rmst is calculated</p>
</td></tr>
<tr><td><code>rmst</code></td>
<td>
<p>estimated RMST</p>
</td></tr>
<tr><td><code>var</code></td>
<td>
<p>estimated variance of <code>rmst</code></p>
</td></tr>
<tr><td><code>vadd</code></td>
<td>
<p>estimated variance-covariance term of <code>rmst</code></p>
</td></tr>
</table>


<h3>Note</h3>

<p>This estimates the restricted mean survival time and its asymptotic variance</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>lamt&lt;-0.8
lamc&lt;-0.4
n&lt;-3000
tcut&lt;-2.0
truermst&lt;-(1-exp(-lamt*tcut))/lamt
tt&lt;-rexp(n)/lamt
cc&lt;-rexp(n)/lamc
yy&lt;-pmin(tt,cc)
dd&lt;-rep(1,n)
dd[tt&gt;cc]&lt;-0
aest&lt;-rmsth(y=yy,d=dd,tcut=tcut)
aest
</code></pre>

<hr>
<h2 id='rmstpower'>Calculate powers at different cut-points based on difference of restricted mean survival times (RMST)</h2><span id='topic+rmstpower'></span>

<h3>Description</h3>

<p>A function to calculate powers at different cut-points based on difference of restricted mean survival times (RMST)
account for delayed treatment, discontinued treatment and non-uniform entry</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmstpower(tcut=2,tstudy=seq(tcut,tcut+2,by=0.5),alpha=0.05,twosided=1,
          taur=1.2,u=c(1/taur,1/taur),ut=c(taur/2,taur),pi1=0.5,
          rate11=c(1,0.5),rate21=rate11,rate31=c(0.7,0.4),
          rate41=rate21,rate51=rate21,ratec1=c(0.5,0.6),
          rate10=rate11,rate20=rate10,rate30=rate31,
          rate40=rate20,rate50=rate20,ratec0=c(0.6,0.5),
          tchange=c(0,1),type1=1,type0=1,rp21=0.5,rp20=0.5,
          eps=1.0e-2,veps=1.0e-2,n=1000)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rmstpower_+3A_tcut">tcut</code></td>
<td>
<p>timepoint at which rmst is calculated</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_tstudy">tstudy</code></td>
<td>
<p>a vector of study time points, which must be not smaller than <code>tcut</code></p>
</td></tr>
<tr><td><code id="rmstpower_+3A_alpha">alpha</code></td>
<td>
<p>type-1 error rate</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_twosided">twosided</code></td>
<td>
<p>twosided test=1 or not</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_taur">taur</code></td>
<td>
<p>Recruitment time</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_u">u</code></td>
<td>
<p>Piecewise constant recuitment rate</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_ut">ut</code></td>
<td>
<p>Recruitment intervals</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_pi1">pi1</code></td>
<td>
<p>Allocation probability for the treatment group</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_rate11">rate11</code></td>
<td>
<p>Hazard before crossover for the treatment group</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_rate21">rate21</code></td>
<td>
<p>Hazard after crossover for the treatment group</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_rate31">rate31</code></td>
<td>
<p>Hazard for time to crossover for the treatment group</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_rate41">rate41</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_rate51">rate51</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_ratec1">ratec1</code></td>
<td>
<p>Hazard for time to censoring for the treatment group</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_rate10">rate10</code></td>
<td>
<p>Hazard before crossover for the control group</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_rate20">rate20</code></td>
<td>
<p>Hazard after crossover for the control group</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_rate30">rate30</code></td>
<td>
<p>Hazard for time to crossover for the control group</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_rate40">rate40</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_rate50">rate50</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_ratec0">ratec0</code></td>
<td>
<p>Hazard for time to censoring for the control group</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_tchange">tchange</code></td>
<td>
<p>A strictly increasing sequence of time points at which the event rates changes. The first element of tchange                 must be zero. It must have the same length as <code>rate11</code>, <code>rate21</code>, <code>rate31</code>, etc.</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_type1">type1</code></td>
<td>
<p>Type of crossover in the treatment group</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_type0">type0</code></td>
<td>
<p>Type of crossover in the control group</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_rp21">rp21</code></td>
<td>
<p>re-randomization prob for the treatment group</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_rp20">rp20</code></td>
<td>
<p>re-randomization prob for the control group</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_eps">eps</code></td>
<td>
<p>error tolerence</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_veps">veps</code></td>
<td>
<p>error tolenrence for calculating variance</p>
</td></tr>
<tr><td><code id="rmstpower_+3A_n">n</code></td>
<td>
<p>total number of subjects, both groups combined</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The hazard functions corresponding to <code>rate11</code>,...,<code>rate51</code>,<code>ratec1</code>, <code>rate10</code>,...,<code>rate50</code>,<code>ratec0</code> are all piecewise constant function taking the form  <code class="reqn">\lambda(t)=\sum_{j=1}^m \lambda_j I(t_{j-1}\le t&lt;t_j)</code>, where <code class="reqn">\lambda_1,\ldots,\lambda_m</code> are the corresponding elements of the rates and <code class="reqn">t_0,\ldots,t_{m-1}</code> are the corresponding elements of <cite>tchange</cite>, <code class="reqn">t_m=\infty</code>. Note that all the rates must have the same <code>tchange</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>power</code></td>
<td>
<p>power</p>
</td></tr>
<tr><td><code>rmst1</code></td>
<td>
<p>rmst in the treatment group</p>
</td></tr>
<tr><td><code>se1</code></td>
<td>
<p>standard error of the rmst in the treatment group</p>
</td></tr>
<tr><td><code>rmst0</code></td>
<td>
<p>rmst in the control group</p>
</td></tr>
<tr><td><code>se0</code></td>
<td>
<p>standard error of the rmst in the control group</p>
</td></tr>
<tr><td><code>drmst</code></td>
<td>
<p><code>rmst1</code>-<code>rmst0</code></p>
</td></tr>
<tr><td><code>sed</code></td>
<td>
<p>standard error of the mean difference</p>
</td></tr>
</table>


<h3>Note</h3>

<p>This calculates the restricted mean survival times between the treatment and control groups and their standard errors</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>tcut&lt;-3.0
tstudy&lt;-seq(3,6,by=1)
taur&lt;-1.2
u&lt;-c(1/taur,1/taur)
ut&lt;-c(taur/2,taur)
r11&lt;-c(0.2,0.1)
r21&lt;-r11
r31&lt;-c(0.03,0.02)
r41&lt;-r51&lt;-r21
rc1&lt;-c(0.01,0.02)
r10&lt;-c(0.2,0.2)
r20&lt;-r10
r30&lt;-c(0.02,0.01)
r40&lt;-r50&lt;-r20
rc0&lt;-c(0.02,0.01)
getrmst&lt;-rmstpower(tcut=tcut,tstudy=tstudy,alpha=0.05,twosided=1,
          taur=taur,u=u,ut=ut,pi1=0.5,
          rate11=r11,rate21=r21,rate31=r31,rate41=r41,rate51=r51,ratec1=rc1,
          rate10=r10,rate20=r20,rate30=r30,rate40=r40,rate50=r50,ratec0=rc0,
          tchange=c(0,1),type1=1,type0=1,rp21=0.5,rp20=0.5,n=1000)
###powers at each time point
cbind(tstudy,getrmst$power)
</code></pre>

<hr>
<h2 id='rmstpowerfindt'>Calculating the timepoint where a certain power of mean difference of RMSTs is obtained</h2><span id='topic+rmstpowerfindt'></span>

<h3>Description</h3>

<p>This will calculate the timepoint where a certain power of the mean difference of RMSTs  is obtained accouting for staggered entry, delayed treatment effect,  treatment crossover and loss to follow-up.</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmstpowerfindt(power=0.9,alpha=0.05,twosided=1,tcut=2,tupp=5,tlow=3.0,taur=1.2,
           u=c(1/taur,1/taur),ut=c(taur/2,taur),pi1=0.5,
           rate11=c(1,0.5),rate21=rate11,rate31=c(0.7,0.4),
           rate41=rate21,rate51=rate21,ratec1=c(0.5,0.6),
           rate10=rate11,rate20=rate10,rate30=rate31,
           rate40=rate20,rate50=rate20,ratec0=c(0.6,0.5),
           tchange=c(0,1),type1=1,type0=1,
           rp21=0.5,rp20=0.5,eps=1.0e-2,veps=1.0e-2,
           n=1000,maxiter=20,itereps=0.001)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rmstpowerfindt_+3A_power">power</code></td>
<td>
<p>the desired power</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_alpha">alpha</code></td>
<td>
<p>type-1 error</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_twosided">twosided</code></td>
<td>
<p>twoside test or not</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_tcut">tcut</code></td>
<td>
<p>time point at which rmst is calculated</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_tupp">tupp</code></td>
<td>
<p>an upper study time point where the power should be larger than <code>power</code></p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_tlow">tlow</code></td>
<td>
<p>a lower study time point where the power should be smaller than <code>power</code>, <code>tlow</code> must be not smaller than <code>tcut</code></p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_taur">taur</code></td>
<td>
<p>recruitment time</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_u">u</code></td>
<td>
<p>Piecewise constant recuitment rate</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_ut">ut</code></td>
<td>
<p>Recruitment intervals</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_pi1">pi1</code></td>
<td>
<p>Allocation probability for the treatment group</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_rate11">rate11</code></td>
<td>
<p>Hazard before crossover for the treatment group</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_rate21">rate21</code></td>
<td>
<p>Hazard after crossover for the treatment group</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_rate31">rate31</code></td>
<td>
<p>Hazard for time to crossover for the treatment group</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_rate41">rate41</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_rate51">rate51</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_ratec1">ratec1</code></td>
<td>
<p>Hazard for time to censoring for the treatment group</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_rate10">rate10</code></td>
<td>
<p>Hazard before crossover for the control group</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_rate20">rate20</code></td>
<td>
<p>Hazard after crossover for the control group</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_rate30">rate30</code></td>
<td>
<p>Hazard for time to crossover for the control group</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_rate40">rate40</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_rate50">rate50</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_ratec0">ratec0</code></td>
<td>
<p>Hazard for time to censoring for the control group</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_tchange">tchange</code></td>
<td>
<p>A strictly increasing sequence of time points at which the event rates changes. The first element of tchange                 must be zero. It must have the same length as <code>rate11</code>, <code>rate21</code>, <code>rate31</code>, etc.</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_type1">type1</code></td>
<td>
<p>Type of crossover in the treatment group</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_type0">type0</code></td>
<td>
<p>Type of crossover in the control group</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_rp21">rp21</code></td>
<td>
<p>re-randomization prob in the treatment group</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_rp20">rp20</code></td>
<td>
<p>re-randomization prob in the control group</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_eps">eps</code></td>
<td>
<p>error tolerence</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_veps">veps</code></td>
<td>
<p>error tolenrence for calculating variance</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_n">n</code></td>
<td>
<p>total number of subjects</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_maxiter">maxiter</code></td>
<td>
<p>maximum number of bi-section iterations</p>
</td></tr>
<tr><td><code id="rmstpowerfindt_+3A_itereps">itereps</code></td>
<td>
<p>error tolerance of <code>power</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The hazard functions corresponding to <code>rate11</code>,...,<code>rate51</code>,<code>ratec1</code>, <code>rate10</code>,...,<code>rate50</code>,<code>ratec0</code> are all piecewise constant function taking the form  <code class="reqn">\lambda(t)=\sum_{j=1}^m \lambda_j I(t_{j-1}\le t&lt;t_j)</code>, where <code class="reqn">\lambda_1,\ldots,\lambda_m</code> are the corresponding elements of the rates and <code class="reqn">t_0,\ldots,t_{m-1}</code> are the corresponding elements of <cite>tchange</cite>, <code class="reqn">t_m=\infty</code>. Note that all the rates must have the same <code>tchange</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>time</code></td>
<td>
<p>time calculated when the iterations stop</p>
</td></tr>
<tr><td><code>power</code></td>
<td>
<p>the power at <code>time</code></p>
</td></tr>
<tr><td><code>err</code></td>
<td>
<p>distance from the desired power</p>
</td></tr>
<tr><td><code>k</code></td>
<td>
<p>number of bi-section iterations performed</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Version 1.0 (8/8/2017)</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pwe">pwe</a></code>,<code><a href="#topic+rpwe">rpwe</a></code>,<code><a href="#topic+qpwe">qpwe</a></code>,<code><a href="#topic+ovbeta">ovbeta</a></code>,<code><a href="#topic+innervar">innervar</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>tcut&lt;-3.0
tstudy&lt;-seq(3,6,by=0.2)
taur&lt;-2
u&lt;-c(0.3,0.7)
ut&lt;-c(taur/2,taur)
r11&lt;-c(0.2,0.1)
r21&lt;-r11
r31&lt;-c(0.03,0.02)
r41&lt;-r51&lt;-r21
rc1&lt;-c(0.05,0.04)
r10&lt;-c(0.22,0.22)
r20&lt;-r10
r30&lt;-c(0.02,0.01)
r40&lt;-r50&lt;-r20
rc0&lt;-c(0.04,0.05)
ntotal&lt;-1200
getrmst&lt;-rmstpower(tcut=tcut,tstudy=tstudy,alpha=0.05,twosided=1,
        taur=taur,u=u,ut=ut,pi1=0.5,
        rate11=r11,rate21=r21,rate31=r31,rate41=r41,rate51=r51,ratec1=rc1,
        rate10=r10,rate20=r20,rate30=r30,rate40=r40,rate50=r50,ratec0=rc0,
        tchange=c(0,1),type1=1,type0=1,rp21=0.5,rp20=0.5,n=ntotal)
###powers at each time point
cbind(tstudy,getrmst$power)

###90 percent power should be in (3,4)
gettime&lt;-rmstpowerfindt(power=0.9,alpha=0.05,twosided=1,tcut=tcut,tupp=4,tlow=3.0,taur=taur,
          u=u,ut=ut,pi1=0.5,rate11=r11,rate21=r21,rate31=r31,rate41=r41,rate51=r51,ratec1=rc1,
          rate10=r10,rate20=r20,rate30=r30,rate40=r40,rate50=r50,ratec0=rc0,
          tchange=c(0,1),type1=1,type0=1,rp21=0.5,rp20=0.5,eps=1.0e-2,veps=1.0e-2,
          n=ntotal,maxiter=20,itereps=0.0001)
gettime
</code></pre>

<hr>
<h2 id='rmstsim'>simulating the restricted mean survival times</h2><span id='topic+rmstsim'></span>

<h3>Description</h3>

<p>This will simulate the test statistics accouting for staggered entry, delayed treatment effect,  treatment crossover and loss to follow-up.</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmstsim(tcut=c(1,2),tstudy=tcut+0.2,taur=1.2,
        u=c(1/taur,1/taur),ut=c(taur/2,taur),pi1=0.5,
        rate11=c(1,0.5),rate21=rate11,rate31=c(0.7,0.4),
        rate41=rate21,rate51=rate21,ratec1=c(0.5,0.6),
        rate10=rate11,rate20=rate10,rate30=rate31,
        rate40=rate20,rate50=rate20,ratec0=c(0.6,0.5),
        tchange=c(0,1),type1=1,type0=1,rp21=0.5,rp20=0.5,
        n=1000,rn=200,eps=1.0E-08)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rmstsim_+3A_tcut">tcut</code></td>
<td>
<p>a vector of time points at which rmst are calculated</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_tstudy">tstudy</code></td>
<td>
<p>a vector of study time points, should be the same length as <code>tcut</code> and should be not less than <code>tcut</code> element-wise</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_taur">taur</code></td>
<td>
<p>Recruitment time</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_u">u</code></td>
<td>
<p>Piecewise constant recuitment rate</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_ut">ut</code></td>
<td>
<p>Recruitment intervals</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_pi1">pi1</code></td>
<td>
<p>Allocation probability for the treatment group</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_rate11">rate11</code></td>
<td>
<p>Hazard before crossover for the treatment group</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_rate21">rate21</code></td>
<td>
<p>Hazard after crossover for the treatment group</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_rate31">rate31</code></td>
<td>
<p>Hazard for time to crossover for the treatment group</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_rate41">rate41</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_rate51">rate51</code></td>
<td>
<p>Hazard after crossover for the treatment group for complex case</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_ratec1">ratec1</code></td>
<td>
<p>Hazard for time to censoring for the treatment group</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_rate10">rate10</code></td>
<td>
<p>Hazard before crossover for the control group</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_rate20">rate20</code></td>
<td>
<p>Hazard after crossover for the control group</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_rate30">rate30</code></td>
<td>
<p>Hazard for time to crossover for the control group</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_rate40">rate40</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_rate50">rate50</code></td>
<td>
<p>Hazard after crossover for the control group for complex case</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_ratec0">ratec0</code></td>
<td>
<p>Hazard for time to censoring for the control group</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_tchange">tchange</code></td>
<td>
<p>A strictly increasing sequence of time points at which the event rates changes. The first element of tchange                 must be zero. It must have the same length as <code>rate11</code>, <code>rate21</code>, <code>rate31</code>, etc.</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_type1">type1</code></td>
<td>
<p>Type of crossover in the treatment group</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_type0">type0</code></td>
<td>
<p>Type of crossover in the control group</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_rp21">rp21</code></td>
<td>
<p>re-randomization prob in the treatment group</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_rp20">rp20</code></td>
<td>
<p>re-randomization prob in the control group</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_n">n</code></td>
<td>
<p>number of subjects</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_rn">rn</code></td>
<td>
<p>number of simulations</p>
</td></tr>
<tr><td><code id="rmstsim_+3A_eps">eps</code></td>
<td>
<p>tolerence for comparing event times</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The hazard functions corresponding to <code>rate11</code>,...,<code>rate51</code>,<code>ratec1</code>, <code>rate10</code>,...,<code>rate50</code>,<code>ratec0</code> are all piecewise constant function taking the form  <code class="reqn">\lambda(t)=\sum_{j=1}^m \lambda_j I(t_{j-1}\le t&lt;t_j)</code>, where <code class="reqn">\lambda_1,\ldots,\lambda_m</code> are the corresponding elements of the rates and <code class="reqn">t_0,\ldots,t_{m-1}</code> are the corresponding elements of <cite>tchange</cite>, <code class="reqn">t_m=\infty</code>. Note that all the rates must have the same <code>tchange</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>outr</code></td>
<td>
<p>test statistics at each pair of <code>tcut</code> and <code>tstudy</code> in column and each simulation run in row</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Version 1.0 (7/19/2016)</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo et al. (2018) Design and monitoring of survival trials in complex scenarios, Statistics in Medicine &lt;doi: https://doi.org/10.1002/sim.7975&gt;.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+pwe">pwe</a></code>,<code><a href="#topic+rpwe">rpwe</a></code>,<code><a href="#topic+qpwe">qpwe</a></code>,<code><a href="#topic+ovbeta">ovbeta</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>tcuta&lt;-c(2,3)
taur&lt;-1.2
u&lt;-c(1/taur,1/taur)
ut&lt;-c(taur/2,taur)
r11&lt;-c(1,0.5)
r21&lt;-c(0.5,0.8)
r31&lt;-c(0.7,0.4)
r41&lt;-r51&lt;-r21
rc1&lt;-c(0.5,0.6)
r10&lt;-c(1.5,0.7)
r20&lt;-c(0.5,1)
r30&lt;-c(0.3,0.4)
r40&lt;-r50&lt;-r20
rc0&lt;-c(0.2,0.4)
ar&lt;-rmstsim(tcut=tcuta,tstudy=tcuta+0.1,taur=taur,u=u,ut=ut,pi1=0.5,
            rate11=r11,rate21=r21,rate31=r31,rate41=r41,rate51=r51,ratec1=rc1,
            rate10=r10,rate20=r20,rate30=r30,rate40=r40,rate50=r50,ratec0=rc0,
            tchange=c(0,1),type1=1,type0=1,
            n=300,rn=200)
##Empirical power
apply(ar$outr&gt;1.96,2,mean)        
</code></pre>

<hr>
<h2 id='rmstutil'>A utility function to calculate the true restricted mean survival time (RMST) and its variance
account for delayed treatment, discontinued treatment and non-uniform entry</h2><span id='topic+rmstutil'></span>

<h3>Description</h3>

<p>A utility function to calculate the true restricted mean survival time (RMST) and its variance
account for delayed treatment, discontinued treatment and non-uniform entry</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmstutil(tcut=2.0,tstudy=5.0,taur=5,u=c(1/taur,1/taur),ut=c(taur/2,taur),
        rate1=c(1,0.5),rate2=rate1,rate3=c(0.7,0.4),
        rate4=rate2,rate5=rate2,ratec=c(0.5,0.6),
        tchange=c(0,1),type=1,rp2=0.5,
        eps=1.0e-2,veps=1.0e-2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rmstutil_+3A_tcut">tcut</code></td>
<td>
<p>time point at which rmst is calculated</p>
</td></tr>
<tr><td><code id="rmstutil_+3A_tstudy">tstudy</code></td>
<td>
<p>the study time point from first patient in, it must be not smaller than <code>tcut</code>.</p>
</td></tr>
<tr><td><code id="rmstutil_+3A_taur">taur</code></td>
<td>
<p>Recruitment time</p>
</td></tr>
<tr><td><code id="rmstutil_+3A_u">u</code></td>
<td>
<p>Piecewise constant recuitment rate</p>
</td></tr>
<tr><td><code id="rmstutil_+3A_ut">ut</code></td>
<td>
<p>Recruitment intervals</p>
</td></tr>
<tr><td><code id="rmstutil_+3A_rate1">rate1</code></td>
<td>
<p>piecewise constant event rate before crossover</p>
</td></tr>
<tr><td><code id="rmstutil_+3A_rate2">rate2</code></td>
<td>
<p>piecewise constant event rate after crossover</p>
</td></tr>
<tr><td><code id="rmstutil_+3A_rate3">rate3</code></td>
<td>
<p>piecewise constant event rate for crossover</p>
</td></tr>
<tr><td><code id="rmstutil_+3A_rate4">rate4</code></td>
<td>
<p>additional piecewise constant event rate for more complex crossover</p>
</td></tr>
<tr><td><code id="rmstutil_+3A_rate5">rate5</code></td>
<td>
<p>additional piecewise constant event rate for more complex crossover</p>
</td></tr>
<tr><td><code id="rmstutil_+3A_ratec">ratec</code></td>
<td>
<p>Hazard for time to censoring</p>
</td></tr>
<tr><td><code id="rmstutil_+3A_tchange">tchange</code></td>
<td>
<p>a strictly increasing sequence of time points starting from zero at which event rate changes. The first element of tchange must be zero. The above rates <code>rate1</code> to <code>ratec</code> and tchange must have the same length.</p>
</td></tr>
<tr><td><code id="rmstutil_+3A_type">type</code></td>
<td>
<p>type of crossover, 1=markov, 2=semi-markov, 3=hybrid</p>
</td></tr>
<tr><td><code id="rmstutil_+3A_rp2">rp2</code></td>
<td>
<p>re-randomization probability to receive the rescue treatment when semi-markov crossover occurs.
When it happens, the overall hazard will be rp2*r2(t-s)+(1-rp2)*r4(t), where r2 is the hazard 
for the semi-markov rescue treatment and r4 is hazard for the markov rescue treatment.</p>
</td></tr> 
<tr><td><code id="rmstutil_+3A_eps">eps</code></td>
<td>
<p>A small number representing the error tolerance when calculating the utility function
</p>
<p style="text-align: center;"><code class="reqn">\Phi_l(x)=\frac{\int_0^x s^l e^{-s}ds}{x^{l+1}}</code>
</p>
<p> with <code class="reqn">l=0,1,2</code>.</p>
</td></tr>
<tr><td><code id="rmstutil_+3A_veps">veps</code></td>
<td>
<p>A small number representing the error tolerance when calculating the variance.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>More details</p>


<h3>Value</h3>

<table>
<tr><td><code>tcut</code></td>
<td>
<p>time point at which rmst is calculated</p>
</td></tr>
<tr><td><code>tstudy</code></td>
<td>
<p>the study time point from first patient in, it must be not smaller than <code>tcut</code></p>
</td></tr>
<tr><td><code>rmst</code></td>
<td>
<p>rmst at cut-point <code>tcut</code></p>
</td></tr>
<tr><td><code>var</code></td>
<td>
<p>the variance of <code>rmst</code></p>
</td></tr>
<tr><td><code>vadd</code></td>
<td>
<p>the additional variance term of <code>rmst</code></p>
</td></tr>
</table>


<h3>Note</h3>

<p>This calculates the &quot;true&quot; variance of restricted mean survival times</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo et al. (2018) Design and monitoring of survival trials in complex scenarios, Statistics in Medicine &lt;doi: https://doi.org/10.1002/sim.7975&gt;.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>r1&lt;-c(0.6,0.3)
r2&lt;-c(0.6,0.6)
r3&lt;-c(0.1,0.2)
r4&lt;-c(0.5,0.4)
r5&lt;-c(0.4,0.5)
rc&lt;-c(0.1,0.1)
rmt&lt;-rmstutil(tcut=2.0,tstudy=5.0,taur=5,
        rate1=r1,rate2=r2,rate3=r3,
        rate4=r4,rate5=r5,ratec=rc,
        tchange=c(0,1),type=1,rp2=0.5,
        eps=1.0e-2,veps=1.0e-2)
rmt
</code></pre>

<hr>
<h2 id='rpwe'>Piecewise exponential distribution: random number generation</h2><span id='topic+rpwe'></span>

<h3>Description</h3>

<p>This will generate random numbers according to the specified piecewise exponential distribution</p>


<h3>Usage</h3>

<pre><code class='language-R'>rpwe(nr=10,rate=c(0,5,0.8),tchange=c(0,3))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rpwe_+3A_nr">nr</code></td>
<td>
<p>number of random numbers to be generated</p>
</td></tr>
<tr><td><code id="rpwe_+3A_rate">rate</code></td>
<td>
<p>piecewise constant event rate</p>
</td></tr>
<tr><td><code id="rpwe_+3A_tchange">tchange</code></td>
<td>
<p>a strictly increasing sequence of time points starting from zero at which event rate changes. The first element of tchange must be zero. rate and tchange must have the same length.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>More details</p>


<h3>Value</h3>

<table>
<tr><td><code>r</code></td>
<td>
<p>random numbers</p>
</td></tr>
</table>


<h3>Note</h3>

<p>This provides a random number generator of the piecewise exponetial distribution</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>See Also</h3>

<p>piecewise exponential</p>


<h3>Examples</h3>

<pre><code class='language-R'>nr&lt;-10
rate&lt;-c(0.6,0.3)
tchange&lt;-c(0,1.75)
pwer&lt;-rpwe(nr=nr,rate=rate,tchange=tchange)
pwer
</code></pre>

<hr>
<h2 id='rpwecx'>Piecewise exponential distribution with crossover effect: random number generation</h2><span id='topic+rpwecx'></span>

<h3>Description</h3>

<p>This will generate random numbers according to the piecewise exponential distribution with crossover</p>


<h3>Usage</h3>

<pre><code class='language-R'>rpwecx(nr=1,rate1=c(1,0.5),rate2=rate1,rate3=c(0.7,0.4),
rate4=rate2,rate5=rate2,tchange=c(0,1),type=1,rp2=0.5)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rpwecx_+3A_nr">nr</code></td>
<td>
<p>number of random numbers to be generated</p>
</td></tr>
<tr><td><code id="rpwecx_+3A_rate1">rate1</code></td>
<td>
<p>piecewise constant event rate before crossover</p>
</td></tr>
<tr><td><code id="rpwecx_+3A_rate2">rate2</code></td>
<td>
<p>piecewise constant event rate after crossover</p>
</td></tr>
<tr><td><code id="rpwecx_+3A_rate3">rate3</code></td>
<td>
<p>piecewise constant event rate for crossover</p>
</td></tr>
<tr><td><code id="rpwecx_+3A_rate4">rate4</code></td>
<td>
<p>additional piecewise constant event rate for more complex crossover</p>
</td></tr>
<tr><td><code id="rpwecx_+3A_rate5">rate5</code></td>
<td>
<p>additional piecewise constant event rate for more complex crossover</p>
</td></tr>
<tr><td><code id="rpwecx_+3A_tchange">tchange</code></td>
<td>
<p>a strictly increasing sequence of time points starting from zero at which event rate changes. The first element of tchange must be zero. The above rates <code>rate1</code> to <code>rate6</code> and tchange must have the same length.</p>
</td></tr>
<tr><td><code id="rpwecx_+3A_type">type</code></td>
<td>
<p>type of crossover, 1=markov, 2=semi-markov, 3=hybrid</p>
</td></tr>
<tr><td><code id="rpwecx_+3A_rp2">rp2</code></td>
<td>
<p>re-randomization probability to receive the rescue treatment when semi-markov crossover occurs.
When it happens, the overall hazard will be pi2*r2(t-s)+(1-pi2)*r4(t), where r2 is the hazard 
for the semi-markov rescue treatment and r4 is hazard for the markov rescue treatment.</p>
</td></tr> 
</table>


<h3>Details</h3>

<p>More details</p>


<h3>Value</h3>

<table>
<tr><td><code>r</code></td>
<td>
<p>random numbers for the event time</p>
</td></tr>
<tr><td><code>rx</code></td>
<td>
<p>random numbers for the crossover time</p>
</td></tr>
<tr><td><code>cxind</code></td>
<td>
<p>indicators for the crossover, the first column indicates whether crossover occurs, i.e. <code class="reqn">\code{rx}&lt;\code{r}</code>. When <code>type</code>=3,4,5, the second column of <code>cxind</code> indicates whether it crosses to the arm with <code>rate2</code></p>
</td></tr>
</table>


<h3>Note</h3>

<p>This provides a random number generator of the piecewise exponetial distribution with crossover</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo et al. (2018) Design and monitoring of survival trials in complex scenarios, Statistics in Medicine &lt;doi: https://doi.org/10.1002/sim.7975&gt;.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rpwe">rpwe</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>r1&lt;-c(0.6,0.3)
r2&lt;-c(0.6,0.6)
r3&lt;-c(0.1,0.2)
r4&lt;-c(0.5,0.4)
r5&lt;-c(0.4,0.5)
pwecxr&lt;-rpwecx(nr=10,rate1=r1,rate2=r2,rate3=r3,rate4=r4,rate5=r5,tchange=c(0,1),type=1)
pwecxr$r
</code></pre>

<hr>
<h2 id='rpwu'>Piecewise uniform distribution: random number generation</h2><span id='topic+rpwu'></span>

<h3>Description</h3>

<p>This will generate random numbers according to the specified piecewise uniform distribution</p>


<h3>Usage</h3>

<pre><code class='language-R'>rpwu(nr=10,u=c(0,6,0.4),ut=c(1,2))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rpwu_+3A_nr">nr</code></td>
<td>
<p>number of random numbers to be generated</p>
</td></tr>
<tr><td><code id="rpwu_+3A_u">u</code></td>
<td>
<p>piecewise constant density</p>
</td></tr>
<tr><td><code id="rpwu_+3A_ut">ut</code></td>
<td>
<p>a strictly increasing sequence of time points defining the pieces. The first element must be strictly greater than zero. <code>u</code> and <code>ut</code> must have the same length.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Let <code class="reqn">f(t)=\sum_{j=1}^m u_j I(t_{j-1}&lt;t\le t_j)</code> be the density function, where <code class="reqn">u_1,\ldots,u_m</code> are the corresponding elements of <cite>u</cite> and <code class="reqn">t_1,\ldots,t_{m}</code> are the corresponding elements of <cite>ut</cite> and <code class="reqn">t_0=0</code>.
The distribution function </p>
<p style="text-align: center;"><code class="reqn">F(t)=\sum_{j=1}^m u_j(t\wedge t_j-t\wedge t_{j-1}). </code>
</p>

<p>User must make sure that <code class="reqn">\sum_{j=1}^m u_j (t_j-t_{j-1})=1</code> before using this function.
</p>


<h3>Value</h3>

<table>
<tr><td><code>r</code></td>
<td>
<p>random numbers</p>
</td></tr>
</table>


<h3>Note</h3>

<p>This provides a random number generator of the piecewise uniform distribution</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rpwe">rpwe</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>nr&lt;-10
u&lt;-c(0.6,0.4)
ut&lt;-c(1,2)
pwur&lt;-rpwu(nr=nr,u=u,ut=ut)
pwur
</code></pre>

<hr>
<h2 id='spf'>A utility function</h2><span id='topic+spf'></span>

<h3>Description</h3>

<p>A utility function to calculate a ratio.</p>


<h3>Usage</h3>

<pre><code class='language-R'>spf(x=seq(-1,1,by=0.2),eps=1.0e-3)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="spf_+3A_x">x</code></td>
<td>
<p>A vector</p>
</td></tr>
<tr><td><code id="spf_+3A_eps">eps</code></td>
<td>
<p>tolerance</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is to calculate
</p>
<p style="text-align: center;"><code class="reqn">\Phi_l(x)=\frac{\int_0^x s^le^{-s}ds}{x^{l+1}},\hspace{0.5cm}l=0,1,2.</code>
</p>

<p>This function is well defined even when x=0. However, it is numerical chanllenging to calculate it when x is small. So when
<code class="reqn">|x|\le \code{eps}</code> we approximate this function and the absolute error is <code class="reqn">\code{eps}^5</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>fx1</code></td>
<td>
<p>when <code class="reqn">l=0</code>;</p>
</td></tr>
<tr><td><code>fx2</code></td>
<td>
<p>when <code class="reqn">l=1</code>;</p>
</td></tr>
<tr><td><code>fx3</code></td>
<td>
<p>when <code class="reqn">l=2</code>.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Version 1.0 (7/19/2016)</p>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>References</h3>

<p>Luo, et al. (2017)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>fun&lt;-spf(x=seq(-1,1,by=0.2),eps=1.0e-3)
fun
</code></pre>

<hr>
<h2 id='wlrcal'>A utility function to calculate the weighted log-rank statistics and their varainces given the weights</h2><span id='topic+wlrcal'></span>

<h3>Description</h3>

<p>A utility function to calculate the weighted log-rank statistics and their varainces given the weights</p>


<h3>Usage</h3>

<pre><code class='language-R'>wlrcal(n=10,te=c(1,2,3),tfix=2.0,dd1=c(1,0,1),dd0=c(0,1,0),r1=c(1,2,3),r0=c(1,2,3),
       weights=matrix(1,nrow=length(te),ncol=1),eps=1.0e-08)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="wlrcal_+3A_n">n</code></td>
<td>
<p>total number of subjects in the study</p>
</td></tr>
<tr><td><code id="wlrcal_+3A_te">te</code></td>
<td>
<p>(ascendingly) ordered unique event times from both groups</p>
</td></tr>
<tr><td><code id="wlrcal_+3A_tfix">tfix</code></td>
<td>
<p>time point where weighted log-rank is calcualted</p>
</td></tr>
<tr><td><code id="wlrcal_+3A_dd1">dd1</code></td>
<td>
<p>number of events from treatment group at each <code>te</code></p>
</td></tr>
<tr><td><code id="wlrcal_+3A_dd0">dd0</code></td>
<td>
<p>number of events from control group at each <code>te</code></p>
</td></tr>
<tr><td><code id="wlrcal_+3A_r1">r1</code></td>
<td>
<p>number of at-risk subjects from treatment group at each <code>te</code></p>
</td></tr>
<tr><td><code id="wlrcal_+3A_r0">r0</code></td>
<td>
<p>number of at-risk subjects from control group at each <code>te</code></p>
</td></tr>
<tr><td><code id="wlrcal_+3A_weights">weights</code></td>
<td>
<p>user specified weights, each column is a set of weights at each <code>te</code></p>
</td></tr>
<tr><td><code id="wlrcal_+3A_eps">eps</code></td>
<td>
<p>tolerence when comparing event times</p>
</td></tr>
</table>


<h3>Details</h3>

<p>More details</p>


<h3>Value</h3>

<table>
<tr><td><code>test</code></td>
<td>
<p>unscaled test statistics</p>
</td></tr>
<tr><td><code>var</code></td>
<td>
<p>variances of the unsclaed test statistics</p>
</td></tr>
<tr><td><code>wlr</code></td>
<td>
<p>weighted log-rank statistics, i.e. scaled test statsitics</p>
</td></tr>
<tr><td><code>wlcor</code></td>
<td>
<p>the correlation matrix of the weighted log-rank statistics</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>Examples</h3>

<pre><code class='language-R'>lr&lt;-wlrcal(n=10,te=c(1,2,3),tfix=2.0,dd1=c(1,0,1),dd0=c(0,1,0),r1=c(1,2,3),r0=c(1,2,3))
lr
</code></pre>

<hr>
<h2 id='wlrcom'>A function to calculate the various weighted log-rank statistics and their varainces</h2><span id='topic+wlrcom'></span>

<h3>Description</h3>

<p>A function to calculate the weighted log-rank statistics and their varainces given the weights including 
log-rank, gehan, Tarone-Ware, Peto-Peto, mPeto-Peto and Fleming-Harrington</p>


<h3>Usage</h3>

<pre><code class='language-R'>wlrcom(y,d,z,tfix=max(y),p=c(1),q=c(1),eps=1.0e-08)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="wlrcom_+3A_y">y</code></td>
<td>
<p>observed times</p>
</td></tr>
<tr><td><code id="wlrcom_+3A_d">d</code></td>
<td>
<p>non-censoring indicators</p>
</td></tr>
<tr><td><code id="wlrcom_+3A_z">z</code></td>
<td>
<p>group indicators, <code>z</code>=1: treatment, <code>z</code>=0 control</p>
</td></tr>
<tr><td><code id="wlrcom_+3A_tfix">tfix</code></td>
<td>
<p>time point at which weighted log-rank is calculated</p>
</td></tr>
<tr><td><code id="wlrcom_+3A_p">p</code></td>
<td>
<p>a vector of power numbers for S in the Fleming-Harrington weight</p>
</td></tr>
<tr><td><code id="wlrcom_+3A_q">q</code></td>
<td>
<p>a vector of power numbers for 1-S in the Fleming-Harrington weight, <code>q</code> and <code>p</code> should have the same length</p>
</td></tr>
<tr><td><code id="wlrcom_+3A_eps">eps</code></td>
<td>
<p>the error tolerance when comparing event times</p>
</td></tr>
</table>


<h3>Details</h3>

<p>V1:3/21/2018</p>


<h3>Value</h3>

<table>
<tr><td><code>n</code></td>
<td>
<p>total number of subjects, combined groups</p>
</td></tr>
<tr><td><code>test</code></td>
<td>
<p>unscaled test statistics</p>
</td></tr>
<tr><td><code>var</code></td>
<td>
<p>variances of the unsclaed test statistics</p>
</td></tr>
<tr><td><code>wlr</code></td>
<td>
<p>weighted log-rank statistics, i.e. scaled test statsitics</p>
</td></tr>
<tr><td><code>pvalue</code></td>
<td>
<p>two-sided p-values of <code>wlr</code></p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>Examples</h3>

<pre><code class='language-R'>n&lt;-1000
pi1&lt;-0.5
taur&lt;-2.8
u&lt;-c(1/taur,1/taur)
ut&lt;-c(taur/2,taur)
r11&lt;-c(1,0.5)
r21&lt;-c(0.5,0.8)
r31&lt;-c(0.7,0.4)
r41&lt;-r51&lt;-r21
rc1&lt;-c(0.5,0.6)
r10&lt;-c(1,0.7)
r20&lt;-c(0.5,1)
r30&lt;-c(0.3,0.4)
r40&lt;-r50&lt;-r20
rc0&lt;-c(0.2,0.4)
tchange&lt;-c(0,1.873)
tcut&lt;-2

E&lt;-T&lt;-C&lt;-z&lt;-delta&lt;-rep(0,n)
E&lt;-rpwu(nr=n,u=u,ut=ut)$r
z&lt;-rbinom(n,1,pi1)
n1&lt;-sum(z)
n0&lt;-sum(1-z)
C[z==1]&lt;-rpwe(nr=n1,rate=rc1,tchange=tchange)$r
C[z==0]&lt;-rpwe(nr=n0,rate=rc0,tchange=tchange)$r
T[z==1]&lt;-rpwecx(nr=n1,rate1=r11,rate2=r21,rate3=r31,
                rate4=r41,rate5=r51,tchange=tchange,type=1)$r
T[z==0]&lt;-rpwecx(nr=n0,rate1=r10,rate2=r20,rate3=r30,
                rate4=r40,rate5=r50,tchange=tchange,type=1)$r
y&lt;-pmin(pmin(T,C),tcut-E)
y1&lt;-pmin(C,tcut-E)
d&lt;-rep(0,n);
d[T&lt;=y]&lt;-1

wlr4&lt;-wlrcom(y=y,d=d,z=z,p=c(1,1),q=c(0,1))
wlr4
</code></pre>

<hr>
<h2 id='wlrutil'>A utility function to calculate some common functions in contructing weights</h2><span id='topic+wlrutil'></span>

<h3>Description</h3>

<p>A utility function to calculate some common functions in contructing weights</p>


<h3>Usage</h3>

<pre><code class='language-R'>wlrutil(y=c(1,2,3),d=c(1,0,1),z=c(1,0,0),te=c(1,3),eps=1.0e-08)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="wlrutil_+3A_y">y</code></td>
<td>
<p>observed times</p>
</td></tr>
<tr><td><code id="wlrutil_+3A_d">d</code></td>
<td>
<p>non-censoring indicators</p>
</td></tr>
<tr><td><code id="wlrutil_+3A_z">z</code></td>
<td>
<p>group indicators with <code>z</code>=1 treatment and <code>z</code>=0 control</p>
</td></tr>
<tr><td><code id="wlrutil_+3A_te">te</code></td>
<td>
<p>(ascendingly) ordered unique event times from both groups</p>
</td></tr>
<tr><td><code id="wlrutil_+3A_eps">eps</code></td>
<td>
<p>tolerence when comparing event times</p>
</td></tr>
</table>


<h3>Details</h3>

<p>More details</p>


<h3>Value</h3>

<table>
<tr><td><code>mfunc</code></td>
<td>
<p>various functions in column</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Xiaodong Luo</p>


<h3>Examples</h3>

<pre><code class='language-R'>ww&lt;-wlrutil(y=c(1,2,3),d=c(1,0,1),z=c(1,0,0),te=c(1,3),eps=1.0e-08)
ww
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
