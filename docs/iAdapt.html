<!DOCTYPE html><html lang="en"><head><title>Help for package iAdapt</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {iAdapt}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#beta.ab'><p>Generates parameters for the beta distribution # I don't think we need to show this as a separate function,</p>
but put together with gen.eff.stg1 or be called by gen.eff.stg1</a></li>
<li><a href='#dlt.prob'><p>Calculate DLT probability corresponding to average nTTP for each dose</p></a></li>
<li><a href='#eff.stg1'><p>Generates efficacy outcomes for stage 1 when using binary toxicity</p></a></li>
<li><a href='#eff.stg1.nTTP'><p>Generates efficacy outcomes for stage 1 when using nTTP to measure toxicity</p></a></li>
<li><a href='#get.thresh'><p>Obtain average nTTP at each dose level</p></a></li>
<li><a href='#LRtox'><p>Calculates likelihood of safety for single dose</p></a></li>
<li><a href='#LRtox.nTTP'><p>Calculates likelihood of safety for single dose, using nTTP</p></a></li>
<li><a href='#nTTP.indiv.sim'><p>Simulate full trial (both stages) x times when using nTTP to measure toxicity</p></a></li>
<li><a href='#rand.prob'><p>Calculates randomization probabilities and dose allocation for next patient</p></a></li>
<li><a href='#rand.stg2'><p>Stage 2 Adaptive Randomization</p></a></li>
<li><a href='#rand.stg2.nTTP'><p>Stage 2 Adaptive Randomization with nTTP to monitor toxicity</p></a></li>
<li><a href='#runExample'><p>Launch Shiny app</p></a></li>
<li><a href='#safe.dose'><p>Identify safe/acceptable doses from stage 1 based on observed binary toxicity</p></a></li>
<li><a href='#safe.dose.nTTP'><p>Identify safe/acceptable doses from stage 1 based on nTTP scores.</p></a></li>
<li><a href='#sim.plot'><p>Generate plots for estimated percent allocation and response per dose.</p></a></li>
<li><a href='#sim.summary'><p>Visualize simulation results (Stages 1&amp;2)</p></a></li>
<li><a href='#sim.trials'><p>Simulate full trial (both stages) x times</p></a></li>
<li><a href='#sim.trials.nTTP'><p>Simulate full trial (both stages) x times when using nTTP to measure toxicity</p></a></li>
<li><a href='#TOX'>
<p>Sample array of toxicity probabilities for 6 doses. Taken from Du et al.</p></a></li>
<li><a href='#tox.profile'><p>Generates DLTs and calculates the likelihood-ratio (LR) for each dose</p></a></li>
<li><a href='#tox.profile.nTTP'><p>Generate nTTPs toxicity scores and the likelihhood-ratio (LR) per dose</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Two-Stage Adaptive Dose-Finding Clinical Trial Design</td>
</tr>
<tr>
<td>Version:</td>
<td>2.0.1</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Alyssa Vanderbeek &lt;vanderbeekam@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Simulate and implement early phase two-stage adaptive dose-finding design for binary and quasi-continuous toxicity endpoints. See Chiuzan et al. (2018) for further reading &lt;<a href="https://doi.org/10.1080%2F19466315.2018.1462727">doi:10.1080/19466315.2018.1462727</a>&gt;.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0), shiny, shinydashboard</td>
</tr>
<tr>
<td>Imports:</td>
<td>Matrix, grDevices, utils</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/LGPL-3">LGPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-08-05 15:29:32 UTC; Alyssa</td>
</tr>
<tr>
<td>Author:</td>
<td>Alyssa Vanderbeek [aut, cre],
  Laura Cosgrove [ctb],
  Elizabeth Garrett-Mayer [ctb],
  Cody Chiuzan [ctb]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-08-06 04:50:09 UTC</td>
</tr>
</table>
<hr>
<h2 id='beta.ab'>Generates parameters for the beta distribution # I don't think we need to show this as a separate function, 
but put together with gen.eff.stg1 or be called by gen.eff.stg1</h2><span id='topic+beta.ab'></span>

<h3>Description</h3>

<p>Function <code>beta.ab()</code> returns parameters alpha and beta for generating beta r.v. (per dose)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>beta.ab(m, v)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="beta.ab_+3A_m">m</code></td>
<td>
<p>mean efficacies for given dose. Values range from 0 - 100. (e.g, T cell persistence - values b/w 5 and 80 per cent)</p>
</td></tr>
<tr><td><code id="beta.ab_+3A_v">v</code></td>
<td>
<p>efficacy variance per dose. Values range from 0 - 1. (e.g., 0.01)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Vector of alpha and beta values for generating beta random variable for a dose.
</p>

<hr>
<h2 id='dlt.prob'>Calculate DLT probability corresponding to average nTTP for each dose</h2><span id='topic+dlt.prob'></span>

<h3>Description</h3>

<p>Calculate DLT probability corresponding to average nTTP for each dose
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dlt.prob(dose, ntox, TOX, grade.thresh)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dlt.prob_+3A_dose">dose</code></td>
<td>
<p>number of doses to be tested (scalar)</p>
</td></tr>
<tr><td><code id="dlt.prob_+3A_ntox">ntox</code></td>
<td>
<p>number (integer) of different toxicity types (e.g, hematological, neurological, GI)</p>
</td></tr>
<tr><td><code id="dlt.prob_+3A_tox">TOX</code></td>
<td>
<p>matrix array of toxicity probabilities. There should be ntox matrices. 
Each matrix represents one toxicity type, where probabilities of each toxicity grade 
are specified across each dose. Each matrix has the same dimensions: n rows, representing 
number of doses, and 5 columns (for grades 0-4, since the probability of a grade 0 event 
may not be 0). Probabilities across each dose (rows) must sum to 1. 
See Ezzalfani et al. (2013) for details.</p>
</td></tr>
<tr><td><code id="dlt.prob_+3A_grade.thresh">grade.thresh</code></td>
<td>
<p>grade (0-4) at which each toxicity type qualifies as a DLT</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ptox - Vector of DLT probabilities per dose.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Number of test doses
dose = 6

# Number of toxicity types
ntox &lt;- 3
           
# Array of toxicity event probabilities
TOX = array(NA, c(dose, 5, ntox)) 

TOX[, , 1] = matrix(c(0.823, 0.152, 0.022, 0.002, 0.001,  #prob of tox for dose 1 and tox type 1
                      0.791, 0.172, 0.032, 0.004, 0.001,  #prob of tox for dose 2 and tox type 1
                      0.758, 0.180, 0.043, 0.010, 0.009,  #prob of tox for dose 3 and tox type 1
                      0.685, 0.190, 0.068, 0.044, 0.013,  #prob of tox for dose 4 and tox type 1
                      0.662, 0.200, 0.078, 0.046, 0.014,  #prob of tox for dose 5 and tox type 1
                      0.605, 0.223, 0.082, 0.070, 0.020), #prob of tox for dose 6 and tox type 1
                      nrow = 6, byrow = TRUE)
TOX[, , 2] = matrix(c(0.970, 0.027, 0.002, 0.001, 0.000,  #prob of tox for dose 1 and tox type 2
                      0.968, 0.029, 0.002, 0.001, 0.000,  #prob of tox for dose 2 and tox type 2
                      0.813, 0.172, 0.006, 0.009, 0.000,  #prob of tox for dose 3 and tox type 2
                      0.762, 0.183, 0.041, 0.010, 0.004,  #prob of tox for dose 4 and tox type 2
                      0.671, 0.205, 0.108, 0.011, 0.005,  #prob of tox for dose 5 and tox type 2
                      0.397, 0.258, 0.277, 0.060, 0.008), #prob of tox for dose 6 and tox type 2
                      nrow = 6, byrow = TRUE)
TOX[, , 3] = matrix(c(0.930, 0.060, 0.005, 0.001, 0.004,  #prob of tox for dose 1 and tox type 3
                      0.917, 0.070, 0.007, 0.001, 0.005,  #prob of tox for dose 2 and tox type 3
                      0.652, 0.280, 0.010, 0.021, 0.037,  #prob of tox for dose 3 and tox type 3
                      0.536, 0.209, 0.031, 0.090, 0.134,  #prob of tox for dose 4 and tox type 3
                      0.015, 0.134, 0.240, 0.335, 0.276,  #prob of tox for dose 5 and tox type 3
                      0.005, 0.052, 0.224, 0.372, 0.347), #prob of tox for dose 6 and tox type 3
                      nrow = 6, byrow = TRUE)
                      
# Grades at which each tox type qualifies as DLT
grade.thresh = c(3, 3, 4)

dlt.prob(dose = dose, ntox = ntox, TOX = TOX, grade.thresh = grade.thresh)

</code></pre>

<hr>
<h2 id='eff.stg1'>Generates efficacy outcomes for stage 1 when using binary toxicity</h2><span id='topic+eff.stg1'></span>

<h3>Description</h3>

<p>Function <code>eff.stg1()</code> uses a beta-binomial distribution to generate 
outcomes (Ys) corresponding to acceptable dose assignments from stage 1.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>eff.stg1(dose, dose.tox, p1, p2, K, coh.size, m, v, nbb = 100)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="eff.stg1_+3A_dose">dose</code></td>
<td>
<p>number of doses to be tested (scalar)</p>
</td></tr>
<tr><td><code id="eff.stg1_+3A_dose.tox">dose.tox</code></td>
<td>
<p>vector of true toxicities for each dose. Values range from 0 - 1.</p>
</td></tr>
<tr><td><code id="eff.stg1_+3A_p1">p1</code></td>
<td>
<p>toxicity under null (unsafe DLT rate). Values range from 0 - 1.</p>
</td></tr>
<tr><td><code id="eff.stg1_+3A_p2">p2</code></td>
<td>
<p>toxicity under alternative (safe DLT rate). Values range from 0 - 1; p1 &gt; p2</p>
</td></tr>
<tr><td><code id="eff.stg1_+3A_k">K</code></td>
<td>
<p>threshold for LR. Takes integer values: 1,2,...(recommended K=2)</p>
</td></tr>
<tr><td><code id="eff.stg1_+3A_coh.size">coh.size</code></td>
<td>
<p>cohort size (number of patients) per dose (Stage 1)</p>
</td></tr>
<tr><td><code id="eff.stg1_+3A_m">m</code></td>
<td>
<p>vector of mean efficacies per dose. Values range from 0 - 100. 
(e.g, T cell persistence - values b/w 5 and 80 per cent)</p>
</td></tr>
<tr><td><code id="eff.stg1_+3A_v">v</code></td>
<td>
<p>vector of efficacy variances per dose. Values range from 0 - 1. (e.g., 0.01)</p>
</td></tr>
<tr><td><code id="eff.stg1_+3A_nbb">nbb</code></td>
<td>
<p>binomial parameter (default = 100 cells per patient)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of efficacy outcomes for subjects enrolled during stage 1 (dose-escalation)
</p>

<ul>
<li><p> Y.safe - vector of efficacy outcomes for each subject assigned to an acceptable safe dose
</p>
</li>
<li><p> d.safe - vector of dose allocation for each subject assigned to an acceptable safe dose
</p>
</li>
<li><p> tox.safe - number of dose-limiting toxicities for each safe dose level
</p>
</li>
<li><p> Y.alloc - vector of efficacy outcomes for all subjects from stage 1 (acceptable and unsafe doses)
</p>
</li>
<li><p> d.alloc - vector of dose allocation for all subjects from stage 1 (acceptable and unsafe doses)
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Number of pre-specified dose levels
dose &lt;- 5
# Vector of true toxicities associated with each dose
dose.tox &lt;- c(0.05, 0.10, 0.20, 0.35, 0.45)       
# Acceptable (p2) and unacceptable (p1) DLT rates used for establishing safety
p1 &lt;- 0.40                                     
p2 &lt;- 0.15   

# Likelihood-ratio (LR) threshold
K &lt;- 2                                          

# Cohort size used in stage 1
coh.size &lt;- 3 

# Vector of true mean efficacies per dose (here mean percent persistence per dose)
m &lt;- c(5, 15, 40, 65, 80)   # MUST BE THE SAME LENGTH AS dose.tox                  

# Efficacy (equal) variance per dose
v &lt;- rep(0.01, 5) 

# Total sample size (stages 1&amp;2)                            
N &lt;- 25                                        

# Stopping rule: if dose 1 is the only safe dose, allocate up to 9 pts.
stop.rule &lt;- 9 

eff.stg1(dose = dose, dose.tox = dose.tox, p1 = p1, p2 = p2, K = K, 
coh.size = coh.size, m, v, nbb = 100)

</code></pre>

<hr>
<h2 id='eff.stg1.nTTP'>Generates efficacy outcomes for stage 1 when using nTTP to measure toxicity</h2><span id='topic+eff.stg1.nTTP'></span>

<h3>Description</h3>

<p>Function <code>eff.stg1.nTTP()</code> uses a beta-binomial distribution to generate 
outcomes (Ys) corresponding to acceptable dose assignments from stage 1.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>eff.stg1.nTTP(
  dose,
  p1,
  p2,
  K,
  coh.size,
  m,
  v,
  nbb = 100,
  W,
  TOX,
  ntox,
  std.nTTP
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="eff.stg1.nTTP_+3A_dose">dose</code></td>
<td>
<p>number of doses to be tested (scalar)</p>
</td></tr>
<tr><td><code id="eff.stg1.nTTP_+3A_p1">p1</code></td>
<td>
<p>toxicity under null (unsafe nTTP). Values range from 0 - 1.</p>
</td></tr>
<tr><td><code id="eff.stg1.nTTP_+3A_p2">p2</code></td>
<td>
<p>toxicity under alternative (safe nTTP). Values range from 0 - 1; p1 &gt; p2</p>
</td></tr>
<tr><td><code id="eff.stg1.nTTP_+3A_k">K</code></td>
<td>
<p>threshold for LR. Takes integer values: 1,2,...(recommended K=2)</p>
</td></tr>
<tr><td><code id="eff.stg1.nTTP_+3A_coh.size">coh.size</code></td>
<td>
<p>cohort size (number of patients) per dose (Stage 1)</p>
</td></tr>
<tr><td><code id="eff.stg1.nTTP_+3A_m">m</code></td>
<td>
<p>vector of mean efficacies per dose. Values range from 0 - 100. 
(e.g, T cell persistence - values b/w 5 and 80 per cent)</p>
</td></tr>
<tr><td><code id="eff.stg1.nTTP_+3A_v">v</code></td>
<td>
<p>vector of efficacy variances per dose. Values range from 0 - 1. (e.g., 0.01)</p>
</td></tr>
<tr><td><code id="eff.stg1.nTTP_+3A_nbb">nbb</code></td>
<td>
<p>binomial parameter (default = 100 cells per patient)</p>
</td></tr>
<tr><td><code id="eff.stg1.nTTP_+3A_w">W</code></td>
<td>
<p>matrix defining burden weight of each grade level for all toxicity types. 
The dimensions are ntox rows by 4 columns (for grades 0-4). 
See Ezzalfani et al. (2013) for details.</p>
</td></tr>
<tr><td><code id="eff.stg1.nTTP_+3A_tox">TOX</code></td>
<td>
<p>matrix array of toxicity probabilities. There should be ntox matrices. 
Each matrix represents one toxicity type, where probabilities of each toxicity grade are 
specified across each dose. Each matrix has the same dimensions: 
n rows, representing number of doses, and 5 columns (for grades 0-4). 
Probabilities across each dose (rows) must sum to 1. 
See Ezzalfani et al. (2013) for details.</p>
</td></tr>
<tr><td><code id="eff.stg1.nTTP_+3A_ntox">ntox</code></td>
<td>
<p>number (integer) of different toxicity types</p>
</td></tr>
<tr><td><code id="eff.stg1.nTTP_+3A_std.nttp">std.nTTP</code></td>
<td>
<p>the standard deviation of nTTP scores at each dose level 
(assumed constant across doses)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of efficacy outcomes for subjects enrolled during stage 1 (dose-escalation)
</p>

<ul>
<li><p> Y.safe - vector of efficacy outcomes for each subject assigned to an acceptable safe dose
</p>
</li>
<li><p> d.safe - vector of dose allocation for each subject assigned to an acceptable safe dose
</p>
</li>
<li><p> tox.safe - number of dose-limiting toxicities for each safe dose level
</p>
</li>
<li><p> Y.alloc - vector of efficacy outcomes for all subjects from stage 1 
(acceptable and unsafe doses)
</p>
</li>
<li><p> d.alloc - vector of dose allocation for all subjects from stage 1 
(acceptable and unsafe doses)
</p>
</li>
<li><p> all_nttp - all observed nTTP values
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Number of pre-specified dose levels
dose &lt;- 6      

# Acceptable (p2) and unacceptable nTTP values
p1 &lt;- 0.35                                     
p2 &lt;- 0.10    

# Likelihood-ratio (LR) threshold
K &lt;- 2                                          

# Cohort size used in stage 1
coh.size &lt;- 3 

# Efficacy (equal) variance per dose
v &lt;- rep(0.01, 6)

# Dose-efficacy curve
m = c(10, 20, 30, 40, 70, 90)

# Number of toxicity types
ntox &lt;- 3

# Toxicity burden weight matrix
W = matrix(c(0, 0.5, 0.75, 1.0, 1.5, # Burden weight for grades 0-4 for toxicity 1
             0, 0.5, 0.75, 1.0, 1.5, # Burden weight for grades 0-4 for toxicity 2
             0, 0.00, 0.00, 0.5, 1), # Burden weight for grades 0-4 for toxicity 3
           nrow = ntox, byrow = TRUE)
           

# standard deviation of nTTP values
std.nTTP = 0.15

# Array of toxicity event probabilities
TOX &lt;- array(NA, c(dose, 5, ntox)) 

TOX[, , 1] = matrix(c(0.823, 0.152, 0.022, 0.002, 0.001,
                      0.791, 0.172, 0.032, 0.004, 0.001,
                      0.758, 0.180, 0.043, 0.010, 0.009,
                      0.685, 0.190, 0.068, 0.044, 0.013,
                      0.662, 0.200, 0.078, 0.046, 0.014,
                      0.605, 0.223, 0.082, 0.070, 0.020),
                    nrow = 6, byrow = TRUE)
TOX[, , 2] = matrix(c(0.970, 0.027, 0.002, 0.001, 0.000,
                      0.968, 0.029, 0.002, 0.001, 0.000,
                      0.813, 0.172, 0.006, 0.009, 0.000,
                      0.762, 0.183, 0.041, 0.010, 0.004,
                      0.671, 0.205, 0.108, 0.011, 0.005,
                      0.397, 0.258, 0.277, 0.060, 0.008),
                    nrow = 6, byrow = TRUE)
TOX[, , 3] = matrix(c(0.930, 0.060, 0.005, 0.001, 0.004,
                      0.917, 0.070, 0.007, 0.001, 0.005,
                      0.652, 0.280, 0.010, 0.021, 0.037,
                      0.536, 0.209, 0.031, 0.090, 0.134,
                      0.015, 0.134, 0.240, 0.335, 0.276,
                      0.005, 0.052, 0.224, 0.372, 0.347),
                    nrow = 6, byrow = TRUE)

eff.stg1.nTTP(dose = dose, p1 = p1, p2 = p2, K = K, coh.size = coh.size, 
m = m, v = v, nbb = 100, W = W, TOX = TOX, ntox = ntox, std.nTTP = std.nTTP) 


</code></pre>

<hr>
<h2 id='get.thresh'>Obtain average nTTP at each dose level</h2><span id='topic+get.thresh'></span>

<h3>Description</h3>

<p>Obtain average nTTP at each dose level
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get.thresh(dose, ntox, W, TOX)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get.thresh_+3A_dose">dose</code></td>
<td>
<p>number of doses to be tested (scalar)</p>
</td></tr>
<tr><td><code id="get.thresh_+3A_ntox">ntox</code></td>
<td>
<p>number (integer) of different toxicity types (e.g, hematological, neurological, GI)</p>
</td></tr>
<tr><td><code id="get.thresh_+3A_w">W</code></td>
<td>
<p>matrix defines burden weight of each grade level for all toxicity types. 
The dimensions are ntox rows by 4 columns (for grades 0-4). See Ezzalfani et al. (2013) for details.</p>
</td></tr>
<tr><td><code id="get.thresh_+3A_tox">TOX</code></td>
<td>
<p>matrix array of toxicity probabilities. There should be ntox matrices. 
Each matrix represents one toxicity type, where probabilities of each toxicity grade 
are specified across each dose. Each matrix has the same dimensions: n rows, representing 
number of doses, and 5 columns (for grades 0-4). 
Probabilities across each dose (rows) must sum to 1. 
See Ezzalfani et al. (2013) for details.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Vector of average nTTP for each dose level.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Number of test doses
dose = 6

# Number of toxicity types
ntox &lt;- 3
 
# Toxicity burden weight matrix
W = matrix(c(0, 0.5, 0.75, 1.0, 1.5, # Burden weight for grades 0-4 for toxicity 1
             0, 0.5, 0.75, 1.0, 1.5, # Burden weight for grades 0-4 for toxicity 2
             0, 0.00, 0.00, 0.5, 1), # Burden weight for grades 0-4 for toxicity 3
           nrow = ntox, byrow = TRUE)
           

# Array of toxicity event probabilities
TOX = array(NA, c(dose, 5, ntox)) 

TOX[, , 1] = matrix(c(0.823, 0.152, 0.022, 0.002, 0.001,  #prob of tox for dose 1 and tox type 1
                      0.791, 0.172, 0.032, 0.004, 0.001,  #prob of tox for dose 2 and tox type 1
                      0.758, 0.180, 0.043, 0.010, 0.009,  #prob of tox for dose 3 and tox type 1
                      0.685, 0.190, 0.068, 0.044, 0.013,  #prob of tox for dose 4 and tox type 1
                      0.662, 0.200, 0.078, 0.046, 0.014,  #prob of tox for dose 5 and tox type 1
                      0.605, 0.223, 0.082, 0.070, 0.020), #prob of tox for dose 6 and tox type 1
                      nrow = 6, byrow = TRUE)
TOX[, , 2] = matrix(c(0.970, 0.027, 0.002, 0.001, 0.000,  #prob of tox for dose 1 and tox type 2
                      0.968, 0.029, 0.002, 0.001, 0.000,  #prob of tox for dose 2 and tox type 2
                      0.813, 0.172, 0.006, 0.009, 0.000,  #prob of tox for dose 3 and tox type 2
                      0.762, 0.183, 0.041, 0.010, 0.004,  #prob of tox for dose 4 and tox type 2
                      0.671, 0.205, 0.108, 0.011, 0.005,  #prob of tox for dose 5 and tox type 2
                      0.397, 0.258, 0.277, 0.060, 0.008), #prob of tox for dose 6 and tox type 2
                      nrow = 6, byrow = TRUE)
TOX[, , 3] = matrix(c(0.930, 0.060, 0.005, 0.001, 0.004,  #prob of tox for dose 1 and tox type 3
                      0.917, 0.070, 0.007, 0.001, 0.005,  #prob of tox for dose 2 and tox type 3
                      0.652, 0.280, 0.010, 0.021, 0.037,  #prob of tox for dose 3 and tox type 3
                      0.536, 0.209, 0.031, 0.090, 0.134,  #prob of tox for dose 4 and tox type 3
                      0.015, 0.134, 0.240, 0.335, 0.276,  #prob of tox for dose 5 and tox type 3
                      0.005, 0.052, 0.224, 0.372, 0.347), #prob of tox for dose 6 and tox type 3
                      nrow = 6, byrow = TRUE)
                      
get.thresh(dose = dose, ntox = ntox, W = W, TOX = TOX)
   
</code></pre>

<hr>
<h2 id='LRtox'>Calculates likelihood of safety for single dose</h2><span id='topic+LRtox'></span>

<h3>Description</h3>

<p>Function <code>LRtox()</code> calculates the likelihood of safety for a single dose 
and designates whether to escalate to the next dose (safe) or stop dose escalation and move onto stage 2 (unsafe).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>LRtox(coh.size, ndlt, p1, p2, K = 2)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="LRtox_+3A_coh.size">coh.size</code></td>
<td>
<p>cohort size (number of patients) per dose (Stage 1)</p>
</td></tr>
<tr><td><code id="LRtox_+3A_ndlt">ndlt</code></td>
<td>
<p>number of observed DLTs</p>
</td></tr>
<tr><td><code id="LRtox_+3A_p1">p1</code></td>
<td>
<p>toxicity under null (unsafe DLT rate). Values range from 0 - 1.</p>
</td></tr>
<tr><td><code id="LRtox_+3A_p2">p2</code></td>
<td>
<p>toxicity under alternative (safe DLT rate). Values range from 0 - 1; p1 &gt; p2</p>
</td></tr>
<tr><td><code id="LRtox_+3A_k">K</code></td>
<td>
<p>threshold for LR. Takes integer values: 1,2,...(recommended K=2)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List object that gives the likelihood ratio of safety and indicates whether to escalate to the 
next highest dose level, or stop dose escalation and move onto stage 2.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>LRtox(coh.size = 3, ndlt = 2, p1 = 0.40, p2 = 0.15, K = 2)
LRtox(coh.size = 3, ndlt = 1, p1 = 0.40, p2 = 0.15, K = 2)

</code></pre>

<hr>
<h2 id='LRtox.nTTP'>Calculates likelihood of safety for single dose, using nTTP</h2><span id='topic+LRtox.nTTP'></span>

<h3>Description</h3>

<p>(nTTP) Function <code>LRtox.nTTP()</code> calculates the likelihood of safety for a single dose 
and designates whether to escalate to the next dose (safe) or stop dose escalation and move onto stage 2 (unsafe).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>LRtox.nTTP(tox_grades, ntox, coh.size, W, p1, p2, K = 2, std.nTTP = 0.15)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="LRtox.nTTP_+3A_tox_grades">tox_grades</code></td>
<td>
<p>data frame of observed AE grades for each patient (rows) across all toxicity types (columns).
e.g. for one patient, grades for 3 toxicity types might be c(3, 2, 4), where they experienced a grade 3 AE for tox type 1,
grade 2 AE for tox type 2, etc.</p>
</td></tr>
<tr><td><code id="LRtox.nTTP_+3A_ntox">ntox</code></td>
<td>
<p>number (integer) of different toxicity types</p>
</td></tr>
<tr><td><code id="LRtox.nTTP_+3A_coh.size">coh.size</code></td>
<td>
<p>cohort size (number of patients) per dose (Stage 1)</p>
</td></tr>
<tr><td><code id="LRtox.nTTP_+3A_w">W</code></td>
<td>
<p>matrix defining burden weight of each grade level for all toxicity types. 
The dimensions are ntox rows by 5 columns (for grades 0-4).
See Ezzalfani et al. (2013) for details.</p>
</td></tr>
<tr><td><code id="LRtox.nTTP_+3A_p1">p1</code></td>
<td>
<p>toxicity under null (unsafe DLT rate). Values range from 0 - 1.</p>
</td></tr>
<tr><td><code id="LRtox.nTTP_+3A_p2">p2</code></td>
<td>
<p>toxicity under alternative (safe DLT rate). Values range from 0 - 1; p1 &gt; p2</p>
</td></tr>
<tr><td><code id="LRtox.nTTP_+3A_k">K</code></td>
<td>
<p>threshold for LR. Takes integer values: 1,2,...(recommended K=2)</p>
</td></tr>
<tr><td><code id="LRtox.nTTP_+3A_std.nttp">std.nTTP</code></td>
<td>
<p>the standard deviation of nTTP scores at each dose level (constant across doses)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List object that gives the likelihood ratio of safety and indicates whether to escalate to the 
next highest dose level, or stop dose escalation and move onto stage 2.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ntox = 3 # three different types of toxicity 
coh.size = 3 # number of patients enrolled per dose

# Observed AE grades for each patient on tested dose
obs = data.frame(tox1 = c(3, 2, 4),
                 tox2 = c(1, 1, 2),
                 tox3 = c(2, 3, 3))
                
# Toxicity burden weight matrix
W = matrix(c(0, 0.5, 0.75, 1.0, 1.5, # Burden weight for grades 0-4 for toxicity 1
             0, 0.5, 0.75, 1.0, 1.5, # Burden weight for grades 0-4 for toxicity 2
             0, 0.00, 0.00, 0.5, 1), # Burden weight for grades 0-4 for toxicity 3
             nrow = ntox, byrow = TRUE) 
             
# Acceptable (p2) and unacceptable nTTP values
p1 &lt;- 0.35                                     
p2 &lt;- 0.10       
             
LRtox.nTTP(obs, ntox, coh.size, W, p1, p2, K = 2, std.nTTP = 0.15)                                

</code></pre>

<hr>
<h2 id='nTTP.indiv.sim'>Simulate full trial (both stages) x times when using nTTP to measure toxicity</h2><span id='topic+nTTP.indiv.sim'></span>

<h3>Description</h3>

<p>Results are displayed in a matrix format, where each row represents one trial simulation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nTTP.indiv.sim(W, TOX, ntox, dose)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="nTTP.indiv.sim_+3A_w">W</code></td>
<td>
<p>matrix defining burden weight of each grade level for all toxicity types. 
The dimensions are ntox rows by 5 columns (for grades 0-4).
See Ezzalfani et al. (2013) for details.</p>
</td></tr>
<tr><td><code id="nTTP.indiv.sim_+3A_tox">TOX</code></td>
<td>
<p>matrix array of toxicity probabilities. There should be ntox matrices. 
Each matrix represents one toxicity type, where probabilities of each toxicity 
grade are specified across each dose. Each matrix has the same dimensions: 
n rows, representing number of doses, and 5 columns (for grades 0-4). 
Probabilities across each dose (rows) must sum to 1. See Ezzalfani et al. (2013) for details.</p>
</td></tr>
<tr><td><code id="nTTP.indiv.sim_+3A_ntox">ntox</code></td>
<td>
<p>number (integer) of different toxicity types</p>
</td></tr>
<tr><td><code id="nTTP.indiv.sim_+3A_dose">dose</code></td>
<td>
<p>number of doses to be tested (scalar)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of the following objects:
</p>

<ul>
<li><p> sim.Y - estimated efficacy per each dose assignment 
</p>
</li>
<li><p> sim.d - dose assignment for each patient in the trial 
</p>
</li></ul>


<hr>
<h2 id='rand.prob'>Calculates randomization probabilities and dose allocation for next patient</h2><span id='topic+rand.prob'></span>

<h3>Description</h3>

<p>Function <code>rand.prob()</code> calculates the updated randomization probabilities based on observed efficacies up to that point.
It also gives the dose allocation for the next enrolled patient based on these probabilities.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rand.prob(y.eff, d.safe)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rand.prob_+3A_y.eff">y.eff</code></td>
<td>
<p>vector of all efficacy outcomes for each dose allocation</p>
</td></tr>
<tr><td><code id="rand.prob_+3A_d.safe">d.safe</code></td>
<td>
<p>vector of dose assignment</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List object giving
</p>

<ul>
<li><p> Rand.Prob - randomization probability for each safe dose (from stage 1)
</p>
</li>
<li><p> Next.Dose - the dose to enroll the next patient on
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>y.eff &lt;- c(9, 1, 0, 34, 10, 27, 38, 42, 60, 75, 48, 62)
d.safe &lt;- c(1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4)
rand.prob(y.eff, d.safe)

</code></pre>

<hr>
<h2 id='rand.stg2'>Stage 2 Adaptive Randomization</h2><span id='topic+rand.stg2'></span>

<h3>Description</h3>

<p>Function <code>rand.stg2()</code> fits a linear regression for the continuous 
efficacy outcomes,
computes the randomization probabilities/dose and allocates the next patient to a dose that
is considered acceptably safe and has the most promising efficacy. Dose safety is still 
monitored using LR and doses
that become unacceptable are discarded (never re-visited).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rand.stg2(
  dose,
  dose.tox,
  p1,
  p2,
  K,
  coh.size,
  m,
  v,
  N,
  stop.rule = 9,
  cohort = 1,
  samedose = TRUE,
  nbb = 100
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rand.stg2_+3A_dose">dose</code></td>
<td>
<p>number of doses to be tested (scalar)</p>
</td></tr>
<tr><td><code id="rand.stg2_+3A_dose.tox">dose.tox</code></td>
<td>
<p>vector of true toxicities for each dose. Values range from 0 - 1.</p>
</td></tr>
<tr><td><code id="rand.stg2_+3A_p1">p1</code></td>
<td>
<p>toxicity under null (unsafe DLT rate). Values range from 0 - 1.</p>
</td></tr>
<tr><td><code id="rand.stg2_+3A_p2">p2</code></td>
<td>
<p>toxicity under alternative (safe DLT rate). Values range from 0 - 1; p1 &gt; p2</p>
</td></tr>
<tr><td><code id="rand.stg2_+3A_k">K</code></td>
<td>
<p>threshold for LR. Takes integer values: 1,2,...(recommended K=2)</p>
</td></tr>
<tr><td><code id="rand.stg2_+3A_coh.size">coh.size</code></td>
<td>
<p>cohort size (number of patients) per dose (Stage 1)</p>
</td></tr>
<tr><td><code id="rand.stg2_+3A_m">m</code></td>
<td>
<p>vector of mean efficacies per dose. Values range from 0 - 100. 
(e.g, T cell persistence - values b/w 5 and 80 per cent)</p>
</td></tr>
<tr><td><code id="rand.stg2_+3A_v">v</code></td>
<td>
<p>vector of efficacy variances per dose. Values range from 0 - 1. (e.g., 0.01)</p>
</td></tr>
<tr><td><code id="rand.stg2_+3A_n">N</code></td>
<td>
<p>total sample size for stages 1&amp;2</p>
</td></tr>
<tr><td><code id="rand.stg2_+3A_stop.rule">stop.rule</code></td>
<td>
<p>if only dose 1 safe, allocate up to 9 (default) patients at dose 1 
to collect more info</p>
</td></tr>
<tr><td><code id="rand.stg2_+3A_cohort">cohort</code></td>
<td>
<p>cohort size (number of patients) per dose (Stage 2). Default is 1.</p>
</td></tr>
<tr><td><code id="rand.stg2_+3A_samedose">samedose</code></td>
<td>
<p>designates whether the next patient is allocated to the same dose 
as the previous patient. Default is TRUE. Function adjusts accordingly.</p>
</td></tr>
<tr><td><code id="rand.stg2_+3A_nbb">nbb</code></td>
<td>
<p>binomial parameter (default = 100 cells per patient)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of the following objects:
</p>

<ul>
<li><p> Y.final - vector of all efficacy outcomes (Ys) corresponding to dose assignments 
(Stages 1&amp;2)
</p>
</li>
<li><p> d.final - vector of all dose assignments(Stages 1&amp;2)
</p>
</li></ul>

<p>If dose allocation stops early, put NAs in d.final and y.final 
until it reaches the total sample size.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Number of pre-specified dose levels
dose &lt;- 5
# Vector of true toxicities associated with each dose
dose.tox &lt;- c(0.05, 0.10, 0.20, 0.35, 0.45)       
# Acceptable (p_yes) and unacceptable (p_no) DLT rates used for establishing safety
p_no &lt;- 0.40                                     
p_yes &lt;- 0.15    

# Likelihood-ratio (LR) threshold
K &lt;- 2                                          

# Cohort size used in stage 1
coh.size &lt;- 3 

# Vector of true mean efficacies per dose (here mean percent persistence per dose)
m &lt;- c(5, 15, 40, 65, 80)   # MUST BE THE SAME LENGTH AS dose.tox                  

# Efficacy(equal) variance per dose
v &lt;- rep(0.01, 5) 

# Total sample size (stages 1&amp;2)                            
N &lt;- 25                                        

# Stopping rule: if dose 1 is the only safe dose, allocate up to 9 pts.
stop.rule &lt;- 9 

rand.stg2(dose, dose.tox, p_no, p_yes, K, coh.size, m, v, N, stop.rule = stop.rule, 
cohort = 1, samedose = TRUE, nbb = 100) 

</code></pre>

<hr>
<h2 id='rand.stg2.nTTP'>Stage 2 Adaptive Randomization with nTTP to monitor toxicity</h2><span id='topic+rand.stg2.nTTP'></span>

<h3>Description</h3>

<p>Function <code>rand.stg2.nTTP()</code> fits a linear regression for the continuous 
efficacy outcomes, computes the randomization probabilities/dose and allocates the next patient 
to a dose that is considered acceptably safe and has the highest efficacy. Dose safety 
(with nTTP) is still monitored using LR and doses that become unacceptable are discarded 
(never re-visited).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rand.stg2.nTTP(
  dose,
  p1,
  p2,
  K,
  coh.size,
  m,
  v,
  N,
  stop.rule = 9,
  cohort = 1,
  samedose = TRUE,
  nbb = 100,
  W,
  TOX,
  ntox,
  std.nTTP = 0.15
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rand.stg2.nTTP_+3A_dose">dose</code></td>
<td>
<p>number of doses to be tested (scalar)</p>
</td></tr>
<tr><td><code id="rand.stg2.nTTP_+3A_p1">p1</code></td>
<td>
<p>toxicity under null (unsafe nTTP). Values range from 0 - 1.</p>
</td></tr>
<tr><td><code id="rand.stg2.nTTP_+3A_p2">p2</code></td>
<td>
<p>toxicity under alternative (safe nTTP). Values range from 0 - 1; p1 &gt; p2</p>
</td></tr>
<tr><td><code id="rand.stg2.nTTP_+3A_k">K</code></td>
<td>
<p>threshold for LR. Takes integer values: 1,2,...(recommended K=2)</p>
</td></tr>
<tr><td><code id="rand.stg2.nTTP_+3A_coh.size">coh.size</code></td>
<td>
<p>cohort size (number of patients) per dose (Stage 1)</p>
</td></tr>
<tr><td><code id="rand.stg2.nTTP_+3A_m">m</code></td>
<td>
<p>vector of mean efficacies per dose. Values range from 0 - 100. 
(e.g, T cell persistence - values b/w 5 and 80 per cent)</p>
</td></tr>
<tr><td><code id="rand.stg2.nTTP_+3A_v">v</code></td>
<td>
<p>vector of efficacy variances per dose. Values range from 0 - 1. (e.g., 0.01)</p>
</td></tr>
<tr><td><code id="rand.stg2.nTTP_+3A_n">N</code></td>
<td>
<p>total sample size for stages 1&amp;2</p>
</td></tr>
<tr><td><code id="rand.stg2.nTTP_+3A_stop.rule">stop.rule</code></td>
<td>
<p>if only dose 1 safe, allocate up to 9 (default) patients at dose 1 to 
collect more info</p>
</td></tr>
<tr><td><code id="rand.stg2.nTTP_+3A_cohort">cohort</code></td>
<td>
<p>cohort size (number of patients) per dose (Stage 2). Default is 1.</p>
</td></tr>
<tr><td><code id="rand.stg2.nTTP_+3A_samedose">samedose</code></td>
<td>
<p>designates whether the next patient is allocated to the same dose as the 
previous patient. Default is TRUE. Function adjusts accordingly.</p>
</td></tr>
<tr><td><code id="rand.stg2.nTTP_+3A_nbb">nbb</code></td>
<td>
<p>binomial parameter (default = 100 cells per patient)</p>
</td></tr>
<tr><td><code id="rand.stg2.nTTP_+3A_w">W</code></td>
<td>
<p>matrix defining burden weight of each grade level for all toxicity types. 
The dimensions are ntox rows by 4 columns (for grades 0-4). 
See Ezzalfani et al. (2013) for details.</p>
</td></tr>
<tr><td><code id="rand.stg2.nTTP_+3A_tox">TOX</code></td>
<td>
<p>matrix array of toxicity probabilities. There should be ntox matrices. 
Each matrix represents one toxicity type, where probabilities of each toxicity grade are 
specified across each dose. Each matrix has the same dimensions: 
n rows, representing number of doses, and 5 columns (for grades 0-4). 
Probabilities across each dose (rows) must sum to 1. 
See Ezzalfani et al. (2013) for details.</p>
</td></tr>
<tr><td><code id="rand.stg2.nTTP_+3A_ntox">ntox</code></td>
<td>
<p>number (integer) of different toxicity types</p>
</td></tr>
<tr><td><code id="rand.stg2.nTTP_+3A_std.nttp">std.nTTP</code></td>
<td>
<p>the standard deviation of nTTP scores at each dose level (constant across doses)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of the following objects:
</p>

<ul>
<li><p> Y.final - vector of all efficacy outcomes (Ys) corresponding to dose assignments 
(Stages 1&amp;2)
</p>
</li>
<li><p> d.final - vector of all dose assignments(Stage 1&amp;2)
</p>
</li>
<li><p> n1 - Stage 1 sample size
</p>
</li></ul>

<p>If dose allocation stops early, put NAs in d.final and y.final until it reaches the total 
sample size.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Number of pre-specified dose levels
dose &lt;- 6      

# Acceptable (p2) and unacceptable nTTP values
p1 &lt;- 0.35                                     
p2 &lt;- 0.10     

# Likelihood-ratio (LR) threshold
K &lt;- 2                                          

# Cohort size used in stage 1
coh.size &lt;- 3 

# Total sample size (stages 1&amp;2)                            
N &lt;- 25 

# Efficacy (equal) variance per dose
v &lt;- rep(0.01, 6)

# Dose-efficacy curve
m = c(10, 20, 30, 40, 70, 90)

# Number of toxicity types
ntox &lt;- 3

# Toxicity burden weight matrix
W = matrix(c(0, 0.5, 0.75, 1.0, 1.5, # Burden weight for grades 0-4 for toxicity 1
             0, 0.5, 0.75, 1.0, 1.5, # Burden weight for grades 0-4 for toxicity 2
             0, 0.00, 0.00, 0.5, 1), # Burden weight for grades 0-4 for toxicity 3
           nrow = ntox, byrow = TRUE)
           
# Standard deviation of nTTP value
std.nTTP = 0.15

# Array of toxicity event probabilities
TOX &lt;- array(NA, c(dose, 5, ntox)) 

TOX[, , 1] = matrix(c(0.823, 0.152, 0.022, 0.002, 0.001,
                      0.791, 0.172, 0.032, 0.004, 0.001,
                      0.758, 0.180, 0.043, 0.010, 0.009,
                      0.685, 0.190, 0.068, 0.044, 0.013,
                      0.662, 0.200, 0.078, 0.046, 0.014,
                      0.605, 0.223, 0.082, 0.070, 0.020),
                      nrow = 6, byrow = TRUE)
TOX[, , 2] = matrix(c(0.970, 0.027, 0.002, 0.001, 0.000,
                      0.968, 0.029, 0.002, 0.001, 0.000,
                      0.813, 0.172, 0.006, 0.009, 0.000,
                      0.762, 0.183, 0.041, 0.010, 0.004,
                      0.671, 0.205, 0.108, 0.011, 0.005,
                      0.397, 0.258, 0.277, 0.060, 0.008),
                      nrow = 6, byrow = TRUE)
TOX[, , 3] = matrix(c(0.930, 0.060, 0.005, 0.001, 0.004,
                      0.917, 0.070, 0.007, 0.001, 0.005,
                      0.652, 0.280, 0.010, 0.021, 0.037,
                      0.536, 0.209, 0.031, 0.090, 0.134,
                      0.015, 0.134, 0.240, 0.335, 0.276,
                      0.005, 0.052, 0.224, 0.372, 0.347),
                      nrow = 6, byrow = TRUE)

rand.stg2.nTTP(dose = dose, p1 = p1, p2 = p2, K = K, coh.size = coh.size, 
m = m, v = v, N = N, stop.rule = 9, 
cohort = 1, samedose = TRUE, nbb = 100, W = W, TOX = TOX, ntox = ntox, std.nTTP = std.nTTP) 

</code></pre>

<hr>
<h2 id='runExample'>Launch Shiny app</h2><span id='topic+runExample'></span>

<h3>Description</h3>

<p>Launch Shiny app
</p>


<h3>Usage</h3>

<pre><code class='language-R'>runExample()
</code></pre>

<hr>
<h2 id='safe.dose'>Identify safe/acceptable doses from stage 1 based on observed binary toxicity</h2><span id='topic+safe.dose'></span>

<h3>Description</h3>

<p>Function <code>safe.dose()</code> distinguishes acceptable from unacceptable doses
</p>


<h3>Usage</h3>

<pre><code class='language-R'>safe.dose(dose, dose.tox, p1, p2, K, coh.size)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="safe.dose_+3A_dose">dose</code></td>
<td>
<p>number of doses to be tested (scalar)</p>
</td></tr>
<tr><td><code id="safe.dose_+3A_dose.tox">dose.tox</code></td>
<td>
<p>vector of true toxicities for each dose. Values range from 0 - 1.</p>
</td></tr>
<tr><td><code id="safe.dose_+3A_p1">p1</code></td>
<td>
<p>toxicity under null (unsafe DLT rate). Values range from 0 - 1.</p>
</td></tr>
<tr><td><code id="safe.dose_+3A_p2">p2</code></td>
<td>
<p>toxicity under alternative (safe DLT rate). Values range from 0 - 1; p1 &gt; p2</p>
</td></tr>
<tr><td><code id="safe.dose_+3A_k">K</code></td>
<td>
<p>threshold for LR. Takes integer values: 1,2,...(recommended K=2)</p>
</td></tr>
<tr><td><code id="safe.dose_+3A_coh.size">coh.size</code></td>
<td>
<p>cohort size (number of patients) per dose (Stage 1)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of the following objects:
</p>

<ul>
<li><p> alloc.safe - matrix of assignments only for acceptable doses 
(to be used in stage 2) and their corresponding toxicities
</p>
</li>
<li><p> alloc.total - vector of all dose assignments from stage 1 
</p>
</li>
<li><p> n1 - total number of subjects allocated in stage 1
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>dose = 5                                      # Dose levels
dose.tox &lt;- c(0.05, 0.10, 0.15, 0.20, 0.30)   # True toxicity per dose
p1 = 0.40                                     # Unacceptable DLT rate
p2 = 0.15                                     # Acceptable DLT rate
K = 2                                         # Likelihood-ratio (LR) threshold
coh.size = 3                                  # Assign 3 pts per dose in stage 1

safe.dose(dose = dose, dose.tox = dose.tox, p1 = p1, p2 = p2, K = K, coh.size = coh.size) 

</code></pre>

<hr>
<h2 id='safe.dose.nTTP'>Identify safe/acceptable doses from stage 1 based on nTTP scores.</h2><span id='topic+safe.dose.nTTP'></span>

<h3>Description</h3>

<p>Function <code>safe.dose.nTTP()</code> distinguishes acceptable from unacceptable doses
</p>


<h3>Usage</h3>

<pre><code class='language-R'>safe.dose.nTTP(dose, p1, p2, K, coh.size, W, TOX, ntox, std.nTTP = 0.15)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="safe.dose.nTTP_+3A_dose">dose</code></td>
<td>
<p>number of doses to be tested (scalar)</p>
</td></tr>
<tr><td><code id="safe.dose.nTTP_+3A_p1">p1</code></td>
<td>
<p>toxicity under null (unsafe nTTP). Values range from 0 - 1.</p>
</td></tr>
<tr><td><code id="safe.dose.nTTP_+3A_p2">p2</code></td>
<td>
<p>toxicity under alternative (safe nTTP). Values range from 0 - 1; p1 &gt; p2</p>
</td></tr>
<tr><td><code id="safe.dose.nTTP_+3A_k">K</code></td>
<td>
<p>threshold for LR. Takes integer values: 1,2,...(recommended K=2)</p>
</td></tr>
<tr><td><code id="safe.dose.nTTP_+3A_coh.size">coh.size</code></td>
<td>
<p>cohort size (number of patients) per dose (Stage 1)</p>
</td></tr>
<tr><td><code id="safe.dose.nTTP_+3A_w">W</code></td>
<td>
<p>matrix defining burden weight of each grade level for all toxicity types. 
The dimensions are ntox rows by 4 columns (for grades 0-4). 
See Ezzalfani et al. (2013) for details.</p>
</td></tr>
<tr><td><code id="safe.dose.nTTP_+3A_tox">TOX</code></td>
<td>
<p>matrix array of toxicity probabilities. There should be ntox matrices. 
Each matrix represents one toxicity type, where probabilities of each toxicity grade 
are specified across each dose. Each matrix has the same dimensions: n rows, representing 
number of doses, and 5 columns (for grades 0-4). 
Probabilities across each dose (rows) must sum to 1. 
See Ezzalfani et al. (2013) for details.</p>
</td></tr>
<tr><td><code id="safe.dose.nTTP_+3A_ntox">ntox</code></td>
<td>
<p>number (integer) of different toxicity types</p>
</td></tr>
<tr><td><code id="safe.dose.nTTP_+3A_std.nttp">std.nTTP</code></td>
<td>
<p>the standard deviation of nTTP scores at each dose level (constant across doses)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of the following objects:
</p>

<ul>
<li><p> alloc.safe - matrix of assignments only for acceptable doses (to be used in stage 2) 
and their corresponding toxicities
</p>
</li>
<li><p> alloc.total - vector of all dose assignments from stage 1 
</p>
</li>
<li><p> n1 - total number of subjects allocated in stage 1
</p>
</li>
<li><p> all_nttp - all observed nTTP values
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Number of pre-specified dose levels
dose &lt;- 6      

# Acceptable (p2) and unacceptable nTTP values
p1 &lt;- 0.35                                     
p2 &lt;- 0.10     

# Likelihood-ratio (LR) threshold
K &lt;- 2                                          

# Cohort size used in stage 1
coh.size &lt;- 3 

# Number of toxicity types
ntox &lt;- 3

# Standard deviation of nTTP values
std.nTTP = 0.15

# Toxicity burden weight matrix
W = matrix(c(0, 0.5, 0.75, 1.0, 1.5, # Burden weight for grades 0-4 for toxicity 1
             0, 0.5, 0.75, 1.0, 1.5, # Burden weight for grades 0-4 for toxicity 2
             0, 0.00, 0.00, 0.5, 1), # Burden weight for grades 0-4 for toxicity 3
           nrow = ntox, byrow = TRUE)
           
# Array of toxicity event probabilities
TOX &lt;- array(NA, c(dose, 5, ntox)) 

TOX[, , 1] = matrix(c(0.823, 0.152, 0.022, 0.002, 0.001,
                      0.791, 0.172, 0.032, 0.004, 0.001,
                      0.758, 0.180, 0.043, 0.010, 0.009,
                      0.685, 0.190, 0.068, 0.044, 0.013,
                      0.662, 0.200, 0.078, 0.046, 0.014,
                      0.605, 0.223, 0.082, 0.070, 0.020),
                      nrow = 6, byrow = TRUE)
TOX[, , 2] = matrix(c(0.970, 0.027, 0.002, 0.001, 0.000,
                      0.968, 0.029, 0.002, 0.001, 0.000,
                      0.813, 0.172, 0.006, 0.009, 0.000,
                      0.762, 0.183, 0.041, 0.010, 0.004,
                      0.671, 0.205, 0.108, 0.011, 0.005,
                      0.397, 0.258, 0.277, 0.060, 0.008),
                      nrow = 6, byrow = TRUE)
TOX[, , 3] = matrix(c(0.930, 0.060, 0.005, 0.001, 0.004,
                      0.917, 0.070, 0.007, 0.001, 0.005,
                      0.652, 0.280, 0.010, 0.021, 0.037,
                      0.536, 0.209, 0.031, 0.090, 0.134,
                      0.015, 0.134, 0.240, 0.335, 0.276,
                      0.005, 0.052, 0.224, 0.372, 0.347),
                      nrow = 6, byrow = TRUE)

safe.dose.nTTP(dose = dose, p1 = p1, p2 = p2, K = K, coh.size = coh.size, 
W = W, TOX = TOX, ntox = ntox, std.nTTP = std.nTTP) 


</code></pre>

<hr>
<h2 id='sim.plot'>Generate plots for estimated percent allocation and response per dose.</h2><span id='topic+sim.plot'></span>

<h3>Description</h3>

<p>Generate plots for estimated percent allocation and response per dose.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim.plot(sims)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sim.plot_+3A_sims">sims</code></td>
<td>
<p>output from sim.trials</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Error plots of estimated (1) percent allocation per dose, and 
(2) estimated response per dose.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Number of pre-specified dose levels
dose &lt;- 5 

# Vector of true toxicities associated with each dose
dose.tox &lt;- c(0.05, 0.10, 0.20, 0.35, 0.45)       

# Acceptable (p_yes) and unacceptable (p_no) DLT rates used for establishing safety
p_no &lt;- 0.40                                     
p_yes &lt;- 0.15    

# Likelihood-ratio (LR) threshold
K &lt;- 2                                          

# Cohort size used in stage 1
coh.size &lt;- 3 

# Vector of true mean efficacies per dose (here mean T-cell persistence per dose (%))
m &lt;- c(5, 15, 40, 65, 80)   # MUST BE THE SAME LENGTH AS dose.tox                  

# Efficacy (equal) variance per dose
v &lt;- rep(0.01, 5) 

# Total sample size (stages 1&amp;2)                            
N &lt;- 25                                        

# Stopping rule
stop.rule &lt;- 9   


numsims = 100

set.seed(1)
simulations = sim.trials(numsims = numsims, dose, dose.tox, p1 = p_no, p2 = p_yes, 
                         K, coh.size, m, v, N, stop.rule = stop.rule, cohort = 1, 
                         samedose = TRUE, nbb = 100)
                         
# sim.plot(simulations)

</code></pre>

<hr>
<h2 id='sim.summary'>Visualize simulation results (Stages 1&amp;2)</h2><span id='topic+sim.summary'></span>

<h3>Description</h3>

<p>Results from simulated trials (using <code>sim.trials()</code> function) 
displayed in tabular and/or graphical format
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim.summary(sims, print = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sim.summary_+3A_sims">sims</code></td>
<td>
<p>output from sim.trials</p>
</td></tr>
<tr><td><code id="sim.summary_+3A_print">print</code></td>
<td>
<p>logical specifying whether to print tables in console</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Printed tables and a list of the following objects:
</p>

<ul>
<li><p> pct.treated - IQR (25th percentile, median, 75th percentile) of 
percent of subjects treated at each dose level
</p>
</li>
<li><p> efficacy - IQR of efficacy observed at each dose level
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Number of pre-specified dose levels
dose &lt;- 5

# Vector of true toxicities associated with each dose
dose.tox &lt;- c(0.05, 0.10, 0.20, 0.35, 0.45)      
 
# Acceptable (p_yes) and unacceptable (p_no) DLT rates used for establishing safety
p_no &lt;- 0.40                                     
p_yes &lt;- 0.15    

# Likelihood-ratio (LR) threshold
K &lt;- 2                                          

# Cohort size used in stage 1
coh.size &lt;- 3 

# Vector of true mean efficacies per dose (here mean percent persistence per dose)
m &lt;- c(5, 15, 40, 65, 80)   # MUST BE THE SAME LENGTH AS dose.tox                  

# Efficacy(equal) variance per dose
v &lt;- rep(0.01, 5) 

# Total sample size (stages 1&amp;2)                            
N &lt;- 25                                        

# Stopping rule: if dose 1 is the only safe dose, allocate up to 9 pts.
stop.rule &lt;- 9 

simulations = sim.trials(numsims = 100, dose, dose.tox, p1 = p_no, p2 = p_yes, K, 
coh.size, m, v, N, stop.rule = stop.rule, cohort = 1, samedose = TRUE, nbb = 100)

summary = sim.summary(simulations)
 
</code></pre>

<hr>
<h2 id='sim.trials'>Simulate full trial (both stages) x times</h2><span id='topic+sim.trials'></span>

<h3>Description</h3>

<p>Results are displayed in a matrix format, where each row 
represents one trial simulation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim.trials(
  numsims,
  dose,
  dose.tox,
  p1,
  p2,
  K,
  coh.size,
  m,
  v,
  N,
  stop.rule = 9,
  cohort = 1,
  samedose = TRUE,
  nbb = 100
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sim.trials_+3A_numsims">numsims</code></td>
<td>
<p>number of simulated trials</p>
</td></tr>
<tr><td><code id="sim.trials_+3A_dose">dose</code></td>
<td>
<p>number of doses to be tested (scalar)</p>
</td></tr>
<tr><td><code id="sim.trials_+3A_dose.tox">dose.tox</code></td>
<td>
<p>vector of true toxicities for each dose. Values range from 0 - 1.</p>
</td></tr>
<tr><td><code id="sim.trials_+3A_p1">p1</code></td>
<td>
<p>toxicity under null (unsafe DLT rate). Values range from 0 - 1.</p>
</td></tr>
<tr><td><code id="sim.trials_+3A_p2">p2</code></td>
<td>
<p>toxicity under alternative (safe DLT rate). Values range from 0 - 1; p1 &gt; p2</p>
</td></tr>
<tr><td><code id="sim.trials_+3A_k">K</code></td>
<td>
<p>threshold for LR. Takes integer values: 1,2,...(recommended K=2)</p>
</td></tr>
<tr><td><code id="sim.trials_+3A_coh.size">coh.size</code></td>
<td>
<p>cohort size (number of patients) per dose (Stage 1)</p>
</td></tr>
<tr><td><code id="sim.trials_+3A_m">m</code></td>
<td>
<p>vector of mean efficacies per dose. Values range from 0 - 100. 
(e.g, T cell persistence - values b/w 5 and 80 per cent)</p>
</td></tr>
<tr><td><code id="sim.trials_+3A_v">v</code></td>
<td>
<p>vector of efficacy variances per dose. Values range from 0 - 1. (e.g., 0.01)</p>
</td></tr>
<tr><td><code id="sim.trials_+3A_n">N</code></td>
<td>
<p>total sample size for stages 1&amp;2</p>
</td></tr>
<tr><td><code id="sim.trials_+3A_stop.rule">stop.rule</code></td>
<td>
<p>if only dose 1 safe, allocate up to 9 (default) patients at dose 1 
to collect more info.</p>
</td></tr>
<tr><td><code id="sim.trials_+3A_cohort">cohort</code></td>
<td>
<p>cohort size (number of patients) per dose (Stage 2). Default is 1.</p>
</td></tr>
<tr><td><code id="sim.trials_+3A_samedose">samedose</code></td>
<td>
<p>designates whether the next patient is allocated to the same dose 
as the previous patient. Default is TRUE. Function adjusts accordingly.</p>
</td></tr>
<tr><td><code id="sim.trials_+3A_nbb">nbb</code></td>
<td>
<p>binomial parameter (default = 100 cells per patient)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of the following objects:
</p>

<ul>
<li><p> sim.Y - estimated efficacy per each dose assignment 
</p>
</li>
<li><p> sim.d - dose assignment for each patient in the trial 
</p>
</li>
<li><p> safe.d - indicator of whether dose was declared safe
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Number of pre-specified dose levels
dose &lt;- 5

# Vector of true toxicities associated with each dose
dose.tox &lt;- c(0.05, 0.10, 0.20, 0.35, 0.45)       

# Acceptable (p_yes) and unacceptable (p_no) DLT rates used for establishing safety
p_no &lt;- 0.40                                     
p_yes &lt;- 0.15    

# Likelihood-ratio (LR) threshold
K &lt;- 2                                          

# Cohort size used in stage 1
coh.size &lt;- 3 

# Vector of true mean efficacies per dose (here mean percent persistence per dose)
m &lt;- c(5, 15, 40, 65, 80)   # MUST BE THE SAME LENGTH AS dose.tox                  

# Efficacy(equal) variance per dose
v &lt;- rep(0.01, 5) 

# Total sample size (stages 1&amp;2)                            
N &lt;- 25                                        

# Stopping rule: if dose 1 is the only safe dose, allocate up to 9 pts.
stop.rule &lt;- 9 

sim.trials(numsims = 10, dose, dose.tox, p1 = p_no, p2 = p_yes, K, 
coh.size, m, v, N, stop.rule = stop.rule, cohort = 1, samedose = TRUE, nbb = 100)

</code></pre>

<hr>
<h2 id='sim.trials.nTTP'>Simulate full trial (both stages) x times when using nTTP to measure toxicity</h2><span id='topic+sim.trials.nTTP'></span>

<h3>Description</h3>

<p>Results are displayed in a matrix format, where each row represents one 
trial simulation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim.trials.nTTP(
  numsims,
  dose,
  p1,
  p2,
  K,
  coh.size,
  m,
  v,
  N,
  stop.rule = 9,
  cohort = 1,
  samedose = TRUE,
  nbb = 100,
  W,
  TOX,
  ntox,
  std.nTTP = 0.15
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sim.trials.nTTP_+3A_numsims">numsims</code></td>
<td>
<p>number of simulated trials</p>
</td></tr>
<tr><td><code id="sim.trials.nTTP_+3A_dose">dose</code></td>
<td>
<p>number of doses to be tested (scalar)</p>
</td></tr>
<tr><td><code id="sim.trials.nTTP_+3A_p1">p1</code></td>
<td>
<p>toxicity under null (unsafe nTTP). Values range from 0 - 1.</p>
</td></tr>
<tr><td><code id="sim.trials.nTTP_+3A_p2">p2</code></td>
<td>
<p>toxicity under alternative (safe nTTP). Values range from 0 - 1; p1 &gt; p2</p>
</td></tr>
<tr><td><code id="sim.trials.nTTP_+3A_k">K</code></td>
<td>
<p>threshold for LR. Takes integer values: 1,2,...(recommended K=2)</p>
</td></tr>
<tr><td><code id="sim.trials.nTTP_+3A_coh.size">coh.size</code></td>
<td>
<p>cohort size (number of patients) per dose (Stage 1)</p>
</td></tr>
<tr><td><code id="sim.trials.nTTP_+3A_m">m</code></td>
<td>
<p>vector of mean efficacies per dose. Values range from 0 - 100. 
(e.g, T cell persistence - values b/w 5 and 80 per cent)</p>
</td></tr>
<tr><td><code id="sim.trials.nTTP_+3A_v">v</code></td>
<td>
<p>vector of efficacy variances per dose. Values range from 0 - 1. (e.g., 0.01)</p>
</td></tr>
<tr><td><code id="sim.trials.nTTP_+3A_n">N</code></td>
<td>
<p>total sample size for stages 1&amp;2</p>
</td></tr>
<tr><td><code id="sim.trials.nTTP_+3A_stop.rule">stop.rule</code></td>
<td>
<p>if only dose 1 safe, allocate up to 9 (default) patients at dose 1 
to collect more info</p>
</td></tr>
<tr><td><code id="sim.trials.nTTP_+3A_cohort">cohort</code></td>
<td>
<p>cohort size (number of patients) per dose (Stage 2). Default is 1.</p>
</td></tr>
<tr><td><code id="sim.trials.nTTP_+3A_samedose">samedose</code></td>
<td>
<p>designates whether the next patient is allocated to the same dose as 
the previous patient. Default is TRUE. Function adjusts accordingly.</p>
</td></tr>
<tr><td><code id="sim.trials.nTTP_+3A_nbb">nbb</code></td>
<td>
<p>binomial parameter (default = 100 cells per patient)</p>
</td></tr>
<tr><td><code id="sim.trials.nTTP_+3A_w">W</code></td>
<td>
<p>matrix defining burden weight of each grade level for all toxicity types. 
The dimensions are ntox rows by 4 columns (for grades 0-4). 
See Ezzalfani et al. (2013) for details.</p>
</td></tr>
<tr><td><code id="sim.trials.nTTP_+3A_tox">TOX</code></td>
<td>
<p>matrix array of toxicity probabilities. There should be ntox matrices. 
Each matrix represents one toxicity type, where probabilities of each toxicity grade 
are specified across each dose. Each matrix has the same dimensions: n rows, representing 
number of doses, and 5 columns (for grades 0-4). 
Probabilities across each dose (rows) must sum to 1. 
See Ezzalfani et al. (2013) for details.</p>
</td></tr>
<tr><td><code id="sim.trials.nTTP_+3A_ntox">ntox</code></td>
<td>
<p>number (integer) of different toxicity types</p>
</td></tr>
<tr><td><code id="sim.trials.nTTP_+3A_std.nttp">std.nTTP</code></td>
<td>
<p>the standard deviation of nTTP scores at each dose level (constant across doses)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of the following objects:
</p>

<ul>
<li><p> sim.Y - estimated efficacy per each dose assignment 
</p>
</li>
<li><p> sim.d - dose assignment for each patient in the trial 
</p>
</li>
<li><p> safe.d - indicator of whether dose was declared safe
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Number of pre-specified dose levels
dose &lt;- 6     
 
# Acceptable (p2) and unacceptable nTTP values
p1 &lt;- 0.35                                     
p2 &lt;- 0.10     

# Likelihood-ratio (LR) threshold
K &lt;- 2                                          

# Cohort size used in stage 1
coh.size &lt;- 3 

# Total sample size (stages 1&amp;2)                            
N &lt;- 25 

# Efficacy (equal) variance per dose
v &lt;- rep(0.01, 6)

# Dose-efficacy curve
m = c(10, 20, 30, 40, 70, 90)

# Number of toxicity types
ntox = 3

# Toxicity burden weight matrix
W = matrix(c(0, 0.5, 0.75, 1.0, 1.5, # Burden weight for grades 0-4 for toxicity 1
             0, 0.5, 0.75, 1.0, 1.5, # Burden weight for grades 0-4 for toxicity 2
             0, 0.00, 0.00, 0.5, 1), # Burden weight for grades 0-4 for toxicity 3
           nrow = ntox, byrow = TRUE)
           


# Standard deviation of nTTP values
std.nTTP = 0.15

# Array of toxicity event probabilities
TOX = array(NA, c(dose, 5, ntox)) 

TOX[, , 1] = matrix(c(0.823, 0.152, 0.022, 0.002, 0.001,
                      0.791, 0.172, 0.032, 0.004, 0.001,
                      0.758, 0.180, 0.043, 0.010, 0.009,
                      0.685, 0.190, 0.068, 0.044, 0.013,
                      0.662, 0.200, 0.078, 0.046, 0.014,
                      0.605, 0.223, 0.082, 0.070, 0.020),
                    nrow = 6, byrow = TRUE)
TOX[, , 2] = matrix(c(0.970, 0.027, 0.002, 0.001, 0.000,
                      0.968, 0.029, 0.002, 0.001, 0.000,
                      0.813, 0.172, 0.006, 0.009, 0.000,
                      0.762, 0.183, 0.041, 0.010, 0.004,
                      0.671, 0.205, 0.108, 0.011, 0.005,
                      0.397, 0.258, 0.277, 0.060, 0.008),
                    nrow = 6, byrow = TRUE)
TOX[, , 3] = matrix(c(0.930, 0.060, 0.005, 0.001, 0.004,
                      0.917, 0.070, 0.007, 0.001, 0.005,
                      0.652, 0.280, 0.010, 0.021, 0.037,
                      0.536, 0.209, 0.031, 0.090, 0.134,
                      0.015, 0.134, 0.240, 0.335, 0.276,
                      0.005, 0.052, 0.224, 0.372, 0.347),
                    nrow = 6, byrow = TRUE)

sim.trials.nTTP(numsims = 10, dose = dose, p1 = p1, p2 = p2, K = K, 
coh.size = coh.size, m = m, v = v, N = N, stop.rule = 9, cohort = 1, 
samedose = TRUE, nbb = 100, W = W, TOX = TOX, ntox = ntox, std.nTTP = std.nTTP)

</code></pre>

<hr>
<h2 id='TOX'>
Sample array of toxicity probabilities for 6 doses. Taken from Du et al.
</h2><span id='topic+TOX'></span>

<h3>Description</h3>

<p>This is a sample array of toxicity probabilities to be used for trial simulations with nTTP as the toxicity endpoint. In this example, we have 3 toxicity types, 6 test doses, and 5 AE grades (0-4). See the nTTP_simulation_example vignette for more details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("TOX")</code></pre>


<h3>Format</h3>

<p>The format is:
num [1:6, 1:5, 1:3] 0.791 0.738 0.685 0.662 0.605 0.39 0.172 0.195 0.19 0.2 ...
</p>


<h3>Source</h3>

<p>https://pubmed.ncbi.nlm.nih.gov/30403559/
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(TOX)
TOX
</code></pre>

<hr>
<h2 id='tox.profile'>Generates DLTs and calculates the likelihood-ratio (LR) for each dose</h2><span id='topic+tox.profile'></span>

<h3>Description</h3>

<p>Gives toxicity profile (number of dose-limiting toxicities) 
and likelihood ratio per dose based on binary toxicity.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tox.profile(dose, dose.tox, p1, p2, K, coh.size)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tox.profile_+3A_dose">dose</code></td>
<td>
<p>number of doses to be tested (scalar)</p>
</td></tr>
<tr><td><code id="tox.profile_+3A_dose.tox">dose.tox</code></td>
<td>
<p>vector of true toxicities for each dose. Values range from 0 - 1.</p>
</td></tr>
<tr><td><code id="tox.profile_+3A_p1">p1</code></td>
<td>
<p>toxicity under null (unsafe DLT rate). Values range from 0 - 1.</p>
</td></tr>
<tr><td><code id="tox.profile_+3A_p2">p2</code></td>
<td>
<p>toxicity under alternative (safe DLT rate). Values range from 0 - 1; p1 &gt; p2</p>
</td></tr>
<tr><td><code id="tox.profile_+3A_k">K</code></td>
<td>
<p>threshold for LR. Takes integer values: 1,2,...(recommended K=2)</p>
</td></tr>
<tr><td><code id="tox.profile_+3A_coh.size">coh.size</code></td>
<td>
<p>cohort size (number of patients) per dose (Stage 1)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>4-column matrix containing dose assignment, dose-limiting toxicities at each dose, 
cohort number, and likelihood ratio.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Number of pre-specified dose levels
dose &lt;- 5
# Vector of true toxicities associated with each dose
dose.tox &lt;- c(0.05, 0.10, 0.20, 0.35, 0.45)       
# Acceptable (p2) and unacceptable (p1) DLT rates used for establishing safety
p1 &lt;- 0.40                                     
p2 &lt;- 0.15    

# Likelihood-ratio (LR) threshold
K &lt;- 2                                          

# Cohort size used in stage 1
coh.size &lt;- 3 

# Stopping rule: if dose 1 is the only safe dose, allocate up to 9 pts.
stop.rule &lt;- 9 

tox.profile(dose = dose, dose.tox = dose.tox, p1 = p1, p2 = p2, K = K, coh.size = coh.size)


</code></pre>

<hr>
<h2 id='tox.profile.nTTP'>Generate nTTPs toxicity scores and the likelihhood-ratio (LR) per dose</h2><span id='topic+tox.profile.nTTP'></span>

<h3>Description</h3>

<p>The normalized total toxicity profiles (nTTP) are calculated by 
combining multiple toxicity grades and their weights. The nTTPs are considered 
a quasi-continuous toxicity measure that follows a normal distribution truncated to [0, 1].
The likelihood ratio per dose are based on nTTP toxicity.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tox.profile.nTTP(dose, p1, p2, K, coh.size, ntox, W, TOX, std.nTTP = 0.15)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tox.profile.nTTP_+3A_dose">dose</code></td>
<td>
<p>number of doses to be tested (scalar)</p>
</td></tr>
<tr><td><code id="tox.profile.nTTP_+3A_p1">p1</code></td>
<td>
<p>toxicity under null (unsafe nTTP). Values range from 0 - 1.</p>
</td></tr>
<tr><td><code id="tox.profile.nTTP_+3A_p2">p2</code></td>
<td>
<p>toxicity under alternative (safe nTTP). Values range from 0 - 1; p1 &gt; p2</p>
</td></tr>
<tr><td><code id="tox.profile.nTTP_+3A_k">K</code></td>
<td>
<p>threshold for LR. Takes integer values: 1,2,...(recommended K=2)</p>
</td></tr>
<tr><td><code id="tox.profile.nTTP_+3A_coh.size">coh.size</code></td>
<td>
<p>cohort size (number of patients) per dose (Stage 1)</p>
</td></tr>
<tr><td><code id="tox.profile.nTTP_+3A_ntox">ntox</code></td>
<td>
<p>number (integer) of different toxicity types (e.g, hematological, neurological, GI)</p>
</td></tr>
<tr><td><code id="tox.profile.nTTP_+3A_w">W</code></td>
<td>
<p>matrix defines burden weight of each grade level for all toxicity types. 
The dimensions are ntox rows by 5 columns (for grades 0-4). See Ezzalfani et al. (2013) for details.</p>
</td></tr>
<tr><td><code id="tox.profile.nTTP_+3A_tox">TOX</code></td>
<td>
<p>matrix array of toxicity probabilities. There should be ntox matrices. 
Each matrix represents one toxicity type, where probabilities of each toxicity grade 
are specified across each dose. Each matrix has the same dimensions: n rows, representing 
number of doses, and 5 columns (for grades 0-4). Probabilities across each dose (rows) must sum to 1. 
See Ezzalfani et al. (2013) for details.</p>
</td></tr>
<tr><td><code id="tox.profile.nTTP_+3A_std.nttp">std.nTTP</code></td>
<td>
<p>the standard deviation of nTTP scores at each dose level (constant across doses)</p>
</td></tr>
</table>


<h3>Value</h3>


<ul>
<li><p> mnTTP - 4-column matrix containing dose assignment, mean nTTP at each dose, 
cohort number, and likelihood ratio.
</p>
</li>
<li><p> all_nttp - all observed nTTP values
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'># Number of pre-specified dose levels
dose &lt;- 6  
    
# Acceptable (p2) and unacceptable nTTP values
p1 &lt;- 0.35                                     
p2 &lt;- 0.10    

# Likelihood-ratio (LR) threshold
K &lt;- 2                                          

# Cohort size used in stage 1
coh.size &lt;- 3 

# Number of toxicity types
ntox &lt;- 3

# Standard deviation of nTTP values
std.nTTP = 0.15
 
# Toxicity burden weight matrix
W = matrix(c(0, 0.5, 0.75, 1.0, 1.5, # Burden weight for grades 0-4 for toxicity 1
             0, 0.5, 0.75, 1.0, 1.5, # Burden weight for grades 0-4 for toxicity 2
             0, 0.00, 0.00, 0.5, 1), # Burden weight for grades 0-4 for toxicity 3
             nrow = ntox, byrow = TRUE)
           

# Array of toxicity event probabilities
TOX = array(NA, c(dose, 5, ntox)) 

TOX[, , 1] = matrix(c(0.823, 0.152, 0.022, 0.002, 0.001,  #prob of tox for dose 1 and tox type 1
                      0.791, 0.172, 0.032, 0.004, 0.001,  #prob of tox for dose 2 and tox type 1
                      0.758, 0.180, 0.043, 0.010, 0.009,  #prob of tox for dose 3 and tox type 1
                      0.685, 0.190, 0.068, 0.044, 0.013,  #prob of tox for dose 4 and tox type 1
                      0.662, 0.200, 0.078, 0.046, 0.014,  #prob of tox for dose 5 and tox type 1
                      0.605, 0.223, 0.082, 0.070, 0.020), #prob of tox for dose 6 and tox type 1
                      nrow = 6, byrow = TRUE)
TOX[, , 2] = matrix(c(0.970, 0.027, 0.002, 0.001, 0.000,  #prob of tox for dose 1 and tox type 2
                      0.968, 0.029, 0.002, 0.001, 0.000,  #prob of tox for dose 2 and tox type 2
                      0.813, 0.172, 0.006, 0.009, 0.000,  #prob of tox for dose 3 and tox type 2
                      0.762, 0.183, 0.041, 0.010, 0.004,  #prob of tox for dose 4 and tox type 2
                      0.671, 0.205, 0.108, 0.011, 0.005,  #prob of tox for dose 5 and tox type 2
                      0.397, 0.258, 0.277, 0.060, 0.008), #prob of tox for dose 6 and tox type 2
                      nrow = 6, byrow = TRUE)
TOX[, , 3] = matrix(c(0.930, 0.060, 0.005, 0.001, 0.004,  #prob of tox for dose 1 and tox type 3
                      0.917, 0.070, 0.007, 0.001, 0.005,  #prob of tox for dose 2 and tox type 3
                      0.652, 0.280, 0.010, 0.021, 0.037,  #prob of tox for dose 3 and tox type 3
                      0.536, 0.209, 0.031, 0.090, 0.134,  #prob of tox for dose 4 and tox type 3
                      0.015, 0.134, 0.240, 0.335, 0.276,  #prob of tox for dose 5 and tox type 3
                      0.005, 0.052, 0.224, 0.372, 0.347), #prob of tox for dose 6 and tox type 3
                      nrow = 6, byrow = TRUE)

tox.profile.nTTP(dose = dose, 
p1 = p1, 
p2 = p2, 
K = K, 
coh.size = coh.size, 
ntox = ntox, 
W = W, 
TOX = TOX, 
std.nTTP = std.nTTP)


</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
