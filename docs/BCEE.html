<!DOCTYPE html><html><head><title>Help for package BCEE</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {BCEE}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#ABCEE'>
<p>Approximate BCEE Implementation</p></a></li>
<li><a href='#BCEE-package'>
<p>The Bayesian Causal Effect Estimation (BCEE) Algorithm</p></a></li>
<li><a href='#GBCEE'>
<p>Generalized BCEE algorithm</p></a></li>
<li><a href='#NBCEE'>
<p>Naive BCEE Implementation</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>The Bayesian Causal Effect Estimation Algorithm</td>
</tr>
<tr>
<td>Version:</td>
<td>1.3.2</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-10-10</td>
</tr>
<tr>
<td>Author:</td>
<td>Denis Talbot, Genevieve Lefebvre, Juli Atherton, Yohann Chiu.</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Denis Talbot &lt;denis.talbot@fmed.ulaval.ca&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>A Bayesian model averaging approach to causal effect estimation
    based on the BCEE algorithm. Currently supports binary or continuous
    exposures and outcomes. For more details, see 
    Talbot et al. (2015) &lt;<a href="https://doi.org/10.1515%2Fjci-2014-0035">doi:10.1515/jci-2014-0035</a>&gt;
    Talbot and Beaudoin (2022) &lt;<a href="https://doi.org/10.1515%2Fjci-2021-0023">doi:10.1515/jci-2021-0023</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Imports:</td>
<td>Rcpp (&ge; 0.12.12)</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo</td>
</tr>
<tr>
<td>Depends:</td>
<td>BMA, leaps, boot, methods</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-10-10 21:51:22 UTC; denis</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-10-10 22:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='ABCEE'>
Approximate BCEE Implementation
</h2><span id='topic+ABCEE'></span>

<h3>Description</h3>

<p>A-BCEE implementation of the BCEE algorithm. This function supports exposures that can be modeled with generalized linear models (e.g., binary, continuous or Poisson), but only continuous outcomes. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ABCEE(X, Y, U, omega, forX = NA, niter = 5000, nburn = 500, nthin = 10,
 maxmodelY = NA, OR = 20, family.X = "gaussian")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ABCEE_+3A_x">X</code></td>
<td>
<p>A vector of observed values for the exposure.
</p>
</td></tr>
<tr><td><code id="ABCEE_+3A_y">Y</code></td>
<td>
<p>A vector of observed values for the continuous outcome.
</p>
</td></tr>
<tr><td><code id="ABCEE_+3A_u">U</code></td>
<td>
<p>A matrix of observed values for the <code>M</code> potential confounding covariates, where each column contains observed values for a potential confounding factor. A recommended implementation is to only consider pre-exposure covariates.
</p>
</td></tr>
<tr><td><code id="ABCEE_+3A_omega">omega</code></td>
<td>
<p>The value of the hyperparameter omega in the BCEE's outcome model prior distribution. A recommended implementation is to take <code>omega</code><code> = </code><code>sqrt(n)*c</code>, where <code>n</code> is the sample size and <code>c</code> is a user-supplied constant value. Simulation studies suggest that values of <code>c</code> between 100 and 1000 yield good results. 
</p>
</td></tr>
<tr><td><code id="ABCEE_+3A_forx">forX</code></td>
<td>

<p>A Boolean vector of size <code>M</code>, where the <code>m</code>th element indicates whether or not the <code>m</code>th potential confounding covariate should be considered in the exposure modeling step of the BCEE algorithm. The default for <code>forX</code> is <code>NA</code>, which indicates that all potential confounding covariates should be considered in the exposure modeling step. 
</p>
</td></tr>
<tr><td><code id="ABCEE_+3A_niter">niter</code></td>
<td>
<p>The number of post burn-in iterations in the Markov chain Monte Carlo model composition (MC^3) algorithm (Madigan et al. 1995), prior to applying thinning. The default is 5000, but users should ensure that the value is large enough so that the number of retained samples can provide good inferences. 
</p>
</td></tr>
<tr><td><code id="ABCEE_+3A_nburn">nburn</code></td>
<td>

<p>The number of burn-in iterations (prior to applying thinning). The default is 500, but users should ensure that the value is large enough so that convergence of the chain is reached. An example of diagnostics of convergence of the chain is provided below.
</p>
</td></tr>
<tr><td><code id="ABCEE_+3A_nthin">nthin</code></td>
<td>

<p>The thinning of the chain. The default is 10, but users should ensure that the value is large enough so that there is no auto-correlation between sampled values. An example of diagnostics of absence of auto-correlation is provided below.
</p>
</td></tr>
<tr><td><code id="ABCEE_+3A_maxmodely">maxmodelY</code></td>
<td>

<p>The maximum number of distinct outcome models that the algorithm can explore. Choosing a smaller value can shorten computing time. However, choosing a value that is too small will cause the algorithm to crash and return an error message. The default is <code>NA</code>; the maximum number of outcome models that can be explored is then set to the minimum of <code>niter + nburn</code> and <code>2^M</code>.  
</p>
</td></tr>
<tr><td><code id="ABCEE_+3A_or">OR</code></td>
<td>

<p>A number specifying the maximum ratio for excluding models in Occam's window for the exposure modeling step (see the <code>bic.glm</code> help file, and Madigan &amp; Raftery, 1994). The default is 20.  
</p>
</td></tr>
<tr><td><code id="ABCEE_+3A_family.x">family.X</code></td>
<td>

<p>A description of the error distribution and link function to be used in the model. This can be a character string naming a family function, a family function or the result of a call to a family function. (See <code><a href="stats.html#topic+family">family</a></code> for details of family functions.) The default is <code>"gaussian"</code>
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>ABCEE</code> function first computes the exposure model's posterior distribution using the <code>bic.glm</code> function if the number of covariates is smaller than 50. Otherwise, the exact procedures depends on the value of <code>family.X</code>. The outcome model's posterior distribution is then computed using MC^3 (Madigan et al., 1995) as described in Talbot et al. (2015).
</p>
<p><code>ABCEE</code> assumes there are no missing values in the objects <code>X</code>, <code>Y</code> and <code>U</code>. The <code>na.omit</code> function which removes cases with missing data or an imputation package might be helpful.
</p>


<h3>Value</h3>

<table>
<tr><td><code>betas</code></td>
<td>
<p>A vector containing the sampled values for the exposure effect.</p>
</td></tr> 
<tr><td><code>models.X</code></td>
<td>
<p>A matrix giving the posterior distribution of the exposure model. Each row corresponds to an exposure model. Within each row, the first <code>M</code> elements are Booleans indicating the inclusion (1) or the exclusion (0) of each potential confounding factor. The last element gives the posterior probability of the exposure model.</p>
</td></tr>
<tr><td><code>models.Y</code></td>
<td>
<p>A Boolean matrix identifying the sampled outcome models. Each row corresponds to a sampled outcome model. Within each row, the <code>m</code>th element equals 1 if and only if the <code>m</code>th potential confounding covariate is included in the sampled outcome model (and 0 otherwise).</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Denis Talbot, Yohann Chiu, Genevieve Lefebvre, Juli Atherton.
</p>


<h3>References</h3>

<p>Madigan, D., York, J., Allard, D. (1995) <em>Bayesian graphical models for discrete data</em>, International Statistical Review, 63, 215-232.
</p>
<p>Madigan, D., Raftery, A. E. (1994) <em>Model selection and accounting for model uncertainty in graphical models using Occam's window</em>, Journal of the American Statistical Association, 89 (428), 1535-1546.
</p>
<p>Talbot, D., Lefebvre, G., Atherton, J. (2015) <em>The Bayesian causal effect estimation algorithm</em>, Journal of Causal Inference, 3(2), 207-236.
</p>


<h3>See Also</h3>

<p><code><a href="BMA.html#topic+bic.glm">bic.glm</a></code>, <code><a href="stats.html#topic+na.omit">na.omit</a></code>, <code><a href="#topic+NBCEE">NBCEE</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#Example:
#In this example, both U1 and U2 are potential confounding covariates.
#Both are generated as independent N(0,1).
#X is generated as a function of both U1 and U2 with a N(0,1) error.
#Y is generated as a function of X and U1 with a N(0,1) error.
#Thus, only U1 is a confounder.
#The causal effect of X on Y equals 1. 
#The parameter beta associated to exposure in the outcome model
#that includes U1 and the one from the full outcome model is an
#unbiased estimator of the effect of X on Y.

#Generating the data
set.seed(418949); 
U1 = rnorm(200); 
U2 = rnorm(200);
X = 0.5*U1 + 1*U2 + rnorm(200);
Y = 1*X + 0.5*U1 + rnorm(200);

#Using ABCEE to estimate the causal exposure effect
results = ABCEE(X,Y,cbind(U1,U2), omega = 500*sqrt(200), niter = 10000, nthin = 5, nburn = 500);

##Diagnostics of convergence of the chain:
plot.default(results$betas, type = "l");
lines(smooth.spline(1:length(results$beta), results$beta), col = "blue", lwd = 2);
#The plot shows no apparent trend.
#The smoothing curve confirms that there is little or no trend,
#suggesting the chain has indeed converged before burn-in iterations ended.
#Otherwise, the value of nburn should be increased.

##Diagnostics of absence of auto-correlation
acf(results$betas, main = "ACF plot");
#Most lines are within the confidence intervals' limits, which suggests
#that there is no residual auto-correlation. If there were, the value
#of nthin should be increased.

##The number of sampled values is niter/nthin = 2000, which should be
##large enough to provide good inferences for 95% confidence intervals.

#The posterior mean of the exposure effect:
mean(results$betas);
#The posterior standard deviation of the exposure effect:
sd(results$betas);
#The posterior inclusion probability of each covariate:
colMeans(results$models.Y);
#The posterior distribution of the outcome model:
table(apply(results$models.Y, 1, paste0, collapse = ""));

</code></pre>

<hr>
<h2 id='BCEE-package'>
The Bayesian Causal Effect Estimation (BCEE) Algorithm</h2><span id='topic+BCEE-package'></span><span id='topic+BCEE'></span>

<h3>Description</h3>

<p>A Bayesian model averaging approach to causal effect estimation
based on the BCEE algorithm. Currently supports binary or continuous
exposures and outcomes. For more details, see: 
Talbot et al. (2015) DOI:10.1515/jci-2014-0035,
Talbot and Beaudoin (2023) DOI:10.1515/jci-2021-0023.  
</p>


<h3>Details</h3>

<p>ABCEE(X, Y, U, omega), <br />
NBCEE(X, Y, U, omega), <br />
GBCEE(X, Y, U, omega)
</p>


<h3>Author(s)</h3>

<p>Denis Talbot, Genevieve Lefebvre, Juli Atherton, Yohann Chiu.
</p>
<p>Maintainer: Denis Talbot <a href="mailto:denis.talbot@fmed.ulaval.ca">denis.talbot@fmed.ulaval.ca</a>
</p>


<h3>References</h3>

<p>Talbot, D., Lefebvre, G., Atherton, J. (2015) <em>The Bayesian causal effect estimation algorithm</em>, Journal of Causal Inference, 3(2), 207-236.\
Talbot, D., Beaudoin, C (2022) <em>A generalized double robust Bayesian model averaging approach to causal effect estimation with application to the Study of Osteoporotic Fractures</em>, Journal of Causal Inference, 10(1), 335-371.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ABCEE">ABCEE</a></code>, <code><a href="#topic+NBCEE">NBCEE</a></code>, <code><a href="#topic+GBCEE">GBCEE</a></code>.
</p>

<hr>
<h2 id='GBCEE'>
Generalized BCEE algorithm
</h2><span id='topic+GBCEE'></span>

<h3>Description</h3>

<p>A generalized double robust Bayesian model averaging approach to causal effect estimation. This function accommodates both binary and continuous exposures and outcomes. More details are available in Talbot and Beaudoin (2020). 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GBCEE(X, Y, U, omega, niter = 5000, family.X = "gaussian",
 family.Y = "gaussian", X1 = 1, X0 = 0, priorX = NA, priorY = NA, maxsize = NA,
 OR = 20, truncation = c(0.01, 0.99), var.comp = "asymptotic", B = 200, nsampX = 30)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="GBCEE_+3A_x">X</code></td>
<td>
<p>A vector of observed values for the exposure.
</p>
</td></tr>
<tr><td><code id="GBCEE_+3A_y">Y</code></td>
<td>
<p>A vector of observed values for the outcome.
</p>
</td></tr>
<tr><td><code id="GBCEE_+3A_u">U</code></td>
<td>
<p>A matrix of observed values for the <code>M</code> potential confounding covariates, where each column contains observed values for a potential confounding factor. A recommended implementation is to only consider pre-exposure covariates.
</p>
</td></tr>
<tr><td><code id="GBCEE_+3A_omega">omega</code></td>
<td>
<p>The value of the hyperparameter omega in the BCEE's outcome model prior distribution. A recommended implementation is to take <code>omega</code><code> = </code><code>sqrt(n)*c</code>, where <code>n</code> is the sample size and <code>c</code> is a user-supplied constant value. Simulation studies suggest that values of <code>c</code> between 100 and 1000 yield good results. 
</p>
</td></tr>
<tr><td><code id="GBCEE_+3A_niter">niter</code></td>
<td>
<p>The number of iterations in the Markov chain Monte Carlo model composition (MC^3) algorithm (Madigan et al. 1995). The default is 5000, but larger values are recommended when the number of potential confounding covariates is large.
</p>
</td></tr>
<tr><td><code id="GBCEE_+3A_family.x">family.X</code></td>
<td>
<p>Distribution to be used for the exposure model. This should be <code>"gaussian"</code> if the exposure is continuous or <code>"binomial"</code> if the exposure is binary. The default is <code>"gaussian"</code>.
</p>
</td></tr>
<tr><td><code id="GBCEE_+3A_family.y">family.Y</code></td>
<td>
<p>Distribution to be used for the outcome model. This should be <code>"gaussian"</code> if the outcome is continuous or <code>"binomial"</code> if the outcome is binary. The default is <code>"gaussian"</code>.
</p>
</td></tr>
<tr><td><code id="GBCEE_+3A_x1">X1</code></td>
<td>
<p>The value of <code class="reqn">X1</code> for contrasts comparing <code class="reqn">E[Y^{X1}]</code> to <code class="reqn">E[Y^{X0}]</code>.  
</p>
</td></tr>
<tr><td><code id="GBCEE_+3A_x0">X0</code></td>
<td>
<p>The value of <code class="reqn">X0</code> for contrasts comparing <code class="reqn">E[Y^{X1}]</code> to <code class="reqn">E[Y^{X0}]</code>.
</p>
</td></tr>
<tr><td><code id="GBCEE_+3A_priorx">priorX</code></td>
<td>
<p>A vector of length <code>M</code> for the prior probability of inclusion of the potential confounding covariates in the exposure model (<code class="reqn">P(\alpha^X)</code>). The default is 0.5 for all covariates.    
</p>
</td></tr>
<tr><td><code id="GBCEE_+3A_priory">priorY</code></td>
<td>
<p>A vector of length <code>M</code> for the prior probability of inclusion of the potential confounding covariates in the outcome model. This vector multiplies BCEE's informative prior distribution (<code class="reqn">P(\alpha^Y)</code>). The default is 0.5 for all covariates.  
</p>
</td></tr>
<tr><td><code id="GBCEE_+3A_maxsize">maxsize</code></td>
<td>
<p>The maximum number of covariates that can be included in a given exposure or outcome model. The default is <code>M</code>, which does not constrain the models' size.
</p>
</td></tr>
<tr><td><code id="GBCEE_+3A_or">OR</code></td>
<td>
<p>A number specifying the maximum ratio for excluding models in Occam's window for the outcome modeling step. All outcome models whose posterior probability is more than <code>OR</code> times smaller than the largest posterior probability are excluded from the model averaging. The posterior mass of discarded models is redistributed on the remaining models. See Madigan &amp; Raftery, 1994. The default is 20. 
</p>
</td></tr>
<tr><td><code id="GBCEE_+3A_truncation">truncation</code></td>
<td>
<p>A vector of length 2 indicating the smallest and largest values for the estimated propensity score (<code class="reqn">P(X = 1|U)</code>). Values outside those bounds are truncated to the bounds. Some truncation can help reduce the impact of near positivity violations. The default is <code>c(0.01, 0.99)</code>. Currently, no truncation is performed when <code>family.X = "gaussian"</code> and <code>family.Y = "gaussian"</code>. 
</p>
</td></tr>
<tr><td><code id="GBCEE_+3A_var.comp">var.comp</code></td>
<td>
<p>The method for computing the variance of the targeted maximum likelihood estimators in the BCEE algorithm. The possible values are <code>"asymptotic"</code>, for the efficient influence function based estimator, and <code>"boostrap"</code> for the nonparametric bootstrap estimator. The default is <code>"asymptotic"</code>.
</p>
</td></tr>
<tr><td><code id="GBCEE_+3A_b">B</code></td>
<td>
<p>The number of bootstrap samples when estimating the variance using the nonparametric bootstrap. The default is 200. 
</p>
</td></tr>
<tr><td><code id="GBCEE_+3A_nsampx">nsampX</code></td>
<td>
<p>The number of samples to take from the exposure distribution for the Monte Carlo integration when X is continuous and Y is binary. The default is 30. 
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When both <code>Y</code> and <code>X</code> are continuous, <code>GBCEE</code> estimates <code class="reqn">\Delta = E[Y^{x+1}] - E[Y^x]</code>, assuming a linear effect of <code>X</code> on <code>Y</code>. When <code>Y</code> is continuous and <code>X</code> is binary, <code>GBCEE</code> estimates <code class="reqn">\Delta = E[Y^{X1}] - E[Y^{X0}]</code>. When <code>Y</code> and <code>X</code> are binary, <code>GBCEE</code> estimates both <code class="reqn">\Delta = E[Y^{X1}] - E[Y^{X0}]</code> and <code class="reqn">\Delta = E[Y^{X1}]/E[Y^{X0}]</code>. When <code>Y</code> is binary and <code>X</code> is continuous, <code>GBCEE</code> estimates the slope of the logistic marginal structural working model <code class="reqn">logit(E[Y^{x}]) = \beta_0 + \beta_1 x</code>  
</p>
<p>The <code>GBCEE</code> function first computes the exposure model's posterior distribution using a Markov chain Monte Carlo model composition (MC^3) algorithm (Madigan et al. 1995). The outcome model's posterior distribution is then computed using MC^3 (Madigan et al., 1995) as described in Section 3.4 of Talbot and Beaudoin (2022).
</p>
<p><code>GBCEE</code> assumes there are no missing values in the objects <code>X</code>, <code>Y</code> and <code>U</code>. The <code>na.omit</code> function which removes cases with missing data or an imputation package might be helpful.
</p>


<h3>Value</h3>

<table>
<tr><td><code>beta</code></td>
<td>
<p>The model averaged estimate of the causal effect (<code class="reqn">\hat{\Delta}</code>). When <code>Y</code> is <code>"gaussian"</code>, this is <code class="reqn">\Delta = E[Y^{X1}] - E[Y^{X0}]</code>. When both <code>Y</code> and <code>X</code> are <code>"binomial"</code>, <code>Diff</code> is <code class="reqn">\Delta = E[Y^{X1}] - E[Y^{X0}]</code> and <code>RR</code> is <code class="reqn">\Delta = E[Y^{X1}]/E[Y^{X0}]</code>. When <code>Y</code> is <code>"binomial"</code> and <code>X</code> is <code>"gaussian"</code>, <code>b0</code> and <code>b1</code> are the coefficients of the working marginal structural model <code class="reqn">logit(E[Y^{x}]) = \beta_0 + \beta_1 x</code>.</p>
</td></tr> 
<tr><td><code>stderr</code></td>
<td>
<p>The estimated standard error of the causal effect estimate.</p>
</td></tr>
<tr><td><code>models.X</code></td>
<td>
<p>A matrix giving the posterior distribution of the exposure model. Each row corresponds to an exposure model. Within each row, the first <code>M</code> elements are Booleans indicating the inclusion (1) or the exclusion (0) of each potential confounding factor. The last element gives the posterior probability of the exposure model.</p>
</td></tr>
<tr><td><code>models.Y</code></td>
<td>
<p>A matrix giving the posterior distribution of the outcome model after applying the Occam's window. Each row corresponds to an outcome model. Within each row, the first <code>M</code> elements are Booleans indicating the inclusion (1) or the exclusion (0) of each potential confounding factor. The next elements are the corresponding causal effect estimate(s) and standard error(s). The last element gives the posterior probability of the outcome model.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Denis Talbot
</p>


<h3>References</h3>

<p>Madigan, D., York, J., Allard, D. (1995) <em>Bayesian graphical models for discrete data</em>, International Statistical Review, 63, 215-232.
</p>
<p>Madigan, D., Raftery, A. E. (1994) <em>Model selection and accounting for model uncertainty in graphical models using Occam's window</em>, Journal of the American Statistical Association, 89 (428), 1535-1546.
</p>
<p>Talbot, D., Beaudoin, C (2022) <em>A generalized double robust Bayesian model averaging approach to causal effect estimation with application to the Study of Osteoporotic Fractures</em>, Journal of Causal Inference, 10(1), 335-371.
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+na.omit">na.omit</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#Example:
#In this example, both U1 and U2 are potential confounding covariates.
#Both are generated as independent N(0,1).
#X is generated as a function of both U1 and U2 with a N(0,1) error.
#Y is generated as a function of X and U1 with a N(0,1) error.
#Thus, only U1 is a confounder.
#Since both X and Y are continuous, the causal contrast estimated
#by GBCEE is E[Y^{x+1}] - E[Y^{x}] assuming a linear trend.
#The true value of the causal effect is 1. 
#Unbiased estimation is possible when adjusting for U1 or
#adjusting for both U1 and U2.


#Generating the data
set.seed(418949); 
U1 = rnorm(200); 
U2 = rnorm(200);
X = 0.5*U1 + 1*U2 + rnorm(200);
Y = 1*X + 0.5*U1 + rnorm(200);

#Using GBCEE to estimate the causal exposure effect
#Very few iterations are necessary since there are only 2 covariates
results = GBCEE(X,Y,cbind(U1,U2), omega = 500*sqrt(200), niter = 50,
                family.X = "gaussian", family.Y = "gaussian");

#Causal effect estimate
results$beta;

#Estimated standard error
results$stderr;

#Results from individual models
results$models.Y;

#Posterior probability of inclusion of each covariate in the outcome model
colSums(results$models.Y[,1:2]*results$models.Y[,ncol(results$models.Y)]);
</code></pre>

<hr>
<h2 id='NBCEE'>
Naive BCEE Implementation
</h2><span id='topic+NBCEE'></span>

<h3>Description</h3>

<p>N-BCEE implementation of the BCEE algorithm. This function supports exposures that can be modeled with generalized linear models (e.g., binary, continuous or Poisson), but only continuous outcomes. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NBCEE(X, Y, U, omega, niter = 5000, nburn = 500, nthin = 10,
 maxmodelX = NA, maxmodelY = NA, family.X = "gaussian")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="NBCEE_+3A_x">X</code></td>
<td>
<p>A vector of observed values for the exposure. 
</p>
</td></tr>
<tr><td><code id="NBCEE_+3A_y">Y</code></td>
<td>
<p>A vector of observed values for the continuous outcome.
</p>
</td></tr>
<tr><td><code id="NBCEE_+3A_u">U</code></td>
<td>
<p>A matrix of observed values for the <code>M</code> potential confounding covariates, where each column contains observed values for a potential confounding factor. A recommended implementation is to only consider pre-exposure covariates.
</p>
</td></tr>
<tr><td><code id="NBCEE_+3A_omega">omega</code></td>
<td>
<p>The value of the hyperparameter omega in the BCEE's outcome model prior distribution. A recommended implementation is to take <code>omega</code><code> = </code><code>sqrt(n)*c</code>, where <code>n</code> is the sample size and <code>c</code> is a user-supplied constant value. Simulation studies suggest that values of <code>c</code> between 100 and 1000 yield good results. 
</p>
</td></tr>
<tr><td><code id="NBCEE_+3A_niter">niter</code></td>
<td>
<p>The number of post burn-in iterations in the Markov chain Monte Carlo model composition (MC^3) algorithm (Madigan et al. 1995), prior to applying thinning. The default is 5000.
</p>
</td></tr>
<tr><td><code id="NBCEE_+3A_nburn">nburn</code></td>
<td>

<p>The number of burn-in iterations (prior to applying thinning). The default is 500.
</p>
</td></tr>
<tr><td><code id="NBCEE_+3A_nthin">nthin</code></td>
<td>

<p>The thinning of the chain. The default is 10. 
</p>
</td></tr>
<tr><td><code id="NBCEE_+3A_maxmodelx">maxmodelX</code></td>
<td>

<p>The maximum number of exposure models the algorithm can explore. See <code>maxmodelY</code> and the note below.
</p>
</td></tr>
<tr><td><code id="NBCEE_+3A_maxmodely">maxmodelY</code></td>
<td>

<p>The maximum number of distinct outcome models that the algorithm can explore. Choosing a smaller value can shorten computing time. However, choosing a value that is too small will cause the algorithm to crash. The default is <code>NA</code>; the maximum number of outcome models that can be explored is then set to the minimum of <code>niter + nburn</code> and <code>2^M</code>.  
</p>
</td></tr>
<tr><td><code id="NBCEE_+3A_family.x">family.X</code></td>
<td>

<p>A description of the error distribution and link function to be used in the model. This can be a character string naming a family function, a family function or the result of a call to a family function. (See <code><a href="stats.html#topic+family">family</a></code> for details of family functions.) The default is <code>"gaussian"</code>
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>NBCEE</code> assumes there are no missing values in the objects <code>X</code>, <code>Y</code> and <code>U</code>. The <code>na.omit</code> function which removes cases with missing data or an imputation package might be helpful.
</p>


<h3>Value</h3>

<table>
<tr><td><code>betas</code></td>
<td>
<p>A vector containing the sampled values for the exposure effect.</p>
</td></tr> 
<tr><td><code>models.X</code></td>
<td>
<p>A Boolean matrix identifying the sampled exposure models. See <code>models.Y</code>.</p>
</td></tr>
<tr><td><code>models.Y</code></td>
<td>
<p>A Boolean matrix identifying the sampled outcome models. Each row corresponds to a sampled outcome model. Within each row, the <code>m</code>th element equals 1 if and only if the <code>m</code>th potential confounding covariate is included in the sampled outcome model (and 0 otherwise).</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Variability of the exposure effect estimator is generally underestimated by the N-BCEE implementation of BCEE. The A-BCEE, which also happens to be faster, is thus preferred. Another option is to use N-BCEE with nonparametric bootstrap (B-BCEE) to correctly estimate variability. 
</p>
<p>The difference in computing time between A-BCEE and N-BCEE is mostly explainable by the method used to compute the posterior distribution of the exposure model. In A-BCEE, this posterior distribution is calculated as a first step using <code>bic.glm</code>. In N-BCEE, the posterior distribution of the exposure model is computed inside the MC^3 algorithm.</p>


<h3>Author(s)</h3>

<p>Denis Talbot, Genevieve Lefebvre, Juli Atherton.
</p>


<h3>References</h3>

<p>Madigan, D., York, J., Allard, D. (1995) <em>Bayesian graphical models for discrete data</em>, International Statistical Review, 63, 215-232.
</p>
<p>Talbot, D., Lefebvre, G., Atherton, J. (2015) <em>The Bayesian causal effect estimation algorithm</em>, Journal of Causal Inference, 3(2), 207-236.
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+na.omit">na.omit</a></code>, <code><a href="#topic+ABCEE">ABCEE</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># In this example, U1 and U2 are potential confounding covariates
# generated as independent N(0,1).
# X is generated as a function of both U1 and U2 with a N(0,1) error.
# Y is generated as a function of X and U1 with a N(0,1) error.
# Variable U1 is the only confounder.
# The causal effect of X on Y equals 1. 
# The exposure effect estimator (beta hat) in the outcome model  
# including U1 and U2 or including U1 only is unbiased.
# The sample size is n = 200.

# Generating the data
set.seed(418949); 
U1 = rnorm(200); 
U2 = rnorm(200);
X = 0.5*U1 + 1*U2 + rnorm(200);
Y = 1*X + 0.5*U1 + rnorm(200);

# Using NBCEE to estimate the causal exposure effect
n = 200;
omega.c = 500;
results = NBCEE(X,Y,cbind(U1,U2), omega = omega.c*sqrt(n),
 niter = 1000, nthin = 5, nburn = 20);

# The posterior mean of the exposure effect:
mean(results$betas);
# The posterior standard deviation of the exposure effect:
sd(results$betas);
# The posterior probability of inclusion of each covariate in the exposure model:
colMeans(results$models.X);
# The posterior distribution of the exposure model:
table(apply(results$models.X, 1, paste0, collapse = ""));
# The posterior probability of inclusion of each covariate in the outcome model:
colMeans(results$models.Y);
# The posterior distribution of the outcome model:
table(apply(results$models.Y, 1, paste0, collapse = ""));
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
