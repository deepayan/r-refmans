<!DOCTYPE html><html lang="en"><head><title>Help for package airGR</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {airGR}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#airGR-package'><p>Suite of GR Hydrological Models for Precipitation-Runoff Modelling</p></a></li>
<li><a href='#BasinInfo'><p>Data sample: characteristics of a different catchments</p></a></li>
<li><a href='#BasinObs'><p>Data sample: time series of observations of different catchments</p></a></li>
<li><a href='#Calibration'><p>Calibration algorithm that optimises the error criterion selected as objective function using the provided functions</p></a></li>
<li><a href='#Calibration_Michel'><p>Calibration algorithm that optimises the error criterion selected as objective function using the Irstea procedure described by C. Michel</p></a></li>
<li><a href='#CreateCalibOptions'><p>Creation of the CalibOptions object required but the Calibration* functions</p></a></li>
<li><a href='#CreateErrorCrit_GAPX'><p>Creation of the ErrorCrit_GAPX function</p></a></li>
<li><a href='#CreateIniStates'><p>Creation of the IniStates object possibly required by the CreateRunOptions functions</p></a></li>
<li><a href='#CreateInputsCrit'><p>Creation of the InputsCrit object required to the ErrorCrit functions</p></a></li>
<li><a href='#CreateInputsCrit_Lavenne'><p>Creation of the InputsCrit object for Lavenne Criterion</p></a></li>
<li><a href='#CreateInputsModel'><p>Creation of the InputsModel object required to the RunModel functions</p></a></li>
<li><a href='#CreateRunOptions'><p>Creation of the RunOptions object required to the RunModel functions</p></a></li>
<li><a href='#DataAltiExtrapolation_Valery'><p>Altitudinal extrapolation of precipitation and temperature series described by A. Valery</p></a></li>
<li><a href='#ErrorCrit'><p>Error criterion using the provided function</p></a></li>
<li><a href='#ErrorCrit_KGE'><p>Error criterion based on the KGE formula</p></a></li>
<li><a href='#ErrorCrit_KGE2'><p>Error criterion based on the KGE' formula</p></a></li>
<li><a href='#ErrorCrit_NSE'><p>Error criterion based on the NSE formula</p></a></li>
<li><a href='#ErrorCrit_RMSE'><p>Error criterion based on the RMSE</p></a></li>
<li><a href='#Imax'><p>Computation of the maximum capacity of the GR5H interception store</p></a></li>
<li><a href='#Param_Sets_GR4J'><p>Generalist parameter sets for the GR4J model</p></a></li>
<li><a href='#PE_Oudin'><p>Computation of series of potential evapotranspiration at the daily or hourly time steps with Oudin's formula</p></a></li>
<li><a href='#plot'><p>Default preview of model outputs</p></a></li>
<li><a href='#RunModel'><p>Run with the provided hydrological model function</p></a></li>
<li><a href='#RunModel_CemaNeige'><p>Run with the CemaNeige snow module</p></a></li>
<li><a href='#RunModel_CemaNeigeGR4H'><p>Run with the CemaNeigeGR4H hydrological model</p></a></li>
<li><a href='#RunModel_CemaNeigeGR4J'><p>Run with the CemaNeigeGR4J hydrological model</p></a></li>
<li><a href='#RunModel_CemaNeigeGR5H'><p>Run with the CemaNeigeGR5H hydrological model</p></a></li>
<li><a href='#RunModel_CemaNeigeGR5J'><p>Run with the CemaNeigeGR5J hydrological model</p></a></li>
<li><a href='#RunModel_CemaNeigeGR6J'><p>Run with the CemaNeigeGR6J hydrological model</p></a></li>
<li><a href='#RunModel_GR1A'><p>Run with the GR1A hydrological model</p></a></li>
<li><a href='#RunModel_GR2M'><p>Run with the GR2M hydrological model</p></a></li>
<li><a href='#RunModel_GR4H'><p>Run with the GR4H hydrological model</p></a></li>
<li><a href='#RunModel_GR4J'><p>Run with the GR4J hydrological model</p></a></li>
<li><a href='#RunModel_GR5H'><p>Run with the GR5H hydrological model</p></a></li>
<li><a href='#RunModel_GR5J'><p>Run with the GR5J hydrological model</p></a></li>
<li><a href='#RunModel_GR6J'><p>Run with the GR6J hydrological model</p></a></li>
<li><a href='#RunModel_Lag'><p>Run with the Lag model</p></a></li>
<li><a href='#SeriesAggreg'><p>Conversion of time series to another time step (aggregation only) and regime computation</p></a></li>
<li><a href='#TransfoParam'><p>Transformation of the parameters using the provided function</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Suite of GR Hydrological Models for Precipitation-Runoff
Modelling</td>
</tr>
<tr>
<td>Version:</td>
<td>1.7.6</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-10-25</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.1.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>graphics, grDevices, stats, utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, markdown, rmarkdown, caRamel, coda, DEoptim, FME,
ggmcmc, Rmalschains, GGally, ggplot2, testthat</td>
</tr>
<tr>
<td>Description:</td>
<td>Hydrological modelling tools developed at INRAE-Antony (HYCAR Research Unit, France). The package includes several conceptual rainfall-runoff models (GR4H, GR5H, GR4J, GR5J, GR6J, GR2M, GR1A) that can be applied either on a lumped or semi-distributed way. A snow accumulation and melt model (CemaNeige) and the associated functions for the calibration and evaluation of models are also included. Use help(airGR) for package description and references.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://hydrogr.github.io/airGR/">https://hydrogr.github.io/airGR/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://gitlab.irstea.fr/HYCAR-Hydro/airgr/-/issues">https://gitlab.irstea.fr/HYCAR-Hydro/airgr/-/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-10-25 11:09:38 UTC; odelaigue</td>
</tr>
<tr>
<td>Author:</td>
<td>Laurent Coron <a href="https://orcid.org/0000-0002-1503-6204"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, trl],
  Olivier Delaigue <a href="https://orcid.org/0000-0002-7668-8468"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Guillaume Thirel <a href="https://orcid.org/0000-0002-1444-1830"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, ths],
  David Dorchies <a href="https://orcid.org/0000-0002-6595-7984"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Charles Perrin <a href="https://orcid.org/0000-0001-8552-1881"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, ths],
  Claude Michel [aut, ths],
  Vazken Andréassian
    <a href="https://orcid.org/0000-0001-7124-9303"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [ctb, ths],
  François Bourgin <a href="https://orcid.org/0000-0002-2820-7260"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Pierre Brigode <a href="https://orcid.org/0000-0001-8257-0741"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Nicolas Le Moine [ctb],
  Thibaut Mathevet <a href="https://orcid.org/0000-0002-4142-4454"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Safouane Mouelhi [ctb],
  Ludovic Oudin <a href="https://orcid.org/0000-0002-3712-0933"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Raji Pushpalatha [ctb],
  Audrey Valéry [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Olivier Delaigue &lt;airGR@inrae.fr&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-10-26 07:30:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='airGR-package'>Suite of GR Hydrological Models for Precipitation-Runoff Modelling</h2><span id='topic+airGR'></span><span id='topic+airGR-package'></span>

<h3>Description</h3>

<p>Hydrological modelling tools developed at INRAE-Antony (HYCAR Research Unit, France). The package includes several conceptual rainfall-runoff models (GR4H, GR5H, GR4J, GR5J, GR6J, GR2M, GR1A) that can be applied either on a lumped or semi-distributed way. A snow accumulation and melt model (CemaNeige) and the associated functions for the calibration and evaluation of models are also included. Use help(airGR) for package description and references.
Each model core is coded in Fortran to ensure low computational time. The other package functions (i.e. mainly the calibration algorithm and the computation of the efficiency criteria) are coded in R. <br /><br />
</p>
<p>## &mdash; Functions and objects
</p>
<p>The airGR package has been designed to fulfil two major requirements: facilitate the use by non-expert users and allow flexibility regarding the addition of external criteria, models or calibration algorithms. The names of the functions and their arguments were chosen to this end.
</p>
<p>The package is mostly based on three families of functions:
</p>

<ul>
<li><p> the functions belonging to the <code><a href="#topic+RunModel">RunModel</a></code> family require three arguments: <em>InputsModel</em>, <em>RunOptions</em> and <em>Param</em>;  please refer to help pages <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> and <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for further details and examples;
</p>
</li>
<li><p> the functions belonging to the <code><a href="#topic+ErrorCrit">ErrorCrit</a></code> family require two arguments: <em>InputsCrit</em> and <em>OutputsModel</em>; please refer to help pages <code><a href="#topic+CreateInputsCrit">CreateInputsCrit</a></code> and <code><a href="#topic+RunModel">RunModel</a></code> for further details and examples;
</p>
</li>
<li><p> the functions belonging to the <code><a href="#topic+Calibration">Calibration</a></code> family require four arguments: <em>InputsModel</em>, <em>RunOptions</em>, <em>InputsCrit</em> and <em>CalibOptions</em>;  please refer to help pages <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>, <code><a href="#topic+CreateInputsCrit">CreateInputsCrit</a></code> and <code><a href="#topic+CreateCalibOptions">CreateCalibOptions</a></code> for further details and examples.
</p>
</li></ul>

<p>In order to limit the risk of mis-use and increase the flexibility of these main functions, we imposed the structure of their arguments and defined their class. Most users will not need to worry about these imposed structures since functions are provided to prepare these arguments for them: <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>, <code><a href="#topic+CreateInputsCrit">CreateInputsCrit</a></code>, <code><a href="#topic+CreateCalibOptions">CreateCalibOptions</a></code>. However, advanced users wishing to supplement the package with their own models will need to comply with these imposed structures and refer to the package source codes to get all the specification requirements. <br /><br />
</p>
<p>## &mdash; Models
</p>
<p>Seven hydrological models and one snow melt and accumulation model are implemented in airGR. The hydrological models can be applied either on a lumped way or on a semi-distributed way (on sub-catchments). The snow model can either be used alone or with the daily or hourly hydrological models. Naturally each hydrological model can also be used alone. <br />
These models can be called within airGR using the following functions:
</p>

<ul>
<li> <p><code><a href="#topic+RunModel_GR4H">RunModel_GR4H</a></code>: four-parameter hourly lumped hydrological model (Mathevet, 2005)
</p>
</li>
<li> <p><code><a href="#topic+RunModel_GR5H">RunModel_GR5H</a></code>: five-parameter hourly lumped hydrological model (Ficchi, 2017; Ficchi <em>et al.</em>, 2019)
</p>
</li>
<li> <p><code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code>: four-parameter daily lumped hydrological model (Perrin <em>et al.</em>, 2003)
</p>
</li>
<li> <p><code><a href="#topic+RunModel_GR5J">RunModel_GR5J</a></code>: five-parameter daily lumped hydrological model (Le Moine, 2008)
</p>
</li>
<li> <p><code><a href="#topic+RunModel_GR6J">RunModel_GR6J</a></code>: six-parameter daily lumped hydrological model (Pushpalatha <em>et al.</em>, 2011)
</p>
</li>
<li> <p><code><a href="#topic+RunModel_GR2M">RunModel_GR2M</a></code>: two-parameter monthly lumped hydrological model (Mouelhi, 2003; Mouelhi <em>et al.</em>, 2006a)
</p>
</li>
<li> <p><code><a href="#topic+RunModel_GR1A">RunModel_GR1A</a></code>: one-parameter yearly lumped hydrological model (Mouelhi, 2003; Mouelhi <em>et al.</em>, 2006b)
</p>
</li>
<li> <p><code><a href="#topic+RunModel_CemaNeige">RunModel_CemaNeige</a></code>: two-parameter degree-day snow melt and accumulation daily model (Valéry <em>et al.</em>, 2014; Riboust <em>et al.</em>, 2019)
</p>
</li>
<li> <p><code><a href="#topic+RunModel_CemaNeigeGR4H">RunModel_CemaNeigeGR4H</a></code>: combined use of GR4H and CemaNeige
</p>
</li>
<li> <p><code><a href="#topic+RunModel_CemaNeigeGR5H">RunModel_CemaNeigeGR5H</a></code>: combined use of GR5H and CemaNeige
</p>
</li>
<li> <p><code><a href="#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code>: combined use of GR4J and CemaNeige
</p>
</li>
<li> <p><code><a href="#topic+RunModel_CemaNeigeGR5J">RunModel_CemaNeigeGR5J</a></code>: combined use of GR5J and CemaNeige
</p>
</li>
<li> <p><code><a href="#topic+RunModel_CemaNeigeGR6J">RunModel_CemaNeigeGR6J</a></code>: combined use of GR6J and CemaNeige
</p>
</li></ul>

<p>## &mdash; How to get started
</p>
<p>To learn how to use the functions from the airGR package, it is recommended to follow the five steps described below:
</p>

<ol>
<li><p> refer to the help for <code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code> then run the provided example to assess how to make a simulation;
</p>
</li>
<li><p> refer to the help for <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> to understand how the inputs of a model are prepared/organised;
</p>
</li>
<li><p> refer to the help for <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> to understand how the run options of a model are parametrised/organised;
</p>
</li>
<li><p> refer to the help for <code><a href="#topic+ErrorCrit_NSE">ErrorCrit_NSE</a></code> and <code><a href="#topic+CreateInputsCrit">CreateInputsCrit</a></code> to understand how the computation of an error criterion is prepared/made;
</p>
</li>
<li><p> refer to the help for <code><a href="#topic+Calibration_Michel">Calibration_Michel</a></code>, run the provided example and then refer to the help for <code><a href="#topic+CreateCalibOptions">CreateCalibOptions</a></code> to understand how a model calibration is prepared/made.
</p>
</li></ol>

<p>To get started with the package, you can refer to the 'get_started' vignette (<code>vignette("V01_get_started", package = "airGR")</code>). To know how to use the models on a semi-distributed way, you can refer to the 'sd_model' vignette (<code>vignette("V05_sd_model", package = "airGR")</code>). For more information, please visit the <a href="https://hydrogr.github.io/airGR/">airGR website</a>. <br /><br />
</p>
<p>## &mdash; References
</p>

<ul>
<li><p> Ficchi, A. (2017). An adaptive hydrological model for multiple time-steps: Diagnostics and improvements based on fluxes consistency. PhD thesis, UPMC - Irstea Antony, Paris, France.
</p>
</li>
<li><p> Ficchi, A., Perrin, C. and Andréassian, V. (2019). Hydrological modelling at multiple sub-daily time steps: model improvement via flux-matching. Journal of Hydrology, 575, 1308-1327, <a href="https://doi.org/10.1016/j.jhydrol.2019.05.084">doi:10.1016/j.jhydrol.2019.05.084</a>.
</p>
</li>
<li><p> Le Moine, N. (2008). Le bassin versant de surface vu par le souterrain : une voie d'amélioration des performances et du réalisme des modèles pluie-débit ?, PhD thesis (in French), UPMC - Cemagref Antony, Paris, France, 324 pp.
</p>
</li>
<li><p> Mathevet, T. (2005). Quels modèles pluie-débit globaux pour le pas de temps horaire ? Développement empirique et comparaison de modèles sur un large échantillon de bassins versants, PhD thesis (in French), ENGREF - Cemagref Antony, Paris, France, 463 pp.
</p>
</li>
<li><p> Mouelhi, S. (2003). Vers une chaîne cohérente de modèles pluie-débit conceptuels globaux aux pas de temps pluriannuel, annuel, mensuel et journalier, PhD thesis (in French), ENGREF - Cemagref Antony, Paris, France, 323 pp.
</p>
</li>
<li><p> Mouelhi, S., Michel, C., Perrin, C. and Andréassian, V. (2006a). Stepwise development of a two-parameter monthly water balance model. Journal of Hydrology, 318(1-4), 200-214, <a href="https://doi.org/10.1016/j.jhydrol.2005.06.014">doi:10.1016/j.jhydrol.2005.06.014</a>.
</p>
</li>
<li><p> Mouelhi, S., Michel, C., Perrin, C. and Andréassian, V. (2006b). Linking stream flow to rainfall at the annual time step: the Manabe bucket model revisited. Journal of Hydrology, 328, 283-296, <a href="https://doi.org/10.1016/j.jhydrol.2005.12.022">doi:10.1016/j.jhydrol.2005.12.022</a>.
</p>
</li>
<li><p> Perrin, C., Michel, C. and Andréassian, V. (2003). Improvement of a parsimonious model for streamflow simulation. Journal of Hydrology, 279(1-4), 275-289, <a href="https://doi.org/10.1016/S0022-1694%2803%2900225-7">doi:10.1016/S0022-1694(03)00225-7</a>.
</p>
</li>
<li><p> Pushpalatha, R., Perrin, C., Le Moine, N., Mathevet, T. and Andréassian, V. (2011). A downward structural sensitivity analysis of hydrological models to improve low-flow simulation. Journal of Hydrology, 411(1-2), 66-76, <a href="https://doi.org/10.1016/j.jhydrol.2011.09.034">doi:10.1016/j.jhydrol.2011.09.034</a>.
</p>
</li>
<li><p> Riboust, P., Thirel, G., Le Moine N. and Ribstein P. (2019). Revisiting a simple degree-day model for integrating satellite data: Implementation of SWE-SCA hystereses. Journal of Hydrology and Hydromechanics, 67(1), 70–81, <a href="https://doi.org/10.1016/j.jhydrol.2014.04.058">doi:10.1016/j.jhydrol.2014.04.058</a>.
</p>
</li>
<li><p> Valéry, A., Andréassian, V. and Perrin, C. (2014). &quot;As simple as possible but not simpler&quot;: What is useful in a temperature-based snow-accounting routine? Part 2 - Sensitivity analysis of the Cemaneige snow accounting routine on 380 catchments. Journal of Hydrology, 517(0), 1176-1187, <a href="https://doi.org/10.1016/j.jhydrol.2014.04.058">doi:10.1016/j.jhydrol.2014.04.058</a>.
</p>
</li></ul>


<hr>
<h2 id='BasinInfo'>Data sample: characteristics of a different catchments</h2><span id='topic+BasinInfo'></span>

<h3>Description</h3>

<p>L0123001, L0123002 and L0123003 are fictional catchments. <br />
X0310010 contains actual data from the Durance River at Embrun [La Clapière] (Hautes-Alpes, France). <br />
<br />
R-object containing the code, station's name, area and hypsometric curve of the catchment.
</p>


<h3>Format</h3>

<p>List named 'BasinInfo' containing
</p>

<ul>
<li><p> two strings: catchment's code and station's name
</p>
</li>
<li><p> one float: catchment's area in km2
</p>
</li>
<li><p> one numeric vector: catchment's hypsometric curve (min, quantiles 01 to 99 and max) in metres
</p>
</li></ul>


<h3>See Also</h3>

<p><code><a href="#topic+BasinObs">BasinObs</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)
data(L0123001)
str(BasinInfo)
</code></pre>

<hr>
<h2 id='BasinObs'>Data sample: time series of observations of different catchments</h2><span id='topic+BasinObs'></span><span id='topic+L0123001'></span><span id='topic+L0123002'></span><span id='topic+L0123003'></span><span id='topic+X0310010'></span>

<h3>Description</h3>

<p>L0123001, L0123002 or L0123003 are fictional catchments.
<br />
X0310010 contains actual data from the Durance River at Embrun [La Clapière] (Hautes-Alpes, France).
The flows are provided by Electricity of France (EDF) and were retrieved from the Banque Hydro database (http://www.hydro.eaufrance.fr).
The meteorological forcing are derived from the SAFRAN reanalysis from Météo-France (Vidal et al., 2010).
<br />
R-object containing the times series of precipitation, temperature, potential evapotranspiration and discharge.
X0310010 contains in addition MODIS snow cover area (SCA) data retrieved from the National Snow and Ice Data Center (NSIDC) repository (https://nsidc.org/). Five SCA time series are given, corresponding to 5 elevation bands of the CemaNeige model (default configuration). SCA data for days with important cloudiness (&gt; 40 %) were set to missing values for the sake of data representativeness. .
<br /> <br />
Times series for L0123001, L0123002 and X0310010 are at the daily time step for use with daily models such as GR4J, GR5J, GR6J, CemaNeigeGR4J, CemaNeigeGR5J and CemaNeigeGR6J. <br />
Times series for X0310010 are provided in order to test hysteresis version of CemaNeige (see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> (Riboust et al., 2019). <br />
Times series for L0123003 are at the hourly time step for use with hourly models such as GR4H or GR5H.
</p>


<h3>Format</h3>

<p>Data frame named 'BasinObs' containing
</p>

<ul>
<li><p> one POSIXct vector: time series dates in the POSIXct format
</p>
</li>
<li><p> five numeric vectors: time series of catchment average precipitation [mm/time step], catchment average air temperature [°C], catchment average potential evapotranspiration [mm/time step], outlet discharge [l/s], outlet discharge [mm/time step]
</p>
</li></ul>


<h3>References</h3>

<p>Riboust, P., Thirel, G., Le Moine, N. and Ribstein P. (2019).
Revisiting a simple degree-day model for integrating satellite data: Implementation of SWE-SCA hystereses.
Journal of Hydrology and Hydromechanics, 67(1), 70–81, <a href="https://doi.org/10.2478/johh-2018-0004">doi:10.2478/johh-2018-0004</a>.
<br /><br />
Vidal, J.-P., Martin, E., Franchistéguy, L., Baillon, M. and Soubeyroux, J. (2010).
A 50-year high-resolution atmospheric reanalysis over France with the Safran system.
International Journal of Climatology, 30, 1627–1644, <a href="https://doi.org/10.1002/joc.2003">doi:10.1002/joc.2003</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+BasinInfo">BasinInfo</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)
data(L0123001)
str(BasinObs)
</code></pre>

<hr>
<h2 id='Calibration'>Calibration algorithm that optimises the error criterion selected as objective function using the provided functions</h2><span id='topic+Calibration'></span>

<h3>Description</h3>

<p>Calibration algorithm that optimises the error criterion selected as objective function using the provided functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Calibration(InputsModel, RunOptions, InputsCrit, CalibOptions,
            FUN_MOD, FUN_CRIT, FUN_CALIB = Calibration_Michel,
            FUN_TRANSFO = NULL, verbose = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Calibration_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em>] see <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> for details</p>
</td></tr>
<tr><td><code id="Calibration_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="Calibration_+3A_inputscrit">InputsCrit</code></td>
<td>
<p>[object of class <em>InputsCrit</em>] see <code><a href="#topic+CreateInputsCrit">CreateInputsCrit</a></code> for details</p>
</td></tr>
<tr><td><code id="Calibration_+3A_caliboptions">CalibOptions</code></td>
<td>
<p>[object of class <em>CalibOptions</em>] see <code><a href="#topic+CreateCalibOptions">CreateCalibOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="Calibration_+3A_fun_mod">FUN_MOD</code></td>
<td>
<p>[function] hydrological model function (e.g. <code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code>, <code><a href="#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code>)</p>
</td></tr>
<tr><td><code id="Calibration_+3A_fun_crit">FUN_CRIT</code></td>
<td>
<p>(deprecated) [function] error criterion function (e.g. <code><a href="#topic+ErrorCrit_RMSE">ErrorCrit_RMSE</a></code>, <code><a href="#topic+ErrorCrit_NSE">ErrorCrit_NSE</a></code>)</p>
</td></tr>
<tr><td><code id="Calibration_+3A_fun_calib">FUN_CALIB</code></td>
<td>
<p>(deprecated) [function] calibration algorithm function (e.g. <code><a href="#topic+Calibration_Michel">Calibration_Michel</a></code>), <code>default = Calibration_Michel</code></p>
</td></tr>
<tr><td><code id="Calibration_+3A_fun_transfo">FUN_TRANSFO</code></td>
<td>
<p>(optional) [function] model parameters transformation function, if the <code>FUN_MOD</code> used is native in the package <code>FUN_TRANSFO</code> is automatically defined</p>
</td></tr>
<tr><td><code id="Calibration_+3A_verbose">verbose</code></td>
<td>
<p>(optional) [boolean] boolean indicating if the function is run in verbose mode or not, default = <code>TRUE</code></p>
</td></tr>
<tr><td><code id="Calibration_+3A_...">...</code></td>
<td>
<p>Further arguments to pass to <code><a href="#topic+RunModel">RunModel</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>[list] see <code><a href="#topic+Calibration_Michel">Calibration_Michel</a></code>
</p>


<h3>Author(s)</h3>

<p>Laurent Coron, Olivier Delaigue
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Calibration_Michel">Calibration_Michel</a></code>,
<code><a href="#topic+ErrorCrit">ErrorCrit</a></code>, <code><a href="#topic+TransfoParam">TransfoParam</a></code>,
<code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>,
<code><a href="#topic+CreateInputsCrit">CreateInputsCrit</a></code>, <code><a href="#topic+CreateCalibOptions">CreateCalibOptions</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123001)

## preparation of InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_GR4J, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E)

## calibration period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

## preparation of RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR4J,
                               InputsModel = InputsModel, IndPeriod_Run = Ind_Run)

## calibration criterion: preparation of the InputsCrit object
InputsCrit &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                               RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])

## preparation of CalibOptions object
CalibOptions &lt;- CreateCalibOptions(FUN_MOD = RunModel_GR4J, FUN_CALIB = Calibration_Michel)

## calibration
OutputsCalib &lt;- Calibration(InputsModel = InputsModel, RunOptions = RunOptions,
                            InputsCrit = InputsCrit, CalibOptions = CalibOptions,
                            FUN_MOD = RunModel_GR4J,
                            FUN_CALIB = Calibration_Michel)

## simulation
Param &lt;- OutputsCalib$ParamFinalR
OutputsModel &lt;- RunModel(InputsModel = InputsModel, RunOptions = RunOptions,
                         Param = Param, FUN = RunModel_GR4J)

## results preview
plot(OutputsModel, Qobs = BasinObs$Qmm[Ind_Run])

## efficiency criterion: Nash-Sutcliffe Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                                RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)

## efficiency criterion: Kling-Gupta Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_KGE, InputsModel = InputsModel,
                                RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_KGE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)
</code></pre>

<hr>
<h2 id='Calibration_Michel'>Calibration algorithm that optimises the error criterion selected as objective function using the Irstea procedure described by C. Michel</h2><span id='topic+Calibration_Michel'></span>

<h3>Description</h3>

<p>Calibration algorithm that optimises the error criterion selected as objective function. <br />
<br />
The algorithm combines a global and a local approach.
First, a screening is performed using either a rough predefined grid or a list of parameter sets.
Then a steepest descent local search algorithm is performed, starting from the result of the screening procedure.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Calibration_Michel(InputsModel, RunOptions, InputsCrit, CalibOptions,
                   FUN_MOD, FUN_CRIT, FUN_TRANSFO = NULL, verbose = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Calibration_Michel_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em>] see <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> for details</p>
</td></tr>
<tr><td><code id="Calibration_Michel_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="Calibration_Michel_+3A_inputscrit">InputsCrit</code></td>
<td>
<p>[object of class <em>InputsCrit</em>] see <code><a href="#topic+CreateInputsCrit">CreateInputsCrit</a></code> for details</p>
</td></tr>
<tr><td><code id="Calibration_Michel_+3A_caliboptions">CalibOptions</code></td>
<td>
<p>[object of class <em>CalibOptions</em>] see <code><a href="#topic+CreateCalibOptions">CreateCalibOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="Calibration_Michel_+3A_fun_mod">FUN_MOD</code></td>
<td>
<p>[function] hydrological model function (e.g. <code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code>, <code><a href="#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code>)</p>
</td></tr>
<tr><td><code id="Calibration_Michel_+3A_fun_crit">FUN_CRIT</code></td>
<td>
<p>(deprecated) [function] error criterion function (e.g. <code><a href="#topic+ErrorCrit_RMSE">ErrorCrit_RMSE</a></code>, <code><a href="#topic+ErrorCrit_NSE">ErrorCrit_NSE</a></code>)</p>
</td></tr>
<tr><td><code id="Calibration_Michel_+3A_fun_transfo">FUN_TRANSFO</code></td>
<td>
<p>(optional) [function] model parameters transformation function, if the <code>FUN_MOD</code> used is native in the package <code>FUN_TRANSFO</code> is automatically defined</p>
</td></tr>
<tr><td><code id="Calibration_Michel_+3A_verbose">verbose</code></td>
<td>
<p>(optional) [boolean] boolean indicating if the function is run in verbose mode or not, default = <code>TRUE</code></p>
</td></tr>
<tr><td><code id="Calibration_Michel_+3A_...">...</code></td>
<td>
<p>(optional) arguments to pass to <code><a href="#topic+RunModel">RunModel</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>A screening is first performed either based on a rough predefined grid (considering various initial
values for each parameter) or from a list of initial parameter sets. <br />
The best set identified in this screening is then used as a starting point for the steepest
descent local search algorithm. <br />
For this search, since the ranges of parameter values can be quite different,
simple mathematical transformations are applied to parameters to make them vary
in a similar range and get a similar sensitivity to a predefined search step.  This is done using the TransfoParam functions. <br />
During the steepest descent method, at each iteration, we start from a parameter set of NParam values (NParam being the number of
free parameters of the chosen hydrological model) and we determine the 2*NParam-1 new candidates
by changing one by one the different parameters (+/- search step). <br />
All these candidates are tested and the best one kept to be the starting point for the next
iteration. At the end of each iteration, the the search step is either increased or decreased to adapt
the progression speed. A composite step can occasionally be done. <br />
The calibration algorithm stops when the search step becomes smaller than a predefined threshold.
</p>


<h3>Value</h3>

<p>[list] list containing the function outputs organised as follows:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <em>$ParamFinalR  </em> </td><td style="text-align: left;"> [numeric] parameter set obtained at the end of the calibration                                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CritFinal    </em> </td><td style="text-align: left;"> [numeric] error criterion selected as objective function obtained at the end of the calibration </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$NIter        </em> </td><td style="text-align: left;"> [numeric] number of iterations during the calibration                                           </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$NRuns        </em> </td><td style="text-align: left;"> [numeric] number of model runs done during the calibration                                      </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$HistParamR   </em> </td><td style="text-align: left;"> [numeric] table showing the progression steps in the search for optimal set: parameter values   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$HistCrit     </em> </td><td style="text-align: left;"> [numeric] table showing the progression steps in the search for optimal set: criterion values   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$MatBoolCrit  </em> </td><td style="text-align: left;"> [boolean] table giving the requested and actual time steps over which the model is calibrated   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CritName     </em> </td><td style="text-align: left;"> [character] name of the calibration criterion used as objective function                        </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CritBestValue</em> </td><td style="text-align: left;"> [numeric] theoretical best criterion value                                                      </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Laurent Coron, Claude Michel, Charles Perrin, Thibault Mathevet, Olivier Delaigue, Guillaume Thirel, David Dorchies
</p>


<h3>References</h3>

<p>Michel, C. (1991),
Hydrologie appliquée aux petits bassins ruraux.
Hydrology handbook (in French), Cemagref, Antony, France.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Calibration">Calibration</a></code>,
<code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code>, <code><a href="#topic+TransfoParam">TransfoParam</a></code>, <code><a href="#topic+ErrorCrit_RMSE">ErrorCrit_RMSE</a></code>,
<code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>,
<code><a href="#topic+CreateInputsCrit">CreateInputsCrit</a></code>, <code><a href="#topic+CreateCalibOptions">CreateCalibOptions</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123001)

## preparation of InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_GR4J, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E)

## calibration period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

## preparation of RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR4J, InputsModel = InputsModel,
                               IndPeriod_Run = Ind_Run)

## calibration criterion: preparation of the InputsCrit object
InputsCrit &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                               RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])

## preparation of CalibOptions object
CalibOptions &lt;- CreateCalibOptions(FUN_MOD = RunModel_GR4J, FUN_CALIB = Calibration_Michel)

## calibration
OutputsCalib &lt;- Calibration_Michel(InputsModel = InputsModel, RunOptions = RunOptions,
                                 InputsCrit = InputsCrit, CalibOptions = CalibOptions,
                                 FUN_MOD = RunModel_GR4J)

## simulation
Param &lt;- OutputsCalib$ParamFinalR
OutputsModel &lt;- RunModel_GR4J(InputsModel = InputsModel,
                              RunOptions = RunOptions, Param = Param)

## results preview
plot(OutputsModel, Qobs = BasinObs$Qmm[Ind_Run])

## efficiency criterion: Nash-Sutcliffe Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                                RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)

## efficiency criterion: Kling-Gupta Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_KGE, InputsModel = InputsModel,
                                RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_KGE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)
</code></pre>

<hr>
<h2 id='CreateCalibOptions'>Creation of the CalibOptions object required but the Calibration* functions</h2><span id='topic+CreateCalibOptions'></span>

<h3>Description</h3>

<p>Creation of the <em>CalibOptions</em> object required by the <code>Calibration*</code> functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CreateCalibOptions(FUN_MOD, FUN_CALIB = Calibration_Michel,
                   FUN_TRANSFO = NULL, IsHyst = FALSE, IsSD = FALSE,
                   FixedParam = NULL,
                   SearchRanges = NULL, StartParamList = NULL,
                   StartParamDistrib = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="CreateCalibOptions_+3A_fun_mod">FUN_MOD</code></td>
<td>
<p>[function] hydrological model function (e.g. <code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code>, <code><a href="#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code>)</p>
</td></tr>
<tr><td><code id="CreateCalibOptions_+3A_fun_calib">FUN_CALIB</code></td>
<td>
<p>(optional) [function] calibration algorithm function (e.g. Calibration_Michel), default = <code>Calibration_Michel</code></p>
</td></tr>
<tr><td><code id="CreateCalibOptions_+3A_fun_transfo">FUN_TRANSFO</code></td>
<td>
<p>(optional) [function] model parameters transformation function, if the <code>FUN_MOD</code> used is native in the package, <code>FUN_TRANSFO</code> is automatically defined</p>
</td></tr>
<tr><td><code id="CreateCalibOptions_+3A_ishyst">IsHyst</code></td>
<td>
<p>[boolean] boolean indicating if the hysteresis version of CemaNeige is used. See details</p>
</td></tr>
<tr><td><code id="CreateCalibOptions_+3A_issd">IsSD</code></td>
<td>
<p>[boolean] boolean indicating if the semi-distributed lag model is used. See details</p>
</td></tr>
<tr><td><code id="CreateCalibOptions_+3A_fixedparam">FixedParam</code></td>
<td>
<p>(optional) [numeric] vector giving the values set for the non-optimised parameter values (NParam columns, 1 line)
<br /> Example:
</p>

<table>
<tr>
 <td style="text-align: left;">
              </td><td style="text-align: left;">   NA   </td><td style="text-align: left;">   NA   </td><td style="text-align: left;"> 3.34   </td><td style="text-align: left;">  ...    </td><td style="text-align: left;">   NA </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>
</td></tr>
<tr><td><code id="CreateCalibOptions_+3A_searchranges">SearchRanges</code></td>
<td>
<p>(optional) [numeric] matrix giving the ranges of real parameters (NParam columns, 2 lines)
<br /> Example:
</p>

<table>
<tr>
 <td style="text-align: left;">
              </td><td style="text-align: left;"> [X1]   </td><td style="text-align: left;"> [X2]   </td><td style="text-align: left;"> [X3]   </td><td style="text-align: left;"> [...]   </td><td style="text-align: left;"> [Xi] </td>
</tr>
<tr>
 <td style="text-align: left;">
     [1,]     </td><td style="text-align: left;">    0   </td><td style="text-align: left;">   -1   </td><td style="text-align: left;">    0   </td><td style="text-align: left;">  ...    </td><td style="text-align: left;">  0.0 </td>
</tr>
<tr>
 <td style="text-align: left;">
     [2,]     </td><td style="text-align: left;"> 3000   </td><td style="text-align: left;">   +1   </td><td style="text-align: left;">  100   </td><td style="text-align: left;">  ...    </td><td style="text-align: left;">  3.0 </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>
</td></tr>
<tr><td><code id="CreateCalibOptions_+3A_startparamlist">StartParamList</code></td>
<td>
<p>(optional) [numeric] matrix of parameter sets used for grid-screening calibration procedure (values in columns, sets in line)
<br /> Example:
</p>

<table>
<tr>
 <td style="text-align: left;">
              </td><td style="text-align: left;"> [X1]   </td><td style="text-align: left;"> [X2]   </td><td style="text-align: left;"> [X3]   </td><td style="text-align: left;"> [...]   </td><td style="text-align: left;"> [Xi] </td>
</tr>
<tr>
 <td style="text-align: left;">
     [set1]   </td><td style="text-align: left;">  800   </td><td style="text-align: left;"> -0.7   </td><td style="text-align: left;">   25   </td><td style="text-align: left;">  ...    </td><td style="text-align: left;">  1.0 </td>
</tr>
<tr>
 <td style="text-align: left;">
     [set2]   </td><td style="text-align: left;"> 1000   </td><td style="text-align: left;"> -0.5   </td><td style="text-align: left;">   22   </td><td style="text-align: left;">  ...    </td><td style="text-align: left;">  1.1 </td>
</tr>
<tr>
 <td style="text-align: left;">
     [...]    </td><td style="text-align: left;">  ...   </td><td style="text-align: left;">  ...   </td><td style="text-align: left;">  ...   </td><td style="text-align: left;">  ...    </td><td style="text-align: left;">  ... </td>
</tr>
<tr>
 <td style="text-align: left;">
     [set n]  </td><td style="text-align: left;">  200   </td><td style="text-align: left;"> -0.3   </td><td style="text-align: left;">   17   </td><td style="text-align: left;">  ...    </td><td style="text-align: left;">  1.0 </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>
</td></tr>
<tr><td><code id="CreateCalibOptions_+3A_startparamdistrib">StartParamDistrib</code></td>
<td>
<p>(optional) [numeric] matrix of parameter values used for grid-screening calibration procedure (values in columns, percentiles in line)
<br /> Example:
</p>

<table>
<tr>
 <td style="text-align: left;">
              </td><td style="text-align: left;"> [X1]   </td><td style="text-align: left;"> [X2]   </td><td style="text-align: left;"> [X3]   </td><td style="text-align: left;"> [...]   </td><td style="text-align: left;"> [Xi] </td>
</tr>
<tr>
 <td style="text-align: left;">
     [value1] </td><td style="text-align: left;">  800   </td><td style="text-align: left;"> -0.7   </td><td style="text-align: left;">   25   </td><td style="text-align: left;">  ...    </td><td style="text-align: left;">  1.0 </td>
</tr>
<tr>
 <td style="text-align: left;">
     [value2] </td><td style="text-align: left;"> 1000   </td><td style="text-align: left;">   NA   </td><td style="text-align: left;">   50   </td><td style="text-align: left;">  ...    </td><td style="text-align: left;">  1.2 </td>
</tr>
<tr>
 <td style="text-align: left;">
     [value3] </td><td style="text-align: left;"> 1200   </td><td style="text-align: left;">   NA   </td><td style="text-align: left;">   NA   </td><td style="text-align: left;">  ...    </td><td style="text-align: left;">  1.6 </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>
</td></tr>
</table>


<h3>Details</h3>

<p>Users wanting to use <code>FUN_MOD</code>, <code>FUN_CALIB</code> or <code>FUN_TRANSFO</code> functions that are not included in
the package must create their own <code>CalibOptions</code> object accordingly. <br />
</p>
<p>## &mdash; CemaNeige version
</p>
<p>If <code>IsHyst = FALSE</code>, the original CemaNeige version from Valéry et al. (2014) is used. <br />
If <code>IsHyst = TRUE</code>, the CemaNeige version from Riboust et al. (2019) is used. Compared to the original version, this version of CemaNeige needs two more parameters and it includes a representation of the hysteretic relationship between the Snow Cover Area (SCA) and the Snow Water Equivalent (SWE) in the catchment. The hysteresis included in airGR is the Modified Linear hysteresis (LH*); it is represented on panel b) of Fig. 3 in Riboust et al. (2019). Riboust et al. (2019) advise to use the LH* version of CemaNeige with parameters calibrated using an objective function combining 75 % of KGE calculated on discharge simulated from a rainfall-runoff model compared to observed discharge and 5 % of KGE calculated on SCA on 5 CemaNeige elevation bands compared to satellite (e.g. MODIS) SCA (see Eq. (18), Table 3 and Fig. 6). Riboust et al. (2019)'s tests were realized with GR4J as the chosen rainfall-runoff model. <br />
</p>
<p>If <code>InputsModel</code> parameter has been created for using a semi-distributed (SD) model (See <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>), the parameter <code>isSD</code> should be set to <code>TRUE</code>.
</p>


<h3>Value</h3>

<p>[list] object of class <em>CalibOptions</em> containing the data required to evaluate the model outputs; it can include the following:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <em>$FixedParam       </em> </td><td style="text-align: left;"> [numeric] vector giving the values to allocate to non-optimised parameter values   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$SearchRanges     </em> </td><td style="text-align: left;"> [numeric] matrix giving the ranges of raw parameters                               </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$StartParamList   </em> </td><td style="text-align: left;"> [numeric] matrix of parameter sets used for grid-screening calibration procedure   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$StartParamDistrib</em> </td><td style="text-align: left;"> [numeric] matrix of parameter values used for grid-screening calibration procedure </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Laurent Coron, Olivier Delaigue, Guillaume Thirel, David Dorchies
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Calibration">Calibration</a></code>, <code><a href="#topic+RunModel">RunModel</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123001)

## preparation of InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_GR4J, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E)

## calibration period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

## preparation of RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR4J,
                               InputsModel = InputsModel, IndPeriod_Run = Ind_Run)

## calibration criterion: preparation of the InputsCrit object
InputsCrit &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                               RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])

## preparation of CalibOptions object
CalibOptions &lt;- CreateCalibOptions(FUN_MOD = RunModel_GR4J, FUN_CALIB = Calibration_Michel)

## calibration
OutputsCalib &lt;- Calibration(InputsModel = InputsModel, RunOptions = RunOptions,
                            InputsCrit = InputsCrit, CalibOptions = CalibOptions,
                            FUN_MOD = RunModel_GR4J,
                            FUN_CALIB = Calibration_Michel)

## simulation
Param &lt;- OutputsCalib$ParamFinalR
OutputsModel &lt;- RunModel(InputsModel = InputsModel, RunOptions = RunOptions,
                         Param = Param, FUN = RunModel_GR4J)

## results preview
plot(OutputsModel, Qobs = BasinObs$Qmm[Ind_Run])

## efficiency criterion: Nash-Sutcliffe Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                                RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)

## efficiency criterion: Kling-Gupta Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_KGE, InputsModel = InputsModel,
                                RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_KGE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)
</code></pre>

<hr>
<h2 id='CreateErrorCrit_GAPX'>Creation of the ErrorCrit_GAPX function</h2><span id='topic+CreateErrorCrit_GAPX'></span>

<h3>Description</h3>

<p>Function which creates the function <code>ErrorCrit_GAPX</code>.
</p>
<p>The produced function <code>ErrorCrit_GAPX</code> allows computing an error criterion based on the GAPX formula proposed by Lavenne et al. (2019).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CreateErrorCrit_GAPX(FUN_TRANSFO)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="CreateErrorCrit_GAPX_+3A_fun_transfo">FUN_TRANSFO</code></td>
<td>
<p>[function] The parameter transformation function used with the model</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In addition to the criterion value, the function outputs include a multiplier (-1 or +1) that allows
the use of the function for model calibration: the product <code class="reqn">CritValue \times Multiplier</code> is the criterion to be minimised
(<code>Multiplier = -1</code> for NSE).
</p>


<h3>Value</h3>

<p>[function] function <code>ErrorCrit_GAPX</code> embedding the parameter transformation function used with the model
</p>


<h3>Author(s)</h3>

<p>David Dorchies
</p>


<h3>References</h3>

<p>de Lavenne, A., Andréassian, V., Thirel, G., Ramos, M.-H. and Perrin, C. (2019).
A Regularization Approach to Improve the Sequential Calibration of a Semidistributed Hydrological Model.
Water Resources Research 55, 8821–8839. <a href="https://doi.org/10.1029/2018WR024266">doi:10.1029/2018WR024266</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+CreateInputsCrit">CreateInputsCrit</a></code>, <code><a href="#topic+ErrorCrit_RMSE">ErrorCrit_RMSE</a></code>, <code><a href="#topic+ErrorCrit_NSE">ErrorCrit_NSE</a></code>,
<code><a href="#topic+ErrorCrit_KGE">ErrorCrit_KGE</a></code>, <code><a href="#topic+ErrorCrit_KGE2">ErrorCrit_KGE2</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123001)

## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_GR4J, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E)

## calibration period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

## preparation of RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR4J, InputsModel = InputsModel,
                               IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(X1 = 257.238, X2 = 1.012, X3 = 88.235, X4 = 2.208)
OutputsModel &lt;- RunModel_GR4J(InputsModel = InputsModel,
                              RunOptions = RunOptions, Param = Param)

## Creation of the ErrorCrit GAPX function
ErrorCrit_GAPX &lt;- CreateErrorCrit_GAPX(TransfoParam_GR4J)

## The "a priori" parameters for GAPX
AprParamR &lt;- c(X1 = 157, X2 = 0.8, X3 = 100, X4 = 1.5)
AprParamT &lt;- TransfoParam_GR4J(AprParamR, "RT")

## Single efficiency criterion: GAPX with a priori parameters
InputsCrit &lt;- CreateInputsCrit(ErrorCrit_GAPX,
                               InputsModel,
                               RunOptions,
                               Obs = AprParamT,
                               VarObs = "ParamT")
ErrorCrit &lt;- ErrorCrit_GAPX(InputsCrit, OutputsModel)
str(ErrorCrit)
</code></pre>

<hr>
<h2 id='CreateIniStates'>Creation of the IniStates object possibly required by the CreateRunOptions functions</h2><span id='topic+CreateIniStates'></span>

<h3>Description</h3>

<p>Creation of the <em>IniStates</em> object possibly required by the <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CreateIniStates(FUN_MOD, InputsModel,
                IsHyst = FALSE, IsIntStore = FALSE,
                ProdStore = 350, RoutStore = 90,
                ExpStore = NULL, IntStore = NULL,
                UH1 = NULL, UH2 = NULL,
                GCemaNeigeLayers = NULL, eTGCemaNeigeLayers = NULL,
                GthrCemaNeigeLayers = NULL, GlocmaxCemaNeigeLayers = NULL,
                SD = NULL, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="CreateIniStates_+3A_fun_mod">FUN_MOD</code></td>
<td>
<p>[function] hydrological model function (e.g. RunModel_GR4J, RunModel_CemaNeigeGR4J)</p>
</td></tr>
<tr><td><code id="CreateIniStates_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <code>InputsModel</code>] see <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> for details</p>
</td></tr>
<tr><td><code id="CreateIniStates_+3A_ishyst">IsHyst</code></td>
<td>
<p>[boolean] boolean indicating if the hysteresis version of CemaNeige is used. See details</p>
</td></tr>
<tr><td><code id="CreateIniStates_+3A_isintstore">IsIntStore</code></td>
<td>
<p>[boolean] boolean indicating if the interception store is used in GR5H. See details</p>
</td></tr>
<tr><td><code id="CreateIniStates_+3A_prodstore">ProdStore</code></td>
<td>
<p>[numeric] production store level [mm] for all GR models except GR1A</p>
</td></tr>
<tr><td><code id="CreateIniStates_+3A_routstore">RoutStore</code></td>
<td>
<p>[numeric] routing store level [mm] for all GR models except GR1A</p>
</td></tr>
<tr><td><code id="CreateIniStates_+3A_expstore">ExpStore</code></td>
<td>
<p>(optional) [numeric] series of exponential store level (negative) [mm] for the GR6J model</p>
</td></tr>
<tr><td><code id="CreateIniStates_+3A_intstore">IntStore</code></td>
<td>
<p>(optional) [numeric] series of rainfall neutralisation or interception store level [mm] for the GR5H model</p>
</td></tr>
<tr><td><code id="CreateIniStates_+3A_uh1">UH1</code></td>
<td>
<p>(optional) [numeric] unit hydrograph 1 levels [mm]</p>
</td></tr>
<tr><td><code id="CreateIniStates_+3A_uh2">UH2</code></td>
<td>
<p>(optional) [numeric] unit hydrograph 2 levels [mm]</p>
</td></tr>
<tr><td><code id="CreateIniStates_+3A_gcemaneigelayers">GCemaNeigeLayers</code></td>
<td>
<p>(optional) [numeric] snow pack [mm], possibly used to create the CemaNeige model initial state</p>
</td></tr>
<tr><td><code id="CreateIniStates_+3A_etgcemaneigelayers">eTGCemaNeigeLayers</code></td>
<td>
<p>(optional) [numeric] snow pack thermal state [°C], possibly used to create the CemaNeige model initial state</p>
</td></tr>
<tr><td><code id="CreateIniStates_+3A_gthrcemaneigelayers">GthrCemaNeigeLayers</code></td>
<td>
<p>(optional) [numeric] melt threshold [mm], possibly used to create the CemaNeige model initial state in case the Linear Hysteresis version is used</p>
</td></tr>
<tr><td><code id="CreateIniStates_+3A_glocmaxcemaneigelayers">GlocmaxCemaNeigeLayers</code></td>
<td>
<p>(optional) [numeric] local melt threshold for hysteresis [mm], possibly used to create the CemaNeige model initial state in case the Linear Hysteresis version is used</p>
</td></tr>
<tr><td><code id="CreateIniStates_+3A_sd">SD</code></td>
<td>
<p>(optional) [list] of [numeric] states of delayed upstream flows for semi-distributed models, the nature of the state and the unit depend on the model and the unit of the upstream flow</p>
</td></tr>
<tr><td><code id="CreateIniStates_+3A_verbose">verbose</code></td>
<td>
<p>(optional) [boolean] boolean indicating if the function is run in verbose mode or not, default = <code>TRUE</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>20 numeric values are required for UH1 and 40 numeric values are required for UH2 if GR4J, GR5J or GR6J are used (respectively 20*24 and 40*24 for the hourly models GR4H and GR5H). Please note that depending on the X4 parameter value that will be provided when running the model, not all the values may be used (only the first int(X4)+1 values are used for UH1 and the first 2*int(X4)+1 for UH2). <br />
<code>GCemaNeigeLayers</code> and <code>eTGCemaNeigeLayers</code> require each numeric values as many as given in <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> with the <code>NLayers</code> argument. <code>eTGCemaNeigeLayers</code> values can be negative.<br />
The structure of the object of class <code>IniStates</code> returned is always exactly the same for all models (except for the unit hydrographs levels that contain more values with GR4H and GR5H), even if some states do not exist (e.g. <em>$UH$UH1</em> for GR2M).  <br />
If CemaNeige is not used, <em>$CemaNeigeLayers$G</em>, <em>$CemaNeigeLayers$eTG</em> <em>$CemaNeigeLayers$GthrCemaNeigeLayers</em> and <em>$CemaNeigeLayers$GlocmaxCemaNeigeLayers</em> are set to <code>NA</code>. <br />
</p>
<p>Nota: the <code>StateEnd</code> objects from the outputs of <code>RunModel*</code> functions already respect the format given by the <code>CreateIniStates</code> function.
</p>


<h3>Value</h3>

<p>[list] object of class <code>IniStates</code> containing the initial model internal states; it always includes the following:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <em>$Store          </em> </td><td style="text-align: left;"> [numeric] list of store levels (<em>$Prod</em>, <em>$Rout</em> and <em>$Exp</em>) </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$UH             </em> </td><td style="text-align: left;"> [numeric] list of unit hydrographs levels (<em>$UH1</em> and <em>$UH2</em>) </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers</em> </td><td style="text-align: left;"> [numeric] list of CemaNeige variables (<em>$G</em>, <em>$eTG</em>, <em>$GthrCemaNeigeLayers</em> and <em>$GlocmaxCemaNeigeLayers</em>)
  </td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Olivier Delaigue
</p>


<h3>See Also</h3>

<p><code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123001)

## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_GR4J, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))


### preparation of the IniStates object with low values of ProdStore and RoutStore
IniStates &lt;- CreateIniStates(FUN_MOD = RunModel_GR4J, InputsModel = InputsModel,
                             ProdStore = 0, RoutStore = 0, ExpStore = NULL,
                             UH1 = c(0.52, 0.54, 0.15, rep(0, 17)),
                             UH2 = c(0.057, 0.042, 0.015, 0.005, rep(0, 36)),
                             GCemaNeigeLayers = NULL, eTGCemaNeigeLayers = NULL,
                             GthrCemaNeigeLayers = NULL, GlocmaxCemaNeigeLayers = NULL)
str(IniStates)

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR4J, InputsModel = InputsModel,
                               IndPeriod_WarmUp = 0L,
                               IndPeriod_Run = Ind_Run, IniStates = IniStates)

## simulation
Param &lt;- c(X1 = 257.238, X2 = 1.012, X3 = 88.235, X4 = 2.208)
OutputsModel &lt;- RunModel_GR4J(InputsModel = InputsModel,
                              RunOptions = RunOptions, Param = Param)

## results preview
plot(OutputsModel, Qobs = BasinObs$Qmm[Ind_Run])


### preparation of the IniStates object with high values of ProdStore and RoutStore
IniStates &lt;- CreateIniStates(FUN_MOD = RunModel_GR4J, InputsModel = InputsModel,
                             ProdStore = 450, RoutStore = 100, ExpStore = NULL,
                             UH1 = c(0.52, 0.54, 0.15, rep(0, 17)),
                             UH2 = c(0.057, 0.042, 0.015, 0.005, rep(0, 36)),
                             GCemaNeigeLayers = NULL, eTGCemaNeigeLayers = NULL,
                             GthrCemaNeigeLayers = NULL, GlocmaxCemaNeigeLayers = NULL)
str(IniStates)

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR4J, InputsModel = InputsModel,
                               IndPeriod_WarmUp = 0L,
                               IndPeriod_Run = Ind_Run, IniStates = IniStates)

## simulation
Param &lt;- c(X1 = 257.238, X2 = 1.012, X3 = 88.235, X4 = 2.208)
OutputsModel &lt;- RunModel_GR4J(InputsModel = InputsModel,
                              RunOptions = RunOptions, Param = Param)

## results preview
plot(OutputsModel, Qobs = BasinObs$Qmm[Ind_Run])
</code></pre>

<hr>
<h2 id='CreateInputsCrit'>Creation of the InputsCrit object required to the ErrorCrit functions</h2><span id='topic+CreateInputsCrit'></span>

<h3>Description</h3>

<p>Creation of the <code>InputsCrit</code> object required to the <code>ErrorCrit_*</code> functions. This function is used to define whether the user wants to calculate a single criterion, multiple criteria in the same time, or a composite criterion, which averages several criteria.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CreateInputsCrit(FUN_CRIT, InputsModel, RunOptions,
                 Obs, VarObs = "Q", BoolCrit = NULL,
                 transfo = "", Weights = NULL,
                 epsilon = NULL,
                 warnings = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="CreateInputsCrit_+3A_fun_crit">FUN_CRIT</code></td>
<td>
<p>[function (atomic or list)] error criterion function (e.g. <code><a href="#topic+ErrorCrit_RMSE">ErrorCrit_RMSE</a></code>, <code><a href="#topic+ErrorCrit_NSE">ErrorCrit_NSE</a></code>)</p>
</td></tr>
<tr><td><code id="CreateInputsCrit_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em>] see <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> for details</p>
</td></tr>
<tr><td><code id="CreateInputsCrit_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="CreateInputsCrit_+3A_obs">Obs</code></td>
<td>
<p>[numeric (atomic or list)] series of observed variable ([mm/time step] for discharge or SWE, [-] for SCA)</p>
</td></tr>
<tr><td><code id="CreateInputsCrit_+3A_varobs">VarObs</code></td>
<td>
<p>(optional) [character (atomic or list)] names of the observed variable (<code>"Q"</code> by default, or one of <code>"SCA"</code>, <code>"SWE"</code>])</p>
</td></tr>
<tr><td><code id="CreateInputsCrit_+3A_boolcrit">BoolCrit</code></td>
<td>
<p>(optional) [boolean (atomic or list)] boolean (the same length as <code>Obs</code>) giving the time steps to consider in the computation (all time steps are considered by default. See details)</p>
</td></tr>
<tr><td><code id="CreateInputsCrit_+3A_transfo">transfo</code></td>
<td>
<p>(optional) [character (atomic or list)] name of the transformation applied to the variables (e.g. <code>""</code>, <code>"sqrt"</code>, <code>"log"</code>, <code>"inv"</code>, <code>"sort"</code>, <code>"boxcox"</code> or a numeric value for power transformation . See details)</p>
</td></tr>
<tr><td><code id="CreateInputsCrit_+3A_weights">Weights</code></td>
<td>
<p>(optional) [numeric (atomic or list)] vector of weights necessary to calculate a composite criterion (the same length as <code>FUN_CRIT</code>) giving the weights to use for elements of <code>FUN_CRIT</code> [-]. See details</p>
</td></tr>
<tr><td><code id="CreateInputsCrit_+3A_epsilon">epsilon</code></td>
<td>
<p>(optional) [numeric (atomic or list)] small value to add to all observations and simulations when <code>"log"</code> or <code>"inv"</code> transformations are used [same unit as <code>Obs</code>]. See details</p>
</td></tr>
<tr><td><code id="CreateInputsCrit_+3A_warnings">warnings</code></td>
<td>
<p>(optional) [boolean] boolean indicating if the warning messages are shown, default = <code>TRUE</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Users wanting to use <code>FUN_CRIT</code> functions that are not included in the package must create their own InputsCrit object accordingly. <br /> <br />
</p>
<p>## &mdash; Period of calculation
</p>
<p>Criteria can be calculated over discontinuous periods (i.e. only over winter periods, or when observed discharge is below a certain threshold). To do so, please indicate in <code>Bool_Crit</code> which indices must be used for calcullation. Discontinuous periods are allowed in the <code>Bool_Crit</code> argument.
</p>
<p>## &mdash; Transformations
</p>
<p>Transformations are simple functions applied to the observed and simulated variables used in order to change their distribution. Transformations are often used in hydrology for modifying the weight put on errors made for high flows or low flows. The following transformations are available: <br /> <br />
</p>

<ul>
<li> <p><code>""</code>: no transformation is used (default case)
</p>
</li>
<li> <p><code>"sqrt"</code>: squared root transformation
</p>
</li>
<li> <p><code>"log"</code>: logarithmic transformation (see below regarding the specific case of KGE or KGE2)
</p>
</li>
<li> <p><code>"inv"</code>: inverse transformation
</p>
</li>
<li> <p><code>"sort"</code>: sort transformation (the simulated and observed variables are sorted from lowest to highest)
</p>
</li>
<li> <p><code>"boxcox"</code>: Box-Cox transformation (see below for details)
</p>
</li>
<li><p> numeric: power transformation (see below for details)
</p>
</li></ul>

<p>We do not advise computing KGE or KGE' with log-transformation as it might be wrongly influenced by discharge values close to 0 or 1 and the criterion value is dependent on the discharge unit. See Santos et al. (2018) for more details and alternative solutions (see the references list below). <br /> <br />
In order to make sure that KGE and KGE2 remain dimensionless and are not impacted by zero values, the Box-Cox transformation (<code>transfo = "boxcox"</code>) uses the formulation given in Equation 10 of Santos et al. (2018). Lambda is set to 0.25 accordingly. <br /> <br />
The syntax of the power transformation allows a numeric or a string of characters. For example for a squared transformation, the following can be used: <code>transfo = 2</code>, <code>transfo = "2"</code> or <code>transfo = "^2"</code>. Negative values are allowed. Fraction values are not allowed (e.g., <code>"-1/2"</code> must instead be written <code>"-0.5"</code>).<br /> <br />
</p>
<p>## &mdash; The epsilon value
</p>
<p>The epsilon value is useful when <code>"log"</code> or <code>"inv"</code> transformations are used (to avoid calculation of the inverse or of the logarithm of zero). If an epsilon value is provided, then it is added to the observed and simulated variable time series at each time step and before the application of a transformation. The epsilon value has no effect when the <code>"boxcox"</code> transformation is used. The impact of this value and a recommendation about the epsilon value to use (usually one hundredth of average observation) are discussed in Pushpalatha et al. (2012) for NSE and in Santos et al. (2018) for KGE and KGE'. <br /> <br />
</p>
<p>## &mdash; Single, multiple or composite criteria calculation
</p>
<p>Users can set the following arguments as atomic or list: <code>FUN_CRIT</code>, <code>Obs</code>, <code>VarObs</code>, <code>BoolCrit</code>, <code>transfo</code>, <code>Weights</code>. If the list format is chosen, all the lists must have the same length. <br />
Calculation of a single criterion (e.g. NSE computed on discharge) is prepared by providing to <code>CreateInputsCrit</code> arguments atomics only. <br />
Calculation of multiple criteria (e.g. NSE computed on discharge and RMSE computed on discharge) is prepared by providing to <code>CreateInputsCrit</code> arguments lists except for <code>Weights</code> that must be set as <code>NULL</code>. <br />
Calculation of a composite criterion (e.g. the average between NSE computed on discharge and NSE computed on log of discharge) is prepared by providing to <code>CreateInputsCrit</code> arguments lists including <code>Weights</code>. <br />
<code><a href="#topic+ErrorCrit_RMSE">ErrorCrit_RMSE</a></code> cannot be used in a composite criterion since it is not a unitless value.
</p>


<h3>Value</h3>

<p>[list] object of class <em>InputsCrit</em> containing the data required to evaluate the model outputs; it can include the following:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <em>$FUN_CRIT  </em> </td><td style="text-align: left;"> [function] error criterion function (e.g. <code><a href="#topic+ErrorCrit_RMSE">ErrorCrit_RMSE</a></code>, <code><a href="#topic+ErrorCrit_NSE">ErrorCrit_NSE</a></code>) </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Obs       </em> </td><td style="text-align: left;"> [numeric] series of observed variable(s) ([mm/time step] for discharge or SWE, [-] for SCA) </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$VarObs    </em> </td><td style="text-align: left;"> [character] names of the observed variable(s) </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$BoolCrit  </em> </td><td style="text-align: left;"> [boolean] boolean giving the time steps considered in the computation </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$transfo   </em> </td><td style="text-align: left;"> [character] name of the transformation (e.g. <code>""</code>, <code>"sqrt"</code>, <code>"log"</code>, <code>"inv"</code>, <code>"sort"</code>, <code>"boxcox"</code> or a number for power transformation) </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$epsilon   </em> </td><td style="text-align: left;"> [numeric] small value to add to all observations and simulations when <code>"log"</code> or <code>"inv"</code> transformations are used [same unit as <code>Obs</code>] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Weights   </em> </td><td style="text-align: left;"> [numeric] vector (same length as <code>VarObs</code>) giving the weights to use for elements of <code>FUN_CRIT</code> [-] </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>

<p>When <code>Weights = NULL</code>, <code>CreateInputsCrit</code> returns an object of class <em>Single</em> that is  a list such as the one described above. <br />
When <code>Weights</code> contains at least one <code>NULL</code> value and <code>Obs</code> contains a list of observations, <code>CreateInputsCrit</code> returns an object of class <em>Multi</em> that is a list of lists such as the one described above. The <code><a href="#topic+ErrorCrit">ErrorCrit</a></code> function will then compute the different criteria prepared by <code>CreateInputsCrit</code>. <br />
When <code>Weights</code> is a list of at least 2 numerical values, <code>CreateInputsCrit</code> returns an object of class <em>Compo</em> that is a list of lists such as the one described above. This object will be useful to compute composite criterion with the <code><a href="#topic+ErrorCrit">ErrorCrit</a></code> function. <br />
To calculate composite or multiple criteria, it is necessary to use the <code>ErrorCrit</code> function. The other <code>ErrorCrit_*</code> functions (e.g. <code><a href="#topic+ErrorCrit_RMSE">ErrorCrit_RMSE</a></code>, <code><a href="#topic+ErrorCrit_NSE">ErrorCrit_NSE</a></code>) can only use objects of class <em>Single</em> (and not <em>Multi</em> or <em>Compo</em>). <br />
</p>


<h3>Author(s)</h3>

<p>Olivier Delaigue, Laurent Coron, Guillaume Thirel
</p>


<h3>References</h3>

<p>Pushpalatha, R., Perrin, C., Le Moine, N. and Andréassian, V. (2012).
A review of efficiency criteria suitable for evaluating low-flow simulations.
Journal of Hydrology, 420-421, 171-182, doi: 10.1016/j.jhydrol.2011.11.055.
<br /><br />
Santos, L., Thirel, G. and Perrin, C. (2018).
Technical note: Pitfalls in using log-transformed flows within the KGE criterion.
Hydrol. Earth Syst. Sci., 22, 4583-4591, doi: 10.5194/hess-22-4583-2018.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+RunModel">RunModel</a></code>, <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>, <code><a href="#topic+CreateCalibOptions">CreateCalibOptions</a></code>, <code><a href="#topic+ErrorCrit">ErrorCrit</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123001)

## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_GR4J, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E)

## calibration period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

## preparation of RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR4J, InputsModel = InputsModel,
                               IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(X1 = 257.238, X2 = 1.012, X3 = 88.235, X4 = 2.208)
OutputsModel &lt;- RunModel_GR4J(InputsModel = InputsModel, RunOptions = RunOptions, Param = Param)

## single efficiency criterion: Nash-Sutcliffe Efficiency
InputsCritSingle &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE,
                                     InputsModel = InputsModel, RunOptions = RunOptions,
                                     Obs = list(BasinObs$Qmm[Ind_Run]),
                                     VarObs = "Q", transfo = "",
                                     Weights = NULL)
str(InputsCritSingle)
invisible(ErrorCrit(InputsCrit = InputsCritSingle, OutputsModel = OutputsModel))

## 2 efficiency criteria: RMSE and Nash-Sutcliffe Efficiency
InputsCritMulti &lt;- CreateInputsCrit(FUN_CRIT = list(ErrorCrit_RMSE, ErrorCrit_NSE),
                                    InputsModel = InputsModel, RunOptions = RunOptions,
                                    Obs = list(BasinObs$Qmm[Ind_Run],
                                               BasinObs$Qmm[Ind_Run]),
                                    VarObs = list("Q", "Q"), transfo = list("", "sqrt"),
                                    Weights = NULL)
str(InputsCritMulti)
invisible(ErrorCrit(InputsCrit = InputsCritMulti, OutputsModel = OutputsModel))

## efficiency composite criterion: Nash-Sutcliffe Efficiency mixing
##                                 both raw and log-transformed flows
InputsCritCompo &lt;- CreateInputsCrit(FUN_CRIT = list(ErrorCrit_NSE, ErrorCrit_NSE),
                                    InputsModel = InputsModel, RunOptions = RunOptions,
                                    Obs = list(BasinObs$Qmm[Ind_Run],
                                               BasinObs$Qmm[Ind_Run]),
                                    VarObs = list("Q", "Q"), transfo = list("", "log"),
                                    Weights = list(0.4, 0.6))
str(InputsCritCompo)
invisible(ErrorCrit(InputsCrit = InputsCritCompo, OutputsModel = OutputsModel))
</code></pre>

<hr>
<h2 id='CreateInputsCrit_Lavenne'>Creation of the InputsCrit object for Lavenne Criterion</h2><span id='topic+CreateInputsCrit_Lavenne'></span>

<h3>Description</h3>

<p>Creation of the <code>InputsCrit</code> object required to the <code><a href="#topic+ErrorCrit">ErrorCrit</a></code> function. This function defines a composite criterion based on the formula proposed by Lavenne et al. (2019).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CreateInputsCrit_Lavenne(FUN_CRIT = ErrorCrit_KGE,
                         InputsModel,
                         RunOptions,
                         Obs,
                         VarObs = "Q",
                         AprParamR,
                         AprCrit = 1,
                         k = 0.15,
                         BoolCrit = NULL,
                         transfo = "sqrt",
                         epsilon = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="CreateInputsCrit_Lavenne_+3A_fun_crit">FUN_CRIT</code></td>
<td>
<p>[function] error criterion function (e.g. <code><a href="#topic+ErrorCrit_KGE">ErrorCrit_KGE</a></code>, <code><a href="#topic+ErrorCrit_NSE">ErrorCrit_NSE</a></code>). Default <code><a href="#topic+ErrorCrit_KGE">ErrorCrit_KGE</a></code></p>
</td></tr>
<tr><td><code id="CreateInputsCrit_Lavenne_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em>] see <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> for details</p>
</td></tr>
<tr><td><code id="CreateInputsCrit_Lavenne_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="CreateInputsCrit_Lavenne_+3A_obs">Obs</code></td>
<td>
<p>[numeric (atomic or list)] series of observed variable ([mm/time step] for discharge or SWE, [-] for SCA)</p>
</td></tr>
<tr><td><code id="CreateInputsCrit_Lavenne_+3A_varobs">VarObs</code></td>
<td>
<p>(optional) [character (atomic or list)] names of the observed variable (<code>"Q"</code> by default, or one of <code>"SCA"</code>, <code>"SWE"</code>)</p>
</td></tr>
<tr><td><code id="CreateInputsCrit_Lavenne_+3A_aprparamr">AprParamR</code></td>
<td>
<p>[numeric] a priori parameter set from a donor catchment</p>
</td></tr>
<tr><td><code id="CreateInputsCrit_Lavenne_+3A_aprcrit">AprCrit</code></td>
<td>
<p>(optional) [numeric] performance criterion of the donor catchment (1 by default)</p>
</td></tr>
<tr><td><code id="CreateInputsCrit_Lavenne_+3A_k">k</code></td>
<td>
<p>(optional) [numeric] coefficient used for the weighted average between <code>FUN_CRIT</code> and the gap between the optimised parameter set and an a priori parameter set calculated with the function produced by <code><a href="#topic+CreateErrorCrit_GAPX">CreateErrorCrit_GAPX</a></code></p>
</td></tr>
<tr><td><code id="CreateInputsCrit_Lavenne_+3A_boolcrit">BoolCrit</code></td>
<td>
<p>(optional) [boolean] boolean (the same length as <code>Obs</code>) giving the time steps to consider in the computation (all time steps are considered by default. See details)</p>
</td></tr>
<tr><td><code id="CreateInputsCrit_Lavenne_+3A_transfo">transfo</code></td>
<td>
<p>(optional) [character] name of the transformation applied to the variables (e.g. <code>""</code>, <code>"sqrt"</code>, <code>"log"</code>, <code>"inv"</code>, <code>"sort"</code>, <code>"boxcox"</code> or a numeric value for power transformation for <code>FUN_CRIT</code>. Default value is <code>"sqrt"</code>. See details of <code><a href="#topic+CreateInputsCrit">CreateInputsCrit</a></code></p>
</td></tr>
<tr><td><code id="CreateInputsCrit_Lavenne_+3A_epsilon">epsilon</code></td>
<td>
<p>(optional) [numeric] small value to add to all observations and simulations for <code>FUN_CRIT</code> when <code>"log"</code> or <code>"inv"</code> transformations are used [same unit as <code>Obs</code>]. See details of <code><a href="#topic+CreateInputsCrit">CreateInputsCrit</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The parameters <code>FUN_CRIT</code>, <code>Obs</code>, <code>VarObs</code>, <code>BoolCrit</code>, <code>transfo</code>, and <code>epsilon</code> must be used as they would be used for <code><a href="#topic+CreateInputsCrit">CreateInputsCrit</a></code> in the case of a single criterion.
</p>
<p><code><a href="#topic+ErrorCrit_RMSE">ErrorCrit_RMSE</a></code> cannot be used in a composite criterion since it is not a unitless value.
</p>
<p><code>CreateInputsCrit_Lavenne</code> creates a composite criterion in respect with Equations 1 and 2 of de Lavenne et al. (2019).
</p>


<h3>Value</h3>

<p>[list] object of class InputsCrit containing the data required to evaluate the model outputs (see <code><a href="#topic+CreateInputsCrit">CreateInputsCrit</a></code> for more details).
</p>
<p><code>CreateInputsCrit_Lavenne</code> returns an object of class <em>Compo</em>.
</p>
<p>Items <code>Weights</code> of the criteria are respectively equal to <code>k</code> and <code>k * max(0, AprCrit)</code>.
</p>
<p>To calculate the Lavenne criterion, it is necessary to use the <code>ErrorCrit</code> function as for any other composite criterion.
</p>


<h3>Author(s)</h3>

<p>David Dorchies
</p>


<h3>References</h3>

<p>de Lavenne, A., Andréassian, V., Thirel, G., Ramos, M.-H. and Perrin, C. (2019).
A Regularization Approach to Improve the Sequential Calibration of a Semidistributed Hydrological Model.
Water Resources Research 55, 8821–8839. <a href="https://doi.org/10.1029/2018WR024266">doi:10.1029/2018WR024266</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+RunModel">RunModel</a></code>, <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>, <code><a href="#topic+CreateCalibOptions">CreateCalibOptions</a></code>, <code><a href="#topic+ErrorCrit">ErrorCrit</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123001)

## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_GR4J, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E)

## calibration period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

## preparation of RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR4J, InputsModel = InputsModel,
                               IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(X1 = 257.238, X2 = 1.012, X3 = 88.235, X4 = 2.208)
OutputsModel &lt;- RunModel_GR4J(InputsModel = InputsModel,
                              RunOptions = RunOptions, Param = Param)

## The "a priori" parameters for the Lavenne formula
AprParamR &lt;- c(X1 = 157, X2 = 0.8, X3 = 100, X4 = 1.5)

## Single efficiency criterion: GAPX with a priori parameters
IC_DL &lt;- CreateInputsCrit_Lavenne(InputsModel = InputsModel,
                                    RunOptions = RunOptions,
                                    Obs = BasinObs$Qmm[Ind_Run],
                                    AprParamR = AprParamR)
str(ErrorCrit(InputsCrit = IC_DL, OutputsModel = OutputsModel))
</code></pre>

<hr>
<h2 id='CreateInputsModel'>Creation of the InputsModel object required to the RunModel functions</h2><span id='topic+CreateInputsModel'></span><span id='topic++5B.InputsModel'></span>

<h3>Description</h3>

<p>Creation of the <em>InputsModel</em> object required to the <code>RunModel*</code> functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CreateInputsModel(FUN_MOD, DatesR, Precip, PrecipScale = TRUE, PotEvap = NULL,
                  TempMean = NULL, TempMin = NULL, TempMax = NULL,
                  ZInputs = NULL, HypsoData = NULL, NLayers = 5,
                  Qupstream = NULL, LengthHydro = NULL, BasinAreas = NULL,
                  QupstrUnit = "mm", verbose = TRUE)

## S3 method for class 'InputsModel'
x[i]
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="CreateInputsModel_+3A_fun_mod">FUN_MOD</code></td>
<td>
<p>[function] hydrological model function (e.g. <code>RunModel_GR4J</code>, <code>RunModel_CemaNeigeGR4J</code>)</p>
</td></tr>
<tr><td><code id="CreateInputsModel_+3A_datesr">DatesR</code></td>
<td>
<p>[POSIXt] vector of dates required to create the GR model and CemaNeige module inputs</p>
</td></tr>
<tr><td><code id="CreateInputsModel_+3A_precip">Precip</code></td>
<td>
<p>[numeric] time series of total precipitation (catchment average) [mm/time step], required to create the GR model and CemaNeige module inputs</p>
</td></tr>
<tr><td><code id="CreateInputsModel_+3A_precipscale">PrecipScale</code></td>
<td>
<p>(optional) [boolean] indicating if the mean of the precipitation interpolated on the elevation layers must be kept or not, required to create CemaNeige module inputs, default = <code>TRUE</code> (the mean of the precipitation is kept to the original value)</p>
</td></tr>
<tr><td><code id="CreateInputsModel_+3A_potevap">PotEvap</code></td>
<td>
<p>[numeric] time series of potential evapotranspiration (catchment average) [mm/time step], required to create the GR model inputs</p>
</td></tr>
<tr><td><code id="CreateInputsModel_+3A_tempmean">TempMean</code></td>
<td>
<p>(optional) [numeric] time series of mean air temperature [°C], required to create the CemaNeige module inputs</p>
</td></tr>
<tr><td><code id="CreateInputsModel_+3A_tempmin">TempMin</code></td>
<td>
<p>(optional) [numeric] time series of min air temperature [°C], possibly used to create the CemaNeige module inputs</p>
</td></tr>
<tr><td><code id="CreateInputsModel_+3A_tempmax">TempMax</code></td>
<td>
<p>(optional) [numeric] time series of max air temperature [°C], possibly used to create the CemaNeige module inputs</p>
</td></tr>
<tr><td><code id="CreateInputsModel_+3A_zinputs">ZInputs</code></td>
<td>
<p>(optional) [numeric] real giving the mean elevation of the Precip and Temp series (before extrapolation) [m], possibly used to create the CemaNeige module inputs</p>
</td></tr>
<tr><td><code id="CreateInputsModel_+3A_hypsodata">HypsoData</code></td>
<td>
<p>(optional) [numeric] vector of 101 reals: min, q01 to q99 and max of catchment elevation distribution [m], if not defined a single elevation is used for CemaNeige</p>
</td></tr>
<tr><td><code id="CreateInputsModel_+3A_nlayers">NLayers</code></td>
<td>
<p>(optional) [numeric] integer giving the number of elevation layers requested [-], required to create CemaNeige module inputs, default=5</p>
</td></tr>
<tr><td><code id="CreateInputsModel_+3A_verbose">verbose</code></td>
<td>
<p>(optional) [boolean] boolean indicating if the function is run in verbose mode or not, default = <code>TRUE</code></p>
</td></tr>
<tr><td><code id="CreateInputsModel_+3A_qupstream">Qupstream</code></td>
<td>
<p>(optional) [numerical matrix] time series of upstream flows (catchment average), its unit is defined by the <code>QupstrUnit</code> parameter, required to create the SD model inputs. See details</p>
</td></tr>
<tr><td><code id="CreateInputsModel_+3A_lengthhydro">LengthHydro</code></td>
<td>
<p>(optional) [numeric] real giving the distance between the downstream outlet and each upstream inlet of the sub-catchment [km], required to create the SD model inputs . See details</p>
</td></tr>
<tr><td><code id="CreateInputsModel_+3A_basinareas">BasinAreas</code></td>
<td>
<p>(optional) [numeric] real giving the area of each upstream sub-catchment [km2] and the area of the downstream sub-catchment in the last item, required to create the SD model inputs . See details</p>
</td></tr>
<tr><td><code id="CreateInputsModel_+3A_qupstrunit">QupstrUnit</code></td>
<td>
<p>(optional) [character] unit of the flow in the argument <code>Qupstream</code>, available units are: &quot;mm&quot; for mm/time-step (default), &quot;m3&quot; for m3/time-step, &quot;m3/s&quot; and &quot;l/s&quot;. See details</p>
</td></tr>
<tr><td><code id="CreateInputsModel_+3A_x">x</code></td>
<td>
<p>[InputsModel] object of class InputsModel</p>
</td></tr>
<tr><td><code id="CreateInputsModel_+3A_i">i</code></td>
<td>
<p>[integer] of the indices to subset a time series or [character] names of the elements to extract</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Users wanting to use <code>FUN_MOD</code> functions that are not included in
the package must create their own InputsModel object accordingly. <br />
Please note that if CemaNeige is used, and <code>ZInputs</code> is different than <code>HypsoData</code>, then precipitation and temperature are interpolated with the <code>DataAltiExtrapolation_Valery</code> function.
</p>
<p>Users wanting to use a semi-distributed (SD) model should provide valid <code>Qupstream</code>, <code>LengthHydro</code>, and <code>BasinAreas</code> arguments. Each upstream sub-catchment is described by an upstream flow time series (one column in <code>Qupstream</code> matrix), a distance between the downstream outlet and the upstream inlet (one item in <code>LengthHydro</code>) and an area (one item in <code>BasinAreas</code>).
The order of the columns or of the items should be consistent for all these parameters.
<code>BasinAreas</code> should contain one extra information (stored in the last item) which is the area of the downstream sub-catchment.
Upstream flows that are not related to a sub-catchment such as release or withdraw spots are identified by an area equal to <code>NA</code>, and if <code>unit="mm"</code> the upstream flow must be expressed in m3/time step instead of mm/time step which is not possible in absence of a related area.
Please note that the use of SD model requires to use the <code><a href="#topic+RunModel">RunModel</a></code> function instead of <code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code> or the other <code>RunModel_*</code> functions.
</p>


<h3>Value</h3>

<p>[list] object of class <em>InputsModel</em> containing the data required to evaluate the model outputs; it can include the following:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <em>$DatesR              </em> </td><td style="text-align: left;"> [POSIXlt] vector of dates </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Precip              </em> </td><td style="text-align: left;"> [numeric] time series of total precipitation (catchment average) [mm/time step] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$PotEvap             </em> </td><td style="text-align: left;"> [numeric] time series of potential evapotranspiration (catchment average) [mm/time step], </td>
</tr>
<tr>
 <td style="text-align: left;"></td><td style="text-align: left;"> defined if FUN_MOD includes GR4H, GR5H, GR4J, GR5J, GR6J, GR2M or GR1A </td>
</tr>
<tr>
 <td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$LayerPrecip         </em> </td><td style="text-align: left;"> [list] list of time series of precipitation (layer average) [mm/time step], </td>
</tr>
<tr>
 <td style="text-align: left;"></td><td style="text-align: left;"> defined if <code>FUN_MOD</code> includes CemaNeige </td>
</tr>
<tr>
 <td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$LayerTempMean       </em> </td><td style="text-align: left;"> [list] list of time series of mean air temperature (layer average) [°C], </td>
</tr>
<tr>
 <td style="text-align: left;"></td><td style="text-align: left;"> defined if <code>FUN_MOD</code> includes CemaNeige </td>
</tr>
<tr>
 <td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$LayerFracSolidPrecip</em> </td><td style="text-align: left;"> [list] list of time series of solid precipitation fraction (layer average) [-], </td>
</tr>
<tr>
 <td style="text-align: left;"></td><td style="text-align: left;"> defined if <code>FUN_MOD</code> includes CemaNeige </td>
</tr>
<tr>
 <td style="text-align: left;"> </td>
</tr>
<tr>
 <td style="text-align: left;">
         </td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Laurent Coron
</p>


<h3>See Also</h3>

<p><code><a href="#topic+RunModel">RunModel</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>, <code><a href="#topic+CreateInputsCrit">CreateInputsCrit</a></code>,
<code><a href="#topic+CreateCalibOptions">CreateCalibOptions</a></code>, <code><a href="#topic+DataAltiExtrapolation_Valery">DataAltiExtrapolation_Valery</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123001)

## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_GR4J, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR4J,
                               InputsModel = InputsModel, IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(X1 = 734.568, X2 = -0.840, X3 = 109.809, X4 = 1.971)
OutputsModel &lt;- RunModel(InputsModel = InputsModel,
                         RunOptions = RunOptions, Param = Param,
                         FUN_MOD = RunModel_GR4J)

## results preview
plot(OutputsModel, Qobs = BasinObs$Qmm[Ind_Run])

## efficiency criterion: Nash-Sutcliffe Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                                RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)
</code></pre>

<hr>
<h2 id='CreateRunOptions'>Creation of the RunOptions object required to the RunModel functions</h2><span id='topic+CreateRunOptions'></span>

<h3>Description</h3>

<p>Creation of the RunOptions object required to the <code>RunModel*</code> functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CreateRunOptions(FUN_MOD, InputsModel,
                 IndPeriod_WarmUp = NULL, IndPeriod_Run,
                 IniStates = NULL, IniResLevels = NULL, Imax = NULL,
                 Outputs_Cal = NULL, Outputs_Sim = "all",
                 MeanAnSolidPrecip = NULL, IsHyst = FALSE,
                 warnings = TRUE, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="CreateRunOptions_+3A_fun_mod">FUN_MOD</code></td>
<td>
<p>[function] hydrological model function (e.g. <code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code>, <code><a href="#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code>)</p>
</td></tr>
<tr><td><code id="CreateRunOptions_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em>] see <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> for details</p>
</td></tr>
<tr><td><code id="CreateRunOptions_+3A_indperiod_warmup">IndPeriod_WarmUp</code></td>
<td>
<p>(optional) [numeric] index of period to be used for the model warm-up [-]. See details</p>
</td></tr>
<tr><td><code id="CreateRunOptions_+3A_indperiod_run">IndPeriod_Run</code></td>
<td>
<p>[numeric] index of period to be used for the model run [-]. See details</p>
</td></tr>
<tr><td><code id="CreateRunOptions_+3A_inistates">IniStates</code></td>
<td>
<p>(optional) [numeric] object of class <code>IniStates</code> [mm and °C], see <code><a href="#topic+CreateIniStates">CreateIniStates</a></code> for details</p>
</td></tr>
<tr><td><code id="CreateRunOptions_+3A_inireslevels">IniResLevels</code></td>
<td>
<p>(optional) [numeric] vector of initial fillings for the GR stores (4 values; use NA when not relevant for a given model) [- and/or mm]. See details</p>
</td></tr>
<tr><td><code id="CreateRunOptions_+3A_imax">Imax</code></td>
<td>
<p>(optional) [numeric] an atomic vector of the maximum capacity of the GR5H interception store [mm]; see <code><a href="#topic+RunModel_GR5H">RunModel_GR5H</a></code></p>
</td></tr>
<tr><td><code id="CreateRunOptions_+3A_outputs_cal">Outputs_Cal</code></td>
<td>
<p>(optional) [character] vector giving the outputs needed for the calibration <br /> (e.g. c(&quot;Qsim&quot;)), the fewer outputs
the faster the calibration</p>
</td></tr>
<tr><td><code id="CreateRunOptions_+3A_outputs_sim">Outputs_Sim</code></td>
<td>
<p>(optional) [character] vector giving the requested outputs <br /> (e.g. c(<code>"DatesR"</code>, <code>"Qsim"</code>, <code>"SnowPack"</code>)), default = <code>"all"</code></p>
</td></tr>
<tr><td><code id="CreateRunOptions_+3A_meanansolidprecip">MeanAnSolidPrecip</code></td>
<td>
<p>(optional) [numeric] vector giving the annual mean of average solid precipitation for each layer (computed from InputsModel if not defined) [mm/y]</p>
</td></tr>
<tr><td><code id="CreateRunOptions_+3A_ishyst">IsHyst</code></td>
<td>
<p>[boolean] boolean indicating if the hysteresis version of CemaNeige is used. See details</p>
</td></tr>
<tr><td><code id="CreateRunOptions_+3A_warnings">warnings</code></td>
<td>
<p>(optional) [boolean]  boolean indicating if the warning messages are shown, default = <code>TRUE</code></p>
</td></tr>
<tr><td><code id="CreateRunOptions_+3A_verbose">verbose</code></td>
<td>
<p>(optional) [boolean] boolean indicating if the function is run in verbose mode or not, default = <code>TRUE</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Users wanting to use <code>FUN_MOD</code> functions that are not included in
the package must create their own <code>RunOptions</code> object accordingly.
</p>
<p>## &mdash; IndPeriod_WarmUp and IndPeriod_Run
</p>
<p>Since the hydrological models included in airGR are continuous models, meaning that internal states of the models are propagated to the next time step, <code>IndPeriod_WarmUp</code> and <code>IndPeriod_Run</code> must be continuous periods, represented by continuous indices values; no gaps are allowed. To calculate criteria or to calibrate a model over discontinuous periods, please see the <code>Bool_Crit</code> argument of the <code><a href="#topic+CreateInputsCrit">CreateInputsCrit</a></code> function.
</p>
<p>## &mdash; Initialisation options
</p>
<p>The model initialisation options can either be set to a default configuration or be defined by the user.
</p>
<p>This is done via three vectors: <br /> <code>IndPeriod_WarmUp</code>, <code>IniStates</code>, <code>IniResLevels</code>. <br />
A default configuration is used for initialisation if these vectors are not defined.
</p>
<p>(1) Default initialisation options:
</p>

<ul>
<li> <p><code>IndPeriod_WarmUp</code> default setting ensures a one-year warm-up using the time steps preceding the <code>IndPeriod_Run</code>.
The actual length of this warm-up might be shorter depending on data availability (no missing value of climate inputs being allowed in model input series).
</p>
</li>
<li> <p><code>IniStates</code> and <code>IniResLevels</code> are automatically set to initialise all the model states at 0, except for the production and routing stores levels which are respectively initialised at 30 % and 50 % of their capacity. In case GR5H is used with an interception store, the intercetion store level is initialised by default with 0 mm. In case GR6J is used, the exponential store level is initialised by default with 0 mm. This initialisation is made at the very beginning of the model call (i.e. at the beginning of <code>IndPeriod_WarmUp</code> or at the beginning of <code>IndPeriod_Run</code> if the warm-up period is disabled).
</p>
</li></ul>

<p>(2) Customisation of initialisation options:
</p>

<ul>
<li> <p><code>IndPeriod_WarmUp</code> can be used to specify the indices of the warm-up period (within the time series prepared in InputsModel).
</p>

<ul>
<li><p> remark 1:	for most common cases, indices corresponding to one or several years preceding <code>IndPeriod_Run</code> are used (e.g. <code>IndPeriod_WarmUp = 1000:1365</code> and <code>IndPeriod_Run = 1366:5000)</code>. <br />
However, it is also possible to perform a long-term initialisation if other indices than the warm-up ones are set in <code>IndPeriod_WarmUp</code> (e.g. <code>IndPeriod_WarmUp = c(1:5000, 1:5000, 1:5000, 1000:1365)</code>). <br />
</p>
</li>
<li><p> remark 2:	it is also possible to completely disable the warm-up period when using <code>IndPeriod_WarmUp = 0L</code>. This is necessary if you want <code>IniStates</code> and/or <code>IniResLevels</code> to be the actual initial values of the model variables from your simulation (e.g. to perform a forecast form a given initial state).
</p>
</li></ul>

</li>
<li> <p><code>IniStates</code> and <code>IniResLevels</code> can be used to specify the initial model states.
</p>

<ul>
<li><p> remark 1: <code>IniStates</code> and <code>IniResLevels</code> can not be used with GR1A. <br />
</p>
</li>
<li><p> remark 2:	if <code>IniStates</code> is used, two possibilities are offered:<br />
- <code>IniStates</code> can be set to the <em>$StateEnd</em> output of a previous <code>RunModel</code> call, as <em>$StateEnd</em> already respects the correct format; <br />
- <code>IniStates</code> can be created with the <code><a href="#topic+CreateIniStates">CreateIniStates</a></code> function.
</p>
</li>
<li><p> remark 3:	in addition to <code>IniStates</code>, <code>IniResLevels</code> allows to set the filling rate of the production and routing stores for the GR models. For instance for GR4J and GR5J: <code>IniResLevels = c(0.3, 0.5, NA, NA)</code> should be used to obtain initial fillings of 30 % and 50 % for the production and routing stores, respectively. For GR6J, <code>IniResLevels = c(0.3, 0.5, 0, NA)</code> should be used to obtain initial fillings of 30 % and 50 % for the production and routing stores levels and 0 mm for the exponential store level, respectively. For GR5H with an interception store, <code>IniResLevels = c(0.3, 0.5, NA, 0.4)</code> should be used to obtain initial fillings of 30 %, 50 % and 40 % for the production, routing and interception stores levels, respectively. <code>IniResLevels</code> is optional and can only be used if <code>IniStates</code> is also defined (the state values corresponding to these two other stores in <code>IniStates</code> are not used in such case).
</p>
</li></ul>

</li></ul>

<p>## &mdash; CemaNeige version
</p>
<p>If <code>IsHyst = FALSE</code>, the original CemaNeige version from Valéry et al. (2014) is used.  <br />
If <code>IsHyst = TRUE</code>, the CemaNeige version from Riboust et al. (2019) is used. Compared to the original version, this version of CemaNeige needs two more parameters and it includes a representation of the hysteretic relationship between the Snow Cover Area (SCA) and the Snow Water Equivalent (SWE) in the catchment. The hysteresis included in airGR is the Modified Linear hysteresis (LH*); it is represented on panel b) of Fig. 3 in Riboust et al. (2019). Riboust et al. (2019) advise to use the LH* version of CemaNeige with parameters calibrated using an objective function combining 75 % of KGE calculated on discharge simulated from a rainfall-runoff model compared to observed discharge and 5 % of KGE calculated on SCA on 5 CemaNeige elevation bands compared to satellite (e.g. MODIS) SCA (see Eq. (18), Table 3 and Fig. 6). Riboust et al. (2019)'s tests were realized with GR4J as the chosen rainfall-runoff model. <br />
</p>


<h3>Value</h3>

<p>[list] object of class <em>RunOptions</em> containing the data required to evaluate the model outputs; it can include the following:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <em>IndPeriod_WarmUp </em> </td><td style="text-align: left;"> [numeric] index of period to be used for the model warm-up [-] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>IndPeriod_Run    </em> </td><td style="text-align: left;"> [numeric] index of period to be used for the model run [-] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>IniStates        </em> </td><td style="text-align: left;"> [numeric] vector of initial model states [mm and °C] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>IniResLevels     </em> </td><td style="text-align: left;"> [numeric] vector of initial filling rates for production and routing stores [-] and level for the exponential store for GR6J [mm]</td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>Outputs_Cal      </em> </td><td style="text-align: left;"> [character] character vector giving only the outputs needed for the calibration </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>Outputs_Sim      </em> </td><td style="text-align: left;"> [character] character vector giving the requested outputs </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>Imax             </em> </td><td style="text-align: left;"> [numeric] vector giving the maximal capacity of the GR5H interception store </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>MeanAnSolidPrecip</em> </td><td style="text-align: left;"> [numeric] vector giving the annual mean of average solid precipitation for each layer [mm/y] </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Laurent Coron, Olivier Delaigue, Guillaume Thirel
</p>


<h3>See Also</h3>

<p><code><a href="#topic+RunModel">RunModel</a></code>, <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>, <code><a href="#topic+CreateInputsCrit">CreateInputsCrit</a></code>,
<code><a href="#topic+CreateCalibOptions">CreateCalibOptions</a></code>, <code><a href="#topic+CreateIniStates">CreateIniStates</a></code>, <code><a href="#topic+Imax">Imax</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123001)

## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_GR4J, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR4J,
                               InputsModel = InputsModel, IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(X1 = 734.568, X2 = -0.840, X3 = 109.809, X4 = 1.971)
OutputsModel &lt;- RunModel(InputsModel = InputsModel,
                         RunOptions = RunOptions, Param = Param,
                         FUN_MOD = RunModel_GR4J)

## results preview
plot(OutputsModel, Qobs = BasinObs$Qmm[Ind_Run])

## efficiency criterion: Nash-Sutcliffe Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                                RunOptions = RunOptions,
                                Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)
</code></pre>

<hr>
<h2 id='DataAltiExtrapolation_Valery'>Altitudinal extrapolation of precipitation and temperature series described by A. Valery</h2><span id='topic+DataAltiExtrapolation_Valery'></span>

<h3>Description</h3>

<p>Function which extrapolates the precipitation and air temperature series for different elevation layers (method from Valéry, 2010).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>DataAltiExtrapolation_Valery(DatesR, Precip, PrecipScale = TRUE,
                             TempMean, TempMin = NULL, TempMax = NULL,
                             ZInputs, HypsoData, NLayers, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="DataAltiExtrapolation_Valery_+3A_datesr">DatesR</code></td>
<td>
<p>[POSIXt] vector of dates</p>
</td></tr>
<tr><td><code id="DataAltiExtrapolation_Valery_+3A_precip">Precip</code></td>
<td>
<p>[numeric] time series of daily total precipitation (catchment average) [mm/time step]</p>
</td></tr>
<tr><td><code id="DataAltiExtrapolation_Valery_+3A_precipscale">PrecipScale</code></td>
<td>
<p>(optional) [boolean] indicating if the mean of the precipitation interpolated on the elevation layers must be kept or not, required to create CemaNeige module inputs, default = <code>TRUE</code> (the mean of the precipitation is kept to the original value)</p>
</td></tr>
<tr><td><code id="DataAltiExtrapolation_Valery_+3A_tempmean">TempMean</code></td>
<td>
<p>[numeric] time series of daily mean air temperature [°C]</p>
</td></tr>
<tr><td><code id="DataAltiExtrapolation_Valery_+3A_tempmin">TempMin</code></td>
<td>
<p>(optional) [numeric] time series of daily min air temperature [°C]</p>
</td></tr>
<tr><td><code id="DataAltiExtrapolation_Valery_+3A_tempmax">TempMax</code></td>
<td>
<p>(optional) [numeric] time series of daily max air temperature [°C]</p>
</td></tr>
<tr><td><code id="DataAltiExtrapolation_Valery_+3A_zinputs">ZInputs</code></td>
<td>
<p>[numeric] real giving the mean elevation of the Precip and Temp series (before extrapolation) [m]</p>
</td></tr>
<tr><td><code id="DataAltiExtrapolation_Valery_+3A_hypsodata">HypsoData</code></td>
<td>
<p>[numeric] vector of 101 reals: min, q01 to q99 and max of catchment elevation distribution [m]</p>
</td></tr>
<tr><td><code id="DataAltiExtrapolation_Valery_+3A_nlayers">NLayers</code></td>
<td>
<p>[numeric] integer giving the number of elevation layers requested [-]</p>
</td></tr>
<tr><td><code id="DataAltiExtrapolation_Valery_+3A_verbose">verbose</code></td>
<td>
<p>(optional) [boolean] boolean indicating if the function is run in verbose mode or not, default = <code>TRUE</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Elevation layers of equal surface are created the 101 elevation quantiles (<code>HypsoData</code>)
and the number requested elevation layers (<code>NLayers</code>). <br />
Forcing data (precipitation and air temperature) are extrapolated using gradients from Valery (2010).
(e.g. gradP = 0.0004 [m-1] for France and gradT = 0.434 [°C/100m] for January, 1st). <br />
This function is used by the <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> function.
</p>


<h3>Value</h3>

<p>list containing the extrapolated series of precip. and air temp. on each elevation layer
</p>

<table>
<tr>
 <td style="text-align: left;">
           <em>$LayerPrecip         </em> </td><td style="text-align: left;"> [list] list of time series of daily precipitation (layer average) [mm/time step] </td>
</tr>
<tr>
 <td style="text-align: left;">
           <em>$LayerTempMean       </em> </td><td style="text-align: left;"> [list] list of time series of daily mean air temperature (layer average) [°C]    </td>
</tr>
<tr>
 <td style="text-align: left;">
           <em>$LayerTempMin        </em> </td><td style="text-align: left;"> [list] list of time series of daily min air temperature (layer average) [°C]     </td>
</tr>
<tr>
 <td style="text-align: left;">
           <em>$LayerTempMax        </em> </td><td style="text-align: left;"> [list] list of time series of daily max air temperature (layer average) [°C]     </td>
</tr>
<tr>
 <td style="text-align: left;">
           <em>$LayerFracSolidPrecip</em> </td><td style="text-align: left;"> [list] list of time series of daily solid precip. fract. (layer average) [-]     </td>
</tr>
<tr>
 <td style="text-align: left;">
           <em>$ZLayers             </em> </td><td style="text-align: left;"> [numeric] vector of median elevation for each layer                              </td>
</tr>
<tr>
 <td style="text-align: left;">
         </td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Laurent Coron, Audrey Valéry, Olivier Delaigue, Pierre Brigode, Guillaume Thirel
</p>


<h3>References</h3>

<p>Turcotte, R., Fortin, L.-G., Fortin, V., Fortin, J.-P. and Villeneuve, J.-P. (2007).
Operational analysis of the spatial distribution and the temporal evolution of the snowpack water equivalent in southern Quebec, Canada.
Nordic Hydrology, 38(3), 211, <a href="https://doi.org/10.2166/nh.2007.009">doi:10.2166/nh.2007.009</a>.
<br /><br />
Valéry, A. (2010),
Modélisation précipitations-débit sous influence nivale ? : Elaboration d'un module neige et évaluation sur 380 bassins versants.
PhD thesis (in French), AgroParisTech - Cemagref Antony, Paris, France.
<br /><br />
USACE (1956),
Snow Hydrology, pp. 437.
U.S. Army Coprs of Engineers (USACE) North Pacific Division, Portland, Oregon, USA.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>, <code><a href="#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code>
</p>

<hr>
<h2 id='ErrorCrit'>Error criterion using the provided function</h2><span id='topic+ErrorCrit'></span>

<h3>Description</h3>

<p>Function which computes an error criterion with the provided function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ErrorCrit(InputsCrit, OutputsModel, warnings = TRUE, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ErrorCrit_+3A_inputscrit">InputsCrit</code></td>
<td>
<p>[object of class <em>InputsCrit</em>] see <code><a href="#topic+CreateInputsCrit">CreateInputsCrit</a></code> for details</p>
</td></tr>
<tr><td><code id="ErrorCrit_+3A_outputsmodel">OutputsModel</code></td>
<td>
<p>[object of class <em>OutputsModel</em>] see <code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code> or <code><a href="#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code> for details</p>
</td></tr>
<tr><td><code id="ErrorCrit_+3A_warnings">warnings</code></td>
<td>
<p>(optional) [boolean] boolean indicating if the warning messages are shown, default = <code>TRUE</code></p>
</td></tr>
<tr><td><code id="ErrorCrit_+3A_verbose">verbose</code></td>
<td>
<p>(optional) [boolean] boolean indicating if the function is run in verbose mode or not, default = <code>TRUE</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>If <code>InputsCrit</code> is of class <em>Single</em>:
</p>

<table>
<tr>
 <td style="text-align: left;">
    [list] containing the <code>ErrorCrit_*</code> functions outputs, see <code><a href="#topic+ErrorCrit_RMSE">ErrorCrit_RMSE</a></code> or <code><a href="#topic+ErrorCrit_NSE">ErrorCrit_NSE</a></code> for details </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>

<p>If <code>InputsCrit</code> is of class <em>Multi</em>:
</p>

<table>
<tr>
 <td style="text-align: left;">
    [list] of list containing the <code>ErrorCrit_*</code> functions outputs, see <code><a href="#topic+ErrorCrit_RMSE">ErrorCrit_RMSE</a></code> or <code><a href="#topic+ErrorCrit_NSE">ErrorCrit_NSE</a></code> for details </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>

<p>If <code>InputsCrit</code> is of class <em>Compo</em>:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <em>$CritValue    </em> </td><td style="text-align: left;"> [numeric] value of the composite criterion </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CritName     </em> </td><td style="text-align: left;"> [character] name of the composite criterion </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CritBestValue</em> </td><td style="text-align: left;"> [numeric] theoretical best criterion value </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Multiplier   </em> </td><td style="text-align: left;"> [numeric] integer indicating whether the criterion is indeed an error (+1) or an efficiency (-1) </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CritCompo$MultiCritValues</em> </td><td style="text-align: left;"> [numeric] values of the sub-criteria </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CritCompo$MultiCritNames</em> </td><td style="text-align: left;"> [numeric] names of the sub-criteria </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CritCompo$MultiCritWeights</em> </td><td style="text-align: left;"> [character] weighted values of the sub-criteria </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$MultiCrit    </em> </td><td style="text-align: left;"> [list] of list containing the <code>ErrorCrit_*</code> functions outputs, see <code><a href="#topic+ErrorCrit_NSE">ErrorCrit_NSE</a></code> or <code><a href="#topic+ErrorCrit_KGE">ErrorCrit_KGE</a></code> for details </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Olivier Delaigue
</p>


<h3>See Also</h3>

<p><code><a href="#topic+CreateInputsCrit">CreateInputsCrit</a></code>, <code><a href="#topic+ErrorCrit_RMSE">ErrorCrit_RMSE</a></code>, <code><a href="#topic+ErrorCrit_NSE">ErrorCrit_NSE</a></code>,
<code><a href="#topic+ErrorCrit_KGE">ErrorCrit_KGE</a></code>, <code><a href="#topic+ErrorCrit_KGE2">ErrorCrit_KGE2</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123001)

## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_GR4J, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E)

## calibration period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

## preparation of RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR4J, InputsModel = InputsModel,
                               IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(X1 = 257.238, X2 = 1.012, X3 = 88.235, X4 = 2.208)
OutputsModel &lt;- RunModel_GR4J(InputsModel = InputsModel,
                              RunOptions = RunOptions, Param = Param)

## single efficiency criterion: Nash-Sutcliffe Efficiency
InputsCritSingle &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE,
                                     InputsModel = InputsModel, RunOptions = RunOptions,
                                     Obs = list(BasinObs$Qmm[Ind_Run]),
                                     VarObs = "Q", transfo = "",
                                     Weights = NULL)
str(ErrorCrit(InputsCrit = InputsCritSingle, OutputsModel = OutputsModel))

## 2 efficiency critera:  RMSE and the Nash-Sutcliffe Efficiency
InputsCritMulti &lt;- CreateInputsCrit(FUN_CRIT = list(ErrorCrit_RMSE, ErrorCrit_NSE),
                                    InputsModel = InputsModel, RunOptions = RunOptions,
                                    Obs = list(BasinObs$Qmm[Ind_Run],
                                               BasinObs$Qmm[Ind_Run]),
                                    VarObs = list("Q", "Q"), transfo = list("", "sqrt"),
                                    Weights = NULL)
str(ErrorCrit(InputsCrit = InputsCritMulti, OutputsModel = OutputsModel))

## efficiency composite criterion: Nash-Sutcliffe Efficiency mixing
##                                 both raw and log-transformed flows
InputsCritCompo &lt;- CreateInputsCrit(FUN_CRIT = list(ErrorCrit_NSE, ErrorCrit_NSE),
                                    InputsModel = InputsModel, RunOptions = RunOptions,
                                    Obs = list(BasinObs$Qmm[Ind_Run],
                                               BasinObs$Qmm[Ind_Run]),
                                    VarObs = list("Q", "Q"), transfo = list("", "log"),
                                    Weights = list(0.4, 0.6))
str(ErrorCrit(InputsCrit = InputsCritCompo, OutputsModel = OutputsModel))
</code></pre>

<hr>
<h2 id='ErrorCrit_KGE'>Error criterion based on the KGE formula</h2><span id='topic+ErrorCrit_KGE'></span>

<h3>Description</h3>

<p>Function which computes an error criterion based on the KGE formula proposed by Gupta et al. (2009).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ErrorCrit_KGE(InputsCrit, OutputsModel, warnings = TRUE, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ErrorCrit_KGE_+3A_inputscrit">InputsCrit</code></td>
<td>
<p>[object of class <em>InputsCrit</em>] see <code><a href="#topic+CreateInputsCrit">CreateInputsCrit</a></code> for details</p>
</td></tr>
<tr><td><code id="ErrorCrit_KGE_+3A_outputsmodel">OutputsModel</code></td>
<td>
<p>[object of class <em>OutputsModel</em>] see <code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code> or <code><a href="#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code> for details</p>
</td></tr>
<tr><td><code id="ErrorCrit_KGE_+3A_warnings">warnings</code></td>
<td>
<p>(optional) [boolean] boolean indicating if the warning messages are shown, default = <code>TRUE</code></p>
</td></tr>
<tr><td><code id="ErrorCrit_KGE_+3A_verbose">verbose</code></td>
<td>
<p>(optional) [boolean] boolean indicating if the function is run in verbose mode or not, default = <code>TRUE</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>In addition to the criterion value, the function outputs include a multiplier (-1 or +1) which allows
the use of the function for model calibration: the product <code class="reqn">CritValue \times Multiplier</code> is the criterion to be minimised (Multiplier = -1 for KGE).<br /><br />
The KGE formula is
</p>
<p style="text-align: center;"><code class="reqn">KGE = 1 - \sqrt{(r - 1)^2 + (\alpha - 1)^2 + (\beta - 1)^2}</code>
</p>

<p>with the following sub-criteria:
</p>
<p style="text-align: center;"><code class="reqn">r = \mathrm{the\: linear\: correlation\: coefficient\: between\:} sim\: \mathrm{and\:} obs</code>
</p>

<p style="text-align: center;"><code class="reqn">\alpha = \frac{\sigma_{sim}}{\sigma_{obs}}</code>
</p>

<p style="text-align: center;"><code class="reqn">\beta = \frac{\mu_{sim}}{\mu_{obs}}</code>
</p>



<h3>Value</h3>

<p>[list] list containing the function outputs organised as follows:
</p>

<table>
<tr>
 <td style="text-align: left;">
         <em>$CritValue      </em>   </td><td style="text-align: left;">   [numeric] value of the criterion </td>
</tr>
<tr>
 <td style="text-align: left;">
         <em>$CritName       </em>   </td><td style="text-align: left;">   [character] name of the criterion </td>
</tr>
<tr>
 <td style="text-align: left;">
         <em>$SubCritValues  </em>   </td><td style="text-align: left;">   [numeric] values of the sub-criteria </td>
</tr>
<tr>
 <td style="text-align: left;">
         <em>$SubCritNames   </em>   </td><td style="text-align: left;">   [character] names of the components of the criterion </td>
</tr>
<tr>
 <td style="text-align: left;">
         <em>$CritBestValue  </em>   </td><td style="text-align: left;">   [numeric] theoretical best criterion value </td>
</tr>
<tr>
 <td style="text-align: left;">
         <em>$Multiplier     </em>   </td><td style="text-align: left;">   [numeric] integer indicating whether the criterion is indeed an error (+1) or an efficiency (-1) </td>
</tr>
<tr>
 <td style="text-align: left;">
         <em>$Ind_notcomputed</em>   </td><td style="text-align: left;">   [numeric] indices of the time steps where <em>InputsCrit$BoolCrit</em> = <code>FALSE</code> or no data is available </td>
</tr>
<tr>
 <td style="text-align: left;">
         </td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Laurent Coron, Olivier Delaigue
</p>


<h3>References</h3>

<p>Gupta, H. V., Kling, H., Yilmaz, K. K. and Martinez, G. F. (2009).
Decomposition of the mean squared error and NSE performance criteria: Implications for improving hydrological modelling.
Journal of Hydrology, 377(1-2), 80-91, <a href="https://doi.org/10.1016/j.jhydrol.2009.08.003">doi:10.1016/j.jhydrol.2009.08.003</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ErrorCrit">ErrorCrit</a></code>, <code><a href="#topic+ErrorCrit_RMSE">ErrorCrit_RMSE</a></code>, <code><a href="#topic+ErrorCrit_NSE">ErrorCrit_NSE</a></code>, <code><a href="#topic+ErrorCrit_KGE2">ErrorCrit_KGE2</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123001)

## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_GR4J, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR4J,
                               InputsModel = InputsModel, IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(X1 = 734.568, X2 = -0.840, X3 = 109.809, X4 = 1.971)
OutputsModel &lt;- RunModel(InputsModel = InputsModel, RunOptions = RunOptions,
                         Param = Param, FUN = RunModel_GR4J)

## efficiency criterion: Kling-Gupta Efficiency
InputsCrit &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_KGE, InputsModel = InputsModel,
                               RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_KGE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)

## efficiency criterion: Kling-Gupta Efficiency on square-root-transformed flows
transfo &lt;- "sqrt"
InputsCrit &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_KGE, InputsModel = InputsModel,
                               RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run],
                               transfo = transfo)
OutputsCrit &lt;- ErrorCrit_KGE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)

## efficiency criterion: Kling-Gupta Efficiency above a threshold (quant. 75 %)
BoolCrit &lt;- BasinObs$Qmm[Ind_Run] &gt;= quantile(BasinObs$Qmm[Ind_Run], 0.75, na.rm = TRUE)
InputsCrit &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_KGE, InputsModel = InputsModel,
                               RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run],
                               BoolCrit = BoolCrit)
OutputsCrit &lt;- ErrorCrit_KGE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)
</code></pre>

<hr>
<h2 id='ErrorCrit_KGE2'>Error criterion based on the KGE' formula</h2><span id='topic+ErrorCrit_KGE2'></span>

<h3>Description</h3>

<p>Function which computes an error criterion based on the KGE' formula proposed by Kling et al. (2012).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ErrorCrit_KGE2(InputsCrit, OutputsModel, warnings = TRUE, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ErrorCrit_KGE2_+3A_inputscrit">InputsCrit</code></td>
<td>
<p>[object of class <em>InputsCrit</em>] see <code><a href="#topic+CreateInputsCrit">CreateInputsCrit</a></code> for details</p>
</td></tr>
<tr><td><code id="ErrorCrit_KGE2_+3A_outputsmodel">OutputsModel</code></td>
<td>
<p>[object of class <em>OutputsModel</em>] see <code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code> or <code><a href="#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code> for details</p>
</td></tr>
<tr><td><code id="ErrorCrit_KGE2_+3A_warnings">warnings</code></td>
<td>
<p>(optional) [boolean] boolean indicating if the warning messages are shown, default = <code>TRUE</code></p>
</td></tr>
<tr><td><code id="ErrorCrit_KGE2_+3A_verbose">verbose</code></td>
<td>
<p>(optional) [boolean] boolean indicating if the function is run in verbose mode or not, default = <code>TRUE</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>In addition to the criterion value, the function outputs include a multiplier (-1 or +1) which allows
the use of the function for model calibration: the product <code class="reqn">CritValue \times Multiplier</code> is the criterion to be minimised (Multiplier = -1 for KGE2).<br /><br />
The KGE' formula is
</p>
<p style="text-align: center;"><code class="reqn">KGE' = 1 - \sqrt{(r - 1)^2 + (\gamma - 1)^2 + (\beta - 1)^2}</code>
</p>

<p>with the following sub-criteria:
</p>
<p style="text-align: center;"><code class="reqn">r = \mathrm{the\: linear\ correlation\: coefficient\: between\:} sim\: \mathrm{and\:} obs</code>
</p>

<p style="text-align: center;"><code class="reqn">\gamma = \frac{CV_{sim}}{CV_{obs}}</code>
</p>

<p style="text-align: center;"><code class="reqn">\beta = \frac{\mu_{sim}}{\mu_{obs}}</code>
</p>



<h3>Value</h3>

<p>[list] list containing the function outputs organised as follows:
</p>

<table>
<tr>
 <td style="text-align: left;">
         <em>$CritValue      </em>   </td><td style="text-align: left;">   [numeric] value of the criterion </td>
</tr>
<tr>
 <td style="text-align: left;">
         <em>$CritName       </em>   </td><td style="text-align: left;">   [character] name of the criterion </td>
</tr>
<tr>
 <td style="text-align: left;">
         <em>$SubCritValues  </em>   </td><td style="text-align: left;">   [numeric] values of the sub-criteria </td>
</tr>
<tr>
 <td style="text-align: left;">
         <em>$SubCritNames   </em>   </td><td style="text-align: left;">   [character] names of the components of the criterion </td>
</tr>
<tr>
 <td style="text-align: left;">
         <em>$CritBestValue  </em>   </td><td style="text-align: left;">   [numeric] theoretical best criterion value </td>
</tr>
<tr>
 <td style="text-align: left;">
         <em>$Multiplier     </em>   </td><td style="text-align: left;">   [numeric] integer indicating whether the criterion is indeed an error (+1) or an efficiency (-1) </td>
</tr>
<tr>
 <td style="text-align: left;">
         <em>$Ind_notcomputed</em>   </td><td style="text-align: left;">   [numeric] indices of the time steps where <em>InputsCrit$BoolCrit</em> = <code>FALSE</code> or no data is available </td>
</tr>
<tr>
 <td style="text-align: left;">
         </td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Laurent Coron, Olivier Delaigue
</p>


<h3>References</h3>

<p>Gupta, H. V., Kling, H., Yilmaz, K. K. and Martinez, G. F. (2009).
Decomposition of the mean squared error and NSE performance criteria: Implications for improving hydrological modelling.
Journal of Hydrology, 377(1-2), 80-91, <a href="https://doi.org/10.1016/j.jhydrol.2009.08.003">doi:10.1016/j.jhydrol.2009.08.003</a>.
<br /><br />
Kling, H., Fuchs, M. and Paulin, M. (2012).
Runoff conditions in the upper Danube basin under an ensemble of climate change scenarios.
Journal of Hydrology, 424-425, 264-277, <a href="https://doi.org/10.1016/j.jhydrol.2012.01.011">doi:10.1016/j.jhydrol.2012.01.011</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ErrorCrit">ErrorCrit</a></code>, <code><a href="#topic+ErrorCrit_RMSE">ErrorCrit_RMSE</a></code>, <code><a href="#topic+ErrorCrit_NSE">ErrorCrit_NSE</a></code>, <code><a href="#topic+ErrorCrit_KGE">ErrorCrit_KGE</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123001)

## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_GR4J, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR4J,
                               InputsModel = InputsModel, IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(X1 = 734.568, X2 = -0.840, X3 = 109.809, X4 = 1.971)
OutputsModel &lt;- RunModel(InputsModel = InputsModel, RunOptions = RunOptions,
                         Param = Param, FUN = RunModel_GR4J)

## efficiency criterion: Kling-Gupta Efficiency
InputsCrit &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_KGE2, InputsModel = InputsModel,
                               RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_KGE2(InputsCrit = InputsCrit, OutputsModel = OutputsModel)

## efficiency criterion: Kling-Gupta Efficiency on square-root-transformed flows
transfo &lt;- "sqrt"
InputsCrit &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_KGE2, InputsModel = InputsModel,
                               RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run],
                               transfo = transfo)
OutputsCrit &lt;- ErrorCrit_KGE2(InputsCrit = InputsCrit, OutputsModel = OutputsModel)

## efficiency criterion: Kling-Gupta Efficiency above a threshold (quant. 75 %)
BoolCrit &lt;- BasinObs$Qmm[Ind_Run] &gt;= quantile(BasinObs$Qmm[Ind_Run], 0.75, na.rm = TRUE)
InputsCrit &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_KGE2, InputsModel = InputsModel,
                               RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run],
                               BoolCrit = BoolCrit)
OutputsCrit &lt;- ErrorCrit_KGE2(InputsCrit = InputsCrit, OutputsModel = OutputsModel)
</code></pre>

<hr>
<h2 id='ErrorCrit_NSE'>Error criterion based on the NSE formula</h2><span id='topic+ErrorCrit_NSE'></span>

<h3>Description</h3>

<p>Function which computes an error criterion based on the NSE formula proposed by Nash &amp; Sutcliffe (1970).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ErrorCrit_NSE(InputsCrit, OutputsModel, warnings = TRUE, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ErrorCrit_NSE_+3A_inputscrit">InputsCrit</code></td>
<td>
<p>[object of class <em>InputsCrit</em>] see <code><a href="#topic+CreateInputsCrit">CreateInputsCrit</a></code> for details</p>
</td></tr>
<tr><td><code id="ErrorCrit_NSE_+3A_outputsmodel">OutputsModel</code></td>
<td>
<p>[object of class <em>OutputsModel</em>] see <code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code> or <code><a href="#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code> for details</p>
</td></tr>
<tr><td><code id="ErrorCrit_NSE_+3A_warnings">warnings</code></td>
<td>
<p>(optional) [boolean] boolean indicating if the warning messages are shown, default = <code>TRUE</code></p>
</td></tr>
<tr><td><code id="ErrorCrit_NSE_+3A_verbose">verbose</code></td>
<td>
<p>(optional) [boolean] boolean indicating if the function is run in verbose mode or not, default = <code>TRUE</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>In addition to the criterion value, the function outputs include a multiplier (-1 or +1) which allows
the use of the function for model calibration: the product <code class="reqn">CritValue \times Multiplier</code> is the criterion to be minimised
(Multiplier = -1 for NSE).
</p>


<h3>Value</h3>

<p>[list] list containing the function outputs organised as follows:
</p>

<table>
<tr>
 <td style="text-align: left;">
         <em>$CritValue      </em>   </td><td style="text-align: left;">   [numeric] value of the criterion </td>
</tr>
<tr>
 <td style="text-align: left;">
         <em>$CritName       </em>   </td><td style="text-align: left;">   [character] name of the criterion </td>
</tr>
<tr>
 <td style="text-align: left;">
         <em>$CritBestValue  </em>   </td><td style="text-align: left;">   [numeric] theoretical best criterion value </td>
</tr>
<tr>
 <td style="text-align: left;">
         <em>$Multiplier     </em>   </td><td style="text-align: left;">   [numeric] integer indicating whether the criterion is indeed an error (+1) or an efficiency (-1) </td>
</tr>
<tr>
 <td style="text-align: left;">
         <em>$Ind_notcomputed</em>   </td><td style="text-align: left;">   [numeric] indices of the time steps where <em>InputsCrit$BoolCrit</em> = <code>FALSE</code> or no data is available </td>
</tr>
<tr>
 <td style="text-align: left;">
         </td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Laurent Coron, Olivier Delaigue
</p>


<h3>References</h3>

<p>Nash, J. E. and Sutcliffe, J. V. (1970).
River flow forecasting through conceptual models.
Part 1 - A discussion of principles.
Journal of Hydrology, 10(3), 282-290, <a href="https://doi.org/10.1016/0022-1694%2870%2990255-6">doi:10.1016/0022-1694(70)90255-6</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ErrorCrit_RMSE">ErrorCrit_RMSE</a></code>, <code><a href="#topic+ErrorCrit_KGE">ErrorCrit_KGE</a></code>, <code><a href="#topic+ErrorCrit_KGE2">ErrorCrit_KGE2</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123001)

## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_GR4J, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR4J,
                               InputsModel = InputsModel, IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(X1 = 734.568, X2 = -0.840, X3 = 109.809, X4 = 1.971)
OutputsModel &lt;- RunModel(InputsModel = InputsModel, RunOptions = RunOptions,
                         Param = Param, FUN = RunModel_GR4J)

## efficiency criterion: Nash-Sutcliffe Efficiency
InputsCrit &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                               RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)

## efficiency criterion: Nash-Sutcliffe Efficiency on log-transformed flows
transfo &lt;- "log"
InputsCrit &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                               RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run],
                               transfo = transfo)
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)

## efficiency criterion: Kling-Gupta Efficiency above a threshold (quant. 75 %)
BoolCrit &lt;- BasinObs$Qmm[Ind_Run] &gt;= quantile(BasinObs$Qmm[Ind_Run], 0.75, na.rm = TRUE)
InputsCrit &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                               RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run],
                               BoolCrit = BoolCrit)
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)
</code></pre>

<hr>
<h2 id='ErrorCrit_RMSE'>Error criterion based on the RMSE</h2><span id='topic+ErrorCrit_RMSE'></span>

<h3>Description</h3>

<p>Function which computes an error criterion based on the root-mean-square error (RMSE).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ErrorCrit_RMSE(InputsCrit, OutputsModel, warnings = TRUE, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ErrorCrit_RMSE_+3A_inputscrit">InputsCrit</code></td>
<td>
<p>[object of class <em>InputsCrit</em>] see <code><a href="#topic+CreateInputsCrit">CreateInputsCrit</a></code> for details</p>
</td></tr>
<tr><td><code id="ErrorCrit_RMSE_+3A_outputsmodel">OutputsModel</code></td>
<td>
<p>[object of class <em>OutputsModel</em>] see <code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code> or <code><a href="#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code> for details</p>
</td></tr>
<tr><td><code id="ErrorCrit_RMSE_+3A_warnings">warnings</code></td>
<td>
<p>(optional) [boolean] boolean indicating if the warning messages are shown, default = <code>TRUE</code></p>
</td></tr>
<tr><td><code id="ErrorCrit_RMSE_+3A_verbose">verbose</code></td>
<td>
<p>(optional) [boolean] boolean indicating if the function is run in verbose mode or not, default = <code>TRUE</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>In addition to the criterion value, the function outputs include a multiplier (-1 or +1) which allows 
the use of the function for model calibration: the product <code class="reqn">CritValue \times Multiplier</code> is the criterion to be minimised 
(Multiplier = +1 for RMSE).
</p>


<h3>Value</h3>

<p>[list] list containing the function outputs organised as follows:
</p>

<table>
<tr>
 <td style="text-align: left;">
         <em>$CritValue      </em> </td><td style="text-align: left;"> [numeric] value of the criterion </td>
</tr>
<tr>
 <td style="text-align: left;">
         <em>$CritName       </em> </td><td style="text-align: left;"> [character] name of the criterion </td>
</tr>
<tr>
 <td style="text-align: left;">
         <em>$CritBestValue  </em> </td><td style="text-align: left;"> [numeric] theoretical best criterion value </td>
</tr>
<tr>
 <td style="text-align: left;">
         <em>$Multiplier     </em> </td><td style="text-align: left;"> [numeric] integer indicating whether the criterion is indeed an error (+1) or an efficiency (-1) </td>
</tr>
<tr>
 <td style="text-align: left;">
         <em>$Ind_notcomputed</em> </td><td style="text-align: left;"> [numeric] indices of the time steps where <em>InputsCrit$BoolCrit</em> = <code>FALSE</code> or no data is available </td>
</tr>
<tr>
 <td style="text-align: left;">
         </td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Laurent Coron, Ludovic Oudin, Olivier Delaigue
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ErrorCrit_NSE">ErrorCrit_NSE</a></code>, <code><a href="#topic+ErrorCrit_KGE">ErrorCrit_KGE</a></code>, <code><a href="#topic+ErrorCrit_KGE2">ErrorCrit_KGE2</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123001)

## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_GR4J, DatesR = BasinObs$DatesR, 
                                 Precip = BasinObs$P, PotEvap = BasinObs$E)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"), 
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR4J,
                               InputsModel = InputsModel, IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(X1 = 734.568, X2 = -0.840, X3 = 109.809, X4 = 1.971)
OutputsModel &lt;- RunModel(InputsModel = InputsModel, RunOptions = RunOptions, 
                         Param = Param, FUN = RunModel_GR4J)

## efficiency criterion: root-mean-square error
InputsCrit &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_RMSE, InputsModel = InputsModel, 
                               RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_RMSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)

## efficiency criterion: root-mean-square error on log-transformed flows
transfo &lt;- "log"
InputsCrit &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_RMSE, InputsModel = InputsModel, 
                               RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run],
                               transfo = transfo)
OutputsCrit &lt;- ErrorCrit_RMSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)

## efficiency criterion: Kling-Gupta Efficiency above a threshold (quant. 75 %)
BoolCrit &lt;- BasinObs$Qmm[Ind_Run] &gt;= quantile(BasinObs$Qmm[Ind_Run], 0.75, na.rm = TRUE)
InputsCrit &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_RMSE, InputsModel = InputsModel, 
                               RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run],
                               BoolCrit = BoolCrit)
OutputsCrit &lt;- ErrorCrit_RMSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)
</code></pre>

<hr>
<h2 id='Imax'>Computation of the maximum capacity of the GR5H interception store</h2><span id='topic+Imax'></span>

<h3>Description</h3>

<p>Function which calculates the maximal capacity of the GR5H interception store. This function compares the interception evapotranspiration from the GR5H interception store for different maximal capacity values with the interception evapotranspiration classically used in the daily GR models (e.g. GR4J). Among all the <code>TestedValues</code>, the value that gives the closest interception evapotranspiration flux over the whole period is kept.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Imax(InputsModel, IndPeriod_Run,
     TestedValues = seq(from = 0.1, to = 3, by = 0.1))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Imax_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em>] see <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> for details</p>
</td></tr>
<tr><td><code id="Imax_+3A_indperiod_run">IndPeriod_Run</code></td>
<td>
<p>[numeric] index of period to be used for the model run [-]</p>
</td></tr>
<tr><td><code id="Imax_+3A_testedvalues">TestedValues</code></td>
<td>
<p>[numeric] vector of tested Imax values [mm]</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Optimal Imax value [mm].
</p>


<h3>Author(s)</h3>

<p>Guillaume Thirel, Olivier Delaigue
</p>


<h3>References</h3>

<p>Ficchi, A. (2017).
An adaptive hydrological model for multiple time-steps:
Diagnostics and improvements based on fluxes consistency.
PhD thesis, UPMC - Irstea Antony, Paris, France.
<br /><br />
Ficchi, A., Perrin, C. and Andréassian, V. (2019).
Hydrological modelling at multiple sub-daily time steps: model improvement via flux-matching.
Journal of Hydrology, 575, 1308-1327, <a href="https://doi.org/10.1016/j.jhydrol.2019.05.084">doi:10.1016/j.jhydrol.2019.05.084</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+RunModel_GR5H">RunModel_GR5H</a></code>,
<code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123003)

## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_GR5H, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d %H")=="2006-01-01 00"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d %H")=="2006-12-31 23"))

## Imax computation
Imax &lt;- Imax(InputsModel = InputsModel, IndPeriod_Run = Ind_Run,
             TestedValues = seq(from = 0, to = 3, by = 0.2))

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR5H, Imax = Imax,
                               InputsModel = InputsModel, IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(X1 = 706.912, X2 = -0.163, X3 = 188.880, X4 = 2.575, X5 = 0.104)
OutputsModel &lt;- RunModel_GR5H(InputsModel = InputsModel,
                              RunOptions = RunOptions, Param = Param)

## results preview
plot(OutputsModel, Qobs = BasinObs$Qmm[Ind_Run])

## efficiency criterion: Nash-Sutcliffe Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                                RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)
</code></pre>

<hr>
<h2 id='Param_Sets_GR4J'>Generalist parameter sets for the GR4J model</h2><span id='topic+Param_Sets_GR4J'></span>

<h3>Description</h3>

<p>These parameter sets can be used as an alternative for the grid-screening calibration procedure (i.e. first step in <code><a href="#topic+Calibration_Michel">Calibration_Michel</a></code>).
Please note that the given GR4J X4u variable does not correspond to the actual GR4J X4 parameter. As explained in Andréassian et al. (2014; section 2.1), the given GR4J X4u value has to be adjusted (rescaled) using catchment area (S) [km2] as follows: <code class="reqn">X4 = X4u / 5.995 \times S^{0.3}</code> (please note that the formula is erroneous in the publication). Please, see the example below. <br />
As shown in Andréassian et al. (2014; figure 4), only using these parameters sets as the tested values for calibration is more efficient than a classical calibration when the amount of data is low (6 months or less).
</p>


<h3>Format</h3>

<p>Data frame of parameters containing four numeric vectors:
</p>

<table>
<tr>
 <td style="text-align: left;">
    GR4J X1  </td><td style="text-align: left;"> production store capacity [mm]             </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR4J X2  </td><td style="text-align: left;"> intercatchment exchange coefficient [mm/d] </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR4J X3  </td><td style="text-align: left;"> routing store capacity [mm]                </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR4J X4u </td><td style="text-align: left;"> unajusted unit hydrograph time constant [d]</td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>References</h3>

<p>Andréassian, V., Bourgin, F., Oudin, L., Mathevet, T., Perrin, C., Lerat, J., Coron, L. and Berthet, L. (2014).
Seeking genericity in the selection of parameter sets: Impact on hydrological model efficiency.
Water Resources Research, 50(10), 8356-8366, <a href="https://doi.org/10.1002/2013WR014761">doi:10.1002/2013WR014761</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code>, <code><a href="#topic+Calibration_Michel">Calibration_Michel</a></code>, <code><a href="#topic+CreateCalibOptions">CreateCalibOptions</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123001)

## loading generalist parameter sets
data(Param_Sets_GR4J)
str(Param_Sets_GR4J)

## computation of the real GR4J X4
Param_Sets_GR4J$X4 &lt;- Param_Sets_GR4J$X4u / 5.995 * BasinInfo$BasinArea^0.3
Param_Sets_GR4J$X4u &lt;- NULL
Param_Sets_GR4J &lt;- as.matrix(Param_Sets_GR4J)

## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_GR4J, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E)

## --- calibration step

## short calibration period selection (&lt; 6 months)
Ind_Cal &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-02-28"))

## preparation of the RunOptions object for the calibration period
RunOptions_Cal &lt;- CreateRunOptions(FUN_MOD = RunModel_GR4J,
                                   InputsModel = InputsModel, IndPeriod_Run = Ind_Cal)

## simulation and efficiency criterion (Nash-Sutcliffe Efficiency)
## with all generalist parameter sets on the calibration period
OutputsCrit_Loop &lt;- apply(Param_Sets_GR4J, 1, function(Param) {
  OutputsModel_Cal &lt;- RunModel_GR4J(InputsModel = InputsModel,
                                    RunOptions = RunOptions_Cal,
                                    Param = Param)
  InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                                  RunOptions = RunOptions_Cal, Obs = BasinObs$Qmm[Ind_Cal])
  OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel_Cal)
  return(OutputsCrit$CritValue)
})

## best parameter set
Param_Best &lt;- unlist(Param_Sets_GR4J[which.max(OutputsCrit_Loop), ])


## --- validation step

## validation period selection
Ind_Val &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-03-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

## preparation of the RunOptions object for the validation period
RunOptions_Val &lt;- CreateRunOptions(FUN_MOD = RunModel_GR4J,
                                   InputsModel = InputsModel, IndPeriod_Run = Ind_Val)

## simulation with the best parameter set on the validation period
OutputsModel_Val &lt;- RunModel_GR4J(InputsModel = InputsModel,
                                  RunOptions = RunOptions_Val,
                                  Param = Param_Best)

## results preview of the simulation with the best parameter set on the validation period
plot(OutputsModel_Val, Qobs = BasinObs$Qmm[Ind_Val])

## efficiency criterion (Nash-Sutcliffe Efficiency) on the validation period
InputsCrit_Val  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                                RunOptions = RunOptions_Val, Obs = BasinObs$Qmm[Ind_Val])
OutputsCrit_Val &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit_Val, OutputsModel = OutputsModel_Val)
</code></pre>

<hr>
<h2 id='PE_Oudin'>Computation of series of potential evapotranspiration at the daily or hourly time steps with Oudin's formula</h2><span id='topic+PE_Oudin'></span>

<h3>Description</h3>

<p>Function which computes PE using the formula from Oudin et al. (2005). PE can be computed at the daily time step from hourly or daily temperature and at the hourly time step with hourly or daily temperature through a disaggregation of daily PE . See details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PE_Oudin(JD, Temp, Lat, LatUnit =  c("rad", "deg"),
         TimeStepIn = "daily", TimeStepOut = "daily",
         RunFortran = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PE_Oudin_+3A_jd">JD</code></td>
<td>
<p>[numeric] time series of Julian day of the year [-]; see details</p>
</td></tr>
<tr><td><code id="PE_Oudin_+3A_temp">Temp</code></td>
<td>
<p>[numeric] time series of daily (or hourly) mean air temperature [°C]</p>
</td></tr>
<tr><td><code id="PE_Oudin_+3A_lat">Lat</code></td>
<td>
<p>[numeric] latitude of measurement for the temperature series [radians or degrees]. Atomic vector, except if <code>RunFortran = TRUE</code>, it can be a vector of the same length as <code>Temp</code></p>
</td></tr>
<tr><td><code id="PE_Oudin_+3A_latunit">LatUnit</code></td>
<td>
<p>[character] latitude unit (default = <code>"rad"</code> or <code>"deg"</code>)</p>
</td></tr>
<tr><td><code id="PE_Oudin_+3A_timestepin">TimeStepIn</code></td>
<td>
<p>[character] time step of inputs (e.g. <code>"daily"</code> or <code>"hourly"</code>, default = <code>"daily"</code>)</p>
</td></tr>
<tr><td><code id="PE_Oudin_+3A_timestepout">TimeStepOut</code></td>
<td>
<p>[character] time step of outputs (e.g. <code>"daily"</code> or <code>"hourly"</code>, default = <code>"daily"</code>)</p>
</td></tr>
<tr><td><code id="PE_Oudin_+3A_runfortran">RunFortran</code></td>
<td>
<p>[boolean] to run the code in the Fortran mode or in the R mode (default)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>To calculate basin-wide Oudin potential evapotranspiration, it is advised, when possible, to use either station temperature or gridded temperature data to calculate PE and then average these PE values at the basin scale.
</p>
<p>In the <code>JD</code> argument, the Julian day of the year of the 1st of January is equal to 1 and the 31st of December to 365 (366 in leap years). If the Julian day of the year is computed on an object of the <code>POSIXlt</code> class, the user has to add 1 to the returned value (e.g. <code>as.POSIXlt("2016-12-31")$yday + 1</code>).
</p>
<p>When hourly temperature is provided, all the values of the same day have to be set to the same Julian day of the year (e.g. <code>as.POSIXlt("2016-12-31 00:00:00")$yday + 1</code> and <code>as.POSIXlt("2016-12-31 00:01:00")$yday + 1</code>). Each single day must be provided 24 identical Julian day values (one for each hour).
</p>
<p>Four cases are possible:
</p>

<ul>
<li> <p><code>TimeStepIn = "daily"</code> and <code>TimeStepOut = "daily"</code>: this is the classical application of the Oudin et al. (2005) formula
</p>
</li>
<li> <p><code>TimeStepIn = "daily"</code> and <code>TimeStepOut = "hourly"</code>: the daily temperature is used inside the <code>PE_Oudin</code> function to calculate daily PE, which is then disaggregated at the hourly time step with use of a sinusoidal function (see Lobligeois, 2014, p. 78)
</p>
</li>
<li> <p><code>TimeStepIn = "hourly"</code> and <code>TimeStepOut = "daily"</code>: the hourly temperature is aggregated at the daily time step and the daily PE is calculated normally within <code>PE_Oudin</code>
</p>
</li>
<li> <p><code>TimeStepIn = "hourly"</code> and <code>TimeStepOut = "hourly"</code>: the hourly temperature is aggregated at the daily time step, the daily PE is then calculated normally within <code>PE_Oudin</code>, which is finally disaggregated at the hourly time step with use of a sinusoidal function (see Lobligeois, 2014, p. 78)
</p>
</li></ul>

<p>The use of the <code>PEdaily_Oudin</code> corresponds to the first case of the use of <code>PE_Oudin</code>.
</p>


<h3>Value</h3>

<p>[numeric] time series of daily potential evapotranspiration [mm/time step]
</p>


<h3>Author(s)</h3>

<p>Laurent Coron, Ludovic Oudin, Olivier Delaigue, Guillaume Thirel, François Bourgin
</p>


<h3>References</h3>

<p>Oudin, L., Hervieu, F., Michel, C., Perrin, C., Andréassian, V., Anctil, F. and Loumagne, C. (2005).
Which potential evapotranspiration input for a lumped rainfall-runoff model?
Part 2 - Towards a simple and efficient potential evapotranspiration model for rainfall-runoff modelling.
Journal of Hydrology, 303(1-4), 290-306, <a href="https://doi.org/10.1016/j.jhydrol.2004.08.026">doi:10.1016/j.jhydrol.2004.08.026</a>.
<br /><br />
Lobligeois, F. (2014).
Mieux connaitre la distribution spatiale des pluies améliore-t-il la modélisation des crues ? Diagnostic sur 181 bassins versants français.
PhD thesis (in French), AgroParisTech - Irstea Antony, Paris, France.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)
data(L0123001)
PotEvap &lt;- PE_Oudin(JD = as.POSIXlt(BasinObs$DatesR)$yday + 1,
                    Temp = BasinObs$T,
                    Lat = 0.8, LatUnit = "rad")
</code></pre>

<hr>
<h2 id='plot'>Default preview of model outputs</h2><span id='topic+plot.OutputsModel'></span><span id='topic+plot'></span><span id='topic+exampleSimPlot'></span><span id='topic+simGR4J'></span><span id='topic+simCNGR4J'></span>

<h3>Description</h3>

<p>Function which creates a screen plot giving an overview of the model outputs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'OutputsModel'
plot(x, Qobs = NULL, IndPeriod_Plot = NULL,
     BasinArea = NULL, which = "synth", log_scale = FALSE,
     cex.axis = 1, cex.lab = 0.9, cex.leg = 0.9, lwd = 1,
     AxisTS = function(x) axis.POSIXct(side = 1, x = x$DatesR, ...),
     LayoutMat = NULL,
     LayoutWidths = rep.int(1, ncol(LayoutMat)),
     LayoutHeights = rep.int(1, nrow(LayoutMat)),
     verbose = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_+3A_x">x</code></td>
<td>
<p>[object of class <em>OutputsModel</em>] list of model outputs (which must at least include DatesR, Precip and Qsim) [POSIXlt, mm/time step, mm/time step]</p>
</td></tr>
<tr><td><code id="plot_+3A_qobs">Qobs</code></td>
<td>
<p>(optional) [numeric] time series of observed flow (for the same time steps than simulated) [mm/time step]</p>
</td></tr>
<tr><td><code id="plot_+3A_indperiod_plot">IndPeriod_Plot</code></td>
<td>
<p>(optional) [numeric] indices of the time steps to be plotted (among the OutputsModel series)</p>
</td></tr>
<tr><td><code id="plot_+3A_basinarea">BasinArea</code></td>
<td>
<p>(optional) [numeric] basin area [km2], used to plot flow axes in m3/s</p>
</td></tr>
<tr><td><code id="plot_+3A_which">which</code></td>
<td>
<p>(optional) [character] choice of plots <br /> (e.g. c(<code>"Precip"</code>, <code>"Temp"</code>, <code>"SnowPack"</code>, <code>"Flows"</code>, <code>"Error"</code>, <code>"Regime"</code>, <code>"CumFreq"</code>, <code>"CorQQ"</code>)), default = <code>"synth"</code>, see details below</p>
</td></tr>
<tr><td><code id="plot_+3A_log_scale">log_scale</code></td>
<td>
<p>(optional) [boolean] indicating if the flow and the error time series axis and the flow error time series axis are to be logarithmic, default = <code>FALSE</code></p>
</td></tr>
<tr><td><code id="plot_+3A_cex.axis">cex.axis</code></td>
<td>
<p>(optional) [numeric] the magnification to be used for axis annotation relative to the current setting of <code>cex</code></p>
</td></tr>
<tr><td><code id="plot_+3A_cex.lab">cex.lab</code></td>
<td>
<p>(optional) [numeric] the magnification to be used for x and y labels relative to the current setting of <code>cex</code></p>
</td></tr>
<tr><td><code id="plot_+3A_cex.leg">cex.leg</code></td>
<td>
<p>(optional) [numeric] the magnification to be used for the legend labels relative to the current setting of <code>cex</code></p>
</td></tr>
<tr><td><code id="plot_+3A_lwd">lwd</code></td>
<td>
<p>(optional) [numeric] the line width (a positive number)</p>
</td></tr>
<tr><td><code id="plot_+3A_axists">AxisTS</code></td>
<td>
<p>(optional) [function] to manage x-axis representing calendar dates and times on time series plots (see <code><a href="graphics.html#topic+axis">axis</a></code> and <code><a href="graphics.html#topic+axis.POSIXct">axis.POSIXct</a></code>)</p>
</td></tr>
<tr><td><code id="plot_+3A_layoutmat">LayoutMat</code></td>
<td>
<p>(optional) [numeric] a matrix object specifying the location of the next N figures on the output device. Each value in the matrix must be 0 or a positive integer. If N is the largest positive integer in the matrix, then the integers <code class="reqn">1, \dots, N-1</code> must also appear at least once in the matrix (see <code><a href="graphics.html#topic+layout">layout</a></code>)</p>
</td></tr>
<tr><td><code id="plot_+3A_layoutwidths">LayoutWidths</code></td>
<td>
<p>(optional) [numeric] a vector of values for the widths of columns on the device (see <code><a href="graphics.html#topic+layout">layout</a></code>)</p>
</td></tr>
<tr><td><code id="plot_+3A_layoutheights">LayoutHeights</code></td>
<td>
<p>(optional) [numeric] a vector of values for the heights of rows on the device (see <code><a href="graphics.html#topic+layout">layout</a></code>)</p>
</td></tr>
<tr><td><code id="plot_+3A_verbose">verbose</code></td>
<td>
<p>(optional) [boolean] indicating if the function is run in verbose mode or not, default = <code>TRUE</code></p>
</td></tr>
<tr><td><code id="plot_+3A_...">...</code></td>
<td>
<p>(optional) other parameters to be passed through to plotting functions</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Different types of independent graphs are available (depending on the model, but always drawn in this order):
</p>

<ul>
<li> <p><code>"Precip"</code>: time series of total precipitation
</p>
</li>
<li> <p><code>"PotEvap"</code>: time series of potential evapotranspiration
</p>
</li>
<li> <p><code>"ActuEvap"</code>: time series of simulated actual evapotranspiration (overlaid to <code>"PotEvap"</code> if already drawn)
</p>
</li>
<li> <p><code>"Temp"</code>: time series of temperature (plotted only if CemaNeige is used)
</p>
</li>
<li> <p><code>"SnowPack"</code>: time series of snow water equivalent (plotted only if CemaNeige is used)
</p>
</li>
<li> <p><code>"Flows"</code>: time series of simulated flows (and observed flows if provided)
</p>
</li>
<li> <p><code>"Error"</code>: time series of simulated flows minus observed flows (and observed flows if provided)
</p>
</li>
<li> <p><code>"Regime"</code>: centred 30-day rolling mean applied on interannual average of daily simulated flows (and observed flows if provided)
</p>
</li>
<li> <p><code>"CorQQ"</code>: correlation plot between simulated and observed flows (only if observed flows provided)
</p>
</li>
<li> <p><code>"CumFreq"</code>: cumulative frequency plot for simulated flows (and observed flows if provided)
</p>
</li></ul>

<p>Different dashboards of results including various graphs are available:
</p>

<ul>
<li> <p><code>"perf"</code>: corresponds to <code>"Error"</code>, <code>"Regime"</code>, <code>"CumFreq"</code> and <code>"CorQQ"</code>
</p>
</li>
<li> <p><code>"ts"</code>: corresponds to <code>"Precip"</code>, <code>"PotEvap"</code>, <code>"Temp"</code>, <code>"SnowPack"</code> and <code>"Flows"</code>
</p>
</li>
<li> <p><code>"synth"</code>: corresponds to <code>"Precip"</code>, <code>"Temp"</code>, <code>"SnowPack"</code>, <code>"Flows"</code>, <code>"Regime"</code>, <code>"CumFreq"</code> and <code>"CorQQ"</code>
</p>
</li>
<li> <p><code>"all"</code>: corresponds to <code>"Precip"</code>, <code>"PotEvap"</code>, <code>"ActuEvap"</code>, <code>"Temp"</code>, <code>"SnowPack"</code>, <code>"Flows"</code>, <code>"Error"</code>, <code>"Regime"</code>, <code>"CumFreq"</code> and <code>"CorQQ"</code>
</p>
</li></ul>

<p>If several dashboards are selected, or if an independent graph is called with a dashboard, the graphical device will include all the requested graphs without redundancy.
</p>


<h3>Value</h3>

<p>Screen plot window.
</p>


<h3>Author(s)</h3>

<p>Laurent Coron, Olivier Delaigue, Guillaume Thirel
</p>


<h3>Examples</h3>

<pre><code class='language-R'>### see examples of RunModel_GR4J or RunModel_CemaNeigeGR4J functions
### to understand how the example datasets have been prepared


## loading examples dataset for GR4J and GR4J + CemaNeige
data(exampleSimPlot)


### Qobs and outputs from GR4J and GR4J + CemaNeige models
str(simGR4J, max.level = 1)
str(simCNGR4J, max.level = 1)


### default dashboard (which = "synth")

## GR models whithout CemaNeige
plot(simGR4J$OutputsModel, Qobs = simGR4J$Qobs)

## GR models whith CemaNeige ("Temp" and "SnowPack" added)
plot(simCNGR4J$OutputsModel, Qobs = simCNGR4J$Qobs)


### "Error" and "CorQQ" plots cannot be display whithout Qobs
plot(simGR4J$OutputsModel, which = "all", Qobs = simGR4J$Qobs)
plot(simGR4J$OutputsModel, which = "all", Qobs = NULL)


### complex plot arrangements
plot(simGR4J$OutputsModel, Qobs = simGR4J$Qobs,
     which = c("Flows", "Regime", "CumFreq", "CorQQ"),
     LayoutMat = matrix(c(1, 2, 3, 1, 4, 4), ncol = 2),
     LayoutWidths  = c(1.5, 1),
     LayoutHeights = c(0.5, 1, 1))


### customize x-axis on time series plot
FunAxisTS &lt;- function(x) {
  axis.POSIXct(side = 1, x = x$DatesR,
  at = pretty(x$DatesR, n = 10),
  format = "%Y-%m-%d")
}
plot(simGR4J$OutputsModel, Qobs = simGR4J$Qobs, AxisTS = FunAxisTS)


### add a main title

## the whole list of settable par's
opar &lt;- par(no.readonly = TRUE)

## define outer margins and a title inside it
par(oma = c(0, 0, 3, 0))
plot(simGR4J$OutputsModel, Qobs = simGR4J$Qobs)
title(main = "GR4J outputs", outer = TRUE, line = 1.2, cex.main = 1.4)

## reset original par
par(opar)
</code></pre>

<hr>
<h2 id='RunModel'>Run with the provided hydrological model function</h2><span id='topic+RunModel'></span>

<h3>Description</h3>

<p>Function which performs a single model run with the provided function over the selected period.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RunModel(InputsModel, RunOptions, Param, FUN_MOD, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RunModel_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em>] see <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_+3A_param">Param</code></td>
<td>
<p>[numeric] vector of model parameters (See details for SD lag model)</p>
</td></tr>
<tr><td><code id="RunModel_+3A_fun_mod">FUN_MOD</code></td>
<td>
<p>[function] hydrological model function (e.g. <code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code>, <code><a href="#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code>)</p>
</td></tr>
<tr><td><code id="RunModel_+3A_...">...</code></td>
<td>
<p>(optional) arguments to pass to <code>FUN_MOD</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>InputsModel</code> parameter has been created for using a semi-distributed (SD) lag model (See <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>), the first item of <code>Param</code> parameter should contain a constant lag parameter expressed as a velocity in m/s, parameters for the hydrological model are then shift one position to the right.
</p>


<h3>Value</h3>

<p>[list] see <code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code> or <code><a href="#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code> for details.
</p>
<p>If <code>InputsModel</code> parameter has been created for using a semi-distributed (SD) lag model (See <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>), the list value contains an extra item named <code>QsimDown</code> which is a numeric series of simulated discharge [mm/time step] related to the run-off contribution of the downstream sub-catchment.
</p>


<h3>Author(s)</h3>

<p>Laurent Coron, Olivier Delaigue
</p>


<h3>See Also</h3>

<p><code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code>, <code><a href="#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code>, <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>,
<code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>, <code><a href="#topic+CreateIniStates">CreateIniStates</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123001)

## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_GR4J, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR4J,
                               InputsModel = InputsModel, IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(X1 = 734.568, X2 = -0.840, X3 = 109.809, X4 = 1.971)
OutputsModel &lt;- RunModel(InputsModel = InputsModel,
                         RunOptions = RunOptions, Param = Param,
                         FUN_MOD = RunModel_GR4J)

## results preview
plot(OutputsModel, Qobs = BasinObs$Qmm[Ind_Run])

## efficiency criterion: Nash-Sutcliffe Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                                RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)
</code></pre>

<hr>
<h2 id='RunModel_CemaNeige'>Run with the CemaNeige snow module</h2><span id='topic+RunModel_CemaNeige'></span>

<h3>Description</h3>

<p>Function which performs a single run for the CemaNeige snow module at the daily or hourly time step.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RunModel_CemaNeige(InputsModel, RunOptions, Param)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RunModel_CemaNeige_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em>] see <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_CemaNeige_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_CemaNeige_+3A_param">Param</code></td>
<td>
<p>[numeric] vector of 2 (or 4 parameters if <code>IsHyst = TRUE</code>, see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details)
</p>

<table>
<tr>
 <td style="text-align: left;">
    CemaNeige X1 </td><td style="text-align: left;"> weighting coefficient for snow pack thermal state [-]                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    CemaNeige X2 </td><td style="text-align: left;"> degree-day melt coefficient [mm/°C/time step]                           </td>
</tr>
<tr>
 <td style="text-align: left;">
    CemaNeige X3 </td><td style="text-align: left;"> (optional) accumulation threshold [mm] (needed if <code>IsHyst = TRUE</code>) </td>
</tr>
<tr>
 <td style="text-align: left;">
    CemaNeige X4 </td><td style="text-align: left;"> (optional) percentage (between 0 and 1) of annual snowfall defining the melt threshold [-] (needed if <code>IsHyst = TRUE</code>) </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>
</td></tr>
</table>


<h3>Details</h3>

<p>The choice of the CemaNeige version (i.e. with or without hysteresis) is explained in <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>. <br />
For further details on the model, see the references section. <br />
For further details on the argument structures and initialisation options, see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>.
</p>


<h3>Value</h3>

<p>[list] containing the function outputs organised as follows:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <em>$DatesR </em>                                </td><td style="text-align: left;"> [POSIXlt] series of dates                                            </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers</em>                        </td><td style="text-align: left;"> [list] CemaNeige outputs (1 element per layer)                       </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Pliq        </em> </td><td style="text-align: left;"> [numeric] series of liquid precip. [mm/time step]                    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Psol        </em> </td><td style="text-align: left;"> [numeric] series of solid precip. [mm/time step]                     </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$SnowPack    </em> </td><td style="text-align: left;"> [numeric] series of snow pack (snow water equivalent) [mm]           </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$ThermalState</em> </td><td style="text-align: left;"> [numeric] series of snow pack thermal state [°C]                     </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Gratio      </em> </td><td style="text-align: left;"> [numeric] series of Gratio [0-1]                                     </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$PotMelt     </em> </td><td style="text-align: left;"> [numeric] series of potential snow melt [mm/time step]               </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Melt        </em> </td><td style="text-align: left;"> [numeric] series of actual snow melt [mm/time step]                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$PliqAndMelt </em> </td><td style="text-align: left;"> [numeric] series of liquid precip. + actual snow melt [mm/time step] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Temp        </em> </td><td style="text-align: left;"> [numeric] series of air temperature [°C]                             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Gthreshold  </em> </td><td style="text-align: left;"> [numeric] series of melt threshold [mm]                              </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Glocalmax   </em> </td><td style="text-align: left;"> [numeric] series of local melt threshold for hysteresis [mm]         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$StateEnd</em> </td><td style="text-align: left;"> [numeric] states at the end of the run: CemaNeige states [mm &amp; °C]. See <code><a href="#topic+CreateIniStates">CreateIniStates</a></code> for more details </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>

<p>Refer to the provided references or to the package source code for further details on these model outputs.
</p>


<h3>Author(s)</h3>

<p>Laurent Coron, Audrey Valéry, Vazken Andréassian, Olivier Delaigue, Guillaume Thirel
</p>


<h3>References</h3>

<p>Riboust, P., Thirel, G., Le Moine, N. and Ribstein, P. (2019).
Revisiting a simple degree-day model for integrating satellite data: Implementation of SWE-SCA hystereses.
Journal of Hydrology and Hydromechanics, 67(1), 70–81, <a href="https://doi.org/10.2478/johh-2018-0004">doi:10.2478/johh-2018-0004</a>.
<br /><br />
Valéry, A., Andréassian, V. and Perrin, C. (2014).
&quot;As simple as possible but not simpler&quot;: What is useful in a temperature-based snow-accounting routine?
Part 1 - Comparison of six snow accounting routines on 380 catchments.
Journal of Hydrology, 517(0), 1166-1175, <a href="https://doi.org/10.1016/j.jhydrol.2014.04.059">doi:10.1016/j.jhydrol.2014.04.059</a>.
<br /><br />
Valéry, A., Andréassian, V. and Perrin, C. (2014).
&quot;As simple as possible but not simpler&quot;: What is useful in a temperature-based snow-accounting routine?
Part 2 - Sensitivity analysis of the Cemaneige snow accounting routine on 380 catchments.
Journal of Hydrology, 517(0), 1176-1187, <a href="https://doi.org/10.1016/j.jhydrol.2014.04.058">doi:10.1016/j.jhydrol.2014.04.058</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code>, <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>,
<code><a href="#topic+CreateIniStates">CreateIniStates</a></code>, <code><a href="#topic+CreateCalibOptions">CreateCalibOptions</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## load of catchment data
data(L0123002)

## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_CemaNeige, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P,TempMean = BasinObs$T,
                                 ZInputs = BasinInfo$HypsoData[51], HypsoData=BasinInfo$HypsoData,
                                 NLayers = 5)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))


## --- original version of CemaNeige

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_CemaNeige, InputsModel = InputsModel,
                               IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(CNX1 = 0.962, CNX2 = 2.249)
OutputsModel &lt;- RunModel_CemaNeige(InputsModel = InputsModel,
                                   RunOptions = RunOptions, Param = Param)

## results preview
plot(OutputsModel)


## --- version of CemaNeige with the Linear Hysteresis

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_CemaNeige, InputsModel = InputsModel,
                               IndPeriod_Run = Ind_Run, IsHyst = TRUE)

## simulation
Param &lt;- c(CNX1 = 0.962, CNX2 = 2.249, CNX3 = 100, CNX4 = 0.4)
OutputsModel &lt;- RunModel_CemaNeige(InputsModel = InputsModel,
                                   RunOptions = RunOptions, Param = Param)

## results preview
plot(OutputsModel)
</code></pre>

<hr>
<h2 id='RunModel_CemaNeigeGR4H'>Run with the CemaNeigeGR4H hydrological model</h2><span id='topic+RunModel_CemaNeigeGR4H'></span>

<h3>Description</h3>

<p>Function which performs a single run for the CemaNeige-GR4H hourly lumped model over the test period.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RunModel_CemaNeigeGR4H(InputsModel, RunOptions, Param)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RunModel_CemaNeigeGR4H_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em>] see <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_CemaNeigeGR4H_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_CemaNeigeGR4H_+3A_param">Param</code></td>
<td>
<p>[numeric] vector of 6 (or 8 parameters if <code>IsHyst = TRUE</code>, see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details)
</p>

<table>
<tr>
 <td style="text-align: left;">
    GR4H X1      </td><td style="text-align: left;"> production store capacity [mm]                                          </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR4H X2      </td><td style="text-align: left;"> intercatchment exchange coefficient [mm/h]                              </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR4H X3      </td><td style="text-align: left;"> routing store capacity [mm]                                             </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR4H X4      </td><td style="text-align: left;"> unit hydrograph time constant [h]                                       </td>
</tr>
<tr>
 <td style="text-align: left;">
    CemaNeige X1 </td><td style="text-align: left;"> weighting coefficient for snow pack thermal state [-]                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    CemaNeige X2 </td><td style="text-align: left;"> degree-hour melt coefficient [mm/°C/h]                                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    CemaNeige X3 </td><td style="text-align: left;"> (optional) accumulation threshold [mm] (needed if <code>IsHyst = TRUE</code>) </td>
</tr>
<tr>
 <td style="text-align: left;">
    CemaNeige X4 </td><td style="text-align: left;"> (optional) percentage (between 0 and 1) of annual snowfall defining the melt threshold [-] (needed if <code>IsHyst = TRUE</code>) </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>
</td></tr>
</table>


<h3>Details</h3>

<p>It is advised to run the GR5H model with an interception store (see Ficchi et al. (2019)) as it improves the consistency of the model fluxes and provides better performance. To do so, the <code><a href="#topic+Imax">Imax</a></code> functions allows to estimates the maximal capacity of the interception store, which can then be given to <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>. <br />
</p>
<p>The choice of the CemaNeige version is explained in <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>. <br />
For further details on the model, see the references section. <br />
For further details on the argument structures and initialisation options, see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>.
<br />
<br />
See <code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code> to look at the diagram of the hydrological model.
</p>


<h3>Value</h3>

<p>[list] containing the function outputs organised as follows:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <em>$DatesR  </em> </td><td style="text-align: left;"> [POSIXlt] series of dates                                                     </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$PotEvap </em> </td><td style="text-align: left;"> [numeric] series of input potential evapotranspiration (E) [mm/h]             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Precip  </em> </td><td style="text-align: left;"> [numeric] series of input total precipitation (P) [mm/h]                      </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Prod    </em> </td><td style="text-align: left;"> [numeric] series of production store level (S) [mm]                           </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Pn      </em> </td><td style="text-align: left;"> [numeric] series of net rainfall (Pn) [mm/h]                                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Ps      </em> </td><td style="text-align: left;"> [numeric] series of the part of Pn filling the production store (Ps) [mm/h]   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AE      </em> </td><td style="text-align: left;"> [numeric] series of actual evapotranspiration [mm/h]                          </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Perc    </em> </td><td style="text-align: left;"> [numeric] series of percolation (Perc) [mm/h]                                 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$PR      </em> </td><td style="text-align: left;"> [numeric] series of Pr=Pn-Ps+Perc (Pr) [mm/h]                                 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Q9      </em> </td><td style="text-align: left;"> [numeric] series of UH1 outflow (Q9) [mm/h]                                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Q1      </em> </td><td style="text-align: left;"> [numeric] series of UH2 outflow (Q1) [mm/h]                                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Rout    </em> </td><td style="text-align: left;"> [numeric] series of routing store level (R1) [mm]                             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Exch    </em> </td><td style="text-align: left;"> [numeric] series of potential semi-exchange between catchments [mm/h]         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch1  </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments for branch 1 [mm/h]    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch2  </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments for branch 2 [mm/h]    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch   </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments (AExch1+AExch2) [mm/h] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$QR      </em> </td><td style="text-align: left;"> [numeric] series of routing store outflow (Qr) [mm/h]                         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$QD      </em> </td><td style="text-align: left;"> [numeric] series of direct flow from UH2 after exchange (Qd) [mm/h]           </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Qsim    </em> </td><td style="text-align: left;"> [numeric] series of simulated discharge (Q) [mm/h]                            </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers</em> </td><td style="text-align: left;"> [list] CemaNeige outputs (1 element per layer)                         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Pliq        </em> </td><td style="text-align: left;"> [numeric] series of liquid precip. [mm/h]                    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Psol        </em> </td><td style="text-align: left;"> [numeric] series of solid precip. [mm/h]                     </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$SnowPack    </em> </td><td style="text-align: left;"> [numeric] series of snow pack (snow water equivalent)[mm]    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$ThermalState</em> </td><td style="text-align: left;"> [numeric] series of snow pack thermal state [°C]             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Gratio      </em> </td><td style="text-align: left;"> [numeric] series of Gratio [0-1]                             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$PotMelt     </em> </td><td style="text-align: left;"> [numeric] series of potential snow melt [mm/h]               </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Melt        </em> </td><td style="text-align: left;"> [numeric] series of actual snow melt [mm/h]                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$PliqAndMelt </em> </td><td style="text-align: left;"> [numeric] series of liquid precip. + actual snow melt [mm/h] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Temp        </em> </td><td style="text-align: left;"> [numeric] series of air temperature [°C]                     </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Gthreshold  </em> </td><td style="text-align: left;"> [numeric] series of melt threshold [mm]                      </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Glocalmax   </em> </td><td style="text-align: left;"> [numeric] series of local melt threshold for hysteresis [mm] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>RunOptions$WarmUpQsim</em> </td><td style="text-align: left;"> [numeric] series of simulated discharge (Q) on the warm-up period [mm/h] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>RunOptions$Param     </em> </td><td style="text-align: left;"> [numeric] parameter set parameter set used by the model                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$StateEnd</em> </td><td style="text-align: left;"> [numeric] states at the end of the run: store &amp; unit hydrographs levels [mm], CemaNeige states [mm &amp; °C]. See <code><a href="#topic+CreateIniStates">CreateIniStates</a></code> for more details </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>

<p>Refer to the provided references or to the package source code for further details on these model outputs.
</p>


<h3>Author(s)</h3>

<p>Laurent Coron, Claude Michel, Charles Perrin, Thibault Mathevet, Audrey Valéry, Vazken Andréassian, Olivier Delaigue, Guillaume Thirel
</p>


<h3>References</h3>

<p>Mathevet, T. (2005).
Quels modèles pluie-débit globaux pour le pas de temps horaire ?
Développement empirique et comparaison de modèles sur un large échantillon de bassins versants.
PhD thesis (in French), ENGREF - Cemagref Antony, Paris, France.
<br /><br />
Le Moine, N. (2008).
Le bassin versant de surface vu par le souterrain :
une voie d'amélioration des performances et du réalisme des modèles pluie-débit ?
PhD thesis (in French), UPMC - Cemagref Antony, Paris, France.
<br /><br />
Riboust, P., Thirel, G., Le Moine, N. and Ribstein, P. (2019).
Revisiting a simple degree-day model for integrating satellite data: Implementation of SWE-SCA hystereses.
Journal of Hydrology and Hydromechanics, 67(1), 70–81, <a href="https://doi.org/10.2478/johh-2018-0004">doi:10.2478/johh-2018-0004</a>.
<br /><br />
Valéry, A., Andréassian, V. and Perrin, C. (2014).
&quot;As simple as possible but not simpler&quot;: What is useful in a temperature-based snow-accounting routine?
Part 1 - Comparison of six snow accounting routines on 380 catchments.
Journal of Hydrology, 517(0), 1166-1175, <a href="https://doi.org/10.1016/j.jhydrol.2014.04.059">doi:10.1016/j.jhydrol.2014.04.059</a>.
<br /><br />
Valéry, A., Andréassian, V. and Perrin, C. (2014).
&quot;As simple as possible but not simpler&quot;: What is useful in a temperature-based snow-accounting routine?
Part 2 - Sensitivity analysis of the Cemaneige snow accounting routine on 380 catchments.
Journal of Hydrology, 517(0), 1176-1187, <a href="https://doi.org/10.1016/j.jhydrol.2014.04.058">doi:10.1016/j.jhydrol.2014.04.058</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+RunModel_CemaNeige">RunModel_CemaNeige</a></code>, <code><a href="#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code>, <code><a href="#topic+RunModel_CemaNeigeGR5J">RunModel_CemaNeigeGR5J</a></code>,
<code><a href="#topic+RunModel_CemaNeigeGR6J">RunModel_CemaNeigeGR6J</a></code>, <code><a href="#topic+RunModel_GR4H">RunModel_GR4H</a></code>,
<code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>, <code><a href="#topic+CreateIniStates">CreateIniStates</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(airGR)

## loading catchment data
data(U2345030)


## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_CemaNeigeGR4H, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E, TempMean = BasinObs$T,
                                 ZInputs = BasinInfo$ZInputs,
                                 HypsoData = BasinInfo$HypsoData, NLayers = 5)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d %H")=="2004-03-01 00"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d %H")=="2008-12-31 23"))


## --- original version of CemaNeige

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_CemaNeigeGR4H, InputsModel = InputsModel,
                               IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(X1 = 149.905, X2 = -0.487, X3 = 391.506, X4 = 9.620,
           CNX1 = 0.520, CNX2 = 0.133)
OutputsModel &lt;- RunModel_CemaNeigeGR4H(InputsModel = InputsModel,
                                       RunOptions = RunOptions, Param = Param)

## results preview
plot(OutputsModel, Qobs = BasinObs$Qmm[Ind_Run])

## efficiency criterion: Nash-Sutcliffe Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                                RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)

## End(Not run)
</code></pre>

<hr>
<h2 id='RunModel_CemaNeigeGR4J'>Run with the CemaNeigeGR4J hydrological model</h2><span id='topic+RunModel_CemaNeigeGR4J'></span>

<h3>Description</h3>

<p>Function which performs a single run for the CemaNeige-GR4J daily lumped model over the test period.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RunModel_CemaNeigeGR4J(InputsModel, RunOptions, Param)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RunModel_CemaNeigeGR4J_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em>] see <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_CemaNeigeGR4J_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_CemaNeigeGR4J_+3A_param">Param</code></td>
<td>
<p>[numeric] vector of 6 (or 8 parameters if <code>IsHyst = TRUE</code>, see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details)
</p>

<table>
<tr>
 <td style="text-align: left;">
    GR4J X1      </td><td style="text-align: left;"> production store capacity [mm]                                          </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR4J X2      </td><td style="text-align: left;"> intercatchment exchange coefficient [mm/d]                              </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR4J X3      </td><td style="text-align: left;"> routing store capacity [mm]                                             </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR4J X4      </td><td style="text-align: left;"> unit hydrograph time constant [d]                                       </td>
</tr>
<tr>
 <td style="text-align: left;">
    CemaNeige X1 </td><td style="text-align: left;"> weighting coefficient for snow pack thermal state [-]                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    CemaNeige X2 </td><td style="text-align: left;"> degree-day melt coefficient [mm/°C/d]                                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    CemaNeige X3 </td><td style="text-align: left;"> (optional) accumulation threshold [mm] (needed if <code>IsHyst = TRUE</code>) </td>
</tr>
<tr>
 <td style="text-align: left;">
    CemaNeige X4 </td><td style="text-align: left;"> (optional) percentage (between 0 and 1) of annual snowfall defining the melt threshold [-] (needed if <code>IsHyst = TRUE</code>) </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>
</td></tr>
</table>


<h3>Details</h3>

<p>The choice of the CemaNeige version is explained in <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>. <br />
For further details on the model, see the references section. <br />
For further details on the argument structures and initialisation options, see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>.
<br />
<br />
See <code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code> to look at the diagram of the hydrological model.
</p>


<h3>Value</h3>

<p>[list] containing the function outputs organised as follows:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <em>$DatesR  </em> </td><td style="text-align: left;"> [POSIXlt] series of dates                                                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$PotEvap </em> </td><td style="text-align: left;"> [numeric] series of input potential evapotranspiration [mm/d] (E)           </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Precip  </em> </td><td style="text-align: left;"> [numeric] series of input total precipitation (P) [mm/d]                    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Prod    </em> </td><td style="text-align: left;"> [numeric] series of production store level (S) [mm]                         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Pn      </em> </td><td style="text-align: left;"> [numeric] series of net rainfall (Pn) [mm/d]                                </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Ps      </em> </td><td style="text-align: left;"> [numeric] series of the part of Pn filling the production store (Ps) [mm/d] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AE      </em> </td><td style="text-align: left;"> [numeric] series of actual evapotranspiration [mm/d]                        </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Perc    </em> </td><td style="text-align: left;"> [numeric] series of percolation (Perc) [mm/d]                               </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$PR      </em> </td><td style="text-align: left;"> [numeric] series of Pr=Pn-Ps+Perc (Pr) [mm/d]                               </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Q9      </em> </td><td style="text-align: left;"> [numeric] series of UH1 outflow (Q9) [mm/d]                                 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Q1      </em> </td><td style="text-align: left;"> [numeric] series of UH2 outflow (Q1) [mm/d]                                 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Rout    </em> </td><td style="text-align: left;"> [numeric] series of routing store level (R1) [mm]                           </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Exch    </em> </td><td style="text-align: left;"> [numeric] series of potential semi-exchange between catchments [mm/d]       </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch1  </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments for branch 1 [mm/d]  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch2  </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments for branch 2 [mm/d]  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch   </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments (1+2) [mm/d]         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$QR      </em> </td><td style="text-align: left;"> [numeric] series of routing store outflow (Qr) [mm/d]                       </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$QD      </em> </td><td style="text-align: left;"> [numeric] series of direct flow from UH2 after exchange (Qd) [mm/d]         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Qsim    </em> </td><td style="text-align: left;"> [numeric] series of simulated discharge (Q) [mm/d]                          </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers</em> </td><td style="text-align: left;"> [list] list of CemaNeige outputs (1 list per layer)                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Pliq         </em> </td><td style="text-align: left;"> [numeric] series of liquid precip. [mm/d]                    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Psol         </em> </td><td style="text-align: left;"> [numeric] series of solid precip. [mm/d]                     </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$SnowPack     </em> </td><td style="text-align: left;"> [numeric] series of snow pack (snow water equivalent) [mm]   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$ThermalState </em> </td><td style="text-align: left;"> [numeric] series of snow pack thermal state [°C]             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Gratio       </em> </td><td style="text-align: left;"> [numeric] series of Gratio [0-1]                             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$PotMelt      </em> </td><td style="text-align: left;"> [numeric] series of potential snow melt [mm/d]               </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Melt         </em> </td><td style="text-align: left;"> [numeric] series of actual snow melt [mm/d]                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$PliqAndMelt  </em> </td><td style="text-align: left;"> [numeric] series of liquid precip. + actual snow melt [mm/d] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Temp         </em> </td><td style="text-align: left;"> [numeric] series of air temperature [°C]                     </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Gthreshold   </em> </td><td style="text-align: left;"> [numeric] series of melt threshold [mm]                      </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Glocalmax    </em> </td><td style="text-align: left;"> [numeric] series of local melt threshold for hysteresis [mm] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>RunOptions$WarmUpQsim</em> </td><td style="text-align: left;"> [numeric] series of simulated discharge (Q) on the warm-up period [mm/d] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>RunOptions$Param     </em> </td><td style="text-align: left;"> [numeric] parameter set parameter set used by the model                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$StateEnd</em> </td><td style="text-align: left;"> [numeric] states at the end of the run: store &amp; unit hydrographs levels [mm], CemaNeige states [mm &amp; °C]. See <code><a href="#topic+CreateIniStates">CreateIniStates</a></code> for more details </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>

<p>Refer to the provided references or to the package source code for further details on these model outputs.
</p>


<h3>Author(s)</h3>

<p>Laurent Coron, Claude Michel, Charles Perrin, Audrey Valéry, Vazken Andréassian, Olivier Delaigue, Guillaume Thirel
</p>


<h3>References</h3>

<p>Perrin, C., Michel, C. and Andréassian, V. (2003).
Improvement of a parsimonious model for streamflow simulation.
Journal of Hydrology, 279(1-4), 275-289, <a href="https://doi.org/10.1016/S0022-1694%2803%2900225-7">doi:10.1016/S0022-1694(03)00225-7</a>.
<br /><br />
Riboust, P., Thirel, G., Le Moine, N. and Ribstein, P. (2019).
Revisiting a simple degree-day model for integrating satellite data: Implementation of SWE-SCA hystereses.
Journal of Hydrology and Hydromechanics, 67(1), 70–81, <a href="https://doi.org/10.2478/johh-2018-0004">doi:10.2478/johh-2018-0004</a>.
<br /><br />
Valéry, A., Andréassian, V. and Perrin, C. (2014).
&quot;As simple as possible but not simpler&quot;: What is useful in a temperature-based snow-accounting routine?
Part 1 - Comparison of six snow accounting routines on 380 catchments.
Journal of Hydrology, 517(0), 1166-1175, <a href="https://doi.org/10.1016/j.jhydrol.2014.04.059">doi:10.1016/j.jhydrol.2014.04.059</a>.
<br /><br />
Valéry, A., Andréassian, V. and Perrin, C. (2014).
&quot;As simple as possible but not simpler&quot;: What is useful in a temperature-based snow-accounting routine?
Part 2 - Sensitivity analysis of the Cemaneige snow accounting routine on 380 catchments.
Journal of Hydrology, 517(0), 1176-1187, <a href="https://doi.org/10.1016/j.jhydrol.2014.04.058">doi:10.1016/j.jhydrol.2014.04.058</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+RunModel_CemaNeige">RunModel_CemaNeige</a></code>, <code><a href="#topic+RunModel_CemaNeigeGR5J">RunModel_CemaNeigeGR5J</a></code>,
<code><a href="#topic+RunModel_CemaNeigeGR6J">RunModel_CemaNeigeGR6J</a></code>, <code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code>,
<code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>, <code><a href="#topic+CreateIniStates">CreateIniStates</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123002)

## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_CemaNeigeGR4J, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E, TempMean = BasinObs$T,
                                 ZInputs = median(BasinInfo$HypsoData),
                                 HypsoData = BasinInfo$HypsoData, NLayers = 5)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))


## --- original version of CemaNeige

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_CemaNeigeGR4J, InputsModel = InputsModel,
                               IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(X1 = 408.774, X2 = 2.646, X3 = 131.264, X4 = 1.174,
           CNX1 = 0.962, CNX2 = 2.249)
OutputsModel &lt;- RunModel_CemaNeigeGR4J(InputsModel = InputsModel,
                                       RunOptions = RunOptions, Param = Param)

## results preview
plot(OutputsModel, Qobs = BasinObs$Qmm[Ind_Run])

## efficiency criterion: Nash-Sutcliffe Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                                RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)


## --- version of CemaNeige with the Linear Hysteresis

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_CemaNeigeGR4J, InputsModel = InputsModel,
                               IndPeriod_Run = Ind_Run, IsHyst = TRUE)

## simulation
Param &lt;- c(X1 = 408.774, X2 = 2.646, X3 = 131.264, X4 = 1.174,
           CNX1 = 0.962, CNX2 = 2.249, CNX3 = 100, CNX4 = 0.4)
OutputsModel &lt;- RunModel_CemaNeigeGR4J(InputsModel = InputsModel,
                                       RunOptions = RunOptions, Param = Param)

## results preview
plot(OutputsModel, Qobs = BasinObs$Qmm[Ind_Run])

## efficiency criterion: Nash-Sutcliffe Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                                RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)
</code></pre>

<hr>
<h2 id='RunModel_CemaNeigeGR5H'>Run with the CemaNeigeGR5H hydrological model</h2><span id='topic+RunModel_CemaNeigeGR5H'></span>

<h3>Description</h3>

<p>Function which performs a single run for the CemaNeige-GR5H hourly lumped model over the test period.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RunModel_CemaNeigeGR5H(InputsModel, RunOptions, Param)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RunModel_CemaNeigeGR5H_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em>] see <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_CemaNeigeGR5H_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_CemaNeigeGR5H_+3A_param">Param</code></td>
<td>
<p>[numeric] vector of 7 (or 9 parameters if <code>IsHyst = TRUE</code>, see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details)
</p>

<table>
<tr>
 <td style="text-align: left;">
    GR5H X1      </td><td style="text-align: left;"> production store capacity [mm]                                          </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR5H X2      </td><td style="text-align: left;"> intercatchment exchange coefficient [mm/h]                              </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR5H X3      </td><td style="text-align: left;"> routing store capacity [mm]                                             </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR5H X4      </td><td style="text-align: left;"> unit hydrograph time constant [h]                                       </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR5H X5      </td><td style="text-align: left;"> intercatchment exchange threshold [-]                                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    CemaNeige X1 </td><td style="text-align: left;"> weighting coefficient for snow pack thermal state [-]                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    CemaNeige X2 </td><td style="text-align: left;"> degree-hour melt coefficient [mm/°C/h]                                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    CemaNeige X3 </td><td style="text-align: left;"> (optional) accumulation threshold [mm] (needed if <code>IsHyst = TRUE</code>) </td>
</tr>
<tr>
 <td style="text-align: left;">
    CemaNeige X4 </td><td style="text-align: left;"> (optional) percentage (between 0 and 1) of annual snowfall defining the melt threshold [-] (needed if <code>IsHyst = TRUE</code>) </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>
</td></tr>
</table>


<h3>Details</h3>

<p>The choice of the CemaNeige version is explained in <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>. <br />
For further details on the model, see the references section. <br />
For further details on the argument structures and initialisation options, see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>.
<br />
<br />
See <code><a href="#topic+RunModel_GR5H">RunModel_GR5H</a></code> to look at the diagram of the hydrological model or <code><a href="#topic+RunModel_GR5J">RunModel_GR5J</a></code> when no interception store is used.
</p>


<h3>Value</h3>

<p>[list] containing the function outputs organised as follows:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <em>$DatesR  </em> </td><td style="text-align: left;"> [POSIXlt] series of dates                                                                             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$PotEvap </em> </td><td style="text-align: left;"> [numeric] series of input potential evapotranspiration (E) [mm/h]                                     </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Precip  </em> </td><td style="text-align: left;"> [numeric] series of input total precipitation (P) [mm/h]                                              </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Interc  </em> </td><td style="text-align: left;"> [numeric] series of interception store level (I) [mm]                                                 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Prod    </em> </td><td style="text-align: left;"> [numeric] series of production store level (S) [mm]                                                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Pn      </em> </td><td style="text-align: left;"> [numeric] series of net rainfall (Pn) [mm/h]                                                          </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Ps      </em> </td><td style="text-align: left;"> [numeric] series of the part of Pn filling the production store (Ps) [mm/h]                           </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AE      </em> </td><td style="text-align: left;"> [numeric] series of actual evapotranspiration (Ei+Es) [mm/h]                                          </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$EI      </em> </td><td style="text-align: left;"> [numeric] series of evapotranspiration from rainfall neutralisation or interception store (Ei) [mm/h] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$ES      </em> </td><td style="text-align: left;"> [numeric] series of evapotranspiration from production store (Es) [mm/h]                              </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Perc    </em> </td><td style="text-align: left;"> [numeric] series of percolation (Perc) [mm/h]                                                         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$PR      </em> </td><td style="text-align: left;"> [numeric] series of Pr=Pn-Ps+Perc (Pr) [mm/h]                                                         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Q9      </em> </td><td style="text-align: left;"> [numeric] series of UH outflow going into branch 9 (Q9) [mm/h]                                        </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Q1      </em> </td><td style="text-align: left;"> [numeric] series of UH outflow going into branch 1 (Q1) [mm/h]                                        </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Rout    </em> </td><td style="text-align: left;"> [numeric] series of routing store level (R1) [mm]                                                     </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Exch    </em> </td><td style="text-align: left;"> [numeric] series of potential semi-exchange between catchments [mm/h]                                 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch1  </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments for branch 1 [mm/h]                            </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch2  </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments for branch 2 [mm/h]                            </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch   </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments (AExch1+AExch2) [mm/h]                         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$QR      </em> </td><td style="text-align: left;"> [numeric] series of routing store outflow (Qr) [mm/h]                                                 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$QD      </em> </td><td style="text-align: left;"> [numeric] series of direct flow from UH after exchange (Qd) [mm/h]                                    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Qsim    </em> </td><td style="text-align: left;"> [numeric] series of simulated discharge (Q) [mm/h]                                                    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers</em> </td><td style="text-align: left;"> [list] CemaNeige outputs (1 element per layer)                                                 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Pliq         </em> </td><td style="text-align: left;"> [numeric] series of liquid precip. [mm/h]                              </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Psol         </em> </td><td style="text-align: left;"> [numeric] series of solid precip. [mm/h]                               </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$SnowPack     </em> </td><td style="text-align: left;"> [numeric] series of snow pack (snow water equivalent) [mm]             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$ThermalState </em> </td><td style="text-align: left;"> [numeric] series of snow pack thermal state [°C]                       </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Gratio       </em> </td><td style="text-align: left;"> [numeric] series of Gratio [0-1]                                       </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$PotMelt      </em> </td><td style="text-align: left;"> [numeric] series of potential snow melt [mm/h]                         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Melt         </em> </td><td style="text-align: left;"> [numeric] series of actual snow melt [mm/h]                            </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$PliqAndMelt  </em> </td><td style="text-align: left;"> [numeric] series of liquid precip. + actual snow melt [mm/h]           </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Temp         </em> </td><td style="text-align: left;"> [numeric] series of air temperature [°C]                               </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Gthreshold   </em> </td><td style="text-align: left;"> [numeric] series of melt threshold [mm]                                </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Glocalmax    </em> </td><td style="text-align: left;"> [numeric] series of local melt threshold for hysteresis [mm]           </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>RunOptions$WarmUpQsim</em> </td><td style="text-align: left;"> [numeric] series of simulated discharge (Q) on the warm-up period [mm/h] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>RunOptions$Param     </em> </td><td style="text-align: left;"> [numeric] parameter set parameter set used by the model                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$StateEnd</em> </td><td style="text-align: left;"> [numeric] states at the end of the run: store &amp; unit hydrographs levels [mm], CemaNeige states [mm &amp; °C]. See <code><a href="#topic+CreateIniStates">CreateIniStates</a></code> for more details </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>

<p>Refer to the provided references or to the package source code for further details on these model outputs.
</p>


<h3>Author(s)</h3>

<p>Laurent Coron, Guillaume Thirel, Olivier Delaigue, Audrey Valéry, Vazken Andréassian
</p>


<h3>References</h3>

<p>Ficchi, A. (2017).
An adaptive hydrological model for multiple time-steps:
Diagnostics and improvements based on fluxes consistency.
PhD thesis, UPMC - Irstea Antony, Paris, France.
<br /><br />
Ficchi, A., Perrin, C. and Andréassian, V. (2019).
Hydrological modelling at multiple sub-daily time steps: model improvement via flux-matching.
Journal of Hydrology, 575, 1308-1327, <a href="https://doi.org/10.1016/j.jhydrol.2019.05.084">doi:10.1016/j.jhydrol.2019.05.084</a>.
<br /><br />
Perrin, C., Michel, C. and Andréassian, V. (2003).
Improvement of a parsimonious model for streamflow simulation.
Journal of Hydrology, 279(1-4), 275-289, <a href="https://doi.org/10.1016/S0022-1694%2803%2900225-7">doi:10.1016/S0022-1694(03)00225-7</a>.
<br /><br />
Riboust, P., Thirel, G., Le Moine, N. and Ribstein, P. (2019).
Revisiting a simple degree-day model for integrating satellite data: Implementation of SWE-SCA hystereses.
Journal of Hydrology and Hydromechanics, 67(1), 70–81, <a href="https://doi.org/10.2478/johh-2018-0004">doi:10.2478/johh-2018-0004</a>.
<br /><br />
Valéry, A., Andréassian, V. and Perrin, C. (2014).
&quot;As simple as possible but not simpler&quot;: What is useful in a temperature-based snow-accounting routine?
Part 1 - Comparison of six snow accounting routines on 380 catchments.
Journal of Hydrology, 517(0), 1166-1175, <a href="https://doi.org/10.1016/j.jhydrol.2014.04.059">doi:10.1016/j.jhydrol.2014.04.059</a>.
<br /><br />
Valéry, A., Andréassian, V. and Perrin, C. (2014).
&quot;As simple as possible but not simpler&quot;: What is useful in a temperature-based snow-accounting routine?
Part 2 - Sensitivity analysis of the Cemaneige snow accounting routine on 380 catchments.
Journal of Hydrology, 517(0), 1176-1187, <a href="https://doi.org/10.1016/j.jhydrol.2014.04.058">doi:10.1016/j.jhydrol.2014.04.058</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+RunModel_CemaNeige">RunModel_CemaNeige</a></code>, <code><a href="#topic+RunModel_CemaNeigeGR4H">RunModel_CemaNeigeGR4H</a></code>, <code><a href="#topic+RunModel_GR5H">RunModel_GR5H</a></code>, <code><a href="#topic+Imax">Imax</a></code>,
<code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>, <code><a href="#topic+CreateIniStates">CreateIniStates</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(airGR)

## loading catchment data
data(U2345030)


## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_CemaNeigeGR5H, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E, TempMean = BasinObs$T,
                                 ZInputs = BasinInfo$ZInputs,
                                 HypsoData = BasinInfo$HypsoData, NLayers = 5)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d %H")=="2004-03-01 00"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d %H")=="2008-12-31 23"))


## --- original version of CemaNeige

## Imax computation
Imax &lt;- Imax(InputsModel = InputsModel, IndPeriod_Run = Ind_Run,
             TestedValues = seq(from = 0, to = 3, by = 0.2))

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_CemaNeigeGR5H, InputsModel = InputsModel,
                               Imax = Imax, IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(X1 = 218.537, X2 = -0.009, X3 = 174.862, X4 = 6.674, X5 = 0.000,
           CNX1 = 0.002, CNX2 = 3.787)
OutputsModel &lt;- RunModel_CemaNeigeGR5H(InputsModel = InputsModel,
                                       RunOptions = RunOptions, Param = Param)

## results preview
plot(OutputsModel, Qobs = BasinObs$Qmm[Ind_Run])

## efficiency criterion: Nash-Sutcliffe Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                                RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)

## End(Not run)
</code></pre>

<hr>
<h2 id='RunModel_CemaNeigeGR5J'>Run with the CemaNeigeGR5J hydrological model</h2><span id='topic+RunModel_CemaNeigeGR5J'></span>

<h3>Description</h3>

<p>Function which performs a single run for the CemaNeige-GR5J daily lumped model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RunModel_CemaNeigeGR5J(InputsModel, RunOptions, Param)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RunModel_CemaNeigeGR5J_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em>] see <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_CemaNeigeGR5J_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_CemaNeigeGR5J_+3A_param">Param</code></td>
<td>
<p>[numeric] vector of 7 (or 9 parameters if <code>IsHyst = TRUE</code>, see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details)
</p>

<table>
<tr>
 <td style="text-align: left;">
    GR5J X1      </td><td style="text-align: left;"> production store capacity [mm]                                          </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR5J X2      </td><td style="text-align: left;"> intercatchment exchange coefficient [mm/d]                              </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR5J X3      </td><td style="text-align: left;"> routing store capacity [mm]                                             </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR5J X4      </td><td style="text-align: left;"> unit hydrograph time constant [d]                                       </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR5J X5      </td><td style="text-align: left;"> intercatchment exchange threshold [-]                                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    CemaNeige X1 </td><td style="text-align: left;"> weighting coefficient for snow pack thermal state [-]                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    CemaNeige X2 </td><td style="text-align: left;"> degree-day melt coefficient [mm/°C/d]                                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    CemaNeige X3 </td><td style="text-align: left;"> (optional) accumulation threshold [mm] (needed if <code>IsHyst = TRUE</code>) </td>
</tr>
<tr>
 <td style="text-align: left;">
    CemaNeige X4 </td><td style="text-align: left;"> (optional) percentage (between 0 and 1) of annual snowfall defining the melt threshold [-] (needed if <code>IsHyst = TRUE</code>) </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>
</td></tr>
</table>


<h3>Details</h3>

<p>The choice of the CemaNeige version is explained in <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>. <br />
For further details on the model, see the references section. <br />
For further details on the argument structures and initialisation options, see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>.
<br />
<br />
See <code><a href="#topic+RunModel_GR5J">RunModel_GR5J</a></code> to look at the diagram of the hydrological model.
</p>


<h3>Value</h3>

<p>[list] containing the function outputs organised as follows:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <em>$DatesR  </em> </td><td style="text-align: left;"> [POSIXlt] series of dates                                                     </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$PotEvap </em> </td><td style="text-align: left;"> [numeric] series of input potential evapotranspiration (E) [mm/d]             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Precip  </em> </td><td style="text-align: left;"> [numeric] series of input total precipitation (P) [mm/d]                      </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Prod    </em> </td><td style="text-align: left;"> [numeric] series of production store level (S) [mm]                           </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Pn      </em> </td><td style="text-align: left;"> [numeric] series of net rainfall (Pn) [mm/d]                                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Ps      </em> </td><td style="text-align: left;"> [numeric] series of the part of Pn filling the production store (Ps) [mm/d]   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AE      </em> </td><td style="text-align: left;"> [numeric] series of actual evapotranspiration [mm/d]                          </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Perc    </em> </td><td style="text-align: left;"> [numeric] series of percolation (Perc) [mm/d]                                 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$PR      </em> </td><td style="text-align: left;"> [numeric] series of Pr=Pn-Ps+Perc (Pr) [mm/d]                                 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Q9      </em> </td><td style="text-align: left;"> [numeric] series of UH outflow going into branch 9 (Q9) [mm/d]                </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Q1      </em> </td><td style="text-align: left;"> [numeric] series of UH outflow going into branch 1 (Q1) [mm/d]                </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Rout    </em> </td><td style="text-align: left;"> [numeric] series of routing store level (R1) [mm]                             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Exch    </em> </td><td style="text-align: left;"> [numeric] series of potential semi-exchange between catchments [mm/d]         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch1  </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments for branch 1 [mm/d]    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch2  </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments for branch 2 [mm/d]    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch   </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments (AExch1+AExch2) [mm/d] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$QR      </em> </td><td style="text-align: left;"> [numeric] series of routing store outflow (Qr) [mm/d]                         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$QD      </em> </td><td style="text-align: left;"> [numeric] series of direct flow from UH after exchange (Qd) [mm/d]            </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Qsim    </em> </td><td style="text-align: left;"> [numeric] series of simulated discharge (Q) [mm/d]                            </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers</em> </td><td style="text-align: left;"> [list] CemaNeige outputs (1 element per layer)                         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Pliq        </em> </td><td style="text-align: left;"> [numeric] series of liquid precip. [mm/d]                    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Psol        </em> </td><td style="text-align: left;"> [numeric] series of solid precip. [mm/d]                     </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$SnowPack    </em> </td><td style="text-align: left;"> [numeric] series of snow pack (snow water equivalent) [mm]   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$ThermalState</em> </td><td style="text-align: left;"> [numeric] series of snow pack thermal state [°C]             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Gratio      </em> </td><td style="text-align: left;"> [numeric] series of Gratio [0-1]                             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$PotMelt     </em> </td><td style="text-align: left;"> [numeric] series of potential snow melt [mm/d]               </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Melt        </em> </td><td style="text-align: left;"> [numeric] series of actual snow melt [mm/d]                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$PliqAndMelt </em> </td><td style="text-align: left;"> [numeric] series of liquid precip. + actual snow melt [mm/d] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Temp        </em> </td><td style="text-align: left;"> [numeric] series of air temperature [°C]                     </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Gthreshold  </em> </td><td style="text-align: left;"> [numeric] series of melt threshold [mm]                      </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Glocalmax   </em> </td><td style="text-align: left;"> [numeric] series of local melt threshold for hysteresis [mm] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>RunOptions$WarmUpQsim</em> </td><td style="text-align: left;"> [numeric] series of simulated discharge (Q) on the warm-up period [mm/d] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>RunOptions$Param     </em> </td><td style="text-align: left;"> [numeric] parameter set parameter set used by the model                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$StateEnd</em> </td><td style="text-align: left;"> [numeric] states at the end of the run: store &amp; unit hydrographs levels [mm], CemaNeige states [mm &amp; °C]. See <code><a href="#topic+CreateIniStates">CreateIniStates</a></code> for more details </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>

<p>Refer to the provided references or to the package source code for further details on these model outputs
</p>


<h3>Author(s)</h3>

<p>Laurent Coron, Claude Michel, Nicolas Le Moine, Audrey Valéry, Vazken Andréassian, Olivier Delaigue, Guillaume Thirel
</p>


<h3>References</h3>

<p>Le Moine, N. (2008).
Le bassin versant de surface vu par le souterrain :
une voie d'amélioration des performances et du réalisme des modèles pluie-débit ?
PhD thesis (in French), UPMC - Cemagref Antony, Paris, France.
<br /><br />
Pushpalatha, R., Perrin, C., Le Moine, N., Mathevet, T. and Andréassian, V. (2011).
A downward structural sensitivity analysis of hydrological models to improve low-flow simulation.
Journal of Hydrology, 411(1-2), 66-76, <a href="https://doi.org/10.1016/j.jhydrol.2011.09.034">doi:10.1016/j.jhydrol.2011.09.034</a>.
<br /><br />
Riboust, P., Thirel, G., Le Moine, N. and Ribstein, P. (2019).
Revisiting a simple degree-day model for integrating satellite data: Implementation of SWE-SCA hystereses.
Journal of Hydrology and Hydromechanics, 67(1), 70–81, <a href="https://doi.org/10.2478/johh-2018-0004">doi:10.2478/johh-2018-0004</a>.
<br /><br />
Valéry, A., Andréassian, V. and Perrin, C. (2014).
&quot;As simple as possible but not simpler&quot;: What is useful in a temperature-based snow-accounting routine?
Part 1 - Comparison of six snow accounting routines on 380 catchments.
Journal of Hydrology, 517(0), 1166-1175, <a href="https://doi.org/10.1016/j.jhydrol.2014.04.059">doi:10.1016/j.jhydrol.2014.04.059</a>.
<br /><br />
Valéry, A., Andréassian, V. and Perrin, C. (2014).
&quot;As simple as possible but not simpler&quot;: What is useful in a temperature-based snow-accounting routine?
Part 2 - Sensitivity analysis of the Cemaneige snow accounting routine on 380 catchments.
Journal of Hydrology, 517(0), 1176-1187, <a href="https://doi.org/10.1016/j.jhydrol.2014.04.058">doi:10.1016/j.jhydrol.2014.04.058</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+RunModel_CemaNeige">RunModel_CemaNeige</a></code>, <code><a href="#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code>, <code><a href="#topic+RunModel_CemaNeigeGR6J">RunModel_CemaNeigeGR6J</a></code>, <code><a href="#topic+RunModel_GR5J">RunModel_GR5J</a></code>,
<code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>, <code><a href="#topic+CreateIniStates">CreateIniStates</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123002)

## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_CemaNeigeGR5J, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E, TempMean = BasinObs$T,
                                 ZInputs = median(BasinInfo$HypsoData),
                                 HypsoData = BasinInfo$HypsoData, NLayers = 5)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_CemaNeigeGR5J, InputsModel = InputsModel,
                               IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(X1 = 179.139, X2 = -0.100, X3 = 203.815, X4 = 1.174, X5 = 2.478,
           CNX1 = 0.977, CNX2 = 2.774)
OutputsModel &lt;- RunModel_CemaNeigeGR5J(InputsModel = InputsModel,
                                       RunOptions = RunOptions, Param = Param)

## results preview
plot(OutputsModel, Qobs = BasinObs$Qmm[Ind_Run])

## efficiency criterion: Nash-Sutcliffe Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                                RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)


## simulation with the Linear Hysteresis
## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_CemaNeigeGR5J, InputsModel = InputsModel,
                               IndPeriod_Run = Ind_Run, IsHyst = TRUE)
Param &lt;- c(179.139, -0.100, 203.815, 1.174, 2.478, 0.977, 2.774, 100, 0.4)
OutputsModel &lt;- RunModel_CemaNeigeGR5J(InputsModel = InputsModel,
                                       RunOptions = RunOptions, Param = Param)

## results preview
plot(OutputsModel, Qobs = BasinObs$Qmm[Ind_Run])

## efficiency criterion: Nash-Sutcliffe Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                                RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)
</code></pre>

<hr>
<h2 id='RunModel_CemaNeigeGR6J'>Run with the CemaNeigeGR6J hydrological model</h2><span id='topic+RunModel_CemaNeigeGR6J'></span>

<h3>Description</h3>

<p>Function which performs a single run for the CemaNeige-GR6J daily lumped model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RunModel_CemaNeigeGR6J(InputsModel, RunOptions, Param)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RunModel_CemaNeigeGR6J_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em>] see <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_CemaNeigeGR6J_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_CemaNeigeGR6J_+3A_param">Param</code></td>
<td>
<p>[numeric] vector of 8 (or 10 parameters if <code>IsHyst = TRUE</code>, see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details)
</p>

<table>
<tr>
 <td style="text-align: left;">
    GR6J X1      </td><td style="text-align: left;"> production store capacity [mm]                                          </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR6J X2      </td><td style="text-align: left;"> intercatchment exchange coefficient [mm/d]                              </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR6J X3      </td><td style="text-align: left;"> routing store capacity [mm]                                             </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR6J X4      </td><td style="text-align: left;"> unit hydrograph time constant [d]                                       </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR6J X5      </td><td style="text-align: left;"> intercatchment exchange threshold [-]                                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR6J X6      </td><td style="text-align: left;"> exponential store depletion coefficient [mm]                            </td>
</tr>
<tr>
 <td style="text-align: left;">
    CemaNeige X1 </td><td style="text-align: left;"> weighting coefficient for snow pack thermal state [-]                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    CemaNeige X2 </td><td style="text-align: left;"> degree-day melt coefficient [mm/°C/d]                                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    CemaNeige X3 </td><td style="text-align: left;"> (optional) accumulation threshold [mm] (needed if <code>IsHyst = TRUE</code>) </td>
</tr>
<tr>
 <td style="text-align: left;">
    CemaNeige X4 </td><td style="text-align: left;"> (optional) percentage (between 0 and 1) of annual snowfall defining the melt threshold [-] (needed if <code>IsHyst = TRUE</code>)</td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>
</td></tr>
</table>


<h3>Details</h3>

<p>The choice of the CemaNeige version is explained in <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>. <br />
For further details on the model, see the references section. <br />
For further details on the argument structures and initialisation options, see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>.
<br />
<br />
See <code><a href="#topic+RunModel_GR6J">RunModel_GR6J</a></code> to look at the diagram of the hydrological model.
</p>


<h3>Value</h3>

<p>[list] containing the function outputs organised as follows:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <em>$DatesR  </em> </td><td style="text-align: left;"> [POSIXlt] series of dates                                                     </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$PotEvap </em> </td><td style="text-align: left;"> [numeric] series of input potential evapotranspiration (E) [mm/d]             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Precip  </em> </td><td style="text-align: left;"> [numeric] series of input total precipitation (P) [mm/d]                      </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Prod    </em> </td><td style="text-align: left;"> [numeric] series of production store level (S) [mm]                           </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Pn      </em> </td><td style="text-align: left;"> [numeric] series of net rainfall (Pn) [mm/d]                                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Ps      </em> </td><td style="text-align: left;"> [numeric] series of the part of Pn filling the production store (Ps) [mm/d]   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AE      </em> </td><td style="text-align: left;"> [numeric] series of actual evapotranspiration [mm/d]                          </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Perc    </em> </td><td style="text-align: left;"> [numeric] series of percolation (Perc) [mm/d]                                 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$PR      </em> </td><td style="text-align: left;"> [numeric] series of Pr=Pn-Ps+Perc (Pr) [mm/d]                                 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Q9      </em> </td><td style="text-align: left;"> [numeric] series of UH1 outflow (Q9) [mm/d]                                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Q1      </em> </td><td style="text-align: left;"> [numeric] series of UH2 outflow (Q1) [mm/d]                                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Rout    </em> </td><td style="text-align: left;"> [numeric] series of routing store level (R1) [mm]                             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Exch    </em> </td><td style="text-align: left;"> [numeric] series of potential semi-exchange between catchments [mm/d]         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch1  </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments for branch 1 [mm/d]    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch2  </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments for branch 2 [mm/d]    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch   </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments (AExch1+AExch2) [mm/d] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$QR      </em> </td><td style="text-align: left;"> [numeric] series of routing store outflow (Qr) [mm/d]                         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$QRExp   </em> </td><td style="text-align: left;"> [numeric] series of exponential store outflow (QrExp) [mm/d]                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Exp     </em> </td><td style="text-align: left;"> [numeric] series of exponential store level (negative) (R2) [mm]              </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$QD      </em> </td><td style="text-align: left;"> [numeric] series of direct flow from UH2 after exchange (Qd) [mm/d]           </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Qsim    </em> </td><td style="text-align: left;"> [numeric] series of simulated discharge (Q) [mm/d]                            </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers</em> </td><td style="text-align: left;"> [list] CemaNeige outputs (1 element per layer)                         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Pliq        </em> </td><td style="text-align: left;"> [numeric] series of liquid precip. [mm/d]                    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Psol        </em> </td><td style="text-align: left;"> [numeric] series of solid precip. [mm/d]                     </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$SnowPack    </em> </td><td style="text-align: left;"> [numeric] series of snow pack (snow water equivalent) [mm]   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$ThermalState</em> </td><td style="text-align: left;"> [numeric] series of snow pack thermal state [°C]             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Gratio      </em> </td><td style="text-align: left;"> [numeric] series of Gratio [0-1]                             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$PotMelt     </em> </td><td style="text-align: left;"> [numeric] series of potential snow melt [mm/d]               </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Melt        </em> </td><td style="text-align: left;"> [numeric] series of actual snow melt [mm/d]                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$PliqAndMelt </em> </td><td style="text-align: left;"> [numeric] series of liquid precip. + actual snow melt [mm/d] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Temp        </em> </td><td style="text-align: left;"> [numeric] series of air temperature [°C]                     </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Gthreshold  </em> </td><td style="text-align: left;"> [numeric] series of melt threshold [mm]                      </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$CemaNeigeLayers[[iLayer]]$Glocalmax   </em> </td><td style="text-align: left;"> [numeric] series of local melt threshold for hysteresis [mm] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>RunOptions$WarmUpQsim</em> </td><td style="text-align: left;"> [numeric] series of simulated discharge (Q) on the warm-up period [mm/d] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>RunOptions$Param     </em> </td><td style="text-align: left;"> [numeric] parameter set parameter set used by the model                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$StateEnd</em> </td><td style="text-align: left;"> [numeric] states at the end of the run: store &amp; unit hydrographs levels [mm], CemaNeige states [mm &amp; °C]. See <code><a href="#topic+CreateIniStates">CreateIniStates</a></code> for more details </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>

<p>Refer to the provided references or to the package source code for further details on these model outputs
</p>


<h3>Author(s)</h3>

<p>Laurent Coron, Claude Michel, Charles Perrin, Raji Pushpalatha, Nicolas Le Moine, Audrey Valéry, Vazken Andréassian, Olivier Delaigue, Guillaume Thirel
</p>


<h3>References</h3>

<p>Pushpalatha, R., Perrin, C., Le Moine, N., Mathevet, T. and Andréassian, V. (2011).
A downward structural sensitivity analysis of hydrological models to improve low-flow simulation.
Journal of Hydrology, 411(1-2), 66-76, <a href="https://doi.org/10.1016/j.jhydrol.2011.09.034">doi:10.1016/j.jhydrol.2011.09.034</a>.
<br /><br />
Riboust, P., Thirel, G., Le Moine, N. and Ribstein, P. (2019).
Revisiting a simple degree-day model for integrating satellite data: Implementation of SWE-SCA hystereses.
Journal of Hydrology and Hydromechanics, 67(1), 70–81, <a href="https://doi.org/10.2478/johh-2018-0004">doi:10.2478/johh-2018-0004</a>.
<br /><br />
Valéry, A., Andréassian, V. and Perrin, C. (2014).
&quot;As simple as possible but not simpler&quot;: What is useful in a temperature-based snow-accounting routine?
Part 1 - Comparison of six snow accounting routines on 380 catchments.
Journal of Hydrology, 517(0), 1166-1175, <a href="https://doi.org/10.1016/j.jhydrol.2014.04.059">doi:10.1016/j.jhydrol.2014.04.059</a>.
<br /><br />
Valéry, A., Andréassian, V. and Perrin, C. (2014).
&quot;As simple as possible but not simpler&quot;: What is useful in a temperature-based snow-accounting routine?
Part 2 - Sensitivity analysis of the Cemaneige snow accounting routine on 380 catchments.
Journal of Hydrology, 517(0), 1176-1187, <a href="https://doi.org/10.1016/j.jhydrol.2014.04.058">doi:10.1016/j.jhydrol.2014.04.058</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+RunModel_CemaNeige">RunModel_CemaNeige</a></code>, <code><a href="#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code>,
<code><a href="#topic+RunModel_CemaNeigeGR5J">RunModel_CemaNeigeGR5J</a></code>, <code><a href="#topic+RunModel_GR6J">RunModel_GR6J</a></code>,
<code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123002)

## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_CemaNeigeGR6J, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E, TempMean = BasinObs$T,
                                 ZInputs = median(BasinInfo$HypsoData),
                                 HypsoData = BasinInfo$HypsoData, NLayers = 5)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))


## --- original version of CemaNeige

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_CemaNeigeGR6J, InputsModel = InputsModel,
                               IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(X1 = 116.482, X2 = 0.500, X3 = 72.733, X4 = 1.224, X5 = 0.278, X6 = 30.333,
           CNX1 = 0.977, CNX2 = 2.776)
OutputsModel &lt;- RunModel_CemaNeigeGR6J(InputsModel = InputsModel,
                                       RunOptions = RunOptions, Param = Param)

## results preview
plot(OutputsModel, Qobs = BasinObs$Qmm[Ind_Run])

## efficiency criterion: Nash-Sutcliffe Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                                RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)


## --- version of CemaNeige with the Linear Hysteresis

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_CemaNeigeGR6J, InputsModel = InputsModel,
                               IndPeriod_Run = Ind_Run, IsHyst = TRUE)

## simulation
Param &lt;- c(X1 = 116.482, X2 = 0.500, X3 = 72.733, X4 = 1.224, X5 = 0.278, X6 = 30.333,
           CNX1 = 0.977, CNX2 = 2.774, CNX3 = 100, CNX4 = 0.4)
OutputsModel &lt;- RunModel_CemaNeigeGR6J(InputsModel = InputsModel,
                                       RunOptions = RunOptions, Param = Param)

## results preview
plot(OutputsModel, Qobs = BasinObs$Qmm[Ind_Run])

## efficiency criterion: Nash-Sutcliffe Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                                RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)
</code></pre>

<hr>
<h2 id='RunModel_GR1A'>Run with the GR1A hydrological model</h2><span id='topic+RunModel_GR1A'></span>

<h3>Description</h3>

<p>Function which performs a single run for the GR1A annual lumped model over the test period.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RunModel_GR1A(InputsModel, RunOptions, Param)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RunModel_GR1A_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em>] see <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_GR1A_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_GR1A_+3A_param">Param</code></td>
<td>
<p>[numeric] vector of 1 parameter
</p>

<table>
<tr>
 <td style="text-align: left;">
    GR1A X1 </td><td style="text-align: left;"> model parameter [-] </td>
</tr>
<tr>
 <td style="text-align: left;">
 </td>
</tr>

</table>
</td></tr>
</table>


<h3>Details</h3>

<p>For further details on the model, see the references section. <br />
For further details on the argument structures and initialisation options, see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>.
</p>


<h3>Value</h3>

<p>[list] containing the function outputs organised as follows:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <em>$DatesR  </em> </td><td style="text-align: left;"> [POSIXlt] series of dates                                     </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$PotEvap </em> </td><td style="text-align: left;"> [numeric] series of input potential evapotranspiration [mm/y] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Precip  </em> </td><td style="text-align: left;"> [numeric] series of input total precipitation [mm/y]          </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Qsim    </em> </td><td style="text-align: left;"> [numeric] series of simulated discharge [mm/y]                </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>RunOptions$WarmUpQsim</em> </td><td style="text-align: left;"> [numeric] series of simulated discharge (Q) on the warm-up period [mm/y] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>RunOptions$Param     </em> </td><td style="text-align: left;"> [numeric] parameter set parameter set used by the model                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$StateEnd</em> </td><td style="text-align: left;"> [numeric] states at the end of the run (NULL) [-]             </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>

<p>Refer to the provided references or to the package source code for further details on these model outputs.
</p>


<h3>Author(s)</h3>

<p>Laurent Coron, Claude Michel, Olivier Delaigue, Guillaume Thirel
</p>


<h3>References</h3>

<p>Mouelhi S. (2003).
Vers une chaîne cohérente de modèles pluie-débit conceptuels globaux aux pas de temps pluriannuel, annuel, mensuel et journalier.
PhD thesis (in French), ENGREF - Cemagref Antony, France.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123001)

## conversion of example data from daily to yearly time step
TabSeries &lt;- data.frame(DatesR = BasinObs$DatesR,
                        P = BasinObs$P,
                        E = BasinObs$E,
                        Qmm = BasinObs$Qmm)
TabSeries &lt;- TabSeries[TabSeries$DatesR &lt; as.POSIXct("2012-09-01", tz = "UTC"), ]
BasinObs &lt;- SeriesAggreg(TabSeries, Format = "%Y",
                         YearFirstMonth = 09,
                         ConvertFun = c("sum", "sum", "sum"))

## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_GR1A, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y")=="1990"),
               which(format(BasinObs$DatesR, format = "%Y")=="1999"))

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR1A,
                               InputsModel = InputsModel, IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(X1 = 0.840)
OutputsModel &lt;- RunModel_GR1A(InputsModel = InputsModel, RunOptions = RunOptions, Param = Param)

## results preview
plot(OutputsModel, Qobs = BasinObs$Qmm[Ind_Run])

## efficiency criterion: Nash-Sutcliffe Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                                RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)
</code></pre>

<hr>
<h2 id='RunModel_GR2M'>Run with the GR2M hydrological model</h2><span id='topic+RunModel_GR2M'></span>

<h3>Description</h3>

<p>Function which performs a single run for the GR2M monthly lumped model over the test period.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RunModel_GR2M(InputsModel, RunOptions, Param)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RunModel_GR2M_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em>] see <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_GR2M_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_GR2M_+3A_param">Param</code></td>
<td>
<p>[numeric] vector of 2 parameters
</p>

<table>
<tr>
 <td style="text-align: left;">
    GR2M X1 </td><td style="text-align: left;"> production store capacity [mm]       </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR2M X2 </td><td style="text-align: left;"> groundwater exchange coefficient [-] </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>
</td></tr>
</table>


<h3>Details</h3>

<p>For further details on the model, see the references section. <br />
For further details on the argument structures and initialisation options, see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>.
<br />
<br />
<img src="../help/figures/diagramGR2M-EN.png" width="60%" alt="Figure: diagramGR4J-EN.png" />

</p>


<h3>Value</h3>

<p>[list] containing the function outputs organised as follows:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <em>$DatesR  </em> </td><td style="text-align: left;"> [POSIXlt] series of dates                                             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$PotEvap </em> </td><td style="text-align: left;"> [numeric] series of input potential evapotranspiration [mm/month] (E) </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Precip  </em> </td><td style="text-align: left;"> [numeric] series of input total precipitation [mm/month] (P)          </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AE      </em> </td><td style="text-align: left;"> [numeric] series of actual evapotranspiration [mm/month]              </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Pn      </em> </td><td style="text-align: left;"> [numeric] series of net rainfall (P1) [mm/month]                      </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Ps      </em> </td><td style="text-align: left;"> [numeric] series of part of P filling the production store [mm/month] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Perc    </em> </td><td style="text-align: left;"> [numeric] series of percolation (P2) [mm/month]                       </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$PR      </em> </td><td style="text-align: left;"> [numeric] series of PR=Pn+Perc (P3) [mm/month]                        </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch   </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments [mm/month]     </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Prod    </em> </td><td style="text-align: left;"> [numeric] series of production store level (S) [mm]                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Rout    </em> </td><td style="text-align: left;"> [numeric] series of routing store level (R1) [mm]                     </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Qsim    </em> </td><td style="text-align: left;"> [numeric] series of simulated discharge [mm/month] (Q)                </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>RunOptions$WarmUpQsim</em> </td><td style="text-align: left;"> [numeric] series of simulated discharge (Q) on the warm-up period [mm/month] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>RunOptions$Param     </em> </td><td style="text-align: left;"> [numeric] parameter set parameter set used by the model                      </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$StateEnd</em> </td><td style="text-align: left;"> [numeric] states at the end of the run (production store level and routing store level) [mm]. See <code><a href="#topic+CreateIniStates">CreateIniStates</a></code> for more details </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>

<p>Refer to the provided references or to the package source code for further details on these model outputs.
</p>


<h3>Author(s)</h3>

<p>Laurent Coron, Claude Michel, Safouane Mouelhi, Olivier Delaigue, Guillaume Thirel
</p>


<h3>References</h3>

<p>Mouelhi S. (2003).
Vers une chaîne cohérente de modèles pluie-débit conceptuels globaux aux pas de temps pluriannuel, annuel, mensuel et journalier.
PhD thesis (in French), ENGREF - Cemagref Antony, France.
<br /><br />
Mouelhi, S., Michel, C., Perrin, C. and Andréassian, V. (2006).
Stepwise development of a two-parameter monthly water balance model.
Journal of Hydrology, 318(1-4), 200-214, <a href="https://doi.org/10.1016/j.jhydrol.2005.06.014">doi:10.1016/j.jhydrol.2005.06.014</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>, <code><a href="#topic+CreateIniStates">CreateIniStates</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123001)

## preparation of the InputsModel object with daily time step data
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_GR4J, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E)

## conversion of InputsModel to monthly time step
InputsModel &lt;- SeriesAggreg(InputsModel, Format = "%Y%m")

## run period selection
Ind_Run &lt;- seq(which(format(InputsModel$DatesR, format = "%Y-%m")=="1990-01"),
               which(format(InputsModel$DatesR, format = "%Y-%m")=="1999-12"))

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR2M,
                               InputsModel = InputsModel, IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(X1 = 265.072, X2 = 1.040)
OutputsModel &lt;- RunModel_GR2M(InputsModel = InputsModel, RunOptions = RunOptions, Param = Param)

## conversion of observed discharge to monthly time step
Qobs &lt;- SeriesAggreg(data.frame(BasinObs$DatesR, BasinObs$Qmm),
                    Format = "%Y%m",
                    ConvertFun = "sum")
Qobs &lt;- Qobs[Ind_Run, 2]

## results preview
plot(OutputsModel, Qobs = Qobs)

## efficiency criterion: Nash-Sutcliffe Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                                RunOptions = RunOptions, Obs = Qobs)
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)
</code></pre>

<hr>
<h2 id='RunModel_GR4H'>Run with the GR4H hydrological model</h2><span id='topic+RunModel_GR4H'></span>

<h3>Description</h3>

<p>Function which performs a single run for the GR4H hourly lumped model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RunModel_GR4H(InputsModel, RunOptions, Param)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RunModel_GR4H_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em>] see <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_GR4H_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_GR4H_+3A_param">Param</code></td>
<td>
<p>[numeric] vector of 4 parameters
</p>

<table>
<tr>
 <td style="text-align: left;">
    GR4H X1 </td><td style="text-align: left;"> production store capacity [mm]          </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR4H X2 </td><td style="text-align: left;"> groundwater exchange coefficient [mm/h] </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR4H X3 </td><td style="text-align: left;"> routing store capacity [mm]             </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR4H X4 </td><td style="text-align: left;"> unit hydrograph time constant [h]       </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>
</td></tr>
</table>


<h3>Details</h3>

<p>For further details on the model, see the references section. <br />
For further details on the argument structures and initialisation options, see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>.
<br />
<br />
See <code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code> to look at the diagram of the hydrological model.
</p>


<h3>Value</h3>

<p>[list] containing the function outputs organised as follows:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <em>$DatesR  </em> </td><td style="text-align: left;"> [POSIXlt] series of dates                                                     </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$PotEvap </em> </td><td style="text-align: left;"> [numeric] series of input potential evapotranspiration (E) [mm/h]             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Precip  </em> </td><td style="text-align: left;"> [numeric] series of input total precipitation (P) [mm/h]                      </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Prod    </em> </td><td style="text-align: left;"> [numeric] series of production store level (S) [mm]                           </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Pn      </em> </td><td style="text-align: left;"> [numeric] series of net rainfall (Pn) [mm/h]                                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Ps      </em> </td><td style="text-align: left;"> [numeric] series of the part of Pn filling the production store (Ps) [mm/h    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AE      </em> </td><td style="text-align: left;"> [numeric] series of actual evapotranspiration [mm/h]                          </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Perc    </em> </td><td style="text-align: left;"> [numeric] series of percolation (Perc) [mm/h]                                 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$PR      </em> </td><td style="text-align: left;"> [numeric] series of Pr=Pn-Ps+Perc (Pr) [mm/h]                                 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Q9      </em> </td><td style="text-align: left;"> [numeric] series of UH1 outflow (Q9) [mm/h]                                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Q1      </em> </td><td style="text-align: left;"> [numeric] series of UH2 outflow (Q1) [mm/h]                                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Rout    </em> </td><td style="text-align: left;"> [numeric] series of routing store level (R1) [mm]                             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Exch    </em> </td><td style="text-align: left;"> [numeric] series of potential semi-exchange between catchments [mm/h]         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch1  </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments for branch 1 [mm/h]    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch2  </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments for branch 2 [mm/h]    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch   </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments (AExch1+AExch2) [mm/h] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$QR      </em> </td><td style="text-align: left;"> [numeric] series of routing store outflow (Qr) [mm/h]                         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$QD      </em> </td><td style="text-align: left;"> [numeric] series of direct flow from UH2 after exchange (Qd) [mm/h]           </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Qsim    </em> </td><td style="text-align: left;"> [numeric] series of simulated discharge (Q) [mm/h]                            </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>RunOptions$WarmUpQsim</em> </td><td style="text-align: left;"> [numeric] series of simulated discharge (Q) on the warm-up period [mm/h] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>RunOptions$Param     </em> </td><td style="text-align: left;"> [numeric] parameter set parameter set used by the model                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$StateEnd</em> </td><td style="text-align: left;"> [numeric] states at the end of the run (res. levels, UH1 levels, UH2 levels) [mm]. See <code><a href="#topic+CreateIniStates">CreateIniStates</a></code> for more details </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>

<p>Refer to the provided references or to the package source code for further details on these model outputs.
</p>


<h3>Author(s)</h3>

<p>Laurent Coron, Charles Perrin, Thibaut Mathevet, Olivier Delaigue, Guillaume Thirel
</p>


<h3>References</h3>

<p>Mathevet, T. (2005).
Quels modèles pluie-débit globaux pour le pas de temps horaire ?
Développement empirique et comparaison de modèles sur un large échantillon de bassins versants.
PhD thesis (in French), ENGREF - Cemagref Antony, Paris, France.
<br /><br />
Le Moine, N. (2008).
Le bassin versant de surface vu par le souterrain :
une voie d'amélioration des performances et du réalisme des modèles pluie-débit ?
PhD thesis (in French), UPMC - Cemagref Antony, Paris, France.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code>, <code><a href="#topic+RunModel_CemaNeigeGR4H">RunModel_CemaNeigeGR4H</a></code>,
<code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>, <code><a href="#topic+CreateIniStates">CreateIniStates</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## load of catchment data
data(L0123003)

## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_GR4H, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d %H")=="2005-01-01 00"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d %H")=="2008-12-31 23"))

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR4H,
                               InputsModel = InputsModel, IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(X1 = 756.930, X2 = -0.773, X3 = 138.638, X4 = 5.247)
OutputsModel &lt;- RunModel_GR4H(InputsModel = InputsModel, RunOptions = RunOptions, Param = Param)

## results preview
plot(OutputsModel, Qobs = BasinObs$Qmm[Ind_Run])

## efficiency criterion: Nash-Sutcliffe Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                                RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)
</code></pre>

<hr>
<h2 id='RunModel_GR4J'>Run with the GR4J hydrological model</h2><span id='topic+RunModel_GR4J'></span>

<h3>Description</h3>

<p>Function which performs a single run for the GR4J daily lumped model over the test period.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RunModel_GR4J(InputsModel, RunOptions, Param)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RunModel_GR4J_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em>] see <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_GR4J_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_GR4J_+3A_param">Param</code></td>
<td>
<p>[numeric] vector of 4 parameters
</p>

<table>
<tr>
 <td style="text-align: left;">
    GR4J X1 </td><td style="text-align: left;"> production store capacity [mm]             </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR4J X2 </td><td style="text-align: left;"> intercatchment exchange coefficient [mm/d] </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR4J X3 </td><td style="text-align: left;"> routing store capacity [mm]                </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR4J X4 </td><td style="text-align: left;"> unit hydrograph time constant [d]          </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>
</td></tr>
</table>


<h3>Details</h3>

<p>For further details on the model, see the references section. <br />
For further details on the argument structures and initialisation options, see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>.
<br />
<br />
<img src="../help/figures/diagramGR4J-EN.png" width="60%" alt="Figure: diagramGR4J-EN.png" />

</p>


<h3>Value</h3>

<p>[list] containing the function outputs organised as follows:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <em>$DatesR  </em> </td><td style="text-align: left;"> [POSIXlt] series of dates                                                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$PotEvap </em> </td><td style="text-align: left;"> [numeric] series of input potential evapotranspiration [mm/d] (E)           </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Precip  </em> </td><td style="text-align: left;"> [numeric] series of input total precipitation (P) [mm/d]                    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Prod    </em> </td><td style="text-align: left;"> [numeric] series of production store level (S) [mm]                         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Pn      </em> </td><td style="text-align: left;"> [numeric] series of net rainfall (Pn) [mm/d]                                </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Ps      </em> </td><td style="text-align: left;"> [numeric] series of the part of Pn filling the production store (Ps) [mm/d] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AE      </em> </td><td style="text-align: left;"> [numeric] series of actual evapotranspiration [mm/d]                        </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Perc    </em> </td><td style="text-align: left;"> [numeric] series of percolation (Perc) [mm/d]                               </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$PR      </em> </td><td style="text-align: left;"> [numeric] series of Pr=Pn-Ps+Perc (Pr) [mm/d]                               </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Q9      </em> </td><td style="text-align: left;"> [numeric] series of UH1 outflow (Q9) [mm/d]                                 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Q1      </em> </td><td style="text-align: left;"> [numeric] series of UH2 outflow (Q1) [mm/d]                                 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Rout    </em> </td><td style="text-align: left;"> [numeric] series of routing store level (R1) [mm]                           </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Exch    </em> </td><td style="text-align: left;"> [numeric] series of potential semi-exchange between catchments [mm/d]       </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch1  </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments for branch 1 [mm/d]  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch2  </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments for branch 2 [mm/d]  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch   </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments (1+2) [mm/d]         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$QR      </em> </td><td style="text-align: left;"> [numeric] series of routing store outflow (Qr) [mm/d]                       </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$QD      </em> </td><td style="text-align: left;"> [numeric] series of direct flow from UH2 after exchange (Qd) [mm/d]         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Qsim    </em> </td><td style="text-align: left;"> [numeric] series of simulated discharge (Q) [mm/d]                          </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>RunOptions$WarmUpQsim</em> </td><td style="text-align: left;"> [numeric] series of simulated discharge (Q) on the warm-up period [mm/d] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>RunOptions$Param     </em> </td><td style="text-align: left;"> [numeric] parameter set parameter set used by the model                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$StateEnd</em> </td><td style="text-align: left;"> [numeric] states at the end of the run (res. levels, UH1 levels, UH2 levels) [mm]. See <code><a href="#topic+CreateIniStates">CreateIniStates</a></code> for more details </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>

<p>Refer to the provided references or to the package source code for further details on these model outputs.
</p>


<h3>Author(s)</h3>

<p>Laurent Coron, Claude Michel, Charles Perrin, Olivier Delaigue
</p>


<h3>References</h3>

<p>Perrin, C., Michel, C. and Andréassian, V. (2003).
Improvement of a parsimonious model for streamflow simulation.
Journal of Hydrology, 279(1-4), 275-289, <a href="https://doi.org/10.1016/S0022-1694%2803%2900225-7">doi:10.1016/S0022-1694(03)00225-7</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+RunModel_GR5J">RunModel_GR5J</a></code>, <code><a href="#topic+RunModel_GR6J">RunModel_GR6J</a></code>, <code><a href="#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code>,
<code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>, <code><a href="#topic+CreateIniStates">CreateIniStates</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123001)

## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_GR4J, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR4J,
                               InputsModel = InputsModel, IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(X1 = 257.238, X2 = 1.012, X3 = 88.235, X4 = 2.208)
OutputsModel &lt;- RunModel_GR4J(InputsModel = InputsModel,
                              RunOptions = RunOptions, Param = Param)

## results preview
plot(OutputsModel, Qobs = BasinObs$Qmm[Ind_Run])

## efficiency criterion: Nash-Sutcliffe Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                                RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)
</code></pre>

<hr>
<h2 id='RunModel_GR5H'>Run with the GR5H hydrological model</h2><span id='topic+RunModel_GR5H'></span>

<h3>Description</h3>

<p>Function which performs a single run for the GR5H hourly lumped model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RunModel_GR5H(InputsModel, RunOptions, Param)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RunModel_GR5H_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em>] see <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_GR5H_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_GR5H_+3A_param">Param</code></td>
<td>
<p>[numeric] vector of 5 parameters
</p>

<table>
<tr>
 <td style="text-align: left;">
    GR5H X1 </td><td style="text-align: left;"> production store capacity [mm]             </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR5H X2 </td><td style="text-align: left;"> intercatchment exchange coefficient [mm/h] </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR5H X3 </td><td style="text-align: left;"> routing store capacity [mm]                </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR5H X4 </td><td style="text-align: left;"> unit hydrograph time constant [h]          </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR5H X5 </td><td style="text-align: left;"> intercatchment exchange threshold [-]      </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>
</td></tr>
</table>


<h3>Details</h3>

<p>It is advised to run the GR5H model with an interception store (see Ficchi (2017) and Ficchi et al. (2019)) as it improves the consistency of the model fluxes and provides better performance. To do so, the <code><a href="#topic+Imax">Imax</a></code> function allows to estimate the maximal capacity of the interception store, which can then be given to <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>. <br />
</p>
<p>For further details on the model, see the references section. <br />
For further details on the argument structures and initialisation options, see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>.
<br />
<br />
<img src="../help/figures/diagramGR5H-EN.png" width="60%" alt="Figure: diagramGR5H-EN.png" />

<br />
<br />
See <code><a href="#topic+RunModel_GR5J">RunModel_GR5J</a></code> to look at the diagram of the hydrological model when no interception store is used.
</p>


<h3>Value</h3>

<p>[list] containing the function outputs organised as follows:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <em>$DatesR  </em> </td><td style="text-align: left;"> [POSIXlt] series of dates                                                                             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$PotEvap </em> </td><td style="text-align: left;"> [numeric] series of input potential evapotranspiration (E) [mm/h]                                     </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Precip  </em> </td><td style="text-align: left;"> [numeric] series of input total precipitation (P) [mm/h]                                              </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Interc  </em> </td><td style="text-align: left;"> [numeric] series of interception store level (I) [mm]                                                 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Prod    </em> </td><td style="text-align: left;"> [numeric] series of production store level (S) [mm]                                                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Pn      </em> </td><td style="text-align: left;"> [numeric] series of net rainfall (Pn) [mm/h]                                                          </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Ps      </em> </td><td style="text-align: left;"> [numeric] series of the part of Pn filling the production store (Ps) [mm/h]                           </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AE      </em> </td><td style="text-align: left;"> [numeric] series of actual evapotranspiration (Ei+Es) [mm/h]                                          </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$EI      </em> </td><td style="text-align: left;"> [numeric] series of evapotranspiration from rainfall neutralisation or interception store (Ei) [mm/h] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$ES      </em> </td><td style="text-align: left;"> [numeric] series of evapotranspiration from production store (Es) [mm/h]                              </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Perc    </em> </td><td style="text-align: left;"> [numeric] series of percolation (Perc) [mm/h]                                                         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$PR      </em> </td><td style="text-align: left;"> [numeric] series of Pr=Pn-Ps+Perc (Pr) [mm/h]                                                         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Q9      </em> </td><td style="text-align: left;"> [numeric] series of UH outflow going into branch 9 (Q9) [mm/h]                                        </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Q1      </em> </td><td style="text-align: left;"> [numeric] series of UH outflow going into branch 1 (Q1) [mm/h]                                        </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Rout    </em> </td><td style="text-align: left;"> [numeric] series of routing store level (R1) [mm]                                                     </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Exch    </em> </td><td style="text-align: left;"> [numeric] series of potential semi-exchange between catchments [mm/h]                                 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch1  </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments for branch 1 [mm/h]                            </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch2  </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments for branch 2 [mm/h]                            </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch   </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments (AExch1+AExch2) [mm/h]                         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$QR      </em> </td><td style="text-align: left;"> [numeric] series of routing store outflow (Qr) [mm/h]                                                 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$QD      </em> </td><td style="text-align: left;"> [numeric] series of direct flow from UH after exchange (Qd) [mm/h]                                    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Qsim    </em> </td><td style="text-align: left;"> [numeric] series of simulated discharge (Q) [mm/h]                                                    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>RunOptions$WarmUpQsim</em> </td><td style="text-align: left;"> [numeric] series of simulated discharge (Q) on the warm-up period [mm/h]                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>RunOptions$Param     </em> </td><td style="text-align: left;"> [numeric] parameter set parameter set used by the model                                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$StateEnd</em> </td><td style="text-align: left;"> [numeric] states at the end of the run (res. levels, UH levels) [mm]. See <code><a href="#topic+CreateIniStates">CreateIniStates</a></code> for more details </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>

<p>Refer to the provided references or to the package source code for further details on these model outputs.
</p>


<h3>Author(s)</h3>

<p>Laurent Coron, Guillaume Thirel, Olivier Delaigue
</p>


<h3>References</h3>

<p>Ficchi, A. (2017).
An adaptive hydrological model for multiple time-steps:
Diagnostics and improvements based on fluxes consistency.
PhD thesis, UPMC - Irstea Antony, Paris, France.
<br /><br />
Ficchi, A., Perrin, C. and Andréassian, V. (2019).
Hydrological modelling at multiple sub-daily time steps: model improvement via flux-matching.
Journal of Hydrology, 575, 1308-1327, <a href="https://doi.org/10.1016/j.jhydrol.2019.05.084">doi:10.1016/j.jhydrol.2019.05.084</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+RunModel_GR4H">RunModel_GR4H</a></code>, <code><a href="#topic+RunModel_CemaNeigeGR5H">RunModel_CemaNeigeGR5H</a></code>, <code><a href="#topic+Imax">Imax</a></code>,
<code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>, <code><a href="#topic+CreateIniStates">CreateIniStates</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## load of catchment data
data(L0123003)

## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_GR5H, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d %H")=="2006-01-01 00"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d %H")=="2006-12-31 23"))

## Imax computation
Imax &lt;- Imax(InputsModel = InputsModel, IndPeriod_Run = Ind_Run,
             TestedValues = seq(from = 0, to = 3, by = 0.2))

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR5H, Imax = Imax,
                               InputsModel = InputsModel, IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(X1 = 706.912, X2 = -0.163, X3 = 188.880, X4 = 2.575, X5 = 0.104)
OutputsModel &lt;- RunModel_GR5H(InputsModel = InputsModel, RunOptions = RunOptions, Param = Param)

## results preview
plot(OutputsModel, Qobs = BasinObs$Qmm[Ind_Run])

## efficiency criterion: Nash-Sutcliffe Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                                RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)
</code></pre>

<hr>
<h2 id='RunModel_GR5J'>Run with the GR5J hydrological model</h2><span id='topic+RunModel_GR5J'></span>

<h3>Description</h3>

<p>Function which performs a single run for the GR5J daily lumped model over the test period.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RunModel_GR5J(InputsModel, RunOptions, Param)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RunModel_GR5J_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em>] see <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_GR5J_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_GR5J_+3A_param">Param</code></td>
<td>
<p>[numeric] vector of 5 parameters
</p>

<table>
<tr>
 <td style="text-align: left;">
    GR5J X1 </td><td style="text-align: left;"> production store capacity [mm]             </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR5J X2 </td><td style="text-align: left;"> intercatchment exchange coefficient [mm/d] </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR5J X3 </td><td style="text-align: left;"> routing store capacity [mm]                </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR5J X4 </td><td style="text-align: left;"> unit hydrograph time constant [d]          </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR5J X5 </td><td style="text-align: left;"> intercatchment exchange threshold [-]      </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>
</td></tr>
</table>


<h3>Details</h3>

<p>For further details on the model, see the references section. <br />
For further details on the argument structures and initialisation options, see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>.
<br />
<br />
<img src="../help/figures/diagramGR5J-EN.png" width="60%" alt="Figure: diagramGR5J-EN.png" />

</p>


<h3>Value</h3>

<p>[list] containing the function outputs organised as follows:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <em>$DatesR  </em> </td><td style="text-align: left;"> [POSIXlt] series of dates                                                     </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$PotEvap </em> </td><td style="text-align: left;"> [numeric] series of input potential evapotranspiration (E) [mm/d]             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Precip  </em> </td><td style="text-align: left;"> [numeric] series of input total precipitation (P) [mm/d]                      </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Prod    </em> </td><td style="text-align: left;"> [numeric] series of production store level (S) [mm]                           </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Pn      </em> </td><td style="text-align: left;"> [numeric] series of net rainfall (Pn) [mm/d]                                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Ps      </em> </td><td style="text-align: left;"> [numeric] series of the part of Pn filling the production store (Ps) [mm/d]   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AE      </em> </td><td style="text-align: left;"> [numeric] series of actual evapotranspiration [mm/d]                          </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Perc    </em> </td><td style="text-align: left;"> [numeric] series of percolation (Perc) [mm/d]                                 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$PR      </em> </td><td style="text-align: left;"> [numeric] series of Pr=Pn-Ps+Perc (Pr) [mm/d]                                 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Q9      </em> </td><td style="text-align: left;"> [numeric] series of UH outflow going into branch 9 (Q9) [mm/d]                </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Q1      </em> </td><td style="text-align: left;"> [numeric] series of UH outflow going into branch 1 (Q1) [mm/d]                </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Rout    </em> </td><td style="text-align: left;"> [numeric] series of routing store level (R1) [mm]                             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Exch    </em> </td><td style="text-align: left;"> [numeric] series of potential semi-exchange between catchments [mm/d]         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch1  </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments for branch 1 [mm/d]    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch2  </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments for branch 2 [mm/d]    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch   </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments (AExch1+AExch2) [mm/d] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$QR      </em> </td><td style="text-align: left;"> [numeric] series of routing store outflow (Qr) [mm/d]                         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$QD      </em> </td><td style="text-align: left;"> [numeric] series of direct flow from UH after exchange (Qd) [mm/d]            </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Qsim    </em> </td><td style="text-align: left;"> [numeric] series of simulated discharge (Q) [mm/d]                            </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>RunOptions$WarmUpQsim</em> </td><td style="text-align: left;"> [numeric] series of simulated discharge (Q) on the warm-up period [mm/d] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>RunOptions$Param     </em> </td><td style="text-align: left;"> [numeric] parameter set parameter set used by the model                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$StateEnd</em> </td><td style="text-align: left;"> [numeric] states at the end of the run (res. levels, UH levels) [mm]. See <code><a href="#topic+CreateIniStates">CreateIniStates</a></code> for more details </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>

<p>Refer to the provided references or to the package source code for further details on these model outputs.
</p>


<h3>Author(s)</h3>

<p>Laurent Coron, Claude Michel, Nicolas Le Moine, Olivier Delaigue, Guillaume Thirel
</p>


<h3>References</h3>

<p>Le Moine, N. (2008).
Le bassin versant de surface vu par le souterrain :
une voie d'amélioration des performances et du réalisme des modèles pluie-débit ?
PhD thesis (in French), UPMC - Cemagref Antony, Paris, France.
<br /><br />
Pushpalatha, R., Perrin, C., Le Moine, N., Mathevet, T. and Andréassian, V. (2011).
A downward structural sensitivity analysis of hydrological models to improve low-flow simulation.
Journal of Hydrology, 411(1-2), 66-76, <a href="https://doi.org/10.1016/j.jhydrol.2011.09.034">doi:10.1016/j.jhydrol.2011.09.034</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code>, <code><a href="#topic+RunModel_GR6J">RunModel_GR6J</a></code>, <code><a href="#topic+RunModel_CemaNeigeGR5J">RunModel_CemaNeigeGR5J</a></code>,
<code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>, <code><a href="#topic+CreateIniStates">CreateIniStates</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123001)

## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_GR5J, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR5J,
                               InputsModel = InputsModel, IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(X1 = 245.918, X2 = 1.027, X3 = 90.017, X4 = 2.198, X5 = 0.434)
OutputsModel &lt;- RunModel_GR5J(InputsModel = InputsModel,
                              RunOptions = RunOptions, Param = Param)

## results preview
plot(OutputsModel, Qobs = BasinObs$Qmm[Ind_Run])

## efficiency criterion: Nash-Sutcliffe Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                                RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)
</code></pre>

<hr>
<h2 id='RunModel_GR6J'>Run with the GR6J hydrological model</h2><span id='topic+RunModel_GR6J'></span>

<h3>Description</h3>

<p>Function which performs a single run for the GR6J daily lumped model over the test period.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RunModel_GR6J(InputsModel, RunOptions, Param)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RunModel_GR6J_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em>] see <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_GR6J_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_GR6J_+3A_param">Param</code></td>
<td>
<p>[numeric] vector of 6 parameters
</p>

<table>
<tr>
 <td style="text-align: left;">
    GR6J X1 </td><td style="text-align: left;"> production store capacity [mm]               </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR6J X2 </td><td style="text-align: left;"> intercatchment exchange coefficient [mm/d]   </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR6J X3 </td><td style="text-align: left;"> routing store capacity [mm]                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR6J X4 </td><td style="text-align: left;"> unit hydrograph time constant [d]            </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR6J X5 </td><td style="text-align: left;"> intercatchment exchange threshold [-]        </td>
</tr>
<tr>
 <td style="text-align: left;">
    GR6J X6 </td><td style="text-align: left;"> exponential store depletion coefficient [mm] </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>
</td></tr>
</table>


<h3>Details</h3>

<p>For further details on the model, see the references section. <br />
For further details on the argument structures and initialisation options, see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>.
<br />
<br />
<img src="../help/figures/diagramGR6J-EN.png" width="60%" alt="Figure: diagramGR6J-EN.png" />

</p>


<h3>Value</h3>

<p>[list] containing the function outputs organised as follows:
</p>

<table>
<tr>
 <td style="text-align: left;">
    <em>$DatesR  </em> </td><td style="text-align: left;"> [POSIXlt] series of dates                                                     </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$PotEvap </em> </td><td style="text-align: left;"> [numeric] series of input potential evapotranspiration (E) [mm/d]             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Precip  </em> </td><td style="text-align: left;"> [numeric] series of input total precipitation (P) [mm/d]                      </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Prod    </em> </td><td style="text-align: left;"> [numeric] series of production store level (S) [mm]                           </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Pn      </em> </td><td style="text-align: left;"> [numeric] series of net rainfall (Pn) [mm/d]                                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Ps      </em> </td><td style="text-align: left;"> [numeric] series of the part of Pn filling the production store (Ps) [mm/d]   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AE      </em> </td><td style="text-align: left;"> [numeric] series of actual evapotranspiration [mm/d]                          </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Perc    </em> </td><td style="text-align: left;"> [numeric] series of percolation (Perc) [mm/d]                                 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$PR      </em> </td><td style="text-align: left;"> [numeric] series of Pr=Pn-Ps+Perc (Pr) [mm/d]                                 </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Q9      </em> </td><td style="text-align: left;"> [numeric] series of UH1 outflow (Q9) [mm/d]                                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Q1      </em> </td><td style="text-align: left;"> [numeric] series of UH2 outflow (Q1) [mm/d]                                   </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Rout    </em> </td><td style="text-align: left;"> [numeric] series of routing store level (R1) [mm]                             </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Exch    </em> </td><td style="text-align: left;"> [numeric] series of potential semi-exchange between catchments [mm/d]         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch1  </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments for branch 1 [mm/d]    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch2  </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments for branch 2 [mm/d]    </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$AExch   </em> </td><td style="text-align: left;"> [numeric] series of actual exchange between catchments (AExch1+AExch2) [mm/d] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$QR      </em> </td><td style="text-align: left;"> [numeric] series of routing store outflow (Qr) [mm/d]                         </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$QRExp   </em> </td><td style="text-align: left;"> [numeric] series of exponential store outflow (QrExp) [mm/d]                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Exp     </em> </td><td style="text-align: left;"> [numeric] series of exponential store level (negative) (R2) [mm]              </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$QD      </em> </td><td style="text-align: left;"> [numeric] series of direct flow from UH2 after exchange (Qd) [mm/d]           </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$Qsim    </em> </td><td style="text-align: left;"> [numeric] series of simulated discharge (Q) [mm/d]                            </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>RunOptions$WarmUpQsim</em> </td><td style="text-align: left;"> [numeric] series of simulated discharge (Q) on the warm-up period [mm/d] </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>RunOptions$Param     </em> </td><td style="text-align: left;"> [numeric] parameter set parameter set used by the model                  </td>
</tr>
<tr>
 <td style="text-align: left;">
    <em>$StateEnd</em> </td><td style="text-align: left;"> [numeric] states at the end of the run (res. levels, UH1 levels, UH2 levels) [mm]. See <code><a href="#topic+CreateIniStates">CreateIniStates</a></code> for more details </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>

<p>Refer to the provided references or to the package source code for further details on these model outputs.
</p>


<h3>Author(s)</h3>

<p>Laurent Coron, Claude Michel, Charles Perrin, Raji Pushpalatha, Nicolas Le Moine, Olivier Delaigue, Guillaume Thirel
</p>


<h3>References</h3>

<p>Pushpalatha, R., Perrin, C., Le Moine, N., Mathevet, T. and Andréassian, V. (2011).
A downward structural sensitivity analysis of hydrological models to improve low-flow simulation.
Journal of Hydrology, 411(1-2), 66-76, <a href="https://doi.org/10.1016/j.jhydrol.2011.09.034">doi:10.1016/j.jhydrol.2011.09.034</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code>, <code><a href="#topic+RunModel_GR5J">RunModel_GR5J</a></code>, <code><a href="#topic+RunModel_CemaNeigeGR6J">RunModel_CemaNeigeGR6J</a></code>,
<code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>, <code><a href="#topic+CreateIniStates">CreateIniStates</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123001)

## preparation of the InputsModel object
InputsModel &lt;- CreateInputsModel(FUN_MOD = RunModel_GR6J, DatesR = BasinObs$DatesR,
                                 Precip = BasinObs$P, PotEvap = BasinObs$E)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

## preparation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR6J,
                               InputsModel = InputsModel, IndPeriod_Run = Ind_Run)

## simulation
Param &lt;- c(X1 = 242.257, X2 = 0.637, X3 = 53.517, X4 = 2.218, X5 = 0.424, X6 = 4.759)
OutputsModel &lt;- RunModel_GR6J(InputsModel = InputsModel,
                             RunOptions = RunOptions, Param = Param)

## results preview
plot(OutputsModel, Qobs = BasinObs$Qmm[Ind_Run])

## efficiency criterion: Nash-Sutcliffe Efficiency
InputsCrit  &lt;- CreateInputsCrit(FUN_CRIT = ErrorCrit_NSE, InputsModel = InputsModel,
                                RunOptions = RunOptions, Obs = BasinObs$Qmm[Ind_Run])
OutputsCrit &lt;- ErrorCrit_NSE(InputsCrit = InputsCrit, OutputsModel = OutputsModel)
</code></pre>

<hr>
<h2 id='RunModel_Lag'>Run with the Lag model</h2><span id='topic+RunModel_Lag'></span>

<h3>Description</h3>

<p>Function which performs a single run for the Lag model over the test period.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RunModel_Lag(InputsModel, RunOptions, Param, QcontribDown)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RunModel_Lag_+3A_inputsmodel">InputsModel</code></td>
<td>
<p>[object of class <em>InputsModel</em>] created with SD model inputs, see <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> for details. The object should also contain a key <em>OutputsModel</em> of class <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code> coming from the simulation of the downstream subcatchment runoff.</p>
</td></tr>
<tr><td><code id="RunModel_Lag_+3A_runoptions">RunOptions</code></td>
<td>
<p>[object of class <em>RunOptions</em>] see <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code> for details</p>
</td></tr>
<tr><td><code id="RunModel_Lag_+3A_param">Param</code></td>
<td>
<p>[numeric] vector of 1 parameter
</p>

<table>
<tr>
 <td style="text-align: left;">
      Velocity </td><td style="text-align: left;"> mean flow velocity [m/s]
    </td>
</tr>

</table>

</td></tr>
<tr><td><code id="RunModel_Lag_+3A_qcontribdown">QcontribDown</code></td>
<td>
<p>[numeric] vector or [OutputsModel] containing the time series of the runoff contribution of the downstream sub-basin</p>
</td></tr>
</table>


<h3>Value</h3>

<p>[list] see <code><a href="#topic+RunModel_GR4J">RunModel_GR4J</a></code> or <code><a href="#topic+RunModel_CemaNeigeGR4J">RunModel_CemaNeigeGR4J</a></code> for details.
</p>
<p>The list value contains an extra item named <code>QsimDown</code> which is a copy of the runoff contribution of the downstream sub-basin contained in argument <code>QcontribDown</code> in [mm/time step].
</p>


<h3>Author(s)</h3>

<p>Olivier Delaigue, David Dorchies, Guillaume Thirel
</p>


<h3>See Also</h3>

<p><code><a href="#topic+RunModel">RunModel</a></code>, <code><a href="#topic+CreateInputsModel">CreateInputsModel</a></code>, <code><a href="#topic+CreateRunOptions">CreateRunOptions</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#####################################################################
## Simulation of a reservoir with a purpose of low-flow mitigation ##
#####################################################################

## ---- preparation of the InputsModel object

## loading package and catchment data
library(airGR)
data(L0123001)

## ---- simulation of the hydrological catchment with GR4J

InputsModelDown &lt;- CreateInputsModel(FUN_MOD = RunModel_GR4J, DatesR = BasinObs$DatesR,
                                     Precip = BasinObs$P, PotEvap = BasinObs$E)

## run period selection
Ind_Run &lt;- seq(which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1990-01-01"),
               which(format(BasinObs$DatesR, format = "%Y-%m-%d")=="1999-12-31"))

## creation of the RunOptions object
RunOptionsDown &lt;- CreateRunOptions(FUN_MOD = RunModel_GR4J,
                                   InputsModel = InputsModelDown, IndPeriod_Run = Ind_Run)

## simulation of the runoff of the catchment with a GR4J model
Param &lt;- c(X1 = 257.238, X2 = 1.012, X3 = 88.235, X4 = 2.208)
OutputsModelDown &lt;- RunModel_GR4J(InputsModel = InputsModelDown,
                                  RunOptions = RunOptionsDown, Param = Param)

## ---- specifications of the reservoir

## the reservoir withdraws 1 m3/s when it's possible considering the flow observed in the basin
Qupstream &lt;- matrix(-sapply(BasinObs$Qls / 1000 - 1, function(x) {
  min(1, max(0, x, na.rm = TRUE))
}), ncol = 1)

## except between July and September when the reservoir releases 3 m3/s for low-flow mitigation
month &lt;- as.numeric(format(BasinObs$DatesR, "%m"))
Qupstream[month &gt;= 7 &amp; month &lt;= 9] &lt;- 3
Qupstream &lt;- Qupstream * 86400 ## Conversion in m3/day

## the reservoir is not an upstream subcachment: its areas is NA
BasinAreas &lt;- c(NA, BasinInfo$BasinArea)

## delay time between the reservoir and the catchment outlet is 2 days and the distance is 150 km
LengthHydro &lt;- 150

## ---- simulation of the basin with the reservoir influence

InputsModelInf &lt;- CreateInputsModel(FUN_MOD = RunModel_GR4J, DatesR = BasinObs$DatesR,
                                    Precip = BasinObs$P, PotEvap = BasinObs$E,
                                    Qupstream = Qupstream, LengthHydro = LengthHydro,
                                    BasinAreas = BasinAreas)
## creation of the RunOptions object
RunOptions &lt;- CreateRunOptions(FUN_MOD = RunModel_GR4J,
                               InputsModel = InputsModelInf, IndPeriod_Run = Ind_Run)

## with a delay of 2 days for 150 km, the flow velocity is 75 km per day
Velocity &lt;- (LengthHydro * 1e3 / 2) / (24 * 60 * 60) ## Conversion km/day -&gt; m/s

## run the lag model which routes precipitation-runoff model and upstream flows
OutputsModel &lt;- RunModel_Lag(InputsModel = InputsModelInf,
                             RunOptions = RunOptions,
                             Param = Velocity,
                             QcontribDown = OutputsModelDown)

## results preview of comparison between naturalised (observed) and influenced flow (simulated)
plot(OutputsModel, Qobs = OutputsModel$QsimDown)
</code></pre>

<hr>
<h2 id='SeriesAggreg'>Conversion of time series to another time step (aggregation only) and regime computation</h2><span id='topic+SeriesAggreg'></span><span id='topic+SeriesAggreg.list'></span><span id='topic+SeriesAggreg.data.frame'></span><span id='topic+SeriesAggreg.InputsModel'></span><span id='topic+SeriesAggreg.OutputsModel'></span>

<h3>Description</h3>

<p>Conversion of time series to another time step (aggregation only) and regime computation. <br />
Warning: on the aggregated outputs, the dates correspond to the beginning of the time step <br />
(e.g. for daily time series 2005-03-01 00:00 = value for period 2005-03-01 00:00 - 2005-03-01 23:59) <br />
(e.g. for monthly time series 2005-03-01 00:00 = value for period 2005-03-01 00:00 - 2005-03-31 23:59) <br />
(e.g. for yearly time series 2005-03-01 00:00 = value for period 2005-03-01 00:00 - 2006-02-28 23:59)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'data.frame'
SeriesAggreg(x,
             Format,
             ConvertFun,
             TimeFormat = NULL,
             NewTimeFormat = NULL,
             YearFirstMonth = 1,
             TimeLag = 0,
             ...)

## S3 method for class 'list'
SeriesAggreg(x,
             Format,
             ConvertFun,
             NewTimeFormat = NULL,
             simplify = FALSE,
             except = NULL,
             recursive = TRUE,
             ...)

## S3 method for class 'InputsModel'
SeriesAggreg(x, Format, ...)

## S3 method for class 'OutputsModel'
SeriesAggreg(x, Format, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="SeriesAggreg_+3A_x">x</code></td>
<td>
<p>[InputsModel], [OutputsModel], [list] or [data.frame] containing the vector of dates (<em>POSIXt</em>) and the time series of numeric values</p>
</td></tr>
<tr><td><code id="SeriesAggreg_+3A_format">Format</code></td>
<td>
<p>[character] output time step format (i.e. yearly times series: <code>"%Y"</code>, monthly time series: <code>"%Y%m"</code>, daily time series: <code>"%Y%m%d"</code>, monthly regimes: <code>"%m"</code>, daily regimes: <code>"%d"</code>)</p>
</td></tr>
<tr><td><code id="SeriesAggreg_+3A_timeformat">TimeFormat</code></td>
<td>
<p>(deprecated) [character] input time step format (i.e. <code>"hourly"</code>, <code>"daily"</code>, <code>"monthly"</code> or <code>"yearly"</code>). Use the <code>x</code> argument instead</p>
</td></tr>
<tr><td><code id="SeriesAggreg_+3A_newtimeformat">NewTimeFormat</code></td>
<td>
<p>(deprecated) [character] output time step format (i.e. <code>"hourly"</code>, <code>"daily"</code>, <code>"monthly"</code> or <code>"yearly"</code>). Use the <code>Format</code> argument instead</p>
</td></tr>
<tr><td><code id="SeriesAggreg_+3A_convertfun">ConvertFun</code></td>
<td>
<p>[character] names of aggregation functions (e.g. for P[mm], T[degC], Q[mm]: <code>ConvertFun = c("sum", "mean", "sum"</code>)) or name of aggregation function to apply to all elements if the parameter 'x' is a [list] . See details</p>
</td></tr>
<tr><td><code id="SeriesAggreg_+3A_yearfirstmonth">YearFirstMonth</code></td>
<td>
<p>(optional) [numeric] integer used when <code>Format = "%Y"</code> to set when the starting month of the year (e.g. 01 for calendar year or 09 for hydrological year starting in September)</p>
</td></tr>
<tr><td><code id="SeriesAggreg_+3A_timelag">TimeLag</code></td>
<td>
<p>(optional) [numeric] numeric indicating a time lag (in seconds) for the time series aggregation (especially useful to aggregate hourly time series into daily time series)</p>
</td></tr>
<tr><td><code id="SeriesAggreg_+3A_simplify">simplify</code></td>
<td>
<p>(optional) [boolean] if set to <code>TRUE</code>, a <code><a href="base.html#topic+data.frame">data.frame</a></code> is returned instead of a <code><a href="base.html#topic+list">list</a></code>. Embedded lists are then ignored. (default = <code>FALSE</code>)</p>
</td></tr>
<tr><td><code id="SeriesAggreg_+3A_except">except</code></td>
<td>
<p>(optional) [character] the name of the items to skip in the aggregation (default = <code>NULL</code>)</p>
</td></tr>
<tr><td><code id="SeriesAggreg_+3A_recursive">recursive</code></td>
<td>
<p>(optional) [boolean] if set to <code>FALSE</code>, embedded lists and dataframes are not aggregated (default = <code>TRUE</code>)</p>
</td></tr>
<tr><td><code id="SeriesAggreg_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code><a href="#topic+SeriesAggreg.list">SeriesAggreg.list</a></code> and then to <code><a href="#topic+SeriesAggreg.data.frame">SeriesAggreg.data.frame</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p><code><a href="#topic+SeriesAggreg.InputsModel">SeriesAggreg.InputsModel</a></code> and <code><a href="#topic+SeriesAggreg.OutputsModel">SeriesAggreg.OutputsModel</a></code>
call <code><a href="#topic+SeriesAggreg.list">SeriesAggreg.list</a></code> which itself calls <code><a href="#topic+SeriesAggreg.data.frame">SeriesAggreg.data.frame</a></code>.
So, all arguments passed to any <code><a href="#topic+SeriesAggreg">SeriesAggreg</a></code> method will be passed to <code><a href="#topic+SeriesAggreg.data.frame">SeriesAggreg.data.frame</a></code>.
</p>
<p>Argument <code>ConvertFun</code> also supports quantile calculation by using the syntax &quot;Q[nn]&quot; with [nn] the requested percentile.
E.g. use &quot;Q90&quot; for calculating 90th percentile in the aggregation.
The formula used is: <code>quantile(x, probs = perc / 100, type = 8, na.rm = TRUE)</code>.
</p>
<p>As there are multiple ways to take into account missing values in aggregation functions, <code>NA</code>s are not supported by <code>SeriesAggreg</code> and it provides <code>NA</code> values when <code>NA</code>s are present in the <code>x</code> input.
</p>


<h3>Value</h3>

<p>[POSIXct+numeric] data.frame containing a vector of aggregated dates (POSIXct) and time series values numeric)
</p>


<h3>Author(s)</h3>

<p>Olivier Delaigue, David Dorchies
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## loading catchment data
data(L0123002)

## preparation of the initial time series data frame at the daily time step
TabSeries &lt;- BasinObs[, c("DatesR", "P", "E", "T", "Qmm")]

## monthly time series
NewTabSeries &lt;- SeriesAggreg(TabSeries,
                             Format = "%Y%m",
                             ConvertFun = c("sum", "sum", "mean", "sum"))
str(NewTabSeries)

## monthly regimes
NewTabSeries &lt;- SeriesAggreg(TabSeries,
                             Format = "%m",
                             ConvertFun = c("sum", "sum", "mean", "sum"))
str(NewTabSeries)

## conversion of InputsModel
example("RunModel_GR2M")

## monthly regimes on OutputsModel object
SimulatedMonthlyRegime &lt;- SeriesAggreg(OutputsModel, Format = "%m")
str(SimulatedMonthlyRegime)

</code></pre>

<hr>
<h2 id='TransfoParam'>Transformation of the parameters using the provided function</h2><span id='topic+TransfoParam'></span><span id='topic+TransfoParam_GR1A'></span><span id='topic+TransfoParam_GR2M'></span><span id='topic+TransfoParam_GR4J'></span><span id='topic+TransfoParam_GR5J'></span><span id='topic+TransfoParam_GR6J'></span><span id='topic+TransfoParam_GR4H'></span><span id='topic+TransfoParam_GR5H'></span><span id='topic+TransfoParam_CemaNeige'></span><span id='topic+TransfoParam_CemaNeigeHyst'></span><span id='topic+TransfoParam_Lag'></span>

<h3>Description</h3>

<p>Function which transforms model parameters using the provided function (from raw to transformed parameters and vice versa).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## Generic function
TransfoParam(ParamIn, Direction, FUN_TRANSFO)

## Specific functions
TransfoParam_GR1A(ParamIn, Direction)
TransfoParam_GR2M(ParamIn, Direction)
TransfoParam_GR4J(ParamIn, Direction)
TransfoParam_GR5J(ParamIn, Direction)
TransfoParam_GR6J(ParamIn, Direction)
TransfoParam_GR4H(ParamIn, Direction)
TransfoParam_GR5H(ParamIn, Direction)
TransfoParam_CemaNeige(ParamIn, Direction)
TransfoParam_CemaNeigeHyst(ParamIn, Direction)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="TransfoParam_+3A_paramin">ParamIn</code></td>
<td>
<p>[numeric] vector or matrix of parameter sets (sets in line, parameter values in column)</p>
</td></tr>
<tr><td><code id="TransfoParam_+3A_direction">Direction</code></td>
<td>
<p>[character] direction of the transformation: use <code>"RT"</code> for Raw -&gt; Transformed and <code>"TR"</code> for Transformed -&gt; Raw</p>
</td></tr>
<tr><td><code id="TransfoParam_+3A_fun_transfo">FUN_TRANSFO</code></td>
<td>
<p>[function] model parameters transformation function (e.g. <code>TransfoParam_GR4J</code>, <code>TransfoParam_CemaNeige</code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The transformation functions proposed in airGR for calibrating the GR models result from numerous testings at INRAE-Antony (HYCAR Research Unit, France). The proposed transformations were obtained with the Calibration_Michel algorithm and may differ for the same parameter of different models (e.g. X5 in GR5J and GR6J).
</p>


<h3>Value</h3>

<p><em>ParamOut</em> [numeric] matrix of parameter sets (sets in line, parameter values in column)
</p>


<h3>Author(s)</h3>

<p>Laurent Coron, Olivier Delaigue
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(airGR)

## --- generic function

## transformation Raw -&gt; Transformed for the GR4J model
Xraw  &lt;- matrix(c(+221.41, -3.63,  +30.00, +1.37,
                  +347.23, -1.03,  +60.34, +1.76,
                  +854.06, -0.10, +148.41, +2.34),
                  ncol = 4, byrow = TRUE)
Xtran &lt;- TransfoParam(ParamIn = Xraw, Direction = "RT", FUN_TRANSFO = TransfoParam_GR4J)

## transformation Transformed -&gt; Raw for the GR4J model
Xtran &lt;- matrix(c(+3.60, -2.00, +3.40, -9.10,
                  +3.90, -0.90, +4.10, -8.70,
                  +4.50, -0.10, +5.00, -8.10),
                  ncol = 4, byrow = TRUE)
Xraw  &lt;- TransfoParam(ParamIn = Xtran, Direction = "TR", FUN_TRANSFO = TransfoParam_GR4J)


## --- specific function

## transformation Raw -&gt; Transformed for the GR4J model
Xraw  &lt;- matrix(c(+221.41, -3.63,  +30.00, +1.37,
                  +347.23, -1.03,  +60.34, +1.76,
                  +854.06, -0.10, +148.41, +2.34),
                  ncol = 4, byrow = TRUE)
Xtran &lt;- TransfoParam_GR4J(ParamIn = Xraw , Direction = "RT")

## transformation Transformed -&gt; Raw for the GR4J model
Xtran &lt;- matrix(c(+3.60, -2.00, +3.40, -9.10,
                  +3.90, -0.90, +4.10, -8.70,
                  +4.50, -0.10, +5.00, -8.10),
                  ncol = 4, byrow = TRUE)
Xraw  &lt;- TransfoParam_GR4J(ParamIn = Xtran, Direction = "TR")
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
