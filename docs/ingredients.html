<!DOCTYPE html><html lang="en"><head><title>Help for package ingredients</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ingredients}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#accumulated_dependence'><p>Accumulated Local Effects Profiles aka ALEPlots</p></a></li>
<li><a href='#aggregate_profiles'><p>Aggregates Ceteris Paribus Profiles</p></a></li>
<li><a href='#bind_plots'><p>Bind Multiple ggplot Objects</p></a></li>
<li><a href='#calculate_oscillations'><p>Calculate Oscillations for Ceteris Paribus Explainer</p></a></li>
<li><a href='#calculate_variable_profile'><p>Internal Function for Individual Variable Profiles</p></a></li>
<li><a href='#calculate_variable_split'><p>Internal Function for Split Points for Selected Variables</p></a></li>
<li><a href='#ceteris_paribus'><p>Ceteris Paribus Profiles aka Individual Variable Profiles</p></a></li>
<li><a href='#ceteris_paribus_2d'><p>Ceteris Paribus 2D Plot</p></a></li>
<li><a href='#cluster_profiles'><p>Cluster Ceteris Paribus Profiles</p></a></li>
<li><a href='#conditional_dependence'><p>Conditional Dependence Profiles</p></a></li>
<li><a href='#describe.partial_dependence_explainer'><p>Natural language description of feature importance explainer</p></a></li>
<li><a href='#feature_importance'><p>Feature Importance</p></a></li>
<li><a href='#partial_dependence'><p>Partial Dependence Profiles</p></a></li>
<li><a href='#plot.aggregated_profiles_explainer'><p>Plots Aggregated Profiles</p></a></li>
<li><a href='#plot.ceteris_paribus_2d_explainer'><p>Plot Ceteris Paribus 2D Explanations</p></a></li>
<li><a href='#plot.ceteris_paribus_explainer'><p>Plots Ceteris Paribus Profiles</p></a></li>
<li><a href='#plot.ceteris_paribus_oscillations'><p>Plot Ceteris Paribus Oscillations</p></a></li>
<li><a href='#plot.feature_importance_explainer'><p>Plots Feature Importance</p></a></li>
<li><a href='#plotD3'><p>Plots Ceteris Paribus Profiles in D3 with r2d3 Package.</p></a></li>
<li><a href='#plotD3.aggregated_profiles_explainer'><p>Plots Aggregated Ceteris Paribus Profiles in D3 with r2d3 Package.</p></a></li>
<li><a href='#plotD3.feature_importance_explainer'><p>Plot Feature Importance Objects in D3 with r2d3 Package.</p></a></li>
<li><a href='#print.aggregated_profiles_explainer'><p>Prints Aggregated Profiles</p></a></li>
<li><a href='#print.ceteris_paribus_explainer'><p>Prints Individual Variable Explainer Summary</p></a></li>
<li><a href='#print.feature_importance_explainer'><p>Print Generic for Feature Importance Object</p></a></li>
<li><a href='#select_neighbours'><p>Select Subset of Rows Closest to a Specified Observation</p></a></li>
<li><a href='#select_sample'><p>Select Subset of Rows</p></a></li>
<li><a href='#show_aggregated_profiles'><p>Adds a Layer with Aggregated Profiles</p></a></li>
<li><a href='#show_observations'><p>Adds a Layer with Observations to a Profile Plot</p></a></li>
<li><a href='#show_profiles'><p>Adds a Layer with Profiles</p></a></li>
<li><a href='#show_residuals'><p>Adds a Layer with Residuals to a Profile Plot</p></a></li>
<li><a href='#show_rugs'><p>Adds a Layer with Rugs to a Profile Plot</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Effects and Importances of Model Ingredients</td>
</tr>
<tr>
<td>Version:</td>
<td>2.3.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Collection of tools for assessment of feature importance and feature effects.
    Key functions are:
    feature_importance() for assessment of global level feature importance,
    ceteris_paribus() for calculation of the what-if plots,
    partial_dependence() for partial dependence plots,
    conditional_dependence() for conditional dependence plots,
    accumulated_dependence() for accumulated local effects plots,
    aggregate_profiles() and cluster_profiles() for aggregation of ceteris paribus profiles,
    generic print() and plot() for better usability of selected explainers,
    generic plotD3() for interactive, D3 based explanations, and
    generic describe() for explanations in natural language.
    The package 'ingredients' is a part of the 'DrWhy.AI' universe (Biecek 2018) &lt;<a href="https://doi.org/10.48550/arXiv.1806.08915">doi:10.48550/arXiv.1806.08915</a>&gt;.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Imports:</td>
<td>ggplot2, scales, gridExtra, methods</td>
</tr>
<tr>
<td>Suggests:</td>
<td>DALEX, gower, ranger, testthat, r2d3, jsonlite, knitr,
rmarkdown, covr</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://ModelOriented.github.io/ingredients/">https://ModelOriented.github.io/ingredients/</a>,
<a href="https://github.com/ModelOriented/ingredients">https://github.com/ModelOriented/ingredients</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/ModelOriented/ingredients/issues">https://github.com/ModelOriented/ingredients/issues</a></td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-01-14 23:08:04 UTC; pbiecek</td>
</tr>
<tr>
<td>Author:</td>
<td>Przemyslaw Biecek <a href="https://orcid.org/0000-0001-8423-1823"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Hubert Baniecki <a href="https://orcid.org/0000-0001-6661-5364"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Adam Izdebski [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Przemyslaw Biecek &lt;przemyslaw.biecek@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-01-15 11:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='accumulated_dependence'>Accumulated Local Effects Profiles aka ALEPlots</h2><span id='topic+accumulated_dependence'></span><span id='topic+accumulated_dependence.explainer'></span><span id='topic+accumulated_dependence.default'></span><span id='topic+accumulated_dependence.ceteris_paribus_explainer'></span><span id='topic+accumulated_dependency'></span>

<h3>Description</h3>

<p>Accumulated Local Effects Profiles accumulate local changes in Ceteris Paribus Profiles.
Function <code><a href="#topic+accumulated_dependence">accumulated_dependence</a></code> calls <code><a href="#topic+ceteris_paribus">ceteris_paribus</a></code> and then <code><a href="#topic+aggregate_profiles">aggregate_profiles</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>accumulated_dependence(x, ...)

## S3 method for class 'explainer'
accumulated_dependence(
  x,
  variables = NULL,
  N = 500,
  variable_splits = NULL,
  grid_points = 101,
  ...,
  variable_type = "numerical"
)

## Default S3 method:
accumulated_dependence(
  x,
  data,
  predict_function = predict,
  label = class(x)[1],
  variables = NULL,
  N = 500,
  variable_splits = NULL,
  grid_points = 101,
  ...,
  variable_type = "numerical"
)

## S3 method for class 'ceteris_paribus_explainer'
accumulated_dependence(x, ..., variables = NULL)

accumulated_dependency(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="accumulated_dependence_+3A_x">x</code></td>
<td>
<p>an explainer created with function <code>DALEX::explain()</code>, an object of the class <code>ceteris_paribus_explainer</code>
or a model to be explained.</p>
</td></tr>
<tr><td><code id="accumulated_dependence_+3A_...">...</code></td>
<td>
<p>other parameters</p>
</td></tr>
<tr><td><code id="accumulated_dependence_+3A_variables">variables</code></td>
<td>
<p>names of variables for which profiles shall be calculated.
Will be passed to <code><a href="#topic+calculate_variable_split">calculate_variable_split</a></code>.
If <code>NULL</code> then all variables from the validation data will be used.</p>
</td></tr>
<tr><td><code id="accumulated_dependence_+3A_n">N</code></td>
<td>
<p>number of observations used for calculation of partial dependence profiles.
By default, <code>500</code> observations will be chosen randomly.</p>
</td></tr>
<tr><td><code id="accumulated_dependence_+3A_variable_splits">variable_splits</code></td>
<td>
<p>named list of splits for variables, in most cases created with <code><a href="#topic+calculate_variable_split">calculate_variable_split</a></code>.
If <code>NULL</code> then it will be calculated based on validation data avaliable in the <code>explainer</code>.</p>
</td></tr>
<tr><td><code id="accumulated_dependence_+3A_grid_points">grid_points</code></td>
<td>
<p>number of points for profile. Will be passed to<code><a href="#topic+calculate_variable_split">calculate_variable_split</a></code>.</p>
</td></tr>
<tr><td><code id="accumulated_dependence_+3A_variable_type">variable_type</code></td>
<td>
<p>a character. If <code>"numerical"</code> then only numerical variables will be calculated.
If <code>"categorical"</code> then only categorical variables will be calculated.</p>
</td></tr>
<tr><td><code id="accumulated_dependence_+3A_data">data</code></td>
<td>
<p>validation dataset Will be extracted from <code>x</code> if it's an explainer
NOTE: It is best when target variable is not present in the <code>data</code></p>
</td></tr>
<tr><td><code id="accumulated_dependence_+3A_predict_function">predict_function</code></td>
<td>
<p>predict function Will be extracted from <code>x</code> if it's an explainer</p>
</td></tr>
<tr><td><code id="accumulated_dependence_+3A_label">label</code></td>
<td>
<p>name of the model. By default it's extracted from the <code>class</code> attribute of the model</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Find more detailes in the <a href="https://ema.drwhy.ai/accumulatedLocalProfiles.html">Accumulated Local Dependence Chapter</a>.
</p>


<h3>Value</h3>

<p>an object of the class <code>aggregated_profiles_explainer</code>
</p>


<h3>References</h3>

<p>ALEPlot: Accumulated Local Effects (ALE) Plots and Partial Dependence (PD) Plots <a href="https://cran.r-project.org/package=ALEPlot">https://cran.r-project.org/package=ALEPlot</a>,
Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")
library("ingredients")

model_titanic_glm &lt;- glm(survived ~ gender + age + fare,
                         data = titanic_imputed, family = "binomial")

explain_titanic_glm &lt;- explain(model_titanic_glm,
                               data = titanic_imputed[,-8],
                               y = titanic_imputed[,8],
                               verbose = FALSE)

adp_glm &lt;- accumulated_dependence(explain_titanic_glm,
                                  N = 25, variables = c("age", "fare"))
head(adp_glm)
plot(adp_glm)


library("ranger")

model_titanic_rf &lt;- ranger(survived ~., data = titanic_imputed, probability = TRUE)

explain_titanic_rf &lt;- explain(model_titanic_rf,
                              data = titanic_imputed[,-8],
                              y = titanic_imputed[,8],
                              label = "ranger forest",
                              verbose = FALSE)

adp_rf &lt;- accumulated_dependence(explain_titanic_rf, N = 200, variable_type = "numerical")
plot(adp_rf)

adp_rf &lt;- accumulated_dependence(explain_titanic_rf, N = 200, variable_type = "categorical")
plotD3(adp_rf, label_margin = 80, scale_plot = TRUE)


</code></pre>

<hr>
<h2 id='aggregate_profiles'>Aggregates Ceteris Paribus Profiles</h2><span id='topic+aggregate_profiles'></span>

<h3>Description</h3>

<p>The function <code>aggregate_profiles()</code> calculates an aggregate of ceteris paribus profiles.
It can be: Partial Dependence Profile (average across Ceteris Paribus Profiles),
Conditional Dependence Profile (local weighted average across Ceteris Paribus Profiles) or
Accumulated Local Dependence Profile (cummulated average local changes in Ceteris Paribus Profiles).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>aggregate_profiles(
  x,
  ...,
  variable_type = "numerical",
  groups = NULL,
  type = "partial",
  variables = NULL,
  span = 0.25,
  center = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="aggregate_profiles_+3A_x">x</code></td>
<td>
<p>a ceteris paribus explainer produced with function <code>ceteris_paribus()</code></p>
</td></tr>
<tr><td><code id="aggregate_profiles_+3A_...">...</code></td>
<td>
<p>other explainers that shall be calculated together</p>
</td></tr>
<tr><td><code id="aggregate_profiles_+3A_variable_type">variable_type</code></td>
<td>
<p>a character. If <code>numerical</code> then only numerical variables will be calculated.
If <code>categorical</code> then only categorical variables will be calculated.</p>
</td></tr>
<tr><td><code id="aggregate_profiles_+3A_groups">groups</code></td>
<td>
<p>a variable name that will be used for grouping.
By default <code>NULL</code> which means that no groups shall be calculated</p>
</td></tr>
<tr><td><code id="aggregate_profiles_+3A_type">type</code></td>
<td>
<p>either <code>partial/conditional/accumulated</code> for partial dependence, conditional profiles of accumulated local effects</p>
</td></tr>
<tr><td><code id="aggregate_profiles_+3A_variables">variables</code></td>
<td>
<p>if not <code>NULL</code> then aggregate only for selected <code>variables</code> will be calculated</p>
</td></tr>
<tr><td><code id="aggregate_profiles_+3A_span">span</code></td>
<td>
<p>smoothing coefficient, by default <code>0.25</code>. It's the sd for gaussian kernel</p>
</td></tr>
<tr><td><code id="aggregate_profiles_+3A_center">center</code></td>
<td>
<p>by default accumulated profiles start at 0. If <code>center=TRUE</code>, then they are centered around mean prediction,
which is calculated on the observations used in <code>ceteris_paribus</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an object of the class <code>aggregated_profiles_explainer</code>
</p>


<h3>References</h3>

<p>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")
library("ingredients")
library("ranger")
head(titanic_imputed)

model_titanic_rf &lt;- ranger(survived ~.,  data = titanic_imputed, probability = TRUE)

explain_titanic_rf &lt;- explain(model_titanic_rf,
                              data = titanic_imputed[,-8],
                              y = titanic_imputed[,8],
                              label = "ranger forest",
                              verbose = FALSE)

selected_passangers &lt;- select_sample(titanic_imputed, n = 100)
cp_rf &lt;- ceteris_paribus(explain_titanic_rf, selected_passangers)
head(cp_rf)

# continuous variable
pdp_rf_p &lt;- aggregate_profiles(cp_rf, variables = "age", type = "partial")
pdp_rf_p$`_label_` &lt;- "RF_partial"
pdp_rf_c &lt;- aggregate_profiles(cp_rf, variables = "age", type = "conditional")
pdp_rf_c$`_label_` &lt;- "RF_conditional"
pdp_rf_a &lt;- aggregate_profiles(cp_rf, variables = "age", type = "accumulated")
pdp_rf_a$`_label_` &lt;- "RF_accumulated"

plot(pdp_rf_p, pdp_rf_c, pdp_rf_a, color = "_label_")

pdp_rf &lt;- aggregate_profiles(cp_rf, variables = "age",
                             groups = "gender")

head(pdp_rf)
plot(cp_rf, variables = "age") +
  show_observations(cp_rf, variables = "age") +
  show_rugs(cp_rf, variables = "age", color = "red") +
  show_aggregated_profiles(pdp_rf, size = 3, color = "_label_")

# categorical variable
pdp_rf_p &lt;- aggregate_profiles(cp_rf, variables = "class",
                               variable_type = "categorical",  type = "partial")
pdp_rf_p$`_label_` &lt;- "RF_partial"
pdp_rf_c &lt;- aggregate_profiles(cp_rf, variables = "class",
                               variable_type = "categorical", type = "conditional")
pdp_rf_c$`_label_` &lt;- "RF_conditional"
pdp_rf_a &lt;- aggregate_profiles(cp_rf, variables = "class",
                               variable_type = "categorical", type = "accumulated")
pdp_rf_a$`_label_` &lt;- "RF_accumulated"
plot(pdp_rf_p, pdp_rf_c, pdp_rf_a, color = "_label_")

# or maybe flipped?
library(ggplot2)
plot(pdp_rf_p, pdp_rf_c, pdp_rf_a, color = "_label_") + coord_flip()

pdp_rf &lt;- aggregate_profiles(cp_rf, variables = "class", variable_type = "categorical",
                             groups = "gender")
head(pdp_rf)
plot(pdp_rf, variables = "class")
# or maybe flipped?
plot(pdp_rf, variables = "class") + coord_flip()



</code></pre>

<hr>
<h2 id='bind_plots'>Bind Multiple ggplot Objects</h2><span id='topic+bind_plots'></span>

<h3>Description</h3>

<p>This is an aesthetically efficient implementation of the
<code><a href="gridExtra.html#topic+arrangeGrob">grid.arrange</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bind_plots(..., byrow = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="bind_plots_+3A_...">...</code></td>
<td>
<p>(<code>ggplot</code>) ggplot objects to combine.</p>
</td></tr>
<tr><td><code id="bind_plots_+3A_byrow">byrow</code></td>
<td>
<p>(<code>logical</code>) if <code>FALSE</code> (the default) the plots are bind by
columns, otherwise the plots are bind by rows.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>(<code>gtable</code>) A plottable object with <code>plot()</code>.
</p>


<h3>Author(s)</h3>

<p><a href="https://github.com/harell">https://github.com/harell</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library("DALEX")
library("ingredients")

titanic_glm &lt;- glm(survived ~ gender + age + fare,
                   data = titanic_imputed, family = "binomial")

explain_glm &lt;- explain(titanic_glm,
                       data = titanic_imputed,
                       y = titanic_imputed$survived,
                       verbose = FALSE)

pdp_numerical &lt;- partial_dependence(explain_glm, N = 50, variable_type = "numerical")
pdp_categorical &lt;- partial_dependence(explain_glm, N = 50, variable_type = "categorical")

# Bind plots by rows
bind_plots(plot(pdp_numerical), plot(pdp_categorical), byrow = TRUE)

# Bind plots by columns
bind_plots(plot(pdp_numerical), plot(pdp_categorical), byrow = FALSE)


</code></pre>

<hr>
<h2 id='calculate_oscillations'>Calculate Oscillations for Ceteris Paribus Explainer</h2><span id='topic+calculate_oscillations'></span>

<h3>Description</h3>

<p>Oscillations are proxies for local feature importance at the instance level.
Find more details in <a href="https://ema.drwhy.ai/ceterisParibusOscillations.html">Ceteris Paribus Oscillations Chapter</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_oscillations(x, sort = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calculate_oscillations_+3A_x">x</code></td>
<td>
<p>a ceteris paribus explainer produced with the <code>ceteris_paribus()</code> function</p>
</td></tr>
<tr><td><code id="calculate_oscillations_+3A_sort">sort</code></td>
<td>
<p>a logical value. If <code>TRUE</code> then rows are sorted along the oscillations</p>
</td></tr>
<tr><td><code id="calculate_oscillations_+3A_...">...</code></td>
<td>
<p>other arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an object of the class <code>ceteris_paribus_oscillations</code>
</p>


<h3>References</h3>

<p>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")
library("ingredients")

titanic_small &lt;- select_sample(titanic_imputed, n = 500, seed = 1313)

# build a model
model_titanic_glm &lt;- glm(survived ~ gender + age + fare,
                         data = titanic_small, family = "binomial")

explain_titanic_glm &lt;- explain(model_titanic_glm,
                               data = titanic_small[,-8],
                               y = titanic_small[,8])

cp_rf &lt;- ceteris_paribus(explain_titanic_glm, titanic_small[1,])

calculate_oscillations(cp_rf)


library("ranger")

apartments_rf_model &lt;- ranger(m2.price ~ construction.year + surface + floor +
                                    no.rooms + district, data = apartments)

explainer_rf &lt;- explain(apartments_rf_model,
                        data = apartments_test[,-1],
                        y = apartments_test$m2.price,
                        label = "ranger forest",
                        verbose = FALSE)

apartment &lt;- apartments_test[1,]

cp_rf &lt;- ceteris_paribus(explainer_rf, apartment)

calculate_oscillations(cp_rf)


</code></pre>

<hr>
<h2 id='calculate_variable_profile'>Internal Function for Individual Variable Profiles</h2><span id='topic+calculate_variable_profile'></span><span id='topic+calculate_variable_profile.default'></span>

<h3>Description</h3>

<p>This function calculates individual variable profiles (ceteris paribus profiles), i.e. series of predictions from a model calculated for observations with altered single coordinate.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_variable_profile(
  data,
  variable_splits,
  model,
  predict_function = predict,
  ...
)

## Default S3 method:
calculate_variable_profile(
  data,
  variable_splits,
  model,
  predict_function = predict,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calculate_variable_profile_+3A_data">data</code></td>
<td>
<p>set of observations. Profile will be calculated for every observation (every row)</p>
</td></tr>
<tr><td><code id="calculate_variable_profile_+3A_variable_splits">variable_splits</code></td>
<td>
<p>named list of vectors. Elements of the list are vectors with points in which profiles should be calculated. See an example for more details.</p>
</td></tr>
<tr><td><code id="calculate_variable_profile_+3A_model">model</code></td>
<td>
<p>a model that will be passed to the <code>predict_function</code></p>
</td></tr>
<tr><td><code id="calculate_variable_profile_+3A_predict_function">predict_function</code></td>
<td>
<p>function that takes data and model and returns numeric predictions. Note that the ... arguments will be passed to this function.</p>
</td></tr>
<tr><td><code id="calculate_variable_profile_+3A_...">...</code></td>
<td>
<p>other parameters that will be passed to the <code>predict_function</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note that <code><a href="#topic+calculate_variable_profile">calculate_variable_profile</a></code> function is S3 generic.
If you want to work on non standard data sources (like H2O ddf, external databases)
you should overload it.
</p>


<h3>Value</h3>

<p>a data frame with profiles for selected variables and selected observations
</p>


<h3>References</h3>

<p>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>

<hr>
<h2 id='calculate_variable_split'>Internal Function for Split Points for Selected Variables</h2><span id='topic+calculate_variable_split'></span><span id='topic+calculate_variable_split.default'></span>

<h3>Description</h3>

<p>This function calculate candidate splits for each selected variable.
For numerical variables splits are calculated as percentiles
(in general uniform quantiles of the length grid_points).
For all other variables splits are calculated as unique values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_variable_split(
  data,
  variables = colnames(data),
  grid_points = 101,
  variable_splits_type = "quantiles",
  new_observation = NA
)

## Default S3 method:
calculate_variable_split(
  data,
  variables = colnames(data),
  grid_points = 101,
  variable_splits_type = "quantiles",
  new_observation = NA
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calculate_variable_split_+3A_data">data</code></td>
<td>
<p>validation dataset. Is used to determine distribution of observations.</p>
</td></tr>
<tr><td><code id="calculate_variable_split_+3A_variables">variables</code></td>
<td>
<p>names of variables for which splits shall be calculated</p>
</td></tr>
<tr><td><code id="calculate_variable_split_+3A_grid_points">grid_points</code></td>
<td>
<p>number of points used for response path</p>
</td></tr>
<tr><td><code id="calculate_variable_split_+3A_variable_splits_type">variable_splits_type</code></td>
<td>
<p>how variable grids shall be calculated? Use &quot;quantiles&quot; (default) for percentiles or &quot;uniform&quot; to get uniform grid of points</p>
</td></tr>
<tr><td><code id="calculate_variable_split_+3A_new_observation">new_observation</code></td>
<td>
<p>if specified (not <code>NA</code>) then all values in <code>new_observation</code> will be included in <code>variable_splits</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note that <code><a href="#topic+calculate_variable_split">calculate_variable_split</a></code> function is S3 generic.
If you want to work on non standard data sources (like H2O ddf, external databases)
you should overload it.
</p>


<h3>Value</h3>

<p>A named list with splits for selected variables
</p>

<hr>
<h2 id='ceteris_paribus'>Ceteris Paribus Profiles aka Individual Variable Profiles</h2><span id='topic+ceteris_paribus'></span><span id='topic+ceteris_paribus.explainer'></span><span id='topic+ceteris_paribus.default'></span>

<h3>Description</h3>

<p>This explainer works for individual observations.
For each observation it calculates Ceteris Paribus Profiles for selected variables.
Such profiles can be used to hypothesize about model results if selected variable is changed.
For this reason it is also called 'What-If Profiles'.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ceteris_paribus(x, ...)

## S3 method for class 'explainer'
ceteris_paribus(
  x,
  new_observation,
  y = NULL,
  variables = NULL,
  variable_splits = NULL,
  grid_points = 101,
  variable_splits_type = "quantiles",
  ...
)

## Default S3 method:
ceteris_paribus(
  x,
  data,
  predict_function = predict,
  new_observation,
  y = NULL,
  variables = NULL,
  variable_splits = NULL,
  grid_points = 101,
  variable_splits_type = "quantiles",
  variable_splits_with_obs = FALSE,
  label = class(x)[1],
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ceteris_paribus_+3A_x">x</code></td>
<td>
<p>an explainer created with the <code>DALEX::explain()</code> function, or a model to be explained.</p>
</td></tr>
<tr><td><code id="ceteris_paribus_+3A_...">...</code></td>
<td>
<p>other parameters</p>
</td></tr>
<tr><td><code id="ceteris_paribus_+3A_new_observation">new_observation</code></td>
<td>
<p>a new observation with columns that corresponds to variables used in the model</p>
</td></tr>
<tr><td><code id="ceteris_paribus_+3A_y">y</code></td>
<td>
<p>true labels for <code>new_observation</code>. If specified then will be added to ceteris paribus plots.
NOTE: It is best when target variable is not present in the <code>new_observation</code></p>
</td></tr>
<tr><td><code id="ceteris_paribus_+3A_variables">variables</code></td>
<td>
<p>names of variables for which profiles shall be calculated.
Will be passed to <code><a href="#topic+calculate_variable_split">calculate_variable_split</a></code>.
If NULL then all variables from the validation data will be used.</p>
</td></tr>
<tr><td><code id="ceteris_paribus_+3A_variable_splits">variable_splits</code></td>
<td>
<p>named list of splits for variables, in most cases created with <code><a href="#topic+calculate_variable_split">calculate_variable_split</a></code>.
If NULL then it will be calculated based on validation data available in the <code>explainer</code>.</p>
</td></tr>
<tr><td><code id="ceteris_paribus_+3A_grid_points">grid_points</code></td>
<td>
<p>maximum number of points for profile calculations. Note that the finaln number of points may be lower than <code>grid_points</code>, eg. if there is not enough unique values for a given variable. Will be passed to <code><a href="#topic+calculate_variable_split">calculate_variable_split</a></code>.</p>
</td></tr>
<tr><td><code id="ceteris_paribus_+3A_variable_splits_type">variable_splits_type</code></td>
<td>
<p>how variable grids shall be calculated? Use &quot;quantiles&quot; (default) for percentiles or &quot;uniform&quot; to get uniform grid of points</p>
</td></tr>
<tr><td><code id="ceteris_paribus_+3A_data">data</code></td>
<td>
<p>validation dataset. It will be extracted from <code>x</code> if it's an explainer
NOTE: It is best when target variable is not present in the <code>data</code></p>
</td></tr>
<tr><td><code id="ceteris_paribus_+3A_predict_function">predict_function</code></td>
<td>
<p>predict function. It will be extracted from <code>x</code> if it's an explainer</p>
</td></tr>
<tr><td><code id="ceteris_paribus_+3A_variable_splits_with_obs">variable_splits_with_obs</code></td>
<td>
<p>if <code>TRUE</code> then all values in <code>new_observation</code> will be included in <code>variable_splits</code></p>
</td></tr>
<tr><td><code id="ceteris_paribus_+3A_label">label</code></td>
<td>
<p>name of the model. By default it's extracted from the <code>class</code> attribute of the model</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Find more details in <a href="https://ema.drwhy.ai/ceterisParibus.html">Ceteris Paribus Chapter</a>.
</p>


<h3>Value</h3>

<p>an object of the class <code>ceteris_paribus_explainer</code>.
</p>


<h3>References</h3>

<p>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")
library("ingredients")
titanic_small &lt;- select_sample(titanic_imputed, n = 500, seed = 1313)

# build a model
model_titanic_glm &lt;- glm(survived ~ gender + age + fare,
                         data = titanic_small,
                         family = "binomial")

explain_titanic_glm &lt;- explain(model_titanic_glm,
                               data = titanic_small[,-8],
                               y = titanic_small[,8])

cp_rf &lt;- ceteris_paribus(explain_titanic_glm, titanic_small[1,])
cp_rf

plot(cp_rf, variables = "age")


library("ranger")
model_titanic_rf &lt;- ranger(survived ~., data = titanic_imputed, probability = TRUE)


explain_titanic_rf &lt;- explain(model_titanic_rf,
                              data = titanic_imputed[,-8],
                              y = titanic_imputed[,8],
                              label = "ranger forest",
                              verbose = FALSE)

# select few passangers
selected_passangers &lt;- select_sample(titanic_imputed, n = 20)
cp_rf &lt;- ceteris_paribus(explain_titanic_rf, selected_passangers)
cp_rf

plot(cp_rf, variables = "age") +
  show_observations(cp_rf, variables = "age") +
  show_rugs(cp_rf, variables = "age", color = "red")



</code></pre>

<hr>
<h2 id='ceteris_paribus_2d'>Ceteris Paribus 2D Plot</h2><span id='topic+ceteris_paribus_2d'></span>

<h3>Description</h3>

<p>This function calculates ceteris paribus profiles for grid of values spanned by two variables.
It may be useful to identify or present interactions between two variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ceteris_paribus_2d(explainer, observation, grid_points = 101, variables = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ceteris_paribus_2d_+3A_explainer">explainer</code></td>
<td>
<p>a model to be explained, preprocessed by the <code>DALEX::explain()</code> function</p>
</td></tr>
<tr><td><code id="ceteris_paribus_2d_+3A_observation">observation</code></td>
<td>
<p>a new observation for which predictions need to be explained</p>
</td></tr>
<tr><td><code id="ceteris_paribus_2d_+3A_grid_points">grid_points</code></td>
<td>
<p>number of points used for response path. Will be used for both variables</p>
</td></tr>
<tr><td><code id="ceteris_paribus_2d_+3A_variables">variables</code></td>
<td>
<p>if specified, then only these variables will be explained</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an object of the class <code>ceteris_paribus_2d_explainer</code>.
</p>


<h3>References</h3>

<p>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")
library("ingredients")

model_titanic_glm &lt;- glm(survived ~ age + fare,
                       data = titanic_imputed, family = "binomial")


explain_titanic_glm &lt;- explain(model_titanic_glm,
                               data = titanic_imputed[,-8],
                               y = titanic_imputed[,8])

cp_rf &lt;- ceteris_paribus_2d(explain_titanic_glm, titanic_imputed[1,],
                       variables = c("age", "fare", "sibsp"))
head(cp_rf)

plot(cp_rf)

library("ranger")
set.seed(59)

apartments_rf_model &lt;- ranger(m2.price ~., data = apartments)

explainer_rf &lt;- explain(apartments_rf_model,
                        data = apartments_test[,-1],
                        y = apartments_test[,1],
                        label = "ranger forest",
                        verbose = FALSE)

new_apartment &lt;- apartments_test[1,]
new_apartment

wi_rf_2d &lt;- ceteris_paribus_2d(explainer_rf, observation = new_apartment,
                               variables = c("surface", "floor", "no.rooms"))
head(wi_rf_2d)
plot(wi_rf_2d)


</code></pre>

<hr>
<h2 id='cluster_profiles'>Cluster Ceteris Paribus Profiles</h2><span id='topic+cluster_profiles'></span>

<h3>Description</h3>

<p>This function calculates aggregates of ceteris paribus profiles based on
hierarchical clustering.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cluster_profiles(
  x,
  ...,
  aggregate_function = mean,
  variable_type = "numerical",
  center = FALSE,
  k = 3,
  variables = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cluster_profiles_+3A_x">x</code></td>
<td>
<p>a ceteris paribus explainer produced with function <code>ceteris_paribus()</code></p>
</td></tr>
<tr><td><code id="cluster_profiles_+3A_...">...</code></td>
<td>
<p>other explainers that shall be plotted together</p>
</td></tr>
<tr><td><code id="cluster_profiles_+3A_aggregate_function">aggregate_function</code></td>
<td>
<p>a function for profile aggregation. By default it's <code>mean</code></p>
</td></tr>
<tr><td><code id="cluster_profiles_+3A_variable_type">variable_type</code></td>
<td>
<p>a character. If <code>numerical</code> then only numerical variables will be computed.
If <code>categorical</code> then only categorical variables will be computed.</p>
</td></tr>
<tr><td><code id="cluster_profiles_+3A_center">center</code></td>
<td>
<p>shall profiles be centered before clustering</p>
</td></tr>
<tr><td><code id="cluster_profiles_+3A_k">k</code></td>
<td>
<p>number of clusters for the hclust function</p>
</td></tr>
<tr><td><code id="cluster_profiles_+3A_variables">variables</code></td>
<td>
<p>if not <code>NULL</code> then only <code>variables</code> will be presented</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Find more detailes in the <a href="https://ema.drwhy.ai/partialDependenceProfiles.html">Clustering Profiles Chapter</a>.
</p>


<h3>Value</h3>

<p>an object of the class <code>aggregated_profiles_explainer</code>
</p>


<h3>References</h3>

<p>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")
library("ingredients")

selected_passangers &lt;- select_sample(titanic_imputed, n = 100)
model_titanic_glm &lt;- glm(survived ~ gender + age + fare,
                         data = titanic_imputed, family = "binomial")

explain_titanic_glm &lt;- explain(model_titanic_glm,
                               data = titanic_imputed[,-8],
                               y = titanic_imputed[,8])

cp_rf &lt;- ceteris_paribus(explain_titanic_glm, selected_passangers)
clust_rf &lt;- cluster_profiles(cp_rf, k = 3, variables = "age")
plot(clust_rf)


library("ranger")
model_titanic_rf &lt;- ranger(survived ~., data = titanic_imputed, probability = TRUE)

explain_titanic_rf &lt;- explain(model_titanic_rf,
                              data = titanic_imputed[,-8],
                              y = titanic_imputed[,8],
                              label = "ranger forest",
                              verbose = FALSE)

cp_rf &lt;- ceteris_paribus(explain_titanic_rf, selected_passangers)
cp_rf

pdp_rf &lt;- aggregate_profiles(cp_rf, variables = "age")
head(pdp_rf)
clust_rf &lt;- cluster_profiles(cp_rf, k = 3, variables = "age")
head(clust_rf)

plot(clust_rf, color = "_label_") +
  show_aggregated_profiles(pdp_rf, color = "black", size = 3)

plot(cp_rf, color = "grey", variables = "age") +
  show_aggregated_profiles(clust_rf, color = "_label_", size = 2)

clust_rf &lt;- cluster_profiles(cp_rf, k = 3, center = TRUE, variables = "age")
head(clust_rf)

</code></pre>

<hr>
<h2 id='conditional_dependence'>Conditional Dependence Profiles</h2><span id='topic+conditional_dependence'></span><span id='topic+conditional_dependence.explainer'></span><span id='topic+conditional_dependence.default'></span><span id='topic+conditional_dependence.ceteris_paribus_explainer'></span><span id='topic+local_dependency'></span><span id='topic+conditional_dependency'></span>

<h3>Description</h3>

<p>Conditional Dependence Profiles (aka Local Profiles) average localy Ceteris Paribus Profiles.
Function 'conditional_dependence' calls 'ceteris_paribus' and then 'aggregate_profiles'.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>conditional_dependence(x, ...)

## S3 method for class 'explainer'
conditional_dependence(
  x,
  variables = NULL,
  N = 500,
  variable_splits = NULL,
  grid_points = 101,
  ...,
  variable_type = "numerical"
)

## Default S3 method:
conditional_dependence(
  x,
  data,
  predict_function = predict,
  label = class(x)[1],
  variables = NULL,
  N = 500,
  variable_splits = NULL,
  grid_points = 101,
  ...,
  variable_type = "numerical"
)

## S3 method for class 'ceteris_paribus_explainer'
conditional_dependence(x, ..., variables = NULL)

local_dependency(x, ...)

conditional_dependency(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="conditional_dependence_+3A_x">x</code></td>
<td>
<p>an explainer created with function <code>DALEX::explain()</code>, an object of the class <code>ceteris_paribus_explainer</code>
or a model to be explained.</p>
</td></tr>
<tr><td><code id="conditional_dependence_+3A_...">...</code></td>
<td>
<p>other parameters</p>
</td></tr>
<tr><td><code id="conditional_dependence_+3A_variables">variables</code></td>
<td>
<p>names of variables for which profiles shall be calculated.
Will be passed to <code><a href="#topic+calculate_variable_split">calculate_variable_split</a></code>. If <code>NULL</code> then all variables from the validation data will be used.</p>
</td></tr>
<tr><td><code id="conditional_dependence_+3A_n">N</code></td>
<td>
<p>number of observations used for calculation of partial dependence profiles. By default <code>500</code>.</p>
</td></tr>
<tr><td><code id="conditional_dependence_+3A_variable_splits">variable_splits</code></td>
<td>
<p>named list of splits for variables, in most cases created with <code><a href="#topic+calculate_variable_split">calculate_variable_split</a></code>.
If <code>NULL</code> then it will be calculated based on validation data avaliable in the <code>explainer</code>.</p>
</td></tr>
<tr><td><code id="conditional_dependence_+3A_grid_points">grid_points</code></td>
<td>
<p>number of points for profile. Will be passed to <code><a href="#topic+calculate_variable_split">calculate_variable_split</a></code>.</p>
</td></tr>
<tr><td><code id="conditional_dependence_+3A_variable_type">variable_type</code></td>
<td>
<p>a character. If <code>"numerical"</code> then only numerical variables will be calculated.
If <code>"categorical"</code> then only categorical variables will be calculated.</p>
</td></tr>
<tr><td><code id="conditional_dependence_+3A_data">data</code></td>
<td>
<p>validation dataset, will be extracted from <code>x</code> if it's an explainer
NOTE: It is best when target variable is not present in the <code>data</code></p>
</td></tr>
<tr><td><code id="conditional_dependence_+3A_predict_function">predict_function</code></td>
<td>
<p>predict function, will be extracted from <code>x</code> if it's an explainer</p>
</td></tr>
<tr><td><code id="conditional_dependence_+3A_label">label</code></td>
<td>
<p>name of the model. By default it's extracted from the <code>class</code> attribute of the model</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Find more details in the <a href="https://ema.drwhy.ai/accumulatedLocalProfiles.html">Accumulated Local Dependence Chapter</a>.
</p>


<h3>Value</h3>

<p>an object of the class <code>aggregated_profile_explainer</code>
</p>


<h3>References</h3>

<p>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")
library("ingredients")

model_titanic_glm &lt;- glm(survived ~ gender + age + fare,
                         data = titanic_imputed, family = "binomial")

explain_titanic_glm &lt;- explain(model_titanic_glm,
                               data = titanic_imputed[,-8],
                               y = titanic_imputed[,8],
                               verbose = FALSE)

cdp_glm &lt;- conditional_dependence(explain_titanic_glm,
                                  N = 150, variables = c("age", "fare"))
head(cdp_glm)
plot(cdp_glm)


library("ranger")

model_titanic_rf &lt;- ranger(survived ~., data = titanic_imputed, probability = TRUE)

explain_titanic_rf &lt;- explain(model_titanic_rf,
                              data = titanic_imputed[,-8],
                              y = titanic_imputed[,8],
                              label = "ranger forest",
                              verbose = FALSE)

cdp_rf &lt;- conditional_dependence(explain_titanic_rf, N = 200, variable_type = "numerical")
plot(cdp_rf)

cdp_rf &lt;- conditional_dependence(explain_titanic_rf, N = 200, variable_type = "categorical")
plotD3(cdp_rf, label_margin = 100, scale_plot = TRUE)


</code></pre>

<hr>
<h2 id='describe.partial_dependence_explainer'>Natural language description of feature importance explainer</h2><span id='topic+describe.partial_dependence_explainer'></span><span id='topic+describe'></span><span id='topic+describe.ceteris_paribus_explainer'></span><span id='topic+describe.feature_importance_explainer'></span>

<h3>Description</h3>

<p>Generic function <code>describe</code> generates a natural language
description of <code>ceteris_paribus()</code>, <code>aggregated_profiles()</code> and
<code>feature_importance()</code> explanations what enchaces their interpretability.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'partial_dependence_explainer'
describe(
  x,
  nonsignificance_treshold = 0.15,
  ...,
  display_values = FALSE,
  display_numbers = FALSE,
  variables = NULL,
  label = "prediction"
)

describe(x, ...)

## S3 method for class 'ceteris_paribus_explainer'
describe(
  x,
  nonsignificance_treshold = 0.15,
  ...,
  display_values = FALSE,
  display_numbers = FALSE,
  variables = NULL,
  label = "prediction"
)

## S3 method for class 'feature_importance_explainer'
describe(x, nonsignificance_treshold = 0.15, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="describe.partial_dependence_explainer_+3A_x">x</code></td>
<td>
<p>a ceteris paribus explanation produced with function <code>ceteris_paribus()</code></p>
</td></tr>
<tr><td><code id="describe.partial_dependence_explainer_+3A_nonsignificance_treshold">nonsignificance_treshold</code></td>
<td>
<p>a parameter specifying a treshold for variable importance</p>
</td></tr>
<tr><td><code id="describe.partial_dependence_explainer_+3A_...">...</code></td>
<td>
<p>other arguments</p>
</td></tr>
<tr><td><code id="describe.partial_dependence_explainer_+3A_display_values">display_values</code></td>
<td>
<p>allows for displaying variable values</p>
</td></tr>
<tr><td><code id="describe.partial_dependence_explainer_+3A_display_numbers">display_numbers</code></td>
<td>
<p>allows for displaying numerical values</p>
</td></tr>
<tr><td><code id="describe.partial_dependence_explainer_+3A_variables">variables</code></td>
<td>
<p>a character of a single variable name to be described</p>
</td></tr>
<tr><td><code id="describe.partial_dependence_explainer_+3A_label">label</code></td>
<td>
<p>label for model's prediction</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function <code>describe.ceteris_paribus()</code> generates a natural language description of
ceteris paribus profile. The description summarizes variable values, that would change
model's prediction at most. If a ceteris paribus profile for multiple variables is passed,
<code>variables</code> must specify a single variable to be described. Works only for a ceteris paribus profile
for one observation. In current version only categorical values are discribed. For <code>display_numbers = TRUE</code>
three most important variable values are displayed, while <code>display_numbers = FALSE</code> displays
all the important variables, however without further details.
</p>
<p>Function <code>describe.ceteris_paribus()</code> generates a natural language description of
ceteris paribus profile. The description summarizes variable values, that would change
model's prediction at most. If a ceteris paribus profile for multiple variables is passed,
<code>variables</code> must specify a single variable to be described. Works only for a ceteris paribus profile
for one observation. For <code>display_numbers = TRUE</code>
three most important variable values are displayed, while <code>display_numbers = FALSE</code> displays
all the important variables, however without further details.
</p>
<p>Function <code>describe.feature_importance_explainer()</code> generates a natural language
description of feature importance explanation. It prints the number of important variables, that
have significant dropout difference from the full model, depending on <code>nonsignificance_treshold</code>.
The description prints the three most important variables for the model's prediction.
The current design of DALEX explainer does not allow for displaying variables values.
</p>


<h3>References</h3>

<p>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")
library("ingredients")
library("ranger")


model_titanic_rf &lt;- ranger(survived ~., data = titanic_imputed, probability = TRUE)

explain_titanic_rf &lt;- explain(model_titanic_rf,
                              data = titanic_imputed[,-8],
                              y = titanic_imputed[,8],
                              label = "ranger forest",
                              verbose = FALSE)

selected_passangers &lt;- select_sample(titanic_imputed, n = 10)
cp_rf &lt;- ceteris_paribus(explain_titanic_rf, selected_passangers)
pdp &lt;- aggregate_profiles(cp_rf, type = "partial", variable_type = "categorical")
describe(pdp, variables = "gender")


library("DALEX")
library("ingredients")
library("ranger")


model_titanic_rf &lt;- ranger(survived ~.,  data = titanic_imputed, probability = TRUE)

explain_titanic_rf &lt;- explain(model_titanic_rf,
                              data = titanic_imputed[,-8],
                              y = titanic_imputed[,8],
                              label = "ranger forest",
                              verbose = FALSE)

selected_passanger &lt;- select_sample(titanic_imputed, n = 1, seed = 123)
cp_rf &lt;- ceteris_paribus(explain_titanic_rf, selected_passanger)

plot(cp_rf, variable_type = "categorical")
describe(cp_rf, variables = "class", label = "the predicted probability")

library("DALEX")
library("ingredients")

lm_model &lt;- lm(m2.price~., data = apartments)
explainer_lm &lt;- explain(lm_model, data = apartments[,-1], y = apartments[,1])

fi_lm &lt;- feature_importance(explainer_lm, loss_function = DALEX::loss_root_mean_square)

plot(fi_lm)
describe(fi_lm)

</code></pre>

<hr>
<h2 id='feature_importance'>Feature Importance</h2><span id='topic+feature_importance'></span><span id='topic+feature_importance.explainer'></span><span id='topic+feature_importance.default'></span>

<h3>Description</h3>

<p>This function calculates permutation based feature importance.
For this reason it is also called the Variable Dropout Plot.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>feature_importance(x, ...)

## S3 method for class 'explainer'
feature_importance(
  x,
  loss_function = DALEX::loss_root_mean_square,
  ...,
  type = c("raw", "ratio", "difference"),
  n_sample = NULL,
  B = 10,
  variables = NULL,
  variable_groups = NULL,
  N = n_sample,
  label = NULL
)

## Default S3 method:
feature_importance(
  x,
  data,
  y,
  predict_function = predict,
  loss_function = DALEX::loss_root_mean_square,
  ...,
  label = class(x)[1],
  type = c("raw", "ratio", "difference"),
  n_sample = NULL,
  B = 10,
  variables = NULL,
  N = n_sample,
  variable_groups = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="feature_importance_+3A_x">x</code></td>
<td>
<p>an explainer created with function <code>DALEX::explain()</code>, or a model to be explained.</p>
</td></tr>
<tr><td><code id="feature_importance_+3A_...">...</code></td>
<td>
<p>other parameters</p>
</td></tr>
<tr><td><code id="feature_importance_+3A_loss_function">loss_function</code></td>
<td>
<p>a function thet will be used to assess variable importance</p>
</td></tr>
<tr><td><code id="feature_importance_+3A_type">type</code></td>
<td>
<p>character, type of transformation that should be applied for dropout loss.
&quot;raw&quot; results raw drop losses, &quot;ratio&quot; returns <code>drop_loss/drop_loss_full_model</code>
while &quot;difference&quot; returns <code>drop_loss - drop_loss_full_model</code></p>
</td></tr>
<tr><td><code id="feature_importance_+3A_n_sample">n_sample</code></td>
<td>
<p>alias for <code>N</code> held for backwards compatibility. number of observations that should be sampled for calculation of variable importance.</p>
</td></tr>
<tr><td><code id="feature_importance_+3A_b">B</code></td>
<td>
<p>integer, number of permutation rounds to perform on each variable. By default it's <code>10</code>.</p>
</td></tr>
<tr><td><code id="feature_importance_+3A_variables">variables</code></td>
<td>
<p>vector of variables. If <code>NULL</code> then variable importance will be tested for each variable from the <code>data</code> separately. By default <code>NULL</code></p>
</td></tr>
<tr><td><code id="feature_importance_+3A_variable_groups">variable_groups</code></td>
<td>
<p>list of variables names vectors. This is for testing joint variable importance.
If <code>NULL</code> then variable importance will be tested separately for <code>variables</code>.
By default <code>NULL</code>. If specified then it will override <code>variables</code></p>
</td></tr>
<tr><td><code id="feature_importance_+3A_n">N</code></td>
<td>
<p>number of observations that should be sampled for calculation of variable importance.
If <code>NULL</code> then variable importance will be calculated on whole dataset (no sampling).</p>
</td></tr>
<tr><td><code id="feature_importance_+3A_label">label</code></td>
<td>
<p>name of the model. By default it's extracted from the <code>class</code> attribute of the model</p>
</td></tr>
<tr><td><code id="feature_importance_+3A_data">data</code></td>
<td>
<p>validation dataset, will be extracted from <code>x</code> if it's an explainer
NOTE: It is best when target variable is not present in the <code>data</code></p>
</td></tr>
<tr><td><code id="feature_importance_+3A_y">y</code></td>
<td>
<p>true labels for <code>data</code>, will be extracted from <code>x</code> if it's an explainer</p>
</td></tr>
<tr><td><code id="feature_importance_+3A_predict_function">predict_function</code></td>
<td>
<p>predict function, will be extracted from <code>x</code> if it's an explainer</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Find more details in the <a href="https://ema.drwhy.ai/featureImportance.html">Feature Importance Chapter</a>.
</p>


<h3>Value</h3>

<p>an object of the class <code>feature_importance</code>
</p>


<h3>References</h3>

<p>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")
library("ingredients")

model_titanic_glm &lt;- glm(survived ~ gender + age + fare,
                         data = titanic_imputed, family = "binomial")

explain_titanic_glm &lt;- explain(model_titanic_glm,
                               data = titanic_imputed[,-8],
                               y = titanic_imputed[,8])

fi_glm &lt;- feature_importance(explain_titanic_glm, B = 1)
plot(fi_glm)



fi_glm_joint1 &lt;- feature_importance(explain_titanic_glm,
                   variable_groups = list("demographics" = c("gender", "age"),
                   "ticket_type" = c("fare")),
                   label = "lm 2 groups")

plot(fi_glm_joint1)

fi_glm_joint2 &lt;- feature_importance(explain_titanic_glm,
                   variable_groups = list("demographics" = c("gender", "age"),
                                          "wealth" = c("fare", "class"),
                                          "family" = c("sibsp", "parch"),
                                          "embarked" = "embarked"),
                   label = "lm 5 groups")

plot(fi_glm_joint2, fi_glm_joint1)

library("ranger")
model_titanic_rf &lt;- ranger(survived ~., data = titanic_imputed, probability = TRUE)

explain_titanic_rf &lt;- explain(model_titanic_rf,
                              data = titanic_imputed[,-8],
                              y = titanic_imputed[,8],
                              label = "ranger forest",
                              verbose = FALSE)

fi_rf &lt;- feature_importance(explain_titanic_rf)
plot(fi_rf)

fi_rf &lt;- feature_importance(explain_titanic_rf, B = 6) # 6 replications
plot(fi_rf)

fi_rf_group &lt;- feature_importance(explain_titanic_rf,
                   variable_groups = list("demographics" = c("gender", "age"),
                   "wealth" = c("fare", "class"),
                   "family" = c("sibsp", "parch"),
                   "embarked" = "embarked"),
                   label = "rf 4 groups")

plot(fi_rf_group, fi_rf)

HR_rf_model &lt;- ranger(status ~., data = HR, probability = TRUE)

explainer_rf  &lt;- explain(HR_rf_model, data = HR, y = HR$status,
                         model_info = list(type = 'multiclass'))

fi_rf &lt;- feature_importance(explainer_rf, type = "raw",
                            loss_function = DALEX::loss_cross_entropy)
head(fi_rf)
plot(fi_rf)

HR_glm_model &lt;- glm(status == "fired"~., data = HR, family = "binomial")
explainer_glm &lt;- explain(HR_glm_model, data = HR, y = as.numeric(HR$status == "fired"))
fi_glm &lt;- feature_importance(explainer_glm, type = "raw",
                             loss_function = DALEX::loss_root_mean_square)
head(fi_glm)
plot(fi_glm)


</code></pre>

<hr>
<h2 id='partial_dependence'>Partial Dependence Profiles</h2><span id='topic+partial_dependence'></span><span id='topic+partial_dependence.explainer'></span><span id='topic+partial_dependence.default'></span><span id='topic+partial_dependence.ceteris_paribus_explainer'></span><span id='topic+partial_dependency'></span>

<h3>Description</h3>

<p>Partial Dependence Profiles are averages from Ceteris Paribus Profiles.
Function <code>partial_dependence</code> calls <code>ceteris_paribus</code> and then <code>aggregate_profiles</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>partial_dependence(x, ...)

## S3 method for class 'explainer'
partial_dependence(
  x,
  variables = NULL,
  N = 500,
  variable_splits = NULL,
  grid_points = 101,
  ...,
  variable_type = "numerical"
)

## Default S3 method:
partial_dependence(
  x,
  data,
  predict_function = predict,
  label = class(x)[1],
  variables = NULL,
  grid_points = 101,
  variable_splits = NULL,
  N = 500,
  ...,
  variable_type = "numerical"
)

## S3 method for class 'ceteris_paribus_explainer'
partial_dependence(x, ..., variables = NULL)

partial_dependency(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="partial_dependence_+3A_x">x</code></td>
<td>
<p>an explainer created with function <code>DALEX::explain()</code>, an object of the class <code>ceteris_paribus_explainer</code> or
or a model to be explained.</p>
</td></tr>
<tr><td><code id="partial_dependence_+3A_...">...</code></td>
<td>
<p>other parameters</p>
</td></tr>
<tr><td><code id="partial_dependence_+3A_variables">variables</code></td>
<td>
<p>names of variables for which profiles shall be calculated.
Will be passed to <code><a href="#topic+calculate_variable_split">calculate_variable_split</a></code>.
If <code>NULL</code> then all variables from the validation data will be used.</p>
</td></tr>
<tr><td><code id="partial_dependence_+3A_n">N</code></td>
<td>
<p>number of observations used for calculation of partial dependence profiles. By default <code>500</code>.</p>
</td></tr>
<tr><td><code id="partial_dependence_+3A_variable_splits">variable_splits</code></td>
<td>
<p>named list of splits for variables, in most cases created with <code><a href="#topic+calculate_variable_split">calculate_variable_split</a></code>.
If <code>NULL</code> then it will be calculated based on validation data avaliable in the <code>explainer</code>.</p>
</td></tr>
<tr><td><code id="partial_dependence_+3A_grid_points">grid_points</code></td>
<td>
<p>number of points for profile. Will be passed to <code><a href="#topic+calculate_variable_split">calculate_variable_split</a></code>.</p>
</td></tr>
<tr><td><code id="partial_dependence_+3A_variable_type">variable_type</code></td>
<td>
<p>a character. If <code>"numerical"</code> then only numerical variables will be calculated.
If <code>"categorical"</code> then only categorical variables will be calculated.</p>
</td></tr>
<tr><td><code id="partial_dependence_+3A_data">data</code></td>
<td>
<p>validation dataset, will be extracted from <code>x</code> if it's an explainer
NOTE: It is best when target variable is not present in the <code>data</code></p>
</td></tr>
<tr><td><code id="partial_dependence_+3A_predict_function">predict_function</code></td>
<td>
<p>predict function, will be extracted from <code>x</code> if it's an explainer</p>
</td></tr>
<tr><td><code id="partial_dependence_+3A_label">label</code></td>
<td>
<p>name of the model. By default it's extracted from the <code>class</code> attribute of the model</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Find more details in the <a href="https://ema.drwhy.ai/partialDependenceProfiles.html">Partial Dependence Profiles Chapter</a>.
</p>


<h3>Value</h3>

<p>an object of the class <code>aggregated_profiles_explainer</code>
</p>


<h3>References</h3>

<p>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")

model_titanic_glm &lt;- glm(survived ~ gender + age + fare,
                         data = titanic_imputed, family = "binomial")

explain_titanic_glm &lt;- explain(model_titanic_glm,
                               data = titanic_imputed[,-8],
                               y = titanic_imputed[,8],
                               verbose = FALSE)

pdp_glm &lt;- partial_dependence(explain_titanic_glm,
                              N = 25, variables = c("age", "fare"))
head(pdp_glm)
plot(pdp_glm)


library("ranger")

model_titanic_rf &lt;- ranger(survived ~., data = titanic_imputed, probability = TRUE)

explain_titanic_rf &lt;- explain(model_titanic_rf,
                              data = titanic_imputed[,-8],
                              y = titanic_imputed[,8],
                              label = "ranger forest",
                              verbose = FALSE)

pdp_rf &lt;- partial_dependence(explain_titanic_rf, variable_type = "numerical")
plot(pdp_rf)

pdp_rf &lt;- partial_dependence(explain_titanic_rf, variable_type = "categorical")
plotD3(pdp_rf, label_margin = 80, scale_plot = TRUE)


</code></pre>

<hr>
<h2 id='plot.aggregated_profiles_explainer'>Plots Aggregated Profiles</h2><span id='topic+plot.aggregated_profiles_explainer'></span>

<h3>Description</h3>

<p>Function <code>plot.aggregated_profiles_explainer</code> plots partial dependence plot or accumulated effect plot.
It works in a similar way to <code>plot.ceteris_paribus</code>, but instead of individual profiles
show average profiles for each variable listed in the <code>variables</code> vector.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'aggregated_profiles_explainer'
plot(
  x,
  ...,
  size = 1,
  alpha = 1,
  color = "_label_",
  facet_ncol = NULL,
  facet_scales = "free_x",
  variables = NULL,
  title = NULL,
  subtitle = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.aggregated_profiles_explainer_+3A_x">x</code></td>
<td>
<p>a ceteris paribus explainer produced with function <code>aggregate_profiles()</code></p>
</td></tr>
<tr><td><code id="plot.aggregated_profiles_explainer_+3A_...">...</code></td>
<td>
<p>other explainers that shall be plotted together</p>
</td></tr>
<tr><td><code id="plot.aggregated_profiles_explainer_+3A_size">size</code></td>
<td>
<p>a numeric. Size of lines to be plotted</p>
</td></tr>
<tr><td><code id="plot.aggregated_profiles_explainer_+3A_alpha">alpha</code></td>
<td>
<p>a numeric between <code>0</code> and <code>1</code>. Opacity of lines</p>
</td></tr>
<tr><td><code id="plot.aggregated_profiles_explainer_+3A_color">color</code></td>
<td>
<p>a character. Either name of a color, or hex code for a color, or <code>_label_</code> if models shall be colored, or <code>_ids_</code> if instances shall be colored</p>
</td></tr>
<tr><td><code id="plot.aggregated_profiles_explainer_+3A_facet_ncol">facet_ncol</code></td>
<td>
<p>number of columns for the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code></p>
</td></tr>
<tr><td><code id="plot.aggregated_profiles_explainer_+3A_facet_scales">facet_scales</code></td>
<td>
<p>a character value for the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code>. Default is <code>"free_x"</code>.</p>
</td></tr>
<tr><td><code id="plot.aggregated_profiles_explainer_+3A_variables">variables</code></td>
<td>
<p>if not <code>NULL</code> then only <code>variables</code> will be presented</p>
</td></tr>
<tr><td><code id="plot.aggregated_profiles_explainer_+3A_title">title</code></td>
<td>
<p>a character. Partial and accumulated dependence explainers have deafult value.</p>
</td></tr>
<tr><td><code id="plot.aggregated_profiles_explainer_+3A_subtitle">subtitle</code></td>
<td>
<p>a character. If <code>NULL</code> value will be dependent on model usage.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>ggplot2</code> object
</p>


<h3>References</h3>

<p>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")
library("ingredients")

model_titanic_glm &lt;- glm(survived ~ gender + age + fare,
                         data = titanic_imputed, family = "binomial")

explain_titanic_glm &lt;- explain(model_titanic_glm,
                               data = titanic_imputed[,-8],
                               y = titanic_imputed[,8],
                               verbose = FALSE)

pdp_rf_p &lt;- partial_dependence(explain_titanic_glm, N = 50)
pdp_rf_p$`_label_` &lt;- "RF_partial"
pdp_rf_l &lt;- conditional_dependence(explain_titanic_glm, N = 50)
pdp_rf_l$`_label_` &lt;- "RF_local"
pdp_rf_a&lt;- accumulated_dependence(explain_titanic_glm, N = 50)
pdp_rf_a$`_label_` &lt;- "RF_accumulated"
head(pdp_rf_p)
plot(pdp_rf_p, pdp_rf_l, pdp_rf_a, color = "_label_")


library("ranger")

model_titanic_rf &lt;- ranger(survived ~., data = titanic_imputed, probability = TRUE)

explain_titanic_rf &lt;- explain(model_titanic_rf,
                              data = titanic_imputed[,-8],
                              y = titanic_imputed[,8],
                              label = "ranger forest",
                              verbose = FALSE)

selected_passangers &lt;- select_sample(titanic_imputed, n = 100)
cp_rf &lt;- ceteris_paribus(explain_titanic_rf, selected_passangers)
cp_rf

pdp_rf_p &lt;- aggregate_profiles(cp_rf, variables = "age", type = "partial")
pdp_rf_p$`_label_` &lt;- "RF_partial"
pdp_rf_c &lt;- aggregate_profiles(cp_rf, variables = "age", type = "conditional")
pdp_rf_c$`_label_` &lt;- "RF_conditional"
pdp_rf_a &lt;- aggregate_profiles(cp_rf, variables = "age", type = "accumulated")
pdp_rf_a$`_label_` &lt;- "RF_accumulated"

head(pdp_rf_p)
plot(pdp_rf_p)
plot(pdp_rf_p, pdp_rf_c, pdp_rf_a)

plot(cp_rf, variables = "age") +
  show_observations(cp_rf, variables = "age") +
  show_rugs(cp_rf, variables = "age", color = "red") +
  show_aggregated_profiles(pdp_rf_p, size = 2)



</code></pre>

<hr>
<h2 id='plot.ceteris_paribus_2d_explainer'>Plot Ceteris Paribus 2D Explanations</h2><span id='topic+plot.ceteris_paribus_2d_explainer'></span>

<h3>Description</h3>

<p>This function plots What-If Plots for a single prediction / observation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ceteris_paribus_2d_explainer'
plot(
  x,
  ...,
  facet_ncol = NULL,
  add_raster = TRUE,
  add_contour = TRUE,
  bins = 3,
  add_observation = TRUE,
  pch = "+",
  size = 6
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.ceteris_paribus_2d_explainer_+3A_x">x</code></td>
<td>
<p>a ceteris paribus explainer produced with the <code>ceteris_paribus_2d()</code> function</p>
</td></tr>
<tr><td><code id="plot.ceteris_paribus_2d_explainer_+3A_...">...</code></td>
<td>
<p>currently will be ignored</p>
</td></tr>
<tr><td><code id="plot.ceteris_paribus_2d_explainer_+3A_facet_ncol">facet_ncol</code></td>
<td>
<p>number of columns for the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code></p>
</td></tr>
<tr><td><code id="plot.ceteris_paribus_2d_explainer_+3A_add_raster">add_raster</code></td>
<td>
<p>if <code>TRUE</code> then <code>geom_raster</code> will be added to present levels with diverging colors</p>
</td></tr>
<tr><td><code id="plot.ceteris_paribus_2d_explainer_+3A_add_contour">add_contour</code></td>
<td>
<p>if <code>TRUE</code> then <code>geom_contour</code> will be added to present contours</p>
</td></tr>
<tr><td><code id="plot.ceteris_paribus_2d_explainer_+3A_bins">bins</code></td>
<td>
<p>number of contours to be added</p>
</td></tr>
<tr><td><code id="plot.ceteris_paribus_2d_explainer_+3A_add_observation">add_observation</code></td>
<td>
<p>if <code>TRUE</code> then <code>geom_point</code> will be added to present observation that is explained</p>
</td></tr>
<tr><td><code id="plot.ceteris_paribus_2d_explainer_+3A_pch">pch</code></td>
<td>
<p>character, symbol used to plot observations</p>
</td></tr>
<tr><td><code id="plot.ceteris_paribus_2d_explainer_+3A_size">size</code></td>
<td>
<p>numeric, size of individual datapoints</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>ggplot2</code> object
</p>


<h3>References</h3>

<p>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")
library("ingredients")
library("ranger")


apartments_rf_model &lt;- ranger(m2.price ~., data = apartments)

explainer_rf &lt;- explain(apartments_rf_model,
                        data = apartments_test[,-1],
                        y = apartments_test[,1],
                        verbose = FALSE)

new_apartment &lt;- apartments_test[1,]
new_apartment

wi_rf_2d &lt;- ceteris_paribus_2d(explainer_rf, observation = new_apartment)
head(wi_rf_2d)

plot(wi_rf_2d)
plot(wi_rf_2d, add_contour = FALSE)
plot(wi_rf_2d, add_observation = FALSE)
plot(wi_rf_2d, add_raster = FALSE)

# HR data
model &lt;- ranger(status ~ gender + age + hours + evaluation + salary, data = HR,
                probability = TRUE)

pred1 &lt;- function(m, x)   predict(m, x)$predictions[,1]

explainer_rf_fired &lt;- explain(model,
                              data = HR[,1:5],
                              y = as.numeric(HR$status == "fired"),
                              predict_function = pred1,
                              label = "fired")
new_emp &lt;- HR[1,]
new_emp

wi_rf_2d &lt;- ceteris_paribus_2d(explainer_rf_fired, observation = new_emp)
head(wi_rf_2d)

plot(wi_rf_2d)


</code></pre>

<hr>
<h2 id='plot.ceteris_paribus_explainer'>Plots Ceteris Paribus Profiles</h2><span id='topic+plot.ceteris_paribus_explainer'></span>

<h3>Description</h3>

<p>Function <code>plot.ceteris_paribus_explainer</code> plots Individual Variable Profiles for selected observations.
Various parameters help to decide what should be plotted, profiles, aggregated profiles, points or rugs.
</p>
<p>Find more details in <a href="https://ema.drwhy.ai/ceterisParibus.html">Ceteris Paribus Chapter</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ceteris_paribus_explainer'
plot(
  x,
  ...,
  size = 1,
  alpha = 1,
  color = "#46bac2",
  variable_type = "numerical",
  facet_ncol = NULL,
  facet_scales = NULL,
  variables = NULL,
  title = "Ceteris Paribus profile",
  subtitle = NULL,
  categorical_type = "profiles"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.ceteris_paribus_explainer_+3A_x">x</code></td>
<td>
<p>a ceteris paribus explainer produced with function <code>ceteris_paribus()</code></p>
</td></tr>
<tr><td><code id="plot.ceteris_paribus_explainer_+3A_...">...</code></td>
<td>
<p>other explainers that shall be plotted together</p>
</td></tr>
<tr><td><code id="plot.ceteris_paribus_explainer_+3A_size">size</code></td>
<td>
<p>a numeric. Size of lines to be plotted</p>
</td></tr>
<tr><td><code id="plot.ceteris_paribus_explainer_+3A_alpha">alpha</code></td>
<td>
<p>a numeric between <code>0</code> and <code>1</code>. Opacity of lines</p>
</td></tr>
<tr><td><code id="plot.ceteris_paribus_explainer_+3A_color">color</code></td>
<td>
<p>a character. Either name of a color or name of a variable that should be used for coloring</p>
</td></tr>
<tr><td><code id="plot.ceteris_paribus_explainer_+3A_variable_type">variable_type</code></td>
<td>
<p>a character. If <code>numerical</code> then only numerical variables will be plotted.
If <code>categorical</code> then only categorical variables will be plotted.</p>
</td></tr>
<tr><td><code id="plot.ceteris_paribus_explainer_+3A_facet_ncol">facet_ncol</code></td>
<td>
<p>number of columns for the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code></p>
</td></tr>
<tr><td><code id="plot.ceteris_paribus_explainer_+3A_facet_scales">facet_scales</code></td>
<td>
<p>a character value for the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code>.
Default is <code>"free_x"</code>, but <code>"free_y"</code> if <code>categorical_type="bars"</code>.</p>
</td></tr>
<tr><td><code id="plot.ceteris_paribus_explainer_+3A_variables">variables</code></td>
<td>
<p>if not <code>NULL</code> then only <code>variables</code> will be presented</p>
</td></tr>
<tr><td><code id="plot.ceteris_paribus_explainer_+3A_title">title</code></td>
<td>
<p>a character. Plot title. By default &quot;Ceteris Paribus profile&quot;.</p>
</td></tr>
<tr><td><code id="plot.ceteris_paribus_explainer_+3A_subtitle">subtitle</code></td>
<td>
<p>a character. Plot subtitle. By default <code>NULL</code> - then subtitle is set to &quot;created for the XXX, YYY model&quot;,
where XXX, YYY are labels of given explainers.</p>
</td></tr>
<tr><td><code id="plot.ceteris_paribus_explainer_+3A_categorical_type">categorical_type</code></td>
<td>
<p>a character. How categorical variables shall be plotted? Either <code>"profiles"</code> (default) or <code>"bars"</code> or <code>"lines"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>ggplot2</code> object
</p>


<h3>References</h3>

<p>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")

model_titanic_glm &lt;- glm(survived ~ gender + age + fare,
                         data = titanic_imputed, family = "binomial")

explain_titanic_glm &lt;- explain(model_titanic_glm,
                               data = titanic_imputed[,-8],
                               y = titanic_imputed[,8],
                               verbose = FALSE)

cp_glm &lt;- ceteris_paribus(explain_titanic_glm, titanic_imputed[1,])
cp_glm

plot(cp_glm, variables = "age")


library("ranger")
model_titanic_rf &lt;- ranger(survived ~., data = titanic_imputed, probability = TRUE)

explain_titanic_rf &lt;- explain(model_titanic_rf,
                              data = titanic_imputed[,-8],
                              y = titanic_imputed[,8],
                              label = "ranger forest",
                              verbose = FALSE)

selected_passangers &lt;- select_sample(titanic_imputed, n = 100)

cp_rf &lt;- ceteris_paribus(explain_titanic_rf, selected_passangers)
cp_rf

plot(cp_rf, variables = "age") +
  show_observations(cp_rf, variables = "age") +
  show_rugs(cp_rf, variables = "age", color = "red")

selected_passangers &lt;- select_sample(titanic_imputed, n = 1)
selected_passangers

cp_rf &lt;- ceteris_paribus(explain_titanic_rf, selected_passangers)

plot(cp_rf) +
  show_observations(cp_rf)

plot(cp_rf, variables = "age") +
  show_observations(cp_rf, variables = "age")

plot(cp_rf, variables = "class")
plot(cp_rf, variables = c("class", "embarked"), facet_ncol = 1)
plot(cp_rf, variables = c("class", "embarked"), facet_ncol = 1, categorical_type = "bars")
plotD3(cp_rf, variables = c("class", "embarked", "gender"),
              variable_type = "categorical", scale_plot = TRUE,
              label_margin = 70)


</code></pre>

<hr>
<h2 id='plot.ceteris_paribus_oscillations'>Plot Ceteris Paribus Oscillations</h2><span id='topic+plot.ceteris_paribus_oscillations'></span>

<h3>Description</h3>

<p>This function plots local variable importance plots
calculated as oscillations in the Ceteris Paribus Profiles.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ceteris_paribus_oscillations'
plot(x, ..., bar_width = 10)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.ceteris_paribus_oscillations_+3A_x">x</code></td>
<td>
<p>a ceteris paribus oscillation explainer produced with function <code>calculate_oscillations()</code></p>
</td></tr>
<tr><td><code id="plot.ceteris_paribus_oscillations_+3A_...">...</code></td>
<td>
<p>other explainers that shall be plotted together</p>
</td></tr>
<tr><td><code id="plot.ceteris_paribus_oscillations_+3A_bar_width">bar_width</code></td>
<td>
<p>width of bars. By default <code>10</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>ggplot2</code> object
</p>


<h3>References</h3>

<p>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library("DALEX")
library("ranger")

apartments_rf_model &lt;- ranger(m2.price ~., data = apartments)

explainer_rf &lt;- explain(apartments_rf_model,
                        data = apartments_test[,-1],
                        y = apartments_test[,1],
                        label = "ranger forest",
                        verbose = FALSE)

apartment &lt;- apartments_test[1:2,]

cp_rf &lt;- ceteris_paribus(explainer_rf, apartment)
plot(cp_rf, color = "_ids_")

vips &lt;- calculate_oscillations(cp_rf)
vips

plot(vips)


</code></pre>

<hr>
<h2 id='plot.feature_importance_explainer'>Plots Feature Importance</h2><span id='topic+plot.feature_importance_explainer'></span>

<h3>Description</h3>

<p>This function plots variable importance calculated as changes in the loss function after variable drops.
It uses output from <code>feature_importance</code> function that corresponds to
permutation based measure of variable importance.
Variables are sorted in the same order in all panels.
The order depends on the average drop out loss.
In different panels variable contributions may not look like sorted if variable
importance is different in different in different models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'feature_importance_explainer'
plot(
  x,
  ...,
  max_vars = NULL,
  show_boxplots = TRUE,
  bar_width = 10,
  desc_sorting = TRUE,
  title = "Feature Importance",
  subtitle = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.feature_importance_explainer_+3A_x">x</code></td>
<td>
<p>a feature importance explainer produced with the <code>feature_importance()</code> function</p>
</td></tr>
<tr><td><code id="plot.feature_importance_explainer_+3A_...">...</code></td>
<td>
<p>other explainers that shall be plotted together</p>
</td></tr>
<tr><td><code id="plot.feature_importance_explainer_+3A_max_vars">max_vars</code></td>
<td>
<p>maximum number of variables that shall be presented for for each model.
By default <code>NULL</code> what means all variables</p>
</td></tr>
<tr><td><code id="plot.feature_importance_explainer_+3A_show_boxplots">show_boxplots</code></td>
<td>
<p>logical if <code>TRUE</code> (default) boxplot will be plotted to show permutation data.</p>
</td></tr>
<tr><td><code id="plot.feature_importance_explainer_+3A_bar_width">bar_width</code></td>
<td>
<p>width of bars. By default <code>10</code></p>
</td></tr>
<tr><td><code id="plot.feature_importance_explainer_+3A_desc_sorting">desc_sorting</code></td>
<td>
<p>logical. Should the bars be sorted descending? By default TRUE</p>
</td></tr>
<tr><td><code id="plot.feature_importance_explainer_+3A_title">title</code></td>
<td>
<p>the plot's title, by default <code>'Feature Importance'</code></p>
</td></tr>
<tr><td><code id="plot.feature_importance_explainer_+3A_subtitle">subtitle</code></td>
<td>
<p>the plot's subtitle. By default - <code>NULL</code>, which means
the subtitle will be 'created for the XXX model', where XXX is the label of explainer(s)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Find more details in the <a href="https://ema.drwhy.ai/featureImportance.html">Feature Importance Chapter</a>.
</p>


<h3>Value</h3>

<p>a <code>ggplot2</code> object
</p>


<h3>References</h3>

<p>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")
library("ingredients")

model_titanic_glm &lt;- glm(survived ~ gender + age + fare,
                         data = titanic_imputed, family = "binomial")

explain_titanic_glm &lt;- explain(model_titanic_glm,
                               data = titanic_imputed[,-8],
                               y = titanic_imputed[,8])

fi_rf &lt;- feature_importance(explain_titanic_glm, B = 1)
plot(fi_rf)


library("ranger")
model_titanic_rf &lt;- ranger(survived ~., data = titanic_imputed, probability = TRUE)

explain_titanic_rf &lt;- explain(model_titanic_rf,
                              data = titanic_imputed[,-8],
                              y = titanic_imputed[,8],
                              label = "ranger forest",
                              verbose = FALSE)

fi_rf &lt;- feature_importance(explain_titanic_rf)
plot(fi_rf)

HR_rf_model &lt;- ranger(status~., data = HR, probability = TRUE)

explainer_rf  &lt;- explain(HR_rf_model, data = HR, y = HR$status,
                         verbose = FALSE, precalculate = FALSE)

fi_rf &lt;- feature_importance(explainer_rf, type = "raw", max_vars = 3,
                            loss_function = DALEX::loss_cross_entropy)
head(fi_rf)
plot(fi_rf)

HR_glm_model &lt;- glm(status == "fired"~., data = HR, family = "binomial")
explainer_glm &lt;- explain(HR_glm_model, data = HR, y = as.numeric(HR$status == "fired"))

fi_glm &lt;- feature_importance(explainer_glm, type = "raw",
                             loss_function = DALEX::loss_root_mean_square)
head(fi_glm)
plot(fi_glm)


</code></pre>

<hr>
<h2 id='plotD3'>Plots Ceteris Paribus Profiles in D3 with r2d3 Package.</h2><span id='topic+plotD3'></span><span id='topic+plotD3.ceteris_paribus_explainer'></span>

<h3>Description</h3>

<p>Function <code><a href="#topic+plotD3.ceteris_paribus_explainer">plotD3.ceteris_paribus_explainer</a></code> plots Individual Variable Profiles for selected observations.
It uses output from <code><a href="#topic+ceteris_paribus">ceteris_paribus</a></code> function.
Various parameters help to decide what should be plotted, profiles, aggregated profiles, points or rugs.
</p>
<p>Find more details in <a href="https://ema.drwhy.ai/ceterisParibus.html">Ceteris Paribus Chapter</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotD3(x, ...)

## S3 method for class 'ceteris_paribus_explainer'
plotD3(
  x,
  ...,
  size = 2,
  alpha = 1,
  color = "#46bac2",
  variable_type = "numerical",
  facet_ncol = 2,
  scale_plot = FALSE,
  variables = NULL,
  chart_title = "Ceteris Paribus Profiles",
  label_margin = 60,
  show_observations = TRUE,
  show_rugs = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plotD3_+3A_x">x</code></td>
<td>
<p>a ceteris paribus explainer produced with function <code>ceteris_paribus()</code></p>
</td></tr>
<tr><td><code id="plotD3_+3A_...">...</code></td>
<td>
<p>other explainers that shall be plotted together</p>
</td></tr>
<tr><td><code id="plotD3_+3A_size">size</code></td>
<td>
<p>a numeric. Set width of lines</p>
</td></tr>
<tr><td><code id="plotD3_+3A_alpha">alpha</code></td>
<td>
<p>a numeric between <code>0</code> and <code>1</code>. Opacity of lines</p>
</td></tr>
<tr><td><code id="plotD3_+3A_color">color</code></td>
<td>
<p>a character.  Set line color</p>
</td></tr>
<tr><td><code id="plotD3_+3A_variable_type">variable_type</code></td>
<td>
<p>a character. If &quot;numerical&quot; then only numerical variables will be plotted.
If &quot;categorical&quot; then only categorical variables will be plotted.</p>
</td></tr>
<tr><td><code id="plotD3_+3A_facet_ncol">facet_ncol</code></td>
<td>
<p>number of columns for the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code></p>
</td></tr>
<tr><td><code id="plotD3_+3A_scale_plot">scale_plot</code></td>
<td>
<p>a logical. If <code>TRUE</code>, the height of plot scales with window size. By default it's <code>FALSE</code></p>
</td></tr>
<tr><td><code id="plotD3_+3A_variables">variables</code></td>
<td>
<p>if not <code>NULL</code> then only <code>variables</code> will be presented</p>
</td></tr>
<tr><td><code id="plotD3_+3A_chart_title">chart_title</code></td>
<td>
<p>a character. Set custom title</p>
</td></tr>
<tr><td><code id="plotD3_+3A_label_margin">label_margin</code></td>
<td>
<p>a numeric. Set width of label margins in <code>categorical</code> type</p>
</td></tr>
<tr><td><code id="plotD3_+3A_show_observations">show_observations</code></td>
<td>
<p>a logical. Adds observations layer to a plot. By default it's <code>TRUE</code></p>
</td></tr>
<tr><td><code id="plotD3_+3A_show_rugs">show_rugs</code></td>
<td>
<p>a logical. Adds rugs layer to a plot. By default it's <code>TRUE</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>r2d3</code> object.
</p>


<h3>References</h3>

<p>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")
library("ingredients")
library("ranger")


model_titanic_rf &lt;- ranger(survived ~., data = titanic_imputed, probability = TRUE)

explain_titanic_rf &lt;- explain(model_titanic_rf,
                              data = titanic_imputed[,-8],
                              y = titanic_imputed[,8],
                              label = "ranger forest",
                              verbose = FALSE)

selected_passangers &lt;- select_sample(titanic_imputed, n = 10)
cp_rf &lt;- ceteris_paribus(explain_titanic_rf, selected_passangers)

plotD3(cp_rf, variables = c("age","parch","fare","sibsp"),
     facet_ncol = 2, scale_plot = TRUE)

selected_passanger &lt;- select_sample(titanic_imputed, n = 1)
cp_rf &lt;- ceteris_paribus(explain_titanic_rf, selected_passanger)

plotD3(cp_rf, variables = c("class", "embarked", "gender", "sibsp"),
     facet_ncol = 2, variable_type = "categorical", label_margin = 100, scale_plot = TRUE)


</code></pre>

<hr>
<h2 id='plotD3.aggregated_profiles_explainer'>Plots Aggregated Ceteris Paribus Profiles in D3 with r2d3 Package.</h2><span id='topic+plotD3.aggregated_profiles_explainer'></span>

<h3>Description</h3>

<p>Function <code><a href="#topic+plotD3.aggregated_profiles_explainer">plotD3.aggregated_profiles_explainer</a></code> plots an aggregate of ceteris paribus profiles.
It works in a similar way to <code><a href="#topic+plotD3.ceteris_paribus_explainer">plotD3.ceteris_paribus_explainer</a></code> but, instead of individual profiles,
show average profiles for each variable listed in the <code>variables</code> vector.
</p>
<p>Find more details in <a href="https://ema.drwhy.ai/ceterisParibus.html">Ceteris Paribus Chapter</a>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'aggregated_profiles_explainer'
plotD3(
  x,
  ...,
  size = 2,
  alpha = 1,
  color = "#46bac2",
  facet_ncol = 2,
  scale_plot = FALSE,
  variables = NULL,
  chart_title = "Aggregated Profiles",
  label_margin = 60
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plotD3.aggregated_profiles_explainer_+3A_x">x</code></td>
<td>
<p>a aggregated profiles explainer produced with function <code>aggregate_profiles()</code></p>
</td></tr>
<tr><td><code id="plotD3.aggregated_profiles_explainer_+3A_...">...</code></td>
<td>
<p>other explainers that shall be plotted together</p>
</td></tr>
<tr><td><code id="plotD3.aggregated_profiles_explainer_+3A_size">size</code></td>
<td>
<p>a numeric. Set width of lines</p>
</td></tr>
<tr><td><code id="plotD3.aggregated_profiles_explainer_+3A_alpha">alpha</code></td>
<td>
<p>a numeric between <code>0</code> and <code>1</code>. Opacity of lines</p>
</td></tr>
<tr><td><code id="plotD3.aggregated_profiles_explainer_+3A_color">color</code></td>
<td>
<p>a character.  Set line/bar color</p>
</td></tr>
<tr><td><code id="plotD3.aggregated_profiles_explainer_+3A_facet_ncol">facet_ncol</code></td>
<td>
<p>number of columns for the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code></p>
</td></tr>
<tr><td><code id="plotD3.aggregated_profiles_explainer_+3A_scale_plot">scale_plot</code></td>
<td>
<p>a logical. If <code>TRUE</code>, the height of plot scales with window size. By default it's <code>FALSE</code></p>
</td></tr>
<tr><td><code id="plotD3.aggregated_profiles_explainer_+3A_variables">variables</code></td>
<td>
<p>if not <code>NULL</code> then only <code>variables</code> will be presented</p>
</td></tr>
<tr><td><code id="plotD3.aggregated_profiles_explainer_+3A_chart_title">chart_title</code></td>
<td>
<p>a character. Set custom title</p>
</td></tr>
<tr><td><code id="plotD3.aggregated_profiles_explainer_+3A_label_margin">label_margin</code></td>
<td>
<p>a numeric. Set width of label margins in <code>categorical</code> type</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>r2d3</code> object.
</p>


<h3>References</h3>

<p>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")
library("ingredients")
library("ranger")

# smaller data, quicker example
titanic_small &lt;- select_sample(titanic_imputed, n = 500, seed = 1313)


# build a model
model_titanic_rf &lt;- ranger(survived ~., data = titanic_small, probability = TRUE)

explain_titanic_rf &lt;- explain(model_titanic_rf,
                              data = titanic_small[,-8],
                              y = titanic_small[,8],
                              label = "ranger forest",
                              verbose = FALSE)

selected_passangers &lt;- select_sample(titanic_small, n = 100)
cp_rf &lt;- ceteris_paribus(explain_titanic_rf, selected_passangers)

pdp_rf_p &lt;- aggregate_profiles(cp_rf, type = "partial", variable_type = "numerical")
pdp_rf_p$`_label_` &lt;- "RF_partial"
pdp_rf_c &lt;- aggregate_profiles(cp_rf, type = "conditional", variable_type = "numerical")
pdp_rf_c$`_label_` &lt;- "RF_conditional"
pdp_rf_a &lt;- aggregate_profiles(cp_rf, type = "accumulated", variable_type = "numerical")
pdp_rf_a$`_label_` &lt;- "RF_accumulated"

plotD3(pdp_rf_p, pdp_rf_c, pdp_rf_a, scale_plot = TRUE)

pdp &lt;- aggregate_profiles(cp_rf, type = "partial", variable_type = "categorical")
pdp$`_label_` &lt;- "RF_partial"

plotD3(pdp, variables = c("gender","class"), label_margin = 70)


</code></pre>

<hr>
<h2 id='plotD3.feature_importance_explainer'>Plot Feature Importance Objects in D3 with r2d3 Package.</h2><span id='topic+plotD3.feature_importance_explainer'></span>

<h3>Description</h3>

<p>Function <code><a href="#topic+plotD3.feature_importance_explainer">plotD3.feature_importance_explainer</a></code> plots dropouts for variables used in the model.
It uses output from <code><a href="#topic+feature_importance">feature_importance</a></code> function that corresponds to permutation based measure of feature importance.
Variables are sorted in the same order in all panels. The order depends on the average drop out loss.
In different panels variable contributions may not look like sorted if variable importance is different in different models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'feature_importance_explainer'
plotD3(
  x,
  ...,
  max_vars = NULL,
  show_boxplots = TRUE,
  bar_width = 12,
  split = "model",
  scale_height = FALSE,
  margin = 0.15,
  chart_title = "Feature importance"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plotD3.feature_importance_explainer_+3A_x">x</code></td>
<td>
<p>a feature importance explainer produced with the <code>feature_importance()</code> function</p>
</td></tr>
<tr><td><code id="plotD3.feature_importance_explainer_+3A_...">...</code></td>
<td>
<p>other explainers that shall be plotted together</p>
</td></tr>
<tr><td><code id="plotD3.feature_importance_explainer_+3A_max_vars">max_vars</code></td>
<td>
<p>maximum number of variables that shall be presented for for each model.
By default <code>NULL</code> which means all variables</p>
</td></tr>
<tr><td><code id="plotD3.feature_importance_explainer_+3A_show_boxplots">show_boxplots</code></td>
<td>
<p>logical if <code>TRUE</code> (default) boxplot will be plotted to show permutation data.</p>
</td></tr>
<tr><td><code id="plotD3.feature_importance_explainer_+3A_bar_width">bar_width</code></td>
<td>
<p>width of bars in px. By default <code>12px</code></p>
</td></tr>
<tr><td><code id="plotD3.feature_importance_explainer_+3A_split">split</code></td>
<td>
<p>either &quot;model&quot; or &quot;feature&quot; determines the plot layout</p>
</td></tr>
<tr><td><code id="plotD3.feature_importance_explainer_+3A_scale_height">scale_height</code></td>
<td>
<p>a logical. If <code>TRUE</code>, the height of plot scales with window size. By default it's <code>FALSE</code></p>
</td></tr>
<tr><td><code id="plotD3.feature_importance_explainer_+3A_margin">margin</code></td>
<td>
<p>extend x axis domain range to adjust the plot.
Usually value between <code>0.1</code> and <code>0.3</code>, by default it's <code>0.15</code></p>
</td></tr>
<tr><td><code id="plotD3.feature_importance_explainer_+3A_chart_title">chart_title</code></td>
<td>
<p>a character. Set custom title</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>r2d3</code> object.
</p>


<h3>References</h3>

<p>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")
library("ingredients")

lm_model &lt;- lm(m2.price ~., data = apartments)
explainer_lm &lt;- explain(lm_model,
                        data = apartments[,-1],
                        y = apartments[,1],
                        verbose = FALSE)

fi_lm &lt;- feature_importance(explainer_lm,
      loss_function = DALEX::loss_root_mean_square, B = 1)

head(fi_lm)
plotD3(fi_lm)


library("ranger")

rf_model &lt;- ranger(m2.price~., data = apartments)

explainer_rf &lt;- explain(rf_model,
                        data = apartments[,-1],
                        y = apartments[,1],
                        label = "ranger forest",
                        verbose = FALSE)

fi_rf &lt;- feature_importance(explainer_rf, loss_function = DALEX::loss_root_mean_square)

head(fi_rf)
plotD3(fi_lm, fi_rf)

plotD3(fi_lm, fi_rf, split = "feature")

plotD3(fi_lm, fi_rf, max_vars = 3, bar_width = 16, scale_height = TRUE)
plotD3(fi_lm, fi_rf, max_vars = 3, bar_width = 16, split = "feature", scale_height = TRUE)
plotD3(fi_lm, margin = 0.2)


</code></pre>

<hr>
<h2 id='print.aggregated_profiles_explainer'>Prints Aggregated Profiles</h2><span id='topic+print.aggregated_profiles_explainer'></span>

<h3>Description</h3>

<p>Prints Aggregated Profiles
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'aggregated_profiles_explainer'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.aggregated_profiles_explainer_+3A_x">x</code></td>
<td>
<p>an individual variable profile explainer produced with the <code>aggregate_profiles()</code> function</p>
</td></tr>
<tr><td><code id="print.aggregated_profiles_explainer_+3A_...">...</code></td>
<td>
<p>other arguments that will be passed to <code>head()</code></p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")
library("ingredients")

model_titanic_glm &lt;- glm(survived ~ gender + age + fare,
                         data = titanic_imputed, family = "binomial")

explain_titanic_glm &lt;- explain(model_titanic_glm,
                               data = titanic_imputed[,-8],
                               y = titanic_imputed[,8])

selected_passangers &lt;- select_sample(titanic_imputed, n = 100)
cp_rf &lt;- ceteris_paribus(explain_titanic_glm, selected_passangers)

head(cp_rf)

pdp_rf &lt;- aggregate_profiles(cp_rf, variables = "age")
head(pdp_rf)


library("ranger")

model_titanic_rf &lt;- ranger(survived ~.,  data = titanic_imputed,
                           probability = TRUE)

explain_titanic_rf &lt;- explain(model_titanic_rf,
                              data = titanic_imputed[,-8],
                              y = titanic_imputed[,8],
                              label = "ranger forest",
                              verbose = FALSE)

cp_rf &lt;- ceteris_paribus(explain_titanic_rf, selected_passangers)
cp_rf

pdp_rf &lt;- aggregate_profiles(cp_rf, variables = "age")
head(pdp_rf)


</code></pre>

<hr>
<h2 id='print.ceteris_paribus_explainer'>Prints Individual Variable Explainer Summary</h2><span id='topic+print.ceteris_paribus_explainer'></span>

<h3>Description</h3>

<p>Prints Individual Variable Explainer Summary
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ceteris_paribus_explainer'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.ceteris_paribus_explainer_+3A_x">x</code></td>
<td>
<p>an individual variable profile explainer produced with the <code>ceteris_paribus()</code> function</p>
</td></tr>
<tr><td><code id="print.ceteris_paribus_explainer_+3A_...">...</code></td>
<td>
<p>other arguments that will be passed to <code>head()</code></p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")
library("ingredients")
titanic_small &lt;- select_sample(titanic_imputed, n = 500, seed = 1313)

# build a model
model_titanic_glm &lt;- glm(survived ~ gender + age + fare,
                         data = titanic_small,
                         family = "binomial")

explain_titanic_glm &lt;- explain(model_titanic_glm,
                               data = titanic_small[,-8],
                               y = titanic_small[,8])

cp_glm &lt;- ceteris_paribus(explain_titanic_glm, titanic_small[1,])
cp_glm


library("ranger")

apartments_rf_model &lt;- ranger(m2.price ~., data = apartments)

explainer_rf &lt;- explain(apartments_rf_model,
                        data = apartments_test[,-1],
                        y = apartments_test[,1],
                        label = "ranger forest",
                        verbose = FALSE)

apartments_small &lt;- select_sample(apartments_test, 10)

cp_rf &lt;- ceteris_paribus(explainer_rf, apartments_small)
cp_rf

</code></pre>

<hr>
<h2 id='print.feature_importance_explainer'>Print Generic for Feature Importance Object</h2><span id='topic+print.feature_importance_explainer'></span>

<h3>Description</h3>

<p>Print Generic for Feature Importance Object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'feature_importance_explainer'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.feature_importance_explainer_+3A_x">x</code></td>
<td>
<p>an explanation created with <code><a href="#topic+feature_importance">feature_importance</a></code></p>
</td></tr>
<tr><td><code id="print.feature_importance_explainer_+3A_...">...</code></td>
<td>
<p>other parameters.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a data frame.
</p>


<h3>References</h3>

<p>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")
library("ingredients")

model_titanic_glm &lt;- glm(survived ~ gender + age + fare,
                         data = titanic_imputed, family = "binomial")

explain_titanic_glm &lt;- explain(model_titanic_glm,
                               data = titanic_imputed[,-8],
                               y = titanic_imputed[,8],
                               verbose = FALSE)

fi_glm &lt;- feature_importance(explain_titanic_glm)

fi_glm


</code></pre>

<hr>
<h2 id='select_neighbours'>Select Subset of Rows Closest to a Specified Observation</h2><span id='topic+select_neighbours'></span>

<h3>Description</h3>

<p>Function <code><a href="#topic+select_neighbours">select_neighbours</a></code> selects subset of rows from data set.
This is useful if data is large and we need just a sample to calculate profiles.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>select_neighbours(
  observation,
  data,
  variables = NULL,
  distance = gower::gower_dist,
  n = 20,
  frac = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="select_neighbours_+3A_observation">observation</code></td>
<td>
<p>single observation</p>
</td></tr>
<tr><td><code id="select_neighbours_+3A_data">data</code></td>
<td>
<p>set of observations</p>
</td></tr>
<tr><td><code id="select_neighbours_+3A_variables">variables</code></td>
<td>
<p>names of variables that shall be used for calculation of distance.
By default these are all variables present in <code>data</code> and <code>observation</code></p>
</td></tr>
<tr><td><code id="select_neighbours_+3A_distance">distance</code></td>
<td>
<p>the distance function, by default the <code>gower_dist()</code> function.</p>
</td></tr>
<tr><td><code id="select_neighbours_+3A_n">n</code></td>
<td>
<p>number of neighbors to select</p>
</td></tr>
<tr><td><code id="select_neighbours_+3A_frac">frac</code></td>
<td>
<p>if <code>n</code> is not specified (NULL), then will be calculated as <code>frac</code> * number of rows in <code>data</code>.
Either <code>n</code> or <code>frac</code> need to be specified.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note that <code>select_neighbours()</code> function is S3 generic.
If you want to work on non standard data sources (like H2O ddf, external databases)
you should overload it.
</p>


<h3>Value</h3>

<p>a data frame with selected rows
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("ingredients")

new_apartment &lt;- DALEX::apartments[1,]
small_apartments &lt;- select_neighbours(new_apartment, DALEX::apartments_test, n = 10)

new_apartment
small_apartments

</code></pre>

<hr>
<h2 id='select_sample'>Select Subset of Rows</h2><span id='topic+select_sample'></span>

<h3>Description</h3>

<p>Function <code><a href="#topic+select_sample">select_sample</a></code> selects subset of rows from data set.
This is useful if data is large and we need just a sample to calculate profiles.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>select_sample(data, n = 100, seed = 1313)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="select_sample_+3A_data">data</code></td>
<td>
<p>set of observations. Profile will be calculated for every observation (every row)</p>
</td></tr>
<tr><td><code id="select_sample_+3A_n">n</code></td>
<td>
<p>number of observations to select.</p>
</td></tr>
<tr><td><code id="select_sample_+3A_seed">seed</code></td>
<td>
<p>seed for random number generator.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note that <code>select_subsample()</code> function is S3 generic.
If you want to work on non standard data sources (like H2O ddf, external databases)
you should overload it.
</p>


<h3>Value</h3>

<p>a data frame with selected rows
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("ingredients")

small_apartments &lt;- select_sample(DALEX::apartments_test)
head(small_apartments)

</code></pre>

<hr>
<h2 id='show_aggregated_profiles'>Adds a Layer with Aggregated Profiles</h2><span id='topic+show_aggregated_profiles'></span>

<h3>Description</h3>

<p>Function <code><a href="#topic+show_aggregated_profiles">show_aggregated_profiles</a></code> adds a layer to a plot created
with <code><a href="#topic+plot.ceteris_paribus_explainer">plot.ceteris_paribus_explainer</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>show_aggregated_profiles(
  x,
  ...,
  size = 0.5,
  alpha = 1,
  color = "#371ea3",
  variables = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="show_aggregated_profiles_+3A_x">x</code></td>
<td>
<p>a ceteris paribus explainer produced with function <code>ceteris_paribus()</code></p>
</td></tr>
<tr><td><code id="show_aggregated_profiles_+3A_...">...</code></td>
<td>
<p>other explainers that shall be plotted together</p>
</td></tr>
<tr><td><code id="show_aggregated_profiles_+3A_size">size</code></td>
<td>
<p>a numeric. Size of lines to be plotted</p>
</td></tr>
<tr><td><code id="show_aggregated_profiles_+3A_alpha">alpha</code></td>
<td>
<p>a numeric between <code>0</code> and <code>1</code>. Opacity of lines</p>
</td></tr>
<tr><td><code id="show_aggregated_profiles_+3A_color">color</code></td>
<td>
<p>a character. Either name of a color or name of a variable that should be used for coloring</p>
</td></tr>
<tr><td><code id="show_aggregated_profiles_+3A_variables">variables</code></td>
<td>
<p>if not <code>NULL</code> then only <code>variables</code> will be presented</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>ggplot2</code> layer
</p>


<h3>References</h3>

<p>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")
library("ingredients")

selected_passangers &lt;- select_sample(titanic_imputed, n = 100)

model_titanic_glm &lt;- glm(survived ~ gender + age + fare,
                         data = titanic_imputed, family = "binomial")

explain_titanic_glm &lt;- explain(model_titanic_glm,
                               data = titanic_imputed[,-8],
                               y = titanic_imputed[,8])

cp_rf &lt;- ceteris_paribus(explain_titanic_glm, selected_passangers)

pdp_rf &lt;- aggregate_profiles(cp_rf, type = "partial", variables = "age")

plot(cp_rf, variables = "age") +
  show_observations(cp_rf, variables = "age") +
  show_aggregated_profiles(pdp_rf, size = 3)


library("ranger")

model_titanic_rf &lt;- ranger(survived ~., data = titanic_imputed, probability = TRUE)

explain_titanic_rf &lt;- explain(model_titanic_rf,
                              data = titanic_imputed[,-8],
                              y = titanic_imputed[,8],
                              label = "ranger forest",
                              verbose = FALSE)

cp_rf &lt;- ceteris_paribus(explain_titanic_rf, selected_passangers)
cp_rf

pdp_rf &lt;- aggregate_profiles(cp_rf, type = "partial", variables = "age")
head(pdp_rf)

plot(cp_rf, variables = "age") +
  show_observations(cp_rf, variables = "age") +
  show_rugs(cp_rf, variables = "age", color = "red") +
  show_aggregated_profiles(pdp_rf, size = 3)


</code></pre>

<hr>
<h2 id='show_observations'>Adds a Layer with Observations to a Profile Plot</h2><span id='topic+show_observations'></span>

<h3>Description</h3>

<p>Function <code><a href="#topic+show_observations">show_observations</a></code> adds a layer to a plot created with
<code><a href="#topic+plot.ceteris_paribus_explainer">plot.ceteris_paribus_explainer</a></code> for selected observations.
Various parameters help to decide what should be plotted, profiles, aggregated profiles, points or rugs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>show_observations(
  x,
  ...,
  size = 2,
  alpha = 1,
  color = "#371ea3",
  variable_type = "numerical",
  variables = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="show_observations_+3A_x">x</code></td>
<td>
<p>a ceteris paribus explainer produced with function <code>ceteris_paribus()</code></p>
</td></tr>
<tr><td><code id="show_observations_+3A_...">...</code></td>
<td>
<p>other explainers that shall be plotted together</p>
</td></tr>
<tr><td><code id="show_observations_+3A_size">size</code></td>
<td>
<p>a numeric. Size of lines to be plotted</p>
</td></tr>
<tr><td><code id="show_observations_+3A_alpha">alpha</code></td>
<td>
<p>a numeric between <code>0</code> and <code>1</code>. Opacity of lines</p>
</td></tr>
<tr><td><code id="show_observations_+3A_color">color</code></td>
<td>
<p>a character. Either name of a color or name of a variable that should be used for coloring</p>
</td></tr>
<tr><td><code id="show_observations_+3A_variable_type">variable_type</code></td>
<td>
<p>a character. If <code>numerical</code> then only numerical variables will be plotted.
If <code>categorical</code> then only categorical variables will be plotted.</p>
</td></tr>
<tr><td><code id="show_observations_+3A_variables">variables</code></td>
<td>
<p>if not <code>NULL</code> then only <code>variables</code> will be presented</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>ggplot2</code> layer
</p>


<h3>References</h3>

<p>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")
library("ingredients")

library("ranger")

rf_model &lt;- ranger(survived ~., data = titanic_imputed, probability = TRUE)

explainer_rf &lt;- explain(rf_model,
                        data = titanic_imputed[,-8],
                        y = titanic_imputed[,8],
                        label = "ranger forest",
                        verbose = FALSE)

selected_passangers &lt;- select_sample(titanic_imputed, n = 100)
cp_rf &lt;- ceteris_paribus(explainer_rf, selected_passangers)
cp_rf

plot(cp_rf, variables = "age", color = "grey") +
show_observations(cp_rf, variables = "age", color = "black") +
  show_rugs(cp_rf, variables = "age", color = "red")


</code></pre>

<hr>
<h2 id='show_profiles'>Adds a Layer with Profiles</h2><span id='topic+show_profiles'></span>

<h3>Description</h3>

<p>Function <code><a href="#topic+show_profiles">show_profiles</a></code> adds a layer to a plot created with
<code><a href="#topic+plot.ceteris_paribus_explainer">plot.ceteris_paribus_explainer</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>show_profiles(
  x,
  ...,
  size = 0.5,
  alpha = 1,
  color = "#371ea3",
  variables = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="show_profiles_+3A_x">x</code></td>
<td>
<p>a ceteris paribus explainer produced with function <code>ceteris_paribus()</code></p>
</td></tr>
<tr><td><code id="show_profiles_+3A_...">...</code></td>
<td>
<p>other explainers that shall be plotted together</p>
</td></tr>
<tr><td><code id="show_profiles_+3A_size">size</code></td>
<td>
<p>a numeric. Size of lines to be plotted</p>
</td></tr>
<tr><td><code id="show_profiles_+3A_alpha">alpha</code></td>
<td>
<p>a numeric between <code>0</code> and <code>1</code>. Opacity of lines</p>
</td></tr>
<tr><td><code id="show_profiles_+3A_color">color</code></td>
<td>
<p>a character. Either name of a color or name of a variable that should be used for coloring</p>
</td></tr>
<tr><td><code id="show_profiles_+3A_variables">variables</code></td>
<td>
<p>if not <code>NULL</code> then only <code>variables</code> will be presented</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>ggplot2</code> layer
</p>


<h3>References</h3>

<p>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")
library("ingredients")

selected_passangers &lt;- select_sample(titanic_imputed, n = 100)
selected_john &lt;- titanic_imputed[1,]

model_titanic_glm &lt;- glm(survived ~ gender + age + fare,
                         data = titanic_imputed, family = "binomial")

explain_titanic_glm &lt;- explain(model_titanic_glm,
                               data = titanic_imputed[,-8],
                               y = titanic_imputed[,8],
                               label = "glm", verbose = FALSE)

cp_rf &lt;- ceteris_paribus(explain_titanic_glm, selected_passangers)
cp_rf_john &lt;- ceteris_paribus(explain_titanic_glm, selected_john)
plot(cp_rf, variables = "age") +
  show_profiles(cp_rf_john, variables = "age", size = 2)


library("ranger")

model_titanic_rf &lt;- ranger(survived ~.,  data = titanic_imputed, probability = TRUE)

explain_titanic_rf &lt;- explain(model_titanic_rf,
                              data = titanic_imputed[,-8],
                              y = titanic_imputed[,8],
                              label = "ranger forest",
                              verbose = FALSE)

cp_rf &lt;- ceteris_paribus(explain_titanic_rf, selected_passangers)
cp_rf_john &lt;- ceteris_paribus(explain_titanic_rf, selected_john)

cp_rf

pdp_rf &lt;- aggregate_profiles(cp_rf, variables = "age")
head(pdp_rf)

plot(cp_rf, variables = "age") +
  show_observations(cp_rf, variables = "age") +
  show_rugs(cp_rf, variables = "age", color = "red") +
  show_profiles(cp_rf_john, variables = "age", color = "red", size = 2)


</code></pre>

<hr>
<h2 id='show_residuals'>Adds a Layer with Residuals to a Profile Plot</h2><span id='topic+show_residuals'></span>

<h3>Description</h3>

<p>Function <code><a href="#topic+show_residuals">show_residuals</a></code> adds a layer to a plot created with
<code><a href="#topic+plot.ceteris_paribus_explainer">plot.ceteris_paribus_explainer</a></code> for selected observations.
Note that the <code>y</code> argument has to be specified in the <code><a href="#topic+ceteris_paribus">ceteris_paribus</a></code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>show_residuals(
  x,
  ...,
  size = 0.75,
  alpha = 1,
  color = c(`TRUE` = "#8bdcbe", `FALSE` = "#f05a71"),
  variables = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="show_residuals_+3A_x">x</code></td>
<td>
<p>a ceteris paribus explainer produced with function <code>ceteris_paribus()</code>.
Note that <code>y</code> parameter shall be supplied in this function.</p>
</td></tr>
<tr><td><code id="show_residuals_+3A_...">...</code></td>
<td>
<p>other explainers that shall be plotted together</p>
</td></tr>
<tr><td><code id="show_residuals_+3A_size">size</code></td>
<td>
<p>a numeric. Size of lines to be plotted</p>
</td></tr>
<tr><td><code id="show_residuals_+3A_alpha">alpha</code></td>
<td>
<p>a numeric between <code>0</code> and <code>1</code>. Opacity of lines</p>
</td></tr>
<tr><td><code id="show_residuals_+3A_color">color</code></td>
<td>
<p>a character. Either name of a color or name of a variable that should be used for coloring</p>
</td></tr>
<tr><td><code id="show_residuals_+3A_variables">variables</code></td>
<td>
<p>if not <code>NULL</code> then only <code>variables</code> will be presented</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>ggplot2</code> layer
</p>


<h3>References</h3>

<p>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")
library("ingredients")
library("ranger")

johny_d &lt;- data.frame(
  class = factor("1st", levels = c("1st", "2nd", "3rd", "deck crew", "engineering crew",
                                   "restaurant staff", "victualling crew")),
  gender = factor("male", levels = c("female", "male")),
  age = 8,
  sibsp = 0,
  parch = 0,
  fare = 72,
  embarked = factor("Southampton", levels = c("Belfast", "Cherbourg", "Queenstown", "Southampton"))
)


model_titanic_rf &lt;- ranger(survived ~., data = titanic_imputed, probability = TRUE)

explain_titanic_rf &lt;- explain(model_titanic_rf,
                              data = titanic_imputed[,-8],
                              y = titanic_imputed[,8],
                              label = "ranger forest",
                              verbose = FALSE)

johny_neighbours &lt;- select_neighbours(data = titanic_imputed,
                                      observation = johny_d,
                                      variables = c("age", "gender", "class",
                                                  "fare", "sibsp", "parch"),
                                      n = 10)

cp_neighbours &lt;- ceteris_paribus(explain_titanic_rf,
                                 johny_neighbours,
                                 y = johny_neighbours$survived == "yes",
                                 variable_splits = list(age = seq(0,70, length.out = 1000)))

plot(cp_neighbours, variables = "age") +
  show_observations(cp_neighbours, variables = "age")


cp_johny &lt;- ceteris_paribus(explain_titanic_rf, johny_d,
                            variable_splits = list(age = seq(0,70, length.out = 1000)))

plot(cp_johny, variables = "age", size = 1.5, color = "#8bdcbe") +
  show_profiles(cp_neighbours, variables = "age", color = "#ceced9") +
  show_observations(cp_johny, variables = "age", size = 5, color = "#371ea3") +
  show_residuals(cp_neighbours, variables = "age")


</code></pre>

<hr>
<h2 id='show_rugs'>Adds a Layer with Rugs to a Profile Plot</h2><span id='topic+show_rugs'></span>

<h3>Description</h3>

<p>Function <code><a href="#topic+show_rugs">show_rugs</a></code> adds a layer to a plot created with
<code><a href="#topic+plot.ceteris_paribus_explainer">plot.ceteris_paribus_explainer</a></code> for selected observations.
Various parameters help to decide what should be plotted, profiles, aggregated profiles, points or rugs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>show_rugs(
  x,
  ...,
  size = 0.5,
  alpha = 1,
  color = "#371ea3",
  variable_type = "numerical",
  sides = "b",
  variables = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="show_rugs_+3A_x">x</code></td>
<td>
<p>a ceteris paribus explainer produced with function <code>ceteris_paribus()</code></p>
</td></tr>
<tr><td><code id="show_rugs_+3A_...">...</code></td>
<td>
<p>other explainers that shall be plotted together</p>
</td></tr>
<tr><td><code id="show_rugs_+3A_size">size</code></td>
<td>
<p>a numeric. Size of lines to be plotted</p>
</td></tr>
<tr><td><code id="show_rugs_+3A_alpha">alpha</code></td>
<td>
<p>a numeric between <code>0</code> and <code>1</code>. Opacity of lines</p>
</td></tr>
<tr><td><code id="show_rugs_+3A_color">color</code></td>
<td>
<p>a character. Either name of a color or name of a variable that should be used for coloring</p>
</td></tr>
<tr><td><code id="show_rugs_+3A_variable_type">variable_type</code></td>
<td>
<p>a character. If <code>numerical</code> then only numerical variables will be plotted.
If <code>categorical</code> then only categorical variables will be plotted.</p>
</td></tr>
<tr><td><code id="show_rugs_+3A_sides">sides</code></td>
<td>
<p>a string containing any of &quot;trbl&quot;, for top, right, bottom, and left. Passed to geom rug.</p>
</td></tr>
<tr><td><code id="show_rugs_+3A_variables">variables</code></td>
<td>
<p>if not <code>NULL</code> then only <code>variables</code> will be presented</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>ggplot2</code> layer
</p>


<h3>References</h3>

<p>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library("DALEX")
library("ingredients")
titanic_small &lt;- select_sample(titanic_imputed, n = 500, seed = 1313)

# build a model
model_titanic_glm &lt;- glm(survived ~ gender + age + fare,
                         data = titanic_small,
                         family = "binomial")

explain_titanic_glm &lt;- explain(model_titanic_glm,
                               data = titanic_small[,-8],
                               y = titanic_small[,8])

cp_glm &lt;- ceteris_paribus(explain_titanic_glm, titanic_small[1,])
cp_glm


library("ranger")

rf_model &lt;- ranger(survived ~., data = titanic_imputed, probability = TRUE)

explainer_rf &lt;- explain(rf_model,
                        data = titanic_imputed[,-8],
                        y = titanic_imputed[,8],
                        label = "ranger forest",
                        verbose = FALSE)

selected_passangers &lt;- select_sample(titanic_imputed, n = 100)
cp_rf &lt;- ceteris_paribus(explainer_rf, selected_passangers)
cp_rf

plot(cp_rf, variables = "age", color = "grey") +
show_observations(cp_rf, variables = "age", color = "black") +
  show_rugs(cp_rf, variables = "age", color = "red")

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
