<!DOCTYPE html><html lang="en-US"><head><title>Help for package SANvi</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {SANvi}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#SANvi-package'><p>SANvi: Fitting Shared Atoms Nested Models via Variational Bayes</p></a></li>
<li><a href='#estimate_atoms_weights_vi'><p>Estimate the Posterior Atoms and Weights of the Discrete Mixing Distributions</p></a></li>
<li><a href='#estimate_clustering_vi'><p>Estimate Posterior Clustering Assignments</p></a></li>
<li><a href='#extract_best'><p>Extract the best run from multiple trials</p></a></li>
<li><a href='#plot.SANvb'><p>Plotting the variational inference output</p></a></li>
<li><a href='#print.SANvb'><p>Print variational inference output</p></a></li>
<li><a href='#variational_CAM'><p>Mean Field Variational Bayes estimation of CAM</p></a></li>
<li><a href='#variational_fiSAN'><p>Mean Field Variational Bayes estimation of fiSAN</p></a></li>
<li><a href='#variational_fSAN'><p>Mean Field Variational Bayes estimation of fSAN</p></a></li>
<li><a href='#variational_multistart'><p>Perform variational inference using multiple starting points.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Fitting Shared Atoms Nested Models via Variational Bayes</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-05-14</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Francesco Denti &lt;francescodenti.personal@gmail.com&gt;</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/fradenti/SANvi">https://github.com/fradenti/SANvi</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/fradenti/SANvi/issues">https://github.com/fradenti/SANvi/issues</a></td>
</tr>
<tr>
<td>Description:</td>
<td>An efficient tool for fitting the nested common and shared atoms models using variational Bayes approximate inference for fast computation. Specifically, the package implements the common atoms model (Denti et al., 2023), its finite version (D'Angelo et al., 2023), and a hybrid finite-infinite model. 
            All models use Gaussian mixtures with a normal-inverse-gamma prior distribution on the parameters. Additional functions are provided to help analyze the results of the fitting procedure.  
            References:   
            Denti, Camerlenghi, Guindani, Mira (2023) &lt;<a href="https://doi.org/10.1080%2F01621459.2021.1933499">doi:10.1080/01621459.2021.1933499</a>&gt;,    
            D’Angelo, Canale, Yu, Guindani (2023) &lt;<a href="https://doi.org/10.1111%2Fbiom.13626">doi:10.1111/biom.13626</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>Imports:</td>
<td>Rcpp, matrixStats</td>
</tr>
<tr>
<td>Depends:</td>
<td>scales, RColorBrewer</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-05-15 11:11:38 UTC; francescodenti</td>
</tr>
<tr>
<td>Author:</td>
<td>Francesco Denti <a href="https://orcid.org/0000-0001-5034-7414"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre, cph],
  Laura D'Angelo <a href="https://orcid.org/0000-0003-2978-4702"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-05-15 11:40:06 UTC</td>
</tr>
</table>
<hr>
<h2 id='SANvi-package'>SANvi: Fitting Shared Atoms Nested Models via Variational Bayes</h2><span id='topic+SANvi'></span><span id='topic+SANvi-package'></span>

<h3>Description</h3>

<p>An efficient tool for fitting the nested common and shared atoms models using variational Bayes approximate inference for fast computation. Specifically, the package implements the common atoms model (Denti et al., 2023), its finite version (D'Angelo et al., 2023), and a hybrid finite-infinite model. All models use Gaussian mixtures with a normal-inverse-gamma prior distribution on the parameters. Additional functions are provided to help analyze the results of the fitting procedure. References: Denti, Camerlenghi, Guindani, Mira (2023) <a href="https://doi.org/10.1080/01621459.2021.1933499">doi:10.1080/01621459.2021.1933499</a>, D’Angelo, Canale, Yu, Guindani (2023) <a href="https://doi.org/10.1111/biom.13626">doi:10.1111/biom.13626</a>.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Francesco Denti <a href="mailto:francescodenti.personal@gmail.com">francescodenti.personal@gmail.com</a> (<a href="https://orcid.org/0000-0001-5034-7414">ORCID</a>) [copyright holder]
</p>
<p>Authors:
</p>

<ul>
<li><p> Laura D'Angelo <a href="mailto:laura.dangelo@live.com">laura.dangelo@live.com</a> (<a href="https://orcid.org/0000-0003-2978-4702">ORCID</a>)
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/fradenti/SANvi">https://github.com/fradenti/SANvi</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/fradenti/SANvi/issues">https://github.com/fradenti/SANvi/issues</a>
</p>
</li></ul>


<hr>
<h2 id='estimate_atoms_weights_vi'>Estimate the Posterior Atoms and Weights of the Discrete Mixing Distributions</h2><span id='topic+estimate_atoms_weights_vi'></span><span id='topic+plot.vi_atoms_weights'></span><span id='topic+print.vi_atoms_weights'></span>

<h3>Description</h3>

<p>This function estimates the posterior atoms and weights characterizing the discrete 
mixing distributions using the variational estimates obtained from one of the model implemented in SANvi.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_atoms_weights_vi(output)

## S3 method for class 'vi_atoms_weights'
plot(x, DC_num = NULL, lim = 2, ...)

## S3 method for class 'vi_atoms_weights'
print(x, thr = 0.01, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="estimate_atoms_weights_vi_+3A_output">output</code></td>
<td>
<p>an object of class <code>SANvb</code>, which is the output of one of the variational functions <code><a href="#topic+variational_CAM">variational_CAM</a></code>, 
<code><a href="#topic+variational_fiSAN">variational_fiSAN</a></code>, <code><a href="#topic+variational_fSAN">variational_fSAN</a></code>.</p>
</td></tr>
<tr><td><code id="estimate_atoms_weights_vi_+3A_x">x</code></td>
<td>
<p>an object of class <code>variational_estimates</code>, which can be 
obtained from the function <code><a href="#topic+estimate_atoms_weights_vi">estimate_atoms_weights_vi</a></code>.</p>
</td></tr>
<tr><td><code id="estimate_atoms_weights_vi_+3A_dc_num">DC_num</code></td>
<td>
<p>an integer or a vector of integers indicating which distributional clusters to plot.</p>
</td></tr>
<tr><td><code id="estimate_atoms_weights_vi_+3A_lim">lim</code></td>
<td>
<p>optional value for <code>plot</code> method to adjust the limits of the x-axis. The atoms are plotted on a range
given by <code>min(posterior means)-2, max(posterior means)+2</code>. Default is set to 2.</p>
</td></tr>
<tr><td><code id="estimate_atoms_weights_vi_+3A_...">...</code></td>
<td>
<p>ignored.</p>
</td></tr>
<tr><td><code id="estimate_atoms_weights_vi_+3A_thr">thr</code></td>
<td>
<p>argument for the <code>print()</code> method. It should be a small positive number, 
representing a threshold. If the posterior weight of a shared atom is below the threshold, the
atom is not reported.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an object of class <code>vi_atoms_weights</code>, which is matrix comprising posterior means, 
variances, and a columns for each estimated DC containing the posterior weights.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+variational_CAM">variational_CAM</a></code>, <code><a href="#topic+variational_fiSAN">variational_fiSAN</a></code>, 
<code><a href="#topic+variational_fSAN">variational_fSAN</a></code>, <code><a href="#topic+extract_best">extract_best</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Generate example data
set.seed(1232)
y &lt;- c(rnorm(100),rnorm(100,5))
g &lt;- rep(1:2,rep(100,2))

# Fitting fiSAN via variational inference
est &lt;- variational_fiSAN(y,g,verbose = FALSE)

# Estimate posterior atoms and weights
estimate_atoms_weights_vi(est)
</code></pre>

<hr>
<h2 id='estimate_clustering_vi'>Estimate Posterior Clustering Assignments</h2><span id='topic+estimate_clustering_vi'></span><span id='topic+plot.vi_clustering'></span><span id='topic+print.vi_clustering'></span>

<h3>Description</h3>

<p>This function estimates posterior clustering assignments based on posterior variational estimates
obtained from one of the model implemented in SANvi.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_clustering_vi(output, ordered = TRUE)

## S3 method for class 'vi_clustering'
plot(
  x,
  DC_num = NULL,
  type = c("ecdf", "boxplot", "scatter"),
  palette_brewed = FALSE,
  ...
)

## S3 method for class 'vi_clustering'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="estimate_clustering_vi_+3A_output">output</code></td>
<td>
<p>an object of class <code>SANvb</code>, the output of one of the variational functions <code><a href="#topic+variational_CAM">variational_CAM</a></code>, 
<code><a href="#topic+variational_fiSAN">variational_fiSAN</a></code>, <code><a href="#topic+variational_fSAN">variational_fSAN</a></code>.</p>
</td></tr>
<tr><td><code id="estimate_clustering_vi_+3A_ordered">ordered</code></td>
<td>
<p>logical, if <code>TRUE</code> (default), the function sorts the distributional cluster labels reflecting the 
increasing values of medians of the data assigned to each DC.</p>
</td></tr>
<tr><td><code id="estimate_clustering_vi_+3A_x">x</code></td>
<td>
<p>an object of class <code>variational_estimates</code>, which can be obtained from the
function <code><a href="#topic+estimate_atoms_weights_vi">estimate_atoms_weights_vi</a></code>.</p>
</td></tr>
<tr><td><code id="estimate_clustering_vi_+3A_dc_num">DC_num</code></td>
<td>
<p>an integer or a vector of integers indicating which distributional clusters to plot.</p>
</td></tr>
<tr><td><code id="estimate_clustering_vi_+3A_type">type</code></td>
<td>
<p>what type of plot should be drawn (only for the left-side plot). Possible types are &quot;boxplot&quot;, &quot;ecdf&quot;, and &quot;scatter&quot;.</p>
</td></tr>
<tr><td><code id="estimate_clustering_vi_+3A_palette_brewed">palette_brewed</code></td>
<td>
<p>(logical) the color palette to be used. Default is <code>R</code> base colors (<code>palette_brewed = FALSE</code>).</p>
</td></tr>
<tr><td><code id="estimate_clustering_vi_+3A_...">...</code></td>
<td>
<p>ignored.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list of class <code>clustering</code> containing 
</p>

<ul>
<li> <p><code>obs_level</code>: a data frame containing the data values, their group indexes, the observational and distributional clustering assignments for each observation.
</p>
</li>
<li> <p><code>dis_level</code>: a vector with the distributional clustering assignment for each unit.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+variational_CAM">variational_CAM</a></code>, <code><a href="#topic+variational_fiSAN">variational_fiSAN</a></code>, <code><a href="#topic+variational_fSAN">variational_fSAN</a></code>, <code><a href="#topic+extract_best">extract_best</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Generate example data
set.seed(123)
y &lt;- c(rnorm(100),rnorm(100,-5),rnorm(100,5),rnorm(100),
       rnorm(100),rnorm(100,-5),rnorm(100,5),rnorm(100))
g &lt;- rep(1:4,rep(200,4))

# Fitting fiSAN via variational inference
est &lt;- SANvi::variational_fiSAN(y,g,verbose = FALSE)

# Estimate clustering assignments
estimate_clustering_vi(est)

</code></pre>

<hr>
<h2 id='extract_best'>Extract the best run from multiple trials</h2><span id='topic+extract_best'></span>

<h3>Description</h3>

<p>A simple function to automatically extract the best run from a collection of fitted variational models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_best(object)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="extract_best_+3A_object">object</code></td>
<td>
<p>an object of class <code>multistart</code>, obtained from the <code>variational_multistart</code> function.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the single best run, an object of class <code>SANvb</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Generate example dataset
set.seed(123)
y &lt;- c(rnorm(100),rnorm(100,5))
g &lt;- rep(1:2,rep(100,2))

# Estimate multiple models via variational inference
est &lt;- variational_multistart(y, g, runs=5,
                              alpha_bar = 3, beta_bar = 3,
                              root=1234, warmstart = FALSE)

# Obtain best run
extract_best(est)

</code></pre>

<hr>
<h2 id='plot.SANvb'>Plotting the variational inference output</h2><span id='topic+plot.SANvb'></span>

<h3>Description</h3>

<p>Plot method for objects of class <code>SANvb</code>. 
The function displays two graphs, meant to analyze the estimated distributional and observational clusters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'SANvb'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.SANvb_+3A_x">x</code></td>
<td>
<p>object of class <code>SANvb</code> (the result of a call to <code><a href="#topic+variational_CAM">variational_CAM</a></code>, 
<code><a href="#topic+variational_fiSAN">variational_fiSAN</a></code>, <code><a href="#topic+variational_fSAN">variational_fSAN</a></code>.</p>
</td></tr>
<tr><td><code id="plot.SANvb_+3A_...">...</code></td>
<td>
<p>additional graphical parameters to be passed.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The function plots a summary of the fitted model.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+print.SANvb">print.SANvb</a></code>, <code><a href="#topic+variational_CAM">variational_CAM</a></code>, 
<code><a href="#topic+variational_fiSAN">variational_fiSAN</a></code>, <code><a href="#topic+variational_fSAN">variational_fSAN</a></code>.
</p>

<hr>
<h2 id='print.SANvb'>Print variational inference output</h2><span id='topic+print.SANvb'></span>

<h3>Description</h3>

<p>Print method for objects of class <code>SANvb</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'SANvb'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.SANvb_+3A_x">x</code></td>
<td>
<p>object of class <code>SANvb</code> (the result of a call to <code><a href="#topic+variational_CAM">variational_CAM</a></code>, 
<code><a href="#topic+variational_fiSAN">variational_fiSAN</a></code>, <code><a href="#topic+variational_fSAN">variational_fSAN</a></code>.</p>
</td></tr>
<tr><td><code id="print.SANvb_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The function prints a summary of the fitted model.
</p>

<hr>
<h2 id='variational_CAM'>Mean Field Variational Bayes estimation of CAM</h2><span id='topic+variational_CAM'></span>

<h3>Description</h3>

<p><code>variational_CAM</code> is used to perform posterior inference under the common atoms model (CAM) of Denti et al. (2023) with Gaussian likelihood. 
The model uses Dirichlet process mixtures (DPM) at both the observational and distributional levels.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>variational_CAM(y, group, maxL = 30, maxK = 20, 
                m0 = 0, tau0 = .01, lambda0 = 3, gamma0 = 2, 
                conc_hyperpar = c(1,1,1,1), conc_par = NULL, 
                epsilon = 1e-6, seed = NULL, maxSIM = 1e5, 
                warmstart = TRUE, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="variational_CAM_+3A_y">y</code></td>
<td>
<p>Numerical vector of observations (required).</p>
</td></tr>
<tr><td><code id="variational_CAM_+3A_group">group</code></td>
<td>
<p>Numerical vector of the same length of <code>y</code>, indicating the group membership (required).</p>
</td></tr>
<tr><td><code id="variational_CAM_+3A_maxl">maxL</code>, <code id="variational_CAM_+3A_maxk">maxK</code></td>
<td>
<p>integers, the upper bounds for the observational and distributional clusters to fit, respectively.</p>
</td></tr>
<tr><td><code id="variational_CAM_+3A_m0">m0</code>, <code id="variational_CAM_+3A_tau0">tau0</code>, <code id="variational_CAM_+3A_lambda0">lambda0</code>, <code id="variational_CAM_+3A_gamma0">gamma0</code></td>
<td>
<p>Hyperparameters on <code class="reqn">(\mu, \sigma^2) \sim NIG(m_0, \tau_0, \lambda_0,\gamma_0)</code>.</p>
</td></tr>
<tr><td><code id="variational_CAM_+3A_conc_hyperpar">conc_hyperpar</code>, <code id="variational_CAM_+3A_conc_par">conc_par</code></td>
<td>
<p>Vectors of values used for the concentration parameters of  of the stick-breaking representation for the distributional and observational DPs, respectively. 
The following two arguments can be passed. Specifically,
</p>

<dl>
<dt><code>conc_hyperpar</code></dt><dd><p>a vector with 4 positive entries: <code class="reqn">(s_1^\alpha,s_2^\alpha,s_1^\beta,s_2^\beta)</code>. 
If a random concentration parameters <code class="reqn">\alpha</code> and <code class="reqn">\beta</code> are adopted, the specifications are
<code class="reqn">\alpha \sim Gamma(s_1^\alpha,s_2^\alpha)</code> and <code class="reqn">\beta \sim Gamma(s_1^\beta,s_2^\beta)</code>. Default set to unitary vector.</p>
</dd>
<dt><code>conc_par</code></dt><dd><p>a vector with 2 positive entries: <code class="reqn">(\alpha,\beta)</code>. Default is set to <code>NULL</code>. If specified, the previous argument is ignored
and the two concentration parameters are assumed fixed and equal to <code>(alpha,beta)</code>.</p>
</dd>
</dl>
</td></tr>
<tr><td><code id="variational_CAM_+3A_epsilon">epsilon</code></td>
<td>
<p>the tolerance that drives the convergence criterion adopted as stopping rule</p>
</td></tr>
<tr><td><code id="variational_CAM_+3A_seed">seed</code></td>
<td>
<p>random seed to control the initialization.</p>
</td></tr>
<tr><td><code id="variational_CAM_+3A_maxsim">maxSIM</code></td>
<td>
<p>the maximum number of CAVI iteration to perform.</p>
</td></tr>
<tr><td><code id="variational_CAM_+3A_warmstart">warmstart</code></td>
<td>
<p>logical, if <code>TRUE</code>, the observational means of the cluster atoms are initialized with a k-means algorithm.</p>
</td></tr>
<tr><td><code id="variational_CAM_+3A_verbose">verbose</code></td>
<td>
<p>logical, if <code>TRUE</code> the iterations are printed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The common atoms mixture model is used to perform inference in nested settings, where the data are organized into <code class="reqn">J</code> groups.
The data should be continuous observations <code class="reqn">(Y_1,\dots,Y_J)</code>, where each <code class="reqn">Y_j = (y_{1,j},\dots,y_{n_j,j})</code>
contains the <code class="reqn">n_j</code> observations from group <code class="reqn">j</code>, for <code class="reqn">j=1,\dots,J</code>.
The function takes as input the data as a numeric vector <code>y</code> in this concatenated form. Hence <code>y</code> should be a vector of length
<code class="reqn">n_1+\dots+n_J</code>. The <code>group</code> parameter is a numeric vector of the same size as <code>y</code> indicating the group membership for each
individual observation.
Notice that with this specification the observations in the same group need not be contiguous as long as the correspondence between the variables
<code>y</code> and <code>group</code> is maintained.
</p>
<p><strong>Model</strong>
</p>
<p>The data are modeled using a Gaussian likelihood, where both the mean and the variance are observational-cluster-specific, i.e.,
</p>
<p style="text-align: center;"><code class="reqn">y_{i,j}\mid M_{i,j} = l \sim N(\mu_l,\sigma^2_l)</code>
</p>

<p>where <code class="reqn">M_{i,j} \in \{1,2,\dots\}</code> is the observational cluster indicator of observation <code class="reqn">i</code> in group <code class="reqn">j</code>.
The prior on the model parameters is a Normal-Inverse-Gamma distribution <code class="reqn">(\mu_l,\sigma^2_l)\sim NIG (m_0,\tau_0,\lambda_0,\gamma_0)</code>,
i.e., <code class="reqn">\mu_l\mid\sigma^2_l \sim N(m_0, \sigma^2_l / \tau_0)</code>, <code class="reqn">1/\sigma^2_l \sim Gamma(\lambda_0, \gamma_0)</code> (shape, rate).
</p>
<p><strong>Clustering</strong>
</p>
<p>The model performs a clustering of both observations and groups.
The clustering of groups (distributional clustering) is provided by the allocation variables <code class="reqn">S_j \in \{1,2,\dots\}</code>, with
</p>
<p style="text-align: center;"><code class="reqn">Pr(S_j = k \mid \dots ) = \pi_k  \qquad \text{for } \: k = 1,2,\dots</code>
</p>

<p>The distribution of the probabilities is <code class="reqn"> \{\pi_k\}_{k=1}^{\infty} \sim GEM(\alpha)</code>,
where GEM is the Griffiths-Engen-McCloskey distribution of parameter <code class="reqn">\alpha</code>,
which characterizes the stick-breaking construction of the DP (Sethuraman, 1994).
</p>
<p>The clustering of observations (observational clustering) is provided by the allocation variables <code class="reqn">M_{i,j} \in \{1,2,\dots\}</code>, with
</p>
<p style="text-align: center;"><code class="reqn"> Pr(M_{i,j} = l \mid S_j = k, \dots ) = \omega_{l,k} \qquad \text{for } \: k = 1,2,\dots \, ; \: l = 1,2,\dots </code>
</p>

<p>The distribution of the probabilities is <code class="reqn"> \{\omega_{l,k}\}_{l=1}^{\infty} \sim GEM(\beta)</code> for all <code class="reqn">k = 1,2,\dots</code>
</p>


<h3>Value</h3>

<p><code>variational_CAM</code> returns a list of class <code>SANvb</code> containing four objects:
</p>

<ul>
<li> <p><code>model</code>: name of the fitted model.
</p>
</li>
<li> <p><code>params</code>: list containing the data and the parameters used in the simulation. Details below.
</p>
</li>
<li> <p><code>sim</code>: list containing the simulated values (optimized variational parameters). Details below.
</p>
</li>
<li> <p><code>time</code>: total computation time.
</p>
</li></ul>

<p><strong>Data and parameters</strong>:
<code>params</code> is a list with the following components:
</p>

<dl>
<dt><code>y, group, Nj, J</code></dt><dd><p>Data, group labels, group frequencies, and number of groups.</p>
</dd>
<dt><code>K, L</code></dt><dd><p>Number of fitted distributional and observational clusters.</p>
</dd>
<dt><code>m0, tau0, lambda0, gamma0</code></dt><dd><p>Model hyperparameters.</p>
</dd>
<dt><code>epsilon, seed</code></dt><dd><p>The threshold controlling the convergence criterion and the random seed adopted to replicate the run.</p>
</dd>
<dt>(<code>hyp_alpha1,hyp_alpha2</code>) or <code>alpha</code></dt><dd><p>Hyperparameters on <code class="reqn">\alpha</code> (if <code class="reqn">\alpha</code> random);
or provided value for <code class="reqn">\alpha</code> (if fixed).</p>
</dd>
<dt>(<code>hyp_beta1,hyp_beta2</code>) or <code>beta</code></dt><dd><p>Hyperparameters on <code class="reqn">\beta</code> (if <code class="reqn">\beta</code> random);
or provided value for <code class="reqn">\beta</code> (if fixed).</p>
</dd>
</dl>

<p><strong>Simulated values</strong>:
<code>sim</code> is a list with the following components:
</p>

<dl>
<dt><code>theta_l</code></dt><dd><p>Matrix of size (L,4).
Each row is a posterior variational estimate of the four normal-inverse gamma hyperparameters.</p>
</dd>
<dt><code>Elbo_val</code></dt><dd><p>Vector containing the values of the ELBO.</p>
</dd>
<dt><code>XI</code></dt><dd><p>A list of length J. Each element is a matrix of size (N, L)
posterior variational probability of assignment of assignment of the i-th observation in the j-th group to the l-th OC, 
i.e., <code class="reqn">\hat{\xi}_{i,j,l} = \hat{\mathbb{Q}}(M_{i,j}=l)</code>.</p>
</dd>
<dt><code>RHO</code></dt><dd><p>Matrix of size (J, K).
Each row is a posterior variational probability of assignment of the j-th group to the k-th DC, i.e., <code class="reqn">\hat{\rho}_{j,k} = \hat{\mathbb{Q}}(S_j=k)</code>. </p>
</dd>
<dt><code>a_tilde_k,b_tilde_k</code></dt><dd><p>Vector of updated variational parameters of the Beta distributions governing the distributional stick-breaking process.</p>
</dd>
<dt><code>a_tilde_lk,b_tilde_lk</code></dt><dd><p>Matrix of updated variational parameters of the Beta distributions governing the observational stick-breaking 
process (arranged by column).</p>
</dd>
<dt><code>conc_hyper</code></dt><dd><p>If the concentration parameters are chosen to be random, these object contain a vector with the four updated hyperparameters.</p>
</dd>
<dt><code>alpha</code>,<code>beta</code></dt><dd><p>If the concentration parameters are chosen to be fixed, these objects contain the passed values.</p>
</dd>
</dl>



<h3>References</h3>

<p>Denti, F., Camerlenghi, F., Guindani, M., and Mira, A. (2023). A Common Atoms Model for the Bayesian Nonparametric Analysis of Nested Data. 
<em>Journal of the American Statistical Association</em>, 118(541), 405-416. DOI: 10.1080/01621459.2021.1933499
</p>
<p>Sethuraman, A.J. (1994). A Constructive Definition of Dirichlet Priors, <em>Statistica Sinica</em>, 4, 639–650.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
set.seed(123)
y &lt;- c(rnorm(100),rnorm(100,5))
g &lt;- rep(1:2,rep(100,2))
est &lt;- variational_CAM(y, g, verbose = FALSE,epsilon = 1e-2)

</code></pre>

<hr>
<h2 id='variational_fiSAN'>Mean Field Variational Bayes estimation of fiSAN</h2><span id='topic+variational_fiSAN'></span>

<h3>Description</h3>

<p><code>variational_fiSAN</code> is used to perform posterior inference under the finite-infinite shared atoms nested (fiSAN) model with Gaussian likelihood. 
The model uses a Dirichlet process mixture prior at the distributional level, and finite Dirichlet mixture at the observational one.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>variational_fiSAN(y, group,
                  maxL = 30, maxK = 20,
                  m0 = 0, tau0 = .01, lambda0 = 3, gamma0 = 2,
                  conc_hyperpar = c(1,1), conc_par = NULL,
                  beta_bar = .005,
                  epsilon = 1e-6, seed = NULL,
                  maxSIM = 1e5, warmstart = TRUE, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="variational_fiSAN_+3A_y">y</code></td>
<td>
<p>Numerical vector of observations (required).</p>
</td></tr>
<tr><td><code id="variational_fiSAN_+3A_group">group</code></td>
<td>
<p>Numerical vector of the same length of <code>y</code>, indicating the group membership (required).</p>
</td></tr>
<tr><td><code id="variational_fiSAN_+3A_maxl">maxL</code>, <code id="variational_fiSAN_+3A_maxk">maxK</code></td>
<td>
<p>integers, the upper bounds for the observational and distributional clusters to fit, respectively</p>
</td></tr>
<tr><td><code id="variational_fiSAN_+3A_m0">m0</code>, <code id="variational_fiSAN_+3A_tau0">tau0</code>, <code id="variational_fiSAN_+3A_lambda0">lambda0</code>, <code id="variational_fiSAN_+3A_gamma0">gamma0</code></td>
<td>
<p>Hyperparameters on <code class="reqn">(\mu, \sigma^2) \sim NIG(m_0, \tau_0, \lambda_0,\gamma_0)</code>.</p>
</td></tr>
<tr><td><code id="variational_fiSAN_+3A_conc_hyperpar">conc_hyperpar</code>, <code id="variational_fiSAN_+3A_conc_par">conc_par</code></td>
<td>
<p>Vectors of values used the concentration parameters of  of the stick-breaking representation for the distributional and observational DPs, respectively. 
The following two arguments can be passed. Specifically,
</p>

<dl>
<dt><code>conc_hyperpar</code></dt><dd><p>a vector with 2 positive entries: <code class="reqn">(s_1^\alpha,s_2^\alpha)</code>. 
If a random concentration parameter <code class="reqn">\alpha</code> is adopted, the specification is
<code class="reqn">\alpha \sim Gamma(s_1^\alpha,s_2^\alpha)</code>. Default set to unitary vector.</p>
</dd>
<dt><code>conc_par</code></dt><dd><p>a vector with one positive entry <code class="reqn">\alpha</code>. Default is set to <code>NULL</code>. If specified, the previous argument is ignored
and the two concentration parameters are assumed fixed and equal to <code>alpha</code>.</p>
</dd>
</dl>
</td></tr>
<tr><td><code id="variational_fiSAN_+3A_beta_bar">beta_bar</code></td>
<td>
<p>the hyperparameter of the symmetric observational Dirichlet distribution.</p>
</td></tr>
<tr><td><code id="variational_fiSAN_+3A_epsilon">epsilon</code></td>
<td>
<p>the tolerance that drives the convergence criterion adopted as stopping rule</p>
</td></tr>
<tr><td><code id="variational_fiSAN_+3A_seed">seed</code></td>
<td>
<p>random seed to control the initialization.</p>
</td></tr>
<tr><td><code id="variational_fiSAN_+3A_maxsim">maxSIM</code></td>
<td>
<p>the maximum number of CAVI iteration to perform.</p>
</td></tr>
<tr><td><code id="variational_fiSAN_+3A_warmstart">warmstart</code></td>
<td>
<p>logical, if <code>TRUE</code>, the observational means of the cluster atoms are initialized with a k-means algorithm.</p>
</td></tr>
<tr><td><code id="variational_fiSAN_+3A_verbose">verbose</code></td>
<td>
<p>logical, if <code>TRUE</code> the iterations are printed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Data structure</strong>
</p>
<p>The finite-infinite common atoms mixture model is used to perform inference in nested settings, where the data are organized into <code class="reqn">J</code> groups. 
The data should be continuous observations <code class="reqn">(Y_1,\dots,Y_J)</code>, where each <code class="reqn">Y_j = (y_{1,j},\dots,y_{n_j,j})</code> 
contains the <code class="reqn">n_j</code> observations from group <code class="reqn">j</code>, for <code class="reqn">j=1,\dots,J</code>. 
The function takes as input the data as a numeric vector <code>y</code> in this concatenated form. Hence <code>y</code> should be a vector of length
<code class="reqn">n_1+\dots+n_J</code>. The <code>group</code> parameter is a numeric vector of the same size as <code>y</code> indicating the group membership for each
individual observation. 
Notice that with this specification the observations in the same group need not be contiguous as long as the correspondence between the variables
<code>y</code> and <code>group</code> is maintained.
</p>
<p><strong>Model</strong>
</p>
<p>The data are modeled using a Gaussian likelihood, where both the mean and the variance are observational-cluster-specific, i.e., 
</p>
<p style="text-align: center;"><code class="reqn">y_{i,j}\mid M_{i,j} = l \sim N(\mu_l,\sigma^2_l)</code>
</p>

<p>where <code class="reqn">M_{i,j} \in \{1,\dots,L \}</code> is the observational cluster indicator of observation <code class="reqn">i</code> in group <code class="reqn">j</code>.
The prior on the model parameters is a Normal-Inverse-Gamma distribution <code class="reqn">(\mu_l,\sigma^2_l)\sim NIG (m_0,\tau_0,\lambda_0,\gamma_0)</code>, 
i.e., <code class="reqn">\mu_l\mid\sigma^2_l \sim N(m_0, \sigma^2_l / \tau_0)</code>, <code class="reqn">1/\sigma^2_l \sim Gamma(\lambda_0, \gamma_0)</code> (shape, rate).
</p>
<p><strong>Clustering</strong>
</p>
<p>The model performs a clustering of both observations and groups. 
The clustering of groups (distributional clustering) is provided by the allocation variables <code class="reqn">S_j \in \{1,2,\dots\}</code>, with 
</p>
<p style="text-align: center;"><code class="reqn">Pr(S_j = k \mid \dots ) = \pi_k  \qquad \text{for } \: k = 1,2,\dots</code>
</p>

<p>The distribution of the probabilities is <code class="reqn"> \{\pi_k\}_{k=1}^{\infty} \sim GEM(\alpha)</code>, 
where GEM is the Griffiths-Engen-McCloskey distribution of parameter <code class="reqn">\alpha</code>, 
which characterizes the stick-breaking construction of the DP (Sethuraman, 1994). 
</p>
<p>The clustering of observations (observational clustering) is provided by the allocation variables <code class="reqn">M_{i,j} \in \{1,\dots,L\}</code>, with
</p>
<p style="text-align: center;"><code class="reqn"> Pr(M_{i,j} = l \mid S_j = k, \dots ) = \omega_{l,k} \qquad \text{for } \: k = 1,2,\dots \, ; \: l = 1,\dots,L. </code>
</p>

<p>The distribution of the probabilities is <code class="reqn">(\omega_{1,k},\dots,\omega_{L,k})\sim Dirichlet_L(\beta/L,\dots,\beta/L)</code> for all <code class="reqn">k = 1,2,\dots</code>. 
Here, the dimension <code class="reqn">L</code> is fixed.
</p>


<h3>Value</h3>

<p><code>variational_fiSAN</code> returns a list of class <code>SANvb</code> containing four objects:
</p>

<ul>
<li> <p><code>model</code>: name of the fitted model.
</p>
</li>
<li> <p><code>params</code>: list containing the data and the parameters used in the simulation. Details below.
</p>
</li>
<li> <p><code>sim</code>: list containing the simulated values (optimized variational parameters). Details below.
</p>
</li>
<li> <p><code>time</code>: total computation time.
</p>
</li></ul>

<p><strong>Data and parameters</strong>:
<code>params</code> is a list with the following components:
</p>

<dl>
<dt><code>y, group, Nj, J</code></dt><dd><p>Data, group labels, group frequencies, and number of groups.</p>
</dd>
<dt><code>K, L</code></dt><dd><p>Number of fitted distributional and observational clusters.</p>
</dd>
<dt><code>m0, tau0, lambda0, gamma0</code></dt><dd><p>Model hyperparameters.</p>
</dd>
<dt><code>epsilon, seed</code></dt><dd><p>The threshold controlling the convergence criterion and the random seed adopted to replicate the run.</p>
</dd>
<dt>(<code>hyp_alpha1,hyp_alpha2</code>) or <code>alpha</code></dt><dd><p>Hyperparameters on <code class="reqn">\alpha</code> (if <code class="reqn">\alpha</code> random);
or provided value for <code class="reqn">\alpha</code> (if fixed).</p>
</dd>
<dt><code>beta_bar</code></dt><dd><p>the hyperparameter governing all the finite Dirichlet distributions at the observational level.</p>
</dd>
</dl>

<p><strong>Simulated values</strong>:
<code>sim</code> is a list with the following components:
</p>

<dl>
<dt><code>theta_l</code></dt><dd><p>Matrix of size (L,4).
Each row is a posterior variational estimate of the four normal-inverse gamma hyperparameters.</p>
</dd>
<dt><code>Elbo_val</code></dt><dd><p>Vector containing the values of the ELBO.</p>
</dd>
<dt><code>XI</code></dt><dd><p>A list of length J. Each element is a matrix of size (N, L)
posterior variational probability of assignment of assignment of the i-th observation in the j-th group to the l-th OC, 
i.e., <code class="reqn">\hat{\xi}_{i,j,l} = \hat{\mathbb{Q}}(M_{i,j}=l)</code>.</p>
</dd>
<dt><code>RHO</code></dt><dd><p>Matrix of size (J, K).
Each row is a posterior variational probability of assignment of the j-th group to the k-th DC, i.e., <code class="reqn">\hat{\rho}_{j,k} = \hat{\mathbb{Q}}(S_j=k)</code>. </p>
</dd>
<dt><code>a_tilde_k,b_tilde_k</code></dt><dd><p>Vector of updated variational parameters of the Beta distributions governing the distributional stick-breaking process.</p>
</dd>
<dt><code>beta_bar_lk</code></dt><dd><p>Matrix of updated variational parameters of the Dirichlet distributions governing the observational clustering (arranged by column).</p>
</dd>
<dt><code>conc_hyper</code></dt><dd><p>If the concentration parameters is chosen to be random, these object contain a vector with the two updated hyperparameters.</p>
</dd>
<dt><code>alpha</code></dt><dd><p>If the concentration parameters is chosen to be fixed, this object contains the passed values.</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>
set.seed(1234)
y &lt;- c( rnorm(100) ,rnorm(100,5))
g &lt;- rep( 1:2, rep(100,2))
est &lt;- variational_fiSAN( y, g, verbose = FALSE,epsilon = 1e-2)

</code></pre>

<hr>
<h2 id='variational_fSAN'>Mean Field Variational Bayes estimation of fSAN</h2><span id='topic+variational_fSAN'></span>

<h3>Description</h3>

<p><code>variational_fSAN</code> is used to perform posterior inference under the finite shared atoms nested (fSAN) model with Gaussian likelihood (originally proposed in D'Angelo et al., 2023). 
The model uses finite Dirichlet mixtures for both the distributional and observational levels of the model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>variational_fSAN(y, group, maxL = 30, maxK = 20,
                 m0 = 0, tau0 = .01, lambda0 = 3, gamma0 = 2, 
                 alpha_bar = .005, beta_bar = .005, 
                 epsilon = 1e-6, seed = NULL, maxSIM = 1e5,
                 warmstart = TRUE,verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="variational_fSAN_+3A_y">y</code></td>
<td>
<p>Numerical vector of observations (required).</p>
</td></tr>
<tr><td><code id="variational_fSAN_+3A_group">group</code></td>
<td>
<p>Numerical vector of the same length of <code>y</code>, indicating the group membership (required).</p>
</td></tr>
<tr><td><code id="variational_fSAN_+3A_maxl">maxL</code>, <code id="variational_fSAN_+3A_maxk">maxK</code></td>
<td>
<p>integers, the upper bounds for the observational and distributional clusters to fit, respectively</p>
</td></tr>
<tr><td><code id="variational_fSAN_+3A_m0">m0</code>, <code id="variational_fSAN_+3A_tau0">tau0</code>, <code id="variational_fSAN_+3A_lambda0">lambda0</code>, <code id="variational_fSAN_+3A_gamma0">gamma0</code></td>
<td>
<p>Hyperparameters on <code class="reqn">(\mu, \sigma^2) \sim NIG(m_0, \tau_0, \lambda_0,\gamma_0)</code>.</p>
</td></tr>
<tr><td><code id="variational_fSAN_+3A_alpha_bar">alpha_bar</code></td>
<td>
<p>the hyperparameter of the symmetric distributional Dirichlet distribution.</p>
</td></tr>
<tr><td><code id="variational_fSAN_+3A_beta_bar">beta_bar</code></td>
<td>
<p>the hyperparameter of the symmetric observational Dirichlet distribution.</p>
</td></tr>
<tr><td><code id="variational_fSAN_+3A_epsilon">epsilon</code></td>
<td>
<p>the tolerance that drives the convergence criterion adopted as stopping rule</p>
</td></tr>
<tr><td><code id="variational_fSAN_+3A_seed">seed</code></td>
<td>
<p>random seed to control the initialization.</p>
</td></tr>
<tr><td><code id="variational_fSAN_+3A_maxsim">maxSIM</code></td>
<td>
<p>the maximum number of CAVI iteration to perform.</p>
</td></tr>
<tr><td><code id="variational_fSAN_+3A_warmstart">warmstart</code></td>
<td>
<p>logical, if <code>TRUE</code>, the observational means of the cluster atoms are initialized with a k-means algorithm.</p>
</td></tr>
<tr><td><code id="variational_fSAN_+3A_verbose">verbose</code></td>
<td>
<p>logical, if <code>TRUE</code> the iterations are printed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Data structure</strong>
</p>
<p>The finite common atoms mixture model is used to perform inference in nested settings, where the data are organized into <code class="reqn">J</code> groups. 
The data should be continuous observations <code class="reqn">(Y_1,\dots,Y_J)</code>, where each <code class="reqn">Y_j = (y_{1,j},\dots,y_{n_j,j})</code> 
contains the <code class="reqn">n_j</code> observations from group <code class="reqn">j</code>, for <code class="reqn">j=1,\dots,J</code>. 
The function takes as input the data as a numeric vector <code>y</code> in this concatenated form. Hence <code>y</code> should be a vector of length
<code class="reqn">n_1+\dots+n_J</code>. The <code>group</code> parameter is a numeric vector of the same size as <code>y</code> indicating the group membership for each
individual observation. 
Notice that with this specification the observations in the same group need not be contiguous as long as the correspondence between the variables
<code>y</code> and <code>group</code> is maintained.
</p>
<p><strong>Model</strong>
</p>
<p>The data are modeled using a Gaussian likelihood, where both the mean and the variance are observational-cluster-specific, i.e., 
</p>
<p style="text-align: center;"><code class="reqn">y_{i,j}\mid M_{i,j} = l \sim N(\mu_l,\sigma^2_l)</code>
</p>

<p>where <code class="reqn">M_{i,j} \in \{1,\dots,L \}</code> is the observational cluster indicator of observation <code class="reqn">i</code> in group <code class="reqn">j</code>.
The prior on the model parameters is a Normal-Inverse-Gamma distribution <code class="reqn">(\mu_l,\sigma^2_l)\sim NIG (m_0,\tau_0,\lambda_0,\gamma_0)</code>, 
i.e., <code class="reqn">\mu_l\mid\sigma^2_l \sim N(m_0, \sigma^2_l / \tau_0)</code>, <code class="reqn">1/\sigma^2_l \sim Gamma(\lambda_0, \gamma_0)</code> (shape, rate).
</p>
<p><strong>Clustering</strong>
</p>
<p>The model performs a clustering of both observations and groups. 
The clustering of groups (distributional clustering) is provided by the allocation variables <code class="reqn">S_j \in \{1,\dots,K\}</code>, with 
</p>
<p style="text-align: center;"><code class="reqn">Pr(S_j = k \mid \dots ) = \pi_k  \qquad \text{for } \: k = 1,\dots,K.</code>
</p>

<p>The distribution of the probabilities is <code class="reqn">(\pi_1,\dots,\pi_{K})\sim Dirichlet_K(\alpha/K,\dots,\alpha/K)</code>. 
Here, the dimension <code class="reqn">K</code> is fixed.
</p>
<p>The clustering of observations (observational clustering) is provided by the allocation variables <code class="reqn">M_{i,j} \in \{1,\dots,L\}</code>, with
</p>
<p style="text-align: center;"><code class="reqn"> Pr(M_{i,j} = l \mid S_j = k, \dots ) = \omega_{l,k} \qquad \text{for } \: k = 1,\dots,K \, ; \: l = 1,\dots,L. </code>
</p>

<p>The distribution of the probabilities is <code class="reqn">(\omega_{1,k},\dots,\omega_{L,k})\sim Dirichlet_L(\beta/L,\dots,\beta/L)</code> for all <code class="reqn">k = 1,\dots,K</code>. 
Here, the dimension <code class="reqn">L</code> is fixed.
</p>


<h3>Value</h3>

<p><code>variational_fSAN</code> returns a list of class <code>SANvb</code> containing four objects:
</p>

<ul>
<li> <p><code>model</code>: name of the fitted model.
</p>
</li>
<li> <p><code>params</code>: list containing the data and the parameters used in the simulation. Details below.
</p>
</li>
<li> <p><code>sim</code>: list containing the simulated values (optimized variational parameters). Details below.
</p>
</li>
<li> <p><code>time</code>: total computation time.
</p>
</li></ul>

<p><strong>Data and parameters</strong>:
<code>params</code> is a list with the following components:
</p>

<dl>
<dt><code>y, group, Nj, J</code></dt><dd><p>Data, group labels, group frequencies, and number of groups.</p>
</dd>
<dt><code>K, L</code></dt><dd><p>Number of fitted distributional and observational clusters.</p>
</dd>
<dt><code>m0, tau0, lambda0, gamma0</code></dt><dd><p>Model hyperparameters.</p>
</dd>
<dt><code>epsilon, seed</code></dt><dd><p>The threshold controlling the convergence criterion and the random seed adopted to replicate the run.</p>
</dd>
<dt><code>alpha_bar, beta_bar</code></dt><dd><p>the hyperparameters governing all the finite Dirichlet distributions at the distributional and observational level.</p>
</dd>
</dl>

<p><strong>Simulated values</strong>:
<code>sim</code> is a list with the following components:
</p>

<dl>
<dt><code>theta_l</code></dt><dd><p>Matrix of size (L,4).
Each row is a posterior variational estimate of the four normal-inverse gamma hyperparameters.</p>
</dd>
<dt><code>Elbo_val</code></dt><dd><p>Vector containing the values of the ELBO.</p>
</dd>
<dt><code>XI</code></dt><dd><p>A list of length J. Each element is a matrix of size (N, L)
posterior variational probability of assignment of assignment of the i-th observation in the j-th group to the l-th OC, 
i.e., <code class="reqn">\hat{\xi}_{i,j,l} = \hat{\mathbb{Q}}(M_{i,j}=l)</code>.</p>
</dd>
<dt><code>RHO</code></dt><dd><p>Matrix of size (J, K).
Each row is a posterior variational probability of assignment of the j-th group to the k-th DC, i.e., <code class="reqn">\hat{\rho}_{j,k} = \hat{\mathbb{Q}}(S_j=k)</code>. </p>
</dd>
<dt><code>a_tilde_k,b_tilde_k</code></dt><dd><p>Vector of updated variational parameters of the Beta distributions governing the distributional stick-breaking process.</p>
</dd>
<dt><code>alpha_bar_k</code></dt><dd><p>Vector of updated variational parameters of the Dirichlet distributions governing the distributional clustering.</p>
</dd>
<dt><code>beta_bar_lk</code></dt><dd><p>Matrix of updated variational parameters of the Dirichlet distributions governing the observational clustering (arranged by column).</p>
</dd>
</dl>



<h3>References</h3>

<p>D’Angelo, L., Canale, A., Yu, Z., and Guindani, M. (2023). 
Bayesian nonparametric analysis for the detection of spikes in noisy calcium imaging data. <em>Biometrics</em>, 79(2), 1370–1382. DOI: 10.1111/biom.13626
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
set.seed(123)
y &lt;- c(rnorm(50),rnorm(50,5))
g &lt;- rep(1:2,rep(50,2))
est &lt;- variational_fSAN(y, g, verbose = FALSE,
                        epsilon = 1e-2, maxL=15, maxK=10)

</code></pre>

<hr>
<h2 id='variational_multistart'>Perform variational inference using multiple starting points.</h2><span id='topic+variational_multistart'></span><span id='topic+plot.multistart'></span><span id='topic+print.multistart'></span>

<h3>Description</h3>

<p><code>variational_multistart</code> is the main function of the package. 
It is used to estimate via variational inference the three models we present (CAM, fiSAN, fSAN) while adopting multiple random starting points to better explore the variational parameter space.
The run that provides the highest Expected Lower BOund (ELBO) is usually the one considered for inference. Note that the arguments passed to this functions are a union of the arguments 
of the functions <code>variational_CAM</code>, <code>variational_fiSAN</code>, and <code>variational_fSAN</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>variational_multistart(y, group, runs, cores = 1, 
                       model = c("fiSAN","CAM","fSAN"), 
                       maxL = 30, maxK = 20, 
                       m0 = 0, tau0 = .01, lambda0 = 3, gamma0 = 2, 
                       conc_par = NULL,  conc_hyperpar = c(1,1,1,1), 
                       alpha_bar = 0.05, beta_bar = 0.05, 
                       epsilon = 1e-6, root = 1234, maxSIM = 1e5, 
                       warmstart = TRUE)

## S3 method for class 'multistart'
plot(x, type = c("elbo", "time"), log_scale_iter = TRUE, ...)

## S3 method for class 'multistart'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="variational_multistart_+3A_y">y</code></td>
<td>
<p>vector of observations.</p>
</td></tr>
<tr><td><code id="variational_multistart_+3A_group">group</code></td>
<td>
<p>vector of the same length of y indicating the group membership (numeric).</p>
</td></tr>
<tr><td><code id="variational_multistart_+3A_runs">runs</code></td>
<td>
<p>the number of multiple runs to launch.</p>
</td></tr>
<tr><td><code id="variational_multistart_+3A_cores">cores</code></td>
<td>
<p>the number of cores to dedicate to the multiple runs.</p>
</td></tr>
<tr><td><code id="variational_multistart_+3A_model">model</code></td>
<td>
<p>a string specifying the model to use. It can be <code>"fiSAN"</code>,<code>"CAM"</code>, or <code>"fSAN"</code>.</p>
</td></tr>
<tr><td><code id="variational_multistart_+3A_maxl">maxL</code>, <code id="variational_multistart_+3A_maxk">maxK</code></td>
<td>
<p>integers, the upper bounds for the observational and distributional clusters to fit, respectively.</p>
</td></tr>
<tr><td><code id="variational_multistart_+3A_m0">m0</code>, <code id="variational_multistart_+3A_tau0">tau0</code>, <code id="variational_multistart_+3A_lambda0">lambda0</code>, <code id="variational_multistart_+3A_gamma0">gamma0</code></td>
<td>
<p>hyperparameters on <code class="reqn">(\mu, \sigma^2) \sim NIG(m_0, \tau_0, \lambda_0,\gamma_0)</code>.</p>
</td></tr>
<tr><td><code id="variational_multistart_+3A_conc_hyperpar">conc_hyperpar</code>, <code id="variational_multistart_+3A_conc_par">conc_par</code>, <code id="variational_multistart_+3A_alpha_bar">alpha_bar</code>, <code id="variational_multistart_+3A_beta_bar">beta_bar</code></td>
<td>
<p>these values crucially depend on the chosen model. See <code><a href="#topic+variational_CAM">variational_CAM</a></code>, <code><a href="#topic+variational_fiSAN">variational_fiSAN</a></code>, <code><a href="#topic+variational_fSAN">variational_fSAN</a></code> for proper explanations.</p>
</td></tr>
<tr><td><code id="variational_multistart_+3A_epsilon">epsilon</code></td>
<td>
<p>the tolerance that drives the convergence criterion adopted as stopping rule.</p>
</td></tr>
<tr><td><code id="variational_multistart_+3A_root">root</code></td>
<td>
<p>common part of the random seeds used to control the initialization in order to provide reproducibility even in paralleled settings.</p>
</td></tr>
<tr><td><code id="variational_multistart_+3A_maxsim">maxSIM</code></td>
<td>
<p>the maximum number of CAVI iteration to perform.</p>
</td></tr>
<tr><td><code id="variational_multistart_+3A_warmstart">warmstart</code></td>
<td>
<p>logical, if <code>TRUE</code>, the observational means of the cluster atoms are initialized with a k-means algorithm.</p>
</td></tr>
<tr><td><code id="variational_multistart_+3A_x">x</code></td>
<td>
<p>an object of class <code>multistart</code>, obtained from the <code>variational_multistart</code> function.</p>
</td></tr>
<tr><td><code id="variational_multistart_+3A_type">type</code></td>
<td>
<p>a string specifying the type of plot. It can be either <code>"elbo"</code> or <code>"time"</code>. The former displays 
the elbo trajectories, highlighting the best run. The latter provides a summary of the computational times.</p>
</td></tr>
<tr><td><code id="variational_multistart_+3A_log_scale_iter">log_scale_iter</code></td>
<td>
<p>logical. If <code>TRUE</code>, when plotting the elbo trajectories, the x-axes is displayed in log-scale, enhancing the visualization of the results.</p>
</td></tr>
<tr><td><code id="variational_multistart_+3A_...">...</code></td>
<td>
<p>ignored</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For the details of the single models, see their specific documentations: <code><a href="#topic+variational_CAM">variational_CAM</a></code>, <code><a href="#topic+variational_fiSAN">variational_fiSAN</a></code>, and <code><a href="#topic+variational_fSAN">variational_fSAN</a></code>.
</p>


<h3>Value</h3>

<p>A list with all the runs performed. Each element of the list is a fitted variational model of class <code>SANvb</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+variational_CAM">variational_CAM</a></code>, <code><a href="#topic+variational_fiSAN">variational_fiSAN</a></code>, <code><a href="#topic+variational_fSAN">variational_fSAN</a></code>, <code><a href="#topic+extract_best">extract_best</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Generate example data
set.seed(123)
y &lt;- c(rnorm(100),rnorm(100,5))
g &lt;- rep(1:2,rep(100,2))

# Estimate multiple models via variational inference
est &lt;- variational_multistart(y, g, runs=5)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
