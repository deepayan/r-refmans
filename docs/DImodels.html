<!DOCTYPE html><html><head><title>Help for package DImodels</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {DImodels}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#DImodels-package'>
<p>Diversity-Interactions (DI) Models</p></a></li>
<li><a href='#autoDI'>
<p>Automated Diversity-Interactions Model Fitting</p></a></li>
<li><a href='#Bell'>
<p>The &quot;Bell&quot; Dataset</p></a></li>
<li><a href='#contrasts_DI'>
<p>Compute contrasts for Diversity Interactions (DI) models</p></a></li>
<li><a href='#describe_model'>
<p>Describe DI models</p></a></li>
<li><a href='#design_a'>
<p>The &quot;design_a&quot; Dataset</p></a></li>
<li><a href='#design_b'>
<p>The &quot;design_b&quot; Dataset</p></a></li>
<li><a href='#DI'>
<p>Diversity-Interactions Model Fitting</p></a></li>
<li><a href='#DI_compare'>
<p>Compare a Fitted Diversity-Interactions Model to the Reference Model</p></a></li>
<li><a href='#DI_data_manipulation'>
<p>Data manipulation function</p></a></li>
<li><a href='#DI_methods'>
<p>Methods for <code>DI</code> Objects</p></a></li>
<li><a href='#DImodels-internal'>
<p>Internal Functions</p></a></li>
<li><a href='#extract'>
<p>Extract terms from a DI or autoDI model object</p></a></li>
<li><a href='#predict.DI'>
<p>Predict Method for Diversity-Interactions (DI) Models</p></a></li>
<li><a href='#richness_vs_DI'>
<p>Comparing the Richness Model with DI Alternatives</p></a></li>
<li><a href='#sim0'>
<p>The Simulated &quot;sim0&quot; Dataset</p></a></li>
<li><a href='#sim0_design'>
<p>The &quot;sim0_design&quot; Dataset</p></a></li>
<li><a href='#sim1'>
<p>The Simulated &quot;sim1&quot; Dataset</p></a></li>
<li><a href='#sim2'>
<p>The Simulated &quot;sim2&quot; Dataset</p></a></li>
<li><a href='#sim3'>
<p>The Simulated &quot;sim3&quot; Dataset</p></a></li>
<li><a href='#sim4'>
<p>The Simulated &quot;sim4&quot; Dataset</p></a></li>
<li><a href='#sim5'>
<p>The Simulated &quot;sim5&quot; Dataset</p></a></li>
<li><a href='#Switzerland'>
<p>The &quot;Switzerland&quot; Dataset</p></a></li>
<li><a href='#theta_CI'>
<p>Compute Confidence Interval for Theta</p></a></li>
<li><a href='#update_DI'>
<p>Update DI function call</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Diversity-Interactions (DI) Models</td>
</tr>
<tr>
<td>Version:</td>
<td>1.3.2</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-02-26</td>
</tr>
<tr>
<td>Author:</td>
<td>Rafael de Andrade Moral [aut, cre],
  John Connolly [aut],
  Rishabh Vishwakarma [ctb],
  Caroline Brophy [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Rafael de Andrade Moral &lt;rafael.deandrademoral@mu.ie&gt;</td>
</tr>
<tr>
<td>Imports:</td>
<td>methods, graphics, stats, utils, ggplot2, hnp, rootSolve,
multcomp</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, markdown, testthat (&ge; 3.0.0), covr</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.6.0)</td>
</tr>
<tr>
<td>Description:</td>
<td>The 'DImodels' package is suitable for analysing data from biodiversity and ecosystem function studies using the Diversity-Interactions (DI) modelling approach introduced by Kirwan et al. (2009) &lt;<a href="https://doi.org/10.1890%2F08-1684.1">doi:10.1890/08-1684.1</a>&gt;. Suitable data will contain proportions for each species and a community-level response variable, and may also include additional factors, such as blocks or treatments. The package can perform data manipulation tasks, such as computing pairwise interactions (the DI_data() function), can perform an automated model selection process (the autoDI() function) and has the flexibility to fit a wide range of user-defined DI models (the DI() function).</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-02-26 11:17:27 UTC; Administrator</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-02-28 18:40:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='DImodels-package'>
Diversity-Interactions (DI) Models
</h2><span id='topic+DImodels-package'></span><span id='topic+DImodels'></span>

<h3>Description</h3>

<p>The 'DImodels' package is suitable for analysing data from biodiversity and ecosystem function studies using the Diversity-Interactions (DI) modelling approach introduced by Kirwan et al. (2009) &lt;doi:10.1890/08-1684.1&gt;. Suitable data will contain proportions for each species and a community-level response variable, and may also include additional factors, such as blocks or treatments. The package can perform data manipulation tasks, such as computing pairwise interactions (the DI_data() function), can perform an automated model selection process (the autoDI() function) and has the flexibility to fit a wide range of user-defined DI models (the DI() function).
</p>


<h3>Details</h3>

<p><strong>Introduction to Diversity-Interactions models</strong>
</p>
<p>Diversity-Interactions (DI) models (Kirwan et al 2009) are a set of tools for analysing and interpreting data from experiments that explore the effects of species diversity on community-level responses; for example, the effect of increasing community diversity on biomass production in a grassland ecosystem. Most analyses of diversity experiments quantify community diversity in terms of species richness, the number of species present. The DI method modifies this presence/absence approach in mixed communities by taking species relative abundance in the community into account. So, instead of ignoring differences in community responses across communities with the same species but with different species relative abundances, the DI approach aims to understand and explain these differences.
</p>
<p><strong>What variables will a suitable dataset contain?</strong>
</p>
<p>The DI approach assesses the effect of species diversity on a community response over a period of time. For data from a biodiversity study with <em>S</em> species to be suited to the DI approach, the variables that are required on each experimental unit are:
</p>

<ol>
<li><p> A set of proportions <code class="reqn">p1, p2, ... , pS</code> that characterise the proportions of each species at a defined starting point in time. These proportions (or relative abundances) of species in the community (<code class="reqn">pi</code> for the ith species) range between 0 (absence) and 1 (monoculture - the only species present) and the sum of all the <code class="reqn">pi</code> values for a community is always 1.   
</p>
</li>
<li><p> A community-level response variable, recorded a period of time after the initial species proportions were recorded.
</p>
</li></ol>

<p>The dataset may also contain other variables such as a block, density or treatments.
</p>
<p><strong>What are Diversity-Interactions models?</strong>
</p>
<p>A DI model typically has three components and takes the form:
</p>
<p style="text-align: center;"><code class="reqn">y = Identities + Interactions + Structures + \epsilon</code>
</p>

<p>where <em>y</em> is a community-level response, the <em>Identities</em> are the effects of species identities and enter the model as individual species proportions at the beginning of the time period, the <em>Interactions</em> are the interactions among the species proportions, while <em>Structures</em> include other experimental structures such as blocks, treatments or density. In a three species system, with an experimental blocking structure, a possible DI model is:
</p>
<p style="text-align: center;"><code class="reqn">y = \beta_1p1 + \beta_2p2 + \beta_3p3 + \delta_{12}p1p2 + \delta_{13}p1p3 + \delta_{23}p2p3 + \alpha_k + \epsilon</code>
</p>

<p>Where <em>p1</em>, <em>p2</em> and <em>p3</em> are the species proportions of species 1, 2 and 3 respectively, and <code class="reqn">\alpha_k</code> is the effect of block <em>k</em>. The error term <code class="reqn">\epsilon</code> is usually assumed to be normally distributed with mean 0 and constant variance (and assumed independent and identically distributed). 
</p>
<p>In a monoculture of the ith species, the expected performance of <em>y</em> in block <em>k</em> is <code class="reqn">\beta_i</code>. In mixture, the <em>Identities</em> component provides the expected performance as a weighted average of monoculture responses, and the <em>Interactions</em> component is added to it to give the overall expected performance of the mixed community. The <em>Interactions</em> component addresses the question: do mixed communities perform differently from what might be expected from the weighted averaging of monoculture performances? Note that in Kirwan et al 2009 the <em>Interactions</em> component is referred to as the diversity effect, however, here we use the more general term &quot;<em>Interactions</em>&quot;, since the interpretation of how species diversity affects the response is a combination of both the <em>Identities</em> and <em>Interactions</em> components. The community with the best overall performance may depend on both the <em>Identities</em> and <em>Interactions</em> and will rarely be the community with the largest net interactions effect. The equation above provides an example of a DI model where there is a unique interaction term for each pair of species. It is possible to test various constraints among interactions, some of which may be motivated by the context of the data (Kirwan et al 2009). 
</p>
<p>The <em>Interactions</em> component may also include an non-linear exponent parameter <code class="reqn">\theta</code> on each <code class="reqn">pipj</code> term, where a value different to one allows the importance and impact of interaction terms to be altered (Connolly et al 2013). 
</p>
<p><strong>What can the <code>DImodels</code> package do?</strong>
</p>
<p>The DI approach is a full regression method where the response of the community is characterised by the effects of diversity variables such as  <em>Identities</em> and <em>Interactions</em> components, and by experimental structural variables such as blocks, density and treatments. All of these may be important determinants of response and so should be included in the analysis of community responses. The <code>DImodels</code> package aims to make it easier to analyse data using DI models. 
</p>
<p>Currently, the <code>DImodels</code> package contains three main functions: <code>autoDI</code>, <code>DI</code> and <code>DI_data</code>. Here we give a brief overview of each, and link to the respective help files for further information. 
</p>
<p><code>auto_DI</code>: This function gives a simple overview of the successive contribution of the <em>Structures</em>, <em>Identities</em> and <em>Interactions</em> components to the model via an automated model selection process. It will identify the 'best' model from a (limited) subset of all possible DI models. However, <code>autoDI</code> may need to be supplemented by more refined analysis, for example, <code>auto_DI</code> does not test for interactions between the terms in the <em>Structures</em> and <em>Identities</em> components. It can also only facilitate one block, one density and one treatment variable. However, it is a very useful starting point for DI model exploration. Further information at: <code><a href="#topic+autoDI">autoDI</a></code>.  
</p>
<p><code>DI</code>: This function can fit a wide range of DI models and includes the flexibility to test for multiple treatments or additional interactions, for example, between terms in the <em>Identities</em> and <em>Structures</em> components. The DI function fits one user-defined DI model at a time, and it allows for flexibility in the form of the model through a combination of in-built argument options and additional user-defined options. Further information at: <code><a href="#topic+DI">DI</a></code>. 
</p>
<p><code>DI_data</code>: This function can compute various forms of interactions among the <code class="reqn">pi</code> variables. This function is not required when using <code>autoDI</code>, or for the in-built argument options in <code>DI</code>, but may be needed when specifying additional user-defined options in <code>DI</code>. Further information at: <code><a href="#topic+DI_data">DI_data</a></code> and for examples of when it is required see <code><a href="#topic+DI">DI</a></code>.  
</p>
<p>There are three other functions:
</p>

<ol>
<li> <p><code><a href="#topic+theta_CI">theta_CI</a></code> can fit a confidence interval to the parameter theta, when it has been estimated using either <code>autoDI</code> or <code>DI</code>,
</p>
</li>
<li> <p><code><a href="#topic+DI_compare">DI_compare</a></code> that can compare a fitted DI model to the 'reference' model (see <code><a href="#topic+autoDI">autoDI</a></code>) for details about the reference model), and
</p>
</li>
<li> <p><code><a href="#topic+update_DI">update_DI</a></code> that can update a fitted DI model passing different values to one or more arguments (see <code><a href="#topic+update_DI">update_DI</a></code>) for details).
</p>
</li></ol>

<p><strong>Challenges with fitting and interpreting Diversity-Interactions models</strong>
</p>
<p>Analysing data using DI methods can be tricky for people familiar with ordinary regression models and the <code>DImodels</code> package aims to make analysis easier. The difficulties lie in:
</p>

<ol>
<li><p> The lack of familiarity in dealing with the <em>Identities</em> component variables <code class="reqn">pi</code>, which must sum to 1. This constraint can lead to interpretative issues, and estimation problems with some widely used R software.
</p>
</li>
<li><p> The novelty of specifying the <em>Interactions</em> components in terms of many pairwise interaction terms whose numbers may greatly increase with <em>S</em>. The number of pairwise terms can often be reduced by identifying biologically meaningful patterns among them, for example, through functional grouping of species. This may greatly reduce the number of coefficients to be estimated and interpreted in the model (Kirwan et al, 2009). 
</p>
</li>
<li><p> The introduction of a power coefficient theta (<code class="reqn">\theta</code>) for all pairwise interaction terms (Connolly et al, 2013). This parameter can be very useful in describing the effect of community evenness on community response, i.e., whether response changes rapidly or slowly across communities where the relative abundance of species changes from being equal for all species to dominance by one or more species. 
</p>
</li></ol>

<p><strong>Limitations of the <code>DImodels</code> package</strong>
</p>
<p>Currently, the <code>DImodels</code> package does not support multivariate responses or repeated measurements on the same experimental unit. It also does not currently support the random effects approach to modelling pairwise interactions that was developed by Brophy et al 2017.
</p>


<h3>Author(s)</h3>

<p>Rafael de Andrade Moral [aut, cre], John Connolly [aut], Rishabh Vishwakarma [ctb], Caroline Brophy [aut]
</p>
<p>Maintainer: Rafael de Andrade Moral &lt;rafael.deandrademoral@mu.ie&gt;
</p>


<h3>References</h3>

<p>Brophy C, A Dooley, L Kirwan, JA Finn, J McDonnell, T Bell, MW Cadotte and J Connolly. (2017) Biodiversity and ecosystem function: Making sense of numerous species interactions in multi-species communities. Ecology 98, 1771-1778.
</p>
<p>Connolly J, T Bell, T Bolger, C Brophy, T Carnus, JA Finn, L Kirwan, F Isbell, J Levine, A Lüscher, V Picasso, C Roscher, MT Sebastia, M Suter and A Weigelt (2013) An improved model to predict the effects of changing biodiversity levels on ecosystem function. Journal of Ecology, 101, 344-355.
</p>
<p>Kirwan L, J Connolly, JA Finn, C Brophy, A Lüscher, D Nyfeler and MT Sebastia (2009) Diversity-interaction modelling - estimating contributions of species identities and interactions to ecosystem function. Ecology, 90, 2032-2038.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+autoDI">autoDI</a></code>
<code><a href="#topic+DI">DI</a></code>
<code><a href="#topic+DI_data">DI_data</a></code>
<code><a href="#topic+theta_CI">theta_CI</a></code>
</p>
<p>Example datasets:
The <code><a href="#topic+Bell">Bell</a></code> dataset.
The <code><a href="#topic+sim1">sim1</a></code> dataset.
The <code><a href="#topic+sim2">sim2</a></code> dataset.
The <code><a href="#topic+sim3">sim3</a></code> dataset.
The <code><a href="#topic+sim4">sim4</a></code> dataset.
The <code><a href="#topic+sim5">sim5</a></code> dataset.
The <code><a href="#topic+Switzerland">Switzerland</a></code> dataset.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Load the Switzerland data
  data(Switzerland)
  
## Check that the proportions sum to 1 (required for DI models)
## p1 to p4 are in the 4th to 7th columns in Switzerland
  Switzerlandsums &lt;- rowSums(Switzerland[4:7])
  summary(Switzerlandsums)
  
## Example of autoDI
  auto1 &lt;- autoDI(y = "yield", density = "density", prop = c("p1","p2","p3","p4"), 
                  treat = "nitrogen", FG = c("G","G","L","L"), data = Switzerland, 
                  selection = "Ftest")
  summary(auto1)
  
## Example of DI
  m1 &lt;- DI(y = "yield", density = "density", prop = 4:7, treat = "nitrogen", 
           FG = c("G","G","L","L"), DImodel = "FG", data = Switzerland)
  summary(m1)
  
## Example of DI_data.
## Create interaction variables and incorporate them into a new data frame Switzerland2.
## Switzerland2 will contain the new variables:  AV, E, p1_add, p2_add, p3_add, p4_add, 
##  bfg_G_L, wfg_G, wfg_L.
  FG_matrix &lt;- DI_data(prop = c("p1","p2","p3","p4"), FG = c("G","G","L","L"),  
                       data = Switzerland, what = "FG")
  Switzerland2 &lt;- data.frame(Switzerland, FG_matrix)
</code></pre>

<hr>
<h2 id='autoDI'>
Automated Diversity-Interactions Model Fitting
</h2><span id='topic+autoDI'></span>

<h3>Description</h3>

<p>This function provides an automated way to fit a (limited) range of Diversity-Interactions (DI) models. Using one of several selection criteria, <code>autoDI</code> will identify the best DI model from the range fitted via a three-step selection process (see Details for more information). While <code>autoDI</code> can be a useful starting point for fitting DI models, its range of models is not exhaustive and additional model fitting or testing via <code>DI</code> is likely to be required. For instance, <code>autoDI</code> does not test for interactions of a treatment with other variables in the model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>autoDI(y, prop, data, block, density, treat, ID, FG = NULL, 
       selection = c("Ftest","AIC","AICc","BIC","BICc"), 
       step0 = FALSE, step4 = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="autoDI_+3A_y">y</code></td>
<td>

<p>The column name of the response vector, which must be in quotes, for example, <code>y = "yield"</code>. 
</p>
</td></tr>
<tr><td><code id="autoDI_+3A_block">block</code></td>
<td>

<p>The name of the block variable (if present), which must be in quotes, for example, <code>block = "block"</code>. If no blocking variable, omit this argument.
</p>
</td></tr>
<tr><td><code id="autoDI_+3A_density">density</code></td>
<td>

<p>The name of the density variable (if present), which must be in quotes, for example, <code>density = "density"</code>. If no density variable, omit this argument. 
</p>
</td></tr>
<tr><td><code id="autoDI_+3A_prop">prop</code></td>
<td>

<p>A vector of <em>s</em> column names identifying the species proportions in each row in the dataset. For example, if the species proportions columns are labelled p1 to p4, then <code>prop = c("p1","p2","p3","p4")</code>. Alternatively, the column numbers can be specified, for example, <code>prop = 4:7</code>, where the species proportions are in the 4th to 7th columns.
</p>
</td></tr>
<tr><td><code id="autoDI_+3A_treat">treat</code></td>
<td>

<p>The name of a column in the dataset containing the value of a treatment factor or covariate. The treatment name must be included in quotes, for example, <code>treat = "nitrogen"</code>. (Only one treatment or covariate is permitted in <code>autoDI</code>, but see <code>DI</code> for options involving more than one treatment.) If the treatment is a factor, the variable must already be specified as a factor prior to using <code>autoDI</code>. 
</p>
</td></tr>
<tr><td><code id="autoDI_+3A_id">ID</code></td>
<td>


<p>This argument takes a text list (of length <em>s</em>) dsecirbing groupings for the identity effects of the species. For example, if there are four species and you wish to group the identity effects all four species into a single term: <code>ID</code> could be <code>ID = c("ID1","ID1","ID1","ID1")</code>, where &quot;ID1&quot; is the name of the ID group. Similarly if the we wish to have two identity effect groups where identity effect of species 1 and 3, and species 2 and 4 are grouped together: <code>ID</code> could be <code>ID = c("ID1","ID2","ID1","ID2")</code>, where &quot;ID1&quot; and &quot;ID2&quot; are the names of the ID groups. These ideas expand to any number of species and any number or combination of groups. Finally, the ID groups do not have to be named &quot;ID1&quot; and &quot;ID2&quot;, the user can specify any name for the groups.
</p>

<ul>
<li><p> If the <code>ID</code> argument is not specified, each species will be assumed to have a separate identity effect. 
</p>
</li>
<li><p> Specify an grouping for the ID does not affect the interaction terms. The interactions are still calculated using the individual species proportions.
</p>
</li>
<li><p> The <code>ID</code> argument is defunct when using the <code>custom_formula</code> argument, since species identity effects must be included directly in the <code>custom_formula</code> argument. 
</p>
</li></ul>

</td></tr>
<tr><td><code id="autoDI_+3A_fg">FG</code></td>
<td>

<p>If species are classified by <em>g</em> functional groups, this parameter gives a text list (of length <em>s</em>) of the functional group to which each species belongs. For example, for four grassland species with two grasses and two legumes: FG could be <code>FG = c("G","G","L","L")</code>, where G stands for grass and L stands for legume.
</p>
</td></tr>
<tr><td><code id="autoDI_+3A_data">data</code></td>
<td>

<p>Specify the dataset, for example, <code>data = Switzerland</code>. The dataset name should not appear in quotes.
</p>
</td></tr>
<tr><td><code id="autoDI_+3A_selection">selection</code></td>
<td>

<p>Selection method to be used in the automated model selection process. Options are <code>"Ftest"</code>, <code>"AIC"</code>, <code>"AICc"</code>, <code>"BIC"</code> and <code>"BICc"</code>. The default is <code>selection = "Ftest"</code>.
</p>
</td></tr>
<tr><td><code id="autoDI_+3A_step0">step0</code></td>
<td>

<p>By default, <code>autoDI</code> outputs steps 1 - 4, however, an initial step 0 can be included by specifying <code>step0 = TRUE</code>. This will fit a model with an intercept only, and will sequentially add in and test the inclusion of <code>block</code>, <code>density</code> and <code>treat</code>, if they are specified in the <code>autoDI</code> arguments. 
</p>
</td></tr>
<tr><td><code id="autoDI_+3A_step4">step4</code></td>
<td>

<p>Step 4 performs a lack of fit test for the final model selected by steps 1 - 3. By default, <code>step4 = TRUE</code>, but it can be omitted by specifying  <code>step4 = FALSE</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>What are Diversity-Interactions models?</strong> 
</p>
<p>Diversity-Interactions (DI) models (Kirwan et al 2009) are a set of tools for analysing and interpreting data from experiments that explore the effects of species diversity on community-level responses. We recommend that users of the <code>DImodels</code> package read the short introduction to DI models (available at: <code><a href="#topic+DImodels">DImodels</a></code>). Further information on DI models is available in Kirwan et al 2009 and Connolly et al 2013.
</p>
<p><strong>Checks on data prior to using <code>autoDI</code>.</strong> 
</p>
<p>Before using <code>autoDI</code>, check that the species proportions for each row in your dataset sum to one. See the 'Examples' section for code to do this. An error message will be generated if the proportions don't sum to one.  
</p>
<p><strong>How does the <code>autoDI</code> function work?</strong> 
</p>
<p>The <code>autoDI</code> function identifies the 'best' Diversity-Interactions (DI) model from a specific range of proposed models using a three-step process of selection (Steps 1 to 3) and performs a lack of fit test on the selected model (Step 4). Only a limited subset of all possible models are examined under autoDI, for example, interactions involving experiment structural terms (<code>block</code>, <code>density</code>, <code>treat</code>) are not explored. The <code>autoDI</code> function can provide an excellent initial analysis, but often additional modelling and exploration will be required using the <code>DI</code> function. 
</p>
<p>Steps 1-3 outlined below provide details on the automated model selection process followed by <code>autoDI</code>. Step 4 is a lack of fit test for the selected model. Step 0 may also be included (<code>step0 = TRUE</code>) as an initial step to sequentially test the inclusion of experiment structural variables (<code>block</code>, <code>density</code>, <code>treat</code>), prior to fitting the DI models in Step 1.
</p>
<p>The default selection method used is <code>selection = "Ftest"</code>, which will return the appropriate F test statistic value(s) and p-value(s) in each step. When any of the information theoretic approaches (<code>"AIC"</code>, <code>"AICc"</code>, <code>"BIC"</code> or <code>"BICc"</code>) are specified, the model with the lowest value is selected in each step, even if it is only the lowest by a tiny margin; therefore, it is recommended to examine the information theoretic values across all models.
</p>
<p><em>Step 1</em>
</p>
<p>The AV model is fitted twice: considering the non-linear parameter <code>theta</code> equal to 1, and estimating it by maximising the profile likelihood. For example, for a design with 4 species, for the AV model, the parameter <code>theta</code> enters the model as:
</p>
<p><code>AV_theta = (p1*p2)^theta + (p1*p3)^theta + (p1*p4)^theta + (p2*p3)^theta + (p2*p4)^theta + (p3*p4)^theta</code>
</p>
<p>In the profile likelihood estimation, <code>theta</code> is tested across the range 0.01 to 1.5. Then, the two models (with <code>theta</code> estimated and with <code>theta</code> set to 1) are compared using the method specified by the <code>selection</code> argument.
</p>
<p>Details on DI models that include <code>theta</code> are described in Connolly et al 2013.
</p>
<p><em>Step 2</em>
</p>
<p>Five models are fitted, sequentially, each building on the previous model, and compared. If in Step 1 the conclusion is that <code>theta</code> is not different from 1, all models are fitted without estimating <code>theta</code>. If, however, in Step 1 the conclusion is that <code>theta</code> is different from 1, all models are fitted by fixing <code>theta</code> to its estimate obtained in Step 1.
</p>
<p>If the experiment structural variables <code>treat</code>, <code>block</code> or <code>density</code> are specified, they will be included as an additive factor or covariate in <strong>each</strong> of the five models, but interactions between them and the DI model terms will not be included or tested. 
</p>
<p>Assume that <code>FG</code> (functional groups) have been specified. The five DI models are:
</p>

<ul>
<li> <p><code>STR</code>: This model contains an intercept, and block, density and treatment if present; STR stand for 'structural' and represents experiment structural variables. 
</p>
</li>
<li> <p><code>ID</code>: The species proportions are added to the STR model. The proportions sum to 1, and are included in the model as <code>0 + p1 + ... + ps</code>, where <em>s</em> is the number of species in the pool, as specified in the <code>prop</code> option.
</p>
</li>
<li> <p><code>AV</code>: The terms in the ID model, plus a single 'average' pairwise interaction term. For the <code>Switzerland</code> dataset, the single variable that is added to the model is computed as: <code>AV = p1*p2 + p1*p3 + p1*p4 + p2*p3 + p2*p4 + p3*p4</code>.
</p>
</li>
<li> <p><code>FG</code>: The terms in the ID model, plus interaction terms related to functional groups. These terms describe the average effects of interaction between pairs of species within each functional group, and between pairs of species from different functional groups. For example, in the <code>Switzerland</code> dataset there are  four species with <code>FG = c("Grass", "Grass", "Legume", "Legume")</code>, and there are six pairwise interactions, one between the two grasses, one between the two legumes, and four between grass and legume species. Grouping these interactions gives three terms, one for interactions between grasses, one for interactions between legumes and one for between a  grass and a legume species. The model assumes that any grass will interaction with any legume in the same way and the 'between functional group grass-legume' variable is computed as: <code>bfg_G_L = p1*p3 + p1*p4 + p2*p3 + p2*p4</code>. If there were more than two grasses in the dataset, this model would assume that any pair of grasses interact in the same way, similarly for legumes. If the <code>FG</code> argument is not specified, this model is omitted from Step 1.
</p>
</li>
<li> <p><code>FULL</code>: The terms in the ID model, plus an interaction term for each pair of species. When there are <em>s</em> species, there are <em>s*(s-1)/2</em> pairwise interaction terms, i.e., for the <code>Switzerland</code> dataset with four species, there are six interactions that are each added to the model (in R formula syntax: <code>p1:p2</code>, <code>p1:p3</code>, <code>p1:p4</code>, <code>p2:p3</code>, <code>p2:p4</code> and <code>p3:p4</code>).
</p>
</li></ul>

<p>If the <code>FG</code> argument is omitted, the <code>FG</code> model will be replaced by:
</p>

<ul>
<li> <p><code>ADD</code>: The terms in the ID model, plus a species specific 'additive' interaction term for each species. These terms measure the interactive contribution of each species with any other species and are denoted <code class="reqn">\lambda_i</code> for the <em>i</em>th species. The interaction between any pair of species <em>i</em> and <em>j</em> is computed as <code class="reqn">\lambda_i + \lambda_j</code>. 
</p>
</li></ul>

<p>If selection by information criteria is specified, both ADD and FG models will be fitted and compared using the selected information criterion.
</p>
<p><em>Step 3</em>
</p>
<p>If <code>treat</code> is specified, the selected model in Step 2 includes the <code>treat</code> variable (since all models in Step 2 include <code>treat</code> if present). Here, the selected model from Step 2 is re-fitted without <code>treat</code> and the models with and without the treatment are compared using the method specified by the <code>selection</code> argument.
</p>
<p>If <code>treat</code> was not specified, this step is redundant.
</p>
<p><em>Step 4</em> 
</p>
<p>Step 4 provides a lack of fit test for the model selected by Steps 1 to 3. A factor called 'community' is created that has a level for each unique setting of the species proportions (as specified in the <code>prop</code> argument). The 'reference' model includes all terms in the model that was selected by Steps 1 to 3, plus the factor community. The reference model is compared to the model selected by Steps 1 to 3 via an F-test (regardless of the <code>selection</code> argument value), thus providing a lack of fit test. 
</p>
<p>Note, that the reference model is never intended to be a candidate model, it is only fitted for the purpose of testing lack of fit.  If the test result is significant, it indicates that there is a lack of fit in the Diversity-Interactions model selected by <code>autoDI</code>.
</p>
<p>Note also, that the test will not work if all combinations of the species proportions are unique. In this instance, the option <code>Step4 = FALSE</code> should be selected.   
</p>


<h3>Value</h3>

<p>The function returns the final selected model, an object of class <code>DI</code>.
</p>


<h3>Author(s)</h3>

<p>Rafael A. Moral, John Connolly, Rishabh Vishwakarma and Caroline Brophy
</p>


<h3>References</h3>

<p>Connolly J, T Bell, T Bolger, C Brophy, T Carnus, JA Finn, L Kirwan, F Isbell, J Levine, A Lüscher, V Picasso, C Roscher, MT Sebastia, M Suter and A Weigelt (2013) An improved model to predict the effects of changing biodiversity levels on ecosystem function. Journal of Ecology, 101, 344-355. 
</p>
<p>Kirwan L, J Connolly, JA Finn, C Brophy, A Lüscher, D Nyfeler and MT Sebastia (2009) Diversity-interaction modelling - estimating contributions of species identities and interactions to ecosystem function. Ecology, 90, 2032-2038. 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+DI">DI</a></code>
</p>
<p>Other examples using <code>autoDI</code>: 
The <code><a href="#topic+sim1">sim1</a></code> dataset examples. 
The <code><a href="#topic+sim2">sim2</a></code> dataset examples. 
The <code><a href="#topic+sim3">sim3</a></code> dataset examples. 
The <code><a href="#topic+sim4">sim4</a></code> dataset examples. 
The <code><a href="#topic+sim5">sim5</a></code> dataset examples. 
The <code><a href="#topic+Switzerland">Switzerland</a></code> dataset examples. </p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Load the Switzerland data
  data(Switzerland)
## Summarise the Switzerland data
  summary(Switzerland)
  
## Check that the proportions sum to 1 (required for DI models)
## p1 to p4 are in the 4th to 7th columns in Switzerland
  Switzerlandsums &lt;- rowSums(Switzerland[4:7])
  summary(Switzerlandsums)
  
## Perform automated model fitting on the Switzerland dataset
  
## Model selection by F-test
  auto1 &lt;- autoDI(y = "yield", density = "density", prop = c("p1","p2","p3","p4"), 
                  treat = "nitrogen", FG = c("G", "G", "L", "L"), data = Switzerland, 
                  selection = "Ftest")
  summary(auto1)
  
## Running autoDI after grouping identity effects using the "ID" argument
  auto2 &lt;- autoDI(y = "yield", density = "density", 
                  prop = c("p1","p2","p3","p4"), 
                  treat = "nitrogen", ID = c("ID1", "ID1", "ID1", "ID1"),
                  FG = c("G", "G", "L", "L"), data = Switzerland, 
                  selection = "Ftest")
  summary(auto2)

  

## Using column numbers to indicate which columns contain the proportions and including Step 0
  auto2 &lt;- autoDI(y = "yield", density = "density", prop = 4:7, treat = "nitrogen", 
                  FG = c("G", "G", "L", "L"), data = Switzerland, selection = "Ftest", step0 = TRUE)
  summary(auto2)
    
## Exclude the FG (functional group) argument to include the additive species "ADD" model in Step 1
  auto3 &lt;- autoDI(y = "yield", density = "density", prop = 4:7, treat = "nitrogen", 
                  data = Switzerland, selection = "Ftest")
  summary(auto3)


</code></pre>

<hr>
<h2 id='Bell'>
The &quot;Bell&quot; Dataset
</h2><span id='topic+Bell'></span>

<h3>Description</h3>

<p>This dataset comes from a bacterial biodiversity experiment (Bell et al 2005). The bacterial ecosystems used were from semi-permanent rainpools that form in bark-lined depressions near the base of large European beech trees (<em>Fagus sylvatica</em>). Microcosms consisting of sterile beech leaf disks and 10 ml of liquid (phosphate buffer) were inoculated with random combinations of 72 bacterial species isolated from these ecosystems. A total of 1,374 microcosms were constructed at richness levels of 1, 2, 3, 4, 6, 8, 9, 12, 18, 24, 36 and 72 species. The daily respiration rate of the bacterial
community in each microcosm was measured over three time intervals (days 0-7, 7-14 and
14-28) and the average over the three time intervals was recorded.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("Bell")</code></pre>


<h3>Format</h3>

<p>A data frame with 1374 observations on the following 76 variables:
</p>

<dl>
<dt><code>id</code></dt><dd><p>A numeric vector uniquely identifying each row of the dataset.</p>
</dd>
<dt><code>community</code></dt><dd><p>A numeric vector identifying each unique community, i.e., two rows with the same community value also share the same set of p1 to p72 values.</p>
</dd>
<dt><code>richness</code></dt><dd><p>The number of species included in the initial composition, i.e., the number of proportions from p1 to p72 that are &gt;0.</p>
</dd>
<dt><code>p1</code></dt><dd><p>A numeric vector indicating the initial proportion of species 1 in the community.</p>
</dd>
<dt><code>p2</code></dt><dd><p>A numeric vector indicating the initial proportion of species 2 in the community.</p>
</dd>
<dt><code>p3</code></dt><dd><p>A numeric vector indicating the initial proportion of species 3 in the community.</p>
</dd>
<dt><code>p4</code></dt><dd><p>A numeric vector indicating the initial proportion of species 4 in the community.</p>
</dd>
<dt><code>p5</code></dt><dd><p>A numeric vector indicating the initial proportion of species 5 in the community.</p>
</dd>
<dt><code>p6</code></dt><dd><p>A numeric vector indicating the initial proportion of species 6 in the community.</p>
</dd>
<dt><code>p7</code></dt><dd><p>A numeric vector indicating the initial proportion of species 7 in the community.</p>
</dd>
<dt><code>p8</code></dt><dd><p>A numeric vector indicating the initial proportion of species 8 in the community.</p>
</dd>
<dt><code>p9</code></dt><dd><p>A numeric vector indicating the initial proportion of species 9 in the community.</p>
</dd>
<dt><code>p10</code></dt><dd><p>A numeric vector indicating the initial proportion of species 10 in the community.</p>
</dd>
<dt><code>p11</code></dt><dd><p>A numeric vector indicating the initial proportion of species 11 in the community.</p>
</dd>
<dt><code>p12</code></dt><dd><p>A numeric vector indicating the initial proportion of species 12 in the community.</p>
</dd>
<dt><code>p13</code></dt><dd><p>A numeric vector indicating the initial proportion of species 13 in the community.</p>
</dd>
<dt><code>p14</code></dt><dd><p>A numeric vector indicating the initial proportion of species 14 in the community.</p>
</dd>
<dt><code>p15</code></dt><dd><p>A numeric vector indicating the initial proportion of species 15 in the community.</p>
</dd>
<dt><code>p16</code></dt><dd><p>A numeric vector indicating the initial proportion of species 16 in the community.</p>
</dd>
<dt><code>p17</code></dt><dd><p>A numeric vector indicating the initial proportion of species 17 in the community.</p>
</dd>
<dt><code>p18</code></dt><dd><p>A numeric vector indicating the initial proportion of species 18 in the community.</p>
</dd>
<dt><code>p19</code></dt><dd><p>A numeric vector indicating the initial proportion of species 19 in the community.</p>
</dd>
<dt><code>p20</code></dt><dd><p>A numeric vector indicating the initial proportion of species 20 in the community.</p>
</dd>
<dt><code>p21</code></dt><dd><p>A numeric vector indicating the initial proportion of species 21 in the community.</p>
</dd>
<dt><code>p22</code></dt><dd><p>A numeric vector indicating the initial proportion of species 22 in the community.</p>
</dd>
<dt><code>p23</code></dt><dd><p>A numeric vector indicating the initial proportion of species 23 in the community.</p>
</dd>
<dt><code>p24</code></dt><dd><p>A numeric vector indicating the initial proportion of species 24 in the community.</p>
</dd>
<dt><code>p25</code></dt><dd><p>A numeric vector indicating the initial proportion of species 25 in the community.</p>
</dd>
<dt><code>p26</code></dt><dd><p>A numeric vector indicating the initial proportion of species 26 in the community.</p>
</dd>
<dt><code>p27</code></dt><dd><p>A numeric vector indicating the initial proportion of species 27 in the community.</p>
</dd>
<dt><code>p28</code></dt><dd><p>A numeric vector indicating the initial proportion of species 28 in the community.</p>
</dd>
<dt><code>p29</code></dt><dd><p>A numeric vector indicating the initial proportion of species 29 in the community.</p>
</dd>
<dt><code>p30</code></dt><dd><p>A numeric vector indicating the initial proportion of species 30 in the community.</p>
</dd>
<dt><code>p31</code></dt><dd><p>A numeric vector indicating the initial proportion of species 31 in the community.</p>
</dd>
<dt><code>p32</code></dt><dd><p>A numeric vector indicating the initial proportion of species 32 in the community.</p>
</dd>
<dt><code>p33</code></dt><dd><p>A numeric vector indicating the initial proportion of species 33 in the community.</p>
</dd>
<dt><code>p34</code></dt><dd><p>A numeric vector indicating the initial proportion of species 34 in the community.</p>
</dd>
<dt><code>p35</code></dt><dd><p>A numeric vector indicating the initial proportion of species 35 in the community.</p>
</dd>
<dt><code>p36</code></dt><dd><p>A numeric vector indicating the initial proportion of species 36 in the community.</p>
</dd>
<dt><code>p37</code></dt><dd><p>A numeric vector indicating the initial proportion of species 37 in the community.</p>
</dd>
<dt><code>p38</code></dt><dd><p>A numeric vector indicating the initial proportion of species 38 in the community.</p>
</dd>
<dt><code>p39</code></dt><dd><p>A numeric vector indicating the initial proportion of species 39 in the community.</p>
</dd>
<dt><code>p40</code></dt><dd><p>A numeric vector indicating the initial proportion of species 40 in the community.</p>
</dd>
<dt><code>p41</code></dt><dd><p>A numeric vector indicating the initial proportion of species 41 in the community.</p>
</dd>
<dt><code>p42</code></dt><dd><p>A numeric vector indicating the initial proportion of species 42 in the community.</p>
</dd>
<dt><code>p43</code></dt><dd><p>A numeric vector indicating the initial proportion of species 43 in the community.</p>
</dd>
<dt><code>p44</code></dt><dd><p>A numeric vector indicating the initial proportion of species 44 in the community.</p>
</dd>
<dt><code>p45</code></dt><dd><p>A numeric vector indicating the initial proportion of species 45 in the community.</p>
</dd>
<dt><code>p46</code></dt><dd><p>A numeric vector indicating the initial proportion of species 46 in the community.</p>
</dd>
<dt><code>p47</code></dt><dd><p>A numeric vector indicating the initial proportion of species 47 in the community.</p>
</dd>
<dt><code>p48</code></dt><dd><p>A numeric vector indicating the initial proportion of species 48 in the community.</p>
</dd>
<dt><code>p49</code></dt><dd><p>A numeric vector indicating the initial proportion of species 49 in the community.</p>
</dd>
<dt><code>p50</code></dt><dd><p>A numeric vector indicating the initial proportion of species 50 in the community.</p>
</dd>
<dt><code>p51</code></dt><dd><p>A numeric vector indicating the initial proportion of species 51 in the community.</p>
</dd>
<dt><code>p52</code></dt><dd><p>A numeric vector indicating the initial proportion of species 52 in the community.</p>
</dd>
<dt><code>p53</code></dt><dd><p>A numeric vector indicating the initial proportion of species 53 in the community.</p>
</dd>
<dt><code>p54</code></dt><dd><p>A numeric vector indicating the initial proportion of species 54 in the community.</p>
</dd>
<dt><code>p55</code></dt><dd><p>A numeric vector indicating the initial proportion of species 55 in the community.</p>
</dd>
<dt><code>p56</code></dt><dd><p>A numeric vector indicating the initial proportion of species 56 in the community.</p>
</dd>
<dt><code>p57</code></dt><dd><p>A numeric vector indicating the initial proportion of species 57 in the community.</p>
</dd>
<dt><code>p58</code></dt><dd><p>A numeric vector indicating the initial proportion of species 58 in the community.</p>
</dd>
<dt><code>p59</code></dt><dd><p>A numeric vector indicating the initial proportion of species 59 in the community.</p>
</dd>
<dt><code>p60</code></dt><dd><p>A numeric vector indicating the initial proportion of species 60 in the community.</p>
</dd>
<dt><code>p61</code></dt><dd><p>A numeric vector indicating the initial proportion of species 61 in the community.</p>
</dd>
<dt><code>p62</code></dt><dd><p>A numeric vector indicating the initial proportion of species 62 in the community.</p>
</dd>
<dt><code>p63</code></dt><dd><p>A numeric vector indicating the initial proportion of species 63 in the community.</p>
</dd>
<dt><code>p64</code></dt><dd><p>A numeric vector indicating the initial proportion of species 64 in the community.</p>
</dd>
<dt><code>p65</code></dt><dd><p>A numeric vector indicating the initial proportion of species 65 in the community.</p>
</dd>
<dt><code>p66</code></dt><dd><p>A numeric vector indicating the initial proportion of species 66 in the community.</p>
</dd>
<dt><code>p67</code></dt><dd><p>A numeric vector indicating the initial proportion of species 67 in the community.</p>
</dd>
<dt><code>p68</code></dt><dd><p>A numeric vector indicating the initial proportion of species 68 in the community.</p>
</dd>
<dt><code>p69</code></dt><dd><p>A numeric vector indicating the initial proportion of species 69 in the community.</p>
</dd>
<dt><code>p70</code></dt><dd><p>A numeric vector indicating the initial proportion of species 70 in the community.</p>
</dd>
<dt><code>p71</code></dt><dd><p>A numeric vector indicating the initial proportion of species 71 in the community.</p>
</dd>
<dt><code>p72</code></dt><dd><p>A numeric vector indicating the initial proportion of species 72 in the community.</p>
</dd>
<dt><code>response</code></dt><dd><p>A numeric vector giving the average daily respiration rate of the bacterial community.</p>
</dd> 
</dl>



<h3>Details</h3>

<p><strong>What are Diversity-Interactions (DI) models?</strong> 
</p>
<p>Diversity-Interactions (DI) models (Kirwan et al 2009) are a set of tools for analysing and interpreting data from experiments that explore the effects of species diversity on community-level responses. We strongly recommend that users read the short introduction to Diversity-Interactions models (available at: <code><a href="#topic+DImodels">DImodels</a></code>). Further information on Diversity-Interactions models is also available in Kirwan et al 2009 and Connolly et al 2013.
</p>
<p>The <code>Bell</code> dataset is analysed using Diversity-Interactions models in both Brophy et al 2017 and Connolly et al 2013. 
</p>


<h3>Source</h3>

<p>Bell T, JA Newman, BW Silverman, SL Turner and AK Lilley (2005) The contribution of species richness and composition to bacterial services. Nature, 436, 1157-1160.  
</p>


<h3>References</h3>

<p>Brophy C, A Dooley, L Kirwan, JA Finn, J McDonnell, T Bell, MW Cadotte and J Connolly (2017) Biodiversity and ecosystem function: Making sense of numerous species interactions in multi-species communities. Ecology, 98, 1771-1778. 
</p>
<p>Connolly J, T Bell, T Bolger, C Brophy, T Carnus, JA Finn, L Kirwan, F Isbell, J Levine, A Lüscher, V Picasso, C Roscher, MT Sebastia, M Suter and A Weigelt (2013) An improved model to predict the effects of changing biodiversity levels on ecosystem function. Journal of Ecology, 101, 344-355. 
</p>
<p>Kirwan L, J Connolly, JA Finn, C Brophy, A Lüscher, D Nyfeler and MT Sebastia (2009) Diversity-interaction modelling - estimating contributions of species identities and interactions to ecosystem function. Ecology, 90, 2032-2038. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Load the Bell data
  data(Bell)
## View the first five entries
  head(Bell)
## Explore the variabes in sim1
  str(Bell)

## Check that the proportions sum to 1 (required for DI models)
## p1 to p72 are in the 4th to 75th columns in Bell
  Bellsums &lt;- rowSums(Bell[4:75])
  summary(Bellsums)

## Check characteristics of Bell
  hist(Bell$response)
  summary(Bell$response)
  plot(Bell$richness, Bell$response)



## This code takes around 11 seconds to run

## Fit the average pairwise model using DI and the AV tag, with theta estimated
  m1 &lt;- DI(y = "response", prop = 4:75, DImodel = "AV", estimate_theta = TRUE, data = Bell)
  summary(m1)
  CI_95 &lt;- theta_CI(m1, conf = .95)
  CI_95
  plot(m1)
  library(hnp)
  hnp(m1)
## Graph the profile likelihood
  library(ggplot2)
  ggplot(m1$profile_loglik, aes(x = grid, y = prof)) +
    theme_bw() +
    geom_line() +
    xlim(0,1.5) +
    xlab(expression(theta)) +
    ylab("Log-likelihood") + 
    geom_vline(xintercept = CI_95, lty = 3) + 
    labs(title = "   Log-likelihood versus theta", 
         caption = "dotted vertical lines are upper and lower bounds of 95% CI for theta")


</code></pre>

<hr>
<h2 id='contrasts_DI'>
Compute contrasts for Diversity Interactions (DI) models
</h2><span id='topic+contrasts_DI'></span>

<h3>Description</h3>

<p>This function calculates and tests contrasts using <code><a href="multcomp.html#topic+glht">glht</a></code> for a model object created by the <code><a href="#topic+DI">DI</a></code> or <code><a href="#topic+autoDI">autoDI</a></code> functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>contrasts_DI(object, contrast, contrast_vars, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="contrasts_DI_+3A_object">object</code></td>
<td>
<p>A <code><a href="#topic+DI">DI</a></code> or <code><a href="#topic+autoDI">autoDI</a></code> model object.</p>
</td></tr>
<tr><td><code id="contrasts_DI_+3A_contrast">contrast</code></td>
<td>
<p>The coefficients to generate the contrast. There are three options to specify these coefficients:
</p>
<p>A list with each element being a vector of the same length as the number of linear coefficients in the model. The list can be named for tracking the contrasts.
</p>
<p>A matrix with the same number of columns as the number of linear coefficients in the model. The matrix can be given row names to track the different contrasts.
</p>
<p>A numeric vector with the length being a multiple of the number of coefficients in the matrix.
</p>
<p>Overrides <code>contrast_vars</code> if specified.</p>
</td></tr>
<tr><td><code id="contrasts_DI_+3A_contrast_vars">contrast_vars</code></td>
<td>
<p>A quicker and easier way to specify contrast coefficients for testing categorical variables. A nested named list with same names as the categorical variables in the model and same lengths as levels of those variables can be specified and the contrast will be calculated without the user having to specify the remaining variables. 
</p>
<p>Will be overridden if <code>contrast</code> is specified.
</p>
<p>Recommended for only testing cateogrical variables in the model.</p>
</td></tr>
<tr><td><code id="contrasts_DI_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to the <code><a href="multcomp.html#topic+glht">glht</a></code> function</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The contrasts are calculated and tested using the <code><a href="multcomp.html#topic+glht">glht</a></code> function in the <code>multcomp</code> package. 
</p>


<h3>Value</h3>

<p>An object of class <code><a href="multcomp.html#topic+glht">glht</a></code> is returned
</p>


<h3>Author(s)</h3>

<p>Rafael A. Moral, John Connolly, Rishabh Vishwakarma and Caroline Brophy
</p>


<h3>References</h3>

<p>Kirwan L, J Connolly, JA Finn, C Brophy, A Lüscher, D Nyfeler and MT Sebastia (2009) Diversity-interaction modelling - estimating contributions of species identities and interactions to ecosystem function. Ecology, 90, 2032-2038. 
</p>
<p>Torsten Hothorn, Frank Bretz and Peter Westfall (2008).
Simultaneous Inference in General Parametric Models.
Biometrical Journal 50(3), 346&ndash;363.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+DI">DI</a></code>
<code><a href="#topic+autoDI">autoDI</a></code>
<code><a href="multcomp.html#topic+glht">glht</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Load the Switzerland data
  data(Switzerland)
## Summarise the Switzerland data
  summary(Switzerland)

## Fit a DI model
  m1 &lt;- DI(y = "yield", prop = 4:7, treat = 'nitrogen', DImodel = 'AV',
  density = 'density', estimate_theta = FALSE, data = Switzerland)
  summary(m1)
  
## Contrasts for difference between monocultures of p1 and p2, p3 and p4, p2 and p3
  con1 &lt;- contrasts_DI(object = m1,
                       contrast = list('p1vp2 Mono' = c(1, -1, 0, 0, 0, 0, 0),
                                       'p3vp4 Mono' = c(0, 0, 1, -1, 0, 0, 0),
                                       'p2vp3 Mono' = c(0, -1, 1, 0, 0, 0, 0)))
  summary(con1)
  
## Contrasts for 50:50 mixture of p1 and p2 vs 50:50 mixture of p3 and p4  
  con2 &lt;- contrasts_DI(object = m1,
                       contrast = list('p1p2 vs p3p4' = c(0.5, 0.5, -0.5, -0.5, 0, 0, 0)))
  summary(con2)

## Example using contrast_vars
  data(sim2)

### Fit model with block
  m2 &lt;- DI(y = "response", prop = 3:6, DImodel = 'FULL', block = 'block',
           estimate_theta = FALSE, data = sim2)
  summary(m2)
  
### contrast for average of first two blocks vs third block
  con3 &lt;- contrasts_DI(object = m2,
                       contrast_vars = list('block' = list('1_2vs3' = c(0.5, 0.5, -1, 0))))
  summary(con3)
</code></pre>

<hr>
<h2 id='describe_model'>
Describe DI models
</h2><span id='topic+describe_model'></span>

<h3>Description</h3>

<p>This function accepts a DImodel (i.e., regression models fit using the <code><a href="#topic+DI">DI</a></code> or <code><a href="#topic+autoDI">autoDI</a></code> functions) object and returns a short text summary describing the model. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>describe_model(model)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="describe_model_+3A_model">model</code></td>
<td>
<p>A <code><a href="#topic+DI">DI</a></code> or <code><a href="#topic+autoDI">autoDI</a></code> regression model object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A short text describing the supplied DImodel object.
</p>


<h3>Author(s)</h3>

<p>Rafael A. Moral, John Connolly, Rishabh Vishwakarma and Caroline Brophy
</p>


<h3>References</h3>

<p>Kirwan L, J Connolly, JA Finn, C Brophy, A Lüscher, D Nyfeler and MT Sebastia (2009) Diversity-interaction modelling - estimating contributions of species identities and interactions to ecosystem function. Ecology, 90, 2032-2038. 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+DI">DI</a></code>
<code><a href="#topic+autoDI">autoDI</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Load the  data
   data(sim2)
## Fit model
   mod_FG &lt;- DI(y = "response", FG = c("G", "G", "L", "L"), 
                prop = 3:6, data = sim2, DImodel = "FG")
## Describe model
   describe_model(mod_FG)


   mod_FULL &lt;- DI(y = "response", estimate_theta = TRUE, 
                  prop = 3:6, data = sim2, DImodel = "FULL")
   describe_model(mod_FULL)

   mod_AV &lt;- DI(y = "response", ID = c("ID1", "ID1", "ID2", "ID2"),
                estimate_theta = TRUE, 
                prop = 3:6, data = sim2, DImodel = "AV")
   describe_model(mod_AV)
</code></pre>

<hr>
<h2 id='design_a'>
The &quot;design_a&quot; Dataset
</h2><span id='topic+design_a'></span>

<h3>Description</h3>

<p>This dataset contains a set of proportions <code>p1</code> to <code>p9</code> where each row sums to 1. It is used as the design matrix for simulating other datasets in the <code>DImodels</code> package.  
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("design_a")</code></pre>


<h3>Format</h3>

<p>A data frame with 206 observations on the following 11 variables:
</p>

<dl>
<dt><code>community</code></dt><dd><p>A numeric vector identifying each unique community, i.e., two rows with the same community value also share the same set of p1 to p9 values.</p>
</dd>
<dt><code>richness</code></dt><dd><p>A numeric vector indicating the number of species in the initial composition, i.e., the number of proportions from p1 to p9 that are &gt;0.</p>
</dd>
<dt><code>p1</code></dt><dd><p>A numeric vector indicating a proportion (of species 1).</p>
</dd>
<dt><code>p2</code></dt><dd><p>A numeric vector indicating a proportion (of species 2).</p>
</dd>
<dt><code>p3</code></dt><dd><p>A numeric vector indicating a proportion (of species 3).</p>
</dd>
<dt><code>p4</code></dt><dd><p>A numeric vector indicating a proportion (of species 4).</p>
</dd>
<dt><code>p5</code></dt><dd><p>A numeric vector indicating a proportion (of species 5).</p>
</dd>
<dt><code>p6</code></dt><dd><p>A numeric vector indicating a proportion (of species 6).</p>
</dd>
<dt><code>p7</code></dt><dd><p>A numeric vector indicating a proportion (of species 7).</p>
</dd>
<dt><code>p8</code></dt><dd><p>A numeric vector indicating a proportion (of species 8).</p>
</dd>
<dt><code>p9</code></dt><dd><p>A numeric vector indicating a proportion (of species 9).</p>
</dd>
</dl>



<h3>Details</h3>

<p>The columns p1 to p9 form a simplex space.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Load the design_a data
  data(design_a)
## View the first five entries
  head(design_a)
## Explore the variables in design_a
  str(design_a)

## Check that the proportions sum to 1 (required for DI models)
## p1 to p9 are in the 3rd to 11th columns in design_a
  design_a_sums &lt;- rowSums(design_a[3:11])
  summary(design_a_sums)
  
</code></pre>

<hr>
<h2 id='design_b'>
The &quot;design_b&quot; Dataset
</h2><span id='topic+design_b'></span>

<h3>Description</h3>

<p>This dataset contains a set of proportions <code>p1</code> to <code>p6</code> where each row sums to 1. It is used as the design matrix for simulating other datasets in the <code>DImodels</code> package.  
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("design_b")</code></pre>


<h3>Format</h3>

<p>A data frame with 47 observations on the following seven variables:
</p>

<dl>
<dt><code>richness</code></dt><dd><p>A numeric vector indicating the number of species in the initial composition, i.e., the number of proportions from p1 to p6 that are &gt;0.</p>
</dd>
<dt><code>p1</code></dt><dd><p>A numeric vector indicating a proportion (of species 1).</p>
</dd>
<dt><code>p2</code></dt><dd><p>A numeric vector indicating a proportion (of species 2).</p>
</dd>
<dt><code>p3</code></dt><dd><p>A numeric vector indicating a proportion (of species 3).</p>
</dd>
<dt><code>p4</code></dt><dd><p>A numeric vector indicating a proportion (of species 4).</p>
</dd>
<dt><code>p5</code></dt><dd><p>A numeric vector indicating a proportion (of species 5).</p>
</dd>
<dt><code>p6</code></dt><dd><p>A numeric vector indicating a proportion (of species 6).</p>
</dd>
</dl>



<h3>Details</h3>

<p>The columns p1 to p6 form a simplex space.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Load the design_b data
  data(design_b)
## View the first five entries
  head(design_b)
## Explore the variables in design_b
  str(design_b)
  
## Check that the proportions sum to 1 (required for DI models)
## p1 to p6 are in the 2nd to 7th columns in design_b
  design_b_sums &lt;- rowSums(design_b[2:7])
  summary(design_b_sums)
  
</code></pre>

<hr>
<h2 id='DI'>
Diversity-Interactions Model Fitting
</h2><span id='topic+DI'></span><span id='topic+DI_ADD_treat'></span><span id='topic+DI_ADD'></span><span id='topic+DI_FULL_treat'></span><span id='topic+DI_FULL'></span><span id='topic+DI_AV_treat'></span><span id='topic+DI_AV'></span><span id='topic+DI_CUSTOM'></span><span id='topic+DI_E_treat'></span><span id='topic+DI_E'></span><span id='topic+DI_FG_treat'></span><span id='topic+DI_FG'></span><span id='topic+DI_ID_treat'></span><span id='topic+DI_ID'></span><span id='topic+DI_STR_treat'></span><span id='topic+DI_STR'></span><span id='topic+DI_theta'></span>

<h3>Description</h3>

<p>This function will fit a wide range of Diversity-Interactions (DI) models, one at a time. It provides some assisted automated ways to fit DI models, and includes the flexibility to extend DI models in several directions.  
</p>


<h3>Usage</h3>

<pre><code class='language-R'>DI(y, prop, DImodel, custom_formula, data,
   block, density, treat, ID, FG, extra_formula,
   estimate_theta = FALSE, theta = 1)
</code></pre>


<h3>Arguments</h3>

<p>The minimum required arguments to use DI are either: 
</p>

<ul>
<li><p> Argument <code>DImodel</code> with <code>data</code>, <code>y</code> and <code>prop</code>, or 
</p>
</li>
<li><p> Argument <code>custom_formula</code> with <code>data</code>.
</p>
</li></ul>

<p>The <code>DImodel</code> argument allows fitting of DI models via a range of 'tag' options that determine the form of the species interactions terms (the tags, described below, are <code>STR</code>, <code>ID</code>, <code>AV</code>, <code>FG</code>, <code>ADD</code> and <code>FULL</code>) and extra terms can be added to the model using the <code>extra_formula</code> argument. Using the argument <code>custom_formula</code> requires full specification of the model to be fitted using standard <code>lm</code> or <code>glm</code> syntax. 
</p>
<table>
<tr><td><code id="DI_+3A_y">y</code></td>
<td>

<p>The column name of the response vector, which must be in quotes, for example, <code>y = "yield"</code>.
</p>
</td></tr>
<tr><td><code id="DI_+3A_block">block</code></td>
<td>

<p>The name of the block variable (if present), which must be in quotes, for example, <code>block = "block"</code>. If no blocking variable, omit this argument.
</p>
</td></tr>
<tr><td><code id="DI_+3A_density">density</code></td>
<td>

<p>The name of the density variable (if present), which must be in quotes, for example, <code>density = "density"</code>. If no density variable, omit this argument.
</p>
</td></tr>
<tr><td><code id="DI_+3A_prop">prop</code></td>
<td>

<p>A vector of <em>s</em> column names identifying the species proportions in each community in the dataset. For example, if the species proportions columns are labelled p1 to p4, then <code>prop = c("p1","p2","p3","p4")</code>. Alternatively, the column numbers can be specified, for example, <code>prop = 4:7</code>, where species proportions are in the 4th to 7th columns.
</p>
</td></tr>
<tr><td><code id="DI_+3A_treat">treat</code></td>
<td>

<p>The name of a column in the dataset containing the value of a treatment factor or covariate. The treatment name must be included in quotes, for example, <code>treat = "nitrogen"</code>. If the treatment is a factor, the variable must already be specified as a factor prior to using <code>DI</code>. 
</p>

<ul>
<li> 
<p>When used in conjunction with <code>DImodel</code>, the treatment will be included in the model as an additive factor or covariate, for example, specifying <code>treat = nitrogen, DImodel = ID</code> will fit the model <code>p1 + p2 + ... + ps + nitrogen</code>. Additional treatments, or interactions between the treatment and other model terms can be included via the <code>extra_formula</code> argument.
</p>
</li>
<li><p> The <code>treat</code> argument is defunct when using the <code>custom_formula</code> argument, and any treatment must be included directly in the <code>custom_formula</code> argument.
</p>
</li></ul>

</td></tr>
<tr><td><code id="DI_+3A_id">ID</code></td>
<td>


<p>This argument takes a text list (of length <em>s</em>) dsecirbing groupings for the identity effects of the species. For example, if there are four species and you wish to group the identity effects all four species into a single term: <code>ID</code> could be <code>ID = c("ID1","ID1","ID1","ID1")</code>, where &quot;ID1&quot; is the name of the ID group. Similarly if the we wish to have two identity effect groups where identity effect of species 1 and 3, and species 2 and 4 are grouped together: <code>ID</code> could be <code>ID = c("ID1","ID2","ID1","ID2")</code>, where &quot;ID1&quot; and &quot;ID2&quot; are the names of the ID groups. These ideas expand to any number of species and any number or combination of groups. Finally, the ID groups do not have to be named &quot;ID1&quot; and &quot;ID2&quot;, the user can specify any name for the groups.
</p>

<ul>
<li><p> If the <code>ID</code> argument is not specified, each species will be assumed to have a separate identity effect. 
</p>
</li>
<li><p> Specify an grouping for the ID does not affect the interaction terms. The interactions are still calculated using the individual species proportions.
</p>
</li>
<li><p> The <code>ID</code> argument is defunct when using the <code>custom_formula</code> argument, since species identity effects must be included directly in the <code>custom_formula</code> argument. 
</p>
</li></ul>

</td></tr>
<tr><td><code id="DI_+3A_fg">FG</code></td>
<td>


<p>If species are classified by <em>g</em> functional groups, this argument takes a text list (of length <em>s</em>) of the functional group to which each species belongs. For example, for four grassland species with two grasses and two legumes: FG could be <code>FG = c("G","G","L","L")</code>, where G stands for grass and L stands for legume.
</p>

<ul>
<li><p> The <code>FG</code> argument is required if <code>DImodel = "FG"</code> is specified. 
</p>
</li>
<li><p> The <code>FG</code> argument is defunct when using the <code>custom_formula</code> argument, since species interactions must be included directly in the <code>custom_formula</code> argument. 
</p>
</li></ul>

</td></tr>
<tr><td><code id="DI_+3A_dimodel">DImodel</code></td>
<td>

<p>This argument is chosen (over <code>custom_formula</code>) to fit an automated version of a DI model. The chosen tag determines the form of the species interactions to be included in the model. The tags (or options) are: 
</p>

<ul>
<li> <p><code>STR</code> (no identity or interaction effects, only an intercept is fitted, plus the experiment structural variables <code>block</code>, <code>density</code> and <code>treat</code>, if specified).  
</p>
</li></ul>

<p>Each of the following includes the species proportions as specified in <code>prop</code>, the interaction variables according to the tag, plus <code>block</code>, <code>density</code> and <code>treat</code> if specified. 
</p>

<ul>
<li> <p><code>ID</code> (no interaction terms),  
</p>
</li>
<li> <p><code>AV</code> (a single average species pairwise interaction variable),  
</p>
</li>
<li> <p><code>FG</code> (functional group interaction variables, the <code>FG</code> argument must be specified to use this option),  
</p>
</li>
<li> <p><code>ADD</code> (the additive species interaction variables),  
</p>
</li>
<li> <p><code>FULL</code> (all pairwise interaction variables). 
</p>
</li></ul>

<p>The DImodel tag should appear in quotes, for example, <code>DImodel = "STR"</code>.
</p>
</td></tr>
<tr><td><code id="DI_+3A_extra_formula">extra_formula</code></td>
<td>

<p>In conjunction with <code>DImodel</code>, additional terms can be added using <code>extra_formula</code>. A <code>~</code> must be included before specifying the terms. For example, if <code>DImodel = "AV"</code> has been specified, adding <code>extra_formula = ~ I(AV**2)</code> will add a quadratic average pairwise interaction variable or <code>extra_formula = ~ treatment:AV</code> will add an interaction between the average pairwise species interaction variable and the treatment. Any variable included directly in <code>extra_formula</code> must already be contained in the dataset (interaction variables can be created using the function <code><a href="#topic+DI_data">DI_data</a></code>, if required).  
</p>
</td></tr>
<tr><td><code id="DI_+3A_custom_formula">custom_formula</code></td>
<td>

<p>To specify your own DI model, write your own model formula using the <code>custom_formula</code> argument. The standard notation from <code>lm</code> and <code>glm</code> is used here, for example, <code>custom_formula = yield ~ 0 + p1:treatment + p2:treatment + p3:treatment + p4:treatment</code> will fit the DI model with the identity effects each crossed with treatment, where treatment is a variable in the dataset. The <code>custom_formula</code> argument is recommended when the <code>DImodel</code> and <code>extra_formula</code> arguments are not sufficient. Any variable included directly in <code>custom_formula</code> must be already contained in the dataset (interaction variables can be created using the function <code><a href="#topic+DI_data">DI_data</a></code>, if required).  
</p>
</td></tr>
<tr><td><code id="DI_+3A_data">data</code></td>
<td>

<p>Specify the dataset, for example, <code>data = Switzerland</code>. The dataset name should not appear in quotes.
</p>
</td></tr>
<tr><td><code id="DI_+3A_estimate_theta">estimate_theta</code></td>
<td>

<p>By default, theta (the power parameter on all <code class="reqn">pi*pj</code> components of each interaction variable in the model) is set equal to one. Specify <code>estimate_theta = TRUE</code> to include the estimation of <code class="reqn">\theta</code> in the specified model. The <code>estimate_theta</code> argument can only be used in conjunction with the <code>DImodel</code> argument; if the <code>custom_formula</code> is used, then theta estimation is not available and the default <code>estimate_theta = FALSE</code> must be used. 
</p>
</td></tr>
<tr><td><code id="DI_+3A_theta">theta</code></td>
<td>

<p>Users may specify a value of theta different than 1 to fit the DI model. Note that if <code>estimate_theta = TRUE</code>, then theta will be estimated via maximum profile log-likelihood and the value specified for <code>theta</code> will be overridden.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>What are Diversity-Interactions models?</strong> 
</p>
<p>Diversity-Interactions (DI) models (Kirwan et al 2009) are a set of tools for analysing and interpreting data from experiments that explore the effects of species diversity on community-level responses. We recommend that users of the <code>DImodels</code> package read the short introduction to DI models (available at: <code><a href="#topic+DImodels">DImodels</a></code>). Further information on DI models is available in Kirwan et al 2009 and Connolly et al 2013.
</p>
<p><strong>Checks on data prior to using <code>DI</code>.</strong> 
</p>
<p>Before using <code>DI</code>, check that the species proportions for each row in your dataset sum to one. See the 'Examples' section for code to do this. An error message will be generated if the proportions don't sum to one.  
</p>
<p><strong>How does the <code>DI</code> function work?</strong> 
</p>
<p>The <code>DI</code> function provides wide flexibility in the types of Diversity-Interactions (DI) models that can be fitted. There are two ways to fit models in <code>DI</code>: 1) using <code>DImodel</code>, possibly augmented by <code>extra_formula</code>, or 2) using <code>custom_formula</code>. Models are estimated using iteratively reweighted least squares, via the <code><a href="stats.html#topic+glm">glm</a></code> package, when the option <code>estimate_theta = FALSE</code>. 
</p>
<p>Consider the following DI model, for example (in R formula syntax):  
<code>y ~ p1 + p2 + p3 + treatment + p1:p2 + p1:p3 + p2:p3 + p1:p2:treatment + p1:p3:treatment + p2:p3:treatment</code> 
</p>
<p>This model can be fitted using <code>DImodel</code> and <code>extra_formula</code>:  
<code>DI(y = "y", prop = c("p1", "p2", "p3"), treat = "nitrogen", DImodel = "FULL", extra_formula = ~ p1:p2:treatment + p1:p3:treatment + p2:p3:treatment, data = datasetname)</code> 
</p>
<p>or, by specifying all of the terms in the model using <code>custom_formula</code>: 
<code>DI(custom_formula = y ~ p1 + p2 + p3 + treatment + p1:p2 + p1:p3 + p2:p3 + p1:p2:treatment + p1:p3:treatment + p2:p3:treatment, data = datasetname)</code> 
</p>
<p>We recommend to use <code>DImodel</code> where possible, to augment with <code>extra_formula</code> where required, and to only use <code>custom_formula</code> when <code>DImodel</code> plus <code>extra_formula</code> is insufficient.  
</p>
<p><strong>Including theta in DI models</strong> 
</p>
<p>A non-linear parameter <code class="reqn">\theta</code> can be included in DI models as a power on all <code class="reqn">pi*pj</code> components of each pairwise interaction variable. For example (in R formula syntax): 
<code>y ~ p1 + p2 + p3 + (p1:p2)^theta + (p1:p3)^theta + (p2:p3)^theta</code>  
for the full pairwise interaction model. Including <code class="reqn">\theta</code> alters the contribution of the interaction term to the response (Connolly et al 2013).  
</p>
<p>By default, the value of <code class="reqn">\theta</code> is 1. By specifying <code>estimate_theta = TRUE</code> within <code>DI</code>, a value of <code class="reqn">\theta</code> will be estimated using profile likelihood over the space <code class="reqn">\theta</code> = 0.01 to 1.5. The option <code>estimate_theta = TRUE</code> can only be used with <code>DImodel</code>, it is not available when using <code>custom_formula</code>.
</p>
<p>As a general guideline to testing if <code class="reqn">\theta</code> is required, we recommend:
</p>
<p>1) finding the best form of the species interaction terms assuming theta = 1, and then,
</p>
<p>2) testing if theta differs from 1.
</p>
<p>If no species interaction terms are needed, then there is no need to do any testing for theta.
</p>


<h3>Value</h3>

<p>A model object of class <code>"glm"</code> including the components detailed in <code><a href="stats.html#topic+glm">glm</a></code>, plus the following:
</p>
<table>
<tr><td><code>DIcall</code></td>
<td>
<p>the call of the <code>DI</code> function</p>
</td></tr>
<tr><td><code>DIinternalcall</code></td>
<td>
<p>an internal call made within the DI model fitting process</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Rafael A. Moral, John Connolly and Caroline Brophy
</p>


<h3>References</h3>

<p>Connolly J, T Bell, T Bolger, C Brophy, T Carnus, JA Finn, L Kirwan, F Isbell, J Levine, A Lüscher, V Picasso, C Roscher, MT Sebastia, M Suter and A Weigelt (2013) An improved model to predict the effects of changing biodiversity levels on ecosystem function. Journal of Ecology, 101, 344-355. 
</p>
<p>Kirwan L, J Connolly, JA Finn, C Brophy, A Lüscher, D Nyfeler and MT Sebastia (2009) Diversity-interaction modelling - estimating contributions of species identities and interactions to ecosystem function. Ecology, 90, 2032-2038. 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+autoDI">autoDI</a></code> 
<code><a href="#topic+theta_CI">theta_CI</a></code>
</p>
<p>Other examples using <code>DI</code>: 
The <code><a href="#topic+Bell">Bell</a></code> dataset examples. 
The <code><a href="#topic+sim1">sim1</a></code> dataset examples. 
The <code><a href="#topic+sim2">sim2</a></code> dataset examples. 
The <code><a href="#topic+sim3">sim3</a></code> dataset examples. 
The <code><a href="#topic+sim4">sim4</a></code> dataset examples. 
The <code><a href="#topic+sim5">sim5</a></code> dataset examples. 
The <code><a href="#topic+Switzerland">Switzerland</a></code> dataset examples. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'> 

## Load the Switzerland data
data(Switzerland)

## Check that the proportions sum to 1 (required for DI models)
## p1 to p4 are in the 4th to 7th columns in Switzerland
Switzerlandsums &lt;- rowSums(Switzerland[4:7])
summary(Switzerlandsums)

## Fit the a simple AV DImodel with theta = 1
mod &lt;- DI(y = "yield", prop = c("p1", "p2", "p3", "p4"), 
          DImodel = "AV", data = Switzerland)
summary(mod)

## Fit the same model but group the 4 species identity effect into 2 groups
mod &lt;- DI(y = "yield", prop = c("p1", "p2", "p3", "p4"), 
          ID = c("ID1", "ID1", "ID2", "ID2"), DImodel = "AV", 
          data = Switzerland)
summary(mod)

## Combine the four identity effects into a single term and estimate theta
mod &lt;- DI(y = "yield", prop = c("p1", "p2", "p3", "p4"), 
          ID = c("ID1", "ID1", "ID1", "ID1"), DImodel = "AV", 
          estimate_theta = TRUE, data = Switzerland)
summary(mod)

## Fit the FG DImodel, with factors density and treatment, and with theta = 1
m1 &lt;- DI(y = "yield", density = "density", prop = 4:7, treat = "nitrogen", 
         FG = c("G","G","L","L"), DImodel = "FG", data = Switzerland)
summary(m1)

## Fit the FG DImodel, with factors density and treatment, and a fixed value of theta not equal to 1
m2 &lt;- DI(y = "yield", density = "density", prop = 4:7, treat = "nitrogen", 
         FG = c("G","G","L","L"), DImodel = "FG", data = Switzerland, 
         theta = 0.5)
summary(m2)

## Test if the identity effects interact with nitrogen (and main effect of nitrogen excluded)
m3 &lt;- DI(y = "yield", density = "density", prop = 4:7, FG = c("G", "G", "L", "L"), DImodel = "FG", 
         extra_formula = ~ (p1 + p2 + p3 + p4):nitrogen, data = Switzerland)
summary(m3)

## Fit the average pairwise model and check for a quadratic term using extra_formula.
## Need to create AV variable to be included in extra_formula and put in new dataset Switzerland2.
  AV_variable &lt;- DI_data(prop = c("p1","p2","p3","p4"), data = Switzerland, what = "AV")
  Switzerland2 &lt;- data.frame(Switzerland, "AV" = AV_variable)
  m4 &lt;- DI(y = "yield", density = "density", prop = 4:7, DImodel = "AV", 
           extra_formula = ~ I(AV**2), data = Switzerland2)
  summary(m4)

## Using the custom_formula option to fit some, but not all, of the FG interactions.
## Fit the FG DImodel using custom_formula, with factors density and treatment, and theta = 1.
## Need to create functional group interaction variables for inclusion in custom_formulaand put
##  in new dataset Switzerland3.
  FG_matrix &lt;- DI_data(prop = 4:7, FG = c("G","G","L","L"), data = Switzerland, what = "FG")
  Switzerland3 &lt;- data.frame(Switzerland, FG_matrix)
  m5 &lt;- DI(y = "yield", prop = c("p1","p2","p3","p4"), 
           custom_formula = yield ~ 0 + p1 + p2 + p3 + p4 + bfg_G_L + wfg_G 
           + density + nitrogen,
           data = Switzerland3)
  summary(m5)

</code></pre>

<hr>
<h2 id='DI_compare'>
Compare a Fitted Diversity-Interactions Model to the Reference Model
</h2><span id='topic+DI_compare'></span>

<h3>Description</h3>

<p>This function fits the reference model internally and compares a DI model fit to it using <code>anova</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>DI_compare(model, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="DI_compare_+3A_model">model</code></td>
<td>
<p>A DI model object.</p>
</td></tr>
<tr><td><code id="DI_compare_+3A_...">...</code></td>
<td>
<p>Further arguments passed to <code>anova</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

 
<p>This function takes a DI model object as input, fits the reference model internally and compares the two models using <code>anova</code>. The reference model includes an additive effect of community (each unique combination of species proportions) in the linear predictor. For more details on the reference model, see Connolly et al. (2013).
</p>


<h3>Value</h3>

<p>The function returns the reference model, a <code>glm</code> model object.
</p>


<h3>Author(s)</h3>

<p>Rafael A. Moral, John Connolly and Caroline Brophy
</p>


<h3>References</h3>

<p>Connolly J, T Bell, T Bolger, C Brophy, T Carnus, JA Finn, L Kirwan, F Isbell, J Levine, A Lüscher, V Picasso, C Roscher, MT Sebastia, M Suter and A Weigelt (2013) An improved model to predict the effects of changing biodiversity levels on ecosystem function. Journal of Ecology, 101, 344-355.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+DI">DI</a></code>
<code><a href="#topic+autoDI">autoDI</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Load the sim1 data
  data(sim1)

## Fit the FULL model
  m1 &lt;- DI(y = "response", block = "block", prop = 3:6, 
           DImodel = "FULL", data = sim1)

## Compare with the reference model
  DI_compare(m1, test = "F")

</code></pre>

<hr>
<h2 id='DI_data_manipulation'>
Data manipulation function
</h2><span id='topic+DI_data_manipulation'></span><span id='topic+DI_data'></span><span id='topic+DI_data_ADD'></span><span id='topic+DI_data_E_AV'></span><span id='topic+DI_data_FG'></span><span id='topic+DI_data_prepare'></span><span id='topic+DI_data_fullpairwise'></span>

<h3>Description</h3>

<p>This function can be used to compute additional variables for the various types of interactions among pairs of species proportions. These variables are defined following Kirwan et al 2007 and 2009, and Connolly et al 2013. 
</p>
<p>The variables are denoted:  
</p>
<p><code>AV</code> and <code>E</code>: the average pairwise interaction variable (AV) and a scaled version of it (E), each a single variable. The variable AV is the sum of products of the  proportions of each pair of species in the mixture. The variable E is a scaled version of AV that ranges between 0 (for a monoculture community) to 1 for the equi-proportional mixture of all species in the pool.  
</p>
<p><code>FG</code>: the functional group interaction variables. There is a variable for (within) each functional group and one for (between) each pair of functional groups, i.e., if there are two functional groups, there will be three functional group interaction variables, while if there are three functional groups, there will be six functional group interaction variables.  
</p>
<p><code>ADD</code>: the additive species interaction variables, one for each species. 
</p>
<p><code>FULL</code>: all individual pairwise interactions. There will be <code class="reqn">s*(s-1)/2</code> new variables created, where <em>s</em> is the number of species in the pool.
</p>
<p>By default, the interaction variables described above are created with <code>theta = 1</code>, but a different value of theta can also be specified (Connolly et al 2013). 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>DI_data(prop, FG, data, theta = 1, what = c("E","AV","FG","ADD","FULL"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="DI_data_manipulation_+3A_prop">prop</code></td>
<td>
 
<p>A vector of column names identifying the species proportions in the dataset. For example, if the species proportions columns are labelled p1 to p4, then <code>prop = c("p1","p2","p3","p4")</code>. The column numbers in which the proportions are stored can also be referred to, for example,  <code>prop = 4:7</code> for the <code>Switzerland</code> data.
</p>
</td></tr>
<tr><td><code id="DI_data_manipulation_+3A_fg">FG</code></td>
<td>

<p>If species are classified by <em>g</em> functional groups, this argument takes a text list (of length <em>s</em>) of the functional group to which each species belongs. For example, for four grassland species with two grasses and two legumes, it could be <code>FG = c("G","G","L","L")</code>, where G stands for grass and L stands for legume. This argument is required when <code>"FG"</code> is included in the <code>what</code> argument. 
</p>
</td></tr>
<tr><td><code id="DI_data_manipulation_+3A_data">data</code></td>
<td>

<p>Specify the dataset, for example, <code>data = Switzerland</code>. The dataset name should not appear in quotes. 
</p>
</td></tr>
<tr><td><code id="DI_data_manipulation_+3A_theta">theta</code></td>
<td>

<p>Interaction variables will be computed with the theta power, equal to the value specified, on all <code class="reqn">pi*pj</code> components of each interaction variable, with default value one. For example, with three species <code>AV = p1*p2 + p1*p3 + p2*p3</code> and if computed with <code>theta</code> = 0.5, this becomes <code>(p1*p2)^0.5 + (p1*p3)^0.5 + (p2*p3)^0.5</code>.
</p>
</td></tr>
<tr><td><code id="DI_data_manipulation_+3A_what">what</code></td>
<td>

<p>The interactions to be computed. By default each set of variables will be computed: AV, E, FG (if <code>FG</code> argument specified), ADD and FULL. Individual sets can be selected. For example, <code>what = c("FULL")</code> or <code>what = c("AV", "FULL")</code>.  
</p>
</td></tr>
</table>


<h3>Details</h3>

 
<p><strong>What are Diversity-Interactions models?</strong> 
</p>
<p>Diversity-Interactions (DI) models (Kirwan et al 2009) are a set of tools for analysing and interpreting data from experiments that explore the effects of species diversity on community-level responses. We recommend that users of the <code>DImodels</code> package read the short introduction to DI models (available at: <code><a href="#topic+DImodels">DImodels</a></code>). Further information on DI models is available in Kirwan et al 2009 and Connolly et al 2013.
</p>
<p><strong>Checks on data prior to using the <code>DI_data</code> function.</strong> 
</p>
<p>Before using the <code>DI_data</code> function, check that the species proportions in each row of your dataset sum to one. See the 'Examples' section for code to do this. An error message will be generated if the proportions don't sum to one. 
</p>
<p><strong>When is the <code>DI_data</code> function needed?</strong> 
</p>
<p>It is not required to use the <code>DI_data</code> function if using the <code>autoDI</code> function, or the <code>DImodel</code> option in the <code>DI</code> function, as they will automatically create the species interaction variables needed. If using species interaction variables in the <code>extra_formula</code> or <code>custom_formula</code> options in <code>DI</code>, then it is required to have the variables already in the dataset and <code>DI_data</code> can do that.  
</p>
<p><strong>Short worked example to illustrate how the <code>DI_data</code> function works</strong> 
</p>
<p>The code to implement this example is provided in the 'Examples' section. 
</p>
<p>Assume four species with initial proportions in two communities: (0.1, 0.2, 0.3, 0.4) and (0.25, 0.25, 0.25, 0.25), with <code>FG = c("G","G","L","L")</code>. 
</p>
<p>For community 1: (0.1,0.2,0.3,0.4), assuming theta = 1, the data preparation functions will compute the following additional variables (details in Kirwan et al 2007 and 2009): 
</p>
<p>AV = 0.1*0.2 + 0.1*0.3 + 0.1*0.4 + 0.2*0.3 + 0.2*0.4 + 0.3*0.4 = 0.35
</p>
<p>E = <em>(2s/(s-1))</em>*AV = 0.9333
</p>
<p>p1_add = 0.1 * (1 - 0.1) = 0.09
</p>
<p>p2_add = 0.2 * (1 - 0.2) = 0.16
</p>
<p>p3_add = 0.3 * (1 - 0.3) = 0.21
</p>
<p>p4_add = 0.4 * (1 - 0.4) = 0.24
</p>
<p>bfg_G_L = 0.1*0.3 + 0.1*0.4 + 0.2*0.3 + 0.2*0.4 = 0.21
</p>
<p>wfg_G = 0.1*0.2 = 0.02
</p>
<p>wfg_L = 0.3*0.4 = 0.12
</p>
<p>For community 1: (0.1,0.2,0.3,0.4), assuming theta = 0.5, the data preparation functions will compute the follow additional variables (details in Connolly et al 2013): 
</p>
<p>AV = (0.1*0.2)^0.5 + (0.1*0.3)^0.5 + (0.1*0.4)^0.5 + (0.2*0.3)^0.5 + (0.2*0.4)^0.5 + (0.3*0.4)^0.5 = 1.3888
</p>
<p>E =<em>(2s/(s-1))</em>*AV = 3.7035
</p>
<p>p1_add = 0.1^0.5 * (0.2^0.5 + 0.3^0.5 + 0.4^0.5) = 0.5146
</p>
<p>p2_add = 0.2^0.5 * (0.1^0.5 + 0.3^0.5 + 0.4^0.5) = 0.6692
</p>
<p>p3_add = 0.3^0.5 * (0.1^0.5 + 0.2^0.5 + 0.4^0.5) = 0.7646
</p>
<p>p4_add = 0.4^0.5 * (0.1^0.5 + 0.2^0.5 + 0.3^0.5) = 0.8293
</p>
<p>bfg_G_L = (0.1*0.3)^0.5 + (0.1*0.4)^0.5 + (0.2*0.3)^0.5 + (0.2*0.4)^0.5 = 0.9010
</p>
<p>wfg_G = (0.1*0.2)^0.5 = 0.1414
</p>
<p>wfg_L = (0.3*0.4)^0.5 = 0.3464  
</p>
<p>When using the <code>DI_data</code> function to create interactions for theta values for a value different from 1, it is recommended to rename the new interaction variables to include <code>_theta</code>. 
</p>
<p>The data manipulation values for community 2 (0.25, 0.25, 0.25,0.25) can be seen when the 'Examples' section code is run.
</p>


<h3>Value</h3>

<p><code>DI_data</code> returns a named list with one or more the following components (depending on the specification of the <code>what</code> argument:
</p>
<table>
<tr><td><code>E</code></td>
<td>
<p>a numeric vector containing the evenness interaction variable</p>
</td></tr>
<tr><td><code>AV</code></td>
<td>
<p>a numeric vector containing the average pairwise interaction variable</p>
</td></tr>
<tr><td><code>FG</code></td>
<td>
<p>a matrix containing the functional group-related interaction variables</p>
</td></tr>
<tr><td><code>ADD</code></td>
<td>
<p>a matrix containing the additive species contributions interaction variables</p>
</td></tr>
<tr><td><code>FULL</code></td>
<td>
<p>a matrix containing all pairwise interactions</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Rafael A. Moral, John Connolly and Caroline Brophy
</p>


<h3>References</h3>

<p>Connolly J, T Bell, T Bolger, C Brophy, T Carnus, JA Finn, L Kirwan, F Isbell, J Levine, A Lüscher, V Picasso, C Roscher, MT Sebastia, M Suter and A Weigelt (2013) An improved model to predict the effects of changing biodiversity levels on ecosystem function. Journal of Ecology, 101, 344-355. 
</p>
<p>Kirwan L, A Lüscher, MT Sebastia, JA Finn, RP Collins, C Porqueddu, A Helgadottir, OH Baadshaug, C Brophy, C Coran, S Dalmannsdottir, I Delgado, A Elgersma, M Fothergill, BE Frankow-Lindberg, P Golinski, P Grieu, AM Gustavsson, M Höglind, O Huguenin-Elie, C Iliadis, M Jørgensen, Z Kadziuliene, T Karyotis, T Lunnan, M Malengier, S Maltoni, V Meyer, D Nyfeler, P Nykanen-Kurki, J Parente, HJ Smit, U Thumm, &amp; J Connolly (2007) Evenness drives consistent diversity effects in intensive grassland systems across 28 European sites. Journal of Ecology, 95, 530-539.  
</p>
<p>Kirwan L, J Connolly, JA Finn, C Brophy, A Lüscher, D Nyfeler and MT Sebastia (2009) Diversity-interaction modelling - estimating contributions of species identities and interactions to ecosystem function. Ecology, 90, 2032-2038. 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+DI">DI</a></code>
<code><a href="#topic+autoDI">autoDI</a></code>
</p>
<p>Other examples using the <code>DI_data</code> function: 
The <code><a href="#topic+sim2">sim2</a></code> dataset examples. 
The <code><a href="#topic+sim3">sim3</a></code> dataset examples. 
The <code><a href="#topic+sim4">sim4</a></code> dataset examples. 
The <code><a href="#topic+sim5">sim5</a></code> dataset examples. 
The <code><a href="#topic+Switzerland">Switzerland</a></code> dataset examples. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>################################
  
#### Data manipulation for the Switzerland dataset
  
## Load the Switzerland data
  data(Switzerland)
  
## Check that the proportions sum to 1 (required for DI models)
## p1 to p4 are in the 4th to 7th columns in Switzerland
  Switzerlandsums &lt;- rowSums(Switzerland[4:7])
  summary(Switzerlandsums)
  
  
## Create FG interaction variables and incorporate them into a new data frame Switzerland2.
## Switzerland2 will contain the new variables:  bfg_G_L, wfg_G and wfg_L.
  FG_matrix &lt;- DI_data(prop = c("p1","p2","p3","p4"), FG = c("G","G","L","L"), 
                       data = Switzerland, what = "FG")
  Switzerland2 &lt;- data.frame(Switzerland, FG_matrix)
  
  
## Create FG interaction variables and incorporate them into a new data frame Switzerland3.
## Use theta = 0.5.
  FG_matrix &lt;- DI_data(prop = c("p1","p2","p3","p4"), FG = c("G","G","L","L"), 
                       data = Switzerland, what = "FG", theta = 0.5)
  Switzerland3 &lt;- data.frame(Switzerland, FG_matrix)
## Add "_theta" to the new interaction variables to differentiate from when theta = 1
  names(Switzerland3)[9:11] &lt;- paste0(names(Switzerland3)[9:11], "_theta") 


#### All interactions can be added to a new dataset all together:

## Create all interactions and add them to a new data frame called Switzerland4
  newlist &lt;- DI_data(prop = c("p1","p2","p3","p4"), FG = c("G","G","L","L"), data = Switzerland, 
                     what = c("E", "AV", "FG", "ADD", "FULL"))
  Switzerland4 &lt;- data.frame(Switzerland, "E" = newlist$E, "AV" = newlist$AV, newlist$FG, 
                             newlist$ADD, newlist$FULL)

  
#### Or the various interactions can also be added to a new dataset individually:
  
## Create the average pairwise interaction and evenness variables
##  and store them in a new data frame called Switzerland5.
## Switzerland5 will contain the new variables: AV, E
  E_variable &lt;- DI_data(prop = c("p1","p2","p3","p4"), data = Switzerland, what = "E")
  AV_variable &lt;- DI_data(prop = c("p1","p2","p3","p4"), data = Switzerland, what = "AV")
  Switzerland5 &lt;- data.frame(Switzerland, "AV" = AV_variable, "E" = E_variable)
  
## Create the functional group variables and add them to Switzerland5.
## In the FG names vector: G stands for grass, L stands for legume.
## Switzerland5 will contain: bfg_G_L, wfg_G and wfg_L
  FG_matrix &lt;- DI_data(prop = 4:7, FG = c("G","G","L","L"), data = Switzerland, what = "FG")
  Switzerland5 &lt;- data.frame(Switzerland5, FG_matrix)
  
## Create the additive species variables and add them to Switzerland5.
## Switzerland5 will contain the new variables: p1_add, p2_add, p3_add and p4_add.
  ADD_matrix &lt;- DI_data(prop = c("p1","p2","p3","p4"), data = Switzerland, what = "ADD")
  Switzerland5 &lt;- data.frame(Switzerland5, ADD_matrix)
  
## Create all pairwise interaction variables and add them to Switzerland5.
## Switzerland5 will contain the new variables: p1.p2, p1.p3, p1.p4, p2.p3, p2.p4, p3.p4.
  FULL_matrix &lt;- DI_data(prop = c("p1","p2","p3","p4"), data = Switzerland, what = "FULL")
  Switzerland5 &lt;- data.frame(Switzerland5, FULL_matrix)
  
################################
  

################################ 
  
#### Short worked example (as illustrated the Details section)
  
## Create a dataframe
  p1 &lt;- c(0.1, 0.25)
  p2 &lt;- c(0.2, 0.25)
  p3 &lt;- c(0.3, 0.25)
  p4 &lt;- c(0.4, 0.25)
  minidataset1 &lt;- data.frame(p1,p2,p3,p4)
  
## Check the rows sum to 1
  rowSums(minidataset1[1:4]) 
  
## Create the FG variables, assume two functional groups and theta = 1
  FG_matrix &lt;- DI_data(prop = c("p1","p2","p3","p4"), FG = c("G","G","L","L"),
                       data = minidataset1, what = "FG")
  minidataset2 &lt;- data.frame(minidataset1, FG_matrix)
  
## Create the FG variables, assume two functional groups and theta = 0.5
  FG_matrix &lt;- DI_data(prop = c("p1","p2","p3","p4"), FG = c("G","G","L","L"), 
                       data = minidataset1, what = "FG", theta = 0.5)
  minidataset3 &lt;- data.frame(minidataset1, FG_matrix)
## Create the ADD variables, assume theta = 0.5
  ADD_matrix &lt;- DI_data(prop = c("p1","p2","p3","p4"), 
                        data = minidataset1, what = "ADD", theta = 0.5)
  minidataset3 &lt;- data.frame(minidataset3, ADD_matrix)
## Add "_theta" to the new interaction variables to differentiate from when theta = 1
  names(minidataset3)[5:11] &lt;- paste0(names(minidataset3)[5:11], "_theta")   

  
################################
</code></pre>

<hr>
<h2 id='DI_methods'>
Methods for <code>DI</code> Objects
</h2><span id='topic+anova.DI'></span><span id='topic+AIC.DI'></span><span id='topic+BIC.DI'></span><span id='topic+AICc.DI'></span><span id='topic+BICc.DI'></span><span id='topic+logLik.DI'></span><span id='topic+fortify.DI'></span>

<h3>Description</h3>

<p>Different methods that can be used with objects of class <code>DI</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'DI'
anova(object, ...)
## S3 method for class 'DI'
AIC(object, ...)
## S3 method for class 'DI'
BIC(object, ...)
## S3 method for class 'DI'
AICc(obj)
## S3 method for class 'DI'
BICc(obj)
## S3 method for class 'DI'
logLik(object, ...)
## S3 method for class 'DI'
fortify(model, data, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="DI_methods_+3A_object">object</code></td>
<td>
<p>a <code>DI</code> model object</p>
</td></tr>
<tr><td><code id="DI_methods_+3A_obj">obj</code></td>
<td>
<p>a <code>DI</code> model object</p>
</td></tr>
<tr><td><code id="DI_methods_+3A_model">model</code></td>
<td>
<p>a <code>DI</code> model object</p>
</td></tr>
<tr><td><code id="DI_methods_+3A_data">data</code></td>
<td>
<p>data to which to add model fit statistics. Defaults to the model frame.</p>
</td></tr>
<tr><td><code id="DI_methods_+3A_...">...</code></td>
<td>
<p>further arguments passed to <code>anova</code>, <code>AIC</code>, <code>BIC</code>, <code>loglik</code>, or <code>fortify</code></p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Rafael A. Moral, John Connolly, Rishabh Vishwakarma and Caroline Brophy
</p>


<h3>See Also</h3>

<p><code><a href="#topic+autoDI">autoDI</a></code>
</p>

<hr>
<h2 id='DImodels-internal'>
Internal Functions
</h2><span id='topic+proflik_theta'></span><span id='topic+test_autoDI'></span><span id='topic+AICsel_autoDI'></span><span id='topic+AICcsel_autoDI'></span><span id='topic+BICsel_autoDI'></span><span id='topic+BICcsel_autoDI'></span><span id='topic+namesub_autoDI'></span><span id='topic+namesub_DI'></span><span id='topic+AIC2'></span><span id='topic+AICc'></span><span id='topic+AICc.default'></span><span id='topic+BIC2'></span><span id='topic+BICc'></span><span id='topic+BICc.default'></span><span id='topic+DI_matrix_check'></span><span id='topic+get_P_indices'></span><span id='topic+get_theta_cols'></span><span id='topic+theta_index_matching'></span><span id='topic+reftest_autoDI'></span><span id='topic+get_community'></span><span id='topic+DI_reference'></span><span id='topic+anovaDIglm'></span><span id='topic+anova_glmlist'></span><span id='topic+autoDI_step0'></span><span id='topic+autoDI_step1'></span><span id='topic+autoDI_step2'></span><span id='topic+autoDI_step3'></span><span id='topic+autoDI_step4'></span><span id='topic+add_name_check'></span>

<h3>Description</h3>

<p>Internal functions used within the <code>DI</code> and <code>autoDI</code> functions.
</p>


<h3>Author(s)</h3>

<p>Rafael A. Moral, John Connolly, Rishabh Vishwakarma and Caroline Brophy
</p>

<hr>
<h2 id='extract'>
Extract terms from a DI or autoDI model object
</h2><span id='topic+extract'></span><span id='topic+extract.DI'></span><span id='topic+extract.autoDI'></span>

<h3>Description</h3>

<p>Extracts terms from a <code><a href="#topic+DI">DI</a></code> or <code><a href="#topic+autoDI">autoDI</a></code> model object that were calculated using the data preparation functions prior to the model fitting procedure.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract(obj, what = c("FULL","ADD","FG","AV","E"))
## S3 method for class 'DI'
extract(obj, what = c("FULL","ADD","FG","AV","E"))
## S3 method for class 'autoDI'
extract(obj, what = c("FULL","ADD","FG","AV","E"))

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extract_+3A_obj">obj</code></td>
<td>
<p>a <code>DI</code> or <code>autoDI</code> model object</p>
</td></tr>
<tr><td><code id="extract_+3A_what">what</code></td>
<td>
<p>the variable(s) to be extracted from the object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing one or more of the following elements:
</p>
<table>
<tr><td><code>E</code></td>
<td>
<p>the evenness interaction variable</p>
</td></tr>
<tr><td><code>AV</code></td>
<td>
<p>the average pairwise interaction variable</p>
</td></tr>
<tr><td><code>FG</code></td>
<td>
<p>the functional group-related interaction variables</p>
</td></tr>
<tr><td><code>ADD</code></td>
<td>
<p>the additive species contributions interaction variables</p>
</td></tr>
<tr><td><code>FULL</code></td>
<td>
<p>all pairwise interactions</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Rafael A. Moral, John Connolly and Caroline Brophy
</p>


<h3>References</h3>

<p>Connolly J, T Bell, T Bolger, C Brophy, T Carnus, JA Finn, L Kirwan, F Isbell, J Levine, A Lüscher, V Picasso, C Roscher, MT Sebastia, M Suter and A Weigelt (2013) An improved model to predict the effects of changing biodiversity levels on ecosystem function. Journal of Ecology, 101, 344-355. 
</p>
<p>Kirwan L, J Connolly, JA Finn, C Brophy, A Lüscher, D Nyfeler and MT Sebastia (2009) Diversity-interaction modelling - estimating contributions of species identities and interactions to ecosystem function. Ecology, 90, 2032-2038. 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+DI">DI</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Load the Switzerland data
  data(Switzerland)

## Fit the FG DImodel, with factors density and treatment, and with theta = 1
  m1 &lt;- DI(y = "yield", density = "density", prop = 4:7, treat = "nitrogen", 
           FG = c("G","G","L","L"), DImodel = "FG", data = Switzerland)

## Extract the FG terms
  extract(m1, what = "FG")

</code></pre>

<hr>
<h2 id='predict.DI'>
Predict Method for Diversity-Interactions (DI) Models
</h2><span id='topic+predict.DI'></span>

<h3>Description</h3>

<p>Generates predictions for a fitted DI models object and, optionally, the associated standard errors for those predictions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'DI'
predict(object, newdata, se.fit = FALSE,
interval = c("none", "confidence", "prediction"), 
level = 0.95, weights = 1,
type = c("link", "response", "terms"), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict.DI_+3A_object">object</code></td>
<td>
<p>a <code><a href="#topic+DI">DI</a></code> or <code><a href="#topic+autoDI">autoDI</a></code> model object.</p>
</td></tr>
<tr><td><code id="predict.DI_+3A_newdata">newdata</code></td>
<td>
<p>optionally, a data frame in which to look for variables with which to predict. If omitted, predictions will be made for data used to fit the model.</p>
</td></tr>
<tr><td><code id="predict.DI_+3A_se.fit">se.fit</code></td>
<td>
<p>A logical switch indicating whether to calculate the associated standard errors.</p>
</td></tr>
<tr><td><code id="predict.DI_+3A_interval">interval</code></td>
<td>
<p>The type of interval to be calculated. Accepts one of &quot;none&quot;, &quot;confidence&quot; or &quot;prediction&quot;, with &quot;none&quot;&quot; being the default.</p>
</td></tr>
<tr><td><code id="predict.DI_+3A_level">level</code></td>
<td>
<p>The level (1 - <code class="reqn">\alpha</code>) at which to calculate the interval. Defaults to 0.95, giving a 95% interval.</p>
</td></tr>
<tr><td><code id="predict.DI_+3A_weights">weights</code></td>
<td>
<p>The variance weights for calculating the prediction intervals. By default all values get the same weight of 1. Can also specify a numeric vector of same length as number of rows in <code>newdata</code>.</p>
</td></tr>
<tr><td><code id="predict.DI_+3A_type">type</code></td>
<td>
<p>the type of prediction required. One of &quot;link&quot;, &quot;response&quot; or &quot;terms&quot;. The default &quot;link&quot; is on the scale of the linear predictors while &quot;response&quot; is on the scale of the response variable. The &quot;terms&quot; option returns a matrix giving the fitted values of each term in the model formula on the linear predictor scale.</p>
</td></tr>
<tr><td><code id="predict.DI_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods. For eg: <code>dispersion</code> or <code>na.action</code> arguments from <code><a href="stats.html#topic+predict.glm">predict.glm</a></code> function.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>newdata</code> doesn't contain all predictors from the model, necessary numeric predictors will be added in with a value of 0, while categorical predictors will be added in with their baseline value. See examples for more information.
</p>


<h3>Value</h3>

<p>if <code>se.fit = FALSE</code>, a vector of predictions is returned.
</p>
<p>if <code>se.fit = TRUE</code>, a list with the following components is returned.
</p>
<table>
<tr><td><code>fit</code></td>
<td>
<p>Predictions, as for <code>se.fit = FALSE.</code></p>
</td></tr>
<tr><td><code>se.fit</code></td>
<td>
<p>Estimated standard error for each prediction</p>
</td></tr>
<tr><td><code>residual.scale</code></td>
<td>
<p>A scalar giving the square root of the dispersion used in computing the standard errors.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Rafael A. Moral, John Connolly, Rishabh Vishwakarma and Caroline Brophy
</p>


<h3>References</h3>

<p>Connolly J, T Bell, T Bolger, C Brophy, T Carnus, JA Finn, L Kirwan, F Isbell, J Levine, A Luescher, V Picasso, C Roscher, MT Sebastia, M Suter and A Weigelt (2013) An improved model to predict the effects of changing biodiversity levels on ecosystem function. Journal of Ecology, 101, 344-355.
</p>
<p>Kirwan L, J Connolly, JA Finn, C Brophy, A Luescher, D Nyfeler and MT Sebastia (2009) Diversity-interaction modelling - estimating contributions of species identities and interactions to ecosystem function. Ecology, 90, 2032-2038.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+DI">DI</a></code>
<code><a href="#topic+autoDI">autoDI</a></code>
<code><a href="stats.html#topic+predict.glm">predict.glm</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Load the Switzerland data
  data(Switzerland)
## Summarise the Switzerland data
  summary(Switzerland)

## Fit a DI model
  m1 &lt;- DI(y = "yield", prop = 4:7, treat = 'nitrogen', DImodel = 'AV',
  density = 'density', estimate_theta = TRUE, data = Switzerland)
  summary(m1)
  
## Prediction without newdata, full dataset from model fit will be used
  predict(m1, se.fit = TRUE)

## Prediction with newdata
  newdata1 &lt;- data.frame('p1' = c(1,0), 'p2' = c(0,1), 'p3' = c(0,0), 'p4' = c(0,0),
                         'nitrogen' = c(50, 150), 'density' = c('low','high'))
  predict(m1, newdata = newdata1, se.fit = TRUE)

## If any categorical variable is missing, the baseline level
## of the variable is used for prediction
  newdata2 &lt;- newdata1[, -5]
  print(newdata2)
  predict(m1, newdata = newdata2)
  
## If a numerical variable is missing, the value 0 is used for it
  newdata3 &lt;- newdata1[, -c(3,4)]
  print(newdata3)
  predict(m1, newdata = newdata3)
</code></pre>

<hr>
<h2 id='richness_vs_DI'>
Comparing the Richness Model with DI Alternatives
</h2><span id='topic+richness_vs_DI'></span>

<h3>Description</h3>

<p>This function provides an automated way to fit the richness model and a (limited) range of Diversity-Interactions (DI) models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>richness_vs_DI(y, prop, data, extra_formula)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="richness_vs_DI_+3A_y">y</code></td>
<td>

<p>The column name of the response vector, which must be in quotes, for example, <code>y = "yield"</code>. 
</p>
</td></tr>
<tr><td><code id="richness_vs_DI_+3A_prop">prop</code></td>
<td>

<p>A vector of <em>s</em> column names identifying the species proportions in each row in the dataset. For example, if the species proportions columns are labelled p1 to p4, then <code>prop = c("p1","p2","p3","p4")</code>. Alternatively, the column numbers can be specified, for example, <code>prop = 4:7</code>, where the species proportions are in the 4th to 7th columns.
</p>
</td></tr>
<tr><td><code id="richness_vs_DI_+3A_data">data</code></td>
<td>

<p>Specify the dataset, for example, <code>data = Switzerland</code>. The dataset name should not appear in quotes.
</p>
</td></tr>
<tr><td><code id="richness_vs_DI_+3A_extra_formula">extra_formula</code></td>
<td>

<p>Additional terms can be added using <code>extra_formula</code>. A <code>~</code> must be included before specifying the terms. For example, <code>extra_formula = ~ treatment:AV</code> will add a treatment effect. Any variable included directly in <code>extra_formula</code> must already be contained in the dataset (interaction variables can be created using the function <code><a href="#topic+DI_data">DI_data</a></code>, if required).  
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Connolly et al. (2013; Appendix 1) shows that there is an equivalence between DI models and different types of richness models (linear and nonlinear predictors using richness in different scales).
</p>
<p>This function fits four models and compares them using AIC. The four models are:
</p>
<p>1. The richness model
</p>
<p style="text-align: center;"><code class="reqn">y = Intercept + Slope * Richness + \epsilon;</code>
</p>

<p>2. The average pairwise interactions (AV) DI model with common identity effects and theta equal to 0.5 (which is equivalent to model 1 when communities are all equi-proportional);
</p>
<p>3. The average pairwise interactions (AV) DI model with common identity effects and estimating theta;
</p>
<p>4. The average pairwise interactions (AV) DI model allowing for unique identity effects, but maintaining theta equal to 0.5;
</p>
<p>5. The average pairwise interactions (AV) DI model allowing for unique identity effects, and estimating theta.
</p>
<p>The function prints a table with AIC, AICc, BIC, and associated degrees of freedom for each of the four models above, and returns the model with the smallest AIC.
</p>


<h3>Value</h3>

<p>The function returns the final selected model, an object of class <code>DI</code> or <code>lm</code>.
</p>


<h3>Author(s)</h3>

<p>Rafael A. Moral, John Connolly, Rishabh Vishwakarma and Caroline Brophy
</p>


<h3>References</h3>

<p>Connolly J, T Bell, T Bolger, C Brophy, T Carnus, JA Finn, L Kirwan, F Isbell, J Levine, A Lüscher, V Picasso, C Roscher, MT Sebastia, M Suter and A Weigelt (2013) An improved model to predict the effects of changing biodiversity levels on ecosystem function. Journal of Ecology, 101, 344-355. 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+DI">DI</a></code>
<code><a href="#topic+autoDI">autoDI</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Load the Switzerland data
  data(Switzerland)


## compare the richness model with DI alternatives
  richness_vs_DI(y = "yield", prop = 4:7, data = Switzerland)

## include the density effects in the linear predictors of the four models
  richness_vs_DI(y = "yield", prop = 4:7, data = Switzerland, extra_formula = ~ density)
  
</code></pre>

<hr>
<h2 id='sim0'>
The Simulated &quot;sim0&quot; Dataset
</h2><span id='topic+sim0'></span>

<h3>Description</h3>

<p>The <code>sim0</code> dataset was simulated. There are four replicates and three species that vary in proportions (<code>p1 - p3</code>). There are 16 unique sets of proportions identified by the variable <code>community</code>. The response was simulated assuming that there were species identity effects and separate pairwise interactions effects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(sim0)</code></pre>


<h3>Format</h3>

<p>A data frame with 64 observations on the following six variables:
</p>

<dl>
<dt><code>community</code></dt><dd><p>A numeric vector identifying each unique community, i.e., two rows with the same community value also share the same set of p1 to p3 values.</p>
</dd>
<dt><code>richness</code></dt><dd><p>A numeric vector indicating the number of species in the initial composition, i.e., the number of proportions from p1 to p3 that are &gt;0.</p>
</dd>
<dt><code>p1</code></dt><dd><p>A numeric vector indicating the initial proportion of species 1.</p>
</dd>
<dt><code>p2</code></dt><dd><p>A numeric vector indicating the initial proportion of species 2.</p>
</dd>
<dt><code>p3</code></dt><dd><p>A numeric vector indicating the initial proportion of species 3.</p>
</dd>
<dt><code>response</code></dt><dd><p>A numeric vector giving the simulated response variable.</p>
</dd> 
</dl>



<h3>Details</h3>

<p><strong>What are Diversity-Interactions (DI) models?</strong>
</p>
<p>Diversity-Interactions (DI) models (Kirwan et al 2009) are a set of tools for analysing and interpreting data from experiments that explore the effects of species diversity on community-level responses. We strongly recommend that users read the short introduction to Diversity-Interactions models (available at: <code><a href="#topic+DImodels">DImodels</a></code>). Further information on Diversity-Interactions models is also available in Kirwan et al 2009 and Connolly et al 2013.
</p>
<p><strong>Parameter values for the simulation</strong>
</p>
<p>DI models take the general form of:
</p>
<p style="text-align: center;"><code class="reqn">y = Identities + Interactions + Structures + \epsilon</code>
</p>

<p>where <em>y</em> is a community-level response, the <em>Identities</em> are the effects of species identities and enter the model as individual species proportions at the beginning of the time period, the <em>Interactions</em> are the interactions among the species proportions, while <em>Structures</em> include other experimental structures such as blocks, treatments or density.
</p>
<p>The dataset <code>sim0</code> was simulated with:
</p>

<ul>
<li><p> identity effects for the four species with values = 25, 20, 15
</p>
</li>
<li><p> all 3 pairwise interaction effects with values: 30, 20, 40 (for pairs of species 1-2, 1-3, and 2-3, respectively). 
</p>
</li>
<li> <p><code class="reqn">\epsilon</code> assumed normally distributed with mean 0 and standard deviation 2.
</p>
</li></ul>



<h3>References</h3>

<p>Connolly J, T Bell, T Bolger, C Brophy, T Carnus, JA Finn, L Kirwan, F Isbell, J Levine, A Lüscher, V Picasso, C Roscher, MT Sebastia, M Suter and A Weigelt (2013) An improved model to predict the effects of changing biodiversity levels on ecosystem function. Journal of Ecology, 101, 344-355.
</p>
<p>Kirwan L, J Connolly, JA Finn, C Brophy, A Lüscher, D Nyfeler and MT Sebastia (2009) Diversity-interaction modelling - estimating contributions of species identities and interactions to ecosystem function. Ecology, 90, 2032-2038.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## load the sim0 dataset
  data(sim0)

## Find the best DI model using autoDI and F-test selection
  auto1 &lt;- autoDI(y = "response", prop = c("p1","p2","p3"), data = sim0, 
                  selection = "Ftest")
  summary(auto1)
  
## Fit the FULL model using DI and the ID tag
  m1 &lt;- DI(y = "response", prop = c("p1","p2","p3"), DImodel = "FULL", 
           data = sim0)
  summary(m1)
  plot(m1)


## Check goodness-of-fit using a half-normal plot with a simulated envelope
  library(hnp)
  hnp(m1)


</code></pre>

<hr>
<h2 id='sim0_design'>
The &quot;sim0_design&quot; Dataset
</h2><span id='topic+sim0_design'></span>

<h3>Description</h3>

<p>This dataset contains a set of proportions <code>p1</code> to <code>p3</code> where each row sums to 1. It is used as the design matrix for simulating other datasets in the <code>DImodels</code> package.  
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("sim0_design")</code></pre>


<h3>Format</h3>

<p>A data frame with 16 observations on the following 5 variables:
</p>

<dl>
<dt><code>community</code></dt><dd><p>A numeric vector identifying each unique community, i.e., two rows with the same community value also share the same set of p1 to p3 values.</p>
</dd>
<dt><code>richness</code></dt><dd><p>A numeric vector indicating the number of species in the initial composition, i.e., the number of proportions from p1 to p3 that are &gt;0.</p>
</dd>
<dt><code>p1</code></dt><dd><p>A numeric vector indicating a proportion (of species 1).</p>
</dd>
<dt><code>p2</code></dt><dd><p>A numeric vector indicating a proportion (of species 2).</p>
</dd>
<dt><code>p3</code></dt><dd><p>A numeric vector indicating a proportion (of species 3).</p>
</dd>
</dl>



<h3>Details</h3>

<p>The columns p1 to p3 form a simplex space.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Load the sim0_design data
  data(sim0_design)
## View the first five entries
  head(sim0_design)
## Explore the variables in design_a
  str(sim0_design)

## Check that the proportions sum to 1 (required for DI models)
## p1 to p3 are in the 3rd to 5th columns in sim0_design
  sim0_design_sums &lt;- rowSums(sim0_design[3:5])
  summary(sim0_design)
  
</code></pre>

<hr>
<h2 id='sim1'>
The Simulated &quot;sim1&quot; Dataset
</h2><span id='topic+sim1'></span>

<h3>Description</h3>

<p>The <code>sim1</code> dataset was simulated. There are four blocks and four species that vary in proportions (<code>p1 - p4</code>). There are 15 unique sets of proportions identified by the variable <code>community</code>. Each unique community appears once in each block. The response was simulated assuming that there were species identity effects and block effects, but no diversity effects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(sim1)</code></pre>


<h3>Format</h3>

<p>A data frame with 60 observations on the following seven variables:
</p>

<dl>
<dt><code>community</code></dt><dd><p>A numeric vector identifying each unique community, i.e., two rows with the same community value also share the same set of p1 to p4 values.</p>
</dd>
<dt><code>block</code></dt><dd><p>A factor taking values 1 to 4 indicating block membership.</p>
</dd>
<dt><code>p1</code></dt><dd><p>A numeric vector indicating the initial proportion of species 1.</p>
</dd>
<dt><code>p2</code></dt><dd><p>A numeric vector indicating the initial proportion of species 2.</p>
</dd>
<dt><code>p3</code></dt><dd><p>A numeric vector indicating the initial proportion of species 3.</p>
</dd>
<dt><code>p4</code></dt><dd><p>A numeric vector indicating the initial proportion of species 4.</p>
</dd>
<dt><code>response</code></dt><dd><p>A numeric vector giving the simulated response variable.</p>
</dd> 
</dl>



<h3>Details</h3>

<p><strong>What are Diversity-Interactions (DI) models?</strong>
</p>
<p>Diversity-Interactions (DI) models (Kirwan et al 2009) are a set of tools for analysing and interpreting data from experiments that explore the effects of species diversity on community-level responses. We strongly recommend that users read the short introduction to Diversity-Interactions models (available at: <code><a href="#topic+DImodels">DImodels</a></code>). Further information on Diversity-Interactions models is also available in Kirwan et al 2009 and Connolly et al 2013.
</p>
<p><strong>Parameter values for the simulation</strong>
</p>
<p>DI models take the general form of:
</p>
<p style="text-align: center;"><code class="reqn">y = Identities + Interactions + Structures + \epsilon</code>
</p>

<p>where <em>y</em> is a community-level response, the <em>Identities</em> are the effects of species identities and enter the model as individual species proportions at the beginning of the time period, the <em>Interactions</em> are the interactions among the species proportions, while <em>Structures</em> include other experimental structures such as blocks, treatments or density.
</p>
<p>The dataset <code>sim1</code> was simulated with:
</p>

<ul>
<li><p> identity effects for the four species with values = 10, 9, 8, 7
</p>
</li>
<li><p> block effects for the four blocks with values = 1, 1.5, 2, 0  
</p>
</li>
<li><p> no interaction effects
</p>
</li>
<li> <p><code class="reqn">\epsilon</code> assumed normally distributed with mean 0 and standard deviation 1.1.
</p>
</li></ul>



<h3>References</h3>

<p>Connolly J, T Bell, T Bolger, C Brophy, T Carnus, JA Finn, L Kirwan, F Isbell, J Levine, A Lüscher, V Picasso, C Roscher, MT Sebastia, M Suter and A Weigelt (2013) An improved model to predict the effects of changing biodiversity levels on ecosystem function. Journal of Ecology, 101, 344-355.
</p>
<p>Kirwan L, J Connolly, JA Finn, C Brophy, A Lüscher, D Nyfeler and MT Sebastia (2009) Diversity-interaction modelling - estimating contributions of species identities and interactions to ecosystem function. Ecology, 90, 2032-2038.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
####################################
## Code to simulate the sim1 dataset



## Simulate dataset sim1 with species identity effects and block effects, but no interaction effect

## Use the proportions from the first fifteen plots in Switzerland
  data(Switzerland)

## Repeat the 15 plots over four blocks.
## Give each community type a unique (community) number.
  sim1 &lt;- data.frame(community = rep(1:15, each = 4),
                   block = factor(rep(1:4, times = 15)),
                   p1 = rep(Switzerland$p1[1:15], each = 4),
                   p2 = rep(Switzerland$p2[1:15], each = 4),
                   p3 = rep(Switzerland$p3[1:15], each = 4),
                   p4 = rep(Switzerland$p4[1:15], each = 4))

## To simulate the response, first create a matrix of predictors that includes 
##  p1-p4 and the four block dummy variables.
  X &lt;- model.matrix(~ p1 + p2 + p3 + p4 + block -1, data = sim1)

## Create a vector of 'known' parameter values for simulating the response.
## The first four are the p1-p4 parameters, the second four are the block effects.
  sim1_coeff &lt;- c(10,9,8,7,   1,1.5,2,0)

## Create response and add normally distributed error 
  sim1$response &lt;- as.numeric(X %*% sim1_coeff)
  set.seed(2020)
  r &lt;- rnorm(n = 60, mean = 0, sd = 1.1)
  sim1$response &lt;- round(sim1$response + r, digits = 3)




###########################
## Analyse the sim1 dataset

## Load the sim1 data
  data(sim1)
## View the first few entries
  head(sim1)
## Explore the variables in sim1
  str(sim1)

## Check that the proportions sum to 1 (required for DI models)
## p1 to p4 are in the 3rd to 6th columns in sim1
  sim1sums &lt;- rowSums(sim1[3:6])
  summary(sim1sums)
  
## Check characteristics of sim1
  hist(sim1$response)
  summary(sim1$response)
  plot(sim1$p1, sim1$response)
  plot(sim1$p2, sim1$response)
  plot(sim1$p3, sim1$response)
  plot(sim1$p4, sim1$response)
  
## Find the best DI model using autoDI and F-test selection
  auto1 &lt;- autoDI(y = "response", prop = c("p1","p2","p3","p4"), block = "block", data = sim1, 
                  selection = "Ftest")
  summary(auto1)
  
## Fit the identity model using DI and the ID tag
  m1 &lt;- DI(y = "response", prop = c("p1","p2","p3","p4"), block = "block", DImodel = "ID", 
           data = sim1)
  summary(m1)
  plot(m1)


## Check goodness-of-fit using a half-normal plot with a simulated envelope
  library(hnp)
  hnp(m1)

  
## Fit the identity model using DI and custom_formula
  m2 &lt;- DI(y = "response", custom_formula = response ~ 0 + p1 + p2 + p3 + p4 + block, data = sim1)
  summary(m2)

</code></pre>

<hr>
<h2 id='sim2'>
The Simulated &quot;sim2&quot; Dataset
</h2><span id='topic+sim2'></span>

<h3>Description</h3>

<p>The <code>sim2</code> dataset was simulated. There are four blocks and four species that vary in proportions (<code>p1 - p4</code>). There are 15 unique sets of proportions identified by the variable <code>community</code>. Each unique community appears once in each block. The response was simulated assuming that there were species identity effects, block effects, an average pairwise interaction effect and a theta value of 0.5. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(sim2)</code></pre>


<h3>Format</h3>

<p>A data frame with 60 observations on the following seven variables:
</p>

<dl>
<dt><code>community</code></dt><dd><p>A numeric vector identifying each unique community, i.e., two rows with the same community value also share the same set of p1 to p4 values.</p>
</dd>
<dt><code>block</code></dt><dd><p>A factor taking values 1 to 4 indicating block membership.</p>
</dd>
<dt><code>p1</code></dt><dd><p>A numeric vector indicating the initial proportion of species 1.</p>
</dd>
<dt><code>p2</code></dt><dd><p>A numeric vector indicating the initial proportion of species 2.</p>
</dd>
<dt><code>p3</code></dt><dd><p>A numeric vector indicating the initial proportion of species 3.</p>
</dd>
<dt><code>p4</code></dt><dd><p>A numeric vector indicating the initial proportion of species 4.</p>
</dd>
<dt><code>response</code></dt><dd><p>A numeric vector giving the simulated response variable.</p>
</dd> 
</dl>



<h3>Details</h3>

<p><strong>What are Diversity-Interactions (DI) models?</strong> 
</p>
<p>Diversity-Interactions (DI) models (Kirwan et al 2009) are a set of tools for analysing and interpreting data from experiments that explore the effects of species diversity on community-level responses. We strongly recommend that users read the short introduction to Diversity-Interactions models (available at: <code><a href="#topic+DImodels">DImodels</a></code>). Further information on Diversity-Interactions models is also available in Kirwan et al 2009 and Connolly et al 2013.
</p>
<p><strong>Parameter values for the simulation</strong> 
</p>
<p>DI models take the general form of:   
</p>
<p style="text-align: center;"><code class="reqn">y = Identities + Interactions + Structures + \epsilon</code>
</p>

<p>where <em>y</em> is a community-level response, the <em>Identities</em> are the effects of species identities and enter the model as individual species proportions at the beginning of the time period, the <em>Interactions</em> are the interactions among the species proportions, while <em>Structures</em> include other experimental structures such as blocks, treatments or density. 
</p>
<p>The dataset <code>sim2</code> was simulated with:  
</p>

<ul>
<li><p> identity effects for the four species with values = 10, 9, 8, 7
</p>
</li>
<li><p> block effects for the four blocks with values = 1, 1.5, 2, 0  
</p>
</li>
<li><p> an average pairwise interaction effect = 8
</p>
</li>
<li><p> theta = 0.5 (where <code class="reqn">\theta</code> is a non-linear parameter included as a power on each <code class="reqn">pipj</code> product within interaction variables, see Connolly et al 2013 for details)
</p>
</li>
<li> <p><code class="reqn">\epsilon</code> assumed normally distributed with mean 0 and standard deviation 1.1.
</p>
</li></ul>



<h3>References</h3>

<p>Connolly J, T Bell, T Bolger, C Brophy, T Carnus, JA Finn, L Kirwan, F Isbell, J Levine, A Lüscher, V Picasso, C Roscher, MT Sebastia, M Suter and A Weigelt (2013) An improved model to predict the effects of changing biodiversity levels on ecosystem function. Journal of Ecology, 101, 344-355. 
</p>
<p>Kirwan L, J Connolly, JA Finn, C Brophy, A Lüscher, D Nyfeler and MT Sebastia (2009) Diversity-interaction modelling - estimating contributions of species identities and interactions to ecosystem function. Ecology, 90, 2032-2038. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
####################################
## Code to simulate the sim2 dataset
  


## Simulate dataset sim2 with species identity effects, block effects and 
##  an average pairwise interaction effect with theta=0.5.

## Use the proportions from the first fifteen plots in Switzerland
  data(Switzerland)

## Repeat the 15 plots over four blocks. 
## Give each community type a unique (community) number.
  sim2 &lt;- data.frame(community = rep(1:15, each = 4),
                   block = factor(rep(1:4, times = 15)),
                   p1 = rep(Switzerland$p1[1:15], each = 4),
                   p2 = rep(Switzerland$p2[1:15], each = 4),
                   p3 = rep(Switzerland$p3[1:15], each = 4),
                   p4 = rep(Switzerland$p4[1:15], each = 4))

## Create the average pairwise interaction variable, with theta = 0.5
  AV_variable &lt;- DI_data(prop = c("p1","p2","p3","p4"), data = sim2, 
                         theta = 0.5, what = "AV")
  sim2 &lt;- data.frame(sim2, "AV_theta" = AV_variable)

## To simulate the response, first create a matrix of predictors that includes p1-p4 and  
##  the four block variables and the average pairwise interaction variable with theta=0.5.
  X &lt;- model.matrix(~ p1 + p2 + p3 + p4 + block + AV_theta -1, data = sim2)

## Create a vector of 'known' parameter values for simulating the response.
## The first four are the p1-p4 parameters, the second four are the block effects and 
##  the last one is the interaction parameter.
  sim2_coeff &lt;- c(10,9,8,7,   1,1.5,2,0,    8)

## Create response and add normally distributed error 
  sim2$response &lt;- as.numeric(X %*% sim2_coeff)
  set.seed(328781)
  r &lt;- rnorm(n = 60, mean = 0, sd = 1.1)
  sim2$response &lt;- round(sim2$response + r, digits = 3)
  sim2$AV_theta &lt;- NULL




###################################################################################################
###################################################################################################
## sim2

###########################
## Analyse the sim2 dataset
  
## Load the sim2 data
  data(sim2)
## View the first few entries
  head(sim2)
## Explore the variables in sim2
  str(sim2)
  
## Check that the proportions sum to 1 (required for DI models)
## p1 to p4 are in the 3rd to 6th columns in sim2
  sim2sums &lt;- rowSums(sim2[3:6])
  summary(sim2sums)
  
## Check characteristics of sim2
  hist(sim2$response)
  summary(sim2$response)
  plot(sim2$p1, sim2$response)
  plot(sim2$p2, sim2$response)
  plot(sim2$p3, sim2$response)
  plot(sim2$p4, sim2$response)

## Find the best DI model using autoDI and F-test selection
  auto1 &lt;- autoDI(y = "response", prop = c("p1", "p2", "p3", "p4"), block = "block", data = sim2, 
                  selection = "Ftest")
  summary(auto1)
  
  ## Fit the average pairwise model, including theta, using DI and the AV tag
  m1 &lt;- DI(y = "response", prop = c("p1","p2","p3","p4"), block = "block", DImodel = "AV", 
           estimate_theta = TRUE, data = sim2)
  summary(m1)
  CI_95 &lt;- theta_CI(m1, conf = .95)
  CI_95
  plot(m1)
  library(hnp)


## Check goodness-of-fit using a half-normal plot with a simulated envelope
  library(hnp)
  hnp(m1)


## Graph the profile likelihood
  library(ggplot2)
  ggplot(m1$profile_loglik, aes(x = grid, y = prof)) +
    theme_bw() +
    geom_line() +
    xlim(0,1.5) +
    xlab(expression(theta)) +
    ylab("Log-likelihood") + 
    geom_vline(xintercept = CI_95, lty = 3) + 
    labs(title = "   Log-likelihood versus theta", 
      caption = "dotted vertical lines are upper and lower bounds of 95% CI for theta")
         
## Fit the average pairwise model, including theta, using DI and custom_formula
## A value of theta must be 'chosen'. Take: 0.4533437 from m1. The 'estimate_theta' option is not
##  available with custom_formula.
  AV_variable &lt;- DI_data(prop = c(3:6), data = sim2, theta = 0.4533437, what = "AV")
  sim2a &lt;- data.frame(sim2, "AV_theta" = AV_variable)
  m2 &lt;- DI(y = "response", custom_formula = response ~ 0 + p1 + p2 + p3 + p4 + AV_theta + block, 
           data = sim2a)
## This will adjust the standard errors in m2 for the 'estimation' of theta
  m2$df.residual &lt;- m2$df.residual - 1
## This will adjust the AIC in m2 for the 'estimation' of theta
  m2$aic &lt;- m2$aic + 2
  summary(m2)
  
</code></pre>

<hr>
<h2 id='sim3'>
The Simulated &quot;sim3&quot; Dataset
</h2><span id='topic+sim3'></span>

<h3>Description</h3>

<p>The <code>sim3</code> dataset was simulated. There are two treatments and nine species that vary in proportions (<code>p1 - p9</code>). It is assumed that species 1 to 5 come from functional group 1, species 6 and 7 from functional group 2 and species 8 and 9 from functional group 3. The response was simulated assuming that there were species identity effects and functional group specific interaction effects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(sim3)</code></pre>


<h3>Format</h3>

<p>A data frame with 412 observations on the following 13 variables:
</p>

<dl>
<dt><code>community</code></dt><dd><p>A numeric vector identifying each unique community, i.e., two rows with the same community value also share the same set of p1 to p9 values.</p>
</dd>
<dt><code>richness</code></dt><dd><p>A numeric vector identifying the number of species in the initial composition.</p>
</dd>
<dt><code>treatment</code></dt><dd><p>A factor with levels <code>A</code> or  <code>B</code>.</p>
</dd>
<dt><code>p1</code></dt><dd><p>A numeric vector indicating the initial proportion of species 1.</p>
</dd>
<dt><code>p2</code></dt><dd><p>A numeric vector indicating the initial proportion of species 2.</p>
</dd>
<dt><code>p3</code></dt><dd><p>A numeric vector indicating the initial proportion of species 3.</p>
</dd>
<dt><code>p4</code></dt><dd><p>A numeric vector indicating the initial proportion of species 4.</p>
</dd>
<dt><code>p5</code></dt><dd><p>A numeric vector indicating the initial proportion of species 5.</p>
</dd>
<dt><code>p6</code></dt><dd><p>A numeric vector indicating the initial proportion of species 6.</p>
</dd>
<dt><code>p7</code></dt><dd><p>A numeric vector indicating the initial proportion of species 7.</p>
</dd>
<dt><code>p8</code></dt><dd><p>A numeric vector indicating the initial proportion of species 8.</p>
</dd>
<dt><code>p9</code></dt><dd><p>A numeric vector indicating the initial proportion of species 9.</p>
</dd>
<dt><code>response</code></dt><dd><p>A numeric vector giving the simulated response variable.</p>
</dd> 
</dl>



<h3>Details</h3>

<p><strong>What are Diversity-Interactions (DI) models?</strong> 
</p>
<p>Diversity-Interactions (DI) models (Kirwan et al 2009) are a set of tools for analysing and interpreting data from experiments that explore the effects of species diversity on community-level responses. We strongly recommend that users read the short introduction to Diversity-Interactions models (available at: <code><a href="#topic+DImodels">DImodels</a></code>). Further information on Diversity-Interactions models is also available in Kirwan et al 2009 and Connolly et al 2013.
</p>
<p><strong>Parameter values for the simulation</strong> 
</p>
<p>DI models take the general form of:   
</p>
<p style="text-align: center;"><code class="reqn">y = Identities + Interactions + Structures + \epsilon</code>
</p>

<p>where <em>y</em> is a community-level response, the <em>Identities</em> are the effects of species identities and enter the model as individual species proportions at the beginning of the time period, the <em>Interactions</em> are the interactions among the species proportions, while <em>Structures</em> include other experimental structures such as blocks, treatments or density. 
</p>
<p>The dataset <code>sim3</code> was simulated with:  
</p>

<ul>
<li><p> identity effects for the nine species with values = 10, 9, 8, 7, 11, 6, 5, 8, 9
</p>
</li>
<li><p> treatment effects = 3, 0
</p>
</li>
<li><p> functional group specific interact effects; assume functional groups are labelled FG1, FG2 and FG3, then the interaction parameter values are: between FG1 and FG2 = 4, between FG1 and FG3 = 9, between FG2 and FG3 = 3, within FG1 = 2, within FG2 = 3 and within FG3 = 1 
</p>
</li>
<li><p> theta = 1 (where <code class="reqn">\theta</code> is a non-linear parameter included as a power on each <code class="reqn">pipj</code> product within interaction variables, see Connolly et al 2013 for details)
</p>
</li>
<li> <p><code class="reqn">\epsilon</code> assumed normally distributed with mean 0 and standard deviation 1.2.
</p>
</li></ul>



<h3>References</h3>

<p>Connolly J, T Bell, T Bolger, C Brophy, T Carnus, JA Finn, L Kirwan, F Isbell, J Levine, A Lüscher, V Picasso, C Roscher, MT Sebastia, M Suter and A Weigelt (2013) An improved model to predict the effects of changing biodiversity levels on ecosystem function. Journal of Ecology, 101, 344-355. 
</p>
<p>Kirwan L, J Connolly, JA Finn, C Brophy, A Lüscher, D Nyfeler and MT Sebastia (2009) Diversity-interaction modelling - estimating contributions of species identities and interactions to ecosystem function. Ecology, 90, 2032-2038. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
####################################
## Code to simulate the sim3 dataset
  


## Simulate dataset sim3 with 9 species, three functional groups and two levels of a treatment.
## The species 1-5 are FG1, species 6-7 are FG2 and species 8-9 are FG3. 
## Assume ID effects and the FG interaction model, with a treatment (factor with two levels).

## Set up proportions
  data("design_a")
  sim3a &lt;- design_a

# Replicate the design over two treatments
  sim3b &lt;- sim3a[rep(seq_len(nrow(sim3a)), each = 2), ]
  sim3c &lt;- data.frame(treatment = factor(rep(c("A","B"), times = 206))) 
  sim3 &lt;- data.frame(sim3b[,1:2], sim3c, sim3b[,3:11])
  row.names(sim3) &lt;- NULL

## Create the functional group interaction variables
  FG_matrix &lt;- DI_data(prop = 4:12, FG = c("FG1","FG1","FG1","FG1","FG1","FG2","FG2","FG3","FG3"),
                        data = sim3, what = "FG")
  sim3 &lt;- data.frame(sim3, FG_matrix)

## To simulate the response, first create a matrix of predictors that includes p1-p9, the treatment 
##  and the interaction variables. 
  X &lt;- model.matrix(~ p1 + p2 + p3 + p4 + p5 + p6 + p7 + p8 + p9 + treatment 
                    + bfg_FG1_FG2 + bfg_FG1_FG3 + bfg_FG2_FG3 
                    + wfg_FG1 + wfg_FG2 + wfg_FG3 -1, data=sim3)

## Create a vector of 'known' parameter values for simulating the response.
## The first nine are the p1-p9 parameters, and the second set of two are the treatment effects 
##   and the third set of six are the interaction parameters.
  sim3_coeff &lt;- c(10,9,8,7,11, 6,5, 8,9,   3,0,      4,9,3, 2,3,1)

## Create response and add normally distributed error 
  sim3$response &lt;- as.numeric(X %*% sim3_coeff)
  set.seed(1657914)
  r &lt;- rnorm(n = 412, mean = 0, sd = 1.2)
  sim3$response &lt;- round(sim3$response + r, digits = 3)

  sim3[,13:18] &lt;- NULL




###########################
## Analyse the sim3 dataset

## Load the sim3 data
  data(sim3)
## View the first few entries
  head(sim3)
## Explore the variables in sim3
  str(sim3)

## Check characteristics of sim3
  hist(sim3$response)
  summary(sim3$response)
  plot(sim3$richness, sim3$response)
  plot(sim3$p1, sim3$response)
  plot(sim3$p2, sim3$response)
  plot(sim3$p3, sim3$response)
  plot(sim3$p4, sim3$response)
  plot(sim3$p5, sim3$response)
  plot(sim3$p6, sim3$response)
  plot(sim3$p7, sim3$response)
  plot(sim3$p8, sim3$response)
  plot(sim3$p9, sim3$response)


## What model fits best? Selection using F-test in autoDI  
  auto1 &lt;- autoDI(y = "response", prop = 4:12, treat = "treatment", 
                  FG = c("FG1","FG1","FG1","FG1","FG1","FG2","FG2","FG3","FG3"), data = sim3, 
                  selection = "Ftest")
  summary(auto1)


## Fit the functional group model, with treatment, using DI and the FG tag
  m1 &lt;- DI(y = "response", prop = 4:12, 
           FG = c("FG1","FG1","FG1","FG1","FG1","FG2","FG2","FG3","FG3"), treat = "treatment", 
           DImodel = "FG", data = sim3)
  summary(m1)
  plot(m1)


## Check goodness-of-fit using a half-normal plot with a simulated envelope
  library(hnp)
  hnp(m1)


## Create the functional group interactions and store them in a new dataset
  FG_matrix &lt;- DI_data(prop = 4:12, FG = c("FG1","FG1","FG1","FG1","FG1","FG2","FG2","FG3","FG3"), 
                        data = sim3, what = "FG")
  sim3a &lt;- data.frame(sim3, FG_matrix)

## Test if the FG interaction variables interact with treatment using 'extra_formula'
  m2 &lt;- DI(y = "response", prop = 4:12, 
           FG = c("FG1","FG1","FG1","FG1","FG1","FG2","FG2","FG3","FG3"),
           treat = "treatment", DImodel = "FG", extra_formula = ~ bfg_FG1_FG2:treatment 
           + bfg_FG1_FG3:treatment + bfg_FG2_FG3:treatment + wfg_FG1:treatment + wfg_FG2:treatment 
           + wfg_FG3:treatment, data = sim3a)
  summary(m2)

## Fit the functional group model using DI and custom_formula
## Set up a dummy variable for treatment first (required).
  sim3a$treatmentA &lt;- as.numeric(sim3a$treatment=="A")
  m3 &lt;- DI(y = "response", custom_formula = response ~ 0 + p1 + p2 + p3 + p4 + p5 + p6 + p7 + p8 
           + p9 + treatmentA + bfg_FG1_FG2 + bfg_FG1_FG3 + bfg_FG2_FG3 + wfg_FG1 + wfg_FG2 
           + wfg_FG3, data = sim3a)
  summary(m3)
</code></pre>

<hr>
<h2 id='sim4'>
The Simulated &quot;sim4&quot; Dataset
</h2><span id='topic+sim4'></span>

<h3>Description</h3>

<p>The <code>sim4</code> dataset was simulated. There is a covariate treatment and six species that vary in proportions (<code>p1 - p6</code>). It is assumed that species 1 and 2 come from functional group 1, species 3 and 4 from functional group 2 and species 5 and 6 from functional group 3. The response was simulated assuming that there were species identity effects, separate pairwise interaction effects and a covariate effect. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(sim4)</code></pre>


<h3>Format</h3>

<p>A data frame with 141 observations on the following nine variables:
</p>

<dl>
<dt><code>richness</code></dt><dd><p>A numeric vector identifying the number of species in the initial composition.</p>
</dd>
<dt><code>treatment</code></dt><dd><p>A covariate taking values 50, 150 or 250.</p>
</dd>
<dt><code>p1</code></dt><dd><p>A numeric vector indicating the initial proportion of species 1.</p>
</dd>
<dt><code>p2</code></dt><dd><p>A numeric vector indicating the initial proportion of species 2.</p>
</dd>
<dt><code>p3</code></dt><dd><p>A numeric vector indicating the initial proportion of species 3.</p>
</dd>
<dt><code>p4</code></dt><dd><p>A numeric vector indicating the initial proportion of species 4.</p>
</dd>
<dt><code>p5</code></dt><dd><p>A numeric vector indicating the initial proportion of species 5.</p>
</dd>
<dt><code>p6</code></dt><dd><p>A numeric vector indicating the initial proportion of species 6.</p>
</dd>
<dt><code>response</code></dt><dd><p>A numeric vector giving the simulated response variable.</p>
</dd> 
</dl>



<h3>Details</h3>

<p><strong>What are Diversity-Interactions (DI) models?</strong> 
</p>
<p>Diversity-Interactions (DI) models (Kirwan et al 2009) are a set of tools for analysing and interpreting data from experiments that explore the effects of species diversity on community-level responses. We strongly recommend that users read the short introduction to Diversity-Interactions models (available at: <code><a href="#topic+DImodels">DImodels</a></code>). Further information on Diversity-Interactions models is also available in Kirwan et al 2009 and Connolly et al 2013.
</p>
<p><strong>Parameter values for the simulation</strong> 
</p>
<p>DI models take the general form of:   
</p>
<p style="text-align: center;"><code class="reqn">y = Identities + Interactions + Structures + \epsilon</code>
</p>

<p>where <em>y</em> is a community-level response, the <em>Identities</em> are the effects of species identities and enter the model as individual species proportions at the beginning of the time period, the <em>Interactions</em> are the interactions among the species proportions, while <em>Structures</em> include other experimental structures such as blocks, treatments or density. 
</p>
<p>The dataset <code>sim4</code> was simulated with:  
</p>

<ul>
<li><p> identity effects for the six species with values = 25, 16, 18, 20, 10, 12
</p>
</li>
<li><p> a covariate effect = 0.03
</p>
</li>
<li><p> all 15 pairwise interaction effects with values: 30, 27, 20, 15, 10, 9, 14, 18, 36, 17, 26, 32, 9, 21, 16 (for pairs of species 1-2, 1-3, 1-4, 1-5, 1-6, 2-3, 2-4, ... , 5-6 respectively). 
</p>
</li>
<li><p> theta = 1 (where <code class="reqn">\theta</code> is a non-linear parameter included as a power on each <code class="reqn">pipj</code> product within interaction variables, see Connolly et al 2013 for details)
</p>
</li>
<li> <p><code class="reqn">\epsilon</code> assumed normally distributed with mean 0 and standard deviation 2.
</p>
</li></ul>



<h3>References</h3>

<p>Connolly J, T Bell, T Bolger, C Brophy, T Carnus, JA Finn, L Kirwan, F Isbell, J Levine, A Lüscher, V Picasso, C Roscher, MT Sebastia, M Suter and A Weigelt (2013) An improved model to predict the effects of changing biodiversity levels on ecosystem function. Journal of Ecology, 101, 344-355. 
</p>
<p>Kirwan L, J Connolly, JA Finn, C Brophy, A Lüscher, D Nyfeler and MT Sebastia (2009) Diversity-interaction modelling - estimating contributions of species identities and interactions to ecosystem function. Ecology, 90, 2032-2038. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
####################################
## Code to simulate the sim4 dataset
  


## Simulate dataset sim4 with 6 species, three functional groups and three levels of a covariate
## The species 1-2 are FG1, species 3-4 are FG2 and species 5-6 are FG3. 
## Assume ID effects and the full pairwise interaction model, with a covariate.

## Set up proportions
  data("design_b")
  sim4a &lt;- design_b

# Replicate the design for three values of a covariate
  sim4b &lt;- sim4a[rep(seq_len(nrow(sim4a)), times = 3), ]
  sim4c &lt;- data.frame(treatment = rep(c(50, 150, 250), each = 47))
  sim4 &lt;- data.frame(richness = sim4b[,1], sim4c, sim4b[,2:7])
  row.names(sim4) &lt;- NULL

## To simulate the response, first create a matrix of predictors that includes p1-p6, the treatment 
##  and all pairwise interaction variables 
  X &lt;- model.matrix(~ p1 + p2 + p3 + p4 + p5 + p6 + treatment + (p1 + p2 + p3 + p4 + p5 + p6)^2 -1,
                    data = sim4)

## Create a vector of 'known' parameter values for simulating the response.
## The first six are the p1-p6 parameters, and the second set of one is the treatment parameter 
##  and the third set of 15 are the interaction parameters.
  sim4_coeff &lt;- c(25,16,18,20,10,12,    0.03,      30,27,20,15,10,9,14,18,36,17,26,32,9,21,16)

## Create response and add normally distributed error 
  sim4$response &lt;- as.numeric(X %*% sim4_coeff)
  set.seed(34261)
  r &lt;- rnorm(n = 141, mean = 0, sd = 2)
  sim4$response &lt;- round(sim4$response + r, digits = 3)




###########################
## Analyse the sim4 dataset

## Load the sim4 data
  data(sim4)
## View the first few entries
  head(sim4)
## Explore the variables in sim4
  str(sim4)

## Check characteristics of sim4
  hist(sim4$response)
  summary(sim4$response)
  plot(sim4$richness, sim4$response)
  plot(sim4$richness[sim4$treatment==50], sim4$response[sim4$treatment==50], ylim=c(0,40))
  plot(sim4$richness[sim4$treatment==150], sim4$response[sim4$treatment==150], ylim=c(0,40))
  plot(sim4$richness[sim4$treatment==250], sim4$response[sim4$treatment==250], ylim=c(0,40))
  plot(sim4$p1, sim4$response)
  plot(sim4$p2, sim4$response)
  plot(sim4$p3, sim4$response)
  plot(sim4$p4, sim4$response)
  plot(sim4$p5, sim4$response)
  plot(sim4$p6, sim4$response)


## What model fits best? Selection using F-test  
  auto1 &lt;- autoDI(y = "response", prop = 3:8, treat = "treatment", 
                  FG = c("FG1","FG1","FG2","FG2","FG3","FG3"), data = sim4, selection = "Ftest")
  summary(auto1)

## Ignore functional groups (will replace FG model with ADD model in Step 1 selection)  
  auto2 &lt;- autoDI(y = "response", prop = 3:8, treat = "treatment", data = sim4, selection = "Ftest")
  summary(auto2)


## Fit the functional group model using DI and the FG tag
  m1 &lt;- DI(y = "response", prop = 3:8, treat = "treatment", 
           FG = c("FG1","FG1","FG2","FG2","FG3","FG3"), DImodel = "FG", data = sim4)
  summary(m1)

## Fit the additive species model using DI and the ADD tag
  m2 &lt;- DI(y = "response", prop = 3:8, treat = "treatment", DImodel = "ADD", data = sim4)
  summary(m2)

## Fit the full pairwise model using DI and the FULL tag
  m3 &lt;- DI(y = "response", prop = 3:8, treat = "treatment", DImodel = "FULL", data = sim4)
  summary(m3)
  plot(m3)
  

## Check goodness-of-fit using a half-normal plot with a simulated envelope
  library(hnp)
  hnp(m3)


## Create the functional group and additive species interaction variables,
##  and store in a new data frame called sim4a
  newlist &lt;- DI_data(prop = 3:8, FG = c("FG1","FG1","FG2","FG2","FG3","FG3"), 
                     data = sim4, what = c("FG", "ADD"))
  sim4a &lt;- data.frame(sim4, newlist$FG, newlist$ADD)

## Fit the functional group model using DI and custom_formula (equivalent to m1)
  m4 &lt;- DI(custom_formula = response ~ 0 + p1 + p2 + p3 + p4 + p5 + p6 + bfg_FG1_FG2 
           + bfg_FG1_FG3 + bfg_FG2_FG3 + wfg_FG1 + wfg_FG2 + wfg_FG3 + treatment, data = sim4a)
  summary(m4)

## Fit the additive species model using DI and custom_formula (equivalent to m2)
  m5 &lt;- DI(custom_formula = response ~ 0 + p1 + p2 + p3 + p4 + p5 + p6 + p1_add 
           + p2_add + p3_add + p4_add + p5_add + p6_add + treatment, data = sim4a)
  summary(m5)

## Fit the full pairwise model using DI and custom_formula (equivalent to m3)
  m6 &lt;- DI(custom_formula = response ~ 0 + p1 + p2 + p3 + p4 + p5 + p6 
           + (p1 + p2 + p3 + p4 + p5 + p6)^2 + treatment, data = sim4a)
  summary(m6)
  
</code></pre>

<hr>
<h2 id='sim5'>
The Simulated &quot;sim5&quot; Dataset
</h2><span id='topic+sim5'></span>

<h3>Description</h3>

<p>The <code>sim5</code> dataset was simulated. There are nine species that vary in proportions (<code>p1 - p9</code>). It is assumed that species 1 to 5 come from functional group 1, species 6 and 7 from functional group 2 and species 8 and 9 from functional group 3. The response was simulated assuming that there were species identity effects and functional group specific interaction effects, with theta  = 0.7. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(sim5)</code></pre>


<h3>Format</h3>

<p>A data frame with 206 observations on the following 12 variables:
</p>

<dl>
<dt><code>community</code></dt><dd><p>A numeric vector identifying each unique community, i.e., two rows with the same community value also share the same set of p1 to p9 values.</p>
</dd>
<dt><code>richness</code></dt><dd><p>A numeric vector identifying the number of species in the initial composition.</p>
</dd>
<dt><code>p1</code></dt><dd><p>A numeric vector indicating the initial proportion of species 1.</p>
</dd>
<dt><code>p2</code></dt><dd><p>A numeric vector indicating the initial proportion of species 2.</p>
</dd>
<dt><code>p3</code></dt><dd><p>A numeric vector indicating the initial proportion of species 3.</p>
</dd>
<dt><code>p4</code></dt><dd><p>A numeric vector indicating the initial proportion of species 4.</p>
</dd>
<dt><code>p5</code></dt><dd><p>A numeric vector indicating the initial proportion of species 5.</p>
</dd>
<dt><code>p6</code></dt><dd><p>A numeric vector indicating the initial proportion of species 6.</p>
</dd>
<dt><code>p7</code></dt><dd><p>A numeric vector indicating the initial proportion of species 7.</p>
</dd>
<dt><code>p8</code></dt><dd><p>A numeric vector indicating the initial proportion of species 8.</p>
</dd>
<dt><code>p9</code></dt><dd><p>A numeric vector indicating the initial proportion of species 9.</p>
</dd>
<dt><code>response</code></dt><dd><p>A numeric vector giving the simulated response variable.</p>
</dd> 
</dl>



<h3>Details</h3>

<p><strong>What are Diversity-Interactions (DI) models?</strong> 
</p>
<p>Diversity-Interactions (DI) models (Kirwan et al 2009) are a set of tools for analysing and interpreting data from experiments that explore the effects of species diversity on community-level responses. We strongly recommend that users read the short introduction to Diversity-Interactions models (available at: <code><a href="#topic+DImodels">DImodels</a></code>). Further information on Diversity-Interactions models is also available in Kirwan et al 2009 and Connolly et al 2013.
</p>
<p><strong>Parameter values for the simulation</strong> 
</p>
<p>DI models take the general form of:   
</p>
<p style="text-align: center;"><code class="reqn">y = Identities + Interactions + Structures + \epsilon</code>
</p>

<p>where <em>y</em> is a community-level response, the <em>Identities</em> are the effects of species identities and enter the model as individual species proportions at the beginning of the time period, the <em>Interactions</em> are the interactions among the species proportions, while <em>Structures</em> include other experimental structures such as blocks, treatments or density. 
</p>
<p>The dataset <code>sim5</code> was simulated with:  
</p>

<ul>
<li><p> identity effects for the nine species with values = 10, 9, 8, 7, 11, 6, 5, 8, 9
</p>
</li>
<li><p> functional group specific interaction effects; assume functional groups are labelled FG1, FG2 and FG3, then the interaction parameter values are: between FG1 and FG2 = 8, between FG1 and FG3 = 3, between FG2 and FG3 = 6, within FG1 = 6, within FG2 = 4 and within FG3 = 5 
</p>
</li>
<li><p> theta = 0.7 (where <code class="reqn">\theta</code> is a non-linear parameter included as a power on each <code class="reqn">pipj</code> product within interaction variables, see Connolly et al 2013 for details)
</p>
</li>
<li> <p><code class="reqn">\epsilon</code> assumed normally distributed with mean 0 and standard deviation 1.2.
</p>
</li></ul>



<h3>References</h3>

<p>Connolly J, T Bell, T Bolger, C Brophy, T Carnus, JA Finn, L Kirwan, F Isbell, J Levine, A Lüscher, V Picasso, C Roscher, MT Sebastia, M Suter and A Weigelt (2013) An improved model to predict the effects of changing biodiversity levels on ecosystem function. Journal of Ecology, 101, 344-355. 
</p>
<p>Kirwan L, J Connolly, JA Finn, C Brophy, A Lüscher, D Nyfeler and MT Sebastia (2009) Diversity-interaction modelling - estimating contributions of species identities and interactions to ecosystem function. Ecology, 90, 2032-2038. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
####################################
## Code to simulate the sim5 dataset
  


## Simulate dataset sim5 with 9 species and three functional groups.
## The species 1-5 are FG1, species 6-7 are FG2 and species 8-9 are FG3. 
## Assume ID effects and the FG interactions model, with theta = 0.7.

## Set up proportions
  data("design_a")
  sim5 &lt;- design_a

## Create the functional group interaction variables, with theta = 0.7.
  FG_matrix &lt;- DI_data(prop = 3:11, FG = c("FG1","FG1","FG1","FG1","FG1","FG2","FG2","FG3","FG3"),
                        data = sim5, theta = 0.7, what = "FG")
  sim5 &lt;- data.frame(sim5, FG_matrix)
  names(sim5)[12:17] &lt;- paste0(names(sim5)[12:17], "_theta")

## To simulate the response, first create a matrix of predictors that includes p1-p9, the 
##  treatment and the interaction variables.
  X &lt;- model.matrix(~ p1 + p2 + p3 + p4 + p5 + p6 + p7 + p8 + p9 
                    + bfg_FG1_FG2_theta + bfg_FG1_FG3_theta + bfg_FG2_FG3_theta 
                    + wfg_FG1_theta + wfg_FG2_theta + wfg_FG3_theta -1, data = sim5)

## Create a vector of 'known' parameter values for simulating the response.
## The first nine are the p1-p9 parameters, and the second set of six are the interaction 
##  parameters. 
  sim5_coeff &lt;- c(10,9,8,7,11, 6,5, 8,9,     8,3,6, 6,4,5)

##Create response and add normally distributed error 
  sim5$response &lt;- as.numeric(X %*% sim5_coeff)
  set.seed(35748)
  r &lt;- rnorm(n = 206, mean = 0, sd = 1.2)
  sim5$response &lt;- round(sim5$response + r, digits = 3)
  sim5[,12:17] &lt;- NULL
  




###########################
## Analyse the sim5 dataset

## Load the sim5 data
  data(sim5)
## View the first few entries
  head(sim5)
## Explore the variables in sim5
  str(sim5)

## Check characteristics of sim5
  hist(sim5$response)
  summary(sim5$response)
  plot(sim5$richness, sim5$response)
  plot(sim5$p1, sim5$response)
  plot(sim5$p2, sim5$response)
  plot(sim5$p3, sim5$response)
  plot(sim5$p4, sim5$response)
  plot(sim5$p5, sim5$response)
  plot(sim5$p6, sim5$response)
  plot(sim5$p7, sim5$response)
  plot(sim5$p8, sim5$response)
  plot(sim5$p9, sim5$response)

## What model fits best? Selection using F-test in autoDI 
  auto1 &lt;- autoDI(y = "response", prop = 3:11, 
                  FG = c("FG1","FG1","FG1","FG1","FG1","FG2","FG2","FG3","FG3"), 
                  data = sim5, selection = "Ftest")
  summary(auto1)

## Fit the functional group model, with theta, using DI and the FG tag
  m1 &lt;- DI(y = "response", prop = 3:11, 
           FG = c("FG1","FG1","FG1","FG1","FG1","FG2","FG2","FG3","FG3"), DImodel = "FG", 
           estimate_theta = TRUE, data = sim5)
  summary(m1)
  CI_95 &lt;- theta_CI(m1, conf = .95)
  CI_95
  plot(m1)


## Check goodness-of-fit using a half-normal plot with a simulated envelope
  library(hnp)
  hnp(m1)


## Graph the profile likelihood
  library(ggplot2)
  ggplot(m1$profile_loglik, aes(x = grid, y = prof)) +
    theme_bw() +
    geom_line() +
    xlim(0,1.5) +
    xlab(expression(theta)) +
    ylab("Log-likelihood") + 
    geom_vline(xintercept = CI_95, lty = 3) + 
    labs(title = "   Log-likelihood versus theta", 
            caption = "dotted vertical lines are upper and lower bounds of 95% CI for theta")
    
## Fit the functional group model, with theta set equal to the estimate from m1, and custom_formula.
## Note, it is not possible to estimate theta with custom_formula (only select a 'known' value). 
## First, create the functional group interactions (theta value as estimated from m1), 
##  store them in a new dataset and rename them with a theta indicator.
  FG_matrix &lt;- DI_data(prop = 3:11, FG=c("FG1","FG1","FG1","FG1","FG1","FG2","FG2","FG3","FG3"), 
                      theta = 0.7296887, data = sim5, what = "FG")
  sim5new &lt;- data.frame(sim5, FG_matrix)
  names(sim5new)[13:18] &lt;- paste0(names(sim5new)[13:18], "_theta")
  m2 &lt;- DI(custom_formula = response ~ 0 + p1 + p2 + p3 + p4 + p5 + p6 + p7 + p8 + p9 + 
         bfg_FG1_FG2_theta + bfg_FG1_FG3_theta + bfg_FG2_FG3_theta 
         + wfg_FG1_theta + wfg_FG2_theta + wfg_FG3_theta, data = sim5new)
## This will adjust the standard errors in m2 for the 'estimation' of theta
  m2$df.residual &lt;- m2$df.residual - 1
## This will adjust the AIC in m2 for the 'estimation' of theta
  m2$aic &lt;- m2$aic + 2
  summary(m2)

</code></pre>

<hr>
<h2 id='Switzerland'>
The &quot;Switzerland&quot; Dataset
</h2><span id='topic+Switzerland'></span>

<h3>Description</h3>

<p>This dataset comes from a grassland biodiversity experiment that was conducted in Switzerland as part of the &quot;Agrodiversity Experiment&quot; (Kirwan et al 2014). A total of 68 grassland plots were established across a gradient of species diversity, and two additional treatments (nitrogen fertiliser and total seed density) were also manipulated. The proportions of four species were varied across the plots: there were plots with 100% of a single species, and 2- and 4-species mixtures with  varying proportions (e.g., (0.5, 0.5, 0, 0) and (0.7, 0.1, 0.1, 0.1)). Nitrogen fertiliser was either 50 or 100 kg N per annum and total seed density was either low or high. Total annual yield per plot was recorded for the first year after establishment. An analysis of the Switzerland dataset is presented in Kirwan et al 2009. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("Switzerland")</code></pre>


<h3>Format</h3>

<p>A data frame with 68 observations on the following 8 variables:
</p>

<dl>
<dt><code>plot</code></dt><dd><p>A numeric vector uniquely identifying each of the 68 plots.</p>
</dd>
<dt><code>nitrogen</code></dt><dd><p>A factor with two levels: &quot;50&quot; or &quot;150&quot; to indicate the level of nitrogen fertiliser (kg N per annum) applied to the plot.</p>
</dd>
<dt><code>density</code></dt><dd><p>A factor with two levels: &quot;low&quot; and &quot;high&quot; to indicate the level of total seed density used when sowing the plot.</p>
</dd>
<dt><code>p1</code></dt><dd><p>A numeric vector indicating the proportion of species 1 in the plot. Species 1 was the grass species <em>Lolium perenne</em>.</p>
</dd>
<dt><code>p2</code></dt><dd><p>A numeric vector indicating the proportion of species 2 in the plot. Species 2 was the grass species <em>Dactylis glomerata</em>.</p>
</dd>
<dt><code>p3</code></dt><dd><p>A numeric vector indicating the proportion of species 3 in the plot. Species 3 was the legume species <em>Trifolium pratense</em>.</p>
</dd>
<dt><code>p4</code></dt><dd><p>A numeric vector indicating the proportion of species 4 in the plot. Species 4 was the legume species <em>Trifolium repens</em>.</p>
</dd>
<dt><code>yield</code></dt><dd><p>A numeric vector giving the total dry matter yield for the plot (tonnes per hectare per annum).</p>
</dd> 
</dl>



<h3>Details</h3>

<p><strong>What are Diversity-Interactions (DI) models?</strong>
</p>
<p>Diversity-Interactions (DI) models (Kirwan et al 2009) are a set of tools for analysing and interpreting data from experiments that explore the effects of species diversity on community-level responses. We strongly recommend that users read the short introduction to Diversity-Interactions models (available at: <code><a href="#topic+DImodels">DImodels</a></code>). Further information on Diversity-Interactions models is also available in Kirwan et al 2009 and Connolly et al 2013.
</p>
<p><strong>Functional groups</strong>
</p>
<p>In Ecology, species can be categorised into 'functional groups' based on their traits and functions. Here, the four species comprise two grasses (species 1 and 2) and two legumes (species 3 and 4); this is one possible 'functional group' categorisation of the four species. 
</p>


<h3>Source</h3>

<p>Kirwan L, J Connolly, C Brophy, O Baadshaug, G Belanger, A Black, T Carnus, R Collins, J Čop, I Delgado, A De Vliegher, A Elgersma, B Frankow-Lindberg, P Golinski, P Grieu, AM Gustavsson, Á Helgadóttir, M Höglind, O Huguenin-Elie, M Jørgensen, Ž Kadžiuliene, T Lunnan, A Lüscher, P Kurki, C Porqueddu, MT Sebastia, U Thumm, D Walmsley and JA Finn (2014) The Agrodiversity Experiment: three years of data from a multisite study in intensively managed grasslands. Ecology, 95, 2680.
</p>


<h3>References</h3>

<p>Connolly J, T Bell, T Bolger, C Brophy, T Carnus, JA Finn, L Kirwan, F Isbell, J Levine, A Lüscher, V Picasso, C Roscher, MT Sebastia, M Suter and A Weigelt (2013) An improved model to predict the effects of changing biodiversity levels on ecosystem function. Journal of Ecology, 101, 344-355.
</p>
<p>Kirwan L, J Connolly, JA Finn, C Brophy, A Lüscher, D Nyfeler and MT Sebastia (2009) Diversity-interaction modelling - estimating contributions of species identities and interactions to ecosystem function. Ecology, 90, 2032-2038.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Load the Switzerland data
  data(Switzerland)
## View the first few entries
  head(Switzerland)
## Explore the variables in Switzerland
  str(Switzerland)

## Histogram of the response variable yield
  hist(Switzerland$yield)
## Explore the marginal relationship between yield and each predictor
  plot(Switzerland$p1, Switzerland$yield)
  plot(Switzerland$p2, Switzerland$yield)
  plot(Switzerland$p3, Switzerland$yield)
  plot(Switzerland$p4, Switzerland$yield)
  boxplot(yield ~ nitrogen, data = Switzerland)
  boxplot(yield ~ density, data = Switzerland)
  
## Check that the proportions sum to 1 (required for DI models)
## p1 to p4 are in the 4th to 7th columns in Switzerland
  Switzerlandsums &lt;- rowSums(Switzerland[4:7])
  summary(Switzerlandsums)
  
## Model selection by F-test
  auto1 &lt;- autoDI(y = "yield", density = "density", prop = c("p1","p2","p3","p4"), 
                  treat = "nitrogen", FG = c("G","G","L","L"), data = Switzerland, 
                  selection = "Ftest")
  summary(auto1)
  
## Fit the model chosen by autoDI using DI
  m1 &lt;- DI(y = "yield", density = "density", prop = 4:7, DImodel = "FG", FG = c("G","G","L","L"), 
           data = Switzerland)
  summary(m1)  
  plot(m1)
  

## Check goodness-of-fit using a half-normal plot with a simulated envelope
  library(hnp)
  hnp(m1)

  
## Set up the functional group interactions and add to a new Switzerland2 dataset
  FG_matrix &lt;- DI_data(prop = 4:7, FG = c("G","G","L","L"), 
                          data = Switzerland, what = "FG")
  Switzerland2 &lt;- data.frame(Switzerland, FG_matrix)
  
## Additional model testing using DI to test for interactions with nitrogen
  m2 &lt;- DI(y = "yield", block = "density", prop = 4:7, DImodel = "FG", FG = c("G","G","L","L"), 
           data = Switzerland2, extra_formula = ~ nitrogen:bfg_G_L)
  summary(m2) 

</code></pre>

<hr>
<h2 id='theta_CI'>
Compute Confidence Interval for Theta
</h2><span id='topic+theta_CI'></span>

<h3>Description</h3>

<p>This function allows the computation of a confidence interval for theta from a model object created from <code>DI</code> that includes the argument <code>estimate_theta = TRUE</code>, or from certain model objects created from <code>autoDI</code>.
</p>
<p>A description of the non-linear parameter theta is available in Connolly et al 2013. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>theta_CI(obj, conf = .95, n =100)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="theta_CI_+3A_obj">obj</code></td>
<td>
<p>DI model object.</p>
</td></tr>
<tr><td><code id="theta_CI_+3A_conf">conf</code></td>
<td>
<p>Confidence level of the interval. The default is 0.95.</p>
</td></tr>
<tr><td><code id="theta_CI_+3A_n">n</code></td>
<td>
<p>Number of subintervals in which the root is sought. The default is 100.</p>
</td></tr>
</table>


<h3>Details</h3>

 
<p>The confidence interval calculated here is based on the values obtained when profiling the log-likelihood function for different values of theta. It is obtained in four steps:
</p>
<p>1. define a grid of values for theta ranging from 0.01 to 2.5 of length 101 including the profile likelihood estimate of theta
</p>
<p>2. fit the DI model setting theta equal to each value in the grid and obtain the log-likelihood value corresponding to each value of theta
</p>
<p>3. obtain linear interpolations between the log-likelihood (<code class="reqn">l</code>) values (here we use <code><a href="stats.html#topic+approxfun">approxfun</a></code>)
</p>
<p>4. calculate the lower and upper values of the CI by obtaining the values of theta corresponding to a log-likelihood value of <code class="reqn">max_\theta(l) - 0.5*\chi^2_(1-\alpha;1)</code>, where <code class="reqn">max_\theta(l)</code> is the maximum value of the profile log-likelihood obtained in the grid and <code class="reqn">\chi^2_(conf;1)</code> is the <code class="reqn">conf*100</code>% percentile of the chi-squared distribution with 1 d.f.
</p>
<p>When fitting any DI model setting <code>estimate_theta = TRUE</code>, steps 1 and 2 are automatically done within the <code>DI</code> function call. The <code>theta_CI</code> function performs steps 3 and 4 above to return the CI.
</p>
<p>Note that when maximising the log-likelihood to find the estimate for theta, the parametric space is limited between 0.01 and 1.5. The larger grid (up to 2.5) is constructed to allow for obtaining the upper bound of the confidence interval in case the estimate of theta is close to 1.5.
</p>


<h3>Value</h3>

<p>The function returns a named numeric vector with two values: the <code>lower</code> and <code>upper</code> limits of the <code>conf</code>*100% CI for theta.
</p>


<h3>Author(s)</h3>

<p>Rafael A. Moral, John Connolly and Caroline Brophy
</p>


<h3>References</h3>

<p>Connolly J, T Bell, T Bolger, C Brophy, T Carnus, JA Finn, L Kirwan, F Isbell, J Levine, A Lüscher, V Picasso, C Roscher, MT Sebastia, M Suter and A Weigelt (2013) An improved model to predict the effects of changing biodiversity levels on ecosystem function. Journal of Ecology, 101, 344-355.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+DI">DI</a></code>
<code><a href="#topic+autoDI">autoDI</a></code>
</p>
<p>Other examples using the <code>theta_CI</code> function:<br />
The <code><a href="#topic+Bell">Bell</a></code> dataset examples.<br />
The <code><a href="#topic+sim2">sim2</a></code> dataset examples.<br />
The <code><a href="#topic+sim5">sim5</a></code> dataset examples.<br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Load the sim5 data
  data(sim5)
## View the first five entries
  head(sim5)
## Explore the variables in sim5
  str(sim5)
  
## Fit the functional group model, with theta, using DI and the FG tag
  m1 &lt;- DI(y = "response", prop = 3:11, 
           FG = c("FG1","FG1","FG1","FG1","FG1","FG2","FG2","FG3","FG3"), DImodel = "FG", 
           estimate_theta = TRUE, data = sim5)
  summary(m1)
  CI_95 &lt;- theta_CI(m1, conf = .95)
  CI_95
## Graph the profile likelihood
  library(ggplot2)
  ggplot(m1$profile_loglik, aes(x = grid, y = prof)) +
    theme_bw() +
    geom_line() +
    xlim(0,1.5) +
    xlab(expression(theta)) +
    ylab("Log-likelihood") + 
    geom_vline(xintercept = CI_95, lty = 3) + 
    labs(title = "   Log-likelihood versus theta", 
         caption = "dotted vertical lines are upper and lower bounds of 95% CI for theta")


</code></pre>

<hr>
<h2 id='update_DI'>
Update DI function call
</h2><span id='topic+update_DI'></span>

<h3>Description</h3>

<p>Update the call to the <code><a href="#topic+DI">DI</a></code> function. This function allows users to update a previous call to the <code>DI</code> function by only updating the relevant arguments from <code>DI</code>, without the need to write out the full <code>DI</code> code again.   
</p>


<h3>Usage</h3>

<pre><code class='language-R'>update_DI(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="update_DI_+3A_object">object</code></td>
<td>
<p>a <code>DI</code> model object</p>
</td></tr>
<tr><td><code id="update_DI_+3A_...">...</code></td>
<td>
<p>other arguments passed to the <code><a href="#topic+DI">DI</a></code> function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A model object of class <code>"glm"</code> including the components detailed in <code><a href="stats.html#topic+glm">glm</a></code>, plus the following:
</p>
<table>
<tr><td><code>DIcall</code></td>
<td>
<p>the call of the <code>DI</code> function</p>
</td></tr>
<tr><td><code>DIinternalcall</code></td>
<td>
<p>an internal call made within the DI model fitting process</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Rafael A. Moral, John Connolly and Caroline Brophy
</p>


<h3>References</h3>

<p>Connolly J, T Bell, T Bolger, C Brophy, T Carnus, JA Finn, L Kirwan, F Isbell, J Levine, A Lüscher, V Picasso, C Roscher, MT Sebastia, M Suter and A Weigelt (2013) An improved model to predict the effects of changing biodiversity levels on ecosystem function. Journal of Ecology, 101, 344-355. 
</p>
<p>Kirwan L, J Connolly, JA Finn, C Brophy, A Lüscher, D Nyfeler and MT Sebastia (2009) Diversity-interaction modelling - estimating contributions of species identities and interactions to ecosystem function. Ecology, 90, 2032-2038. 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+DI">DI</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Load the Switzerland data
  data(Switzerland)

## Fit the FG DImodel, with factors density and treatment, and with theta = 1
  m1 &lt;- DI(y = "yield", density = "density", prop = 4:7, treat = "nitrogen", 
         FG = c("G","G","L","L"), DImodel = "FG", data = Switzerland)
  summary(m1)

## Fit the FG DImodel, with factors density and treatment, and theta estimated
  m2 &lt;- update_DI(m1, estimate_theta = TRUE)
  summary(m2)

## Fit the FULL DImodel, with factors density and treatment, and theta estimated
  m3 &lt;- update_DI(m1, DImodel = "FULL", estimate_theta = TRUE)
  summary(m3)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
