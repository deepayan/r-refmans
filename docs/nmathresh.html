<!DOCTYPE html><html><head><title>Help for package nmathresh</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {nmathresh}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#d_ab2i'><p>Convert contrast indexing</p></a></li>
<li><a href='#get.int'><p>Get thresholds from U matrix</p></a></li>
<li><a href='#nma_thresh'><p>Calculate thresholds and invariant intervals</p></a></li>
<li><a href='#recon_vcov'><p>Reconstruct likelihood covariance matrix</p></a></li>
<li><a href='#SocAnx.post.cov'><p>Posterior covariance matrix from Social Anxiety NMA</p></a></li>
<li><a href='#SocAnx.post.summary'><p>Posterior summary from Social Anxiety NMA</p></a></li>
<li><a href='#thresh_2d'><p>Producing two-dimensional invariant regions</p></a></li>
<li><a href='#thresh_forest'><p>Producing threshold forest plots</p></a></li>
<li><a href='#thresh-class'><p>The thresh class</p></a></li>
<li><a href='#Thrombo.post.cov'><p>Posterior covariance matrix from Thrombolytics NMA</p></a></li>
<li><a href='#Thrombo.post.summary'><p>Posterior summary from Thrombolytics NMA</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Thresholds and Invariant Intervals for Network Meta-Analysis</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.6</td>
</tr>
<tr>
<td>Description:</td>
<td>Calculation and presentation of decision-invariant bias adjustment
    thresholds and intervals for Network Meta-Analysis, as described by 
    Phillippo et al. (2018) &lt;<a href="https://doi.org/10.1111%2Frssa.12341">doi:10.1111/rssa.12341</a>&gt;. These describe the 
    smallest changes to the data that would result in a change of decision.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>TRUE</td>
</tr>
<tr>
<td>Imports:</td>
<td>nnls, grid, gridExtra, gtable, Matrix, ggplot2</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.1.0)</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.0</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, coda</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-06-11 13:57:46 UTC; dp14189</td>
</tr>
<tr>
<td>Author:</td>
<td>David Phillippo [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>David Phillippo &lt;david.phillippo@bristol.ac.uk&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-06-11 14:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='d_ab2i'>Convert contrast indexing</h2><span id='topic+d_ab2i'></span><span id='topic+d_i2ab'></span>

<h3>Description</h3>

<p>Functions for converting between <code class="reqn">d_{ab}</code> indexing of contrasts (useful
notationally) and <code>d[i]</code> indexing used by R.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>d_ab2i(a, b, K)

d_i2ab(i, K)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="d_ab2i_+3A_a">a</code></td>
<td>
<p>Vector of treatment codes <code class="reqn">a</code>.</p>
</td></tr>
<tr><td><code id="d_ab2i_+3A_b">b</code></td>
<td>
<p>Vector of treatment codes <code class="reqn">b</code>.</p>
</td></tr>
<tr><td><code id="d_ab2i_+3A_k">K</code></td>
<td>
<p>Total number of treatments.</p>
</td></tr>
<tr><td><code id="d_ab2i_+3A_i">i</code></td>
<td>
<p>Vector of indices <code>i</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>d_ab2i</code> returns a vector of indices <code>i</code>. <code>d_i2ab</code>
returns a data frame of indices <code>a</code> and <code>b</code>.
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>d_ab2i</code>: Convert <code>d[i]</code> type indices to <code class="reqn">d_{ab}</code> type indices.
</p>
</li>
<li> <p><code>d_i2ab</code>: Convert <code class="reqn">d_{ab}</code> type indices to <code>d[i]</code> type indices.
</p>
</li></ul>


<h3>Note</h3>

<p>By convention, <code class="reqn">1 \le a &lt; b \le K</code>. If this is not the case, an
error will be thrown. For a given number of treatments <code class="reqn">K</code>, the total
number of possible contrasts <code class="reqn">d_{ab}</code> is <code class="reqn">K(K-1)/2</code>, and hence
<code class="reqn">i \le K</code>. Again, if this is not the case, an error will be thrown.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>d_ab2i(c(1,1,1, 2,2, 3), c(2,3,4, 3,4, 4), K=4)
d_i2ab(1:6, K=4)

</code></pre>

<hr>
<h2 id='get.int'>Get thresholds from U matrix</h2><span id='topic+get.int'></span>

<h3>Description</h3>

<p>Return the positive and negative thresholds for an observation, given a
vector of possible threshold solutions. This function is intended for
internal use, and is called by <code>nma_thresh</code> automatically.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get.int(
  x,
  kstar,
  trt.code,
  contrs,
  mcid = FALSE,
  mean.dk = NULL,
  inflmat = NULL,
  opt.max = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get.int_+3A_x">x</code></td>
<td>
<p>Column of <code class="reqn">U</code> matrix, containing all possible threshold
solutions for a data point.</p>
</td></tr>
<tr><td><code id="get.int_+3A_kstar">kstar</code></td>
<td>
<p>Base-case optimal treatment.</p>
</td></tr>
<tr><td><code id="get.int_+3A_trt.code">trt.code</code></td>
<td>
<p>Vector of (possibly recoded) treatments. See
<code>nma_thresh</code> parameter of the same name.</p>
</td></tr>
<tr><td><code id="get.int_+3A_contrs">contrs</code></td>
<td>
<p>Details of contrasts corresponding to rows in <code>x</code>,
as rows of the data.frame output by <code>d_i2ab</code>.</p>
</td></tr>
<tr><td><code id="get.int_+3A_mcid">mcid</code></td>
<td>
<p>Use MCID decision rule? Default <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="get.int_+3A_mean.dk">mean.dk</code></td>
<td>
<p>Posterior means of basic treatment parameters, required when
<code>mcid</code> is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="get.int_+3A_inflmat">inflmat</code></td>
<td>
<p>Column of influence matrix <code class="reqn">H</code> for the data point,
required when <code>mcid</code> is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="get.int_+3A_opt.max">opt.max</code></td>
<td>
<p>Is the maximum treatment effect optimal? See
<code>nma_thresh</code> parameter of same name. Required when <code>mcid</code> is
<code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Data frame of thresholds and new optimal treatments with columns
<code>lo</code>, <code>lo.newkstar</code>, <code>hi</code>, and <code>hi.newkstar</code>.
</p>

<hr>
<h2 id='nma_thresh'>Calculate thresholds and invariant intervals</h2><span id='topic+nma_thresh'></span>

<h3>Description</h3>

<p>This function calculates decision-invariant bias-adjustment thresholds and
intervals for Bayesian network meta-analysis, as described by Phillippo
<em>et al.</em> (2018). Thresholds are derived from the joint
posterior, and reflect the amount of change to a data point before the
treatment decision changes. Calculation is achieved using fast matrix
operations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nma_thresh(
  mean.dk,
  lhood,
  post,
  nmatype = "fixed",
  X = NULL,
  mu.design = NULL,
  delta.design = NULL,
  opt.max = TRUE,
  trt.rank = 1,
  trt.code = NULL,
  trt.sub = NULL,
  mcid = 0,
  mcid.type = "decision"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nma_thresh_+3A_mean.dk">mean.dk</code></td>
<td>
<p>Posterior means of basic treatment parameters <code class="reqn">d_k</code>.</p>
</td></tr>
<tr><td><code id="nma_thresh_+3A_lhood">lhood</code></td>
<td>
<p>Likelihood (data) covariance matrix.</p>
</td></tr>
<tr><td><code id="nma_thresh_+3A_post">post</code></td>
<td>
<p>Posterior covariance matrix (see details).</p>
</td></tr>
<tr><td><code id="nma_thresh_+3A_nmatype">nmatype</code></td>
<td>
<p>Character string, giving the type of NMA performed. One of
&quot;fixed&quot; (fixed effects, the default) or &quot;random&quot; (random effects). May be
abbreviated.</p>
</td></tr>
<tr><td><code id="nma_thresh_+3A_x">X</code></td>
<td>
<p>[FE models only] Design matrix for basic treatment parameters.</p>
</td></tr>
<tr><td><code id="nma_thresh_+3A_mu.design">mu.design</code></td>
<td>
<p>[RE models only] Design matrix for any extra parameters.
Defaults to <code>NULL</code> (no extra parameters).</p>
</td></tr>
<tr><td><code id="nma_thresh_+3A_delta.design">delta.design</code></td>
<td>
<p>[RE models only] Design matrix for delta, defaults to the
<code class="reqn">N \times N</code> identity matrix.</p>
</td></tr>
<tr><td><code id="nma_thresh_+3A_opt.max">opt.max</code></td>
<td>
<p>Should the optimal decision be the maximal treatment effect
(<code>TRUE</code>, default) or the minimum (<code>FALSE</code>).</p>
</td></tr>
<tr><td><code id="nma_thresh_+3A_trt.rank">trt.rank</code></td>
<td>
<p>Rank of the treatment to derive thresholds for. Defaults to
1, thresholds for the optimum treatment.</p>
</td></tr>
<tr><td><code id="nma_thresh_+3A_trt.code">trt.code</code></td>
<td>
<p>Treatment codings of the reference treatment and in the
parameter vector <code class="reqn">d_k</code>. Use if treatments re-labelled or re-ordered.
Default is equivalent to <code>1:K</code>.</p>
</td></tr>
<tr><td><code id="nma_thresh_+3A_trt.sub">trt.sub</code></td>
<td>
<p>Only look at thresholds in this subset of treatments in
<code>trt.code</code>, e.g. if some are excluded from the ranking. Default is
equivalent to <code>1:K</code>.</p>
</td></tr>
<tr><td><code id="nma_thresh_+3A_mcid">mcid</code></td>
<td>
<p>Minimal clinically important difference for the decision (when
<code>mcid.type = 'decision'</code>) or for changing the decision (when
<code>mcid.type = 'change'</code>). Defaults to 0, use the maximal efficacy
decision rule.</p>
</td></tr>
<tr><td><code id="nma_thresh_+3A_mcid.type">mcid.type</code></td>
<td>
<p>Default <code>'decision'</code>, the decision rule is based on
MCID (see details). Otherwise <code>'change'</code>, use the maximum efficacy
rule, but only consider changing the decision when the alternative
treatment becomes more effective than the base case by <code>mcid</code> or more.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function provides bias-adjustment threshold analysis for both
fixed and random effects NMA models, as described by Phillippo <em>et
al.</em> (2018). Parameters <code>mean.dk</code>, <code>lhood</code>, and
<code>post</code> are always required, however there are differences in the
specification of <code>post</code> and other required parameters and between the
fixed and random effects cases:
</p>
 <dl>
<dt><strong>FE models</strong></dt><dd><p>The design matrix <code>X</code> for basic
treatment parameters is required. The posterior covariance matrix specified
in <code>post</code> should only refer to the basic treatment parameters.</p>
</dd>
<dt><strong>RE models</strong></dt><dd><p>The design matrix <code>mu.design</code> for additional
parameters (e.g. covariates) is required, as is the design matrix
<code>delta.design</code> for random effects terms. The posterior covariance
matrix specified in <code>post</code> should refer to the basic treatment
parameters, RE terms, and additional parameters <em>in that order</em>; i.e.
<code>post</code> should be the posterior covariance matrix of the vector
<code class="reqn">(d^T, \delta^T, \mu^T)^T</code>.</p>
</dd> </dl>



<h3>Value</h3>

<p>An object of class <code>thresh</code>.
</p>


<h3>Model details</h3>

<p><strong>The FE NMA model</strong>
</p>
<p>The fixed effects NMA model is assumed to be of the form </p>

<dl>
<dt>Prior:</dt><dd><p><code class="reqn">d \sim \mathrm{N} ( d_0, \Sigma_d )</code></p>
</dd>
<dt>Likelihood:</dt><dd><p><code class="reqn">y|d \sim \mathrm{N} ( \delta, V )</code></p>
</dd> <dt>FE model:</dt><dd><p><code class="reqn">\delta = Xd + M\mu</code></p>
</dd> </dl>

<p>The additional parameters <code class="reqn">\mu</code> may be given any sensible prior; they
do not affect the threshold analysis in any way.
</p>
<p><strong>The RE NMA model</strong>
</p>
<p>The random effects NMA model is assumed to be of the form </p>

<dl>
<dt>Priors:</dt><dd><p><code class="reqn"> d \sim \mathrm{N} ( d_0, \Sigma_d ), \quad \mu \sim
  \mathrm{N} ( \mu_0, \Sigma_\mu )</code></p>
</dd>
<dt>Likelihood:</dt><dd><p><code class="reqn">y|d,\mu,\tau^2 \sim \mathrm{N} ( L\delta + M\mu, V
  )</code></p>
</dd>
<dt>RE model:</dt><dd><p><code class="reqn">\delta \sim \mathrm{N} ( Xd, \tau^2 )</code></p>
</dd> </dl>

<p>The between-study heterogeneity parameter <code class="reqn">\tau^2</code> may be given any
sensible prior. In the RE case, the threshold derivations make the
approximation that <code class="reqn">\tau^2</code> is fixed and known.
</p>


<h3>Decision rules</h3>

<p>The default decision rule is maximal efficacy; the optimal treatment is
<code class="reqn"> k^* = \mathrm{argmax}_k \mathrm{E}(d_{k})</code>.
</p>
<p>When <code class="reqn">\epsilon</code> = <code>mcid</code> is greater than zero and
<code>mcid.type = 'decision'</code>, the decision rule is no longer for a single
best treatment, but is based on minimal clinically important difference. A
treatment is in the optimal set if <code class="reqn">\mathrm{E}(d_k) \ge
  \epsilon</code> and <code class="reqn">\max_a \mathrm{E}(d_a) -
  \mathrm{E}(d_k) \le \epsilon</code>.
</p>
<p>When <code>mcid.type = 'change'</code>, the maximal efficacy rule is used, but
thresholds are found for when a new treatment is better than the base-case
optimal by at least <code>mcid</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+recon_vcov">recon_vcov</a></code>, <code><a href="#topic+thresh_forest">thresh_forest</a></code>,
<code><a href="#topic+thresh-class">thresh-class</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Please see the vignette "Examples" for worked examples including use of
# this function, including more information on the brief code below.

vignette("Examples", package = "nmathresh")

### Contrast level thresholds for Thrombolytic treatments NMA
K &lt;- 6   # Number of treatments

# Contrast design matrix is
X &lt;- matrix(ncol = K-1, byrow = TRUE,
            c(1, 0, 0, 0, 0,
              0, 1, 0, 0, 0,
              0, 0, 1, 0, 0,
              0, 0, 0, 1, 0,
              0, -1, 1, 0, 0,
              0, -1, 0, 1, 0,
              0, -1, 0, 0, 1))

# Reconstruct hypothetical likelihood covariance matrix using NNLS
lik.cov &lt;- recon_vcov(Thrombo.post.cov, prior.prec = .0001, X = X)

# Thresholds are then
thresh &lt;- nma_thresh(mean.dk = Thrombo.post.summary$statistics[1:(K-1), "Mean"],
                     lhood = lik.cov,
                     post = Thrombo.post.cov,
                     nmatype = "fixed",
                     X = X,
                     opt.max = FALSE)

</code></pre>

<hr>
<h2 id='recon_vcov'>Reconstruct likelihood covariance matrix</h2><span id='topic+recon_vcov'></span>

<h3>Description</h3>

<p>Reconstruct the contrast-level likelihood covariance matrix from prior and
posterior covariance matrices. The resulting likelihood covariance matrix can
then be used to perform a contrast-level threshold analysis with the function
<code>nma_thresh</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>recon_vcov(
  post,
  prior.prec = 1e-04,
  prior.vcov = diag(1/prior.prec, dim(post)[1]),
  X = NULL,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="recon_vcov_+3A_post">post</code></td>
<td>
<p>Posterior covariance matrix.</p>
</td></tr>
<tr><td><code id="recon_vcov_+3A_prior.prec">prior.prec</code></td>
<td>
<p>Prior precision. Defaults to .0001 which is a common flat
prior for NMA. Not used if <code>prior.vcov</code> is specified.</p>
</td></tr>
<tr><td><code id="recon_vcov_+3A_prior.vcov">prior.vcov</code></td>
<td>
<p>Prior covariance matrix. Defaults to a diagonal matrix of
the same size as post, with elements <code>1/prior.prec</code>.</p>
</td></tr>
<tr><td><code id="recon_vcov_+3A_x">X</code></td>
<td>
<p>Contrast design matrix. If omitted a complete network is assumed.</p>
</td></tr>
<tr><td><code id="recon_vcov_+3A_verbose">verbose</code></td>
<td>
<p>Print intermediate matrices? Defaults to <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Full details of the calculation are given by Phillippo <em>et al.</em>
(2018). Briefly, the aim is to recover the contrast-level likelihood
covariance matrix <code class="reqn">V</code> that would have led to the posterior covariance
matrix <code class="reqn">\Sigma</code> being obtained from a fixed effects NMA, with design
matrix <code class="reqn">X</code> and prior covariance matrix <code class="reqn">\Sigma_d</code> for a normal
prior on the basic treatment parameters. This is possible in this case via
the equation (resulting from conjugacy):
</p>
<p style="text-align: center;"><code class="reqn">\Sigma^{-1} = X^TV^{-1}X + \Sigma_d^{-1}.</code>
</p>

<p>When the treatment network is complete (i.e. fully connected), this
equation may be rearranged exactly.
</p>
<p>When the treatment network is incomplete (i.e. not all treatments are
directly compared), this equation may be solved through the use of
non-negative least squares (NNLS).
</p>
<p>When NNLS is used, some additional diagnostics are printed (and returned as
attributes). Firstly, the residual sum-of-squares (RSS) from the NNLS fit.
The RSS is further split into <em>fixed</em> RSS, from structural zeros in
the reconstructed posterior according to the design matrix (and hence not
fitted) that are non-zero in the true posterior, and <em>fitted</em> RSS,
from the other fitted elements. Secondly, the Kullback-Leibler divergence
of the reconstructed posterior from the true posterior. Interpreting the KL
divergence as a log Bayes factor, values less than 1 indicate negligible
differences between the reconstructed posterior from the true posterior,
whilst values greater than 3 indicate considerable differences.
</p>


<h3>Value</h3>

<p>A matrix; the reconstructed likelihood covariance matrix. If NNLS is
used, the residual sum-of-squares and Kullback-Leibler divergence
diagnostics (as printed to the console) are returned as additional
attributes <code>rss.total</code>, <code>rss.fixed</code>, <code>rss.free</code>,
<code>kl.divergence</code>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+nma_thresh">nma_thresh</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Please see the vignette "Examples" for worked examples including use of
# this function, including more information on the brief code below.

vignette("Examples", package = "nmathresh")

### Contrast level thresholds for Thrombolytic treatments NMA
K &lt;- 6   # Number of treatments

# Contrast design matrix is
X &lt;- matrix(ncol = K-1, byrow = TRUE,
            c(1, 0, 0, 0, 0,
              0, 1, 0, 0, 0,
              0, 0, 1, 0, 0,
              0, 0, 0, 1, 0,
              0, -1, 1, 0, 0,
              0, -1, 0, 1, 0,
              0, -1, 0, 0, 1))

# Reconstruct hypothetical likelihood covariance matrix using NNLS
lik.cov &lt;- recon_vcov(Thrombo.post.cov, prior.prec = .0001, X = X)

</code></pre>

<hr>
<h2 id='SocAnx.post.cov'>Posterior covariance matrix from Social Anxiety NMA</h2><span id='topic+SocAnx.post.cov'></span>

<h3>Description</h3>

<p>The posterior covariance matrix of the variables <code>d</code> (basic treatment
effect parameters) and <code>delta</code> (shrunken random effects estimates for
each study).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SocAnx.post.cov
</code></pre>


<h3>Format</h3>

<p>An object of class <code>matrix</code> (inherits from <code>array</code>) with 186 rows and 186 columns.
</p>


<h3>Source</h3>

<p>Generated from WinBUGS output, using the WinBUGS code from
Mayo-Wilson et al. (2014). See also <code>vignette("Examples", package =
  "nmathresh")</code>.
</p>


<h3>References</h3>

<p>Mayo-Wilson E, Dias S, Mavranezouli I, Kew K, Clark DM, Ades AE,
et al. Psychological and pharmacological interventions for social anxiety
disorder in adults: a systematic review and network meta-analysis. Lancet
Psychiatry 2014;1:368-76.
http://dx.doi.org/10.1016/S2215-0366(14)70329-3
</p>


<h3>See Also</h3>

<p><code><a href="#topic+SocAnx.post.summary">SocAnx.post.summary</a></code>
</p>

<hr>
<h2 id='SocAnx.post.summary'>Posterior summary from Social Anxiety NMA</h2><span id='topic+SocAnx.post.summary'></span>

<h3>Description</h3>

<p>A <code>summary.mcmc</code> object of the type produced by the <code>coda</code> package,
containing the requisite posterior summary information on the variables
<code>d</code> (basic treatment effect parameters), <code>delta</code> (shrunken random
effects estimates for each study), and <code>diff</code> (contrasts of treatment
effect parameters).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SocAnx.post.summary
</code></pre>


<h3>Format</h3>

<p>A <code>summary.mcmc</code> object. The key components for our use are:
</p>
 <dl>
<dt>statistics</dt><dd><p>Matrix containing the posterior summary
statistics of the variables <code>d</code>, <code>delta</code>, and <code>diff</code>, with
columns for <code>Mean</code>, <code>SD</code>, <code>Naive SE</code>, and <code>Time-series
  SE</code> (also known as the Monte-Carlo standard error)</p>
</dd> <dt>quantiles</dt><dd><p>Matrix
containing the posterior 2.5%, 25%, 50%, 75%, and 97.5% quantiles of
the variables <code>d</code>, <code>delta</code>, and <code>diff</code></p>
</dd></dl>



<h3>Source</h3>

<p>Generated from WinBUGS output, using the WinBUGS code from
Mayo-Wilson et al. (2014). See also <code>vignette("Examples", package =
  "nmathresh")</code>.
</p>


<h3>References</h3>

<p>Mayo-Wilson E, Dias S, Mavranezouli I, Kew K, Clark DM, Ades AE,
et al. Psychological and pharmacological interventions for social anxiety
disorder in adults: a systematic review and network meta-analysis. Lancet
Psychiatry 2014;1:368-76.
http://dx.doi.org/10.1016/S2215-0366(14)70329-3
</p>


<h3>See Also</h3>

<p><code><a href="coda.html#topic+summary.mcmc">summary.mcmc</a></code>, <code><a href="#topic+SocAnx.post.cov">SocAnx.post.cov</a></code>
</p>

<hr>
<h2 id='thresh_2d'>Producing two-dimensional invariant regions</h2><span id='topic+thresh_2d'></span>

<h3>Description</h3>

<p>This function produces two-dimensional threshold lines and invariant regions,
as shown by Phillippo <em>et al.</em> (2018).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>thresh_2d(
  thresh,
  idx,
  idy,
  xlab = paste("Adjustment to data point", idx),
  ylab = paste("Adjustment to data point", idy),
  xlim = NULL,
  ylim = NULL,
  breaks = waiver(),
  xbreaks = breaks,
  ybreaks = breaks,
  fill = rgb(0.72, 0.8, 0.93, 0.7),
  lwd = 1,
  fontsize = 12
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="thresh_2d_+3A_thresh">thresh</code></td>
<td>
<p>A <code>thresh</code> object, as produced by
<code><a href="#topic+nma_thresh">nma_thresh</a></code>.</p>
</td></tr>
<tr><td><code id="thresh_2d_+3A_idx">idx</code></td>
<td>
<p>Integer specifying the index (with respect to
<code>thresh$thresholds</code>) of the first data point to consider adjusting.
Will be shown on the x axis.</p>
</td></tr>
<tr><td><code id="thresh_2d_+3A_idy">idy</code></td>
<td>
<p>Integer specifying the index (with respect to
<code>thresh$thresholds</code>) of the second data point to consider adjusting.
Will be shown on the y axis.</p>
</td></tr>
<tr><td><code id="thresh_2d_+3A_xlab">xlab</code></td>
<td>
<p>Character string giving the label for the x axis.</p>
</td></tr>
<tr><td><code id="thresh_2d_+3A_ylab">ylab</code></td>
<td>
<p>Character string giving the label for the y axis.</p>
</td></tr>
<tr><td><code id="thresh_2d_+3A_xlim">xlim</code></td>
<td>
<p>Numeric vector of length 2, giving the x axis limits.</p>
</td></tr>
<tr><td><code id="thresh_2d_+3A_ylim">ylim</code></td>
<td>
<p>Numeric vector of length 2, giving the y axis limits.</p>
</td></tr>
<tr><td><code id="thresh_2d_+3A_breaks">breaks</code></td>
<td>
<p>Numeric vector giving position of tick marks on the x and y
axes. Calculated automatically by default.</p>
</td></tr>
<tr><td><code id="thresh_2d_+3A_xbreaks">xbreaks</code></td>
<td>
<p>Numeric vector giving position of tick marks on the x axis.
Equal to <code>breaks</code> by default, if set this overrides any value given to
<code>breaks</code>.</p>
</td></tr>
<tr><td><code id="thresh_2d_+3A_ybreaks">ybreaks</code></td>
<td>
<p>Numeric vector giving position of tick marks on the y axis.
Equal to <code>breaks</code> by default, if set this overrides any value given to
<code>breaks</code>.</p>
</td></tr>
<tr><td><code id="thresh_2d_+3A_fill">fill</code></td>
<td>
<p>Fill colour for invariant region. Defaults to a nice shade of
blue <code>rgb(.72, .80, .93, .7)</code>.</p>
</td></tr>
<tr><td><code id="thresh_2d_+3A_lwd">lwd</code></td>
<td>
<p>Line width for threshold lines. Default 1.</p>
</td></tr>
<tr><td><code id="thresh_2d_+3A_fontsize">fontsize</code></td>
<td>
<p>Font size for labels. Default 12.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>ggplot</code> object containing the 2D threshold plot, which is
returned invisibly and plotted (unless assigned).
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Please see the vignette "Examples" for worked examples including use of
# this function, including more information on the brief code below.

vignette("Examples", package = "nmathresh")

### Contrast level thresholds for Thrombolytic treatments NMA
K &lt;- 6   # Number of treatments

# Contrast design matrix is
X &lt;- matrix(ncol = K-1, byrow = TRUE,
            c(1, 0, 0, 0, 0,
              0, 1, 0, 0, 0,
              0, 0, 1, 0, 0,
              0, 0, 0, 1, 0,
              0, -1, 1, 0, 0,
              0, -1, 0, 1, 0,
              0, -1, 0, 0, 1))

# Reconstruct hypothetical likelihood covariance matrix using NNLS
lik.cov &lt;- recon_vcov(Thrombo.post.cov, prior.prec = .0001, X = X)

# Thresholds are then
thresh &lt;- nma_thresh(mean.dk = Thrombo.post.summary$statistics[1:(K-1), "Mean"],
                     lhood = lik.cov,
                     post = Thrombo.post.cov,
                     nmatype = "fixed",
                     X = X,
                     opt.max = FALSE)

# Produce an invariant region for simultaneous adjustments to both arms of Study 1
thresh_2d(thresh, 1, 2,
          xlab = "Adjustment in Study 1 LOR: 3 vs. 1",
          ylab = "Adjustment in Study 1 LOR: 4 vs. 1",
          xlim = c(-1.5, 0.5), ylim = c(-2, 14),
          ybreaks = seq(-2, 14, 2))

</code></pre>

<hr>
<h2 id='thresh_forest'>Producing threshold forest plots</h2><span id='topic+thresh_forest'></span>

<h3>Description</h3>

<p>This function produces threshold forest plots, overlaying the
decision-invariant intervals on the data points and their confidence/credible
intervals, as shown by Phillippo <em>et al.</em> (2018).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>thresh_forest(
  thresh,
  y,
  CI.lo,
  CI.hi,
  label,
  orderby = NULL,
  data = NULL,
  CI.title = "95% Confidence Interval",
  label.title = "",
  y.title = "Mean",
  II.title = "Invariant Interval",
  xlab = "",
  xlim = NULL,
  sigfig = 3,
  digits = NULL,
  refline = NULL,
  clinsig = NULL,
  cutoff = NULL,
  II.colw = rgb(0.72, 0.8, 0.93),
  II.cols = rgb(0.93, 0.72, 0.8),
  II.lwd = 8,
  CI.lwd = 1,
  pointsize = 4,
  fontsize = 12,
  xbreaks = NULL,
  add.columns = NULL,
  add.columns.title = NULL,
  add.columns.after = -1,
  add.columns.hjust = 0.5,
  add.columns.uline = TRUE,
  calcdim = display,
  display = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="thresh_forest_+3A_thresh">thresh</code></td>
<td>
<p>A <code>thresh</code> object, as produced by
<code><a href="#topic+nma_thresh">nma_thresh</a></code>.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_y">y</code></td>
<td>
<p>Data points. Either a column of <code>data</code>, or a numeric vector.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_ci.lo">CI.lo</code></td>
<td>
<p>Confidence/credible interval lower limits. Either a column of
<code>data</code>, or a numeric vector.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_ci.hi">CI.hi</code></td>
<td>
<p>Confidence/credible interval upper limits. Either a column of
<code>data</code>, or a numeric vector.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_label">label</code></td>
<td>
<p>Row labels (for each data point). Either a column of
<code>data</code>, or a character vector.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_orderby">orderby</code></td>
<td>
<p>Variable(s) to order the table rows by. Either a column or
columns of <code>data</code>, or a vector. By default, the rows are not
reordered. Further arguments and/or multiple ordering columns may be passed
to the function <code>order</code> by instead providing a <code>list</code> containing
the arguments to <code>order</code>.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_data">data</code></td>
<td>
<p>A data frame containing the data points <code>y</code>,
confidence/credible intervals (<code>CI.lo</code>, <code>CI.hi</code>), and row labels
<code>labels</code>. If <code>data</code> is not provided, the above variables will be
searched for in the calling environment.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_ci.title">CI.title</code></td>
<td>
<p>Title for CI column, default &quot;95% Confidence Interval&quot;.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_label.title">label.title</code></td>
<td>
<p>Character string giving the heading for the row labels
column.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_y.title">y.title</code></td>
<td>
<p>Character string giving the heading for the data points
column, default &quot;Mean&quot;.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_ii.title">II.title</code></td>
<td>
<p>Title for invariant interval column, default &quot;Invariant
Interval&quot;.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_xlab">xlab</code></td>
<td>
<p>Character string giving the label for the <code class="reqn">x</code>-axis.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_xlim">xlim</code></td>
<td>
<p>Numeric vector (length 2) of lower and upper limits for the
<code class="reqn">x</code>-axis. If not set, tries to choose a sensible default.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_sigfig">sigfig</code></td>
<td>
<p>Number of significant digits to display in the table. Default
3.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_digits">digits</code></td>
<td>
<p>Number of decimal places to display in the table. Overrides
<code>sigfig</code> if set.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_refline">refline</code></td>
<td>
<p><code class="reqn">x</code> intercept of vertical reference line, if desired.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_clinsig">clinsig</code></td>
<td>
<p>Set the clinical significance level. Rows are marked with a
dagger if they have one or more thresholds less than this value. Not set by
default.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_cutoff">cutoff</code></td>
<td>
<p>A single numeric value or numeric vector pair. Thresholds
larger in magnitude than this value, or lying outside this interval, will
be cut off and marked as NT (no threshold). Not set by default.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_ii.colw">II.colw</code></td>
<td>
<p>Colour for &quot;wide&quot; invariant intervals.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_ii.cols">II.cols</code></td>
<td>
<p>Colour for &quot;short&quot; invariant intervals.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_ii.lwd">II.lwd</code></td>
<td>
<p>Line width of invariant intervals. Default 8.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_ci.lwd">CI.lwd</code></td>
<td>
<p>Line width of confidence/credible intervals. Default 1.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_pointsize">pointsize</code></td>
<td>
<p>Point size for forest plot means. Default 4.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_fontsize">fontsize</code></td>
<td>
<p>Base font size. Default 12.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_xbreaks">xbreaks</code></td>
<td>
<p>Position of tick marks on the <code class="reqn">x</code>-axis as a numeric
vector.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_add.columns">add.columns</code></td>
<td>
<p>Data frame (or matrix, vector) of additional columns to
add to table.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_add.columns.title">add.columns.title</code></td>
<td>
<p>Optional titles for the additional columns,
otherwise use names from provided data.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_add.columns.after">add.columns.after</code></td>
<td>
<p>Which column to add the new columns after? Default
adds the columns to the far right.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_add.columns.hjust">add.columns.hjust</code></td>
<td>
<p>Vector of horizontal justifications for the new
columns, from <code>0</code> (left) to <code>1</code> (right). Default centres every
column.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_add.columns.uline">add.columns.uline</code></td>
<td>
<p>Underline the header of the new columns? Default
<code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_calcdim">calcdim</code></td>
<td>
<p>Logical, calculate suggested output dimensions for saving to
pdf? Calculates output size when <code>TRUE</code>; saves time when <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="thresh_forest_+3A_display">display</code></td>
<td>
<p>Logical, display the plot? Defaults to <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Displays the forest plot on the current plot device (if <code>display
  = TRUE</code>). Also returns invisibly the underlying <code>gtable</code> object, which
can be further manipulated.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Please see the vignette "Examples" for worked examples including use of
# this function, including more information on the brief code below.

vignette("Examples", package = "nmathresh")

### Contrast level thresholds for Thrombolytic treatments NMA
K &lt;- 6   # Number of treatments

# Contrast design matrix is
X &lt;- matrix(ncol = K-1, byrow = TRUE,
            c(1, 0, 0, 0, 0,
              0, 1, 0, 0, 0,
              0, 0, 1, 0, 0,
              0, 0, 0, 1, 0,
              0, -1, 1, 0, 0,
              0, -1, 0, 1, 0,
              0, -1, 0, 0, 1))

# Reconstruct hypothetical likelihood covariance matrix using NNLS
lik.cov &lt;- recon_vcov(Thrombo.post.cov, prior.prec = .0001, X = X)

# Thresholds are then
thresh &lt;- nma_thresh(mean.dk = Thrombo.post.summary$statistics[1:(K-1), "Mean"],
                     lhood = lik.cov,
                     post = Thrombo.post.cov,
                     nmatype = "fixed",
                     X = X,
                     opt.max = FALSE)

# Get treatment codes for the contrasts with data
d.a &lt;- d.b &lt;- vector(length = nrow(X))
for (i in 1:nrow(X)){
  d.a[i] &lt;- ifelse(any(X[i, ] == -1), which(X[i, ] == -1), 0) + 1
  d.b[i] &lt;- ifelse(any(X[i, ] == 1), which(X[i, ] == 1), 0) + 1
}

# Transform from d_ab style contrast references into d[i] style from the full set of contrasts
# for easy indexing in R
d.i &lt;- d_ab2i(d.a, d.b, K = 6)

# Create plot data
plotdat &lt;- data.frame(lab = paste0(d.b, " vs. ", d.a),
                      contr.mean = Thrombo.post.summary$statistics[d.i, "Mean"],
                      CI2.5 = Thrombo.post.summary$quantiles[d.i, "2.5%"],
                      CI97.5 = Thrombo.post.summary$quantiles[d.i, "97.5%"])

# Plot
thresh_forest(thresh, contr.mean, CI2.5, CI97.5, label = lab, data = plotdat,
              label.title = "Contrast", xlab = "Log Odds Ratio", CI.title = "95% Credible Interval",
              xlim = c(-.3, .3), refline = 0, digits = 2)

</code></pre>

<hr>
<h2 id='thresh-class'>The thresh class</h2><span id='topic+thresh-class'></span>

<h3>Description</h3>

<p>The function <code>nmathresh</code> returns S3 objects of class <code>thresh</code>.
</p>


<h3>Details</h3>

<p>Objects of class <code>thresh</code> have the following components:
</p>

<dl>
<dt><code>thresholds</code></dt><dd><p>A data frame with columns <code>lo</code> and <code>hi</code>
for the lower and upper thresholds, and <code>lo.newkstar</code> and
<code>hi.newkstar</code> for the new optimal (or rank-<code>trt.rank</code>) treatments
at each of the thresholds.</p>
</dd>
<dt><code>U</code></dt><dd><p>The threshold solutions matrix. One column for each data
point <code class="reqn">m</code>, one row for each contrast <code class="reqn">d_{ab}</code> (in ascending order).
The elements <code class="reqn">U_{ab,m}</code> describe the amount of adjustment to data point
<code class="reqn">y_m</code> required to reverse the relative ranking of treatments <code class="reqn">a</code>
and <code class="reqn">b</code>. This matrix is particularly useful for deriving thresholds for
more complex decisions (e.g. bias-adjustment thresholds for a new treatment
entering the top two, for any change in rank of the top three, etc.)</p>
</dd>
<dt><code>Ukstar</code></dt><dd><p>The threshold solutions matrix limited to contrasts
involving <code class="reqn">k^*</code>. In other words, the rows of <code>U</code> corresponding to
contrasts of the form <code class="reqn">d_{ak^*}</code> or <code class="reqn">d_{k^*a}</code>. Elements
<code class="reqn">U_{ak^*,m}</code> of this matrix describe the amount of adjustment to data
point <code class="reqn">y_m</code> required to make treatment <code class="reqn">a</code> optimal (or
rank-<code>trt.rank</code>) over <code class="reqn">k^*</code>.</p>
</dd>
<dt><code>H</code></dt><dd><p>The influence matrix of the data on the basic treatment
parameters. One column for each data point <code class="reqn">m</code>, one row for each basic
treatment parameter <code class="reqn">d_k</code>. Elements <code class="reqn">H_{k,m}</code> describe the
influence of data point <code class="reqn">y_m</code> on parameter <code class="reqn">d_k</code>. This matrix can
be used to derive more complex thresholds (e.g. 2D thresholds
for simultaneous adjustments to two data points, or thresholds for common
adjustments to a group of data points).</p>
</dd>
<dt><code>kstar</code></dt><dd><p>The base-case optimal (or rank-<code>trt.rank</code>)
treatment <code class="reqn">k^*</code>.</p>
</dd>
<dt><code>call</code></dt><dd><p>A list containing all the arguments defined in the
original call to <code>nma_thresh</code>.</p>
</dd>
</dl>



<h3>See Also</h3>

<p><code><a href="#topic+nma_thresh">nma_thresh</a></code>
</p>

<hr>
<h2 id='Thrombo.post.cov'>Posterior covariance matrix from Thrombolytics NMA</h2><span id='topic+Thrombo.post.cov'></span>

<h3>Description</h3>

<p>The posterior covariance matrix of the basic treatment effect parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Thrombo.post.cov
</code></pre>


<h3>Format</h3>

<p>An object of class <code>matrix</code> (inherits from <code>array</code>) with 5 rows and 5 columns.
</p>


<h3>Source</h3>

<p>Generated from WinBUGS output, using the WinBUGS code from Caldwell
et al. (2005). See also <code>vignette("Examples", package = "nmathresh")</code>.
</p>


<h3>References</h3>

<p>Caldwell DM, Ades AE, Higgins JPT. Simultaneous comparison of
multiple treatments: combining direct and indirect evidence. Brit Med J
2005;331:897-900. http://dx.doi.org/10.1136/bmj.331.7521.897
</p>


<h3>See Also</h3>

<p><code><a href="#topic+Thrombo.post.summary">Thrombo.post.summary</a></code>
</p>

<hr>
<h2 id='Thrombo.post.summary'>Posterior summary from Thrombolytics NMA</h2><span id='topic+Thrombo.post.summary'></span>

<h3>Description</h3>

<p>A <code>summary.mcmc</code> object of the type produced by the <code>coda</code> package,
containing the requisite posterior summary information on the variables
<code>dd</code>, the contrasts of the treatment effect parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Thrombo.post.summary
</code></pre>


<h3>Format</h3>

<p>A <code>summary.mcmc</code> object. The key components for our use are:
</p>
 <dl>
<dt>statistics</dt><dd><p>Matrix containing the posterior summary
statistics, with columns for <code>Mean</code>, <code>SD</code>, <code>Naive SE</code>, and
<code>Time-series SE</code> (also known as the Monte-Carlo standard error)</p>
</dd>
<dt>quantiles</dt><dd><p>Matrix containing the posterior 2.5%, 25%, 50%, 75%,
and 97.5% quantiles</p>
</dd></dl>



<h3>Source</h3>

<p>Generated from WinBUGS output, using the WinBUGS code from Caldwell
et al. (2005). See also <code>vignette("Examples", package = "nmathresh")</code>.
</p>


<h3>References</h3>

<p>Caldwell DM, Ades AE, Higgins JPT. Simultaneous comparison of
multiple treatments: combining direct and indirect evidence. Brit Med J
2005;331:897-900. http://dx.doi.org/10.1136/bmj.331.7521.897
</p>


<h3>See Also</h3>

<p><code><a href="coda.html#topic+summary.mcmc">summary.mcmc</a></code>, <code><a href="#topic+Thrombo.post.cov">Thrombo.post.cov</a></code>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
