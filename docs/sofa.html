<!DOCTYPE html><html lang="en"><head><title>Help for package sofa</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {sofa}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#sofa-package'><p>R client for CouchDB.</p></a></li>
<li><a href='#active_tasks'><p>active tasks</p></a></li>
<li><a href='#attach_get'><p>Get an attachment</p></a></li>
<li><a href='#attachments'><p>Work with attachments</p></a></li>
<li><a href='#Cushion'><p>sofa connection client</p></a></li>
<li><a href='#databases'><p>Work with databases in your CouchDB's.</p></a></li>
<li><a href='#db_alldocs'><p>List all docs in a given database.</p></a></li>
<li><a href='#db_bulk_create'><p>Create documents via the bulk API</p></a></li>
<li><a href='#db_bulk_get'><p>Query many documents at once</p></a></li>
<li><a href='#db_bulk_update'><p>Create documents via the bulk API</p></a></li>
<li><a href='#db_changes'><p>List changes to a database.</p></a></li>
<li><a href='#db_compact'><p>Request compaction of the specified database</p></a></li>
<li><a href='#db_create'><p>Create a database.</p></a></li>
<li><a href='#db_delete'><p>Delete a database.</p></a></li>
<li><a href='#db_explain'><p>Explain API</p></a></li>
<li><a href='#db_index'><p>Create and get database indexes</p></a></li>
<li><a href='#db_info'><p>List database info.</p></a></li>
<li><a href='#db_list'><p>List all databases.</p></a></li>
<li><a href='#db_query'><p>Query a database.</p></a></li>
<li><a href='#db_replicate'><p>Upload (replicate) a local database to a remote database server,</p>
e.g., Cloudant, Iriscouch</a></li>
<li><a href='#db_revisions'><p>Get document revisions.</p></a></li>
<li><a href='#design'><p>Work with design documents</p></a></li>
<li><a href='#design_search'><p>Search design documents</p></a></li>
<li><a href='#doc_create'><p>Create documents to a database.</p></a></li>
<li><a href='#doc_delete'><p>Delete a document in a database.</p></a></li>
<li><a href='#doc_get'><p>Get a document from a database.</p></a></li>
<li><a href='#doc_head'><p>Get header info for a document</p></a></li>
<li><a href='#doc_update'><p>Update a document.</p></a></li>
<li><a href='#doc_upsert'><p>Create a new document or update an existing one</p></a></li>
<li><a href='#documents'><p>Work with documents in your CouchDB's.</p></a></li>
<li><a href='#membership'><p>membership</p></a></li>
<li><a href='#parse_df'><p>Parse data.frame to json or list by row or column</p></a></li>
<li><a href='#ping'><p>Ping a CouchDB server</p></a></li>
<li><a href='#restart'><p>Restart your Couchdb instance</p></a></li>
<li><a href='#session'><p>session</p></a></li>
<li><a href='#uuids'><p>Get uuids.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Connector to 'CouchDB'</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides an interface to the 'NoSQL' database 'CouchDB'
    (<a href="http://couchdb.apache.org">http://couchdb.apache.org</a>). Methods are provided for managing
    databases within 'CouchDB', including creating/deleting/updating/transferring,
    and managing documents within databases. One can connect with a local
    'CouchDB' instance, or a remote 'CouchDB' databases such as 'Cloudant'. 
    Documents can be inserted directly from vectors, lists, data.frames, 
    and 'JSON'. Targeted at 'CouchDB' v2 or greater.</td>
</tr>
<tr>
<td>Version:</td>
<td>0.4.0</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/ropensci/sofa">https://github.com/ropensci/sofa</a> (devel)
<a href="https://docs.ropensci.org/sofa">https://docs.ropensci.org/sofa</a> (docs)</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/ropensci/sofa/issues">https://github.com/ropensci/sofa/issues</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Imports:</td>
<td>crul (&ge; 0.4.0), jsonlite (&ge; 1.5), R6 (&ge; 2.2.2), mime</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat, knitr, rmarkdown</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.0</td>
</tr>
<tr>
<td>X-schema.org-applicationCategory:</td>
<td>Databases</td>
</tr>
<tr>
<td>X-schema.org-keywords:</td>
<td>CouchDB, database, NoSQL, documents</td>
</tr>
<tr>
<td>X-schema.org-isPartOf:</td>
<td>https://ropensci.org</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-06-26 14:29:31 UTC; sckott</td>
</tr>
<tr>
<td>Author:</td>
<td>Scott Chamberlain <a href="https://orcid.org/0000-0003-1444-9135"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  rOpenSci [fnd] (https://ropensci.org/)</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Scott Chamberlain &lt;myrmecocystus@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-06-26 15:10:03 UTC</td>
</tr>
</table>
<hr>
<h2 id='sofa-package'>R client for CouchDB.</h2><span id='topic+sofa-package'></span><span id='topic+sofa'></span>

<h3>Description</h3>

<p>Relax.
</p>


<h3>About sofa</h3>

<p><span class="pkg">sofa</span> provides an interface to the NoSQL database CouchDB
(<a href="http://couchdb.apache.org">http://couchdb.apache.org</a>). Methods are provided for managing
databases within CouchDB, including creating/deleting/updating/transferring,
and managing documents within databases. One can connect with a local
CouchDB instance, or a remote CouchDB databases such as Cloudant
(<a href="https://cloudant.com">https://cloudant.com</a>). Documents can be inserted directly from
vectors, lists, data.frames, and JSON.
</p>


<h3>Client connections</h3>

<p>All functions take as their first parameter a client connection object,
or a <strong>cushion</strong>. Create the object with <a href="#topic+Cushion">Cushion</a>. You
can have multiple connection objects in an R session.
</p>


<h3>CouchDB versions</h3>

<p><span class="pkg">sofa</span> was built assuming CouchDB version 2 or greater. Some
functionality of this package will work with versions &lt; 2, while
some may not (mango queries, see <code><a href="#topic+db_query">db_query()</a></code>). I don't
plan to support older CouchDB versions per se.
</p>


<h3>Digits after the decimal</h3>

<p>If you have any concern about number of digits after the decimal
in your documents, make sure to look at <code>digits</code> in your R options.
The default value is 7 (see <a href="base.html#topic+options">options</a> for more informnation). You
can set the value you like with e.g., <code>options(digits = 10)</code>, and
get what <code>digits</code> is set to with <code>getOption("digits")</code>.
</p>
<p>Note that in <code><a href="#topic+doc_create">doc_create()</a></code> we convert your document to JSON with
<code>jsonlite::toJSON()</code> if given as a list, which has a <code>digits</code> parameter.
We pass <code>getOption("digits")</code> to the <code>digits</code> parameter in
<code>jsonlite::toJSON()</code>.
</p>


<h3>Defunct functions</h3>


<ul>
<li> <p><a href="#topic+attach_get">attach_get</a>
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Scott Chamberlain <a href="mailto:myrmecocystus@gmail.com">myrmecocystus@gmail.com</a>
</p>

<hr>
<h2 id='active_tasks'>active tasks</h2><span id='topic+active_tasks'></span>

<h3>Description</h3>

<p>active tasks
</p>


<h3>Usage</h3>

<pre><code class='language-R'>active_tasks(cushion, as = "list", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="active_tasks_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="active_tasks_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="active_tasks_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Create a CouchDB connection client
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

active_tasks(x)
active_tasks(x, as = 'json')

## End(Not run)
</code></pre>

<hr>
<h2 id='attach_get'>Get an attachment</h2><span id='topic+attach_get'></span>

<h3>Description</h3>

<p>This function is defunct. See <code><a href="#topic+doc_attach_get">doc_attach_get()</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>attach_get(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="attach_get_+3A_...">...</code></td>
<td>
<p>ignored</p>
</td></tr>
</table>

<hr>
<h2 id='attachments'>Work with attachments</h2><span id='topic+attachments'></span><span id='topic+doc_attach_create'></span><span id='topic+doc_attach_info'></span><span id='topic+doc_attach_get'></span><span id='topic+doc_attach_delete'></span>

<h3>Description</h3>

<p>Work with attachments
</p>


<h3>Usage</h3>

<pre><code class='language-R'>doc_attach_create(
  cushion,
  dbname,
  docid,
  attachment,
  attname,
  as = "list",
  ...
)

doc_attach_info(cushion, dbname, docid, attname, ...)

doc_attach_get(cushion, dbname, docid, attname = NULL, type = "raw", ...)

doc_attach_delete(cushion, dbname, docid, attname, as = "list", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="attachments_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="attachments_+3A_dbname">dbname</code></td>
<td>
<p>(character) Database name. Required.</p>
</td></tr>
<tr><td><code id="attachments_+3A_docid">docid</code></td>
<td>
<p>(character) Document ID. Required.</p>
</td></tr>
<tr><td><code id="attachments_+3A_attachment">attachment</code></td>
<td>
<p>(character) A file name. Required.</p>
</td></tr>
<tr><td><code id="attachments_+3A_attname">attname</code></td>
<td>
<p>(character) Attachment name. Required.</p>
</td></tr>
<tr><td><code id="attachments_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="attachments_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
<tr><td><code id="attachments_+3A_type">type</code></td>
<td>
<p>(character) one of raw (default) or text. required.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Methods:
</p>

<ul>
<li> <p><code>doc_attach_create</code> - create an attachment
</p>
</li>
<li> <p><code>doc_attach_info</code> - get info (headers) for an attachment
</p>
</li>
<li> <p><code>doc_attach_get</code> - get an attachment. this method does not attempt
to read the object into R, but only gets the raw bytes or plain
text. See examples for how to read some attachment types
</p>
</li>
<li> <p><code>doc_attach_delete</code> - delete and attachment
</p>
</li></ul>



<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

if ("foodb" %in% db_list(x)) {
  invisible(db_delete(x, dbname="foodb"))
}
db_create(x, dbname='foodb')

# create an attachment on an existing document
## create a document first
doc &lt;- '{"name":"stuff", "drink":"soda"}'
doc_create(x, dbname="foodb", doc=doc, docid="asoda")

## create a csv attachment
row.names(mtcars) &lt;- NULL
file &lt;- tempfile(fileext = ".csv")
write.csv(mtcars, file = file, row.names = FALSE)
doc_attach_create(x, dbname="foodb", docid="asoda",
  attachment=file, attname="mtcarstable.csv")

## create a binary (png) attachment
file &lt;- tempfile(fileext = ".png")
png(file)
plot(1:10)
dev.off()
doc_attach_create(x, dbname="foodb", docid="asoda",
  attachment=file, attname="img.png")

## create a binary (pdf) attachment
file &lt;- tempfile(fileext = ".pdf")
pdf(file)
plot(1:10)
dev.off()
doc_attach_create(x, dbname="foodb", docid="asoda",
  attachment=file, attname="plot.pdf")

# get info for an attachment (HEAD request)
doc_attach_info(x, "foodb", docid="asoda", attname="mtcarstable.csv")
doc_attach_info(x, "foodb", docid="asoda", attname="img.png")
doc_attach_info(x, "foodb", docid="asoda", attname="plot.pdf")

# get an attachment (GET request)
res &lt;- doc_attach_get(x, "foodb", docid="asoda",
  attname="mtcarstable.csv", type = "text")
read.csv(text = res)
doc_attach_get(x, "foodb", docid="asoda", attname="img.png")
doc_attach_get(x, "foodb", docid="asoda", attname="plot.pdf")
## OR, don't specify an attachment and list the attachments
(attchms &lt;- doc_attach_get(x, "foodb", docid="asoda", type="text"))
jsonlite::fromJSON(attchms)

# delete an attachment
doc_attach_delete(x, "foodb", docid="asoda", attname="mtcarstable.csv")
doc_attach_delete(x, "foodb", docid="asoda", attname="img.png")
doc_attach_delete(x, "foodb", docid="asoda", attname="plot.pdf")

## End(Not run)
</code></pre>

<hr>
<h2 id='Cushion'>sofa connection client</h2><span id='topic+Cushion'></span>

<h3>Description</h3>

<p>sofa connection client
</p>
<p>sofa connection client
</p>


<h3>Value</h3>

<p>An object of class <code>Cushion</code>, with variables accessible for
host, port, path, transport, user, pwd, and headers. Functions are callable
to get headers, and to make the base url sent with all requests.
</p>


<h3>CouchDB versions</h3>

<p><span class="pkg">sofa</span> was built assuming CouchDB version 2 or greater. Some
functionality of this package will work with versions &lt; 2, while
some may not (mango queries, see <code><a href="#topic+db_query">db_query()</a></code>). I don't
plan to support older CouchDB versions per se.
</p>


<h3>Public fields</h3>

<div class="r6-fields">

<dl>
<dt><code>host</code></dt><dd><p>(character) host</p>
</dd>
<dt><code>port</code></dt><dd><p>(integer) port</p>
</dd>
<dt><code>path</code></dt><dd><p>(character) url path, if any</p>
</dd>
<dt><code>transport</code></dt><dd><p>(character) transport schema, (http|https)</p>
</dd>
<dt><code>user</code></dt><dd><p>(character) username</p>
</dd>
<dt><code>pwd</code></dt><dd><p>(character) password</p>
</dd>
<dt><code>headers</code></dt><dd><p>(list) named list of headers</p>
</dd>
</dl>

</div>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-new"><code>Cushion$new()</code></a>
</p>
</li>
<li> <p><a href="#method-print"><code>Cushion$print()</code></a>
</p>
</li>
<li> <p><a href="#method-ping"><code>Cushion$ping()</code></a>
</p>
</li>
<li> <p><a href="#method-make_url"><code>Cushion$make_url()</code></a>
</p>
</li>
<li> <p><a href="#method-get_headers"><code>Cushion$get_headers()</code></a>
</p>
</li>
<li> <p><a href="#method-get_auth"><code>Cushion$get_auth()</code></a>
</p>
</li>
<li> <p><a href="#method-version"><code>Cushion$version()</code></a>
</p>
</li>
<li> <p><a href="#method-clone"><code>Cushion$clone()</code></a>
</p>
</li></ul>


<hr>
<a id="method-new"></a>



<h4>Method <code>new()</code></h4>

<p>Create a new <code>Cushion</code> object
</p>


<h5>Usage</h5>

<div class="r"><pre>Cushion$new(host, port, path, transport, user, pwd, headers)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>host</code></dt><dd><p>(character) A base URL (without the transport), e.g.,
<code>localhost</code>, <code style="white-space: pre;">&#8288;127.0.0.1&#8288;</code>, or <code>foobar.cloudant.com</code></p>
</dd>
<dt><code>port</code></dt><dd><p>(numeric) Port. Remember that if you don't want a port set,
set this parameter to <code>NULL</code>. Default: <code>5984</code></p>
</dd>
<dt><code>path</code></dt><dd><p>(character) context path that is appended to the end of
the url. e.g., <code>bar</code> in <code style="white-space: pre;">&#8288;http://foo.com/bar&#8288;</code>. Default: <code>NULL</code>,
ignored</p>
</dd>
<dt><code>transport</code></dt><dd><p>(character) http or https. Default: http</p>
</dd>
<dt><code>user, pwd</code></dt><dd><p>(character) user name, and password. these are used in all
requests. if absent, they are not passed to requests</p>
</dd>
<dt><code>headers</code></dt><dd><p>A named list of headers. These headers are used in all
requests. To use headers in individual requests and not others, pass
in headers via <code>...</code> in a function call.</p>
</dd>
</dl>

</div>



<h5>Returns</h5>

<p>A new <code>Cushion</code> object
</p>


<hr>
<a id="method-print"></a>



<h4>Method <code>print()</code></h4>

<p>print method for <code>Cushion</code>
</p>


<h5>Usage</h5>

<div class="r"><pre>Cushion$print()</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>x</code></dt><dd><p>self</p>
</dd>
<dt><code>...</code></dt><dd><p>ignored</p>
</dd>
</dl>

</div>


<hr>
<a id="method-ping"></a>



<h4>Method <code>ping()</code></h4>

<p>Ping the CouchDB server
</p>


<h5>Usage</h5>

<div class="r"><pre>Cushion$ping(as = "list", ...)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>as</code></dt><dd><p>(character) One of list (default) or json</p>
</dd>
<dt><code>...</code></dt><dd><p>curl options passed to <a href="crul.html#topic+verb-GET">crul::verb-GET</a></p>
</dd>
</dl>

</div>


<hr>
<a id="method-make_url"></a>



<h4>Method <code>make_url()</code></h4>

<p>Construct full base URL from the pieces in the
connection object
</p>


<h5>Usage</h5>

<div class="r"><pre>Cushion$make_url()</pre></div>


<hr>
<a id="method-get_headers"></a>



<h4>Method <code>get_headers()</code></h4>

<p>Get list of headers that will be sent with
each request
</p>


<h5>Usage</h5>

<div class="r"><pre>Cushion$get_headers()</pre></div>


<hr>
<a id="method-get_auth"></a>



<h4>Method <code>get_auth()</code></h4>

<p>Get list of auth values, user and pwd
</p>


<h5>Usage</h5>

<div class="r"><pre>Cushion$get_auth()</pre></div>


<hr>
<a id="method-version"></a>



<h4>Method <code>version()</code></h4>

<p>Get the CouchDB version as a numeric
</p>


<h5>Usage</h5>

<div class="r"><pre>Cushion$version()</pre></div>


<hr>
<a id="method-clone"></a>



<h4>Method <code>clone()</code></h4>

<p>The objects of this class are cloneable with this method.
</p>


<h5>Usage</h5>

<div class="r"><pre>Cushion$clone(deep = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>deep</code></dt><dd><p>Whether to make a deep clone.</p>
</dd>
</dl>

</div>




<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Create a CouchDB connection client
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

## metadata
x$host
x$path
x$port
x$type

## ping the CouchDB server
x$ping()

## get CouchDB version
x$version()

# create database
if (!"stuff" %in% db_list(x)) {
  db_create(x, "stuff")
}

# add documents to a database
if (!"sofadb" %in% db_list(x)) {
  db_create(x, "sofadb")
}
doc1 &lt;- '{"name": "drink", "beer": "IPA", "score": 5}'
doc_create(x, dbname="sofadb", docid="abeer", doc1)

# bulk create
if (!"mymtcars" %in% db_list(x)) {
  db_create(x, "mymtcars")
}
db_bulk_create(x, dbname="mymtcars", doc = mtcars)
db_list(x)

## database info
db_info(x, "mymtcars")

## list dbs
db_list(x)

## all docs
db_alldocs(x, "mymtcars", limit = 3)

## changes
db_changes(x, "mymtcars")

# With auth
# x &lt;- Cushion$new(user = 'sckott', pwd = 'sckott')

# Using Cloudant
# z &lt;- Cushion$new(host = "ropensci.cloudant.com", transport = 'https', port = NULL,
#   user = 'ropensci', pwd = Sys.getenv('CLOUDANT_PWD'))
# z
# db_list(z)
# db_create(z, "stuff2")
# db_info(z, "stuff2")
# db_alldocs(z, "foobar")

## End(Not run)
</code></pre>

<hr>
<h2 id='databases'>Work with databases in your CouchDB's.</h2><span id='topic+databases'></span>

<h3>Description</h3>

<p>Work with databases in your CouchDB's.
</p>


<h3>Details</h3>

<p>There are the following functions for working with databases:
</p>

<ul>
<li> <p><code><a href="#topic+db_create">db_create()</a></code> - Create a database
</p>
</li>
<li> <p><code><a href="#topic+db_delete">db_delete()</a></code> - Delete a database
</p>
</li>
<li> <p><code><a href="#topic+db_info">db_info()</a></code> - Get info for a database
</p>
</li>
<li> <p><code><a href="#topic+db_list">db_list()</a></code> - List databases
</p>
</li>
<li> <p><code><a href="#topic+db_replicate">db_replicate()</a></code> - Replicate a database from one couch to another
</p>
</li></ul>


<hr>
<h2 id='db_alldocs'>List all docs in a given database.</h2><span id='topic+db_alldocs'></span>

<h3>Description</h3>

<p>List all docs in a given database.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>db_alldocs(
  cushion,
  dbname,
  descending = NULL,
  startkey = NULL,
  endkey = NULL,
  limit = NULL,
  include_docs = FALSE,
  as = "list",
  disk = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="db_alldocs_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="db_alldocs_+3A_dbname">dbname</code></td>
<td>
<p>Database name. (character)</p>
</td></tr>
<tr><td><code id="db_alldocs_+3A_descending">descending</code></td>
<td>
<p>Return in descending order? (logical)</p>
</td></tr>
<tr><td><code id="db_alldocs_+3A_startkey">startkey</code></td>
<td>
<p>Document ID to start at. (character)</p>
</td></tr>
<tr><td><code id="db_alldocs_+3A_endkey">endkey</code></td>
<td>
<p>Document ID to end at. (character)</p>
</td></tr>
<tr><td><code id="db_alldocs_+3A_limit">limit</code></td>
<td>
<p>Number document IDs to return. (numeric)</p>
</td></tr>
<tr><td><code id="db_alldocs_+3A_include_docs">include_docs</code></td>
<td>
<p>(logical) If <code>TRUE</code>, returns docs themselves,
in addition to IDs. Default: <code>FALSE</code></p>
</td></tr>
<tr><td><code id="db_alldocs_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="db_alldocs_+3A_disk">disk</code></td>
<td>
<p>write to disk or not. By default, data is in the R session;
if you give a file path, we'll write data to disk and you'll get back
the file path. by default, we save in the R session</p>
</td></tr>
<tr><td><code id="db_alldocs_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

if ("leothelion" %in% db_list(x)) {
  invisible(db_delete(x, dbname="leothelion"))
}
db_create(x, dbname='leothelion')
db_bulk_create(x, mtcars, dbname="leothelion")

db_alldocs(x, dbname="leothelion")
db_alldocs(x, dbname="leothelion", as='json')
db_alldocs(x, dbname="leothelion", limit=2)
db_alldocs(x, dbname="leothelion", limit=2, include_docs=TRUE)

# curl options
res &lt;- db_alldocs(x, dbname="leothelion", verbose = TRUE)

# write data to disk - useful when data is very large
## create omdb dataset first
file &lt;- system.file("examples/omdb.json", package = "sofa")
strs &lt;- readLines(file)
if ("omdb" %in% db_list(x)) {
  invisible(db_delete(x, dbname="omdb"))
}
db_create(x, dbname='omdb')
invisible(db_bulk_create(x, "omdb", strs))

## get all docs, writing them to disk
res &lt;- db_alldocs(x, dbname="omdb", disk = (f &lt;- tempfile(fileext=".json")))
res
readLines(res, n = 10)

## End(Not run)
</code></pre>

<hr>
<h2 id='db_bulk_create'>Create documents via the bulk API</h2><span id='topic+db_bulk_create'></span>

<h3>Description</h3>

<p>Create documents via the bulk API
</p>


<h3>Usage</h3>

<pre><code class='language-R'>db_bulk_create(
  cushion,
  dbname,
  doc,
  docid = NULL,
  how = "rows",
  as = "list",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="db_bulk_create_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="db_bulk_create_+3A_dbname">dbname</code></td>
<td>
<p>(character) Database name. Required.</p>
</td></tr>
<tr><td><code id="db_bulk_create_+3A_doc">doc</code></td>
<td>
<p>A data.frame, list, or JSON as a character string. Required.</p>
</td></tr>
<tr><td><code id="db_bulk_create_+3A_docid">docid</code></td>
<td>
<p>Document IDs, ignored for now, eventually, you can pass in a
list, or vector to be the ids for each document created. Has to be the same
length as the number of documents.</p>
</td></tr>
<tr><td><code id="db_bulk_create_+3A_how">how</code></td>
<td>
<p>(character) One of rows (default) or columns. If rows, each row
becomes a separate document; if columns, each column becomes a separate
document.</p>
</td></tr>
<tr><td><code id="db_bulk_create_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="db_bulk_create_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note that row.names are dropped from data.frame inputs.
</p>


<h3>Value</h3>

<p>Either a list or json (depending on <code>as</code> parameter), with
each element an array of key:value pairs:
</p>

<ul>
<li><p> ok - whether creation was successful
</p>
</li>
<li><p> id - the document id
</p>
</li>
<li><p> rev - the revision id
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# initialize a CouchDB connection
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

# From a data.frame
if ("bulktest" %in% db_list(x)) {
  invisible(db_delete(x, dbname="bulktest"))
}
db_create(x, dbname="bulktest")
db_bulk_create(x, "bulktest", mtcars)

if ("bulktest2" %in% db_list(x)) {
  invisible(db_delete(x, dbname="bulktest2"))
}
db_create(x, dbname="bulktest2")
db_bulk_create(x, "bulktest2", iris)

# data.frame with 1 or more columns as neseted lists
mtcars$stuff &lt;- list("hello_world")
mtcars$stuff2 &lt;- list("hello_world","things")
if ("bulktest3" %in% db_list(x)) {
  invisible(db_delete(x, dbname="bulktest3"))
}
db_create(x, dbname="bulktest3")
db_bulk_create(x, "bulktest3", mtcars)

# From a json character string, or more likely, many json character strings
library("jsonlite")
strs &lt;- as.character(parse_df(mtcars, "columns"))
if ("bulkfromchr" %in% db_list(x)) {
  invisible(db_delete(x, dbname="bulkfromchr"))
}
db_create(x, dbname="bulkfromchr")
db_bulk_create(x, "bulkfromchr", strs)

# From a list of lists
library("jsonlite")
lst &lt;- parse_df(mtcars, tojson=FALSE)
if ("bulkfromchr" %in% db_list(x)) {
  invisible(db_delete(x, dbname="bulkfromchr"))
}
db_create(x, dbname="bulkfromchr")
db_bulk_create(x, "bulkfromchr", lst)

# iris dataset - by rows
if ("irisrows" %in% db_list(x)) {
  invisible(db_delete(x, dbname="irisrows"))
}
db_create(x, dbname="irisrows")
db_bulk_create(x, "irisrows", apply(iris, 1, as.list))

# iris dataset - by columns - doesn't quite work yet
# if ("iriscolumns" %in% db_list(x)) {
#   invisible(db_delete(x, dbname="iriscolumns"))
# }
# db_create(x, dbname="iriscolumns")
# db_bulk_create(x, "iriscolumns", parse_df(iris, "columns", tojson=FALSE), how="columns")

## End(Not run)
</code></pre>

<hr>
<h2 id='db_bulk_get'>Query many documents at once</h2><span id='topic+db_bulk_get'></span>

<h3>Description</h3>

<p>Query many documents at once
</p>


<h3>Usage</h3>

<pre><code class='language-R'>db_bulk_get(cushion, dbname, docid_rev, as = "list", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="db_bulk_get_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="db_bulk_get_+3A_dbname">dbname</code></td>
<td>
<p>(character) Database name. Required.</p>
</td></tr>
<tr><td><code id="db_bulk_get_+3A_docid_rev">docid_rev</code></td>
<td>
<p>A list of named lists, each of which must have the
slot <code>id</code>, and optionally <code>rev</code> for the revision of the document id</p>
</td></tr>
<tr><td><code id="db_bulk_get_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="db_bulk_get_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>Either a list or json (depending on <code>as</code> parameter)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# initialize a CouchDB connection
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

if ("bulkgettest" %in% db_list(x)) {
  invisible(db_delete(x, dbname="bulkgettest"))
}
db_create(x, dbname="bulkgettest")
db_bulk_create(x, "bulkgettest", mtcars)
res &lt;- db_query(x, dbname = "bulkgettest", selector = list(cyl = 8))

# with ids only
ids &lt;- vapply(res$docs, "[[", "", "_id")
ids_only &lt;- lapply(ids[1:5], function(w) list(id = w))
db_bulk_get(x, "bulkgettest", docid_rev = ids_only)

# with ids and revs
ids_rev &lt;- lapply(res$docs[1:3],
  function(w) list(id = w$`_id`, rev = w$`_rev`))
db_bulk_get(x, "bulkgettest", docid_rev = ids_rev)

## End(Not run)
</code></pre>

<hr>
<h2 id='db_bulk_update'>Create documents via the bulk API</h2><span id='topic+db_bulk_update'></span>

<h3>Description</h3>

<p>Create documents via the bulk API
</p>


<h3>Usage</h3>

<pre><code class='language-R'>db_bulk_update(
  cushion,
  dbname,
  doc,
  docid = NULL,
  how = "rows",
  as = "list",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="db_bulk_update_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="db_bulk_update_+3A_dbname">dbname</code></td>
<td>
<p>(character) Database name. Required.</p>
</td></tr>
<tr><td><code id="db_bulk_update_+3A_doc">doc</code></td>
<td>
<p>For now, a data.frame only. Required.</p>
</td></tr>
<tr><td><code id="db_bulk_update_+3A_docid">docid</code></td>
<td>
<p>Document IDs, ignored for now, eventually, you can pass in a
list, or vector to be the ids for each document created. Has to be the same
length as the number of documents.</p>
</td></tr>
<tr><td><code id="db_bulk_update_+3A_how">how</code></td>
<td>
<p>(character) One of rows (default) or columns. If rows, each row
becomes a separate document; if columns, each column becomes a separate
document.</p>
</td></tr>
<tr><td><code id="db_bulk_update_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="db_bulk_update_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>Either a list or json (depending on <code>as</code> parameter), with
each element an array of key:value pairs:
</p>

<ul>
<li><p> ok - whether creation was successful
</p>
</li>
<li><p> id - the document id
</p>
</li>
<li><p> rev - the revision id
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# initialize a CouchDB connection
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

row.names(mtcars) &lt;- NULL

if ("bulktest" %in% db_list(x)) {
  invisible(db_delete(x, dbname="bulktest"))
}
db_create(x, dbname="bulktest")
db_bulk_create(x, mtcars, dbname="bulktest")

# modify mtcars
mtcars$letter &lt;- sample(letters, NROW(mtcars), replace = TRUE)
db_bulk_update(x, "bulktest", mtcars)

# change again
mtcars$num &lt;- 89
db_bulk_update(x, "bulktest", mtcars)

## End(Not run)
</code></pre>

<hr>
<h2 id='db_changes'>List changes to a database.</h2><span id='topic+db_changes'></span>

<h3>Description</h3>

<p>Of course it doesn't make much sense to use certain options in
_changes. For example, using feed=longpoll or continuous doesn't make much
sense within R itself.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>db_changes(
  cushion,
  dbname,
  descending = NULL,
  startkey = NULL,
  endkey = NULL,
  since = NULL,
  limit = NULL,
  include_docs = NULL,
  feed = "normal",
  heartbeat = NULL,
  filter = NULL,
  as = "list",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="db_changes_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="db_changes_+3A_dbname">dbname</code></td>
<td>
<p>Database name. (character)</p>
</td></tr>
<tr><td><code id="db_changes_+3A_descending">descending</code></td>
<td>
<p>Return in descending order? (logical)</p>
</td></tr>
<tr><td><code id="db_changes_+3A_startkey">startkey</code></td>
<td>
<p>Document ID to start at. (character)</p>
</td></tr>
<tr><td><code id="db_changes_+3A_endkey">endkey</code></td>
<td>
<p>Document ID to end at. (character)</p>
</td></tr>
<tr><td><code id="db_changes_+3A_since">since</code></td>
<td>
<p>Start the results from the change immediately after the given
sequence number.</p>
</td></tr>
<tr><td><code id="db_changes_+3A_limit">limit</code></td>
<td>
<p>Number document IDs to return. (numeric)</p>
</td></tr>
<tr><td><code id="db_changes_+3A_include_docs">include_docs</code></td>
<td>
<p>(character) If &quot;true&quot;, returns docs themselves, in
addition to IDs</p>
</td></tr>
<tr><td><code id="db_changes_+3A_feed">feed</code></td>
<td>
<p>Select the type of feed. One of normal, longpoll, or continuous.
See description. (character)</p>
</td></tr>
<tr><td><code id="db_changes_+3A_heartbeat">heartbeat</code></td>
<td>
<p>Period in milliseconds after which an empty line is sent in
the results. Only applicable for longpoll or continuous feeds. Overrides any
timeout to keep the feed alive indefinitely. (numeric (milliseconds))</p>
</td></tr>
<tr><td><code id="db_changes_+3A_filter">filter</code></td>
<td>
<p>Reference a filter function from a design document to
selectively get updates.</p>
</td></tr>
<tr><td><code id="db_changes_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="db_changes_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>Either a list of json (depending on <code>as</code> parameter), with
keys:
</p>

<ul>
<li><p> results - Changes made to a database, length 0 if no changes.
Each of these has:
</p>

<ul>
<li><p> changes - List of document's leafs with single field rev
</p>
</li>
<li><p> id - Document ID
</p>
</li>
<li><p> seq - Update sequence
</p>
</li></ul>

</li>
<li><p> last_seq - Last change update sequence
</p>
</li>
<li><p> pending - Count of remaining items in the feed
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

if ("leoalion" %in% db_list(x)) {
  invisible(db_delete(x, dbname="leoalion"))
}
db_create(x, dbname='leoalion')

# no changes
res &lt;- db_changes(x, dbname="leoalion")
res$results

# create a document
doc1 &lt;- '{"name": "drink", "type": "water", "score": 5}'
doc_create(x, dbname="leoalion", doc1, docid="awater")

# now there's changes
res &lt;- db_changes(x, dbname="leoalion")
res$results

# as JSON
db_changes(x, dbname="leoalion", as='json')

## End(Not run)
</code></pre>

<hr>
<h2 id='db_compact'>Request compaction of the specified database</h2><span id='topic+db_compact'></span>

<h3>Description</h3>

<p>Request compaction of the specified database
</p>


<h3>Usage</h3>

<pre><code class='language-R'>db_compact(cushion, dbname, as = "list", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="db_compact_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="db_compact_+3A_dbname">dbname</code></td>
<td>
<p>Database name. Required.</p>
</td></tr>
<tr><td><code id="db_compact_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="db_compact_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Compaction compresses the disk database file by performing the following
operations:
</p>

<ul>
<li><p> Writes a new, optimised, version of the database file, removing any unused
sections from the new version during write. Because a new file is temporarily
created for this purpose, you may require up to twice the current storage space
of the specified database in order for the compaction routine to complete.
</p>
</li>
<li><p> Removes old revisions of documents from the database, up to the per-database
limit specified by the _revs_limit database parameter.
</p>
</li></ul>

<p>Compaction can only be requested on an individual database; you cannot compact all
the databases for a CouchDB instance. The compaction process runs as a background
process. You can determine if the compaction process is operating on a database by
obtaining the database meta information, the compact_running value of the returned
database structure will be set to true. See GET /db. You can also obtain a list of
running processes to determine whether compaction is currently running.
See &quot;/_active_tasks&quot;
</p>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))
# db_compact(x, dbname = "iris")

## End(Not run)
</code></pre>

<hr>
<h2 id='db_create'>Create a database.</h2><span id='topic+db_create'></span>

<h3>Description</h3>

<p>Create a database.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>db_create(cushion, dbname, delifexists = FALSE, as = "list", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="db_create_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="db_create_+3A_dbname">dbname</code></td>
<td>
<p>Database name</p>
</td></tr>
<tr><td><code id="db_create_+3A_delifexists">delifexists</code></td>
<td>
<p>If <code>TRUE</code>, delete any database of the same name before
creating it. This is useful for testing. Default: <code>FALSE</code></p>
</td></tr>
<tr><td><code id="db_create_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="db_create_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

if ("leothetiger" %in% db_list(x)) {
  invisible(db_delete(x, dbname="leothetiger"))
}
db_create(x, dbname='leothetiger')

## see if its there now
db_list(x)

## End(Not run)
</code></pre>

<hr>
<h2 id='db_delete'>Delete a database.</h2><span id='topic+db_delete'></span>

<h3>Description</h3>

<p>Delete a database.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>db_delete(cushion, dbname, as = "list", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="db_delete_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="db_delete_+3A_dbname">dbname</code></td>
<td>
<p>Database name</p>
</td></tr>
<tr><td><code id="db_delete_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="db_delete_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

# local databasees
## create database first, then delete
db_create(x, dbname='newdb')
db_delete(x, dbname='newdb')

## with curl info while doing request
library('crul')
db_create(x, 'newdb')
db_delete(x, 'newdb', verbose = TRUE)

## End(Not run)
</code></pre>

<hr>
<h2 id='db_explain'>Explain API</h2><span id='topic+db_explain'></span>

<h3>Description</h3>

<p>Explain API
</p>


<h3>Usage</h3>

<pre><code class='language-R'>db_explain(
  cushion,
  dbname,
  query = NULL,
  selector = NULL,
  limit = NULL,
  skip = NULL,
  sort = NULL,
  fields = NULL,
  use_index = NULL,
  as = "list",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="db_explain_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="db_explain_+3A_dbname">dbname</code></td>
<td>
<p>Database name</p>
</td></tr>
<tr><td><code id="db_explain_+3A_query">query</code></td>
<td>
<p>(character) instead of using the other parameters, you can
compose one R list or json blob here</p>
</td></tr>
<tr><td><code id="db_explain_+3A_selector">selector</code></td>
<td>
<p>(json) - JSON object describing criteria used to select
documents. More information provided in the section on selector syntax.
See the <code>query_tutorial</code> in this package, and the selectors docs
<a href="http://docs.couchdb.org/en/2.0.0/api/database/find.html#find-selectors">http://docs.couchdb.org/en/2.0.0/api/database/find.html#find-selectors</a></p>
</td></tr>
<tr><td><code id="db_explain_+3A_limit">limit</code></td>
<td>
<p>(number) - Maximum number of results returned. Default: 25
Optional</p>
</td></tr>
<tr><td><code id="db_explain_+3A_skip">skip</code></td>
<td>
<p>(number) - Skip the first 'n' results, where 'n' is the value
specified. Optional</p>
</td></tr>
<tr><td><code id="db_explain_+3A_sort">sort</code></td>
<td>
<p>(json) - JSON array following sort syntax. Optional.
See <a href="http://docs.couchdb.org/en/2.0.0/api/database/find.html#find-sort">http://docs.couchdb.org/en/2.0.0/api/database/find.html#find-sort</a>
For some reason, sort doesn't work often, not sure why.</p>
</td></tr>
<tr><td><code id="db_explain_+3A_fields">fields</code></td>
<td>
<p>(json) - JSON array specifying which fields of each object
should be returned. If it is omitted, the entire object is returned. More
information provided in the section on filtering fields. Optional
See <a href="http://docs.couchdb.org/en/2.0.0/api/database/find.html#find-filter">http://docs.couchdb.org/en/2.0.0/api/database/find.html#find-filter</a></p>
</td></tr>
<tr><td><code id="db_explain_+3A_use_index">use_index</code></td>
<td>
<p>(json) - Instruct a query to use a specific index.
Specified either as <code style="white-space: pre;">&#8288;&lt;design_document&gt;&#8288;</code> or <code style="white-space: pre;">&#8288;["&lt;design_document&gt;", "&lt;index_name&gt;"]&#8288;</code>. Optional</p>
</td></tr>
<tr><td><code id="db_explain_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="db_explain_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
## create a connection
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

file &lt;- system.file("examples/omdb.json", package = "sofa")
strs &lt;- readLines(file)

## create a database
if ("omdb" %in% db_list(x)) {
  invisible(db_delete(x, dbname="omdb"))
}
db_create(x, dbname='omdb')

## add some documents
invisible(db_bulk_create(x, "omdb", strs))

## query all in one json blob
db_explain(x, dbname = "omdb", query = '{
  "selector": {
    "_id": {
      "$gt": null
    }
  }
}')

## End(Not run)
</code></pre>

<hr>
<h2 id='db_index'>Create and get database indexes</h2><span id='topic+db_index'></span><span id='topic+db_index_create'></span><span id='topic+db_index_delete'></span>

<h3>Description</h3>

<p>Create and get database indexes
</p>


<h3>Usage</h3>

<pre><code class='language-R'>db_index(cushion, dbname, as = "list", ...)

db_index_create(cushion, dbname, body, as = "list", ...)

db_index_delete(cushion, dbname, design, index_name, as = "list", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="db_index_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="db_index_+3A_dbname">dbname</code></td>
<td>
<p>(character) Database name, required</p>
</td></tr>
<tr><td><code id="db_index_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="db_index_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
<tr><td><code id="db_index_+3A_body">body</code></td>
<td>
<p>(named list) index fields, required</p>
</td></tr>
<tr><td><code id="db_index_+3A_design">design</code></td>
<td>
<p>(character) Design document name</p>
</td></tr>
<tr><td><code id="db_index_+3A_index_name">index_name</code></td>
<td>
<p>(character) index name</p>
</td></tr>
</table>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Body parameters</h3>


<ul>
<li><p> index (json) - JSON object describing the index to create.
</p>
</li>
<li><p> ddoc (string) - Name of the design document in which the index will be
created. By default, each index will be created in its own design
document. Indexes can be grouped into design documents for efficiency.
However, a change to one index in a design document will invalidate all
other indexes in the same document (similar to views). Optional
</p>
</li>
<li><p> name (string) - Name of the index. If no name is provided, a name will
be generated automatically. Optional
</p>
</li>
<li><p> type (string) - Can be &quot;json&quot; or &quot;text&quot;. Defaults to json. Geospatial
indexes will be supported in the future. Optional Text indexes are
supported via a third party library Optional
</p>
</li>
<li><p> partial_filter_selector (json) - A selector to apply to documents at
indexing time, creating a partial index. Optional
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

# create a database first
if ("testing" %in% db_list(x)) {
  invisible(db_delete(x, dbname="testing"))
}
db_create(x, "testing")

# get indexes
db_index(x, "testing")

# create indexes
body &lt;- list(index = list(fields = I("foo")), name = "foo-index", type = "json")
db_index_create(x, "testing", body = body)

# get indexes, after creating another index
db_index(x, "testing")

# delete an index
res &lt;- db_index(x, "testing")
db_index_delete(x, "testing", res$indexes[[2]]$ddoc, res$indexes[[2]]$name)
## and it's gone
db_index(x, "testing")

## End(Not run)
</code></pre>

<hr>
<h2 id='db_info'>List database info.</h2><span id='topic+db_info'></span>

<h3>Description</h3>

<p>List database info.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>db_info(cushion, dbname, as = "list", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="db_info_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="db_info_+3A_dbname">dbname</code></td>
<td>
<p>Database name</p>
</td></tr>
<tr><td><code id="db_info_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="db_info_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

if ("sofadb" %in% db_list(x)) {
  invisible(db_delete(x, dbname="sofadb"))
}
db_create(x, dbname='sofadb')

db_info(x, dbname="sofadb")
db_info(x, dbname="sofadb", as='json')

## End(Not run)
</code></pre>

<hr>
<h2 id='db_list'>List all databases.</h2><span id='topic+db_list'></span>

<h3>Description</h3>

<p>List all databases.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>db_list(cushion, simplify = TRUE, as = "list", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="db_list_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="db_list_+3A_simplify">simplify</code></td>
<td>
<p>(logical) Simplify to character vector, ignored
if <code>as="json"</code></p>
</td></tr>
<tr><td><code id="db_list_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="db_list_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

db_list(x)
db_list(x, as = 'json')

## End(Not run)
</code></pre>

<hr>
<h2 id='db_query'>Query a database.</h2><span id='topic+db_query'></span>

<h3>Description</h3>

<p>Query a database.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>db_query(
  cushion,
  dbname,
  query = NULL,
  selector = NULL,
  limit = NULL,
  skip = NULL,
  sort = NULL,
  fields = NULL,
  use_index = NULL,
  r = NULL,
  bookmark = NULL,
  update = NULL,
  stable = NULL,
  stale = NULL,
  execution_stats = FALSE,
  as = "list",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="db_query_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="db_query_+3A_dbname">dbname</code></td>
<td>
<p>Database name</p>
</td></tr>
<tr><td><code id="db_query_+3A_query">query</code></td>
<td>
<p>(character) instead of using the other parameters, you can
compose one R list or json blob here</p>
</td></tr>
<tr><td><code id="db_query_+3A_selector">selector</code></td>
<td>
<p>(list/json) - JSON object describing criteria used to select
documents. More information provided in the section on selector syntax.
See the <code>query_tutorial</code> in this package, and the selectors docs
<a href="http://docs.couchdb.org/en/2.0.0/api/database/find.html#find-selectors">http://docs.couchdb.org/en/2.0.0/api/database/find.html#find-selectors</a></p>
</td></tr>
<tr><td><code id="db_query_+3A_limit">limit</code></td>
<td>
<p>(numeric) - Maximum number of results returned. Default is 25.
Optional</p>
</td></tr>
<tr><td><code id="db_query_+3A_skip">skip</code></td>
<td>
<p>(numeric) - Skip the first 'n' results, where 'n' is the value
specified. Optional</p>
</td></tr>
<tr><td><code id="db_query_+3A_sort">sort</code></td>
<td>
<p>(json) - JSON array following sort syntax. Optional.
See <a href="http://docs.couchdb.org/en/2.0.0/api/database/find.html#find-sort">http://docs.couchdb.org/en/2.0.0/api/database/find.html#find-sort</a>
For some reason, sort doesn't work often, not sure why.</p>
</td></tr>
<tr><td><code id="db_query_+3A_fields">fields</code></td>
<td>
<p>(json) - JSON array specifying which fields of each object
should be returned. If it is omitted, the entire object is returned. More
information provided in the section on filtering fields. Optional
See <a href="http://docs.couchdb.org/en/2.0.0/api/database/find.html#find-filter">http://docs.couchdb.org/en/2.0.0/api/database/find.html#find-filter</a></p>
</td></tr>
<tr><td><code id="db_query_+3A_use_index">use_index</code></td>
<td>
<p>(json) - Instruct a query to use a specific index.
Specified either as <code style="white-space: pre;">&#8288;&lt;design_document&gt;&#8288;</code> or <code style="white-space: pre;">&#8288;["&lt;design_document&gt;", "&lt;index_name&gt;"]&#8288;</code>. Optional</p>
</td></tr>
<tr><td><code id="db_query_+3A_r">r</code></td>
<td>
<p>(numeric) Read quorum needed for the result. This defaults to 1,
in which case the document found in the index is returned. If set to a
higher value, each document is read from at least that many replicas before
it is returned in the results. This is likely to take more time than using
only the document stored locally with the index. Optional, default: 1</p>
</td></tr>
<tr><td><code id="db_query_+3A_bookmark">bookmark</code></td>
<td>
<p>(character) A string that enables you to specify which
page of results you require. Used for paging through result sets. Every
query returns an opaque string under the bookmark key that can then be
passed back in a query to get the next page of results. If any part of
the selector query changes between requests, the results are undefined.
Optional, default: <code>NULL</code></p>
</td></tr>
<tr><td><code id="db_query_+3A_update">update</code></td>
<td>
<p>(logical) Whether to update the index prior to returning the
result. Default is true. Optional</p>
</td></tr>
<tr><td><code id="db_query_+3A_stable">stable</code></td>
<td>
<p>(logical) Whether or not the view results should be returned
from a stable set of shards. Optional</p>
</td></tr>
<tr><td><code id="db_query_+3A_stale">stale</code></td>
<td>
<p>(character) Combination of <code>update=FALSE</code> and <code>stable=TRUE</code>
options. Possible options: &quot;ok&quot;, &quot;FALSE&quot; (default). Optional</p>
</td></tr>
<tr><td><code id="db_query_+3A_execution_stats">execution_stats</code></td>
<td>
<p>(logical) Include execution statistics in the query
response. Optional, default: <code>FALSE</code></p>
</td></tr>
<tr><td><code id="db_query_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="db_query_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
## create a connection
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

file &lt;- system.file("examples/omdb.json", package = "sofa")
strs &lt;- readLines(file)

## create a database
if ("omdb" %in% db_list(x)) {
  invisible(db_delete(x, dbname="omdb"))
}
db_create(x, dbname='omdb')

## add some documents
invisible(db_bulk_create(x, "omdb", strs))

## query all in one json blob
db_query(x, dbname = "omdb", query = '{
  "selector": {
    "_id": {
      "$gt": null
    }
  }
}')

## query with each parameter
db_query(x, dbname = "omdb",
  selector = list(`_id` = list(`$gt` = NULL)))

db_query(x, dbname = "omdb",
  selector = list(`_id` = list(`$gt` = NULL)), limit = 3)

# fields
## single field works
db_query(x, dbname = "omdb",
  selector = list(`_id` = list(`$gt` = NULL)), limit = 3,
  fields = c('_id', 'Actors', 'imdbRating'))

## as well as many fields
db_query(x, dbname = "omdb",
  selector = list(`_id` = list(`$gt` = NULL)), limit = 3,
  fields = '_id')

## other queries
db_query(x, dbname = "omdb",
  selector = list(Year = list(`$gt` = "2013")))

db_query(x, dbname = "omdb", selector = list(Rated = "R"))

db_query(x, dbname = "omdb",
  selector = list(Rated = "PG", Language = "English"))

db_query(x, dbname = "omdb", selector = list(
  `$or` = list(
    list(Director = "Jon Favreau"),
    list(Director = "Spike Lee")
  )
), fields = c("_id", "Director"))

## when selector vars are of same name, use a JSON string
## b/c R doesn't let you have a list with same name slots
db_query(x, dbname = "omdb", query = '{
  "selector": {
    "Year": {"$gte": "1990"},
    "Year": {"$lte": "2000"},
    "$not": {"Year": "1998"}
  },
  "fields": ["_id", "Year"]
}')

## regex
db_query(x, dbname = "omdb", selector = list(
  Director = list(`$regex` = "^R")
), fields = c("_id", "Director"))


## End(Not run)
</code></pre>

<hr>
<h2 id='db_replicate'>Upload (replicate) a local database to a remote database server,
e.g., Cloudant, Iriscouch</h2><span id='topic+db_replicate'></span>

<h3>Description</h3>

<p>Upload (replicate) a local database to a remote database server,
e.g., Cloudant, Iriscouch
</p>


<h3>Usage</h3>

<pre><code class='language-R'>db_replicate(from, to, dbname, createdb = FALSE, as = "list", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="db_replicate_+3A_from">from</code></td>
<td>
<p>Couch to replicate from. An object of class <a href="#topic+Cushion">Cushion</a>.
Required.</p>
</td></tr>
<tr><td><code id="db_replicate_+3A_to">to</code></td>
<td>
<p>Remote couch to replicate to. An object of class <a href="#topic+Cushion">Cushion</a>.
Required.</p>
</td></tr>
<tr><td><code id="db_replicate_+3A_dbname">dbname</code></td>
<td>
<p>(character) Database name. Required.</p>
</td></tr>
<tr><td><code id="db_replicate_+3A_createdb">createdb</code></td>
<td>
<p>If <code>TRUE</code>, the function creates the db on the remote
server before uploading. The db has to exist before uploading, so either
you do it separately or this fxn can do it for you. Default: <code>FALSE</code></p>
</td></tr>
<tr><td><code id="db_replicate_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="db_replicate_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <a href="crul.html#topic+HttpClient">crul::HttpClient</a></p>
</td></tr>
</table>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
if (interactive()) {
## create a connection
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

# Create a database locally
db_list(x)
if ("hello_earth" %in% db_list(x)) {
  invisible(db_delete(x, dbname="hello_earth"))
}
db_create(x, 'hello_earth')

## replicate to a remote server
z &lt;- Cushion$new(host = "ropensci.cloudant.com", transport = 'https',
  port = NULL, user = 'ropensci', pwd = Sys.getenv('CLOUDANT_PWD'))

## do the replication
db_replicate(x, z, dbname = "hello_earth")

## check changes on the remote
db_list(z)
db_changes(z, dbname = "hello_earth")

## make some changes on the remote
doc_create(z, dbname = "hello_earth",
  '{"language":"python","library":"requests"}', 'stuff')
changes(z, dbname = "hello_earth")

## create another document, and try to get it
doc_create(z, dbname = "hello_earth", doc = '{"language":"R"}',
  docid="R_rules")
doc_get(z, dbname = "hello_earth", docid='R_rules')

## cleanup - delete the database
db_delete(z, 'hello_earth')
}

## End(Not run)
</code></pre>

<hr>
<h2 id='db_revisions'>Get document revisions.</h2><span id='topic+db_revisions'></span>

<h3>Description</h3>

<p>Get document revisions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>db_revisions(cushion, dbname, docid, simplify = TRUE, as = "list", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="db_revisions_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="db_revisions_+3A_dbname">dbname</code></td>
<td>
<p>Database name</p>
</td></tr>
<tr><td><code id="db_revisions_+3A_docid">docid</code></td>
<td>
<p>Document ID</p>
</td></tr>
<tr><td><code id="db_revisions_+3A_simplify">simplify</code></td>
<td>
<p>(logical) Simplify to character vector of revision ids.
If <code>FALSE</code>, gives back availability info too. Default: <code>TRUE</code></p>
</td></tr>
<tr><td><code id="db_revisions_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="db_revisions_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

if ("sofadb" %in% db_list(x)) {
 db_delete(x, dbname = "sofadb")
}
db_create(x, dbname = "sofadb")

doc1 &lt;- '{"name": "drink", "beer": "IPA", "score": 5}'
doc_create(x, dbname="sofadb", doc1, docid="abeer")
doc_create(x, dbname="sofadb", doc1, docid="morebeer", as='json')

db_revisions(x, dbname="sofadb", docid="abeer")
db_revisions(x, dbname="sofadb", docid="abeer", simplify=FALSE)
db_revisions(x, dbname="sofadb", docid="abeer", as='json')
db_revisions(x, dbname="sofadb", docid="abeer", simplify=FALSE, as='json')

## End(Not run)
</code></pre>

<hr>
<h2 id='design'>Work with design documents</h2><span id='topic+design'></span><span id='topic+design_create'></span><span id='topic+design_create_'></span><span id='topic+design_delete'></span><span id='topic+design_get'></span><span id='topic+design_head'></span><span id='topic+design_info'></span>

<h3>Description</h3>

<p>Work with design documents
</p>


<h3>Usage</h3>

<pre><code class='language-R'>design_create(
  cushion,
  dbname,
  design,
  fxnname,
  key = "null",
  value = "doc",
  as = "list",
  ...
)

design_create_(cushion, dbname, design, fxnname, fxn, as = "list", ...)

design_delete(cushion, dbname, design, as = "list", ...)

design_get(cushion, dbname, design, as = "list", ...)

design_head(cushion, dbname, design, ...)

design_info(cushion, dbname, design, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="design_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="design_+3A_dbname">dbname</code></td>
<td>
<p>(character) Database name. required.</p>
</td></tr>
<tr><td><code id="design_+3A_design">design</code></td>
<td>
<p>(character) Design document name. this is the design name
without <code style="white-space: pre;">&#8288;_design/&#8288;</code>, which is prepended internally. required.</p>
</td></tr>
<tr><td><code id="design_+3A_fxnname">fxnname</code></td>
<td>
<p>(character) A function name. required for <code>view_put</code>
and <code>view_put_</code></p>
</td></tr>
<tr><td><code id="design_+3A_key">key</code>, <code id="design_+3A_value">value</code></td>
<td>
<p>(character) a key and value, see Examples and Details</p>
</td></tr>
<tr><td><code id="design_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="design_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
<tr><td><code id="design_+3A_fxn">fxn</code></td>
<td>
<p>(character) a javascript function. required for <code>view_put_</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>design_create</code> is a slightly easier interface to creating
design documents; it just asks for a function name, the key and a
value, then we create the function for you internally. TO have more
flexibility use <code>view_put_</code> (with underscore on the end) to write the
function yourself.
</p>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

file &lt;- system.file("examples/omdb.json", package = "sofa")
strs &lt;- readLines(file)

## create a database
if ("omdb" %in% db_list(x)) {
  invisible(db_delete(x, dbname="omdb"))
}
db_create(x, dbname='omdb')

## add the documents
invisible(db_bulk_create(x, "omdb", strs))

# Create a view, the easy way, but less flexible
design_create(x, dbname='omdb', design='view1', fxnname="foobar1")
design_create(x, dbname='omdb', design='view2', fxnname="foobar2",
  value="doc.Country")
design_create(x, dbname='omdb', design='view5', fxnname="foobar3",
  value="[doc.Country,doc.imdbRating]")

# the harder way, write your own function, but more flexible
design_create_(x, dbname='omdb', design='view22',
  fxnname = "stuffthings", fxn = "function(doc){emit(null,doc.Country)}")

# Delete a view
design_delete(x, dbname='omdb', design='view1')

# Get info on a design document
## HEAD request, returns just response headers
design_head(x, dbname='omdb', design='view2')
design_head(x, dbname='omdb', design='view5')
## GET request, returns information about the design document
design_info(x, dbname='omdb', design='view2')
design_info(x, dbname='omdb', design='view5')

# Get a design document (GET request)
design_get(x, dbname='omdb', design='view2')
design_get(x, dbname='omdb', design='view5')

# Search using a view
res &lt;- design_search(x, dbname='omdb', design='view2', view='foobar2')
head(
  do.call(
    "rbind.data.frame",
    lapply(res$rows, function(x) Filter(length, x))
  )
)

res &lt;- design_search(x, dbname='omdb', design='view5', view='foobar3')
head(
  structure(do.call(
    "rbind.data.frame",
    lapply(res$rows, function(x) x$value)
  ), .Names = c('Country', 'imdbRating'))
)

## End(Not run)
</code></pre>

<hr>
<h2 id='design_search'>Search design documents</h2><span id='topic+design_search'></span><span id='topic+design_search_many'></span>

<h3>Description</h3>

<p>Search design documents
</p>


<h3>Usage</h3>

<pre><code class='language-R'>design_search(
  cushion,
  dbname,
  design,
  view,
  params = list(),
  body = list(),
  as = "list",
  ...
)

design_search_many(cushion, dbname, design, view, queries, as = "list", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="design_search_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="design_search_+3A_dbname">dbname</code></td>
<td>
<p>(character) Database name. required.</p>
</td></tr>
<tr><td><code id="design_search_+3A_design">design</code></td>
<td>
<p>(character) Design document name. this is the design name
without <code style="white-space: pre;">&#8288;_design/&#8288;</code>, which is prepended internally. required.</p>
</td></tr>
<tr><td><code id="design_search_+3A_view">view</code></td>
<td>
<p>(character) a view, same as <code>fxn</code> param in
<code><a href="#topic+design_create_">design_create_()</a></code>. required.</p>
</td></tr>
<tr><td><code id="design_search_+3A_params">params</code></td>
<td>
<p>query parameters. a named list</p>
</td></tr>
<tr><td><code id="design_search_+3A_body">body</code></td>
<td>
<p>same as <code>params</code>, but if any given, a POST request is
sent (if body non-NULL, <code>params</code> also sent). a named list</p>
</td></tr>
<tr><td><code id="design_search_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="design_search_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
<tr><td><code id="design_search_+3A_queries">queries</code></td>
<td>
<p>a list of named lists of queries</p>
</td></tr>
</table>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Options to pass to <code>params</code>, <code>body</code>, or <code>queries</code> params</h3>


<ul>
<li><p> conflicts (logical) Includes conflicts information in response.
Ignored if include_docs isn't <code>TRUE</code>. Default: <code>FALSE</code>
</p>
</li>
<li><p> descending (logical) Return the documents in descending by key
order. Default: <code>FALSE</code>
</p>
</li>
<li><p> endkey,end_key (list) Stop returning records when the specified key is
reached. Optional. <code>end_key</code> is an alias for <code>endkey</code>
</p>
</li>
<li><p> endkey_docid,end_key_doc_id (character) Stop returning records when
the specified document ID is reached. Requires endkey to be specified for
this to have any effect. Optional. <code>end_key_doc_id</code> is an alias for
<code>endkey_docid</code>
</p>
</li>
<li><p> group (logical) Group the results using the reduce function to a
group or single row. Default: <code>FALSE</code>
</p>
</li>
<li><p> group_level (integer) Specify the group level to be used. Optional
</p>
</li>
<li><p> include_docs (logical) Include the associated document with each
row. Default: <code>FALSE</code>.
</p>
</li>
<li><p> attachments (logical) Include the Base64-encoded content of
attachments in the documents that are included if include_docs is
<code>TRUE</code>. Ignored if include_docs isn't <code>TRUE</code>.
Default: <code>FALSE</code>
</p>
</li>
<li><p> att_encoding_info (logical) Include encoding information in
attachment stubs if include_docs is <code>TRUE</code> and the particular
attachment is compressed. Ignored if include_docs isn't <code>TRUE</code>.
Default: <code>FALSE</code>.
</p>
</li>
<li><p> inclusive_end (logical) Specifies whether the specified end key
should be included in the result. Default: <code>TRUE</code>
</p>
</li>
<li><p> key (list) Return only documents that match the specified
key. Optional
</p>
</li>
<li><p> keys (list) Return only documents where the key matches one of the
keys specified in the array. Optional
</p>
</li>
<li><p> limit (integer) Limit the number of the returned documents to the
specified number. Optional
</p>
</li>
<li><p> reduce (logical)  Use the reduction function. Default: <code>TRUE</code>
</p>
</li>
<li><p> skip (integer)  Skip this number of records before starting to
return the results. Default: 0
</p>
</li>
<li><p> sorted (logical)  Sort returned rows (see Sorting Returned Rows).
Setting this to <code>FALSE</code> offers a performance boost. The total_rows
and offset fields are not available when this is set to <code>FALSE</code>.
Default: <code>TRUE</code>
</p>
</li>
<li><p> stale (character) Allow the results from a stale view to be used.
Supported values: ok and update_after. Optional
</p>
</li>
<li><p> startkey,start_key (list) Return records starting with the specified
key. Optional. <code>start_key</code> is an alias for startkey
</p>
</li>
<li><p> startkey_docid,start_key_doc_id (character) Return records starting
with the specified document ID. Requires startkey to be specified for this
to have any effect. Optional. <code>start_key_doc_id</code> is an alias for
<code>startkey_docid</code>
</p>
</li>
<li><p> update_seq (logical) Response includes an update_seq value
indicating which sequence id of the database the view reflects.
Default: <code>FALSE</code>
</p>
</li></ul>



<h3>References</h3>

<p>https://docs.couchdb.org/en/latest/api/ddoc/views.html
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

file &lt;- system.file("examples/omdb.json", package = "sofa")
strs &lt;- readLines(file)

## create a database
if ("omdb" %in% db_list(x)) {
  invisible(db_delete(x, dbname="omdb"))
}
db_create(x, dbname='omdb')

## add the documents
invisible(db_bulk_create(x, "omdb", strs))

# Create a view, the easy way, but less flexible
design_create(x, dbname='omdb', design='view1', fxnname="foobar1")
design_create(x, dbname='omdb', design='view2', fxnname="foobar2",
  value="doc.Country")
design_create(x, dbname='omdb', design='view5', fxnname="foobar3",
  value="[doc.Country,doc.imdbRating]")
design_create_(x, dbname='omdb', design='view6', fxnname="foobar4",
  fxn = "function(doc){emit(doc._id,doc.Country)}")

# Search using a view
compact &lt;- function(l) Filter(Negate(is.null), l)
res &lt;- design_search(x, dbname='omdb', design='view2', view ='foobar2')
head(
  do.call(
    "rbind.data.frame",
    Filter(
      function(z) length(z) == 2,
      lapply(res$rows, function(x) compact(x[names(x) %in% c('id', 'value')]))
    )
  )
)

res &lt;- design_search(x, dbname='omdb', design='view5', view = 'foobar3')
head(
  structure(do.call(
    "rbind.data.frame",
    lapply(res$rows, function(x) x$value)
  ), .Names = c('Country', 'imdbRating'))
)

# query parameters
## limit
design_search(x, dbname='omdb', design='view5', view = 'foobar3',
  params = list(limit = 5))
## limit and skip
design_search(x, dbname='omdb', design='view5', view = 'foobar3',
  params = list(limit = 5, skip = 3))
## with start and end keys
### important: the key strings have to be in JSON, so here e.g., 
###  need to add escaped double quotes
res &lt;- design_search(
  cushion = x,
  dbname = 'omdb',
  design = 'view6',
  view = 'foobar4',
  params = list(
    startkey = "\"c25bbf4fef99408b3e1115374a03f642\"",
    endkey = "\"c25bbf4fef99408b3e1115374a040f11\""
  )
)

# POST request
ids &lt;- vapply(db_alldocs(x, dbname='omdb')$rows[1:3], "[[", "", "id")
res &lt;- design_search(x, dbname='omdb', design='view6', view = 'foobar4',
  body = list(keys = ids), verbose = TRUE)
res

# Many queries at once in a POST request
queries &lt;- list(
  list(keys = ids),
  list(limit = 3, skip = 2)
)
design_search_many(x, 'omdb', 'view6', 'foobar4', queries)

## End(Not run)
</code></pre>

<hr>
<h2 id='doc_create'>Create documents to a database.</h2><span id='topic+doc_create'></span>

<h3>Description</h3>

<p>Create documents to a database.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>doc_create(cushion, dbname, doc, docid = NULL, how = "rows", as = "list", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="doc_create_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="doc_create_+3A_dbname">dbname</code></td>
<td>
<p>Database name3</p>
</td></tr>
<tr><td><code id="doc_create_+3A_doc">doc</code></td>
<td>
<p>Document content, can be character string or a list.
The character type can be XML as well, if embedded in JSON. When
the document is retrieved via <code><a href="#topic+doc_get">doc_get()</a></code>, the XML is given back and
you can parse it as normal.</p>
</td></tr>
<tr><td><code id="doc_create_+3A_docid">docid</code></td>
<td>
<p>Document ID</p>
</td></tr>
<tr><td><code id="doc_create_+3A_how">how</code></td>
<td>
<p>(character) One of rows (default) or columns. If rows, each row
becomes a separate document; if columns, each column becomes a separate
document.</p>
</td></tr>
<tr><td><code id="doc_create_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="doc_create_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Documents can have attachments just like email. There are two ways
to use attachments: the first one is via a separate REST call
(see <code><a href="#topic+doc_attach_create">doc_attach_create()</a></code>); the second is inline within your
document, you can do so with this fxn. See
https://docs.couchdb.org/en/latest/api/document/attachments.html for help
on formatting json appropriately.
</p>
<p>Note that you can create documents from a data.frame with this function,
where each row or column is a separate document. However, this function
does not use the bulk API
<a href="https://couchdb.readthedocs.org/en/latest/api/database/bulk-api.html#db-bulk-docs">https://couchdb.readthedocs.org/en/latest/api/database/bulk-api.html#db-bulk-docs</a>
</p>

<ul>
<li><p> see <code><a href="#topic+db_bulk_create">db_bulk_create()</a></code> and <code><a href="#topic+db_bulk_update">db_bulk_update()</a></code> to
create or update documents with the bulk API - which should be much faster
for a large number of documents.
</p>
</li></ul>



<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Digits after the decimal</h3>

<p>If you have any concern about number of digits after the decimal
in your documents, make sure to look at <code>digits</code> in your R options.
The default value is 7 (see <a href="base.html#topic+options">options</a> for more informnation). You
can set the value you like with e.g., <code>options(digits = 10)</code>, and
get what <code>digits</code> is set to with <code>getOption("digits")</code>.
</p>
<p>Note that in <code><a href="#topic+doc_create">doc_create()</a></code> we convert your document to JSON with
<code>jsonlite::toJSON()</code> if given as a list, which has a <code>digits</code> parameter.
We pass <code>getOption("digits")</code> to the <code>digits</code> parameter in
<code>jsonlite::toJSON()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

if ("sofadb" %in% db_list(x)) {
  invisible(db_delete(x, dbname="sofadb"))
}
db_create(x, 'sofadb')

# write a document WITH a name (uses PUT)
doc1 &lt;- '{"name": "drink", "beer": "IPA", "score": 5}'
doc_create(x, dbname="sofadb", doc1, docid="abeer")
doc_create(x, dbname="sofadb", doc1, docid="morebeer", as='json')
doc_get(x, dbname = "sofadb", docid = "abeer")
## with factor class values
doc2 &lt;- list(name = as.factor("drink"), beer = "stout", score = 4)
doc_create(x, doc2, dbname="sofadb", docid="nextbeer", as='json')
doc_get(x, dbname = "sofadb", docid = "nextbeer")

# write a json document WITHOUT a name (uses POST)
doc2 &lt;- '{"name": "food", "icecream": "rocky road"}'
doc_create(x, doc2, dbname="sofadb")
doc3 &lt;- '{"planet": "mars", "size": "smallish"}'
doc_create(x, doc3, dbname="sofadb")
## assigns a UUID instead of a user given name
db_alldocs(x, dbname = "sofadb")

# write an xml document WITH a name (uses PUT). xml is written as xml in
# couchdb, just wrapped in json, when you get it out it will be as xml
doc4 &lt;- "&lt;top&gt;&lt;a/&gt;&lt;b/&gt;&lt;c&gt;&lt;d/&gt;&lt;e&gt;bob&lt;/e&gt;&lt;/c&gt;&lt;/top&gt;"
doc_create(x, doc4, dbname="sofadb", docid="somexml")
doc_get(x, dbname = "sofadb", docid = "somexml")

# You can pass in lists that autoconvert to json internally
doc1 &lt;- list(name = "drink", type = "soda", score = 9)
doc_create(x, dbname="sofadb", doc1, docid="gooddrink")

# Write directly from a data.frame
## Each row or column becomes a separate document
### by rows
if ("test" %in% db_list(x)) {
  invisible(db_delete(x, dbname="test"))
}
db_create(x, dbname = "test")
doc_create(x, mtcars, dbname="test", how="rows")
doc_create(x, mtcars, dbname="test", how="columns")

if ("testiris" %in% db_list(x)) {
  invisible(db_delete(x, dbname="testiris"))
}
db_create(x, dbname = "testiris")
head(iris)
doc_create(x, iris, dbname = "testiris")

## End(Not run)
</code></pre>

<hr>
<h2 id='doc_delete'>Delete a document in a database.</h2><span id='topic+doc_delete'></span>

<h3>Description</h3>

<p>Delete a document in a database.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>doc_delete(cushion, dbname, docid, as = "list", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="doc_delete_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="doc_delete_+3A_dbname">dbname</code></td>
<td>
<p>Database name. (character)</p>
</td></tr>
<tr><td><code id="doc_delete_+3A_docid">docid</code></td>
<td>
<p>Document ID (character)</p>
</td></tr>
<tr><td><code id="doc_delete_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="doc_delete_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

# create a database
if ("sofadb" %in% db_list(x)) {
  invisible(db_delete(x, dbname="sofadb"))
}
db_create(x, dbname='sofadb')

doc3 &lt;- "&lt;top&gt;&lt;a/&gt;&lt;b/&gt;&lt;c&gt;&lt;d/&gt;&lt;e&gt;bob&lt;/e&gt;&lt;/c&gt;&lt;/top&gt;"
doc_create(x, dbname="sofadb", doc=doc3, docid="newnewxml")
doc_delete(x, dbname="sofadb", docid="newnewxml")

# wrong docid name
doc_create(x, dbname="sofadb", doc=doc3, docid="newxml")
# doc_delete(x, dbname="sofadb", docid="wrongname")

## End(Not run)
</code></pre>

<hr>
<h2 id='doc_get'>Get a document from a database.</h2><span id='topic+doc_get'></span>

<h3>Description</h3>

<p>Get a document from a database.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>doc_get(
  cushion,
  dbname,
  docid,
  rev = NULL,
  attachments = FALSE,
  deleted = FALSE,
  revs = FALSE,
  revs_info = FALSE,
  conflicts = FALSE,
  deleted_conflicts = FALSE,
  local_seq = FALSE,
  as = "list",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="doc_get_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="doc_get_+3A_dbname">dbname</code></td>
<td>
<p>Database name</p>
</td></tr>
<tr><td><code id="doc_get_+3A_docid">docid</code></td>
<td>
<p>Document ID</p>
</td></tr>
<tr><td><code id="doc_get_+3A_rev">rev</code></td>
<td>
<p>Revision id of the document to get. If NULL, gets current revision</p>
</td></tr>
<tr><td><code id="doc_get_+3A_attachments">attachments</code></td>
<td>
<p>(logical) Whether to include _attachments field.</p>
</td></tr>
<tr><td><code id="doc_get_+3A_deleted">deleted</code></td>
<td>
<p>(logical) Whether to include _deleted field.</p>
</td></tr>
<tr><td><code id="doc_get_+3A_revs">revs</code></td>
<td>
<p>(logical) Whether to include _revisions field.</p>
</td></tr>
<tr><td><code id="doc_get_+3A_revs_info">revs_info</code></td>
<td>
<p>(logical) Whether to include _revs_info field.</p>
</td></tr>
<tr><td><code id="doc_get_+3A_conflicts">conflicts</code></td>
<td>
<p>(logical) Whether to include _conflicts field.</p>
</td></tr>
<tr><td><code id="doc_get_+3A_deleted_conflicts">deleted_conflicts</code></td>
<td>
<p>(logical) Whether to include _deleted_conflicts field.</p>
</td></tr>
<tr><td><code id="doc_get_+3A_local_seq">local_seq</code></td>
<td>
<p>(logical) Whether to include _local_seq field.</p>
</td></tr>
<tr><td><code id="doc_get_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="doc_get_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

if ("sofadb" %in% db_list(x)) {
  invisible(db_delete(x, dbname="sofadb"))
}
db_create(x, dbname="sofadb")

# create a document
doc1 &lt;- '{"name": "drink", "type": "drink", "score": 5}'
doc_create(x, dbname="sofadb", doc1, docid="asoda")

doc_get(x, dbname="sofadb", docid="asoda")
revs &lt;- db_revisions(x, dbname="sofadb", docid="asoda")
doc_get(x, dbname="sofadb", docid="asoda", rev=revs[1])
doc_get(x, dbname="sofadb", docid="asoda", as='json')
doc_get(x, dbname="sofadb", docid="asoda", revs=TRUE)
doc_get(x, dbname="sofadb", docid="asoda", revs=TRUE, local_seq=TRUE)

## End(Not run)
</code></pre>

<hr>
<h2 id='doc_head'>Get header info for a document</h2><span id='topic+doc_head'></span>

<h3>Description</h3>

<p>Get header info for a document
</p>


<h3>Usage</h3>

<pre><code class='language-R'>doc_head(cushion, dbname, docid, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="doc_head_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="doc_head_+3A_dbname">dbname</code></td>
<td>
<p>(character) Database name. Required.</p>
</td></tr>
<tr><td><code id="doc_head_+3A_docid">docid</code></td>
<td>
<p>(character) Document ID. Required.</p>
</td></tr>
<tr><td><code id="doc_head_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

# create a database
if ("sofadb" %in% db_list(x)) {
  invisible(db_delete(x, dbname="sofadb"))
}
db_create(x, dbname='sofadb')

# create a document
doc1 &lt;- '{"name": "drink", "beer": "IPA", "score": 5}'
doc_create(x, dbname="sofadb", doc1, docid="abeer")

# run doc_head
doc_head(x, dbname="sofadb", docid="abeer")

## End(Not run)
</code></pre>

<hr>
<h2 id='doc_update'>Update a document.</h2><span id='topic+doc_update'></span>

<h3>Description</h3>

<p>Update a document.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>doc_update(cushion, dbname, doc, docid, rev, as = "list", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="doc_update_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="doc_update_+3A_dbname">dbname</code></td>
<td>
<p>(character) Database name. Required.</p>
</td></tr>
<tr><td><code id="doc_update_+3A_doc">doc</code></td>
<td>
<p>(character) Document content. Required.</p>
</td></tr>
<tr><td><code id="doc_update_+3A_docid">docid</code></td>
<td>
<p>(character) Document ID. Required.</p>
</td></tr>
<tr><td><code id="doc_update_+3A_rev">rev</code></td>
<td>
<p>(character) Revision id. Required.</p>
</td></tr>
<tr><td><code id="doc_update_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="doc_update_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Internally, this function adds in the docid and revision id,
required to do a document update
</p>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

if ("sofadb" %in% db_list(x)) {
  invisible(db_delete(x, dbname="sofadb"))
}
db_create(x, dbname='sofadb')

doc1 &lt;- '{"name":"drink","beer":"IPA"}'
doc_create(x, dbname="sofadb", doc=doc1, docid="b_beer")
doc_get(x, dbname = "sofadb", docid = "b_beer")
revs &lt;- db_revisions(x, dbname = "sofadb", docid = "b_beer")
doc2 &lt;- '{"name":"drink","beer":"IPA","note":"yummy","note2":"yay"}'
doc_update(x, dbname="sofadb", doc=doc2, docid="b_beer", rev=revs[1])
db_revisions(x, dbname = "sofadb", docid = "b_beer")

## End(Not run)
</code></pre>

<hr>
<h2 id='doc_upsert'>Create a new document or update an existing one</h2><span id='topic+doc_upsert'></span>

<h3>Description</h3>

<p>Create a new document or update an existing one
</p>


<h3>Usage</h3>

<pre><code class='language-R'>doc_upsert(cushion, dbname, doc, docid)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="doc_upsert_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="doc_upsert_+3A_dbname">dbname</code></td>
<td>
<p>(character) Database name. Required.</p>
</td></tr>
<tr><td><code id="doc_upsert_+3A_doc">doc</code></td>
<td>
<p>(character) Document content. Required.</p>
</td></tr>
<tr><td><code id="doc_upsert_+3A_docid">docid</code></td>
<td>
<p>(character) Document ID. Required.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Internally, this function attempts to update a document with the given name. <br />
If the document does not exist, it is created
</p>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Author(s)</h3>

<p>George Kritikos
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

if ("sofadb" %in% db_list(x)) {
  invisible(db_delete(x, dbname="sofadb"))
}
db_create(x, 'sofadb')

# create a document
doc1 &lt;- '{"name": "drink", "beer": "IPA", "score": 5}'
doc_upsert(x, dbname="sofadb", doc1, docid="abeer")

#update the document
doc2 &lt;- '{"name": "drink", "beer": "lager", "score": 6}'
doc_upsert(x, dbname="sofadb", doc2, docid="abeer")


doc_get(x, dbname = "sofadb", docid = "abeer")

## End(Not run)
</code></pre>

<hr>
<h2 id='documents'>Work with documents in your CouchDB's.</h2><span id='topic+documents'></span>

<h3>Description</h3>

<p>Work with documents in your CouchDB's.
</p>


<h3>Details</h3>

<p>If you are writing a complicated javascript function, better to do
that in the Futon CouchDB interface or otherwise.
</p>
<p>There are the following functions for working with documents:
</p>

<ul>
<li> <p><code>doc_create</code> - Create a document, with or without an ID
</p>
</li>
<li> <p><code>doc_update</code> - Update a document
</p>
</li>
<li> <p><code>doc_get</code> - Get a document
</p>
</li>
<li> <p><code>doc_delete</code> - Delete a document
</p>
</li>
<li> <p><code>doc_head</code> - Get headers for a document
</p>
</li>
<li> <p><code>doc_attach_create</code> - Attach something to a document
</p>
</li>
<li> <p><code>doc_attach_info</code> - Get info on an attachment
</p>
</li>
<li> <p><code>doc_attach_get</code> - Fetch an attachment
</p>
</li>
<li> <p><code>doc_attach_delete</code> - Delete an attachment
</p>
</li>
<li> <p><code>db_alldocs</code> - Get all documents
</p>
</li>
<li> <p><code>db_revisions</code> - Get revisions for a document
</p>
</li></ul>


<hr>
<h2 id='membership'>membership</h2><span id='topic+membership'></span>

<h3>Description</h3>

<p>membership
</p>


<h3>Usage</h3>

<pre><code class='language-R'>membership(cushion, as = "list", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="membership_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="membership_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="membership_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Create a CouchDB connection client
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

membership(x)
membership(x, as = 'json')

## End(Not run)
</code></pre>

<hr>
<h2 id='parse_df'>Parse data.frame to json or list by row or column</h2><span id='topic+parse_df'></span>

<h3>Description</h3>

<p>Parse data.frame to json or list by row or column
</p>


<h3>Usage</h3>

<pre><code class='language-R'>parse_df(dat, how = "rows", tojson = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="parse_df_+3A_dat">dat</code></td>
<td>
<p>(data.frame) A data.frame, matrix, or tbl_df</p>
</td></tr>
<tr><td><code id="parse_df_+3A_how">how</code></td>
<td>
<p>(character) One of rows (default) or columns. If rows, each
row becomes a separate document; if columns, each column becomes a
separate document.</p>
</td></tr>
<tr><td><code id="parse_df_+3A_tojson">tojson</code></td>
<td>
<p>(logical) If <code>TRUE</code> (default) convert to json - if <code>FALSE</code>,
to lists</p>
</td></tr>
<tr><td><code id="parse_df_+3A_...">...</code></td>
<td>
<p>Further args passed on to <code>jsonlite::toJSON()</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Parse data.frame to get either rows or columns, each as a list
or json string
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
parse_df(mtcars, how="rows")
parse_df(mtcars, how="columns")
parse_df(mtcars, how="rows", tojson=FALSE)
parse_df(mtcars, how="columns", tojson=FALSE)

## End(Not run)
</code></pre>

<hr>
<h2 id='ping'>Ping a CouchDB server</h2><span id='topic+ping'></span>

<h3>Description</h3>

<p>Ping a CouchDB server
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ping(cushion, as = "list", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ping_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="ping_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="ping_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# initialize a CouchDB connection
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

# call ping on the cushion object, or pass the cushion to ping()
x$ping()
ping(x)
ping(x, as = "json")

## End(Not run)
</code></pre>

<hr>
<h2 id='restart'>Restart your Couchdb instance</h2><span id='topic+restart'></span>

<h3>Description</h3>

<p>Restart your Couchdb instance
</p>


<h3>Usage</h3>

<pre><code class='language-R'>restart(cushion = "localhost", as = "list", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="restart_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="restart_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="restart_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

# restart(x)

## End(Not run)
</code></pre>

<hr>
<h2 id='session'>session</h2><span id='topic+session'></span>

<h3>Description</h3>

<p>session
</p>


<h3>Usage</h3>

<pre><code class='language-R'>session(cushion, as = "list", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="session_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="session_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="session_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Create a CouchDB connection client
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

session(x)
session(x, as = 'json')

## End(Not run)
</code></pre>

<hr>
<h2 id='uuids'>Get uuids.</h2><span id='topic+uuids'></span>

<h3>Description</h3>

<p>Get uuids.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>uuids(cushion, count = 1, as = "list", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="uuids_+3A_cushion">cushion</code></td>
<td>
<p>A <code><a href="#topic+Cushion">Cushion</a></code> object. Required.</p>
</td></tr>
<tr><td><code id="uuids_+3A_count">count</code></td>
<td>
<p>(numeric) Number of uuids to return. Default: 1</p>
</td></tr>
<tr><td><code id="uuids_+3A_as">as</code></td>
<td>
<p>(character) One of list (default) or json</p>
</td></tr>
<tr><td><code id="uuids_+3A_...">...</code></td>
<td>
<p>Curl args passed on to <code><a href="crul.html#topic+HttpClient">HttpClient</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>JSON as a character string or a list (determined by the
<code>as</code> parameter)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Create a CouchDB connection client
user &lt;- Sys.getenv("COUCHDB_TEST_USER")
pwd &lt;- Sys.getenv("COUCHDB_TEST_PWD")
(x &lt;- Cushion$new(user=user, pwd=pwd))

uuids(x)
uuids(x, as = 'json')

## End(Not run)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
