<!DOCTYPE html><html lang="en"><head><title>Help for package gfoRmulaICE</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {gfoRmulaICE}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#compData'><p>Example Dataset for a Survival Outcome with Both Censoring and Competing Event</p></a></li>
<li><a href='#dynamic'><p>Dynamic</p></a></li>
<li><a href='#grace_period'><p>Strategy with Grace Period</p></a></li>
<li><a href='#ice'><p>Iterative Conditional Expectation Estimator</p></a></li>
<li><a href='#natural_course'><p>Natural Course</p></a></li>
<li><a href='#plot.ICE'><p>Plot method for ICE estimator objects</p></a></li>
<li><a href='#pool'><p>Indicator for the pooling over treatment history ICE estimator</p></a></li>
<li><a href='#static'><p>Static</p></a></li>
<li><a href='#strat'><p>Indicator for the stratifying on treatment history ICE estimator</p></a></li>
<li><a href='#summary.ICE'><p>Summary method for ICE Estimator Objects</p></a></li>
<li><a href='#threshold'><p>Threshold</p></a></li>
<li><a href='#weight'><p>Indicator for the doubly robust ICE estimator</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Parametric Iterative Conditional Expectation G-Formula</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Implements iterative conditional expectation (ICE) estimators of the plug-in g-formula (Wen, Young, Robins, and Hernán (2020) &lt;<a href="https://doi.org/10.1111%2Fbiom.13321">doi:10.1111/biom.13321</a>&gt;). 
    Both singly robust and doubly robust ICE estimators based on parametric models are available. 
    The package can be used to estimate survival curves under sustained treatment strategies (interventions) using longitudinal data with time-varying treatments, time-varying confounders, censoring, and competing events.
    The interventions can be static or dynamic, and deterministic or stochastic (including threshold interventions). Both prespecified and user-defined interventions are available.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>data.table, ggplot2, nnet, doParallel, parallel, foreach,
stringr, magrittr, dplyr, rlang, reshape2, speedglm, methods,
Hmisc, splines</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-12-01 17:39:16 UTC; carriecheng</td>
</tr>
<tr>
<td>Author:</td>
<td>Zhaoxi Cheng [aut, cre],
  Jing Li [aut],
  Sophia Rein [aut],
  Ryan O'Dea [aut],
  Sean McGrath [aut],
  Lan Wen [aut],
  Miguel A. Hernán [aut],
  2024 The President and Fellows of Harvard College [cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Zhaoxi Cheng &lt;zcheng@hsph.harvard.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-12-02 12:50:08 UTC</td>
</tr>
</table>
<hr>
<h2 id='compData'>Example Dataset for a Survival Outcome with Both Censoring and Competing Event</h2><span id='topic+compData'></span>

<h3>Description</h3>

<p>A dataset with 26581 observations on 10000 individuals and 4 time points. The dataset is in long format with each row representing the record of one individual at one time point.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compData
</code></pre>


<h3>Format</h3>

<p>A data frame with 26581 rows and 9 variables:
</p>

<dl>
<dt>t0</dt><dd><p>Time index.</p>
</dd>
<dt>id</dt><dd><p>Unique identifier for each individual.</p>
</dd>
<dt>L1</dt><dd><p>Binary covariate.</p>
</dd>
<dt>L2</dt><dd><p>Continuous covariate.</p>
</dd>
<dt>A1</dt><dd><p>Categorical treatment variable with levels 1, 2, and 3.</p>
</dd>
<dt>A2</dt><dd><p>Binary treatment variable.</p>
</dd>
<dt>C</dt><dd><p>Censoring event indicator.</p>
</dd>
<dt>D</dt><dd><p>Competing event indicator.</p>
</dd>
<dt>Y</dt><dd><p>Outcome indicator.</p>
</dd>
</dl>


<hr>
<h2 id='dynamic'>Dynamic</h2><span id='topic+dynamic'></span>

<h3>Description</h3>

<p>This function specifies a dynamic intervention on the treatment variable specified in <code>data</code>. 
This function follows the treatment strategy specified in <code>strategy_before</code> until a user-defined condition that depends on covariate values is met. Upon the condition is met, the strategy specified in <code>strategy_after</code> is followed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dynamic(
  condition,
  strategy_before,
  strategy_after,
  absorb = FALSE,
  id,
  time,
  data
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dynamic_+3A_condition">condition</code></td>
<td>
<p>a string that specifies a logical expression, upon which is met, the strategy specified in <code>strategy_after</code> is followed.</p>
</td></tr>
<tr><td><code id="dynamic_+3A_strategy_before">strategy_before</code></td>
<td>
<p>a function or vector of intervened values that specifies the strategy followed after <code>condition</code> is met. 
The vector of intervened values should be the same length as the number of rows in the data frame <code>data</code>.</p>
</td></tr>
<tr><td><code id="dynamic_+3A_strategy_after">strategy_after</code></td>
<td>
<p>a function or vector of intervened values that specifies the strategy followed before <code>condition</code> is met.
The vector of intervened values should be the same length as the number of rows in the data frame <code>data</code>.</p>
</td></tr>
<tr><td><code id="dynamic_+3A_absorb">absorb</code></td>
<td>
<p>a logical value indicating whether the strategy specified in <code>strategy_after</code> becomes absorbing (always treat with the specified strategy) upon the first time when <code>condition</code> is met.</p>
</td></tr>
<tr><td><code id="dynamic_+3A_id">id</code></td>
<td>
<p>a string specifying the ID variable name in <code>data</code>.</p>
</td></tr>
<tr><td><code id="dynamic_+3A_time">time</code></td>
<td>
<p>a string specifying the time variable name in <code>data</code>.</p>
</td></tr>
<tr><td><code id="dynamic_+3A_data">data</code></td>
<td>
<p>a data frame containing the observed data.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a vector containing the intervened value of the same size as the number of rows in <code>data</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data &lt;- gfoRmulaICE::compData
# Dynamic intervention example 1: 
# treat when L1 = 0, and not treat otherwise.
dynamic1 &lt;- dynamic(
condition = "L1 == 0", 
strategy_before = static(0, data), 
strategy_after = static(1, data), 
absorb = FALSE, 
id = "id", 
time = "t0", 
data = data
)

# Dynamic intervention example 2: 
# never treat upon until L1 = 0, after which follows always treat.
dynamic2 &lt;- dynamic(
condition = "L1 == 0", 
strategy_before = static(0, data), 
strategy_after = static(1, data), 
absorb = TRUE, 
id = "id", 
time = "t0", 
data = data
)

# Dynamic intervention example 3: 
# never treat upon until L1 = 0, after which follows natural course.
dynamic3 &lt;- dynamic(
condition = "L1 == 0", 
strategy_before = static(0, data), 
strategy_after = natural_course(data, "A1"), 
absorb = FALSE, 
id = "id", 
time = "t0", 
data = data
)
</code></pre>

<hr>
<h2 id='grace_period'>Strategy with Grace Period</h2><span id='topic+grace_period'></span>

<h3>Description</h3>

<p>This function specifies an intervention in which treatment is initiated within the grace period of <code>nperiod</code> time units. 
During the grace period, the treatment variable follows its natural value or initiate intervention with a uniform distribution at each time point.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>grace_period(type, nperiod, condition, data, id, time_name, outcome_name)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="grace_period_+3A_type">type</code></td>
<td>
<p>a string specifying the type of grace period strategy. Possible values are &quot;uniform&quot; and &quot;natural&quot;.</p>
</td></tr>
<tr><td><code id="grace_period_+3A_nperiod">nperiod</code></td>
<td>
<p>a number indicating the length of grace period.</p>
</td></tr>
<tr><td><code id="grace_period_+3A_condition">condition</code></td>
<td>
<p>a string specifying the logical expression, upon which is met, the treatment is initiated within <code>nperiod</code> time units.</p>
</td></tr>
<tr><td><code id="grace_period_+3A_data">data</code></td>
<td>
<p>a data frame containing the observed data.</p>
</td></tr>
<tr><td><code id="grace_period_+3A_id">id</code></td>
<td>
<p>a string specifying the ID variable name in <code>data</code>.</p>
</td></tr>
<tr><td><code id="grace_period_+3A_time_name">time_name</code></td>
<td>
<p>a string specifying the time variable name in <code>data</code>.</p>
</td></tr>
<tr><td><code id="grace_period_+3A_outcome_name">outcome_name</code></td>
<td>
<p>a string specifying the outcome variable name in <code>data</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a vector containing the intervened value of the same size as the number of rows in <code>data</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data &lt;- gfoRmulaICE::compData
grace_period &lt;- grace_period(type = "uniform", nperiod = 2, condition = "L1 == 0", 
                            data = data, id = "id", time_name = "t0", outcome_name = "Y")
</code></pre>

<hr>
<h2 id='ice'>Iterative Conditional Expectation Estimator</h2><span id='topic+ice'></span>

<h3>Description</h3>

<p>This function implements iterative conditional expectation (ICE) estimators under user-defined treatment strategies.
Available ICE estimators are classical and hazard-based pooling over treatment history ICE, 
classical and hazard-based stratifying on treatment history ICE, and doubly robust ICE estimators. 
See Wen et al. (2021) for more details regarding the parametric g-formula iterative conditional expectation estimator.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ice(
  data,
  time_points,
  id,
  time_name,
  outcome_name,
  censor_name = NULL,
  compevent_name = NULL,
  comp_effect = 0,
  outcome_model,
  censor_model = NULL,
  competing_model = NULL,
  hazard_model = NULL,
  global_hazard = FALSE,
  ref_idx = 0,
  estimator,
  int_descript,
  ci_method = "percentile",
  nsamples = 0,
  seed = 1,
  coverage = 95,
  parallel = FALSE,
  ncores = 2,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ice_+3A_data">data</code></td>
<td>
<p>a data frame containing the observed data in long format.</p>
</td></tr>
<tr><td><code id="ice_+3A_time_points">time_points</code></td>
<td>
<p>a number indicating the total number of time points.</p>
</td></tr>
<tr><td><code id="ice_+3A_id">id</code></td>
<td>
<p>a string indicating the ID variable name in <code>data</code>.</p>
</td></tr>
<tr><td><code id="ice_+3A_time_name">time_name</code></td>
<td>
<p>a string specifying the time variable name in <code>data</code>.</p>
</td></tr>
<tr><td><code id="ice_+3A_outcome_name">outcome_name</code></td>
<td>
<p>a string specifying the outcome variable name in <code>data</code>.</p>
</td></tr>
<tr><td><code id="ice_+3A_censor_name">censor_name</code></td>
<td>
<p>a string specifying the censor variable name in <code>data</code>. Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="ice_+3A_compevent_name">compevent_name</code></td>
<td>
<p>a string specifying the competing variable name in <code>data</code>. Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="ice_+3A_comp_effect">comp_effect</code></td>
<td>
<p>a number indicating how the competing event is handled for all the specified interventions. Default is 0.
0 for controlled direct effect. 1 for total effect.</p>
</td></tr>
<tr><td><code id="ice_+3A_outcome_model">outcome_model</code></td>
<td>
<p>a formula specifying the model statement for the outcome.</p>
</td></tr>
<tr><td><code id="ice_+3A_censor_model">censor_model</code></td>
<td>
<p>a formula specifying the model statement for the censoring event. Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="ice_+3A_competing_model">competing_model</code></td>
<td>
<p>a formula specifying the model statement for the competing event. Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="ice_+3A_hazard_model">hazard_model</code></td>
<td>
<p>a formula specifying the model statement for the hazard, if hazard-based estimator is used. Default is <code>NULL</code>. 
If specified, the model in <code>hazard_model</code> will be used. If NULL, the model in <code>outcome_model</code> will be used.</p>
</td></tr>
<tr><td><code id="ice_+3A_global_hazard">global_hazard</code></td>
<td>
<p>a logical value indicating whether to use global pooled-over-time hazard model or time-specific hazard models, for hazard-based pooled ICE only. 
If <code>TRUE</code>, use pooled-over-time hazard model. If <code>FALSE</code>, use time-specific hazard models. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="ice_+3A_ref_idx">ref_idx</code></td>
<td>
<p>a number indicating which intervention to be used as the reference to calculate the risk ratio and risk difference. Default is 0.
0 refers to the natural course as the reference intervention.
Any other numbers refer to the corresponding intervention that users specify in the keyword arguments.</p>
</td></tr>
<tr><td><code id="ice_+3A_estimator">estimator</code></td>
<td>
<p>a function specifying which ICE estimator to use for the estimation. Please see Details for all available specifications.</p>
</td></tr>
<tr><td><code id="ice_+3A_int_descript">int_descript</code></td>
<td>
<p>a vector of strings containing descriptions for each specified intervention.</p>
</td></tr>
<tr><td><code id="ice_+3A_ci_method">ci_method</code></td>
<td>
<p>a string specifying the method for calculating the confidence interval, if <code>nsamples</code> is larger than 0.
Possible values are &quot;percentile&quot; and &quot;normal.&quot; Default is &quot;percentile.&quot;</p>
</td></tr>
<tr><td><code id="ice_+3A_nsamples">nsamples</code></td>
<td>
<p>a number larger than 0 indicating the number of bootstrap samples. Default is 0.</p>
</td></tr>
<tr><td><code id="ice_+3A_seed">seed</code></td>
<td>
<p>a number indicating the starting seed for bootstrapping. Default is 1.</p>
</td></tr>
<tr><td><code id="ice_+3A_coverage">coverage</code></td>
<td>
<p>a number greater than 0 and less than 100 indicating the coverage of the confidence interval. Default is 95.</p>
</td></tr>
<tr><td><code id="ice_+3A_parallel">parallel</code></td>
<td>
<p>a logical value indicating whether to parallelize the bootstrap process. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="ice_+3A_ncores">ncores</code></td>
<td>
<p>a number indicating the number of CPU cores to use in parallel computing. Default is 2.</p>
</td></tr>
<tr><td><code id="ice_+3A_verbose">verbose</code></td>
<td>
<p>a logical specifying whether progress of the algorithm is printed. Default is TRUE.</p>
</td></tr>
<tr><td><code id="ice_+3A_...">...</code></td>
<td>
<p>keyword arguments to specify intervention inputs. If stratified ICE is used, keyword arguments also allow intervention-specific outcome models and competing models. 
<br /> 
To specify interventions, please follow the input convention below:
</p>

<ul>
<li><p>Each intervention is specified using the keyword argument name with <em>intervention</em> prefix.
</p>
</li>
<li><p>Use <em>i</em> after <em>intervention</em> prefix in keyword argument name to represent the ith strategy.
</p>
</li>
<li><p>Use <em>.</em> followed with <em>treatment variable name</em> after <em>interventioni</em> in keyword argument name to represent the treatment name within the ith strategy.</p>
</li></ul>

<p>Each input of intervention keyword arguments is a list consisting of a vector of intervened values and an optional vector of time points on which the intervention is applied. 
If the intervention time points are not specified, the intervention is applied to all time points. For example, 
an input considers a simultaneous intervention with always treat on A1 and never treat on A2 at all time points looks like: <br /> 
<br />
<code>intervention1.A1 = list(static(1))</code> <br />
<code>intervention1.A2 = list(static(0))</code> <br /> <br />
The above intervention applies to all time points. The following is an example of custom intervention time points, 
with always treat on A1 at time point 1 and 2 and never treat on A2 at time point 3 to 5. <br /> 
<br />
<code>intervention1.A1 = list(static(1), 1:2)</code> <br />
<code>intervention1.A2 = list(static(0), 3:5)</code> <br />
<br /> If there is no intervention keyword argument specified, the function returns the natural course risk only. Please see the &quot;Examples&quot; section for more examples.
</p>
<p>To specify different outcome model and/or competing model for different intervention, please follow the input convention below:
</p>

<ul>
<li><p>Each outcome model is specified using keyword argument name starting with <em>outcomeModel</em> or <em>compModel</em> prefix for outcome model or competing model correspondingly.
</p>
</li>
<li><p>Use <em>.n</em> after <em>outcomeModel</em> or <em>compModel</em> prefix in keyword argument name to specify which intervention being applied to,
where <em>n</em> represents the <em>n</em>th intervention.</p>
</li></ul>

<p>The input to each outcome or competing model keyword argument is a model statement formula. 
If no outcome model and competing model keyword argument is specified, the models specified in <code>outcome_model</code> and <code>comp_model</code> are used.
Please refer to the &quot;Examples&quot; section for more examples.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Users could specify which version ICE estimator to use through <code>estimator</code>.
</p>

<ul>
<li><p><code>pool(hazard = FALSE)</code> specifies the classical pooling over treatment history ICE estimator. 
</p>
</li>
<li><p><code>pool(hazard = TRUE)</code> specifies the hazard-based pooling over treatment history ICE estimator. 
</p>
</li>
<li><p><code>strat(hazard = FALSE)</code> specifies the classical stratifying on treatment history ICE estimator. 
</p>
</li>
<li><p><code>strat(hazard = TRUE)</code> specifies the hazard-based stratifying on treatment history ICE estimator. 
</p>
</li>
<li><p><code>weight(treat_model)</code> specifies the doubly robust weighted ICE estimator
where <code>treat_model</code> specifies the treatment model.
</p>
</li></ul>

<p>To provide flexible choices on model inputs for stratified ICE and doubly robust ICE, we allow users to specify intervention-specific model statements through keyword arguments. 
In the case where intervention-specific model statements are specified, 
treatment variables that are not intervened under some strategies will be considered as a covariate and automatically added into the model specification at each time point.
Please see more details on how to specify intervention-specific model specifications in the &quot;Arguments&quot; section.
</p>
<p>For example, the following input specifies <code>Y ~ L1</code> as outcome model for intervention 1,
<code>D ~ L1</code> as competing model for intervention 2,
<code>D ~ L1 + L2</code> as competing model for intervention 1,
<code>Y ~ L1 + L2</code> as outcome model for intervention 2.
</p>
<p><code>fit_hazard_strat &lt;- ice(data = data, K = 4, id = "id", time_name = "t0", </code> <br />
<code>outcome_name = "Y", censor_name = "C", competing_name = "D", </code> <br />
<code>estimator = strat(hazard = TRUE), comp_effect = 1, </code> <br />
<code>censor_model = C ~ L1 + L2, ref_idx = 0,</code> <br />
<code>int_descript = c("Static Intervention", "Dynamic Intervention"),</code> <br />
<code>outcome_model = Y ~ L1 + L2,</code> <br />
<code>competing_model = D ~ L1 + L2,</code> <br />
<code>intervention1.A1 = list(static(0)),</code> <br />
<code>intervention1.A2 = list(static(1)),</code> <br />
<code>intervention2.A1 = list(dynamic("L1 &gt; 0", static(0), static(1), absorb = FALSE)),</code> <br />
<code>intervention2.A2 = list(dynamic("L2 == 0", static(0), static(1), absorb = TRUE)),</code> <br />
<code>outcomeModel.1 = Y ~ L1,</code> <br />
<code>compModel.2 = D ~ L1</code> <br />
</p>
<p>Because the keyword argument for outcome model is not specified for intervention 2, the outcome model for intervention 2 is
<code>Y ~ L1 + L2</code> as specified in <code>outcome_model</code>.
Similarly, because the keyword argument for competing model is not specified for intervention 1, the competing model for intervention 1 is
<code>D ~ L1 + L2</code> as specified in <code>competing_model</code>.
In the case of controlled direct effect, the keyword arguments for competing models are ignored. Please see more examples in the &quot;Examples&quot; section.
</p>
<p>Both built-in interventions and user-defined interventions are available. 
</p>
<p>The following are the built-in intervention functions in the package:
</p>

<ul>
<li><p> Static Intervention: <code>static(value)</code> specifies a constant intervention with <code>value</code>.
</p>
</li>
<li><p> Dynamic Intervention: <code>dynamic(condition, strategy_before, strategy_after, absorb)</code> specifies a dynamic intervention where the strategy in <code>strategy_before</code> is followed until <code>condition</code> is met. Upon <code>condition</code> is met, the strategy in <code>strategy_after</code> is followed. If absorb is <code>TRUE</code>, the intervention becomes absorbing (always treat with the specified strategy) once <code>condition</code> is met.
</p>
</li>
<li><p> Threshold Intervention: <code>threshold(lower_bound, upper_bound)</code> specifies a threshold intervention. If the treatment value is between <code>lower_bound</code> and <code>upper_bound</code> inclusively, follow the natural value of the treatment. Otherwise, set to <code>lower_bound</code> or <code>upper_bound</code>, if the treatment value is below <code>lower_bound</code> or above <code>upper_bound</code>, correspondingly.
</p>
</li>
<li><p> Grace Period: <code>grace_period(type, nperiod, condition)</code> specifies a dynamic intervention with grace period. Once <code>condition</code> is met, the intervention is initiated within <code>nperiod</code> time units. During the grace period, the treatment variable follows its natural value or initiate intervention with a uniform distribution at each time point.</p>
</li></ul>

<p>The following is the user-defined intervention:
</p>

<ul>
<li><p> User-defined Interventions: The output of the user-defined intervention should contain the intervened value for each individual at each time point, and should be of the same size as the number of rows in <code>data</code>.</p>
</li></ul>

<p>Please see examples in the &quot;Examples&quot; section.
</p>
<p>In order to obtain an inverse probability (IP) weighted natural course risk based on the observed data, users must specify
a censoring variable through <code>censor_name</code> and a corresponding censoring model through <code>censor_model</code>. Please see
Chiu et al. (2023) for more details regarding the IP weighted estimate of the natural course risk.
</p>
<p>If competing event exists in the data, users need to specify the name of the competing variable through <code>competing_name</code> and
the model specification through <code>competing_model</code> for hazard-based ICE estimator. Users need to specify whether to treat
the competing event as censoring or total effect through <code>total_effect</code>.
</p>
<p>We provide flexible term options in model specification for the outcome, censoring, competing, and hazard model. 
Users could specify polynomial terms using functions <code>I</code> and <code>poly</code> and spline terms using <code>ns</code> from splines package
and <code>rcspline.eval</code> from Hmisc package. In addition, users could specify lagged terms using the format lag<code>n</code>_<code>var</code> 
to indicate lagging the variable <em>var</em> with <em>n</em> periods. 
If the lagged variable is a treatment variable, this variable is automatically intervened based on user-defined intervention.
The polynomial and spline terms could be used on lagged variables.
</p>


<h3>Value</h3>

<p>A list containing the following components. Each component that contains the fitted models includes the model fits, the summary of the fitted model, 
standard errors of the coefficients, variance-covariance matrices of the parameters, and the root mean square error (RMSE) values.
</p>
<table role = "presentation">
<tr><td><code>estimator.type</code></td>
<td>
<p>A string describing the type of the estimator.</p>
</td></tr>
<tr><td><code>summary</code></td>
<td>
<p>A summary table containing the estimated risk, risk ratio, and risk difference for user-defined interventions including estimated natural course risk and the observed risk.
If <code>nsamples</code> is greater than 0, the summary table includes standard error and confidence interval for the point estimates.</p>
</td></tr>
<tr><td><code>risk.over.time</code></td>
<td>
<p>A data frame containing the estimated risk at each time point for each intervention.</p>
</td></tr>
<tr><td><code>initial.outcome</code></td>
<td>
<p>A list, where the name of each sublist corresponds to each specified intervention description, and each sublist contains the fitted models for the outcome model in the first step of algorithm.</p>
</td></tr>
<tr><td><code>initial.comp</code></td>
<td>
<p>A list, where the name of each sublist corresponds to each specified intervention description, and each sublist contains the fitted models for the competing model in the first step of algorithm (if applicable).</p>
</td></tr>
<tr><td><code>np.risk.model</code></td>
<td>
<p>A list containing the fitted models for the censoring and/or competing model in estimating observed risk (if applicable).</p>
</td></tr>
<tr><td><code>outcome.models.by.step</code></td>
<td>
<p>A list, where the name of each sublist corresponds to each specified intervention description, and each sublist contains the fitted models for the outcome model in each iteration of algorithm.</p>
</td></tr>
<tr><td><code>comp.models.by.step</code></td>
<td>
<p>A list, where the name of each sublist corresponds to each specified intervention description, and each sublist contains the fitted models for the competing model in each iteration of algorithm (if applicable).</p>
</td></tr>
<tr><td><code>hazard.models.by.step</code></td>
<td>
<p>A list, where the name of each sublist corresponds to each specified intervention description, and each sublist contains the fitted models for the hazard model (if applicable), either time-specific models at all time points or one pooled-over-time global model.</p>
</td></tr> 
<tr><td><code>boot.data</code></td>
<td>
<p>A list of bootstrap samples. If <code>nsamples</code> is set to 0, a <code>NULL</code> value is returned.</p>
</td></tr>
<tr><td><code>boot.initial.outcome</code></td>
<td>
<p>A list, where the name of each sublist corresponds to each specified intervention description, and each sublist contains the fitted models for the outcome model in the first step of algorithm on the bootstrap samples.
If <code>nsamples</code> is set to 0, a <code>NULL</code> value is returned.</p>
</td></tr>
<tr><td><code>boot.initial.comp</code></td>
<td>
<p>A list, where the name of each sublist corresponds to each specified intervention description, and each sublist contains the fitted models for the competing model in the first step of algorithm on the bootstrap samples (if applicable).
If <code>nsamples</code> is set to 0, a <code>NULL</code> value is returned.</p>
</td></tr>
<tr><td><code>boot.np.risk.model</code></td>
<td>
<p>A list containing the fitted models for the censoring and/or competing model in estimating observed risk on the bootstrap samples (if applicable).
If <code>nsamples</code> is set to 0, a <code>NULL</code> value is returned.</p>
</td></tr>
<tr><td><code>boot.outcome.models.by.step</code></td>
<td>
<p>A list, where the name of each sublist corresponds to each specified intervention description, and each sublist contains the fitted models for the outcome model in each iteration of algorithm on the bootstrap samples (if applicable).
If <code>nsamples</code> is set to 0, a <code>NULL</code> value is returned.</p>
</td></tr>
<tr><td><code>boot.comp.models.by.step</code></td>
<td>
<p>A list, where the name of each sublist corresponds to each specified intervention description, and each sublist contains the fitted models for the competing model in each iteration of algorithm on the bootstrap samples (if applicable).
If <code>nsamples</code> is set to 0, a <code>NULL</code> value is returned.</p>
</td></tr>
<tr><td><code>boot.hazard.models.by.step</code></td>
<td>
<p>A list, where the name of each sublist corresponds to each specified intervention description, and each sublist contains the fitted models for the hazard model (if applicable), either time-specific models at all time points or one pooled-over-time global model, on the bootstrap samples.
If <code>nsamples</code> is set to 0, a <code>NULL</code> value is returned.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Wen L, Young JG, Robins JM, Hernán MA. Parametric g-formula implementations for causal survival analyses. Biometrics. 2021;77(2):740-753.
</p>
<p>McGrath S, Lin V, Zhang Z, Petito LC, Logan RW, Hernán MA, and JG Young. gfoRmula: An R package for estimating the effects of sustained treatment strategies via the parametric g-formula. Patterns. 2020;1:100008.
</p>
<p>Young JG, Herńan MA, Robins JM. Identification, estimation and approximation of risk under interventions that depend on the natural value of treatment using observational data. Epidemiologic Methods. 2014;3(1):1-19.
</p>
<p>Young JG, Vatsa R, Murray EJ, Hernán MA. Interval-cohort designs and bias in the estimation of per-protocol effects: a simulation study. Trials. 2019;20(1):552.
</p>
<p>Díaz, I, Williams, N, Hoffman, KL, &amp; Schenck, EJ. Nonparametric causal effects based on longitudinal modified treatment policies. Journal of the American Statistical Association. 2021;118(542), 846–857.
</p>
<p>Young JG, Stensrud MJ, Tchetgen Tchetgen EJ, Hernán MA. A causal framework for classical statistical estimands in failure-time settings with competing events. Statistics in medicine. 2020;39(8):1199-1236.
</p>
<p>Wen L, Hernán MA, Robins JM. Multiply robust estimators of causal effects for survival outcomes. Scandinavian journal of statistics, theory and applications. 2022;49(3):1304-1328.
</p>
<p>Haneuse S, Rotnitzky A. Estimation of the effect of interventions that modify the received treatment. Statistics in medicine. 2013;32(30):5260-5277.
</p>
<p>McGrath S, Young JG, Hernán MA. Revisiting the g-null Paradox. Epidemiology. 2022;33(1):114-120.
</p>
<p>Chiu YH, Wen L, McGrath S, Logan R, Dahabreh IJ, Hernán MA. Evaluating model specification when using the parametric g-formula in the presence of censoring. American Journal of Epidemiology. 2023;192:1887–1895.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data &lt;- gfoRmulaICE::compData

# Example: Built-in and User-defined Interventions

# We consider the following interventions. 
# We intervene at all time points.
# Intervention 1 on A1: always treat with value 3.
# Intervention 2 on L2: when the natural value of L2 at time t is lower than -3, 
# set its value to -3. Otherwise, do not intervene.
# Intervention 3 on A2: dynamic intervention (treat when L1 = 0) 
# with uniform grace period of 2 periods
# Intervention 4 on A2: at time t, if L1 = 0, then treat; otherwise, not treat.


# We use classical pooled ICE estimator, 
# natural course as the reference intervention, 
# and the following models:
# a. outcome model: Y ~ L1 + L2 + A1 + A2
# b. censor model: C ~ L1 + L2 + A1 + A2.

ice_fit &lt;- ice(
data = data, 
time_points = 4, 
id = "id", 
time_name = "t0",
censor_name = "C", 
outcome_name = "Y",
compevent_name = "D",
comp_effect = 0,
outcome_model = Y ~ L1 + L2 + A1 + A2, 
censor_model = C ~ L1 + L2 + A1 + A2,
ref_idx = 0,
estimator = pool(hazard = FALSE),
int_descript = c("Static Intervention", "Threshold Intervention", 
"Dynamic Intervention with Grace Period", "Dynamic Intervention"),
intervention1.A1 = list(static(3)),
intervention2.L2 = list(threshold(-3, Inf)),
intervention3.A2 = list(grace_period("uniform", 2, "L1 == 0")),
intervention4.A2 = list(dynamic("L1 == 0", static(0), static(1)))
)

summary(ice_fit)

plot(ice_fit)



</code></pre>

<hr>
<h2 id='natural_course'>Natural Course</h2><span id='topic+natural_course'></span>

<h3>Description</h3>

<p>This function specifies the natural course intervention on the treatment variable in <code>data</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>natural_course(data, treat_var)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="natural_course_+3A_data">data</code></td>
<td>
<p>a data frame containing the observed data.</p>
</td></tr>
<tr><td><code id="natural_course_+3A_treat_var">treat_var</code></td>
<td>
<p>a string specifying the treatment variable in <code>data</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a vector containing the intervened values of the same size as the number of rows in <code>data</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data &lt;- gfoRmulaICE::compData
natural_course &lt;- natural_course(data = data, treat_var = "A1")

</code></pre>

<hr>
<h2 id='plot.ICE'>Plot method for ICE estimator objects</h2><span id='topic+plot.ICE'></span>

<h3>Description</h3>

<p>This function provides visualization of estimated risk 
for all specified interventions, estimated natural course risk, and observed risk at each time point.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ICE'
plot(..., plot_obs = TRUE, label = 0)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.ICE_+3A_...">...</code></td>
<td>
<p>ICE estimator objects.</p>
</td></tr>
<tr><td><code id="plot.ICE_+3A_plot_obs">plot_obs</code></td>
<td>
<p>a logical value indicating whether to plot the observed risk over time.
Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot.ICE_+3A_label">label</code></td>
<td>
<p>a number specifying which time label is used in x-axis. 0 represents using generic numerical time index, and
1 represents using the original time label from the data. Default is 0.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a plot for risks of all the interventions specified in <code>...</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data &lt;- gfoRmulaICE::compData

ice_fit1 &lt;- ice(
data = data, 
time_points = 4, 
id = "id", 
time_name = "t0",
censor_name = "C", 
outcome_name = "Y",
compevent_name = "D",
comp_effect = 0,
outcome_model = Y ~ L1 + L2 + A1 + A2, 
censor_model = C ~ L1 + L2 + A1 + A2,
ref_idx = 0,
estimator = pool(hazard = FALSE),
int_descript = "Static Intervention",
intervention1.A1 = list(static(3)),
intervention1.A2 = list(static(1))
)

ice_fit2 &lt;- ice(
data = data, 
time_points = 4, 
id = "id", 
time_name = "t0",
censor_name = "C", 
outcome_name = "Y",
compevent_name = "D",
comp_effect = 0,
outcome_model = Y ~ L1 + L2 + A1 + A2, 
censor_model = C ~ L1 + L2 + A1 + A2,
competing_model = D ~ L1 + L2 + A1 + A2,
ref_idx = 0,
estimator = pool(hazard = TRUE),
int_descript = "Static Intervention",
intervention1.A1 = list(static(3)),
intervention1.A2 = list(static(1))
)

plot(ice_fit1, ice_fit2)

</code></pre>

<hr>
<h2 id='pool'>Indicator for the pooling over treatment history ICE estimator</h2><span id='topic+pool'></span>

<h3>Description</h3>

<p>This function identifies the pooling over treatment history ICE estimator. The classical pooling over
treatment history ICE estimator is specified by <code>pool(hazard = FALSE)</code>. The hazard based pooling over treatment
history ICE estimator is specified by <code>pool(hazard = TRUE)</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pool(hazard)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pool_+3A_hazard">hazard</code></td>
<td>
<p>a logical value indicating whether to use hazard-based ICE estimator.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a logical value on whether to use hazard-based ICE estimator.
</p>

<hr>
<h2 id='static'>Static</h2><span id='topic+static'></span>

<h3>Description</h3>

<p>This function specifies the static intervention, either treat with a constant value or never treat, 
on the treatment variable in <code>data</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>static(value, data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="static_+3A_value">value</code></td>
<td>
<p>a number specifying the intervention value. 0 for never treat.</p>
</td></tr>
<tr><td><code id="static_+3A_data">data</code></td>
<td>
<p>a data frame containing the observed data.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a vector containing the intervened values of the same size as the number of rows in <code>data</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data &lt;- gfoRmulaICE::compData
always_treat &lt;- static(value = 1, data = data)
</code></pre>

<hr>
<h2 id='strat'>Indicator for the stratifying on treatment history ICE estimator</h2><span id='topic+strat'></span>

<h3>Description</h3>

<p>This function identifies the stratifying on treatment history ICE estimator. The classical stratifying on 
treatment history ICE estimator is specified by <code>strat(hazard = FALSE)</code>. The hazard based stratifying on treatment
history ICE estimator is specified by <code>strat(hazard = TRUE)</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>strat(hazard)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="strat_+3A_hazard">hazard</code></td>
<td>
<p>a logical value indicating whether to use hazard-based ICE estimator.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a logical value on whether to use hazard-based ICE estimator.
</p>

<hr>
<h2 id='summary.ICE'>Summary method for ICE Estimator Objects</h2><span id='topic+summary.ICE'></span>

<h3>Description</h3>

<p>This function returns a summary table for ICE estimator objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ICE'
summary(...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.ICE_+3A_...">...</code></td>
<td>
<p>the ICE estimator objects.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a data frame containing the summary table for all specified ICE estimator objects.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
data &lt;- gfoRmulaICE::compData

fit_classical_pool &lt;- ice(
data = data, 
time_points = 4, 
id = "id", 
time_name = "t0",
censor_name = "C", 
outcome_name = "Y",
compevent_name = "D",
comp_effect = 0,
outcome_model = Y ~ L1 + L2 + A1 + A2, 
censor_model = C ~ L1 + L2 + A1 + A2,
ref_idx = 0,
estimator = pool(hazard = FALSE),
int_descript = c("Static Intervention"),
intervention1.A1 = list(static(3)),
intervention1.A2 = list(static(1))
)

fit_hazard_pool &lt;- ice(
data = data, 
time_points = 4, 
id = "id", 
time_name = "t0",
censor_name = "C", 
outcome_name = "Y",
compevent_name = "D",
comp_effect = 0,
outcome_model = Y ~ L1 + L2 + A1 + A2, 
censor_model = C ~ L1 + L2 + A1 + A2,
competing_model = D ~ L1 + L2 + A1 + A2,
ref_idx = 0,
estimator = pool(hazard = TRUE),
int_descript = c("Static Intervention"),
intervention1.A1 = list(static(3)),
intervention1.A2 = list(static(1))
)

summary(fit_classical_pool, fit_hazard_pool)
</code></pre>

<hr>
<h2 id='threshold'>Threshold</h2><span id='topic+threshold'></span>

<h3>Description</h3>

<p>This function specifies the threshold intervention on the treatment variable in <code>data</code>.
If treatment value is between the lower bound and the upper bound, it follows the natural value of the treatment. 
If treatment value is either below the lower bound or above the upper bound, it is set to the lower bound or the upper bound, correspondingly.
See Young et al. (2014) for more details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>threshold(lower_bound, upper_bound, var, data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="threshold_+3A_lower_bound">lower_bound</code></td>
<td>
<p>a number indicating the lower bound of the threshold.</p>
</td></tr>
<tr><td><code id="threshold_+3A_upper_bound">upper_bound</code></td>
<td>
<p>a number indicating the upper bound of the threshold.</p>
</td></tr>
<tr><td><code id="threshold_+3A_var">var</code></td>
<td>
<p>a string specifying the treatment variable for the intervention.</p>
</td></tr>
<tr><td><code id="threshold_+3A_data">data</code></td>
<td>
<p>a data frame containing the observed data.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a vector containing the intervened values of the same size as the number of rows in <code>data</code>.
</p>


<h3>References</h3>

<p>Young JG, Herńan MA, Robins JM. Identification, estimation and approximation of risk under interventions that depend on the natural value of treatment using observational data. Epidemiologic Methods. 2014;3(1):1-19.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data &lt;- gfoRmulaICE::compData
threshold_treat &lt;- threshold(lower_bound = 0, upper_bound = 2, var = "A1", data = data)
</code></pre>

<hr>
<h2 id='weight'>Indicator for the doubly robust ICE estimator</h2><span id='topic+weight'></span>

<h3>Description</h3>

<p>This function identifies the doubly robust ICE estimator. The treatment models could be specified by
<code>treat_model</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>weight(treat_model = list())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="weight_+3A_treat_model">treat_model</code></td>
<td>
<p>a list of formulas specifying the treatment model for the corresponding treatment variable. The length of list must match
the number of treatment variables.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>treatment model specifications and treatment variable names.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
