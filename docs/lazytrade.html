<!DOCTYPE html><html><head><title>Help for package lazytrade</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {lazytrade}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#aml_collect_data'><p>Function to read, transform, aggregate and save data for further retraining</p>
of regression model for a single asset</a></li>
<li><a href='#aml_consolidate_results'><p>Function to consolidate model test results</p></a></li>
<li><a href='#aml_make_model'><p>Function to train Deep Learning regression model for a single asset</p></a></li>
<li><a href='#aml_score_data'><p>Function to score new data and predict change for each single currency pair</p></a></li>
<li><a href='#aml_simulation'><p>Function to simulate multiple input structures</p></a></li>
<li><a href='#aml_test_model'><p>Function to test the model and conditionally decide to update existing model for a single currency pair</p></a></li>
<li><a href='#check_if_optimize'><p>Function check_if_optimize.</p></a></li>
<li><a href='#create_labelled_data'><p>Create labelled data</p></a></li>
<li><a href='#create_transposed_data'><p>Create Transposed Data</p></a></li>
<li><a href='#data_trades'><p>Table with Trade results samples</p></a></li>
<li><a href='#decrypt_mykeys'><p>Function that decrypt encrypted content</p></a></li>
<li><a href='#DFR'><p>Table with predicted price change</p></a></li>
<li><a href='#dlog'><p>Create log difference distribution</p></a></li>
<li><a href='#encrypt_api_key'><p>Encrypt api keys</p></a></li>
<li><a href='#EURUSDM15X75'><p>Table with indicator and price change dataset</p></a></li>
<li><a href='#evaluate_macroeconomic_event'><p>Function used to evaluate market type situation by reading the file with Macroeconomic Events</p>
and writing a trigger to the trading robot</a></li>
<li><a href='#get_profit_factorDF'><p>Function that returns the profit factors of the systems in a form of a DataFrame</p></a></li>
<li><a href='#import_data'><p>Import Data file with Trade Logs to R.</p></a></li>
<li><a href='#indicator_dataset'><p>Table with indicator dataset</p></a></li>
<li><a href='#macd_100'><p>Table with indicator only used to train model, 128 col 1646 rows</p></a></li>
<li><a href='#macd_df'><p>Table with one column indicator dataset</p></a></li>
<li><a href='#macd_ML60M'><p>Table with indicator and market type category used to train model</p></a></li>
<li><a href='#mt_evaluate'><p>Function to score data and predict current market type using pre-trained classification model</p></a></li>
<li><a href='#mt_import_data'><p>Import Market Type related Data to R from the Sandbox</p></a></li>
<li><a href='#mt_make_model'><p>Function to train Deep Learning Classification model for Market Type recognition</p></a></li>
<li><a href='#mt_stat_evaluate'><p>Function to prepare and score data, finally predict current market type using pre-trained classification model</p></a></li>
<li><a href='#mt_stat_transf'><p>Perform Statistical transformation and clustering of Market Types on the price data</p></a></li>
<li><a href='#opt_aggregate_results'><p>Function to aggregate trading results from multiple folders and files</p></a></li>
<li><a href='#opt_create_graphs'><p>Function to create summary graphs of the trading results</p></a></li>
<li><a href='#policy_tr_systDF'><p>Table with Market Types and sample of actual policy for those states</p></a></li>
<li><a href='#price_dataset'><p>Table with price dataset</p></a></li>
<li><a href='#price_dataset_big'><p>Table with price dataset, 30000 rows</p></a></li>
<li><a href='#profit_factor_data'><p>Table with Trade results samples</p></a></li>
<li><a href='#profit_factorDF'><p>Table with Trade results samples</p></a></li>
<li><a href='#result_prev'><p>Table with one column as result from the model prediction</p></a></li>
<li><a href='#result_R'><p>Table with predicted price change</p></a></li>
<li><a href='#result_R1'><p>Table with aggregated trade results</p></a></li>
<li><a href='#rl_generate_policy'><p>Function performs Reinforcement Learning using the past data to generate model policy</p></a></li>
<li><a href='#rl_generate_policy_mt'><p>Function performs RL and generates model policy for each Market Type</p></a></li>
<li><a href='#rl_log_progress'><p>Function to retrieve and help to log Q values during RL progress.</p></a></li>
<li><a href='#rl_log_progress_mt'><p>Function to retrieve and help to log Q values during RL progress. This function is dedicated to the situations when</p>
Market Types are used as a 'states' for the Environment.</a></li>
<li><a href='#rl_record_policy'><p>Record Reinforcement Learning Policy.</p></a></li>
<li><a href='#rl_record_policy_mt'><p>Record Reinforcement Learning Policy for Market Types</p></a></li>
<li><a href='#rl_write_control_parameters'><p>Function to find and write the best control parameters.</p></a></li>
<li><a href='#rl_write_control_parameters_mt'><p>Function to find and write the best control parameters.</p></a></li>
<li><a href='#test_data_pattern'><p>Table with several columns containing indicator values and Label values</p></a></li>
<li><a href='#to_m'><p>Convert time series data to matrix with defined number of columns</p></a></li>
<li><a href='#TradeStatePolicy'><p>Table with Trade States and sample of actual policy for those states</p></a></li>
<li><a href='#trading_systemDF'><p>Table with trade data and joined market type info</p></a></li>
<li><a href='#util_find_pid'><p>R function to find PID of active applications</p></a></li>
<li><a href='#util_generate_password'><p>R function to generate random passwords for MT4 platform or other needs</p></a></li>
<li><a href='#util_profit_factor'><p>Calculate Profit Factor</p></a></li>
<li><a href='#write_command_via_csv'><p>Write csv files with indicated commands to the external system</p></a></li>
<li><a href='#write_ini_file'><p>Create initialization files to launch MT4 platform with specific configuration</p></a></li>
<li><a href='#x_test_model'><p>Table with a dataset to test the Model</p></a></li>
<li><a href='#y'><p>Table with indicators and price change which is used to train model</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Learn Computer and Data Science using Algorithmic Trading</td>
</tr>
<tr>
<td>Version:</td>
<td>0.5.3</td>
</tr>
<tr>
<td>Author:</td>
<td>Vladimir Zhbanko</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Vladimir Zhbanko &lt;vladimir.zhbanko@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Provide sets of functions and methods to learn and practice data science using idea of algorithmic trading.
    Main goal is to process information within "Decision Support System" to come up with analysis or predictions.
    There are several utilities such as dynamic and adaptive risk management using reinforcement learning
    and even functions to generate predictions of price changes using pattern recognition deep regression learning.
    Summary of Methods used: Awesome H2O tutorials: <a href="https://github.com/h2oai/awesome-h2o">https://github.com/h2oai/awesome-h2o</a>, 
    Market Type research of Van Tharp Institute: <a href="https://www.vantharp.com/">https://www.vantharp.com/</a>,
    Reinforcement Learning R package: <a href="https://CRAN.R-project.org/package=ReinforcementLearning">https://CRAN.R-project.org/package=ReinforcementLearning</a>.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://vladdsm.github.io/myblog_attempt/topics/lazy%20trading/">https://vladdsm.github.io/myblog_attempt/topics/lazy%20trading/</a>,
<a href="https://github.com/vzhomeexperiments/lazytrade">https://github.com/vzhomeexperiments/lazytrade</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/vzhomeexperiments/lazytrade/issues">https://github.com/vzhomeexperiments/lazytrade/issues</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.2</td>
</tr>
<tr>
<td>Imports:</td>
<td>readr, stringr, dplyr, tibble, lubridate, ggplot2, grDevices,
h2o, ReinforcementLearning, openssl, stats, cluster, lifecycle</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 2.1.0), covr, magrittr, data.table, bit64</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.6.0)</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-12-15 16:25:32 UTC; fxtrams</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-12-15 18:10:07 UTC</td>
</tr>
</table>
<hr>
<h2 id='aml_collect_data'>Function to read, transform, aggregate and save data for further retraining
of regression model for a single asset</h2><span id='topic+aml_collect_data'></span>

<h3>Description</h3>

<p>Function is collecting data from the csv files
Data objects are transformed to be suitable for Regression Modelling.
Price change will be in the column 'LABEL', column X1 will keep the time index
Result will be written to a new or aggregated to the existing '.rds' file
</p>
<p>Function is keeping generated dataset to be not larger than specified by the user
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>aml_collect_data(
  indicator_dataset,
  symbol,
  timeframe = 60,
  path_data,
  max_nrows = 2500
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="aml_collect_data_+3A_indicator_dataset">indicator_dataset</code></td>
<td>
<p>Dataset containing assets indicator which pattern will be used as predictor</p>
</td></tr>
<tr><td><code id="aml_collect_data_+3A_symbol">symbol</code></td>
<td>
<p>Character symbol of the asset for which to train the model</p>
</td></tr>
<tr><td><code id="aml_collect_data_+3A_timeframe">timeframe</code></td>
<td>
<p>Data timeframe e.g. 1 min</p>
</td></tr>
<tr><td><code id="aml_collect_data_+3A_path_data">path_data</code></td>
<td>
<p>Path where the aggregated historical data is stored, if exists in rds format</p>
</td></tr>
<tr><td><code id="aml_collect_data_+3A_max_nrows">max_nrows</code></td>
<td>
<p>Integer, Maximum number of rows to collect</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function is not handling shift of the price and indicator datasets.
</p>
<p>This function is relying on the data collection from the dedicated data robot
Other 'aml_*' functions will work based on the data processed by this function
</p>


<h3>Value</h3>

<p>Function is writing files into Decision Support System folder, mainly file object with the model
</p>


<h3>Author(s)</h3>

<p>(C) 2020, 2021 Vladimir Zhbanko
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# write examples for the function
library(dplyr)
library(readr)
library(lubridate)
library(lazytrade)
library(magrittr)

# sample dataset
ind = system.file("extdata", "AI_RSIADXUSDJPY60.csv",
                  package = "lazytrade") %&gt;% read_csv(col_names = FALSE)

# convert to POSIX format
ind$X1 &lt;- ymd_hms(ind$X1)

# create temporary path (check output of tempdir() to check the result)
path_data &lt;- normalizePath(tempdir(),winslash = "/")

# add tick data to the folder
tick = system.file("extdata", "TickSize_AI_RSIADX.csv",
                  package = "lazytrade") %&gt;% read_csv(col_names = FALSE)

write_csv(tick, file.path(path_data, "TickSize_AI_RSIADX.csv"), col_names = FALSE)


# data transformation using the custom function for one symbol
aml_collect_data(indicator_dataset = ind,
                 symbol = 'USDJPY',
                 timeframe = 60,
                 path_data = path_data)


</code></pre>

<hr>
<h2 id='aml_consolidate_results'>Function to consolidate model test results</h2><span id='topic+aml_consolidate_results'></span>

<h3>Description</h3>

<p>Function is designed to evaluate test results of multiple models.
This is done to select only group of models with the best performance. In addition,
function will provide facility to generate logs hence to allow tracking of long term model performance
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>aml_consolidate_results(
  timeframe = 15,
  used_symbols,
  path_model,
  path_sbxm,
  path_sbxs,
  min_quality = 0.75,
  get_quantile = FALSE,
  log_results = FALSE,
  path_logs = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="aml_consolidate_results_+3A_timeframe">timeframe</code></td>
<td>
<p>Integer, Data timeframe interval in minutes e.g. 60 min</p>
</td></tr>
<tr><td><code id="aml_consolidate_results_+3A_used_symbols">used_symbols</code></td>
<td>
<p>Vector, containing several financial instruments that were previously used
to test the model</p>
</td></tr>
<tr><td><code id="aml_consolidate_results_+3A_path_model">path_model</code></td>
<td>
<p>String, User path where the test results were stored</p>
</td></tr>
<tr><td><code id="aml_consolidate_results_+3A_path_sbxm">path_sbxm</code></td>
<td>
<p>String, User path to the sandbox where file with strategy test results should be written (master terminal)</p>
</td></tr>
<tr><td><code id="aml_consolidate_results_+3A_path_sbxs">path_sbxs</code></td>
<td>
<p>String, User path to the sandbox where file with strategy test results should be written (slave terminal)</p>
</td></tr>
<tr><td><code id="aml_consolidate_results_+3A_min_quality">min_quality</code></td>
<td>
<p>Double, value typically from 0.25 to 0.95 to select the min threshold value</p>
</td></tr>
<tr><td><code id="aml_consolidate_results_+3A_get_quantile">get_quantile</code></td>
<td>
<p>Bool, whether or not function should return an overall value of model performances
this will be used to conditionally update only less performant models</p>
</td></tr>
<tr><td><code id="aml_consolidate_results_+3A_log_results">log_results</code></td>
<td>
<p>Bool, option to write logs with cumulative results obtained for all models</p>
</td></tr>
<tr><td><code id="aml_consolidate_results_+3A_path_logs">path_logs</code></td>
<td>
<p>String, User path to the folder where to log results</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Provide a modular facility to aggregate and update files, write performance logs.
</p>


<h3>Value</h3>

<p>Function is writing files into Decision Support System folders
</p>


<h3>Author(s)</h3>

<p>(C) 2021 Vladimir Zhbanko
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

library(dplyr)
library(magrittr)
library(readr)
library(lazytrade)
library(stats)

testpath &lt;- normalizePath(tempdir(),winslash = "/")
path_model &lt;- file.path(testpath, "_Model")
path_sbxm &lt;- file.path(testpath, "_T1")
path_sbxs &lt;- file.path(testpath, "_T3")
path_logs &lt;- file.path(testpath, "_LOGS")
dir.create(path_model)
dir.create(path_sbxm)
dir.create(path_sbxs)
dir.create(path_logs)

file.copy(from = system.file("extdata", "StrTest-EURGBPM15.csv", package = "lazytrade"),
          to = file.path(path_model, "StrTest-EURGBPM15.csv"), overwrite = TRUE)

file.copy(from = system.file("extdata", "StrTest-EURJPYM15.csv", package = "lazytrade"),
          to = file.path(path_model, "StrTest-EURJPYM15.csv"), overwrite = TRUE)

file.copy(from = system.file("extdata", "StrTest-EURNZDM15.csv", package = "lazytrade"),
          to = file.path(path_model, "StrTest-EURNZDM15.csv"), overwrite = TRUE)

file.copy(from = system.file("extdata", "StrTest-EURUSDM15.csv", package = "lazytrade"),
          to = file.path(path_model, "StrTest-EURUSDM15.csv"), overwrite = TRUE)

Pairs &lt;- c("EURGBP","EURJPY","EURNZD","EURUSD")

aml_consolidate_results(timeframe = 15,
                        used_symbols = Pairs,
                        path_model = path_model,
                        path_sbxm = path_sbxm,
                        path_sbxs = path_sbxs,
                        min_quality = 0.75,
                        get_quantile = FALSE)


aml_consolidate_results(timeframe = 15,
                        used_symbols = Pairs,
                        path_model = path_model,
                        path_sbxm = path_sbxm,
                        path_sbxs = path_sbxs,
                        min_quality = 0.75,
                        get_quantile = TRUE)


aml_consolidate_results(timeframe = 15,
                        used_symbols = Pairs,
                        path_model = path_model,
                        path_sbxm = path_sbxm,
                        path_sbxs = path_sbxs,
                        min_quality = 0.75,
                        get_quantile = FALSE,
                        log_results = TRUE,
                        path_logs = path_logs)


</code></pre>

<hr>
<h2 id='aml_make_model'>Function to train Deep Learning regression model for a single asset</h2><span id='topic+aml_make_model'></span>

<h3>Description</h3>

<p>Function is training h2o deep learning model to match future
prices of the asset to the indicator pattern. Main idea is to be able
to predict future prices by solely relying on the recently retrieved
indicator pattern. This is to mimic traditional algorithmic systems
based on the indicator rule and to attempt automated optimization with AI.
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>aml_make_model(
  symbol,
  timeframe = 60,
  path_model,
  path_data,
  force_update = FALSE,
  objective_test = FALSE,
  num_nn_options = 12,
  fixed_nn_struct = c(100, 100),
  num_epoch = 100,
  num_bars_test = 600,
  num_bars_ahead = 34,
  num_cols_used = 16,
  min_perf = 0.3
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="aml_make_model_+3A_symbol">symbol</code></td>
<td>
<p>Character symbol of the asset for which to train the model</p>
</td></tr>
<tr><td><code id="aml_make_model_+3A_timeframe">timeframe</code></td>
<td>
<p>Integer, value in minutes, e.g. 60 min</p>
</td></tr>
<tr><td><code id="aml_make_model_+3A_path_model">path_model</code></td>
<td>
<p>Path where the models shall be stored</p>
</td></tr>
<tr><td><code id="aml_make_model_+3A_path_data">path_data</code></td>
<td>
<p>Path where the aggregated historical data is stored, if exists in rds format</p>
</td></tr>
<tr><td><code id="aml_make_model_+3A_force_update">force_update</code></td>
<td>
<p>Boolean, by setting this to TRUE function will generate new model
(useful after h2o engine update)</p>
</td></tr>
<tr><td><code id="aml_make_model_+3A_objective_test">objective_test</code></td>
<td>
<p>Boolean, option to use trading objective test as a parameter to validate best model,
defaults to FALSE</p>
</td></tr>
<tr><td><code id="aml_make_model_+3A_num_nn_options">num_nn_options</code></td>
<td>
<p>Integer, value from 0 to 24 or more. Used to change number of variants
of the random neural network structures, when value is 0 uses fixed structure
Higher number may lead to long code execution. Select value multiple of 3 otherwise
function will generate warning. E.g. 12, 24, 48, etc</p>
</td></tr>
<tr><td><code id="aml_make_model_+3A_fixed_nn_struct">fixed_nn_struct</code></td>
<td>
<p>Integer vector with numeric elements, see par hidden in ?h2o.deeplearning,
default value is c(100,100). Note this will only work if num_nn_options is 0</p>
</td></tr>
<tr><td><code id="aml_make_model_+3A_num_epoch">num_epoch</code></td>
<td>
<p>Integer, see parameter epochs in ?h2o.deeplearning, default value is 100
Higher number may lead to long code execution</p>
</td></tr>
<tr><td><code id="aml_make_model_+3A_num_bars_test">num_bars_test</code></td>
<td>
<p>Integer, value of bars used for model testing</p>
</td></tr>
<tr><td><code id="aml_make_model_+3A_num_bars_ahead">num_bars_ahead</code></td>
<td>
<p>Integer, value to specify how far should the function predict. Default 34 bars.</p>
</td></tr>
<tr><td><code id="aml_make_model_+3A_num_cols_used">num_cols_used</code></td>
<td>
<p>Integer, number of columns to use for training the model, defaults to 16</p>
</td></tr>
<tr><td><code id="aml_make_model_+3A_min_perf">min_perf</code></td>
<td>
<p>Double, value greater than 0. Used to set minimum value of model performance.
Higher value will increase computation time</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Deep learning model structure is obtained from several random
combinations of neurons within 3 hidden layers of the network.
The most accurate model configuration will be automatically selected
based either RMSE or Objective Test. In addition, the function will
check if there is a need to update the model. To do that function will check
results of the function aml_test_model.R.
</p>
<p>Function is using the dataset prepared by the function aml_collect_data.R.
Note that function will start to train the model as soon as there are more
than 1000 rows in the dataset
</p>


<h3>Value</h3>

<p>Function is writing a file object with the best Deep Learning Regression model
</p>


<h3>Author(s)</h3>

<p>(C) 2020, 2021 Vladimir Zhbanko
</p>


<h3>Examples</h3>

<pre><code class='language-R'>



library(dplyr)
library(readr)
library(h2o)
library(lazytrade)
library(lubridate)
library(magrittr)

path_model &lt;- normalizePath(tempdir(),winslash = "/")
path_data &lt;- normalizePath(tempdir(),winslash = "/")

ind = system.file("extdata", "AI_RSIADXUSDJPY60.csv",
                  package = "lazytrade") %&gt;% read_csv(col_names = FALSE)

ind$X1 &lt;- ymd_hms(ind$X1)

tick = system.file("extdata", "TickSize_AI_RSIADX.csv",
                  package = "lazytrade") %&gt;% read_csv(col_names = FALSE)

write_csv(tick, file.path(path_data, "TickSize_AI_RSIADX.csv"), col_names = FALSE)

# data transformation using the custom function for one symbol
aml_collect_data(indicator_dataset = ind,
                 symbol = 'USDJPY',
                 timeframe = 60,
                 path_data = path_data)

# dataset will be written to the temp directory

# start h2o engine
h2o.init(nthreads = 2)


# performing Deep Learning Regression using 2 random neural network structures and objective test
aml_make_model(symbol = 'USDJPY',
               timeframe = 60,
               path_model = path_model,
               path_data = path_data,
               force_update=FALSE,
               objective_test = TRUE,
               num_nn_options = 6,
               num_epoch = 10,
               min_perf = 0,
               num_bars_test = 600,
               num_bars_ahead = 34,
               num_cols_used = 16)

# performing DL Regression using 2 random neural network structures
# with objective test, all columns
aml_make_model(symbol = 'USDJPY',
               timeframe = 60,
               path_model = path_model,
               path_data = path_data,
               force_update=FALSE,
               objective_test = TRUE,
               num_nn_options = 6,
               num_epoch = 10,
               min_perf = 0,
               num_bars_test = 600,
               num_bars_ahead = 34,
               num_cols_used = 0)


# performing Deep Learning Regression using the custom function
aml_make_model(symbol = 'USDJPY',
               timeframe = 60,
               path_model = path_model,
               path_data = path_data,
               force_update=FALSE,
               objective_test = FALSE,
               num_nn_options = 6,
               num_epoch = 10,
               min_perf = 0,
               num_bars_test = 600,
               num_bars_ahead = 34,
               num_cols_used = 16)

# performing Deep Learning Regression, fixed mode
aml_make_model(symbol = 'USDJPY',
               timeframe = 60,
               path_model = path_model,
               path_data = path_data,
               force_update=TRUE,
               num_nn_options = 0,
               fixed_nn_struct = c(100, 100),
               num_epoch = 10,
               min_perf = 0)

# stop h2o engine
h2o.shutdown(prompt = FALSE)

#set delay to insure h2o unit closes properly before the next test
Sys.sleep(5)





</code></pre>

<hr>
<h2 id='aml_score_data'>Function to score new data and predict change for each single currency pair</h2><span id='topic+aml_score_data'></span>

<h3>Description</h3>

<p>Function is using the latest data from the financial assets
indicator pattern and deep learning model.
Prediction is a future price change for that asset
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>aml_score_data(symbol, timeframe, path_model, path_data, path_sbxm, path_sbxs)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="aml_score_data_+3A_symbol">symbol</code></td>
<td>
<p>Character symbol of the asset for which the model shall predict</p>
</td></tr>
<tr><td><code id="aml_score_data_+3A_timeframe">timeframe</code></td>
<td>
<p>Data timeframe e.g. 60 min</p>
</td></tr>
<tr><td><code id="aml_score_data_+3A_path_model">path_model</code></td>
<td>
<p>Path where the models are be stored</p>
</td></tr>
<tr><td><code id="aml_score_data_+3A_path_data">path_data</code></td>
<td>
<p>Path where the aggregated historical data is stored, if exists in rds format</p>
</td></tr>
<tr><td><code id="aml_score_data_+3A_path_sbxm">path_sbxm</code></td>
<td>
<p>Path to the sandbox where file with predicted price should be written (master terminal)</p>
</td></tr>
<tr><td><code id="aml_score_data_+3A_path_sbxs">path_sbxs</code></td>
<td>
<p>Path to the sandbox where file with predicted price should be written (slave terminal)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Performs fresh data reading from the rds file
</p>


<h3>Value</h3>

<p>Function is writing file into Decision Support System folder, mainly file with price change prediction in pips
</p>


<h3>Author(s)</h3>

<p>(C) 2020 Vladimir Zhbanko
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


# test of function aml_make_model is duplicated here
library(dplyr)
library(readr)
library(lubridate)
library(h2o)
library(magrittr)
library(lazytrade)

path_model &lt;- normalizePath(tempdir(),winslash = "/")
path_data &lt;- normalizePath(tempdir(),winslash = "/")

ind = system.file("extdata", "AI_RSIADXUSDJPY60.csv",
                  package = "lazytrade") %&gt;% read_csv(col_names = FALSE)

ind$X1 &lt;- ymd_hms(ind$X1)

write_csv(ind, file.path(path_data, "AI_RSIADXUSDJPY60.csv"), col_names = FALSE)

# add tick data to the folder
tick = system.file("extdata", "TickSize_AI_RSIADX.csv",
                  package = "lazytrade") %&gt;% read_csv(col_names = FALSE)

write_csv(tick, file.path(path_data, "TickSize_AI_RSIADX.csv"), col_names = FALSE)

# data transformation using the custom function for one symbol
aml_collect_data(indicator_dataset = ind,
                 symbol = 'USDJPY',
                 timeframe = 60,
                 path_data = path_data)
# start h2o engine (using all CPU's by default)

h2o.init(nthreads = 2)


# performing Deep Learning Regression using the custom function
aml_make_model(symbol = 'USDJPY',
               timeframe = 60,
               path_model = path_model,
               path_data = path_data,
               force_update=FALSE,
               num_nn_options = 2)


path_sbxm &lt;- normalizePath(tempdir(),winslash = "/")
path_sbxs &lt;- normalizePath(tempdir(),winslash = "/")


# score the latest data to generate predictions for one currency pair
aml_score_data(symbol = 'USDJPY',
               timeframe = 60,
               path_model = path_model,
               path_data = path_data,
               path_sbxm = path_sbxm,
               path_sbxs = path_sbxs)

# stop h2o engine
h2o.shutdown(prompt = FALSE)

#set delay to insure h2o unit closes properly before the next test
Sys.sleep(5)





</code></pre>

<hr>
<h2 id='aml_simulation'>Function to simulate multiple input structures</h2><span id='topic+aml_simulation'></span>

<h3>Description</h3>

<p>Function is designed to evaluate several different inputs.
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>aml_simulation(
  timeframe = 60,
  path_sim_input,
  path_sim_result,
  par_simulate1 = 10,
  par_simulate2 = 16,
  demo_mode = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="aml_simulation_+3A_timeframe">timeframe</code></td>
<td>
<p>Integer, Data timeframe e.g. 60 min. This will be equal to 1 bar</p>
</td></tr>
<tr><td><code id="aml_simulation_+3A_path_sim_input">path_sim_input</code></td>
<td>
<p>String, Path to the folder where csv files will be placed, typically AI_RSIADXAUDCAD60.csv</p>
</td></tr>
<tr><td><code id="aml_simulation_+3A_path_sim_result">path_sim_result</code></td>
<td>
<p>String, Path to the folder where all results from simulations shall be written</p>
</td></tr>
<tr><td><code id="aml_simulation_+3A_par_simulate1">par_simulate1</code></td>
<td>
<p>Integer, Parameter that can be used in simulation</p>
</td></tr>
<tr><td><code id="aml_simulation_+3A_par_simulate2">par_simulate2</code></td>
<td>
<p>Integer, Parameter that can be used in simulation</p>
</td></tr>
<tr><td><code id="aml_simulation_+3A_demo_mode">demo_mode</code></td>
<td>
<p>Boolean, Simplify function test. When TRUE no simulation will be made</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function is using several other functions to perform sets of operations
designed to test several inputs. Designed to validate model settings.
</p>
<p>Update: New function structure to allow quicker simulation of parameters to find best performing input
</p>


<h3>Value</h3>

<p>Function is writing file into Decision Support System folders
</p>


<h3>Author(s)</h3>

<p>(C) 2021 Vladimir Zhbanko
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


library(dplyr)
library(magrittr)
library(readr)
library(h2o)
library(lazytrade)
library(lubridate)
library(stats)

path_input &lt;- normalizePath(tempdir(),winslash = "/")
path_sim_input &lt;- file.path(path_input, "path_sim_input")
dir.create(path_sim_input)
path_sim_result &lt;- file.path(path_input, "path_sim_result")
dir.create(path_sim_result)

file.copy(from = system.file("extdata", "AI_RSIADXCADCHF60.csv", package = "lazytrade"),
          to = file.path(path_sim_input, "AI_RSIADXCADCHF60.csv"), overwrite = TRUE)
file.copy(from = system.file("extdata", "AI_RSIADXEURNZD60.csv", package = "lazytrade"),
          to = file.path(path_sim_input, "AI_RSIADXEURNZD60.csv"), overwrite = TRUE)

# start h2o engine
h2o.init(nthreads = 2)

# simulation of different epoch values
aml_simulation(timeframe = 60,
               path_sim_input = path_sim_input,
               path_sim_result = path_sim_result,
               par_simulate1 = 10,
               par_simulate2 = 10,
               demo_mode = FALSE)

Sys.sleep(5)
# stop h2o engine
h2o.shutdown(prompt = FALSE)

#set delay to insure h2o unit closes properly before the next test
Sys.sleep(5)





</code></pre>

<hr>
<h2 id='aml_test_model'>Function to test the model and conditionally decide to update existing model for a single currency pair</h2><span id='topic+aml_test_model'></span>

<h3>Description</h3>

<p>Function is designed to test the trading decision generated by the Deep learning regression model.
It is doing so by simulating trading strategy outcome.
The outcome of this function will be also used to define best trigger to join into the
trading opportunity
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>aml_test_model(
  symbol,
  num_bars,
  timeframe,
  path_model,
  path_data,
  path_sbxm = path_sbxm,
  path_sbxs = path_sbxs
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="aml_test_model_+3A_symbol">symbol</code></td>
<td>
<p>Character symbol of the asset for which to train the model</p>
</td></tr>
<tr><td><code id="aml_test_model_+3A_num_bars">num_bars</code></td>
<td>
<p>Integer, Number of (rows) bars used to test the model</p>
</td></tr>
<tr><td><code id="aml_test_model_+3A_timeframe">timeframe</code></td>
<td>
<p>Integer, Data timeframe e.g. 60 min. This will be equal to 1 bar</p>
</td></tr>
<tr><td><code id="aml_test_model_+3A_path_model">path_model</code></td>
<td>
<p>String, User path where the models are be stored</p>
</td></tr>
<tr><td><code id="aml_test_model_+3A_path_data">path_data</code></td>
<td>
<p>String, User path where the aggregated historical data is stored, if exists in rds format</p>
</td></tr>
<tr><td><code id="aml_test_model_+3A_path_sbxm">path_sbxm</code></td>
<td>
<p>String, User path to the sandbox where file with strategy test results should be written (master terminal)</p>
</td></tr>
<tr><td><code id="aml_test_model_+3A_path_sbxs">path_sbxs</code></td>
<td>
<p>String, User path to the sandbox where file with strategy test results should be written (slave terminal)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function is reading price data and corresponding indicator.
Starting from the trained model function will test the trading strategy using simplified trading approach.
Trading approach will entail using the last available indicator data, predict the price change for every row,
trade will be simulating by holding the asset for 3, 5, 10 and 34 hours.
Several trigger points will be evaluated selecting the most optimal trading trigger.
Function is writing most optimal decision into *.csv file
Such file will be used by the function aml_make_model.R to decide whether model must be updated...
</p>


<h3>Value</h3>

<p>Function is writing file into Decision Support System folders
</p>


<h3>Author(s)</h3>

<p>(C) 2020, 2021 Vladimir Zhbanko
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


library(dplyr)
library(magrittr)
library(readr)
library(h2o)
library(lazytrade)
library(lubridate)

path_model &lt;- normalizePath(tempdir(),winslash = "/")
path_data &lt;- normalizePath(tempdir(),winslash = "/")

ind = system.file("extdata", "AI_RSIADXUSDJPY60.csv",
                  package = "lazytrade") %&gt;% read_csv(col_names = FALSE)

ind$X1 &lt;- ymd_hms(ind$X1)

tick = system.file("extdata", "TickSize_AI_RSIADX.csv",
                  package = "lazytrade") %&gt;% read_csv(col_names = FALSE)

write_csv(ind, file.path(path_data, "AI_RSIADXUSDJPY60.csv"), col_names = FALSE)

write_csv(tick, file.path(path_data, "TickSize_AI_RSIADX.csv"), col_names = FALSE)

# data transformation using the custom function for one symbol
aml_collect_data(indicator_dataset = ind,
                 symbol = 'USDJPY',
                 timeframe = 60,
                 path_data = path_data)


# start h2o engine
h2o.init(nthreads = 2)


# performing Deep Learning Regression using the custom function
aml_make_model(symbol = 'USDJPY',
               timeframe = 60,
               path_model = path_model,
               path_data = path_data,
               force_update=FALSE,
               num_nn_options = 3)

path_sbxm &lt;- normalizePath(tempdir(),winslash = "/")
path_sbxs &lt;- normalizePath(tempdir(),winslash = "/")

# score the latest data to generate predictions for one currency pair
aml_score_data(symbol = 'USDJPY',
               timeframe = 60,
               path_model = path_model,
               path_data = path_data,
               path_sbxm = path_sbxm,
               path_sbxs = path_sbxs)

# test the results of predictions
aml_test_model(symbol = 'USDJPY',
               num_bars = 600,
               timeframe = 60,
               path_model = path_model,
               path_data = path_data,
               path_sbxm = path_sbxm,
               path_sbxs = path_sbxs)

# stop h2o engine
h2o.shutdown(prompt = FALSE)

#set delay to insure h2o unit closes properly before the next test
Sys.sleep(5)





</code></pre>

<hr>
<h2 id='check_if_optimize'>Function check_if_optimize.</h2><span id='topic+check_if_optimize'></span>

<h3>Description</h3>

<p>Purpose of this function is to verify trading system functionality by analysing
profit factor on the last trades. Whenever trading robot has profit factor value below certain limit
function will write a file log indicating which trading systems need to be maintained.
</p>
<p>Learn by example how to manipulate data
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_if_optimize(
  x,
  system_list,
  path_data,
  num_trades_to_consider = 3,
  profit_factor_limit = 0.7,
  write_mode = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_if_optimize_+3A_x">x</code></td>
<td>

<ul>
<li><p> dataframe containing trading results
</p>
</li></ul>
</td></tr>
<tr><td><code id="check_if_optimize_+3A_system_list">system_list</code></td>
<td>

<ul>
<li><p> dataframe containing a table with magic numbers used by robots. Stored in file Setup.csv
</p>
</li></ul>
</td></tr>
<tr><td><code id="check_if_optimize_+3A_path_data">path_data</code></td>
<td>

<ul>
<li><p> string, path to the folder where optimization file should be written
</p>
</li></ul>
</td></tr>
<tr><td><code id="check_if_optimize_+3A_num_trades_to_consider">num_trades_to_consider</code></td>
<td>

<ul>
<li><p> Number of trades to calculate profit factor
</p>
</li></ul>
</td></tr>
<tr><td><code id="check_if_optimize_+3A_profit_factor_limit">profit_factor_limit</code></td>
<td>

<ul>
<li><p> Limit below which trading robot is considered not working properly
</p>
</li></ul>
</td></tr>
<tr><td><code id="check_if_optimize_+3A_write_mode">write_mode</code></td>
<td>

<ul>
<li><p> When true function will write result to the file located in the temporary directory
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>Whenever there will be not enough trades then empty file will be written to the destination
</p>


<h3>Value</h3>

<p>function returns a dataframe with systems that should be optimized
</p>


<h3>Author(s)</h3>

<p>(C) 2019,2021 Vladimir Zhbanko
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(lazytrade)
library(magrittr)
library(dplyr)
library(readr)
library(lubridate)

path_data &lt;- normalizePath(tempdir(),winslash = "/")

file.copy(from = system.file("extdata", "Setup.csv", package = "lazytrade"),
          to = file.path(path_data, "Setup.csv"), overwrite = TRUE)

system_list &lt;- read_csv(file.path(path_data, "Setup.csv"))

data(profit_factorDF)


# without writing to the file
check_if_optimize(x = profit_factorDF,
                  system_list = system_list,
                  path_data,
                  num_trades_to_consider = 3,
                  profit_factor_limit = 0.8,
                  write_mode = TRUE)


</code></pre>

<hr>
<h2 id='create_labelled_data'>Create labelled data</h2><span id='topic+create_labelled_data'></span>

<h3>Description</h3>

<p>FUNCTION create_labelled_data.
PURPOSE: function gets price data of every currency in each column.
It is splitting this data by periods and transposes the data.
Additionally function is capable to label the data based on the simple logic.
Each row will be assigned into 2 categories based on the difference between beginning and end of the row elements
Finally all data will be stacked on top and joined into the table
</p>
<p>Learn by example how to manipulate data
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#superseded"><img src="../help/figures/lifecycle-superseded.svg" alt='[Superseded]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_labelled_data(x, n = 50, type = "regression")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_labelled_data_+3A_x">x</code></td>
<td>

<ul>
<li><p> data set containing a table where 1st column is a Time index and other columns containing financial asset price values
</p>
</li></ul>
</td></tr>
<tr><td><code id="create_labelled_data_+3A_n">n</code></td>
<td>

<ul>
<li><p> number of rows we intend to split and transpose the data to
</p>
</li></ul>
</td></tr>
<tr><td><code id="create_labelled_data_+3A_type">type</code></td>
<td>

<ul>
<li><p> type of the label required. Can be either &quot;classification&quot; or &quot;regression&quot;.
&quot;classification&quot; will return either &quot;BU&quot; or &quot;BE&quot;,
&quot;regression&quot; will return the difference between first value and the last value in each row (in pips)
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>see more info in the udemy course self-learning-trading-robot
</p>


<h3>Value</h3>

<p>function returns transposed data. One column called 'LABEL' indicate achieved value of the label.
Transposed values from every column are stacked one to each other
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

library(dplyr)
library(magrittr)
library(readr)
library(lazytrade)

# usind a sample data
data(price_dataset)

# price change as a label
create_labelled_data(x = price_dataset, n = 75, type = "regression")

# factors 'BU'/'BE' as a label
create_labelled_data(x = price_dataset, n = 75, type = "classification")


</code></pre>

<hr>
<h2 id='create_transposed_data'>Create Transposed Data</h2><span id='topic+create_transposed_data'></span>

<h3>Description</h3>

<p>PURPOSE: function gets indicator data in each column.
Goal is to splitting this data into periods and transpose the data.
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#superseded"><img src="../help/figures/lifecycle-superseded.svg" alt='[Superseded]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_transposed_data(x, n = 50)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_transposed_data_+3A_x">x</code></td>
<td>

<ul>
<li><p> data set containing a table where 1st column is a Time index and other columns containing financial asset indicator values
</p>
</li></ul>
</td></tr>
<tr><td><code id="create_transposed_data_+3A_n">n</code></td>
<td>

<ul>
<li><p> number of rows we intend to split and transpose the data
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>each column contains records of the indicator value of the assets
every column will be split into chunks of n observations and transposed into rows
this repeated for all the columns coming up with a matrix.
Function works in combination with a function create_labelled_data
</p>


<h3>Value</h3>

<p>function returns transposed data. Transposed values from every column are stacked one to each other
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

library(dplyr)
library(magrittr)
library(lazytrade)

# usind a sample data
data(indicator_dataset)

create_transposed_data(indicator_dataset, n = 75)



</code></pre>

<hr>
<h2 id='data_trades'>Table with Trade results samples</h2><span id='topic+data_trades'></span>

<h3>Description</h3>

<p>Table with Trade results samples
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data_trades
</code></pre>


<h3>Format</h3>

<p>A dataframe with several columns
</p>

<dl>
<dt>MagicNumber</dt><dd><p>Unique identifiers of the Trading Robots</p>
</dd>
<dt>TicketNumber</dt><dd><p>Ticket Number of closed position</p>
</dd>
<dt>OrderStartTime</dt><dd><p>Date and Time when order started</p>
</dd>
<dt>OrderCloseTime</dt><dd><p>Date and Time when order closed</p>
</dd>
<dt>Profit</dt><dd><p>Monetary result of the trade</p>
</dd>
<dt>Symbol</dt><dd><p>Symbol of the Asset e.g. EURUSD</p>
</dd>
<dt>OrderType</dt><dd><p>Order Type 0 - buy, 1 - sell</p>
</dd>
</dl>


<hr>
<h2 id='decrypt_mykeys'>Function that decrypt encrypted content</h2><span id='topic+decrypt_mykeys'></span>

<h3>Description</h3>

<p>Cryptography facility
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>decrypt_mykeys(path_encrypted_content, path_private_key)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="decrypt_mykeys_+3A_path_encrypted_content">path_encrypted_content</code></td>
<td>

<ul>
<li><p> path to the encrypted content of the API key
</p>
</li></ul>
</td></tr>
<tr><td><code id="decrypt_mykeys_+3A_path_private_key">path_private_key</code></td>
<td>

<ul>
<li><p> path to the private RSA key, should be without password
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>It is possible to generate private/public key pair using R-Studio Project Options Menu.
Alternatively possible to use 'openssl' R package
</p>


<h3>Value</h3>


<ul>
<li><p> a string with decrypted key
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(magrittr)
library(openssl)
library(readr)

path_ssh &lt;- normalizePath(tempdir(),winslash = "/")
rsa_keygen() %&gt;% write_pem(path = file.path(path_ssh, 'id_api'))
# extract and write your public key
read_key(file = file.path(path_ssh, 'id_api'), password = "") %&gt;%
`[[`("pubkey") %&gt;% write_pem(path = file.path(path_ssh, 'id_api.pub'))

path_private_key &lt;- file.path(path_ssh, "id_api")
path_public_key &lt;- file.path(path_ssh, "id_api.pub")

#encrypting string 'my_key'...
encrypt_api_key(api_key = 'my_key', enc_name = 'api_key.enc.rds',path_ssh = path_ssh)

#encrypted content
out &lt;- read_rds(file.path(path_ssh, "api_key.enc.rds"))

# Consumer API keys
ConsumerAPIkeys &lt;- decrypt_mykeys(path_encrypted_content = file.path(path_ssh,
                                  'api_key.enc.rds'),
                                  path_private_key = path_private_key)


</code></pre>

<hr>
<h2 id='DFR'>Table with predicted price change</h2><span id='topic+DFR'></span>

<h3>Description</h3>

<p>Table with predicted price change
</p>


<h3>Usage</h3>

<pre><code class='language-R'>DFR
</code></pre>


<h3>Format</h3>

<p>A dataframe with one column
</p>

<dl>
<dt>&quot;MagicNumber.x</dt><dd><p>Unique identifiers of the Trading Robots from Trade Log</p>
</dd>
<dt>TicketNumber</dt><dd><p>Ticket Number of closed position</p>
</dd>
<dt>OrderStartTime</dt><dd><p>Date and Time when order started</p>
</dd>
<dt>OrderCloseTime</dt><dd><p>Date and Time when order closed</p>
</dd>
<dt>Profit</dt><dd><p>Monetary result of the trade</p>
</dd>
<dt>Symbol</dt><dd><p>Symbol of the Asset e.g. EURUSD</p>
</dd>
<dt>OrderType</dt><dd><p>Order Type 0 - buy, 1 - sell</p>
</dd>
<dt>&quot;CUMSUM_PNL</dt><dd><p>Cumulative sum of Profit and Loss</p>
</dd>
</dl>


<hr>
<h2 id='dlog'>Create log difference distribution</h2><span id='topic+dlog'></span>

<h3>Description</h3>

<p>Calculate log distribution and calculate difference within rows
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dlog(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dlog_+3A_x">x</code></td>
<td>

<ul>
<li><p> matrix with one or more column
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>


<ul>
<li><p> dataframe
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
library(magrittr)
library(lazytrade)
m &lt;- seq(1:1000) %&gt;% as.matrix(10) %&gt;% dlog()


</code></pre>

<hr>
<h2 id='encrypt_api_key'>Encrypt api keys</h2><span id='topic+encrypt_api_key'></span>

<h3>Description</h3>

<p>Provide easy interface to encrypt the api key.
In order to use function simply provide a string with an API key.
In addition provide the path to the .ssh folder and names of the private and public keys
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>encrypt_api_key(
  api_key,
  enc_name = "api_key.enc.rds",
  path_ssh = "path_ssh",
  file_rsa = "id_api",
  file_rsa_pub = "id_api.pub"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="encrypt_api_key_+3A_api_key">api_key</code></td>
<td>
<p>String with API key</p>
</td></tr>
<tr><td><code id="encrypt_api_key_+3A_enc_name">enc_name</code></td>
<td>
<p>String with a name of the file with encrypted key. Default name is 'api_key.enc.rds'</p>
</td></tr>
<tr><td><code id="encrypt_api_key_+3A_path_ssh">path_ssh</code></td>
<td>
<p>String with path to the file with rsa keys. Same place will be used to store encrypted data</p>
</td></tr>
<tr><td><code id="encrypt_api_key_+3A_file_rsa">file_rsa</code></td>
<td>
<p>String with a name of the file with a private key. Default name is 'id_api'</p>
</td></tr>
<tr><td><code id="encrypt_api_key_+3A_file_rsa_pub">file_rsa_pub</code></td>
<td>
<p>String with a name of the file with a public key. Default name is 'id_api.pub'</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Make sure to clean the history of the R session
</p>


<h3>Value</h3>

<p>Writes a file with encrypted key
</p>


<h3>References</h3>

<p>for more info on how to use RSA cryptography in R check my course
https://www.udemy.com/course/keep-your-secrets-under-control/?referralCode=5B78D58E7C06AFFD80AE
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(openssl)
library(magrittr)
library(readr)
path_ssh &lt;- normalizePath(tempdir(),winslash = "/")
rsa_keygen() %&gt;% write_pem(path = file.path(path_ssh, 'id_api'))
# extract and write your public key
read_key(file = file.path(path_ssh, 'id_api'), password = "") %&gt;%
`[[`("pubkey") %&gt;% write_pem(path = file.path(path_ssh, 'id_api.pub'))


path_private_key &lt;- file.path(path_ssh, "id_api")
path_public_key &lt;- file.path(path_ssh, "id_api.pub")

#encrypting string 'my_key'...
encrypt_api_key(api_key = 'my_key', enc_name = 'api_key.enc.rds',path_ssh = path_ssh)

out &lt;- read_rds(file.path(path_ssh, "api_key.enc.rds"))

# decrypting the password using public data list and private key
api_key &lt;- decrypt_envelope(out$data,
                            out$iv,
                            out$session,
                            path_private_key, password = "") %&gt;%
           unserialize()

# outcome of the encryption will be a string 'my_key'


</code></pre>

<hr>
<h2 id='EURUSDM15X75'>Table with indicator and price change dataset</h2><span id='topic+EURUSDM15X75'></span>

<h3>Description</h3>

<p>Table with indicator and price change dataset
</p>


<h3>Usage</h3>

<pre><code class='language-R'>EURUSDM15X75
</code></pre>


<h3>Format</h3>

<p>A dataframe with several columns
</p>

<dl>
<dt>LABEL</dt><dd><p>future price change</p>
</dd>
<dt>X1-X75</dt><dd><p>Values of the macd indicator</p>
</dd>
</dl>


<hr>
<h2 id='evaluate_macroeconomic_event'>Function used to evaluate market type situation by reading the file with Macroeconomic Events
and writing a trigger to the trading robot</h2><span id='topic+evaluate_macroeconomic_event'></span>

<h3>Description</h3>

<p>Function is reading the content of the file 01_MacroeconomicEvent.csv.
Content of the file can be either 1 or 0.
1 - when Macro Economic event is present, 0 - when it's not.
Function will also read magic number of the trading robots. This is indicated in the file 'Setup.csv'.
Final outcome of the function is the series of files written to the destination directories.
These files will either enable or disable opening of new positions in the trading robots
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>evaluate_macroeconomic_event(
  setup_file_path,
  setup_file_name = "Setup.csv",
  macro_event_path,
  macro_file_name = "01_MacroeconomicEvent.csv",
  path_T1,
  path_T3
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="evaluate_macroeconomic_event_+3A_setup_file_path">setup_file_path</code></td>
<td>
<p>string, path to the folder with Setup.csv file</p>
</td></tr>
<tr><td><code id="evaluate_macroeconomic_event_+3A_setup_file_name">setup_file_name</code></td>
<td>
<p>string, name of the file 'Setup.csv'</p>
</td></tr>
<tr><td><code id="evaluate_macroeconomic_event_+3A_macro_event_path">macro_event_path</code></td>
<td>
<p>string, path to the folder with a file '01_MacroeconomicEvent.csv'</p>
</td></tr>
<tr><td><code id="evaluate_macroeconomic_event_+3A_macro_file_name">macro_file_name</code></td>
<td>
<p>string, name of the file '01_MacroeconomicEvent.csv'</p>
</td></tr>
<tr><td><code id="evaluate_macroeconomic_event_+3A_path_t1">path_T1</code></td>
<td>
<p>Path of the Terminal 1</p>
</td></tr>
<tr><td><code id="evaluate_macroeconomic_event_+3A_path_t3">path_T3</code></td>
<td>
<p>Path of the Terminal 3</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is used exclusively with Market Type recognition system.
</p>
<p>Final evaluation will consist in writing a dedicated file with a simple information:
</p>
<p>When Macro economic even is not present:
</p>
<p>&quot;Magic&quot;,&quot;IsEnabled&quot;
8139125,1
</p>
<p>or, when Macro economic event is present:
</p>
<p>&quot;Magic&quot;,&quot;IsEnabled&quot;
8139125,0
</p>


<h3>Value</h3>

<p>Function will write files indicating to enable or disable trading systems to open new orders
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# evaluate data on macroeconomic event (required to start trading)
library(dplyr)
library(readr)
library(lazytrade)

dir &lt;- normalizePath(tempdir(),winslash = "/")

evaluate_macroeconomic_event(setup_file_path = system.file('extdata', package = "lazytrade"),
                             setup_file_name = "Setup.csv",
                             macro_event_path = system.file('extdata', package = "lazytrade"),
                             macro_file_name = "01_MacroeconomicEvent.csv",
                             path_T1 = dir, path_T3 = dir)



</code></pre>

<hr>
<h2 id='get_profit_factorDF'>Function that returns the profit factors of the systems in a form of a DataFrame</h2><span id='topic+get_profit_factorDF'></span>

<h3>Description</h3>

<p>Calculation of profit factor using dplyr verbs
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#superseded"><img src="../help/figures/lifecycle-superseded.svg" alt='[Superseded]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_profit_factorDF(x, num_orders)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_profit_factorDF_+3A_x">x</code></td>
<td>

<ul>
<li><p> data frame with orders. Note x must contain MagicNumber and Profit columns!
</p>
</li></ul>
</td></tr>
<tr><td><code id="get_profit_factorDF_+3A_num_orders">num_orders</code></td>
<td>

<ul>
<li><p> desired number of orders to base profit factor calculation
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>


<ul>
<li><p> Function returns dataframe with column PrFact with calculated profit factor value for each trading robot
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
library(lazytrade)
library(dplyr)
library(magrittr)
data(profit_factorDF)
get_profit_factorDF(x = profit_factorDF,
                    num_orders = 10)



</code></pre>

<hr>
<h2 id='import_data'>Import Data file with Trade Logs to R.</h2><span id='topic+import_data'></span>

<h3>Description</h3>

<p>Function is capable to import file with executed trades log.
Files do not have column headers hence function will take care to name columns as well as to perform relevant cleansing
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>import_data(path_sbxm, trade_log_file)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="import_data_+3A_path_sbxm">path_sbxm</code></td>
<td>

<ul>
<li><p> String, Path to the sandbox with the log file where the file with data is written
</p>
</li></ul>
</td></tr>
<tr><td><code id="import_data_+3A_trade_log_file">trade_log_file</code></td>
<td>

<ul>
<li><p> String, File name where the order results are written
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>Function will return the dataframe with trade data and automatically set proper column types
</p>


<h3>Author(s)</h3>

<p>(C) 2019, 2020 Vladimir Zhbanko
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(lazytrade)
library(dplyr)
library(readr)
library(lubridate)

path_sbxm &lt;- normalizePath(tempdir(),winslash = "/")

file.copy(from = system.file("extdata", "OrdersResultsT1.csv", package = "lazytrade"),
          to = file.path(path_sbxm, "OrdersResultsT1.csv"), overwrite = TRUE)

DFT1 &lt;- import_data(path_sbxm = path_sbxm,
                    trade_log_file = "OrdersResultsT1.csv")



</code></pre>

<hr>
<h2 id='indicator_dataset'>Table with indicator dataset</h2><span id='topic+indicator_dataset'></span>

<h3>Description</h3>

<p>Table with indicator dataset
</p>


<h3>Usage</h3>

<pre><code class='language-R'>indicator_dataset
</code></pre>


<h3>Format</h3>

<p>A dataframe with several columns
</p>

<dl>
<dt>X1</dt><dd><p>Date and time of the indicator sample</p>
</dd>
<dt>X2-X29</dt><dd><p>Values of the assets</p>
</dd>
</dl>


<hr>
<h2 id='macd_100'>Table with indicator only used to train model, 128 col 1646 rows</h2><span id='topic+macd_100'></span>

<h3>Description</h3>

<p>Table with indicator only used to train model, 128 col 1646 rows
</p>


<h3>Usage</h3>

<pre><code class='language-R'>macd_100
</code></pre>


<h3>Format</h3>

<p>A dataframe with several columns
</p>

<dl>
<dt>EURUSD</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>GBPUSD</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>AUDUSD</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>NZDUSD</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>USDCAD</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>USDCHF</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>USDJPY</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>EURGBP</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>EURJPY</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>EURCHF</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>EURNZD</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>EURCAD</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>EURAUD</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>GBPAUD</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>GBPCAD</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>GBPCHF</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>GBPJPY</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>GBPNZD</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>AUDCAD</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>AUDCHF</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>AUDJPY</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>AUDNZD</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>CADJPY</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>CHFJPY</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>NZDJPY</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>NZDCAD</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>NZDCHF</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>CADCHF</dt><dd><p>Values of the macd indicator</p>
</dd>
</dl>


<hr>
<h2 id='macd_df'>Table with one column indicator dataset</h2><span id='topic+macd_df'></span>

<h3>Description</h3>

<p>Table with one column indicator dataset
</p>


<h3>Usage</h3>

<pre><code class='language-R'>macd_df
</code></pre>


<h3>Format</h3>

<p>A dataframe with one column
</p>

<dl>
<dt>CADCHF</dt><dd><p>Indicator values of the asset</p>
</dd>
</dl>


<hr>
<h2 id='macd_ML60M'>Table with indicator and market type category used to train model</h2><span id='topic+macd_ML60M'></span>

<h3>Description</h3>

<p>Table with indicator and market type category used to train model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>macd_ML60M
</code></pre>


<h3>Format</h3>

<p>A dataframe with several columns
</p>

<dl>
<dt>X1-X64</dt><dd><p>Values of the macd indicator</p>
</dd>
<dt>M_T</dt><dd><p>Category of Market Type</p>
</dd>
</dl>


<hr>
<h2 id='mt_evaluate'>Function to score data and predict current market type using pre-trained classification model</h2><span id='topic+mt_evaluate'></span>

<h3>Description</h3>

<p>PURPOSE: Function that uses Deep Learning model and Time Series Column of the dataframe
to find out specific market type of the financial asset
it will also discard bad result outputting -1 if it is the case
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mt_evaluate(x, path_model, num_cols, timeframe)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mt_evaluate_+3A_x">x</code></td>
<td>

<ul>
<li><p> dataframe with one column containing asset indicator in the time descending order,
typically 64 or more values
</p>
</li></ul>
</td></tr>
<tr><td><code id="mt_evaluate_+3A_path_model">path_model</code></td>
<td>
<p>String, path to the model</p>
</td></tr>
<tr><td><code id="mt_evaluate_+3A_num_cols">num_cols</code></td>
<td>
<p>Integer, number of columns (features) in the final vector input to the model</p>
</td></tr>
<tr><td><code id="mt_evaluate_+3A_timeframe">timeframe</code></td>
<td>
<p>Integer, timeframe in Minutes.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>it is mandatory to switch on the virtual h2o machine with h2o.init()
also to shut it down with h2o.shutdown(prompt = F)
</p>


<h3>Value</h3>

<p>dataframe with predicted value of the market type
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


library(h2o)
library(magrittr)
library(dplyr)
library(readr)
library(lazytrade)

path_model &lt;- normalizePath(tempdir(),winslash = "/")
path_data &lt;- normalizePath(tempdir(),winslash = "/")

data(macd_ML60M)

# start h2o engine (using all CPU's by default)
h2o.init(nthreads = 2)

# performing Deep Learning Regression using the custom function
# this function stores model to the temp location
mt_make_model(indicator_dataset = macd_ML60M,
              num_bars = 64,
              timeframe = 60,
              path_model = path_model,
              path_data = path_data,
              activate_balance = TRUE,
              num_nn_options = 3)


# Use sample data
data(macd_100)

# use one column for testing
x &lt;- macd_100[ ,2]


mt_evaluate(x = x,
            path_model = path_model,
            num_cols = 64,
            timeframe = 60)

h2o.shutdown(prompt = FALSE)

#set delay to insure h2o unit closes properly before the next test
Sys.sleep(5)



</code></pre>

<hr>
<h2 id='mt_import_data'>Import Market Type related Data to R from the Sandbox</h2><span id='topic+mt_import_data'></span>

<h3>Description</h3>

<p>Function imports file from the MetaTrader sandbox. Function performs necessary cleansing of the data column types
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mt_import_data(path_sbxm, system_number)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mt_import_data_+3A_path_sbxm">path_sbxm</code></td>
<td>

<ul>
<li><p> String, Path to the sandbox with the log file (master terminal)
</p>
</li></ul>
</td></tr>
<tr><td><code id="mt_import_data_+3A_system_number">system_number</code></td>
<td>

<ul>
<li><p> magic number id of the trading system
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>function returns the data frame with 5 columns including market type code
</p>


<h3>Author(s)</h3>

<p>(C) 2020, 2021 Vladimir Zhbanko
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(readr)
library(lazytrade)

path_sbxm &lt;- normalizePath(tempdir(),winslash = "/")

file.copy(from = system.file("extdata", "MarketTypeLog9139106.csv", package = "lazytrade"),
          to = file.path(path_sbxm, "MarketTypeLog9139106.csv"), overwrite = TRUE)

DF1 &lt;- mt_import_data(path_sbxm = path_sbxm,
                      system_number = 9139106)



</code></pre>

<hr>
<h2 id='mt_make_model'>Function to train Deep Learning Classification model for Market Type recognition</h2><span id='topic+mt_make_model'></span>

<h3>Description</h3>

<p>Function is training h2o deep learning model to match
classified patterns of the financial indicator.
Main idea is to be able to detect Market Type by solely relying on the
current indicator pattern.
This is in the attempt to evaluate current market type for trading purposes.
</p>
<p>Selected Market Periods could be manually classified
according to the theory from Van K. Tharp:
</p>

<ol>
<li><p> Bull normal, BUN
</p>
</li>
<li><p> Bull volatile, BUV
</p>
</li>
<li><p> Bear normal, BEN
</p>
</li>
<li><p> Bear volatile, BEV
</p>
</li>
<li><p> Sideways quiet, RAN
</p>
</li>
<li><p> Sideways volatile, RAV
</p>
</li></ol>

<p>For automatic classification, could only be used: BUN, BEN, RAN market types
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mt_make_model(
  indicator_dataset,
  num_bars = 64,
  timeframe = 60,
  path_model,
  path_data,
  activate_balance = TRUE,
  num_nn_options = 24,
  fixed_nn_struct = c(100, 100),
  num_epoch = 100,
  is_cluster = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mt_make_model_+3A_indicator_dataset">indicator_dataset</code></td>
<td>
<p>Data frame, Data set containing indicator patterns to train the model</p>
</td></tr>
<tr><td><code id="mt_make_model_+3A_num_bars">num_bars</code></td>
<td>
<p>Integer, Number of bars used to detect pattern</p>
</td></tr>
<tr><td><code id="mt_make_model_+3A_timeframe">timeframe</code></td>
<td>
<p>Integer, Data time frame in minutes.</p>
</td></tr>
<tr><td><code id="mt_make_model_+3A_path_model">path_model</code></td>
<td>
<p>String, Path where the models are be stored</p>
</td></tr>
<tr><td><code id="mt_make_model_+3A_path_data">path_data</code></td>
<td>
<p>String, Path where the aggregated historical data is stored,
if exists, in rds format</p>
</td></tr>
<tr><td><code id="mt_make_model_+3A_activate_balance">activate_balance</code></td>
<td>
<p>Boolean, option to choose to balance market type classes or not,
default TRUE</p>
</td></tr>
<tr><td><code id="mt_make_model_+3A_num_nn_options">num_nn_options</code></td>
<td>
<p>Integer, value from 0 to 24 or more as multiple of 3.
Used to change number of variants for 3 hidden layer structure.
Random neural network structures will be generated.
When value 0 is set then a fixed structure will be used as
defined by parameter fixed_nn_struct.
To avoid warnings make sure to set this value as
multiple of 3. Higher values will increase computation time.</p>
</td></tr>
<tr><td><code id="mt_make_model_+3A_fixed_nn_struct">fixed_nn_struct</code></td>
<td>
<p>Integer vector with numeric elements, see par hidden in ?h2o.deeplearning,
default value is c(100,100).
Note this will only work if num_nn_options is 0</p>
</td></tr>
<tr><td><code id="mt_make_model_+3A_num_epoch">num_epoch</code></td>
<td>
<p>Integer, see parameter epochs in ?h2o.deeplearning, default value is 100
Higher number may lead to long code execution</p>
</td></tr>
<tr><td><code id="mt_make_model_+3A_is_cluster">is_cluster</code></td>
<td>
<p>Boolean, set TRUE to use automatically clustered data</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Function is using labeled dataset and tries several different random
neural network structures. Once the best neural network is found then the
better model is selected and stored. Dataset can be either manually labelled
or generated using function mt_stat_transf.R. In the latter case parameter
is_cluster shall be set to TRUE.
</p>


<h3>Value</h3>

<p>Function is writing file object with the model
</p>


<h3>Author(s)</h3>

<p>(C) 2020, 2021 Vladimir Zhbanko
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


library(dplyr)
library(magrittr)
library(readr)
library(h2o)
library(lazytrade)
library(stats)

path_model &lt;- normalizePath(tempdir(),winslash = "/")
path_data &lt;- normalizePath(tempdir(),winslash = "/")

data(macd_ML60M)

Sys.sleep(5)

# start h2o engine
h2o.init(nthreads = 2)


# performing Deep Learning Classification using manually labelled data
mt_make_model(indicator_dataset = macd_ML60M,
              num_bars = 64,
              timeframe = 60,
              path_model = path_model,
              path_data = path_data,
              activate_balance = TRUE,
              num_nn_options = 3,
              num_epoch = 10)

data(price_dataset_big)
data &lt;- head(price_dataset_big, 5000) #reduce computational time

ai_class &lt;- mt_stat_transf(indicator_dataset = data,
                      num_bars = 64,
                      timeframe = 60,
                      path_data = path_data,
                      mt_classes = c('BUN', 'BEN', 'RAN'))

# performing Deep Learning Classification using the custom function auto clustered data
mt_make_model(indicator_dataset = ai_class,
              num_bars = 64,
              timeframe = 60,
              path_model = path_model,
              path_data = path_data,
              activate_balance = TRUE,
              num_nn_options = 6,
              num_epoch = 10,
              is_cluster = TRUE)

# performing Deep Learning Classification using the custom function auto clustered data
# and fixed nn structure
mt_make_model(indicator_dataset = ai_class,
              num_bars = 64,
              timeframe = 60,
              path_model = path_model,
              path_data = path_data,
              activate_balance = TRUE,
              num_nn_options = 0,
              fixed_nn_struct = c(10, 10),
              num_epoch = 10,
              is_cluster = TRUE)
              
# stop h2o engine
h2o.shutdown(prompt = FALSE)

#set delay to insure h2o unit closes properly before the next test
Sys.sleep(5)





</code></pre>

<hr>
<h2 id='mt_stat_evaluate'>Function to prepare and score data, finally predict current market type using pre-trained classification model</h2><span id='topic+mt_stat_evaluate'></span>

<h3>Description</h3>

<p>PURPOSE: Function that uses Deep Learning model and Time Series Column of the dataframe
to find out specific market type of the financial asset
it will also discard bad result outputting -1 if it is the case
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mt_stat_evaluate(x, path_model, num_bars, timeframe)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mt_stat_evaluate_+3A_x">x</code></td>
<td>

<ul>
<li><p> dataframe with one column containing asset indicator in the time descending order,
typically 64 or more values
</p>
</li></ul>
</td></tr>
<tr><td><code id="mt_stat_evaluate_+3A_path_model">path_model</code></td>
<td>
<p>String, path to the model</p>
</td></tr>
<tr><td><code id="mt_stat_evaluate_+3A_num_bars">num_bars</code></td>
<td>
<p>Integer, Number of bars used to perform transformation</p>
</td></tr>
<tr><td><code id="mt_stat_evaluate_+3A_timeframe">timeframe</code></td>
<td>
<p>Integer, timeframe in Minutes.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>dataframe with predicted value of the market type
</p>


<h3>Author(s)</h3>

<p>(C) 2021 Vladimir Zhbanko
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


library(h2o)
library(magrittr)
library(dplyr)
library(readr)
library(lazytrade)
library(stats)

path_model &lt;- normalizePath(tempdir(),winslash = "/")
path_data &lt;- normalizePath(tempdir(),winslash = "/")


# start h2o engine (using all CPU's by default)
h2o.init(nthreads = 2)

data(price_dataset_big)
data &lt;- head(price_dataset_big, 500) #reduce computational time

ai_class &lt;- mt_stat_transf(indicator_dataset = data,
                      num_bars = 64,
                      timeframe = 60,
                      path_data = path_data,
                      mt_classes = c('BUN', 'BEN', 'RAN'))

# performing Deep Learning Classification using the custom function auto clustered data
mt_make_model(indicator_dataset = ai_class,
              num_bars = 64,
              timeframe = 60,
              path_model = path_model,
              path_data = path_data,
              activate_balance = TRUE,
              num_nn_options = 3,
              num_epoch = 10,
              is_cluster = TRUE)


# Use sample data
data(price_dataset)

# use one column for testing
x &lt;- price_dataset[ ,2]


mt_stat_evaluate(x = x,
                 path_model = path_model,
                 num_bars = 64,
                 timeframe = 60)

h2o.shutdown(prompt = FALSE)

#set delay to insure h2o unit closes properly before the next test
Sys.sleep(5)



</code></pre>

<hr>
<h2 id='mt_stat_transf'>Perform Statistical transformation and clustering of Market Types on the price data</h2><span id='topic+mt_stat_transf'></span>

<h3>Description</h3>

<p>Function features methods of statistical data transformation and clustering of the price data.
Multiple statistical properties are calculated for a defined time interval. Once combined,
unsupervised learning (clustering) is performed to assign several classes, see function <code>mt_make_model</code>.
Function allows to fully automatize financial periods classification.
It is possible to choose two clustering methods either kmeans or hierarchical clustering.
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mt_stat_transf(
  indicator_dataset,
  num_bars = 64,
  timeframe = 60,
  path_data,
  mt_classes,
  clust_method = "kmeans",
  clust_opt = "complete",
  rule_opt = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mt_stat_transf_+3A_indicator_dataset">indicator_dataset</code></td>
<td>
<p>Dataframe, multiple column dataset containing price data in each column.
Each row is a time index, multiple columns are required but not strictly needed</p>
</td></tr>
<tr><td><code id="mt_stat_transf_+3A_num_bars">num_bars</code></td>
<td>
<p>Integer, Number of bars used to perform transformation</p>
</td></tr>
<tr><td><code id="mt_stat_transf_+3A_timeframe">timeframe</code></td>
<td>
<p>Integer, Data timeframe in Minutes, only used for naming convention</p>
</td></tr>
<tr><td><code id="mt_stat_transf_+3A_path_data">path_data</code></td>
<td>
<p>String, User path where the dataset could be stored for the future use by other function</p>
</td></tr>
<tr><td><code id="mt_stat_transf_+3A_mt_classes">mt_classes</code></td>
<td>
<p>Character Vector, with 2 or more Market Type classes</p>
</td></tr>
<tr><td><code id="mt_stat_transf_+3A_clust_method">clust_method</code></td>
<td>
<p>Character, option to select which clustering method to choose. Could be either
'kmeans' or 'hclust'. Default value is 'kmeans'</p>
</td></tr>
<tr><td><code id="mt_stat_transf_+3A_clust_opt">clust_opt</code></td>
<td>
<p>Character, option to select how to perform h clustering
&quot;average&quot;, &quot;single&quot;, &quot;complete&quot;, &quot;ward&quot;. Default value is 'complete'</p>
</td></tr>
<tr><td><code id="mt_stat_transf_+3A_rule_opt">rule_opt</code></td>
<td>
<p>Boolean, option to perform rule-based Market Type Assignment, defaults to TRUE</p>
</td></tr>
</table>


<h3>Details</h3>

<p>User can define several market type classes names however function will randomly assign
Market Period labels based on Unsupervised Learning. This is inconvenient however that should be compensated by
automated way of doing such data classification
</p>


<h3>Value</h3>

<p>Dataframe with statistically transformed and classified dataset for classification modeling
</p>


<h3>Author(s)</h3>

<p>(C) 2021 Vladimir Zhbanko
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(stats)
library(magrittr)
library(readr)
library(lazytrade)

path_data &lt;- normalizePath(tempdir(),winslash = "/")

data(price_dataset_big)

#option
#mt_classes = c('BUN', 'BEN', 'RAN','BUV', 'BEV', 'RAV')
#mt_classes = c('BUN', 'BEN', 'RAN')
#clust_method = 'hclust'
#clust_opt = 'ward'

#build dataset for Market Type detection without rule based check
ai_class_rand &lt;- mt_stat_transf(indicator_dataset = price_dataset_big,
                                num_bars = 64,
                                timeframe = 60,
                                path_data = path_data,
                                mt_classes = c('BUN', 'BEN', 'RAN'),
                                clust_method = 'kmeans',
                                clust_opt = 'complete',
                                rule_opt = FALSE)

#use rule base check
ai_class_rule &lt;- mt_stat_transf(indicator_dataset = price_dataset_big,
                                num_bars = 64,
                                timeframe = 60,
                                path_data = path_data,
                                mt_classes = c('BUN', 'BEN', 'RAN'),
                                clust_method = 'kmeans',
                                clust_opt = 'complete',
                                rule_opt = TRUE)


</code></pre>

<hr>
<h2 id='opt_aggregate_results'>Function to aggregate trading results from multiple folders and files</h2><span id='topic+opt_aggregate_results'></span>

<h3>Description</h3>

<p>Read multiple '.csv' files stored in different folders
Store results to the intermediate dataframe.
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>opt_aggregate_results(path_data)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="opt_aggregate_results_+3A_path_data">path_data</code></td>
<td>

<ul>
<li><p> String, path to the folder containing subfolders
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>user must provide the path to the files in the folders
all files in subfolders are read and aggregated into one data object.
Data object is sorted in descending order by order close time
</p>


<h3>Value</h3>

<p>Dataframe with trading results
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 library(lazytrade)
 library(readr)
 library(dplyr)
 library(magrittr)
 library(lubridate)

 dir &lt;- normalizePath(tempdir(),winslash = "/")

 file.copy(from = system.file("extdata/RES", package = "lazytrade"),
           to = dir, recursive = TRUE)

 DF_RES &lt;- opt_aggregate_results(path_data = file.path(dir, "RES"))


</code></pre>

<hr>
<h2 id='opt_create_graphs'>Function to create summary graphs of the trading results</h2><span id='topic+opt_create_graphs'></span>

<h3>Description</h3>

<p>Create graphs and store them into pdf file
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>opt_create_graphs(x, outp_path, graph_type = "pdf")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="opt_create_graphs_+3A_x">x</code></td>
<td>

<ul>
<li><p> dataframe with aggregated trading results
</p>
</li></ul>
</td></tr>
<tr><td><code id="opt_create_graphs_+3A_outp_path">outp_path</code></td>
<td>

<ul>
<li><p> path to the folder where to write file
</p>
</li></ul>
</td></tr>
<tr><td><code id="opt_create_graphs_+3A_graph_type">graph_type</code></td>
<td>

<ul>
<li><p> character, one of the options c('ts', 'bars', 'pdf')
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>bar graph and time series optionally written to the pdf file.
File is named with a date of analysis to the location specified by the user
</p>


<h3>Value</h3>

<p>graphic output
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
 library(lazytrade)
 library(readr)
 library(dplyr)
 library(magrittr)
 library(lubridate)
 library(ggplot2)
 data(DFR)
 dir &lt;- normalizePath(tempdir(),winslash = "/")
 # create pdf file with two graphs
 opt_create_graphs(x = DFR, outp_path = dir)

 # only show time series plot
 opt_create_graphs(x = DFR, graph_type = 'ts')


</code></pre>

<hr>
<h2 id='policy_tr_systDF'>Table with Market Types and sample of actual policy for those states</h2><span id='topic+policy_tr_systDF'></span>

<h3>Description</h3>

<p>Table with Market Types and sample of actual policy for those states
</p>


<h3>Usage</h3>

<pre><code class='language-R'>policy_tr_systDF
</code></pre>


<h3>Format</h3>

<p>A dataframe with 2 columns:
</p>

<dl>
<dt>MarketType</dt><dd><p>Current Market Type status</p>
</dd>
<dt>Policy</dt><dd><p>Policy choice</p>
</dd>
</dl>


<hr>
<h2 id='price_dataset'>Table with price dataset</h2><span id='topic+price_dataset'></span>

<h3>Description</h3>

<p>Table with price dataset
</p>


<h3>Usage</h3>

<pre><code class='language-R'>price_dataset
</code></pre>


<h3>Format</h3>

<p>A dataframe with several columns
</p>

<dl>
<dt>X1</dt><dd><p>Date and time of the price sample</p>
</dd>
<dt>X2-X29</dt><dd><p>Values of the assets</p>
</dd>
</dl>


<hr>
<h2 id='price_dataset_big'>Table with price dataset, 30000 rows</h2><span id='topic+price_dataset_big'></span>

<h3>Description</h3>

<p>Table with price dataset, 30000 rows
</p>


<h3>Usage</h3>

<pre><code class='language-R'>price_dataset_big
</code></pre>


<h3>Format</h3>

<p>A dataframe with several columns
</p>

<dl>
<dt>X1</dt><dd><p>Date and time of the price sample</p>
</dd>
<dt>X2-X29</dt><dd><p>Values of the assets</p>
</dd>
</dl>


<hr>
<h2 id='profit_factor_data'>Table with Trade results samples</h2><span id='topic+profit_factor_data'></span>

<h3>Description</h3>

<p>Table with Trade results samples
</p>


<h3>Usage</h3>

<pre><code class='language-R'>profit_factor_data
</code></pre>


<h3>Format</h3>

<p>A dataframe with several columns
</p>

<dl>
<dt>X1</dt><dd><p>Unique identifiers of the Trading Robots</p>
</dd>
<dt>X2</dt><dd><p>Ticket Number of closed position</p>
</dd>
<dt>X3</dt><dd><p>Date and Time when order started</p>
</dd>
<dt>X4</dt><dd><p>Date and Time when order closed</p>
</dd>
<dt>X5</dt><dd><p>Monetary result of the trade</p>
</dd>
<dt>X6</dt><dd><p>Symbol of the Asset e.g. EURUSD</p>
</dd>
<dt>X7</dt><dd><p>Order Type 0 - buy, 1 - sell</p>
</dd>
</dl>


<hr>
<h2 id='profit_factorDF'>Table with Trade results samples</h2><span id='topic+profit_factorDF'></span>

<h3>Description</h3>

<p>Table with Trade results samples
</p>


<h3>Usage</h3>

<pre><code class='language-R'>profit_factorDF
</code></pre>


<h3>Format</h3>

<p>A dataframe with several columns
</p>

<dl>
<dt>MagicNumber</dt><dd><p>Unique identifiers of the Trading Robots</p>
</dd>
<dt>TicketNumber</dt><dd><p>Ticket Number of closed position</p>
</dd>
<dt>OrderStartTime</dt><dd><p>Date and Time when order started</p>
</dd>
<dt>OrderCloseTime</dt><dd><p>Date and Time when order closed</p>
</dd>
<dt>Profit</dt><dd><p>Monetary result of the trade</p>
</dd>
<dt>Symbol</dt><dd><p>Symbol of the Asset e.g. EURUSD</p>
</dd>
<dt>OrderType</dt><dd><p>Order Type 0 - buy, 1 - sell</p>
</dd>
</dl>


<hr>
<h2 id='result_prev'>Table with one column as result from the model prediction</h2><span id='topic+result_prev'></span>

<h3>Description</h3>

<p>Table with one column as result from the model prediction
</p>


<h3>Usage</h3>

<pre><code class='language-R'>result_prev
</code></pre>


<h3>Format</h3>

<p>A dataframe with one column
</p>

<dl>
<dt>predict</dt><dd><p>Predicted values from the model</p>
</dd>
</dl>


<hr>
<h2 id='result_R'>Table with predicted price change</h2><span id='topic+result_R'></span>

<h3>Description</h3>

<p>Table with predicted price change
</p>


<h3>Usage</h3>

<pre><code class='language-R'>result_R
</code></pre>


<h3>Format</h3>

<p>A dataframe with one column
</p>

<dl>
<dt>predict</dt><dd><p>predicted future price change</p>
</dd>
</dl>


<hr>
<h2 id='result_R1'>Table with aggregated trade results</h2><span id='topic+result_R1'></span>

<h3>Description</h3>

<p>Table with aggregated trade results
</p>


<h3>Usage</h3>

<pre><code class='language-R'>result_R1
</code></pre>


<h3>Format</h3>

<p>A dataframe with one column
</p>

<dl>
<dt>predict</dt><dd><p>predicted price change</p>
</dd>
</dl>


<hr>
<h2 id='rl_generate_policy'>Function performs Reinforcement Learning using the past data to generate model policy</h2><span id='topic+rl_generate_policy'></span>

<h3>Description</h3>

<p>This function will perform Reinforcement Learning using Trading Data.
It will suggest whether or not it is better to keep using trading systems or not.
Function is just using results of the past performance to generate the recommendation (not a holy grail).
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rl_generate_policy(x, states, actions, control)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rl_generate_policy_+3A_x">x</code></td>
<td>

<ul>
<li><p> Dataframe containing trading data
</p>
</li></ul>
</td></tr>
<tr><td><code id="rl_generate_policy_+3A_states">states</code></td>
<td>

<ul>
<li><p> Character vector, Selected states of the System
</p>
</li></ul>
</td></tr>
<tr><td><code id="rl_generate_policy_+3A_actions">actions</code></td>
<td>

<ul>
<li><p> Character vector, Selected actions executed under environment
</p>
</li></ul>
</td></tr>
<tr><td><code id="rl_generate_policy_+3A_control">control</code></td>
<td>

<ul>
<li><p> List, control parameters as defined in the Reinforcement Learning Package
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>Initial policy is generated using a dummy zero values.
This way function starts working directly from the first observation.
However policy 'ON' value will only be generated once the Q value is greater than zero
</p>


<h3>Value</h3>

<p>Function returns data frame with reinforcement learning model policy
</p>


<h3>Author(s)</h3>

<p>(C) 2019,2021 Vladimir Zhbanko
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
  library(dplyr)
  library(ReinforcementLearning)
  library(magrittr)
  library(lazytrade)

  data(data_trades)
  states &lt;- c("tradewin", "tradeloss")
  actions &lt;- c("ON", "OFF")
  control &lt;- list(alpha = 0.7, gamma = 0.3, epsilon = 0.1)
  rl_generate_policy(x = data_trades,
                     states, actions, control)


</code></pre>

<hr>
<h2 id='rl_generate_policy_mt'>Function performs RL and generates model policy for each Market Type</h2><span id='topic+rl_generate_policy_mt'></span>

<h3>Description</h3>

<p>This function will perform Reinforcement Learning using Trading Data.
It will suggest whether or not it is better to keep using trading systems or not.
Function is just using results of the past performance to generate the recommendation (not a holy grail).
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rl_generate_policy_mt(x, states, actions, control)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rl_generate_policy_mt_+3A_x">x</code></td>
<td>

<ul>
<li><p> Dataframe containing trading data
</p>
</li></ul>
</td></tr>
<tr><td><code id="rl_generate_policy_mt_+3A_states">states</code></td>
<td>

<ul>
<li><p> Character vector, Selected states of the System
</p>
</li></ul>
</td></tr>
<tr><td><code id="rl_generate_policy_mt_+3A_actions">actions</code></td>
<td>

<ul>
<li><p> Character vector, Selected actions executed under environment
</p>
</li></ul>
</td></tr>
<tr><td><code id="rl_generate_policy_mt_+3A_control">control</code></td>
<td>

<ul>
<li><p> List, control parameters as defined in the Reinforcement Learning Package
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>Initial policy is generated using a dummy zero values.
This way function starts working directly from the first observation.
However policy 'ON' value will only be generated once the Q value is greater than zero
</p>


<h3>Value</h3>

<p>Function returns data frame with reinforcement learning model policy
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(magrittr)
library(ReinforcementLearning)
library(lazytrade)
data(trading_systemDF)
states &lt;- c("BUN", "BUV", "BEN", "BEV", "RAN", "RAV")
actions &lt;- c("ON", "OFF")
control &lt;- list(alpha = 0.7, gamma = 0.3, epsilon = 0.1)
rl_generate_policy_mt(x = trading_systemDF,
                      states = states,
                      actions = actions,
                      control = control)


</code></pre>

<hr>
<h2 id='rl_log_progress'>Function to retrieve and help to log Q values during RL progress.</h2><span id='topic+rl_log_progress'></span>

<h3>Description</h3>

<p>Function will record Q values during the model update. These values will be used by another function
Function was developed to help to estimate best control parameters during optimisation process
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rl_log_progress(x, states, actions, control)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rl_log_progress_+3A_x">x</code></td>
<td>

<ul>
<li><p> dataframe containing trading results
</p>
</li></ul>
</td></tr>
<tr><td><code id="rl_log_progress_+3A_states">states</code></td>
<td>

<ul>
<li><p> Selected states of the System
</p>
</li></ul>
</td></tr>
<tr><td><code id="rl_log_progress_+3A_actions">actions</code></td>
<td>

<ul>
<li><p> Selected actions executed under environment
</p>
</li></ul>
</td></tr>
<tr><td><code id="rl_log_progress_+3A_control">control</code></td>
<td>

<ul>
<li><p> control parameters as defined in the Reinforcement Learning Package
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>dataframe with log of RL model reward sequences during model update
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# retrieve RL model Q values progress
library(ReinforcementLearning)
library(dplyr)
library(magrittr)
library(lazytrade)
data(data_trades)
x &lt;- data_trades
states &lt;- c("tradewin", "tradeloss")
actions &lt;- c("ON", "OFF")
control &lt;- list(alpha = 0.7, gamma = 0.3, epsilon = 0.1)

rl_log_progress(x = x,states = states, actions = actions, control = control)

</code></pre>

<hr>
<h2 id='rl_log_progress_mt'>Function to retrieve and help to log Q values during RL progress. This function is dedicated to the situations when
Market Types are used as a 'states' for the Environment.</h2><span id='topic+rl_log_progress_mt'></span>

<h3>Description</h3>

<p>Function will record Q values during the model update. These values will be used by another function
Function was developed to help to estimate best control parameters during optimisation process
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rl_log_progress_mt(x, states, actions, control)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rl_log_progress_mt_+3A_x">x</code></td>
<td>

<ul>
<li><p> dataframe containing trading results
</p>
</li></ul>
</td></tr>
<tr><td><code id="rl_log_progress_mt_+3A_states">states</code></td>
<td>

<ul>
<li><p> Selected states of the System
</p>
</li></ul>
</td></tr>
<tr><td><code id="rl_log_progress_mt_+3A_actions">actions</code></td>
<td>

<ul>
<li><p> Selected actions executed under environment
</p>
</li></ul>
</td></tr>
<tr><td><code id="rl_log_progress_mt_+3A_control">control</code></td>
<td>

<ul>
<li><p> control parameters as defined in the Reinforcement Learning Package
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>dataframe with log of RL model reward sequences during model update
</p>


<h3>Author(s)</h3>

<p>(C) 2020, 2021 Vladimir Zhbanko
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# retrieve RL model Q values progress
library(ReinforcementLearning)
library(dplyr)
library(magrittr)
library(lazytrade)
data(trading_systemDF)
x &lt;- trading_systemDF
states &lt;- c("BUN", "BUV", "BEN", "BEV", "RAN", "RAV")
actions &lt;- c("ON", "OFF") # 'ON' and 'OFF' are referring to decision to trade with Slave system
control &lt;- list(alpha = 0.7, gamma = 0.3, epsilon = 0.1)

rl_log_progress_mt(x = x,states = states, actions = actions, control = control)


</code></pre>

<hr>
<h2 id='rl_record_policy'>Record Reinforcement Learning Policy.</h2><span id='topic+rl_record_policy'></span>

<h3>Description</h3>

<p>Function will write a policy 'decision' to the csv file specific for each Expert Advisor
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rl_record_policy(
  x,
  last_result,
  trading_system,
  path_terminal,
  fileName = "SystemControl"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rl_record_policy_+3A_x">x</code></td>
<td>

<ul>
<li><p> Dataframe containing columns MarketType and Policy
</p>
</li></ul>
</td></tr>
<tr><td><code id="rl_record_policy_+3A_last_result">last_result</code></td>
<td>

<ul>
<li><p> character vector of the last result of the trade
</p>
</li></ul>
</td></tr>
<tr><td><code id="rl_record_policy_+3A_trading_system">trading_system</code></td>
<td>

<ul>
<li><p> character vector of length 1 with Trading System Magic Number information
</p>
</li></ul>
</td></tr>
<tr><td><code id="rl_record_policy_+3A_path_terminal">path_terminal</code></td>
<td>

<ul>
<li><p> path to the sandbox where this Policy/Decision must be written
</p>
</li></ul>
</td></tr>
<tr><td><code id="rl_record_policy_+3A_filename">fileName</code></td>
<td>

<ul>
<li><p> string, desired control file prefix e.g. 'SystemControl'
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>It is imperative that terminal path contains exact word Terminal3
</p>


<h3>Value</h3>

<p>nothing is returned but function will write csv file to the supplied directory
</p>


<h3>Author(s)</h3>

<p>(C) 2019,2021 Vladimir Zhbanko
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

library(stringr)
library(magrittr)
library(dplyr)
data(TradeStatePolicy)

dir &lt;- normalizePath(tempdir(),winslash = "/")

rl_record_policy(x = TradeStatePolicy,
              last_result = "tradewin",
              trading_system = 8118101,
              path_terminal = dir,
              fileName = "SystemControlRL")



</code></pre>

<hr>
<h2 id='rl_record_policy_mt'>Record Reinforcement Learning Policy for Market Types</h2><span id='topic+rl_record_policy_mt'></span>

<h3>Description</h3>

<p>Function will write a policy 'decision' to the csv file specific for each Expert Advisor
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rl_record_policy_mt(
  x,
  trading_system,
  path_terminal,
  fileName = "SystemControlMT"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rl_record_policy_mt_+3A_x">x</code></td>
<td>

<ul>
<li><p> Dataframe containing columns MarketType and Policy
</p>
</li></ul>
</td></tr>
<tr><td><code id="rl_record_policy_mt_+3A_trading_system">trading_system</code></td>
<td>

<ul>
<li><p> numeric vector of length 1 with Trading System Magic Number information
</p>
</li></ul>
</td></tr>
<tr><td><code id="rl_record_policy_mt_+3A_path_terminal">path_terminal</code></td>
<td>

<ul>
<li><p> string, path to the terminal where this Policy/Decision must be written
</p>
</li></ul>
</td></tr>
<tr><td><code id="rl_record_policy_mt_+3A_filename">fileName</code></td>
<td>

<ul>
<li><p> string, desired control file prefix e.g. 'SystemControlMT'
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>It is imperative that terminal path contains exact word Terminal3
</p>


<h3>Value</h3>

<p>nothing is returned but function will write csv file to the supplied directory
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

library(stringr)
library(lazytrade)
data(policy_tr_systDF)

dir &lt;- normalizePath(tempdir(),winslash = "/")

rl_record_policy_mt(x = policy_tr_systDF,
                 trading_system = 8118101,
                 path_terminal = dir,
                 fileName = "SystemControlMT")


</code></pre>

<hr>
<h2 id='rl_write_control_parameters'>Function to find and write the best control parameters.</h2><span id='topic+rl_write_control_parameters'></span>

<h3>Description</h3>

<p>This function is supposed to run on a weekly basis. Purpose of this function is to perform RL and
trading simulation and find out the best possible control parameters for the RL function.
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rl_write_control_parameters(
  x,
  path_control_files,
  num_trades_to_consider = 100
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rl_write_control_parameters_+3A_x">x</code></td>
<td>

<ul>
<li><p> dataset containing the trading results for one trading robot
</p>
</li></ul>
</td></tr>
<tr><td><code id="rl_write_control_parameters_+3A_path_control_files">path_control_files</code></td>
<td>

<ul>
<li><p> path where control parameters will be saved
</p>
</li></ul>
</td></tr>
<tr><td><code id="rl_write_control_parameters_+3A_num_trades_to_consider">num_trades_to_consider</code></td>
<td>

<ul>
<li><p> number of last trades to use for RL modeling simulations, default value 100
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>Function is used by the R script Adapt_RL_control.R
</p>


<h3>Value</h3>

<p>Function writes best control parameters to be used by the Reinforcement Learning Function
</p>


<h3>Author(s)</h3>

<p>(C) 2019 Vladimir Zhbanko
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


dir &lt;- normalizePath(tempdir(),winslash = "/")
#test lasts 15 sec:
library(dplyr)
library(readr)
library(ReinforcementLearning)
library(magrittr)
library(lazytrade)
data(data_trades)
x &lt;- data_trades
rl_write_control_parameters(x = data_trades,
                            path_control_files = dir,
                            num_trades_to_consider = 20)



</code></pre>

<hr>
<h2 id='rl_write_control_parameters_mt'>Function to find and write the best control parameters.</h2><span id='topic+rl_write_control_parameters_mt'></span>

<h3>Description</h3>

<p>This function is supposed to run on a weekly basis. Purpose of this function is to perform RL and
trading simulation and find out the best possible control parameters for the RL function.
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rl_write_control_parameters_mt(
  x,
  path_control_files,
  num_trades_to_consider = 100
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rl_write_control_parameters_mt_+3A_x">x</code></td>
<td>

<ul>
<li><p> dataset containing the trading results for one trading robot
</p>
</li></ul>
</td></tr>
<tr><td><code id="rl_write_control_parameters_mt_+3A_path_control_files">path_control_files</code></td>
<td>

<ul>
<li><p> path where control parameters will be saved
</p>
</li></ul>
</td></tr>
<tr><td><code id="rl_write_control_parameters_mt_+3A_num_trades_to_consider">num_trades_to_consider</code></td>
<td>

<ul>
<li><p> number of last trades to use for RL modeling simulations, default value 100
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>Function is used by the R script Adapt_RL_MT_control.R
</p>


<h3>Value</h3>

<p>Function writes best control parameters to be used by the Reinforcement Learning Function
</p>


<h3>Author(s)</h3>

<p>(C) 2019, 2021 Vladimir Zhbanko
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

# test lasts 15 sec:
dir &lt;- normalizePath(tempdir(),winslash = "/")

library(dplyr)
library(readr)
library(ReinforcementLearning)
library(magrittr)
library(lazytrade)
data(trading_systemDF)

# use optimal control parameters found by auxiliary function
rl_write_control_parameters_mt(x = trading_systemDF,
                               path_control_files = dir,
                               num_trades_to_consider = 100)



</code></pre>

<hr>
<h2 id='test_data_pattern'>Table with several columns containing indicator values and Label values</h2><span id='topic+test_data_pattern'></span>

<h3>Description</h3>

<p>Table with several columns containing indicator values and Label values
</p>


<h3>Usage</h3>

<pre><code class='language-R'>test_data_pattern
</code></pre>


<h3>Format</h3>

<p>A dataframe with several columns
</p>

<dl>
<dt>LABEL</dt><dd><p>Asset values as were recorded in the future</p>
</dd>
<dt>V1-V49</dt><dd><p>Transposed values of the indicator</p>
</dd>
</dl>


<hr>
<h2 id='to_m'>Convert time series data to matrix with defined number of columns</h2><span id='topic+to_m'></span>

<h3>Description</h3>

<p>Transforms Time Series Column of the dataframe to the matrix with specified number of columns.
Number of rows will be automatically found. Eventually not complete last row will be discarded.
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#superseded"><img src="../help/figures/lifecycle-superseded.svg" alt='[Superseded]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>to_m(x, n_cols)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="to_m_+3A_x">x</code></td>
<td>

<ul>
<li><p> dataframe with one column
</p>
</li></ul>
</td></tr>
<tr><td><code id="to_m_+3A_n_cols">n_cols</code></td>
<td>

<ul>
<li><p> number of columns in the matrix
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>


<ul>
<li><p> matrix with specified amount of rows
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
library(magrittr)
library(lazytrade)
macd_m &lt;- seq(1:1000) %&gt;% as.data.frame() %&gt;% to_m(64)


</code></pre>

<hr>
<h2 id='TradeStatePolicy'>Table with Trade States and sample of actual policy for those states</h2><span id='topic+TradeStatePolicy'></span>

<h3>Description</h3>

<p>Table with Trade States and sample of actual policy for those states
</p>


<h3>Usage</h3>

<pre><code class='language-R'>TradeStatePolicy
</code></pre>


<h3>Format</h3>

<p>A dataframe with 2 columns:
</p>

<dl>
<dt>TradeState</dt><dd><p>Current trade state status</p>
</dd>
<dt>Policy</dt><dd><p>Policy choice</p>
</dd>
</dl>


<hr>
<h2 id='trading_systemDF'>Table with trade data and joined market type info</h2><span id='topic+trading_systemDF'></span>

<h3>Description</h3>

<p>Table with trade data and joined market type info
</p>


<h3>Usage</h3>

<pre><code class='language-R'>trading_systemDF
</code></pre>


<h3>Format</h3>

<p>A dataframe with several columns
</p>

<dl>
<dt>&quot;MagicNumber.x</dt><dd><p>Unique identifiers of the Trading Robots from Trade Log</p>
</dd>
<dt>TicketNumber</dt><dd><p>Ticket Number of closed position</p>
</dd>
<dt>OrderStartTime</dt><dd><p>Date and Time when order started</p>
</dd>
<dt>OrderCloseTime</dt><dd><p>Date and Time when order closed</p>
</dd>
<dt>Profit</dt><dd><p>Monetary result of the trade</p>
</dd>
<dt>Symbol</dt><dd><p>Symbol of the Asset e.g. EURUSD</p>
</dd>
<dt>OrderType</dt><dd><p>Order Type 0 - buy, 1 - sell</p>
</dd>
<dt>&quot;MagicNumber.y</dt><dd><p>Unique identifiers of the Trading Robots from Ticket Opening Log</p>
</dd>
<dt>&quot;MarketType</dt><dd><p>Logged Market Type of the asset at the moment of Ticket Opening</p>
</dd>
</dl>


<hr>
<h2 id='util_find_pid'>R function to find PID of active applications</h2><span id='topic+util_find_pid'></span>

<h3>Description</h3>

<p>Utility function to find PID of the working terminal.exe application
Function is created to generate a system call to programmatically close
any given application
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>util_find_pid(tasks_running = t_running, pid_pattern = "terminal.exe")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="util_find_pid_+3A_tasks_running">tasks_running</code></td>
<td>

<ul>
<li><p> string, vector with system tasks
</p>
</li></ul>
</td></tr>
<tr><td><code id="util_find_pid_+3A_pid_pattern">pid_pattern</code></td>
<td>

<ul>
<li><p> string, pattern value to search application with
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>Function is executing a system command to get all processes running on the OS
Retrieved data is cleaned and organized to filter on required process
Function can also be used to track specific applications defined by the user
</p>


<h3>Value</h3>

<p>string with system kill command to close selected application
</p>


<h3>Author(s)</h3>

<p>(C) 2021 Vladimir Zhbanko
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(magrittr)
library(tibble)
library(stringr)
library(dplyr)

#library(readr)


dir &lt;- normalizePath(tempdir(),winslash = "/")


#tasks_running &lt;- system("tasklist", intern = TRUE)
#writeLines(tasks_running, con = file.path(dir,'tasks_running.txt'))
#t_running &lt;- readLines(con = file.path(dir,'tasks_running.txt'))

tasks_list = system.file("extdata", "tasks_running.txt",
                  package = "lazytrade")

t_running &lt;- readLines(con = tasks_list)

#generate task kill command for this application
util_find_pid(tasks_running = t_running,
              pid_pattern = 'terminal.exe')

util_find_pid(tasks_running = t_running,
              pid_pattern = 'chrome.exe')


</code></pre>

<hr>
<h2 id='util_generate_password'>R function to generate random passwords for MT4 platform or other needs</h2><span id='topic+util_generate_password'></span>

<h3>Description</h3>

<p>Utility function to generate random passwords.
Wrapper of cryptographic functions from 'openssl' library in R.
Password length can be customized.
By default function just output randomly generated 8 symbol password suitable for MT4 logins.
It is also possible to create other passwords and include special symbols.
When required, it's possible to write resulting password to the txt file.
Once generated, password is written to the destination supplied by the user.
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>util_generate_password(
  salt = "something random",
  pass_len = 8,
  write_file = FALSE,
  file_name = "",
  special_symbols = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="util_generate_password_+3A_salt">salt</code></td>
<td>
<p>string, random text supplied by the user</p>
</td></tr>
<tr><td><code id="util_generate_password_+3A_pass_len">pass_len</code></td>
<td>
<p>integer, number specifying how long should the password be</p>
</td></tr>
<tr><td><code id="util_generate_password_+3A_write_file">write_file</code></td>
<td>
<p>bool, if true writes result to the txt file</p>
</td></tr>
<tr><td><code id="util_generate_password_+3A_file_name">file_name</code></td>
<td>
<p>string, indicate path of the file where to write text result</p>
</td></tr>
<tr><td><code id="util_generate_password_+3A_special_symbols">special_symbols</code></td>
<td>
<p>bool, if true adds special symbols</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Passwords are generated using sha512 cryptographic function from openssl package.
System date and user 'salt' is used to supply initial text for cryptographic function.
Hashing function is using additional 'salt' which will be based on the current System time.
Additionally, only a part of generated string is selected and used for password.
Some letters of generated string are converted from lower to upper case.
</p>


<h3>Value</h3>

<p>string or text file with password
</p>


<h3>Author(s)</h3>

<p>(C) 2019, 2021 Vladimir Zhbanko
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(stringr)
library(magrittr)
library(openssl)
library(readr)

dir &lt;- normalizePath(tempdir(),winslash = "/")
file_path &lt;- file.path(dir, 'p.txt')

#write to file
util_generate_password(salt = 'random text', file_name = file_path)

#generate 8digit
util_generate_password(salt = 'random text')

#generate password with special symbols
util_generate_password(salt = 'random text', special_symbols = TRUE)

#generate longer password with special symbols
util_generate_password(salt = 'random text', pass_len = 10, special_symbols = TRUE)

</code></pre>

<hr>
<h2 id='util_profit_factor'>Calculate Profit Factor</h2><span id='topic+util_profit_factor'></span>

<h3>Description</h3>

<p>Calculate profit factor using a data vector with the trading results
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>util_profit_factor(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="util_profit_factor_+3A_x">x</code></td>
<td>
<p>column vector with profit or loss of the orders for one system</p>
</td></tr>
</table>


<h3>Value</h3>

<p>function should calculate profit factor for this vector and return one value also as vector
</p>


<h3>Author(s)</h3>

<p>(C) 2019 Vladimir Zhbanko
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(magrittr)
library(dplyr)
library(lazytrade)
data(profit_factor_data)
profit_factor_data %&gt;%
   group_by(X1) %&gt;%
   summarise(PnL = sum(X5),
             NumTrades = n(),
             PrFact = util_profit_factor(X5)) %&gt;%
   select(PrFact) %&gt;% head(1) %&gt;% round(3)


</code></pre>

<hr>
<h2 id='write_command_via_csv'>Write csv files with indicated commands to the external system</h2><span id='topic+write_command_via_csv'></span>

<h3>Description</h3>

<p>Function is capable to read the data and  writing multiple files
e.g. 'SystemControl8139124.csv'
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_command_via_csv(x, path_terminal = "", fileName = "SystemControl")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="write_command_via_csv_+3A_x">x</code></td>
<td>

<ul>
<li><p> dataframe object with resulting command e.g. 1 - enable; 0 - disable
</p>
</li></ul>
</td></tr>
<tr><td><code id="write_command_via_csv_+3A_path_terminal">path_terminal</code></td>
<td>

<ul>
<li><p> path to the terminal
</p>
</li></ul>
</td></tr>
<tr><td><code id="write_command_via_csv_+3A_filename">fileName</code></td>
<td>

<ul>
<li><p> desired control file prefix e.g. 'SystemControl'
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>Function is writing multiple files e.g. 'SystemControl8139124.csv' to the Sandbox
</p>
<p>typical content of the file:
&quot;Magic&quot;,&quot;IsEnabled&quot;
8139124,1
</p>


<h3>Author(s)</h3>

<p>(C) 2019, 2021 Vladimir Zhbanko
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(readr)
library(lubridate)
library(lazytrade)

path_sbxm &lt;- normalizePath(tempdir(),winslash = "/")

file.copy(from = system.file("extdata", "OrdersResultsT1.csv", package = "lazytrade"),
          to = file.path(path_sbxm, "OrdersResultsT1.csv"), overwrite = TRUE)

DFT1 &lt;- import_data(path_sbxm = path_sbxm,
                    trade_log_file = "OrdersResultsT1.csv")

DFT1 %&gt;%
group_by(MagicNumber) %&gt;% select(MagicNumber) %&gt;% mutate(IsEnabled = 0) %&gt;%
# head to shorten time of this example
head(2) %&gt;%
# write commands to disable/enable systems
write_command_via_csv(path_terminal = path_sbxm)




</code></pre>

<hr>
<h2 id='write_ini_file'>Create initialization files to launch MT4 platform with specific configuration</h2><span id='topic+write_ini_file'></span>

<h3>Description</h3>

<p>Function generate initialization files suitable for launching MT4 terminal with
specific parameters. Several options available for generating files specific for each purpose.
Option 'prod' will just use existing profile and connect to the broker server
Option 'backtest' will generate file for the robot backtest
Option 'opt' will generate file needed for the robot optimization
Option 'full' allows to specify any desired parameter
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt='[Stable]' /></a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_ini_file(
  mt4_Profile = "Default",
  mt4_MarketWatch = "Forex.set",
  mt4_Login = "1234567",
  mt4_Password = "xxxxxXX",
  mt4_Server = "BrokerServerName",
  mt4_AutoConfiguration = "false",
  mt4_EnableNews = "false",
  mt4_ExpertsEnable = "true",
  mt4_ExpertsDllImport = "true",
  mt4_ExpertsExpImport = "true",
  mt4_ExpertsTrades = "true",
  mt4_Symbol = "EURUSD",
  mt4_Period = "H1",
  mt4_Template = "Default",
  mt4_Expert = "",
  mt4_ExpertParameters = "",
  mt4_Script = "",
  mt4_ScriptParameters = "",
  mt4_TestExpert = "",
  mt4_TestExpertParameters = "",
  mt4_TestSymbol = "EURUSD",
  mt4_TestPeriod = "H1",
  mt4_TestModel = "",
  mt4_TestSpread = "",
  mt4_TestOptimization = "false",
  mt4_TestDateEnable = "true",
  mt4_TestFromDate = "",
  mt4_TestToDate = "",
  mt4_TestReport = "test report",
  mt4_TestReplaceReport = "false",
  mt4_TestShutdownTerminal = "",
  mt4_TestVisualEnable = "false",
  dss_inifilepath = "",
  dss_inifilename = "test.ini",
  dss_mode = "prod"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="write_ini_file_+3A_mt4_profile">mt4_Profile</code></td>
<td>
<p>string, the subdirectory name in the /profiles directory.
The charts will be opened in the client terminal according to the given profile.
If this parameter is not specified, the current profile will be opened</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_marketwatch">mt4_MarketWatch</code></td>
<td>
<p>string, file name (the symbolsets directory) that contains the symbol
list to be shown in the Market Watch window.</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_login">mt4_Login</code></td>
<td>
<p>string,  the number of the account to connect to at startup.
If this parameter is not specified, the current login will be used.</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_password">mt4_Password</code></td>
<td>
<p>string, the password that allows entering the system.
This parameter will be ignored if the client terminal stores personal data on the disk
and the account to be connected is in the list</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_server">mt4_Server</code></td>
<td>
<p>string,  the name of the trade server to be connected to.
The server name is the same as the name of the corresponding .srv file stored in the /config directory</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_autoconfiguration">mt4_AutoConfiguration</code></td>
<td>
<p>string, &quot;true&quot; or &quot;false&quot;
depending on whether the autoconfiguration of Data Center setting should be enabled or not.
If this parameter is not specified, the value from the current server settings will be used.</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_enablenews">mt4_EnableNews</code></td>
<td>
<p>string, either 'false' or 'true'</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_expertsenable">mt4_ExpertsEnable</code></td>
<td>
<p>string, enable/disable experts.</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_expertsdllimport">mt4_ExpertsDllImport</code></td>
<td>
<p>string, enable/disable DLL imports</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_expertsexpimport">mt4_ExpertsExpImport</code></td>
<td>
<p>string, enable/disable import of functions from external experts or MQL4 libraries.</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_expertstrades">mt4_ExpertsTrades</code></td>
<td>
<p>string, enable/disable the experts trading</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_symbol">mt4_Symbol</code></td>
<td>
<p>string,the symbol of the security the chart of which should be opened
immediately after the terminal startup</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_period">mt4_Period</code></td>
<td>
<p>string, the chart timeframe (M1, M5, M15, M30, H1, H4, D1, W1, MN).
If this parameter is not specified, H1 is used</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_template">mt4_Template</code></td>
<td>
<p>string,  the name of the template file (the templates directory),
which should be applied to the chart.</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_expert">mt4_Expert</code></td>
<td>
<p>string, the name of the expert that should be launched after the client terminal has started</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_expertparameters">mt4_ExpertParameters</code></td>
<td>
<p>string, the name of the file containing the expert parameters
(the MQL4 Presets directory).</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_script">mt4_Script</code></td>
<td>
<p>string, the name of the script, which must be launched after the client terminal startup</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_scriptparameters">mt4_ScriptParameters</code></td>
<td>
<p>string, the name of the file containing the script parameters
(the MQL5 Presets directory).</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_testexpert">mt4_TestExpert</code></td>
<td>
<p>string, the name of the expert to be launched for testing.
If this parameter has not been specified, no testing is launched.</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_testexpertparameters">mt4_TestExpertParameters</code></td>
<td>
<p>string,  the name of the file containing parameters (the tester directory).</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_testsymbol">mt4_TestSymbol</code></td>
<td>
<p>string,  the name of the symbol used for the expert testing.
If this parameter has not been specified, the latest value used in the tester is used.</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_testperiod">mt4_TestPeriod</code></td>
<td>
<p>string, the chart period (M1, M5, M15, M30, H1, H4, D1, W1, MN).
If this parameter has not been specified, H1 is used.</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_testmodel">mt4_TestModel</code></td>
<td>
<p>string, 0, 1, or 2, depending on the testing model
(Every tick, Control points, Open prices only).
If this parameter has not been specified, 0 is used (Every tick)</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_testspread">mt4_TestSpread</code></td>
<td>
<p>string, spread value that will be used for modeling Ask prices during testing.
If 0 value is specified, the strategy tester will use the current spread of a symbol at the beginning of testing</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_testoptimization">mt4_TestOptimization</code></td>
<td>
<p>string, enable/disable optimization. The values that can be taken are &quot;true&quot; or &quot;false&quot;.
If this parameter had not been specified, the &quot;false&quot; value is used.</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_testdateenable">mt4_TestDateEnable</code></td>
<td>
<p>string, enable/disable the &quot;Use date&quot; flag.
The values that can be taken are &quot;true&quot; or &quot;false&quot;.
If this parameter had not been specified, the &quot;false&quot; value is used.</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_testfromdate">mt4_TestFromDate</code></td>
<td>
<p>string, the date, from which to start testing, appeared as YYYY.MM.DD.
If this parameter has not been specified, this date is 1970.01.01.</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_testtodate">mt4_TestToDate</code></td>
<td>
<p>string, the date, on which to finish testing, appeared as YYYY.MM.DD.
If this parameter has not been specified, this date is 1970.01.01.</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_testreport">mt4_TestReport</code></td>
<td>
<p>string, the name of the test report file.
The file will be created in the client terminal directory.
A relative path can be specified, for example: tester \ MovingAverageReport&quot;.
If the extension has not been specified in the file name, the &quot;.htm&quot; will be set automatically.
If this parameter has not been specified, the test report will not be formed</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_testreplacereport">mt4_TestReplaceReport</code></td>
<td>
<p>string, enable/disable the repeated report file record.
The values that can be taken are &quot;true&quot; or &quot;false&quot;</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_testshutdownterminal">mt4_TestShutdownTerminal</code></td>
<td>
<p>string, enable/disable shutdown of the terminal
after the testing has been finished.</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_mt4_testvisualenable">mt4_TestVisualEnable</code></td>
<td>
<p>string, enable (true) or disable  (false) the visual test mode.
If the parameter is not specified, the current setting is used.</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_dss_inifilepath">dss_inifilepath</code></td>
<td>
<p>string, path on the computer where file will be stored</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_dss_inifilename">dss_inifilename</code></td>
<td>
<p>string, file name that should be written</p>
</td></tr>
<tr><td><code id="write_ini_file_+3A_dss_mode">dss_mode</code></td>
<td>
<p>string,</p>
</td></tr>
</table>


<h3>Details</h3>

<p>added value of this function is the ability to generate multiple files to backtest several robots
for several timeframes. For example it is solves the problem of doing repetitive tasks to 'backtest'
robots for several currencies and repeat this procedure over time.
</p>
<p>Most of the variables present in the function are starting with a prefix mt4_,
the remainder of the name comes from the platform documentation, see references
</p>
<p>Remaining variables are named with a prefix 'dss_' stands for 'Decision Support System', as these
are the variables used for further automation purposes
</p>
<p>Note that for simplicity reasons not all parameters are present in this function.
e.g. FTP Settings and Proxy Server settings are not present
</p>


<h3>Value</h3>

<p>output is a file with desired parameters
</p>


<h3>Author(s)</h3>

<p>(C) 2019 Vladimir Zhbanko
</p>


<h3>References</h3>

<p>All parameters used are taken from the reference documentation
https://www.metatrader4.com/en/trading-platform/help/service/start_conf_file
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(lazytrade)

dir &lt;- normalizePath(tempdir(),winslash = "/")

# test file to launch MT4 terminal with parameters
write_ini_file(mt4_Profile = "Default",
               mt4_Login = "12345678",
               mt4_Password = "password",
               mt4_Server = "BrokerServerName",
               dss_inifilepath = dir,
               dss_inifilename = "prod_T1.ini",
               dss_mode = "prod")

# test file to launch robot backtest
TO &lt;- format(as.Date(Sys.Date()), "%Y.%m.%d")
FROM &lt;- format(as.Date(Sys.Date()-60), "%Y.%m.%d")

# test file for MT4 use for backtesting
write_ini_file(mt4_Profile = "Default",
               mt4_Login = "12345678",
               mt4_Password = "password",
               mt4_Server = "BrokerServerName",
               mt4_TestExpert="FALCON_D\\Falcon_D",
               mt4_TestExpertParameters="Falcon_D.set",
               mt4_TestSymbol="EURUSD",
               mt4_TestPeriod="H1",
               mt4_TestModel="2",
               mt4_TestSpread="20",
               mt4_TestOptimization="false",
               mt4_TestDateEnable="true",
               mt4_TestFromDate=FROM,
               mt4_TestToDate=TO,
               mt4_TestReport="EURUSD_Report",
               mt4_TestReplaceReport="false",
               mt4_TestShutdownTerminal="true",
               mt4_TestVisualEnable="false",
               dss_inifilepath = dir,
               dss_inifilename = "backtest.ini",
               dss_mode = "backtest")


</code></pre>

<hr>
<h2 id='x_test_model'>Table with a dataset to test the Model</h2><span id='topic+x_test_model'></span>

<h3>Description</h3>

<p>Table with a dataset to test the Model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>x_test_model
</code></pre>


<h3>Format</h3>

<p>A dataframe with several columns
</p>

<dl>
<dt>LABEL</dt><dd><p>future price change</p>
</dd>
<dt>X1-X75</dt><dd><p>Values of the macd indicator</p>
</dd>
</dl>


<hr>
<h2 id='y'>Table with indicators and price change which is used to train model</h2><span id='topic+y'></span>

<h3>Description</h3>

<p>Table with indicators and price change which is used to train model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>y
</code></pre>


<h3>Format</h3>

<p>A dataframe with several columns
</p>

<dl>
<dt>X1</dt><dd><p>Time index</p>
</dd>
<dt>X2</dt><dd><p>Closed price now</p>
</dd>
<dt>X3</dt><dd><p>Closed price 34 bars ago</p>
</dd>
<dt>X4-X19</dt><dd><p>Series of Indicator values</p>
</dd>
<dt>LABEL</dt><dd><p>Price difference, difference between X3 and X2</p>
</dd>
</dl>


</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
