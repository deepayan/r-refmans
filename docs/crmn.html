<!DOCTYPE html><html lang="en"><head><title>Help for package crmn</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {crmn}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#crmn'><p>CRMN</p></a></li>
<li><a href='#analytes'><p>Accessor for the analytes</p></a></li>
<li><a href='#analytes_eset'><p>Accessor for the analytes</p></a></li>
<li><a href='#analytes_other'><p>Accessor for the analytes</p></a></li>
<li><a href='#dropunusedlevels'><p>Drop unused levels</p></a></li>
<li><a href='#makeX-methods'><p>Make X</p></a></li>
<li><a href='#method-methods'><p>Accessor for the method</p></a></li>
<li><a href='#mexprs-methods'><p>Matrix safe accessor of expression slot</p></a></li>
<li><a href='#mexprs-rep-methods'><p>Accessor</p></a></li>
<li><a href='#mix'><p>Dilution mixture dataset.</p></a></li>
<li><a href='#model-methods'><p>Accessor for the model</p></a></li>
<li><a href='#nFit'><p>Normalization model</p></a></li>
<li><a href='#normalize'><p>Normalize a metabolomics dataset</p></a></li>
<li><a href='#normFit'><p>Fit a normalization model</p></a></li>
<li><a href='#normPred'><p>Predict for normalization</p></a></li>
<li><a href='#pcaMuffle'><p>Muffle the pca function</p></a></li>
<li><a href='#plot.nFit'><p>Plot a statistics for CRMN normalization model</p></a></li>
<li><a href='#sFit-method'><p>Accessor for the standards model</p></a></li>
<li><a href='#show'><p>Show method for nFit</p></a></li>
<li><a href='#show_nfit'><p>Show nfit</p></a></li>
<li><a href='#standards'><p>Accessor for the Internal Standards</p></a></li>
<li><a href='#standards_eset'><p>Accessor for the Internal Standards</p></a></li>
<li><a href='#standards_other'><p>Accessor for the Internal Standards</p></a></li>
<li><a href='#standardsFit'><p>Standards model</p></a></li>
<li><a href='#standardsPred'><p>Predict effect for new data (or get fitted data)</p></a></li>
<li><a href='#weightnorm'><p>Normalize by sample weight</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Version:</td>
<td>0.0.21</td>
</tr>
<tr>
<td>Date:</td>
<td>2020-02-09</td>
</tr>
<tr>
<td>Author:</td>
<td>Henning Redestig</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Henning Redestig &lt;henning.red@gmail.com&gt;</td>
</tr>
<tr>
<td>Title:</td>
<td>CCMN and Other Normalization Methods for Metabolomics Data</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10), pcaMethods (&ge; 1.56.0), Biobase, methods</td>
</tr>
<tr>
<td>Description:</td>
<td>Implements the Cross-contribution Compensating Multiple
    standard Normalization (CCMN) method described in Redestig et
    al. (2009) Analytical Chemistry &lt;<a href="https://doi.org/10.1021%2Fac901143w">doi:10.1021/ac901143w</a>&gt;
    and other normalization algorithms.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/hredestig/crmn">https://github.com/hredestig/crmn</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Collate:</td>
<td>'classes.R' 'crmn-package.R' 'misc.R' 'norm.R' 'generic.R'</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-02-10 07:45:05 UTC; hredestig</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-02-10 21:50:10 UTC</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.0.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
</table>
<hr>
<h2 id='crmn'>CRMN</h2><span id='topic+crmn'></span><span id='topic+crmn-package'></span>

<h3>Description</h3>

<p>Normalize metabolomics data using CCMN and other methods
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> crmn </td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package </td>
</tr>
<tr>
 <td style="text-align: left;">
Developed since: </td><td style="text-align: left;"> 2009-05-14 </td>
</tr>
<tr>
 <td style="text-align: left;">
Depends: </td><td style="text-align: left;"> Biobase, pcaMethods (&gt;= 1.20.2), pls, methods </td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL (&gt;=3) </td>
</tr>
<tr>
 <td style="text-align: left;">
LazyLoad: </td><td style="text-align: left;"> yes </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>A package implementing the 'Cross-contribution compensating
multiple standard normalization' described in Redestig et al. (2009)
Analytical Chemistry, https://doi.org/10.1021/ac901143w. Can be used to
normalize metabolomics data. Do <code>openVignette("crmn")</code> to see
the manual.
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>

<hr>
<h2 id='analytes'>Accessor for the analytes</h2><span id='topic+analytes'></span>

<h3>Description</h3>

<p>Subset an data set to only contain the analytes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>analytes(object, standards=NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="analytes_+3A_object">object</code></td>
<td>
<p>an <code>ExpressionSet</code>, <code>matrix</code> or <code>data.frame</code></p>
</td></tr>
<tr><td><code id="analytes_+3A_standards">standards</code></td>
<td>
<p>a logical vector indicating which rows are internal analytes</p>
</td></tr>
<tr><td><code id="analytes_+3A_...">...</code></td>
<td>
<p>not used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>subsetted dataset
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mix)
analytes(mix)
analytes(exprs(mix), fData(mix)$tag == 'IS')
</code></pre>

<hr>
<h2 id='analytes_eset'>Accessor for the analytes</h2><span id='topic+analytes_eset'></span><span id='topic+analytes+2CExpressionSet+2Cmissing-method'></span>

<h3>Description</h3>

<p>Subset an expression set to remove the internal standards
</p>


<h3>Usage</h3>

<pre><code class='language-R'>analytes_eset(object, where = "tag", what = "IS", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="analytes_eset_+3A_object">object</code></td>
<td>
<p>an <code>ExpressionSet</code></p>
</td></tr>
<tr><td><code id="analytes_eset_+3A_where">where</code></td>
<td>
<p>Column index or name of fData which equals
<code>what</code> for the ISs (and something else for the analytes)</p>
</td></tr>
<tr><td><code id="analytes_eset_+3A_what">what</code></td>
<td>
<p>What the column <code>where</code> does not equal for
analytes. Can be vector values too.</p>
</td></tr>
<tr><td><code id="analytes_eset_+3A_...">...</code></td>
<td>
<p>not used</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>ExpressionSet</code>
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mix)
analytes(mix)
fData(mix)$test &lt;- fData(mix)$tag
analytes(mix, where="test")
</code></pre>

<hr>
<h2 id='analytes_other'>Accessor for the analytes</h2><span id='topic+analytes_other'></span><span id='topic+analytes+2Cmatrix+2Clogical-method'></span><span id='topic+analytes+2Cdata.frame+2Clogical-method'></span>

<h3>Description</h3>

<p>Subset an expression set to remove the internal standards
</p>


<h3>Usage</h3>

<pre><code class='language-R'>analytes_other(object, standards, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="analytes_other_+3A_object">object</code></td>
<td>
<p>an <code>ExpressionSet</code></p>
</td></tr>
<tr><td><code id="analytes_other_+3A_standards">standards</code></td>
<td>
<p>a logical vector indicating which rows are
internal standards</p>
</td></tr>
<tr><td><code id="analytes_other_+3A_...">...</code></td>
<td>
<p>not used</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>ExpressionSet</code>
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mix)
analytes(exprs(mix), fData(mix)$tag == 'IS')
</code></pre>

<hr>
<h2 id='dropunusedlevels'>Drop unused levels</h2><span id='topic+dropunusedlevels'></span>

<h3>Description</h3>

<p>Drop unused factor levels in a data frame.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dropunusedlevels(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="dropunusedlevels_+3A_x">x</code></td>
<td>
<p>the data frame</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>


<h3>Examples</h3>

<pre><code class='language-R'>iris[1:10,]$Species
dropunusedlevels(iris[1:10,])$Species
</code></pre>

<hr>
<h2 id='makeX-methods'>Make X</h2><span id='topic+makeX-methods'></span><span id='topic+makeX'></span><span id='topic+makeX+2CANY+2Cmatrix-method'></span><span id='topic+makeX+2CExpressionSet+2Ccharacter-method'></span>

<h3>Description</h3>

<p>Construct a design matrix
</p>


<h3>Usage</h3>

<pre><code class='language-R'>makeX(object, factors, ...)

## S4 method for signature 'ANY,matrix'
makeX(object, factors, ...)

## S4 method for signature 'ExpressionSet,character'
makeX(object, factors, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="makeX-methods_+3A_object">object</code></td>
<td>
<p>an <code>ExpressionSet</code></p>
</td></tr>
<tr><td><code id="makeX-methods_+3A_factors">factors</code></td>
<td>
<p>column names from the pheno data of <code>object</code>
or a design matrix</p>
</td></tr>
<tr><td><code id="makeX-methods_+3A_...">...</code></td>
<td>
<p>not used</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Make a design matrix from the pheno data slot of an expression
set, taking care that factors and numerical are handled
properly. No interactions are included and formula is the most
simple possible, i.e. <code>y~-1+term1+term2+...</code>. Can also be given
anything as object in which case <code>factor</code> must be a design matrix.
It that case the same design matrix is returned.
</p>


<h3>Value</h3>

<p>a design matrix
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mix)
makeX(mix, "runorder")
runorder &lt;- mix$runorder
makeX(mix, model.matrix(~-1+runorder))
</code></pre>

<hr>
<h2 id='method-methods'>Accessor for the method</h2><span id='topic+method-methods'></span><span id='topic+method'></span><span id='topic+method+2CnFit-method'></span>

<h3>Description</h3>

<p>Get the method
</p>


<h3>Usage</h3>

<pre><code class='language-R'>method(object, ...)

method(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="method-methods_+3A_object">object</code></td>
<td>
<p>an <code>nFit</code> object</p>
</td></tr>
<tr><td><code id="method-methods_+3A_...">...</code></td>
<td>
<p>not used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the method (content differs between normlization methods)
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>

<hr>
<h2 id='mexprs-methods'>Matrix safe accessor of expression slot</h2><span id='topic+mexprs-methods'></span><span id='topic+mexprs'></span><span id='topic+mexprs+2Cmatrix-method'></span><span id='topic+mexprs+2CExpressionSet-method'></span>

<h3>Description</h3>

<p>Get the expression data from an <code>ExpressionSet</code> or
just return the given matrix
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mexprs(object)

mexprs(object)

## S4 method for signature 'ExpressionSet'
mexprs(object)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mexprs-methods_+3A_object">object</code></td>
<td>
<p>an <code>ExpressionSet</code> or <code>matrix</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>the expression data
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mix)
head(mexprs(mix))
head(mexprs(exprs(mix)))
</code></pre>

<hr>
<h2 id='mexprs-rep-methods'>Accessor</h2><span id='topic+mexprs-rep-methods'></span><span id='topic+mexprs+3C-'></span><span id='topic+mexprs+3C-+2CExpressionSet+2Cmatrix-method'></span><span id='topic+mexprs+3C-+2Cmatrix+2Cmatrix-method'></span>

<h3>Description</h3>

<p>Matrix safe setter of expression slot
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mexprs(object) &lt;- value

## S4 replacement method for signature 'ExpressionSet,matrix'
mexprs(object) &lt;- value

mexprs(object) &lt;- value
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mexprs-rep-methods_+3A_object">object</code></td>
<td>
<p>an <code>ExpressionSet</code> or <code>matrix</code></p>
</td></tr>
<tr><td><code id="mexprs-rep-methods_+3A_value">value</code></td>
<td>
<p>the value to assign</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Set the expression data in an <code>ExpressionSet</code> or
just return the given matrix
</p>


<h3>Value</h3>

<p>the expression data
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mix)
test &lt;- mix
mexprs(test) &lt;- exprs(mix) * 0
head(mexprs(test))
test &lt;- exprs(mix)
mexprs(test) &lt;- test * 0
head(mexprs(test))
</code></pre>

<hr>
<h2 id='mix'>Dilution mixture dataset.</h2><span id='topic+mix'></span>

<h3>Description</h3>

<p>Mixture dilution series
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(mix)
</code></pre>


<h3>Details</h3>

<p>Multi-component dilution series. GC-TOF/MS measurements by Miyako Kusano.
Input concentrations are known and given in the original publication.
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>


<h3>Examples</h3>

<pre><code class='language-R'> data(mix)
 fData(mix)
 exprs(mix)
 pData(mix)
</code></pre>

<hr>
<h2 id='model-methods'>Accessor for the model</h2><span id='topic+model-methods'></span><span id='topic+model'></span><span id='topic+model+2CnFit-method'></span>

<h3>Description</h3>

<p>Get the model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>model(object, ...)

model(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="model-methods_+3A_object">object</code></td>
<td>
<p>an <code>nFit</code> object</p>
</td></tr>
<tr><td><code id="model-methods_+3A_...">...</code></td>
<td>
<p>not used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the model (content differs between normlization models)
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>

<hr>
<h2 id='nFit'>Normalization model</h2><span id='topic+nFit'></span><span id='topic+nFit-class'></span>

<h3>Description</h3>

<p>Common class representation for normalization models.
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>

<hr>
<h2 id='normalize'>Normalize a metabolomics dataset</h2><span id='topic+normalize'></span>

<h3>Description</h3>

<p>Normalization methods for metabolomics data
</p>


<h3>Usage</h3>

<pre><code class='language-R'>normalize(object, method, segments = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="normalize_+3A_object">object</code></td>
<td>
<p>an <code>ExpressionSet</code></p>
</td></tr>
<tr><td><code id="normalize_+3A_method">method</code></td>
<td>
<p>the desired method</p>
</td></tr>
<tr><td><code id="normalize_+3A_segments">segments</code></td>
<td>
<p>normalization in a cross-validation setup, only to use for
validation/QC purposes.</p>
</td></tr>
<tr><td><code id="normalize_+3A_...">...</code></td>
<td>
<p>passed on to <code>normFit</code> and <code>normPred</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Wrapper function for <code>normFit</code> and <code>normPred</code>
</p>


<h3>Value</h3>

<p>the normalized dataset
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>


<h3>See Also</h3>

<p><code>normFit</code>, <code>normPred</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mix)
normalize(mix, "crmn", factor="type", ncomp=3)
#other methods
normalize(mix, "one")
normalize(mix, "avg")
normalize(mix, "nomis")
normalize(mix, "t1")
normalize(mix, "ri")
normalize(mix, "median")
normalize(mix, "totL2")
## can also do normalization with matrices
Y &lt;- exprs(mix)
G &lt;- with(pData(mix), model.matrix(~-1+type))
isIS &lt;- with(fData(mix), tag == "IS")
normalize(Y, "crmn", factor=G, ncomp=3, standards=isIS)
</code></pre>

<hr>
<h2 id='normFit'>Fit a normalization model</h2><span id='topic+normFit'></span>

<h3>Description</h3>

<p>Fit the parameters for normalization of a metabolomics data set.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>normFit(
  object,
  method,
  one = "Succinate_d4",
  factors = NULL,
  lg = TRUE,
  fitfunc = lm,
  formula = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="normFit_+3A_object">object</code></td>
<td>
<p>an <code>ExpressionSet</code> or a <code>matrix</code> (with
samples as   columns) in which case the <code>standards</code> must be
passed on via <code>...</code></p>
</td></tr>
<tr><td><code id="normFit_+3A_method">method</code></td>
<td>
<p>chosen normalization method</p>
</td></tr>
<tr><td><code id="normFit_+3A_one">one</code></td>
<td>
<p>single internal standard to use for normalization</p>
</td></tr>
<tr><td><code id="normFit_+3A_factors">factors</code></td>
<td>
<p>column names in the pheno data slot describing the
biological factors. Or a design matrix directly.</p>
</td></tr>
<tr><td><code id="normFit_+3A_lg">lg</code></td>
<td>
<p>logical indicating that the data should be log
transformed</p>
</td></tr>
<tr><td><code id="normFit_+3A_fitfunc">fitfunc</code></td>
<td>
<p>the function that creates the model fit for
normalization, must use the same interfaces as <code>lm</code>.</p>
</td></tr>
<tr><td><code id="normFit_+3A_formula">formula</code></td>
<td>
<p>if fitfunc has formula interface or not</p>
</td></tr>
<tr><td><code id="normFit_+3A_...">...</code></td>
<td>
<p>passed on to <code>standardsFit</code>, <code>standards</code>,
analytes</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Normalization is first done by fitting a model and then applying
that model either to new data or the same data using
<code>normPred</code>. Five different methods are implemented.
</p>

<dl>
<dt>t1</dt><dd><p>divide by row-means of the <code class="reqn">L_2</code>  scaled internal standards</p>
</dd>
<dt>one</dt><dd><p>divide by value of a single, user defined, internal standard</p>
</dd>
<dt>totL2</dt><dd><p>divide by the square of sums of the full dataset</p>
</dd>
<dt>nomis</dt><dd><p>See Sysi-Aho et al.</p>
</dd>
<dt>crmn</dt><dd><p>See Redestig et al.</p>
</dd>
</dl>



<h3>Value</h3>

<p>a normalization model
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>


<h3>References</h3>

<p>Sysi-Aho, M.; Katajamaa, M.; Yetukuri, L. &amp; Oresic,
M. Normalization method for metabolomics data using optimal
selection of multiple internal standards. BMC Bioinformatics,
2007, 8, 93
</p>
<p>Redestig, H.; Fukushima, A.; Stenlund, H.; Moritz, T.; Arita, M.;
Saito, K. &amp; Kusano, M.  Compensation for systematic
cross-contribution improves normalization of mass spectrometry
based metabolomics data Anal Chem, 2009, 81, 7974-7980
</p>


<h3>See Also</h3>

<p><code>normPred</code>, <code>standards</code>, <code>model.matrix</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mix)
nfit &lt;- normFit(mix, "crmn", factors="type", ncomp=3)
slplot(sFit(nfit)$fit$pc, scol=as.integer(mix$runorder))
## same thing
Y &lt;- exprs(mix)
G &lt;- model.matrix(~-1+mix$type)
isIS &lt;- fData(mix)$tag == 'IS'
nfit &lt;- normFit(Y, "crmn", factors=G, ncomp=3, standards=isIS)
slplot(sFit(nfit)$fit$pc, scol=as.integer(mix$runorder))
</code></pre>

<hr>
<h2 id='normPred'>Predict for normalization</h2><span id='topic+normPred'></span>

<h3>Description</h3>

<p>Predict the normalized data using a previously fitted normalization model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>normPred(normObj, newdata, factors = NULL, lg = TRUE, predfunc = predict, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="normPred_+3A_normobj">normObj</code></td>
<td>
<p>the result from <code>normFit</code></p>
</td></tr>
<tr><td><code id="normPred_+3A_newdata">newdata</code></td>
<td>
<p>an <code>ExpressionSet</code> or a <code>matrix</code> (in
which case the <code>standards</code> must be passed on via
<code>...</code>), possibly the same as used to   fit the
normalization model in order to get the fitted data.</p>
</td></tr>
<tr><td><code id="normPred_+3A_factors">factors</code></td>
<td>
<p>column names in the pheno data slot describing the
biological factors. Or a design matrix.</p>
</td></tr>
<tr><td><code id="normPred_+3A_lg">lg</code></td>
<td>
<p>logical indicating that the data should be log
transformed</p>
</td></tr>
<tr><td><code id="normPred_+3A_predfunc">predfunc</code></td>
<td>
<p>the function to use to get predicted values from
the fitted object (only for crmn)</p>
</td></tr>
<tr><td><code id="normPred_+3A_...">...</code></td>
<td>
<p>passed on to <code>standardsPred</code>, <code>standardsFit</code>,
odestandards, <code>analytes</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Apply fitted normalization parameters to new data to get normalized data.
Current can not only handle matrices as input for methods 'RI' and 'one'.
</p>


<h3>Value</h3>

<p>the normalized data
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>


<h3>See Also</h3>

<p><code>normFit</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mix)
nfit &lt;- normFit(mix, "crmn", factor="type", ncomp=3)
normedData &lt;- normPred(nfit, mix, "type")
slplot(pca(t(log2(exprs(normedData)))), scol=as.integer(mix$type))
## same thing
Y &lt;- exprs(mix)
G &lt;- with(pData(mix), model.matrix(~-1+type))
isIS &lt;- fData(mix)$tag == 'IS'
nfit &lt;- normFit(Y, "crmn", factors=G, ncomp=3, standards=isIS)
normedData &lt;- normPred(nfit, Y, G, standards=isIS)
slplot(pca(t(log2(normedData))), scol=as.integer(mix$type))
</code></pre>

<hr>
<h2 id='pcaMuffle'>Muffle the pca function</h2><span id='topic+pcaMuffle'></span>

<h3>Description</h3>

<p>PCA and Q2 issues warnings about biasedness and poorly estimated
PCs. The first is non-informative and the poorly estimated PCs will
show up as poor overfitting which leads to a choice of fewer PCs
i.e. not a problem. This function is mean to muffle those warnings.
Only used for version of pcaMethods before 1.26.0.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pcaMuffle(w)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pcaMuffle_+3A_w">w</code></td>
<td>
<p>a warning</p>
</td></tr>
</table>


<h3>Value</h3>

<p>nothing
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>

<hr>
<h2 id='plot.nFit'>Plot a statistics for CRMN normalization model</h2><span id='topic+plot.nFit'></span><span id='topic+plot+2CnFit-method'></span>

<h3>Description</h3>

<p>Simple plot function for a CRMN normalization model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'nFit'
plot(x, y = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.nFit_+3A_x">x</code></td>
<td>
<p>an <code>nFit</code> object</p>
</td></tr>
<tr><td><code id="plot.nFit_+3A_y">y</code></td>
<td>
<p>not used</p>
</td></tr>
<tr><td><code id="plot.nFit_+3A_...">...</code></td>
<td>
<p>passed on to the scatter plot calls</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Shows Tz and the optimization (if computed) of the PCA model. The
number of components used for normalization should not exceed the
maximum indicated by Q2. The structure shown in the Tz plot
indicate the analytical variance which is exactly independent of
the experimental design. The corresponding loading plot shows how
this structure is capture by the used ISs.
</p>


<h3>Value</h3>

<p>nothing
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>


<h3>See Also</h3>

<p><code>slplot</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mix)
nfit &lt;- normFit(mix, "crmn", factors="type", ncomp=2)
plot(nfit)
</code></pre>

<hr>
<h2 id='sFit-method'>Accessor for the standards model</h2><span id='topic+sFit-method'></span><span id='topic+sFit'></span><span id='topic+sFit+2CnFit-method'></span>

<h3>Description</h3>

<p>Get the sFit
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sFit(object, ...)

sFit(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sFit-method_+3A_object">object</code></td>
<td>
<p>an <code>nFit</code> object</p>
</td></tr>
<tr><td><code id="sFit-method_+3A_...">...</code></td>
<td>
<p>not used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the sFit is only defined for CRMN
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>

<hr>
<h2 id='show'>Show method for nFit</h2><span id='topic+show'></span><span id='topic+show+2CnFit-method'></span>

<h3>Description</h3>

<p>Show some basic information for an nFit model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'nFit'
show(object)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="show_+3A_object">object</code></td>
<td>
<p>the <code>nFit</code> object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>prints some basic information
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mix)
normFit(mix, "avg")
</code></pre>

<hr>
<h2 id='show_nfit'>Show nfit</h2><span id='topic+show_nfit'></span>

<h3>Description</h3>

<p>Show method for nFit
</p>


<h3>Usage</h3>

<pre><code class='language-R'>show_nfit(object)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="show_nfit_+3A_object">object</code></td>
<td>
<p>the <code>nFit</code> object</p>
</td></tr>
</table>


<h3>Value</h3>

<p>prints some basic information
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>

<hr>
<h2 id='standards'>Accessor for the Internal Standards</h2><span id='topic+standards'></span>

<h3>Description</h3>

<p>Subset an data set to only contain the labeled internal standards.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>standards(object, standards=NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="standards_+3A_object">object</code></td>
<td>
<p>an <code>ExpressionSet</code>, <code>matrix</code> or <code>data.frame</code></p>
</td></tr>
<tr><td><code id="standards_+3A_standards">standards</code></td>
<td>
<p>a logical vector indicating which rows are internal standards</p>
</td></tr>
<tr><td><code id="standards_+3A_...">...</code></td>
<td>
<p>not used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>subsetted dataset
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mix)
standards(mix)
standards(exprs(mix), fData(mix)$tag == 'IS')
</code></pre>

<hr>
<h2 id='standards_eset'>Accessor for the Internal Standards</h2><span id='topic+standards_eset'></span><span id='topic+standards+2CExpressionSet+2Cmissing-method'></span>

<h3>Description</h3>

<p>Subset an data set to only contain the labeled internal standards.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>standards_eset(object, where = "tag", what = "IS", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="standards_eset_+3A_object">object</code></td>
<td>
<p>an <code>ExpressionSet</code></p>
</td></tr>
<tr><td><code id="standards_eset_+3A_where">where</code></td>
<td>
<p>Column index or name in fData which equals
<code>what</code> for the ISs</p>
</td></tr>
<tr><td><code id="standards_eset_+3A_what">what</code></td>
<td>
<p>What the column <code>where</code> equals for ISs</p>
</td></tr>
<tr><td><code id="standards_eset_+3A_...">...</code></td>
<td>
<p>not used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>subsetted dataset
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mix)
standards(mix)
fData(mix)$test &lt;- fData(mix)$tag
standards(mix, where="test")
</code></pre>

<hr>
<h2 id='standards_other'>Accessor for the Internal Standards</h2><span id='topic+standards_other'></span><span id='topic+standards+2Cmatrix+2Clogical-method'></span><span id='topic+standards+2Cdata.frame+2Clogical-method'></span>

<h3>Description</h3>

<p>Subset an data set to only contain the labeled internal standards.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>standards_other(object, standards, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="standards_other_+3A_object">object</code></td>
<td>
<p>an <code>matrix</code> or <code>data.frame</code></p>
</td></tr>
<tr><td><code id="standards_other_+3A_standards">standards</code></td>
<td>
<p>a logical vector indicating which rows are internal standards</p>
</td></tr>
<tr><td><code id="standards_other_+3A_...">...</code></td>
<td>
<p>not used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>subsetted dataset
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mix)
standards(exprs(mix), fData(mix)$tag == 'IS')
</code></pre>

<hr>
<h2 id='standardsFit'>Standards model</h2><span id='topic+standardsFit'></span>

<h3>Description</h3>

<p>Fit a model which describes the variation of the labeled internal
standards from the biological factors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>standardsFit(object, factors, ncomp = NULL, lg = TRUE, fitfunc = lm, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="standardsFit_+3A_object">object</code></td>
<td>
<p>an <code>ExpressionSet</code> or a <code>matrix</code>.   Note
that if you pass a<code>matrix</code> have to specify the identity of
the standards by   passing the appropriate argument to
<code>standards</code>.</p>
</td></tr>
<tr><td><code id="standardsFit_+3A_factors">factors</code></td>
<td>
<p>the biological factors described in the pheno data
slot if <code>object</code> is an <code>ExpressionSet</code> or a design
matrix if <code>object</code> is a <code>matrix</code>.</p>
</td></tr>
<tr><td><code id="standardsFit_+3A_ncomp">ncomp</code></td>
<td>
<p>number of PCA components to use.   Determined by
cross-validation if left <code>NULL</code></p>
</td></tr>
<tr><td><code id="standardsFit_+3A_lg">lg</code></td>
<td>
<p>logical indicating that the data should be log
transformed</p>
</td></tr>
<tr><td><code id="standardsFit_+3A_fitfunc">fitfunc</code></td>
<td>
<p>the function that creates the model fit for
normalization, must use the same interfaces as <code>lm</code>.</p>
</td></tr>
<tr><td><code id="standardsFit_+3A_...">...</code></td>
<td>
<p>passed on to <code>Q2</code>, <code>pca</code> (if pcaMethods &gt;
1.26.0), <code>standards</code> and <code>analytes</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>There is often unwanted variation in among the labeled internal
standards which is related to the experimental factors due to
overlapping peaks etc. This function fits a model that describes
that overlapping variation using a scaled and centered PCA /
multiple linear regression model. Scaling is done outside the PCA
model.
</p>


<h3>Value</h3>

<p>a list containing the PCA/MLR model, the recommended number of
components for that model, the standard deviations and mean values
and Q2/R2 for the fit.
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>


<h3>See Also</h3>

<p><code>makeX</code>, <code>standardsPred</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mix)
sfit &lt;- standardsFit(mix, "type", ncomp=3)
slplot(sfit$fit$pc)
## same thing
Y &lt;- exprs(mix)
G &lt;- model.matrix(~-1+mix$type)
isIS &lt;- fData(mix)$tag == 'IS'
sfit &lt;- standardsFit(Y, G, standards=isIS, ncomp=3)
</code></pre>

<hr>
<h2 id='standardsPred'>Predict effect for new data (or get fitted data)</h2><span id='topic+standardsPred'></span>

<h3>Description</h3>

<p>Predicted values for the standards
</p>


<h3>Usage</h3>

<pre><code class='language-R'>standardsPred(model, newdata, factors, lg = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="standardsPred_+3A_model">model</code></td>
<td>
<p>result from <code>standardsFit</code></p>
</td></tr>
<tr><td><code id="standardsPred_+3A_newdata">newdata</code></td>
<td>
<p>an <code>ExpressionSet</code> or <code>matrix</code> with new
data (or the data used to fit the model to get the fitted data)</p>
</td></tr>
<tr><td><code id="standardsPred_+3A_factors">factors</code></td>
<td>
<p>the biological factors described in the pheno data
slot if <code>object</code> is an <code>ExpressionSet</code> or a design
matrix if <code>object</code> is a <code>matrix</code>.</p>
</td></tr>
<tr><td><code id="standardsPred_+3A_lg">lg</code></td>
<td>
<p>logical indicating that the data should be log
transformed</p>
</td></tr>
<tr><td><code id="standardsPred_+3A_...">...</code></td>
<td>
<p>passed on to <code>standards</code> and <code>analytes</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>There is often unwanted variation in among the labeled internal
standards which is related to the experimental factors due to
overlapping peaks etc. This predicts this effect given a model of
the overlapping variance. The prediction is given by
<code class="reqn">\hat{X}_{IS}=X_{IS}-X_{IS}B</code>
</p>


<h3>Value</h3>

<p>the corrected data
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>


<h3>See Also</h3>

<p><code>makeX</code>, <code>standardsFit</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mix)
fullFit &lt;- standardsFit(mix, "type", ncomp=3)
sfit &lt;- standardsFit(mix[,-1], "type", ncomp=3)
pred &lt;- standardsPred(sfit, mix[,1], "type")
cor(scores(sfit$fit$pc)[1,], scores(fullFit$fit$pc)[1,])
## could just as well have been done as
Y &lt;- exprs(mix)
G &lt;- model.matrix(~-1+mix$type)
isIS &lt;- fData(mix)$tag == 'IS'
fullFit &lt;- standardsFit(Y, G, ncomp=3, standards=isIS)
sfit    &lt;- standardsFit(Y[,-1], G[-1,], ncomp=3,
                        standards=isIS)
pred &lt;- standardsPred(sfit, Y[,1,drop=FALSE], G[1,,drop=FALSE], standards=isIS)
cor(scores(sfit$fit$pc)[1,], scores(fullFit$fit$pc)[1,])
</code></pre>

<hr>
<h2 id='weightnorm'>Normalize by sample weight</h2><span id='topic+weightnorm'></span>

<h3>Description</h3>

<p>Normalize samples by their weight (as in grams fresh weight)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>weightnorm(object, weight = "weight", lg = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="weightnorm_+3A_object">object</code></td>
<td>
<p>an <code>ExpressionSet</code></p>
</td></tr>
<tr><td><code id="weightnorm_+3A_weight">weight</code></td>
<td>
<p>a string naming the pheno data column with the
weight or a numeric vector with one weight value per sample.</p>
</td></tr>
<tr><td><code id="weightnorm_+3A_lg">lg</code></td>
<td>
<p>is the assay data already on the log-scale or not. If
lg, the weight value is also log-transformed and subtraction is
used instead of division.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Normalize each sample by dividing by the loaded sample weight. The
weight argument is takes from the pheno data (or given as numerical
vector with one value per sample). Missing values are not
tolerated.
</p>


<h3>Value</h3>

<p>the normalized expression set
</p>


<h3>Author(s)</h3>

<p>Henning Redestig
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(mix)
w &lt;- runif(ncol(mix),1, 1.3)
weightnorm(mix, w)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
