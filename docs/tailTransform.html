<!DOCTYPE html><html><head><title>Help for package tailTransform</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {tailTransform}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#tailTransform-package'>
<p>Symmetric Transformation of Tails for Plotting Differences</p></a></li>
<li><a href='#aHDL'>
<p>Alcohol and HDL Cholesterol: An Observational Study with 3 Control Groups</p></a></li>
<li><a href='#boxplotTT'>
<p>Parallel Boxplots After Tail Transformation</p></a></li>
<li><a href='#ttrans'>
<p>Symmetric Tail Transformation of Differences for Graphical Display</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Symmetric Transformation of Tails for Plotting Differences</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.4</td>
</tr>
<tr>
<td>Author:</td>
<td>Paul R. Rosenbaum</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Paul R. Rosenbaum &lt;rosenbaum@wharton.upenn.edu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>When plotting treated-minus-control differences, after-minus-before changes, or difference-in-differences, the ttrans() function symmetrically transforms the positive and negative tails to aid plotting.  The package includes an observational study with three control groups and an unaffected outcome; see Rosenbaum (2020) &lt;<a href="https://doi.org/10.1111%2Fbiom.13558">doi:10.1111/biom.13558</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats, graphics</td>
</tr>
<tr>
<td>Suggests:</td>
<td>sensitivitymw, sensitivitymult</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-03-17 17:59:28 UTC; rosenbap</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-03-21 08:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='tailTransform-package'>
Symmetric Transformation of Tails for Plotting Differences
</h2><span id='topic+tailTransform-package'></span><span id='topic+tailTransform'></span>

<h3>Description</h3>

<p>When plotting treated-minus-control differences, after-minus-before changes, or difference-in-differences, the ttrans() function symmetrically transforms the positive and negative tails to aid plotting.  The package includes an observational study with three control groups and an unaffected outcome; see Rosenbaum (2020) &lt;doi:10.1111/biom.13558&gt;.
</p>


<h3>Details</h3>

<p>The DESCRIPTION file:
</p>

<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> tailTransform</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Title: </td><td style="text-align: left;"> Symmetric Transformation of Tails for Plotting Differences</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.0.4</td>
</tr>
<tr>
 <td style="text-align: left;">
Author: </td><td style="text-align: left;"> Paul R. Rosenbaum</td>
</tr>
<tr>
 <td style="text-align: left;">
Maintainer: </td><td style="text-align: left;"> Paul R. Rosenbaum &lt;rosenbaum@wharton.upenn.edu&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
Description: </td><td style="text-align: left;"> When plotting treated-minus-control differences, after-minus-before changes, or difference-in-differences, the ttrans() function symmetrically transforms the positive and negative tails to aid plotting.  The package includes an observational study with three control groups and an unaffected outcome; see Rosenbaum (2020) &lt;doi:10.1111/biom.13558&gt;.</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL-2</td>
</tr>
<tr>
 <td style="text-align: left;">
Encoding: </td><td style="text-align: left;"> UTF-8</td>
</tr>
<tr>
 <td style="text-align: left;">
LazyData: </td><td style="text-align: left;"> true</td>
</tr>
<tr>
 <td style="text-align: left;">
Imports: </td><td style="text-align: left;"> stats, graphics</td>
</tr>
<tr>
 <td style="text-align: left;">
Suggests: </td><td style="text-align: left;"> sensitivitymw, sensitivitymult</td>
</tr>
<tr>
 <td style="text-align: left;">
Depends: </td><td style="text-align: left;"> R (&gt;= 3.5.0)</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>


<p>Index of help topics:
</p>
<pre>
aHDL                    Alcohol and HDL Cholesterol: An Observational
                        Study with 3 Control Groups
boxplotTT               Parallel Boxplots After Tail Transformation
tailTransform-package   Symmetric Transformation of Tails for Plotting
                        Differences
ttrans                  Symmetric Tail Transformation of Differences
                        for Graphical Display
</pre>
<p>The package contains three items: (i) a function ttrans() that symmetrically shortens the tails of pair differences for graphical display, (ii) a function boxplotTT() that aids in interpreting and displaying the transformed data, and (iii) an observational study aHDL with three control groups and an unaffected outcome that are intended to reveal unmeasured confounding if it is present.&lt;doi:10.1111/biom.13558&gt;
</p>


<h3>Author(s)</h3>

<p>Paul R. Rosenbaum
</p>
<p>Maintainer: Paul R. Rosenbaum &lt;rosenbaum@wharton.upenn.edu&gt;
</p>


<h3>References</h3>

<p>Rosenbaum, P. R. (2022a). Sensitivity analyses informed by tests for bias in observational studies. Biometrics. &lt;doi:10.1111/biom.13558&gt;
</p>
<p>Rosenbaum, P. R. (2022b). A new transformation of treated-control matched-pair differences for graphical display.  Manuscript.</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(aHDL)
attach(aHDL)
d&lt;-hdl[grpL=="D"]-hdl[grpL=="N"]  # pair differences
tcks&lt;-c(-100,-60,-40,-20,0,20,40,60,200)
boxplotTT(d,p=-1,qu=.95,tcks=tcks)
detach(aHDL)
rm(tcks,aHDL)
</code></pre>

<hr>
<h2 id='aHDL'>
Alcohol and HDL Cholesterol: An Observational Study with 3 Control Groups
</h2><span id='topic+aHDL'></span>

<h3>Description</h3>

<p>A small observational study of light daily alcohol consumption and HDL cholesterol &ndash; so-called good cholesterol &ndash; derived from NHANES 2013-2014
and 2015-2016.  There are 406 matched sets of four individuals, making 1624 individuals in total.  Sets were matched for age, female and education in five ordered categories.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("aHDL")</code></pre>


<h3>Format</h3>

<p>A data frame with 1624 observations on the following 11 variables.
</p>

<dl>
<dt><code>nh</code></dt><dd><p>NHANES 2013-2014 is 1314, and NHANES 2015-2016 is 1516</p>
</dd>
<dt><code>SEQN</code></dt><dd><p>NHANES ID number</p>
</dd>
<dt><code>age</code></dt><dd><p>Age in years</p>
</dd>
<dt><code>female</code></dt><dd><p>1=female, 0=male</p>
</dd>
<dt><code>education</code></dt><dd><p>1 is &lt;9th grade, 3 is high school, 5 is a BA degree</p>
</dd>
<dt><code>z</code></dt><dd><p>1=light almost daily alcohol, 0=little or no alcohol last year.</p>
</dd>
<dt><code>grp</code></dt><dd><p>Treated group and control groups.  Daily=light almost daily alcohol, Never=fewer than 12 drinks during entire life, Rarely=more than 12 drinks in life, but fewer than 12 in the past year, and never had a period of daily binge drinking, PastBinge = a past history of binge drinking on most days, but currently drinks once a week or less.  For details, see Rosenbaum (2022a, Appendix).</p>
</dd>
<dt><code>grpL</code></dt><dd><p>Short labels for plotting formed as the first letters of grp. <code>D</code> &lt; <code>N</code> &lt; <code>R</code> &lt; <code>B</code></p>
</dd>
<dt><code>hdl</code></dt><dd><p>HDL cholesterol level mg/dL</p>
</dd>
<dt><code>mmercury</code></dt><dd><p>Methylmercury level ug/L</p>
</dd>
<dt><code>mset</code></dt><dd><p>Matched set indicator, 1, 2, ..., 406.  The 1624 observations are in 406 matched sets, each of size 4.</p>
</dd>
</dl>



<h3>Details</h3>

<p>There is a debate about whether light daily alcohol consumption &ndash; a single glass of red wine &ndash; shortens or lengthens life.  LoConte et al. (2018) emphasize that alcohol is a carcinogen.  Suh et al. (1992) claim reduced cardiovascular mortality brought about by an increase in high density high-density lipoprotein (HDL) cholesterol, the so-called good cholesterol.  There is on-going debate about whether there are cardiovascular benefits, and if they exist, whether they are large enough to offset an increased risk of cancer.  This example looks at a small corner of the larger debate, namely the effect on HDL cholesterol.
</p>
<p>The example contains several attempts to detect unmeasured confounding bias, if present.  There is a secondary outcome thought to be unaffected by alcohol consumption, namely methylmercury levels in the blood, likely an indicator of the consumption of fish, not of alcohol; see Pedersen et al. (1994) and WHO (2021).  There are also three control groups, all with little present alcohol consumption, but with different uses of alcohol in the past; see the definition of variable grp above.
</p>
<p>The appendix to Rosenbaum (2022a) describes the data and matching in detail.  It is used as an example in Rosenbaum (2022b).
</p>
<p>The help file for boxplotTT() applies the tail transformation to this example, reproducing a plot from Rosenbaum (2022b).
</p>


<h3>Source</h3>

<p>US National Health and Nutrition Examination Survey (NHANES), 2013-2014 and 2015-2016. &lt;www.cdc.gov/nchs/nhanes&gt;
</p>


<h3>References</h3>

<p>LoConte, N. K., Brewster, A. M., Kaur, J. S., Merrill, J. K., and Alberg, A. J. (2018). Alcohol and cancer: a statement of the American Society of Clinical Oncology. Journal of Clinical Oncology 36, 83-93.
&lt;doi:10.1200/JCO.2017.76.1155&gt;
</p>
<p>Pedersen, G. A., Mortensen, G. K. and Larsen, E. H. (1994) Beverages
as a source of toxic trace element intake. Food Additives and Contaminants, 11, 351â€“363. &lt;doi:10.1080/02652039409374234&gt;
</p>
<p>Rosenbaum, P. R. (1987). The role of a second control group in an observational study. Statistical Science, 2, 292-306.
&lt;doi:10.1214/ss/1177013232&gt;
</p>
<p>Rosenbaum, P. R. (1989). The role of known effects in observational studies. Biometrics, 45, 557-569. &lt;doi:10.2307/2531497&gt;
</p>
<p>Rosenbaum, P. R. (1989). On permutation tests for hidden biases in observational studies. The Annals of Statistics, 17, 643-653.
&lt;doi:10.1214/aos/1176347131&gt;
</p>
<p>Rosenbaum, P. R. (2014) Weighted M-statistics with superior design sensitivity in matched observational studies with multiple controls. Journal of the American Statistical Association, 109(507), 1145-1158 &lt;doi:10.1080/01621459.2013.879261&gt;
</p>
<p>Rosenbaum, P. R. (2022a). Sensitivity analyses informed by tests for bias in observational studies. Biometrics. &lt;doi:10.1111/biom.13558&gt;
</p>
<p>Rosenbaum, P. R. (2022b). A new transformation of treated-control matched-pair differences for graphical display.  Manuscript.
</p>
<p>Suh, I., Shaten, B. J., Cutler, J. A., and Kuller, L. H. (1992). Alcohol use and mortality from coronary heart disease: the role of high-density lipoprotein cholesterol. Annals of Internal Medicine 116, 881-887.
&lt;doi:10.7326/0003-4819-116-11-881&gt;
</p>
<p>World Health Organization (2021). Mercury and Health,
&lt;https://www.who.int/news-room/fact-sheets/detail/mercury-and-health&gt;, (Accessed 30 August 2021).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(aHDL)
table(aHDL$grp,aHDL$grpL) # Short labels for plotting
boxplot(aHDL$age~aHDL$grp,xlab="Group",ylab="Age")
boxplot(aHDL$education~aHDL$grp,xlab="Group",ylab="Education")
table(aHDL$female,aHDL$grpL)
table(aHDL$z,aHDL$grpL)

# The sets were also matched for is.na(aHDL$mmercury), for use
# in Rosenbaum (2022a).  About half of the matched sets
# have values for mmercury.
table(is.na(aHDL$mmercury),aHDL$grp)

# Sensitivity analysis in Rosenbaum (2022b); see
# also Rosenbaum (2014)
y&lt;-t(matrix(aHDL$hdl,4,406))
y&lt;-y[,c(1,3,2,4)]
colnames(y)&lt;-c("D","N","R","B")
sensitivitymw::senmw(y,gamma=6,method="f")$pval
sensitivitymult::amplify(6,11)

# See also the informedSen package for additional analysis
</code></pre>

<hr>
<h2 id='boxplotTT'>
Parallel Boxplots After Tail Transformation
</h2><span id='topic+boxplotTT'></span>

<h3>Description</h3>

<p>Plots one or more boxplots for differences after applying the same tail transformation to all differences.  See the help file for ttrans() for information about the transformation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>boxplotTT(y, p = -1, qu = 0.95, tcks = NULL, ylab = "", xlab = "",main = "")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="boxplotTT_+3A_y">y</code></td>
<td>

<p>A vector, matrix, or dataframe of differences to be transformed and plotted.  Each column becomes a different boxplot after transformation.
</p>
</td></tr>
<tr><td><code id="boxplotTT_+3A_p">p</code></td>
<td>

<p>The power of the transformation.  See the help file for the ttrans() function.
</p>
</td></tr>
<tr><td><code id="boxplotTT_+3A_qu">qu</code></td>
<td>

<p>One number strictly between 0 and 1, commonly 0.9 or 0.95.  Define beta to be the qu quantile of abs(as.vector(y)).  Then, values between -beta and beta are not transformed.
</p>
</td></tr>
<tr><td><code id="boxplotTT_+3A_tcks">tcks</code></td>
<td>

<p>A vector of untransformed values to become tick marks for the y axis after transformation.  Although the y axis was transformed, it is labeled with corresponding untransformed values given by tcks.  If is.null(tcks), then the y axis has no tick marks.
</p>
</td></tr>
<tr><td><code id="boxplotTT_+3A_ylab">ylab</code></td>
<td>

<p>Label for the y-axis.
</p>
</td></tr>
<tr><td><code id="boxplotTT_+3A_xlab">xlab</code></td>
<td>

<p>Label for the x-axis.
</p>
</td></tr>
<tr><td><code id="boxplotTT_+3A_main">main</code></td>
<td>

<p>Title for the plot.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See the help file for ttrans() for an explanation of the transformation.
</p>


<h3>Value</h3>

<p>A boxplot.
</p>


<h3>Author(s)</h3>

<p>Paul R. Rosenbaum
</p>


<h3>References</h3>

<p>Rosenbaum, P. R. (2022). A new transformation of treated-control
matched-pair differences for graphical display.  Manuscript.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ttrans">ttrans</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>data(aHDL)
y&lt;-t(matrix(aHDL$hdl,4,406))
y&lt;-y[,c(1,3,2,4)]
colnames(y)&lt;-c("D","N","R","B")


# 6 pairwise comparisons of 4 groups
o&lt;-matrix(NA,dim(y)[1],6)
colnames(o)&lt;-1:6
k&lt;-0
for (i in 1:3)
  for (j in (i+1):4){
    k&lt;-k+1
    colnames(o)[k]&lt;-paste(colnames(y)[i],colnames(y)[j],sep="-")
    o[,k]&lt;-y[,i]-y[,j]
  }
rm(i,j,k)

# Plotting tick marks.  Remember, the transformation compresses
# extremes, so unequally spaced tick marks are usually needed.
tcks&lt;-c(-100,-60,-40,-20,0,20,40,60,200)

# tails transformed by the p=-1 power (i.e., reciprocal)
boxplotTT(o,p=-1,qu=.95,tcks=tcks,ylab="HDL",
     xlab="Pairwise Comparisons of 4 Groups",
     main="HDL Differences in 4 Alcohol Groups")

</code></pre>

<hr>
<h2 id='ttrans'>
Symmetric Tail Transformation of Differences for Graphical Display
</h2><span id='topic+ttrans'></span>

<h3>Description</h3>

<p>Performs a differentiable, strictly increasing, odd transformation of treated-minus-control pair differences d, or after-minus-before changes, or difference-in-differences.  The transformation allows one to see the undistorted center of a distribution that contains extreme outliers, while also seeing the outliers.  The transformation t(d) is: (i) odd, meaning
t(d )= -t(-d), so positive and negative values of d are transformed symmetrically, (ii) for some number beta&gt;0, the transformation leaves d untouched between -beta and beta, so t(d)=d for -beta &lt; d &lt; beta, (iii) the transformation has derivative 1 at -beta and beta, so it is smooth at the point where the nonlinear transformation begins to take effect.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ttrans(d, p = -1, qu = NULL, beta = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ttrans_+3A_d">d</code></td>
<td>

<p>A vector of differences to be transformed.
</p>
</td></tr>
<tr><td><code id="ttrans_+3A_p">p</code></td>
<td>

<p>The power to be used in the transformation of the tails, with p=0 being the log, as in the Box-Cox-Tukey transformation.
</p>
</td></tr>
<tr><td><code id="ttrans_+3A_qu">qu</code></td>
<td>

<p>If qu is specified, it is a number strictly between 0 and 1, commonly 0.9 or 0.95.  Then beta is set to be the qu quantile of abs(d).  If qu=.95, then 95 percent of the differences in d are not transformed.  You must specify either qu or beta, and you must not specify both qu and beta.
</p>
</td></tr>
<tr><td><code id="ttrans_+3A_beta">beta</code></td>
<td>

<p>The value beta mentioned in the description.  You must specify either qu or beta, and you must not specify both qu and beta.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Recall that beta&gt;0.  Let y be one difference in d.  If y=0, then t(y)=y=0.  If 0&lt;y&lt;=beta, then
t(y) = y.  If y&gt;beta, then a Box-Cox-Tukey power transformation is applied to y, with the transformation relocated and scaled so that t(y) has derivative 1 at beta.  If y&lt;0, then t(y) = -t(|y|).  Properties of the transformation are discussed in Rosenbaum (2022).
</p>
<p>Although t(y) is nonlinear, it is exactly linear with slope 1 between -beta and beta, and t(y) is smooth with slope 1 at -beta and beta.  The nonlinear aspect of the transformation is barely visible near -beta and beta.
</p>
<p>If d is symmetric about zero, then the transformed values are also symmetric about zero.  If there is no effect on the differences, in the sense that they are symmetric about zero, then the transformed differences also exhibit no effect.
</p>
<p>The transformation does not alter Wilcoxon's signed rank statistic, or other signed rank statistics.  Specifically, the transformation does not alter the ranks of |d|, and it does not alter sign(d).
</p>
<p>The p=-1 reciprocal transformation has an upper and lower asymptote, so it limits the range of the d's, but it shows outliers clearly.
</p>


<h3>Value</h3>

<p>A vector of transformed values of d.
</p>


<h3>Author(s)</h3>

<p>Paul R. Rosenbaum
</p>


<h3>References</h3>

<p>Box, George E. P. and David R. Cox. (1964) An analysis of transformations. Journal of the Royal Statistical Society: Series B 26, 211-243.
&lt;doi:10.1111/j.2517-6161.1964.tb00553.x&gt;
</p>
<p>Rosenbaum, P. R. (2022). A new transformation of treated-control
matched-pair differences for graphical display.  Manuscript.
</p>
<p>Tukey, J. W. (1949). One degree of freedom for non-additivity. Biometrics, 5, 232-242. &lt;doi:10.2307/3001938&gt;
</p>
<p>Tukey, J. W. (1957). On the comparative anatomy of transformations.  Annals of Mathematical Statistics, 28, 602-632.
&lt;doi:10.1214/aoms/1177706875&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(aHDL)
attach(aHDL)
d&lt;-hdl[grpL=="D"]-hdl[grpL=="N"]  # pair differences
detach(aHDL)
oldpar&lt;-par()
par(mfrow=c(1,2))
boxplot(d) # untransformed
boxplot(ttrans(d,qu=.95,p=-1)) # reciprocal transformation of tails

par(mfrow=c(1,1))
# Label the transformed vertical axis with untransformed values
# Add -beta and beta on the right axis
tcks&lt;-c(-100,-60,-40,-20,0,20,40,60,200)
boxplotTT(d,p=-1,qu=.95,tcks=tcks)

par&lt;-oldpar
rm(aHDL,d,oldpar)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
