<!DOCTYPE html><html><head><title>Help for package unittest</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {unittest}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#ok'><p>The unittest package's workhorse function</p></a></li>
<li><a href='#ok_group'><p>Group associated unit tests</p></a></li>
<li><a href='#unittest-package'><p>TAP-compliant Unit Testing</p></a></li>
<li><a href='#ut_cmp'><p>Compare variables with verbose error output</p></a></li>
<li><a href='#ut_cmp_error'><p>Test for and compare errors generated by code</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>TAP-Compliant Unit Testing</td>
</tr>
<tr>
<td>Version:</td>
<td>1.6-1</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-01-10</td>
</tr>
<tr>
<td>Description:</td>
<td>
    Concise TAP <a href="http://testanything.org/">http://testanything.org/</a> compliant unit testing package. Authored tests can be run using CMD check with minimal implementation overhead.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.6.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>methods</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/ravingmantis/unittest/issues">https://github.com/ravingmantis/unittest/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-01-10 11:32:18 UTC; lentinj</td>
</tr>
<tr>
<td>Author:</td>
<td>Jamie Lentin [aut, cre],
  Anthony Hennessey [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jamie Lentin &lt;lentinj@shuttlethread.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-01-10 12:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='ok'>The unittest package's workhorse function</h2><span id='topic+ok'></span>

<h3>Description</h3>

<p>Report the test of an expression in TAP format.</p>


<h3>Usage</h3>

<pre><code class='language-R'>  ok(test, description)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ok_+3A_test">test</code></td>
<td>

<p>Expression to be tested. Evaluating to <code>TRUE</code> is treated as success,
anything else as failure.
</p>
</td></tr>
<tr><td><code id="ok_+3A_description">description</code></td>
<td>

<p>Character string describing the test. If a description is not given a 
character representation of the test expression will be used.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code><a href="#topic+unittest">unittest</a></code> package documentation.
</p>
<p>The <code>unittest.output</code> option tells unittest where output should be sent.
This is most useful for vignettes, where sending output to
<code><a href="base.html#topic+stderr">stderr</a></code> separates the unittest output from the vignette itself.
</p>


<h3>Value</h3>

<p><code>ok()</code> returns whatever was returned when <code>test</code> is evaluated.
More importantly it has the side effect of printing the result of the
test in <code>TAP</code> format.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ok(1==1, "1 equals 1")

ok(1==1)

ok(1==2, "1 equals 2")

ok(all.equal(c(1,2),c(1,2)), "compare vectors")

fn &lt;- function () stop("oops")
ok(fn(), "something with a coding error")

ok(c("Some diagnostic", "messages"), "A failure with diagnostic messages")

## Send unittest output to stderr()
options(unittest.output = stderr())
ok(ut_cmp_equal(4, 5), "4 == 5? Probably not")

## Reset unittest output to default (stdout())
options(unittest.output = NULL)
ok(ut_cmp_equal(4, 5), "4 == 5? Probably not")


</code></pre>

<hr>
<h2 id='ok_group'>Group associated unit tests</h2><span id='topic+ok_group'></span>

<h3>Description</h3>

<p>Group associated unit tests with TAP compliant comments separating the output.</p>


<h3>Usage</h3>

<pre><code class='language-R'>  ok_group(message, tests)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ok_group_+3A_message">message</code></td>
<td>

<p>Character vector describing this group. Will be printed as a comment
before the tests are ran.
</p>
</td></tr>
<tr><td><code id="ok_group_+3A_tests">tests</code></td>
<td>

<p>A code block full of tests.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Used to group a selection of tests together, for instance you may group
the tests relating to a function together.
</p>


<h3>Value</h3>

<p>Returns NULL.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ok_group("Test addition", {
    ok(1 + 1 == 2, "Can add 1")
    ok(1 + 3 == 4, "Can add 3")
})

ok_group("Test subtraction", {
    ok(1 - 1 == 0, "Can subtract 1")
    ok(1 - 3 == -2, "Can subtract 3")
})

# Multiline group message
ok_group(c("Test multiplication", "but not division"),{
    ok(1 * 1 == 1, "Can multiply by 1")
    ok(2 * 3 == 6, "Can multiply by 3")
})


</code></pre>

<hr>
<h2 id='unittest-package'>TAP-compliant Unit Testing</h2><span id='topic+unittest-package'></span><span id='topic+unittest'></span>

<h3>Description</h3>

<p>Concise TAP-compliant unit testing package.
Authored unit tests can be run using <code>R CMD check</code> with minimal implementation overhead.
</p>


<h3>Details</h3>

<p>Given a simple function you'd like to test in the file <code>myfunction.R</code>:
</p>
<pre>biggest &lt;- function(x,y) { max(c(x,y)) }
</pre>
<p>A test script for this function <code>test_myfunction.R</code> would be:
</p>
<pre>library(unittest)
    
source('myfunction.R')  # Or library(mypackage) if part of a package
    
ok(biggest(3,4) == 4, "two numbers")
ok(biggest(c(5,3),c(3,4)) == 5, "two vectors")
</pre>
<p>You can then run this test in several ways:
</p>

<ol>
<li><p><code>source('test_myfunction.R')</code> from R
</p>
</li>
<li><p><code>Rscript --vanilla test_myfunction.R</code> from the command prompt
</p>
</li>
<li><p><code>R CMD check</code>, if <code>test_myfunction.R</code> is inside the <code>tests</code> directory of <code>mypackage</code> being tested. &lsquo;unittest&rsquo; doesn't require any further setup in your package
</p>
</li></ol>

<p>If writing tests as part of a package, see <code>vignette("testing_packages", package='unittest')</code>.
</p>
<p>The workhorse of the &lsquo;unittest&rsquo; package is the <code><a href="#topic+ok">ok</a></code> function which prints &quot;ok&quot; when the expression provided evaluates to <code>TRUE</code> and &quot;not ok&quot; if the expression evaluates to anything else or results in an error.
There are several <code>ut_cmp_*</code> helpers designed to work with <code><a href="#topic+ok">ok</a></code>:
</p>

<ol>
<li><p><code>ok(ut_cmp_equal( biggest(1/3, 2/6), 2/6), "two floating point numbers")</code>: Uses <code><a href="base.html#topic+all.equal">all.equal</a></code> to compare within a tolerance
</p>
</li>
<li><p><code>ok(ut_cmp_identical( biggest("c", "d") ), "two strings")</code>: Uses <code><a href="base.html#topic+identical">identical</a></code> to make sure outputs are identical
</p>
</li>
<li><p><code>ok(ut_cmp_error(biggest(3), '"y".*missing'), "single argument is an error")</code>: Make sure the code produces an error matching the regular expression
</p>
</li></ol>

<p>In all cases you get detailed, colourised output on what the difference is if the test fails.
</p>


<h3>Author(s)</h3>

<p>Maintainer: Jamie Lentin &lt;lentinj@shuttlethread.com&gt;, Anthony Hennessey &lt;anthony.hennessey@protonmail.com&gt;.
</p>


<h3>References</h3>

<p>Inspired by Perl's Test::Simple (<a href="https://metacpan.org/pod/Test::Simple">https://metacpan.org/pod/Test::Simple</a>).
</p>


<h3>See Also</h3>

<p><a href="https://CRAN.R-project.org/package=testthat">testthat</a>,
<a href="https://CRAN.R-project.org/package=RUnit">RUnit</a>,
<a href="https://CRAN.R-project.org/package=svUnit">svUnit</a>.
</p>

<hr>
<h2 id='ut_cmp'>Compare variables with verbose error output</h2><span id='topic+ut_cmp_equal'></span><span id='topic+ut_cmp_identical'></span>

<h3>Description</h3>

<p>A wrapper for <code><a href="Matrix.html#topic+all.equal">all.equal</a></code> and <code><a href="base.html#topic+identical">identical</a></code> that provides
more useful diagnostics when used in a unittest <code><a href="#topic+ok">ok</a></code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  ut_cmp_equal(a, b, filter = NULL, deparse_frame = -1, ...)
  ut_cmp_identical(a, b, filter = NULL, deparse_frame = -1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ut_cmp_+3A_a">a</code></td>
<td>
<p>First item to compare, usually the result of whatever you are testing</p>
</td></tr>
<tr><td><code id="ut_cmp_+3A_b">b</code></td>
<td>
<p>Second item to compare, usually the expected output of whatever you are testing</p>
</td></tr>
<tr><td><code id="ut_cmp_+3A_filter">filter</code></td>
<td>
<p>An optional filter function, that turns either a or b into text, and prints this out</p>
</td></tr>
<tr><td><code id="ut_cmp_+3A_deparse_frame">deparse_frame</code></td>
<td>

<p>Tell <code><a href="base.html#topic+sys.call">sys.call</a></code> which frame to deparse to get original expressions.
Set to <code>-2</code> when making a helper function, see examples.
</p>
</td></tr>
<tr><td><code id="ut_cmp_+3A_...">...</code></td>
<td>
<p>Other arguments passed directly to <code><a href="Matrix.html#topic+all.equal">all.equal</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>For both functions, <code>a</code> and <code>b</code> are first passed to
<code><a href="Matrix.html#topic+all.equal">all.equal</a></code> (for <code>ut_cmp_equal()</code>) or
<code><a href="base.html#topic+identical">identical</a></code> (for <code>ut_cmp_identical()</code>). If they match, then
the function returns TRUE and your test passes.
</p>
<p>If this fails, then we turn both <code>a</code> and <code>b</code> into text, and then
use <code>git diff</code> to compare the 2 outputs. If you do not have git
installed, then the 2 outputs will be shown side-by-side.
</p>
<p>When using <code>git diff</code>, we turn colored output on when outputting to a
terminal. You can force this on or off using <code>options("cli.num_colors" = 1)</code>
or the <code>NO_COLOR</code> or <code>R_CLI_NUM_COLORS</code> environment variable.
</p>
<p>The step of turning into text is done with the filter function. There are
several of these built-in, and it will choose the one that produces the
simplest output. This may mean that the output will be from the <code><a href="base.html#topic+print">print</a></code>
function if the differences are obvious, or <code><a href="utils.html#topic+str">str</a></code> with many
decimal places if there are subtle differences between the 2.
</p>
<p>You can also provide your own filter function if there's a particular way
you would like to see the data when comparing, for example you can use
<code>write.table</code> if your data is easiest to understand in tabular output.
</p>


<h3>Value</h3>

<p>Returns <code>TRUE</code> if <code>a</code> &amp; <code>b</code> are <code><a href="Matrix.html#topic+all.equal">all.equal</a></code> (for <code>ut_cmp_equal()</code>) or <code><a href="base.html#topic+identical">identical</a></code> (for <code>ut_cmp_identical()</code>).
Otherwise, returns an <code>invisible()</code> character vector of diagnostic
strings helping you find where the difference is.
</p>
<p>If called directly in an interactive R session, this output will be printed
to the console.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## A function to test:
fn &lt;- function(x) { seq(x) }

## Get it right, and test passes:
ok(ut_cmp_equal(fn(3), c(1,2,3)))

## Get it wrong, and we get told where in the output things are different:
ok(ut_cmp_equal(fn(3), c(1,4,3)))

## Using a custom filter, we can format the output with write.table:
ok(ut_cmp_equal(fn(3), c(1,4,3), filter = write.table))

## With ut_cmp_equal, an integer 1 is the same as a numeric 1
ok(ut_cmp_equal(as.numeric(1), as.integer(1)))

## With ut_cmp_identical, they're not
ok(ut_cmp_identical(as.numeric(1), as.integer(1)))

## all.equal() takes a tolerance parameter, for example:
all.equal(0.01, 0.02, tolerance = 0.1)

## ...we can also give this to to ut_cmp_equal if we want a very
## approximate comparison
ok(ut_cmp_equal(0.01, 0.02, tolerance = 0.1))

## We can make a comparison function of our own, and use
## deparse_frame to show the right expression in diff output
cmp_noorder &lt;- function (a, b) {
    sortlist &lt;- function (x) if (length(x) &gt; 0) x[order(names(x))] else x
    ut_cmp_identical(sortlist(a), sortlist(b), deparse_frame = -2)
}
ok(cmp_noorder(list(a=1, b=2), list(b=2, a=3)))


</code></pre>

<hr>
<h2 id='ut_cmp_error'>Test for and compare errors generated by code</h2><span id='topic+ut_cmp_error'></span>

<h3>Description</h3>

<p>A helper to catch expected errors and ensure they match what is expected</p>


<h3>Usage</h3>

<pre><code class='language-R'>  ut_cmp_error(code, expected_regexp, ignore.case = FALSE, perl = FALSE, fixed = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ut_cmp_error_+3A_code">code</code></td>
<td>
<p>Code expression to test, should generate an error</p>
</td></tr>
<tr><td><code id="ut_cmp_error_+3A_expected_regexp">expected_regexp</code></td>
<td>
<p>Regular expression the error should match</p>
</td></tr>
<tr><td><code id="ut_cmp_error_+3A_ignore.case">ignore.case</code></td>
<td>
<p>Passed to <code><a href="base.html#topic+grepl">grepl</a></code></p>
</td></tr>
<tr><td><code id="ut_cmp_error_+3A_perl">perl</code></td>
<td>
<p>Passed to <code><a href="base.html#topic+grepl">grepl</a></code></p>
</td></tr>
<tr><td><code id="ut_cmp_error_+3A_fixed">fixed</code></td>
<td>
<p>Passed to <code><a href="base.html#topic+grepl">grepl</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns <code>TRUE</code> if <code>exp</code> generates an error and matches <code>expected_regexp</code>.
Returns a string with expected and actual error if <code>exp</code> generates an error but does not match.
Returns <code>"No error returned"</code> if <code>exp</code> does not generate an error.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ok(ut_cmp_error({
  stop("Hammer time")
}, "hammer", ignore.case = TRUE), "Returned a hammer-based error")


</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
