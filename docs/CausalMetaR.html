<!DOCTYPE html><html><head><title>Help for package CausalMetaR</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {CausalMetaR}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#ATE_external'><p>Estimating the Average Treatment Effect (ATE) in an external target population using multi-source data</p></a></li>
<li><a href='#ATE_internal'><p>Estimating the Average Treatment Effect (ATE) in an internal target population using multi-source data</p></a></li>
<li><a href='#dat_external'><p>External dataset</p></a></li>
<li><a href='#dat_multisource'><p>Multi-source dataset</p></a></li>
<li><a href='#plot.ATE_internal'><p>Plot method for objects of class &quot;ATE_internal&quot;</p></a></li>
<li><a href='#plot.STE_internal'><p>Plot method for objects of class &quot;STE_internal&quot;</p></a></li>
<li><a href='#print.STE_internal'><p>Print method for objects of class &quot;ATE_internal&quot;, &quot;ATE_external&quot;, &quot;STE_internal&quot;, or &quot;STE_external&quot;</p></a></li>
<li><a href='#STE_external'><p>Estimating the Subgroup Treatment Effect (STE) in an external target population using multi-source data</p></a></li>
<li><a href='#STE_internal'><p>Estimating the Subgroup Treatment Effect (STE) in an internal target population using multi-source data</p></a></li>
<li><a href='#summary.STE_internal'><p>Summary method for objects of class &quot;ATE_internal&quot;, &quot;ATE_external&quot;, &quot;STE_internal&quot;, or &quot;STE_external&quot;</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Causally Interpretable Meta-Analysis</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.1</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides robust and efficient methods for estimating causal effects in a target population using a multi-source dataset, including those of Dahabreh et al. (2019) &lt;<a href="https://doi.org/10.1111%2Fbiom.13716">doi:10.1111/biom.13716</a>&gt; and Robertson et al. (2021) &lt;<a href="https://doi.org/10.48550/arXiv.2104.05905">doi:10.48550/arXiv.2104.05905</a>&gt;. The multi-source data can be a collection of trials, observational studies, or a combination of both, which have the same data structure (outcome, treatment, and covariates). The target population can be based on an internal dataset or an external dataset where only covariate information is available. The causal estimands available are average treatment effects and subgroup treatment effects.  </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>glmnet, metafor, nnet, progress, SuperLearner</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/ly129/CausalMetaR">https://github.com/ly129/CausalMetaR</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/ly129/CausalMetaR/issues">https://github.com/ly129/CausalMetaR/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-01-13 21:04:48 UTC; Sean</td>
</tr>
<tr>
<td>Author:</td>
<td>Yi Lian [aut],
  Guanbo Wang [aut],
  Sean McGrath <a href="https://orcid.org/0000-0002-7281-3516"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Issa Dahabreh [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Sean McGrath &lt;sean_mcgrath@g.harvard.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-01-15 16:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='ATE_external'>Estimating the Average Treatment Effect (ATE) in an external target population using multi-source data</h2><span id='topic+ATE_external'></span>

<h3>Description</h3>

<p>Doubly-robust and efficient estimator for the ATE in an external target population using multi-source data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ATE_external(
  X,
  X_external,
  Y,
  S,
  A,
  cross_fitting = FALSE,
  replications = 10L,
  source_model = "MN.glmnet",
  source_model_args = list(),
  treatment_model_type = "separate",
  treatment_model_args = list(),
  external_model_args = list(),
  outcome_model_args = list(),
  show_progress = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ATE_external_+3A_x">X</code></td>
<td>
<p>Data frame (or matrix) containing the covariate data in the multi-source data. It should have <code class="reqn">n</code> rows and <code class="reqn">p</code> columns. Character variables will be converted to factors.</p>
</td></tr>
<tr><td><code id="ATE_external_+3A_x_external">X_external</code></td>
<td>
<p>Data frame (or matrix) containing the covariate data in the external target population. It should have <code class="reqn">n_0</code> rows and <code class="reqn">p</code> columns. This is the external data counterpart to the <code>X</code> argument.</p>
</td></tr>
<tr><td><code id="ATE_external_+3A_y">Y</code></td>
<td>
<p>Vector of length <code class="reqn">n</code> containing the outcome.</p>
</td></tr>
<tr><td><code id="ATE_external_+3A_s">S</code></td>
<td>
<p>Vector of length <code class="reqn">n</code> containing the source indicator. If <code>S</code> is a factor, it will maintain its level order; otherwise it will be converted to a factor with the default level order. The order will be carried over to the outputs and plots.</p>
</td></tr>
<tr><td><code id="ATE_external_+3A_a">A</code></td>
<td>
<p>Vector of length <code class="reqn">n</code> containing the binary treatment (1 for treated and 0 for untreated).</p>
</td></tr>
<tr><td><code id="ATE_external_+3A_cross_fitting">cross_fitting</code></td>
<td>
<p>Logical specifying whether sample splitting and cross fitting should be used.</p>
</td></tr>
<tr><td><code id="ATE_external_+3A_replications">replications</code></td>
<td>
<p>Integer specifying the number of sample splitting and cross fitting replications to perform, if <code>cross_fitting = TRUE</code>. The default is <code>10L</code>.</p>
</td></tr>
<tr><td><code id="ATE_external_+3A_source_model">source_model</code></td>
<td>
<p>Character string specifying the (penalized) multinomial logistic regression for estimating the source model. It has two options: &quot;<code>MN.glmnet</code>&quot; (default) and &quot;<code>MN.nnet</code>&quot;, which use <span class="pkg">glmnet</span> and <span class="pkg">nnet</span> respectively.</p>
</td></tr>
<tr><td><code id="ATE_external_+3A_source_model_args">source_model_args</code></td>
<td>
<p>List specifying the arguments for the source model (in <span class="pkg">glmnet</span> or <span class="pkg">nnet</span>).</p>
</td></tr>
<tr><td><code id="ATE_external_+3A_treatment_model_type">treatment_model_type</code></td>
<td>
<p>Character string specifying how the treatment model is estimated. Options include &quot;<code>separate</code>&quot; (default) and &quot;<code>joint</code>&quot;. If &quot;<code>separate</code>&quot;, the treatment model (i.e., <code class="reqn">P(A=1|X, S=s)</code>) is estimated by regressing <code class="reqn">A</code> on <code class="reqn">X</code> within each specific internal population <code class="reqn">S=s</code>. If &quot;<code>joint</code>&quot;, the treatment model is estimated by regressing <code class="reqn">A</code> on <code class="reqn">X</code> and <code class="reqn">S</code> using the multi-source population.</p>
</td></tr>
<tr><td><code id="ATE_external_+3A_treatment_model_args">treatment_model_args</code></td>
<td>
<p>List specifying the arguments for the treatment model (in <span class="pkg">SuperLearner</span>).</p>
</td></tr>
<tr><td><code id="ATE_external_+3A_external_model_args">external_model_args</code></td>
<td>
<p>List specifying the arguments for the external model (in <span class="pkg">SuperLearner</span>).</p>
</td></tr>
<tr><td><code id="ATE_external_+3A_outcome_model_args">outcome_model_args</code></td>
<td>
<p>List specifying the arguments for the outcome model  (in <span class="pkg">SuperLearner</span>).</p>
</td></tr>
<tr><td><code id="ATE_external_+3A_show_progress">show_progress</code></td>
<td>
<p>Logical specifying whether to print a progress bar for the cross-fit replicates completed, if <code>cross_fitting = TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Data structure:</strong>
</p>
<p>The multi-source dataset consists the outcome <code>Y</code>, source <code>S</code>, treatment <code>A</code>, and covariates <code>X</code> (<code class="reqn">n \times p</code>) in the internal populations. The data sources can be trials, observational studies, or a combination of both.
</p>
<p>The external dataset contains only covariates <code>X_external</code> (<code class="reqn">n_0 \times p</code>).
</p>
<p><strong>Estimation of nuissance parameters:</strong>
</p>
<p>The following models are fit:
</p>

<ul>
<li><p> External model: <code class="reqn">q(X)=P(R=1|X)</code>, where <code class="reqn">R</code> takes value 1 if the subject belongs to any of the internal dataset and 0 if the subject belongs to the external dataset
</p>
</li>
<li><p> Propensity score model: <code class="reqn">\eta_a(X)=P(A=a|X)</code>. We perform the decomposition <code class="reqn">P(A=a|X)=\sum_{s} P(A=a|X, S=s)P(S=s|X)</code> and estimate <code class="reqn">P(A=1|X, S=s)</code> (i.e., the treatment model) and <code class="reqn">P(S=s|X)</code> (i.e., the source model).
</p>
</li>
<li><p> Outcome model: <code class="reqn">\mu_a(X)=E(Y|X, A=a)</code>
</p>
</li></ul>

<p>The models are estimated by <span class="pkg">SuperLearner</span> with the exception of the source model which is estimated by <span class="pkg">glmnet</span> or <span class="pkg">nnet</span>.
</p>
<p><strong>ATE estimation:</strong>
</p>
<p>The ATE estimator is
</p>
<p style="text-align: center;"><code class="reqn">
 \dfrac{\widehat \kappa}{N}\sum\limits_{i=1}^{N} \Bigg[ I(R_i = 0) \widehat \mu_a(X_i)
 +I(A_i = a, R_i=1) \dfrac{1-\widehat q(X_i)}{\widehat \eta_a(X_i)\widehat q(X_i)}  \Big\{ Y_i - \widehat \mu_a(X_i) \Big\} \Bigg],
</code>
</p>

<p>where <code class="reqn">N=n+n_0</code>, and <code class="reqn">\widehat \kappa=\{N^{-1} \sum_{i=1}^N I(R_i=0)\}^{-1}</code>.
</p>
<p>This estimator is doubly robust and non-parametrically efficient.
To achieve non-parametric efficiency and asymptotic normality, it requires that <code class="reqn">||\widehat \mu_a(X) -\mu_a(X)||\big\{||\widehat \eta_a(X) -\eta_a(X)||+||\widehat q(X) -q(X)||\big\}=o_p(n^{-1/2})</code>.
In addition, sample splitting and cross-fitting can be performed to avoid the Donsker class assumption.
</p>
<p>When a data source is a randomized trial, it is still recommended to estimate the propensity score for optimal efficiency.
</p>


<h3>Value</h3>

<p>An object of class &quot;ATE_external&quot;. This object is a list with the following elements:
</p>
<table>
<tr><td><code>df_dif</code></td>
<td>
<p>A data frame containing the treatment effect (mean difference) estimates for the extenal data.</p>
</td></tr>
<tr><td><code>df_A0</code></td>
<td>
<p>A data frame containing the potential outcome mean estimates under A = 0 for the extenal data.</p>
</td></tr>
<tr><td><code>df_A1</code></td>
<td>
<p>A data frame containing the potential outcome mean estimates under A = 1 for the extenal data.</p>
</td></tr>
<tr><td><code>fit_outcome</code></td>
<td>
<p>Fitted outcome model.</p>
</td></tr>
<tr><td><code>fit_source</code></td>
<td>
<p>Fitted source model.</p>
</td></tr>
<tr><td><code>fit_treatment</code></td>
<td>
<p>Fitted treatment model(s).</p>
</td></tr>
<tr><td><code>fit_external</code></td>
<td>
<p>Fitted external model.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Dahabreh, I.J., Robertson, S.E., Petito, L.C., Hernán, M.A. and Steingrimsson, J.A.. (2019) <em>Efficient and robust methods for causally
interpretable meta‐analysis: Transporting inferences from multiple randomized trials to a target population</em>, Biometrics.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
ae &lt;- ATE_external(
  X = dat_multisource[, 1:10],
  Y = dat_multisource$Y,
  S = dat_multisource$S,
  A = dat_multisource$A,
  X_external = dat_external[, 1:10],
  source_model = "MN.glmnet",
  source_model_args = list(),
  treatment_model_type = "separate",
  treatment_model_args = list(
    family = binomial(),
    SL.library = c("SL.glmnet", "SL.nnet", "SL.glm"),
    cvControl = list(V = 5L)
  ),
  external_model_args = list(
    family = binomial(),
    SL.library = c("SL.glmnet", "SL.nnet", "SL.glm"),
    cvControl = list(V = 5L)
  ),
  outcome_model_args = list(
    family = gaussian(),
    SL.library = c("SL.glmnet", "SL.nnet", "SL.glm"),
    cvControl = list(V = 5L)
  )
)


</code></pre>

<hr>
<h2 id='ATE_internal'>Estimating the Average Treatment Effect (ATE) in an internal target population using multi-source data</h2><span id='topic+ATE_internal'></span>

<h3>Description</h3>

<p>Doubly-robust and efficient estimator for the ATE in each internal target population using multi-source data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ATE_internal(
  X,
  Y,
  S,
  A,
  cross_fitting = FALSE,
  replications = 10L,
  source_model = "MN.glmnet",
  source_model_args = list(),
  treatment_model_type = "separate",
  treatment_model_args = list(),
  outcome_model_args = list(),
  show_progress = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ATE_internal_+3A_x">X</code></td>
<td>
<p>Data frame (or matrix) containing the covariate data in the multi-source data. It should have <code class="reqn">n</code> rows and <code class="reqn">p</code> columns. Character variables will be converted to factors.</p>
</td></tr>
<tr><td><code id="ATE_internal_+3A_y">Y</code></td>
<td>
<p>Vector of length <code class="reqn">n</code> containing the outcome.</p>
</td></tr>
<tr><td><code id="ATE_internal_+3A_s">S</code></td>
<td>
<p>Vector of length <code class="reqn">n</code> containing the source indicator. If <code>S</code> is a factor, it will maintain its level order; otherwise it will be converted to a factor with the default level order. The order will be carried over to the outputs and plots.</p>
</td></tr>
<tr><td><code id="ATE_internal_+3A_a">A</code></td>
<td>
<p>Vector of length <code class="reqn">n</code> containing the binary treatment (1 for treated and 0 for untreated).</p>
</td></tr>
<tr><td><code id="ATE_internal_+3A_cross_fitting">cross_fitting</code></td>
<td>
<p>Logical specifying whether sample splitting and cross fitting should be used.</p>
</td></tr>
<tr><td><code id="ATE_internal_+3A_replications">replications</code></td>
<td>
<p>Integer specifying the number of sample splitting and cross fitting replications to perform, if <code>cross_fitting = TRUE</code>. The default is <code>10L</code>.</p>
</td></tr>
<tr><td><code id="ATE_internal_+3A_source_model">source_model</code></td>
<td>
<p>Character string specifying the (penalized) multinomial logistic regression for estimating the source model. It has two options: &quot;<code>MN.glmnet</code>&quot; (default) and &quot;<code>MN.nnet</code>&quot;, which use <span class="pkg">glmnet</span> and <span class="pkg">nnet</span> respectively.</p>
</td></tr>
<tr><td><code id="ATE_internal_+3A_source_model_args">source_model_args</code></td>
<td>
<p>List specifying the arguments for the source model (in <span class="pkg">glmnet</span> or <span class="pkg">nnet</span>).</p>
</td></tr>
<tr><td><code id="ATE_internal_+3A_treatment_model_type">treatment_model_type</code></td>
<td>
<p>Character string specifying how the treatment model is estimated. Options include &quot;<code>separate</code>&quot; (default) and &quot;<code>joint</code>&quot;. If &quot;<code>separate</code>&quot;, the treatment model (i.e., <code class="reqn">P(A=1|X, S=s)</code>) is estimated by regressing <code class="reqn">A</code> on <code class="reqn">X</code> within each specific internal population <code class="reqn">S=s</code>. If &quot;<code>joint</code>&quot;, the treatment model is estimated by regressing <code class="reqn">A</code> on <code class="reqn">X</code> and <code class="reqn">S</code> using the multi-source population.</p>
</td></tr>
<tr><td><code id="ATE_internal_+3A_treatment_model_args">treatment_model_args</code></td>
<td>
<p>List specifying the arguments for the treatment model (in <span class="pkg">SuperLearner</span>).</p>
</td></tr>
<tr><td><code id="ATE_internal_+3A_outcome_model_args">outcome_model_args</code></td>
<td>
<p>List specifying the arguments for the outcome model  (in <span class="pkg">SuperLearner</span>).</p>
</td></tr>
<tr><td><code id="ATE_internal_+3A_show_progress">show_progress</code></td>
<td>
<p>Logical specifying whether to print a progress bar for the cross-fit replicates completed, if <code>cross_fitting = TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Data structure:</strong>
</p>
<p>The multi-source dataset consists the outcome <code>Y</code>, source <code>S</code>, treatment <code>A</code>, and covariates <code>X</code> (<code class="reqn">n \times p</code>) in the internal populations. The data sources can be trials, observational studies, or a combination of both.
</p>
<p><strong>Estimation of nuissance parameters:</strong>
</p>
<p>The following models are fit:
</p>

<ul>
<li><p> Propensity score model: <code class="reqn">\eta_a(X)=P(A=a|X)</code>. We perform the decomposition <code class="reqn">P(A=a|X)=\sum_{s} P(A=a|X, S=s)P(S=s|X)</code> and estimate <code class="reqn">P(A=1|X, S=s)</code> (i.e., the treatment model) and <code class="reqn">q_s(X)=P(S=s|X)</code> (i.e., the source model).
</p>
</li>
<li><p> Outcome model: <code class="reqn">\mu_a(X)=E(Y|X, A=a)</code>
</p>
</li></ul>

<p>The models are estimated by <span class="pkg">SuperLearner</span> with the exception of the source model which is estimated by <span class="pkg">glmnet</span> or <span class="pkg">nnet</span>.
</p>
<p><strong>ATE estimation:</strong>
</p>
<p>The ATE estimator is
</p>
<p style="text-align: center;"><code class="reqn">
 \dfrac{\widehat \kappa}{n}\sum\limits_{i=1}^{n} \Bigg[ I(S_i = s) \widehat \mu_a(X_i)
 +I(A_i = a) \dfrac{\widehat q_{s}(X_i)}{\widehat \eta_a(X_i)}  \Big\{ Y_i - \widehat \mu_a(X_i) \Big\} \Bigg],
</code>
</p>

<p>where <code class="reqn">\widehat \kappa=\{n^{-1} \sum_{i=1}^n I(S_i=s)\}^{-1}</code>. The estimator is doubly robust and non-parametrically efficient.
</p>
<p>To achieve non-parametric efficiency and asymptotic normality, it requires that <code class="reqn">||\widehat \mu_a(X) -\mu_a(X)||\big\{||\widehat \eta_a(X) -\eta_a(X)||+||\widehat q_s(X) -q_s(X)||\big\}=o_p(n^{-1/2})</code>.
In addition, sample splitting and cross-fitting can be performed to avoid the Donsker class assumption.
</p>
<p>When a data source is a randomized trial, it is still recommended to estimate the propensity score for optimal efficiency.
</p>


<h3>Value</h3>

<p>An object of class &quot;ATE_internal&quot;. This object is a list with the following elements:
</p>
<table>
<tr><td><code>df_dif</code></td>
<td>
<p>A data frame containing the treatment effect (mean difference) estimates for the internal populations.</p>
</td></tr>
<tr><td><code>df_A0</code></td>
<td>
<p>A data frame containing the potential outcome mean estimates under A = 0 for the internal populations.</p>
</td></tr>
<tr><td><code>df_A1</code></td>
<td>
<p>A data frame containing the potential outcome mean estimates under A = 1 for the internal populations.</p>
</td></tr>
<tr><td><code>fit_outcome</code></td>
<td>
<p>Fitted outcome model.</p>
</td></tr>
<tr><td><code>fit_source</code></td>
<td>
<p>Fitted source model.</p>
</td></tr>
<tr><td><code>fit_treatment</code></td>
<td>
<p>Fitted treatment model(s).</p>
</td></tr>
</table>


<h3>References</h3>

<p>Robertson, S.E., Steingrimsson, J.A., Joyce, N.R., Stuart, E.A., &amp; Dahabreh, I.J. (2021). <em>Center-specific causal inference with multicenter trials: Reinterpreting trial evidence in the context of each participating center</em>. arXiv preprint arXiv:2104.05905.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
ai &lt;- ATE_internal(
  X = dat_multisource[, 1:10],
  Y = dat_multisource$Y,
  S = dat_multisource$S,
  A = dat_multisource$A,
  source_model = "MN.glmnet",
  source_model_args = list(),
  treatment_model_type = "separate",
  treatment_model_args = list(
    family = binomial(),
    SL.library = c("SL.glmnet", "SL.nnet", "SL.glm"),
    cvControl = list(V = 5L)
  ),
  outcome_model_args = list(
    family = gaussian(),
    SL.library = c("SL.glmnet", "SL.nnet", "SL.glm"),
    cvControl = list(V = 5L)
  )
)


</code></pre>

<hr>
<h2 id='dat_external'>External dataset</h2><span id='topic+dat_external'></span>

<h3>Description</h3>

<p>Simulated external dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dat_external
</code></pre>


<h3>Format</h3>

<p>A data frame with 10,083 rows and 13 columns. The columns are:
</p>

<table>
<tr>
 <td style="text-align: left;">
 <code>EM</code> </td><td style="text-align: left;"> Effect modifier. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>X2</code>, ..., <code>X10</code>  </td><td style="text-align: left;">  Covariates. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>S</code> </td><td style="text-align: left;"> Source indicator. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>A</code> </td><td style="text-align: left;"> Treatment (1 for treated and 0 for untreated). </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>Y</code> </td><td style="text-align: left;"> Outcome.
</td>
</tr>

</table>


<hr>
<h2 id='dat_multisource'>Multi-source dataset</h2><span id='topic+dat_multisource'></span>

<h3>Description</h3>

<p>Simulated multi-source dataset consisting of 3 sources.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dat_multisource
</code></pre>


<h3>Format</h3>

<p>A data frame with 3,917 rows and 13 columns. The columns are:
</p>

<table>
<tr>
 <td style="text-align: left;">
 <code>EM</code> </td><td style="text-align: left;"> Effect modifier. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>X2</code>, ..., <code>X10</code> </td><td style="text-align: left;"> Covariates. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>S</code> </td><td style="text-align: left;"> Source indicator. </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>A</code> </td><td style="text-align: left;"> Treatment (1 for treated and 0 for untreated). </td>
</tr>
<tr>
 <td style="text-align: left;">
 <code>Y</code> </td><td style="text-align: left;"> Outcome.
</td>
</tr>

</table>


<hr>
<h2 id='plot.ATE_internal'>Plot method for objects of class &quot;ATE_internal&quot;</h2><span id='topic+plot.ATE_internal'></span>

<h3>Description</h3>

<p>This function creates forest plots of objects of class &quot;ATE_internal&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ATE_internal'
plot(x, source_names, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.ATE_internal_+3A_x">x</code></td>
<td>
<p>Object of class &quot;ATE_internal&quot;.</p>
</td></tr>
<tr><td><code id="plot.ATE_internal_+3A_source_names">source_names</code></td>
<td>
<p>optional, vector of character strings specifying the names of the sources. Defaults are the values in <code>S</code> provided by the user to <code><a href="#topic+ATE_internal">ATE_internal</a></code>.</p>
</td></tr>
<tr><td><code id="plot.ATE_internal_+3A_...">...</code></td>
<td>
<p>Other arguments, which are passed to <code><a href="metafor.html#topic+forest.rma">forest.rma</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No value is returned.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ATE_internal">ATE_internal</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
ai &lt;- ATE_internal(
  X = dat_multisource[, 1:10],
  Y = dat_multisource$Y,
  S = dat_multisource$S,
  A = dat_multisource$A,
  source_model = "MN.glmnet",
  source_model_args = list(),
  treatment_model_type = "separate",
  treatment_model_args = list(
    family = binomial(),
    SL.library = c("SL.glmnet", "SL.nnet", "SL.glm"),
    cvControl = list(V = 5L)
  ),
  outcome_model_args = list(
    family = gaussian(),
    SL.library = c("SL.glmnet", "SL.nnet", "SL.glm"),
    cvControl = list(V = 5L)
  )
)
plot(ai)


</code></pre>

<hr>
<h2 id='plot.STE_internal'>Plot method for objects of class &quot;STE_internal&quot;</h2><span id='topic+plot.STE_internal'></span>

<h3>Description</h3>

<p>This function creates forest plots of objects of class &quot;STE_internal&quot;.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'STE_internal'
plot(
  x,
  use_scb = FALSE,
  header = c("Source", "Subgroup", ifelse(use_scb, "Estimate [95% SCB]",
    "Estimate [95% CI]")),
  source_names,
  subgroup_names,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.STE_internal_+3A_x">x</code></td>
<td>
<p>Object of class &quot;STE_internal&quot;.</p>
</td></tr>
<tr><td><code id="plot.STE_internal_+3A_use_scb">use_scb</code></td>
<td>
<p>logical scalar specifying whether the intervals in the forest plot should be simultaneous confidence bands (rather than confidence intervals). The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="plot.STE_internal_+3A_header">header</code></td>
<td>
<p>optional, vector of character strings of length 3, headers for the source, effect modifier subgroup and the estimates in the forest plot.</p>
</td></tr>
<tr><td><code id="plot.STE_internal_+3A_source_names">source_names</code></td>
<td>
<p>optional, vector of character strings specifying the names of the sources. Defaults are the values in <code>S</code> provided by the user to <code><a href="#topic+STE_internal">STE_internal</a></code>.</p>
</td></tr>
<tr><td><code id="plot.STE_internal_+3A_subgroup_names">subgroup_names</code></td>
<td>
<p>optional, vector of character strings specifying the names of the effect modifier subgroups. Defaults are the values in <code>EM</code> provided by the user to <code><a href="#topic+STE_internal">STE_internal</a></code>.</p>
</td></tr>
<tr><td><code id="plot.STE_internal_+3A_...">...</code></td>
<td>
<p>Other arguments, which are passed to <code><a href="metafor.html#topic+forest.rma">forest.rma</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note that users may need to custom set the argument <code>ilab.xpos</code> which specifies the position (along the x-axis) of the effect modifier header and subgroup labels. See <code><a href="metafor.html#topic+forest.rma">forest.rma</a></code> for further details.
</p>


<h3>Value</h3>

<p>No value is returned.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+STE_internal">STE_internal</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
si &lt;- STE_internal(
  X = dat_multisource[, 2:10],
  Y = dat_multisource$Y,
  EM = dat_multisource$EM,
  S = dat_multisource$S,
  A = dat_multisource$A,
  cross_fitting = FALSE,
  source_model = "MN.nnet",
  source_model_args = list(),
  treatment_model_type = "separate",
  treatment_model_args = list(
    family = binomial(),
    SL.library = c("SL.glmnet", "SL.nnet", "SL.glm"),
    cvControl = list(V = 5L)
  ),
  outcome_model_args = list(
    family = gaussian(),
    SL.library = c("SL.glmnet", "SL.nnet", "SL.glm"),
    cvControl = list(V = 5L)
  )
)
plot(si)


</code></pre>

<hr>
<h2 id='print.STE_internal'>Print method for objects of class &quot;ATE_internal&quot;, &quot;ATE_external&quot;, &quot;STE_internal&quot;, or &quot;STE_external&quot;</h2><span id='topic+print.STE_internal'></span><span id='topic+print.ATE_internal'></span><span id='topic+print.STE_external'></span><span id='topic+print.ATE_external'></span>

<h3>Description</h3>

<p>Print method for objects of class &quot;ATE_internal&quot;, &quot;ATE_external&quot;, &quot;STE_internal&quot;, or &quot;STE_external&quot;
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'STE_internal'
print(x, digits = 4, ...)

## S3 method for class 'ATE_internal'
print(x, digits = 4, ...)

## S3 method for class 'STE_external'
print(x, digits = 4, ...)

## S3 method for class 'ATE_external'
print(x, digits = 4, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.STE_internal_+3A_x">x</code></td>
<td>
<p>Object of class &quot;ATE_internal&quot;, &quot;ATE_external&quot;, &quot;STE_internal&quot;, or &quot;STE_external&quot;.</p>
</td></tr>
<tr><td><code id="print.STE_internal_+3A_digits">digits</code></td>
<td>
<p>Integer specifying the number of decimal places to display.</p>
</td></tr>
<tr><td><code id="print.STE_internal_+3A_...">...</code></td>
<td>
<p>Other arguments (ignored).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No value is returned.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ATE_internal">ATE_internal</a></code>, <code><a href="#topic+ATE_external">ATE_external</a></code>, <code><a href="#topic+STE_internal">STE_internal</a></code>, <code><a href="#topic+STE_external">STE_external</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
si &lt;- STE_internal(
  X = dat_multisource[, 2:10],
  Y = dat_multisource$Y,
  EM = dat_multisource$EM,
  S = dat_multisource$S,
  A = dat_multisource$A,
  cross_fitting = FALSE,
  source_model = "MN.nnet",
  source_model_args = list(),
  treatment_model_type = "separate",
  treatment_model_args = list(
    family = binomial(),
    SL.library = c("SL.glmnet", "SL.nnet", "SL.glm"),
    cvControl = list(V = 5L)
  ),
  outcome_model_args = list(
    family = gaussian(),
    SL.library = c("SL.glmnet", "SL.nnet", "SL.glm"),
    cvControl = list(V = 5L)
  )
)
print(si)


</code></pre>

<hr>
<h2 id='STE_external'>Estimating the Subgroup Treatment Effect (STE) in an external target population using multi-source data</h2><span id='topic+STE_external'></span>

<h3>Description</h3>

<p>Doubly-robust and efficient estimator for the STE in an external target population using multi-source data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>STE_external(
  X,
  X_external,
  EM,
  EM_external,
  Y,
  S,
  A,
  cross_fitting = FALSE,
  replications = 10L,
  source_model = "MN.glmnet",
  source_model_args = list(),
  treatment_model_type = "separate",
  treatment_model_args = list(),
  external_model_args = list(),
  outcome_model_args = list(),
  show_progress = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="STE_external_+3A_x">X</code></td>
<td>
<p>Data frame (or matrix) containing the covariate data in the multi-source data. It should have <code class="reqn">n</code> rows and <code class="reqn">p</code> columns. Character variables will be converted to factors.</p>
</td></tr>
<tr><td><code id="STE_external_+3A_x_external">X_external</code></td>
<td>
<p>Data frame (or matrix) containing the covariate data in the external target population. It should have <code class="reqn">n_0</code> rows and <code class="reqn">p</code> columns. This is the external data counterpart to the <code>X</code> argument.</p>
</td></tr>
<tr><td><code id="STE_external_+3A_em">EM</code></td>
<td>
<p>Vector of length <code class="reqn">n</code> containing the effect modifier in the multi-source data. If <code>EM</code> is a factor, it will maintain its subgroup level order; otherwise it will be converted to a factor with default level order.</p>
</td></tr>
<tr><td><code id="STE_external_+3A_em_external">EM_external</code></td>
<td>
<p>Vector of length <code class="reqn">n_0</code> containing the effect modifier in the external data. This is the external data counterpart to the <code>EM</code> argument.</p>
</td></tr>
<tr><td><code id="STE_external_+3A_y">Y</code></td>
<td>
<p>Vector of length <code class="reqn">n</code> containing the outcome.</p>
</td></tr>
<tr><td><code id="STE_external_+3A_s">S</code></td>
<td>
<p>Vector of length <code class="reqn">n</code> containing the source indicator. If <code>S</code> is a factor, it will maintain its level order; otherwise it will be converted to a factor with the default level order. The order will be carried over to the outputs and plots.</p>
</td></tr>
<tr><td><code id="STE_external_+3A_a">A</code></td>
<td>
<p>Vector of length <code class="reqn">n</code> containing the binary treatment (1 for treated and 0 for untreated).</p>
</td></tr>
<tr><td><code id="STE_external_+3A_cross_fitting">cross_fitting</code></td>
<td>
<p>Logical specifying whether sample splitting and cross fitting should be used.</p>
</td></tr>
<tr><td><code id="STE_external_+3A_replications">replications</code></td>
<td>
<p>Integer specifying the number of sample splitting and cross fitting replications to perform, if <code>cross_fitting = TRUE</code>. The default is <code>10L</code>.</p>
</td></tr>
<tr><td><code id="STE_external_+3A_source_model">source_model</code></td>
<td>
<p>Character string specifying the (penalized) multinomial logistic regression for estimating the source model. It has two options: &quot;<code>MN.glmnet</code>&quot; (default) and &quot;<code>MN.nnet</code>&quot;, which use <span class="pkg">glmnet</span> and <span class="pkg">nnet</span> respectively.</p>
</td></tr>
<tr><td><code id="STE_external_+3A_source_model_args">source_model_args</code></td>
<td>
<p>List specifying the arguments for the source model (in <span class="pkg">glmnet</span> or <span class="pkg">nnet</span>).</p>
</td></tr>
<tr><td><code id="STE_external_+3A_treatment_model_type">treatment_model_type</code></td>
<td>
<p>Character string specifying how the treatment model is estimated. Options include &quot;<code>separate</code>&quot; (default) and &quot;<code>joint</code>&quot;. If &quot;<code>separate</code>&quot;, the treatment model (i.e., <code class="reqn">P(A=1|X, S=s)</code>) is estimated by regressing <code class="reqn">A</code> on <code class="reqn">X</code> within each specific internal population <code class="reqn">S=s</code>. If &quot;<code>joint</code>&quot;, the treatment model is estimated by regressing <code class="reqn">A</code> on <code class="reqn">X</code> and <code class="reqn">S</code> using the multi-source population.</p>
</td></tr>
<tr><td><code id="STE_external_+3A_treatment_model_args">treatment_model_args</code></td>
<td>
<p>List specifying the arguments for the treatment model (in <span class="pkg">SuperLearner</span>).</p>
</td></tr>
<tr><td><code id="STE_external_+3A_external_model_args">external_model_args</code></td>
<td>
<p>List specifying the arguments for the external model (in <span class="pkg">SuperLearner</span>).</p>
</td></tr>
<tr><td><code id="STE_external_+3A_outcome_model_args">outcome_model_args</code></td>
<td>
<p>List specifying the arguments for the outcome model  (in <span class="pkg">SuperLearner</span>).</p>
</td></tr>
<tr><td><code id="STE_external_+3A_show_progress">show_progress</code></td>
<td>
<p>Logical specifying whether to print a progress bar for the cross-fit replicates completed, if <code>cross_fitting = TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Data structure:</strong>
</p>
<p>The multi-source dataset consists the outcome <code>Y</code>, source <code>S</code>, treatment <code>A</code>, covariates <code>X</code> (<code class="reqn">n \times p</code>), and effect modifier <code>EM</code> in the internal populations. The data sources can be trials, observational studies, or a combination of both.
</p>
<p>The external dataset contains only covariates <code>X_external</code> (<code class="reqn">n_0 \times p</code>) and the effect modifier <code>EM_external</code>.
</p>
<p><strong>Estimation of nuissance parameters:</strong>
</p>
<p>The following models are fit:
</p>

<ul>
<li><p> External model: <code class="reqn">q(X)=P(R=1|X)</code>, where <code class="reqn">R</code> takes value 1 if the subject belongs to any of the internal dataset and 0 if the subject belongs to the external dataset
</p>
</li>
<li><p> Propensity score model: <code class="reqn">\eta_a(X)=P(A=a|X)</code>. We perform the decomposition <code class="reqn">P(A=a|X)=\sum_{s} P(A=a|X, S=s)P(S=s|X)</code> and estimate <code class="reqn">P(A=1|X, S=s)</code> (i.e., the treatment model) and <code class="reqn">P(S=s|X)</code> (i.e., the source model).
</p>
</li>
<li><p> Outcome model: <code class="reqn">\mu_a(X)=E(Y|X, A=a)</code>
</p>
</li></ul>

<p>The models are estimated by <span class="pkg">SuperLearner</span> with the exception of the source model which is estimated by <span class="pkg">glmnet</span> or <span class="pkg">nnet</span>.
</p>
<p><strong>STE estimation:</strong>
</p>
<p>The estimator is
</p>
<p style="text-align: center;"><code class="reqn">
 \dfrac{\widehat \kappa}{N}\sum\limits_{i=1}^{N} \Bigg[ I(R_i = 0) \widehat \mu_a(X_i)
 +I(A_i = a, R_i=1) \dfrac{1-\widehat q(X_i)}{\widehat \eta_a(X_i)\widehat q(X_i)}  \Big\{ Y_i - \widehat \mu_a(X_i) \Big\} \Bigg],
</code>
</p>

<p>where <code class="reqn">N=n+n_0</code>, <code class="reqn">\widehat \kappa=\{N^{-1} \sum_{i=1}^N I(R_i=0)\}^{-1}</code>, and  and <code class="reqn">\widetilde X</code> denotes the effect modifier.
</p>
<p>The estimator is doubly robust and non-parametrically efficient. To achieve non-parametric efficiency and asymptotic normality, it requires that <code class="reqn">||\widehat \mu_a(X) -\mu_a(X)||\big\{||\widehat \eta_a(X) -\eta_a(X)||+||\widehat q(X) -q(X)||\big\}=o_p(n^{-1/2})</code>.
In addition, sample splitting and cross-fitting can be performed to avoid the Donsker class assumption.
</p>
<p>When a data source is a randomized trial, it is still recommended to estimate the propensity score for optimal efficiency.
</p>


<h3>Value</h3>

<p>An object of class &quot;STE_external&quot;. This object is a list with the following elements:
</p>
<table>
<tr><td><code>df_dif</code></td>
<td>
<p>A data frame containing the subgroup treatment effect (mean difference) estimates for the extenal data.</p>
</td></tr>
<tr><td><code>df_A0</code></td>
<td>
<p>A data frame containing the subgroup potential outcome mean estimates under A = 0 for the extenal data.</p>
</td></tr>
<tr><td><code>df_A1</code></td>
<td>
<p>A data frame containing the subgroup potential outcome mean estimates under A = 1 for the extenal data.</p>
</td></tr>
<tr><td><code>fit_outcome</code></td>
<td>
<p>Fitted outcome model.</p>
</td></tr>
<tr><td><code>fit_source</code></td>
<td>
<p>Fitted source model.</p>
</td></tr>
<tr><td><code>fit_treatment</code></td>
<td>
<p>Fitted treatment model(s).</p>
</td></tr>
<tr><td><code>fit_external</code></td>
<td>
<p>Fitted external model.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
se &lt;- STE_external(
  X = dat_multisource[, 2:10],
  Y = dat_multisource$Y,
  EM = dat_multisource$EM,
  S = dat_multisource$S,
  A = dat_multisource$A,
  X_external = dat_external[, 2:10],
  EM_external = dat_external$EM,
  cross_fitting = FALSE,
  source_model = "MN.nnet",
  source_model_args = list(),
  treatment_model_type = "separate",
  treatment_model_args = list(
    family = binomial(),
    SL.library = c("SL.glmnet", "SL.nnet", "SL.glm"),
    cvControl = list(V = 5L)
  ),
  external_model_args = list(
    family = binomial(),
    SL.library = c("SL.glmnet", "SL.nnet", "SL.glm"),
    cvControl = list(V = 5L)
  ),
  outcome_model_args = list(
    family = gaussian(),
    SL.library = c("SL.glmnet", "SL.nnet", "SL.glm"),
    cvControl = list(V = 5L)
  )
)


</code></pre>

<hr>
<h2 id='STE_internal'>Estimating the Subgroup Treatment Effect (STE) in an internal target population using multi-source data</h2><span id='topic+STE_internal'></span>

<h3>Description</h3>

<p>Doubly-robust and efficient estimator for the STE in each internal target population using multi-source data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>STE_internal(
  X,
  Y,
  EM,
  S,
  A,
  cross_fitting = FALSE,
  replications = 10L,
  source_model = "MN.glmnet",
  source_model_args = list(),
  treatment_model_type = "separate",
  treatment_model_args = list(),
  outcome_model_args = list(),
  show_progress = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="STE_internal_+3A_x">X</code></td>
<td>
<p>Data frame (or matrix) containing the covariate data in the multi-source data. It should have <code class="reqn">n</code> rows and <code class="reqn">p</code> columns. Character variables will be converted to factors.</p>
</td></tr>
<tr><td><code id="STE_internal_+3A_y">Y</code></td>
<td>
<p>Vector of length <code class="reqn">n</code> containing the outcome.</p>
</td></tr>
<tr><td><code id="STE_internal_+3A_em">EM</code></td>
<td>
<p>Vector of length <code class="reqn">n</code> containing the effect modifier in the multi-source data. If <code>EM</code> is a factor, it will maintain its subgroup level order; otherwise it will be converted to a factor with default level order.</p>
</td></tr>
<tr><td><code id="STE_internal_+3A_s">S</code></td>
<td>
<p>Vector of length <code class="reqn">n</code> containing the source indicator. If <code>S</code> is a factor, it will maintain its level order; otherwise it will be converted to a factor with the default level order. The order will be carried over to the outputs and plots.</p>
</td></tr>
<tr><td><code id="STE_internal_+3A_a">A</code></td>
<td>
<p>Vector of length <code class="reqn">n</code> containing the binary treatment (1 for treated and 0 for untreated).</p>
</td></tr>
<tr><td><code id="STE_internal_+3A_cross_fitting">cross_fitting</code></td>
<td>
<p>Logical specifying whether sample splitting and cross fitting should be used.</p>
</td></tr>
<tr><td><code id="STE_internal_+3A_replications">replications</code></td>
<td>
<p>Integer specifying the number of sample splitting and cross fitting replications to perform, if <code>cross_fitting = TRUE</code>. The default is <code>10L</code>.</p>
</td></tr>
<tr><td><code id="STE_internal_+3A_source_model">source_model</code></td>
<td>
<p>Character string specifying the (penalized) multinomial logistic regression for estimating the source model. It has two options: &quot;<code>MN.glmnet</code>&quot; (default) and &quot;<code>MN.nnet</code>&quot;, which use <span class="pkg">glmnet</span> and <span class="pkg">nnet</span> respectively.</p>
</td></tr>
<tr><td><code id="STE_internal_+3A_source_model_args">source_model_args</code></td>
<td>
<p>List specifying the arguments for the source model (in <span class="pkg">glmnet</span> or <span class="pkg">nnet</span>).</p>
</td></tr>
<tr><td><code id="STE_internal_+3A_treatment_model_type">treatment_model_type</code></td>
<td>
<p>Character string specifying how the treatment model is estimated. Options include &quot;<code>separate</code>&quot; (default) and &quot;<code>joint</code>&quot;. If &quot;<code>separate</code>&quot;, the treatment model (i.e., <code class="reqn">P(A=1|X, S=s)</code>) is estimated by regressing <code class="reqn">A</code> on <code class="reqn">X</code> within each specific internal population <code class="reqn">S=s</code>. If &quot;<code>joint</code>&quot;, the treatment model is estimated by regressing <code class="reqn">A</code> on <code class="reqn">X</code> and <code class="reqn">S</code> using the multi-source population.</p>
</td></tr>
<tr><td><code id="STE_internal_+3A_treatment_model_args">treatment_model_args</code></td>
<td>
<p>List specifying the arguments for the treatment model (in <span class="pkg">SuperLearner</span>).</p>
</td></tr>
<tr><td><code id="STE_internal_+3A_outcome_model_args">outcome_model_args</code></td>
<td>
<p>List specifying the arguments for the outcome model  (in <span class="pkg">SuperLearner</span>).</p>
</td></tr>
<tr><td><code id="STE_internal_+3A_show_progress">show_progress</code></td>
<td>
<p>Logical specifying whether to print a progress bar for the cross-fit replicates completed, if <code>cross_fitting = TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Data structure:</strong>
</p>
<p>The multi-source dataset consists the outcome <code>Y</code>, source <code>S</code>, treatment <code>A</code>, covariates <code>X</code> (<code class="reqn">n \times p</code>), and effect modifier <code>EM</code> in the internal populations. The data sources can be trials, observational studies, or a combination of both.
</p>
<p><strong>Estimation of nuissance parameters:</strong>
</p>
<p>The following models are fit:
</p>

<ul>
<li><p> Propensity score model: <code class="reqn">\eta_a(X)=P(A=a|X)</code>. We perform the decomposition <code class="reqn">P(A=a|X)=\sum_{s} P(A=a|X, S=s)P(S=s|X)</code> and estimate <code class="reqn">P(A=1|X, S=s)</code> (i.e., the treatment model) and <code class="reqn">q_s(X)=P(S=s|X)</code> (i.e., the source model).
</p>
</li>
<li><p> Outcome model: <code class="reqn">\mu_a(X)=E(Y|X, A=a)</code>
</p>
</li></ul>

<p>The models are estimated by <span class="pkg">SuperLearner</span> with the exception of the source model which is estimated by <span class="pkg">glmnet</span> or <span class="pkg">nnet</span>.
</p>
<p><strong>STE estimation:</strong>
</p>
<p>The estimator is
</p>
<p style="text-align: center;"><code class="reqn">
 \dfrac{\widehat \kappa}{n}\sum\limits_{i=1}^{n} \Bigg[ I(S_i = s, \widetilde X_i=\widetilde x) \widehat \mu_a(X_i)
 +I(A_i = a, \widetilde X_i=\widetilde x) \dfrac{\widehat q_{s}(X_i)}{\widehat \eta_a(X_i)}  \Big\{ Y_i - \widehat \mu_a(X_i) \Big\} \Bigg],
</code>
</p>

<p>where <code class="reqn">\widehat \kappa=\{n^{-1} \sum_{i=1}^n I(S_i=s, \widetilde X_i=\widetilde x)\}^{-1}</code> and <code class="reqn">\widetilde X</code> denotes the effect modifier.
</p>
<p>The estimator is doubly robust and non-parametrically efficient. To achieve non-parametric efficiency and asymptotic normality, it requires that <code class="reqn">||\widehat \mu_a(X) -\mu_a(X)||\big\{||\widehat \eta_a(X) -\eta_a(X)||+||\widehat q_s(X) -q_s(X)||\big\}=o_p(n^{-1/2})</code>.
In addition, sample splitting and cross-fitting can be performed to avoid the Donsker class assumption.
</p>
<p>When a data source is a randomized trial, it is still recommended to estimate the propensity score for optimal efficiency.
</p>


<h3>Value</h3>

<p>An object of class &quot;STE_internal&quot;. This object is a list with the following elements:
</p>
<table>
<tr><td><code>df_dif</code></td>
<td>
<p>A data frame containing the subgroup treatment effect (mean difference) estimates for the internal populations.</p>
</td></tr>
<tr><td><code>df_A0</code></td>
<td>
<p>A data frame containing the subgroup potential outcome mean estimates under A = 0 for the internal populations.</p>
</td></tr>
<tr><td><code>df_A1</code></td>
<td>
<p>A data frame containing the subgroup potential outcome mean estimates under A = 1 for the internal populations.</p>
</td></tr>
<tr><td><code>fit_outcome</code></td>
<td>
<p>Fitted outcome model.</p>
</td></tr>
<tr><td><code>fit_source</code></td>
<td>
<p>Fitted source model.</p>
</td></tr>
<tr><td><code>fit_treatment</code></td>
<td>
<p>Fitted treatment model(s).</p>
</td></tr>
<tr><td><code>...</code></td>
<td>
<p>Some additional elements.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
si &lt;- STE_internal(
  X = dat_multisource[, 2:10],
  Y = dat_multisource$Y,
  EM = dat_multisource$EM,
  S = dat_multisource$S,
  A = dat_multisource$A,
  cross_fitting = FALSE,
  source_model = "MN.nnet",
  source_model_args = list(),
  treatment_model_type = "separate",
  treatment_model_args = list(
    family = binomial(),
    SL.library = c("SL.glmnet", "SL.nnet", "SL.glm"),
    cvControl = list(V = 5L)
  ),
  outcome_model_args = list(
    family = gaussian(),
    SL.library = c("SL.glmnet", "SL.nnet", "SL.glm"),
    cvControl = list(V = 5L)
  )
)


</code></pre>

<hr>
<h2 id='summary.STE_internal'>Summary method for objects of class &quot;ATE_internal&quot;, &quot;ATE_external&quot;, &quot;STE_internal&quot;, or &quot;STE_external&quot;</h2><span id='topic+summary.STE_internal'></span><span id='topic+summary.STE_external'></span><span id='topic+summary.ATE_external'></span><span id='topic+summary.ATE_internal'></span>

<h3>Description</h3>

<p>Summary method for objects of class &quot;ATE_internal&quot;, &quot;ATE_external&quot;, &quot;STE_internal&quot;, or &quot;STE_external&quot;
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'STE_internal'
summary(object, digits = 4, ...)

## S3 method for class 'STE_external'
summary(object, digits = 4, ...)

## S3 method for class 'ATE_external'
summary(object, digits = 4, ...)

## S3 method for class 'ATE_internal'
summary(object, digits = 4, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.STE_internal_+3A_object">object</code></td>
<td>
<p>Object of class &quot;ATE_internal&quot;, &quot;ATE_external&quot;, &quot;STE_internal&quot;, or &quot;STE_external&quot;.</p>
</td></tr>
<tr><td><code id="summary.STE_internal_+3A_digits">digits</code></td>
<td>
<p>Integer specifying the number of decimal places to display.</p>
</td></tr>
<tr><td><code id="summary.STE_internal_+3A_...">...</code></td>
<td>
<p>Other arguments.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No value is returned.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ATE_internal">ATE_internal</a></code>, <code><a href="#topic+ATE_external">ATE_external</a></code>, <code><a href="#topic+STE_internal">STE_internal</a></code>, <code><a href="#topic+STE_external">STE_external</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
si &lt;- STE_internal(
  X = dat_multisource[, 2:10],
  Y = dat_multisource$Y,
  EM = dat_multisource$EM,
  S = dat_multisource$S,
  A = dat_multisource$A,
  cross_fitting = FALSE,
  source_model = "MN.nnet",
  source_model_args = list(),
  treatment_model_type = "separate",
  treatment_model_args = list(
    family = binomial(),
    SL.library = c("SL.glmnet", "SL.nnet", "SL.glm"),
    cvControl = list(V = 5L)
  ),
  outcome_model_args = list(
    family = gaussian(),
    SL.library = c("SL.glmnet", "SL.nnet", "SL.glm"),
    cvControl = list(V = 5L)
  )
)
summary(si)


</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
