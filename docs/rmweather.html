<!DOCTYPE html><html lang="en"><head><title>Help for package rmweather</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {rmweather}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#+25+26gt+3B+25'><p>Pseudo-function to re-export <strong>magrittr</strong>'s pipe.</p></a></li>
<li><a href='#base+20functions'><p>Pseudo-function to re-export functions from the <strong>stats</strong> package.</p></a></li>
<li><a href='#data_london'><p>Example observational data for the <strong>rmweather</strong> package.</p></a></li>
<li><a href='#data_london_normalised'><p>Example of meteorologically normalised data for the <strong>rmweather</strong> package.</p></a></li>
<li><a href='#dplyr+20functions'><p>Pseudo-function to re-export <strong>dplyr</strong>'s common functions.</p></a></li>
<li><a href='#model_london'><p>Example <strong>ranger</strong> random forest model for the <strong>rmweather</strong></p>
package.</a></li>
<li><a href='#rmw_calculate_model_errors'><p>Function to calculate observed-predicted error statistics.</p></a></li>
<li><a href='#rmw_clip'><p>Function to &quot;clip&quot; the edges of a normalised time series after being</p>
produced with <code>rmw_normalise</code>.</a></li>
<li><a href='#rmw_do_all'><p>Function to train a random forest model to predict (usually) pollutant</p>
concentrations using meteorological and time variables and then immediately
normalise a variable for &quot;average&quot; meteorological conditions.</a></li>
<li><a href='#rmw_find_breakpoints'><p>Function to detect breakpoints in a data frame using a linear regression</p>
based approach.</a></li>
<li><a href='#rmw_model_nested_sets'><p>Function to train random forest models using a nested tibble.</p></a></li>
<li><a href='#rmw_model_statistics'><p>Functions to extract model statistics from a model calculated with</p>
<code>rmw_calculate_model</code>.</a></li>
<li><a href='#rmw_nest_for_modelling'><p>Function to nest observational data before modelling with <strong>rmweather</strong>.</p></a></li>
<li><a href='#rmw_normalise'><p>Function to normalise a variable for &quot;average&quot; meteorological conditions.</p></a></li>
<li><a href='#rmw_normalise_nested_sets'><p>Function to normalise a variable for &quot;average&quot; meteorological conditions in</p>
a nested tibble.</a></li>
<li><a href='#rmw_partial_dependencies'><p>Function to calculate partial dependencies after training with</p>
<strong>rmweather</strong>.</a></li>
<li><a href='#rmw_plot_importance'><p>Function to plot random forest variable importances after training by</p>
<code>rmw_train_model</code>.</a></li>
<li><a href='#rmw_plot_normalised'><p>Function to plot the meteorologically normalised time series after</p>
<code>rmw_normalise</code>.</a></li>
<li><a href='#rmw_plot_partial_dependencies'><p>Function to plot partial dependencies after calculation by</p>
<code>rmw_partial_dependencies</code>.</a></li>
<li><a href='#rmw_plot_test_prediction'><p>Function to plot the test set and predicted set after</p>
<code>rmw_predict_the_test_set</code>.</a></li>
<li><a href='#rmw_predict'><p>Function to predict using a <strong>ranger</strong> random forest.</p></a></li>
<li><a href='#rmw_predict_nested_partial_dependencies'><p>Function to calculate partial dependencies from a random forest models using</p>
a nested tibble.</a></li>
<li><a href='#rmw_predict_nested_sets'><p>Function to make predictions from a random forest models using a nested</p>
tibble.</a></li>
<li><a href='#rmw_predict_nested_sets_by_year'><p>Function to make predictions by meteorological year from a random forest</p>
models using a nested tibble.</a></li>
<li><a href='#rmw_predict_the_test_set'><p>Functions to use a model to predict the observations within a test set after</p>
<code>rmw_calculate_model</code>.</a></li>
<li><a href='#rmw_prepare_data'><p>Function to prepare a data frame for modelling with <strong>rmweather</strong>.</p></a></li>
<li><a href='#rmw_train_model'><p>Function to train a random forest model to predict (usually) pollutant</p>
concentrations using meteorological and time variables.</a></li>
<li><a href='#system_cpu_core_count'><p>Function to return the system's number of CPU cores.</p></a></li>
<li><a href='#wday_monday'><p>Function to get weekday number from a date where <code>1</code> is Monday and</p>
<code>7</code> is Sunday.</a></li>
<li><a href='#zzz'><p>Squash the global variable notes when building a package.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Tools to Conduct Meteorological Normalisation and Counterfactual
Modelling for Air Quality Data</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.62</td>
</tr>
<tr>
<td>Date:</td>
<td>2025-02-20</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Stuart K. Grange &lt;s.k.grange@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>An integrated set of tools to allow data users to conduct 
    meteorological normalisation and counterfactual modelling for air quality 
    data. The meteorological normalisation technique uses predictive random 
    forest models to remove variation of pollutant concentrations so trends and 
    interventions can be explored in a robust way. For examples, see 
    Grange et al. (2018) &lt;<a href="https://doi.org/10.5194%2Facp-18-6223-2018">doi:10.5194/acp-18-6223-2018</a>&gt; and 
    Grange and Carslaw (2019) &lt;<a href="https://doi.org/10.1016%2Fj.scitotenv.2018.10.344">doi:10.1016/j.scitotenv.2018.10.344</a>&gt;. The random
    forest models can also be used for counterfactual or business as usual (BAU) 
    modelling by using the models to predict, from the model's perspective, the 
    future. For an example, see Grange et al. (2021) &lt;<a href="https://doi.org/10.5194%2Facp-2020-1171">doi:10.5194/acp-2020-1171</a>&gt;.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/skgrange/rmweather">https://github.com/skgrange/rmweather</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/skgrange/rmweather/issues">https://github.com/skgrange/rmweather/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> | file LICENSE</td>
</tr>
<tr>
<td>ByteCompile:</td>
<td>true</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.2.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr (&ge; 1.0.1), ggplot2, lubridate, magrittr, pdp, purrr (&ge;
1.0.0), ranger, stringr, strucchange, tibble, viridis, tidyr,
cli</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat, openair</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-02-20 23:53:41 UTC; stuart</td>
</tr>
<tr>
<td>Author:</td>
<td>Stuart K. Grange <a href="https://orcid.org/0000-0003-4093-3596"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [cre, aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-02-21 00:20:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='+25+26gt+3B+25'>Pseudo-function to re-export <strong>magrittr</strong>'s pipe.</h2><span id='topic++25+3E+25'></span>

<h3>Description</h3>

<p>Pseudo-function to re-export <strong>magrittr</strong>'s pipe.
</p>

<hr>
<h2 id='base+20functions'>Pseudo-function to re-export functions from the <strong>stats</strong> package.</h2><span id='topic+base+20functions'></span>

<h3>Description</h3>

<p>Pseudo-function to re-export functions from the <strong>stats</strong> package.
</p>

<hr>
<h2 id='data_london'>Example observational data for the <strong>rmweather</strong> package.</h2><span id='topic+data_london'></span>

<h3>Description</h3>

<p>These example data are daily means of NO2 and NOx observations at London 
Marylebone Road. The accompanying surface meteorological data are from
London Heathrow, a major airport located 23 km west of Central London.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data_london
</code></pre>


<h3>Format</h3>

<p>Tibble with 15676 observations and 11 variables. The variables are:
<code>date</code>, <code>date_end</code>, <code>site</code>, <code>site_name</code>, <code>value</code>, 
<code>air_temp</code>, <code>atmospheric_pressure</code>, <code>rh</code>, <code>wd</code>, and 
<code>ws</code>. The dates are in <code>POSIXct</code> format, the site variables are 
characters and all other variables are numeric.
</p>


<h3>Details</h3>

<p>The NO2 and NOx observations are sourced from the European Commission Air 
Quality e-Reporting <a href="https://cdr.eionet.europa.eu/gb/eu/aqd/e1a/">repository</a>
which can be freely shared with acknowledgement of the source. The 
meteorological data are sourced from the Integrated Surface Data (ISD) 
database which cannot be redistributed for commercial purposes and are bound 
to the <a href="https://www.weather.gov/media/im/wmo_827_enCG-XII-Res40.pdf">WMO Resolution 40 Policy</a>.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load rmweather's example data and check
head(data_london)

</code></pre>

<hr>
<h2 id='data_london_normalised'>Example of meteorologically normalised data for the <strong>rmweather</strong> package.</h2><span id='topic+data_london_normalised'></span>

<h3>Description</h3>

<p>These example data are derived from the observational data included in 
<strong>rmweather</strong> and represent meteorologically normalised NO2 
concentrations at London Marylebone Road, aggregated to monthly resolution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data_london_normalised
</code></pre>


<h3>Format</h3>

<p>Tibble with 258 observations and 5 variables. The variables are:
<code>date</code>, <code>date_end</code>, <code>site</code>, <code>site_name</code>, and 
<code>value_predict</code>. The dates are in <code>POSIXct</code> format, the site 
variables are characters and <code>value_predict</code> is numeric.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data_london">data_london</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load rmweather's meteorologically normalised example data and check
head(data_london_normalised)

</code></pre>

<hr>
<h2 id='dplyr+20functions'>Pseudo-function to re-export <strong>dplyr</strong>'s common functions.</h2><span id='topic+dplyr+20functions'></span>

<h3>Description</h3>

<p>Pseudo-function to re-export <strong>dplyr</strong>'s common functions.
</p>

<hr>
<h2 id='model_london'>Example <strong>ranger</strong> random forest model for the <strong>rmweather</strong> 
package.</h2><span id='topic+model_london'></span>

<h3>Description</h3>

<p>This example object was created from the observational data included in 
<strong>rmweather</strong> and is a random forest model returned by 
<code><a href="#topic+rmw_train_model">rmw_train_model</a></code>. This forest is only made from one tree to keep
the file size small and is only used for the package's examples.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>model_london
</code></pre>


<h3>Format</h3>

<p>A ranger object, a named list with 16 elements.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>


<h3>See Also</h3>

<p><code><a href="#topic+data_london">data_london</a></code>, <code><a href="#topic+rmw_train_model">rmw_train_model</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load rmweather's ranger model example data and see what elements it contains
names(model_london)

# Print ranger object
print(model_london)

</code></pre>

<hr>
<h2 id='rmw_calculate_model_errors'>Function to calculate observed-predicted error statistics.</h2><span id='topic+rmw_calculate_model_errors'></span>

<h3>Description</h3>

<p>Function to calculate observed-predicted error statistics.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmw_calculate_model_errors(
  df,
  value_model = "value_predict",
  value_observed = "value",
  testing_only = TRUE,
  as_long = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rmw_calculate_model_errors_+3A_df">df</code></td>
<td>
<p>Data frame with observed-predicted variables.</p>
</td></tr>
<tr><td><code id="rmw_calculate_model_errors_+3A_value_model">value_model</code></td>
<td>
<p>The modelled/predicted variable in <code>"df"</code>.</p>
</td></tr>
<tr><td><code id="rmw_calculate_model_errors_+3A_value_observed">value_observed</code></td>
<td>
<p>The observed variable in <code>"df"</code>.</p>
</td></tr>
<tr><td><code id="rmw_calculate_model_errors_+3A_testing_only">testing_only</code></td>
<td>
<p>Should only the testing set be used for the calculation 
of errors?</p>
</td></tr>
<tr><td><code id="rmw_calculate_model_errors_+3A_as_long">as_long</code></td>
<td>
<p>Should the returned tibble be in &quot;long&quot; format? This is useful
for plotting.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Tibble.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>

<hr>
<h2 id='rmw_clip'>Function to &quot;clip&quot; the edges of a normalised time series after being 
produced with <code><a href="#topic+rmw_normalise">rmw_normalise</a></code>.</h2><span id='topic+rmw_clip'></span>

<h3>Description</h3>

<p><code>rmw_clip</code> helps if the random forest model behaves strangely at the 
beginning and end of the time series during prediction.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmw_clip(df, seconds = 31536000/2)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rmw_clip_+3A_df">df</code></td>
<td>
<p>Data frame from <code><a href="#topic+rmw_normalise">rmw_normalise</a></code>.</p>
</td></tr>
<tr><td><code id="rmw_clip_+3A_seconds">seconds</code></td>
<td>
<p>Number of seconds to clip from start and end of time-series. 
The default is half a year.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Data frame.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rmw_normalise">rmw_normalise</a></code>, <code><a href="#topic+rmw_plot_normalised">rmw_plot_normalised</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Clip the edges of a normalised time series, default is half a year
data_normalised_clipped &lt;- rmw_clip(data_london_normalised)

</code></pre>

<hr>
<h2 id='rmw_do_all'>Function to train a random forest model to predict (usually) pollutant
concentrations using meteorological and time variables and then immediately
normalise a variable for &quot;average&quot; meteorological conditions.</h2><span id='topic+rmw_do_all'></span>

<h3>Description</h3>

<p><code>rmw_do_all</code> is a user-level function to conduct the meteorological 
normalisation process in one step.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmw_do_all(
  df,
  variables,
  variables_sample = NA,
  n_trees = 300,
  min_node_size = 5,
  mtry = NULL,
  keep_inbag = TRUE,
  n_samples = 300,
  replace = TRUE,
  se = FALSE,
  aggregate = TRUE,
  n_cores = NA,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rmw_do_all_+3A_df">df</code></td>
<td>
<p>Input data frame after preparation with 
<code><a href="#topic+rmw_prepare_data">rmw_prepare_data</a></code>. <code>df</code> has a number of constraints which 
will be checked for before modelling.</p>
</td></tr>
<tr><td><code id="rmw_do_all_+3A_variables">variables</code></td>
<td>
<p>Independent/explanatory variables used to predict 
<code>"value"</code>.</p>
</td></tr>
<tr><td><code id="rmw_do_all_+3A_variables_sample">variables_sample</code></td>
<td>
<p>Variables to use for the normalisation step. If not 
used, the default of all variables used for training the model with the 
exception of <code>date_unix</code>, the trend term (see 
<code><a href="#topic+rmw_normalise">rmw_normalise</a></code>).</p>
</td></tr>
<tr><td><code id="rmw_do_all_+3A_n_trees">n_trees</code></td>
<td>
<p>Number of trees to grow to make up the forest.</p>
</td></tr>
<tr><td><code id="rmw_do_all_+3A_min_node_size">min_node_size</code></td>
<td>
<p>Minimal node size.</p>
</td></tr>
<tr><td><code id="rmw_do_all_+3A_mtry">mtry</code></td>
<td>
<p>Number of variables to possibly split at in each node. Default is 
the (rounded down) square root of the number variables.</p>
</td></tr>
<tr><td><code id="rmw_do_all_+3A_keep_inbag">keep_inbag</code></td>
<td>
<p>Should in-bag data be kept in the <strong>ranger</strong> model 
object? This needs to be <code>TRUE</code> if standard errors are to be calculated
when predicting with the model.</p>
</td></tr>
<tr><td><code id="rmw_do_all_+3A_n_samples">n_samples</code></td>
<td>
<p>Number of times to sample <code>df</code> and then predict?</p>
</td></tr>
<tr><td><code id="rmw_do_all_+3A_replace">replace</code></td>
<td>
<p>Should <code>variables</code> be sampled with replacement?</p>
</td></tr>
<tr><td><code id="rmw_do_all_+3A_se">se</code></td>
<td>
<p>Should the standard error of the predictions be calculated too? 
The standard error method is the &quot;infinitesimal jackknife for bagging&quot; and 
will slow down the predictions significantly.</p>
</td></tr>
<tr><td><code id="rmw_do_all_+3A_aggregate">aggregate</code></td>
<td>
<p>Should all the <code>n_samples</code> predictions be aggregated?</p>
</td></tr>
<tr><td><code id="rmw_do_all_+3A_n_cores">n_cores</code></td>
<td>
<p>Number of CPU cores to use for the model calculation. Default
is system's total minus one.</p>
</td></tr>
<tr><td><code id="rmw_do_all_+3A_verbose">verbose</code></td>
<td>
<p>Should the function give messages?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Named list.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rmw_prepare_data">rmw_prepare_data</a></code>,  <code><a href="#topic+rmw_train_model">rmw_train_model</a></code>, 
<code><a href="#topic+rmw_normalise">rmw_normalise</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


# Load package
library(dplyr)

# Keep things reproducible
set.seed(123)

# Prepare example data
data_london_prepared &lt;- data_london %&gt;% 
  filter(variable == "no2") %&gt;% 
  rmw_prepare_data()

# Use the example data to conduct the steps needed for meteorological
# normalisation
list_normalised &lt;- rmw_do_all(
  df = data_london_prepared,
  variables = c(
    "ws", "wd", "air_temp", "rh", "date_unix", "day_julian", "weekday", "hour"
  ),
  n_trees = 300,
  n_samples = 300
)



</code></pre>

<hr>
<h2 id='rmw_find_breakpoints'>Function to detect breakpoints in a data frame using a linear regression 
based approach.</h2><span id='topic+rmw_find_breakpoints'></span>

<h3>Description</h3>

<p><code>rmw_find_breakpoints</code> will generally be applied to a data frame after
<code><a href="#topic+rmw_normalise">rmw_normalise</a></code>. <code>rmw_find_breakpoints</code> is rather slow.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmw_find_breakpoints(df, h = 0.15, n = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rmw_find_breakpoints_+3A_df">df</code></td>
<td>
<p>Tibble from <code><a href="#topic+rmw_normalise">rmw_normalise</a></code> to detect breakpoints 
in.</p>
</td></tr>
<tr><td><code id="rmw_find_breakpoints_+3A_h">h</code></td>
<td>
<p>Minimal segment size either given as fraction relative to the sample 
size or as an integer giving the minimal number of observations in each 
segment.</p>
</td></tr>
<tr><td><code id="rmw_find_breakpoints_+3A_n">n</code></td>
<td>
<p>Number of breaks to detect. Default is maximum number allowed by
<code>h</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Tibble with a <code>date</code> variable indicating where the breakpoints 
are.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Test for breakpoints in an example normalised time series
data_breakpoints &lt;- rmw_find_breakpoints(data_london_normalised)

</code></pre>

<hr>
<h2 id='rmw_model_nested_sets'>Function to train random forest models using a nested tibble.</h2><span id='topic+rmw_model_nested_sets'></span>

<h3>Description</h3>

<p>Function to train random forest models using a nested tibble.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmw_model_nested_sets(
  df_nest,
  variables,
  n_trees = 10,
  mtry = NULL,
  min_node_size = 5,
  n_cores = NA,
  verbose = FALSE,
  progress = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rmw_model_nested_sets_+3A_df_nest">df_nest</code></td>
<td>
<p>Nested tibble created by <code><a href="#topic+rmw_nest_for_modelling">rmw_nest_for_modelling</a></code>.</p>
</td></tr>
<tr><td><code id="rmw_model_nested_sets_+3A_variables">variables</code></td>
<td>
<p>Independent/explanatory variables used to predict <code>"value"</code>.</p>
</td></tr>
<tr><td><code id="rmw_model_nested_sets_+3A_n_trees">n_trees</code></td>
<td>
<p>Number of trees to grow to make up the forest.</p>
</td></tr>
<tr><td><code id="rmw_model_nested_sets_+3A_mtry">mtry</code></td>
<td>
<p>Number of variables to possibly split at in each node. Default is
the (rounded down) square root of the number variables.</p>
</td></tr>
<tr><td><code id="rmw_model_nested_sets_+3A_min_node_size">min_node_size</code></td>
<td>
<p>Minimal node size.</p>
</td></tr>
<tr><td><code id="rmw_model_nested_sets_+3A_n_cores">n_cores</code></td>
<td>
<p>Number of CPU cores to use for the model calculations.</p>
</td></tr>
<tr><td><code id="rmw_model_nested_sets_+3A_verbose">verbose</code></td>
<td>
<p>Should the function give messages?</p>
</td></tr>
<tr><td><code id="rmw_model_nested_sets_+3A_progress">progress</code></td>
<td>
<p>Should a progress bar be displayed?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nested tibble.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rmw_nest_for_modelling">rmw_nest_for_modelling</a></code>, 
<code><a href="#topic+rmw_predict_nested_sets">rmw_predict_nested_sets</a></code>, <code><a href="#topic+rmw_train_model">rmw_train_model</a></code>
</p>

<hr>
<h2 id='rmw_model_statistics'>Functions to extract model statistics from a model calculated with
<code>rmw_calculate_model</code>.</h2><span id='topic+rmw_model_statistics'></span><span id='topic+rmw_model_importance'></span>

<h3>Description</h3>

<p>Functions to extract model statistics from a model calculated with
<code>rmw_calculate_model</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmw_model_statistics(model)

rmw_model_importance(model, date_unix = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rmw_model_statistics_+3A_model">model</code></td>
<td>
<p>A ranger model object from <code>rmw_calculate_model</code>.</p>
</td></tr>
<tr><td><code id="rmw_model_statistics_+3A_date_unix">date_unix</code></td>
<td>
<p>Should the <code>date_unix</code> variable be included in the 
return?</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The variable importances are defined as &quot;the permutation importance 
differences of predictions errors&quot;. This measure is unit-less and the values 
are not useful when comparing among data sets.
</p>


<h3>Value</h3>

<p>Tibble.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Extract statistics from the example random forest model
rmw_model_statistics(model_london)

# Extract importances from a model object
rmw_model_importance(model_london)

</code></pre>

<hr>
<h2 id='rmw_nest_for_modelling'>Function to nest observational data before modelling with <strong>rmweather</strong>.</h2><span id='topic+rmw_nest_for_modelling'></span>

<h3>Description</h3>

<p><code>rmw_nest_for_modelling</code> will resample the observations if desired, will
test and prepare the data (with <code><a href="#topic+rmw_prepare_data">rmw_prepare_data</a></code>), and return
a nested tibble ready for modelling.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmw_nest_for_modelling(
  df,
  by = "resampled_set",
  n = 1,
  na.rm = FALSE,
  fraction = 0.8
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rmw_nest_for_modelling_+3A_df">df</code></td>
<td>
<p>Input data frame. Generally a time series of air quality data with 
pollutant concentrations and meteorological variables.</p>
</td></tr>
<tr><td><code id="rmw_nest_for_modelling_+3A_by">by</code></td>
<td>
<p>Variables within <code>df</code> which will be used for nesting. 
Generally, <code>by</code> will be <code>"site"</code> and <code>"variable"</code>. 
<code>"resampled_set"</code> will always be added for clarity.</p>
</td></tr>
<tr><td><code id="rmw_nest_for_modelling_+3A_n">n</code></td>
<td>
<p>Number of resampling sets to create.</p>
</td></tr>
<tr><td><code id="rmw_nest_for_modelling_+3A_na.rm">na.rm</code></td>
<td>
<p>Should missing values (NA) be removed from value?</p>
</td></tr>
<tr><td><code id="rmw_nest_for_modelling_+3A_fraction">fraction</code></td>
<td>
<p>Fraction of the observations to make up the training set.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nested tibble.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rmw_prepare_data">rmw_prepare_data</a></code>, <code><a href="#topic+rmw_model_nested_sets">rmw_model_nested_sets</a></code>, 
<code><a href="#topic+rmw_predict_nested_sets">rmw_predict_nested_sets</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load package
library(dplyr)

# Keep things reproducible
set.seed(123)

# Prepare example data for modelling, replicate observations twice too
data_london %&gt;% 
  rmw_nest_for_modelling(by = c("site", "variable"), n = 2)
 
</code></pre>

<hr>
<h2 id='rmw_normalise'>Function to normalise a variable for &quot;average&quot; meteorological conditions.</h2><span id='topic+rmw_normalise'></span>

<h3>Description</h3>

<p>Function to normalise a variable for &quot;average&quot; meteorological conditions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmw_normalise(
  model,
  df,
  variables = NA,
  n_samples = 300,
  replace = TRUE,
  se = FALSE,
  aggregate = TRUE,
  keep_samples = FALSE,
  n_cores = NA,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rmw_normalise_+3A_model">model</code></td>
<td>
<p>A ranger model object from <code><a href="#topic+rmw_train_model">rmw_train_model</a></code>.</p>
</td></tr>
<tr><td><code id="rmw_normalise_+3A_df">df</code></td>
<td>
<p>Input data used to calculate <code>model</code> using 
<code><a href="#topic+rmw_prepare_data">rmw_prepare_data</a></code>.</p>
</td></tr>
<tr><td><code id="rmw_normalise_+3A_variables">variables</code></td>
<td>
<p>Variables to randomly sample. Default is all variables used
for training the model with the exception of <code>date_unix</code>, the trend term.</p>
</td></tr>
<tr><td><code id="rmw_normalise_+3A_n_samples">n_samples</code></td>
<td>
<p>Number of times to sample <code>df</code> and then predict?</p>
</td></tr>
<tr><td><code id="rmw_normalise_+3A_replace">replace</code></td>
<td>
<p>Should <code>variables</code> be sampled with replacement?</p>
</td></tr>
<tr><td><code id="rmw_normalise_+3A_se">se</code></td>
<td>
<p>Should the standard error of the predictions be calculated too? 
The standard error method is the &quot;infinitesimal jackknife for bagging&quot; and 
will slow down the predictions significantly.</p>
</td></tr>
<tr><td><code id="rmw_normalise_+3A_aggregate">aggregate</code></td>
<td>
<p>Should all the <code>n_samples</code> predictions be aggregated?</p>
</td></tr>
<tr><td><code id="rmw_normalise_+3A_keep_samples">keep_samples</code></td>
<td>
<p>When <code>aggregate</code> is <code>FALSE</code>, should the 
sampled/shuffled observations be kept?</p>
</td></tr>
<tr><td><code id="rmw_normalise_+3A_n_cores">n_cores</code></td>
<td>
<p>Number of CPU cores to use for the model predictions. Default
is system's total minus one.</p>
</td></tr>
<tr><td><code id="rmw_normalise_+3A_verbose">verbose</code></td>
<td>
<p>Should the function give messages and display a progress bar?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Tibble.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rmw_prepare_data">rmw_prepare_data</a></code>, <code><a href="#topic+rmw_train_model">rmw_train_model</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


# Load package
library(dplyr)

# Keep things reproducible
set.seed(123)

# Prepare example data
data_london_prepared &lt;- data_london %&gt;% 
  filter(variable == "no2") %&gt;% 
  rmw_prepare_data()

# Normalise the example no2 data
data_normalised &lt;- rmw_normalise(
  model_london, 
  df = data_london_prepared, 
  n_samples = 300,
  verbose = TRUE
)



</code></pre>

<hr>
<h2 id='rmw_normalise_nested_sets'>Function to normalise a variable for &quot;average&quot; meteorological conditions in
a nested tibble.</h2><span id='topic+rmw_normalise_nested_sets'></span>

<h3>Description</h3>

<p>Function to normalise a variable for &quot;average&quot; meteorological conditions in
a nested tibble.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmw_normalise_nested_sets(
  df_nest,
  variables = NA,
  n_samples = 10,
  replace = TRUE,
  se = FALSE,
  aggregate = TRUE,
  keep_samples = FALSE,
  n_cores = NA,
  verbose = FALSE,
  progress = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rmw_normalise_nested_sets_+3A_df_nest">df_nest</code></td>
<td>
<p>Nested tibble created by <code><a href="#topic+rmw_model_nested_sets">rmw_model_nested_sets</a></code>.</p>
</td></tr>
<tr><td><code id="rmw_normalise_nested_sets_+3A_variables">variables</code></td>
<td>
<p>Variables to randomly sample. Default is all variables used
for training the model with the exception of <code>date_unix</code>, the trend term.</p>
</td></tr>
<tr><td><code id="rmw_normalise_nested_sets_+3A_n_samples">n_samples</code></td>
<td>
<p>Number of times to sample <code>df</code> and then predict?</p>
</td></tr>
<tr><td><code id="rmw_normalise_nested_sets_+3A_replace">replace</code></td>
<td>
<p>Should <code>variables</code> be sampled with replacement?</p>
</td></tr>
<tr><td><code id="rmw_normalise_nested_sets_+3A_se">se</code></td>
<td>
<p>Should the standard error of the predictions be calculated too? 
The standard error method is the &quot;infinitesimal jackknife for bagging&quot; and 
will slow down the predictions significantly.</p>
</td></tr>
<tr><td><code id="rmw_normalise_nested_sets_+3A_aggregate">aggregate</code></td>
<td>
<p>Should all the <code>n_samples</code> predictions be aggregated?</p>
</td></tr>
<tr><td><code id="rmw_normalise_nested_sets_+3A_keep_samples">keep_samples</code></td>
<td>
<p>When <code>aggregate</code> is <code>FALSE</code>, should the 
sampled/shuffled observations be kept?</p>
</td></tr>
<tr><td><code id="rmw_normalise_nested_sets_+3A_n_cores">n_cores</code></td>
<td>
<p>Number of CPU cores to use for the model predictions. Default
is system's total minus one.</p>
</td></tr>
<tr><td><code id="rmw_normalise_nested_sets_+3A_verbose">verbose</code></td>
<td>
<p>Should the function give messages?</p>
</td></tr>
<tr><td><code id="rmw_normalise_nested_sets_+3A_progress">progress</code></td>
<td>
<p>Should a progress bar be displayed?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nested tibble.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rmw_nest_for_modelling">rmw_nest_for_modelling</a></code>, 
<code><a href="#topic+rmw_model_nested_sets">rmw_model_nested_sets</a></code>, <code><a href="#topic+rmw_model_nested_sets">rmw_model_nested_sets</a></code>, 
<code><a href="#topic+rmw_normalise">rmw_normalise</a></code>.
</p>

<hr>
<h2 id='rmw_partial_dependencies'>Function to calculate partial dependencies after training with 
<strong>rmweather</strong>.</h2><span id='topic+rmw_partial_dependencies'></span>

<h3>Description</h3>

<p><code>rmw_plot_partial_dependencies</code> is rather slow.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmw_partial_dependencies(
  model,
  df,
  variable,
  training_only = TRUE,
  resolution = NULL,
  n_cores = NA,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rmw_partial_dependencies_+3A_model">model</code></td>
<td>
<p>A ranger model object from <code><a href="#topic+rmw_train_model">rmw_train_model</a></code>.</p>
</td></tr>
<tr><td><code id="rmw_partial_dependencies_+3A_df">df</code></td>
<td>
<p>Input data frame after preparation with 
<code><a href="#topic+rmw_prepare_data">rmw_prepare_data</a></code>.</p>
</td></tr>
<tr><td><code id="rmw_partial_dependencies_+3A_variable">variable</code></td>
<td>
<p>Vector of variables to calculate partial dependencies for.</p>
</td></tr>
<tr><td><code id="rmw_partial_dependencies_+3A_training_only">training_only</code></td>
<td>
<p>Should only the training set be used for prediction? The
default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="rmw_partial_dependencies_+3A_resolution">resolution</code></td>
<td>
<p>The number of points that should be predicted for each 
independent variable. If left as <code>NULL</code>, a default sequence will be 
generated. See <code><a href="pdp.html#topic+partial">partial</a></code> for details.</p>
</td></tr>
<tr><td><code id="rmw_partial_dependencies_+3A_n_cores">n_cores</code></td>
<td>
<p>Number of CPU cores to use for the model calculation. The 
default is system's total minus one.</p>
</td></tr>
<tr><td><code id="rmw_partial_dependencies_+3A_verbose">verbose</code></td>
<td>
<p>Should the function give messages?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Tibble.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


# Load packages
library(dplyr)
# Ranger package needs to be loaded
library(ranger)

# Prepare example data
data_london_prepared &lt;- data_london %&gt;% 
  filter(variable == "no2") %&gt;% 
  rmw_prepare_data()

# Calculate partial dependencies for wind speed
data_partial &lt;- rmw_partial_dependencies(
  model = model_london, 
  df = data_london_prepared, 
  variable = "ws", 
  verbose = TRUE
)

# Calculate partial dependencies for all independent variables used in model
data_partial &lt;- rmw_partial_dependencies(
  model = model_london, 
  df = data_london_prepared, 
  variable = NA, 
  verbose = TRUE
)



</code></pre>

<hr>
<h2 id='rmw_plot_importance'>Function to plot random forest variable importances after training by 
<code><a href="#topic+rmw_train_model">rmw_train_model</a></code>.</h2><span id='topic+rmw_plot_importance'></span>

<h3>Description</h3>

<p>Function to plot random forest variable importances after training by 
<code><a href="#topic+rmw_train_model">rmw_train_model</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmw_plot_importance(df, colour = "black")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rmw_plot_importance_+3A_df">df</code></td>
<td>
<p>Data frame created by <code><a href="#topic+rmw_model_importance">rmw_model_importance</a></code>.</p>
</td></tr>
<tr><td><code id="rmw_plot_importance_+3A_colour">colour</code></td>
<td>
<p>Colour of point and segment geometries.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ggplot2 plot with point and segment geometries.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rmw_train_model">rmw_train_model</a></code>, <code><a href="#topic+rmw_model_importance">rmw_model_importance</a></code>
</p>

<hr>
<h2 id='rmw_plot_normalised'>Function to plot the meteorologically normalised time series after
<code><a href="#topic+rmw_normalise">rmw_normalise</a></code>.</h2><span id='topic+rmw_plot_normalised'></span>

<h3>Description</h3>

<p>If the input data contains a standard error variable named <code>"se"</code>, 
this will be plotted as a ribbon (+ and -) around the mean.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmw_plot_normalised(df, colour = "#6B186EFF")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rmw_plot_normalised_+3A_df">df</code></td>
<td>
<p>Tibble created by <code><a href="#topic+rmw_normalise">rmw_normalise</a></code>.</p>
</td></tr>
<tr><td><code id="rmw_plot_normalised_+3A_colour">colour</code></td>
<td>
<p>Colour for line geometry.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ggplot2 plot with a line and ribbon geometries.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Plot normalised example data
rmw_plot_normalised(data_london_normalised)

</code></pre>

<hr>
<h2 id='rmw_plot_partial_dependencies'>Function to plot partial dependencies after calculation by 
<code><a href="#topic+rmw_partial_dependencies">rmw_partial_dependencies</a></code>.</h2><span id='topic+rmw_plot_partial_dependencies'></span>

<h3>Description</h3>

<p>Function to plot partial dependencies after calculation by 
<code><a href="#topic+rmw_partial_dependencies">rmw_partial_dependencies</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmw_plot_partial_dependencies(df)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rmw_plot_partial_dependencies_+3A_df">df</code></td>
<td>
<p>Tibble created by <code><a href="#topic+rmw_partial_dependencies">rmw_partial_dependencies</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ggplot2 plot with a point geometry.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>

<hr>
<h2 id='rmw_plot_test_prediction'>Function to plot the test set and predicted set after
<code><a href="#topic+rmw_predict_the_test_set">rmw_predict_the_test_set</a></code>.</h2><span id='topic+rmw_plot_test_prediction'></span>

<h3>Description</h3>

<p>Function to plot the test set and predicted set after
<code><a href="#topic+rmw_predict_the_test_set">rmw_predict_the_test_set</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmw_plot_test_prediction(df, bins = 30, coord_equal = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rmw_plot_test_prediction_+3A_df">df</code></td>
<td>
<p>Tibble created by <code><a href="#topic+rmw_predict_the_test_set">rmw_predict_the_test_set</a></code>.</p>
</td></tr>
<tr><td><code id="rmw_plot_test_prediction_+3A_bins">bins</code></td>
<td>
<p>Numeric vector giving number of bins in both vertical and 
horizontal directions.</p>
</td></tr>
<tr><td><code id="rmw_plot_test_prediction_+3A_coord_equal">coord_equal</code></td>
<td>
<p>Should axes be forced to be equal?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>ggplot2 plot with a hex geometry.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>

<hr>
<h2 id='rmw_predict'>Function to predict using a <strong>ranger</strong> random forest.</h2><span id='topic+rmw_predict'></span>

<h3>Description</h3>

<p>Function to predict using a <strong>ranger</strong> random forest.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmw_predict(model, df = NA, se = FALSE, n_cores = NULL, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rmw_predict_+3A_model">model</code></td>
<td>
<p>A <strong>ranger</strong> model object from <code>rmw_train_model</code>.</p>
</td></tr>
<tr><td><code id="rmw_predict_+3A_df">df</code></td>
<td>
<p>Input data to be used for predictions.</p>
</td></tr>
<tr><td><code id="rmw_predict_+3A_se">se</code></td>
<td>
<p>If <code>df</code> is supplied, should the standard error of the 
prediction be calculated too? The standard error method is the &quot;infinitesimal
jackknife for bagging&quot; and will slow down the predictions significantly.</p>
</td></tr>
<tr><td><code id="rmw_predict_+3A_n_cores">n_cores</code></td>
<td>
<p>Number of CPU cores to use for the model predictions.</p>
</td></tr>
<tr><td><code id="rmw_predict_+3A_verbose">verbose</code></td>
<td>
<p>Should the function give messages?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Numeric vector or a named list containing two numeric vectors.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load package
library(dplyr)

# Prepare example data
data_london_prepared &lt;- data_london %&gt;% 
  filter(variable == "no2") %&gt;% 
  rmw_prepare_data()

# Make a prediction with the examples
vector_prediction &lt;- rmw_predict(
  model_london, 
  df = data_london_prepared
)


# Make a prediction with standard errors too
list_prediction &lt;- rmw_predict(
  model_london, 
  df = data_london_prepared,
  se = TRUE
)
 
</code></pre>

<hr>
<h2 id='rmw_predict_nested_partial_dependencies'>Function to calculate partial dependencies from a random forest models using 
a nested tibble.</h2><span id='topic+rmw_predict_nested_partial_dependencies'></span>

<h3>Description</h3>

<p>Function to calculate partial dependencies from a random forest models using 
a nested tibble.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmw_predict_nested_partial_dependencies(
  df_nest,
  variables = NA,
  n_cores = NA,
  training_only = TRUE,
  rename = FALSE,
  verbose = FALSE,
  progress = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rmw_predict_nested_partial_dependencies_+3A_df_nest">df_nest</code></td>
<td>
<p>Nested tibble created by <code><a href="#topic+rmw_model_nested_sets">rmw_model_nested_sets</a></code>.</p>
</td></tr>
<tr><td><code id="rmw_predict_nested_partial_dependencies_+3A_variables">variables</code></td>
<td>
<p>Vector of variables to calculate partial dependencies for.</p>
</td></tr>
<tr><td><code id="rmw_predict_nested_partial_dependencies_+3A_n_cores">n_cores</code></td>
<td>
<p>Number of CPU cores to use for the model calculations.</p>
</td></tr>
<tr><td><code id="rmw_predict_nested_partial_dependencies_+3A_training_only">training_only</code></td>
<td>
<p>Should only the training set be used for prediction?</p>
</td></tr>
<tr><td><code id="rmw_predict_nested_partial_dependencies_+3A_rename">rename</code></td>
<td>
<p>Within the <code>partial_dependencies</code> nested tibble, should 
the generic <code>"variable"</code> name be renamed to <code>"variable_model"</code>. 
This is useful when <code>"variable"</code> has been used as a pollutant identifier.</p>
</td></tr>
<tr><td><code id="rmw_predict_nested_partial_dependencies_+3A_verbose">verbose</code></td>
<td>
<p>Should the function give messages?</p>
</td></tr>
<tr><td><code id="rmw_predict_nested_partial_dependencies_+3A_progress">progress</code></td>
<td>
<p>Should a progress bar be displayed?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nested tibble.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rmw_nest_for_modelling">rmw_nest_for_modelling</a></code>, 
<code><a href="#topic+rmw_model_nested_sets">rmw_model_nested_sets</a></code>, <code><a href="#topic+rmw_partial_dependencies">rmw_partial_dependencies</a></code>
</p>

<hr>
<h2 id='rmw_predict_nested_sets'>Function to make predictions from a random forest models using a nested 
tibble.</h2><span id='topic+rmw_predict_nested_sets'></span>

<h3>Description</h3>

<p>Function to make predictions from a random forest models using a nested 
tibble.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmw_predict_nested_sets(
  df_nest,
  se = FALSE,
  n_cores = NULL,
  keep_vectors = FALSE,
  model_errors = FALSE,
  as_long = TRUE,
  partial = FALSE,
  verbose = FALSE,
  progress = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rmw_predict_nested_sets_+3A_df_nest">df_nest</code></td>
<td>
<p>Nested tibble created by <code><a href="#topic+rmw_model_nested_sets">rmw_model_nested_sets</a></code>.</p>
</td></tr>
<tr><td><code id="rmw_predict_nested_sets_+3A_se">se</code></td>
<td>
<p>Should the standard error of the predictions be calculated?</p>
</td></tr>
<tr><td><code id="rmw_predict_nested_sets_+3A_n_cores">n_cores</code></td>
<td>
<p>Number of CPU cores to use for the model calculations.</p>
</td></tr>
<tr><td><code id="rmw_predict_nested_sets_+3A_keep_vectors">keep_vectors</code></td>
<td>
<p>Should the prediction vectors be kept in the return? This
is usually not needed because these vectors have been added to the 
<code>observations</code> variable.</p>
</td></tr>
<tr><td><code id="rmw_predict_nested_sets_+3A_model_errors">model_errors</code></td>
<td>
<p>Should model error statistics between the observed and 
predicted values be calculated and returned?</p>
</td></tr>
<tr><td><code id="rmw_predict_nested_sets_+3A_as_long">as_long</code></td>
<td>
<p>For when <code>model_errors</code> is <code>TRUE</code>, should the model 
error unit be returned in &quot;long format&quot;?</p>
</td></tr>
<tr><td><code id="rmw_predict_nested_sets_+3A_partial">partial</code></td>
<td>
<p>Should the model's partial dependencies also be calculated? 
This will increase the execution time of the function.</p>
</td></tr>
<tr><td><code id="rmw_predict_nested_sets_+3A_verbose">verbose</code></td>
<td>
<p>Should the function give messages?</p>
</td></tr>
<tr><td><code id="rmw_predict_nested_sets_+3A_progress">progress</code></td>
<td>
<p>Should a progress bar be displayed?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nested tibble.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rmw_nest_for_modelling">rmw_nest_for_modelling</a></code>, 
<code><a href="#topic+rmw_model_nested_sets">rmw_model_nested_sets</a></code>, <code><a href="#topic+rmw_predict">rmw_predict</a></code>, 
<code><a href="#topic+rmw_calculate_model_errors">rmw_calculate_model_errors</a></code>, 
<code><a href="#topic+rmw_partial_dependencies">rmw_partial_dependencies</a></code>
</p>

<hr>
<h2 id='rmw_predict_nested_sets_by_year'>Function to make predictions by meteorological year from a random forest 
models using a nested tibble.</h2><span id='topic+rmw_predict_nested_sets_by_year'></span>

<h3>Description</h3>

<p>Function to make predictions by meteorological year from a random forest 
models using a nested tibble.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmw_predict_nested_sets_by_year(
  df_nest,
  variables = NA,
  n_samples = 10,
  aggregate = TRUE,
  n_cores = NULL,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rmw_predict_nested_sets_by_year_+3A_df_nest">df_nest</code></td>
<td>
<p>Nested tibble created by <code><a href="#topic+rmw_model_nested_sets">rmw_model_nested_sets</a></code>.</p>
</td></tr>
<tr><td><code id="rmw_predict_nested_sets_by_year_+3A_variables">variables</code></td>
<td>
<p>Variables to randomly sample. Default is all variables used
for training the model with the exception of <code>date_unix</code>, the trend term.</p>
</td></tr>
<tr><td><code id="rmw_predict_nested_sets_by_year_+3A_n_samples">n_samples</code></td>
<td>
<p>Number of times to sample the observations from each 
meteorological year and then predict.</p>
</td></tr>
<tr><td><code id="rmw_predict_nested_sets_by_year_+3A_aggregate">aggregate</code></td>
<td>
<p>Should all the <code>n_samples</code> predictions be aggregated?</p>
</td></tr>
<tr><td><code id="rmw_predict_nested_sets_by_year_+3A_n_cores">n_cores</code></td>
<td>
<p>Number of CPU cores to use for the model calculations.</p>
</td></tr>
<tr><td><code id="rmw_predict_nested_sets_by_year_+3A_verbose">verbose</code></td>
<td>
<p>Should the function give messages?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nested tibble.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rmw_nest_for_modelling">rmw_nest_for_modelling</a></code>, 
<code><a href="#topic+rmw_model_nested_sets">rmw_model_nested_sets</a></code>
</p>

<hr>
<h2 id='rmw_predict_the_test_set'>Functions to use a model to predict the observations within a test set after
<code>rmw_calculate_model</code>.</h2><span id='topic+rmw_predict_the_test_set'></span>

<h3>Description</h3>

<p><code>rmw_predict_the_test_set</code> uses data withheld from the training of the 
model and therefore can be used for investigating overfitting.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmw_predict_the_test_set(model, df)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rmw_predict_the_test_set_+3A_model">model</code></td>
<td>
<p>A ranger model object from <code>rmw_calculate_model</code>.</p>
</td></tr>
<tr><td><code id="rmw_predict_the_test_set_+3A_df">df</code></td>
<td>
<p>Input data used to calculate <code>model</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Tibble.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load package
library(dplyr)

# Prepare example data
data_london_prepared &lt;- data_london %&gt;% 
  filter(variable == "no2") %&gt;% 
  rmw_prepare_data()

# Use the test set for prediction
rmw_predict_the_test_set(
  model_london, 
  df = data_london_prepared
)

# Predict, then produce a hex plot of the predictions
rmw_predict_the_test_set(
  model_london, 
  df = data_london_prepared
) %&gt;% 
  rmw_plot_test_prediction()

</code></pre>

<hr>
<h2 id='rmw_prepare_data'>Function to prepare a data frame for modelling with <strong>rmweather</strong>.</h2><span id='topic+rmw_prepare_data'></span>

<h3>Description</h3>

<p><code>rmw_prepare_data</code> will test and prepare a data frame for further use 
with <strong>rmweather</strong>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmw_prepare_data(
  df,
  value = "value",
  na.rm = FALSE,
  replace = FALSE,
  fraction = 0.8
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rmw_prepare_data_+3A_df">df</code></td>
<td>
<p>Input data frame. Generally a time series of air quality data with
pollutant concentrations and meteorological variables.</p>
</td></tr>
<tr><td><code id="rmw_prepare_data_+3A_value">value</code></td>
<td>
<p>Name of the dependent variable. Usually a pollutant, for example,
<code>"no2"</code> or <code>"pm10"</code>.</p>
</td></tr>
<tr><td><code id="rmw_prepare_data_+3A_na.rm">na.rm</code></td>
<td>
<p>Should missing values (<code>NA</code>) be removed from <code>value</code>?</p>
</td></tr>
<tr><td><code id="rmw_prepare_data_+3A_replace">replace</code></td>
<td>
<p>When adding the date variables to the set, should they replace
the versions already contained in the data frame if they exist?</p>
</td></tr>
<tr><td><code id="rmw_prepare_data_+3A_fraction">fraction</code></td>
<td>
<p>Fraction of the observations to make up the training set. 
Default is 0.8, 80 %.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>rmw_prepare_data</code> will check if a <code>date</code> variable is present and 
is of the correct data type, impute missing numeric and categorical values, 
randomly split the input into training and testing sets, and rename the 
dependent variable to <code>"value"</code>. The <code>date</code> variable will also be 
used to calculate new variables such as <code>date_unix</code>, <code>day_julian</code>, 
<code>weekday</code>, and <code>hour</code> which can be used as independent variables. 
These attributes are needed for other <strong>rmweather</strong> functions to operate. 
</p>
<p>Use <code>set.seed</code> in an R session to keep results reproducible.
</p>


<h3>Value</h3>

<p>Tibble, the input data transformed ready for modelling with 
<strong>rmweather</strong>.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>


<h3>See Also</h3>

<p><code><a href="base.html#topic+set.seed">set.seed</a></code>, <code><a href="#topic+rmw_train_model">rmw_train_model</a></code>, 
<code><a href="#topic+rmw_normalise">rmw_normalise</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load package
library(dplyr)

# Keep things reproducible
set.seed(123)

# Prepare example data for modelling, only use no2 data here
data_london_prepared &lt;- data_london %&gt;% 
  filter(variable == "no2") %&gt;% 
  rmw_prepare_data()

</code></pre>

<hr>
<h2 id='rmw_train_model'>Function to train a random forest model to predict (usually) pollutant
concentrations using meteorological and time variables.</h2><span id='topic+rmw_train_model'></span>

<h3>Description</h3>

<p>Function to train a random forest model to predict (usually) pollutant
concentrations using meteorological and time variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rmw_train_model(
  df,
  variables,
  n_trees = 300,
  mtry = NULL,
  min_node_size = 5,
  keep_inbag = TRUE,
  n_cores = NA,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rmw_train_model_+3A_df">df</code></td>
<td>
<p>Input tibble after preparation with <code><a href="#topic+rmw_prepare_data">rmw_prepare_data</a></code>.
<code>df</code> has a number of constraints which will be checked for before
modelling.</p>
</td></tr>
<tr><td><code id="rmw_train_model_+3A_variables">variables</code></td>
<td>
<p>Independent/explanatory variables used to predict 
<code>"value"</code>.</p>
</td></tr>
<tr><td><code id="rmw_train_model_+3A_n_trees">n_trees</code></td>
<td>
<p>Number of trees to grow to make up the forest.</p>
</td></tr>
<tr><td><code id="rmw_train_model_+3A_mtry">mtry</code></td>
<td>
<p>Number of variables to possibly split at in each node. Default is 
the (rounded down) square root of the number variables.</p>
</td></tr>
<tr><td><code id="rmw_train_model_+3A_min_node_size">min_node_size</code></td>
<td>
<p>Minimal node size.</p>
</td></tr>
<tr><td><code id="rmw_train_model_+3A_keep_inbag">keep_inbag</code></td>
<td>
<p>Should in-bag data be kept in the <strong>ranger</strong> model 
object? This needs to be <code>TRUE</code> if standard errors are to be calculated
when predicting with the model.</p>
</td></tr>
<tr><td><code id="rmw_train_model_+3A_n_cores">n_cores</code></td>
<td>
<p>Number of CPU cores to use for the model calculation. Default
is system's total minus one.</p>
</td></tr>
<tr><td><code id="rmw_train_model_+3A_verbose">verbose</code></td>
<td>
<p>Should the function give messages?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <strong>ranger</strong> model object, a named list.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>


<h3>See Also</h3>

<p><code><a href="#topic+rmw_prepare_data">rmw_prepare_data</a></code>, <code><a href="#topic+rmw_normalise">rmw_normalise</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>


# Load package
library(dplyr)

# Keep things reproducible
set.seed(123)

# Prepare example data
data_london_prepared &lt;- data_london %&gt;% 
  filter(variable == "no2") %&gt;% 
  rmw_prepare_data()

# Calculate a model using common meteorological and time variables
model &lt;- rmw_train_model(
  data_london_prepared,
  variables = c(
    "ws", "wd", "air_temp", "rh", "date_unix", "day_julian", "weekday", "hour"
  ),
  n_trees = 300
)



</code></pre>

<hr>
<h2 id='system_cpu_core_count'>Function to return the system's number of CPU cores.</h2><span id='topic+system_cpu_core_count'></span>

<h3>Description</h3>

<p>Function to return the system's number of CPU cores.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>system_cpu_core_count(logical_cores = TRUE, max_cores = NA)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="system_cpu_core_count_+3A_logical_cores">logical_cores</code></td>
<td>
<p>Should logical cores be included in the core count?</p>
</td></tr>
<tr><td><code id="system_cpu_core_count_+3A_max_cores">max_cores</code></td>
<td>
<p>Should the return have a maximum value? This can be useful 
when there are very many cores and logic is being built.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>

<hr>
<h2 id='wday_monday'>Function to get weekday number from a date where <code>1</code> is Monday and 
<code>7</code> is Sunday.</h2><span id='topic+wday_monday'></span>

<h3>Description</h3>

<p>Function to get weekday number from a date where <code>1</code> is Monday and 
<code>7</code> is Sunday.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wday_monday(x, as.factor = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="wday_monday_+3A_x">x</code></td>
<td>
<p>Date vector.</p>
</td></tr>
<tr><td><code id="wday_monday_+3A_as.factor">as.factor</code></td>
<td>
<p>Should the return be a factor?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Numeric vector.
</p>


<h3>Author(s)</h3>

<p>Stuart K. Grange
</p>

<hr>
<h2 id='zzz'>Squash the global variable notes when building a package.</h2><span id='topic+zzz'></span>

<h3>Description</h3>

<p>Squash the global variable notes when building a package.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
