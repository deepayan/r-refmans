<!DOCTYPE html><html lang="en"><head><title>Help for package VirtualPop</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {VirtualPop}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#BuildViP'><p>Builds a Virtual Population in a Single Step</p></a></li>
<li><a href='#Children'><p>Generates Individual Fertility Histories</p></a></li>
<li><a href='#dLH'><p>Individual fertility histories based on period data and in the presence of mortality (USA 2021)</p></a></li>
<li><a href='#e0'><p>Mean Ages at Death and Probabilities of Surviving to Selected Ages, by Sex</p></a></li>
<li><a href='#GetData'><p>Reads Data from the HMD and HFD into R</p></a></li>
<li><a href='#GetGenerations'><p>Builds a Multi-Generation Virtual Population from demographic parameters</p></a></li>
<li><a href='#GetRates'><p>Retrieves Period Mortality and Fertility Rates from HMD and HFD for a Selected Country and Selected Year</p></a></li>
<li><a href='#GetRatesC'><p>Retrieves Cohort Data from the HMD and HFD and Obtains Cohort Rates</p></a></li>
<li><a href='#H_pw'><p>Computes Cumulative Hazard at Duration t under a Piecewise Exponential Model</p></a></li>
<li><a href='#Lifespan'><p>Generates Individual Lifespan(s)</p></a></li>
<li><a href='#PartnerSearch'><p>Simple Partner Search Simulation</p></a></li>
<li><a href='#pw_root'><p>The Function for which the Root is Sought.</p></a></li>
<li><a href='#r.pw_exp'><p>Draws Waiting Times from a Piecewise-Exponential Distribution.</p></a></li>
<li><a href='#rates'><p>Period rates</p></a></li>
<li><a href='#ratesC'><p>Cohort rates</p></a></li>
<li><a href='#Sim_bio'><p>Generic Function to Generate Single Life History</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Simulation of Populations by Sampling Waiting-Time Distributions</td>
</tr>
<tr>
<td>Version:</td>
<td>2.0.2</td>
</tr>
<tr>
<td>Imports:</td>
<td>msm,HMDHFDplus</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, kableExtra, ggplot2, foreign, lubridate, xml2, eha,
survival, survminer, rmarkdown</td>
</tr>
<tr>
<td>BuildResaveData:</td>
<td>best</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-03-18</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Frans Willekens &lt;willekens@nidi.nl&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Constructs a virtual population from fertility and mortality rates for any country,
	calendar year and birth cohort in the Human Mortality Database <a href="https://www.mortality.org">https://www.mortality.org</a> and the Human Fertility Database <a href="https://www.humanfertility.org">https://www.humanfertility.org</a>.  Fertility histories are simulated for every individual and their offspring, producing a multi-generation virtual population. </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.3.0),</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/willekens/VirtualPop/issues">https://github.com/willekens/VirtualPop/issues</a></td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-03-18 10:04:52 UTC; frans</td>
</tr>
<tr>
<td>Author:</td>
<td>Frans Willekens <a href="https://orcid.org/0000-0001-6125-0212"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Tim Riffe <a href="https://orcid.org/0000-0002-2673-4622"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [ctb]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-03-18 10:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='BuildViP'>Builds a Virtual Population in a Single Step</h2><span id='topic+BuildViP'></span>

<h3>Description</h3>

<p>Builds a virtual population from mortality and fertility rates retrieved from the Human Mortality Database (HMD) and the Human Fertility Database (HFD) in a single step.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>BuildViP(
  user = NULL,
  pw_HMD = NULL,
  pw_HFD = NULL,
  countrycode,
  cohort = NULL,
  refyear = NULL,
  ncohort,
  ngen,
  mort = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="BuildViP_+3A_user">user</code></td>
<td>
<p>User name (e-mail address)</p>
</td></tr>
<tr><td><code id="BuildViP_+3A_pw_hmd">pw_HMD</code></td>
<td>
<p>Password Human Mortality Database</p>
</td></tr>
<tr><td><code id="BuildViP_+3A_pw_hfd">pw_HFD</code></td>
<td>
<p>Password Human Fertility Database</p>
</td></tr>
<tr><td><code id="BuildViP_+3A_countrycode">countrycode</code></td>
<td>
<p>Code of country selected</p>
</td></tr>
<tr><td><code id="BuildViP_+3A_cohort">cohort</code></td>
<td>
<p>Birth cohort (for virtual population based on cohort data)</p>
</td></tr>
<tr><td><code id="BuildViP_+3A_refyear">refyear</code></td>
<td>
<p>Reference year (for virtual population based on period data)</p>
</td></tr>
<tr><td><code id="BuildViP_+3A_ncohort">ncohort</code></td>
<td>
<p>Size of initial cohort</p>
</td></tr>
<tr><td><code id="BuildViP_+3A_ngen">ngen</code></td>
<td>
<p>Number of generations</p>
</td></tr>
<tr><td><code id="BuildViP_+3A_mort">mort</code></td>
<td>
<p>Presence or absence of mortality (optional). Default: mortality is present (mort=TRUE). If mortality is absent, mort=FALSE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>dLH Dataframe with virtual population (one row per individual) (See description of dLH object).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Registration is required to be able to download data from the HMD and HFD
## HMD: https://www.mortality.org
## HFD: https://www.humanfertility.org
## Not run: 
# Period data
dLH &lt;- BuildViP(user,pw_HMD,pw_HFD,
                    countrycode="USA",
                    refyear=2021,
                    ncohort=1000,
                    ngen=4)
# Cohort data
dLHc &lt;- BuildViP(user,pw_HMD,pw_HFD,
                    countrycode="USA",
                    cohort=1964,
                    ncohort=1000,
                    ngen=4)

## End(Not run)
</code></pre>

<hr>
<h2 id='Children'>Generates Individual Fertility Histories</h2><span id='topic+Children'></span>

<h3>Description</h3>

<p>Builds individual fertility histories from conditional fertility rates. Children() uses the function Sim_bio().
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Children(dat0, rates, mort = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Children_+3A_dat0">dat0</code></td>
<td>
<p>Data frame with data on individual members of the virtual population (dLH format)</p>
</td></tr>
<tr><td><code id="Children_+3A_rates">rates</code></td>
<td>
<p>Mortality and fertility rates. The object 'rates' is produced by the function Getrates().</p>
</td></tr>
<tr><td><code id="Children_+3A_mort">mort</code></td>
<td>
<p>Presence or absence of mortality (optional). Default: mortality is present (mort=TRUE). If mortality is absent, set mort=FALSE.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List object with two components: 
</p>
<table role = "presentation">
<tr><td><code>data</code></td>
<td>
<p>Data frame with updated information on members of the virtual population</p>
</td></tr>
<tr><td><code>dch</code></td>
<td>
<p>Data frame with information on children</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'># The example generates data on children of the first 10 female members of 
# the first generation of the virtual population.
utils::data(dLH,package="VirtualPop")
utils::data(rates,package="VirtualPop")
dat0 &lt;- dLH[dLH$sex=="Female" &amp; dLH$gen==1,][1:10,]
out &lt;- VirtualPop::Children(dat0=dat0,rates=rates)

</code></pre>

<hr>
<h2 id='dLH'>Individual fertility histories based on period data and in the presence of mortality (USA 2021)</h2><span id='topic+dLH'></span>

<h3>Description</h3>

<p>Fertility histories based on period data and in the presence of mortality. 
The histories are simulated from age-specific death rates and conditional fertility rates of USA 2021.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(dLH,package="VirtualPop")
</code></pre>


<h3>Format</h3>

<p>A data frame with data about 7,000 individuals (2000 in initial cohort). </p>

<dl>
<dt>ID</dt><dd><p>Identification number</p>
</dd> 	
<dt>gen</dt><dd><p>Generation</p>
</dd>
<dt>cohort</dt><dd><p>Birth cohort (year of birth)</p>
</dd>
<dt>sex</dt><dd><p>Sex. A factor with levels Males and Females</p>
</dd>
<dt>bdated</dt><dd><p>Date of birth (decimal date)</p>
</dd> 
<dt>ddated</dt><dd><p>Date of death (decimal date)</p>
</dd> 
<dt>x_D</dt><dd><p>Age at death (decimal number)</p>
</dd> 	
<dt>IDmother</dt><dd><p>ID of mother</p>
</dd> 	
<dt>IDfather</dt><dd><p>ID of father</p>
</dd>
<dt>jch</dt><dd><p>Child's line number in the nuclear family (household)</p>
</dd>
<dt>IDpartner</dt><dd><p>ID of partner</p>
</dd>
<dt>udated</dt><dd><p>Date of union formation</p>
</dd>
<dt>nch</dt><dd><p>Number of children ever born to the individual</p>
</dd></dl>
	
<p>The object has four attributes:
</p>

<ul>
<li><p> Country
</p>
</li>
<li><p> type: Type of data used to produce the histories (period data or cohort data)
</p>
</li>
<li><p> refyear: Calendar year for which period data are used. If cohort data are used, refyear is missing (NA)
</p>
</li>
<li><p> cohort: Year of birth of cohort for which the data are used. If period data are used, cohort is missing (NA)
</p>
</li></ul>



<h3>Source</h3>

<p>The virtual population is produced from period mortality rates by age and period
fertility rates by age and parity from the United States 2021. The data are from the Human
Mortality Database (HMD) and the Human Fertility Database (HFD).
</p>

<hr>
<h2 id='e0'>Mean Ages at Death and Probabilities of Surviving to Selected Ages, by Sex</h2><span id='topic+e0'></span>

<h3>Description</h3>

<p>Computes (a) Life expectancy at birth, (b) Probability of surviving at age
65, and (c) Probability of surviving at age 85
</p>


<h3>Usage</h3>

<pre><code class='language-R'>e0(d)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="e0_+3A_d">d</code></td>
<td>
<p>The name of the database. If missing, dLH is used if it exists.</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>e0</code></td>
<td>
<p>Mean ages at death</p>
</td></tr> <tr><td><code>Prob65</code></td>
<td>
<p>Probability of surviving
at age 65</p>
</td></tr> <tr><td><code>Prob85</code></td>
<td>
<p>Probability of surviving at age 85</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>

utils::data(dLH,package="VirtualPop")
e0(d=dLH)


</code></pre>

<hr>
<h2 id='GetData'>Reads Data from the HMD and HFD into R</h2><span id='topic+GetData'></span>

<h3>Description</h3>

<p>Reads data from the HMD and HFD into R. The function uses the readHMDweb() and the readHFDweb() functions of the HMDHFDplus package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GetData(country, user, pw_HMD, pw_HFD)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="GetData_+3A_country">country</code></td>
<td>
<p>Code of the selected country. The code must be one of the country codes of HMD and HFD.</p>
</td></tr>
<tr><td><code id="GetData_+3A_user">user</code></td>
<td>
<p>email address of the user, used at registration with the HMD and HFD. It
is assumed that the same email address is used for both HMD and HFD.</p>
</td></tr>
<tr><td><code id="GetData_+3A_pw_hmd">pw_HMD</code></td>
<td>
<p>Password to access HMD, provided at registration.</p>
</td></tr>
<tr><td><code id="GetData_+3A_pw_hfd">pw_HFD</code></td>
<td>
<p>Password to access HFD, provided at registration</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>data_raw</code></td>
<td>
<p>A list object with four elements:</p>
</td></tr>
<tr><td><code>country</code></td>
<td>
<p>Country</p>
</td></tr>
<tr><td><code>LTf</code></td>
<td>
<p>Life table for female population for all years available in the HMD</p>
</td></tr>
<tr><td><code>LTm</code></td>
<td>
<p>Life table for male population for all years available in the HMD</p>
</td></tr>
<tr><td><code>fert_rates</code></td>
<td>
<p>Conditional fertility rates for all years available in the HFD</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>

## Not run: 
data_raw &lt;- GetData(country="USA",user,pw_HMD,pw_HFD)

## End(Not run)

</code></pre>

<hr>
<h2 id='GetGenerations'>Builds a Multi-Generation Virtual Population from demographic parameters</h2><span id='topic+GetGenerations'></span>

<h3>Description</h3>

<p>Builds a virtual population from mortality rates by age and sex, and fertility
rates by age of mother and parity.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GetGenerations(rates, ncohort = NULL, ngen = NULL, mort = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="GetGenerations_+3A_rates">rates</code></td>
<td>
<p>List object with death rates (ASDR) and birth rates (ASFR). Produced by function VirtualPop::GetRates(). Rates of USA 2021 are distributed with the VirtualPop package.</p>
</td></tr>
<tr><td><code id="GetGenerations_+3A_ncohort">ncohort</code></td>
<td>
<p>Size of hypothetical birth cohort (first generation)</p>
</td></tr>
<tr><td><code id="GetGenerations_+3A_ngen">ngen</code></td>
<td>
<p>Number of generations to be simulated. No upper limit.</p>
</td></tr>
<tr><td><code id="GetGenerations_+3A_mort">mort</code></td>
<td>
<p>Presence or absence of mortality. This parameter is optional. Default is TRUE. If mortality is absent, mort=FALSE.</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>dataAllgen</code></td>
<td>
<p>The database of simulated individual lifespans and
fertility histories (all generations).</p>
</td></tr>
</table>
<p>The object dataAllgen has four attributes:
</p>
<table role = "presentation">
<tr><td><code>country</code></td>
<td>
<p>The country</p>
</td></tr>
<tr><td><code>type</code></td>
<td>
<p>The type of data (period data or cohort data).</p>
</td></tr>
<tr><td><code>refyear</code></td>
<td>
<p>The calendar year for which the period data are used (reference year).</p>
</td></tr>
<tr><td><code>cohort</code></td>
<td>
<p>The birth cohort (if applicable).</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>

utils::data(rates,package = "VirtualPop")
dLH &lt;- VirtualPop::GetGenerations (rates=rates,ncohort=1000,ngen=4)


</code></pre>

<hr>
<h2 id='GetRates'>Retrieves Period Mortality and Fertility Rates from HMD and HFD for a Selected Country and Selected Year</h2><span id='topic+GetRates'></span>

<h3>Description</h3>

<p>The rates are retrieved from the life tables and fertility tables included in the raw data downloaded from the HMD and HFD.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GetRates(data, refyear)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="GetRates_+3A_data">data</code></td>
<td>
<p>data (the object data_raw, produced by the GetData() function.)</p>
</td></tr>
<tr><td><code id="GetRates_+3A_refyear">refyear</code></td>
<td>
<p>Reference year, which is the year of period data</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list object with three elements:
</p>
<table role = "presentation">
<tr><td><code>ASDR</code></td>
<td>
<p>Age-specific death rates, by sex for reference year</p>
</td></tr> 
<tr><td><code>ASFR</code></td>
<td>
<p>Age-specific birth rates by birth order for reference year</p>
</td></tr>
<tr><td><code>ratesM</code></td>
<td>
<p>Matrix of transition rates in format required for mulitstate modelling</p>
</td></tr>
</table>
<p>The object returned by the function has three attributes:
</p>
<table role = "presentation">
<tr><td><code>country</code></td>
<td>
<p>Country</p>
</td></tr>
<tr><td><code>type</code></td>
<td>
<p>Type of data (period data or cohort data)</p>
</td></tr>
<tr><td><code>year</code></td>
<td>
<p>Calendar year for which period death rates are used to complete cohort experience in case of incomplete mortality experience (reference year).</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Not run because passwords needed
# Input data: data_raw produced by GetData().
rates &lt;- GetRates(data=data_raw,refyear=2021)

## End(Not run)

</code></pre>

<hr>
<h2 id='GetRatesC'>Retrieves Cohort Data from the HMD and HFD and Obtains Cohort Rates</h2><span id='topic+GetRatesC'></span>

<h3>Description</h3>

<p>Retrieves cohort data from the HMD and HFD and produces cohort rates 
(death rates by age and sex and conditional fertility rates by age and parity). 
The function combines the steps of (a) data retrieval and (b) extraction of mortality and fertility rates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>GetRatesC(country, user, pw_HMD, pw_HFD, refcohort)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="GetRatesC_+3A_country">country</code></td>
<td>
<p>Code of the country selected. The code must be one of the country codes of HMD and HFD.</p>
</td></tr>
<tr><td><code id="GetRatesC_+3A_user">user</code></td>
<td>
<p>Name of the user, used at registration with the HMD and HFD. It
is assumed that the same name is used for both HMD and HFD.</p>
</td></tr>
<tr><td><code id="GetRatesC_+3A_pw_hmd">pw_HMD</code></td>
<td>
<p>Password to access HMD, provided at registration.</p>
</td></tr>
<tr><td><code id="GetRatesC_+3A_pw_hfd">pw_HFD</code></td>
<td>
<p>Password to access HFD, provided at registration</p>
</td></tr>
<tr><td><code id="GetRatesC_+3A_refcohort">refcohort</code></td>
<td>
<p>Year of birth of cohort for which the data are used for the simulation.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list object with three elements: 
</p>
<table role = "presentation">
<tr><td><code>ASDR</code></td>
<td>
<p>Age-specific death rates by sex for selected birth cohort</p>
</td></tr> 
<tr><td><code>ASFR</code></td>
<td>
<p>Age-specific fertility rates by parity for selected birth cohort</p>
</td></tr>
<tr><td><code>ratesM</code></td>
<td>
<p>Matrix of transition rates in format required for mulitstate modelling</p>
</td></tr>
</table>
<p>The object returned by the function has five attributes:
</p>
<table role = "presentation">
<tr><td><code>country</code></td>
<td>
<p>Country</p>
</td></tr>
<tr><td><code>type</code></td>
<td>
<p>Type of data (period data or cohort data)</p>
</td></tr>
<tr><td><code>cohort</code></td>
<td>
<p>Birth cohort (year of birth</p>
</td></tr>
<tr><td><code>refyear</code></td>
<td>
<p>Calendar year for which period death rates are used to complete cohort experience in case of incomplete mortality experience (reference year).</p>
</td></tr>
<tr><td><code>start_pASDR</code></td>
<td>
<p>Lowest age for which cohort data are missing. The mortality rates of that age and higher ages are borrowed from period data collected in the reference year.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
ratesC  &lt;- GetRatesC(country="USA",user,pw_HMD,pw_HFD,refcohort)

## End(Not run)


</code></pre>

<hr>
<h2 id='H_pw'>Computes Cumulative Hazard at Duration t under a Piecewise Exponential Model</h2><span id='topic+H_pw'></span>

<h3>Description</h3>

<p>Computes cumulative hazard at duration t from piecewise-constant rates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>H_pw(t, breakpoints, rates)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="H_pw_+3A_t">t</code></td>
<td>
<p>Duration at which cumulative hazard is required. It may be a vector of durations.</p>
</td></tr>
<tr><td><code id="H_pw_+3A_breakpoints">breakpoints</code></td>
<td>
<p>Breakpoints: values of time at which piecewise-constant
rates change.</p>
</td></tr>
<tr><td><code id="H_pw_+3A_rates">rates</code></td>
<td>
<p>Piecewise-constant rates</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Cumulative hazard at duration t
</p>


<h3>See Also</h3>

<p>functions pw_root() and r_pw_exp(): Function H_pw() is called by pw_root(), which is called by r_pw_exp().
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Example 1
breakpoints &lt;- c(0, 10, 20, 30, 60)
rates &lt;- c(0.01,0.02,0.04,0.15)
z &lt;- VirtualPop::H_pw(t=0:40, breakpoints=breakpoints, rates=rates)

# Example 2
utils::data(rates,package="VirtualPop")
ages &lt;- as.numeric(rownames(rates$ASDR))
breakpoints &lt;- c(ages,120)
zz &lt;- VirtualPop::H_pw(t=ages, breakpoints=breakpoints, rates=rates$ASDR[,1])


</code></pre>

<hr>
<h2 id='Lifespan'>Generates Individual Lifespan(s)</h2><span id='topic+Lifespan'></span>

<h3>Description</h3>

<p>Uses age-specific death rates to simulate length of life. The function generates age(s) at
death and date(s) of death. The function uses the function rpexp() of the msm package and uniroot() of base R
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Lifespan(data, ASDR, mort = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Lifespan_+3A_data">data</code></td>
<td>
<p>Data frame with individual data. If the object &quot;data&quot; includes date of 
birth (bdated; decimal date), then the date of death is computed.</p>
</td></tr>
<tr><td><code id="Lifespan_+3A_asdr">ASDR</code></td>
<td>
<p>Age-specific death rates</p>
</td></tr>
<tr><td><code id="Lifespan_+3A_mort">mort</code></td>
<td>
<p>Presence or absence of mortality. This parameter is optional. Default is TRUE. If mortality is (should be) absent, mort=FALSE.</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>LS</code></td>
<td>
<p>Data frame with age(s) at death and date(s) of death</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
utils::data(dLH,package="VirtualPop")
utils::data(rates,package="VirtualPop")
d &lt;- VirtualPop::Lifespan (dLH[1:5,1:5],ASDR=rates$ASDR)

</code></pre>

<hr>
<h2 id='PartnerSearch'>Simple Partner Search Simulation</h2><span id='topic+PartnerSearch'></span>

<h3>Description</h3>

<p>In this simple model, a partner is an individual of a different sex selected at random among members of the same generation.
The function is called by GetGenerations().
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PartnerSearch(dLH)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="PartnerSearch_+3A_dlh">dLH</code></td>
<td>
<p>Database</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>dLH</code></td>
<td>
<p>Updated version of database (dLH), which includes, for each individual 
without a partner and able to find a partner, the ID of the partner.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
utils::data(dLH,package="VirtualPop")
d &lt;- VirtualPop::PartnerSearch(dLH=dLH)

</code></pre>

<hr>
<h2 id='pw_root'>The Function for which the Root is Sought.</h2><span id='topic+pw_root'></span>

<h3>Description</h3>

<p>The function pw_root() specifies the mathematical function g(t). 
The equation to be solved is g(t)=0, with g(t) the cumulative hazard function of the piecewise exponential distribution + 
log(u) with u a random draw from standard uniform distribution (see vignette &quot;Piecewise_exponential&quot;, Section 2.2.4).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pw_root(t, breakpoints, rates, uu)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pw_root_+3A_t">t</code></td>
<td>
<p>Vector of durations for which the equation g(t)=0 should be solved.</p>
</td></tr>
<tr><td><code id="pw_root_+3A_breakpoints">breakpoints</code></td>
<td>
<p>Breakpoints</p>
</td></tr>
<tr><td><code id="pw_root_+3A_rates">rates</code></td>
<td>
<p>Piecewise-constant rates</p>
</td></tr>
<tr><td><code id="pw_root_+3A_uu">uu</code></td>
<td>
<p>Random draw from standard uniform distribution.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>pw_root is an argument of the function uniroot() of base R (argument &quot;f&quot;). It is required by uniroot(). 
The function uniroot() is called by
r.pw_exp(). See also Functions H_pw() and r.pw_exp().
</p>


<h3>Value</h3>

<p>Vector of differences between cumulative hazard and -log(uu) for
different values of t.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>breakpoints &lt;- c(0, 10, 20, 30, 60)
rates &lt;- c(0.01,0.02,0.04,0.15)
z &lt;- VirtualPop::pw_root (t= c(10,18.3,23.6,54.7),breakpoints,rates,uu=0.43)

</code></pre>

<hr>
<h2 id='r.pw_exp'>Draws Waiting Times from a Piecewise-Exponential Distribution.</h2><span id='topic+r.pw_exp'></span>

<h3>Description</h3>

<p>The function produces n realizations of a piecewise-exponentially distributed random waiting time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>r.pw_exp(n, breakpoints, rates)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="r.pw_exp_+3A_n">n</code></td>
<td>
<p>Number of random draws</p>
</td></tr>
<tr><td><code id="r.pw_exp_+3A_breakpoints">breakpoints</code></td>
<td>
<p>Breakpoints in piecewise-exponential distribution</p>
</td></tr>
<tr><td><code id="r.pw_exp_+3A_rates">rates</code></td>
<td>
<p>Piecewise-constant rates</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Vector of waiting times, drawn randomly from a piecewise-exponential survival
function.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

breakpoints &lt;- c(0, 10, 20, 30, 60)
rates &lt;- c(0.01,0.02,0.04,0.15)
pw_sample &lt;- VirtualPop::r.pw_exp (n=10, breakpoints, rates=rates)


</code></pre>

<hr>
<h2 id='rates'>Period rates</h2><span id='topic+rates'></span>

<h3>Description</h3>

<p>Data consisting of period rates of mortality by age and sex and fertility by age and parity, USA 2021
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(rates,package="VirtualPop")
</code></pre>


<h3>Format</h3>

<p>A list of three objects. </p>

<dl>
<dt>ASDR</dt><dd><p>Mortality rates</p>
</dd> 
<dt>ASFR</dt><dd><p>Fertility rates</p>
</dd>
<dt>ratesM</dt><dd><p>Multistate transition rates</p>
</dd> </dl>

<p>The dataset has three attributes:
</p>

<ul>
<li><p> Country
</p>
</li>
<li><p> Type of rates: period rates or cohort rates
</p>
</li>
<li><p> Calendar year for which period death rates are used to complete cohort experience in case of incomplete mortality experience (reference year).
</p>
</li></ul>



<h3>Source</h3>

<p>The data are downloaded from the Human Mortality Database (HMD) and
the Human Fertility Database (HFD). Country: USA. Year: 2021
</p>

<hr>
<h2 id='ratesC'>Cohort rates</h2><span id='topic+ratesC'></span>

<h3>Description</h3>

<p>Cohort rates of mortality by age and sex and fertility by age and parity, USA birth cohort 1964
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(ratesC,package="VirtualPop")
</code></pre>


<h3>Format</h3>

<p>A list of three objects. </p>

<dl>
<dt>ASDR</dt><dd><p>Mortality rates</p>
</dd> 
<dt>ASFR</dt><dd><p>Fertility rates</p>
</dd>
<dt>ratesM</dt><dd><p>Multistate transition rates</p>
</dd> 
</dl>

<p>The object returned by the function has five attributes:
</p>

<ul>
<li><p> Country
</p>
</li>
<li><p> type: Type of data (period data or cohort data)
</p>
</li>
<li><p> cohort: Birth cohort (year of birth)
</p>
</li>
<li><p> year: Calendar year for which period death rates are used to complete cohort experience in case of incomplete mortality experience (reference year).
</p>
</li>
<li><p> start_pASDR: Lowest age for which cohort data are missing. The mortality rates of that age and higher ages are borrowed from period data collected in the reference year.
</p>
</li></ul>



<h3>Source</h3>

<p>The data are downloaded from the Human Mortality Database (HMD) and
the Human Fertility Database (HFD). Country: USA. Cohort: 1964
</p>

<hr>
<h2 id='Sim_bio'>Generic Function to Generate Single Life History</h2><span id='topic+Sim_bio'></span>

<h3>Description</h3>

<p>The function generates a single life history from age-specific transition rates (rates$ratesM) and an initial state. 
RatesM is an object with the rates in the proper format for multistate modelling. The user supplies the 
starting age and ending age of the simulation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Sim_bio(datsim, ratesM)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="Sim_bio_+3A_datsim">datsim</code></td>
<td>
<p>Dataframe with, for each individual, ID, date of birth, starting 
and ending times (ages) of the simulation, and the state occupied at the start 
of the simulation (see vignette &quot;Tutorial&quot;).</p>
</td></tr>
<tr><td><code id="Sim_bio_+3A_ratesm">ratesM</code></td>
<td>
<p>Multistate transition rates in standard (multistate) format</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function is called from the function VirtualPop::Children(). It uses the rpexp() function of the msm package.
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>age_startSim</code></td>
<td>
<p>Age at start of simulation</p>
</td></tr>
<tr><td><code>age_endSim</code></td>
<td>
<p>Age at end of simulation</p>
</td></tr> <tr><td><code>nstates</code></td>
<td>
<p>Number of states</p>
</td></tr>
<tr><td><code>path</code></td>
<td>
<p>path: sequence of states occupied</p>
</td></tr> <tr><td><code>ages_trans</code></td>
<td>
<p>Ages at
transition</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
  # Fertily history is simulated from starting age to ending age
  # Individual starts in state "par0"
  utils::data(rates,package="VirtualPop")
  popsim &lt;- data.frame(ID=1,born=2000.450,start=0,end=80,st_start="par0")
  ch &lt;- VirtualPop::Sim_bio (datsim=popsim,ratesM=rates$ratesM) 

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
