<!DOCTYPE html><html lang="en"><head><title>Help for package MR.RGM</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {MR.RGM}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#NetworkMotif'><p>Estimating the uncertainty of a specified network</p></a></li>
<li><a href='#RGM'><p>Fitting Bayesian Multivariate Bidirectional Mendelian Randomization Networks</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Multivariate Bidirectional Mendelian Randomization Networks</td>
</tr>
<tr>
<td>Version:</td>
<td>0.0.4</td>
</tr>
<tr>
<td>Description:</td>
<td>Addressing a central challenge encountered in Mendelian randomization (MR) studies, where MR primarily focuses on discerning the effects of individual exposures on specific outcomes and establishes causal links between them. Using a network-based methodology, the intricacy involving interdependent outcomes due to numerous factors has been tackled through this routine. Based on Ni et al. (2018) &lt;<a href="https://doi.org/10.1214%2F17-BA1087">doi:10.1214/17-BA1087</a>&gt;, 'MR.RGM' extends to a broader exploration of the causal landscape by leveraging on network structures and involves the construction of causal graphs that capture interactions between response variables and consequently between responses and instrument variables. The resulting Graph visually represents these causal connections, showing directed edges with effect sizes labeled. 'MR.RGM' facilitates the navigation of various data availability scenarios effectively by accommodating three input formats, i.e., individual-level data and two types of summary-level data. In the process, causal effects, adjacency matrices, and other essential parameters of the complex biological networks, are estimated. Besides, 'MR.RGM' provides uncertainty quantification for specific network structures among response variables.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/bitansa/MR.RGM">https://github.com/bitansa/MR.RGM</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/bitansa/MR.RGM/issues">https://github.com/bitansa/MR.RGM/issues</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>Rcpp, stats, igraph</td>
</tr>
<tr>
<td>Suggests:</td>
<td>MASS</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-03-03 05:09:39 UTC; bitansarkar</td>
</tr>
<tr>
<td>Author:</td>
<td>Bitan Sarkar [aut, cre],
  Yang Ni [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Bitan Sarkar &lt;bitan@tamu.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-03-03 10:02:25 UTC</td>
</tr>
</table>
<hr>
<h2 id='NetworkMotif'>Estimating the uncertainty of a specified network</h2><span id='topic+NetworkMotif'></span>

<h3>Description</h3>

<p>The NetworkMotif function facilitates uncertainty quantification.
Specifically, it determines the proportion of posterior samples that contains the given network structure. To use this function, users may use the GammaPst output obtained from the RGM function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>NetworkMotif(Gamma, GammaPst)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="NetworkMotif_+3A_gamma">Gamma</code></td>
<td>
<p>A matrix of dimension p * p that signifies a specific network structure among the response variables, where p represents the number of response variables. This matrix is the focus of uncertainty quantification.</p>
</td></tr>
<tr><td><code id="NetworkMotif_+3A_gammapst">GammaPst</code></td>
<td>
<p>An array of dimension p * p * n_pst, where n_pst is the number of posterior samples and p denotes the number of response variables. It comprises the posterior samples of the causal network among the response variables. This input might be obtained from the RGM function. Initially, execute the RGM function and save the resulting GammaPst. Subsequently, utilize this stored GammaPst as input for this function.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The NetworkMotif function calculates the uncertainty quantification for the provided network structure. A value close to 1 indicates that the given network structure is frequently observed in the posterior samples, while a value close to 0 suggests that the given network structure is rarely observed in the posterior samples.
</p>


<h3>References</h3>

<p>Ni, Y., Ji, Y., &amp; Müller, P. (2018).
Reciprocal graphical models for integrative gene regulatory network analysis.
<em>Bayesian Analysis</em>,
<strong>13(4)</strong>, 1095-1110.
<a href="https://doi.org/10.1214/17-BA1087">doi:10.1214/17-BA1087</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

#' # ---------------------------------------------------------

# Example 1:
# Run NetworkMotif to do uncertainty quantification for a given network among the response variable

# Data Generation
set.seed(9154)

# Number of data points
n = 10000

# Number of response variables and number of instrument variables
p = 3
k = 4

# Initialize causal interaction matrix between response variables
A = matrix(sample(c(-0.1, 0.1), p^2, replace = TRUE), p, p)

# Diagonal entries of A matrix will always be 0
diag(A) = 0

# Make the network sparse
A[sample(which(A!=0), length(which(A!=0))/2)] = 0

# Create D matrix (Indicator matrix where each row corresponds to a response variable
# and each column corresponds to an instrument variable)
D = matrix(0, nrow = p, ncol = k)

# Manually assign values to D matrix
D[1, 1:2] = 1  # First response variable is influenced by the first 2 instruments
D[2, 3] = 1    # Second response variable is influenced by the 3rd instrument
D[3, 4] = 1    # Third response variable is influenced by the 4th instrument


# Initialize B matrix
B = matrix(0, p, k)  # Initialize B matrix with zeros

# Calculate B matrix based on D matrix
for (i in 1:p) {
  for (j in 1:k) {
    if (D[i, j] == 1) {
      B[i, j] = 1  # Set B[i, j] to 1 if D[i, j] is 1
    }
  }
}

Sigma = diag(p)

Mult_Mat = solve(diag(p) - A)

Variance = Mult_Mat %*% Sigma %*% t(Mult_Mat)

# Generate instrument data matrix
X = matrix(rnorm(n * k, 0, 1), nrow = n, ncol = k)

# Initialize response data matrix
Y = matrix(0, nrow = n, ncol = p)

# Generate response data matrix based on instrument data matrix
for (i in 1:n) {

    Y[i, ] = MASS::mvrnorm(n = 1, Mult_Mat %*% B %*% X[i, ], Variance)

}


# Apply RGM on individual level data with Spike and Slab Prior
Output = RGM(X = X, Y = Y, D = D, prior = "Spike and Slab")

# Store GammaPst
GammaPst = Output$GammaPst

# Define a function to create smaller arrowheads
smaller_arrowheads = function(graph) {
    igraph::E(graph)$arrow.size = 1  # Adjust the arrow size value as needed
    return(graph)
}


# Plot the true graph structure between response variables
plot(smaller_arrowheads(igraph::graph_from_adjacency_matrix((A != 0) * 1,
  mode = "directed")), layout = igraph::layout_in_circle, main = "True Graph")

# Start with a random subgraph
Gamma = matrix(0, nrow = p, ncol = p)
Gamma[2, 1] = 1

# Plot the subgraph to get an idea about the causal network
plot(smaller_arrowheads(igraph::graph_from_adjacency_matrix(Gamma,
         mode = "directed")), layout = igraph::layout_in_circle,
            main = "Subgraph")


# Do uncertainty quantification for the subgraph
NetworkMotif(Gamma = Gamma, GammaPst = GammaPst)





</code></pre>

<hr>
<h2 id='RGM'>Fitting Bayesian Multivariate Bidirectional Mendelian Randomization Networks</h2><span id='topic+RGM'></span>

<h3>Description</h3>

<p>The RGM function transforms causal inference by merging Mendelian randomization and network-based methods, enabling the creation of comprehensive causal graphs within complex biological systems. RGM accommodates varied data contexts with three input options: individual-level data (X, Y matrices), summary-level data including Syy, Syx, and Sxx matrices, and intricate data with challenging cross-correlations, utilizing Sxx, Beta, and SigmaHat matrices.
For the latter input, data centralization is necessary. Users can select any of these data formats to suit their needs and don’t have to specify all of them, allowing flexibility based on data availability. Crucial inputs encompass &quot;D&quot; (a matrix indicating which IV is affecting which response) and &quot;n&quot; (total observations, only required for summary level data), amplified by customizable parameters that refine analysis. Additionally, users can tailor the analysis by setting parameters such as &quot;nIter&quot; (number of MCMC iterations), &quot;nBurnin&quot; (number of discarded samples during burn-in for convergence), and &quot;Thin&quot; (thinning of posterior samples). These customizable parameters enhance the precision and relevance of the analysis.
RGM provides essential causal effect/strength estimates between response variables and between response and instrument variables. Moreover, it furnishes adjacency matrices, visually mapping causal graph structures. These outputs empower researchers to untangle intricate relationships within biological networks, fostering a holistic understanding of complex systems.
The function also returns a graph object representing the estimated causal network between the responses. This graph consists of directed edges that indicate causal effects, with effect sizes displayed on the edges. The edges are determined based on a threshold of 0.5 for inclusion. Users can visualize the network by plotting this object, which helps in interpreting the causal relationships between response variables.
The output includes AEst, BEst, A0Est, B0Est, GammaEst, TauEst, PhiEst, EtaEst, tAEst, tBEst, SigmaEst, RhoEst, and PsiEst, representing the posterior means of the corresponding quantities. Additionally, LLPst and GammaPst represent posterior samples. The adjacency matrices zAEst and zBEst are obtained by thresholding GammaEst and TauEst, respectively.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RGM(
  X = NULL,
  Y = NULL,
  Syy = NULL,
  Syx = NULL,
  Sxx = NULL,
  Beta = NULL,
  SigmaHat = NULL,
  D,
  n,
  nIter = 10000,
  nBurnin = 2000,
  Thin = 1,
  prior = c("Threshold", "Spike and Slab"),
  aRho = 3,
  bRho = 1,
  nu1 = 0.001,
  aPsi = 0.5,
  bPsi = 0.5,
  nu2 = 1e-04,
  aSigma = 0.01,
  bSigma = 0.01,
  PropVarA = 0.01,
  PropVarB = 0.01
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="RGM_+3A_x">X</code></td>
<td>
<p>A matrix of dimension n * k. Each row represents a distinct observation, and each column corresponds to a specific instrumental variable. The default value is set to NULL.</p>
</td></tr>
<tr><td><code id="RGM_+3A_y">Y</code></td>
<td>
<p>A matrix of dimension n * p. Each row represents a specific observation, and each column corresponds to a particular response variable. The default value is set to NULL.</p>
</td></tr>
<tr><td><code id="RGM_+3A_syy">Syy</code></td>
<td>
<p>A matrix of dimension p * p, where &quot;p&quot; is the number of response variables. It is calculated as t(Y) %*% Y / n, where &quot;Y&quot; represents the response data matrix and &quot;n&quot; is the number of observations.</p>
</td></tr>
<tr><td><code id="RGM_+3A_syx">Syx</code></td>
<td>
<p>A matrix of dimension p * k, where &quot;p&quot; is the number of response variables, and &quot;k&quot; is the number of instrumental variables. It is calculated as t(Y) %*% X / n, where &quot;Y&quot; represents the response data matrix, &quot;X&quot; represents the instrumental data matrix, and &quot;n&quot; is the number of observations.</p>
</td></tr>
<tr><td><code id="RGM_+3A_sxx">Sxx</code></td>
<td>
<p>A matrix of dimension k * k, where &quot;k&quot; is the number of instrumental variables. It is derived as t(X) %*% X / n, where &quot;X&quot; represents the instrumental data matrix and &quot;n&quot; is the number of observations.</p>
</td></tr>
<tr><td><code id="RGM_+3A_beta">Beta</code></td>
<td>
<p>A matrix of dimension p * k, where each row corresponds to a specific response variable and each column pertains to an instrumental variable. Each entry represents the regression coefficient of the response variable on the instrumental variable. When using Beta as input, ensure that both Y (response data) and X (instrument data) are centered before calculating Beta, Sxx, and SigmaHat.</p>
</td></tr>
<tr><td><code id="RGM_+3A_sigmahat">SigmaHat</code></td>
<td>
<p>A matrix of dimension p * k. Each row corresponds to a specific response variable, and each column pertains to an instrumental variable. Each entry represents the mean square error of the regression between the response and the instrumental variable. As with Beta, ensure that both Y and X are centered before calculating SigmaHat.</p>
</td></tr>
<tr><td><code id="RGM_+3A_d">D</code></td>
<td>
<p>A binary indicator matrix of dimension p * k, where each row corresponds to a response variable, and each column corresponds to an instrumental variable. The entry <code>D[i, j]</code> is 1 if instrumental variable j affects response variable i, and 0 otherwise. For each response variable, there must be at least one instrumental variable that affects only that response (i.e., for each row in D, there must be at least one column with 1, and that column must have zeros in all other rows). If you use <code>Syy</code>, <code>Beta</code>, and <code>SigmaHat</code> as inputs, this condition must be satisfied to run this algorithm. If this condition is not met, an error will be thrown. However, if using <code>X</code>, <code>Y</code> or <code>Syy</code>, <code>Syx</code>, <code>Sxx</code> as inputs, a warning will be issued if the condition is violated, but the method will still proceed.</p>
</td></tr>
<tr><td><code id="RGM_+3A_n">n</code></td>
<td>
<p>A positive integer input representing the count of data points or observations in the dataset. This input is only required when summary level data is used as input.</p>
</td></tr>
<tr><td><code id="RGM_+3A_niter">nIter</code></td>
<td>
<p>A positive integer input representing the number of MCMC (Markov Chain Monte Carlo) sampling iterations. The default value is set to 10,000.</p>
</td></tr>
<tr><td><code id="RGM_+3A_nburnin">nBurnin</code></td>
<td>
<p>A non-negative integer input representing the number of samples to be discarded during the burn-in phase of MCMC sampling. It's important that nBurnin is less than nIter. The default value is set to 2000.</p>
</td></tr>
<tr><td><code id="RGM_+3A_thin">Thin</code></td>
<td>
<p>A positive integer input denoting the thinning factor applied to posterior samples. Thinning reduces the number of samples retained from the MCMC process for efficiency. Thin should not exceed (nIter - nBurnin). The default value is set to 1.</p>
</td></tr>
<tr><td><code id="RGM_+3A_prior">prior</code></td>
<td>
<p>A parameter representing the prior assumption on the graph structure. It offers two options: &quot;Threshold&quot; or &quot;Spike and Slab&quot;. The default value is &quot;Spike and Slab&quot;.</p>
</td></tr>
<tr><td><code id="RGM_+3A_arho">aRho</code></td>
<td>
<p>A positive scalar input representing the first parameter of a Beta distribution. The default value is set to 3.</p>
</td></tr>
<tr><td><code id="RGM_+3A_brho">bRho</code></td>
<td>
<p>A positive scalar input representing the second parameter of a Beta distribution. The default value is set to 1.</p>
</td></tr>
<tr><td><code id="RGM_+3A_nu1">nu1</code></td>
<td>
<p>A positive scalar input representing the multiplication factor in the variance of the spike part in the spike and slab distribution of matrix A. The default value is set to 0.001.</p>
</td></tr>
<tr><td><code id="RGM_+3A_apsi">aPsi</code></td>
<td>
<p>A positive scalar input corresponding to the first parameter of a Beta distribution. The default value is set to 0.5.</p>
</td></tr>
<tr><td><code id="RGM_+3A_bpsi">bPsi</code></td>
<td>
<p>A positive scalar input corresponding to the second parameter of a Beta distribution. The default value is set to 0.5.</p>
</td></tr>
<tr><td><code id="RGM_+3A_nu2">nu2</code></td>
<td>
<p>A positive scalar input corresponding to the multiplication factor in the variance of the spike part in the spike and slab distribution of matrix B. The default value is set to 0.0001.</p>
</td></tr>
<tr><td><code id="RGM_+3A_asigma">aSigma</code></td>
<td>
<p>A positive scalar input corresponding to the first parameter of an Inverse Gamma distribution, which is associated with the variance of the model. The default value is set to 0.01.</p>
</td></tr>
<tr><td><code id="RGM_+3A_bsigma">bSigma</code></td>
<td>
<p>A positive scalar input corresponding to the second parameter of an Inverse Gamma distribution, which is associated with the variance of the model. The default value is set to 0.01.</p>
</td></tr>
<tr><td><code id="RGM_+3A_propvara">PropVarA</code></td>
<td>
<p>A positive scalar input representing the variance of the normal distribution used for proposing terms within the A matrix. The default value is set to 0.01.</p>
</td></tr>
<tr><td><code id="RGM_+3A_propvarb">PropVarB</code></td>
<td>
<p>A positive scalar input representing the variance of the normal distribution used for proposing terms within the B matrix. The default value is set to 0.01.</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>AEst</code></td>
<td>
<p>A matrix of dimensions p * p, representing the estimated causal effects or strengths between the response variables.</p>
</td></tr>
<tr><td><code>BEst</code></td>
<td>
<p>A matrix of dimensions p * k, representing the estimated causal effects or strengths of the instrument variables on the response variables. Each row corresponds to a specific response variable, and each column corresponds to a particular instrument variable.</p>
</td></tr>
<tr><td><code>zAEst</code></td>
<td>
<p>A binary adjacency matrix of dimensions p * p, indicating the graph structure between the response variables. Each entry in the matrix represents the presence (1) or absence (0) of a causal link between the corresponding response variables.</p>
</td></tr>
<tr><td><code>zBEst</code></td>
<td>
<p>A binary adjacency matrix of dimensions p * k, illustrating the graph structure between the response variables and the instrument variables. Each row corresponds to a specific response variable, and each column corresponds to a particular instrument variable. The presence of a causal link is denoted by 1, while the absence is denoted by 0.</p>
</td></tr>
<tr><td><code>Graph</code></td>
<td>
<p>A graph object that visually represents the estimated causal network by integrating AEst and zAEst. The graph consists of directed edges that indicate causal relationships between response variables. The edge weights correspond to effect sizes from AEst, while the structure of the graph is defined by zAEst, which already contain binary values (0 or 1) after thresholding at 0.5. This visualization provides an intuitive way to analyze both the strength and structure of causal effects within the network. Users can plot this graph to explore the causal relationships effectively.</p>
</td></tr>
<tr><td><code>A0Est</code></td>
<td>
<p>A matrix of dimensions p * p, representing the estimated causal effects or strengths between response variables before thresholding. This output is particularly relevant for cases where the &quot;Threshold&quot; prior assumption is utilized.</p>
</td></tr>
<tr><td><code>B0Est</code></td>
<td>
<p>A matrix of dimensions p * k, representing the estimated causal effects or strengths of the instrument variables on the response variables before thresholding. This output is particularly relevant for cases where the &quot;Threshold&quot; prior assumption is utilized. Each row corresponds to a specific response variable, and each column corresponds to a particular instrument variable.</p>
</td></tr>
<tr><td><code>GammaEst</code></td>
<td>
<p>A matrix of dimensions p * p, representing the estimated probabilities of edges between response variables in the graph structure. Each entry in the matrix indicates the probability of a causal link between the corresponding response variables.</p>
</td></tr>
<tr><td><code>TauEst</code></td>
<td>
<p>A matrix of dimensions p * p, representing the estimated variances of causal interactions between response variables. Each entry in the matrix corresponds to the variance of the causal effect between the corresponding response variables.</p>
</td></tr>
<tr><td><code>PhiEst</code></td>
<td>
<p>A matrix of dimensions p * k, representing the estimated probabilities of edges between response and instrument variables in the graph structure. Each row corresponds to a specific response variable, and each column corresponds to a particular instrument variable.</p>
</td></tr>
<tr><td><code>EtaEst</code></td>
<td>
<p>A matrix of dimensions p * k, representing the estimated variances of causal interactions between response and instrument variables. Each row corresponds to a specific response variable, and each column corresponds to a particular instrument variable.</p>
</td></tr>
<tr><td><code>tAEst</code></td>
<td>
<p>A scalar value representing the estimated thresholding value of causal interactions between response variables. This output is relevant when using the &quot;Threshold&quot; prior assumption.</p>
</td></tr>
<tr><td><code>tBEst</code></td>
<td>
<p>A scalar value representing the estimated thresholding value of causal interactions between response and instrument variables. This output is applicable when using the &quot;Threshold&quot; prior assumption.</p>
</td></tr>
<tr><td><code>SigmaEst</code></td>
<td>
<p>A vector of length p, representing the estimated variances of each response variable. Each element in the vector corresponds to the variance of a specific response variable.</p>
</td></tr>
<tr><td><code>AccptA</code></td>
<td>
<p>The percentage of accepted entries in the A matrix, which represents the causal interactions between response variables. This metric indicates the proportion of proposed changes that were accepted during the sampling process.</p>
</td></tr>
<tr><td><code>AccptB</code></td>
<td>
<p>The percentage of accepted entries in the B matrix, which represents the causal interactions between response and instrument variables. This metric indicates the proportion of proposed changes that were accepted during the sampling process.</p>
</td></tr>
<tr><td><code>AccpttA</code></td>
<td>
<p>The percentage of accepted thresholding values for causal interactions between response variables when using the &quot;Threshold&quot; prior assumption. This metric indicates the proportion of proposed thresholding values that were accepted during the sampling process.</p>
</td></tr>
<tr><td><code>AccpttB</code></td>
<td>
<p>The percentage of accepted thresholding values for causal interactions between response and instrument variables when using the &quot;Threshold&quot; prior assumption. This metric indicates the proportion of proposed thresholding values that were accepted during the sampling process.</p>
</td></tr>
<tr><td><code>LLPst</code></td>
<td>
<p>A vector containing the posterior log-likelihoods of the model. Each element in the vector represents the log-likelihood of the model given the observed data and the estimated parameters.</p>
</td></tr>
<tr><td><code>RhoEst</code></td>
<td>
<p>A matrix of dimensions p * p, representing the estimated Bernoulli success probabilities of causal interactions between response variables when using the &quot;Spike and Slab&quot; prior assumption. Each entry in the matrix corresponds to the success probability of a causal interaction between the corresponding response variables.</p>
</td></tr>
<tr><td><code>PsiEst</code></td>
<td>
<p>A matrix of dimensions p * k, representing the estimated Bernoulli success probabilities of causal interactions between response and instrument variables when using the &quot;Spike and Slab&quot; prior assumption. Each row in the matrix corresponds to a specific response variable, and each column corresponds to a particular instrument variable.</p>
</td></tr>
<tr><td><code>GammaPst</code></td>
<td>
<p>An array containing the posterior samples of the network structure among the response variables.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Ni, Y., Ji, Y., &amp; Müller, P. (2018).
Reciprocal graphical models for integrative gene regulatory network analysis.
<em>Bayesian Analysis</em>,
<strong>13(4)</strong>, 1095-1110.
<a href="https://doi.org/10.1214/17-BA1087">doi:10.1214/17-BA1087</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

# ---------------------------------------------------------

# Example 1:
# Run RGM based on individual level data with Threshold prior based on the model Y = AY + BX + E

# Data Generation
set.seed(9154)

# Number of data points
n = 10000

# Number of response variables and number of instrument variables
p = 3
k = 4

# Initialize causal interaction matrix between response variables
A = matrix(sample(c(-0.1, 0.1), p^2, replace = TRUE), p, p)

# Diagonal entries of A matrix will always be 0
diag(A) = 0

# Make the network sparse
A[sample(which(A != 0), length(which(A != 0)) / 2)] = 0

# Create D matrix (Indicator matrix where each row corresponds to a response variable
# and each column corresponds to an instrument variable)
D = matrix(0, nrow = p, ncol = k)

# Manually assign values to D matrix
D[1, 1:2] = 1  # First response variable is influenced by the first 2 instruments
D[2, 3] = 1    # Second response variable is influenced by the 3rd instrument
D[3, 4] = 1    # Third response variable is influenced by the 4th instrument


# Initialize B matrix
B = matrix(0, p, k)  # Initialize B matrix with zeros

# Calculate B matrix based on D matrix
for (i in 1:p) {
  for (j in 1:k) {
    if (D[i, j] == 1) {
      B[i, j] = 1  # Set B[i, j] to 1 if D[i, j] is 1
    }
  }
}

# Define Sigma matrix
Sigma = diag(p)

# Compute Mult_Mat
Mult_Mat = solve(diag(p) - A)

# Calculate Variance
Variance = Mult_Mat %*% Sigma %*% t(Mult_Mat)

# Generate instrument data matrix
X = matrix(rnorm(n * k, 0, 1), nrow = n, ncol = k)

# Initialize response data matrix
Y = matrix(0, nrow = n, ncol = p)

# Generate response data matrix based on instrument data matrix
for (i in 1:n) {
  Y[i, ] = MASS::mvrnorm(n = 1, Mult_Mat %*% B %*% X[i, ], Variance)
}

# Define a function to create smaller arrowheads
smaller_arrowheads = function(graph) {
  igraph::E(graph)$arrow.size = 1  # Adjust the arrow size value as needed
  return(graph)
}

# Print true causal interaction matrices between response variables
# and between response and instrument variables
A
B

# Plot the true graph structure between response variables
plot(smaller_arrowheads(igraph::graph_from_adjacency_matrix((A != 0) * 1,
  mode = "directed")), layout = igraph::layout_in_circle, main = "True Graph")

# Apply RGM on individual level data for Threshold Prior
Output = RGM(X = X, Y = Y, D = D, prior = "Threshold")


# Get the graph structure between response variables
Output$zAEst

# Get the estimated causal strength matrix between response variables
Output$AEst

# Get the graph structure between response and instrument variables
Output$zBEst

# Get the estimated causal strength matrix between response and instrument variables
Output$BEst

# Get the estimated causal network between responses
Output$Graph

# Plot the estimated causal network
plot(Output$Graph, main = "Estimated Causal Network")

# Plot posterior log-likelihood
plot(Output$LLPst, type = 'l', xlab = "Number of Iterations", ylab = "Log-likelihood")

# -----------------------------------------------------------------
# Example 2:
# Run RGM based on Syy, Syx and Sxx with Spike and Slab prior based on the model Y = AY + BX + E

# Data Generation
set.seed(9154)

# Number of data points
n = 10000

# Number of response variables and number of instrument variables
p = 3
k = 4

# Initialize causal interaction matrix between response variables
A = matrix(sample(c(-0.1, 0.1), p^2, replace = TRUE), p, p)

# Diagonal entries of A matrix will always be 0
diag(A) = 0

# Make the network sparse
A[sample(which(A!=0), length(which(A!=0))/2)] = 0


# Create D matrix (Indicator matrix where each row corresponds to a response variable
# and each column corresponds to an instrument variable)
D = matrix(0, nrow = p, ncol = k)

# Manually assign values to D matrix
D[1, 1:2] = 1  # First response variable is influenced by the first 2 instruments
D[2, 3] = 1    # Second response variable is influenced by the 3rd instrument
D[3, 4] = 1    # Third response variable is influenced by the 4th instrument


# Initialize B matrix
B = matrix(0, p, k)  # Initialize B matrix with zeros

# Calculate B matrix based on D matrix
for (i in 1:p) {
  for (j in 1:k) {
    if (D[i, j] == 1) {
      B[i, j] = 1  # Set B[i, j] to 1 if D[i, j] is 1
    }
  }
}


Sigma = diag(p)

Mult_Mat = solve(diag(p) - A)

Variance = Mult_Mat %*% Sigma %*% t(Mult_Mat)

# Generate instrument data matrix
X = matrix(rnorm(n * k, 0, 1), nrow = n, ncol = k)

# Initialize response data matrix
Y = matrix(0, nrow = n, ncol = p)

# Generate response data matrix based on instrument data matrix
for (i in 1:n) {

    Y[i, ] = MASS::mvrnorm(n = 1, Mult_Mat %*% B %*% X[i, ], Variance)

}


# Calculate summary level data
Syy = t(Y) %*% Y / n
Syx = t(Y) %*% X / n
Sxx = t(X) %*% X / n


# Print true causal interaction matrices between response variables
# and between response and instrument variables
A
B

# Plot the true graph structure between response variables
plot(smaller_arrowheads(igraph::graph_from_adjacency_matrix(((A != 0) * 1),
 mode = "directed")), layout = igraph::layout_in_circle, main = "True Graph")


# Apply RGM on summary level data for Spike and Slab Prior
Output = RGM(Syy = Syy, Syx = Syx, Sxx = Sxx,
          D = D, n = 10000, prior = "Spike and Slab")


# Get the graph structure between response variables
Output$zAEst

# Get the estimated causal strength matrix between response variables
Output$AEst

# Get the graph structure between response and instrument variables
Output$zBEst

# Get the estimated causal strength matrix between response and instrument variables
Output$BEst

# Get the estimated causal network between responses
Output$Graph

# Plot the estimated causal network
plot(Output$Graph, main = "Estimated Causal Network")

# Plot posterior log-likelihood
plot(Output$LLPst, type = 'l', xlab = "Number of Iterations", ylab = "Log-likelihood")




# -----------------------------------------------------------------
# Example 3:
# Run RGM based on Sxx, Beta and SigmaHat with Spike and Slab prior
# based on the model Y = AY + BX + E

# Data Generation
set.seed(9154)

# Number of datapoints
n = 10000

# Number of response variables and number of instrument variables
p = 3
k = 4

# Initialize causal interaction matrix between response variables
A = matrix(sample(c(-0.1, 0.1), p^2, replace = TRUE), p, p)

# Diagonal entries of A matrix will always be 0
diag(A) = 0

# Make the network sparse
A[sample(which(A!=0), length(which(A!=0))/2)] = 0


# Create D matrix (Indicator matrix where each row corresponds to a response variable
# and each column corresponds to an instrument variable)
D = matrix(0, nrow = p, ncol = k)

# Manually assign values to D matrix
D[1, 1:2] = 1  # First response variable is influenced by the first 2 instruments
D[2, 3] = 1    # Second response variable is influenced by the 3rd instrument
D[3, 4] = 1    # Third response variable is influenced by the 4th instrument


# Initialize B matrix
B = matrix(0, p, k)  # Initialize B matrix with zeros

# Calculate B matrix based on D matrix
for (i in 1:p) {
  for (j in 1:k) {
    if (D[i, j] == 1) {
      B[i, j] = 1  # Set B[i, j] to 1 if D[i, j] is 1
    }
  }
}


Sigma = diag(p)

Mult_Mat = solve(diag(p) - A)

Variance = Mult_Mat %*% Sigma %*% t(Mult_Mat)

# Generate DNA expressions
X = matrix(rnorm(n * k, 0, 1), nrow = n, ncol = k)

# Initialize response data matrix
Y = matrix(0, nrow = n, ncol = p)

# Generate response data matrix based on instrument data matrix
for (i in 1:n) {

    Y[i, ] = MASS::mvrnorm(n = 1, Mult_Mat %*% B %*% X[i, ], Variance)

}


# Centralize Data
Y = t(t(Y) - colMeans(Y))
X = t(t(X) - colMeans(X))

# Calculate Sxx
Sxx = t(X) %*% X / n

# Generate Beta matrix and SigmaHat
Beta = matrix(0, nrow = p, ncol = k)
SigmaHat = matrix(0, nrow = p, ncol = k)

for (i in 1:p) {

   for (j in 1:k) {

       fit = lm(Y[, i] ~ X[, j])

       Beta[i, j] =  fit$coefficients[2]

       SigmaHat[i, j] = sum(fit$residuals^2) / n

       }

   }


# Print true causal interaction matrices between response variables
# and between response and instrument variables
A
B


# Plot the true graph structure between response variables
plot(smaller_arrowheads(igraph::graph_from_adjacency_matrix(((A != 0) * 1),
 mode = "directed")), layout = igraph::layout_in_circle, main = "True Graph")


# Apply RGM based on Sxx, Beta and SigmaHat for Spike and Slab Prior
Output = RGM(Sxx = Sxx, Beta = Beta, SigmaHat = SigmaHat,
          D = D, n = 10000, prior = "Spike and Slab")


# Get the graph structure between response variables
Output$zAEst

# Get the estimated causal strength matrix between response variables
Output$AEst

# Get the graph structure between response and instrument variables
Output$zBEst

# Get the estimated causal strength matrix between response and instrument variables
Output$BEst

# Get the estimated causal network between responses
Output$Graph

# Plot the estimated causal network
plot(Output$Graph, main = "Estimated Causal Network")

# Plot posterior log-likelihood
plot(Output$LLPst, type = 'l', xlab = "Number of Iterations", ylab = "Log-likelihood")






</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
