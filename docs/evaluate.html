<!DOCTYPE html><html><head><title>Help for package evaluate</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {evaluate}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#create_traceback'><p>Generate a traceback from a list of calls.</p></a></li>
<li><a href='#evaluate'><p>Evaluate input and return all details of evaluation.</p></a></li>
<li><a href='#flush_console'><p>An emulation of flush.console() in evaluate()</p></a></li>
<li><a href='#inject_funs'><p>Inject functions into the environment of <code>evaluate()</code></p></a></li>
<li><a href='#is.message'><p>Object class tests</p></a></li>
<li><a href='#line_prompt'><p>Line prompt.</p></a></li>
<li><a href='#new_output_handler'><p>Custom output handlers.</p></a></li>
<li><a href='#parse_all'><p>Parse, retaining comments.</p></a></li>
<li><a href='#remove_hooks'><p>Remove hooks.</p></a></li>
<li><a href='#replay'><p>Replay a list of evaluated results.</p></a></li>
<li><a href='#set_hooks'><p>Set hooks.</p></a></li>
<li><a href='#try_capture_stack'><p>Try, capturing stack on error.</p></a></li>
<li><a href='#watchout'><p>Watch for changes in output, text and graphical.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Parsing and Evaluation Tools that Provide More Details than the
Default</td>
</tr>
<tr>
<td>Version:</td>
<td>0.24.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Parsing and evaluation tools that make it easy to recreate
    the command line behaviour of R.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/r-lib/evaluate">https://github.com/r-lib/evaluate</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/r-lib/evaluate/issues">https://github.com/r-lib/evaluate/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.0.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>methods</td>
</tr>
<tr>
<td>Suggests:</td>
<td>covr, ggplot2, lattice, rlang, testthat (&ge; 3.0.0), withr</td>
</tr>
<tr>
<td>Config/Needs/website:</td>
<td>tidyverse/tidytemplate</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-06-10 13:33:57 UTC; hadleywickham</td>
</tr>
<tr>
<td>Author:</td>
<td>Hadley Wickham [aut, cre],
  Yihui Xie <a href="https://orcid.org/0000-0003-0645-5666"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Michael Lawrence [ctb],
  Thomas Kluyver [ctb],
  Jeroen Ooms [ctb],
  Barret Schloerke [ctb],
  Adam Ryczkowski [ctb],
  Hiroaki Yutani [ctb],
  Michel Lang [ctb],
  Karolis Konceviƒçius [ctb],
  Posit Software, PBC [cph, fnd]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Hadley Wickham &lt;hadley@posit.co&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-06-10 14:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='create_traceback'>Generate a traceback from a list of calls.</h2><span id='topic+create_traceback'></span>

<h3>Description</h3>

<p>Generate a traceback from a list of calls.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_traceback(callstack)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="create_traceback_+3A_callstack">callstack</code></td>
<td>
<p>stack of calls, as generated by (e.g.)
<code><a href="base.html#topic+sys.parent">base::sys.calls()</a></code></p>
</td></tr>
</table>

<hr>
<h2 id='evaluate'>Evaluate input and return all details of evaluation.</h2><span id='topic+evaluate'></span>

<h3>Description</h3>

<p>Compare to <code><a href="base.html#topic+eval">eval()</a></code>, <code>evaluate</code> captures all of the
information necessary to recreate the output as if you had copied and pasted
the code into a R terminal. It captures messages, warnings, errors and
output, all correctly interleaved in the order in which they occured. It
stores the final result, whether or not it should be visible, and the
contents of the current graphics device.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>evaluate(
  input,
  envir = parent.frame(),
  enclos = NULL,
  debug = FALSE,
  stop_on_error = 0L,
  keep_warning = TRUE,
  keep_message = TRUE,
  log_echo = FALSE,
  log_warning = FALSE,
  new_device = TRUE,
  output_handler = default_output_handler,
  filename = NULL,
  include_timing = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="evaluate_+3A_input">input</code></td>
<td>
<p>input object to be parsed and evaluated.  May be a string, file
connection or function.  Passed on to <code><a href="#topic+parse_all">parse_all()</a></code>.</p>
</td></tr>
<tr><td><code id="evaluate_+3A_envir">envir</code></td>
<td>
<p>environment in which to evaluate expressions.</p>
</td></tr>
<tr><td><code id="evaluate_+3A_enclos">enclos</code></td>
<td>
<p>when <code>envir</code> is a list or data frame, this is treated as
the parent environment to <code>envir</code>.</p>
</td></tr>
<tr><td><code id="evaluate_+3A_debug">debug</code></td>
<td>
<p>if <code>TRUE</code>, displays information useful for debugging,
including all output that evaluate captures.</p>
</td></tr>
<tr><td><code id="evaluate_+3A_stop_on_error">stop_on_error</code></td>
<td>
<p>if <code>2</code>, evaluation will halt on first error and you
will get no results back. If <code>1</code>, evaluation will stop on first error
without signaling the error, and you will get back all results up to that
point. If <code>0</code> will continue running all code, just as if you'd pasted
the code into the command line.</p>
</td></tr>
<tr><td><code id="evaluate_+3A_keep_warning">keep_warning</code>, <code id="evaluate_+3A_keep_message">keep_message</code></td>
<td>
<p>whether to record warnings and messages; if
<code>FALSE</code>, messages will be suppressed; if <code>NA</code>, they will not be captured
(normally they will be sent to the console). Note that if the environment
variable <code>R_EVALUATE_BYPASS_MESSAGES</code> is set to true, these arguments will
always be set to <code>NA</code>, meaning that messages will not be captured by this
function.</p>
</td></tr>
<tr><td><code id="evaluate_+3A_log_echo">log_echo</code>, <code id="evaluate_+3A_log_warning">log_warning</code></td>
<td>
<p>If <code>TRUE</code>, will immediately log code and
warnings (respectively) to <code>stderr</code>.</p>
</td></tr>
<tr><td><code id="evaluate_+3A_new_device">new_device</code></td>
<td>
<p>if <code>TRUE</code>, will open a new graphics device and
automatically close it after completion. This prevents evaluation from
interfering with your existing graphics environment.</p>
</td></tr>
<tr><td><code id="evaluate_+3A_output_handler">output_handler</code></td>
<td>
<p>an instance of <code><a href="#topic+output_handler">output_handler()</a></code> that
processes the output from the evaluation. The default simply prints the
visible return values.</p>
</td></tr>
<tr><td><code id="evaluate_+3A_filename">filename</code></td>
<td>
<p>string overrriding the <code><a href="base.html#topic+srcfile">base::srcfile()</a></code> filename.</p>
</td></tr>
<tr><td><code id="evaluate_+3A_include_timing">include_timing</code></td>
<td>
<p>if <code>TRUE</code>, evaluate will wrap each input
expression in <code>system.time()</code>, which will be accessed by following
<code>replay()</code> call to produce timing information for each evaluated
command.</p>
</td></tr>
</table>

<hr>
<h2 id='flush_console'>An emulation of flush.console() in evaluate()</h2><span id='topic+flush_console'></span>

<h3>Description</h3>

<p>When <code><a href="#topic+evaluate">evaluate()</a></code> is evaluating code, the text output is diverted into
an internal connection, and there is no way to flush that connection. This
function provides a way to &quot;flush&quot; the connection so that any text output can
be immediately written out, and more importantly, the <code>text</code> handler
(specified in the <code>output_handler</code> argument of <code>evaluate()</code>) will
be called, which makes it possible for users to know it when the code
produces text output using the handler.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>flush_console()
</code></pre>


<h3>Note</h3>

<p>This function is supposed to be called inside <code>evaluate()</code> (e.g.
either a direct <code>evaluate()</code> call or in <span class="pkg">knitr</span> code chunks).
</p>

<hr>
<h2 id='inject_funs'>Inject functions into the environment of <code>evaluate()</code></h2><span id='topic+inject_funs'></span>

<h3>Description</h3>

<p>Create functions in the environment specified in the <code>envir</code> argument of
<code><a href="#topic+evaluate">evaluate()</a></code>. This can be helpful if you want to substitute certain
functions when evaluating the code. To make sure it does not wipe out
existing functions in the environment, only functions that do not exist in
the environment are injected.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>inject_funs(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="inject_funs_+3A_...">...</code></td>
<td>
<p>Named arguments of functions. If empty, previously injected
functions will be emptied.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>For expert use only. Do not use it unless you clearly understand it.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(evaluate)
# normally you cannot capture the output of system
evaluate("system('R --version')")

# replace the system() function
inject_funs(system = function(...) cat(base::system(..., intern = TRUE), sep = '\n'))

evaluate("system('R --version')")

inject_funs()  # empty previously injected functions
</code></pre>

<hr>
<h2 id='is.message'>Object class tests</h2><span id='topic+is.message'></span><span id='topic+is.warning'></span><span id='topic+is.error'></span><span id='topic+is.value'></span><span id='topic+is.source'></span><span id='topic+is.recordedplot'></span>

<h3>Description</h3>

<p>Object class tests
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is.message(x)

is.warning(x)

is.error(x)

is.value(x)

is.source(x)

is.recordedplot(x)
</code></pre>

<hr>
<h2 id='line_prompt'>Line prompt.</h2><span id='topic+line_prompt'></span>

<h3>Description</h3>

<p>Format a single expression as if it had been entered at the command prompt.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>line_prompt(x, prompt = getOption("prompt"), continue = getOption("continue"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="line_prompt_+3A_x">x</code></td>
<td>
<p>string representing a single expression</p>
</td></tr>
<tr><td><code id="line_prompt_+3A_prompt">prompt</code></td>
<td>
<p>prompt for first line</p>
</td></tr>
<tr><td><code id="line_prompt_+3A_continue">continue</code></td>
<td>
<p>prompt for subsequent lines</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a string
</p>

<hr>
<h2 id='new_output_handler'>Custom output handlers.</h2><span id='topic+new_output_handler'></span><span id='topic+output_handler'></span>

<h3>Description</h3>

<p>An <code>output_handler</code> handles the results of <code><a href="#topic+evaluate">evaluate()</a></code>,
including the values, graphics, conditions. Each type of output is handled by
a particular function in the handler object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>new_output_handler(
  source = identity,
  text = identity,
  graphics = identity,
  message = identity,
  warning = identity,
  error = identity,
  value = render,
  calling_handlers = list()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="new_output_handler_+3A_source">source</code></td>
<td>
<p>Function to handle the echoed source code under evaluation.
This function should take two arguments (<code>src</code> and <code>call</code>), and return
an object that will be inserted into the evaluate outputs. <code>src</code> is the
unparsed text of the source code, and <code>call</code> is the parsed language object
If <code>src</code> is unparsable, <code>call</code> will be <code>expression()</code>.
</p>
<p>Return <code>src</code> for the default evaluate behaviour. Return <code>NULL</code> to
drop the source from the output.</p>
</td></tr>
<tr><td><code id="new_output_handler_+3A_text">text</code></td>
<td>
<p>Function to handle any textual console output.</p>
</td></tr>
<tr><td><code id="new_output_handler_+3A_graphics">graphics</code></td>
<td>
<p>Function to handle graphics, as returned by
<code><a href="grDevices.html#topic+recordPlot">recordPlot()</a></code>.</p>
</td></tr>
<tr><td><code id="new_output_handler_+3A_message">message</code></td>
<td>
<p>Function to handle <code><a href="base.html#topic+message">message()</a></code> output.</p>
</td></tr>
<tr><td><code id="new_output_handler_+3A_warning">warning</code></td>
<td>
<p>Function to handle <code><a href="base.html#topic+warning">warning()</a></code> output.</p>
</td></tr>
<tr><td><code id="new_output_handler_+3A_error">error</code></td>
<td>
<p>Function to handle <code><a href="base.html#topic+stop">stop()</a></code> output.</p>
</td></tr>
<tr><td><code id="new_output_handler_+3A_value">value</code></td>
<td>
<p>Function to handle the values returned from evaluation. If it
only has one argument, only visible values are handled; if it has more
arguments, the second argument indicates whether the value is visible.</p>
</td></tr>
<tr><td><code id="new_output_handler_+3A_calling_handlers">calling_handlers</code></td>
<td>
<p>List of <a href="base.html#topic+withCallingHandlers">calling handlers</a>.
These handlers have precedence over the exiting handler installed
by <code><a href="#topic+evaluate">evaluate()</a></code> when <code>stop_on_error</code> is set to 0.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The handler functions should accept an output object as their first argument.
The return value of the handlers is ignored, except in the case of the
<code>value</code> handler, where a visible return value is saved in the output
list.
</p>
<p>Calling the constructor with no arguments results in the default handler,
which mimics the behavior of the console by printing visible values.
</p>
<p>Note that recursion is common: for example, if <code>value</code> does any
printing, then the <code>text</code> or <code>graphics</code> handlers may be called.
</p>


<h3>Value</h3>

<p>A new <code>output_handler</code> object
</p>

<hr>
<h2 id='parse_all'>Parse, retaining comments.</h2><span id='topic+parse_all'></span>

<h3>Description</h3>

<p>Works very similarly to parse, but also keeps original formatting and
comments.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>parse_all(x, filename = NULL, allow_error = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="parse_all_+3A_x">x</code></td>
<td>
<p>object to parse.  Can be a string, a file connection, or a function.
If a connection, will be opened and closed only if it was closed initially.</p>
</td></tr>
<tr><td><code id="parse_all_+3A_filename">filename</code></td>
<td>
<p>string overriding the file name</p>
</td></tr>
<tr><td><code id="parse_all_+3A_allow_error">allow_error</code></td>
<td>
<p>whether to allow syntax errors in <code>x</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame with columns <code>src</code>, the source code, and
<code>expr</code>. If there are syntax errors in <code>x</code> and <code>allow_error = TRUE</code>, the data frame has an attribute <code>PARSE_ERROR</code> that stores the
error object.
</p>

<hr>
<h2 id='remove_hooks'>Remove hooks.</h2><span id='topic+remove_hooks'></span>

<h3>Description</h3>

<p>This provides a way to remove previously set hook values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>remove_hooks(hooks)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="remove_hooks_+3A_hooks">hooks</code></td>
<td>
<p>a named list of hooks - each hook can either be a function or
a list of functions.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>new1 &lt;- list(before.plot.new = function() print("Plotted!"))
new2 &lt;- list(before.plot.new = function() print("Plotted Again!"))
set_hooks(new1)
set_hooks(new2)
plot(1)
remove_hooks(new1)
plot(1)
remove_hooks(new2)
plot(1)
</code></pre>

<hr>
<h2 id='replay'>Replay a list of evaluated results.</h2><span id='topic+replay'></span>

<h3>Description</h3>

<p>Replay a list of evaluated results, as if you'd run them in an R
terminal.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>replay(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="replay_+3A_x">x</code></td>
<td>
<p>result from <code><a href="#topic+evaluate">evaluate()</a></code></p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>samples &lt;- system.file("tests", "testthat", package = "evaluate")
if (file_test("-d", samples)) {
  replay(evaluate(file(file.path(samples, "order.R"))))
  replay(evaluate(file(file.path(samples, "plot.R"))))
  replay(evaluate(file(file.path(samples, "data.R"))))
}
</code></pre>

<hr>
<h2 id='set_hooks'>Set hooks.</h2><span id='topic+set_hooks'></span>

<h3>Description</h3>

<p>This wraps the base <code><a href="base.html#topic+setHook">setHook()</a></code> function to provide a return
value that makes it easy to undo.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_hooks(hooks, action = "append")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="set_hooks_+3A_hooks">hooks</code></td>
<td>
<p>a named list of hooks - each hook can either be a function or
a list of functions.</p>
</td></tr>
<tr><td><code id="set_hooks_+3A_action">action</code></td>
<td>
<p><code>"replace"</code>, <code>"append"</code> or <code>"prepend"</code></p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>new &lt;- list(before.plot.new = function() print("Plotted!"))
hooks &lt;- set_hooks(new)
plot(1)
set_hooks(hooks, "replace")
plot(1)
</code></pre>

<hr>
<h2 id='try_capture_stack'>Try, capturing stack on error.</h2><span id='topic+try_capture_stack'></span>

<h3>Description</h3>

<p>This is a variant of <code><a href="base.html#topic+tryCatch">tryCatch()</a></code> that also captures the call
stack if an error occurs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>try_capture_stack(quoted_code, env)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="try_capture_stack_+3A_quoted_code">quoted_code</code></td>
<td>
<p>code to evaluate, in quoted form</p>
</td></tr>
<tr><td><code id="try_capture_stack_+3A_env">env</code></td>
<td>
<p>environment in which to execute code</p>
</td></tr>
</table>

<hr>
<h2 id='watchout'>Watch for changes in output, text and graphical.</h2><span id='topic+watchout'></span>

<h3>Description</h3>

<p>Watch for changes in output, text and graphical.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>watchout(debug = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="watchout_+3A_debug">debug</code></td>
<td>
<p>activate debug mode where output will be both printed to
screen and captured.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list containing four functions: <code>get_new</code>, <code>pause</code>,
<code>unpause</code>, <code>close</code>.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
