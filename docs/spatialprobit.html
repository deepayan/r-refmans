<!DOCTYPE html><html><head><title>Help for package spatialprobit</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {spatialprobit}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#c.sarprobit'><p>Combine different SAR probit estimates into one</p></a></li>
<li><a href='#CKM'><p>Coleman, Katz, Menzel &quot;Innovation among Physicians&quot; dataset</p></a></li>
<li><a href='#coef.sarprobit'><p>Extract Model Coefficients</p></a></li>
<li><a href='#fitted'><p>Fitted values of spatial probit/Tobit models</p></a></li>
<li><a href='#Katrina'><p>New Orleans business recovery in the aftermath of Hurricane Katrina</p></a></li>
<li><a href='#kNearestNeighbors'><p>Build Spatial Weight Matrix from k Nearest Neighbors</p></a></li>
<li><a href='#LeSagePaceExperiment'><p>Replicate the LeSage and Pace (2009), section 10.1.5 experiment</p></a></li>
<li><a href='#logLik'><p>Log Likelihood for spatial probit models (SAR probit, SEM probit)</p></a></li>
<li><a href='#marginal.effects'><p>Marginal effects for spatial probit and Tobit models (SAR probit, SAR Tobit)</p></a></li>
<li><a href='#plot.sarprobit'>
<p>Plot Diagnostics for <code>sarprobit</code>, <code>semprobit</code> or <code>sartobit</code> objects</p></a></li>
<li><a href='#sar_eigs'>
<p>compute the eigenvalues for the spatial weight matrix W</p></a></li>
<li><a href='#sar_lndet'>
<p>Approximation of the log determinant <code class="reqn">\ln{|I_n - \rho W|}</code> of a spatial weight matrix</p></a></li>
<li><a href='#sarorderedprobit'><p>Bayesian estimation of the SAR ordered probit model</p></a></li>
<li><a href='#sarprobit'><p>Bayesian estimation of the SAR probit model</p></a></li>
<li><a href='#sartobit'><p>Bayesian estimation of the SAR Tobit model</p></a></li>
<li><a href='#semprobit'><p>Bayesian estimation of the SEM probit model</p></a></li>
<li><a href='#summary'><p>Print the results of the spatial probit/Tobit estimation via MCMC</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Version:</td>
<td>1.0.4</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-02-07</td>
</tr>
<tr>
<td>Title:</td>
<td>Spatial Probit Models</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 1.9.0), Matrix, spdep (&ge; 1.1-1), spatialreg (&ge; 1.1-1),
mvtnorm, tmvtnorm</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Suggests:</td>
<td>RUnit, testthat</td>
</tr>
<tr>
<td>Description:</td>
<td>A collection of methods for the Bayesian estimation of Spatial Probit, Spatial Ordered Probit and Spatial Tobit Models. Original implementations from the works of 'LeSage and Pace' (2009, ISBN: 1420064258) were ported and adjusted for R, as described in 'Wilhelm and de Matos' (2013) &lt;<a href="https://doi.org/10.32614%2FRJ-2013-013">doi:10.32614/RJ-2013-013</a>&gt;.  </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://www.r-project.org">https://www.r-project.org</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-02-08 17:40:30 UTC; stefan</td>
</tr>
<tr>
<td>Author:</td>
<td>Stefan Wilhelm [aut, cre],
  Miguel Godinho de Matos [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Stefan Wilhelm &lt;wilhelm@financial.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-02-09 08:00:07 UTC</td>
</tr>
</table>
<hr>
<h2 id='c.sarprobit'>Combine different SAR probit estimates into one</h2><span id='topic+c.sarprobit'></span>

<h3>Description</h3>

<p>This method combines SAR probit estimates into one SAR probit object,
e.g. when collecting the results of a parallel MCMC.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'sarprobit'
c(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="c.sarprobit_+3A_...">...</code></td>
<td>
<p>A vector of <code>sarprobit</code> objects.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>This functions returns an object of class <code>sarprobit</code>.
</p>


<h3>Author(s)</h3>

<p>Stefan Wilhelm &lt;wilhelm@financial.com&gt;
</p>


<h3>See Also</h3>

<p><code><a href="#topic+sarprobit">sarprobit</a></code> for SAR probit model fitting
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
## parallel estimation using mclapply() under Unix (will not work on Windows)
library(parallel)
mc &lt;- 2 # number of cores; set as appropriate to your hardware
run1 &lt;- function(...) sar_probit_mcmc(y, X, W, ndraw=500, burn.in=200, thinning=1)
system.time( {
## To make this reproducible:
set.seed(123, "L'Ecuyer")
sarprobit.res &lt;- do.call(c, mclapply(seq_len(mc), run1))
})
summary(sarprobit.res)


## parallel estimation using parLapply() under Windows
library(parallel)
ndraw &lt;- 1000  # the number of MCMC draws
mc &lt;- 4        # the number of cores; set as appropriate to your hardware

run1 &lt;- function(...) {
  args &lt;- list(...)
  library(spatialprobit)
  sar_probit_mcmc(y=args$y, X=args$X2, W=args$W, ndraw=args$ndraw, burn.in=100, thinning=1)
}

parallelEstimation &lt;- function(mc, ndraw, y, X, W) {
  cl &lt;- makeCluster(mc)
  ## To make this reproducible:
  clusterSetRNGStream(cl, 123)
  library(spatialprobit) # needed for c() method on master
  sarprobit.res &lt;- do.call(c, parLapply(cl, seq_len(mc), run1, y=y, X2=X, W=W, ndraw=ndraw/mc))
  stopCluster(cl)
  return(sarprobit.res)
}

# parallel estimation using 1, 2, 4 and 8 cores
system.time(p1 &lt;- parallelEstimation(mc=1, ndraw=5000, y=y, X=X, W=W))
system.time(p2 &lt;- parallelEstimation(mc=2, ndraw=5000, y=y, X=X, W=W))
system.time(p4 &lt;- parallelEstimation(mc=4, ndraw=5000, y=y, X=X, W=W))
system.time(p8 &lt;- parallelEstimation(mc=8, ndraw=5000, y=y, X=X, W=W))

## End(Not run)
</code></pre>

<hr>
<h2 id='CKM'>Coleman, Katz, Menzel &quot;Innovation among Physicians&quot; dataset</h2><span id='topic+CKM'></span><span id='topic+A1'></span><span id='topic+A2'></span><span id='topic+A3'></span><span id='topic+W1'></span><span id='topic+W2'></span><span id='topic+W3'></span>

<h3>Description</h3>

<p>The classic Coleman's Drug Adoption dataset &quot;Innovation among Physicians&quot;
for studying the information diffusion through social networks.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(CKM)</code></pre>


<h3>Format</h3>

<p>A data frame <code>CKM</code> with 246 observations on the following 13 variables.
</p>

<dl>
<dt><code>city</code></dt><dd><p>a numeric vector; City: 1 Peoria, 2 Bloomington, 3 Quincy, 4 Galesburg</p>
</dd>
<dt><code>adoption.date</code></dt><dd><p>an ordered factor with levels 
<code>November, 1953</code> &lt; <code>December, 1953</code> &lt; <code>January, 1954</code> &lt; 
<code>February, 1954</code> &lt; <code>March, 1954</code> &lt; <code>April, 1954</code> &lt; 
<code>May, 1954</code> &lt; <code>June, 1954</code> &lt; <code>July, 1954</code> &lt; 
<code>August, 1954</code> &lt; <code>September, 1954</code> &lt; <code>October, 1954</code> &lt; 
<code>November, 1954</code> &lt; <code>December, 1954</code> &lt; 
<code>December/January, 1954/1955</code> &lt; <code>January/February, 1955</code> &lt; 
<code>February, 1955</code> &lt; <code>no prescriptions found</code> &lt; 
<code>no prescription data obtained</code></p>
</dd>
<dt><code>med_sch_yr</code></dt><dd><p>years in practice</p>
</dd>
<dt><code>meetings</code></dt><dd><p>meetings attended</p>
</dd>
<dt><code>jours</code></dt><dd><p>journal subscriptions</p>
</dd>
<dt><code>free_time</code></dt><dd><p>free time activities</p>
</dd>
<dt><code>discuss</code></dt><dd><p>discussions</p>
</dd>
<dt><code>clubs</code></dt><dd><p>club memberships</p>
</dd>
<dt><code>friends</code></dt><dd><p>friends</p>
</dd>
<dt><code>community</code></dt><dd><p>time in the community</p>
</dd>
<dt><code>patients</code></dt><dd><p>patient load</p>
</dd>
<dt><code>proximity</code></dt><dd><p>physical proximity to other physicians</p>
</dd>
<dt><code>specialty</code></dt><dd><p>medical specialty</p>
</dd>
</dl>

<p>Three 246 <code class="reqn">\times</code> 246 binary peer matrices <code>A1</code>,<code>A2</code>,<code>A3</code> 
for three different social relationships/networks: &quot;Advice&quot;, &quot;Discussion&quot;, &quot;Friend&quot;.
</p>
<p>Three 246 <code class="reqn">\times</code> 246 spatial weight matrices <code>W1</code>, <code>W2</code> and <code>W3</code> 
from built from adjacency matrices <code>A1</code>,<code>A2</code>,<code>A3</code>.
</p>


<h3>Details</h3>

<p>The description of the data set from a UCI website (previous link is invalid now):
</p>
<p>This data set was prepared by Ron Burt. 
He dug out the 1966 data collected by Coleman, Katz and Menzel on medical innovation. 
They had collected data from physicians in four towns in Illinois, Peoria, 
Bloomington, Quincy and Galesburg. 
</p>
<p>They were concerned with the impact of network ties on the physicians' 
adoprion of a new drug, tetracycline. 
Three sociometric matrices were generated. 
One was based on the replies to a question, 
&quot;When you need information or advice about questions of therapy where do you usually turn?&quot; 
A second stemmed from the question 
&quot;And who are the three or four physicians with whom you most often find yourself discussing cases or therapy in the course of an ordinary week &ndash; last week for instance?&quot; 
And the third was simply 
&quot;Would you tell me the first names of your three friends whom you see most often socially?&quot;
</p>
<p>In addition, records of prescriptions were reviewed and a great many other questions were asked. 
In the CKM data I have included 13 items: city of practice, recorded date of tetracycline adoption date, 
years in practice, meetings attended, journal subscriptions, free time activities, discussions, club memberships, 
friends, time in the community, patient load, physical proximity to other physicians and medical specialty.
</p>
<p>The codes are:<br />
City (: 1 Peoria, 2 Bloomington, 3 Quincy, 4 Galesburg
</p>
<p>Adoption Date:
</p>

<table>
<tr>
 <td style="text-align: right;">
1 </td><td style="text-align: left;"> November, 1953 </td>
</tr>
<tr>
 <td style="text-align: right;">
2 </td><td style="text-align: left;"> December, 1953 </td>
</tr>
<tr>
 <td style="text-align: right;"> 
3 </td><td style="text-align: left;"> January, 1954 </td>
</tr>
<tr>
 <td style="text-align: right;"> 
4 </td><td style="text-align: left;"> February, 1954 </td>
</tr>
<tr>
 <td style="text-align: right;"> 
5 </td><td style="text-align: left;"> March, 1954 </td>
</tr>
<tr>
 <td style="text-align: right;"> 
6 </td><td style="text-align: left;"> April, 1954 </td>
</tr>
<tr>
 <td style="text-align: right;"> 
7 </td><td style="text-align: left;"> May, 1954 </td>
</tr>
<tr>
 <td style="text-align: right;"> 
8 </td><td style="text-align: left;"> June, 1954 </td>
</tr>
<tr>
 <td style="text-align: right;"> 
9 </td><td style="text-align: left;"> July, 1954 </td>
</tr>
<tr>
 <td style="text-align: right;"> 
10 </td><td style="text-align: left;"> August, 1954 </td>
</tr>
<tr>
 <td style="text-align: right;"> 
11 </td><td style="text-align: left;"> September, 1954 </td>
</tr>
<tr>
 <td style="text-align: right;"> 
12 </td><td style="text-align: left;"> October, 1954 </td>
</tr>
<tr>
 <td style="text-align: right;"> 
13 </td><td style="text-align: left;"> November, 1954 </td>
</tr>
<tr>
 <td style="text-align: right;"> 
14 </td><td style="text-align: left;"> December, 1954 </td>
</tr>
<tr>
 <td style="text-align: right;"> 
15 </td><td style="text-align: left;"> December/January, 1954/1955 </td>
</tr>
<tr>
 <td style="text-align: right;"> 
16 </td><td style="text-align: left;"> January/February, 1955 </td>
</tr>
<tr>
 <td style="text-align: right;"> 
17 </td><td style="text-align: left;"> February, 1955 </td>
</tr>
<tr>
 <td style="text-align: right;"> 
18 </td><td style="text-align: left;"> no prescriptions found </td>
</tr>
<tr>
 <td style="text-align: right;"> 
98 </td><td style="text-align: left;"> no prescription data obtained 
</td>
</tr>

</table>

<p>Year started in the profession
</p>

<table>
<tr>
 <td style="text-align: right;">
1 </td><td style="text-align: left;"> 1919 or before </td>
</tr>
<tr>
 <td style="text-align: right;"> 
2 </td><td style="text-align: left;"> 1920-1929 </td>
</tr>
<tr>
 <td style="text-align: right;"> 
3 </td><td style="text-align: left;"> 1930-1934 </td>
</tr>
<tr>
 <td style="text-align: right;"> 
4 </td><td style="text-align: left;"> 1935-1939 </td>
</tr>
<tr>
 <td style="text-align: right;"> 
5 </td><td style="text-align: left;"> 1940-1944 </td>
</tr>
<tr>
 <td style="text-align: right;"> 
6 </td><td style="text-align: left;"> 1945 or later </td>
</tr>
<tr>
 <td style="text-align: right;"> 
9 </td><td style="text-align: left;"> no answer 
</td>
</tr>

</table>

<p>Have you attended any national, regional or state conventions of professional 
societies during the last 12 months? [if yes] Which ones? 
</p>

<table>
<tr>
 <td style="text-align: right;">
0 </td><td style="text-align: left;"> none </td>
</tr>
<tr>
 <td style="text-align: right;"> 
1 </td><td style="text-align: left;"> only general meetings </td>
</tr>
<tr>
 <td style="text-align: right;"> 
2 </td><td style="text-align: left;"> specialty meetings </td>
</tr>
<tr>
 <td style="text-align: right;"> 
9 </td><td style="text-align: left;"> no answer </td>
</tr>
<tr>
 <td style="text-align: right;">
</td>
</tr>

</table>

<p>Which medical journals do you receive regularly?
</p>

<table>
<tr>
 <td style="text-align: right;"> 
1 </td><td style="text-align: left;"> two </td>
</tr>
<tr>
 <td style="text-align: right;"> 
2 </td><td style="text-align: left;"> three </td>
</tr>
<tr>
 <td style="text-align: right;"> 
3 </td><td style="text-align: left;"> four </td>
</tr>
<tr>
 <td style="text-align: right;"> 
4 </td><td style="text-align: left;"> five </td>
</tr>
<tr>
 <td style="text-align: right;"> 
5 </td><td style="text-align: left;"> six </td>
</tr>
<tr>
 <td style="text-align: right;"> 
6 </td><td style="text-align: left;"> seven </td>
</tr>
<tr>
 <td style="text-align: right;"> 
7 </td><td style="text-align: left;"> eight </td>
</tr>
<tr>
 <td style="text-align: right;"> 
8 </td><td style="text-align: left;"> nine or more </td>
</tr>
<tr>
 <td style="text-align: right;">
9 </td><td style="text-align: left;"> no answer 
</td>
</tr>

</table>

<p>With whom do you actually spend more of your free time &ndash; doctors or non-doctors? 
</p>

<table>
<tr>
 <td style="text-align: right;">
1 </td><td style="text-align: left;"> non-doctors </td>
</tr>
<tr>
 <td style="text-align: right;"> 
2 </td><td style="text-align: left;"> about evenly split between them </td>
</tr>
<tr>
 <td style="text-align: right;"> 
3 </td><td style="text-align: left;"> doctors </td>
</tr>
<tr>
 <td style="text-align: right;"> 
9 </td><td style="text-align: left;"> mssing; no answer, don't know 
</td>
</tr>

</table>

<p>When you are with other doctors socially, do you like to talk about medical matter? 
</p>

<table>
<tr>
 <td style="text-align: right;">
1 </td><td style="text-align: left;"> no </td>
</tr>
<tr>
 <td style="text-align: right;"> 
2 </td><td style="text-align: left;"> yes </td>
</tr>
<tr>
 <td style="text-align: right;"> 
3 </td><td style="text-align: left;"> don't care </td>
</tr>
<tr>
 <td style="text-align: right;"> 
9 </td><td style="text-align: left;"> missing; no answer, don't know 
</td>
</tr>

</table>

<p>Do you belong to any club or hobby composed mostly of doctors?
</p>

<table>
<tr>
 <td style="text-align: right;"> 
0 </td><td style="text-align: left;"> no </td>
</tr>
<tr>
 <td style="text-align: right;"> 
1 </td><td style="text-align: left;"> yes </td>
</tr>
<tr>
 <td style="text-align: right;"> 
9 </td><td style="text-align: left;"> no answer </td>
</tr>
<tr>
 <td style="text-align: right;">
</td>
</tr>

</table>
 
<p>Would you tell me who are your three friends whom you see most often socially? What is [their] occupation?
</p>

<table>
<tr>
 <td style="text-align: right;">
1 </td><td style="text-align: left;"> none are doctors </td>
</tr>
<tr>
 <td style="text-align: right;"> 
2 </td><td style="text-align: left;"> one is a doctor </td>
</tr>
<tr>
 <td style="text-align: right;"> 
3 </td><td style="text-align: left;"> two are doctors </td>
</tr>
<tr>
 <td style="text-align: right;"> 
4 </td><td style="text-align: left;"> three are doctors </td>
</tr>
<tr>
 <td style="text-align: right;"> 
9 </td><td style="text-align: left;"> no answer 
</td>
</tr>

</table>

<p>How long have you been practicing in this community? 
</p>

<table>
<tr>
 <td style="text-align: right;">
1 </td><td style="text-align: left;"> a year or less </td>
</tr>
<tr>
 <td style="text-align: right;"> 
2 </td><td style="text-align: left;"> more than a year, up to two years </td>
</tr>
<tr>
 <td style="text-align: right;"> 
3 </td><td style="text-align: left;"> more than two years, up to five years </td>
</tr>
<tr>
 <td style="text-align: right;"> 
4 </td><td style="text-align: left;"> more than five years, up to ten years </td>
</tr>
<tr>
 <td style="text-align: right;"> 
5 </td><td style="text-align: left;"> more than ten years, up to twenty years </td>
</tr>
<tr>
 <td style="text-align: right;"> 
6 </td><td style="text-align: left;"> more than twenty years </td>
</tr>
<tr>
 <td style="text-align: right;"> 
9 </td><td style="text-align: left;"> no answer 
</td>
</tr>

</table>

<p>About how many office visits would you say you have during the average week at this time of year?
</p>

<table>
<tr>
 <td style="text-align: right;">
1 </td><td style="text-align: left;"> 25 or less </td>
</tr>
<tr>
 <td style="text-align: right;"> 
2 </td><td style="text-align: left;"> 26-50 </td>
</tr>
<tr>
 <td style="text-align: right;"> 
3 </td><td style="text-align: left;"> 51-75 </td>
</tr>
<tr>
 <td style="text-align: right;"> 
4 </td><td style="text-align: left;"> 76-100 </td>
</tr>
<tr>
 <td style="text-align: right;"> 
5 </td><td style="text-align: left;"> 101-150 </td>
</tr>
<tr>
 <td style="text-align: right;"> 
6 </td><td style="text-align: left;"> 151 or more </td>
</tr>
<tr>
 <td style="text-align: right;">
9 </td><td style="text-align: left;"> missing; no answer, don't know
</td>
</tr>

</table>
 
<p>Are there other physicians in this building? 
[if yes] Other physicians in same office or with same waiting room? 
</p>

<table>
<tr>
 <td style="text-align: right;">
1 </td><td style="text-align: left;"> none in building </td>
</tr>
<tr>
 <td style="text-align: right;"> 
2 </td><td style="text-align: left;"> some in building, but none share his office or waiting room </td>
</tr>
<tr>
 <td style="text-align: right;"> 
3 </td><td style="text-align: left;"> some in building sharing his office or waiting room </td>
</tr>
<tr>
 <td style="text-align: right;"> 
4 </td><td style="text-align: left;"> some in building perhaps sharing his office or waiting room </td>
</tr>
<tr>
 <td style="text-align: right;"> 
9 </td><td style="text-align: left;"> no answer 
</td>
</tr>

</table>

<p>Do you specialize in any particular field of medicine? [if yes] What is it?
</p>

<table>
<tr>
 <td style="text-align: right;">
1 </td><td style="text-align: left;"> GP, general practitioner </td>
</tr>
<tr>
 <td style="text-align: right;"> 
2 </td><td style="text-align: left;"> internist </td>
</tr>
<tr>
 <td style="text-align: right;"> 
3 </td><td style="text-align: left;"> pediatrician </td>
</tr>
<tr>
 <td style="text-align: right;"> 
4 </td><td style="text-align: left;"> other specialty </td>
</tr>
<tr>
 <td style="text-align: right;"> 
9 </td><td style="text-align: left;"> no answer
</td>
</tr>

</table>



<h3>Source</h3>

<p>The data set had been reproduced from the now invalid <code>http://moreno.ss.uci.edu/data.html#ckm</code>
with the friendly permission of Prof. Lin Freeman.
</p>


<h3>References</h3>

<p>Burt, R. (1987). Social contagion and innovation: Cohesion versus structural equivalence. <em>American Journal of Sociology</em>, <b>92</b>, 1287&ndash;1335. 
</p>
<p>Coleman, James, Elihu Katz and Herbert Menzel (1957). The Diffusion of an Innovation Among Physicians, <em>Sociometry</em>, <b>20</b>, 253&ndash;270. 
</p>
<p>Coleman, J.S., E. Katz, and H. Menzel (1966). <em>Medical Innovation: A Diffusion Study</em>. New York: Bobbs Merrill. 
</p>
<p>Valente, T. W. (1995). <em>Network Models of the Diffusion of Innovations</em>. Cresskill, NJ: Hampton Press. 
</p>
<p>Van den Bulte, C. and G. L. Lilien. (2001). Medical Innovation Revisited: Social Contagion versus Marketing Effort, 
<em>American Journal of Sociology</em>, <b>106</b>, 1409&ndash;1435. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(CKM)
</code></pre>

<hr>
<h2 id='coef.sarprobit'>Extract Model Coefficients</h2><span id='topic+coef.sarprobit'></span><span id='topic+coefficients.sarprobit'></span><span id='topic+coef.semprobit'></span><span id='topic+coefficients.semprobit'></span><span id='topic+coef.sartobit'></span><span id='topic+coefficients.sartobit'></span>

<h3>Description</h3>

<p>coef is a generic function which extracts model coefficients 
from objects returned by modeling functions. coefficients is an alias for it.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'sarprobit'
coef(object, ...)
## S3 method for class 'sarprobit'
coefficients(object, ...)
## S3 method for class 'semprobit'
coef(object, ...)
## S3 method for class 'semprobit'
coefficients(object, ...)
## S3 method for class 'sartobit'
coef(object, ...)
## S3 method for class 'sartobit'
coefficients(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="coef.sarprobit_+3A_object">object</code></td>
<td>
<p>class <code>sarprobit</code>, <code>semprobit</code> or <code>sartobit</code> with model fits</p>
</td></tr>
<tr><td><code id="coef.sarprobit_+3A_...">...</code></td>
<td>
<p>Additional arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of named model coefficients
</p>


<h3>Author(s)</h3>

<p>Stefan Wilhelm &lt;wilhelm@financial.com&gt;
</p>

<hr>
<h2 id='fitted'>Fitted values of spatial probit/Tobit models</h2><span id='topic+fitted.sarprobit'></span><span id='topic+fitted.sarorderedprobit'></span><span id='topic+fitted.semprobit'></span><span id='topic+fitted.sartobit'></span>

<h3>Description</h3>

<p>Calculate fitted values of spatial probit/Tobit models. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'sarprobit'
fitted(object, ...)
## S3 method for class 'sarorderedprobit'
fitted(object, ...)
## S3 method for class 'semprobit'
fitted(object, ...)
## S3 method for class 'sartobit'
fitted(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fitted_+3A_object">object</code></td>
<td>
<p>a fitted model of class <code>sarprobit</code>,<code>sarorderedprobit</code>,<code>semprobit</code> or <code>sartobit</code></p>
</td></tr>
<tr><td><code id="fitted_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector of the fitted values. 
</p>


<h3>Author(s)</h3>

<p>Stefan Wilhelm &lt;wilhelm@financial.com&gt;
</p>

<hr>
<h2 id='Katrina'>New Orleans business recovery in the aftermath of Hurricane Katrina</h2><span id='topic+Katrina'></span><span id='topic+Katrina.raw'></span>

<h3>Description</h3>

<p>This dataset has been used in the LeSage et al. (2011) paper entitled 
&quot;New Orleans business recovery in the aftermath of Hurricane Katrina&quot;
to study the decisions of shop owners to reopen business after Hurricane Katrina. 
The dataset contains 673 observations on 3 streets in New Orleans 
and can be used to estimate the spatial probit models 
and to replicate the findings in the paper.
</p>


<h3>Usage</h3>

<pre><code class='language-R'> data(Katrina)
</code></pre>


<h3>Format</h3>

<p><code>Katrina.raw</code> is a data frame with 673 observations on the following 15 variables.
</p>

<dl>
<dt><code>code</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>long</code></dt><dd><p>longitude coordinate of store</p>
</dd>
<dt><code>lat</code></dt><dd><p>latitude coordinate of store</p>
</dd>
<dt><code>street1</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>medinc</code></dt><dd><p>median income</p>
</dd>
<dt><code>perinc</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>elevation</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>flood</code></dt><dd><p>flood depth (measured in feet)</p>
</dd>
<dt><code>owntype</code></dt><dd><p>type of store ownership: &quot;sole proprietorship&quot; vs. &quot;local chain&quot; vs. &quot;national chain&quot;</p>
</dd>
<dt><code>sesstatus</code></dt><dd><p>socio-economic status of clientele (1-5): 1-2 = low status customers, 3 = middle, 4-5 = high status customers</p>
</dd>
<dt><code>sizeemp</code></dt><dd><p>&quot;small size&quot; vs. &quot;medium size&quot; vs. &quot;large size&quot; firms</p>
</dd>
<dt><code>openstatus1</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>openstatus2</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>days</code></dt><dd><p>days to reopen business</p>
</dd>
<dt><code>street</code></dt><dd><p>1=Magazine Street, 2=Carrollton Avenue, 3=St. Claude Avenue</p>
</dd>
</dl>

<p><code>Katrina</code> is a data frame with 673 observations on the following 13 variables.
</p>

<dl>
<dt><code>long</code></dt><dd><p>longitude coordinate of store</p>
</dd>
<dt><code>lat</code></dt><dd><p>latitude coordinate of store</p>
</dd>
<dt><code>flood_depth</code></dt><dd><p>flood depth (measured in feet)</p>
</dd>
<dt><code>log_medinc</code></dt><dd><p>log median income</p>
</dd>
<dt><code>small_size</code></dt><dd><p>binary variable for &quot;small size&quot; firms</p>
</dd>
<dt><code>large_size</code></dt><dd><p>binary variable for &quot;large size&quot; firms</p>
</dd>
<dt><code>low_status_customers</code></dt><dd><p>binary variable for low socio-economic status of clientele</p>
</dd>
<dt><code>high_status_customers</code></dt><dd><p>binary variable for high socio-economic status of clientele</p>
</dd>
<dt><code>owntype_sole_proprietor</code></dt><dd><p>a binary variable indicating &quot;sole proprietor&quot; ownership type</p>
</dd>
<dt><code>owntype_national_chain</code></dt><dd><p>a binary variable indicating &quot;national_chain&quot; ownership type</p>
</dd>
<dt><code>y1</code></dt><dd><p>reopening status in the very short period 0-3 months; 1=reopened, 0=not reopened</p>
</dd>
<dt><code>y2</code></dt><dd><p>reopening status in the period 0-6 months; 1=reopened, 0=not reopened</p>
</dd>
<dt><code>y3</code></dt><dd><p>reopening status in the period 0-12 months; 1=reopened, 0=not reopened</p>
</dd>
</dl>



<h3>Details</h3>

<p>The <code>Katrina.raw</code> dataset contains the data found on the website
before some of the variables are recoded. For example, the 
socio-economic status of clientele is coded as 1-5 in the raw data, 
but only 3 levels will be used in estimation: 
1-2 = low status customers, 3 = middle, 4-5 = high status customers. Hence,
with &quot;middle&quot; as the reference category, 
<code>Katrina</code> contains 2 dummy variables for low status customers 
and high status customers.
</p>
<p>The dataset <code>Katrina</code> is the result of these recoding operations and can be
directly used for model estimation.
</p>


<h3>Note</h3>

<p>When definining the reopening status variables <code>y1</code> (0-3 months), <code>y2</code> (0-6 months),
and <code>y3</code> (0-12 months) from the <code>days</code> variable, the Matlab code ignores the seven cases
where <code>days=90</code>. To be consistent with the number of cases in the paper,
we define <code>y1</code>,<code>y2</code>,<code>y3</code> in the same way: 
<code>y1=sum(days &lt; 90)</code>, <code>y2=sum(days &lt; 180 &amp; days != 90)</code>, 
<code>y3=sum(days &lt; 365 &amp; days != 90)</code>.
So this is not a bug, its a feature.
</p>


<h3>Source</h3>

<p>The raw data was obtained from the Journal of the Royal Statistical Society dataset website
(was: <code>https://rss.onlinelibrary.wiley.com/pb-assets/hub-assets/rss/Datasets/</code>)
and brought to RData format.
</p>


<h3>References</h3>

<p>J. P. LeSage, R. K. Pace, N. Lam, R. Campanella and X. Liu  (2011),
New Orleans business recovery in the aftermath of Hurricane Katrina
<em>Journal of the Royal Statistical Society A</em>, <b>174</b>, 1007&ndash;1027
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(Katrina)
attach(Katrina)
table(y1) # 300 of the 673 firms reopened during 0-3 months horizon, p.1016
table(y2) # 425 of the 673 firms reopened during 0-6 months horizon, p.1016
table(y3) # 478 of the 673 firms reopened during 0-12 months horizon, p.1016
detach(Katrina)

## Not run: 
# plot observations in New Orleans map; Google requires an API key; see `ggmap::register_google()`
if (require(ggmap)) {
  qmplot(long, lat, data = Katrina, maptype="roadmap", source="google")
}

## End(Not run)


# replicate LeSage et al. (2011), Table 3, p.1017
require(spatialreg)
 
# (a) 0-3 months time horizon
# LeSage et al. (2011) use k=11 nearest neighbors in this case
nb &lt;- knn2nb(knearneigh(cbind(Katrina$lat, Katrina$long), k=11))
listw &lt;- nb2listw(nb, style="W")
W1 &lt;- as(as_dgRMatrix_listw(listw), "CsparseMatrix")

# Note: cannot replicate (a) 0-3 months time horizon model as of February 2024  
#fit1 &lt;- sarprobit(y1 ~ flood_depth + log_medinc + small_size + large_size +
#  low_status_customers +  high_status_customers + 
#  owntype_sole_proprietor + owntype_national_chain, 
#  W=W1, data=Katrina, ndraw=600, burn.in = 100, showProgress=FALSE)
#summary(fit1)
  
# (b) 0-6 months time horizon
# LeSage et al. (2011) use k=15 nearest neighbors
nb &lt;- knn2nb(knearneigh(cbind(Katrina$lat, Katrina$long), k=15))
listw &lt;- nb2listw(nb, style="W")
W2 &lt;- as(as_dgRMatrix_listw(listw), "CsparseMatrix")

fit2 &lt;- sarprobit(y2 ~ flood_depth + log_medinc + small_size + large_size +
  low_status_customers + high_status_customers + 
  owntype_sole_proprietor + owntype_national_chain, 
  W=W2, data=Katrina, ndraw=600, burn.in = 100, showProgress=FALSE)
summary(fit2)  

# (c) 0-12 months time horizon
# LeSage et al. (2011) use k=15 nearest neighbors as in 0-6 months
W3 &lt;- W2
fit3 &lt;- sarprobit(y3 ~ flood_depth + log_medinc + small_size + large_size +
  low_status_customers + high_status_customers + 
  owntype_sole_proprietor + owntype_national_chain, 
  W=W3, data=Katrina, ndraw=600, burn.in = 100, showProgress=FALSE)
summary(fit3)

# replicate LeSage et al. (2011), Table 4, p.1018
# SAR probit model effects estimates for the 0-3-month time horizon
# impacts(fit1)  

# replicate LeSage et al. (2011), Table 5, p.1019
# SAR probit model effects estimates for the 0-6-month time horizon
impacts(fit2)

# replicate LeSage et al. (2011), Table 6, p.1020
# SAR probit model effects estimates for the 0-12-month time horizon
impacts(fit3)

</code></pre>

<hr>
<h2 id='kNearestNeighbors'>Build Spatial Weight Matrix from k Nearest Neighbors</h2><span id='topic+kNearestNeighbors'></span>

<h3>Description</h3>

<p>Build a spatial weight matrix W using the k nearest neighbors of (x, y) coordinates 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>kNearestNeighbors(x, y, k = 6)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="kNearestNeighbors_+3A_x">x</code></td>
<td>
<p>x coordinate</p>
</td></tr>
<tr><td><code id="kNearestNeighbors_+3A_y">y</code></td>
<td>
<p>y coordinate</p>
</td></tr>
<tr><td><code id="kNearestNeighbors_+3A_k">k</code></td>
<td>
<p>number of nearest neighbors</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Determine the k nearest neighbors for a set of n points represented by (x, y) 
coordinates and build a spatial weight matrix W (n <code class="reqn">\times</code> n).
W will be a sparse matrix representation and row-standardised.
</p>
<p>This method is a convenience method for quickly creating a spatial weights matrix based
on planar coordinates. More ways to create W are 
available in <code><a href="spdep.html#topic+knearneigh">knearneigh</a></code> of package <code>spdep</code>.
</p>


<h3>Value</h3>

<p>The method returns a sparse spatial weight matrix W with dimension 
(n <code class="reqn">\times</code> n) and <code>k</code> non-zero entries per row 
which represent the <code>k</code> nearest neighbors.
</p>


<h3>Author(s)</h3>

<p>Stefan Wilhelm &lt;wilhelm@financial.com&gt;
</p>


<h3>See Also</h3>

<p><code><a href="spdep.html#topic+nb2listw">nb2listw</a></code> and <code><a href="spdep.html#topic+knearneigh">knearneigh</a></code>
for computation of neighbors lists, spatial weights and standardisation.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>require(Matrix)
# build spatial weight matrix W from random (x,y) coordinates
W &lt;- kNearestNeighbors(x=rnorm(100), y=rnorm(100), k=6)
image(W, main="spatial weight matrix W")
</code></pre>

<hr>
<h2 id='LeSagePaceExperiment'>Replicate the LeSage and Pace (2009), section 10.1.5 experiment</h2><span id='topic+LeSagePaceExperiment'></span>

<h3>Description</h3>

<p>This method replicates the experiment from LeSage and Pace (2009), section 10.1.5.
It first generates data from a SAR probit model and then estimates the model with our implementation. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>LeSagePaceExperiment(n = 400, beta = c(0, 1, -1), rho = 0.75, ndraw = 1000, 
 burn.in = 200, thinning = 1, m = 10, computeMarginalEffects=TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="LeSagePaceExperiment_+3A_n">n</code></td>
<td>
<p>sample size</p>
</td></tr>
<tr><td><code id="LeSagePaceExperiment_+3A_beta">beta</code></td>
<td>
<p>parameter vector</p>
</td></tr>
<tr><td><code id="LeSagePaceExperiment_+3A_rho">rho</code></td>
<td>
<p>spatial dependence parameter</p>
</td></tr>
<tr><td><code id="LeSagePaceExperiment_+3A_ndraw">ndraw</code></td>
<td>
<p>number of draws</p>
</td></tr>
<tr><td><code id="LeSagePaceExperiment_+3A_burn.in">burn.in</code></td>
<td>
<p>number of burn-in samples</p>
</td></tr>
<tr><td><code id="LeSagePaceExperiment_+3A_thinning">thinning</code></td>
<td>
<p>thinning parameter</p>
</td></tr>
<tr><td><code id="LeSagePaceExperiment_+3A_m">m</code></td>
<td>
<p>Gibbs sampler burn-in size for drawing from the truncated multinormal distribution</p>
</td></tr>
<tr><td><code id="LeSagePaceExperiment_+3A_computemarginaleffects">computeMarginalEffects</code></td>
<td>
<p>Should marginal effects be computed?</p>
</td></tr>
<tr><td><code id="LeSagePaceExperiment_+3A_...">...</code></td>
<td>
<p>Additional parameters to be passed to <code><a href="#topic+sar_probit_mcmc">sar_probit_mcmc</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a structure of class <code>sarprobit</code>
</p>


<h3>Author(s)</h3>

<p>Stefan Wilhelm &lt;wilhelm@financial.com&gt;
</p>


<h3>References</h3>

<p>LeSage, J. and Pace, R. K. (2009), <em>Introduction to Spatial Econometrics</em>, CRC Press, section 10.1.5
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# LeSage/Pace(2009), Table 10.1, p.291: n=400, m=10
res1 &lt;- LeSagePaceExperiment(n=400, beta=c(0,1,-1), rho=0.75, 
 ndraw=1000, burn.in=200, thinning=1, m=10)
res1$time
res1$coefficients
summary(res1)

# LeSage/Pace(2009), Table 10.1, p.291: n=1000, m=1
res2 &lt;- LeSagePaceExperiment(n=1000, beta=c(0,1,-1), rho=0.75, 
  ndraw=1000, burn.in=200, thinning=1, m=1)
res2$time
res2$coefficients
summary(res2)

# LeSage/Pace(2009), Table 10.2, p.291: n=400, m=1
res400.1 &lt;- LeSagePaceExperiment(n=400, beta=c(0,1,-1), rho=0.75, 
  ndraw=1000, burn.in=200, thinning=1, m=1)
summary(res400.1)

# LeSage/Pace(2009), Table 10.2, p.291: n=400, m=2
res400.2 &lt;- LeSagePaceExperiment(n=400, beta=c(0,1,-1), rho=0.75, 
  ndraw=1000, burn.in=200, thinning=1, m=2)
summary(res400.2)

# LeSage/Pace(2009), Table 10.2, p.291: n=400, m=10
res400.10 &lt;- LeSagePaceExperiment(n=400, beta=c(0,1,-1), rho=0.75, 
  ndraw=1000, burn.in=200, thinning=1, m=10)
summary(res400.10)

</code></pre>

<hr>
<h2 id='logLik'>Log Likelihood for spatial probit models (SAR probit, SEM probit)</h2><span id='topic+logLik.sarprobit'></span><span id='topic+logLik.semprobit'></span>

<h3>Description</h3>

<p>The functions return the log likelihood for the spatial autoregressive probit model
(SAR probit, spatial lag model) and the spatial error model probit (SEM probit).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'sarprobit'
logLik(object, ...)
## S3 method for class 'semprobit'
logLik(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="logLik_+3A_object">object</code></td>
<td>
<p>a fitted <code>sarprobit</code> or <code>semprobit</code> object</p>
</td></tr>
<tr><td><code id="logLik_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods</p>
</td></tr>
</table>


<h3>Value</h3>

<p>returns an object of class <code>logLik</code>
</p>


<h3>Author(s)</h3>

<p>Stefan Wilhelm &lt;wilhelm@financial.com&gt;
</p>


<h3>See Also</h3>

<p><code><a href="spdep.html#topic+logLik.sarlm">logLik.sarlm</a></code>
</p>

<hr>
<h2 id='marginal.effects'>Marginal effects for spatial probit and Tobit models (SAR probit, SAR Tobit)</h2><span id='topic+marginal.effects'></span><span id='topic+marginal.effects.sarprobit'></span><span id='topic+marginal.effects.sartobit'></span><span id='topic+impacts.sarprobit'></span><span id='topic+impacts.sartobit'></span>

<h3>Description</h3>

<p>Estimate marginal effects (average direct, indirect and total impacts)
for the SAR probit and SAR Tobit model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'sarprobit'
marginal.effects(object, o = 100, ...)
## S3 method for class 'sartobit'
marginal.effects(object, o = 100, ...)
## S3 method for class 'sarprobit'
impacts(obj, file=NULL, 
  digits = max(3, getOption("digits")-3), ...)
## S3 method for class 'sartobit'
impacts(obj, file=NULL, 
  digits = max(3, getOption("digits")-3), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="marginal.effects_+3A_object">object</code></td>
<td>
<p>Estimated model of class <code>sarprobit</code> or <code>sartobit</code></p>
</td></tr>
<tr><td><code id="marginal.effects_+3A_obj">obj</code></td>
<td>
<p>Estimated model of class <code>sarprobit</code> or <code>sartobit</code></p>
</td></tr>
<tr><td><code id="marginal.effects_+3A_o">o</code></td>
<td>
<p>maximum value for the power <code class="reqn">tr(W^i), i=1,...,o</code> to be estimated</p>
</td></tr>
<tr><td><code id="marginal.effects_+3A_digits">digits</code></td>
<td>
<p>number of digits for printing</p>
</td></tr>
<tr><td><code id="marginal.effects_+3A_file">file</code></td>
<td>
<p>Output to file or console</p>
</td></tr>
<tr><td><code id="marginal.effects_+3A_...">...</code></td>
<td>
<p>additional parameters</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>impacts()</code> will extract and print the marginal effects from a fitted model,
while <code>marginal.effects(x)</code> will estimate the marginal effects anew for a fitted
model.
</p>
<p>In spatial models, a change in some explanatory variable <code class="reqn">x_{ir}</code> for observation <code class="reqn">i</code> 
will not only affect the observations <code class="reqn">y_i</code> directly (direct impact), 
but also affect neighboring observations <code class="reqn">y_j</code> (indirect impact). 
These impacts potentially also include feedback loops from observation 
<code class="reqn">i</code> to observation <code class="reqn">j</code> and back to <code class="reqn">i</code>. 
(see LeSage (2009), section 2.7 for interpreting parameter estimates in spatial models).
</p>
<p>For the <code class="reqn">r</code>-th non-constant explanatory variable, 
let <code class="reqn">S_r(W)</code> be the <code class="reqn">n \times n</code> matrix 
that captures the impacts from observation <code class="reqn">i</code> to <code class="reqn">j</code>.
</p>
<p>The direct impact of a change in <code class="reqn">x_{ir}</code> on its own observation <code class="reqn">y_i</code> can be written as
</p>
<p style="text-align: center;"><code class="reqn">
  \frac{\partial y_i}{\partial x_{ir}} = S_r(W)_{ii}
</code>
</p>
 
<p>and the indirect impact from observation <code class="reqn">j</code> to observation <code class="reqn">i</code> as
</p>
<p style="text-align: center;"><code class="reqn">
  \frac{\partial y_i}{\partial x_{jr}} = S_r(W)_{ij}
</code>
</p>
<p>.
</p>
<p>LeSage(2009) proposed summary measures for direct, indirect and total effects, 
e.g. averaged direct impacts across all <code class="reqn">n</code> observations.
See LeSage(2009), section 5.6.2., p.149/150 for marginal effects estimation in general spatial models
and section 10.1.6, p.293 for marginal effects in SAR probit models.
</p>
<p>We implement these three summary measures:
</p>

<ol>
<li><p> average direct impacts:   
</p>
<p style="text-align: center;"><code class="reqn">M_r(D) = \bar{S_r(W)_{ii}} = n^{-1} tr(S_r(W))</code>
</p>

</li>
<li><p> average total impacts:    
</p>
<p style="text-align: center;"><code class="reqn">M_r(T) = n^{-1} 1'_n S_r(W) 1_n</code>
</p>

</li>
<li><p> average indirect impacts: 
</p>
<p style="text-align: center;"><code class="reqn">M_r(I) = M_r(T) - M_r(D)</code>
</p>

</li></ol>

<p>The average direct impact is the average of the diagonal elements, the average total
impacts is the mean of the row (column) sums.
</p>
<p>For the average direct impacts <code class="reqn">M_r(D)</code>, 
there are efficient approaches available, see LeSage (2009), chapter 4, pp.114/115.
</p>
<p>The computation of the average total effects <code class="reqn">M_r(T)</code> and hence 
also the average indirect effects <code class="reqn">M_r(I)</code> are more subtle, 
as <code class="reqn">S_r(W)</code> is a dense <code class="reqn">n \times n</code> matrix.
In the LeSage Spatial Econometrics Toolbox for MATLAB (March 2010), 
the implementation in <code>sarp_g</code> computes the matrix inverse of <code class="reqn">S= (I_n -  \rho W)</code>
which all the negative consequences for large n.
We implemented <code class="reqn">n^{-1} 1'_n S_r(W) 1_n</code> via a QR decomposition of 
<code class="reqn">S = (I_n -  \rho W)</code> (already available from a previous step) and solving a linear equation, 
which is less costly and will work better for large <code class="reqn">n</code>.
</p>
<p><b>SAR probit model</b><br />
</p>
<p>Specifically, for the SAR probit model the <code class="reqn">n \times n</code> matrix of marginal effects is
</p>
<p style="text-align: center;"><code class="reqn">
  S_r(W) = \frac{\partial E[y | x_r]}{\partial x_{r}'} = \phi\left((I_n -  \rho W)^{-1} \bar{x}_r \beta_r \right) \odot (I_n -  \rho W)^{-1} I_n \beta_r 
</code>
</p>

<p><b>SAR Tobit model</b><br />
</p>
<p>Specifically, for the SAR Tobit model the <code class="reqn">n \times n</code> matrix of marginal effects is
</p>
<p style="text-align: center;"><code class="reqn">
  S_r(W) = \frac{\partial E[y | x_r]}{\partial x_{r}'} = \Phi\left((I_n -  \rho W)^{-1} \bar{x}_r \beta_r / \sigma \right) \odot (I_n -  \rho W)^{-1} I_n \beta_r 
</code>
</p>



<h3>Value</h3>

<p>This function returns a list with 6 elements: 'direct' for direct effects, 'indirect' for indirect effects, 
'total' for total effects, and 'summary_direct', 'summary_indirect', 'summary_total' for the summary of direct, indirect and total effects.
</p>


<h3>Warning</h3>

<p>1. Although the direct impacts can be efficiently estimated, the computation
of the indirect effects require the inversion of a <code class="reqn">n \times n</code> matrix
and will break down for large <code class="reqn">n</code>.
</p>
<p>2. <code class="reqn">tr(W^i)</code> is determined with simulation, 
so different calls to this method will produce different estimates.
</p>


<h3>Author(s)</h3>

<p>Stefan Wilhelm &lt;wilhelm@financial.com&gt;
</p>


<h3>References</h3>

<p>LeSage, J. and Pace, R. K. (2009), <em>Introduction to Spatial Econometrics</em>, CRC Press 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+marginal.effects.sartobit">marginal.effects.sartobit</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
require(spatialprobit)

# number of observations
n &lt;- 100

# true parameters
beta &lt;- c(0, 1, -1)
rho &lt;- 0.75

# design matrix with two standard normal variates as "covariates"
X &lt;- cbind(intercept=1, x=rnorm(n), y=rnorm(n))

# sparse identity matrix
I_n &lt;- sparseMatrix(i=1:n, j=1:n, x=1)

# number of nearest neighbors in spatial weight matrix W
m &lt;- 6

# spatial weight matrix with m=6 nearest neighbors
# W must not have non-zeros in the main diagonal!
W &lt;- kNearestNeighbors(x = rnorm(n), y = rnorm(n), k = m)

# innovations
eps &lt;- rnorm(n=n, mean=0, sd=1)

# generate data from model 
S &lt;- I_n - rho * W
z &lt;- solve(qr(S), X %*% beta + eps)
y &lt;- as.vector(z &gt;= 0)  # 0 or 1, FALSE or TRUE

# estimate SAR probit model
set.seed(12345)
sarprobit.fit1 &lt;- sar_probit_mcmc(y, X, W, ndraw=500, burn.in=100, 
  thinning=1, prior=NULL, computeMarginalEffects=TRUE)
summary(sarprobit.fit1)

# print impacts
impacts(sarprobit.fit1)

################################################################################
#
# Example from LeSage/Pace (2009), section 10.3.1, p. 302-304
#
################################################################################

# Value of "a" is not stated in book! 
# Assuming a=-1 which gives approx. 50% censoring
 library(spatialprobit)

a &lt;- -1   # control degree of censored observation
n &lt;- 1000
rho &lt;- 0.7
beta &lt;- c(0, 2)
sige &lt;- 0.5
I_n &lt;- sparseMatrix(i=1:n, j=1:n, x=1)
x &lt;- runif(n, a, 1)
X &lt;- cbind(1, x)
eps &lt;- rnorm(n, sd=sqrt(sige))
param &lt;- c(beta, sige, rho)

# random locational coordinates and 6 nearest neighbors
lat &lt;- rnorm(n)
long &lt;- rnorm(n)
W &lt;- kNearestNeighbors(lat, long, k=6)

y &lt;- as.double(solve(I_n - rho * W) %*% (X %*% beta + eps))
table(y &gt; 0)

# set negative values to zero to reflect sample truncation
ind &lt;- which(y &lt;=0)
y[ind] &lt;- 0

# Fit SAR Tobit (with approx. 50% censored observations)
fit_sartobit &lt;- sartobit(y ~ x, W, ndraw=1000, burn.in=200, 
  computeMarginalEffects=TRUE, showProgress=TRUE)

# print impacts
impacts(fit_sartobit)

</code></pre>

<hr>
<h2 id='plot.sarprobit'>
Plot Diagnostics for <code>sarprobit</code>, <code>semprobit</code> or <code>sartobit</code> objects
</h2><span id='topic+plot.sarprobit'></span><span id='topic+plot.semprobit'></span><span id='topic+plot.sartobit'></span>

<h3>Description</h3>

<p>Three plots (selectable by which) are currently available:
MCMC trace plots, autocorrelation plots and posterior density plots.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'sarprobit'
plot(x, 
which = c(1, 2, 3), 
ask = prod(par("mfcol")) &lt; length(which) &amp;&amp; dev.interactive(),
...,
trueparam = NULL)

## S3 method for class 'semprobit'
plot(x, 
which = c(1, 2, 3), 
ask = prod(par("mfcol")) &lt; length(which) &amp;&amp; dev.interactive(),
...,
trueparam = NULL)

## S3 method for class 'sartobit'
plot(x, 
which = c(1, 2, 3), 
ask = prod(par("mfcol")) &lt; length(which) &amp;&amp; dev.interactive(),
...,
trueparam = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.sarprobit_+3A_x">x</code></td>
<td>
<p>a <code>sarprobit</code> or <code>semprobit</code> object</p>
</td></tr>
<tr><td><code id="plot.sarprobit_+3A_which">which</code></td>
<td>
<p>if a subset of the plots is required, specify a subset of the numbers 1:3.</p>
</td></tr>
<tr><td><code id="plot.sarprobit_+3A_ask">ask</code></td>
<td>
<p>logical; if TRUE, the user is asked before each plot, see <code>par(ask=.)</code>.</p>
</td></tr>
<tr><td><code id="plot.sarprobit_+3A_...">...</code></td>
<td>
<p>other parameters to be passed through to plotting functions.</p>
</td></tr>
<tr><td><code id="plot.sarprobit_+3A_trueparam">trueparam</code></td>
<td>
<p>a vector of &quot;true&quot; parameter values to be marked as vertical lines in posterior density plot</p>
</td></tr>
</table>


<h3>Value</h3>

<p>This function does not return any values.
</p>


<h3>Author(s)</h3>

<p>Stefan Wilhelm &lt;wilhelm@financial.com&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(Matrix)
set.seed(2)

# number of observations
n &lt;- 100

# true parameters
beta &lt;- c(0, 1, -1)
rho &lt;- 0.75

# design matrix with two standard normal variates as "covariates"
X &lt;- cbind(intercept=1, x=rnorm(n), y=rnorm(n))

# sparse identity matrix
I_n &lt;- sparseMatrix(i=1:n, j=1:n, x=1)

# number of nearest neighbors in spatial weight matrix W
m &lt;- 6

# spatial weight matrix with m=6 nearest neighbors
# W must not have non-zeros in the main diagonal!
lat &lt;- rnorm(n)
long &lt;- rnorm(n)
W &lt;- kNearestNeighbors(lat, long, k=6)

# innovations
eps &lt;- rnorm(n=n, mean=0, sd=1)

# generate data from model 
S &lt;- I_n - rho * W
z &lt;- solve(qr(S), X %*% beta + eps)
y &lt;- as.vector(z &gt;= 0)  # 0 or 1, FALSE or TRUE

# estimate SAR probit model
fit1 &lt;- sar_probit_mcmc(y, X, W, ndraw=100, thinning=1, prior=NULL)
plot(fit1, which=c(1,3), trueparam = c(beta, rho))

</code></pre>

<hr>
<h2 id='sar_eigs'>
compute the eigenvalues for the spatial weight matrix W
</h2><span id='topic+sar_eigs'></span>

<h3>Description</h3>

<p>compute the eigenvalues <code class="reqn">\lambda</code> for the spatial weight matrix <code class="reqn">W</code> and lower and upper bound
for parameter <code class="reqn">\rho</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sar_eigs(eflag, W)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sar_eigs_+3A_eflag">eflag</code></td>
<td>
<p>if eflag==1, then eigen values
</p>
</td></tr>
<tr><td><code id="sar_eigs_+3A_w">W</code></td>
<td>
<p>spatial weight matrix</p>
</td></tr>
</table>


<h3>Value</h3>

<p>function returns a list of
</p>
<table>
<tr><td><code>rmin</code></td>
<td>
<p>minimum value for <code class="reqn">\rho</code>. if eflag==1, then <code class="reqn">1/\lambda_{min}</code> , else -1</p>
</td></tr>
<tr><td><code>rmax</code></td>
<td>
<p>maximum value for <code class="reqn">\rho</code>. Always 1.</p>
</td></tr>
<tr><td><code>time</code></td>
<td>
<p>execution time</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>James P. LeSage, Adapted to R by Miguel Godinho de Matos &lt;miguelgodinhomatos@cmu.edu&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(123)
# sparse matrix representation for spatial weight matrix W (d x d) 
# and m nearest neighbors
d &lt;- 100
m &lt;- 6
W &lt;- sparseMatrix(i=rep(1:d, each=m), 
  j=replicate(d, sample(x=1:d, size=m, replace=FALSE)), x=1/m, dims=c(d, d))
sar_eigs(eflag=1, W)    
</code></pre>

<hr>
<h2 id='sar_lndet'>
Approximation of the log determinant <code class="reqn">\ln{|I_n - \rho W|}</code> of a spatial weight matrix 
</h2><span id='topic+sar_lndet'></span><span id='topic+lndetfull'></span><span id='topic+lndetChebyshev'></span>

<h3>Description</h3>

<p>Compute the log determinant <code class="reqn">\ln{|I_n - \rho W|}</code> of a 
spatial weight matrix W
using either the exact approach, or using some approximations like 
the Chebyshev log determinant approximation or Pace and Barry approximation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sar_lndet(ldetflag, W, rmin, rmax)
lndetfull(W, rmin, rmax)
lndetChebyshev(W, rmin, rmax)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sar_lndet_+3A_ldetflag">ldetflag</code></td>
<td>
<p>flag to compute the exact or approximate log-determinant (Chebychev approximation, Pace and Barry approximation). See details.</p>
</td></tr>
<tr><td><code id="sar_lndet_+3A_w">W</code></td>
<td>
<p>spatial weight matrix</p>
</td></tr>
<tr><td><code id="sar_lndet_+3A_rmin">rmin</code></td>
<td>
<p>minimum eigen value</p>
</td></tr>
<tr><td><code id="sar_lndet_+3A_rmax">rmax</code></td>
<td>
<p>maximum eigen value</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This method will no longer provide its own implementation and 
will use the already existing methods in the package <span class="pkg">spatialreg</span> (<a href="spatialreg.html#topic+do_ldet">do_ldet</a>).
</p>
<p><code>ldetflag=0</code> will compute the exact log-determinant at some gridpoints, whereas
<code>ldetflag=1</code> will compute the Chebyshev log-determinant approximation.
<code>ldetflag=2</code> will compute the Barry and Pace (1999) Monte Carlo approximation 
of the log-determinant.
</p>
<p><b>Exact log-determinant:</b><br />
The exact log determinant <code class="reqn">\ln|I_n - \rho W|</code> 
is evaluated on a grid from <code class="reqn">\rho=-1,...,+1</code>. The gridpoints
are then approximated by a spline function.
</p>
<p><b>Chebychev approximation:</b><br />
This option provides the Chebyshev log-determinant approximation as proposed 
by Pace and LeSage (2004). The implementation is faster than the full 
log-determinant method.
</p>


<h3>Value</h3>

<table>
<tr><td><code>detval</code></td>
<td>
<p>a 2-column <code>Matrix</code> with gridpoints for rho from <code>rmin</code>,...,<code>rmax</code> and corresponding log-determinant</p>
</td></tr>
<tr><td><code>time</code></td>
<td>
<p>execution time</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>James P. LeSage, Adapted to R by Miguel Godinho de Matos &lt;miguelgodinhomatos@cmu.edu&gt;
</p>


<h3>References</h3>

<p>Pace, R. K. and Barry, R. (1997), Quick Computation of Spatial Autoregressive Estimators, <em>Geographical Analysis</em>, <b>29</b>, 232&ndash;247
</p>
<p>R. Barry and R. K. Pace (1999) A Monte Carlo Estimator of the Log Determinant of Large Sparse Matrices, <em>Linear Algebra and its Applications</em>, <b>289</b>, 41&ndash;54.
</p>
<p>Pace, R. K. and LeSage, J. (2004), Chebyshev Approximation of log-determinants of spatial weight matrices, <em>Computational Statistics and Data Analysis</em>, <b>45</b>, 179&ndash;196.
</p>
<p>LeSage, J. and Pace, R. K. (2009), <em>Introduction to Spatial Econometrics</em>, CRC Press, chapter 4 
</p>


<h3>See Also</h3>

<p><a href="spatialreg.html#topic+do_ldet">do_ldet</a> for computation of log-determinants
</p>


<h3>Examples</h3>

<pre><code class='language-R'>require(Matrix)

# sparse matrix representation for spatial weight matrix W (d x d) 
# and m nearest neighbors
d &lt;- 10
m &lt;- 3
W &lt;- sparseMatrix(i=rep(1:d, each=m), 
  j=replicate(d, sample(x=1:d, size=m, replace=FALSE)), x=1/m, dims=c(d, d))

# exact log determinant
ldet1 &lt;- sar_lndet(ldetflag=0, W, rmin=-1, rmax=1)

# Chebychev approximation of log determinant
ldet2 &lt;- sar_lndet(ldetflag=1, W, rmin=-1, rmax=1)

plot(ldet1$detval[,1], ldet1$detval[,2], type="l", col="black", 
  xlab="rho", ylab="ln|I_n - rho W|",
  main="Log-determinant ln|I_n - rho W| Interpolations")
lines(ldet2$detval[,1], ldet2$detval[,2], type="l", col="red")
legend("bottomleft", legend=c("Exact log-determinant", "Chebychev approximation"), 
  lty=1, lwd=1, col=c("black","red"), bty="n")

</code></pre>

<hr>
<h2 id='sarorderedprobit'>Bayesian estimation of the SAR ordered probit model</h2><span id='topic+sarorderedprobit'></span><span id='topic+sar_ordered_probit_mcmc'></span>

<h3>Description</h3>

<p>Bayesian estimation of the spatial autoregressive ordered probit model (SAR ordered probit model).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sarorderedprobit(formula, W, data, subset, ...)

sar_ordered_probit_mcmc(y, X, W, ndraw = 1000, burn.in = 100, thinning = 1, 
  prior=list(a1=1, a2=1, c=rep(0, ncol(X)), T=diag(ncol(X))*1e12, lflag = 0), 
  start = list(rho = 0.75, beta = rep(0, ncol(X)), 
  phi = c(-Inf, 0:(max(y)-1), Inf)),
  m=10, computeMarginalEffects=TRUE, showProgress=FALSE)

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sarorderedprobit_+3A_y">y</code></td>
<td>
<p>dependent variables. vector of discrete choices from 1 to J ({1,2,...,J})</p>
</td></tr>
<tr><td><code id="sarorderedprobit_+3A_x">X</code></td>
<td>
<p>design matrix</p>
</td></tr>
<tr><td><code id="sarorderedprobit_+3A_w">W</code></td>
<td>
<p>spatial weight matrix</p>
</td></tr>
<tr><td><code id="sarorderedprobit_+3A_ndraw">ndraw</code></td>
<td>
<p>number of MCMC iterations</p>
</td></tr>
<tr><td><code id="sarorderedprobit_+3A_burn.in">burn.in</code></td>
<td>
<p>number of MCMC burn-in to be discarded</p>
</td></tr>
<tr><td><code id="sarorderedprobit_+3A_thinning">thinning</code></td>
<td>
<p>MCMC thinning factor, defaults to 1.</p>
</td></tr>
<tr><td><code id="sarorderedprobit_+3A_prior">prior</code></td>
<td>
<p>A list of prior settings for 
<code class="reqn">\rho \sim Beta(a1,a2)</code> 
and <code class="reqn">\beta \sim N(c,T)</code>. Defaults to diffuse prior for beta.</p>
</td></tr>
<tr><td><code id="sarorderedprobit_+3A_start">start</code></td>
<td>
<p>list of start values</p>
</td></tr>
<tr><td><code id="sarorderedprobit_+3A_m">m</code></td>
<td>
<p>Number of burn-in samples in innermost Gibbs sampler. Defaults to 10.</p>
</td></tr>
<tr><td><code id="sarorderedprobit_+3A_computemarginaleffects">computeMarginalEffects</code></td>
<td>
<p>Flag if marginal effects are calculated. Defaults to TRUE. Currently without effect.</p>
</td></tr>
<tr><td><code id="sarorderedprobit_+3A_showprogress">showProgress</code></td>
<td>
<p>Flag if progress bar should be shown. Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="sarorderedprobit_+3A_formula">formula</code></td>
<td>
<p>an object of class &quot;<code><a href="stats.html#topic+formula">formula</a></code>&quot; (or one that can be coerced to that class): a symbolic description of the model to be fitted.</p>
</td></tr>
<tr><td><code id="sarorderedprobit_+3A_data">data</code></td>
<td>
<p>an optional data frame, list or environment (or object coercible by <code>as.data.frame</code> to a data frame) containing the variables in the model. 
If not found in data, the variables are taken from environment(formula), typically the environment from which sarprobit is called.</p>
</td></tr>
<tr><td><code id="sarorderedprobit_+3A_subset">subset</code></td>
<td>
<p>an optional vector specifying a subset of observations to be used in the fitting process.</p>
</td></tr>
<tr><td><code id="sarorderedprobit_+3A_...">...</code></td>
<td>
<p>additional arguments to be passed</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Bayesian estimates of the spatial autoregressive ordered probit model (SAR ordered probit model)
</p>
<p style="text-align: center;"><code class="reqn">
  z = \rho W z + X \beta + \epsilon, \epsilon \sim N(0, I_n)
</code>
</p>

<p style="text-align: center;"><code class="reqn">
  z = (I_n - \rho W)^{-1} X \beta + (I_n - \rho W)^{-1} \epsilon
</code>
</p>
    
<p>where y is a <code class="reqn">(n \times 1)</code> vector of 
discrete choices from 1 to J, <code class="reqn">y \in \{1,2,...,J\}</code>, where
</p>
<p><code class="reqn">y = 1</code>   for <code class="reqn">-\infty  \le z \le \phi_1 = 0</code> <br />
<code class="reqn">y = 2</code>   for <code class="reqn">\phi_1   \le z \le \phi_2</code> <br />
...     <br />
<code class="reqn">y = j</code>   for <code class="reqn">\phi_{j-1} \le z \le \phi_j</code> <br />
...     <br />
<code class="reqn">y = J</code>   for <code class="reqn">\phi_{J-1} \le z \le \infty</code>
</p>
<p>The vector <code class="reqn">\phi=(\phi_1,...,\phi_{J-1})'</code> <code class="reqn">(J-1 \times 1)</code> represents the cut points
(threshold values) that need to be estimated. <code class="reqn">\phi_1 = 0</code> is set to zero by default.
</p>
<p><code class="reqn">\beta</code> is a <code class="reqn">(k \times 1)</code> 
vector of parameters associated with the <code class="reqn">(n \times k)</code> data matrix X.
</p>
<p><code class="reqn">\rho</code> is the spatial dependence parameter.
</p>
<p>The error variance <code class="reqn">\sigma_e</code> is set to 1 for identification.
</p>
<p>Computation of marginal effects is currently not implemented.
</p>


<h3>Value</h3>

<p>Returns a structure of class <code>sarprobit</code>:
</p>
<table>
<tr><td><code>beta</code></td>
<td>
<p> posterior mean of bhat based on draws </p>
</td></tr>
<tr><td><code>rho</code></td>
<td>
<p> posterior mean of rho based on draws </p>
</td></tr>
<tr><td><code>phi</code></td>
<td>
<p> posterior mean of phi based on draws </p>
</td></tr>
<tr><td><code>coefficients</code></td>
<td>
<p> posterior mean of coefficients </p>
</td></tr>
<tr><td><code>fitted.values</code></td>
<td>
<p> fitted values </p>
</td></tr>
<tr><td><code>fitted.reponse</code></td>
<td>
<p> fitted reponse </p>
</td></tr>
<tr><td><code>ndraw</code></td>
<td>
<p> # of draws </p>
</td></tr>
<tr><td><code>bdraw</code></td>
<td>
<p> beta draws (ndraw-nomit x nvar) </p>
</td></tr>
<tr><td><code>pdraw</code></td>
<td>
<p> rho  draws (ndraw-nomit x 1) </p>
</td></tr>
<tr><td><code>phidraw</code></td>
<td>
<p> phi  draws (ndraw-nomit x 1) </p>
</td></tr>
<tr><td><code>a1</code></td>
<td>
<p> a1 parameter for beta prior on rho from input, or default value </p>
</td></tr>
<tr><td><code>a2</code></td>
<td>
<p> a2 parameter for beta prior on rho from input, or default value </p>
</td></tr>
<tr><td><code>time</code></td>
<td>
<p> total time taken </p>
</td></tr>  
<tr><td><code>rmax</code></td>
<td>
<p> 1/max eigenvalue of W (or rmax if input) </p>
</td></tr>
<tr><td><code>rmin</code></td>
<td>
<p> 1/min eigenvalue of W (or rmin if input) </p>
</td></tr>
<tr><td><code>tflag</code></td>
<td>
<p> 'plevel' (default) for printing p-levels; 
'tstat' for printing bogus t-statistics </p>
</td></tr>
<tr><td><code>lflag</code></td>
<td>
<p> lflag from input </p>
</td></tr>
<tr><td><code>cflag</code></td>
<td>
<p> 1 for intercept term, 0 for no intercept term </p>
</td></tr>
<tr><td><code>lndet</code></td>
<td>
<p> a matrix containing log-determinant information
(for use in later function calls to save time) </p>
</td></tr>          
<tr><td><code>W</code></td>
<td>
<p>spatial weights matrix </p>
</td></tr>
<tr><td><code>X</code></td>
<td>
<p>regressor matrix </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Stefan Wilhelm &lt;wilhelm@financial.com&gt; 
</p>


<h3>References</h3>

<p>LeSage, J. and Pace, R. K. (2009), <em>Introduction to Spatial Econometrics</em>, CRC Press, chapter 10, section 10.2 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+sarprobit">sarprobit</a></code> for the SAR binary probit model
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(spatialprobit)
set.seed(1)

################################################################################
#
# Example with J = 4 alternatives
#
################################################################################

# set up a model like in SAR probit
J &lt;- 4   
# ordered alternatives j=1, 2, 3, 4 
# --&gt; (J-2)=2 cutoff-points to be estimated phi_2, phi_3
phi &lt;- c(-Inf, 0,  +1, +2, Inf)    # phi_0,...,phi_j, vector of length (J+1)
# phi_1 = 0 is a identification restriction

# generate random samples from true model
n &lt;- 400             # number of items
k &lt;- 3               # 3 beta parameters
beta &lt;- c(0, -1, 1)  # true model parameters k=3 beta=(beta1,beta2,beta3)
rho &lt;- 0.75
# design matrix with two standard normal variates as "coordinates"
X &lt;- cbind(intercept=1, x=rnorm(n), y=rnorm(n))

# identity matrix I_n
I_n &lt;- sparseMatrix(i=1:n, j=1:n, x=1)

# build spatial weight matrix W from coordinates in X
W &lt;- kNearestNeighbors(x=rnorm(n), y=rnorm(n), k=6)

# create samples from epsilon using independence of distributions (rnorm()) 
# to avoid dense matrix I_n
eps &lt;- rnorm(n=n, mean=0, sd=1)
z   &lt;- solve(qr(I_n - rho * W), X %*% beta + eps)

# ordered variable y:
# y_i = 1 for phi_0 &lt; z &lt;= phi_1; -Inf &lt; z &lt;= 0
# y_i = 2 for phi_1 &lt; z &lt;= phi_2
# y_i = 3 for phi_2 &lt; z &lt;= phi_3
# y_i = 4 for phi_3 &lt; z &lt;= phi_4

# y in {1, 2, 3} 
y   &lt;- cut(as.double(z), breaks=phi, labels=FALSE, ordered_result = TRUE)
table(y)

#y
#  1   2   3   4 
#246  55  44  55

# estimate SAR Ordered Probit
res &lt;- sar_ordered_probit_mcmc(y=y, X=X, W=W, showProgress=TRUE)
summary(res)

#----MCMC spatial autoregressive ordered probit----
#Execution time  = 12.152 secs
#
#N draws         =   1000, N omit (burn-in)=    100
#N observations  =    400, K covariates    =      3
#Min rho         = -1.000, Max rho         =  1.000
#--------------------------------------------------
#
#y
#  1   2   3   4 
#246  55  44  55 
#          Estimate Std. Dev  p-level t-value Pr(&gt;|z|)    
#intercept -0.10459  0.05813  0.03300  -1.799   0.0727 .  
#x         -0.78238  0.07609  0.00000 -10.283   &lt;2e-16 ***
#y          0.83102  0.07256  0.00000  11.452   &lt;2e-16 ***
#rho        0.72289  0.04045  0.00000  17.872   &lt;2e-16 ***
#y&gt;=2       0.00000  0.00000  1.00000      NA       NA    
#y&gt;=3       0.74415  0.07927  0.00000   9.387   &lt;2e-16 ***
#y&gt;=4       1.53705  0.10104  0.00000  15.212   &lt;2e-16 ***
#---

addmargins(table(y=res$y, fitted=res$fitted.response))

#     fitted
#y       1   2   3   4 Sum
#  1   218  26   2   0 246
#  2    31  19   5   0  55
#  3    11  19  12   2  44
#  4     3  14  15  23  55
#  Sum 263  78  34  25 400

</code></pre>

<hr>
<h2 id='sarprobit'>Bayesian estimation of the SAR probit model</h2><span id='topic+sar_probit_mcmc'></span><span id='topic+sarprobit'></span>

<h3>Description</h3>

<p>Bayesian estimation of the spatial autoregressive probit model (SAR probit model).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sarprobit(formula, W, data, subset, ...)

sar_probit_mcmc(y, X, W, ndraw = 1000, burn.in = 100, thinning = 1, 
  prior=list(a1=1, a2=1, c=rep(0, ncol(X)), T=diag(ncol(X))*1e12, lflag = 0), 
  start = list(rho = 0.75, beta = rep(0, ncol(X))),
  m=10, computeMarginalEffects=TRUE, showProgress=FALSE, verbose=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sarprobit_+3A_y">y</code></td>
<td>
<p>dependent variables. vector of zeros and ones</p>
</td></tr>
<tr><td><code id="sarprobit_+3A_x">X</code></td>
<td>
<p>design matrix</p>
</td></tr>
<tr><td><code id="sarprobit_+3A_w">W</code></td>
<td>
<p>spatial weight matrix</p>
</td></tr>
<tr><td><code id="sarprobit_+3A_ndraw">ndraw</code></td>
<td>
<p>number of MCMC iterations</p>
</td></tr>
<tr><td><code id="sarprobit_+3A_burn.in">burn.in</code></td>
<td>
<p>number of MCMC burn-in to be discarded</p>
</td></tr>
<tr><td><code id="sarprobit_+3A_thinning">thinning</code></td>
<td>
<p>MCMC thinning factor, defaults to 1.</p>
</td></tr>
<tr><td><code id="sarprobit_+3A_prior">prior</code></td>
<td>
<p>A list of prior settings for 
<code class="reqn">\rho \sim Beta(a1,a2)</code> 
and <code class="reqn">\beta \sim N(c,T)</code>. Defaults to diffuse prior for beta.</p>
</td></tr>
<tr><td><code id="sarprobit_+3A_start">start</code></td>
<td>
<p>list of start values</p>
</td></tr>
<tr><td><code id="sarprobit_+3A_m">m</code></td>
<td>
<p>Number of burn-in samples in innermost Gibbs sampler. Defaults to 10.</p>
</td></tr>
<tr><td><code id="sarprobit_+3A_computemarginaleffects">computeMarginalEffects</code></td>
<td>
<p>Flag if marginal effects are calculated. Defaults to TRUE</p>
</td></tr>
<tr><td><code id="sarprobit_+3A_showprogress">showProgress</code></td>
<td>
<p>Flag if progress bar should be shown. Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="sarprobit_+3A_verbose">verbose</code></td>
<td>
<p>Flag for more verbose output. Default to FALSE.</p>
</td></tr>
<tr><td><code id="sarprobit_+3A_formula">formula</code></td>
<td>
<p>an object of class &quot;<code><a href="stats.html#topic+formula">formula</a></code>&quot; (or one that can be coerced to that class): a symbolic description of the model to be fitted.</p>
</td></tr>
<tr><td><code id="sarprobit_+3A_data">data</code></td>
<td>
<p>an optional data frame, list or environment (or object coercible by <code>as.data.frame</code> to a data frame) containing the variables in the model. 
If not found in data, the variables are taken from environment(formula), typically the environment from which sarprobit is called.</p>
</td></tr>
<tr><td><code id="sarprobit_+3A_subset">subset</code></td>
<td>
<p>an optional vector specifying a subset of observations to be used in the fitting process.</p>
</td></tr>
<tr><td><code id="sarprobit_+3A_...">...</code></td>
<td>
<p>additional arguments to be passed</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Bayesian estimates of the spatial autoregressive probit model (SAR probit model)
</p>
<p style="text-align: center;"><code class="reqn">
  z = \rho W z + X \beta + \epsilon, \epsilon \sim N(0, I_n)
</code>
</p>

<p style="text-align: center;"><code class="reqn">
  z = (I_n - \rho W)^{-1} X \beta + (I_n - \rho W)^{-1} \epsilon
</code>
</p>
    
<p>where y is a binary 0,1 <code class="reqn">(n \times 1)</code> vector of observations for z &lt; 0 and z &gt;= 0. 
<code class="reqn">\beta</code> is a <code class="reqn">(k \times 1)</code> 
vector of parameters associated with the <code class="reqn">(n \times k)</code> data matrix X.
The error variance <code class="reqn">\sigma_e</code> is set to 1 for identification.
</p>
<p>The prior distributions are 
<code class="reqn">\beta \sim N(c,T)</code> 
and  
<code class="reqn">\rho \sim Uni(rmin,rmax)</code> 
or 
<code class="reqn">\rho \sim Beta(a1,a2)</code>.
</p>


<h3>Value</h3>

<p>Returns a structure of class <code>sarprobit</code>:
</p>
<table>
<tr><td><code>beta</code></td>
<td>
<p> posterior mean of bhat based on draws </p>
</td></tr>
<tr><td><code>rho</code></td>
<td>
<p> posterior mean of rho based on draws </p>
</td></tr>
<tr><td><code>bdraw</code></td>
<td>
<p> beta draws (ndraw-nomit x nvar) </p>
</td></tr>
<tr><td><code>pdraw</code></td>
<td>
<p> rho  draws (ndraw-nomit x 1) </p>
</td></tr>
<tr><td><code>total</code></td>
<td>
<p> a matrix (ndraw,nvars-1) total x-impacts </p>
</td></tr>
<tr><td><code>direct</code></td>
<td>
<p> a matrix (ndraw,nvars-1) direct x-impacts </p>
</td></tr>
<tr><td><code>indirect</code></td>
<td>
<p> a matrix (ndraw,nvars-1) indirect x-impacts </p>
</td></tr>
<tr><td><code>rdraw</code></td>
<td>
<p> r draws (ndraw-nomit x 1) (if m,k input) </p>
</td></tr>
<tr><td><code>nobs</code></td>
<td>
<p> # of observations </p>
</td></tr>
<tr><td><code>nvar</code></td>
<td>
<p> # of variables in x-matrix </p>
</td></tr>
<tr><td><code>ndraw</code></td>
<td>
<p> # of draws </p>
</td></tr>
<tr><td><code>nomit</code></td>
<td>
<p> # of initial draws omitted </p>
</td></tr>
<tr><td><code>nsteps</code></td>
<td>
<p> # of samples used by Gibbs sampler for TMVN </p>
</td></tr>
<tr><td><code>y</code></td>
<td>
<p> y-vector from input (nobs x 1) </p>
</td></tr>
<tr><td><code>zip</code></td>
<td>
<p> # of zero y-values </p>
</td></tr>
<tr><td><code>a1</code></td>
<td>
<p> a1 parameter for beta prior on rho from input, or default value </p>
</td></tr>
<tr><td><code>a2</code></td>
<td>
<p> a2 parameter for beta prior on rho from input, or default value </p>
</td></tr>
<tr><td><code>time</code></td>
<td>
<p> total time taken </p>
</td></tr>  
<tr><td><code>rmax</code></td>
<td>
<p> 1/max eigenvalue of W (or rmax if input) </p>
</td></tr>
<tr><td><code>rmin</code></td>
<td>
<p> 1/min eigenvalue of W (or rmin if input) </p>
</td></tr>          
<tr><td><code>tflag</code></td>
<td>
<p> 'plevel' (default) for printing p-levels; 
'tstat' for printing bogus t-statistics </p>
</td></tr>
<tr><td><code>lflag</code></td>
<td>
<p> lflag from input </p>
</td></tr>
<tr><td><code>cflag</code></td>
<td>
<p> 1 for intercept term, 0 for no intercept term </p>
</td></tr>
<tr><td><code>lndet</code></td>
<td>
<p> a matrix containing log-determinant information
(for use in later function calls to save time) </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>adapted to and optimized for R by Stefan Wilhelm &lt;wilhelm@financial.com&gt; 
and Miguel Godinho de Matos &lt;miguelgodinhomatos@cmu.edu&gt;
based on code from James P. LeSage</p>


<h3>References</h3>

<p>LeSage, J. and Pace, R. K. (2009), <em>Introduction to Spatial Econometrics</em>, CRC Press, chapter 10 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+sar_lndet">sar_lndet</a></code> for computing log-determinants
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(Matrix)
set.seed(2)

# number of observations
n &lt;- 100

# true parameters
beta &lt;- c(0, 1, -1)
rho &lt;- 0.75

# design matrix with two standard normal variates as "covariates"
X &lt;- cbind(intercept=1, x=rnorm(n), y=rnorm(n))

# sparse identity matrix
I_n &lt;- sparseMatrix(i=1:n, j=1:n, x=1)

# number of nearest neighbors in spatial weight matrix W
m &lt;- 6

# spatial weight matrix with m=6 nearest neighbors
# W must not have non-zeros in the main diagonal!
i &lt;- rep(1:n, each=m)
j &lt;- rep(NA, n * m)
for (k in 1:n) {
  j[(((k-1)*m)+1):(k*m)] &lt;- sample(x=(1:n)[-k], size=m, replace=FALSE)
}
W &lt;- sparseMatrix(i, j, x=1/m, dims=c(n, n))


# innovations
eps &lt;- rnorm(n=n, mean=0, sd=1)

# generate data from model 
S &lt;- I_n - rho * W
z &lt;- solve(qr(S), X %*% beta + eps)
y &lt;- as.vector(z &gt;= 0)  # 0 or 1, FALSE or TRUE

# estimate SAR probit model
sarprobit.fit1 &lt;- sar_probit_mcmc(y, X, W, ndraw=100, thinning=1, prior=NULL)
summary(sarprobit.fit1)
</code></pre>

<hr>
<h2 id='sartobit'>Bayesian estimation of the SAR Tobit model</h2><span id='topic+sartobit'></span><span id='topic+sar_tobit_mcmc'></span>

<h3>Description</h3>

<p>Bayesian estimation of the spatial autoregressive Tobit model (SAR Tobit model).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sartobit(formula, W, data, ...)

sar_tobit_mcmc(y, X, W, ndraw = 1000, burn.in = 100, thinning = 1, 
  prior=list(a1=1, a2=1, c=rep(0, ncol(X)), T=diag(ncol(X))*1e12, lflag = 0), 
  start = list(rho = 0.75, beta = rep(0, ncol(X)), sige = 1),
  m=10, computeMarginalEffects=FALSE, showProgress=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sartobit_+3A_y">y</code></td>
<td>
<p>dependent variables. vector of zeros and ones</p>
</td></tr>
<tr><td><code id="sartobit_+3A_x">X</code></td>
<td>
<p>design matrix</p>
</td></tr>
<tr><td><code id="sartobit_+3A_w">W</code></td>
<td>
<p>spatial weight matrix</p>
</td></tr>
<tr><td><code id="sartobit_+3A_ndraw">ndraw</code></td>
<td>
<p>number of MCMC iterations</p>
</td></tr>
<tr><td><code id="sartobit_+3A_burn.in">burn.in</code></td>
<td>
<p>number of MCMC burn-in to be discarded</p>
</td></tr>
<tr><td><code id="sartobit_+3A_thinning">thinning</code></td>
<td>
<p>MCMC thinning factor, defaults to 1.</p>
</td></tr>
<tr><td><code id="sartobit_+3A_prior">prior</code></td>
<td>
<p>A list of prior settings for 
<code class="reqn">\rho \sim Beta(a1,a2)</code> 
and <code class="reqn">\beta \sim N(c,T)</code>. Defaults to diffuse prior for beta.</p>
</td></tr>
<tr><td><code id="sartobit_+3A_start">start</code></td>
<td>
<p>list of start values</p>
</td></tr>
<tr><td><code id="sartobit_+3A_m">m</code></td>
<td>
<p>Number of burn-in samples in innermost Gibbs sampler. Defaults to 10.</p>
</td></tr>
<tr><td><code id="sartobit_+3A_computemarginaleffects">computeMarginalEffects</code></td>
<td>
<p>Flag if marginal effects are calculated. Defaults to FALSE. 
We recommend to enable it only when sample size is small.</p>
</td></tr>
<tr><td><code id="sartobit_+3A_showprogress">showProgress</code></td>
<td>
<p>Flag if progress bar should be shown. Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="sartobit_+3A_formula">formula</code></td>
<td>
<p>an object of class &quot;<code><a href="stats.html#topic+formula">formula</a></code>&quot; (or one that can be coerced to that class): a symbolic description of the model to be fitted.</p>
</td></tr>
<tr><td><code id="sartobit_+3A_data">data</code></td>
<td>
<p>an optional data frame, list or environment (or object coercible by <code>as.data.frame</code> to a data frame) containing the variables in the model. 
If not found in data, the variables are taken from environment(formula), typically the environment from which sarprobit is called.</p>
</td></tr>
<tr><td><code id="sartobit_+3A_...">...</code></td>
<td>
<p>additional arguments to be passed</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Bayesian estimates of the spatial autoregressive Tobit model (SAR Tobit model)
</p>
<p style="text-align: center;"><code class="reqn">
  z = \rho W y + X \beta + \epsilon, \epsilon \sim N(0, \sigma^2_{e} I_n)
</code>
</p>

<p style="text-align: center;"><code class="reqn">
  z = (I_n - \rho W)^{-1} X \beta + (I_n - \rho W)^{-1} \epsilon
</code>
</p>

<p style="text-align: center;"><code class="reqn">
  y = max(z, 0)
</code>
</p>

<p>where <code class="reqn">y</code> <code class="reqn">(n \times 1)</code> is only observed for <code class="reqn">z \ge 0</code> and censored to 0 otherwise. 
<code class="reqn">\beta</code> is a <code class="reqn">(k \times 1)</code> 
vector of parameters associated with the <code class="reqn">(n \times k)</code> data matrix X.
</p>
<p>The prior distributions are 
<code class="reqn">\beta \sim N(c,T)</code> 
and  
<code class="reqn">\rho \sim Uni(rmin,rmax)</code> 
or 
<code class="reqn">\rho \sim Beta(a1,a2)</code>.
</p>


<h3>Value</h3>

<p>Returns a structure of class <code>sartobit</code>:
</p>
<table>
<tr><td><code>beta</code></td>
<td>
<p> posterior mean of bhat based on draws </p>
</td></tr>
<tr><td><code>rho</code></td>
<td>
<p> posterior mean of rho based on draws </p>
</td></tr>
<tr><td><code>bdraw</code></td>
<td>
<p> beta draws (ndraw-nomit x nvar) </p>
</td></tr>
<tr><td><code>pdraw</code></td>
<td>
<p> rho  draws (ndraw-nomit x 1) </p>
</td></tr>
<tr><td><code>sdraw</code></td>
<td>
<p> sige draws (ndraw-nomit x 1) </p>
</td></tr>
<tr><td><code>total</code></td>
<td>
<p> a matrix (ndraw,nvars-1) total x-impacts </p>
</td></tr>
<tr><td><code>direct</code></td>
<td>
<p> a matrix (ndraw,nvars-1) direct x-impacts </p>
</td></tr>
<tr><td><code>indirect</code></td>
<td>
<p> a matrix (ndraw,nvars-1) indirect x-impacts </p>
</td></tr>
<tr><td><code>rdraw</code></td>
<td>
<p> r draws (ndraw-nomit x 1) (if m,k input) </p>
</td></tr>
<tr><td><code>nobs</code></td>
<td>
<p> # of observations </p>
</td></tr>
<tr><td><code>nvar</code></td>
<td>
<p> # of variables in x-matrix </p>
</td></tr>
<tr><td><code>ndraw</code></td>
<td>
<p> # of draws </p>
</td></tr>
<tr><td><code>nomit</code></td>
<td>
<p> # of initial draws omitted </p>
</td></tr>
<tr><td><code>nsteps</code></td>
<td>
<p> # of samples used by Gibbs sampler for TMVN </p>
</td></tr>
<tr><td><code>y</code></td>
<td>
<p> y-vector from input (nobs x 1) </p>
</td></tr>
<tr><td><code>zip</code></td>
<td>
<p> # of zero y-values </p>
</td></tr>
<tr><td><code>a1</code></td>
<td>
<p> a1 parameter for beta prior on rho from input, or default value </p>
</td></tr>
<tr><td><code>a2</code></td>
<td>
<p> a2 parameter for beta prior on rho from input, or default value </p>
</td></tr>
<tr><td><code>time</code></td>
<td>
<p> total time taken </p>
</td></tr>  
<tr><td><code>rmax</code></td>
<td>
<p> 1/max eigenvalue of W (or rmax if input) </p>
</td></tr>
<tr><td><code>rmin</code></td>
<td>
<p> 1/min eigenvalue of W (or rmin if input) </p>
</td></tr>          
<tr><td><code>tflag</code></td>
<td>
<p> 'plevel' (default) for printing p-levels; 
'tstat' for printing bogus t-statistics </p>
</td></tr>
<tr><td><code>lflag</code></td>
<td>
<p> lflag from input </p>
</td></tr>
<tr><td><code>cflag</code></td>
<td>
<p> 1 for intercept term, 0 for no intercept term </p>
</td></tr>
<tr><td><code>lndet</code></td>
<td>
<p> a matrix containing log-determinant information
(for use in later function calls to save time) </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>adapted to and optimized for R by Stefan Wilhelm &lt;wilhelm@financial.com&gt; 
based on Matlab code from James P. LeSage</p>


<h3>References</h3>

<p>LeSage, J. and Pace, R. K. (2009), <em>Introduction to Spatial Econometrics</em>, CRC Press, chapter 10,
section 10.3, 299&ndash;304 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+sarprobit">sarprobit</a></code>, <code><a href="#topic+sarorderedprobit">sarorderedprobit</a></code> or <code><a href="#topic+semprobit">semprobit</a></code> 
for SAR probit/SAR Ordered Probit/ SEM probit model fitting
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Example from LeSage/Pace (2009), section 10.3.1, p. 302-304
# Value of "a" is not stated in book! 
# Assuming a=-1 which gives approx. 50% censoring
library(spatialprobit)

a &lt;- -1   # control degree of censored observation
n &lt;- 1000
rho &lt;- 0.7
beta &lt;- c(0, 2)
sige &lt;- 0.5
I_n &lt;- sparseMatrix(i=1:n, j=1:n, x=1)
x &lt;- runif(n, a, 1)
X &lt;- cbind(1, x)
eps &lt;- rnorm(n, sd=sqrt(sige))
param &lt;- c(beta, sige, rho)

# random locational coordinates and 6 nearest neighbors
lat &lt;- rnorm(n)
long &lt;- rnorm(n)
W &lt;- kNearestNeighbors(lat, long, k=6)

y &lt;- as.double(solve(I_n - rho * W) %*% (X %*% beta + eps))
table(y &gt; 0)

# full information
yfull &lt;- y

# set negative values to zero to reflect sample truncation
ind &lt;- which(y &lt;=0)
y[ind] &lt;- 0

# Fit SAR (with complete information)
fit_sar &lt;- sartobit(yfull ~ X-1, W,ndraw=1000,burn.in=200, showProgress=FALSE)
summary(fit_sar)

# Fit SAR Tobit (with approx. 50% censored observations)
fit_sartobit &lt;- sartobit(y ~ x,W,ndraw=1000,burn.in=200, showProgress=TRUE)

par(mfrow=c(2,2))
for (i in 1:4) {
 ylim1 &lt;- range(fit_sar$B[,i], fit_sartobit$B[,i])
 plot(fit_sar$B[,i], type="l", ylim=ylim1, main=fit_sartobit$names[i], col="red")
 lines(fit_sartobit$B[,i], col="green")
 legend("topleft", legend=c("SAR", "SAR Tobit"), col=c("red", "green"), 
   lty=1, bty="n")
}

# Fit SAR Tobit (with approx. 50% censored observations)
fit_sartobit &lt;- sartobit(y ~ x,W,ndraw=1000,burn.in=0, showProgress=TRUE, 
    computeMarginalEffects=TRUE)
# Print SAR Tobit marginal effects
impacts(fit_sartobit)
#--------Marginal Effects--------
#
#(a) Direct effects
#  lower_005 posterior_mean upper_095
#x     1.013          1.092     1.176
#
#(b) Indirect effects
#  lower_005 posterior_mean upper_095
#x     2.583          2.800     3.011
#
#(c) Total effects
#  lower_005 posterior_mean upper_095
#x     3.597          3.892     4.183
#mfx &lt;- marginal.effects(fit_sartobit)

</code></pre>

<hr>
<h2 id='semprobit'>Bayesian estimation of the SEM probit model</h2><span id='topic+sem_probit_mcmc'></span><span id='topic+semprobit'></span>

<h3>Description</h3>

<p>Bayesian estimation of the probit model with spatial errors (SEM probit model).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>semprobit(formula, W, data, subset, ...)

sem_probit_mcmc(y, X, W, ndraw = 1000, burn.in = 100, thinning = 1, 
  prior=list(a1=1, a2=1, c=rep(0, ncol(X)), T=diag(ncol(X))*1e12,
  nu = 0, d0 = 0, lflag = 0), 
  start = list(rho = 0.75, beta = rep(0, ncol(X)), sige = 1),
  m=10, showProgress=FALSE, univariateConditionals = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="semprobit_+3A_y">y</code></td>
<td>
<p>dependent variables. vector of zeros and ones</p>
</td></tr>
<tr><td><code id="semprobit_+3A_x">X</code></td>
<td>
<p>design matrix</p>
</td></tr>
<tr><td><code id="semprobit_+3A_w">W</code></td>
<td>
<p>spatial weight matrix</p>
</td></tr>
<tr><td><code id="semprobit_+3A_ndraw">ndraw</code></td>
<td>
<p>number of MCMC iterations</p>
</td></tr>
<tr><td><code id="semprobit_+3A_burn.in">burn.in</code></td>
<td>
<p>number of MCMC burn-in to be discarded</p>
</td></tr>
<tr><td><code id="semprobit_+3A_thinning">thinning</code></td>
<td>
<p>MCMC thinning factor, defaults to 1.</p>
</td></tr>
<tr><td><code id="semprobit_+3A_prior">prior</code></td>
<td>
<p>A list of prior settings for 
<code class="reqn">\rho \sim Beta(a1,a2)</code> 
and <code class="reqn">\beta \sim N(c,T)</code>. Defaults to diffuse prior for beta.</p>
</td></tr>
<tr><td><code id="semprobit_+3A_start">start</code></td>
<td>
<p>list of start values</p>
</td></tr>
<tr><td><code id="semprobit_+3A_m">m</code></td>
<td>
<p>Number of burn-in samples in innermost Gibbs sampler. Defaults to 10.</p>
</td></tr>
<tr><td><code id="semprobit_+3A_showprogress">showProgress</code></td>
<td>
<p>Flag if progress bar should be shown. Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="semprobit_+3A_univariateconditionals">univariateConditionals</code></td>
<td>
<p>Switch whether to draw from univariate or multivariate truncated normals. See notes. Defaults to TRUE.</p>
</td></tr>
<tr><td><code id="semprobit_+3A_formula">formula</code></td>
<td>
<p>an object of class &quot;<code><a href="stats.html#topic+formula">formula</a></code>&quot; (or one that can be coerced to that class): a symbolic description of the model to be fitted.</p>
</td></tr>
<tr><td><code id="semprobit_+3A_data">data</code></td>
<td>
<p>an optional data frame, list or environment (or object coercible by <code>as.data.frame</code> to a data frame) containing the variables in the model. 
If not found in data, the variables are taken from environment(formula), typically the environment from which semprobit is called.</p>
</td></tr>
<tr><td><code id="semprobit_+3A_subset">subset</code></td>
<td>
<p>an optional vector specifying a subset of observations to be used in the fitting process.</p>
</td></tr>
<tr><td><code id="semprobit_+3A_...">...</code></td>
<td>
<p>additional arguments to be passed</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Bayesian estimates of the probit model with spatial errors (SEM probit model)
</p>
<p style="text-align: center;"><code class="reqn">
  z = X \beta + u, \\
  u = \rho W u + \epsilon, \epsilon \sim N(0, \sigma^2_{\epsilon} I_n)
</code>
</p>

<p>which leads to the data-generating process
</p>
<p style="text-align: center;"><code class="reqn">
  z = X \beta + (I_n - \rho W)^{-1} \epsilon
</code>
</p>
    
<p>where y is a binary 0,1 <code class="reqn">(n \times 1)</code> vector of observations for <code class="reqn">z &lt; 0</code> and <code class="reqn">z \ge 0</code>. 
<code class="reqn">\beta</code> is a <code class="reqn">(k \times 1)</code> 
vector of parameters associated with the <code class="reqn">(n \times k)</code> data matrix X.
</p>
<p>The prior distributions are 
<code class="reqn">\beta \sim N(c,T)</code>,
<code class="reqn">\sigma^2_{\epsilon} \sim IG(a1, a2)</code>, 
and  
<code class="reqn">\rho \sim Uni(rmin,rmax)</code> 
or 
<code class="reqn">\rho \sim Beta(a1,a2)</code>.
</p>


<h3>Value</h3>

<p>Returns a structure of class <code>semprobit</code>:
</p>
<table>
<tr><td><code>beta</code></td>
<td>
<p> posterior mean of bhat based on draws </p>
</td></tr>
<tr><td><code>rho</code></td>
<td>
<p> posterior mean of rho based on draws </p>
</td></tr>
<tr><td><code>bdraw</code></td>
<td>
<p> beta draws (ndraw-nomit x nvar) </p>
</td></tr>
<tr><td><code>pdraw</code></td>
<td>
<p> rho  draws (ndraw-nomit x 1) </p>
</td></tr>
<tr><td><code>sdraw</code></td>
<td>
<p> sige draws (ndraw-nomit x 1) </p>
</td></tr>
<tr><td><code>total</code></td>
<td>
<p> a matrix (ndraw,nvars-1) total x-impacts </p>
</td></tr>
<tr><td><code>direct</code></td>
<td>
<p> a matrix (ndraw,nvars-1) direct x-impacts </p>
</td></tr>
<tr><td><code>indirect</code></td>
<td>
<p> a matrix (ndraw,nvars-1) indirect x-impacts </p>
</td></tr>
<tr><td><code>rdraw</code></td>
<td>
<p> r draws (ndraw-nomit x 1) (if m,k input) </p>
</td></tr>
<tr><td><code>nobs</code></td>
<td>
<p> # of observations </p>
</td></tr>
<tr><td><code>nvar</code></td>
<td>
<p> # of variables in x-matrix </p>
</td></tr>
<tr><td><code>ndraw</code></td>
<td>
<p> # of draws </p>
</td></tr>
<tr><td><code>nomit</code></td>
<td>
<p> # of initial draws omitted </p>
</td></tr>
<tr><td><code>nsteps</code></td>
<td>
<p> # of samples used by Gibbs sampler for TMVN </p>
</td></tr>
<tr><td><code>y</code></td>
<td>
<p> y-vector from input (nobs x 1) </p>
</td></tr>
<tr><td><code>zip</code></td>
<td>
<p> # of zero y-values </p>
</td></tr>
<tr><td><code>a1</code></td>
<td>
<p> a1 parameter for beta prior on rho from input, or default value </p>
</td></tr>
<tr><td><code>a2</code></td>
<td>
<p> a2 parameter for beta prior on rho from input, or default value </p>
</td></tr>
<tr><td><code>time</code></td>
<td>
<p> total time taken </p>
</td></tr>  
<tr><td><code>rmax</code></td>
<td>
<p> 1/max eigenvalue of W (or rmax if input) </p>
</td></tr>
<tr><td><code>rmin</code></td>
<td>
<p> 1/min eigenvalue of W (or rmin if input) </p>
</td></tr>          
<tr><td><code>tflag</code></td>
<td>
<p> 'plevel' (default) for printing p-levels; 
'tstat' for printing bogus t-statistics </p>
</td></tr>
<tr><td><code>lflag</code></td>
<td>
<p> lflag from input </p>
</td></tr>
<tr><td><code>cflag</code></td>
<td>
<p> 1 for intercept term, 0 for no intercept term </p>
</td></tr>
<tr><td><code>lndet</code></td>
<td>
<p> a matrix containing log-determinant information
(for use in later function calls to save time) </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>adapted to and optimized for R by Stefan Wilhelm &lt;wilhelm@financial.com&gt; 
based on code from James P. LeSage</p>


<h3>References</h3>

<p>LeSage, J. and Pace, R. K. (2009), <em>Introduction to Spatial Econometrics</em>, CRC Press, chapter 10 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+sar_lndet">sar_lndet</a></code> for computing log-determinants
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(Matrix)
# number of observations
n &lt;- 200

# true parameters
beta &lt;- c(0, 1, -1)
sige &lt;- 2
rho &lt;- 0.75

# design matrix with two standard normal variates as "covariates"
X &lt;- cbind(intercept=1, x=rnorm(n), y=rnorm(n))

# sparse identity matrix
I_n &lt;- sparseMatrix(i=1:n, j=1:n, x=1)

# number of nearest neighbors in spatial weight matrix W
m &lt;- 6

# spatial weight matrix with m=6 nearest neighbors
# W must not have non-zeros in the main diagonal!
i &lt;- rep(1:n, each=m)
j &lt;- rep(NA, n * m)
for (k in 1:n) {
  j[(((k-1)*m)+1):(k*m)] &lt;- sample(x=(1:n)[-k], size=m, replace=FALSE)
}
W &lt;- sparseMatrix(i, j, x=1/m, dims=c(n, n))

# innovations
eps &lt;- sqrt(sige)*rnorm(n=n, mean=0, sd=1)

# generate data from model 
S &lt;- I_n - rho * W
z &lt;- X %*% beta + solve(qr(S), eps)
y &lt;- as.double(z &gt;= 0)  # 0 or 1, FALSE or TRUE

# estimate SEM probit model
semprobit.fit1 &lt;- semprobit(y ~ X - 1, W, ndraw=500, burn.in=100, 
  thinning=1, prior=NULL)
summary(semprobit.fit1)

</code></pre>

<hr>
<h2 id='summary'>Print the results of the spatial probit/Tobit estimation via MCMC</h2><span id='topic+summary.sarprobit'></span><span id='topic+summary.sarorderedprobit'></span><span id='topic+summary.semprobit'></span><span id='topic+summary.sartobit'></span>

<h3>Description</h3>

<p>Print the results of the spatial probit/Tobit estimation via MCMC
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'sarprobit'
summary(object, var_names = NULL, file = NULL, 
  digits = max(3, getOption("digits")-3), ...)
  
## S3 method for class 'sarprobit'
summary(object, var_names = NULL, file = NULL, 
  digits = max(3, getOption("digits")-3), ...)  

## S3 method for class 'semprobit'
summary(object, var_names = NULL, file = NULL, 
  digits = max(3, getOption("digits")-3), ...)

## S3 method for class 'sartobit'
summary(object, var_names = NULL, file = NULL, 
  digits = max(3, getOption("digits")-3), ...)  
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary_+3A_object">object</code></td>
<td>
<p>class <code>sarprobit</code>, <code>semprobit</code> or <code>sartobit</code> or with model fits from 
<code><a href="#topic+sarprobit">sarprobit</a></code>, <code><a href="#topic+semprobit">semprobit</a></code> or <code><a href="#topic+sartobit">sartobit</a></code></p>
</td></tr>
<tr><td><code id="summary_+3A_var_names">var_names</code></td>
<td>
<p>vector with names for the parameters under analysis</p>
</td></tr>
<tr><td><code id="summary_+3A_file">file</code></td>
<td>
<p>file name to be printed. If NULL or &quot;&quot; then print to console.</p>
</td></tr>
<tr><td><code id="summary_+3A_digits">digits</code></td>
<td>
<p>integer, used for number formatting with signif() (for summary.default) or format() (for summary.data.frame).</p>
</td></tr>
<tr><td><code id="summary_+3A_...">...</code></td>
<td>
<p>Additional arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>This functions does not return any values.
</p>


<h3>Author(s)</h3>

<p>Miguel Godinho de Matos &lt;miguelgodinhomatos@cmu.edu&gt;, Stefan Wilhelm &lt;wilhelm@financial.com&gt;
</p>


<h3>See Also</h3>

<p><code><a href="#topic+sarprobit">sarprobit</a></code>, <code><a href="#topic+sarorderedprobit">sarorderedprobit</a></code>, <code><a href="#topic+semprobit">semprobit</a></code> or <code><a href="#topic+sartobit">sartobit</a></code> 
for SAR probit/SAR Ordered Probit/ SEM probit/ SAR Tobit model fitting
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
