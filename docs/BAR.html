<!DOCTYPE html><html><head><title>Help for package BAR</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {BAR}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#get_oc_BAR'>
<p>Generate operating characteristics for Bayesian adaptive randomization</p></a></li>
<li><a href='#next_allocation_rate_BAR'>
<p>Calculate the allocation probability for the next block of new patients using Bayesian adaptive randomization</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Bayesian Adaptive Randomization</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.1</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Chia-Wei Hsu &lt;Chia-Wei.Hsu@stjude.org&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Bayesian adaptive randomization is also called outcome adaptive randomization, which is increasingly used in clinical trials.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-11-08 03:10:42 UTC; chsu1</td>
</tr>
<tr>
<td>Author:</td>
<td>Chia-Wei Hsu [aut, cre],
  Haitao Pan [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-11-08 22:20:17 UTC</td>
</tr>
</table>
<hr>
<h2 id='get_oc_BAR'>
Generate operating characteristics for Bayesian adaptive randomization
</h2><span id='topic+get_oc_BAR'></span>

<h3>Description</h3>

<p>Randomization is the established method for obtaining scientifically valid comparisons of competing treatments in clinical trials and other experiments. Bayesian adaptive randomization (BAR) allows changes to be made to the randomization probabilities to treatments during the trial. The aim of the procedure is to allocate a greater proportion of patients to treatments that have so far demonstrated evidence of a better performance than other arms. Binary outcomes are considered in this package
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_oc_BAR(success_prob, n_burn_in, tot_num, block_size,
           power_c = "n/2N", lower_bound = .05, reptime,
           control_arm = "", output = "", seed = 100)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_oc_BAR_+3A_success_prob">success_prob</code></td>
<td>

<p>the successful probability for each arm (the first slot refers to the control arm)
</p>
</td></tr>
<tr><td><code id="get_oc_BAR_+3A_n_burn_in">n_burn_in</code></td>
<td>

<p>the number of burn-in for each arm
</p>
</td></tr>
<tr><td><code id="get_oc_BAR_+3A_tot_num">tot_num</code></td>
<td>

<p>the total number of patients enrolled for the trial
</p>
</td></tr>
<tr><td><code id="get_oc_BAR_+3A_block_size">block_size</code></td>
<td>

<p>the block size
</p>
</td></tr>
<tr><td><code id="get_oc_BAR_+3A_power_c">power_c</code></td>
<td>

<p>the power correction of allocation probability. The default value is power_c = &quot;n/2N&quot; and can also be numeric, e.g., power_c = .5
</p>
</td></tr>
<tr><td><code id="get_oc_BAR_+3A_lower_bound">lower_bound</code></td>
<td>

<p>the lower bound of the allocation probability. It must between 0 and <code class="reqn">\frac{1}{K}</code>. The default value is lower_bound = .05; K indicates total number of arms (including control arm)
</p>
</td></tr>
<tr><td><code id="get_oc_BAR_+3A_reptime">reptime</code></td>
<td>

<p>the number of simulated trials
</p>
</td></tr>
<tr><td><code id="get_oc_BAR_+3A_control_arm">control_arm</code></td>
<td>

<p>if this argument is &quot;fixed&quot;, then allocation probability of control arm (the first slot)
will be fixed to <code class="reqn">\frac{1}{K}</code>. The default of this argument will return unfixed results; K indicates total number of arms (including control arm)
</p>
</td></tr>
<tr><td><code id="get_oc_BAR_+3A_output">output</code></td>
<td>

<p>if this argument is &quot;raw&quot;, then the function will return
updated allocation probability path after burn-in for each arm for each simulated
trial. The default of this argument will return the average allocation probability and the average number of patients assigned to each arm
</p>
</td></tr>
<tr><td><code id="get_oc_BAR_+3A_seed">seed</code></td>
<td>

<p>the seed. The default value is seed = 100
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We show how the updated allocation probabilities for each arm are calculated.<br /> <br /> Treatments are denoted by <code class="reqn">k = 1,\ldots,K</code>.<code class="reqn">\;N</code> is the total sample size. If no burn-in(s), the BAR will be initiated start of a study, that is, for each enrolled patient, <code class="reqn">n = 1,\ldots,N,</code> the BAR will be used to assign each patient. Denoting the true unknown response rates of <code class="reqn">K</code> treatments by <code class="reqn">\pi_{1},\ldots,\pi_{K},\;</code>we can compute <code class="reqn">K</code> posterior probabilities: <code class="reqn">r_{k,n} = Pr(\pi_{k} = max\{\pi_{1},\ldots,\pi_{K}\}\;|\;Data_{n})</code>, here, <code class="reqn">n</code> refers to the <code class="reqn">n</code>-th patient and <code class="reqn">k</code> refers to the <code class="reqn">k</code>-th arm. We calculate the updated probabilities of the BAR algorithm according to the following steps.<br /> <code class="reqn">\;</code><br /> Step 1: (Normalization) Normalize <code class="reqn">r_{k,n}</code> as <code class="reqn">r_{k,n}^{(c)} = \frac{(r_{k,n})^{c}}{\sum_{j=1}^{K}(r_{j,n})^{c}}</code>, here <code class="reqn">\;c = \frac{n}{2N}</code>.<br /> <br />
Step 2: (Restriction) To avoid the BAR sticking to very low/high probabilities, a restriction rule to the posterior probability <code class="reqn">r_{k,n}^{(c)}</code> will be applied: </p>
<p style="text-align: center;"><code class="reqn">Lower\;Bound \le r_{k,n}^{(c)} \le 1 - (K - 1) \times Lower\;Bound,</code>
</p>

<p style="text-align: center;"><code class="reqn">0 \le Lower\;Bound \le \frac{1}{K}</code>
</p>

<p>After restriction, the posterior probability is denoted as <code class="reqn">r_{k,n}^{(c,re)}</code>.<br /> <br />
Step 3: (Re-normalization) Then, we can have the updated allocation probabilities by the BAR denoted as:</p>
<p style="text-align: center;"><code class="reqn">r_{k,n}^{(f)} = \frac{r_{k,n}^{(c,re)}\times(\frac{r_{k,n}^{(c,re)}}{\frac{n_{k}}{n}})^{2}}{\sum_{j=1}^{K}\{r_{j,n}^{(c,re)}\times(\frac{r_{j,n}^{(c,re)}}{\frac{n_{j}}{n}})^{2}\}}</code>
</p>
<p> where <code class="reqn">n_{k}</code> is the number of patients enrolled on arm <code class="reqn">k</code> up-to-now.<br /> <br />
Step 4: (Re-restriction) Finally, restricts again by using </p>
<p style="text-align: center;"><code class="reqn">Lower\;Bound \le r_{k,n}^{(f)} \le 1 - (K-1) \times Lower\;Bound,</code>
</p>

<p style="text-align: center;"><code class="reqn">0 \le Lower\;Bound \le \frac{1}{K}</code>
</p>
<p>and denote <code class="reqn">r_{k,n}^{(ff)}</code> as the allocation probability used in the BAR package.
</p>


<h3>Value</h3>

<p><code>get_oc_BAR()</code> depending on the argument &quot;output&quot;, it returns:
</p>
<p>default: (1) the average allocation probability (2) the average number of patients assigned to each arm
</p>
<p>raw: (1) updated allocation probability path after burn-in for each arm for each simulated
trial
</p>


<h3>Author(s)</h3>

<p>Chia-Wei Hsu, Haitao Pan
</p>


<h3>References</h3>

<p>Wathen JK, Thall PF. A simulation study of outcome adaptive randomization in multi-arm clinical trials. Clin Trials. 2017 Oct; 14(5): 432-440. doi: 10.1177/1740774517692302.
</p>
<p>Xiao, Y., Liu, Z. &amp; Hu, F. Bayesian doubly adaptive randomization in clinical trials. Sci. China Math. 60, 2503-2514 (2017). doi: 10.1007/s11425-016-0056-1.
</p>
<p>Hu F, Zhang L X. Asymptotic properties of doubly adaptive biased coin designs for multi-treatment clinical trials. Ann Statist, 2004, 30: 268–301.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## power_c = "n/2N"
get_oc_BAR(success_prob = c(.1, .5, .8), n_burn_in = 10,
           tot_num = 150, block_size = 1, reptime = 5)

## power_c = .5
get_oc_BAR(success_prob = c(.1, .5, .8), n_burn_in = 10,
           tot_num = 150, block_size = 1, power_c = .5,
           reptime = 5)
</code></pre>

<hr>
<h2 id='next_allocation_rate_BAR'>
Calculate the allocation probability for the next block of new patients using Bayesian adaptive randomization
</h2><span id='topic+next_allocation_rate_BAR'></span>

<h3>Description</h3>

<p>Calculate updated allocation probability for each arm based on the accumulative data with binary outcomes
</p>


<h3>Usage</h3>

<pre><code class='language-R'>next_allocation_rate_BAR(n, success_count, tot_num,
                         power_c = "n/2N",
                         lower_bound = .05,
                         control_arm = "",
                         seed = 100)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="next_allocation_rate_BAR_+3A_n">n</code></td>
<td>

<p>the number of patients enrolled for each arm
</p>
</td></tr>
<tr><td><code id="next_allocation_rate_BAR_+3A_success_count">success_count</code></td>
<td>

<p>the number of responders for each arm
</p>
</td></tr>
<tr><td><code id="next_allocation_rate_BAR_+3A_tot_num">tot_num</code></td>
<td>

<p>the total number of patients enrolled for the trial. If this number cannot be pre-planned, the user can choose argument &quot;power_c&quot; to be numeric instead of &quot;n/2N&quot;. In this case, even if the &quot;tot_num&quot; is given a number, this number will not be used
</p>
</td></tr>
<tr><td><code id="next_allocation_rate_BAR_+3A_power_c">power_c</code></td>
<td>

<p>the power correction of allocation probability. The default value is power_c = &quot;n/2N&quot; and can also be numeric, e.g., power_c = .5
</p>
</td></tr>
<tr><td><code id="next_allocation_rate_BAR_+3A_lower_bound">lower_bound</code></td>
<td>

<p>the lower bound of the allocation probability. It must between 0 and <code class="reqn">\frac{1}{K}</code>. The default value is lower_bound = .05; K indicates total number of arms (including control arm)
</p>
</td></tr>
<tr><td><code id="next_allocation_rate_BAR_+3A_control_arm">control_arm</code></td>
<td>

<p>if this argument is &quot;fixed&quot;, then allocation probability of control arm (the first slot)
will be fixed to <code class="reqn">\frac{1}{K}</code>. The default of this argument will return unfixed results; K indicates total number of arms (including control arm)
</p>
</td></tr>
<tr><td><code id="next_allocation_rate_BAR_+3A_seed">seed</code></td>
<td>

<p>the seed. The default value is seed = 100
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We show how the updated allocation probabilities for each arm are calculated.<br /> <br /> Treatments are denoted by <code class="reqn">k = 1,\ldots,K</code>.<code class="reqn">\;N</code> is the total sample size. If no burn-in(s), the BAR will be initiated start of a study, that is, for each enrolled patient, <code class="reqn">n = 1,\ldots,N,</code> the BAR will be used to assign each patient. Denoting the true unknown response rates of <code class="reqn">K</code> treatments by <code class="reqn">\pi_{1},\ldots,\pi_{K},\;</code>we can compute <code class="reqn">K</code> posterior probabilities: <code class="reqn">r_{k,n} = Pr(\pi_{k} = max\{\pi_{1},\ldots,\pi_{K}\}\;|\;Data_{n})</code>, here, <code class="reqn">n</code> refers to the <code class="reqn">n</code>-th patient and <code class="reqn">k</code> refers to the <code class="reqn">k</code>-th arm. We calculate the updated probabilities of the BAR algorithm according to the following steps.<br /> <code class="reqn">\;</code><br /> Step 1: (Normalization) Normalize <code class="reqn">r_{k,n}</code> as <code class="reqn">r_{k,n}^{(c)} = \frac{(r_{k,n})^{c}}{\sum_{j=1}^{K}(r_{j,n})^{c}}</code>, here <code class="reqn">\;c = \frac{n}{2N}</code>.<br /> <br />
Step 2: (Restriction) To avoid the BAR sticking to very low/high probabilities, a restriction rule to the posterior probability <code class="reqn">r_{k,n}^{(c)}</code> will be applied: </p>
<p style="text-align: center;"><code class="reqn">Lower\;Bound \le r_{k,n}^{(c)} \le 1 - (K - 1) \times Lower\;Bound,</code>
</p>

<p style="text-align: center;"><code class="reqn">0 \le Lower\;Bound \le \frac{1}{K}</code>
</p>

<p>After restriction, the posterior probability is denoted as <code class="reqn">r_{k,n}^{(c,re)}</code>.<br /> <br />
Step 3: (Re-normalization) Then, we can have the updated allocation probabilities by the BAR denoted as:</p>
<p style="text-align: center;"><code class="reqn">r_{k,n}^{(f)} = \frac{r_{k,n}^{(c,re)}\times(\frac{r_{k,n}^{(c,re)}}{\frac{n_{k}}{n}})^{2}}{\sum_{j=1}^{K}\{r_{j,n}^{(c,re)}\times(\frac{r_{j,n}^{(c,re)}}{\frac{n_{j}}{n}})^{2}\}}</code>
</p>
<p> where <code class="reqn">n_{k}</code> is the number of patients enrolled on arm <code class="reqn">k</code> up-to-now.<br /> <br />
Step 4: (Re-restriction) Finally, restricts again by using </p>
<p style="text-align: center;"><code class="reqn">Lower\;Bound \le r_{k,n}^{(f)} \le 1 - (K-1) \times Lower\;Bound,</code>
</p>

<p style="text-align: center;"><code class="reqn">0 \le Lower\;Bound \le \frac{1}{K}</code>
</p>
<p>and denote <code class="reqn">r_{k,n}^{(ff)}</code> as the allocation probability used in the BAR package.
</p>


<h3>Value</h3>

<p><code>next_allocation_rate_BAR()</code> returns the updated allocation probability for each arm
</p>


<h3>Author(s)</h3>

<p>Chia-Wei Hsu, Haitao Pan
</p>


<h3>References</h3>

<p>Wathen JK, Thall PF. A simulation study of outcome adaptive randomization in multi-arm clinical trials. Clin Trials. 2017 Oct; 14(5): 432-440. doi: 10.1177/1740774517692302.
</p>
<p>Xiao, Y., Liu, Z. &amp; Hu, F. Bayesian doubly adaptive randomization in clinical trials. Sci. China Math. 60, 2503-2514 (2017). doi: 10.1007/s11425-016-0056-1.
</p>
<p>Hu F, Zhang L X. Asymptotic properties of doubly adaptive biased coin designs for multi-treatment clinical trials. Ann Statist, 2004, 30: 268–301.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## power_c = "n/2N"
next_allocation_rate_BAR(n = c(30, 30, 30),
                         success_count = c(5, 6, 12),
                         tot_num = 150)

## power_c = .5
next_allocation_rate_BAR(n = c(30, 30, 30),
                         success_count = c(5, 6, 12),
                         tot_num = 150, power_c = .5)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
