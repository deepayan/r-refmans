<!DOCTYPE html><html><head><title>Help for package testdat</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {testdat}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#chk-dates'><p>Checks: dates</p></a></li>
<li><a href='#chk-defunct'><p>Defunct checking functions</p></a></li>
<li><a href='#chk-deprec'><p>Deprecated checking functions</p></a></li>
<li><a href='#chk-dummy'><p>Checks: dummy</p></a></li>
<li><a href='#chk-helper'><p>Checks: data frame helpers</p></a></li>
<li><a href='#chk-labels'><p>Checks: labels</p></a></li>
<li><a href='#chk-patterns'><p>Checks: patterns</p></a></li>
<li><a href='#chk-text'><p>Checks: text</p></a></li>
<li><a href='#chk-uniqueness'><p>Checks: uniqueness</p></a></li>
<li><a href='#chk-values'><p>Checks: values</p></a></li>
<li><a href='#conditional-expectations'><p>Expectations: consistency</p></a></li>
<li><a href='#data-params'><p>Expectation params</p></a></li>
<li><a href='#datacomp-expectations'><p>Expectations: comparisons</p></a></li>
<li><a href='#date-expectations'><p>Expectations: dates</p></a></li>
<li><a href='#exclusivity-expectations'><p>Expectations: exclusivity</p></a></li>
<li><a href='#expect_custom'><p>Extension of 'expect' to allow inclusion of custom fields</p></a></li>
<li><a href='#expect_depends'><p>Expectations: functional dependency</p></a></li>
<li><a href='#expect_make'><p>Create an expectation from a check function</p></a></li>
<li><a href='#expect-defunct'><p>Defunct expectation functions</p></a></li>
<li><a href='#expect-deprec'><p>Deprecated expectation functions</p></a></li>
<li><a href='#generic-expectations'><p>Expectations: generic helpers</p></a></li>
<li><a href='#global-data'><p>Get/set test data</p></a></li>
<li><a href='#label-expectations'><p>Expectations: labels</p></a></li>
<li><a href='#output_results_excel'><p>Output <code>ListReporter</code> results in Excel format</p></a></li>
<li><a href='#pattern-expectations'><p>Expectations: patterns</p></a></li>
<li><a href='#proportion-expectations'><p>Expectations: proportions</p></a></li>
<li><a href='#reexports'><p>Objects exported from other packages</p></a></li>
<li><a href='#reporter-deprec'><p>Deprecated reporter functions</p></a></li>
<li><a href='#testdat-package'><p>testdat: Data Unit Testing for R</p></a></li>
<li><a href='#text-expectations'><p>Expectations: text</p></a></li>
<li><a href='#uniqueness-expectations'><p>Expectations: uniqueness</p></a></li>
<li><a href='#value-expectations'><p>Expectations: values</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Data Unit Testing for R</td>
</tr>
<tr>
<td>Version:</td>
<td>0.4.2</td>
</tr>
<tr>
<td>Description:</td>
<td>Test your data! An extension of the 'testthat' unit testing
    framework with a family of functions and reporting tools for checking
    and validating data frames.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://socialresearchcentre.github.io/testdat/">https://socialresearchcentre.github.io/testdat/</a>,
<a href="https://github.com/socialresearchcentre/testdat">https://github.com/socialresearchcentre/testdat</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/socialresearchcentre/testdat/issues">https://github.com/socialresearchcentre/testdat/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.2.2), testthat (&ge; 2.0.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr (&ge; 0.8.0), glue, lifecycle, rlang, stringr, tidyselect</td>
</tr>
<tr>
<td>Suggests:</td>
<td>covr, crayon, knitr, labelled, lubridate, openxlsx, rmarkdown</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Collate:</td>
<td>'chk-filter.R' 'chk.R' 'comparison.R' 'deprec-chk.R'
'deprec-expect.R' 'deprec-reporter.R' 'expectation.R'
'expect-generic.R' 'expect-make.R' 'expect-chk.R'
'expect-conditional.R' 'expect-data.R' 'expect-datacomp.R'
'expect-exclusive.R' 'expect-labels.R' 'expect-proportion.R'
'expect-unique.R' 'expect_depends.R' 'reporter-excel.R'
'reporter-zzz.R' 'testdat-package.R' 'utils.R' 'zzz.R'</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-09-03 23:49:23 UTC; danny.smith</td>
</tr>
<tr>
<td>Author:</td>
<td>Danny Smith [aut, cre],
  Kinto Behr [aut],
  The Social Research Centre [cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Danny Smith &lt;danny@gorcha.org&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-09-04 00:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='chk-dates'>Checks: dates</h2><span id='topic+chk-dates'></span><span id='topic+chk_date_yyyymmdd'></span><span id='topic+chk_date_yyyymm'></span><span id='topic+chk_date_yyyy'></span>

<h3>Description</h3>

<p>Check that a vector conforms to a given date format such as YYYYMMDD.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chk_date_yyyymmdd(x)

chk_date_yyyymm(x)

chk_date_yyyy(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="chk-dates_+3A_x">x</code></td>
<td>
<p>A vector to check.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A logical vector flagging records that have passed or failed the
check.
</p>


<h3>See Also</h3>

<p><a href="#topic+chk-helper">Checks: data frame helpers</a>
</p>
<p><a href="#topic+date-expectations">Expectations: dates</a>
</p>
<p>Other vector checks: 
<code><a href="#topic+chk-dummy">chk-dummy</a></code>,
<code><a href="#topic+chk-labels">chk-labels</a></code>,
<code><a href="#topic+chk-patterns">chk-patterns</a></code>,
<code><a href="#topic+chk-text">chk-text</a></code>,
<code><a href="#topic+chk-uniqueness">chk-uniqueness</a></code>,
<code><a href="#topic+chk-values">chk-values</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
date &lt;- c(20210101, 20211301, 20210132, 202101, 2021)
chk_date_yyyymmdd(date)

date &lt;- c(202101, 202112, 202113, 2021)
chk_date_yyyymm(date)

date &lt;- c("0001", "1688", "1775", "1789", "1791", "1848")
chk_date_yyyy(date)

</code></pre>

<hr>
<h2 id='chk-defunct'>Defunct checking functions</h2><span id='topic+chk-defunct'></span><span id='topic+chk_filter_vars'></span><span id='topic+chk_filter_where'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#defunct"><img src="../help/figures/lifecycle-defunct.svg" alt='[Defunct]' /></a>
</p>
<p>These functions are defunct.
</p>

<ul>
<li> <p><code>chk_filter_where()</code> works exactly like <code>chk_filter_all()</code>. When testdat
used <code>dplyr::vars()</code> as standard <code>chk_filter_where()</code> provided an alternative
interface using <code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>chk_filter_vars(data, vars, func, flt = TRUE, args = list())

chk_filter_where(data, where, func, flt = TRUE, args = list())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="chk-defunct_+3A_where">where</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt; Columns to check.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A logical vector flagging records that have passed or failed the
check.
</p>


<h3>See Also</h3>

<p><code style="white-space: pre;">&#8288;chk_*()&#8288;</code> functions such as <code><a href="#topic+chk-values">chk_values()</a></code>
</p>
<p><a href="#topic+chk-helper">Checking Helper Functions</a>
</p>

<hr>
<h2 id='chk-deprec'>Deprecated checking functions</h2><span id='topic+chk-deprec'></span><span id='topic+chk_length'></span><span id='topic+chk_miss'></span><span id='topic+chk_nmiss'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a>
</p>
<p>These functions are deprecated.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chk_length(x, len)

chk_miss(x, miss = getOption("testdat.miss_text"))

chk_nmiss(x, miss = getOption("testdat.miss_text"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="chk-deprec_+3A_x">x</code></td>
<td>
<p>A vector to check.</p>
</td></tr>
<tr><td><code id="chk-deprec_+3A_len">len</code></td>
<td>
<p>Maximum string length for checking string variables.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A logical vector flagging records that have passed or failed the
check.
</p>


<h3>See Also</h3>

<p><code style="white-space: pre;">&#8288;chk_*()&#8288;</code> functions such as <code><a href="#topic+chk-values">chk_values()</a></code>
</p>
<p><a href="#topic+chk-helper">Checking Helper Functions</a>
</p>

<hr>
<h2 id='chk-dummy'>Checks: dummy</h2><span id='topic+chk-dummy'></span><span id='topic+chk_dummy'></span>

<h3>Description</h3>

<p>These functions provide common, simple data checks.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chk_dummy(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="chk-dummy_+3A_x">x</code></td>
<td>
<p>A vector to check.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A logical vector flagging records that have passed or failed the
check.
</p>


<h3>See Also</h3>

<p><a href="#topic+chk-helper">Checks: data frame helpers</a>
</p>
<p>Other vector checks: 
<code><a href="#topic+chk-dates">chk-dates</a></code>,
<code><a href="#topic+chk-labels">chk-labels</a></code>,
<code><a href="#topic+chk-patterns">chk-patterns</a></code>,
<code><a href="#topic+chk-text">chk-text</a></code>,
<code><a href="#topic+chk-uniqueness">chk-uniqueness</a></code>,
<code><a href="#topic+chk-values">chk-values</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
chk_dummy(LETTERS)

</code></pre>

<hr>
<h2 id='chk-helper'>Checks: data frame helpers</h2><span id='topic+chk-helper'></span><span id='topic+chk_filter'></span><span id='topic+chk_filter_all'></span><span id='topic+chk_filter_any'></span>

<h3>Description</h3>

<p>These helper functions allowing easy checking using an arbitrary function
(<code>func</code>) over multiple columns (<code>vars</code>) of a data frame (<code>data</code>), with an
optional filter (<code>flt</code>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chk_filter(data, vars, func, flt = TRUE, args = list())

chk_filter_all(data, vars, func, flt = TRUE, args = list())

chk_filter_any(data, vars, func, flt = TRUE, args = list())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="chk-helper_+3A_data">data</code></td>
<td>
<p>A data frame to check.</p>
</td></tr>
<tr><td><code id="chk-helper_+3A_vars">vars</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt; A set of columns to
check.</p>
</td></tr>
<tr><td><code id="chk-helper_+3A_func">func</code></td>
<td>
<p>A function to use for checking that takes a vector as the first
argument and returns a logical vector of the same length showing whether an
element passed or failed.</p>
</td></tr>
<tr><td><code id="chk-helper_+3A_flt">flt</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_data_masking">data-masking</a></code>&gt; A filter specifying
a subset of the data frame to test.</p>
</td></tr>
<tr><td><code id="chk-helper_+3A_args">args</code></td>
<td>
<p>A list of additional arguments to be added to the function calls.</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li> <p><code>chk_filter()</code> applies <code>func</code> with <code>args</code> to <code>vars</code> in <code>data</code> filtered
with <code>flt</code> and returns a data frame containing the resulting logical vectors.
</p>
</li>
<li> <p><code>chk_filter_all()</code> and <code>chk_filter_any()</code> both run <code>chk_filter()</code> and
return a single logical vector flagging whether <em>all</em> or <em>any</em> values in each
row are <code>TRUE</code> (i.e. the conjunction and disjunction, respectively, of the
columns in the output of <code>chk_filter()</code>).
</p>
</li></ul>



<h3>Value</h3>

<p>A logical vector or data frame of logical vectors flagging records
that have passed or failed the check, with <code>NA</code> where records do not meet
the filter condition.
</p>


<h3>See Also</h3>

<p>Other <code style="white-space: pre;">&#8288;chk_*()&#8288;</code> functions such as <code><a href="#topic+chk-values">chk_values()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Check that every 4-cylinder car has an engine displacement of &lt; 100 cubic
# inches AND &lt; 100 horsepower - return a data frame
chk_filter(
  mtcars,
  c("disp", "hp"),
  chk_range,
  cyl == 4,
  list(min = 0, max = 100)
)

# Check that every 4-cylinder car has an engine displacement of &lt; 100 cubic
# inches AND &lt; 100 horsepower
chk_filter_all(
  mtcars,
  c("disp", "hp"),
  chk_range,
  cyl == 4,
  list(min = 0, max = 100)
)

# Check that every 4-cylinder car has an engine displacement of &lt; 100 cubic
# inches OR &lt; 100 horsepower
chk_filter_any(
  mtcars,
  c("disp", "hp"),
  chk_range,
  cyl == 4,
  list(min = 0, max = 100)
)

# Check that columns made up of whole numbers are binary
chk_filter_all(
  mtcars,
  where(~ all(. %% 1 == 0)),
  chk_values,
  TRUE,
  list(0:1)
)

</code></pre>

<hr>
<h2 id='chk-labels'>Checks: labels</h2><span id='topic+chk-labels'></span><span id='topic+chk_labels'></span>

<h3>Description</h3>

<p>Check that a vector is labelled in a given way.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chk_labels(x, val_labels = NULL, var_label = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="chk-labels_+3A_x">x</code></td>
<td>
<p>A vector to check.</p>
</td></tr>
<tr><td><code id="chk-labels_+3A_val_labels">val_labels</code></td>
<td>
<p>What value label check should be performed? One of:
</p>

<ul>
<li><p> A character vector of expected value labels.
</p>
</li>
<li><p> A named vector of expected label-value pairs.
</p>
</li>
<li> <p><code>TRUE</code> to test for the presence of value labels in general.
</p>
</li>
<li> <p><code>FALSE</code> to test for the absence of value labels.
</p>
</li>
<li> <p><code>NULL</code> to ignore value labels when checking.
</p>
</li></ul>
</td></tr>
<tr><td><code id="chk-labels_+3A_var_label">var_label</code></td>
<td>
<p>What variable label check should be performed? One of:
</p>

<ul>
<li><p> A character vector of expected variable labels.
</p>
</li>
<li> <p><code>TRUE</code> to test for the presence of a variable labels.
</p>
</li>
<li> <p><code>FALSE</code> to test for the absence of a variable labels.
</p>
</li>
<li> <p><code>NULL</code> to ignore the variable label when checking.
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>A logical vector flagging records that have passed or failed the
check.
</p>


<h3>See Also</h3>

<p><a href="#topic+chk-helper">Checks: data frame helpers</a>
</p>
<p><a href="#topic+label-expectations">Expectations: labels</a>
</p>
<p>Other vector checks: 
<code><a href="#topic+chk-dates">chk-dates</a></code>,
<code><a href="#topic+chk-dummy">chk-dummy</a></code>,
<code><a href="#topic+chk-patterns">chk-patterns</a></code>,
<code><a href="#topic+chk-text">chk-text</a></code>,
<code><a href="#topic+chk-uniqueness">chk-uniqueness</a></code>,
<code><a href="#topic+chk-values">chk-values</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
df &lt;- data.frame(
  x = labelled::labelled(c("M", "M", "F"), c(Male = "M", Female = "F"), "Sex"),
  y = labelled::labelled(c("M", "M", "F"), c(Male = "M", Female = "F", Other = "X")),
  z = c("M", "M", "F")
)

# Check for a value-label pairing
chk_labels(df$x, c(Male = "M"))

# Check that two variables have the same values
chk_labels(df$x, labelled::val_labels(df$y))

# Check for the presence of a particular label
chk_labels(df$x, "Male")
chk_labels(df$x, var_label = "Sex")

# Check that a variable is labelled at all
chk_labels(df$z, val_labels = TRUE)
chk_labels(df$z, var_label = TRUE)

# Check that a variable isn't labelled
chk_labels(df$z, val_labels = FALSE)
chk_labels(df$z, var_label = FALSE)

</code></pre>

<hr>
<h2 id='chk-patterns'>Checks: patterns</h2><span id='topic+chk-patterns'></span><span id='topic+chk_regex'></span><span id='topic+chk_max_length'></span>

<h3>Description</h3>

<p>Check that a vector conforms to a certain pattern.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chk_regex(x, pattern)

chk_max_length(x, len)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="chk-patterns_+3A_x">x</code></td>
<td>
<p>A vector to check.</p>
</td></tr>
<tr><td><code id="chk-patterns_+3A_pattern">pattern</code></td>
<td>
<p>A <a href="stringr.html#topic+str_detect">str_detect()</a> pattern to match.</p>
</td></tr>
<tr><td><code id="chk-patterns_+3A_len">len</code></td>
<td>
<p>Maximum string length.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A logical vector flagging records that have passed or failed the
check.
</p>


<h3>See Also</h3>

<p><a href="#topic+chk-helper">Checks: data frame helpers</a>
</p>
<p><a href="#topic+pattern-expectations">Expectations: patterns</a>
</p>
<p>Other vector checks: 
<code><a href="#topic+chk-dates">chk-dates</a></code>,
<code><a href="#topic+chk-dummy">chk-dummy</a></code>,
<code><a href="#topic+chk-labels">chk-labels</a></code>,
<code><a href="#topic+chk-text">chk-text</a></code>,
<code><a href="#topic+chk-uniqueness">chk-uniqueness</a></code>,
<code><a href="#topic+chk-values">chk-values</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
x &lt;- c("a_1", "b_2", "c_2", NA, "NULL")
chk_regex(x, "[a-z]_[0-9]")
chk_max_length(x, 3)

</code></pre>

<hr>
<h2 id='chk-text'>Checks: text</h2><span id='topic+chk-text'></span><span id='topic+chk_ascii'></span><span id='topic+chk_text_miss'></span><span id='topic+chk_text_nmiss'></span>

<h3>Description</h3>

<p>Check character vectors for non-ASCII characters or common NULL value
placeholders.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chk_ascii(x)

chk_text_miss(x, miss = getOption("testdat.miss_text"))

chk_text_nmiss(x, miss = getOption("testdat.miss_text"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="chk-text_+3A_x">x</code></td>
<td>
<p>A vector to check.</p>
</td></tr>
<tr><td><code id="chk-text_+3A_miss">miss</code></td>
<td>
<p>A vector of values to be treated as missing. The
<a href="#topic+testdat">testdat.miss</a> or <a href="#topic+testdat">testdat.miss_text</a> option is used by
default.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A logical vector flagging records that have passed or failed the
check.
</p>


<h3>See Also</h3>

<p><a href="#topic+chk-helper">Checks: data frame helpers</a>
</p>
<p><a href="#topic+text-expectations">Expectations: text</a>
</p>
<p>Other vector checks: 
<code><a href="#topic+chk-dates">chk-dates</a></code>,
<code><a href="#topic+chk-dummy">chk-dummy</a></code>,
<code><a href="#topic+chk-labels">chk-labels</a></code>,
<code><a href="#topic+chk-patterns">chk-patterns</a></code>,
<code><a href="#topic+chk-uniqueness">chk-uniqueness</a></code>,
<code><a href="#topic+chk-values">chk-values</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
chk_ascii(c("a", "\U1f642")) # detect non-ASCII characters

imported_data &lt;- c(1, "#n/a", 2, "", 3, NA)
chk_text_miss(imported_data)
chk_text_nmiss(imported_data) # Equivalent to !chk_text_miss(imported_data)

</code></pre>

<hr>
<h2 id='chk-uniqueness'>Checks: uniqueness</h2><span id='topic+chk-uniqueness'></span><span id='topic+chk_unique'></span>

<h3>Description</h3>

<p>Check that each value in a vector is unique.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chk_unique(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="chk-uniqueness_+3A_x">x</code></td>
<td>
<p>A vector to check.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A logical vector flagging records that have passed or failed the
check.
</p>


<h3>See Also</h3>

<p><a href="#topic+chk-helper">Checks: data frame helpers</a>
</p>
<p><a href="#topic+uniqueness-expectations">Expectations: uniqueness</a>
</p>
<p>Other vector checks: 
<code><a href="#topic+chk-dates">chk-dates</a></code>,
<code><a href="#topic+chk-dummy">chk-dummy</a></code>,
<code><a href="#topic+chk-labels">chk-labels</a></code>,
<code><a href="#topic+chk-patterns">chk-patterns</a></code>,
<code><a href="#topic+chk-text">chk-text</a></code>,
<code><a href="#topic+chk-values">chk-values</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
x &lt;- c(NA, 1:10, NA)
chk_unique(x)

x &lt;- c(10, 1:10, 10)
chk_unique(x)

</code></pre>

<hr>
<h2 id='chk-values'>Checks: values</h2><span id='topic+chk-values'></span><span id='topic+chk_equals'></span><span id='topic+chk_values'></span><span id='topic+chk_range'></span><span id='topic+chk_blank'></span>

<h3>Description</h3>

<p>Check that a vector contains only certain values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chk_equals(x, val)

chk_values(x, ..., miss = getOption("testdat.miss"))

chk_range(x, min, max, ...)

chk_blank(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="chk-values_+3A_x">x</code></td>
<td>
<p>A vector to check.</p>
</td></tr>
<tr><td><code id="chk-values_+3A_val">val</code></td>
<td>
<p>A scalar value for the equality check.</p>
</td></tr>
<tr><td><code id="chk-values_+3A_...">...</code></td>
<td>
<p>Vectors of valid values.</p>
</td></tr>
<tr><td><code id="chk-values_+3A_miss">miss</code></td>
<td>
<p>A vector of values to be treated as missing. The
<a href="#topic+testdat">testdat.miss</a> or <a href="#topic+testdat">testdat.miss_text</a> option is used by
default.</p>
</td></tr>
<tr><td><code id="chk-values_+3A_min">min</code></td>
<td>
<p>Minimum value for range check.</p>
</td></tr>
<tr><td><code id="chk-values_+3A_max">max</code></td>
<td>
<p>Maximum value for range check.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A logical vector flagging records that have passed or failed the
check.
</p>


<h3>See Also</h3>

<p><a href="#topic+chk-helper">Checks: data frame helpers</a>
</p>
<p><a href="#topic+value-expectations">Expectations: values</a>
</p>
<p>Other vector checks: 
<code><a href="#topic+chk-dates">chk-dates</a></code>,
<code><a href="#topic+chk-dummy">chk-dummy</a></code>,
<code><a href="#topic+chk-labels">chk-labels</a></code>,
<code><a href="#topic+chk-patterns">chk-patterns</a></code>,
<code><a href="#topic+chk-text">chk-text</a></code>,
<code><a href="#topic+chk-uniqueness">chk-uniqueness</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
x &lt;- c(NA, 0, 1, 0.5, 0, NA, 99)
chk_blank(x) # Blank
chk_equals(x, 0) # Either blank or 0
chk_values(x, 0, 1) # Either blank, 0, 1, or 99
chk_range(x, 0, 1) # Either blank or in [0,1]
chk_range(x, 0, 1, 99) # Either blank, in [0,1], or equal to 99

</code></pre>

<hr>
<h2 id='conditional-expectations'>Expectations: consistency</h2><span id='topic+conditional-expectations'></span><span id='topic+expect_cond'></span><span id='topic+expect_base'></span>

<h3>Description</h3>

<p>These functions test whether multiple conditions coexist.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expect_cond(cond1, cond2, data = get_testdata())

expect_base(
  var,
  base,
  miss = getOption("testdat.miss"),
  missing_valid = FALSE,
  data = get_testdata()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="conditional-expectations_+3A_cond1">cond1</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_data_masking">data-masking</a></code>&gt; First condition
(antecedent) for consistency check.</p>
</td></tr>
<tr><td><code id="conditional-expectations_+3A_cond2">cond2</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_data_masking">data-masking</a></code>&gt; Second condition
(consequent) for consistency check.</p>
</td></tr>
<tr><td><code id="conditional-expectations_+3A_data">data</code></td>
<td>
<p>A data frame to test. The <a href="#topic+global-data">global test data</a> is used
by default.</p>
</td></tr>
<tr><td><code id="conditional-expectations_+3A_var">var</code></td>
<td>
<p>An unquoted column name to test.</p>
</td></tr>
<tr><td><code id="conditional-expectations_+3A_base">base</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_data_masking">data-masking</a></code>&gt; The condition that
determines which records should be non-missing.</p>
</td></tr>
<tr><td><code id="conditional-expectations_+3A_miss">miss</code></td>
<td>
<p>A vector of values to be treated as missing. The
<a href="#topic+testdat">testdat.miss</a> option is used by default.</p>
</td></tr>
<tr><td><code id="conditional-expectations_+3A_missing_valid">missing_valid</code></td>
<td>
<p>Should missing values be treated as valid for records
meeting the <code>base</code> condition? This allows 'one way' base checks. This is
<code>FALSE</code> by default.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code style="white-space: pre;">&#8288;expect_*()&#8288;</code> functions are mainly called for their side effects. The
expectation signals its result (e.g. &quot;success&quot;, &quot;failure&quot;), which is logged
by the current <a href="testthat.html#topic+Reporter">test reporter</a>. In a non-testing
context the expectation will raise an error with class
<code>expectation_failure</code> if it fails.
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>expect_cond()</code>: Checks the coexistence of two
conditions. It can be read as &quot;if <code>cond1</code> then <code>cond2</code>&quot;.
</p>
</li>
<li> <p><code>expect_base()</code>: A special case that checks missing data
against a specified condition. It can be read as &quot;if <code>base</code> then <code>var</code> not
missing, if not <code>base</code> then <code>var</code> missing&quot;.
</p>
</li></ul>


<h3>See Also</h3>

<p>Other data expectations: 
<code><a href="#topic+datacomp-expectations">datacomp-expectations</a></code>,
<code><a href="#topic+date-expectations">date-expectations</a></code>,
<code><a href="#topic+exclusivity-expectations">exclusivity-expectations</a></code>,
<code><a href="#topic+expect_depends">expect_depends</a>()</code>,
<code><a href="#topic+generic-expectations">generic-expectations</a></code>,
<code><a href="#topic+label-expectations">label-expectations</a></code>,
<code><a href="#topic+pattern-expectations">pattern-expectations</a></code>,
<code><a href="#topic+proportion-expectations">proportion-expectations</a></code>,
<code><a href="#topic+text-expectations">text-expectations</a></code>,
<code><a href="#topic+uniqueness-expectations">uniqueness-expectations</a></code>,
<code><a href="#topic+value-expectations">value-expectations</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>my_survey &lt;- data.frame(
  resp_id = 1:5,
  q1a = c(0, 1, 0, 1, 0),
  q1b = c(NA, NA, NA, 1, 0), # Asked if q1a %in% 1
  q2a = c(90, 80, 60, 40, 90),
  q2b = c("", "", NA, "Some reason for low rating", "") # Asked if q2a &lt; 50
)

# Check that q1b has a value if and only if q1a %in% 1
try(expect_base(q1b, q1a %in% 1, data = my_survey)) # Fails for resp_id 2 and 5

# Check that q2b has a value if and only if q2a &lt; 50
expect_base(q2b, q2a &lt; 50, data = my_survey)

# Check that if q1a %in% 0 then q2a &gt; 50 (but not vice-versa)
expect_cond(q1a %in% 0, q2a &gt; 50, data = my_survey)

</code></pre>

<hr>
<h2 id='data-params'>Expectation params</h2><span id='topic+data-params'></span>

<h3>Description</h3>

<p>Expectation params
</p>


<h3>Arguments</h3>

<table>
<tr><td><code id="data-params_+3A_var">var</code></td>
<td>
<p>An unquoted column name to test.</p>
</td></tr>
<tr><td><code id="data-params_+3A_vars">vars</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt; A set of columns to
test.</p>
</td></tr>
<tr><td><code id="data-params_+3A_flt">flt</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_data_masking">data-masking</a></code>&gt; A filter specifying
a subset of the data frame to test.</p>
</td></tr>
<tr><td><code id="data-params_+3A_miss">miss</code></td>
<td>
<p>A vector of values to be treated as missing. The
<a href="#topic+testdat">testdat.miss</a> option is used by default.</p>
</td></tr>
<tr><td><code id="data-params_+3A_data">data</code></td>
<td>
<p>A data frame to test. The <a href="#topic+global-data">global test data</a> is used
by default.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code style="white-space: pre;">&#8288;expect_*()&#8288;</code> functions are mainly called for their side effects. The
expectation signals its result (e.g. &quot;success&quot;, &quot;failure&quot;), which is logged
by the current <a href="testthat.html#topic+Reporter">test reporter</a>. In a non-testing
context the expectation will raise an error with class
<code>expectation_failure</code> if it fails.
</p>

<hr>
<h2 id='datacomp-expectations'>Expectations: comparisons</h2><span id='topic+datacomp-expectations'></span><span id='topic+expect_valmatch'></span><span id='topic+expect_subset'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
</p>
<p>These functions allow for comparison between two data frames.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expect_valmatch(
  data2,
  vars,
  by,
  not = FALSE,
  flt = TRUE,
  data = get_testdata()
)

expect_subset(data2, by = NULL, not = FALSE, flt = TRUE, data = get_testdata())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="datacomp-expectations_+3A_data2">data2</code></td>
<td>
<p>The data frame to compare against.</p>
</td></tr>
<tr><td><code id="datacomp-expectations_+3A_vars">vars</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt; A set of columns to
test.</p>
</td></tr>
<tr><td><code id="datacomp-expectations_+3A_by">by</code></td>
<td>
<p>A character vector of columns to join by. See <code><a href="dplyr.html#topic+mutate-joins">dplyr::join()</a></code> for
details.</p>
</td></tr>
<tr><td><code id="datacomp-expectations_+3A_not">not</code></td>
<td>
<p>Reverse the results of the check?</p>
</td></tr>
<tr><td><code id="datacomp-expectations_+3A_flt">flt</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_data_masking">data-masking</a></code>&gt; A filter specifying
a subset of the data frame to test.</p>
</td></tr>
<tr><td><code id="datacomp-expectations_+3A_data">data</code></td>
<td>
<p>A data frame to test. The <a href="#topic+global-data">global test data</a> is used
by default.</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li> <p><code>expect_valmatch()</code> compares the observations appearing in one data frame
(<code>data</code>) to the same observations, as picked out by a key (<code>by</code>), in another
data frame (<code>data2</code>). It fails if the selected columns (<code>vars</code>) aren't the
same for those observations in both data frames.
</p>
</li>
<li> <p><code>expect_subset()</code> compares one data frame (<code>data</code>) to another (<code>data2</code>) and
fails if all of the observations in the first, as picked out by a key (<code>by</code>),
do not appear in the second.
</p>
</li></ul>



<h3>Value</h3>

<p><code style="white-space: pre;">&#8288;expect_*()&#8288;</code> functions are mainly called for their side effects. The
expectation signals its result (e.g. &quot;success&quot;, &quot;failure&quot;), which is logged
by the current <a href="testthat.html#topic+Reporter">test reporter</a>. In a non-testing
context the expectation will raise an error with class
<code>expectation_failure</code> if it fails.
</p>


<h3>See Also</h3>

<p>Other data expectations: 
<code><a href="#topic+conditional-expectations">conditional-expectations</a></code>,
<code><a href="#topic+date-expectations">date-expectations</a></code>,
<code><a href="#topic+exclusivity-expectations">exclusivity-expectations</a></code>,
<code><a href="#topic+expect_depends">expect_depends</a>()</code>,
<code><a href="#topic+generic-expectations">generic-expectations</a></code>,
<code><a href="#topic+label-expectations">label-expectations</a></code>,
<code><a href="#topic+pattern-expectations">pattern-expectations</a></code>,
<code><a href="#topic+proportion-expectations">proportion-expectations</a></code>,
<code><a href="#topic+text-expectations">text-expectations</a></code>,
<code><a href="#topic+uniqueness-expectations">uniqueness-expectations</a></code>,
<code><a href="#topic+value-expectations">value-expectations</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
df1 &lt;- data.frame(
  id = 0:99,
  binomial = sample(0:1, 100, TRUE),
  even = abs(0:99%%2 - 1) * 0:99
)

df2 &lt;- data.frame(
  id = 0:99,
  binomial = sample(0:1, 100, TRUE),
  odd = 0:99%%2 *0:99
)


# Check that same records 'succeeded' across data frames
try(expect_valmatch(df2, binomial, by = "id", data = df1))

# Check that all records in `df1`, as picked out by `id`, exist in `df2`
expect_subset(df2, by = "id", data = df1)

</code></pre>

<hr>
<h2 id='date-expectations'>Expectations: dates</h2><span id='topic+date-expectations'></span><span id='topic+expect_date_yyyy'></span><span id='topic+expect_date_yyyymm'></span><span id='topic+expect_date_yyyymmdd'></span>

<h3>Description</h3>

<p>Test whether variables in a data frame conform to a given date format such as
YYYYMMDD.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expect_date_yyyy(vars, flt = TRUE, data = get_testdata())

expect_date_yyyymm(vars, flt = TRUE, data = get_testdata())

expect_date_yyyymmdd(vars, flt = TRUE, data = get_testdata())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="date-expectations_+3A_vars">vars</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt; A set of columns to
test.</p>
</td></tr>
<tr><td><code id="date-expectations_+3A_flt">flt</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_data_masking">data-masking</a></code>&gt; A filter specifying
a subset of the data frame to test.</p>
</td></tr>
<tr><td><code id="date-expectations_+3A_data">data</code></td>
<td>
<p>A data frame to test. The <a href="#topic+global-data">global test data</a> is used
by default.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code style="white-space: pre;">&#8288;expect_*()&#8288;</code> functions are mainly called for their side effects. The
expectation signals its result (e.g. &quot;success&quot;, &quot;failure&quot;), which is logged
by the current <a href="testthat.html#topic+Reporter">test reporter</a>. In a non-testing
context the expectation will raise an error with class
<code>expectation_failure</code> if it fails.
</p>


<h3>See Also</h3>

<p><a href="#topic+chk-dates">Checks: date</a>
</p>
<p>Other data expectations: 
<code><a href="#topic+conditional-expectations">conditional-expectations</a></code>,
<code><a href="#topic+datacomp-expectations">datacomp-expectations</a></code>,
<code><a href="#topic+exclusivity-expectations">exclusivity-expectations</a></code>,
<code><a href="#topic+expect_depends">expect_depends</a>()</code>,
<code><a href="#topic+generic-expectations">generic-expectations</a></code>,
<code><a href="#topic+label-expectations">label-expectations</a></code>,
<code><a href="#topic+pattern-expectations">pattern-expectations</a></code>,
<code><a href="#topic+proportion-expectations">proportion-expectations</a></code>,
<code><a href="#topic+text-expectations">text-expectations</a></code>,
<code><a href="#topic+uniqueness-expectations">uniqueness-expectations</a></code>,
<code><a href="#topic+value-expectations">value-expectations</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
sales &lt;- data.frame(
  sale_id = 1:5,
  date = c("20200101", "20200101", "20200102", "20200103", "20220101"),
  quarter = c(202006, 202009, 202012, 20203, 20200101),
  published = c(1999, 19991, 21, 0001, 20200101)
)

try(expect_date_yyyymmdd(date, data = sales)) # Full date of sale valid
try(expect_date_yyyymm(quarter, data = sales)) # Quarters given as YYYYMM
try(expect_date_yyyy(published, data = sales)) # Publication years valid

</code></pre>

<hr>
<h2 id='exclusivity-expectations'>Expectations: exclusivity</h2><span id='topic+exclusivity-expectations'></span><span id='topic+expect_exclusive'></span>

<h3>Description</h3>

<p><code>expect_exclusive</code> tests that <code>vars</code> are exclusive - that, if any one of
<code>vars</code> is set to <code>exc_val</code>, no other column in <code>vars</code> or <code>var_set</code> is also
set to <code>exc_val</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expect_exclusive(vars, var_set, exc_val = 1, flt = TRUE, data = get_testdata())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="exclusivity-expectations_+3A_vars">vars</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt; A set of columns to
test.</p>
</td></tr>
<tr><td><code id="exclusivity-expectations_+3A_var_set">var_set</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt; The full set of
columns to check against. This should include all columns specified in the
<code>vars</code> argument.</p>
</td></tr>
<tr><td><code id="exclusivity-expectations_+3A_exc_val">exc_val</code></td>
<td>
<p>The value that flags a variable as &quot;selected&quot; (default: <code>1</code>)</p>
</td></tr>
<tr><td><code id="exclusivity-expectations_+3A_flt">flt</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_data_masking">data-masking</a></code>&gt; A filter specifying
a subset of the data frame to test.</p>
</td></tr>
<tr><td><code id="exclusivity-expectations_+3A_data">data</code></td>
<td>
<p>A data frame to test. The <a href="#topic+global-data">global test data</a> is used
by default.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This expectation is designed to check exclusivity in survey multiple response
sets, where one response is only valid on its own.
</p>
<p>See the example data set below:
</p>

<ul>
<li><p> No record should have <code>q10_98</code>, &quot;None of the above&quot;, selected while also
having any other response selected, so we refer to this as an &quot;exclusive&quot;
response.
</p>
</li>
<li> <p><code>expect_exclusive()</code> checks whether <code>q10_98</code> &quot;None of the above&quot; or
<code>q10_99</code> &quot;Don't know&quot;, the exclusive responses, have been selected alongside
any other <code style="white-space: pre;">&#8288;q10_*&#8288;</code> response.
</p>
</li>
<li><p> The expectation fails, since the first record has both <code>q10_1</code> and
<code>q10_98</code> selected.
</p>
</li></ul>



<h3>Value</h3>

<p><code style="white-space: pre;">&#8288;expect_*()&#8288;</code> functions are mainly called for their side effects. The
expectation signals its result (e.g. &quot;success&quot;, &quot;failure&quot;), which is logged
by the current <a href="testthat.html#topic+Reporter">test reporter</a>. In a non-testing
context the expectation will raise an error with class
<code>expectation_failure</code> if it fails.
</p>


<h3>See Also</h3>

<p>Other data expectations: 
<code><a href="#topic+conditional-expectations">conditional-expectations</a></code>,
<code><a href="#topic+datacomp-expectations">datacomp-expectations</a></code>,
<code><a href="#topic+date-expectations">date-expectations</a></code>,
<code><a href="#topic+expect_depends">expect_depends</a>()</code>,
<code><a href="#topic+generic-expectations">generic-expectations</a></code>,
<code><a href="#topic+label-expectations">label-expectations</a></code>,
<code><a href="#topic+pattern-expectations">pattern-expectations</a></code>,
<code><a href="#topic+proportion-expectations">proportion-expectations</a></code>,
<code><a href="#topic+text-expectations">text-expectations</a></code>,
<code><a href="#topic+uniqueness-expectations">uniqueness-expectations</a></code>,
<code><a href="#topic+value-expectations">value-expectations</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
my_q_block &lt;- data.frame(
  resp_id = 1:5, # Unique to respondent
  q10_1  = c(1, 1, 0, 0, 0),
  q10_2  = c(0, 1, 0, 0, 0),
  q10_3  = c(0, 0, 1, 0, 0),
  q10_98 = c(1, 0, 0, 1, 0), # None of the above
  q10_99 = c(0, 0, 0, 0, 1)  # Item not answered
)

# Make sure that if "None of the above" and "Item skipped" are selected
# none of the other question options are selected:
try(
expect_exclusive(
  c(q10_98, q10_99),
  starts_with("q10_"),
  data = my_q_block
)
)
</code></pre>

<hr>
<h2 id='expect_custom'>Extension of 'expect' to allow inclusion of custom fields</h2><span id='topic+expect_custom'></span>

<h3>Description</h3>

<p>Use expect_custom to allow inclusion of arbitrary data in expectation
results. Additional data is stored in a list in an attribute called <code>custom</code>
in the resulting expectation. This allows data expectations to store
information about the number of failed and successful cases for reporting of
test results.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expect_custom(
  ok,
  failure_message,
  info = NULL,
  srcref = NULL,
  trace = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="expect_custom_+3A_ok">ok</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code> indicating if the expectation was successful.</p>
</td></tr>
<tr><td><code id="expect_custom_+3A_failure_message">failure_message</code></td>
<td>
<p>Message to show if the expectation failed.</p>
</td></tr>
<tr><td><code id="expect_custom_+3A_info">info</code></td>
<td>
<p>Character vector continuing additional information. Included for
backward compatibility only and new expectations should not use it.</p>
</td></tr>
<tr><td><code id="expect_custom_+3A_srcref">srcref</code></td>
<td>
<p>Location of the failure. Should only needed to be explicitly
supplied when you need to forward a srcref captured elsewhere.</p>
</td></tr>
<tr><td><code id="expect_custom_+3A_...">...</code></td>
<td>
<p>Additional data to be added to a list in the <code>custom</code> attribute of
the resulting expectation.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An expectation object. Signals the expectation condition with a
<code>continue_test</code> restart.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># calling expect_custom directly with some custom data
x &lt;- expect_custom(TRUE, "Test", extra_data = 1:5, more_data = "Hello")
str(x)

# an example expectation (note additional libraries used)
library(rlang)

expect_example &lt;- function(var, data = get_testdata()) {
  act &lt;- quasi_label(enquo(data))
  act$var_desc &lt;- expr_label(get_expr(enquo(var)))
  act$var &lt;- expr_text(get_expr(enquo(var)))

  act$result &lt;- act$val[[act$var]] &gt; 0
  act$result[is.na(act$result)] &lt;- FALSE

  expect_custom(
    all(act$result, na.rm = TRUE),
    glue::glue("{act$lab} has {sum(!act$result, na.rm = TRUE)} cases with \\
                {act$var_desc} not greater than 0."),
    failed_count = sum(!act$result, na.rm = TRUE),
    total_count = sum(!is.na(act$result))
  )

  invisible(act$result)
}

try(expect_example(x, data = data.frame(x = c(NA, -2:2))))
</code></pre>

<hr>
<h2 id='expect_depends'>Expectations: functional dependency</h2><span id='topic+expect_depends'></span>

<h3>Description</h3>

<p>Test whether one set of variables functionally depend on another set of
variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expect_depends(vars, on, flt = TRUE, data = get_testdata())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="expect_depends_+3A_vars">vars</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt; A set of columns to
test.</p>
</td></tr>
<tr><td><code id="expect_depends_+3A_on">on</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt; A set of columns which
<code>vars</code> are expected to depend on.</p>
</td></tr>
<tr><td><code id="expect_depends_+3A_flt">flt</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_data_masking">data-masking</a></code>&gt; A filter specifying
a subset of the data frame to test.</p>
</td></tr>
<tr><td><code id="expect_depends_+3A_data">data</code></td>
<td>
<p>A data frame to test. The <a href="#topic+global-data">global test data</a> is used
by default.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>One set of variables, X, functionally depends on another, Y, if and only if
each value in Y corresponds to exactly one value in X. For instance,
<code>course_duration</code> and <code>course_topic</code> functionally depend on <code>course_code</code> if
each <code>course_code</code> corresponds to just one combination of <code>course_duration</code>
and <code style="white-space: pre;">&#8288;course topic&#8288;</code>. That is, if two records have the same <code>course_code</code> then
they must have the same <code>course_duration</code> and <code>course_topic</code>.
</p>
<p>See the <a href="https://en.wikipedia.org/wiki/Functional_dependency">wikipedia page</a>
for more information.
</p>


<h3>Value</h3>

<p><code style="white-space: pre;">&#8288;expect_*()&#8288;</code> functions are mainly called for their side effects. The
expectation signals its result (e.g. &quot;success&quot;, &quot;failure&quot;), which is logged
by the current <a href="testthat.html#topic+Reporter">test reporter</a>. In a non-testing
context the expectation will raise an error with class
<code>expectation_failure</code> if it fails.
</p>


<h3>See Also</h3>

<p>Other data expectations: 
<code><a href="#topic+conditional-expectations">conditional-expectations</a></code>,
<code><a href="#topic+datacomp-expectations">datacomp-expectations</a></code>,
<code><a href="#topic+date-expectations">date-expectations</a></code>,
<code><a href="#topic+exclusivity-expectations">exclusivity-expectations</a></code>,
<code><a href="#topic+generic-expectations">generic-expectations</a></code>,
<code><a href="#topic+label-expectations">label-expectations</a></code>,
<code><a href="#topic+pattern-expectations">pattern-expectations</a></code>,
<code><a href="#topic+proportion-expectations">proportion-expectations</a></code>,
<code><a href="#topic+text-expectations">text-expectations</a></code>,
<code><a href="#topic+uniqueness-expectations">uniqueness-expectations</a></code>,
<code><a href="#topic+value-expectations">value-expectations</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
student_course &lt;- data.frame(
  student_id = 1:5,
  course_code = c(1, 2, 1, 3, 4),
  course_duration = c(12, 12, 12, 12, 12),
  course_topic = c("Song", "Dance", "Song", "Painting", "Pottery")
)

# Check that each `course_code` corresponds to exactly one combination of
# `course_duration` and `course_topic`
expect_depends(
  c(course_duration, course_topic),
  on = course_code,
  data = student_course
)
</code></pre>

<hr>
<h2 id='expect_make'>Create an expectation from a check function</h2><span id='topic+expect_make'></span>

<h3>Description</h3>

<p><code>expect_make()</code> creates an expectation from a vectorised checking function to
allow simple generation of domain specific data checks.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expect_make(
  func,
  func_desc = NULL,
  vars = FALSE,
  all = TRUE,
  env = caller_env()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="expect_make_+3A_func">func</code></td>
<td>
<p>A function whose first argument takes a vector to check, and
returns a logical vector of the same length with the results.</p>
</td></tr>
<tr><td><code id="expect_make_+3A_func_desc">func_desc</code></td>
<td>
<p>A character function description to use in the expectation
failure message.</p>
</td></tr>
<tr><td><code id="expect_make_+3A_vars">vars</code></td>
<td>
<p>Included for backwards compatibility only.</p>
</td></tr>
<tr><td><code id="expect_make_+3A_all">all</code></td>
<td>
<p>Function to use to combine results for each vector.</p>
</td></tr>
<tr><td><code id="expect_make_+3A_env">env</code></td>
<td>
<p>The parent environment of the function, defaults to the calling
environment of <code>expect_make()</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An <code style="white-space: pre;">&#8288;expect_*()&#8288;</code> style function.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Create a custom check
chk_binary &lt;- function(x) {
  suppressWarnings(as.integer(x) %in% 0:1)
}

# Create custom expectation function
expect_binary &lt;- expect_make(chk_binary)

# Validate a data frame
try(expect_binary(vs, data = mtcars))
try(expect_binary(cyl, data = mtcars))

</code></pre>

<hr>
<h2 id='expect-defunct'>Defunct expectation functions</h2><span id='topic+expect-defunct'></span><span id='topic+filter_expect'></span><span id='topic+expect_where'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#defunct"><img src="../help/figures/lifecycle-defunct.svg" alt='[Defunct]' /></a>
</p>
<p>These functions are defunct.
</p>

<ul>
<li> <p><code>expect_where()</code> works exactly like <code>expect_all()</code>. When testdat used
<code>dplyr::vars()</code> as standard <code>expect_where()</code> provided an alternative
interface using <code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>.
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>filter_expect(data, expect_function, ..., not = TRUE)

expect_where(
  where,
  func,
  flt = TRUE,
  data = get_testdata(),
  args = list(),
  func_desc = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="expect-defunct_+3A_data">data</code></td>
<td>
<p>A data frame to test. The <a href="#topic+global-data">global test data</a> is used
by default.</p>
</td></tr>
<tr><td><code id="expect-defunct_+3A_expect_function">expect_function</code></td>
<td>
<p>An expectation function.</p>
</td></tr>
<tr><td><code id="expect-defunct_+3A_...">...</code></td>
<td>
<p>Arguments to pass to expect_function.</p>
</td></tr>
<tr><td><code id="expect-defunct_+3A_not">not</code></td>
<td>
<p>Reverse the results of the check.</p>
</td></tr>
<tr><td><code id="expect-defunct_+3A_where">where</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt; Columns to check</p>
</td></tr>
<tr><td><code id="expect-defunct_+3A_flt">flt</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_data_masking">data-masking</a></code>&gt; A filter specifying
a subset of the data frame to test.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The input data frame filtered to records failing the expectation.
</p>

<hr>
<h2 id='expect-deprec'>Deprecated expectation functions</h2><span id='topic+expect-deprec'></span><span id='topic+expect_func'></span><span id='topic+expect_join'></span><span id='topic+expect_similar'></span><span id='topic+expect_allany'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#soft-deprecated"><img src="../help/figures/lifecycle-soft-deprecated.svg" alt='[Soft-deprecated]' /></a>
</p>
<p>These functions are deprecated.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expect_func(var, ...)

expect_join(data2, by = NULL, not = FALSE, flt = TRUE, data = get_testdata())

expect_similar(
  var,
  data2,
  var2,
  flt = TRUE,
  flt2 = flt,
  threshold = 0.05,
  min = 100,
  data = get_testdata()
)

expect_allany(
  vars,
  func,
  flt = TRUE,
  data = get_testdata(),
  args = list(),
  allany = c(chk_filter_all, chk_filter_any),
  func_desc = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="expect-deprec_+3A_var">var</code></td>
<td>
<p>An unquoted column name to test.</p>
</td></tr>
<tr><td><code id="expect-deprec_+3A_...">...</code></td>
<td>
<p>Arguments to pass to <code>expect_allany()</code>.</p>
</td></tr>
<tr><td><code id="expect-deprec_+3A_data2">data2</code></td>
<td>
<p>The data frame to compare against.</p>
</td></tr>
<tr><td><code id="expect-deprec_+3A_by">by</code></td>
<td>
<p>A character vector of columns to join by. See <code><a href="dplyr.html#topic+mutate-joins">dplyr::join()</a></code> for
details.</p>
</td></tr>
<tr><td><code id="expect-deprec_+3A_not">not</code></td>
<td>
<p>Reverse the results of the check?</p>
</td></tr>
<tr><td><code id="expect-deprec_+3A_flt">flt</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_data_masking">data-masking</a></code>&gt; A filter specifying
a subset of the data frame to test.</p>
</td></tr>
<tr><td><code id="expect-deprec_+3A_data">data</code></td>
<td>
<p>A data frame to test. The <a href="#topic+global-data">global test data</a> is used
by default.</p>
</td></tr>
<tr><td><code id="expect-deprec_+3A_var2">var2</code></td>
<td>
<p>An unquoted column name from data2.</p>
</td></tr>
<tr><td><code id="expect-deprec_+3A_flt2">flt2</code></td>
<td>
<p>A filter specifying a subset of data2 to test.</p>
</td></tr>
<tr><td><code id="expect-deprec_+3A_threshold">threshold</code></td>
<td>
<p>The maximum proportional difference allowed between the two
categories.</p>
</td></tr>
<tr><td><code id="expect-deprec_+3A_min">min</code></td>
<td>
<p>The minimum number of responses for a category to allow
comparison. This avoids small categories raising spurious errors.</p>
</td></tr>
<tr><td><code id="expect-deprec_+3A_vars">vars</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt; A set of columns to
test.</p>
</td></tr>
<tr><td><code id="expect-deprec_+3A_func">func</code></td>
<td>
<p>A function to use for testing that takes a vector as the first
argument and returns a logical vector of the same length showing whether an
element passed or failed.</p>
</td></tr>
<tr><td><code id="expect-deprec_+3A_args">args</code></td>
<td>
<p>A named list of arguments to pass to <code>func</code>.</p>
</td></tr>
<tr><td><code id="expect-deprec_+3A_allany">allany</code></td>
<td>
<p>The function to combine the <code>func</code> results for each row.</p>
</td></tr>
<tr><td><code id="expect-deprec_+3A_func_desc">func_desc</code></td>
<td>
<p>A human friendly description of <code>func</code> to use in the
expectation failure message.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code style="white-space: pre;">&#8288;expect_*()&#8288;</code> functions are mainly called for their side effects. The
expectation signals its result (e.g. &quot;success&quot;, &quot;failure&quot;), which is logged
by the current <a href="testthat.html#topic+Reporter">test reporter</a>. In a non-testing
context the expectation will raise an error with class
<code>expectation_failure</code> if it fails.
</p>


<h3>See Also</h3>

<p><a href="#topic+generic-expectations">Generic Expectation Functions</a>
</p>
<p><a href="#topic+datacomp-expectations">Expectations: comparisons</a>
</p>

<hr>
<h2 id='generic-expectations'>Expectations: generic helpers</h2><span id='topic+generic-expectations'></span><span id='topic+expect_all'></span><span id='topic+expect_any'></span>

<h3>Description</h3>

<p>These functions allow for testing of multiple columns (<code>vars</code>) of a data
frame (<code>data</code>), with an optional filter (<code>flt</code>), using an arbitrary function
(<code>func</code>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expect_all(
  vars,
  func,
  flt = TRUE,
  data = get_testdata(),
  args = list(),
  func_desc = NULL
)

expect_any(
  vars,
  func,
  flt = TRUE,
  data = get_testdata(),
  args = list(),
  func_desc = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="generic-expectations_+3A_vars">vars</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt; A set of columns to
test.</p>
</td></tr>
<tr><td><code id="generic-expectations_+3A_func">func</code></td>
<td>
<p>A function to use for testing that takes a vector as the first
argument and returns a logical vector of the same length showing whether an
element passed or failed.</p>
</td></tr>
<tr><td><code id="generic-expectations_+3A_flt">flt</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_data_masking">data-masking</a></code>&gt; A filter specifying
a subset of the data frame to test.</p>
</td></tr>
<tr><td><code id="generic-expectations_+3A_data">data</code></td>
<td>
<p>A data frame to test. The <a href="#topic+global-data">global test data</a> is used
by default.</p>
</td></tr>
<tr><td><code id="generic-expectations_+3A_args">args</code></td>
<td>
<p>A named list of arguments to pass to <code>func</code>.</p>
</td></tr>
<tr><td><code id="generic-expectations_+3A_func_desc">func_desc</code></td>
<td>
<p>A human friendly description of <code>func</code> to use in the
expectation failure message.</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li> <p><code>expect_allany()</code> tests the columns in <code>vars</code> to see whether <code>func</code>
returns <code>TRUE</code> for each of them, and combines the results for each row using
the function in <code>allany</code>. Both <code>expect_all()</code> and <code>expect_any()</code> are wrappers
around <code>expect_allany()</code>.
</p>
</li>
<li> <p><code>expect_all()</code> tests the <code>vars</code> to see whether <code>func</code> returns <code>TRUE</code> for
<em>all</em> of them (i.e. whether the conjunction of results of applying <code>func</code> to
each of the <code>vars</code> is <code>TRUE</code>).
</p>
</li>
<li> <p><code>expect_any()</code> tests the <code>vars</code> to see whether <code>func</code> returns <code>TRUE</code> for
<em>any</em> of them (i.e. whether the disjunction of the results of applying <code>func</code>
to each of the <code>vars</code> is <code>TRUE</code>).
</p>
</li></ul>



<h3>Value</h3>

<p><code style="white-space: pre;">&#8288;expect_*()&#8288;</code> functions are mainly called for their side effects. The
expectation signals its result (e.g. &quot;success&quot;, &quot;failure&quot;), which is logged
by the current <a href="testthat.html#topic+Reporter">test reporter</a>. In a non-testing
context the expectation will raise an error with class
<code>expectation_failure</code> if it fails.
</p>


<h3>See Also</h3>

<p><code style="white-space: pre;">&#8288;chk_*()&#8288;</code> functions such as <code><a href="#topic+chk-values">chk_values()</a></code>
</p>
<p>Other data expectations: 
<code><a href="#topic+conditional-expectations">conditional-expectations</a></code>,
<code><a href="#topic+datacomp-expectations">datacomp-expectations</a></code>,
<code><a href="#topic+date-expectations">date-expectations</a></code>,
<code><a href="#topic+exclusivity-expectations">exclusivity-expectations</a></code>,
<code><a href="#topic+expect_depends">expect_depends</a>()</code>,
<code><a href="#topic+label-expectations">label-expectations</a></code>,
<code><a href="#topic+pattern-expectations">pattern-expectations</a></code>,
<code><a href="#topic+proportion-expectations">proportion-expectations</a></code>,
<code><a href="#topic+text-expectations">text-expectations</a></code>,
<code><a href="#topic+uniqueness-expectations">uniqueness-expectations</a></code>,
<code><a href="#topic+value-expectations">value-expectations</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Check that every 4-cylinder car has an engine displacement of &lt; 100 cubic
# inches *AND* &lt; 100 horsepower
try(
expect_all(
  vars = c(disp, hp),
  func = chk_range,
  flt = (cyl == 4),
  args = list(min = 0, max = 100),
  data = mtcars
)
)

# Check that every 4-cylinder car has an engine displacement of &lt; 100 cubic
# inches *OR* &lt; 100 horsepower
try(
expect_any(
  vars = c(disp, hp),
  func = chk_range,
  flt = (cyl == 4),
  args = list(min = 0, max = 100),
  data = mtcars
)
)

# Check that all variables are numeric:
try(expect_all(
  vars = everything(),
  func = is.numeric,
  data = iris
))

</code></pre>

<hr>
<h2 id='global-data'>Get/set test data</h2><span id='topic+global-data'></span><span id='topic+set_testdata'></span><span id='topic+get_testdata'></span><span id='topic+with_testdata'></span><span id='topic++25E+3E+25'></span>

<h3>Description</h3>

<p>A global test data set is used to avoid having to re-specify the testing data
frame in every test. These functions get and set the global data or set the
data for the current context.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_testdata(data, quosure = TRUE)

get_testdata()

with_testdata(data, code, quosure = TRUE)

data %E&gt;% code
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="global-data_+3A_data">data</code></td>
<td>
<p>Data frame to be used.</p>
</td></tr>
<tr><td><code id="global-data_+3A_quosure">quosure</code></td>
<td>
<p>If <code>TRUE</code>, the default, the data frame is stored as a
<a href="rlang.html#topic+quosure-tools">quosure</a> and lazily evaluated when <code>get_testdata()</code> is
called, so <code>get_testdata()</code> will return the current state of the data
frame.
</p>
<p>If <code>FALSE</code>, the data frame will be copied and <code>get_testdata()</code> will return
the state of the data frame at the time <code>set_testdata()</code> was called.</p>
</td></tr>
<tr><td><code id="global-data_+3A_code">code</code></td>
<td>
<p>Code to execute with the test data set to <code>data</code>.</p>
</td></tr>
</table>


<h3>Value</h3>


<ul>
<li> <p><code>set_testdata()</code> invisibly returns the previous test data. The test data
is returned as it was stored - if it was stored with <code>quosure = TRUE</code> it
will be returned as a quosure.
</p>
</li>
<li> <p><code>get_testdata()</code> returns the current test data frame.
</p>
</li>
<li> <p><code>with_testdata()</code> and the test data pipe <code style="white-space: pre;">&#8288;%E&gt;%&#8288;</code> invisibly return the
input <code>data</code> for easy piping.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>set_testdata(mtcars)
head(get_testdata())

with_testdata(iris, {
  x &lt;- get_testdata()
  print(head(x))
})

mtcars %E&gt;%
  expect_base(mpg, TRUE) %E&gt;%
  expect_range(carb, 1, 8)
</code></pre>

<hr>
<h2 id='label-expectations'>Expectations: labels</h2><span id='topic+label-expectations'></span><span id='topic+expect_labels'></span>

<h3>Description</h3>

<p>Test whether variables in a data frame are labelled in a given way.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expect_labels(
  vars,
  val_labels = NULL,
  var_label = NULL,
  flt = TRUE,
  data = get_testdata()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="label-expectations_+3A_vars">vars</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt; A set of columns to
test.</p>
</td></tr>
<tr><td><code id="label-expectations_+3A_val_labels">val_labels</code></td>
<td>
<p>What value label check should be performed? One of:
</p>

<ul>
<li><p> A character vector of expected value labels.
</p>
</li>
<li><p> A named vector of expected label-value pairs.
</p>
</li>
<li> <p><code>TRUE</code> to test for the presence of value labels in general.
</p>
</li>
<li> <p><code>FALSE</code> to test for the absence of value labels.
</p>
</li>
<li> <p><code>NULL</code> to ignore value labels when checking.
</p>
</li></ul>
</td></tr>
<tr><td><code id="label-expectations_+3A_var_label">var_label</code></td>
<td>
<p>What variable label check should be performed? One of:
</p>

<ul>
<li><p> A character vector of expected variable labels.
</p>
</li>
<li> <p><code>TRUE</code> to test for the presence of a variable labels.
</p>
</li>
<li> <p><code>FALSE</code> to test for the absence of a variable labels.
</p>
</li>
<li> <p><code>NULL</code> to ignore the variable label when checking.
</p>
</li></ul>
</td></tr>
<tr><td><code id="label-expectations_+3A_flt">flt</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_data_masking">data-masking</a></code>&gt; A filter specifying
a subset of the data frame to test.</p>
</td></tr>
<tr><td><code id="label-expectations_+3A_data">data</code></td>
<td>
<p>A data frame to test. The <a href="#topic+global-data">global test data</a> is used
by default.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code style="white-space: pre;">&#8288;expect_*()&#8288;</code> functions are mainly called for their side effects. The
expectation signals its result (e.g. &quot;success&quot;, &quot;failure&quot;), which is logged
by the current <a href="testthat.html#topic+Reporter">test reporter</a>. In a non-testing
context the expectation will raise an error with class
<code>expectation_failure</code> if it fails.
</p>


<h3>See Also</h3>

<p><a href="#topic+chk-labels">Checks: labels</a>
</p>
<p>Other data expectations: 
<code><a href="#topic+conditional-expectations">conditional-expectations</a></code>,
<code><a href="#topic+datacomp-expectations">datacomp-expectations</a></code>,
<code><a href="#topic+date-expectations">date-expectations</a></code>,
<code><a href="#topic+exclusivity-expectations">exclusivity-expectations</a></code>,
<code><a href="#topic+expect_depends">expect_depends</a>()</code>,
<code><a href="#topic+generic-expectations">generic-expectations</a></code>,
<code><a href="#topic+pattern-expectations">pattern-expectations</a></code>,
<code><a href="#topic+proportion-expectations">proportion-expectations</a></code>,
<code><a href="#topic+text-expectations">text-expectations</a></code>,
<code><a href="#topic+uniqueness-expectations">uniqueness-expectations</a></code>,
<code><a href="#topic+value-expectations">value-expectations</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
df &lt;- data.frame(
  x = labelled::labelled(c("M", "M", "F"), c(Male = "M", Female = "F"), "Sex"),
  y = labelled::labelled(c("M", "M", "F"), c(Male = "M", Female = "F", Other = "X")),
  z = c("M", "M", "F")
)

# Check for a value-label pairing
try(expect_labels(x, c(Male = "M"), data = df))

# Check that two variables have the same values
expect_labels(x, labelled::val_labels(df$y), data = df) # N.B. This passes!

# Check for the presence of a particular label
try(expect_labels(x, "Male", data = df))
expect_labels(x, var_label = "Sex", data = df)

# Check that a variable is labelled at all
try(expect_labels(z, val_labels = TRUE, data = df))
try(expect_labels(z, var_label = TRUE, data = df))

# Check that a variable isn't labelled
expect_labels(z, val_labels = FALSE, data = df)
expect_labels(z, var_label = FALSE, data = df)

</code></pre>

<hr>
<h2 id='output_results_excel'>Output <code>ListReporter</code> results in Excel format</h2><span id='topic+output_results_excel'></span>

<h3>Description</h3>

<p>Output formatted <code>ListReporter</code> results to an Excel workbook using
<a href="openxlsx.html#topic+openxlsx">openxlsx</a>. The workbook consists of a summary sheet
showing aggregated results for each context, and one sheet per context
showing details of each unsuccessful test.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>output_results_excel(results, file)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="output_results_excel_+3A_results">results</code></td>
<td>
<p>An object of class <code>testthat_results</code>, e.g. output from
<code><a href="testthat.html#topic+test_dir">test_dir()</a></code> or <code><a href="testthat.html#topic+test_file">test_file()</a></code>.</p>
</td></tr>
<tr><td><code id="output_results_excel_+3A_file">file</code></td>
<td>
<p>Output file name</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The return value of <code><a href="openxlsx.html#topic+saveWorkbook">openxlsx::saveWorkbook()</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Output the results from running all tests in a directory
x &lt;- test_dir(".")
output_results_excel(x, "Test results.xlsx")

## End(Not run)
</code></pre>

<hr>
<h2 id='pattern-expectations'>Expectations: patterns</h2><span id='topic+pattern-expectations'></span><span id='topic+expect_regex'></span><span id='topic+expect_max_length'></span>

<h3>Description</h3>

<p>Test whether variables in a data frame conform to a given pattern.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expect_regex(vars, pattern, flt = TRUE, data = get_testdata())

expect_max_length(vars, len, flt = TRUE, data = get_testdata())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pattern-expectations_+3A_vars">vars</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt; A set of columns to
test.</p>
</td></tr>
<tr><td><code id="pattern-expectations_+3A_pattern">pattern</code></td>
<td>
<p>A <a href="stringr.html#topic+str_detect">str_detect()</a> pattern to match.</p>
</td></tr>
<tr><td><code id="pattern-expectations_+3A_flt">flt</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_data_masking">data-masking</a></code>&gt; A filter specifying
a subset of the data frame to test.</p>
</td></tr>
<tr><td><code id="pattern-expectations_+3A_data">data</code></td>
<td>
<p>A data frame to test. The <a href="#topic+global-data">global test data</a> is used
by default.</p>
</td></tr>
<tr><td><code id="pattern-expectations_+3A_len">len</code></td>
<td>
<p>Maximum string length.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code style="white-space: pre;">&#8288;expect_*()&#8288;</code> functions are mainly called for their side effects. The
expectation signals its result (e.g. &quot;success&quot;, &quot;failure&quot;), which is logged
by the current <a href="testthat.html#topic+Reporter">test reporter</a>. In a non-testing
context the expectation will raise an error with class
<code>expectation_failure</code> if it fails.
</p>


<h3>See Also</h3>

<p><a href="#topic+chk-patterns">Checks: patterns</a>
</p>
<p>Other data expectations: 
<code><a href="#topic+conditional-expectations">conditional-expectations</a></code>,
<code><a href="#topic+datacomp-expectations">datacomp-expectations</a></code>,
<code><a href="#topic+date-expectations">date-expectations</a></code>,
<code><a href="#topic+exclusivity-expectations">exclusivity-expectations</a></code>,
<code><a href="#topic+expect_depends">expect_depends</a>()</code>,
<code><a href="#topic+generic-expectations">generic-expectations</a></code>,
<code><a href="#topic+label-expectations">label-expectations</a></code>,
<code><a href="#topic+proportion-expectations">proportion-expectations</a></code>,
<code><a href="#topic+text-expectations">text-expectations</a></code>,
<code><a href="#topic+uniqueness-expectations">uniqueness-expectations</a></code>,
<code><a href="#topic+value-expectations">value-expectations</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
sales &lt;- data.frame(
  sale_id = 1:5,
  item_code = c("a_1", "b_2", "c_2", NA, "NULL")
)

try(expect_regex(item_code, "[a-z]_[0-9]", data = sales)) # Codes match regex
try(expect_max_length(item_code,  3, data = sales)) # Code width &lt;= 3

</code></pre>

<hr>
<h2 id='proportion-expectations'>Expectations: proportions</h2><span id='topic+proportion-expectations'></span><span id='topic+expect_prop_lte'></span><span id='topic+expect_prop_gte'></span><span id='topic+expect_prop_nmiss'></span><span id='topic+expect_prop_values'></span>

<h3>Description</h3>

<p>These test the proportion of data in a data frame satisfying some condition.
The generic functions, <code>expect_prop_lte()</code> and <code>expect_prop_gte()</code>, can be
used with any arbitrary function. The <code style="white-space: pre;">&#8288;chk_*()&#8288;</code> functions, like
<code>chk_values()</code>, are useful in this regard.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expect_prop_lte(
  var,
  func,
  prop,
  flt = TRUE,
  data = get_testdata(),
  args = list(),
  func_desc = NULL
)

expect_prop_gte(
  var,
  func,
  prop,
  flt = TRUE,
  data = get_testdata(),
  args = list(),
  func_desc = NULL
)

expect_prop_nmiss(
  var,
  prop,
  miss = getOption("testdat.miss"),
  flt = TRUE,
  data = get_testdata()
)

expect_prop_values(var, prop, ..., flt = TRUE, data = get_testdata())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="proportion-expectations_+3A_var">var</code></td>
<td>
<p>An unquoted column name to test.</p>
</td></tr>
<tr><td><code id="proportion-expectations_+3A_func">func</code></td>
<td>
<p>A function to use for testing that takes a vector as the first
argument and returns a logical vector of the same length showing whether an
element passed or failed.</p>
</td></tr>
<tr><td><code id="proportion-expectations_+3A_prop">prop</code></td>
<td>
<p>The proportion of the data frame expected to satisfy the
condition.</p>
</td></tr>
<tr><td><code id="proportion-expectations_+3A_flt">flt</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_data_masking">data-masking</a></code>&gt; A filter specifying
a subset of the data frame to test.</p>
</td></tr>
<tr><td><code id="proportion-expectations_+3A_data">data</code></td>
<td>
<p>A data frame to test. The <a href="#topic+global-data">global test data</a> is used
by default.</p>
</td></tr>
<tr><td><code id="proportion-expectations_+3A_args">args</code></td>
<td>
<p>A named list of arguments to pass to <code>func</code>.</p>
</td></tr>
<tr><td><code id="proportion-expectations_+3A_func_desc">func_desc</code></td>
<td>
<p>A human friendly description of <code>func</code> to use in the
expectation failure message.</p>
</td></tr>
<tr><td><code id="proportion-expectations_+3A_miss">miss</code></td>
<td>
<p>A vector of values to be treated as missing. The
<a href="#topic+testdat">testdat.miss</a> option is used by default.</p>
</td></tr>
<tr><td><code id="proportion-expectations_+3A_...">...</code></td>
<td>
<p>Vectors of valid values.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Given the use of quasi-quotation within these functions, to make a new
functions using one of the generics such as <code>expect_prop_gte()</code> one must
defuse the <code>var</code> argument using the embracing operator <code>{{ }}</code>. See the
examples sections for an example.
</p>


<h3>Value</h3>

<p><code style="white-space: pre;">&#8288;expect_*()&#8288;</code> functions are mainly called for their side effects. The
expectation signals its result (e.g. &quot;success&quot;, &quot;failure&quot;), which is logged
by the current <a href="testthat.html#topic+Reporter">test reporter</a>. In a non-testing
context the expectation will raise an error with class
<code>expectation_failure</code> if it fails.
</p>


<h3>See Also</h3>

<p><code style="white-space: pre;">&#8288;chk_*()&#8288;</code> functions such as <code><a href="#topic+chk-values">chk_values()</a></code>
</p>
<p>Other data expectations: 
<code><a href="#topic+conditional-expectations">conditional-expectations</a></code>,
<code><a href="#topic+datacomp-expectations">datacomp-expectations</a></code>,
<code><a href="#topic+date-expectations">date-expectations</a></code>,
<code><a href="#topic+exclusivity-expectations">exclusivity-expectations</a></code>,
<code><a href="#topic+expect_depends">expect_depends</a>()</code>,
<code><a href="#topic+generic-expectations">generic-expectations</a></code>,
<code><a href="#topic+label-expectations">label-expectations</a></code>,
<code><a href="#topic+pattern-expectations">pattern-expectations</a></code>,
<code><a href="#topic+text-expectations">text-expectations</a></code>,
<code><a href="#topic+uniqueness-expectations">uniqueness-expectations</a></code>,
<code><a href="#topic+value-expectations">value-expectations</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sales &lt;- data.frame(
  sale_id = 1:5,
  date = c("20200101", "20200101", "20200102", "20200103", "2020003"),
  sale_price = c(10, 20, 30, 40, -1),
  book_title = c(
    "Phenomenology of Spirit",
    NA,
    "Critique of Practical Reason",
    "Spirit of Trust",
    "Empiricism and the Philosophy of Mind"
  ),
  stringsAsFactors = FALSE
)

# Create a custom expectation
expect_prop_length &lt;- function(var, len, prop, data) {
  expect_prop_gte(
    var = {{var}}, # Notice the use of the embracing operator
    func = chk_max_length,
    prop = prop,
    data = data,
    args = list(len = len),
    func_desc = "length_check"
  )
}

# Use it to check that dates are mostly &lt;= 8 char wide
expect_prop_length(date, 8, 0.9, sales)

# Check price values mostly between 0 and 100
try(expect_prop_values(sale_price, 0.9, 1:100, data = sales))

</code></pre>

<hr>
<h2 id='reexports'>Objects exported from other packages</h2><span id='topic+reexports'></span><span id='topic+contains'></span><span id='topic+select_helpers'></span><span id='topic+ends_with'></span><span id='topic+everything'></span><span id='topic+matches'></span><span id='topic+num_range'></span><span id='topic+one_of'></span><span id='topic+starts_with'></span><span id='topic+last_col'></span><span id='topic+any_of'></span><span id='topic+all_of'></span>

<h3>Description</h3>

<p>These objects are imported from other packages. Follow the links
below to see their documentation.
</p>

<dl>
<dt>tidyselect</dt><dd><p><code><a href="tidyselect.html#topic+all_of">all_of</a></code>, <code><a href="tidyselect.html#topic+all_of">any_of</a></code>, <code><a href="tidyselect.html#topic+starts_with">contains</a></code>, <code><a href="tidyselect.html#topic+starts_with">ends_with</a></code>, <code><a href="tidyselect.html#topic+everything">everything</a></code>, <code><a href="tidyselect.html#topic+everything">last_col</a></code>, <code><a href="tidyselect.html#topic+starts_with">matches</a></code>, <code><a href="tidyselect.html#topic+starts_with">num_range</a></code>, <code><a href="tidyselect.html#topic+one_of">one_of</a></code>, <code><a href="tidyselect.html#topic+starts_with">starts_with</a></code></p>
</dd>
</dl>

<hr>
<h2 id='reporter-deprec'>Deprecated reporter functions</h2><span id='topic+reporter-deprec'></span><span id='topic+context_data'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#soft-deprecated"><img src="../help/figures/lifecycle-soft-deprecated.svg" alt='[Soft-deprecated]' /></a>
</p>
<p>These functions are deprecated.
</p>
<p>See <a href="#topic+global-data">Get/set test data</a> for working with global test data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>context_data(data)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="reporter-deprec_+3A_data">data</code></td>
<td>
<p>Data frame to be used.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><a href="#topic+global-data">Get/set test data</a>
</p>

<hr>
<h2 id='testdat-package'>testdat: Data Unit Testing for R</h2><span id='topic+testdat'></span><span id='topic+testdat-package'></span>

<h3>Description</h3>

<p><img src="../help/figures/logo.png" style='float: right' alt='logo' width='120' />
</p>
<p>Test your data! An extension of the 'testthat' unit testing framework with a family of functions and reporting tools for checking and validating data frames.
</p>


<h3>Options</h3>


<ul>
<li> <p><code>testdat.miss</code>: A vector of values to consider missing
(default: <code>c(NA, "")</code>).
</p>
</li>
<li> <p><code>testdat.miss_text</code>: A vector of values to consider missing in text
variables
(default: <code>c("error", "null", "0", ".", "-", ",", "na", "#n/a", "", NA)</code>).
</p>
</li>
<li> <p><code>testdat.stop_on_fail</code>: Should an expectation raise an error on failure?
Useful for interactive use of expectation functions (default: <code>TRUE</code>).
</p>
</li>
<li> <p><code>testdat.scipen</code>: When it is necessary to convert a numeric vector to
character for checking, this value will be used for <code>scipen</code>
(default: <code>999</code>).
</p>
</li></ul>



<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Danny Smith <a href="mailto:danny@gorcha.org">danny@gorcha.org</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> Kinto Behr <a href="mailto:kinto.behr@srcentre.com.au">kinto.behr@srcentre.com.au</a>
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> The Social Research Centre [copyright holder]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://socialresearchcentre.github.io/testdat/">https://socialresearchcentre.github.io/testdat/</a>
</p>
</li>
<li> <p><a href="https://github.com/socialresearchcentre/testdat">https://github.com/socialresearchcentre/testdat</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/socialresearchcentre/testdat/issues">https://github.com/socialresearchcentre/testdat/issues</a>
</p>
</li></ul>


<hr>
<h2 id='text-expectations'>Expectations: text</h2><span id='topic+text-expectations'></span><span id='topic+expect_text_miss'></span><span id='topic+expect_text_nmiss'></span>

<h3>Description</h3>

<p>Test whether variables in a data frame contain common NULL placeholders.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expect_text_miss(
  vars,
  miss = getOption("testdat.miss_text"),
  flt = TRUE,
  data = get_testdata()
)

expect_text_nmiss(
  vars,
  miss = getOption("testdat.miss_text"),
  flt = TRUE,
  data = get_testdata()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="text-expectations_+3A_vars">vars</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt; A set of columns to
test.</p>
</td></tr>
<tr><td><code id="text-expectations_+3A_miss">miss</code></td>
<td>
<p>A vector of values to be treated as missing. The
<a href="#topic+testdat">testdat.miss</a> or <a href="#topic+testdat">testdat.miss_text</a> option is used by
default.</p>
</td></tr>
<tr><td><code id="text-expectations_+3A_flt">flt</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_data_masking">data-masking</a></code>&gt; A filter specifying
a subset of the data frame to test.</p>
</td></tr>
<tr><td><code id="text-expectations_+3A_data">data</code></td>
<td>
<p>A data frame to test. The <a href="#topic+global-data">global test data</a> is used
by default.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code style="white-space: pre;">&#8288;expect_*()&#8288;</code> functions are mainly called for their side effects. The
expectation signals its result (e.g. &quot;success&quot;, &quot;failure&quot;), which is logged
by the current <a href="testthat.html#topic+Reporter">test reporter</a>. In a non-testing
context the expectation will raise an error with class
<code>expectation_failure</code> if it fails.
</p>


<h3>See Also</h3>

<p><a href="#topic+chk-text">Checks: text</a>
</p>
<p>Other data expectations: 
<code><a href="#topic+conditional-expectations">conditional-expectations</a></code>,
<code><a href="#topic+datacomp-expectations">datacomp-expectations</a></code>,
<code><a href="#topic+date-expectations">date-expectations</a></code>,
<code><a href="#topic+exclusivity-expectations">exclusivity-expectations</a></code>,
<code><a href="#topic+expect_depends">expect_depends</a>()</code>,
<code><a href="#topic+generic-expectations">generic-expectations</a></code>,
<code><a href="#topic+label-expectations">label-expectations</a></code>,
<code><a href="#topic+pattern-expectations">pattern-expectations</a></code>,
<code><a href="#topic+proportion-expectations">proportion-expectations</a></code>,
<code><a href="#topic+uniqueness-expectations">uniqueness-expectations</a></code>,
<code><a href="#topic+value-expectations">value-expectations</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
sales &lt;- data.frame(
  sale_id = 1:5,
  date = c("20200101", "null", "20200102", "20200103", "null"),
  sale_price = c(10, -1, 30, 40, -1)
)

# Dates not missing
try(expect_text_nmiss(date, data = sales))

# Date missing if price negative
try(expect_text_miss(date, flt = sale_price %in% -1, data = sales))

</code></pre>

<hr>
<h2 id='uniqueness-expectations'>Expectations: uniqueness</h2><span id='topic+uniqueness-expectations'></span><span id='topic+expect_unique'></span><span id='topic+expect_unique_across'></span><span id='topic+expect_unique_combine'></span>

<h3>Description</h3>

<p>These functions test variables for uniqueness.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expect_unique(
  vars,
  exclude = getOption("testdat.miss"),
  flt = TRUE,
  data = get_testdata()
)

expect_unique_across(
  vars,
  exclude = getOption("testdat.miss"),
  flt = TRUE,
  data = get_testdata()
)

expect_unique_combine(
  vars,
  exclude = getOption("testdat.miss"),
  flt = TRUE,
  data = get_testdata()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="uniqueness-expectations_+3A_vars">vars</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt; A set of columns to
test.</p>
</td></tr>
<tr><td><code id="uniqueness-expectations_+3A_exclude">exclude</code></td>
<td>
<p>a vector of values to exclude from uniqueness check.  The
<a href="#topic+testdat">testdat.miss</a> option is used by default. To include all values,
set <code>exclude = NULL</code>.</p>
</td></tr>
<tr><td><code id="uniqueness-expectations_+3A_flt">flt</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_data_masking">data-masking</a></code>&gt; A filter specifying
a subset of the data frame to test.</p>
</td></tr>
<tr><td><code id="uniqueness-expectations_+3A_data">data</code></td>
<td>
<p>A data frame to test. The <a href="#topic+global-data">global test data</a> is used
by default.</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li> <p><code>expect_unique()</code> tests a set of columns (<code>vars</code>) and fails if the combined
columns do not uniquely identify each row.
</p>
</li>
<li> <p><code>expect_unique_across()</code> tests a set of columns (<code>vars</code>) and fails if each
row does not have unique values in each column.
</p>
</li>
<li> <p><code>expect_unique_combine()</code> tests a set of columns (<code>vars</code>) and fails if any
value appears more than once across all of them.
</p>
</li></ul>

<p>By default the uniqueness check excludes missing values (as specified by the
<a href="#topic+testdat">testdat.miss</a> option). Setting <code>exclude = NULL</code> will include all
values.
</p>


<h3>Value</h3>

<p><code style="white-space: pre;">&#8288;expect_*()&#8288;</code> functions are mainly called for their side effects. The
expectation signals its result (e.g. &quot;success&quot;, &quot;failure&quot;), which is logged
by the current <a href="testthat.html#topic+Reporter">test reporter</a>. In a non-testing
context the expectation will raise an error with class
<code>expectation_failure</code> if it fails.
</p>


<h3>See Also</h3>

<p><a href="#topic+chk-uniqueness">Checks: uniqueness</a>
</p>
<p>Other data expectations: 
<code><a href="#topic+conditional-expectations">conditional-expectations</a></code>,
<code><a href="#topic+datacomp-expectations">datacomp-expectations</a></code>,
<code><a href="#topic+date-expectations">date-expectations</a></code>,
<code><a href="#topic+exclusivity-expectations">exclusivity-expectations</a></code>,
<code><a href="#topic+expect_depends">expect_depends</a>()</code>,
<code><a href="#topic+generic-expectations">generic-expectations</a></code>,
<code><a href="#topic+label-expectations">label-expectations</a></code>,
<code><a href="#topic+pattern-expectations">pattern-expectations</a></code>,
<code><a href="#topic+proportion-expectations">proportion-expectations</a></code>,
<code><a href="#topic+text-expectations">text-expectations</a></code>,
<code><a href="#topic+value-expectations">value-expectations</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
student_fruit_preferences &lt;- data.frame(
  student_id = c(1:5, NA, NA),
  apple = c(1, 1, 1, 1, 99, NA, NA),
  orange = c(2, 3, 2, 3, 99, NA, NA),
  banana = c(3, 2, 3, 2, 99, NA, NA),
  phone1 = c(123, 456, 789, 987, 654, NA, NA),
  phone2 = c(345, 678, 987, 567, 000, NA, NA)
)

# Check that key is unique, excluding NAs by default
expect_unique(student_id, data = student_fruit_preferences)

# Check that key is unique, including NAs
try(expect_unique(student_id, exclude = NULL, data = student_fruit_preferences))

# Check each fruit has unique preference number
try(
expect_unique_across(
  c(apple, orange, banana),
  data = student_fruit_preferences
)
)

# Check each fruit has unique preference number, allowing multiple 99 (item
# skipped) codes
expect_unique_across(
  c(apple, orange, banana),
  exclude = c(99, NA), data = student_fruit_preferences
)

# Check that each phone number appears at most once
try(expect_unique_combine(c(phone1, phone2), data = student_fruit_preferences))

</code></pre>

<hr>
<h2 id='value-expectations'>Expectations: values</h2><span id='topic+value-expectations'></span><span id='topic+expect_values'></span><span id='topic+expect_range'></span>

<h3>Description</h3>

<p>Test whether variables in a data frame contain only certain values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expect_values(
  vars,
  ...,
  miss = getOption("testdat.miss"),
  flt = TRUE,
  data = get_testdata()
)

expect_range(vars, min, max, ..., flt = TRUE, data = get_testdata())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="value-expectations_+3A_vars">vars</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_tidy_select">tidy-select</a></code>&gt; A set of columns to
test.</p>
</td></tr>
<tr><td><code id="value-expectations_+3A_...">...</code></td>
<td>
<p>Vectors of valid values.</p>
</td></tr>
<tr><td><code id="value-expectations_+3A_miss">miss</code></td>
<td>
<p>A vector of values to be treated as missing. The
<a href="#topic+testdat">testdat.miss</a> or <a href="#topic+testdat">testdat.miss_text</a> option is used by
default.</p>
</td></tr>
<tr><td><code id="value-expectations_+3A_flt">flt</code></td>
<td>
<p>&lt;<code><a href="dplyr.html#topic+dplyr_data_masking">data-masking</a></code>&gt; A filter specifying
a subset of the data frame to test.</p>
</td></tr>
<tr><td><code id="value-expectations_+3A_data">data</code></td>
<td>
<p>A data frame to test. The <a href="#topic+global-data">global test data</a> is used
by default.</p>
</td></tr>
<tr><td><code id="value-expectations_+3A_min">min</code></td>
<td>
<p>Minimum value for range check.</p>
</td></tr>
<tr><td><code id="value-expectations_+3A_max">max</code></td>
<td>
<p>Maximum value for range check.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code style="white-space: pre;">&#8288;expect_*()&#8288;</code> functions are mainly called for their side effects. The
expectation signals its result (e.g. &quot;success&quot;, &quot;failure&quot;), which is logged
by the current <a href="testthat.html#topic+Reporter">test reporter</a>. In a non-testing
context the expectation will raise an error with class
<code>expectation_failure</code> if it fails.
</p>


<h3>See Also</h3>

<p><a href="#topic+chk-values">Checks: values</a>
</p>
<p>Other data expectations: 
<code><a href="#topic+conditional-expectations">conditional-expectations</a></code>,
<code><a href="#topic+datacomp-expectations">datacomp-expectations</a></code>,
<code><a href="#topic+date-expectations">date-expectations</a></code>,
<code><a href="#topic+exclusivity-expectations">exclusivity-expectations</a></code>,
<code><a href="#topic+expect_depends">expect_depends</a>()</code>,
<code><a href="#topic+generic-expectations">generic-expectations</a></code>,
<code><a href="#topic+label-expectations">label-expectations</a></code>,
<code><a href="#topic+pattern-expectations">pattern-expectations</a></code>,
<code><a href="#topic+proportion-expectations">proportion-expectations</a></code>,
<code><a href="#topic+text-expectations">text-expectations</a></code>,
<code><a href="#topic+uniqueness-expectations">uniqueness-expectations</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
sales &lt;- data.frame(
  sale_id = 1:5,
  date = c("20200101", "20200101", "20200102", "20200103", "20220101"),
  sale_price = c(10, 20, 30, 40, -1)
)

try(expect_values(date, 20000000:20210000, data = sales)) # Dates between 2000 and 2021
try(expect_range(sale_price, min = 0, max = Inf, data = sales)) # Prices non-negative

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
