<!DOCTYPE html><html><head><title>Help for package mevr</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {mevr}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#censored_weibull_fit'><p>Fit Weibull distribution to censored data</p></a></li>
<li><a href='#dailyrainfall'><p>Daily rainfall data</p></a></li>
<li><a href='#dmev'><p>The Metastatistical Extreme Value Distribution</p></a></li>
<li><a href='#dtmev'><p>The non-stationary Metastatistical Extreme Value Distribution</p></a></li>
<li><a href='#fmev'><p>Fitting the Metastatistical Extreme Value Distribution (MEVD)</p></a></li>
<li><a href='#fsmev'><p>Fitting the simplified Metastatistical Extreme Value Distribution (SMEV)</p></a></li>
<li><a href='#ftmev'><p>Fitting the temporal Metastatistical Extreme Value Distribution (TMEV)</p></a></li>
<li><a href='#plot.mevr'><p>Plot graphs of MEVD, SMEV or TMEV fit</p></a></li>
<li><a href='#pp.weibull'><p>Weibull plotting position</p></a></li>
<li><a href='#predict.mevr'><p>TMEV prediction</p></a></li>
<li><a href='#print.mevr'><p>Print method for object of class mevr</p></a></li>
<li><a href='#return.levels.mev'><p>Return Levels for the MEVD/SMEV/TMEV extreme value distributions</p></a></li>
<li><a href='#weibull_tail_test'><p>Weibull tail test</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Version:</td>
<td>1.1.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-06-24</td>
</tr>
<tr>
<td>Title:</td>
<td>Fitting the Metastatistical Extreme Value Distribution MEVD</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Harald Schellander &lt;harald.schellander@geosphere.at&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.1), dplyr, rlang</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Imports:</td>
<td>graphics, stats, EnvStats, parallel, foreach, doParallel,
bamlss, mgcv</td>
</tr>
<tr>
<td>Description:</td>
<td>Extreme value analysis with the metastatistical extreme value distribution MEVD (Marani and Ignaccolo, 2015, &lt;<a href="https://doi.org/10.1016%2Fj.advwatres.2015.03.001">doi:10.1016/j.advwatres.2015.03.001</a>&gt;) and some of its variants. In particular, analysis can be performed with the simplified metastatistical extreme value distribution SMEV (Marra et al., 2019, &lt;<a href="https://doi.org/10.1016%2Fj.advwatres.2019.04.002">doi:10.1016/j.advwatres.2019.04.002</a>&gt;) and the temporal metastatistical extreme value distribution TMEV (Falkensteiner et al., 2023, &lt;<a href="https://doi.org/10.1016%2Fj.wace.2023.100601">doi:10.1016/j.wace.2023.100601</a>&gt;). Parameters can be estimated with probability weighted moments, maximum likelihood and least squares. The data can also be left-censored prior to a fit. Density, distribution function, quantile function and random generation for the MEVD, SMEV and TMEV are included. In addition, functions for the calculation of return levels including confidence intervals are provided. For a description of use cases please see the provided references.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-06-30 06:09:28 UTC; hschellander</td>
</tr>
<tr>
<td>Author:</td>
<td>Harald Schellander
    <a href="https://orcid.org/0000-0001-7661-287X"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut, cre]
    (Package creator and maintainer),
  Alexander Lieb [ctb] (Coded first versions of MEVD and SMEV),
  Marc-Andre Falkensteiner [ctb] (Developed the TMEV)</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-06-30 06:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='censored_weibull_fit'>Fit Weibull distribution to censored data</h2><span id='topic+censored_weibull_fit'></span>

<h3>Description</h3>

<p>Finds the optimal left-censoring threshold(s) at which 
the data series should be censored to make sure that the observations 
in the tail are likely sampled from a Weibull distribution
</p>


<h3>Usage</h3>

<pre><code class='language-R'>censored_weibull_fit(x, thresholds)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="censored_weibull_fit_+3A_x">x</code></td>
<td>
<p>A tibble which is most commonly a result of function 
<code><a href="#topic+weibull_tail_test">weibull_tail_test</a></code>.</p>
</td></tr>
<tr><td><code id="censored_weibull_fit_+3A_thresholds">thresholds</code></td>
<td>
<p>A numeric or vector of quantiles which shal be tested 
as optimal threshold for left-censoring.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble with the optimal threshold itself and 
the Weibull scale and shape parameters obtained from the censored sample.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data("dailyrainfall")
wbtest &lt;- weibull_tail_test(dailyrainfall)
censored_weibull_fit(wbtest, 0.9)

</code></pre>

<hr>
<h2 id='dailyrainfall'>Daily rainfall data</h2><span id='topic+dailyrainfall'></span>

<h3>Description</h3>

<p>A dataset containing daily rainfall 
intended to be used with the package <code>mevr</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(dailyrainfall)
</code></pre>


<h3>Format</h3>

<p>The dataset contains real world daily rainfall observations from a station 
in the northern Alps. The series contains values from 1971 to 1985 and are assumed to be 
Weibull distributed. This data series is intended to be used as is as input data 
for the package <code>mevr</code> to fit the metastatistical extreme value 
distribution and its variants with different estimation methods.
</p>
<p>The dataset is a dataframe with two columns, dates and val:
</p>

<dl>
<dt>dates</dt><dd><p> Days of class <code>Date</code> in the format YYYY-MM-DD</p>
</dd>
<dt>val</dt><dd><p> Rainfall observations corresponding to the date in the row. 
The value is the 24 hour sum from the morning hours of day-1 to the morning hours of day. </p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>## Load example data
data(dailyrainfall)

## explore dataset
head(dailyrainfall)
hist(dailyrainfall$val)
plot(dailyrainfall$val, type = "o")
</code></pre>

<hr>
<h2 id='dmev'>The Metastatistical Extreme Value Distribution</h2><span id='topic+dmev'></span><span id='topic+pmev'></span><span id='topic+qmev'></span><span id='topic+rmev'></span>

<h3>Description</h3>

<p>Density, distribution function, quantile function and random generation for the 
MEV distribution with shape parameter 'w', scale parameter 'c'. 
Parameter 'n' refers either to the mean number of wet days per year in case 
of the simplified MEV, or to the number of wet days for each year.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dmev(x, w, c, n)

pmev(q, w, c, n)

qmev(p, w, c, n)

rmev(N, w, c, n)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dmev_+3A_x">x</code>, <code id="dmev_+3A_q">q</code></td>
<td>
<p>numeric vector or single values of quantiles for <code>dmev</code> 
and <code>pmev</code>.</p>
</td></tr>
<tr><td><code id="dmev_+3A_w">w</code>, <code id="dmev_+3A_c">c</code></td>
<td>
<p>vector or single values of shape and scale parameter of the 
MEV distribution. If a vector, w and c must have the same length as n.</p>
</td></tr>
<tr><td><code id="dmev_+3A_n">n</code></td>
<td>
<p>Either mean number of wet events per year for the SMEV, 
or a vector for yearly MEVD calculations, i.e. one value per year (see details). 
If a vector, n must have the same length as w and c.</p>
</td></tr>
<tr><td><code id="dmev_+3A_p">p</code></td>
<td>
<p>vector or single value of probabilities for <code>qmev</code>.</p>
</td></tr>
<tr><td><code id="dmev_+3A_n">N</code></td>
<td>
<p>Number of observations to sample from the MEVD or SMEV.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>dmev</code> gives the density function, <code>pmev</code> gives the distribution function, 
<code>qmev</code> gives the quantile function and <code>rmev</code> provides random realizations of 
the SMEV and MEVD.
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>pmev()</code>: distribution quantile function
</p>
</li>
<li> <p><code>qmev()</code>: quantile function
</p>
</li>
<li> <p><code>rmev()</code>: random generation function
</p>
</li></ul>


<h3>Examples</h3>

<pre><code class='language-R'># SMEV
dmev(1200:1300, 0.7, 20, 110)
pmev(1200:1300, 0.7, 70, 110)
qmev(1 - 1 / seq(5,50,5), 0.7, 70, 110)

# MEVD: 50-year event of 10 years Weibull series
w &lt;- rnorm(10, 0.8, 0.1) # shape parameter
c &lt;- rnorm(10, 200, 30) # scale parameter
n &lt;- rnorm(10, 200, 50) # number of wet days
qmev(1 - 1 / 50, w, c, n)

# rl-plot
rp &lt;- seq(5, 50, 5)
rl &lt;- qmev(1 - 1 / rp, w, c, n)
pp &lt;- (1:length(rp)) / (length(rp) + 1)
plot(pp, rl, type = "o")
</code></pre>

<hr>
<h2 id='dtmev'>The non-stationary Metastatistical Extreme Value Distribution</h2><span id='topic+dtmev'></span><span id='topic+ptmev'></span><span id='topic+qtmev'></span>

<h3>Description</h3>

<p>Quantile function for the TMEV distribution with a Weibull parent distribution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dtmev(x, data)

ptmev(q, data)

qtmev(p, data)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dtmev_+3A_x">x</code>, <code id="dtmev_+3A_q">q</code></td>
<td>
<p>Numeric vector or single value of probabilities for <code>dtmev</code>.</p>
</td></tr>
<tr><td><code id="dtmev_+3A_data">data</code></td>
<td>
<p>A data frame with at least columns <code>c</code>, <code>w</code> and <code>year</code>. 
Can be taken from the output of the fitted TMEV object, i.e. <code>x$data</code> (see <code><a href="#topic+ftmev">ftmev</a></code>).</p>
</td></tr>
<tr><td><code id="dtmev_+3A_p">p</code></td>
<td>
<p>Numeric vector or single value of probabilities for <code>qtmev</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>dtmev</code> gives the density function, <code>ptmev</code> gives the distribution function, 
and <code>qtmev</code> gives the quantile function of the TMEV.
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>ptmev()</code>: distribution quantile function
</p>
</li>
<li> <p><code>qtmev()</code>: distribution quantile function
</p>
</li></ul>


<h3>Examples</h3>

<pre><code class='language-R'>data(dailyrainfall)
fit &lt;- ftmev(dailyrainfall)
rp &lt;- pp.weibull(fit$maxima)
rl &lt;- qtmev(1 - 1 / rp, fit$data)
plot(rp, sort(fit$maxima), main = "TMEV", ylab = "return level", xlab = "return period (years)")
lines(rp, rl, type = "l")


</code></pre>

<hr>
<h2 id='fmev'>Fitting the Metastatistical Extreme Value Distribution (MEVD)</h2><span id='topic+fmev'></span>

<h3>Description</h3>

<p>Fit the MEVD distribution to rainfall observations with different estimation methods.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fmev(data, threshold = 0, method = c("pwm", "mle", "ls"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fmev_+3A_data">data</code></td>
<td>
<p>The data to which the MEVD should be fitted to. <code>data</code> must be a data.frame with two columns. 
The first column must contain dates of class  <code>Date</code>, the second or last column must contain the rainfall 
values corresponding to datums in the rows. No negative values are allowed. NA values are removed with a warning.</p>
</td></tr>
<tr><td><code id="fmev_+3A_threshold">threshold</code></td>
<td>
<p>A numeric that is used to define wet days as values &gt; threshold. 
<code class="reqn">data &lt;= threshold</code> is set to NA.</p>
</td></tr>
<tr><td><code id="fmev_+3A_method">method</code></td>
<td>
<p>Character string describing the method that is used to estimate the 
Weibull parameters c and w. Possible options are probability weighted moments (<code>method='pwm'</code>), 
maximum likelihood (<code>method='mle'</code>) or least squares (<code>method='ls'</code>). 
The <code>default</code> is <code>pwm</code>. (see details).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>With the aim of weakening the requirement of an asymptotic assumption for the GEV distribution, 
a metastatistical approach was proposed by Marani and Ignaccolo (2015). The MEVD is defined 
in terms of the distribution of the statistical parameters describing &quot;ordinary&quot; daily rainfall 
occurrence and intensity. The MEVD accounts for the random process of event occurrence in each 
block and the possibly changing probability distribution of event magnitudes across different blocks, 
by recognizing the number of events in each block, n, and the values of the shape and scale 
parameters w and C of the parent Weibull distribution to be realisations of stochastic variables. 
The MEVD can then be written as
</p>
<p style="text-align: center;"><code class="reqn">F = \frac{1}{T} \sum_{j=1}^T \prod_{k \in A_j} \left( 1-e^{-\left(\frac{x}{C(j,k)}\right)^{w(j,k)}} \right)</code>
</p>

<p>for <code class="reqn">w &gt; 0</code> and <code class="reqn">C &gt; 0</code>. With T fully recorded years, yearly C and w can be estimated 
by fitting a Weibull distribution to the values x of this year, and n is the number of ordinary 
events per year, i.e. all rainfall events larger than a threshold. 
</p>
<p>If the probability distribution of daily rainfall is assumed to be time-invariant, the MEVD can be simplified to 
</p>
<p style="text-align: center;"><code class="reqn">F = [1 - exp(-x/C)^w]^n</code>
</p>

<p>with single values for the shape and scale parameters w and C. n is then the mean number of wet 
days at this location (Marra et al., 2019; Schellander et al., 2019).
</p>
<p>As is shown e.g. Schellander et al., 2019, probability weighted moments should be preferred 
over maximum likelihood for the estimation of the Weibull parameters w and C. 
Therefore <code>method = 'pwm'</code> is the default.
</p>
<p>The MEVD can also be used for sub-daily precipitation (Marra et al., 2019). 
In that case n has to be adapted accordingly to the 'mean number of wet events' per year.
</p>
<p>This function returns the parameters of the fitted MEVD distribution as well as some 
additional fitting results and input parameters useful for further analysis.
</p>


<h3>Value</h3>

<p>A list of class <code>mevr</code> with the fitted Weibull parameters and other helpful ingredients.
</p>
<table>
<tr><td><code>c</code></td>
<td>
<p> vector of Weibull scale parameters of the MEVD, each component refers to one year.</p>
</td></tr>
<tr><td><code>w</code></td>
<td>
<p> vector of Weibull shape parameters of the MEVD, each component refers to one year.</p>
</td></tr>
<tr><td><code>n</code></td>
<td>
<p> Number of wet events per year. Wet events are defined as rainfall &gt; <code>threshold</code>.</p>
</td></tr>
<tr><td><code>params</code></td>
<td>
<p> A named vector of the fitted parameters. </p>
</td></tr>
<tr><td><code>maxima</code></td>
<td>
<p> Maximum values corresponding to each year.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
 <p><code class="reqn">data &gt;= threshold</code> used to fit the MEVD and additional components which may be useful for further analysis.</p>
</td></tr>
<tr><td><code>years</code></td>
<td>
<p> Vector of years as YYYY.</p>
</td></tr>
<tr><td><code>threshold</code></td>
<td>
<p> The chosen threshold.</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p> Method used to fit the MEVD.</p>
</td></tr>
<tr><td><code>type</code></td>
<td>
<p> The type of distribution (&quot;MEVD&quot;)</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Harald Schellander, Alexander Lieb
</p>


<h3>References</h3>

<p>Marani, M. and Ignaccolo, M. (2015) 'A metastatistical approach to rainfall extremes', Advances in Water Resources. Elsevier Ltd, 79(Supplement C), pp. 121-126. doi: 10.1016/j.advwatres.2015.03.001.
</p>
<p>Schellander, H., Lieb, A. and Hell, T. (2019) 'Error Structure of Metastatistical and Generalized Extreme Value Distributions for Modeling Extreme Rainfall in Austria', Earth and Space Science, 6, pp. 1616-1632. doi: 10.1029/2019ea000557.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fsmev">fsmev</a></code>, <code><a href="#topic+ftmev">ftmev</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(dailyrainfall)
fit &lt;- fmev(dailyrainfall, method = "mle")
fit
plot(fit)

</code></pre>

<hr>
<h2 id='fsmev'>Fitting the simplified Metastatistical Extreme Value Distribution (SMEV)</h2><span id='topic+fsmev'></span>

<h3>Description</h3>

<p>Fit the SMEV distribution to rainfall observations with different estimation methods.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fsmev(
  data,
  threshold = 0,
  method = c("pwm", "mle", "ls"),
  censor = FALSE,
  censor_opts = list(),
  sd = FALSE,
  sd.method = "boot",
  R = 502
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fsmev_+3A_data">data</code></td>
<td>
<p>The data to which the SMEV should be fitted to. <code>data</code> must be a data.frame with two columns. 
The first column must contain dates of class <code>Date</code>, the second or last column must contain the rainfall 
values corresponding to datums in the rows. No negative values are allowed. NA values are removed with a warning.</p>
</td></tr>
<tr><td><code id="fsmev_+3A_threshold">threshold</code></td>
<td>
<p>A numeric that is used to define wet days as values &gt; threshold. 
<code class="reqn">data &lt;= threshold</code> is set to NA.</p>
</td></tr>
<tr><td><code id="fsmev_+3A_method">method</code></td>
<td>
<p>Character string describing the method that is used to estimate the 
Weibull parameters c and w. Possible options are probability weighted moments (<code>method='pwm'</code>), 
maximum likelihood (<code>method='mle'</code>) or least squares (<code>method='ls'</code>). 
The <code>default</code> is <code>pwm</code>. (see details).</p>
</td></tr>
<tr><td><code id="fsmev_+3A_censor">censor</code></td>
<td>
<p>If <code>censor=TRUE</code>, the data series will be left-censored to assure that the observed maxima
are samples from a weibull tail. Defaults to <code>censor=FALSE</code>.</p>
</td></tr>
<tr><td><code id="fsmev_+3A_censor_opts">censor_opts</code></td>
<td>
<p>An empty list which can be populated with components <code>thresholds</code>, <code>mon</code>, <code>nrtrials</code> and <code>R</code>. 
They give the range of quantiles used as left-censoring threshold, the month with which the block starts, 
the number of trials used to achieve a weibull fit to the left-censored sample, and the number of synthetic samples 
used for the test statistics, respectively. See also <code><a href="#topic+weibull_tail_test">weibull_tail_test</a></code>.</p>
</td></tr>
<tr><td><code id="fsmev_+3A_sd">sd</code></td>
<td>
<p>If <code>sd=TRUE</code>, confidence intervals of the SMEV distribution are calculated (see details).</p>
</td></tr>
<tr><td><code id="fsmev_+3A_sd.method">sd.method</code></td>
<td>
<p>Currently only a non parametric bootstrap technique can be used to calculate SMEV confidence intervals with <code>sd.method='boot'</code>. The default is <code>sd=FALSE</code>.</p>
</td></tr>
<tr><td><code id="fsmev_+3A_r">R</code></td>
<td>
<p>The number of samples drawn from the SMEV distribution to calculate the confidence intervals with <code>sd.method='boot'</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The SMEV was introduced by (Marra et al., 2019) as a simplified version of the MEVD 
(Marani and Ignaccolo, 2015) with the assumption of a stationary parent Weibull distribution 
as 
</p>
<p style="text-align: center;"><code class="reqn">F = [1 - exp(-x/C)^w]^n</code>
</p>

<p>for <code class="reqn">w &gt; 0</code> and <code class="reqn">C &gt; 0</code> being the Weibull shape and scale parameter and 
<code class="reqn">n &gt; 0</code> being the mean number of wet days over all years. 
Wet days are defined as rainfall events &gt; threshold. As it was shown by 
e.g. Schellander et al., 2019, probability weighted moments should be preferred over 
maximum likelihood for the estimation of the Weibull parameters w and C. Therefore 
<code>method = 'pwm'</code> is the default.
</p>
<p>Confidence intervals of the SMEV distribution can be calculated using a non parametric 
bootstrap technique. Note that this very slow. 
</p>
<p>This function returns the parameters of the fitted SMEV distribution as well as some 
additional fitting results and input parameters useful for further analysis.
</p>


<h3>Value</h3>

<p>A list of class <code>mevr</code> with components:
</p>
<table>
<tr><td><code>c</code></td>
<td>
<p> Single value of the Weibull scale parameter of the SMEV.</p>
</td></tr>
<tr><td><code>w</code></td>
<td>
<p> Single value of the Weibull shape parameter of the SMEV.</p>
</td></tr>
<tr><td><code>n</code></td>
<td>
<p> Mean number of wet events, averaged over all years. Wet events are defined as rainfall &gt; <code>threshold</code>.</p>
</td></tr>
<tr><td><code>params</code></td>
<td>
<p> A named vector of the fitted parameters. </p>
</td></tr>
<tr><td><code>maxima</code></td>
<td>
<p> Maximum values corresponding to each year.</p>
</td></tr>
<tr><td><code>std</code></td>
<td>
<p> Standard error of fitted parameters (if <code>sd=TRUE</code>).</p>
</td></tr>
<tr><td><code>varcov</code></td>
<td>
<p> Covariance matrix of fitted parameters (if <code>sd=TRUE</code>).</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
 <p><code class="reqn">data &gt;= threshold</code> used to fit the SMEV and additional components which may be useful for further analysis.</p>
</td></tr>
<tr><td><code>years</code></td>
<td>
<p> Vector of years as YYYY.</p>
</td></tr>
<tr><td><code>threshold</code></td>
<td>
<p> The chosen threshold.</p>
</td></tr>
<tr><td><code>method</code></td>
<td>
<p> Method used to fit the MEVD. Note that <code>method</code> is set to <code>censored lsreg</code> when the data is left-censored
and the weibull tail test is not rejected.</p>
</td></tr>
<tr><td><code>type</code></td>
<td>
<p> The type of distribution (&quot;SMEV&quot;)</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Harald Schellander, Alexander Lieb
</p>


<h3>References</h3>

<p>Marra, F. et al. (2019) 'A simplified MEV formulation to model extremes emerging from multiple nonstationary underlying processes', Advances in Water Resources. Elsevier Ltd, 127(April), pp. 280-290. doi: 10.1016/j.advwatres.2019.04.002.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fmev">fmev</a></code>, <code><a href="#topic+ftmev">ftmev</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(dailyrainfall)

fit &lt;- fsmev(dailyrainfall)
fit
plot(fit)

# left censor data prior to fitting
set.seed(123)
sample_dates &lt;- seq.Date(from = as.Date("2000-01-01"), to = as.Date("2020-12-31"), by = 1)
sample_data &lt;- data.frame(dates = sample_dates, val = sample(rnorm(length(sample_dates))))
d &lt;- sample_data |&gt;
  filter(val &gt;= 0 &amp; !is.na(val))

fit &lt;- fsmev(d)
fit_c &lt;- fsmev(d, 
               censor = TRUE, 
               censor_opts = list(thresholds = c(seq(0.5, 0.9, 0.1), 0.95),
                                  mon = 1,
                                  nrtrials = 2,
                                  R = 100))

rp &lt;- 2:100
rl &lt;- return.levels.mev(fit, return.periods = rp)
rl_c &lt;- return.levels.mev(fit_c, return.periods = rp)
plot(sort(pp.weibull(fit$maxima)), sort(fit$maxima))
lines(rl$rp, rl$rl)
lines(rl_c$rp, rl_c$rl, col = "red")


</code></pre>

<hr>
<h2 id='ftmev'>Fitting the temporal Metastatistical Extreme Value Distribution (TMEV)</h2><span id='topic+ftmev'></span>

<h3>Description</h3>

<p>Fit the temporal MEVD distribution TMEV to rainfall observations with a cyclic spline to account for seasonality.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ftmev(
  data,
  threshold = 0,
  minyears = 10,
  day_year_interaction = FALSE,
  verbose = FALSE,
  yday_ti_shape_k = 10,
  yday_ti_scale_k = 10,
  year_ti_shape_k = 10,
  year_ti_scale_k = 10
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ftmev_+3A_data">data</code></td>
<td>
<p>The data to which the TMEV should be fitted to. <code>data</code> must be a data.frame with two columns. 
The first column must contain dates of class  <code>Date</code>, the second or last column must contain the rainfall 
values corresponding to datums in the rows. No negative values are allowed. NA values are removed with a warning.</p>
</td></tr>
<tr><td><code id="ftmev_+3A_threshold">threshold</code></td>
<td>
<p>A numeric that is used to define wet days as values &gt; threshold. 
<code class="reqn">data &lt;= threshold</code> is set to NA.</p>
</td></tr>
<tr><td><code id="ftmev_+3A_minyears">minyears</code></td>
<td>
<p>Minimum number of available years for fitting a cyclic spline to the non-stationary data series (see details).</p>
</td></tr>
<tr><td><code id="ftmev_+3A_day_year_interaction">day_year_interaction</code></td>
<td>
<p>Logical. Should an additional year vs day of the year 
interaction be used for the calculation of the temporal trend in seasonality?  (see details). Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="ftmev_+3A_verbose">verbose</code></td>
<td>
<p>Logical. If <code>TRUE</code>, verbose output of the temporal fitting process is shown during runtime.</p>
</td></tr>
<tr><td><code id="ftmev_+3A_yday_ti_shape_k">yday_ti_shape_k</code></td>
<td>
<p>A numeric that is used to set the dimension of the bases used to represent the smooth term ti() for yday in the formula for shape.</p>
</td></tr>
<tr><td><code id="ftmev_+3A_yday_ti_scale_k">yday_ti_scale_k</code></td>
<td>
<p>A numeric that is used to set the dimension of the bases used to represent the smooth term ti() for yday in the formula for scale.</p>
</td></tr>
<tr><td><code id="ftmev_+3A_year_ti_shape_k">year_ti_shape_k</code></td>
<td>
<p>A numeric that is used to set the dimension of the bases used to represent the smooth term ti() for year in the formula for shape (only used when day_year_interaction == TRUE).</p>
</td></tr>
<tr><td><code id="ftmev_+3A_year_ti_scale_k">year_ti_scale_k</code></td>
<td>
<p>A numeric that is used to set the dimension of the bases used to represent the smooth term ti() for year in the formula for scale (only used when day_year_interaction == TRUE).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>With the aim of exploiting the full temporal information for parameter estimation, 
Falkensteiner et al., (2023) introduced the TMEV, which is an explicitly 
non-stationary formulation of the MEVD (Marani and Ignaccolo, 2015). Adopting a 
Weibull distribution for ordinary rainfall events, the assumption of yearly 
constant coefficients is relaxed by allowing the Weibull
parameters to fluctuate with time. The TMEV can then be written as  
</p>
<p style="text-align: center;"><code class="reqn">F = \frac{1}{T} \sum_{j=1}^T \prod_{k \in A_j} \left( 1-e^{-\left(\frac{x}{C(j,k)}\right)^{w(j,k)}} \right)</code>
</p>

<p>with <code class="reqn">w &gt; 0</code> and <code class="reqn">C &gt; 0</code> being the Weibull shape and scale parameters, and 
$A_j \subseteq (1, ..., 366)$ being the wet days in year j. The temporal and 
the superimposed seasonal dependence on w and c is modeled with a cyclic seasonal 
effect on the day of the year. 
</p>
<p>Technically this is accomplished by fitting a cyclic spline to the daily rainfall 
values. The following formula is used for the fitting procedure of both the Weibull scale and 
shape parameter with the function <code><a href="bamlss.html#topic+bamlss">bamlss</a></code> from package <code>bamlss</code>: 
</p>
<p style="text-align: center;"><code class="reqn">parameter = x \sim s(year) + ti(yday, bs = "cc", k = 10)</code>
</p>

<p>The first effect models the long-term temporal trend of the parameter with a thin-plate spline. 
The second effect models the superimposed seasonal fluctuations of the parameter 
with the 'day of the year' with a cyclic cubic regression spline and 10 knots, 
to ensure a smooth transition between December and January. The number of knots (k)
in the above equation can be set separately for the year and yday effect as well as 
separately for the shape and scale parameter of the Weibull distribution. This can be done
by overwriting the parameters <code>yday_ti_shape_k</code>, <code>yday_ti_scale_k</code>, 
<code>year_ti_shape_k</code>, <code>year_ti_scale_k</code> in the call to <code>ftmev</code>. Note that 
these values depend on many factors, such as the structure of the data, the TMEV is fitted to.
Please refer to the documentation of the packages <code><a href="bamlss.html#topic+bamlss">bamlss</a></code> and, 
in particular <code><a href="mgcv.html#topic+mgcv">mgcv</a></code>.
</p>
<p>For data series with lengths &lt; 10 years, the first temporal effect is changed to 
a simple linear time trend. 
</p>
<p>For trend analysis, an additional interaction term can be added to the model formula. 
The following term models the relationship between the seasonality as day of the year 
and the year itself with a combination of a thin plate and a cyclic cubic spline:
</p>
<p style="text-align: center;"><code class="reqn">ti(year, yday, bs = c("tp", "cc"), d = c(1, 1), k = c(year_ti_k, yday_ti_k))</code>
</p>

<p>This function returns the parameters of the fitted TMEV distribution as well as some 
additional fitting results and input parameters useful for further analysis.
</p>


<h3>Value</h3>

<p>A list of class <code>mevr</code> with components:
</p>
<table>
<tr><td><code>c</code></td>
<td>
<p> Vector of Weibull scale parameters of the TMEV, each row refers to one event, which is a day for daiyl rainfall.</p>
</td></tr>
<tr><td><code>w</code></td>
<td>
<p> Vector of Weibull shape parameters of the TMEV, each row refers to one event, which is a day for daiyl rainfall.</p>
</td></tr>
<tr><td><code>n</code></td>
<td>
<p> Number of wet events per year. Wet events are defined as rainfall &gt; <code>threshold</code>.</p>
</td></tr>
<tr><td><code>maxima</code></td>
<td>
<p> Maximum values corresponding to each year.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p> A data frame with the data used to fit the TMEV and the fitted Weibull parameters <code>c</code> and <code>w</code>. </p>
</td></tr>
<tr><td><code>years</code></td>
<td>
<p> Vector of years as YYYY.</p>
</td></tr>
<tr><td><code>threshold</code></td>
<td>
<p> The chosen threshold.</p>
</td></tr>
<tr><td><code>x</code></td>
<td>
<p> The fitted <code>bamlss</code> object.</p>
</td></tr>
<tr><td><code>type</code></td>
<td>
<p> The type of distribution (&quot;TMEV&quot;).</p>
</td></tr>
<tr><td><code>minyears</code></td>
<td>
<p> The minimum number of years used to fit the TMEV as provided.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Marc-Andre Falkensteiner, Harald Schellander
</p>


<h3>References</h3>

<p>Marani, M. and Ignaccolo, M. (2015) 'A metastatistical approach to rainfall extremes', Advances in Water Resources. Elsevier Ltd, 79(Supplement C), pp. 121-126. doi: 10.1016/j.advwatres.2015.03.001.
</p>
<p>Falkensteiner, M., Schellander, H., Hell, T. (2023) 'Accounting for seasonality in the metastatistical extreme value distribution', (Weather and Climate Extremes, 42, 2023, https://doi.org/10.1016/j.wace.2023.100601).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fmev">fmev</a></code>, <code><a href="#topic+fsmev">fsmev</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(dailyrainfall)
fit &lt;- ftmev(dailyrainfall)
plot(fit, type = "rl")

# temporal trend of the Weibull parameters 
pred &lt;- predict(fit)
pred_year &lt;- predict(fit, term = "year")
boxplot(c.pred ~ year, data = pred)
with(pred_year, lines(year - 1970, c.pred.year, type = "b", pch = 20, col = "red"))

</code></pre>

<hr>
<h2 id='plot.mevr'>Plot graphs of MEVD, SMEV or TMEV fit</h2><span id='topic+plot.mevr'></span>

<h3>Description</h3>

<p>A return level plot, qq-plot, pp-plot and a histogram with the fitted density is produced
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mevr'
plot(
  x,
  q = c(2, 10, 20, 30, 50, 75, 100, 150, 200),
  ci = FALSE,
  type = c("all", "rl", "qq", "pp", "hist"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.mevr_+3A_x">x</code></td>
<td>
<p>An object of class<code>mevr</code>, whose <code>type</code> argument is one of MEVD, SMEV or TMEV</p>
</td></tr>
<tr><td><code id="plot.mevr_+3A_q">q</code></td>
<td>
<p>vector of return periods, <code class="reqn">q &gt; 1</code>.</p>
</td></tr>
<tr><td><code id="plot.mevr_+3A_ci">ci</code></td>
<td>
<p>if <code>ci=TRUE</code>, confidence intervals will be computed.</p>
</td></tr>
<tr><td><code id="plot.mevr_+3A_type">type</code></td>
<td>
<p>if omitted a panel with a return level plot (<code>type='rl'</code>, 
a density plot (<code>type='hist'</code>), a qq-plot (<code>type='qq'</code>) and a 
probability plot (<code>tpe='pp'</code>) are shown.</p>
</td></tr>
<tr><td><code id="plot.mevr_+3A_...">...</code></td>
<td>
<p>Further parameters may also be supplied as arguments. 
See e.g. <a href="base.html#topic+plot">plot</a>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, only a plot is produced.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(dailyrainfall)

# fit a simplified MEVD
fit &lt;- fsmev(dailyrainfall)
fit
plot(fit)

# fit MEVD
fit &lt;- fmev(dailyrainfall, method = "ls")
fit
plot(fit)
</code></pre>

<hr>
<h2 id='pp.weibull'>Weibull plotting position</h2><span id='topic+pp.weibull'></span>

<h3>Description</h3>

<p>Calculates the Weibull plotting position for the given maxima
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pp.weibull(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pp.weibull_+3A_x">x</code></td>
<td>
<p>Numeric vector of block maxima</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector of Weibull plotting positions corresponding to the given maxima <code>x</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(dailyrainfall)
fit &lt;- fsmev(dailyrainfall)
rp &lt;- pp.weibull(fit$maxima)
rl &lt;- return.levels.mev(fit, return.periods = rp)
plot(rp, sort(fit$maxima), xlab = "Return period (years)", ylab = "Return level", main = fit$type)
lines(rp, rl$rl)
</code></pre>

<hr>
<h2 id='predict.mevr'>TMEV prediction</h2><span id='topic+predict.mevr'></span>

<h3>Description</h3>

<p>Takes a <code>mevr</code> object where the TMEV has been fitted to rainfall data and calculates 
<code>bamlss</code> predictions for the distributional parameters and the model terms. Basically 
a wrapper to the corresponding function <code>predict.bamlss</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mevr'
predict(object, newdata, term, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict.mevr_+3A_object">object</code></td>
<td>
<p>Object of class <code>mevr</code>, fitted with the TMEV.</p>
</td></tr>
<tr><td><code id="predict.mevr_+3A_newdata">newdata</code></td>
<td>
<p>A data frame with the model covariates (year, yday) at which predictions are required. 
Note that depending on argument term, only covariates that are needed by the corresponding model terms need to be supplied.
If not supplied, predictions are made on the data supplied by the fitted object <code>x</code>.</p>
</td></tr>
<tr><td><code id="predict.mevr_+3A_term">term</code></td>
<td>
<p>Character of the model terms for which predictions shall be calculated. 
Can only be <code>"year"</code> or <code>"yday"</code>. If not specified, predictions for all terms are calculated.</p>
</td></tr>
<tr><td><code id="predict.mevr_+3A_...">...</code></td>
<td>
<p>Arguments passed to prediction functions that are part of a bamlss.family object, i.e., the objects has a $predict() function that should be used instead.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See also the details of <code><a href="#topic+ftmev">ftmev</a></code> for an explanation of the model terms used to fit the temporal trend 
of the Weibull parameters. The basis dimensions yday_ti_shape_k, 
yday_ti_scale_k, year_ti_shape_k, year_ti_scale_k are taken from 
the fitting process, i.e. the call to <code><a href="#topic+ftmev">ftmev</a></code>.
</p>


<h3>Value</h3>

<p>A data.frame with the supplied covariables and the predicted parameters.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ftmev">ftmev</a></code>, <code><a href="bamlss.html#topic+predict.bamlss">predict.bamlss</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(dailyrainfall)

# restrict for the sake of speed
idx &lt;- which(as.POSIXlt(dailyrainfall$date)$year + 1900 &lt; 1976)
data &lt;- dailyrainfall[idx, ]

f &lt;- ftmev(data, minyears = 5)
predict(f, term = "year")

</code></pre>

<hr>
<h2 id='print.mevr'>Print method for object of class mevr</h2><span id='topic+print.mevr'></span>

<h3>Description</h3>

<p>Print nicely formatted output of the fit to the MEVD and its variants
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mevr'
print(x, digits = max(3, getOption("digits") - 3), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.mevr_+3A_x">x</code></td>
<td>
<p>Object of class <code>mevr</code>, fitted with MEVD, SMEV or TMEV.</p>
</td></tr>
<tr><td><code id="print.mevr_+3A_digits">digits</code></td>
<td>
<p>Number of digits.</p>
</td></tr>
<tr><td><code id="print.mevr_+3A_...">...</code></td>
<td>
<p>Additional parameters.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A nicely formatted output of the fitting results.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(dailyrainfall)

# fit a simplified MEVD
fit &lt;- fsmev(dailyrainfall)
print(fit)
</code></pre>

<hr>
<h2 id='return.levels.mev'>Return Levels for the MEVD/SMEV/TMEV extreme value distributions</h2><span id='topic+return.levels.mev'></span>

<h3>Description</h3>

<p>Calculate return levels for a MEVD, SMEV or TMEV extreme value distributions 
from an object of class <code>mevr</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>return.levels.mev(
  x,
  return.periods = c(2, 10, 20, 30, 50, 75, 100, 150, 200),
  ci = FALSE,
  alpha = 0.05,
  method = "boot",
  R = 502,
  ncores = 2L
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="return.levels.mev_+3A_x">x</code></td>
<td>
<p>An object of class <code>mevr</code>, either fitted with the MEVD, SMEV or TMEV</p>
</td></tr>
<tr><td><code id="return.levels.mev_+3A_return.periods">return.periods</code></td>
<td>
<p>A vector of return periods in years, excluding 1.</p>
</td></tr>
<tr><td><code id="return.levels.mev_+3A_ci">ci</code></td>
<td>
<p>If <code>ci=TRUE</code>, confidence intervals are calculated depending on the type of distribution (only for MEVD or SMEV).</p>
</td></tr>
<tr><td><code id="return.levels.mev_+3A_alpha">alpha</code></td>
<td>
<p>Number between zero and one giving the <code>1 - alpha</code> confidence level. Defaults to <code>alpha=0.05</code>.</p>
</td></tr>
<tr><td><code id="return.levels.mev_+3A_method">method</code></td>
<td>
<p>Character string giving the method for confidence interval calculation. Option <code>method='boot'</code> employs a 
parametric bootstrap that simulates data from the fitted model, and then fits the chosen MEVD type to each simulated data set 
to obtain a sample of parameters or return levels (very slow).</p>
</td></tr>
<tr><td><code id="return.levels.mev_+3A_r">R</code></td>
<td>
<p>The number of bootstrap iterations.</p>
</td></tr>
<tr><td><code id="return.levels.mev_+3A_ncores">ncores</code></td>
<td>
<p>Number of cores used for parallel computing of confidence intervals. Defaults to 2.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Note that bootstraping the confidence intervals is very slow.
</p>


<h3>Value</h3>

<p>A list with return levels, chosen return periods and, if <code>ci=TRUE</code>, 
<code>alpha/2</code> and <code>1 - alpha/2</code> confidence intervals.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(dailyrainfall)

fit &lt;- fmev(dailyrainfall)
return.levels.mev(fit)
plot(fit)
 
</code></pre>

<hr>
<h2 id='weibull_tail_test'>Weibull tail test</h2><span id='topic+weibull_tail_test'></span>

<h3>Description</h3>

<p>This functions provides a way to test if observed rainfall maxima from a data series are 
likely samples from a parent distribution with a Weibull tail. The concept and the 
code is based on the paper Marra F, W Amponsah, SM Papalexiou, 2023. Non-asymptotic Weibull tails 
explain the statistics of extreme daily precipitation. Adv. Water Resour., 173, 104388, 
https://doi.org/10.1016/j.advwatres.2023.104388. They also provide the corresponding Matlab code 
(https://zenodo.org/records/7234708).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>weibull_tail_test(
  data,
  threshold = 0,
  mon = 1,
  cens_quant = 0.9,
  p_test = 0.1,
  R = 500
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="weibull_tail_test_+3A_data">data</code></td>
<td>
<p>A data.frame</p>
</td></tr>
<tr><td><code id="weibull_tail_test_+3A_threshold">threshold</code></td>
<td>
<p>A numeric that is used to define wet days as values &gt; threshold.</p>
</td></tr>
<tr><td><code id="weibull_tail_test_+3A_mon">mon</code></td>
<td>
<p>This month defines the block whose maxima 
will be tested. The block goes from month-YYYY-1 to month-YYYY.</p>
</td></tr>
<tr><td><code id="weibull_tail_test_+3A_cens_quant">cens_quant</code></td>
<td>
<p>The quantile at which the tail test should be performed.</p>
</td></tr>
<tr><td><code id="weibull_tail_test_+3A_p_test">p_test</code></td>
<td>
<p>A numeric defining the 1 - p_test confidence band. This function 
tests the ratio of observed block maxima below p_test and above 1 - p_test. See details.</p>
</td></tr>
<tr><td><code id="weibull_tail_test_+3A_r">R</code></td>
<td>
<p>The number of synthetic samples.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Null-Hyothesis: block maxima are samples from a parent distribution with
Weibull tail (tail defined by a given left-censoring threshold). If the fraction 
of observed block maxima outside of the interval defined by 
p_test is larger than p_test the null hypothesis is rejected.
</p>


<h3>Value</h3>

<p>A tibble with the test outcome and other useful results:
</p>
<table>
<tr><td><code>is_rejected</code></td>
<td>
<p> outcome of the test (TRUE means that the assumption of
Weibull tails for the given left-censoring threshold is rejected).</p>
</td></tr>   
<tr><td><code>p_out</code></td>
<td>
<p> fraction of block maxima outside of the Y = 1 - p_out confidence interval</p>
</td></tr> 
<tr><td><code>p_hi</code></td>
<td>
<p> fraction of block maxima above the Y = 1 - p_out confidence interval</p>
</td></tr> 
<tr><td><code>p_lo</code></td>
<td>
<p> fraction of block maxima below the Y = 1 - p_out confidence interval</p>
</td></tr> 
<tr><td><code>scale</code></td>
<td>
<p> scale parameter of the Weibull distribution describing the non-censored samples</p>
</td></tr>
<tr><td><code>shape</code></td>
<td>
<p> shape parameter of the Weibull distribution describing the non-censored samples</p>
</td></tr>
<tr><td><code>quant</code></td>
<td>
<p> the quantile used as left-censoring threshold</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>data("dailyrainfall")
weibull_tail_test(dailyrainfall)

# generate data
set.seed(123)
sample_dates &lt;- seq.Date(from = as.Date("2000-01-01"), to = as.Date("2010-12-31"), by = 1)
sample_data &lt;- data.frame(dates = sample_dates, val = sample(rnorm(length(sample_dates))))
d &lt;- sample_data |&gt;
  filter(val &gt;= 0 &amp; !is.na(val))
fit_uncensored &lt;- fsmev(d)

# censor the data
thresholds &lt;- c(seq(0.1, 0.9, 0.1), 0.95)
p_test &lt;- 0.1
res &lt;- lapply(thresholds, function(x) {
  weibull_tail_test(d, cens_quant = x, p_test = p_test, R = 200)
})
res &lt;- do.call(rbind, res)

# find the optimal left-censoring threshold
cens &lt;- censored_weibull_fit(res, thresholds)
cens$optimal_threshold
cens$quantile

# plot return levels censored vs uncensored
rp &lt;- c(2:100)
rl_uncensored &lt;- return.levels.mev(fit_uncensored, return.periods = rp)$rl 
rl_censored &lt;- qmev(1 - 1/rp, cens$shape, cens$scale, fit_uncensored$n)
plot(rp, rl_uncensored, type = "l", log = "x", ylim = c(0, max(rl_censored, rl_uncensored)), 
     ylab = "return level", xlab = "return period (a)")
points(pp.weibull(fit_uncensored$maxima), sort(fit_uncensored$maxima))
lines(rp, rl_censored, type = "l", col = "red")
legend("bottomright", legend = c("uncensored", 
        paste0("censored at ", round(cens$optimal_threshold, 1), "mm")), 
        col = c("black", "red"), lty = c(1, 1))

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
