<!DOCTYPE html><html><head><title>Help for package AdhereR</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {AdhereR}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#callAdhereR'><p>callAdhereR.</p></a></li>
<li><a href='#CMA_per_episode'><p>CMA_per_episode constructor.</p></a></li>
<li><a href='#CMA_polypharmacy'><p>CMA constructor for polypharmacy.</p></a></li>
<li><a href='#CMA_sliding_window'><p>CMA_sliding_window constructor.</p></a></li>
<li><a href='#CMA0'><p>CMA0 constructor.</p></a></li>
<li><a href='#CMA1'><p>CMA1 and CMA3 constructors.</p></a></li>
<li><a href='#CMA2'><p>CMA2 and CMA4 constructors.</p></a></li>
<li><a href='#CMA5'><p>CMA5 constructor.</p></a></li>
<li><a href='#CMA6'><p>CMA6 constructor.</p></a></li>
<li><a href='#CMA7'><p>CMA7 constructor.</p></a></li>
<li><a href='#CMA8'><p>CMA8 constructor.</p></a></li>
<li><a href='#CMA9'><p>CMA9 constructor.</p></a></li>
<li><a href='#compute_event_durations'><p>Computation of event durations.</p></a></li>
<li><a href='#compute.event.int.gaps'><p>Gap Days and Event (prescribing or dispensing) Intervals.</p></a></li>
<li><a href='#compute.treatment.episodes'><p>Compute Treatment Episodes.</p></a></li>
<li><a href='#cover_special_periods'><p>Cover special periods.</p></a></li>
<li><a href='#durcomp.dispensing'><p>Example dispensing events for 16 patients.</p></a></li>
<li><a href='#durcomp.hospitalisation'><p>Example special periods for 10 patients.</p></a></li>
<li><a href='#durcomp.prescribing'><p>Example prescription events for 16 patients.</p></a></li>
<li><a href='#get.event.plotting.area'><p>Get the actual plotting area.</p></a></li>
<li><a href='#get.legend.plotting.area'><p>Get the legend plotting area.</p></a></li>
<li><a href='#get.plotted.events'><p>Get info about the plotted events.</p></a></li>
<li><a href='#get.plotted.partial.cmas'><p>Get info about the plotted partial CMAs.</p></a></li>
<li><a href='#getCallerWrapperLocation'><p>getCallerWrapperLocation.</p></a></li>
<li><a href='#getCMA'><p>Access the actual CMA estimate from a CMA object.</p></a></li>
<li><a href='#getEventInfo'><p>Access the event info from a CMA object.</p></a></li>
<li><a href='#getEventsToEpisodesMapping'><p>getEventsToEpisodesMapping</p></a></li>
<li><a href='#getEventsToSlidingWindowsMapping'><p>getEventsToSlidingWindowsMapping</p></a></li>
<li><a href='#getInnerEventInfo'><p>Access the inner event info from a complex CMA object.</p></a></li>
<li><a href='#getMGs'><p>Access the medication groups of a CMA object.</p></a></li>
<li><a href='#last.plot.get.info'><p>Access last adherence plot info.</p></a></li>
<li><a href='#map.event.coords.to.plot'><p>Map from event to plot coordinates.</p></a></li>
<li><a href='#med.events'><p>Example medication events records for 100 patients.</p></a></li>
<li><a href='#med.events.ATC'><p>Example of medication events with ATC codes.</p></a></li>
<li><a href='#med.groups'><p>Example of medication groups.</p></a></li>
<li><a href='#plot_interactive_cma'><p>Interactive exploration and CMA computation.</p></a></li>
<li><a href='#plot.CMA_per_episode'><p>Plot CMA_per_episode and CMA_sliding_window objects.</p></a></li>
<li><a href='#plot.CMA0'><p>Plot CMA0 objects.</p></a></li>
<li><a href='#plot.CMA1'><p>Plot CMA0-derived objects.</p></a></li>
<li><a href='#print.CMA0'><p>Print CMA0 (and derived) objects.</p></a></li>
<li><a href='#prune_event_durations'><p>Prune event durations.</p></a></li>
<li><a href='#subsetCMA'><p>Restrict a CMA object to a subset of patients.</p></a></li>
<li><a href='#time_to_initiation'><p>Computation of initiation times.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Adherence to Medications</td>
</tr>
<tr>
<td>Version:</td>
<td>0.8.1</td>
</tr>
<tr>
<td>Author:</td>
<td>Dan Dediu [aut, cre],
  Alexandra Dima [aut],
  Samuel Allemann [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Dan Dediu &lt;ddediu@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Computation of adherence to medications from Electronic Health care 
    Data and visualization of individual medication histories and adherence 
    patterns. The package implements a set of S3 classes and
    functions consistent with current adherence guidelines and definitions. 
    It allows the computation of different measures of
    adherence (as defined in the literature, but also several original ones), 
    their publication-quality plotting,
    the estimation of event duration and time to initiation,
    the interactive exploration of patient medication history and 
    the real-time estimation of adherence given various parameter settings.
    It scales from very small datasets stored in flat CSV files to very large 
    databases and from single-thread processing on mid-range consumer
    laptops to parallel processing on large heterogeneous computing clusters.
    It exposes a standardized interface allowing it to be used from other
    programming languages and platforms, such as Python.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/ddediu/AdhereR">https://github.com/ddediu/AdhereR</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>LazyData:</td>
<td>TRUE</td>
</tr>
<tr>
<td>Imports:</td>
<td>lubridate (&ge; 1.5), parallel (&ge; 3.0), data.table (&ge; 1.9),
rsvg (&ge; 1.3), jpeg (&ge; 0.1), png (&ge; 0.1), webp (&ge; 1.0),
methods</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.0)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>rmarkdown (&ge; 1.1), knitr (&ge; 1.20), R.rsp (&ge; 0.40), base64
(&ge; 2.0), viridisLite (&ge; 0.4), AdhereRViz (&ge; 0.2)</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr, R.rsp</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.0</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-07-05 14:45:35 UTC; ddediu</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-07-05 15:40:18 UTC</td>
</tr>
</table>
<hr>
<h2 id='callAdhereR'>callAdhereR.</h2><span id='topic+callAdhereR'></span>

<h3>Description</h3>

<p>The function encapsulating all the logics that allows AdhereR to be called
from any platform using the generic <code>shell</code> mechanism.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>callAdhereR(shared.data.directory)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="callAdhereR_+3A_shared.data.directory">shared.data.directory</code></td>
<td>
<p>A <em>string</em> containing the path to the
directory where all the exchanged (shared) data (both input and output) is.
<code>AdhereR</code> needs read and write access to this directory.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In most cases this should not be done directly by the user,
but instead used by an appropriate <code>wrapper</code> on the client platform.
It allows transparent use of <code>AdhereR</code> from virtually any platform or
programming language for which an appropriate wrapper is provided.
For more details see the vignette describing the included reference
<code>Python 3</code> wrapper.
</p>


<h3>Value</h3>

<p>This function displays any messages to the console, tries to also
write them to the <code>Adherer-results.txt</code> file in the
<code>shared.data.directory</code> directory, and, when finished, forces <code>R</code>
to quit with a given shell error code:
</p>

<ul>
<li> <p><code>0</code> The processing ended without major errors;
</p>
</li>
<li> <p><code>1</code> General error (hopefully there are messages in the
<code>Adherer-results.txt</code> file;
</p>
</li>
<li> <p><code>10</code> The directory <code>shared.data.directory</code> does not exit;
</p>
</li>
<li> <p><code>11</code> <code>AdhereR</code> does not have read access to the
<code>shared.data.directory</code> directory;
</p>
</li>
<li> <p><code>12</code> <code>AdhereR</code> does not have write access to the
<code>shared.data.directory</code> directory;
</p>
</li>
<li> <p><code>13</code> issues with the parameters file <code>parameters.log</code>;
</p>
</li>
<li> <p><code>14</code> issues with the data file <code>dataset.csv</code>;
</p>
</li>
<li> <p><code>15</code> plotting issues;
</p>
</li>
<li> <p><code>16</code> interactive plotting issues;
</p>
</li>
<li> <p><code>17</code> issues exporting the results.
</p>
</li></ul>


<hr>
<h2 id='CMA_per_episode'>CMA_per_episode constructor.</h2><span id='topic+CMA_per_episode'></span>

<h3>Description</h3>

<p>Applies a given CMA to each treatment episode and constructs a
CMA_per_episode object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CMA_per_episode(
  CMA.to.apply,
  data,
  treat.epi = NULL,
  ID.colname = NA,
  event.date.colname = NA,
  event.duration.colname = NA,
  event.daily.dose.colname = NA,
  medication.class.colname = NA,
  medication.groups = NULL,
  flatten.medication.groups = FALSE,
  medication.groups.colname = ".MED_GROUP_ID",
  carry.only.for.same.medication = NA,
  consider.dosage.change = NA,
  medication.change.means.new.treatment.episode = TRUE,
  dosage.change.means.new.treatment.episode = FALSE,
  maximum.permissible.gap = 180,
  maximum.permissible.gap.unit = c("days", "weeks", "months", "years", "percent")[1],
  maximum.permissible.gap.append.to.episode = FALSE,
  followup.window.start = 0,
  followup.window.start.unit = c("days", "weeks", "months", "years")[1],
  followup.window.start.per.medication.group = FALSE,
  followup.window.duration = 365 * 2,
  followup.window.duration.unit = c("days", "weeks", "months", "years")[1],
  observation.window.start = 0,
  observation.window.start.unit = c("days", "weeks", "months", "years")[1],
  observation.window.duration = 365 * 2,
  observation.window.duration.unit = c("days", "weeks", "months", "years")[1],
  return.inner.event.info = FALSE,
  date.format = "%m/%d/%Y",
  summary = "CMA per treatment episode",
  event.interval.colname = "event.interval",
  gap.days.colname = "gap.days",
  force.NA.CMA.for.failed.patients = TRUE,
  return.mapping.events.episodes = FALSE,
  parallel.backend = c("none", "multicore", "snow", "snow(SOCK)", "snow(MPI)",
    "snow(NWS)")[1],
  parallel.threads = "auto",
  suppress.warnings = FALSE,
  suppress.special.argument.checks = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CMA_per_episode_+3A_cma.to.apply">CMA.to.apply</code></td>
<td>
<p>A <em>string</em> giving the name of the CMA function (1 to
9) that will be computed for each treatment episode.</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_data">data</code></td>
<td>
<p>A <em><code>data.frame</code></em> containing the events (prescribing or
dispensing) used to compute the CMA. Must contain, at a minimum, the patient
unique ID, the event date and duration, and might also contain the daily
dosage and medication type (the actual column names are defined in the
following four parameters).</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_treat.epi">treat.epi</code></td>
<td>
<p>A <em><code>data.frame</code></em> containing the treatment episodes.
Must contain the patient ID (as given in <code>ID.colname</code>), the episode unique ID
(increasing sequentially, <code>episode.ID</code>), the episode start date
(<code>episode.start</code>), the episode duration in days (<code>episode.duration</code>),
and the episode end date (<code>episode.end</code>).</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_id.colname">ID.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in <code>data</code>
containing the unique patient ID; must be present.</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_event.date.colname">event.date.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the start date of the event (in the format given in
the <code>date.format</code> parameter); must be present.</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_event.duration.colname">event.duration.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the event duration (in days); must be present.</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_event.daily.dose.colname">event.daily.dose.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the prescribed daily dose, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_medication.class.colname">medication.class.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the medication type, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_medication.groups">medication.groups</code></td>
<td>
<p>A <em>vector</em> of characters defining medication
groups or the name of a column in <code>data</code> that defines such groups.
The names of the vector are the medication group unique names, while
the content defines them as logical expressions. While the names can be any
string of characters except &quot;}&quot;, it is recommended to stick to the rules for
defining vector names in <code>R</code>. For example,
<code>c("A"="CATEGORY == 'medA'", "AA"="{A} &amp; PERDAY &lt; 4"</code> defines two
medication groups: <em>A</em> which selects all events of type &quot;medA&quot;, and
<em>B</em> which selects all events already defined by &quot;A&quot; but with a daily
dose lower than 4. If <code>NULL</code>, no medication groups are defined. If
medication groups are defined, there is one CMA estimate for each group;
moreover, there is a special group <em>__ALL_OTHERS__</em> automatically defined
containing all observations <em>not</em> covered by any of the explicitly defined
groups.</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_flatten.medication.groups">flatten.medication.groups</code></td>
<td>
<p><em>Logical</em>, if <code>FALSE</code> (the default)
then the <code>CMA</code> and <code>event.info</code> components of the object are lists
with one medication group per element; otherwise, they are <code>data.frame</code>s
with an extra column containing the medication group (its name is given by
<code>medication.groups.colname</code>).</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_medication.groups.colname">medication.groups.colname</code></td>
<td>
<p>a <em>string</em> (defaults to &quot;.MED_GROUP_ID&quot;)
giving the name of the column storing the group name when
<code>flatten.medication.groups</code> is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_carry.only.for.same.medication">carry.only.for.same.medication</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code>, the
carry-over applies only across medication of the same type; valid only for
CMAs 5 to 9, in which case it is coupled (i.e., the same value is used for
computing the treatment episodes and the CMA on each treatment episode).</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_consider.dosage.change">consider.dosage.change</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code>, the carry-over
is adjusted to also reflect changes in dosage; valid only for CMAs 5 to 9, in
which case it is coupled (i.e., the same value is used for computing the
treatment episodes and the CMA on each treatment episode).</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_medication.change.means.new.treatment.episode">medication.change.means.new.treatment.episode</code></td>
<td>
<p><em>Logical</em>, should a
change in medication automatically start a new treatment episode?</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_dosage.change.means.new.treatment.episode">dosage.change.means.new.treatment.episode</code></td>
<td>
<p><em>Logical</em>, should a
change in dosage automatically start a new treatment episode?</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_maximum.permissible.gap">maximum.permissible.gap</code></td>
<td>
<p>The <em>number</em> of units given by
<code>maximum.permissible.gap.unit</code> representing the maximum duration of
permissible gaps between treatment episodes (can also be a percent, see
<code>maximum.permissible.gap.unit</code> for details).</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_maximum.permissible.gap.unit">maximum.permissible.gap.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em>, <em>&quot;years&quot;</em> or <em>&quot;percent&quot;</em>, and
represents the time units that <code>maximum.permissible.gap</code> refers to;
if <em>percent</em>, then  <code>maximum.permissible.gap</code> is interpreted as a
percent (can be greater than 100%) of the duration of the current
prescription.</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_maximum.permissible.gap.append.to.episode">maximum.permissible.gap.append.to.episode</code></td>
<td>
<p>a <em>logical</em> value
specifying of the <code>maximum.permissible.gap</code> should be append at the
end of an episode with a gap larger than the <code>maximum.permissible.gap</code>;
<code>FALSE</code> (the default) mean no addition, while <code>TRUE</code> mean that the
full <code>maximum.permissible.gap</code> is added.</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_followup.window.start">followup.window.start</code></td>
<td>
<p>If a <em><code>Date</code></em> object, it represents
the actual start date of the follow-up window; if a <em>string</em> it is the
name of the column in <code>data</code> containing the start date of the follow-up
window either as the numbers of <code>followup.window.start.unit</code> units after
the first event (the column must be of type <code>numeric</code>) or as actual
dates (in which case the column must be of type <code>Date</code> or a string
that conforms to the format specified in <code>date.format</code>); if a
<em>number</em> it is the number of time units defined in the
<code>followup.window.start.unit</code> parameter after the begin of the
participant's first event; or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_followup.window.start.unit">followup.window.start.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.start</code> refers to (when a number), or
<code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_followup.window.start.per.medication.group">followup.window.start.per.medication.group</code></td>
<td>
<p>a <em>logical</em>: if there are
medication groups defined and this is <code>TRUE</code>, then the first event
considered for the follow-up window start is relative to each medication group
separately, otherwise (the default) it is relative to the patient.</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_followup.window.duration">followup.window.duration</code></td>
<td>
<p>either a <em>number</em> representing the
duration of the follow-up window in the time units given in
<code>followup.window.duration.unit</code>, or a <em>string</em> giving the column
containing these numbers. Should represent a period for which relevant
medication events are recorded accurately (e.g. not extend after end of
relevant treatment, loss-to-follow-up or change to a health care provider
not covered by the database).</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_followup.window.duration.unit">followup.window.duration.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.duration</code> refers to, or <code>NA</code> if not
defined.</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_observation.window.start">observation.window.start</code>, <code id="CMA_per_episode_+3A_observation.window.start.unit">observation.window.start.unit</code>, <code id="CMA_per_episode_+3A_observation.window.duration">observation.window.duration</code>, <code id="CMA_per_episode_+3A_observation.window.duration.unit">observation.window.duration.unit</code></td>
<td>
<p>the definition of the observation window
(see the follow-up window parameters above for details).</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_return.inner.event.info">return.inner.event.info</code></td>
<td>
<p><em>Logical</em> specifying if the function
should also return the event.info for all the individual events in each
sliding window; by default it is <code>FALSE</code> as this information is useful
only in very specific cases (e.g., plotting the event intervals) and adds a
small but non-negligible computational overhead.</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_date.format">date.format</code></td>
<td>
<p>A <em>string</em> giving the format of the dates used in the
<code>data</code> and the other parameters; see the <code>format</code> parameters of the
<code><a href="base.html#topic+as.Date">as.Date</a></code> function for details (NB, this concerns only the
dates given as strings and not as <code>Date</code> objects).</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_summary">summary</code></td>
<td>
<p>Metadata as a <em>string</em>, briefly describing this CMA.</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_event.interval.colname">event.interval.colname</code></td>
<td>
<p>A <em>string</em>, the name of a newly-created
column storing the number of days between the start of the current event and
the start of the next one; the default value &quot;event.interval&quot; should be
changed only if there is a naming conflict with a pre-existing
&quot;event.interval&quot; column in <code>event.info</code>.</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_gap.days.colname">gap.days.colname</code></td>
<td>
<p>A <em>string</em>, the name of a newly-created column
storing the number of days when medication was not available (i.e., the
&quot;gap days&quot;); the default value &quot;gap.days&quot; should be changed only if there is
a naming conflict with a pre-existing &quot;gap.days&quot; column in <code>event.info</code>.</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_force.na.cma.for.failed.patients">force.NA.CMA.for.failed.patients</code></td>
<td>
<p><em>Logical</em> describing how the
patients for which the CMA estimation fails are treated: if <code>TRUE</code>
they are returned with an <code>NA</code> CMA estimate, while for
<code>FALSE</code> they are omitted.</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_return.mapping.events.episodes">return.mapping.events.episodes</code></td>
<td>
<p>A <em>Logical</em>, if <code>TRUE</code> then
the mapping between events and episodes is returned as an extra component
<code>mapping.episodes.to.events</code>, which is a <code>data.table</code> giving, for
each episode, the events that belong to it (an event is given by its row
number in the <code>data</code>). Please note that the episodes returned are
specific to the particular simple CMA used, and should preferentially used
over those returned by <code>compute.treatment.episodes()</code>. This component
can also be accessed using the <code>getEventsToEpisodesMapping()</code> function.</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_parallel.backend">parallel.backend</code></td>
<td>
<p>Can be &quot;none&quot; (the default) for single-threaded
execution, &quot;multicore&quot;  (using <code>mclapply</code> in package <code>parallel</code>)
for multicore processing (NB. not currently implemented on MS Windows and
automatically falls back on &quot;snow&quot; on this platform),  or &quot;snow&quot;,
&quot;snow(SOCK)&quot; (equivalent to &quot;snow&quot;), &quot;snow(MPI)&quot; or &quot;snow(NWS)&quot; specifying
various types of SNOW clusters (can be on the local machine or more complex
setups &ndash; please see the documentation of package <code>snow</code> for details;
the last two require packages <code>Rmpi</code> and <code>nws</code>, respectively, not
automatically installed with <code>AdhereR</code>).</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_parallel.threads">parallel.threads</code></td>
<td>
<p>Can be &quot;auto&quot; (for <code>parallel.backend</code> ==
&quot;multicore&quot;, defaults to the number of cores in the system as given by
<code>options("cores")</code>, while for <code>parallel.backend</code> == &quot;snow&quot;,
defaults to 2), a strictly positive integer specifying the number of parallel
threads, or a more complex specification of the SNOW cluster nodes for
<code>parallel.backend</code> == &quot;snow&quot; (see the documentation of package
<code>snow</code> for details).</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any
warnings.</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_suppress.special.argument.checks">suppress.special.argument.checks</code></td>
<td>
<p><em>Logical</em> parameter for internal
use; if <code>FALSE</code> (default) check if the important columns in the <code>data</code>
have some of the reserved names, if <code>TRUE</code> this check is not performed.</p>
</td></tr>
<tr><td><code id="CMA_per_episode_+3A_...">...</code></td>
<td>
<p>other possible parameters</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>CMA_per_episode</code> first identifies the treatment episodes for the whole
follo-up window (using the <code><a href="#topic+compute.treatment.episodes">compute.treatment.episodes</a></code> function),
and then computes the given &quot;simple&quot; CMA for each treatment episode that
intersects with the observation window. NB: the CMA is computed for the
period of the episode that is part of the observations window; thus, if an
episode starts earlier or ends later than the observation window, CMA will
be computed for a section of that episode.
Thus, as opposed to the &quot;simple&quot; CMAs 1 to 9, it returns a set of CMAs, with
possibly more than one element.
</p>
<p>It is highly similar to <code><a href="#topic+CMA_sliding_window">CMA_sliding_window</a></code> which computes a CMA
for a set of sliding windows.
</p>


<h3>Value</h3>

<p>An <code>S3</code> object of class <code>CMA_per_episode</code> with the
following fields:
</p>

<ul>
<li> <p><code>data</code> The actual event data, as given by the <code>data</code>
parameter.
</p>
</li>
<li> <p><code>ID.colname</code> the name of the column in <code>data</code> containing the
unique patient ID, as given by the <code>ID.colname</code> parameter.
</p>
</li>
<li> <p><code>event.date.colname</code> the name of the column in <code>data</code>
containing the start date of the event (in the format given in the
<code>date.format</code> parameter), as given by the <code>event.date.colname</code>
parameter.
</p>
</li>
<li> <p><code>event.duration.colname</code> the name of the column in <code>data</code>
containing the event duration (in days), as given by the
<code>event.duration.colname</code> parameter.
</p>
</li>
<li> <p><code>event.daily.dose.colname</code> the name of the column in <code>data</code>
containing the prescribed daily dose, as given by the
<code>event.daily.dose.colname</code> parameter.
</p>
</li>
<li> <p><code>medication.class.colname</code> the name of the column in <code>data</code>
containing the classes/types/groups of medication, as given by the
<code>medication.class.colname</code> parameter.
</p>
</li>
<li> <p><code>carry.only.for.same.medication</code> whether the carry-over applies
only across medication of the same type, as given by the
<code>carry.only.for.same.medication</code> parameter.
</p>
</li>
<li> <p><code>consider.dosage.change</code> whether the carry-over is adjusted to
reflect changes in dosage, as given by the <code>consider.dosage.change</code>
parameter.
</p>
</li>
<li> <p><code>followup.window.start</code> the beginning of the follow-up window, as
given by the <code>followup.window.start</code> parameter.
</p>
</li>
<li> <p><code>followup.window.start.unit</code> the time unit of the
<code>followup.window.start</code>, as given by the
<code>followup.window.start.unit</code> parameter.
</p>
</li>
<li> <p><code>followup.window.duration</code> the duration of the follow-up window,
as given by the <code>followup.window.duration</code> parameter.
</p>
</li>
<li> <p><code>followup.window.duration.unit</code> the time unit of the
<code>followup.window.duration</code>, as given by the
<code>followup.window.duration.unit</code> parameter.
</p>
</li>
<li> <p><code>observation.window.start</code> the beginning of the observation
window, as given by the <code>observation.window.start</code> parameter.
</p>
</li>
<li> <p><code>observation.window.start.unit</code> the time unit of the
<code>observation.window.start</code>, as given by the
<code>observation.window.start.unit</code> parameter.
</p>
</li>
<li> <p><code>observation.window.duration</code> the duration of the observation
window, as given by the <code>observation.window.duration</code> parameter.
</p>
</li>
<li> <p><code>observation.window.duration.unit</code> the time unit of the
<code>observation.window.duration</code>, as given by the
<code>observation.window.duration.unit</code> parameter.
</p>
</li>
<li> <p><code>date.format</code> the format of the dates, as given by the
<code>date.format</code> parameter.
</p>
</li>
<li> <p><code>summary</code> the metadata, as given by the <code>summary</code> parameter.
</p>
</li>
<li> <p><code>event.info</code> the <code>data.frame</code> containing the event info
(irrelevant for most users; see <code><a href="#topic+compute.event.int.gaps">compute.event.int.gaps</a></code> for
details).
</p>
</li>
<li> <p><code>computed.CMA</code> the class name of the computed CMA.
</p>
</li>
<li> <p><code>CMA</code> the <code>data.frame</code> containing the actual <code>CMA</code>
estimates for each participant (the <code>ID.colname</code> column) and treatment
episode, with columns:
</p>

<ul>
<li> <p><code>ID.colname</code> the patient ID as given by the <code>ID.colname</code>
parameter.
</p>
</li>
<li> <p><code>episode.ID</code> the unique treatment episode ID (within
patients).
</p>
</li>
<li> <p><code>episode.start</code> the treatment episode's start date (as a
<code>Date</code> object).
</p>
</li>
<li> <p><code>end.episode.gap.days</code> the corresponding gap days of the last
event in this episode.
</p>
</li>
<li> <p><code>episode.duration</code> the treatment episode's duration in days.
</p>
</li>
<li> <p><code>episode.end</code> the treatment episode's end date (as a
<code>Date</code> object).
</p>
</li>
<li> <p><code>CMA</code> the treatment episode's estimated CMA.
</p>
</li></ul>

</li></ul>

<p>Please note that if <code>medication.groups</code> are defined, then the <code>CMA</code>
and <code>event.info</code> are named lists, each element containing the CMA and
event.info corresponding to a single medication group (the element's name).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+CMA_sliding_window">CMA_sliding_window</a></code> is very similar, computing a
&quot;simple&quot; CMA for each of a set of same-size sliding windows.
The &quot;simple&quot; CMAs that can be computed comprise <code><a href="#topic+CMA1">CMA1</a></code>,
<code><a href="#topic+CMA2">CMA2</a></code>, <code><a href="#topic+CMA3">CMA3</a></code>, <code><a href="#topic+CMA4">CMA4</a></code>,
<code><a href="#topic+CMA5">CMA5</a></code>, <code><a href="#topic+CMA6">CMA6</a></code>, <code><a href="#topic+CMA7">CMA7</a></code>,
<code><a href="#topic+CMA8">CMA8</a></code>, <code><a href="#topic+CMA9">CMA9</a></code>, as well as user-defined classes
derived from <code><a href="#topic+CMA0">CMA0</a></code> that have a <code>CMA</code> component giving the
estimated CMA per patient as a <code>data.frame</code>.
If <code>return.mapping.events.episodes</code> is <code>TRUE</code>, then this also has a
component <code>mapping.episodes.to.events</code> that gives the mapping between
episodes and events as a <code>data.table</code> with the following columns:
</p>

<ul>
<li> <p><code>patid</code> the patient ID.
</p>
</li>
<li> <p><code>episode.ID</code> the episode unique ID (increasing sequentially).
</p>
</li>
<li> <p><code>event.index.in.data</code> the event given by its row number in the <code>data</code>.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
cmaE &lt;- CMA_per_episode(CMA="CMA1",
                        data=med.events,
                        ID.colname="PATIENT_ID",
                        event.date.colname="DATE",
                        event.duration.colname="DURATION",
                        event.daily.dose.colname="PERDAY",
                        medication.class.colname="CATEGORY",
                        carry.only.for.same.medication=FALSE,
                        consider.dosage.change=FALSE,
                        followup.window.start=0,
                        observation.window.start=0,
                        observation.window.duration=365,
                        date.format="%m/%d/%Y"
                       );
## End(Not run)
</code></pre>

<hr>
<h2 id='CMA_polypharmacy'>CMA constructor for polypharmacy.</h2><span id='topic+CMA_polypharmacy'></span>

<h3>Description</h3>

<p>Constructs a CMA (continuous multiple-interval measures of medication
availability/gaps) object for polypharmacy.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CMA_polypharmacy(
  data = data,
  medication.groups = medication.class.colname,
  CMA.to.apply = NA,
  aggregate.first = TRUE,
  aggregation.method = NA,
  aggregation.method.arguments = NA,
  thresholds = NA,
  ID.colname = NA,
  event.date.colname = NA,
  event.duration.colname = NA,
  event.daily.dose.colname = NA,
  medication.class.colname = NA,
  carry.only.for.same.medication = NA,
  consider.dosage.change = NA,
  followup.window.start = 0,
  followup.window.start.unit = c("days", "weeks", "months", "years")[1],
  followup.window.duration = 365 * 2,
  followup.window.duration.unit = c("days", "weeks", "months", "years")[1],
  observation.window.start = 0,
  observation.window.start.unit = c("days", "weeks", "months", "years")[1],
  observation.window.duration = 365 * 2,
  observation.window.duration.unit = c("days", "weeks", "months", "years")[1],
  date.format = "%m/%d/%Y",
  summary = "CMA for polypharmacy",
  force.NA.CMA.for.failed.patients = TRUE,
  parallel.backend = c("none", "multicore", "snow", "snow(SOCK)", "snow(MPI)",
    "snow(NWS)")[1],
  parallel.threads = "auto",
  suppress.warnings = FALSE,
  suppress.special.argument.checks = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CMA_polypharmacy_+3A_data">data</code></td>
<td>
<p>A <em><code>data.frame</code></em> containing the events (prescribing or
dispensing) used to compute the CMA. Must contain, at a minimum, the patient
unique ID, the event date and duration, medication type, and might also contain the daily
dosage (the actual column names are defined in the
following four parameters).</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_medication.groups">medication.groups</code></td>
<td>
<p>A <em>string</em> with the name of the column containing the medication
groups. If multiple medication classes should belong to the same treatment group, they can be
differentiated here (important to investigate treatment switches)</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_cma.to.apply">CMA.to.apply</code></td>
<td>
<p>A <em>string</em> giving the name of the CMA function (1 to
9) that will be computed for each treatment group.</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_aggregate.first">aggregate.first</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code>, aggregate across treatment groups before
summarizing over time during OW.</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_aggregation.method">aggregation.method</code></td>
<td>
<p>A <em>string</em> giving the name of the function to
aggregate CMA values of medication group, or <code>NA</code> to return only raw CMA estimates
per medication group. Accepts summary functions such as &quot;mean&quot;, &quot;sd&quot;, &quot;var&quot;, &quot;min&quot;, &quot;max&quot;,
and &quot;median&quot;. Custom functions are possible as long as they take a numeric vector as input
and return a single numeric value.</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_aggregation.method.arguments">aggregation.method.arguments</code></td>
<td>
<p>optional, A <em>named list</em> of additional arguments to the
function given in <code>aggregation method</code>, e.g. <code>na.rm = TRUE</code>.</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_thresholds">thresholds</code></td>
<td>
<p>optional, a <em>number</em> to apply as threshold between aggregation and summarizing.</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_id.colname">ID.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the medication type. Defaults to
<code>medication.class.colname</code>.</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_event.date.colname">event.date.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the start date of the event (in the format given in
the <code>date.format</code> parameter); must be present.</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_event.duration.colname">event.duration.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the event duration (in days); must be present.</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_event.daily.dose.colname">event.daily.dose.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the prescribed daily dose, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_medication.class.colname">medication.class.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the medication type, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_carry.only.for.same.medication">carry.only.for.same.medication</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code>, the
carry-over applies only across medication of the same type; valid only for
CMAs 5 to 9, in which case it is coupled (i.e., the same value is used for
computing the treatment episodes and the CMA on each treatment episode).</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_consider.dosage.change">consider.dosage.change</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code>, the carry-over
is adjusted to also reflect changes in dosage; valid only for CMAs 5 to 9, in
which case it is coupled (i.e., the same value is used for computing the
treatment episodes and the CMA on each treatment episode).</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_followup.window.start">followup.window.start</code></td>
<td>
<p>If a <em><code>Date</code></em> object, it represents
the actual start date of the follow-up window; if a <em>string</em> it is the
name of the column in <code>data</code> containing the start date of the follow-up
window either as the numbers of <code>followup.window.start.unit</code> units after
the first event (the column must be of type <code>numeric</code>) or as actual
dates (in which case the column must be of type <code>Date</code>); if a
<em>number</em> it is the number of time units defined in the
<code>followup.window.start.unit</code> parameter after the begin of the
participant's first event; or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_followup.window.start.unit">followup.window.start.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.start</code> refers to (when a number), or
<code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_followup.window.duration">followup.window.duration</code></td>
<td>
<p>either a <em>number</em> representing the
duration of the follow-up window in the time units given in
<code>followup.window.duration.unit</code>, or a <em>string</em> giving the column
containing these numbers. Should represent a period for which relevant
medication events are recorded accurately (e.g. not extend after end of
relevant treatment, loss-to-follow-up or change to a health care provider
not covered by the database).</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_followup.window.duration.unit">followup.window.duration.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.duration</code> refers to, or <code>NA</code> if not
defined.</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_observation.window.start">observation.window.start</code>, <code id="CMA_polypharmacy_+3A_observation.window.start.unit">observation.window.start.unit</code>, <code id="CMA_polypharmacy_+3A_observation.window.duration">observation.window.duration</code>, <code id="CMA_polypharmacy_+3A_observation.window.duration.unit">observation.window.duration.unit</code></td>
<td>
<p>the definition of the observation window
(see the follow-up window parameters above for details). Can be defined separately
for each patient and treatment group.</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_date.format">date.format</code></td>
<td>
<p>A <em>string</em> giving the format of the dates used in the
<code>data</code> and the other parameters; see the <code>format</code> parameters of the
<code><a href="base.html#topic+as.Date">as.Date</a></code> function for details (NB, this concerns only the
dates given as strings and not as <code>Date</code> objects).</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_summary">summary</code></td>
<td>
<p>Metadata as a <em>string</em>, briefly describing this CMA.</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_force.na.cma.for.failed.patients">force.NA.CMA.for.failed.patients</code></td>
<td>
<p><em>Logical</em> describing how the
patients for which the CMA estimation fails are treated: if <code>TRUE</code>
they are returned with an <code>NA</code> CMA estimate, while for
<code>FALSE</code> they are omitted.</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_parallel.backend">parallel.backend</code></td>
<td>
<p>Can be &quot;none&quot; (the default) for single-threaded
execution, &quot;multicore&quot;  (using <code>mclapply</code> in package <code>parallel</code>)
for multicore processing (NB. not currently implemented on MS Windows and
automatically falls back on &quot;snow&quot; on this platform),  or &quot;snow&quot;,
&quot;snow(SOCK)&quot; (equivalent to &quot;snow&quot;), &quot;snow(MPI)&quot; or &quot;snow(NWS)&quot; specifying
various types of SNOW clusters (can be on the local machine or more complex
setups &ndash; please see the documentation of package <code>snow</code> for details;
the last two require packages <code>Rmpi</code> and <code>nws</code>, respectively, not
automatically installed with <code>AdhereR</code>).</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_parallel.threads">parallel.threads</code></td>
<td>
<p>Can be &quot;auto&quot; (for <code>parallel.backend</code> ==
&quot;multicore&quot;, defaults to the number of cores in the system as given by
<code>options("cores")</code>, while for <code>parallel.backend</code> == &quot;snow&quot;,
defaults to 2), a strictly positive integer specifying the number of parallel
threads, or a more complex specification of the SNOW cluster nodes for
<code>parallel.backend</code> == &quot;snow&quot; (see the documentation of package
<code>snow</code> for details).</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any
warnings.</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_suppress.special.argument.checks">suppress.special.argument.checks</code></td>
<td>
<p><em>Logical</em> parameter for internal
use; if <code>FALSE</code> (default) check if the important columns in the <code>data</code>
have some of the reserved names, if <code>TRUE</code> this check is not performed.</p>
</td></tr>
<tr><td><code id="CMA_polypharmacy_+3A_...">...</code></td>
<td>
<p>other possible parameters</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An <code>S3</code> object of class <code>CMA_polypharmacy</code> with the
following fields:
</p>

<ul>
<li> <p><code>data</code> The actual event data, as given by the <code>data</code>
parameter.
</p>
</li>
<li> <p><code>ID.colname</code> the name of the column in <code>data</code> containing the
unique patient ID, as given by the <code>ID.colname</code> parameter.
</p>
</li>
<li> <p><code>event.date.colname</code> the name of the column in <code>data</code>
containing the start date of the event (in the format given in the
<code>date.format</code> parameter), as given by the <code>event.date.colname</code>
parameter.
</p>
</li>
<li> <p><code>event.duration.colname</code> the name of the column in <code>data</code>
containing the event duration (in days), as given by the
<code>event.duration.colname</code> parameter.
</p>
</li>
<li> <p><code>event.daily.dose.colname</code> the name of the column in <code>data</code>
containing the prescribed daily dose, as given by the
<code>event.daily.dose.colname</code> parameter.
</p>
</li>
<li> <p><code>medication.class.colname</code> the name of the column in <code>data</code>
containing the classes/types/groups of medication, as given by the
<code>medication.class.colname</code> parameter.
</p>
</li>
<li> <p><code>carry.only.for.same.medication</code> whether the carry-over applies
only across medication of the same type, as given by the
<code>carry.only.for.same.medication</code> parameter.
</p>
</li>
<li> <p><code>consider.dosage.change</code> whether the carry-over is adjusted to
reflect changes in dosage, as given by the <code>consider.dosage.change</code>
parameter.
</p>
</li>
<li> <p><code>followup.window.start</code> the beginning of the follow-up window, as
given by the <code>followup.window.start</code> parameter.
</p>
</li>
<li> <p><code>followup.window.start.unit</code> the time unit of the
<code>followup.window.start</code>, as given by the
<code>followup.window.start.unit</code> parameter.
</p>
</li>
<li> <p><code>followup.window.duration</code> the duration of the follow-up window,
as given by the <code>followup.window.duration</code> parameter.
</p>
</li>
<li> <p><code>followup.window.duration.unit</code> the time unit of the
<code>followup.window.duration</code>, as given by the
<code>followup.window.duration.unit</code> parameter.
</p>
</li>
<li> <p><code>observation.window.start</code> the beginning of the observation
window, as given by the <code>observation.window.start</code> parameter.
</p>
</li>
<li> <p><code>observation.window.start.unit</code> the time unit of the
<code>observation.window.start</code>, as given by the
<code>observation.window.start.unit</code> parameter.
</p>
</li>
<li> <p><code>observation.window.duration</code> the duration of the observation
window, as given by the <code>observation.window.duration</code> parameter.
</p>
</li>
<li> <p><code>observation.window.duration.unit</code> the time unit of the
<code>observation.window.duration</code>, as given by the
<code>observation.window.duration.unit</code> parameter.
</p>
</li>
<li> <p><code>date.format</code> the format of the dates, as given by the
<code>date.format</code> parameter.
</p>
</li>
<li> <p><code>summary</code> the metadata, as given by the <code>summary</code> parameter.
</p>
</li>
<li> <p><code>event.info</code> the <code>data.frame</code> containing the event info
(irrelevant for most users; see <code><a href="#topic+compute.event.int.gaps">compute.event.int.gaps</a></code> for
details).
</p>
</li>
<li> <p><code>aggregation.method</code> the aggregation method to combine CMA values
from different groups.
</p>
</li>
<li> <p><code>computed.CMA</code> the class name of the computed CMA.
</p>
</li>
<li> <p><code>medication.groups</code> a <code>data.frame</code> with medication groups and
classes
</p>
</li>
<li> <p><code>CMA</code> the <code>data.frame</code> containing the actual <code>CMA</code>
estimates for each participant (the <code>ID.colname</code> column) and
sometimes treatment group, with columns:
</p>

<ul>
<li> <p><code>ID.colname</code> the patient ID as given by the <code>ID.colname</code>
parameter.
</p>
</li>
<li> <p><code>medication.groups</code> only when no aggregation method is used
(<code>aggregation.method = NA</code>); the treatment group as given by the
<code>medication.groups</code> parameter.
</p>
</li>
<li> <p><code>CMA</code> the treatment episode's estimated CMA.
</p>
</li></ul>

</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
CMA_PP &lt;- CMA_polypharmacy(data = med.events.pp,
medication.groups = med.groups,
CMA.to.apply = "CMA7",
aggregate.first = TRUE, # aggregate before summarizing
aggregation.method = "mean", # compute mean of CMAs
aggregation.method.arguments = list(na.rm = TRUE), # remove NA's during calculation
thresholds = NA, # don't apply threshold
ID.colname="PATIENT_ID",
event.date.colname="DATE",
event.duration.colname="DURATION",
event.daily.dose.colname="PERDAY",
medication.class.colname="CATEGORY",
followup.window.start=0,
observation.window.start=180,
observation.window.duration=365,
carry.only.for.same.medication = TRUE);
## End(Not run)
</code></pre>

<hr>
<h2 id='CMA_sliding_window'>CMA_sliding_window constructor.</h2><span id='topic+CMA_sliding_window'></span>

<h3>Description</h3>

<p>Applies a given CMA to each sliding window and constructs a
CMA_sliding_window object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CMA_sliding_window(
  CMA.to.apply,
  data,
  ID.colname = NA,
  event.date.colname = NA,
  event.duration.colname = NA,
  event.daily.dose.colname = NA,
  medication.class.colname = NA,
  medication.groups = NULL,
  flatten.medication.groups = FALSE,
  medication.groups.colname = ".MED_GROUP_ID",
  carry.only.for.same.medication = NA,
  consider.dosage.change = NA,
  followup.window.start = 0,
  followup.window.start.unit = c("days", "weeks", "months", "years")[1],
  followup.window.start.per.medication.group = FALSE,
  followup.window.duration = 365 * 2,
  followup.window.duration.unit = c("days", "weeks", "months", "years")[1],
  observation.window.start = 0,
  observation.window.start.unit = c("days", "weeks", "months", "years")[1],
  observation.window.duration = 365 * 2,
  observation.window.duration.unit = c("days", "weeks", "months", "years")[1],
  sliding.window.start = 0,
  sliding.window.start.unit = c("days", "weeks", "months", "years")[1],
  sliding.window.duration = 90,
  sliding.window.duration.unit = c("days", "weeks", "months", "years")[1],
  sliding.window.step.duration = 30,
  sliding.window.step.unit = c("days", "weeks", "months", "years")[1],
  sliding.window.no.steps = NA,
  return.inner.event.info = FALSE,
  date.format = "%m/%d/%Y",
  summary = "CMA per sliding window",
  event.interval.colname = "event.interval",
  gap.days.colname = "gap.days",
  force.NA.CMA.for.failed.patients = TRUE,
  return.mapping.events.sliding.window = FALSE,
  parallel.backend = c("none", "multicore", "snow", "snow(SOCK)", "snow(MPI)",
    "snow(NWS)")[1],
  parallel.threads = "auto",
  suppress.warnings = FALSE,
  suppress.special.argument.checks = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CMA_sliding_window_+3A_cma.to.apply">CMA.to.apply</code></td>
<td>
<p>A <em>string</em> giving the name of the CMA function (1 to
9) that will be computed for each treatment episode.</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_data">data</code></td>
<td>
<p>A <em><code>data.frame</code></em> containing the events used to compute
the CMA. Must contain, at a minimum, the patient unique ID, the event date
and duration, and might also contain the daily dosage and medication type
(the actual column names are defined in the following four parameters).</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_id.colname">ID.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in <code>data</code>
containing the unique patient ID; must be present.</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_event.date.colname">event.date.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the start date of the event (in the format given in
the <code>date.format</code> parameter); must be present.</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_event.duration.colname">event.duration.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the event duration (in days); must be present.</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_event.daily.dose.colname">event.daily.dose.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the prescribed daily dose, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_medication.class.colname">medication.class.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the medication type, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_medication.groups">medication.groups</code></td>
<td>
<p>A <em>vector</em> of characters defining medication
groups or the name of a column in <code>data</code> that defines such groups.
The names of the vector are the medication group unique names, while
the content defines them as logical expressions. While the names can be any
string of characters except &quot;}&quot;, it is recommended to stick to the rules for
defining vector names in <code>R</code>. For example,
<code>c("A"="CATEGORY == 'medA'", "AA"="{A} &amp; PERDAY &lt; 4"</code> defines two
medication groups: <em>A</em> which selects all events of type &quot;medA&quot;, and
<em>B</em> which selects all events already defined by &quot;A&quot; but with a daily
dose lower than 4. If <code>NULL</code>, no medication groups are defined. If
medication groups are defined, there is one CMA estimate for each group;
moreover, there is a special group <em>__ALL_OTHERS__</em> automatically defined
containing all observations <em>not</em> covered by any of the explicitly defined
groups.</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_flatten.medication.groups">flatten.medication.groups</code></td>
<td>
<p><em>Logical</em>, if <code>FALSE</code> (the default)
then the <code>CMA</code> and <code>event.info</code> components of the object are lists
with one medication group per element; otherwise, they are <code>data.frame</code>s
with an extra column containing the medication group (its name is given by
<code>medication.groups.colname</code>).</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_medication.groups.colname">medication.groups.colname</code></td>
<td>
<p>a <em>string</em> (defaults to &quot;.MED_GROUP_ID&quot;)
giving the name of the column storing the group name when
<code>flatten.medication.groups</code> is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_carry.only.for.same.medication">carry.only.for.same.medication</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code>, the
carry-over applies only across medication of the same type.</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_consider.dosage.change">consider.dosage.change</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code>, the carry-over
is adjusted to also reflect changes in dosage.</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_followup.window.start">followup.window.start</code></td>
<td>
<p>If a <em><code>Date</code></em> object, it represents
the actual start date of the follow-up window; if a <em>string</em> it is the
name of the column in <code>data</code> containing the start date of the follow-up
window either as the numbers of <code>followup.window.start.unit</code> units after
the first event (the column must be of type <code>numeric</code>) or as actual
dates (in which case the column must be of type <code>Date</code> or a string
that conforms to the format specified in <code>date.format</code>); if a
<em>number</em> it is the number of time units defined in the
<code>followup.window.start.unit</code> parameter after the begin of the
participant's first event; or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_followup.window.start.unit">followup.window.start.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.start</code> refers to (when a number), or
<code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_followup.window.start.per.medication.group">followup.window.start.per.medication.group</code></td>
<td>
<p>a <em>logical</em>: if there are
medication groups defined and this is <code>TRUE</code>, then the first event
considered for the follow-up window start is relative to each medication group
separately, otherwise (the default) it is relative to the patient.</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_followup.window.duration">followup.window.duration</code></td>
<td>
<p>either a <em>number</em> representing the
duration of the follow-up window in the time units given in
<code>followup.window.duration.unit</code>, or a <em>string</em> giving the column
containing these numbers. Should represent a period for which relevant
medication events are recorded accurately (e.g. not extend after end of
relevant treatment, loss-to-follow-up or change to a health care provider not
covered by the database).</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_followup.window.duration.unit">followup.window.duration.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.duration</code> refers to, or <code>NA</code> if not
defined.</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_observation.window.start">observation.window.start</code>, <code id="CMA_sliding_window_+3A_observation.window.start.unit">observation.window.start.unit</code>, <code id="CMA_sliding_window_+3A_observation.window.duration">observation.window.duration</code>, <code id="CMA_sliding_window_+3A_observation.window.duration.unit">observation.window.duration.unit</code></td>
<td>
<p>the definition of the observation window
(see the follow-up window parameters above for details).</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_sliding.window.start">sliding.window.start</code>, <code id="CMA_sliding_window_+3A_sliding.window.start.unit">sliding.window.start.unit</code>, <code id="CMA_sliding_window_+3A_sliding.window.duration">sliding.window.duration</code>, <code id="CMA_sliding_window_+3A_sliding.window.duration.unit">sliding.window.duration.unit</code></td>
<td>
<p>the definition of the first sliding window
(see the follow-up window parameters above for details).</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_sliding.window.step.duration">sliding.window.step.duration</code>, <code id="CMA_sliding_window_+3A_sliding.window.step.unit">sliding.window.step.unit</code></td>
<td>
<p>if not missing
(<code>NA</code>), these give the step (or &quot;jump&quot;) to the right of the sliding
window in time units.</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_sliding.window.no.steps">sliding.window.no.steps</code></td>
<td>
<p>a <em>integer</em> specifying the desired number
of sliding windows to cover the observation window (if possible); trumps
<code>sliding.window.step.duration</code> and <code>sliding.window.step.unit</code>.</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_return.inner.event.info">return.inner.event.info</code></td>
<td>
<p><em>Logical</em> specifying if the function
should also return the event.info for all the individual events in each
sliding window; by default it is <code>FALSE</code> as this information is useful
only in very specific cases (e.g., plotting the event intervals) and adds a
small but non-negligible computational overhead.</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_date.format">date.format</code></td>
<td>
<p>A <em>string</em> giving the format of the dates used in the
<code>data</code> and the other parameters; see the <code>format</code> parameters of the
<code><a href="base.html#topic+as.Date">as.Date</a></code> function for details (NB, this concerns only the
dates given as strings and not as <code>Date</code> objects).</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_summary">summary</code></td>
<td>
<p>Metadata as a <em>string</em>, briefly describing this CMA.</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_event.interval.colname">event.interval.colname</code></td>
<td>
<p>A <em>string</em>, the name of a newly-created
column storing the number of days between the start of the current event and
the start of the next one; the default value &quot;event.interval&quot; should be
changed only if there is a naming conflict with a pre-existing
&quot;event.interval&quot; column in <code>event.info</code>.</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_gap.days.colname">gap.days.colname</code></td>
<td>
<p>A <em>string</em>, the name of a newly-created column
storing the number of days when medication was not available (i.e., the
&quot;gap days&quot;); the default value &quot;gap.days&quot; should be changed only if there is
a naming conflict with a pre-existing &quot;gap.days&quot; column in <code>event.info</code>.</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_force.na.cma.for.failed.patients">force.NA.CMA.for.failed.patients</code></td>
<td>
<p><em>Logical</em> describing how the
patients for which the CMA estimation fails are treated: if <code>TRUE</code>
they are returned with an <code>NA</code> CMA estimate, while for
<code>FALSE</code> they are omitted.</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_return.mapping.events.sliding.window">return.mapping.events.sliding.window</code></td>
<td>
<p>A <em>Logical</em>, if <code>TRUE</code> then
the mapping between events and sliding windows is returned as the component
<code>mapping.windows.to.events</code>, which is a <code>data.table</code> giving, for
each sliding window, the events that belong to it (an event is given by its row
number in the <code>data</code>).</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_parallel.backend">parallel.backend</code></td>
<td>
<p>Can be &quot;none&quot; (the default) for single-threaded
execution, &quot;multicore&quot;  (using <code>mclapply</code> in package <code>parallel</code>)
for multicore processing (NB. not currently implemented on MS Windows and
automatically falls back on &quot;snow&quot; on this platform),  or &quot;snow&quot;,
&quot;snow(SOCK)&quot; (equivalent to &quot;snow&quot;), &quot;snow(MPI)&quot; or &quot;snow(NWS)&quot; specifying
various types of SNOW clusters (can be on the local machine or more complex
setups &ndash; please see the documentation of package <code>snow</code> for details;
the last two require packages <code>Rmpi</code> and <code>nws</code>, respectively, not
automatically installed with <code>AdhereR</code>).</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_parallel.threads">parallel.threads</code></td>
<td>
<p>Can be &quot;auto&quot; (for <code>parallel.backend</code> ==
&quot;multicore&quot;, defaults to the number of cores in the system as given by
<code>options("cores")</code>, while for <code>parallel.backend</code> == &quot;snow&quot;,
defaults to 2), a strictly positive integer specifying the number of parallel
threads, or a more complex specification of the SNOW cluster nodes for
<code>parallel.backend</code> == &quot;snow&quot; (see the documentation of package
<code>snow</code> for details).</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any
warnings.</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_suppress.special.argument.checks">suppress.special.argument.checks</code></td>
<td>
<p><em>Logical</em> parameter for internal
use; if <code>FALSE</code> (default) check if the important columns in the <code>data</code>
have some of the reserved names, if <code>TRUE</code> this check is not performed.</p>
</td></tr>
<tr><td><code id="CMA_sliding_window_+3A_...">...</code></td>
<td>
<p>other possible parameters</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>CMA_sliding_window</code> first computes a set of fixed-size (possibly partly
overlapping) sliding windows,
each sliding to the right by a fixed timelag,
and then, for each of them, it computes the given &quot;simple&quot; CMA.
Thus, as opposed to the &quot;simple&quot; CMAs 1 to 9, it returns a set of CMAs, with
possibly more than one element.
</p>
<p>It is highly similar to <code><a href="#topic+CMA_per_episode">CMA_per_episode</a></code> which computes a CMA
for a set of treatment episodes.
</p>


<h3>Value</h3>

<p>An <code>S3</code> object of class <code>CMA_sliding_window</code> with the
following fields:
</p>

<ul>
<li> <p><code>data</code> The actual event data, as given by the <code>data</code>
parameter.
</p>
</li>
<li> <p><code>ID.colname</code> the name of the column in <code>data</code> containing the
unique patient ID, as given by the <code>ID.colname</code> parameter.
</p>
</li>
<li> <p><code>event.date.colname</code> the name of the column in <code>data</code>
containing the start date of the event (in the format given in the
<code>date.format</code> parameter), as given by the <code>event.date.colname</code>
parameter.
</p>
</li>
<li> <p><code>event.duration.colname</code> the name of the column in <code>data</code>
containing the event duration (in days), as given by the
<code>event.duration.colname</code> parameter.
</p>
</li>
<li> <p><code>event.daily.dose.colname</code> the name of the column in <code>data</code>
containing the prescribed daily dose, as given by the
<code>event.daily.dose.colname</code> parameter.
</p>
</li>
<li> <p><code>medication.class.colname</code> the name of the column in <code>data</code>
containing the classes/types/groups of medication, as given by the
<code>medication.class.colname</code> parameter.
</p>
</li>
<li> <p><code>carry.only.for.same.medication</code> whether the carry-over applies
only across medication of the same type, as given by the
<code>carry.only.for.same.medication</code> parameter.
</p>
</li>
<li> <p><code>consider.dosage.change</code> whether the carry-over is adjusted to
reflect changes in dosage, as given by the <code>consider.dosage.change</code> parameter.
</p>
</li>
<li> <p><code>followup.window.start</code> the beginning of the follow-up window,
as given by the <code>followup.window.start</code> parameter.
</p>
</li>
<li> <p><code>followup.window.start.unit</code> the time unit of the
<code>followup.window.start</code>, as given by the
<code>followup.window.start.unit</code> parameter.
</p>
</li>
<li> <p><code>followup.window.duration</code> the duration of the follow-up window,
as given by the <code>followup.window.duration</code> parameter.
</p>
</li>
<li> <p><code>followup.window.duration.unit</code> the time unit of the
<code>followup.window.duration</code>, as given by the
<code>followup.window.duration.unit</code> parameter.
</p>
</li>
<li> <p><code>observation.window.start</code> the beginning of the observation
window, as given by the <code>observation.window.start</code> parameter.
</p>
</li>
<li> <p><code>observation.window.start.unit</code> the time unit of the
<code>observation.window.start</code>, as given by the
<code>observation.window.start.unit</code> parameter.
</p>
</li>
<li> <p><code>observation.window.duration</code> the duration of the observation
window, as given by the <code>observation.window.duration</code> parameter.
</p>
</li>
<li> <p><code>observation.window.duration.unit</code> the time unit of the
<code>observation.window.duration</code>, as given by the
<code>observation.window.duration.unit</code> parameter.
</p>
</li>
<li> <p><code>date.format</code> the format of the dates, as given by the
<code>date.format</code> parameter.
</p>
</li>
<li> <p><code>summary</code> the metadata, as given by the <code>summary</code> parameter.
</p>
</li>
<li> <p><code>event.info</code> the <code>data.frame</code> containing the event info
(irrelevant for most users; see <code><a href="#topic+compute.event.int.gaps">compute.event.int.gaps</a></code> for
details).
</p>
</li>
<li> <p><code>computed.CMA</code> the class name of the computed CMA.
</p>
</li>
<li> <p><code>CMA</code> the <code>data.frame</code> containing the actual <code>CMA</code>
estimates for each participant (the <code>ID.colname</code> column) and sliding
window, with columns:
</p>

<ul>
<li> <p><code>ID.colname</code> the patient ID as given by the <code>ID.colname</code>
parameter.
</p>
</li>
<li> <p><code>window.ID</code> the unique window ID (within patients).
</p>
</li>
<li> <p><code>window.start</code> the window's start date (as a <code>Date</code>
object).
</p>
</li>
<li> <p><code>window.end</code> the window's end date (as a <code>Date</code> object).
</p>
</li>
<li> <p><code>CMA</code> the window's estimated CMA.
</p>
</li></ul>

</li></ul>

<p>Please note that if <code>medication.groups</code> are defined, then the <code>CMA</code>
and <code>event.info</code> are named lists, each element containing the CMA and
event.info corresponding to a single medication group (the element's name).
</p>


<h3>See Also</h3>

<p><code><a href="#topic+CMA_per_episode">CMA_per_episode</a></code> is very similar, computing a &quot;simple&quot;
CMA for each of the treatment episodes.
The &quot;simple&quot; CMAs that can be computed comprise <code><a href="#topic+CMA1">CMA1</a></code>,
<code><a href="#topic+CMA2">CMA2</a></code>, <code><a href="#topic+CMA3">CMA3</a></code>, <code><a href="#topic+CMA4">CMA4</a></code>,
<code><a href="#topic+CMA5">CMA5</a></code>, <code><a href="#topic+CMA6">CMA6</a></code>, <code><a href="#topic+CMA7">CMA7</a></code>,
<code><a href="#topic+CMA8">CMA8</a></code>, <code><a href="#topic+CMA9">CMA9</a></code>, as well as user-defined classes
derived from <code><a href="#topic+CMA0">CMA0</a></code> that have a <code>CMA</code> component giving the
estimated CMA per patient as a <code>data.frame</code>.
If <code>return.mapping.events.sliding.window</code> is <code>TRUE</code>, then this also has an
attribute <code>mapping.windows.to.events</code> that gives the mapping between
episodes and events as a <code>data.table</code> with the following columns:
</p>

<ul>
<li> <p><code>patid</code> the patient ID.
</p>
</li>
<li> <p><code>window.ID</code> the episode unique ID (increasing sequentially).
</p>
</li>
<li> <p><code>event.index.in.data</code> the event given by its row number in the <code>data</code>.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
cmaW &lt;- CMA_sliding_window(CMA="CMA1",
                           data=med.events,
                           ID.colname="PATIENT_ID",
                           event.date.colname="DATE",
                           event.duration.colname="DURATION",
                           event.daily.dose.colname="PERDAY",
                           medication.class.colname="CATEGORY",
                           carry.only.for.same.medication=FALSE,
                           consider.dosage.change=FALSE,
                           followup.window.start=0,
                           observation.window.start=0,
                           observation.window.duration=365,
                           sliding.window.start=0,
                           sliding.window.start.unit="days",
                           sliding.window.duration=90,
                           sliding.window.duration.unit="days",
                           sliding.window.step.duration=7,
                           sliding.window.step.unit="days",
                           sliding.window.no.steps=NA,
                           date.format="%m/%d/%Y"
                          );
## End(Not run)
</code></pre>

<hr>
<h2 id='CMA0'>CMA0 constructor.</h2><span id='topic+CMA0'></span>

<h3>Description</h3>

<p>Constructs a basic CMA (continuous multiple-interval measures of medication
availability/gaps) object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CMA0(
  data = NULL,
  ID.colname = NA,
  event.date.colname = NA,
  event.duration.colname = NA,
  event.daily.dose.colname = NA,
  medication.class.colname = NA,
  medication.groups = NULL,
  flatten.medication.groups = FALSE,
  medication.groups.colname = ".MED_GROUP_ID",
  carryover.within.obs.window = NA,
  carryover.into.obs.window = NA,
  carry.only.for.same.medication = NA,
  consider.dosage.change = NA,
  followup.window.start = 0,
  followup.window.start.unit = c("days", "weeks", "months", "years")[1],
  followup.window.start.per.medication.group = FALSE,
  followup.window.duration = 365 * 2,
  followup.window.duration.unit = c("days", "weeks", "months", "years")[1],
  observation.window.start = 0,
  observation.window.start.unit = c("days", "weeks", "months", "years")[1],
  observation.window.duration = 365 * 2,
  observation.window.duration.unit = c("days", "weeks", "months", "years")[1],
  date.format = "%m/%d/%Y",
  summary = "Base CMA object",
  suppress.warnings = FALSE,
  suppress.special.argument.checks = FALSE,
  arguments.that.should.not.be.defined = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CMA0_+3A_data">data</code></td>
<td>
<p>A <em><code>data.frame</code></em> containing the medication events
(prescribing or dispensing) used to compute the CMA. Must contain, at a
minimum, the patient unique ID, the event date and duration, and might also
contain the daily dosage and medication type (the actual column names are
defined in the following four parameters).</p>
</td></tr>
<tr><td><code id="CMA0_+3A_id.colname">ID.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in <code>data</code>
containing the unique patient ID, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA0_+3A_event.date.colname">event.date.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the start date of the event (in the format given in
the <code>date.format</code> parameter), or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA0_+3A_event.duration.colname">event.duration.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the event duration (in days), or <code>NA</code> if not
defined.</p>
</td></tr>
<tr><td><code id="CMA0_+3A_event.daily.dose.colname">event.daily.dose.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the prescribed daily dose, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA0_+3A_medication.class.colname">medication.class.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the classes/types/groups of medication, or <code>NA</code>
if not defined.</p>
</td></tr>
<tr><td><code id="CMA0_+3A_medication.groups">medication.groups</code></td>
<td>
<p>A <em>vector</em> of characters defining medication
groups or the name of a column in <code>data</code> that defines such groups.
The names of the vector are the medication group unique names, while
the content defines them as logical expressions. While the names can be any
string of characters except &quot;}&quot;, it is recommended to stick to the rules for
defining vector names in <code>R</code>. For example,
<code>c("A"="CATEGORY == 'medA'", "AA"="{A} &amp; PERDAY &lt; 4"</code> defines two
medication groups: <em>A</em> which selects all events of type &quot;medA&quot;, and
<em>B</em> which selects all events already defined by &quot;A&quot; but with a daily
dose lower than 4. If <code>NULL</code>, no medication groups are defined. If
medication groups are defined, there is one CMA estimate for each group;
moreover, there is a special group <em>__ALL_OTHERS__</em> automatically defined
containing all observations <em>not</em> covered by any of the explicitly defined
groups.</p>
</td></tr>
<tr><td><code id="CMA0_+3A_flatten.medication.groups">flatten.medication.groups</code></td>
<td>
<p><em>Logical</em>, if <code>FALSE</code> (the default)
then the <code>CMA</code> and <code>event.info</code> components of the object are lists
with one medication group per element; otherwise, they are <code>data.frame</code>s
with an extra column containing the medication group (its name is given by
<code>medication.groups.colname</code>).</p>
</td></tr>
<tr><td><code id="CMA0_+3A_medication.groups.colname">medication.groups.colname</code></td>
<td>
<p>a <em>string</em> (defaults to &quot;.MED_GROUP_ID&quot;)
giving the name of the column storing the group name when
<code>flatten.medication.groups</code> is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="CMA0_+3A_carryover.within.obs.window">carryover.within.obs.window</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> consider
the carry-over within the observation window, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA0_+3A_carryover.into.obs.window">carryover.into.obs.window</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> consider the
carry-over from before the starting date of the observation window, or
<code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA0_+3A_carry.only.for.same.medication">carry.only.for.same.medication</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> the
carry-over applies only across medications of the same type, or <code>NA</code>
if not defined.</p>
</td></tr>
<tr><td><code id="CMA0_+3A_consider.dosage.change">consider.dosage.change</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> the carry-over
is adjusted to reflect changes in dosage, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA0_+3A_followup.window.start">followup.window.start</code></td>
<td>
<p>If a <em><code>Date</code></em> object, it represents
the actual start date of the follow-up window; if a <em>string</em> it is the
name of the column in <code>data</code> containing the start date of the follow-up
window either as the numbers of <code>followup.window.start.unit</code> units
after the first event (the column must be of type <code>numeric</code>) or as
actual dates (in which case the column must be of type <code>Date</code> or a string
that conforms to the format specified in <code>date.format</code>); if a
<em>number</em> it is the number of time units defined in the
<code>followup.window.start.unit</code> parameter after the begin of the
participant's first event; or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA0_+3A_followup.window.start.unit">followup.window.start.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.start</code> refers to (when a number), or
<code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA0_+3A_followup.window.start.per.medication.group">followup.window.start.per.medication.group</code></td>
<td>
<p>a <em>logical</em>: if there are
medication groups defined and this is <code>TRUE</code>, then the first event
considered for the follow-up window start is relative to each medication group
separately, otherwise (the default) it is relative to the patient.</p>
</td></tr>
<tr><td><code id="CMA0_+3A_followup.window.duration">followup.window.duration</code></td>
<td>
<p>either a <em>number</em> representing the
duration of the follow-up window in the time units given in
<code>followup.window.duration.unit</code>, or a <em>string</em> giving the column
containing these numbers. Should represent a period for which relevant
medication events are recorded accurately (e.g. not extend after end of
relevant treatment, loss-to-follow-up or change to a health care provider
not covered by the database).</p>
</td></tr>
<tr><td><code id="CMA0_+3A_followup.window.duration.unit">followup.window.duration.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.duration</code> refers to, or <code>NA</code> if not
defined.</p>
</td></tr>
<tr><td><code id="CMA0_+3A_observation.window.start">observation.window.start</code>, <code id="CMA0_+3A_observation.window.start.unit">observation.window.start.unit</code>, <code id="CMA0_+3A_observation.window.duration">observation.window.duration</code>, <code id="CMA0_+3A_observation.window.duration.unit">observation.window.duration.unit</code></td>
<td>
<p>the definition of the observation window
(see the follow-up window parameters above for details).</p>
</td></tr>
<tr><td><code id="CMA0_+3A_date.format">date.format</code></td>
<td>
<p>A <em>string</em> giving the format of the dates used in
the <code>data</code> and the other parameters; see the <code>format</code> parameters
of the <code><a href="base.html#topic+as.Date">as.Date</a></code> function for details (NB, this concerns
only the dates given as strings and not as <code>Date</code> objects).</p>
</td></tr>
<tr><td><code id="CMA0_+3A_summary">summary</code></td>
<td>
<p>Metadata as a <em>string</em>, briefly describing this CMA.</p>
</td></tr>
<tr><td><code id="CMA0_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any
warnings.</p>
</td></tr>
<tr><td><code id="CMA0_+3A_suppress.special.argument.checks">suppress.special.argument.checks</code></td>
<td>
<p><em>Logical</em> parameter for internal
use; if <code>FALSE</code> (default) check if the important columns in the <code>data</code>
have some of the reserved names, if <code>TRUE</code> this check is not performed.</p>
</td></tr>
<tr><td><code id="CMA0_+3A_arguments.that.should.not.be.defined">arguments.that.should.not.be.defined</code></td>
<td>
<p>a <em>list</em> of argument names
and pre-defined valuesfor which a warning should be thrown if passed to the
function.</p>
</td></tr>
<tr><td><code id="CMA0_+3A_...">...</code></td>
<td>
<p>other possible parameters</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In most cases this should not be done directly by the user,
but it is used internally by the other CMAs.
</p>


<h3>Value</h3>

<p>An <code>S3</code> object of class <code>CMA0</code> with the following fields:
</p>

<ul>
<li> <p><code>data</code> The actual event (prescribing or dispensing) data, as
given by the <code>data</code> parameter.
</p>
</li>
<li> <p><code>ID.colname</code> the name of the column in <code>data</code> containing
the unique patient ID, as given by the <code>ID.colname</code> parameter.
</p>
</li>
<li> <p><code>event.date.colname</code> the name of the column in <code>data</code>
containing the start date of the event (in the format given in the
<code>date.format</code> parameter), as given by the <code>event.date.colname</code>
parameter.
</p>
</li>
<li> <p><code>event.duration.colname</code> the name of the column in <code>data</code>
containing the event duration (in days), as given by the
<code>event.duration.colname</code> parameter.
</p>
</li>
<li> <p><code>event.daily.dose.colname</code> the name of the column in <code>data</code>
containing the prescribed daily dose, as given by the
<code>event.daily.dose.colname</code> parameter.
</p>
</li>
<li> <p><code>medication.class.colname</code> the name of the column in <code>data</code>
containing the classes/types/groups of medication, as given by the
<code>medication.class.colname</code> parameter.
</p>
</li>
<li> <p><code>carryover.within.obs.window</code> whether to consider the carry-over
within the observation window, as given by the
<code>carryover.within.obs.window</code> parameter.
</p>
</li>
<li> <p><code>carryover.into.obs.window</code> whether to consider the carry-over
from before the starting date of the observation window, as given by the
<code>carryover.into.obs.window</code> parameter.
</p>
</li>
<li> <p><code>carry.only.for.same.medication</code> whether the carry-over applies
only across medication of the same type, as given by the
<code>carry.only.for.same.medication</code> parameter.
</p>
</li>
<li> <p><code>consider.dosage.change</code> whether the carry-over is adjusted to
reflect changes in dosage, as given by the <code>consider.dosage.change</code>
parameter.
</p>
</li>
<li> <p><code>followup.window.start</code> the beginning of the follow-up window,
as given by the <code>followup.window.start</code> parameter.
</p>
</li>
<li> <p><code>followup.window.start.unit</code> the time unit of the
<code>followup.window.start</code>, as given by the
<code>followup.window.start.unit</code> parameter.
</p>
</li>
<li> <p><code>followup.window.duration</code> the duration of the follow-up window,
as given by the <code>followup.window.duration</code> parameter.
</p>
</li>
<li> <p><code>followup.window.duration.unit</code> the time unit of the
<code>followup.window.duration</code>, as given by the
<code>followup.window.duration.unit</code> parameter.
</p>
</li>
<li> <p><code>observation.window.start</code> the beginning of the observation
window, as given by the <code>observation.window.start</code> parameter.
</p>
</li>
<li> <p><code>observation.window.start.unit</code> the time unit of the
<code>observation.window.start</code>, as given by the
<code>observation.window.start.unit</code> parameter.
</p>
</li>
<li> <p><code>observation.window.duration</code> the duration of the observation
window, as given by the <code>observation.window.duration</code> parameter.
</p>
</li>
<li> <p><code>observation.window.duration.unit</code> the time unit of the
<code>observation.window.duration</code>, as given by the <code>observation.window.duration.unit</code> parameter.
</p>
</li>
<li> <p><code>date.format</code> the format of the dates, as given by the
<code>date.format</code> parameter.
</p>
</li>
<li> <p><code>summary</code> the metadata, as given by the <code>summary</code>
parameter.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>cma0 &lt;- CMA0(data=med.events,
             ID.colname="PATIENT_ID",
             event.date.colname="DATE",
             event.duration.colname="DURATION",
             event.daily.dose.colname="PERDAY",
             medication.class.colname="CATEGORY",
             followup.window.start=0,
             followup.window.start.unit="days",
             followup.window.duration=2*365,
             followup.window.duration.unit="days",
             observation.window.start=30,
             observation.window.start.unit="days",
             observation.window.duration=365,
             observation.window.duration.unit="days",
             date.format="%m/%d/%Y",
             summary="Base CMA");
</code></pre>

<hr>
<h2 id='CMA1'>CMA1 and CMA3 constructors.</h2><span id='topic+CMA1'></span><span id='topic+CMA3'></span>

<h3>Description</h3>

<p>Constructs a CMA (continuous multiple-interval measures of medication
availability/gaps) type 1 or type 3 object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CMA1(
  data = NULL,
  ID.colname = NA,
  event.date.colname = NA,
  event.duration.colname = NA,
  medication.groups = NULL,
  flatten.medication.groups = FALSE,
  medication.groups.colname = ".MED_GROUP_ID",
  followup.window.start = 0,
  followup.window.start.unit = c("days", "weeks", "months", "years")[1],
  followup.window.start.per.medication.group = FALSE,
  followup.window.duration = 365 * 2,
  followup.window.duration.unit = c("days", "weeks", "months", "years")[1],
  observation.window.start = 0,
  observation.window.start.unit = c("days", "weeks", "months", "years")[1],
  observation.window.duration = 365 * 2,
  observation.window.duration.unit = c("days", "weeks", "months", "years")[1],
  date.format = "%m/%d/%Y",
  summary = NA,
  event.interval.colname = "event.interval",
  gap.days.colname = "gap.days",
  force.NA.CMA.for.failed.patients = TRUE,
  parallel.backend = c("none", "multicore", "snow", "snow(SOCK)", "snow(MPI)",
    "snow(NWS)")[1],
  parallel.threads = "auto",
  suppress.warnings = FALSE,
  suppress.special.argument.checks = TRUE,
  arguments.that.should.not.be.defined = c(carryover.within.obs.window = FALSE,
    carryover.into.obs.window = FALSE, carry.only.for.same.medication = FALSE,
    consider.dosage.change = FALSE),
  ...
)

CMA3(
  data = NULL,
  ID.colname = NA,
  event.date.colname = NA,
  event.duration.colname = NA,
  medication.groups = NULL,
  flatten.medication.groups = FALSE,
  medication.groups.colname = ".MED_GROUP_ID",
  followup.window.start = 0,
  followup.window.start.unit = c("days", "weeks", "months", "years")[1],
  followup.window.start.per.medication.group = FALSE,
  followup.window.duration = 365 * 2,
  followup.window.duration.unit = c("days", "weeks", "months", "years")[1],
  observation.window.start = 0,
  observation.window.start.unit = c("days", "weeks", "months", "years")[1],
  observation.window.duration = 365 * 2,
  observation.window.duration.unit = c("days", "weeks", "months", "years")[1],
  date.format = "%m/%d/%Y",
  summary = NA,
  event.interval.colname = "event.interval",
  gap.days.colname = "gap.days",
  force.NA.CMA.for.failed.patients = TRUE,
  parallel.backend = c("none", "multicore", "snow", "snow(SOCK)", "snow(MPI)",
    "snow(NWS)")[1],
  parallel.threads = "auto",
  suppress.warnings = FALSE,
  suppress.special.argument.checks = TRUE,
  arguments.that.should.not.be.defined = c(carryover.within.obs.window = FALSE,
    carryover.into.obs.window = FALSE, carry.only.for.same.medication = FALSE,
    consider.dosage.change = FALSE),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CMA1_+3A_data">data</code></td>
<td>
<p>A <em><code>data.frame</code></em> containing the events used to compute
the CMA. Must contain, at a minimum, the patient unique ID, the event date
and duration, and might also contain the daily dosage and medication type
(the actual column names are defined in the following four parameters).</p>
</td></tr>
<tr><td><code id="CMA1_+3A_id.colname">ID.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in <code>data</code>
containing the unique patient ID; must be present.</p>
</td></tr>
<tr><td><code id="CMA1_+3A_event.date.colname">event.date.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the start date of the event (in the format given in
the <code>date.format</code> parameter); must be present.</p>
</td></tr>
<tr><td><code id="CMA1_+3A_event.duration.colname">event.duration.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the event duration (in days); must be present.</p>
</td></tr>
<tr><td><code id="CMA1_+3A_medication.groups">medication.groups</code></td>
<td>
<p>A <em>vector</em> of characters defining medication
groups or the name of a column in <code>data</code> that defines such groups.
The names of the vector are the medication group unique names, while
the content defines them as logical expressions. While the names can be any
string of characters except &quot;}&quot;, it is recommended to stick to the rules for
defining vector names in <code>R</code>. For example,
<code>c("A"="CATEGORY == 'medA'", "AA"="{A} &amp; PERDAY &lt; 4"</code> defines two
medication groups: <em>A</em> which selects all events of type &quot;medA&quot;, and
<em>B</em> which selects all events already defined by &quot;A&quot; but with a daily
dose lower than 4. If <code>NULL</code>, no medication groups are defined. If
medication groups are defined, there is one CMA estimate for each group;
moreover, there is a special group <em>__ALL_OTHERS__</em> automatically defined
containing all observations <em>not</em> covered by any of the explicitly defined
groups.</p>
</td></tr>
<tr><td><code id="CMA1_+3A_flatten.medication.groups">flatten.medication.groups</code></td>
<td>
<p><em>Logical</em>, if <code>FALSE</code> (the default)
then the <code>CMA</code> and <code>event.info</code> components of the object are lists
with one medication group per element; otherwise, they are <code>data.frame</code>s
with an extra column containing the medication group (its name is given by
<code>medication.groups.colname</code>).</p>
</td></tr>
<tr><td><code id="CMA1_+3A_medication.groups.colname">medication.groups.colname</code></td>
<td>
<p>a <em>string</em> (defaults to &quot;.MED_GROUP_ID&quot;)
giving the name of the column storing the group name when
<code>flatten.medication.groups</code> is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="CMA1_+3A_followup.window.start">followup.window.start</code></td>
<td>
<p>If a <em><code>Date</code></em> object, it represents
the actual start date of the follow-up window; if a <em>string</em> it is the
name of the column in <code>data</code> containing the start date of the follow-up
window either as the numbers of <code>followup.window.start.unit</code> units after
the first event (the column must be of type <code>numeric</code>) or as actual
dates (in which case the column must be of type <code>Date</code> or a string
that conforms to the format specified in <code>date.format</code>); if a
<em>number</em> it is the number of time units defined in the
<code>followup.window.start.unit</code> parameter after the begin of the
participant's first event; or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA1_+3A_followup.window.start.unit">followup.window.start.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.start</code> refers to (when a number), or
<code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA1_+3A_followup.window.start.per.medication.group">followup.window.start.per.medication.group</code></td>
<td>
<p>a <em>logical</em>: if there are
medication groups defined and this is <code>TRUE</code>, then the first event
considered for the follow-up window start is relative to each medication group
separately, otherwise (the default) it is relative to the patient.</p>
</td></tr>
<tr><td><code id="CMA1_+3A_followup.window.duration">followup.window.duration</code></td>
<td>
<p>either a <em>number</em> representing the
duration of the follow-up window in the time units given in
<code>followup.window.duration.unit</code>, or a <em>string</em> giving the column
containing these numbers. Should represent a period for which relevant
medication events are recorded accurately (e.g. not extend after end of
relevant treatment, loss-to-follow-up or change to a health care provider
not covered by the database).</p>
</td></tr>
<tr><td><code id="CMA1_+3A_followup.window.duration.unit">followup.window.duration.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.duration</code> refers to, or <code>NA</code> if not
defined.</p>
</td></tr>
<tr><td><code id="CMA1_+3A_observation.window.start">observation.window.start</code>, <code id="CMA1_+3A_observation.window.start.unit">observation.window.start.unit</code>, <code id="CMA1_+3A_observation.window.duration">observation.window.duration</code>, <code id="CMA1_+3A_observation.window.duration.unit">observation.window.duration.unit</code></td>
<td>
<p>the definition of the observation window
(see the follow-up window parameters above for details).</p>
</td></tr>
<tr><td><code id="CMA1_+3A_date.format">date.format</code></td>
<td>
<p>A <em>string</em> giving the format of the dates used in the
<code>data</code> and the other parameters; see the <code>format</code> parameters of the
<code><a href="base.html#topic+as.Date">as.Date</a></code> function for details (NB, this concerns only the
dates given as strings and not as <code>Date</code> objects).</p>
</td></tr>
<tr><td><code id="CMA1_+3A_summary">summary</code></td>
<td>
<p>Metadata as a <em>string</em>, briefly describing this CMA.</p>
</td></tr>
<tr><td><code id="CMA1_+3A_event.interval.colname">event.interval.colname</code></td>
<td>
<p>A <em>string</em>, the name of a newly-created
column storing the number of days between the start of the current event and
the start of the next one; the default value &quot;event.interval&quot; should be
changed only if there is a naming conflict with a pre-existing
&quot;event.interval&quot; column in <code>event.info</code>.</p>
</td></tr>
<tr><td><code id="CMA1_+3A_gap.days.colname">gap.days.colname</code></td>
<td>
<p>A <em>string</em>, the name of a newly-created column
storing the number of days when medication was not available (i.e., the
&quot;gap days&quot;); the default value &quot;gap.days&quot; should be changed only if there is
a naming conflict with a pre-existing &quot;gap.days&quot; column in <code>event.info</code>.</p>
</td></tr>
<tr><td><code id="CMA1_+3A_force.na.cma.for.failed.patients">force.NA.CMA.for.failed.patients</code></td>
<td>
<p><em>Logical</em> describing how the
patients for which the CMA estimation fails are treated: if <code>TRUE</code>
they are returned with an <code>NA</code> CMA estimate, while for
<code>FALSE</code> they are omitted.</p>
</td></tr>
<tr><td><code id="CMA1_+3A_parallel.backend">parallel.backend</code></td>
<td>
<p>Can be &quot;none&quot; (the default) for single-threaded
execution, &quot;multicore&quot;  (using <code>mclapply</code> in package <code>parallel</code>)
for multicore processing (NB. not currently implemented on MS Windows and
automatically falls back on &quot;snow&quot; on this platform),  or &quot;snow&quot;,
&quot;snow(SOCK)&quot; (equivalent to &quot;snow&quot;), &quot;snow(MPI)&quot; or &quot;snow(NWS)&quot; specifying
various types of SNOW clusters (can be on the local machine or more complex
setups &ndash; please see the documentation of package <code>snow</code> for details;
the last two require packages <code>Rmpi</code> and <code>nws</code>, respectively, not
automatically installed with <code>AdhereR</code>).</p>
</td></tr>
<tr><td><code id="CMA1_+3A_parallel.threads">parallel.threads</code></td>
<td>
<p>Can be &quot;auto&quot; (for <code>parallel.backend</code> ==
&quot;multicore&quot;, defaults to the number of cores in the system as given by
<code>options("cores")</code>, while for <code>parallel.backend</code> == &quot;snow&quot;,
defaults to 2), a strictly positive integer specifying the number of parallel
threads, or a more complex specification of the SNOW cluster nodes for
<code>parallel.backend</code> == &quot;snow&quot; (see the documentation of package
<code>snow</code> for details).</p>
</td></tr>
<tr><td><code id="CMA1_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any
warnings.</p>
</td></tr>
<tr><td><code id="CMA1_+3A_suppress.special.argument.checks">suppress.special.argument.checks</code></td>
<td>
<p><em>Logical</em> parameter for internal
use; if <code>FALSE</code> (default) check if the important columns in the <code>data</code>
have some of the reserved names, if <code>TRUE</code> this check is not performed.</p>
</td></tr>
<tr><td><code id="CMA1_+3A_arguments.that.should.not.be.defined">arguments.that.should.not.be.defined</code></td>
<td>
<p>a <em>list</em> of argument names
and pre-defined valuesfor which a warning should be thrown if passed to the
function.</p>
</td></tr>
<tr><td><code id="CMA1_+3A_...">...</code></td>
<td>
<p>other possible parameters</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>CMA1</code> considers the total number of days with medication supplied in
all medication events in the observation window, excluding the last event.
<code>CMA3</code> is identical to <code>CMA1</code> except that it is capped at 100%.
</p>
<p>The formula is
</p>
<p style="text-align: center;"><code class="reqn">(number of days supply excluding last) / (first to last event)</code>
</p>

<p>Thus, the durations of all events are added up, possibly resulting in an CMA
estimate (much) bigger than 1.0 (100%).
</p>
<p><code><a href="#topic+CMA2">CMA2</a></code> and <code>CMA1</code> differ in the inclusion or not of the last
event.
</p>


<h3>Value</h3>

<p>An <code>S3</code> object of class <code>CMA1</code> (derived from <code>CMA0</code>)
with the following fields:
</p>

<ul>
<li> <p><code>data</code> The actual event data, as given by the <code>data</code>
parameter.
</p>
</li>
<li> <p><code>ID.colname</code> the name of the column in <code>data</code> containing the
unique patient ID, as given by the <code>ID.colname</code> parameter.
</p>
</li>
<li> <p><code>event.date.colname</code> the name of the column in <code>data</code>
containing the start date of the event (in the format given in the
<code>date.format</code> parameter), as given by the <code>event.date.colname</code>
parameter.
</p>
</li>
<li> <p><code>event.duration.colname</code> the name of the column in <code>data</code>
containing the event duration (in days), as given by the
<code>event.duration.colname</code> parameter.
</p>
</li>
<li> <p><code>event.daily.dose.colname</code> the name of the column in <code>data</code>
containing the prescribed daily dose, as given by the
<code>event.daily.dose.colname</code> parameter.
</p>
</li>
<li> <p><code>medication.class.colname</code> the name of the column in <code>data</code>
containing the classes/types/groups of medication, as given by the
<code>medication.class.colname</code> parameter.
</p>
</li>
<li> <p><code>followup.window.start</code> the beginning of the follow-up window, as
given by the <code>followup.window.start</code> parameter.
</p>
</li>
<li> <p><code>followup.window.start.unit</code> the time unit of the
<code>followup.window.start</code>, as given by the
<code>followup.window.start.unit</code> parameter.
</p>
</li>
<li> <p><code>followup.window.duration</code> the duration of the follow-up window,
as given by the <code>followup.window.duration</code> parameter.
</p>
</li>
<li> <p><code>followup.window.duration.unit</code> the time unit of the
<code>followup.window.duration</code>, as given by the
<code>followup.window.duration.unit</code> parameter.
</p>
</li>
<li> <p><code>observation.window.start</code> the beginning of the observation
window, as given by the <code>observation.window.start</code> parameter.
</p>
</li>
<li> <p><code>observation.window.start.unit</code> the time unit of the
<code>observation.window.start</code>, as given by the
<code>observation.window.start.unit</code> parameter.
</p>
</li>
<li> <p><code>observation.window.duration</code> the duration of the observation
window, as given by the <code>observation.window.duration</code> parameter.
</p>
</li>
<li> <p><code>observation.window.duration.unit</code> the time unit of the
<code>observation.window.duration</code>, as given by the
<code>observation.window.duration.unit</code> parameter.
</p>
</li>
<li> <p><code>date.format</code> the format of the dates, as given by the
<code>date.format</code> parameter.
</p>
</li>
<li> <p><code>summary</code> the metadata, as given by the <code>summary</code>
parameter.
</p>
</li>
<li> <p><code>event.info</code> the <code>data.frame</code> containing the event info
(irrelevant for most users; see <code><a href="#topic+compute.event.int.gaps">compute.event.int.gaps</a></code> for
details).
</p>
</li>
<li> <p><code>CMA</code> the <code>data.frame</code> containing the actual <code>CMA</code>
estimates for each participant (the <code>ID.colname</code> column).
</p>
</li></ul>

<p>Please note that if <code>medication.groups</code> are defined and
<code>flatten.medication.groups</code> is <code>FALSE</code>, then the <code>CMA</code>
and <code>event.info</code> are named lists, each element containing the CMA and
event.info corresponding to a single medication group (the element's name),
but if <code>flatten.medication.groups</code> is <code>FALSE</code> then they are
<code>data.frame</code>s with an extra column giving the medication group (the
column's name is given by <code>medication.groups.colname</code>).
</p>


<h3>See Also</h3>

<p>CMAs 1 to 8 are described in:
</p>
<p>Vollmer, W. M., Xu, M., Feldstein, A., Smith, D., Waterbury, A., &amp; Rand, C.
(2012). Comparison of pharmacy-based measures of medication adherence.
<em>BMC Health Services Research</em>, <strong>12</strong>, 155.
doi: <a href="https://doi.org/10.1186/1472-6963-12-155">10.1186/1472-6963-12-155</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cma1 &lt;- CMA1(data=med.events,
             ID.colname="PATIENT_ID",
             event.date.colname="DATE",
             event.duration.colname="DURATION",
             followup.window.start=30,
             observation.window.start=30,
             observation.window.duration=365,
             date.format="%m/%d/%Y"
            );
cma3 &lt;- CMA3(data=med.events,
             ID.colname="PATIENT_ID",
             event.date.colname="DATE",
             event.duration.colname="DURATION",
             followup.window.start=30,
             observation.window.start=30,
             observation.window.duration=365,
             date.format="%m/%d/%Y"
            );
</code></pre>

<hr>
<h2 id='CMA2'>CMA2 and CMA4 constructors.</h2><span id='topic+CMA2'></span><span id='topic+CMA4'></span>

<h3>Description</h3>

<p>Constructs a CMA (continuous multiple-interval measures of medication
availability/gaps) type 2 or type 4 object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CMA2(
  data = NULL,
  ID.colname = NA,
  event.date.colname = NA,
  event.duration.colname = NA,
  medication.groups = NULL,
  flatten.medication.groups = FALSE,
  medication.groups.colname = ".MED_GROUP_ID",
  followup.window.start = 0,
  followup.window.start.unit = c("days", "weeks", "months", "years")[1],
  followup.window.start.per.medication.group = FALSE,
  followup.window.duration = 365 * 2,
  followup.window.duration.unit = c("days", "weeks", "months", "years")[1],
  observation.window.start = 0,
  observation.window.start.unit = c("days", "weeks", "months", "years")[1],
  observation.window.duration = 365 * 2,
  observation.window.duration.unit = c("days", "weeks", "months", "years")[1],
  date.format = "%m/%d/%Y",
  summary = NA,
  event.interval.colname = "event.interval",
  gap.days.colname = "gap.days",
  force.NA.CMA.for.failed.patients = TRUE,
  parallel.backend = c("none", "multicore", "snow", "snow(SOCK)", "snow(MPI)",
    "snow(NWS)")[1],
  parallel.threads = "auto",
  suppress.warnings = FALSE,
  suppress.special.argument.checks = TRUE,
  arguments.that.should.not.be.defined = c(carryover.within.obs.window = FALSE,
    carryover.into.obs.window = FALSE, carry.only.for.same.medication = FALSE,
    consider.dosage.change = FALSE),
  ...
)

CMA4(
  data = NULL,
  ID.colname = NA,
  event.date.colname = NA,
  event.duration.colname = NA,
  medication.groups = NULL,
  flatten.medication.groups = FALSE,
  medication.groups.colname = ".MED_GROUP_ID",
  followup.window.start = 0,
  followup.window.start.unit = c("days", "weeks", "months", "years")[1],
  followup.window.start.per.medication.group = FALSE,
  followup.window.duration = 365 * 2,
  followup.window.duration.unit = c("days", "weeks", "months", "years")[1],
  observation.window.start = 0,
  observation.window.start.unit = c("days", "weeks", "months", "years")[1],
  observation.window.duration = 365 * 2,
  observation.window.duration.unit = c("days", "weeks", "months", "years")[1],
  date.format = "%m/%d/%Y",
  summary = NA,
  event.interval.colname = "event.interval",
  gap.days.colname = "gap.days",
  force.NA.CMA.for.failed.patients = TRUE,
  parallel.backend = c("none", "multicore", "snow", "snow(SOCK)", "snow(MPI)",
    "snow(NWS)")[1],
  parallel.threads = "auto",
  suppress.warnings = FALSE,
  suppress.special.argument.checks = TRUE,
  arguments.that.should.not.be.defined = c(carryover.within.obs.window = FALSE,
    carryover.into.obs.window = FALSE, carry.only.for.same.medication = FALSE,
    consider.dosage.change = FALSE),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CMA2_+3A_data">data</code></td>
<td>
<p>A <em><code>data.frame</code></em> containing the events used to compute
the CMA. Must contain, at a minimum, the patient unique ID, the event date
and duration, and might also contain the daily dosage and medication type
(the actual column names are defined in the following four parameters).</p>
</td></tr>
<tr><td><code id="CMA2_+3A_id.colname">ID.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in <code>data</code>
containing the unique patient ID; must be present.</p>
</td></tr>
<tr><td><code id="CMA2_+3A_event.date.colname">event.date.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the start date of the event (in the format given in
the <code>date.format</code> parameter); must be present.</p>
</td></tr>
<tr><td><code id="CMA2_+3A_event.duration.colname">event.duration.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the event duration (in days); must be present.</p>
</td></tr>
<tr><td><code id="CMA2_+3A_medication.groups">medication.groups</code></td>
<td>
<p>A <em>vector</em> of characters defining medication
groups or the name of a column in <code>data</code> that defines such groups.
The names of the vector are the medication group unique names, while
the content defines them as logical expressions. While the names can be any
string of characters except &quot;}&quot;, it is recommended to stick to the rules for
defining vector names in <code>R</code>. For example,
<code>c("A"="CATEGORY == 'medA'", "AA"="{A} &amp; PERDAY &lt; 4"</code> defines two
medication groups: <em>A</em> which selects all events of type &quot;medA&quot;, and
<em>B</em> which selects all events already defined by &quot;A&quot; but with a daily
dose lower than 4. If <code>NULL</code>, no medication groups are defined. If
medication groups are defined, there is one CMA estimate for each group;
moreover, there is a special group <em>__ALL_OTHERS__</em> automatically defined
containing all observations <em>not</em> covered by any of the explicitly defined
groups.</p>
</td></tr>
<tr><td><code id="CMA2_+3A_flatten.medication.groups">flatten.medication.groups</code></td>
<td>
<p><em>Logical</em>, if <code>FALSE</code> (the default)
then the <code>CMA</code> and <code>event.info</code> components of the object are lists
with one medication group per element; otherwise, they are <code>data.frame</code>s
with an extra column containing the medication group (its name is given by
<code>medication.groups.colname</code>).</p>
</td></tr>
<tr><td><code id="CMA2_+3A_medication.groups.colname">medication.groups.colname</code></td>
<td>
<p>a <em>string</em> (defaults to &quot;.MED_GROUP_ID&quot;)
giving the name of the column storing the group name when
<code>flatten.medication.groups</code> is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="CMA2_+3A_followup.window.start">followup.window.start</code></td>
<td>
<p>If a <em><code>Date</code></em> object, it represents
the actual start date of the follow-up window; if a <em>string</em> it is the
name of the column in <code>data</code> containing the start date of the follow-up
window either as the numbers of <code>followup.window.start.unit</code> units after
the first event (the column must be of type <code>numeric</code>) or as actual
dates (in which case the column must be of type <code>Date</code> or a string
that conforms to the format specified in <code>date.format</code>); if a
<em>number</em> it is the number of time units defined in the
<code>followup.window.start.unit</code> parameter after the begin of the
participant's first event; or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA2_+3A_followup.window.start.unit">followup.window.start.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.start</code> refers to (when a number), or
<code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA2_+3A_followup.window.start.per.medication.group">followup.window.start.per.medication.group</code></td>
<td>
<p>a <em>logical</em>: if there are
medication groups defined and this is <code>TRUE</code>, then the first event
considered for the follow-up window start is relative to each medication group
separately, otherwise (the default) it is relative to the patient.</p>
</td></tr>
<tr><td><code id="CMA2_+3A_followup.window.duration">followup.window.duration</code></td>
<td>
<p>either a <em>number</em> representing the
duration of the follow-up window in the time units given in
<code>followup.window.duration.unit</code>, or a <em>string</em> giving the column
containing these numbers. Should represent a period for which relevant
medication events are recorded accurately (e.g. not extend after end of
relevant treatment, loss-to-follow-up or change to a health care provider
not covered by the database).</p>
</td></tr>
<tr><td><code id="CMA2_+3A_followup.window.duration.unit">followup.window.duration.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.duration</code> refers to, or <code>NA</code> if not
defined.</p>
</td></tr>
<tr><td><code id="CMA2_+3A_observation.window.start">observation.window.start</code>, <code id="CMA2_+3A_observation.window.start.unit">observation.window.start.unit</code>, <code id="CMA2_+3A_observation.window.duration">observation.window.duration</code>, <code id="CMA2_+3A_observation.window.duration.unit">observation.window.duration.unit</code></td>
<td>
<p>the definition of the observation window
(see the follow-up window parameters above for details).</p>
</td></tr>
<tr><td><code id="CMA2_+3A_date.format">date.format</code></td>
<td>
<p>A <em>string</em> giving the format of the dates used in the
<code>data</code> and the other parameters; see the <code>format</code> parameters of the
<code><a href="base.html#topic+as.Date">as.Date</a></code> function for details (NB, this concerns only the
dates given as strings and not as <code>Date</code> objects).</p>
</td></tr>
<tr><td><code id="CMA2_+3A_summary">summary</code></td>
<td>
<p>Metadata as a <em>string</em>, briefly describing this CMA.</p>
</td></tr>
<tr><td><code id="CMA2_+3A_event.interval.colname">event.interval.colname</code></td>
<td>
<p>A <em>string</em>, the name of a newly-created
column storing the number of days between the start of the current event and
the start of the next one; the default value &quot;event.interval&quot; should be
changed only if there is a naming conflict with a pre-existing
&quot;event.interval&quot; column in <code>event.info</code>.</p>
</td></tr>
<tr><td><code id="CMA2_+3A_gap.days.colname">gap.days.colname</code></td>
<td>
<p>A <em>string</em>, the name of a newly-created column
storing the number of days when medication was not available (i.e., the
&quot;gap days&quot;); the default value &quot;gap.days&quot; should be changed only if there is
a naming conflict with a pre-existing &quot;gap.days&quot; column in <code>event.info</code>.</p>
</td></tr>
<tr><td><code id="CMA2_+3A_force.na.cma.for.failed.patients">force.NA.CMA.for.failed.patients</code></td>
<td>
<p><em>Logical</em> describing how the
patients for which the CMA estimation fails are treated: if <code>TRUE</code>
they are returned with an <code>NA</code> CMA estimate, while for
<code>FALSE</code> they are omitted.</p>
</td></tr>
<tr><td><code id="CMA2_+3A_parallel.backend">parallel.backend</code></td>
<td>
<p>Can be &quot;none&quot; (the default) for single-threaded
execution, &quot;multicore&quot;  (using <code>mclapply</code> in package <code>parallel</code>)
for multicore processing (NB. not currently implemented on MS Windows and
automatically falls back on &quot;snow&quot; on this platform),  or &quot;snow&quot;,
&quot;snow(SOCK)&quot; (equivalent to &quot;snow&quot;), &quot;snow(MPI)&quot; or &quot;snow(NWS)&quot; specifying
various types of SNOW clusters (can be on the local machine or more complex
setups &ndash; please see the documentation of package <code>snow</code> for details;
the last two require packages <code>Rmpi</code> and <code>nws</code>, respectively, not
automatically installed with <code>AdhereR</code>).</p>
</td></tr>
<tr><td><code id="CMA2_+3A_parallel.threads">parallel.threads</code></td>
<td>
<p>Can be &quot;auto&quot; (for <code>parallel.backend</code> ==
&quot;multicore&quot;, defaults to the number of cores in the system as given by
<code>options("cores")</code>, while for <code>parallel.backend</code> == &quot;snow&quot;,
defaults to 2), a strictly positive integer specifying the number of parallel
threads, or a more complex specification of the SNOW cluster nodes for
<code>parallel.backend</code> == &quot;snow&quot; (see the documentation of package
<code>snow</code> for details).</p>
</td></tr>
<tr><td><code id="CMA2_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any
warnings.</p>
</td></tr>
<tr><td><code id="CMA2_+3A_suppress.special.argument.checks">suppress.special.argument.checks</code></td>
<td>
<p><em>Logical</em> parameter for internal
use; if <code>FALSE</code> (default) check if the important columns in the <code>data</code>
have some of the reserved names, if <code>TRUE</code> this check is not performed.</p>
</td></tr>
<tr><td><code id="CMA2_+3A_arguments.that.should.not.be.defined">arguments.that.should.not.be.defined</code></td>
<td>
<p>a <em>list</em> of argument names
and pre-defined valuesfor which a warning should be thrown if passed to the
function.</p>
</td></tr>
<tr><td><code id="CMA2_+3A_...">...</code></td>
<td>
<p>other possible parameters</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>CMA2</code> considers the total number of days with medication supplied in
all medication events in the observation window, including the last event.
<code>CMA4</code> is identical to <code>CMA2</code> except that it is capped at 100%.
</p>
<p>The formula is
</p>
<p style="text-align: center;"><code class="reqn">(number of days supply including last event) / (first to last event)</code>
</p>

<p>Thus, the durations of all events are added up, possibly resulting in an CMA
estimate (much) bigger than 1.0 (100%)
</p>
<p><code>CMA2</code> and <code><a href="#topic+CMA1">CMA1</a></code> differ in the inclusion or not of the last
event.
</p>


<h3>Value</h3>

<p>An <code>S3</code> object of class <code>CMA2</code> (derived from <code>CMA0</code>)
with the following fields:
</p>

<ul>
<li> <p><code>data</code> The actual event data, as given by the <code>data</code>
parameter.
</p>
</li>
<li> <p><code>ID.colname</code> the name of the column in <code>data</code> containing the
unique patient ID, as given by the <code>ID.colname</code> parameter.
</p>
</li>
<li> <p><code>event.date.colname</code> the name of the column in <code>data</code>
containing the start date of the event (in the format given in the
<code>date.format</code> parameter), as given by the <code>event.date.colname</code>
parameter.
</p>
</li>
<li> <p><code>event.duration.colname</code> the name of the column in <code>data</code>
containing the event duration (in days), as given by the
<code>event.duration.colname</code> parameter.
</p>
</li>
<li> <p><code>event.daily.dose.colname</code> the name of the column in <code>data</code>
containing the prescribed daily dose, as given by the
<code>event.daily.dose.colname</code> parameter.
</p>
</li>
<li> <p><code>medication.class.colname</code> the name of the column in <code>data</code>
containing the classes/types/groups of medication, as given by the
<code>medication.class.colname</code> parameter.
</p>
</li>
<li> <p><code>followup.window.start</code> the beginning of the follow-up window, as
given by the <code>followup.window.start</code> parameter.
</p>
</li>
<li> <p><code>followup.window.start.unit</code> the time unit of the
<code>followup.window.start</code>, as given by the
<code>followup.window.start.unit</code> parameter.
</p>
</li>
<li> <p><code>followup.window.duration</code> the duration of the follow-up window,
as given by the <code>followup.window.duration</code> parameter.
</p>
</li>
<li> <p><code>followup.window.duration.unit</code> the time unit of the
<code>followup.window.duration</code>, as given by the
<code>followup.window.duration.unit</code> parameter.
</p>
</li>
<li> <p><code>observation.window.start</code> the beginning of the observation
window, as given by the <code>observation.window.start</code> parameter.
</p>
</li>
<li> <p><code>observation.window.start.unit</code> the time unit of the
<code>observation.window.start</code>, as given by the
<code>observation.window.start.unit</code> parameter.
</p>
</li>
<li> <p><code>observation.window.duration</code> the duration of the observation
window, as given by the <code>observation.window.duration</code> parameter.
</p>
</li>
<li> <p><code>observation.window.duration.unit</code> the time unit of the
<code>observation.window.duration</code>, as given by the
<code>observation.window.duration.unit</code> parameter.
</p>
</li>
<li> <p><code>date.format</code> the format of the dates, as given by the
<code>date.format</code> parameter.
</p>
</li>
<li> <p><code>summary</code> the metadata, as given by the <code>summary</code> parameter.
</p>
</li>
<li> <p><code>event.info</code> the <code>data.frame</code> containing the event info
(irrelevant for most users; see <code><a href="#topic+compute.event.int.gaps">compute.event.int.gaps</a></code> for
details).
</p>
</li>
<li> <p><code>CMA</code> the <code>data.frame</code> containing the actual <code>CMA</code>
estimates for each participant (the <code>ID.colname</code> column).
</p>
</li></ul>

<p>Please note that if <code>medication.groups</code> are defined, then the <code>CMA</code>
and <code>event.info</code> are named lists, each element containing the CMA and
event.info corresponding to a single medication group (the element's name).
</p>


<h3>See Also</h3>

<p>CMAs 1 to 8 are defined in:
</p>
<p>Vollmer, W. M., Xu, M., Feldstein, A., Smith, D., Waterbury, A., &amp; Rand, C.
(2012). Comparison of pharmacy-based measures of medication adherence.
<em>BMC Health Services Research</em>, <strong>12</strong>, 155.
doi: <a href="https://doi.org/10.1186/1472-6963-12-155">10.1186/1472-6963-12-155</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
cma2 &lt;- CMA2(data=med.events,
             ID.colname="PATIENT_ID",
             event.date.colname="DATE",
             event.duration.colname="DURATION",
             followup.window.start=30,
             observation.window.start=30,
             observation.window.duration=365,
             date.format="%m/%d/%Y"
            );
cma4 &lt;- CMA4(data=med.events,
             ID.colname="PATIENT_ID",
             event.date.colname="DATE",
             event.duration.colname="DURATION",
             followup.window.start=30,
             observation.window.start=30,
             observation.window.duration=365,
             date.format="%m/%d/%Y"
            );
## End(Not run)
</code></pre>

<hr>
<h2 id='CMA5'>CMA5 constructor.</h2><span id='topic+CMA5'></span>

<h3>Description</h3>

<p>Constructs a CMA (continuous multiple-interval measures of medication
availability/gaps) type 5 object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CMA5(
  data = NULL,
  ID.colname = NA,
  event.date.colname = NA,
  event.duration.colname = NA,
  event.daily.dose.colname = NA,
  medication.class.colname = NA,
  medication.groups = NULL,
  flatten.medication.groups = FALSE,
  medication.groups.colname = ".MED_GROUP_ID",
  carry.only.for.same.medication = FALSE,
  consider.dosage.change = FALSE,
  followup.window.start = 0,
  followup.window.start.unit = c("days", "weeks", "months", "years")[1],
  followup.window.start.per.medication.group = FALSE,
  followup.window.duration = 365 * 2,
  followup.window.duration.unit = c("days", "weeks", "months", "years")[1],
  observation.window.start = 0,
  observation.window.start.unit = c("days", "weeks", "months", "years")[1],
  observation.window.duration = 365 * 2,
  observation.window.duration.unit = c("days", "weeks", "months", "years")[1],
  date.format = "%m/%d/%Y",
  summary = NA,
  event.interval.colname = "event.interval",
  gap.days.colname = "gap.days",
  force.NA.CMA.for.failed.patients = TRUE,
  parallel.backend = c("none", "multicore", "snow", "snow(SOCK)", "snow(MPI)",
    "snow(NWS)")[1],
  parallel.threads = "auto",
  suppress.warnings = FALSE,
  suppress.special.argument.checks = TRUE,
  arguments.that.should.not.be.defined = c(carryover.within.obs.window = TRUE,
    carryover.into.obs.window = FALSE),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CMA5_+3A_data">data</code></td>
<td>
<p>A <em><code>data.frame</code></em> containing the medication events used
to compute the CMA. Must contain, at a minimum, the patient unique ID, the
event date and duration, and might also contain the daily dosage and
medication type (the actual column names are defined in the following four
parameters).</p>
</td></tr>
<tr><td><code id="CMA5_+3A_id.colname">ID.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in <code>data</code>
containing the unique patient ID; must be present.</p>
</td></tr>
<tr><td><code id="CMA5_+3A_event.date.colname">event.date.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the start date of the event (in the format given in
the <code>date.format</code> parameter); must be present.</p>
</td></tr>
<tr><td><code id="CMA5_+3A_event.duration.colname">event.duration.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the event duration (in days); must be present.</p>
</td></tr>
<tr><td><code id="CMA5_+3A_event.daily.dose.colname">event.daily.dose.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the prescribed daily dose, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA5_+3A_medication.class.colname">medication.class.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the medication type, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA5_+3A_medication.groups">medication.groups</code></td>
<td>
<p>A <em>vector</em> of characters defining medication
groups or the name of a column in <code>data</code> that defines such groups.
The names of the vector are the medication group unique names, while
the content defines them as logical expressions. While the names can be any
string of characters except &quot;}&quot;, it is recommended to stick to the rules for
defining vector names in <code>R</code>. For example,
<code>c("A"="CATEGORY == 'medA'", "AA"="{A} &amp; PERDAY &lt; 4"</code> defines two
medication groups: <em>A</em> which selects all events of type &quot;medA&quot;, and
<em>B</em> which selects all events already defined by &quot;A&quot; but with a daily
dose lower than 4. If <code>NULL</code>, no medication groups are defined. If
medication groups are defined, there is one CMA estimate for each group;
moreover, there is a special group <em>__ALL_OTHERS__</em> automatically defined
containing all observations <em>not</em> covered by any of the explicitly defined
groups.</p>
</td></tr>
<tr><td><code id="CMA5_+3A_flatten.medication.groups">flatten.medication.groups</code></td>
<td>
<p><em>Logical</em>, if <code>FALSE</code> (the default)
then the <code>CMA</code> and <code>event.info</code> components of the object are lists
with one medication group per element; otherwise, they are <code>data.frame</code>s
with an extra column containing the medication group (its name is given by
<code>medication.groups.colname</code>).</p>
</td></tr>
<tr><td><code id="CMA5_+3A_medication.groups.colname">medication.groups.colname</code></td>
<td>
<p>a <em>string</em> (defaults to &quot;.MED_GROUP_ID&quot;)
giving the name of the column storing the group name when
<code>flatten.medication.groups</code> is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="CMA5_+3A_carry.only.for.same.medication">carry.only.for.same.medication</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code>, the
carry-over applies only across medication of the same type.</p>
</td></tr>
<tr><td><code id="CMA5_+3A_consider.dosage.change">consider.dosage.change</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code>, the carry-over
is adjusted to also reflect changes in dosage.</p>
</td></tr>
<tr><td><code id="CMA5_+3A_followup.window.start">followup.window.start</code></td>
<td>
<p>If a <em><code>Date</code></em> object, it represents
the actual start date of the follow-up window; if a <em>string</em> it is the
name of the column in <code>data</code> containing the start date of the follow-up
window either as the numbers of <code>followup.window.start.unit</code> units after
the first event (the column must be of type <code>numeric</code>) or as actual
dates (in which case the column must be of type <code>Date</code> or a string
that conforms to the format specified in <code>date.format</code>); if a
<em>number</em> it is the number of time units defined in the
<code>followup.window.start.unit</code> parameter after the begin of the
participant's first event; or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA5_+3A_followup.window.start.unit">followup.window.start.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.start</code> refers to (when a number), or
<code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA5_+3A_followup.window.start.per.medication.group">followup.window.start.per.medication.group</code></td>
<td>
<p>a <em>logical</em>: if there are
medication groups defined and this is <code>TRUE</code>, then the first event
considered for the follow-up window start is relative to each medication group
separately, otherwise (the default) it is relative to the patient.</p>
</td></tr>
<tr><td><code id="CMA5_+3A_followup.window.duration">followup.window.duration</code></td>
<td>
<p>either a <em>number</em> representing the
duration of the follow-up window in the time units given in
<code>followup.window.duration.unit</code>, or a <em>string</em> giving the column
containing these numbers. Should represent a period for which relevant
medication events are recorded accurately (e.g. not extend after end of
relevant treatment, loss-to-follow-up or change to a health care provider not
covered by the database).</p>
</td></tr>
<tr><td><code id="CMA5_+3A_followup.window.duration.unit">followup.window.duration.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.duration</code> refers to, or <code>NA</code> if not
defined.</p>
</td></tr>
<tr><td><code id="CMA5_+3A_observation.window.start">observation.window.start</code>, <code id="CMA5_+3A_observation.window.start.unit">observation.window.start.unit</code>, <code id="CMA5_+3A_observation.window.duration">observation.window.duration</code>, <code id="CMA5_+3A_observation.window.duration.unit">observation.window.duration.unit</code></td>
<td>
<p>the definition of the observation window
(see the follow-up window parameters above for details).</p>
</td></tr>
<tr><td><code id="CMA5_+3A_date.format">date.format</code></td>
<td>
<p>A <em>string</em> giving the format of the dates used in the
<code>data</code> and the other parameters; see the <code>format</code> parameters of the
<code><a href="base.html#topic+as.Date">as.Date</a></code> function for details (NB, this concerns only the
dates given as strings and not as <code>Date</code> objects).</p>
</td></tr>
<tr><td><code id="CMA5_+3A_summary">summary</code></td>
<td>
<p>Metadata as a <em>string</em>, briefly describing this CMA.</p>
</td></tr>
<tr><td><code id="CMA5_+3A_event.interval.colname">event.interval.colname</code></td>
<td>
<p>A <em>string</em>, the name of a newly-created
column storing the number of days between the start of the current event and
the start of the next one; the default value &quot;event.interval&quot; should be
changed only if there is a naming conflict with a pre-existing
&quot;event.interval&quot; column in <code>event.info</code>.</p>
</td></tr>
<tr><td><code id="CMA5_+3A_gap.days.colname">gap.days.colname</code></td>
<td>
<p>A <em>string</em>, the name of a newly-created column
storing the number of days when medication was not available (i.e., the
&quot;gap days&quot;); the default value &quot;gap.days&quot; should be changed only if there is
a naming conflict with a pre-existing &quot;gap.days&quot; column in <code>event.info</code>.</p>
</td></tr>
<tr><td><code id="CMA5_+3A_force.na.cma.for.failed.patients">force.NA.CMA.for.failed.patients</code></td>
<td>
<p><em>Logical</em> describing how the
patients for which the CMA estimation fails are treated: if <code>TRUE</code>
they are returned with an <code>NA</code> CMA estimate, while for
<code>FALSE</code> they are omitted.</p>
</td></tr>
<tr><td><code id="CMA5_+3A_parallel.backend">parallel.backend</code></td>
<td>
<p>Can be &quot;none&quot; (the default) for single-threaded
execution, &quot;multicore&quot;  (using <code>mclapply</code> in package <code>parallel</code>)
for multicore processing (NB. not currently implemented on MS Windows and
automatically falls back on &quot;snow&quot; on this platform),  or &quot;snow&quot;,
&quot;snow(SOCK)&quot; (equivalent to &quot;snow&quot;), &quot;snow(MPI)&quot; or &quot;snow(NWS)&quot; specifying
various types of SNOW clusters (can be on the local machine or more complex
setups &ndash; please see the documentation of package <code>snow</code> for details;
the last two require packages <code>Rmpi</code> and <code>nws</code>, respectively, not
automatically installed with <code>AdhereR</code>).</p>
</td></tr>
<tr><td><code id="CMA5_+3A_parallel.threads">parallel.threads</code></td>
<td>
<p>Can be &quot;auto&quot; (for <code>parallel.backend</code> ==
&quot;multicore&quot;, defaults to the number of cores in the system as given by
<code>options("cores")</code>, while for <code>parallel.backend</code> == &quot;snow&quot;,
defaults to 2), a strictly positive integer specifying the number of parallel
threads, or a more complex specification of the SNOW cluster nodes for
<code>parallel.backend</code> == &quot;snow&quot; (see the documentation of package
<code>snow</code> for details).</p>
</td></tr>
<tr><td><code id="CMA5_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any
warnings.</p>
</td></tr>
<tr><td><code id="CMA5_+3A_suppress.special.argument.checks">suppress.special.argument.checks</code></td>
<td>
<p><em>Logical</em> parameter for internal
use; if <code>FALSE</code> (default) check if the important columns in the <code>data</code>
have some of the reserved names, if <code>TRUE</code> this check is not performed.</p>
</td></tr>
<tr><td><code id="CMA5_+3A_arguments.that.should.not.be.defined">arguments.that.should.not.be.defined</code></td>
<td>
<p>a <em>list</em> of argument names
and pre-defined valuesfor which a warning should be thrown if passed to the
function.</p>
</td></tr>
<tr><td><code id="CMA5_+3A_...">...</code></td>
<td>
<p>other possible parameters</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>CMA5</code> assumes that, within the observation window, the medication is
used as prescribed and new medication is &quot;banked&quot; until needed (oversupply
from previous events is used first, followed new medication supply).
It computes days of theoretical use by extracting the total number of gap
days from the total time interval between the first and the last event,
accounting for carry over for all medication events within the observation
window.
Thus, it accounts for timing within the observation window, and excludes the
remaining supply at the start of the last event within the observation window.
</p>
<p>The formula is
</p>
<p style="text-align: center;"><code class="reqn">(number of days of theoretical use) / (first to last event)</code>
</p>

<p>Observations:
</p>

<ul>
<li><p> the <code>carry.only.for.same.medication</code> parameter controls the
transmission of carry-over across medication changes, producing a &quot;standard&quot;
<code>CMA5</code> (default value is FALSE), and an &quot;alternative&quot; <code>CMA5b</code>,
respectively;
</p>
</li>
<li><p> the <code>consider.dosage.change</code> parameter controls if dosage changes
are taken into account, i.e. if set as TRUE and a new medication event has a
different daily dosage recommendation, carry-over is recomputed assuming
medication use according to the new prescribed dosage (default value is FALSE).
</p>
</li></ul>



<h3>Value</h3>

<p>An <code>S3</code> object of class <code>CMA5</code> (derived from <code>CMA0</code>)
with the following fields:
</p>

<ul>
<li> <p><code>data</code> The actual event data, as given by the <code>data</code>
parameter.
</p>
</li>
<li> <p><code>ID.colname</code> the name of the column in <code>data</code> containing the
unique patient ID, as given by the <code>ID.colname</code> parameter.
</p>
</li>
<li> <p><code>event.date.colname</code> the name of the column in <code>data</code>
containing the start date of the event (in the format given in the
<code>date.format</code> parameter), as given by the <code>event.date.colname</code>
parameter.
</p>
</li>
<li> <p><code>event.duration.colname</code> the name of the column in <code>data</code>
containing the event duration (in days), as given by the
<code>event.duration.colname</code> parameter.
</p>
</li>
<li> <p><code>event.daily.dose.colname</code> the name of the column in <code>data</code>
containing the prescribed daily dose, as given by the
<code>event.daily.dose.colname</code> parameter.
</p>
</li>
<li> <p><code>medication.class.colname</code> the name of the column in <code>data</code>
containing the classes/types/groups of medication, as given by the
<code>medication.class.colname</code> parameter.
</p>
</li>
<li> <p><code>carry.only.for.same.medication</code> whether the carry-over applies
only across medication of the same type, as given by the
<code>carry.only.for.same.medication</code> parameter.
</p>
</li>
<li> <p><code>consider.dosage.change</code> whether the carry-over is adjusted to
reflect changes in dosage, as given by the <code>consider.dosage.change</code>
parameter.
</p>
</li>
<li> <p><code>followup.window.start</code> the beginning of the follow-up window, as
given by the <code>followup.window.start</code> parameter.
</p>
</li>
<li> <p><code>followup.window.start.unit</code> the time unit of the
<code>followup.window.start</code>, as given by the
<code>followup.window.start.unit</code> parameter.
</p>
</li>
<li> <p><code>followup.window.duration</code> the duration of the follow-up window,
as given by the <code>followup.window.duration</code> parameter.
</p>
</li>
<li> <p><code>followup.window.duration.unit</code> the time unit of the
<code>followup.window.duration</code>, as given by the
<code>followup.window.duration.unit</code> parameter.
</p>
</li>
<li> <p><code>observation.window.start</code> the beginning of the observation
window, as given by the <code>observation.window.start</code> parameter.
</p>
</li>
<li> <p><code>observation.window.start.unit</code> the time unit of the
<code>observation.window.start</code>, as given by the
<code>observation.window.start.unit</code> parameter.
</p>
</li>
<li> <p><code>observation.window.duration</code> the duration of the observation
window, as given by the <code>observation.window.duration</code> parameter.
</p>
</li>
<li> <p><code>observation.window.duration.unit</code> the time unit of the
<code>observation.window.duration</code>, as given by the
<code>observation.window.duration.unit</code> parameter.
</p>
</li>
<li> <p><code>date.format</code> the format of the dates, as given by the
<code>date.format</code> parameter.
</p>
</li>
<li> <p><code>summary</code> the metadata, as given by the <code>summary</code> parameter.
</p>
</li>
<li> <p><code>event.info</code> the <code>data.frame</code> containing the event info
(irrelevant for most users; see <code><a href="#topic+compute.event.int.gaps">compute.event.int.gaps</a></code> for
details).
</p>
</li>
<li> <p><code>CMA</code> the <code>data.frame</code> containing the actual <code>CMA</code>
estimates for each participant (the <code>ID.colname</code> column).
</p>
</li></ul>

<p>Please note that if <code>medication.groups</code> are defined, then the <code>CMA</code>
and <code>event.info</code> are named lists, each element containing the CMA and
event.info corresponding to a single medication group (the element's name).
</p>


<h3>See Also</h3>

<p>CMAs 1 to 8 are defined in:
</p>
<p>Vollmer, W. M., Xu, M., Feldstein, A., Smith, D., Waterbury, A., &amp; Rand, C.
(2012). Comparison of pharmacy-based measures of medication adherence.
<em>BMC Health Services Research</em>, <strong>12</strong>, 155.
doi: <a href="https://doi.org/10.1186/1472-6963-12-155">10.1186/1472-6963-12-155</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cma5 &lt;- CMA5(data=med.events,
             ID.colname="PATIENT_ID",
             event.date.colname="DATE",
             event.duration.colname="DURATION",
             event.daily.dose.colname="PERDAY",
             medication.class.colname="CATEGORY",
             carry.only.for.same.medication=FALSE,
             consider.dosage.change=FALSE,
             followup.window.start=30,
             observation.window.start=30,
             observation.window.duration=365,
             date.format="%m/%d/%Y"
            );
</code></pre>

<hr>
<h2 id='CMA6'>CMA6 constructor.</h2><span id='topic+CMA6'></span>

<h3>Description</h3>

<p>Constructs a CMA (continuous multiple-interval measures of medication
availability/gaps) type 6 object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CMA6(
  data = NULL,
  ID.colname = NA,
  event.date.colname = NA,
  event.duration.colname = NA,
  event.daily.dose.colname = NA,
  medication.class.colname = NA,
  medication.groups = NULL,
  flatten.medication.groups = FALSE,
  medication.groups.colname = ".MED_GROUP_ID",
  carry.only.for.same.medication = FALSE,
  consider.dosage.change = FALSE,
  followup.window.start = 0,
  followup.window.start.unit = c("days", "weeks", "months", "years")[1],
  followup.window.start.per.medication.group = FALSE,
  followup.window.duration = 365 * 2,
  followup.window.duration.unit = c("days", "weeks", "months", "years")[1],
  observation.window.start = 0,
  observation.window.start.unit = c("days", "weeks", "months", "years")[1],
  observation.window.duration = 365 * 2,
  observation.window.duration.unit = c("days", "weeks", "months", "years")[1],
  date.format = "%m/%d/%Y",
  summary = NA,
  event.interval.colname = "event.interval",
  gap.days.colname = "gap.days",
  force.NA.CMA.for.failed.patients = TRUE,
  parallel.backend = c("none", "multicore", "snow", "snow(SOCK)", "snow(MPI)",
    "snow(NWS)")[1],
  parallel.threads = "auto",
  suppress.warnings = FALSE,
  suppress.special.argument.checks = TRUE,
  arguments.that.should.not.be.defined = c(carryover.within.obs.window = TRUE,
    carryover.into.obs.window = FALSE),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CMA6_+3A_data">data</code></td>
<td>
<p>A <em><code>data.frame</code></em> containing the events used to compute
the CMA. Must contain, at a minimum, the patient unique ID, the event date
and duration, and might also contain the daily dosage and medication type
(the actual column names are defined in the following four parameters).</p>
</td></tr>
<tr><td><code id="CMA6_+3A_id.colname">ID.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in <code>data</code>
containing the unique patient ID; must be present.</p>
</td></tr>
<tr><td><code id="CMA6_+3A_event.date.colname">event.date.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the start date of the event (in the format given in
the <code>date.format</code> parameter); must be present.</p>
</td></tr>
<tr><td><code id="CMA6_+3A_event.duration.colname">event.duration.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the event duration (in days); must be present.</p>
</td></tr>
<tr><td><code id="CMA6_+3A_event.daily.dose.colname">event.daily.dose.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the prescribed daily dose, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA6_+3A_medication.class.colname">medication.class.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the medication type, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA6_+3A_medication.groups">medication.groups</code></td>
<td>
<p>A <em>vector</em> of characters defining medication
groups or the name of a column in <code>data</code> that defines such groups.
The names of the vector are the medication group unique names, while
the content defines them as logical expressions. While the names can be any
string of characters except &quot;}&quot;, it is recommended to stick to the rules for
defining vector names in <code>R</code>. For example,
<code>c("A"="CATEGORY == 'medA'", "AA"="{A} &amp; PERDAY &lt; 4"</code> defines two
medication groups: <em>A</em> which selects all events of type &quot;medA&quot;, and
<em>B</em> which selects all events already defined by &quot;A&quot; but with a daily
dose lower than 4. If <code>NULL</code>, no medication groups are defined. If
medication groups are defined, there is one CMA estimate for each group;
moreover, there is a special group <em>__ALL_OTHERS__</em> automatically defined
containing all observations <em>not</em> covered by any of the explicitly defined
groups.</p>
</td></tr>
<tr><td><code id="CMA6_+3A_flatten.medication.groups">flatten.medication.groups</code></td>
<td>
<p><em>Logical</em>, if <code>FALSE</code> (the default)
then the <code>CMA</code> and <code>event.info</code> components of the object are lists
with one medication group per element; otherwise, they are <code>data.frame</code>s
with an extra column containing the medication group (its name is given by
<code>medication.groups.colname</code>).</p>
</td></tr>
<tr><td><code id="CMA6_+3A_medication.groups.colname">medication.groups.colname</code></td>
<td>
<p>a <em>string</em> (defaults to &quot;.MED_GROUP_ID&quot;)
giving the name of the column storing the group name when
<code>flatten.medication.groups</code> is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="CMA6_+3A_carry.only.for.same.medication">carry.only.for.same.medication</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code>, the
carry-over applies only across medication of the same type.</p>
</td></tr>
<tr><td><code id="CMA6_+3A_consider.dosage.change">consider.dosage.change</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code>, the carry-over
is adjusted to also reflect changes in dosage.</p>
</td></tr>
<tr><td><code id="CMA6_+3A_followup.window.start">followup.window.start</code></td>
<td>
<p>If a <em><code>Date</code></em> object, it represents
the actual start date of the follow-up window; if a <em>string</em> it is the
name of the column in <code>data</code> containing the start date of the follow-up
window either as the numbers of <code>followup.window.start.unit</code> units after
the first event (the column must be of type <code>numeric</code>) or as actual
dates (in which case the column must be of type <code>Date</code> or a string
that conforms to the format specified in <code>date.format</code>); if a
<em>number</em> it is the number of time units defined in the
<code>followup.window.start.unit</code> parameter after the begin of the
participant's first event; or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA6_+3A_followup.window.start.unit">followup.window.start.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.start</code> refers to (when a number), or
<code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA6_+3A_followup.window.start.per.medication.group">followup.window.start.per.medication.group</code></td>
<td>
<p>a <em>logical</em>: if there are
medication groups defined and this is <code>TRUE</code>, then the first event
considered for the follow-up window start is relative to each medication group
separately, otherwise (the default) it is relative to the patient.</p>
</td></tr>
<tr><td><code id="CMA6_+3A_followup.window.duration">followup.window.duration</code></td>
<td>
<p>either a <em>number</em> representing the
duration of the follow-up window in the time units given in
<code>followup.window.duration.unit</code>, or a <em>string</em> giving the column
containing these numbers. Should represent a period for which relevant
medication events are recorded accurately (e.g. not extend after end of
relevant treatment, loss-to-follow-up or change to a health care provider
not covered by the database).</p>
</td></tr>
<tr><td><code id="CMA6_+3A_followup.window.duration.unit">followup.window.duration.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.duration</code> refers to, or <code>NA</code> if not
defined.</p>
</td></tr>
<tr><td><code id="CMA6_+3A_observation.window.start">observation.window.start</code>, <code id="CMA6_+3A_observation.window.start.unit">observation.window.start.unit</code>, <code id="CMA6_+3A_observation.window.duration">observation.window.duration</code>, <code id="CMA6_+3A_observation.window.duration.unit">observation.window.duration.unit</code></td>
<td>
<p>the definition of the observation window
(see the follow-up window parameters above for details).</p>
</td></tr>
<tr><td><code id="CMA6_+3A_date.format">date.format</code></td>
<td>
<p>A <em>string</em> giving the format of the dates used in the
<code>data</code> and the other parameters; see the <code>format</code> parameters of the
<code><a href="base.html#topic+as.Date">as.Date</a></code> function for details (NB, this concerns only the
dates given as strings and not as <code>Date</code> objects).</p>
</td></tr>
<tr><td><code id="CMA6_+3A_summary">summary</code></td>
<td>
<p>Metadata as a <em>string</em>, briefly describing this CMA.</p>
</td></tr>
<tr><td><code id="CMA6_+3A_event.interval.colname">event.interval.colname</code></td>
<td>
<p>A <em>string</em>, the name of a newly-created
column storing the number of days between the start of the current event and
the start of the next one; the default value &quot;event.interval&quot; should be
changed only if there is a naming conflict with a pre-existing
&quot;event.interval&quot; column in <code>event.info</code>.</p>
</td></tr>
<tr><td><code id="CMA6_+3A_gap.days.colname">gap.days.colname</code></td>
<td>
<p>A <em>string</em>, the name of a newly-created column
storing the number of days when medication was not available (i.e., the
&quot;gap days&quot;); the default value &quot;gap.days&quot; should be changed only if there is
a naming conflict with a pre-existing &quot;gap.days&quot; column in <code>event.info</code>.</p>
</td></tr>
<tr><td><code id="CMA6_+3A_force.na.cma.for.failed.patients">force.NA.CMA.for.failed.patients</code></td>
<td>
<p><em>Logical</em> describing how the
patients for which the CMA estimation fails are treated: if <code>TRUE</code>
they are returned with an <code>NA</code> CMA estimate, while for
<code>FALSE</code> they are omitted.</p>
</td></tr>
<tr><td><code id="CMA6_+3A_parallel.backend">parallel.backend</code></td>
<td>
<p>Can be &quot;none&quot; (the default) for single-threaded
execution, &quot;multicore&quot;  (using <code>mclapply</code> in package <code>parallel</code>)
for multicore processing (NB. not currently implemented on MS Windows and
automatically falls back on &quot;snow&quot; on this platform),  or &quot;snow&quot;,
&quot;snow(SOCK)&quot; (equivalent to &quot;snow&quot;), &quot;snow(MPI)&quot; or &quot;snow(NWS)&quot; specifying
various types of SNOW clusters (can be on the local machine or more complex
setups &ndash; please see the documentation of package <code>snow</code> for details;
the last two require packages <code>Rmpi</code> and <code>nws</code>, respectively, not
automatically installed with <code>AdhereR</code>).</p>
</td></tr>
<tr><td><code id="CMA6_+3A_parallel.threads">parallel.threads</code></td>
<td>
<p>Can be &quot;auto&quot; (for <code>parallel.backend</code> ==
&quot;multicore&quot;, defaults to the number of cores in the system as given by
<code>options("cores")</code>, while for <code>parallel.backend</code> == &quot;snow&quot;,
defaults to 2), a strictly positive integer specifying the number of parallel
threads, or a more complex specification of the SNOW cluster nodes for
<code>parallel.backend</code> == &quot;snow&quot; (see the documentation of package
<code>snow</code> for details).</p>
</td></tr>
<tr><td><code id="CMA6_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any
warnings.</p>
</td></tr>
<tr><td><code id="CMA6_+3A_suppress.special.argument.checks">suppress.special.argument.checks</code></td>
<td>
<p><em>Logical</em> parameter for internal
use; if <code>FALSE</code> (default) check if the important columns in the <code>data</code>
have some of the reserved names, if <code>TRUE</code> this check is not performed.</p>
</td></tr>
<tr><td><code id="CMA6_+3A_arguments.that.should.not.be.defined">arguments.that.should.not.be.defined</code></td>
<td>
<p>a <em>list</em> of argument names
and pre-defined valuesfor which a warning should be thrown if passed to the
function.</p>
</td></tr>
<tr><td><code id="CMA6_+3A_...">...</code></td>
<td>
<p>other possible parameters</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>CMA6</code> assumes that, within the observation window, the medication is
used as prescribed and new medication is &quot;banked&quot; until needed (oversupply
from previous events is used first, followed new medication supply).
It computes days of theoretical use by extracting the total number of gap
days from the total time interval between the first event and the end of the
observation window, accounting for carry over for all medication events
within the observation window.
Thus, it accounts for timing within the observation window, and excludes the
remaining supply at the end of the observation window.
</p>
<p>The formula is
</p>
<p style="text-align: center;"><code class="reqn">(number of days of theoretical use) / (first event to end of
observation window)</code>
</p>

<p>Observations:
</p>

<ul>
<li><p> the <code>carry.only.for.same.medication</code> parameter controls the
transmission of carry-over across medication changes, producing a
&quot;standard&quot; <code>CMA6</code> (default value is FALSE), and an &quot;alternative&quot;
<code>CMA6b</code>, respectively;
</p>
</li>
<li><p> the <code>consider.dosage.change</code> parameter controls if dosage changes
are taken into account, i.e. if set as TRUE and a new medication event has
a different daily dosage recommendation, carry-over is recomputed assuming
medication use according to the new prescribed dosage (default value is FALSE).
</p>
</li></ul>



<h3>Value</h3>

<p>An <code>S3</code> object of class <code>CMA6</code> (derived from <code>CMA0</code>)
with the following fields:
</p>

<ul>
<li> <p><code>data</code> The actual event data, as given by the <code>data</code>
parameter.
</p>
</li>
<li> <p><code>ID.colname</code> the name of the column in <code>data</code> containing the
unique patient ID, as given by the <code>ID.colname</code> parameter.
</p>
</li>
<li> <p><code>event.date.colname</code> the name of the column in <code>data</code>
containing the start date of the event (in the format given in the
<code>date.format</code> parameter), as given by the <code>event.date.colname</code>
parameter.
</p>
</li>
<li> <p><code>event.duration.colname</code> the name of the column in <code>data</code>
containing the event duration (in days), as given by the
<code>event.duration.colname</code> parameter.
</p>
</li>
<li> <p><code>event.daily.dose.colname</code> the name of the column in <code>data</code>
containing the prescribed daily dose, as given by the
<code>event.daily.dose.colname</code> parameter.
</p>
</li>
<li> <p><code>medication.class.colname</code> the name of the column in <code>data</code>
containing the classes/types/groups of medication, as given by the
<code>medication.class.colname</code> parameter.
</p>
</li>
<li> <p><code>carry.only.for.same.medication</code> whether the carry-over applies
only across medication of the same type, as given by the
<code>carry.only.for.same.medication</code> parameter.
</p>
</li>
<li> <p><code>consider.dosage.change</code> whether the carry-over is adjusted to
reflect changes in dosage, as given by the <code>consider.dosage.change</code>
parameter.
</p>
</li>
<li> <p><code>followup.window.start</code> the beginning of the follow-up window, as
given by the <code>followup.window.start</code> parameter.
</p>
</li>
<li> <p><code>followup.window.start.unit</code> the time unit of the
<code>followup.window.start</code>, as given by the
<code>followup.window.start.unit</code> parameter.
</p>
</li>
<li> <p><code>followup.window.duration</code> the duration of the follow-up window,
as given by the <code>followup.window.duration</code> parameter.
</p>
</li>
<li> <p><code>followup.window.duration.unit</code> the time unit of the
<code>followup.window.duration</code>, as given by the
<code>followup.window.duration.unit</code> parameter.
</p>
</li>
<li> <p><code>observation.window.start</code> the beginning of the observation
window, as given by the <code>observation.window.start</code> parameter.
</p>
</li>
<li> <p><code>observation.window.start.unit</code> the time unit of the
<code>observation.window.start</code>, as given by the
<code>observation.window.start.unit</code> parameter.
</p>
</li>
<li> <p><code>observation.window.duration</code> the duration of the observation
window, as given by the <code>observation.window.duration</code> parameter.
</p>
</li>
<li> <p><code>observation.window.duration.unit</code> the time unit of the
<code>observation.window.duration</code>, as given by the
<code>observation.window.duration.unit</code> parameter.
</p>
</li>
<li> <p><code>date.format</code> the format of the dates, as given by the
<code>date.format</code> parameter.
</p>
</li>
<li> <p><code>summary</code> the metadata, as given by the <code>summary</code> parameter.
</p>
</li>
<li> <p><code>event.info</code> the <code>data.frame</code> containing the event info
(irrelevant for most users; see <code><a href="#topic+compute.event.int.gaps">compute.event.int.gaps</a></code> for
details).
</p>
</li>
<li> <p><code>CMA</code> the <code>data.frame</code> containing the actual <code>CMA</code>
estimates for each participant (the <code>ID.colname</code> column).
</p>
</li></ul>

<p>Please note that if <code>medication.groups</code> are defined, then the <code>CMA</code>
and <code>event.info</code> are named lists, each element containing the CMA and
event.info corresponding to a single medication group (the element's name).
</p>


<h3>See Also</h3>

<p>CMAs 1 to 8 are defined in:
</p>
<p>Vollmer, W. M., Xu, M., Feldstein, A., Smith, D., Waterbury, A., &amp; Rand, C.
(2012). Comparison of pharmacy-based measures of medication adherence.
<em>BMC Health Services Research</em>, <strong>12</strong>, 155.
doi: <a href="https://doi.org/10.1186/1472-6963-12-155">10.1186/1472-6963-12-155</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cma6 &lt;- CMA6(data=med.events,
             ID.colname="PATIENT_ID",
             event.date.colname="DATE",
             event.duration.colname="DURATION",
             event.daily.dose.colname="PERDAY",
             medication.class.colname="CATEGORY",
             carry.only.for.same.medication=FALSE,
             consider.dosage.change=FALSE,
             followup.window.start=30,
             observation.window.start=30,
             observation.window.duration=365,
             date.format="%m/%d/%Y"
            );
</code></pre>

<hr>
<h2 id='CMA7'>CMA7 constructor.</h2><span id='topic+CMA7'></span>

<h3>Description</h3>

<p>Constructs a CMA (continuous multiple-interval measures of medication
availability/gaps) type 7 object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CMA7(
  data = NULL,
  ID.colname = NA,
  event.date.colname = NA,
  event.duration.colname = NA,
  event.daily.dose.colname = NA,
  medication.class.colname = NA,
  medication.groups = NULL,
  flatten.medication.groups = FALSE,
  medication.groups.colname = ".MED_GROUP_ID",
  carry.only.for.same.medication = FALSE,
  consider.dosage.change = FALSE,
  followup.window.start = 0,
  followup.window.start.unit = c("days", "weeks", "months", "years")[1],
  followup.window.start.per.medication.group = FALSE,
  followup.window.duration = 365 * 2,
  followup.window.duration.unit = c("days", "weeks", "months", "years")[1],
  observation.window.start = 0,
  observation.window.start.unit = c("days", "weeks", "months", "years")[1],
  observation.window.duration = 365 * 2,
  observation.window.duration.unit = c("days", "weeks", "months", "years")[1],
  date.format = "%m/%d/%Y",
  summary = NA,
  event.interval.colname = "event.interval",
  gap.days.colname = "gap.days",
  force.NA.CMA.for.failed.patients = TRUE,
  parallel.backend = c("none", "multicore", "snow", "snow(SOCK)", "snow(MPI)",
    "snow(NWS)")[1],
  parallel.threads = "auto",
  suppress.warnings = FALSE,
  suppress.special.argument.checks = TRUE,
  arguments.that.should.not.be.defined = c(carryover.within.obs.window = TRUE,
    carryover.into.obs.window = TRUE),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CMA7_+3A_data">data</code></td>
<td>
<p>A <em><code>data.frame</code></em> containing the events used to compute
the CMA. Must contain, at a minimum, the patient unique ID, the event date
and duration, and might also contain the daily dosage and medication type
(the actual column names are defined in the following four parameters).</p>
</td></tr>
<tr><td><code id="CMA7_+3A_id.colname">ID.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in <code>data</code>
containing the unique patient ID; must be present.</p>
</td></tr>
<tr><td><code id="CMA7_+3A_event.date.colname">event.date.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the start date of the event (in the format given in
the <code>date.format</code> parameter); must be present.</p>
</td></tr>
<tr><td><code id="CMA7_+3A_event.duration.colname">event.duration.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the event duration (in days); must be present.</p>
</td></tr>
<tr><td><code id="CMA7_+3A_event.daily.dose.colname">event.daily.dose.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the prescribed daily dose, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA7_+3A_medication.class.colname">medication.class.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the medication type, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA7_+3A_medication.groups">medication.groups</code></td>
<td>
<p>A <em>vector</em> of characters defining medication
groups or the name of a column in <code>data</code> that defines such groups.
The names of the vector are the medication group unique names, while
the content defines them as logical expressions. While the names can be any
string of characters except &quot;}&quot;, it is recommended to stick to the rules for
defining vector names in <code>R</code>. For example,
<code>c("A"="CATEGORY == 'medA'", "AA"="{A} &amp; PERDAY &lt; 4"</code> defines two
medication groups: <em>A</em> which selects all events of type &quot;medA&quot;, and
<em>B</em> which selects all events already defined by &quot;A&quot; but with a daily
dose lower than 4. If <code>NULL</code>, no medication groups are defined. If
medication groups are defined, there is one CMA estimate for each group;
moreover, there is a special group <em>__ALL_OTHERS__</em> automatically defined
containing all observations <em>not</em> covered by any of the explicitly defined
groups.</p>
</td></tr>
<tr><td><code id="CMA7_+3A_flatten.medication.groups">flatten.medication.groups</code></td>
<td>
<p><em>Logical</em>, if <code>FALSE</code> (the default)
then the <code>CMA</code> and <code>event.info</code> components of the object are lists
with one medication group per element; otherwise, they are <code>data.frame</code>s
with an extra column containing the medication group (its name is given by
<code>medication.groups.colname</code>).</p>
</td></tr>
<tr><td><code id="CMA7_+3A_medication.groups.colname">medication.groups.colname</code></td>
<td>
<p>a <em>string</em> (defaults to &quot;.MED_GROUP_ID&quot;)
giving the name of the column storing the group name when
<code>flatten.medication.groups</code> is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="CMA7_+3A_carry.only.for.same.medication">carry.only.for.same.medication</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code>, the
carry-over applies only across medication of the same type.</p>
</td></tr>
<tr><td><code id="CMA7_+3A_consider.dosage.change">consider.dosage.change</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code>, the carry-over
is adjusted to also reflect changes in dosage.</p>
</td></tr>
<tr><td><code id="CMA7_+3A_followup.window.start">followup.window.start</code></td>
<td>
<p>If a <em><code>Date</code></em> object, it represents
the actual start date of the follow-up window; if a <em>string</em> it is the
name of the column in <code>data</code> containing the start date of the follow-up
window either as the numbers of <code>followup.window.start.unit</code> units after
the first event (the column must be of type <code>numeric</code>) or as actual
dates (in which case the column must be of type <code>Date</code> or a string
that conforms to the format specified in <code>date.format</code>); if a
<em>number</em> it is the number of time units defined in the
<code>followup.window.start.unit</code> parameter after the begin of the
participant's first event; or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA7_+3A_followup.window.start.unit">followup.window.start.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.start</code> refers to (when a number), or
<code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA7_+3A_followup.window.start.per.medication.group">followup.window.start.per.medication.group</code></td>
<td>
<p>a <em>logical</em>: if there are
medication groups defined and this is <code>TRUE</code>, then the first event
considered for the follow-up window start is relative to each medication group
separately, otherwise (the default) it is relative to the patient.</p>
</td></tr>
<tr><td><code id="CMA7_+3A_followup.window.duration">followup.window.duration</code></td>
<td>
<p>either a <em>number</em> representing the
duration of the follow-up window in the time units given in
<code>followup.window.duration.unit</code>, or a <em>string</em> giving the column
containing these numbers. Should represent a period for which relevant
medication events are recorded accurately (e.g. not extend after end of
relevant treatment, loss-to-follow-up or change to a health care provider not
covered by the database).</p>
</td></tr>
<tr><td><code id="CMA7_+3A_followup.window.duration.unit">followup.window.duration.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.duration</code> refers to, or <code>NA</code> if not
defined.</p>
</td></tr>
<tr><td><code id="CMA7_+3A_observation.window.start">observation.window.start</code>, <code id="CMA7_+3A_observation.window.start.unit">observation.window.start.unit</code>, <code id="CMA7_+3A_observation.window.duration">observation.window.duration</code>, <code id="CMA7_+3A_observation.window.duration.unit">observation.window.duration.unit</code></td>
<td>
<p>the definition of the observation window
(see the follow-up window parameters above for details).</p>
</td></tr>
<tr><td><code id="CMA7_+3A_date.format">date.format</code></td>
<td>
<p>A <em>string</em> giving the format of the dates used in the
<code>data</code> and the other parameters; see the <code>format</code> parameters of the
<code><a href="base.html#topic+as.Date">as.Date</a></code> function for details (NB, this concerns only the
dates given as strings and not as <code>Date</code> objects).</p>
</td></tr>
<tr><td><code id="CMA7_+3A_summary">summary</code></td>
<td>
<p>Metadata as a <em>string</em>, briefly describing this CMA.</p>
</td></tr>
<tr><td><code id="CMA7_+3A_event.interval.colname">event.interval.colname</code></td>
<td>
<p>A <em>string</em>, the name of a newly-created
column storing the number of days between the start of the current event and
the start of the next one; the default value &quot;event.interval&quot; should be
changed only if there is a naming conflict with a pre-existing
&quot;event.interval&quot; column in <code>event.info</code>.</p>
</td></tr>
<tr><td><code id="CMA7_+3A_gap.days.colname">gap.days.colname</code></td>
<td>
<p>A <em>string</em>, the name of a newly-created column
storing the number of days when medication was not available (i.e., the
&quot;gap days&quot;); the default value &quot;gap.days&quot; should be changed only if there is
a naming conflict with a pre-existing &quot;gap.days&quot; column in <code>event.info</code>.</p>
</td></tr>
<tr><td><code id="CMA7_+3A_force.na.cma.for.failed.patients">force.NA.CMA.for.failed.patients</code></td>
<td>
<p><em>Logical</em> describing how the
patients for which the CMA estimation fails are treated: if <code>TRUE</code>
they are returned with an <code>NA</code> CMA estimate, while for
<code>FALSE</code> they are omitted.</p>
</td></tr>
<tr><td><code id="CMA7_+3A_parallel.backend">parallel.backend</code></td>
<td>
<p>Can be &quot;none&quot; (the default) for single-threaded
execution, &quot;multicore&quot;  (using <code>mclapply</code> in package <code>parallel</code>)
for multicore processing (NB. not currently implemented on MS Windows and
automatically falls back on &quot;snow&quot; on this platform),  or &quot;snow&quot;,
&quot;snow(SOCK)&quot; (equivalent to &quot;snow&quot;), &quot;snow(MPI)&quot; or &quot;snow(NWS)&quot; specifying
various types of SNOW clusters (can be on the local machine or more complex
setups &ndash; please see the documentation of package <code>snow</code> for details;
the last two require packages <code>Rmpi</code> and <code>nws</code>, respectively, not
automatically installed with <code>AdhereR</code>).</p>
</td></tr>
<tr><td><code id="CMA7_+3A_parallel.threads">parallel.threads</code></td>
<td>
<p>Can be &quot;auto&quot; (for <code>parallel.backend</code> ==
&quot;multicore&quot;, defaults to the number of cores in the system as given by
<code>options("cores")</code>, while for <code>parallel.backend</code> == &quot;snow&quot;,
defaults to 2), a strictly positive integer specifying the number of parallel
threads, or a more complex specification of the SNOW cluster nodes for
<code>parallel.backend</code> == &quot;snow&quot; (see the documentation of package
<code>snow</code> for details).</p>
</td></tr>
<tr><td><code id="CMA7_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any
warnings.</p>
</td></tr>
<tr><td><code id="CMA7_+3A_suppress.special.argument.checks">suppress.special.argument.checks</code></td>
<td>
<p><em>Logical</em> parameter for internal
use; if <code>FALSE</code> (default) check if the important columns in the <code>data</code>
have some of the reserved names, if <code>TRUE</code> this check is not performed.</p>
</td></tr>
<tr><td><code id="CMA7_+3A_arguments.that.should.not.be.defined">arguments.that.should.not.be.defined</code></td>
<td>
<p>a <em>list</em> of argument names
and pre-defined valuesfor which a warning should be thrown if passed to the
function.</p>
</td></tr>
<tr><td><code id="CMA7_+3A_...">...</code></td>
<td>
<p>other possible parameters</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>CMA7</code> assumes that, within and before the observation window, the
medication is used as prescribed and new medication is &quot;banked&quot; until needed
(oversupply from previous events is used first, followed new medication
supply).
It computes days of theoretical use by extracting the total number of gap
days from the total time interval between the start and the end of the
observation window, accounting for carry over for all medication events
within and before the observation window. All medication events in the
follow up window before observation window are considered for carry-over
calculation.
Thus, it accounts for timing within and before the observation window, and
excludes the remaining supply at the end of the observation window.
</p>
<p>The formula is
</p>
<p style="text-align: center;"><code class="reqn">(number of days of theoretical use) / (start to end of observation
 window)</code>
</p>

<p>Observations:
</p>

<ul>
<li><p> the <code>carry.only.for.same.medication</code> parameter controls the
transmission of carry-over across medication changes, producing a &quot;standard&quot;
<code>CMA7</code> (default value is FALSE), and an &quot;alternative&quot; <code>CMA7b</code>,
respectively;
</p>
</li>
<li><p> the <code>consider.dosage.change</code> parameter controls if dosage
changes are taken into account, i.e. if set as TRUE and a new medication
event has a different daily dosage recommendation, carry-over is recomputed
assuming medication use according to the new prescribed dosage (default
value is FALSE).
</p>
</li></ul>



<h3>Value</h3>

<p>An <code>S3</code> object of class <code>CMA7</code> (derived from <code>CMA0</code>)
with the following fields:
</p>

<ul>
<li> <p><code>data</code> The actual event data, as given by the <code>data</code>
parameter.
</p>
</li>
<li> <p><code>ID.colname</code> the name of the column in <code>data</code> containing the
unique patient ID, as given by the <code>ID.colname</code> parameter.
</p>
</li>
<li> <p><code>event.date.colname</code> the name of the column in <code>data</code>
containing the start date of the event (in the format given in the
<code>date.format</code> parameter), as given by the <code>event.date.colname</code>
parameter.
</p>
</li>
<li> <p><code>event.duration.colname</code> the name of the column in <code>data</code>
containing the event duration (in days), as given by the
<code>event.duration.colname</code> parameter.
</p>
</li>
<li> <p><code>event.daily.dose.colname</code> the name of the column in <code>data</code>
containing the prescribed daily dose, as given by the
<code>event.daily.dose.colname</code> parameter.
</p>
</li>
<li> <p><code>medication.class.colname</code> the name of the column in <code>data</code>
containing the classes/types/groups of medication, as given by the
<code>medication.class.colname</code> parameter.
</p>
</li>
<li> <p><code>carry.only.for.same.medication</code> whether the carry-over applies
only across medication of the same type, as given by the
<code>carry.only.for.same.medication</code> parameter.
</p>
</li>
<li> <p><code>consider.dosage.change</code> whether the carry-over is adjusted to
reflect changes in dosage, as given by the <code>consider.dosage.change</code>
parameter.
</p>
</li>
<li> <p><code>followup.window.start</code> the beginning of the follow-up window,
as given by the <code>followup.window.start</code> parameter.
</p>
</li>
<li> <p><code>followup.window.start.unit</code> the time unit of the
<code>followup.window.start</code>, as given by the
<code>followup.window.start.unit</code> parameter.
</p>
</li>
<li> <p><code>followup.window.duration</code> the duration of the follow-up window,
as given by the <code>followup.window.duration</code> parameter.
</p>
</li>
<li> <p><code>followup.window.duration.unit</code> the time unit of the
<code>followup.window.duration</code>, as given by the
<code>followup.window.duration.unit</code> parameter.
</p>
</li>
<li> <p><code>observation.window.start</code> the beginning of the observation
window, as given by the <code>observation.window.start</code> parameter.
</p>
</li>
<li> <p><code>observation.window.start.unit</code> the time unit of the
<code>observation.window.start</code>, as given by the
<code>observation.window.start.unit</code> parameter.
</p>
</li>
<li> <p><code>observation.window.duration</code> the duration of the observation
window, as given by the <code>observation.window.duration</code> parameter.
</p>
</li>
<li> <p><code>observation.window.duration.unit</code> the time unit of the
<code>observation.window.duration</code>, as given by the
<code>observation.window.duration.unit</code> parameter.
</p>
</li>
<li> <p><code>date.format</code> the format of the dates, as given by the
<code>date.format</code> parameter.
</p>
</li>
<li> <p><code>summary</code> the metadata, as given by the <code>summary</code> parameter.
</p>
</li>
<li> <p><code>event.info</code> the <code>data.frame</code> containing the event info
(irrelevant for most users; see <code><a href="#topic+compute.event.int.gaps">compute.event.int.gaps</a></code> for
details).
</p>
</li>
<li> <p><code>CMA</code> the <code>data.frame</code> containing the actual <code>CMA</code>
estimates for each participant (the <code>ID.colname</code> column).
</p>
</li></ul>

<p>Please note that if <code>medication.groups</code> are defined, then the <code>CMA</code>
and <code>event.info</code> are named lists, each element containing the CMA and
event.info corresponding to a single medication group (the element's name).
</p>


<h3>See Also</h3>

<p>CMAs 1 to 8 are defined in:
</p>
<p>Vollmer, W. M., Xu, M., Feldstein, A., Smith, D., Waterbury, A., &amp; Rand, C.
(2012). Comparison of pharmacy-based measures of medication adherence.
<em>BMC Health Services Research</em>, <strong>12</strong>, 155.
doi: <a href="https://doi.org/10.1186/1472-6963-12-155">10.1186/1472-6963-12-155</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cma7 &lt;- CMA7(data=med.events,
             ID.colname="PATIENT_ID",
             event.date.colname="DATE",
             event.duration.colname="DURATION",
             event.daily.dose.colname="PERDAY",
             medication.class.colname="CATEGORY",
             carry.only.for.same.medication=FALSE,
             consider.dosage.change=FALSE,
             followup.window.start=30,
             observation.window.start=30,
             observation.window.duration=365,
             date.format="%m/%d/%Y"
            );
</code></pre>

<hr>
<h2 id='CMA8'>CMA8 constructor.</h2><span id='topic+CMA8'></span>

<h3>Description</h3>

<p>Constructs a CMA (continuous multiple-interval measures of medication
availability/gaps) type 8 object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CMA8(
  data = NULL,
  ID.colname = NA,
  event.date.colname = NA,
  event.duration.colname = NA,
  event.daily.dose.colname = NA,
  medication.class.colname = NA,
  medication.groups = NULL,
  flatten.medication.groups = FALSE,
  medication.groups.colname = ".MED_GROUP_ID",
  carry.only.for.same.medication = FALSE,
  consider.dosage.change = FALSE,
  followup.window.start = 0,
  followup.window.start.unit = c("days", "weeks", "months", "years")[1],
  followup.window.start.per.medication.group = FALSE,
  followup.window.duration = 365 * 2,
  followup.window.duration.unit = c("days", "weeks", "months", "years")[1],
  observation.window.start = 0,
  observation.window.start.unit = c("days", "weeks", "months", "years")[1],
  observation.window.duration = 365 * 2,
  observation.window.duration.unit = c("days", "weeks", "months", "years")[1],
  date.format = "%m/%d/%Y",
  summary = NA,
  event.interval.colname = "event.interval",
  gap.days.colname = "gap.days",
  force.NA.CMA.for.failed.patients = TRUE,
  parallel.backend = c("none", "multicore", "snow", "snow(SOCK)", "snow(MPI)",
    "snow(NWS)")[1],
  parallel.threads = "auto",
  suppress.warnings = FALSE,
  suppress.special.argument.checks = TRUE,
  arguments.that.should.not.be.defined = c(carryover.within.obs.window = TRUE,
    carryover.into.obs.window = TRUE),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CMA8_+3A_data">data</code></td>
<td>
<p>A <em><code>data.frame</code></em> containing the events used to compute
the CMA. Must contain, at a minimum, the patient unique ID, the event date
and duration, and might also contain the daily dosage and medication type
(the actual column names are defined in the following four parameters).</p>
</td></tr>
<tr><td><code id="CMA8_+3A_id.colname">ID.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in <code>data</code>
containing the unique patient ID; must be present.</p>
</td></tr>
<tr><td><code id="CMA8_+3A_event.date.colname">event.date.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the start date of the event (in the format given in
the <code>date.format</code> parameter); must be present.</p>
</td></tr>
<tr><td><code id="CMA8_+3A_event.duration.colname">event.duration.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the event duration (in days); must be present.</p>
</td></tr>
<tr><td><code id="CMA8_+3A_event.daily.dose.colname">event.daily.dose.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the prescribed daily dose, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA8_+3A_medication.class.colname">medication.class.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the medication type, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA8_+3A_medication.groups">medication.groups</code></td>
<td>
<p>A <em>vector</em> of characters defining medication
groups or the name of a column in <code>data</code> that defines such groups.
The names of the vector are the medication group unique names, while
the content defines them as logical expressions. While the names can be any
string of characters except &quot;}&quot;, it is recommended to stick to the rules for
defining vector names in <code>R</code>. For example,
<code>c("A"="CATEGORY == 'medA'", "AA"="{A} &amp; PERDAY &lt; 4"</code> defines two
medication groups: <em>A</em> which selects all events of type &quot;medA&quot;, and
<em>B</em> which selects all events already defined by &quot;A&quot; but with a daily
dose lower than 4. If <code>NULL</code>, no medication groups are defined. If
medication groups are defined, there is one CMA estimate for each group;
moreover, there is a special group <em>__ALL_OTHERS__</em> automatically defined
containing all observations <em>not</em> covered by any of the explicitly defined
groups.</p>
</td></tr>
<tr><td><code id="CMA8_+3A_flatten.medication.groups">flatten.medication.groups</code></td>
<td>
<p><em>Logical</em>, if <code>FALSE</code> (the default)
then the <code>CMA</code> and <code>event.info</code> components of the object are lists
with one medication group per element; otherwise, they are <code>data.frame</code>s
with an extra column containing the medication group (its name is given by
<code>medication.groups.colname</code>).</p>
</td></tr>
<tr><td><code id="CMA8_+3A_medication.groups.colname">medication.groups.colname</code></td>
<td>
<p>a <em>string</em> (defaults to &quot;.MED_GROUP_ID&quot;)
giving the name of the column storing the group name when
<code>flatten.medication.groups</code> is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="CMA8_+3A_carry.only.for.same.medication">carry.only.for.same.medication</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code>, the
carry-over applies only across medication of the same type.</p>
</td></tr>
<tr><td><code id="CMA8_+3A_consider.dosage.change">consider.dosage.change</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code>, the carry-over
is adjusted to also reflect changes in dosage.</p>
</td></tr>
<tr><td><code id="CMA8_+3A_followup.window.start">followup.window.start</code></td>
<td>
<p>If a <em><code>Date</code></em> object, it represents
the actual start date of the follow-up window; if a <em>string</em> it is the
name of the column in <code>data</code> containing the start date of the follow-up
window either as the numbers of <code>followup.window.start.unit</code> units after
the first event (the column must be of type <code>numeric</code>) or as actual
dates (in which case the column must be of type <code>Date</code> or a string
that conforms to the format specified in <code>date.format</code>); if a
<em>number</em> it is the number of time units defined in the
<code>followup.window.start.unit</code> parameter after the begin of the
participant's first event; or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA8_+3A_followup.window.start.unit">followup.window.start.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.start</code> refers to (when a number), or
<code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA8_+3A_followup.window.start.per.medication.group">followup.window.start.per.medication.group</code></td>
<td>
<p>a <em>logical</em>: if there are
medication groups defined and this is <code>TRUE</code>, then the first event
considered for the follow-up window start is relative to each medication group
separately, otherwise (the default) it is relative to the patient.</p>
</td></tr>
<tr><td><code id="CMA8_+3A_followup.window.duration">followup.window.duration</code></td>
<td>
<p>either a <em>number</em> representing the
duration of the follow-up window in the time units given in
<code>followup.window.duration.unit</code>, or a <em>string</em> giving the column
containing these numbers. Should represent a period for which relevant
medication events are recorded accurately (e.g. not extend after end of
relevant treatment, loss-to-follow-up or change to a health care provider
not covered by the database).</p>
</td></tr>
<tr><td><code id="CMA8_+3A_followup.window.duration.unit">followup.window.duration.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.duration</code> refers to, or <code>NA</code> if not
defined.</p>
</td></tr>
<tr><td><code id="CMA8_+3A_observation.window.start">observation.window.start</code>, <code id="CMA8_+3A_observation.window.start.unit">observation.window.start.unit</code>, <code id="CMA8_+3A_observation.window.duration">observation.window.duration</code>, <code id="CMA8_+3A_observation.window.duration.unit">observation.window.duration.unit</code></td>
<td>
<p>the definition of the observation window
(see the follow-up window parameters above for details).</p>
</td></tr>
<tr><td><code id="CMA8_+3A_date.format">date.format</code></td>
<td>
<p>A <em>string</em> giving the format of the dates used in the
<code>data</code> and the other parameters; see the <code>format</code> parameters of the
<code><a href="base.html#topic+as.Date">as.Date</a></code> function for details (NB, this concerns only the
dates given as strings and not as <code>Date</code> objects).</p>
</td></tr>
<tr><td><code id="CMA8_+3A_summary">summary</code></td>
<td>
<p>Metadata as a <em>string</em>, briefly describing this CMA.</p>
</td></tr>
<tr><td><code id="CMA8_+3A_event.interval.colname">event.interval.colname</code></td>
<td>
<p>A <em>string</em>, the name of a newly-created
column storing the number of days between the start of the current event and
the start of the next one; the default value &quot;event.interval&quot; should be
changed only if there is a naming conflict with a pre-existing
&quot;event.interval&quot; column in <code>event.info</code>.</p>
</td></tr>
<tr><td><code id="CMA8_+3A_gap.days.colname">gap.days.colname</code></td>
<td>
<p>A <em>string</em>, the name of a newly-created column
storing the number of days when medication was not available (i.e., the
&quot;gap days&quot;); the default value &quot;gap.days&quot; should be changed only if there is
a naming conflict with a pre-existing &quot;gap.days&quot; column in <code>event.info</code>.</p>
</td></tr>
<tr><td><code id="CMA8_+3A_force.na.cma.for.failed.patients">force.NA.CMA.for.failed.patients</code></td>
<td>
<p><em>Logical</em> describing how the
patients for which the CMA estimation fails are treated: if <code>TRUE</code>
they are returned with an <code>NA</code> CMA estimate, while for
<code>FALSE</code> they are omitted.</p>
</td></tr>
<tr><td><code id="CMA8_+3A_parallel.backend">parallel.backend</code></td>
<td>
<p>Can be &quot;none&quot; (the default) for single-threaded
execution, &quot;multicore&quot;  (using <code>mclapply</code> in package <code>parallel</code>)
for multicore processing (NB. not currently implemented on MS Windows and
automatically falls back on &quot;snow&quot; on this platform),  or &quot;snow&quot;,
&quot;snow(SOCK)&quot; (equivalent to &quot;snow&quot;), &quot;snow(MPI)&quot; or &quot;snow(NWS)&quot; specifying
various types of SNOW clusters (can be on the local machine or more complex
setups &ndash; please see the documentation of package <code>snow</code> for details;
the last two require packages <code>Rmpi</code> and <code>nws</code>, respectively, not
automatically installed with <code>AdhereR</code>).</p>
</td></tr>
<tr><td><code id="CMA8_+3A_parallel.threads">parallel.threads</code></td>
<td>
<p>Can be &quot;auto&quot; (for <code>parallel.backend</code> ==
&quot;multicore&quot;, defaults to the number of cores in the system as given by
<code>options("cores")</code>, while for <code>parallel.backend</code> == &quot;snow&quot;,
defaults to 2), a strictly positive integer specifying the number of parallel
threads, or a more complex specification of the SNOW cluster nodes for
<code>parallel.backend</code> == &quot;snow&quot; (see the documentation of package
<code>snow</code> for details).</p>
</td></tr>
<tr><td><code id="CMA8_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any
warnings.</p>
</td></tr>
<tr><td><code id="CMA8_+3A_suppress.special.argument.checks">suppress.special.argument.checks</code></td>
<td>
<p><em>Logical</em> parameter for internal
use; if <code>FALSE</code> (default) check if the important columns in the <code>data</code>
have some of the reserved names, if <code>TRUE</code> this check is not performed.</p>
</td></tr>
<tr><td><code id="CMA8_+3A_arguments.that.should.not.be.defined">arguments.that.should.not.be.defined</code></td>
<td>
<p>a <em>list</em> of argument names
and pre-defined valuesfor which a warning should be thrown if passed to the
function.</p>
</td></tr>
<tr><td><code id="CMA8_+3A_...">...</code></td>
<td>
<p>other possible parameters</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>CMA8</code> is similar to CMA6 in that it assumes that, within the
observation window, the medication is used as prescribed and new medication
is &quot;banked&quot; until needed (oversupply from previous events is used first,
followed new medication supply). Unlike <code>CMA6</code> it accounts for
carry-over from before the window - but in a different way from <code>CMA7</code>:
by adding a time lag at the start of the observation window equal to the
duration of carry-over from before. It is designed for situations when an
event with a hypothesized causal effect on adherence happens at the start of
the observation window (e.g. enrolment in an intervention study); in this
case, it may be that the existing supply is not part of the relationship
under study (e.g. it delays the actual start of the study for that
participant) and needs to be excluded by shortening the time interval
examined. The end of the observation window remains the same.
Thus, <code>CMA8</code> computes days of theoretical use by extracting the total
number of gap days from the total time interval between the lagged start and
the end of the observation window, accounting for carry over for all
medication events within the observation window. All medication events in the
follow up window before observation window are considered for carry-over
calculation.
Thus, as <code>CMA7</code>, it accounts for timing within the observation window,
as well as before (different adjustment than <code>CMA7</code>), and excludes the
remaining supply at the end of the observation window.
</p>
<p>The formula is
</p>
<p style="text-align: center;"><code class="reqn">(number of days of theoretical use) / (lagged start to end of
observation window)</code>
</p>

<p>Observations:
</p>

<ul>
<li><p> the <code>carry.only.for.same.medication</code> parameter controls the
transmission of carry-over across medication changes, producing a &quot;standard&quot;
<code>CMA8</code> (default value is FALSE), and an &quot;alternative&quot; <code>CMA8b</code>,
respectively;
</p>
</li>
<li><p> the <code>consider.dosage.change</code> parameter controls if dosage changes
are taken into account, i.e. if set as TRUE and a new medication event has
a different daily dosage recommendation, carry-over is recomputed assuming
medication use according to the new prescribed dosage (default value is
FALSE).
</p>
</li></ul>



<h3>Value</h3>

<p>An <code>S3</code> object of class <code>CMA8</code> (derived from <code>CMA0</code>)
with the following fields:
</p>

<ul>
<li> <p><code>data</code> The actual event data, as given by the <code>data</code>
parameter.
</p>
</li>
<li> <p><code>ID.colname</code> the name of the column in <code>data</code> containing the
unique patient ID, as given by the <code>ID.colname</code> parameter.
</p>
</li>
<li> <p><code>event.date.colname</code> the name of the column in <code>data</code>
containing the start date of the event (in the format given in the
<code>date.format</code> parameter), as given by the <code>event.date.colname</code>
parameter.
</p>
</li>
<li> <p><code>event.duration.colname</code> the name of the column in <code>data</code>
containing the event duration (in days), as given by the
<code>event.duration.colname</code> parameter.
</p>
</li>
<li> <p><code>event.daily.dose.colname</code> the name of the column in <code>data</code>
containing the prescribed daily dose, as given by the
<code>event.daily.dose.colname</code> parameter.
</p>
</li>
<li> <p><code>medication.class.colname</code> the name of the column in <code>data</code>
containing the classes/types/groups of medication, as given by the
<code>medication.class.colname</code> parameter.
</p>
</li>
<li> <p><code>carry.only.for.same.medication</code> whether the carry-over applies
only across medication of the same type, as given by the
<code>carry.only.for.same.medication</code> parameter.
</p>
</li>
<li> <p><code>consider.dosage.change</code> whether the carry-over is adjusted to
reflect changes in dosage, as given by the <code>consider.dosage.change</code>
parameter.
</p>
</li>
<li> <p><code>followup.window.start</code> the beginning of the follow-up window, as
given by the <code>followup.window.start</code> parameter.
</p>
</li>
<li> <p><code>followup.window.start.unit</code> the time unit of the
<code>followup.window.start</code>, as given by the
<code>followup.window.start.unit</code> parameter.
</p>
</li>
<li> <p><code>followup.window.duration</code> the duration of the follow-up window,
as given by the <code>followup.window.duration</code> parameter.
</p>
</li>
<li> <p><code>followup.window.duration.unit</code> the time unit of the
<code>followup.window.duration</code>, as given by the
<code>followup.window.duration.unit</code> parameter.
</p>
</li>
<li> <p><code>observation.window.start</code> the beginning of the observation
window, as given by the <code>observation.window.start</code> parameter.
</p>
</li>
<li> <p><code>observation.window.start.unit</code> the time unit of the
<code>observation.window.start</code>, as given by the
<code>observation.window.start.unit</code> parameter.
</p>
</li>
<li> <p><code>observation.window.duration</code> the duration of the observation
window, as given by the <code>observation.window.duration</code> parameter.
</p>
</li>
<li> <p><code>observation.window.duration.unit</code> the time unit of the
<code>observation.window.duration</code>, as given by the
<code>observation.window.duration.unit</code> parameter.
</p>
</li>
<li> <p><code>date.format</code> the format of the dates, as given by the
<code>date.format</code> parameter.
</p>
</li>
<li> <p><code>summary</code> the metadata, as given by the <code>summary</code> parameter.
</p>
</li>
<li> <p><code>event.info</code> the <code>data.frame</code> containing the event info
(irrelevant for most users; see <code><a href="#topic+compute.event.int.gaps">compute.event.int.gaps</a></code> for
details).
</p>
</li>
<li> <p><code>CMA</code> the <code>data.frame</code> containing the actual <code>CMA</code>
estimates for each participant (the <code>ID.colname</code> column).
</p>
</li></ul>

<p>Please note that if <code>medication.groups</code> are defined, then the <code>CMA</code>
and <code>event.info</code> are named lists, each element containing the CMA and
event.info corresponding to a single medication group (the element's name).
</p>


<h3>See Also</h3>

<p>CMAs 1 to 8 are defined in:
</p>
<p>Vollmer, W. M., Xu, M., Feldstein, A., Smith, D., Waterbury, A., &amp; Rand, C.
(2012). Comparison of pharmacy-based measures of medication adherence.
<em>BMC Health Services Research</em>, <strong>12</strong>, 155.
doi: <a href="https://doi.org/10.1186/1472-6963-12-155">10.1186/1472-6963-12-155</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cma8 &lt;- CMA8(data=med.events,
             ID.colname="PATIENT_ID",
             event.date.colname="DATE",
             event.duration.colname="DURATION",
             event.daily.dose.colname="PERDAY",
             medication.class.colname="CATEGORY",
             carry.only.for.same.medication=FALSE,
             consider.dosage.change=FALSE,
             followup.window.start=30,
             observation.window.start=30,
             observation.window.duration=365,
             date.format="%m/%d/%Y"
            );
</code></pre>

<hr>
<h2 id='CMA9'>CMA9 constructor.</h2><span id='topic+CMA9'></span>

<h3>Description</h3>

<p>Constructs a CMA (continuous multiple-interval measures of medication
availability/gaps) type 9 object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CMA9(
  data = NULL,
  ID.colname = NA,
  event.date.colname = NA,
  event.duration.colname = NA,
  event.daily.dose.colname = NA,
  medication.class.colname = NA,
  medication.groups = NULL,
  flatten.medication.groups = FALSE,
  medication.groups.colname = ".MED_GROUP_ID",
  carry.only.for.same.medication = FALSE,
  consider.dosage.change = FALSE,
  followup.window.start = 0,
  followup.window.start.unit = c("days", "weeks", "months", "years")[1],
  followup.window.start.per.medication.group = FALSE,
  followup.window.duration = 365 * 2,
  followup.window.duration.unit = c("days", "weeks", "months", "years")[1],
  observation.window.start = 0,
  observation.window.start.unit = c("days", "weeks", "months", "years")[1],
  observation.window.duration = 365 * 2,
  observation.window.duration.unit = c("days", "weeks", "months", "years")[1],
  date.format = "%m/%d/%Y",
  summary = NA,
  event.interval.colname = "event.interval",
  gap.days.colname = "gap.days",
  force.NA.CMA.for.failed.patients = TRUE,
  parallel.backend = c("none", "multicore", "snow", "snow(SOCK)", "snow(MPI)",
    "snow(NWS)")[1],
  parallel.threads = "auto",
  suppress.warnings = FALSE,
  suppress.special.argument.checks = TRUE,
  arguments.that.should.not.be.defined = c(carryover.within.obs.window = TRUE,
    carryover.into.obs.window = TRUE),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CMA9_+3A_data">data</code></td>
<td>
<p>A <em><code>data.frame</code></em> containing the events used to compute
the CMA. Must contain, at a minimum, the patient unique ID, the event date
and duration, and might also contain the daily dosage and medication type
(the actual column names are defined in the following four parameters).</p>
</td></tr>
<tr><td><code id="CMA9_+3A_id.colname">ID.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in <code>data</code>
containing the unique patient ID; must be present.</p>
</td></tr>
<tr><td><code id="CMA9_+3A_event.date.colname">event.date.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the start date of the event (in the format given in
the <code>date.format</code> parameter); must be present.</p>
</td></tr>
<tr><td><code id="CMA9_+3A_event.duration.colname">event.duration.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the event duration (in days); must be present.</p>
</td></tr>
<tr><td><code id="CMA9_+3A_event.daily.dose.colname">event.daily.dose.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the prescribed daily dose, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA9_+3A_medication.class.colname">medication.class.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the medication type, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA9_+3A_medication.groups">medication.groups</code></td>
<td>
<p>A <em>vector</em> of characters defining medication
groups or the name of a column in <code>data</code> that defines such groups.
The names of the vector are the medication group unique names, while
the content defines them as logical expressions. While the names can be any
string of characters except &quot;}&quot;, it is recommended to stick to the rules for
defining vector names in <code>R</code>. For example,
<code>c("A"="CATEGORY == 'medA'", "AA"="{A} &amp; PERDAY &lt; 4"</code> defines two
medication groups: <em>A</em> which selects all events of type &quot;medA&quot;, and
<em>B</em> which selects all events already defined by &quot;A&quot; but with a daily
dose lower than 4. If <code>NULL</code>, no medication groups are defined. If
medication groups are defined, there is one CMA estimate for each group;
moreover, there is a special group <em>__ALL_OTHERS__</em> automatically defined
containing all observations <em>not</em> covered by any of the explicitly defined
groups.</p>
</td></tr>
<tr><td><code id="CMA9_+3A_flatten.medication.groups">flatten.medication.groups</code></td>
<td>
<p><em>Logical</em>, if <code>FALSE</code> (the default)
then the <code>CMA</code> and <code>event.info</code> components of the object are lists
with one medication group per element; otherwise, they are <code>data.frame</code>s
with an extra column containing the medication group (its name is given by
<code>medication.groups.colname</code>).</p>
</td></tr>
<tr><td><code id="CMA9_+3A_medication.groups.colname">medication.groups.colname</code></td>
<td>
<p>a <em>string</em> (defaults to &quot;.MED_GROUP_ID&quot;)
giving the name of the column storing the group name when
<code>flatten.medication.groups</code> is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="CMA9_+3A_carry.only.for.same.medication">carry.only.for.same.medication</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code>, the
carry-over applies only across medication of the same type.</p>
</td></tr>
<tr><td><code id="CMA9_+3A_consider.dosage.change">consider.dosage.change</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code>, the carry-over
is adjusted to also reflect changes in dosage.</p>
</td></tr>
<tr><td><code id="CMA9_+3A_followup.window.start">followup.window.start</code></td>
<td>
<p>If a <em><code>Date</code></em> object, it represents
the actual start date of the follow-up window; if a <em>string</em> it is the
name of the column in <code>data</code> containing the start date of the follow-up
window either as the numbers of <code>followup.window.start.unit</code> units after
the first event (the column must be of type <code>numeric</code>) or as actual
dates (in which case the column must be of type <code>Date</code> or a string
that conforms to the format specified in <code>date.format</code>); if a
<em>number</em> it is the number of time units defined in the
<code>followup.window.start.unit</code> parameter after the begin of the
participant's first event; or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA9_+3A_followup.window.start.unit">followup.window.start.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.start</code> refers to (when a number), or
<code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="CMA9_+3A_followup.window.start.per.medication.group">followup.window.start.per.medication.group</code></td>
<td>
<p>a <em>logical</em>: if there are
medication groups defined and this is <code>TRUE</code>, then the first event
considered for the follow-up window start is relative to each medication group
separately, otherwise (the default) it is relative to the patient.</p>
</td></tr>
<tr><td><code id="CMA9_+3A_followup.window.duration">followup.window.duration</code></td>
<td>
<p>either a <em>number</em> representing the
duration of the follow-up window in the time units given in
<code>followup.window.duration.unit</code>, or a <em>string</em> giving the column
containing these numbers. Should represent a period for which relevant
medication events are recorded accurately (e.g. not extend after end of
relevant treatment, loss-to-follow-up or change to a health care provider not
covered by the database).</p>
</td></tr>
<tr><td><code id="CMA9_+3A_followup.window.duration.unit">followup.window.duration.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.duration</code> refers to, or <code>NA</code> if not
defined.</p>
</td></tr>
<tr><td><code id="CMA9_+3A_observation.window.start">observation.window.start</code>, <code id="CMA9_+3A_observation.window.start.unit">observation.window.start.unit</code>, <code id="CMA9_+3A_observation.window.duration">observation.window.duration</code>, <code id="CMA9_+3A_observation.window.duration.unit">observation.window.duration.unit</code></td>
<td>
<p>the definition of the observation window
(see the follow-up window parameters above for details).</p>
</td></tr>
<tr><td><code id="CMA9_+3A_date.format">date.format</code></td>
<td>
<p>A <em>string</em> giving the format of the dates used in the
<code>data</code> and the other parameters; see the <code>format</code> parameters of the
<code><a href="base.html#topic+as.Date">as.Date</a></code> function for details (NB, this concerns only the
dates given as strings and not as <code>Date</code> objects).</p>
</td></tr>
<tr><td><code id="CMA9_+3A_summary">summary</code></td>
<td>
<p>Metadata as a <em>string</em>, briefly describing this CMA.</p>
</td></tr>
<tr><td><code id="CMA9_+3A_event.interval.colname">event.interval.colname</code></td>
<td>
<p>A <em>string</em>, the name of a newly-created
column storing the number of days between the start of the current event and
the start of the next one; the default value &quot;event.interval&quot; should be
changed only if there is a naming conflict with a pre-existing
&quot;event.interval&quot; column in <code>event.info</code>.</p>
</td></tr>
<tr><td><code id="CMA9_+3A_gap.days.colname">gap.days.colname</code></td>
<td>
<p>A <em>string</em>, the name of a newly-created column
storing the number of days when medication was not available (i.e., the
&quot;gap days&quot;); the default value &quot;gap.days&quot; should be changed only if there is
a naming conflict with a pre-existing &quot;gap.days&quot; column in <code>event.info</code>.</p>
</td></tr>
<tr><td><code id="CMA9_+3A_force.na.cma.for.failed.patients">force.NA.CMA.for.failed.patients</code></td>
<td>
<p><em>Logical</em> describing how the
patients for which the CMA estimation fails are treated: if <code>TRUE</code>
they are returned with an <code>NA</code> CMA estimate, while for
<code>FALSE</code> they are omitted.</p>
</td></tr>
<tr><td><code id="CMA9_+3A_parallel.backend">parallel.backend</code></td>
<td>
<p>Can be &quot;none&quot; (the default) for single-threaded
execution, &quot;multicore&quot;  (using <code>mclapply</code> in package <code>parallel</code>)
for multicore processing (NB. not currently implemented on MS Windows and
automatically falls back on &quot;snow&quot; on this platform),  or &quot;snow&quot;,
&quot;snow(SOCK)&quot; (equivalent to &quot;snow&quot;), &quot;snow(MPI)&quot; or &quot;snow(NWS)&quot; specifying
various types of SNOW clusters (can be on the local machine or more complex
setups &ndash; please see the documentation of package <code>snow</code> for details;
the last two require packages <code>Rmpi</code> and <code>nws</code>, respectively, not
automatically installed with <code>AdhereR</code>).</p>
</td></tr>
<tr><td><code id="CMA9_+3A_parallel.threads">parallel.threads</code></td>
<td>
<p>Can be &quot;auto&quot; (for <code>parallel.backend</code> ==
&quot;multicore&quot;, defaults to the number of cores in the system as given by
<code>options("cores")</code>, while for <code>parallel.backend</code> == &quot;snow&quot;,
defaults to 2), a strictly positive integer specifying the number of parallel
threads, or a more complex specification of the SNOW cluster nodes for
<code>parallel.backend</code> == &quot;snow&quot; (see the documentation of package
<code>snow</code> for details).</p>
</td></tr>
<tr><td><code id="CMA9_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any
warnings.</p>
</td></tr>
<tr><td><code id="CMA9_+3A_suppress.special.argument.checks">suppress.special.argument.checks</code></td>
<td>
<p><em>Logical</em> parameter for internal
use; if <code>FALSE</code> (default) check if the important columns in the <code>data</code>
have some of the reserved names, if <code>TRUE</code> this check is not performed.</p>
</td></tr>
<tr><td><code id="CMA9_+3A_arguments.that.should.not.be.defined">arguments.that.should.not.be.defined</code></td>
<td>
<p>a <em>list</em> of argument names
and pre-defined valuesfor which a warning should be thrown if passed to the
function.</p>
</td></tr>
<tr><td><code id="CMA9_+3A_...">...</code></td>
<td>
<p>other possible parameters</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>CMA9</code> is similar to <code>CMA7</code> and <code>CMA8</code> in that it accounts for
carry-over within and before the observation window assuming that new
medication is &quot;banked&quot; until needed (oversupply from previous events is used
first, followed new medication supply). Yet, unlike these previous CMAs, it
does not assume the medication is used as prescribed; in longitudinal studies
with multiple CMA measures, this assumption may introduce additional
variation in CMA estimates depending on when the observation window starts
in relation to the previous medication event. A shorter time distance from
the previous event (and longer to the first event in the observation window)
results in higher values even if the number of gap days is the same, and it
may also be that the patient has had a similar use pattern for that time
interval, rather than perfect adherence followed by no medication use.
<code>CMA9</code> applies a different adjustment: it computes a ratio of days
supply over each interval between two prescriptions and considers this
applies for each day of that interval, up to 100% (moving oversupply to the
next event interval). All medication events in the follow up window before
observation window are considered for carry-over calculation. The last
interval ends at the end of the follow-up window.
Thus, it accounts for timing within  the observation window, as well as
before (but differently from <code>CMA7</code> and <code>CMA8</code>), and excludes the
remaining supply at the end of the observation window, if any.
</p>
<p>The formula is
</p>
<p style="text-align: center;"><code class="reqn">(number of days in the observation window, each weighted by the ratio
of days supply applicable to their event interval) / (start to end of
observation window)</code>
</p>

<p>Observations:
</p>

<ul>
<li><p> the <code>carry.only.for.same.medication</code> parameter controls the
transmission of carry-over across medication changes, producing a &quot;standard&quot;
<code>CMA7</code> (default value is FALSE), and an &quot;alternative&quot; <code>CMA7b</code>,
respectively;
</p>
</li>
<li><p> the <code>consider.dosage.change</code> parameter controls if dosage changes
are taken into account, i.e. if set as TRUE and a new medication event has a
different daily dosage recommendation, carry-over is recomputed assuming
medication use according to the new prescribed dosage (default value is
FALSE).
</p>
</li></ul>



<h3>Value</h3>

<p>An <code>S3</code> object of class <code>CMA9</code> (derived from <code>CMA0</code>)
with the following fields:
</p>

<ul>
<li> <p><code>data</code> The actual event data, as given by the <code>data</code>
parameter.
</p>
</li>
<li> <p><code>ID.colname</code> the name of the column in <code>data</code> containing the
unique patient ID, as given by the <code>ID.colname</code> parameter.
</p>
</li>
<li> <p><code>event.date.colname</code> the name of the column in <code>data</code>
containing the start date of the event (in the format given in the
<code>date.format</code> parameter), as given by the <code>event.date.colname</code>
parameter.
</p>
</li>
<li> <p><code>event.duration.colname</code> the name of the column in <code>data</code>
containing the event duration (in days), as given by the
<code>event.duration.colname</code> parameter.
</p>
</li>
<li> <p><code>event.daily.dose.colname</code> the name of the column in <code>data</code>
containing the prescribed daily dose, as given by the
<code>event.daily.dose.colname</code> parameter.
</p>
</li>
<li> <p><code>medication.class.colname</code> the name of the column in <code>data</code>
containing the classes/types/groups of medication, as given by the
<code>medication.class.colname</code> parameter.
</p>
</li>
<li> <p><code>carry.only.for.same.medication</code> whether the carry-over applies
only across medication of the same type, as given by the
<code>carry.only.for.same.medication</code> parameter.
</p>
</li>
<li> <p><code>consider.dosage.change</code> whether the carry-over is adjusted to
reflect changes in dosage, as given by the <code>consider.dosage.change</code>
parameter.
</p>
</li>
<li> <p><code>followup.window.start</code> the beginning of the follow-up window,
as given by the <code>followup.window.start</code> parameter.
</p>
</li>
<li> <p><code>followup.window.start.unit</code> the time unit of the
<code>followup.window.start</code>, as given by the
<code>followup.window.start.unit</code> parameter.
</p>
</li>
<li> <p><code>followup.window.duration</code> the duration of the follow-up window,
as given by the <code>followup.window.duration</code> parameter.
</p>
</li>
<li> <p><code>followup.window.duration.unit</code> the time unit of the
<code>followup.window.duration</code>, as given by the
<code>followup.window.duration.unit</code> parameter.
</p>
</li>
<li> <p><code>observation.window.start</code> the beginning of the observation
window, as given by the <code>observation.window.start</code> parameter.
</p>
</li>
<li> <p><code>observation.window.start.unit</code> the time unit of the
<code>observation.window.start</code>, as given by the
<code>observation.window.start.unit</code> parameter.
</p>
</li>
<li> <p><code>observation.window.duration</code> the duration of the observation
window, as given by the <code>observation.window.duration</code> parameter.
</p>
</li>
<li> <p><code>observation.window.duration.unit</code> the time unit of the
<code>observation.window.duration</code>, as given by the
<code>observation.window.duration.unit</code> parameter.
</p>
</li>
<li> <p><code>date.format</code> the format of the dates, as given by the
<code>date.format</code> parameter.
</p>
</li>
<li> <p><code>summary</code> the metadata, as given by the <code>summary</code> parameter.
</p>
</li>
<li> <p><code>event.info</code> the <code>data.frame</code> containing the event info
(irrelevant for most users; see <code><a href="#topic+compute.event.int.gaps">compute.event.int.gaps</a></code> for
details).
</p>
</li>
<li> <p><code>CMA</code> the <code>data.frame</code> containing the actual <code>CMA</code>
estimates for each participant (the <code>ID.colname</code> column).
</p>
</li></ul>

<p>Please note that if <code>medication.groups</code> are defined, then the <code>CMA</code>
and <code>event.info</code> are named lists, each element containing the CMA and
event.info corresponding to a single medication group (the element's name).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cma9 &lt;- CMA9(data=med.events,
             ID.colname="PATIENT_ID",
             event.date.colname="DATE",
             event.duration.colname="DURATION",
             event.daily.dose.colname="PERDAY",
             medication.class.colname="CATEGORY",
             carry.only.for.same.medication=FALSE,
             consider.dosage.change=FALSE,
             followup.window.start=30,
             observation.window.start=30,
             observation.window.duration=365,
             date.format="%m/%d/%Y"
            );
</code></pre>

<hr>
<h2 id='compute_event_durations'>Computation of event durations.</h2><span id='topic+compute_event_durations'></span>

<h3>Description</h3>

<p>Computes event durations based on dispensing, prescription, and other data (e.g.
hospitalization data) and returns a <code>data.frame</code> which can be used with the
CMA constructors in <code>AdhereR</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compute_event_durations(
  disp.data = NULL,
  presc.data = NULL,
  special.periods.data = NULL,
  ID.colname,
  medication.class.colnames,
  disp.date.colname,
  total.dose.colname,
  presc.date.colname,
  presc.daily.dose.colname,
  presc.duration.colname,
  visit.colname,
  split.on.dosage.change = TRUE,
  force.init.presc = FALSE,
  force.presc.renew = FALSE,
  trt.interruption = c("continue", "discard", "carryover")[1],
  special.periods.method = trt.interruption,
  carryover = FALSE,
  date.format = "%d.%m.%Y",
  suppress.warnings = FALSE,
  return.data.table = FALSE,
  progress.bar = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="compute_event_durations_+3A_disp.data">disp.data</code></td>
<td>
<p>A <em><code>data.frame</code></em> or <em><code>data.table</code></em> containing
the dispensing events. Must contain, at a minimum, the patient unique ID, one
medication identifier, the dispensing date, and total dispensed dose, and might
also contain additional columns to identify and group medications (the actual
column names are defined in the <em><code>medication.class.colnames</code></em> parameter).</p>
</td></tr>
<tr><td><code id="compute_event_durations_+3A_presc.data">presc.data</code></td>
<td>
<p>A <em><code>data.frame</code></em> containing the prescribing events.
Must contain, at a minimum, the same unique patient ID and medication identifier(s)
as the dispensing data, the prescription date, the daily prescribed dose, and the
prescription duration. Optionally, it might also contain a visit number.</p>
</td></tr>
<tr><td><code id="compute_event_durations_+3A_special.periods.data">special.periods.data</code></td>
<td>
<p>Optional, <em><code>NULL</code></em> or a <em><code>data.frame</code></em>
containing the information about special periods (e.g., hospitalizations or other situations
where medication use may differ, e.g. during incarcerations or holidays). Must contain the same unique
patient ID as dispensing and prescription data, the start and end dates of the special
periods with the exact column names <em><code>DATE.IN</code></em> and <em><code>DATE.OUT</code></em>.
Optional columns are <em><code>TYPE</code></em> (indicating the type of special situation),
customized instructions how to handle a specific period (see
<code>special.periods.method</code>), and any of those specified in <code>medication.class.colnames</code>.</p>
</td></tr>
<tr><td><code id="compute_event_durations_+3A_id.colname">ID.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in <code>disp.data</code>,
<code>presc.data</code>, and <code>special.periods.data</code> containing the unique patient ID.</p>
</td></tr>
<tr><td><code id="compute_event_durations_+3A_medication.class.colnames">medication.class.colnames</code></td>
<td>
<p>A <em><code>Vector</code></em> of <em>strings</em>, the
name(s) of the column(s) in <code>disp.data</code> and <code>presc.data</code> containing
the classes/types/groups of medication.</p>
</td></tr>
<tr><td><code id="compute_event_durations_+3A_disp.date.colname">disp.date.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>disp.data</code> containing the dispensing date (in the format given in
the <code>date.format</code> parameter).</p>
</td></tr>
<tr><td><code id="compute_event_durations_+3A_total.dose.colname">total.dose.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>disp.data</code> containing the total dispensed dose as <code>numeric</code> (e.g.
<code>500</code> for 10 tablets of 50 mg).</p>
</td></tr>
<tr><td><code id="compute_event_durations_+3A_presc.date.colname">presc.date.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>presc.data</code> containing the prescription date (in the format given in
the <code>date.format</code> parameter).</p>
</td></tr>
<tr><td><code id="compute_event_durations_+3A_presc.daily.dose.colname">presc.daily.dose.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>presc.data</code> containing the daily prescribed dose as <code>numeric</code> (e.g.
<code>50</code> for 50 mg once per day, or 25 for 50 mg once ever 2 days).</p>
</td></tr>
<tr><td><code id="compute_event_durations_+3A_presc.duration.colname">presc.duration.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>presc.data</code> containing the duration of the prescription as <code>numeric</code>
or <code>NA</code> if duration is unknown.</p>
</td></tr>
<tr><td><code id="compute_event_durations_+3A_visit.colname">visit.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>presc.data</code> containing the number of the visit or a new column name if the
prescribing data does not contain such a column.</p>
</td></tr>
<tr><td><code id="compute_event_durations_+3A_split.on.dosage.change">split.on.dosage.change</code></td>
<td>
<p><em>Logical</em> or <em>string</em>. If <code>TRUE</code>
split the dispensing event on days with dosage change and create a new event with
the new dosage for the remaining supply. If <em>string</em>, the name of the column
containing the <code>Logical</code> in <em>disp.data</em> for each medication class separatly.
Important if carryover should be considered later on.</p>
</td></tr>
<tr><td><code id="compute_event_durations_+3A_force.init.presc">force.init.presc</code></td>
<td>
<p><em>Logical</em>. If <code>TRUE</code> advance the date of the
first prescription event to the date of the first dispensing event, if the first
prescription event is after the first dispensing event for a specific medication.
Only if the first prescription event is not limited in duration (as indicated in
the <code>presc.duration.colname</code>).</p>
</td></tr>
<tr><td><code id="compute_event_durations_+3A_force.presc.renew">force.presc.renew</code></td>
<td>
<p><em>Logical</em> or <em>string</em>. If <code>TRUE</code> require
a new prescription for all medications for every prescription event (visit),
otherwise prescriptions end on the first visit without renewal. If <em>string</em>,
the name of the column in <em>disp.data</em> containing the <code>Logical</code> for each
medication class separatly.</p>
</td></tr>
<tr><td><code id="compute_event_durations_+3A_trt.interruption">trt.interruption</code></td>
<td>
<p>can be either of <em>&quot;continue&quot;</em>, <em>&quot;discard&quot;</em>,
<em>&quot;carryover&quot;</em>, or a <em>string</em>. It indicates how to handle durations during
treatment interruptions (see <code>special.periods.method</code>).
If <em>string</em>, the name of the (<em>character</em>) column in <em>disp.data</em>
containing the information (<em>&quot;continue&quot;</em>, <em>&quot;discard&quot;</em>, or <em>&quot;carryover&quot;</em>)
for each medication class separatly.</p>
</td></tr>
<tr><td><code id="compute_event_durations_+3A_special.periods.method">special.periods.method</code></td>
<td>
<p>can be either of <em>continue</em>, <em>discard</em>,
<em>carryover</em>, or <em>custom</em>. It indicates how to handle durations during special periods.
With <em>continue</em>, special periods have no effect on durations and event start dates.
With <em>discard</em>, durations are truncated at the beginning of special periods and the
remaining quantity is discarded. With <em>carryover</em>, durations are truncated
at the beginning of a special period and a new event with the remaining duration
is created after the end of the end of the special period. With <em>custom</em>, the
mapping has to be included in <em><code>special.periods.data</code></em>.</p>
</td></tr>
<tr><td><code id="compute_event_durations_+3A_carryover">carryover</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> apply carry-over to medications of the
same type (according to <code>medication.class.colnames</code>). Can only be used together with
CMA7 and above in combination with <code>carry.only.for.same.medication = TRUE</code>.</p>
</td></tr>
<tr><td><code id="compute_event_durations_+3A_date.format">date.format</code></td>
<td>
<p>A <em>string</em> giving the format of the dates used in
the <code>data</code> and the other parameters; see the <code>format</code> parameters
of the <code><a href="base.html#topic+as.Date">as.Date</a></code> function for details (NB, this concerns
only the dates given as strings and not as <code>Date</code> objects).</p>
</td></tr>
<tr><td><code id="compute_event_durations_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any warnings.</p>
</td></tr>
<tr><td><code id="compute_event_durations_+3A_return.data.table">return.data.table</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> return a
<code>data.table</code> object, otherwise a <code>data.frame</code>.</p>
</td></tr>
<tr><td><code id="compute_event_durations_+3A_progress.bar">progress.bar</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> show a progress bar.</p>
</td></tr>
<tr><td><code id="compute_event_durations_+3A_...">...</code></td>
<td>
<p>other possible parameters.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Computation of CMAs requires a supply duration for medications dispensed to
patients. If medications are not supplied for fixed durations but as a quantity
that may last for various durations based on the prescribed dose, the supply
duration has to be calculated based on dispensed and prescribed doses. Treatments
may be interrupted and resumed at later times, for which existing supplies may
or may not be taken into account. Patients may be hospitalized or incarcerated,
and may not use their own supplies during these periods. This function calculates
supply durations, taking into account the aforementioned situations and providing
various parameters for flexible adjustments.
</p>


<h3>Value</h3>

<p>A <code>list</code> with the following elements:
</p>

<ul>
<li> <p><code>event_durations</code>: A <code>data.table</code> or <code>data.frame</code> with the following columns:
</p>

<ul>
<li> <p><code>ID.colname</code> the unique patient ID, as given by the <code>ID.colname</code>
parameter.
</p>
</li>
<li> <p><code>medication.class.colnames</code> the column(s) with classes/types/groups
of medication, as given by the <code>medication.class.colnames</code> parameter.
</p>
</li>
<li> <p><code>disp.date.colname</code> the date of the dispensing event, as given by
the <code>disp.date.colnema</code> parameter.
</p>
</li>
<li> <p><code>total.dose.colname</code> the total dispensed dose, as given by the
<code>total.dose.colname</code> parameter.
</p>
</li>
<li> <p><code>presc.daily.dose.colname</code> the prescribed daily dose, as given by
the <code>presc.daily.dose.colname</code> parameter.
</p>
</li>
<li> <p><code>DISP.START</code> the start date of the dispensing event, either the
same as in <code>disp.date.colname</code> or a later date in case of dosage changes
or treatment interruptions/hospitalizations.
</p>
</li>
<li> <p><code>DURATION</code> the calculated duration of the supply, based on the total
dispensed dose and the prescribed daily dose, starting from the <code>DISP.START</code>
date.
</p>
</li>
<li> <p><code>episode.start</code>: the start date of the current prescription episode.
</p>
</li>
<li> <p><code>episode.end</code>: the end date of the current prescription episode.
Can be before the start date of the dispensing event if dispensed during a treatment interruption.
</p>
</li>
<li> <p><code>SPECIAL.DURATION</code> the number of days <em>during</em> the current duration affected
by special durations or treatment interruptions of type &quot;continue&quot;.
</p>
</li>
<li> <p><code>CARRYOVER.DURATION</code> the number of days <em>after</em> the current duration affected
by special durations or treatment interruptions of type &quot;carryover&quot;.
</p>
</li>
<li> <p><code>EVENT.ID</code>: in case of multiple events with the same dispensing date
(e.g. for dosage changes or interruptions); a unique ID starting at 1 for the first event
</p>
</li>
<li> <p><code>tot.presc.interruptions</code> the total number of prescription interruptions
per patient for a specific medication.
</p>
</li>
<li> <p><code>tot.dosage.changes</code> the total number of dosage changes per patient
for a specific medication.
</p>
</li></ul>

</li>
<li> <p><code>prescription_episodes</code>: A <code>data.table</code> or <code>data.frame</code> with the following columns:
</p>

<ul>
<li> <p><code>ID.colname</code>: the unique patient ID, as given by the <code>ID.colname</code> parameter.
</p>
</li>
<li> <p><code>medication.class.colnames</code>:  the column(s) with classes/types/groups of medication,
as given by the <code>medication.class.colnames</code> parameter.
</p>
</li>
<li> <p><code>presc.daily.dose.colname</code>: the prescribed daily dose, as given by the
<code>presc.daily.dose.colname</code> parameter.
</p>
</li>
<li> <p><code>episode.start</code>: the start date of the prescription episode.
</p>
</li>
<li> <p><code>episode.duration</code>: the duration of the prescription episode in days.
</p>
</li>
<li> <p><code>episode.end</code>: the end date of the prescription episode.
</p>
</li></ul>

</li>
<li> <p><code>special_periods</code>: A <code>data.table</code> or <code>data.frame</code>, the <code>special.periods.data</code>
with an additional column <code>SPECIAL.DURATION</code>: the number of days
between <code>DATE.IN</code> and <code>DATE.OUT</code>
</p>
</li>
<li> <p><code>ID.colname</code> the name of the columns containing
the unique patient ID, as given by the <code>ID.colname</code> parameter.
</p>
</li>
<li> <p><code>medication.class.colnames</code> the name(s) of the column(s) in <code>disp.data</code>
and <code>presc.data</code> containing the classes/types/groups of medication, as given by the
<code>medication.class.colnames</code> parameter.
</p>
</li>
<li> <p><code>disp.date.colname</code>  the name of the column in
<code>disp.data</code> containing the dispensing date, as given in the <code>disp.date.colname</code>
parameter.
</p>
</li>
<li> <p><code>total.dose.colname</code> the name of the column in
<code>disp.data</code> containing the total dispensed dose, as given by the
<code>total.dose.colname</code> parameter.
</p>
</li>
<li> <p><code>presc.date.colname</code> the name of the column in
<code>presc.data</code> containing the prescription date, as given in the <code>presc.date.colname</code>
parameter.
</p>
</li>
<li> <p><code>presc.daily.dose.colname</code> the name of the column in
<code>presc.data</code> containing the daily prescribed dose, as given by the
<code>presc.daily.dose.colname</code> parameter.
</p>
</li>
<li> <p><code>presc.duration.colname</code> the name of the column in
<code>presc.data</code> containing the duration of the prescription, as given by the
<code>presc.duration.colname</code> parameter.
</p>
</li>
<li> <p><code>visit.colname</code> the name of the column containing the number of the visit,
as given by the <code>visit.colname</code> parameter
</p>
</li>
<li> <p><code>split.on.dosage.change</code> whether to split the dispensing event on days with dosage changes
and create a new event with the new dosage for the remaining supply, as given by the
<code>split.on.dosage.change</code> parameter.
</p>
</li>
<li> <p><code>force.init.presc</code> whether the date of the first prescription event was set back
to the date of the first dispensing event, when the first prescription event was after the
first dispensing event for a specific medication, as given by the <code>force.init.presc</code> parameter.
</p>
</li>
<li> <p><code>force.presc.renew</code> whether a new prescription was required for all medications for every
prescription event (visit), as given by the <code>force.presc.renew</code> parameter.
</p>
</li>
<li> <p><code>trt.interruption</code> how durations during treatment interruptions were handled, as given
by the <code>trt.interruption</code> parameter.
</p>
</li>
<li> <p><code>special.periods.method</code> as given by the <code>special.periods.method</code> parameter.
</p>
</li>
<li> <p><code>date.format</code> the format of the dates, as given by the
<code>date.format</code> parameter.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
event_durations &lt;- compute_event_durations(disp.data = durcomp.dispensing,
                                           presc.data = durcomp.prescribing,
                                           special.periods.data = durcomp.hospitalisation,
                                           ID.colname = "ID",
                                           presc.date.colname = "DATE.PRESC",
                                           disp.date.colname = "DATE.DISP",
                                           medication.class.colnames = c("ATC.CODE",
                                           "UNIT", "FORM"),
                                           total.dose.colname = "TOTAL.DOSE",
                                           presc.daily.dose.colname = "DAILY.DOSE",
                                           presc.duration.colname = "PRESC.DURATION",
                                           visit.colname = "VISIT",
                                           split.on.dosage.change = TRUE,
                                           force.init.presc = TRUE,
                                           force.presc.renew = TRUE,
                                           trt.interruption = "continue",
                                           special.periods.method = "continue",
                                           date.format = "%Y-%m-%d",
                                           suppress.warnings = FALSE,
                                           return.data.table = TRUE);
       
## End(Not run)
</code></pre>

<hr>
<h2 id='compute.event.int.gaps'>Gap Days and Event (prescribing or dispensing) Intervals.</h2><span id='topic+compute.event.int.gaps'></span>

<h3>Description</h3>

<p>For a given event (prescribing or dispensing) database, compute the gap days
and event intervals in various scenarious.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compute.event.int.gaps(
  data,
  ID.colname = NA,
  event.date.colname = NA,
  event.duration.colname = NA,
  event.daily.dose.colname = NA,
  medication.class.colname = NA,
  event.interval.colname = "event.interval",
  gap.days.colname = "gap.days",
  carryover.within.obs.window = FALSE,
  carryover.into.obs.window = FALSE,
  carry.only.for.same.medication = FALSE,
  consider.dosage.change = FALSE,
  followup.window.start = 0,
  followup.window.start.unit = c("days", "weeks", "months", "years")[1],
  followup.window.duration = 365 * 2,
  followup.window.duration.unit = c("days", "weeks", "months", "years")[1],
  observation.window.start = 0,
  observation.window.start.unit = c("days", "weeks", "months", "years")[1],
  observation.window.duration = 365 * 2,
  observation.window.duration.unit = c("days", "weeks", "months", "years")[1],
  date.format = "%m/%d/%Y",
  keep.window.start.end.dates = FALSE,
  remove.events.outside.followup.window = TRUE,
  keep.event.interval.for.all.events = FALSE,
  parallel.backend = c("none", "multicore", "snow", "snow(SOCK)", "snow(MPI)",
    "snow(NWS)")[1],
  parallel.threads = "auto",
  suppress.warnings = FALSE,
  suppress.special.argument.checks = FALSE,
  return.data.table = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="compute.event.int.gaps_+3A_data">data</code></td>
<td>
<p>A <em><code>data.frame</code></em> containing the events used to
compute the CMA. Must contain, at a minimum, the patient unique ID, the event
date and duration, and might also contain the daily dosage and medication
type (the actual column names are defined in the following four parameters);
the <code>CMA</code> constructors call this parameter <code>data</code>.</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_id.colname">ID.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in <code>data</code>
containing the unique patient ID; must be present.</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_event.date.colname">event.date.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the start date of the event (in the format given in
the <code>date.format</code> parameter); must be present.</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_event.duration.colname">event.duration.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the event duration (in days); must be present.</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_event.daily.dose.colname">event.daily.dose.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the prescribed daily dose, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_medication.class.colname">medication.class.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the classes/types/groups of medication, or <code>NA</code>
if not defined.</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_event.interval.colname">event.interval.colname</code></td>
<td>
<p>A <em>string</em>, the name of a newly-created
column storing the number of days between the start of the current event and
the start of the next one; the default value &quot;event.interval&quot; should be
changed only if there is a naming conflict with a pre-existing
&quot;event.interval&quot; column in <code>event.info</code>.</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_gap.days.colname">gap.days.colname</code></td>
<td>
<p>A <em>string</em>, the name of a newly-created column
storing the number of days when medication was not available (i.e., the
&quot;gap days&quot;); the default value &quot;gap.days&quot; should be changed only if there is
a naming conflict with a pre-existing &quot;gap.days&quot; column in <code>event.info</code>.</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_carryover.within.obs.window">carryover.within.obs.window</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> consider
the carry-over within the observation window, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_carryover.into.obs.window">carryover.into.obs.window</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> consider the
carry-over from before the starting date of the observation window, or
<code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_carry.only.for.same.medication">carry.only.for.same.medication</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> the
carry-over applies only across medication of the same type, or <code>NA</code>
if not defined.</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_consider.dosage.change">consider.dosage.change</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> the carry-over
is adjusted to reflect changes in dosage, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_followup.window.start">followup.window.start</code></td>
<td>
<p>If a <em><code>Date</code></em> object, it represents
the actual start date of the follow-up window; if a <em>string</em> it is the
name of the column in <code>data</code> containing the start date of the follow-up
window either as the numbers of <code>followup.window.start.unit</code> units after
the first event (the column must be of type <code>numeric</code>) or as actual
dates (in which case the column must be of type <code>Date</code>); if a
<em>number</em> it is the number of time units defined in the
<code>followup.window.start.unit</code> parameter after the begin of the
participant's first event.</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_followup.window.start.unit">followup.window.start.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.start</code> refers to (when a number), or
<code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_followup.window.duration">followup.window.duration</code></td>
<td>
<p>either a <em>number</em> representing the
duration of the follow-up window in the time units given in
<code>followup.window.duration.unit</code>, or a <em>string</em> giving the column
containing these numbers. Should represent a period for which relevant
medication events are recorded accurately (e.g. not extend after end of
relevant treatment, loss-to-follow-up or change to a health care provider
not covered by the database).</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_followup.window.duration.unit">followup.window.duration.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.duration</code> refers to, or <code>NA</code> if not
defined.</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_observation.window.start">observation.window.start</code>, <code id="compute.event.int.gaps_+3A_observation.window.start.unit">observation.window.start.unit</code>, <code id="compute.event.int.gaps_+3A_observation.window.duration">observation.window.duration</code>, <code id="compute.event.int.gaps_+3A_observation.window.duration.unit">observation.window.duration.unit</code></td>
<td>
<p>the definition of the observation window
(see the follow-up window parameters above for details).</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_date.format">date.format</code></td>
<td>
<p>A <em>string</em> giving the format of the dates used in the
<code>data</code> and the other parameters; see the <code>format</code> parameters of the
<code><a href="base.html#topic+as.Date">as.Date</a></code> function for details (NB, this concerns only the
dates given as strings and not as <code>Date</code> objects).</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_keep.window.start.end.dates">keep.window.start.end.dates</code></td>
<td>
<p><em>Logical</em>, should the computed start
and end dates of the windows be kept?</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_remove.events.outside.followup.window">remove.events.outside.followup.window</code></td>
<td>
<p><em>Logical</em>, should the
events that fall outside the follo-wup window be removed from the results?</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_keep.event.interval.for.all.events">keep.event.interval.for.all.events</code></td>
<td>
<p><em>Logical</em>, should the computed
event intervals be kept for all events, or <code>NA</code>'ed for those outside the
OW?</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_parallel.backend">parallel.backend</code></td>
<td>
<p>Can be &quot;none&quot; (the default) for single-threaded
execution, &quot;multicore&quot;  (using <code>mclapply</code> in package <code>parallel</code>)
for multicore processing (NB. not currently implemented on MS Windows and
automatically falls back on &quot;snow&quot; on this platform),  or &quot;snow&quot;,
&quot;snow(SOCK)&quot; (equivalent to &quot;snow&quot;), &quot;snow(MPI)&quot; or &quot;snow(NWS)&quot; specifying
various types of SNOW clusters (can be on the local machine or more complex
setups &ndash; please see the documentation of package <code>snow</code> for details;
the last two require packages <code>Rmpi</code> and <code>nws</code>, respectively, not
automatically installed with <code>AdhereR</code>).</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_parallel.threads">parallel.threads</code></td>
<td>
<p>Can be &quot;auto&quot; (for <code>parallel.backend</code> ==
&quot;multicore&quot;, defaults to the number of cores in the system as given by
<code>options("cores")</code>, while for <code>parallel.backend</code> == &quot;snow&quot;,
defaults to 2), a strictly positive integer specifying the number of parallel
threads, or a more complex specification of the SNOW cluster nodes for
<code>parallel.backend</code> == &quot;snow&quot; (see the documentation of package
<code>snow</code> for details).</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any
warnings.</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_suppress.special.argument.checks">suppress.special.argument.checks</code></td>
<td>
<p><em>Logical</em> parameter for internal
use; if <code>FALSE</code> (default) check if the important columns in the <code>data</code>
have some of the reserved names, if <code>TRUE</code> this check is not performed.</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_return.data.table">return.data.table</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> return a
<code>data.table</code> object, otherwise a <code>data.frame</code>.</p>
</td></tr>
<tr><td><code id="compute.event.int.gaps_+3A_...">...</code></td>
<td>
<p>extra arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This should in general not be called directly by the user, but is provided as
a basis for the extension to new CMAs.
</p>


<h3>Value</h3>

<p>A <code>data.frame</code> or <code>data.table</code> extending the
<code>event.info</code> parameter with:
</p>

<ul>
<li> <p><code>event.interval</code> Or any other name given in
<code>event.interval.colname</code>, containing the number of days between the
start of the current event and the start of the next one.
</p>
</li>
<li> <p><code>gap.days</code> Or any other name given in <code>gap.days.colname</code>,
containing the number of days when medication was not available for the
current event (i.e., the &quot;gap days&quot;).
</p>
</li>
<li> <p><code>.FU.START.DATE,.FU.END.DATE</code> if kept, the actual start and end
dates of the follow-up window (after adjustments due to the various
parameters).
</p>
</li>
<li> <p><code>.OBS.START.DATE,.OBS.END.DATE</code> if kept, the actual start and end
dates of the observation window (after adjustments due to the various
parameters).
</p>
</li>
<li> <p><code>.EVENT.STARTS.BEFORE.OBS.WINDOW</code> if kept, <code>TRUE</code> if the
current event starts before the start of the observation window.
</p>
</li>
<li> <p><code>.TDIFF1,.TDIFF2</code> if kept, various auxiliary time differences
(in days).
</p>
</li>
<li> <p><code>.EVENT.STARTS.AFTER.OBS.WINDOW</code> if kept, <code>TRUE</code> if the
current event starts after the end of the observation window.
</p>
</li>
<li> <p><code>.CARRY.OVER.FROM.BEFORE</code> if kept, the carry-over (if any) from
the previous events.
</p>
</li>
<li> <p><code>.EVENT.WITHIN.FU.WINDOW</code> if kept, <code>TRUE</code> if the current
event is within the follow-up window.
</p>
</li></ul>


<hr>
<h2 id='compute.treatment.episodes'>Compute Treatment Episodes.</h2><span id='topic+compute.treatment.episodes'></span>

<h3>Description</h3>

<p>For a given event (prescribing or dispensing) database, compute the treatment
episodes for each patient in various scenarious.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compute.treatment.episodes(
  data,
  ID.colname = NA,
  event.date.colname = NA,
  event.duration.colname = NA,
  event.daily.dose.colname = NA,
  medication.class.colname = NA,
  carryover.within.obs.window = TRUE,
  carry.only.for.same.medication = TRUE,
  consider.dosage.change = TRUE,
  medication.change.means.new.treatment.episode = TRUE,
  dosage.change.means.new.treatment.episode = FALSE,
  maximum.permissible.gap = 90,
  maximum.permissible.gap.unit = c("days", "weeks", "months", "years", "percent")[1],
  maximum.permissible.gap.append.to.episode = FALSE,
  followup.window.start = 0,
  followup.window.start.unit = c("days", "weeks", "months", "years")[1],
  followup.window.duration = 365 * 2,
  followup.window.duration.unit = c("days", "weeks", "months", "years")[1],
  event.interval.colname = "event.interval",
  gap.days.colname = "gap.days",
  return.mapping.events.episodes = FALSE,
  date.format = "%m/%d/%Y",
  parallel.backend = c("none", "multicore", "snow", "snow(SOCK)", "snow(MPI)",
    "snow(NWS)")[1],
  parallel.threads = "auto",
  suppress.warnings = FALSE,
  suppress.special.argument.checks = FALSE,
  return.data.table = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="compute.treatment.episodes_+3A_data">data</code></td>
<td>
<p>A <em><code>data.frame</code></em> containing the events used to
compute the CMA. Must contain, at a minimum, the patient unique ID, the event
date and duration, and might also contain the daily dosage and medication
type (the actual column names are defined in the following four parameters);
the <code>CMA</code> constructors call this parameter <code>data</code>.</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_id.colname">ID.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in <code>data</code>
containing the unique patient ID, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_event.date.colname">event.date.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the start date of the event (in the format given in
the <code>date.format</code> parameter), or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_event.duration.colname">event.duration.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the event duration (in days), or <code>NA</code> if not
defined.</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_event.daily.dose.colname">event.daily.dose.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the prescribed daily dose, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_medication.class.colname">medication.class.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the classes/types/groups of medication, or <code>NA</code>
if not defined.</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_carryover.within.obs.window">carryover.within.obs.window</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> consider
the carry-over within the observation window, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_carry.only.for.same.medication">carry.only.for.same.medication</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> the
carry-over applies only across medication of the same type, or <code>NA</code> if
not defined.</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_consider.dosage.change">consider.dosage.change</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> the carry-over
is adjusted to reflect changes in dosage, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_medication.change.means.new.treatment.episode">medication.change.means.new.treatment.episode</code></td>
<td>
<p><em>Logical</em>, should
a change in medication automatically start a new treatment episode?</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_dosage.change.means.new.treatment.episode">dosage.change.means.new.treatment.episode</code></td>
<td>
<p><em>Logical</em>, should
a change in dosage automatically start a new treatment episode?</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_maximum.permissible.gap">maximum.permissible.gap</code></td>
<td>
<p>The <em>number</em> of units given by
<code>maximum.permissible.gap.unit</code> representing the maximum duration of
permissible gaps between treatment episodes (can also be a percent, see
<code>maximum.permissible.gap.unit</code> for details).</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_maximum.permissible.gap.unit">maximum.permissible.gap.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em>, <em>&quot;years&quot;</em> or <em>&quot;percent&quot;</em>, and
represents the time units that <code>maximum.permissible.gap</code> refers to;
if <em>percent</em>, then  <code>maximum.permissible.gap</code> is interpreted as a
percent (can be greater than 100%) of the duration of the current
prescription.</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_maximum.permissible.gap.append.to.episode">maximum.permissible.gap.append.to.episode</code></td>
<td>
<p>a <em>logical</em> value
specifying of the <code>maximum.permissible.gap</code> should be append at the
end of an episode with a gap larger than the <code>maximum.permissible.gap</code>;
<code>FALSE</code> (the default) mean no addition, while <code>TRUE</code> mean that the
full <code>maximum.permissible.gap</code> is added.</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_followup.window.start">followup.window.start</code></td>
<td>
<p>If a <em><code>Date</code></em> object it is the actual
start date of the follow-up window; if a <em>string</em> it is the name of the
column in <code>data</code> containing the start date of the follow-up window; if a
<em>number</em> it is the number of time units defined in the
<code>followup.window.start.unit</code> parameter after the begin of the
participant's first event; or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_followup.window.start.unit">followup.window.start.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>, <em>&quot;weeks&quot;</em>,
<em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time units that
<code>followup.window.start</code> refers to (when a number), or <code>NA</code> if not
defined.</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_followup.window.duration">followup.window.duration</code></td>
<td>
<p>a <em>number</em> representing the duration of
the follow-up window in the time units given in
<code>followup.window.duration.unit</code>, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_followup.window.duration.unit">followup.window.duration.unit</code></td>
<td>
<p>can be either <em>&quot;days&quot;</em>,
<em>&quot;weeks&quot;</em>, <em>&quot;months&quot;</em> or <em>&quot;years&quot;</em>, and represents the time
units that <code>followup.window.duration</code> refers to, or <code>NA</code> if not
defined.</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_event.interval.colname">event.interval.colname</code></td>
<td>
<p>A <em>string</em>, the name of a newly-created
column storing the number of days between the start of the current event and
the start of the next one; the default value &quot;event.interval&quot; should be
changed only if there is a naming conflict with a pre-existing
&quot;event.interval&quot; column in <code>event.info</code>.</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_gap.days.colname">gap.days.colname</code></td>
<td>
<p>A <em>string</em>, the name of a newly-created column
storing the number of days when medication was not available (i.e., the
&quot;gap days&quot;); the default value &quot;gap.days&quot; should be changed only if there is
a naming conflict with a pre-existing &quot;gap.days&quot; column in <code>event.info</code>.</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_return.mapping.events.episodes">return.mapping.events.episodes</code></td>
<td>
<p>A <em>Logical</em>, if <code>TRUE</code> then
the mapping between events and episodes is returned as the attribute
<code>mapping.episodes.to.events</code>, which is a <code>data.table</code> giving, for
each episode, the events that belong to it (an event is given by its row
number in the <code>data</code>). Please note that the episodes returned are quite
&quot;generic&quot; (e.g., they include all the events in the FUW), because which events
will be actually used in the computation of a <code>CMA_per_episode</code> depend on
which simple CMA is used (see also <code>CMA_per_episode</code>), and should be used
with care (we recommend using the mappings given by <code>CMA_per_episode</code>
instead).</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_date.format">date.format</code></td>
<td>
<p>A <em>string</em> giving the format of the dates used in the
<code>data</code> and the other parameters; see the <code>format</code> parameters of the
<code><a href="base.html#topic+as.Date">as.Date</a></code> function for details (NB, this concerns only the
dates given as strings and not as <code>Date</code> objects).</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_parallel.backend">parallel.backend</code></td>
<td>
<p>Can be &quot;none&quot; (the default) for single-threaded
execution, &quot;multicore&quot;  (using <code>mclapply</code> in package <code>parallel</code>)
for multicore processing (NB. not currently implemented on MS Windows and
automatically falls back on &quot;snow&quot; on this platform),  or &quot;snow&quot;,
&quot;snow(SOCK)&quot; (equivalent to &quot;snow&quot;), &quot;snow(MPI)&quot; or &quot;snow(NWS)&quot; specifying
various types of SNOW clusters (can be on the local machine or more complex
setups &ndash; please see the documentation of package <code>snow</code> for details;
the last two require packages <code>Rmpi</code> and <code>nws</code>, respectively, not
automatically installed with <code>AdhereR</code>).</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_parallel.threads">parallel.threads</code></td>
<td>
<p>Can be &quot;auto&quot; (for <code>parallel.backend</code> ==
&quot;multicore&quot;, defaults to the number of cores in the system as given by
<code>options("cores")</code>, while for <code>parallel.backend</code> == &quot;snow&quot;,
defaults to 2), a strictly positive integer specifying the number of parallel
threads, or a more complex specification of the SNOW cluster nodes for
<code>parallel.backend</code> == &quot;snow&quot; (see the documentation of package
<code>snow</code> for details).</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any
warnings.</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_suppress.special.argument.checks">suppress.special.argument.checks</code></td>
<td>
<p><em>Logical</em> parameter for internal
use; if <code>FALSE</code> (default) check if the important columns in the <code>data</code>
have some of the reserved names, if <code>TRUE</code> this check is not performed.</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_return.data.table">return.data.table</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> return a
<code>data.table</code> object, otherwise a <code>data.frame</code>.</p>
</td></tr>
<tr><td><code id="compute.treatment.episodes_+3A_...">...</code></td>
<td>
<p>extra arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This should in general not be called directly by the user, but is provided as
a basis for the extension to new CMAs.
</p>
<p>For the last treatment episode, the gap is considered only when longer than
the maximum permissible gap.
Please note the following:
</p>

<ul>
<li><p> episode starts at first medication event for a particular medication,
</p>
</li>
<li><p> episode ends on the day when the last supply of that medication
finished or if a period longer than the permissible gap preceded the next
medication event, or at the end of the FUW,
</p>
</li>
<li><p> end episode gap days represents either the number of days after the
end of the treatment episode (if medication changed, or if a period longer
than the permissible gap preceded the next medication event) or at the
end of (and within) the episode, i.e. the number of days after the last
supply finished (if no other medication event followed until the end of the
FUW),
</p>
</li>
<li><p> the duration of the episode is the interval between the episode start
and episode end (and may include the gap days at the end, in the latter
condition described above),
</p>
</li>
<li><p> the number of gap days after the end of the episode can be computed
as all values larger than the permissible gap and 0 otherwise,
</p>
</li>
<li><p> if medication change starts new episode, then previous episode ends
when the last supply is finished (irrespective of the length of gap compared
to a maximum permissible gap); any days before the date of the new
medication supply are considered a gap; this maintains consistency with gaps
between episodes (whether they are constructed based on the maximum
permissible gap rule or the medication change rule).
</p>
</li></ul>



<h3>Value</h3>

<p>A <code>data.frame</code> or <code>data.table</code> with the following columns
(or <code>NULL</code> if no
treatment episodes could be computed):
</p>

<ul>
<li> <p><code>patid</code> the patient ID.
</p>
</li>
<li> <p><code>episode.ID</code> the episode unique ID (increasing sequentially).
</p>
</li>
<li> <p><code>episode.start</code> the episode start date.
</p>
</li>
<li> <p><code>end.episode.gap.days</code> the corresponding gap days of the last event in this episode.
</p>
</li>
<li> <p><code>episode.duration</code> the episode duration in days.
</p>
</li>
<li> <p><code>episode.end</code> the episode end date.
</p>
</li></ul>

<p>If <code>mapping.episodes.to.events</code> is <code>TRUE</code>, then this also has an
<em>attribute</em> <code>mapping.episodes.to.events</code> that gives the mapping between
episodes and events as a <code>data.table</code> with the following columns:
</p>

<ul>
<li> <p><code>patid</code> the patient ID.
</p>
</li>
<li> <p><code>episode.ID</code> the episode unique ID (increasing sequentially).
</p>
</li>
<li> <p><code>event.index.in.data</code> the event given by its row number in the <code>data</code>.
</p>
</li></ul>


<hr>
<h2 id='cover_special_periods'>Cover special periods.</h2><span id='topic+cover_special_periods'></span>

<h3>Description</h3>

<p>Identifies special periods that are in proximity to already covered durations and adds additional
events for these durations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cover_special_periods(
  events.data,
  special.periods.data,
  ID.colname,
  medication.class.colnames,
  disp.date.colname,
  disp.start.colname,
  episode.start.colname,
  episode.end.colname,
  duration.colname,
  days.before,
  days.after,
  date.format,
  suppress.warnings = FALSE,
  return.data.table = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cover_special_periods_+3A_events.data">events.data</code></td>
<td>
<p>A <em><code>data.frame</code></em> or <em><code>data.table</code></em> with the event durations.</p>
</td></tr>
<tr><td><code id="cover_special_periods_+3A_special.periods.data">special.periods.data</code></td>
<td>
<p>a <em><code>data.frame</code></em> or or <em><code>data.table</code></em>
containing the information about special periods (e.g., hospitalizations or other situations
where medication use may differ, e.g. during incarcerations or holidays). Must contain the same unique
patient ID as dispensing and prescription data, the start and end dates of the special
periods with the exact column names <em><code>DATE.IN</code></em> and <em><code>DATE.OUT</code></em>.</p>
</td></tr>
<tr><td><code id="cover_special_periods_+3A_id.colname">ID.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in <code>events.data</code> and
<code>special.periods.data</code> containing the unique patient ID.</p>
</td></tr>
<tr><td><code id="cover_special_periods_+3A_medication.class.colnames">medication.class.colnames</code></td>
<td>
<p>A <em><code>Vector</code></em> of <em>strings</em>, the
name(s) of the column(s) in the <code>events.data</code> identify medication classes.</p>
</td></tr>
<tr><td><code id="cover_special_periods_+3A_disp.date.colname">disp.date.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>events.data</code> containing the dispensation start date (in the format given in
the <code>date.format</code> parameter).</p>
</td></tr>
<tr><td><code id="cover_special_periods_+3A_disp.start.colname">disp.start.colname</code>, <code id="cover_special_periods_+3A_episode.start.colname">episode.start.colname</code>, <code id="cover_special_periods_+3A_episode.end.colname">episode.end.colname</code></td>
<td>
<p>column names in
<code>events.data</code>.</p>
</td></tr>
<tr><td><code id="cover_special_periods_+3A_duration.colname">duration.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>events.data</code> containing the duration of the medication event.</p>
</td></tr>
<tr><td><code id="cover_special_periods_+3A_days.before">days.before</code></td>
<td>
<p>an <em>integer</em>, the number of days before the start of a special period
within which an event duration must end to consider the special period as covered.</p>
</td></tr>
<tr><td><code id="cover_special_periods_+3A_days.after">days.after</code></td>
<td>
<p>an <em>integer</em>, the number of days after a special period within
which an event duration must start to consider the special period as covered.</p>
</td></tr>
<tr><td><code id="cover_special_periods_+3A_date.format">date.format</code></td>
<td>
<p>A <em>string</em> giving the format of the dates used in
the <code>data</code> and the other parameters; see the <code>format</code> parameters
of the <code><a href="base.html#topic+as.Date">as.Date</a></code> function for details (NB, this concerns
only the dates given as strings and not as <code>Date</code> objects).</p>
</td></tr>
<tr><td><code id="cover_special_periods_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any
warnings.</p>
</td></tr>
<tr><td><code id="cover_special_periods_+3A_return.data.table">return.data.table</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> return a
<code>data.table</code> object, otherwise a <code>data.frame</code>.</p>
</td></tr>
<tr><td><code id="cover_special_periods_+3A_...">...</code></td>
<td>
<p>other possible parameters.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Special periods may appear as gaps, possibly leading to underestimation of implementation or even
assumption of discontinuation and non-persistence. To consider such periods as covered, this function
adds additional durations, for example when it is assumed that hospitalized patients are adherent
during the hospitalization period. This function should be used after pruning with
<code>prune_event_durations</code>.
</p>


<h3>Value</h3>

<p>A <code>data.frame</code> or <code>data.table</code>, the <code>events.data</code> with the additional
durations for special periods covered.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# select medication class of interest and compute event durations
disp_data &lt;- durcomp.dispensing[ID == 3 &amp; grepl("J01EE01", ATC.CODE)]
presc_data &lt;- durcomp.prescribing[ID == 3 &amp; grepl("J01EE01", ATC.CODE)]

event_durations_list &lt;- compute_event_durations(disp.data = disp_data,
                                                presc.data = presc_data,
                                                special.periods.data = durcomp.hospitalisation,
                                                special.periods.method = "carryover",
                                                ID.colname = "ID",
                                                presc.date.colname = "DATE.PRESC",
                                                disp.date.colname = "DATE.DISP",
                                                date.format = "%Y-%m-%d",
                                                medication.class.colnames = c("ATC.CODE",
                                                                              "UNIT",
                                                                              "FORM"),
                                                total.dose.colname = "TOTAL.DOSE",
                                                presc.daily.dose.colname = "DAILY.DOSE",
                                                presc.duration.colname = "PRESC.DURATION",
                                                visit.colname = "VISIT",
                                                force.init.presc = TRUE,
                                                force.presc.renew = TRUE,
                                                split.on.dosage.change = TRUE,
                                                trt.interruption = "carryover",
                                                suppress.warnings = FALSE,
                                                return.data.table = TRUE,
                                                progress.bar = FALSE)

event_durations &lt;- prune_event_durations(event_durations_list,
                                         include = c("special periods"),
                                         medication.class.colnames = "ATC.CODE",
                                         days.within.out.date.1 = 7,
                                         days.within.out.date.2 = 30,
                                         keep.all = TRUE)

# cover special periods
special_periods &lt;- event_durations_list$special_periods
event_durations_covered &lt;- cover_special_periods(events.data = event_durations,
                                                 special.periods.data = special_periods,
                                                 ID.colname = "ID",
                                                 medication.class.colnames = "ATC.CODE",
                                                 disp.start.colname = "DISP.START",
                                                 duration.colname = "DURATION",
                                                 days.before = 7,
                                                 days.after = 7,
                                                 date.format = "%Y-%m-%d")
       
## End(Not run)
</code></pre>

<hr>
<h2 id='durcomp.dispensing'>Example dispensing events for 16 patients.</h2><span id='topic+durcomp.dispensing'></span>

<h3>Description</h3>

<p>A sample dataset containing dispensing events (one per row) for 16 patients
over a period of roughly 24 months (1794 events in total).
This is the appropriate format to compute event durations with the
<code>compute_event_durations</code> function. Each row represents an individual dispensing
record for a specific dose of a specific medication for a patient at a given date.
More than one column to group medications can be supplied (such as ATC code, Form and Unit).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>durcomp.dispensing
</code></pre>


<h3>Format</h3>

<p>A data frame with 1794 rows and 6 variables:
</p>

<dl>
<dt>ID</dt><dd><p><em>integer</em> here; patient unique identifier. Can also
be <em>string</em>.</p>
</dd>
<dt>DATE.DISP</dt><dd><p><em>Date</em> here;the dispensing event date, by default in the
yyyy-mm-dd format. Can also be <em>string</em>.</p>
</dd>
<dt>ATC.CODE</dt><dd><p><em>character</em>; the medication type, according to the WHO ATC
classification system. This can be a researcher-defined classification
depending on study aims (e.g., based on therapeutic use, mechanism of
action, chemical molecule, or pharmaceutical formulation). The <code>compute_event_durations</code>
function will match prescribed medication to dispensed medications based on this variable.</p>
</dd>
<dt>UNIT</dt><dd><p><em>integer</em>; the unit of the dispensed dose. This is optional and can be used
as a separate variable to match between prescription and dispensing events.</p>
</dd>
<dt>FORM</dt><dd><p><em>character</em>; the galenic form of the dispensed preparation.
This is optional and can be used as a separate variable to match between prescription and
dispensing events.</p>
</dd>
<dt>TOTAL.DOSE</dt><dd><p><em>numeric</em>; the total dispensed dose supplied at this
medication event (e.g., <code>5000</code> for 10 tables of 500 mg).</p>
</dd>
</dl>


<hr>
<h2 id='durcomp.hospitalisation'>Example special periods for 10 patients.</h2><span id='topic+durcomp.hospitalisation'></span>

<h3>Description</h3>

<p>A sample dataset containing special periods (one per row) for 10 patients
over a period of roughly 18 months (28 events in total).
This is the appropriate format to compute event durations with the
<code>compute_event_durations</code> function. Each row represents an individual special period of type
&quot;hospitalization&quot; of a patient for whom event durations should be calculated.
Besides hospitalizations, this could cover other situations
where medication use may differ, e.g. during incarcerations or holidays.
All column names must match the format provided in this example.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>durcomp.hospitalisation
</code></pre>


<h3>Format</h3>

<p>A data frame with 28 rows and 3 variables:
</p>

<dl>
<dt>ID</dt><dd><p><em>Integer</em> here; patient unique identifier. Can also
be <em>string</em>.</p>
</dd>
<dt>DATE.IN</dt><dd><p><em>Date</em> here;the start of the hospitalization period, by default in the
yyyy-mm-dd format.Can also be <em>string</em>.</p>
</dd>
<dt>DATE.OUT</dt><dd><p><em>Date</em>;the end of the hospitalization period, by default in the
yyyy-mm-dd format. Can also be <em>string</em>.</p>
</dd>
</dl>


<hr>
<h2 id='durcomp.prescribing'>Example prescription events for 16 patients.</h2><span id='topic+durcomp.prescribing'></span>

<h3>Description</h3>

<p>A sample dataset containing prescription events (one per row) for 16 patients
over a period of roughly 15 months (1502 events in total).
This is the appropriate format to compute event durations with the
<code>compute_event_durations</code> function. Each row represents an individual prescription
record for a specific dose of a specific medication for a patient at a given date.
Visit number and Duration are optional, and more than one column to group medications
can be supplied (such as ATC Code, Form or Unit).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>durcomp.prescribing
</code></pre>


<h3>Format</h3>

<p>A data table with 1502 rows and 8 variables:
</p>

<dl>
<dt>ID</dt><dd><p><em>integer</em> here; patient unique identifier. Can also
be <em>string</em>.</p>
</dd>
<dt>DATE.PRESC</dt><dd><p><em>Date</em> here;the prescription event date, by default in the
yyyy-mm-dd format. Can also be <em>string</em>.</p>
</dd>
<dt>VISIT</dt><dd><p><em>integer</em>; the consecutive number of the prescription instances.
This column is optional and will be generated internally when not supplied. It is
used to identify treatment interruptions.</p>
</dd>
<dt>ATC.CODE</dt><dd><p><em>character</em>; the medication type, according to the WHO ATC
classification system. This can be a researcher-defined classification
depending on study aims (e.g., based on therapeutic use, mechanism of
action, chemical molecule, or pharmaceutical formulation). The <code>compute_event_durations</code>
function will match prescribed medication to dispensed medications based on this variable.</p>
</dd>
<dt>FORM</dt><dd><p><em>character</em>; the galenic form of the prescribed preparation.
This is optional and can be used as a separate variable to match between prescription and
dispensing events.</p>
</dd>
<dt>UNIT</dt><dd><p><em>integer</em>; the unit of the prescribed dose. This is optional and can be used
as a separate variable to match between prescription and dispensing events.</p>
</dd>
<dt>PRESC.DURATION</dt><dd><p><em>numeric</em>; the duration (in days) for which the prescription
is intended. Can be <code>NA</code> if the prescription is continuous without a fixed end date.</p>
</dd>
<dt>DAILY.DOSE</dt><dd><p><em>numeric</em>; the daily dose prescribed during this event (e.g., <code>50</code> for 1 tablet
of 50 mg per day or <code>25</code> for 1 tablet of 50 mg every two days).</p>
</dd>
</dl>


<hr>
<h2 id='get.event.plotting.area'>Get the actual plotting area.</h2><span id='topic+get.event.plotting.area'></span>

<h3>Description</h3>

<p>Returns the actual plotting area rectangle in plotting coordinates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get.event.plotting.area(
  plot.type = c("baseR", "SVG")[1],
  suppress.warnings = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get.event.plotting.area_+3A_plot.type">plot.type</code></td>
<td>
<p>Can be either &quot;baseR&quot; or &quot;SVG&quot; and specifies to which type of plotting
the mapping applies.</p>
</td></tr>
<tr><td><code id="get.event.plotting.area_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any
warnings.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is intended for advanced users only.
</p>


<h3>Value</h3>

<p>A numeric vector with components <em>x.min</em>, <em>x.max</em>,
<em>y.min</em> and <em>y.max</em>, or <code>NULL</code> in case of error.
</p>

<hr>
<h2 id='get.legend.plotting.area'>Get the legend plotting area.</h2><span id='topic+get.legend.plotting.area'></span>

<h3>Description</h3>

<p>Returns the legend plotting area rectangle in plotting coordinates
(if any).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get.legend.plotting.area(
  plot.type = c("baseR", "SVG")[1],
  suppress.warnings = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get.legend.plotting.area_+3A_plot.type">plot.type</code></td>
<td>
<p>Can be either &quot;baseR&quot; or &quot;SVG&quot; and specifies to which type of plotting
the mapping applies.</p>
</td></tr>
<tr><td><code id="get.legend.plotting.area_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any
warnings.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is intended for advanced users only.
</p>


<h3>Value</h3>

<p>A numeric vector with components <em>x.min</em>, <em>x.max</em>,
<em>y.min</em> and <em>y.max</em>, or <code>NULL</code> in case of error or no
legend being shown.
</p>

<hr>
<h2 id='get.plotted.events'>Get info about the plotted events.</h2><span id='topic+get.plotted.events'></span>

<h3>Description</h3>

<p>Returns a <code>data.frame</code> where each row contains info about one plotted event;
the order of the rows reflects the y-axis (first row on bottom).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get.plotted.events(plot.type = c("baseR", "SVG")[1], suppress.warnings = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get.plotted.events_+3A_plot.type">plot.type</code></td>
<td>
<p>Can be either &quot;baseR&quot; or &quot;SVG&quot; and specifies to which type of plotting
the mapping applies.</p>
</td></tr>
<tr><td><code id="get.plotted.events_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any
warnings.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is intended for advanced users only.
</p>


<h3>Value</h3>

<p>A <code>data.frame</code> that, besides the info about each event, also
contains info about:
</p>

<ul>
<li><p> the corresponding follow-up and observation windows (and, for
<code>CMA8</code>, the &quot;real&quot; observation window), given as the corners of the area
<em>.X...START</em>, <em>.X...END</em>, <em>.Y...START</em> and <em>.Y...END</em>
(where the mid dot stands for FUW, OW and ROW, respectively).
</p>
</li>
<li><p> the area occupied by the graphic representation of the event given by
its four corners <em>.X.START</em>, <em>.X.END</em>, <em>.Y.START</em> and
<em>.Y.END</em>, as well as the line width <em>.EV.LWD</em>.
</p>
</li>
<li><p> the dose text's (if any) position (<em>.X.DOSE</em>, <em>.Y.DOSE</em>) and
font size <em>.FONT.SIZE.DOSE</em>.
</p>
</li>
<li><p> if event corvered and not covered are plotted, also give their areas as
<em>.X.EVC.START</em>, <em>.X.EVC.END</em>, <em>.Y.EVC.START</em>, <em>.Y.EVC.END</em>,
<em>.X.EVNC.START</em>, <em>.X.EVNC.END</em>, <em>.Y.EVNC.START</em> and
<em>.Y.EVNC.END</em>.
</p>
</li>
<li><p> the continuation lines area as <em>.X.CNT.START</em>, <em>.X.CNT.END</em>,
<em>.Y.CNT.START</em> and <em>.Y.CNT.END</em>.
</p>
</li>
<li><p> and the corresponding summary CMA (if any) given as the area
<em>.X.SCMA.START</em>, <em>.X.SCMA.END</em>, <em>.Y.SCMA.START</em> and
<em>.Y.SCMA.END</em>.
</p>
</li></ul>

<p>Please note that even if with follow-up and (&quot;real&quot;) observation window, and
the summary CMA info is repeated for each event, they really make sense at
the level of the patient.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cma7 &lt;- CMA7(data=med.events[med.events$PATIENT_ID %in% c(1,2),],
             ID.colname="PATIENT_ID",
             event.date.colname="DATE",
             event.duration.colname="DURATION",
             event.daily.dose.colname="PERDAY",
             medication.class.colname="CATEGORY",
             followup.window.start=0,
             followup.window.start.unit="days",
             followup.window.duration=2*365,
             followup.window.duration.unit="days",
             observation.window.start=30,
             observation.window.start.unit="days",
             observation.window.duration=365,
             observation.window.duration.unit="days",
             date.format="%m/%d/%Y",
             summary="Base CMA");
plot(cma7);
tmp &lt;- get.plotted.events();
head(tmp);
# "Mask" the first event:
rect(tmp$.X.START[1], tmp$.Y.START[1]-0.5, tmp$.X.END[1], tmp$.Y.END[1]+0.5,
     col=adjustcolor("white",alpha.f=0.75), border="black");
# "Mask" the first patient's summary CMA:
rect(tmp$.X.SCMA.START[1], tmp$.Y.SCMA.START[1],
     tmp$.X.SCMA.END[1], tmp$.Y.SCMA.END[1],
     col=adjustcolor("white",alpha.f=0.75), border="black");
</code></pre>

<hr>
<h2 id='get.plotted.partial.cmas'>Get info about the plotted partial CMAs.</h2><span id='topic+get.plotted.partial.cmas'></span>

<h3>Description</h3>

<p>Returns a <code>data.frame</code> where each row contains info about one plotted
partial CMA (partial CMAs make sense only for &quot;complex&quot; CMAs, i.e., per
episode and sliding windows).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get.plotted.partial.cmas(
  plot.type = c("baseR", "SVG")[1],
  suppress.warnings = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get.plotted.partial.cmas_+3A_plot.type">plot.type</code></td>
<td>
<p>Can be either &quot;baseR&quot; or &quot;SVG&quot; and specifies to which type of plotting
the mapping applies.</p>
</td></tr>
<tr><td><code id="get.plotted.partial.cmas_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any
warnings.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is intended for advanced users only.
</p>


<h3>Value</h3>

<p>A <code>data.frame</code> that contains info about:
</p>

<ul>
<li><p> the patient ID (<em>pid</em>) to which the partial CMA belongs.
</p>
</li>
<li><p> the <em>type</em> of partial CMA (see the help for plotting &quot;complex&quot;
CMAs).
</p>
</li>
<li><p> the corners of the whole area covered by the partial CMA plot given as
<em>x.region.start</em>, <em>y.region.start</em>, <em>x.region.end</em> and
<em>y.region.end</em>.
</p>
</li>
<li><p> for each element of the partial CMA plot, its area as
<em>x.partial.start</em>, <em>y.partial.start</em>, <em>x.partial.end</em> and
<em>y.partial.end</em>.
</p>
</li></ul>

<p>Please note that this contains one row per partial CMA element (e.g., if
plotting stacked, one row for each rectangle).
</p>

<hr>
<h2 id='getCallerWrapperLocation'>getCallerWrapperLocation.</h2><span id='topic+getCallerWrapperLocation'></span>

<h3>Description</h3>

<p>This function returns the full path to where the various <code>wrappers</code> that
can call <code>AdhereR</code> are installed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getCallerWrapperLocation(callig.platform = c("python3")[1], full.path = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getCallerWrapperLocation_+3A_callig.platform">callig.platform</code></td>
<td>
<p>A <em>string</em> specifying the desired wrapper.
Currently it can be &quot;python3&quot;.</p>
</td></tr>
<tr><td><code id="getCallerWrapperLocation_+3A_full.path">full.path</code></td>
<td>
<p>A <em>logical</em> specifying if the returned path should
also include the wrapper's main file name.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>In most cases, these wrappers are one or more files in the calling language
that may be directly used as such.
For more details see the vignette describing the included reference
<code>Python 3</code> wrapper.
</p>


<h3>Value</h3>

<p>The full path to the requested wrapper or NULL if none exists.
</p>

<hr>
<h2 id='getCMA'>Access the actual CMA estimate from a CMA object.</h2><span id='topic+getCMA'></span>

<h3>Description</h3>

<p>Retrieve the actual CMA estimate(s) encapsulated in a simple, per episode,
or sliding window CMA object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getCMA(
  x,
  flatten.medication.groups = FALSE,
  medication.groups.colname = ".MED_GROUP_ID"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getCMA_+3A_x">x</code></td>
<td>
<p>a CMA object.</p>
</td></tr>
<tr><td><code id="getCMA_+3A_flatten.medication.groups">flatten.medication.groups</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> and there are
medication groups defined, then the return value is flattened to a single
<code>data.frame</code> with an extra column containing the medication group (its
name is given by <code>medication.groups.colname</code>).</p>
</td></tr>
<tr><td><code id="getCMA_+3A_medication.groups.colname">medication.groups.colname</code></td>
<td>
<p>a <em>string</em> (defaults to &quot;.MED_GROUP_ID&quot;)
giving the name of the column storing the group name when
<code>flatten.medication.groups</code> is <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <em>data.frame</em> containing the CMA estimate(s).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cma1 &lt;- CMA1(data=med.events,
             ID.colname="PATIENT_ID",
             event.date.colname="DATE",
             event.duration.colname="DURATION",
             followup.window.start=30,
             observation.window.start=30,
             observation.window.duration=365,
             date.format="%m/%d/%Y"
            );
getCMA(cma1);
## Not run: 
cmaE &lt;- CMA_per_episode(CMA="CMA1",
                        data=med.events,
                        ID.colname="PATIENT_ID",
                        event.date.colname="DATE",
                        event.duration.colname="DURATION",
                        event.daily.dose.colname="PERDAY",
                        medication.class.colname="CATEGORY",
                        carry.only.for.same.medication=FALSE,
                        consider.dosage.change=FALSE,
                        followup.window.start=0,
                        observation.window.start=0,
                        observation.window.duration=365,
                        date.format="%m/%d/%Y"
                       );
getCMA(cmaE);
## End(Not run)
</code></pre>

<hr>
<h2 id='getEventInfo'>Access the event info from a CMA object.</h2><span id='topic+getEventInfo'></span>

<h3>Description</h3>

<p>Retrieve the event info encapsulated in a simple, per episode,
or sliding window CMA object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getEventInfo(
  x,
  flatten.medication.groups = FALSE,
  medication.groups.colname = ".MED_GROUP_ID"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getEventInfo_+3A_x">x</code></td>
<td>
<p>a CMA object.</p>
</td></tr>
<tr><td><code id="getEventInfo_+3A_flatten.medication.groups">flatten.medication.groups</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> and there are
medication groups defined, then the return value is flattened to a single
<code>data.frame</code> with an extra column containing the medication group (its
name is given by <code>medication.groups.colname</code>).</p>
</td></tr>
<tr><td><code id="getEventInfo_+3A_medication.groups.colname">medication.groups.colname</code></td>
<td>
<p>a <em>string</em> (defaults to &quot;.MED_GROUP_ID&quot;)
giving the name of the column storing the group name when
<code>flatten.medication.groups</code> is <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <em>data.frame</em> containing the CMA estimate(s).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cma1 &lt;- CMA1(data=med.events,
             ID.colname="PATIENT_ID",
             event.date.colname="DATE",
             event.duration.colname="DURATION",
             followup.window.start=30,
             observation.window.start=30,
             observation.window.duration=365,
             date.format="%m/%d/%Y"
            );
getEventInfo(cma1);
</code></pre>

<hr>
<h2 id='getEventsToEpisodesMapping'>getEventsToEpisodesMapping</h2><span id='topic+getEventsToEpisodesMapping'></span>

<h3>Description</h3>

<p>This function returns the event-to-episode mapping, if this information exists.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getEventsToEpisodesMapping(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getEventsToEpisodesMapping_+3A_x">x</code></td>
<td>
<p>Either a <code>data.frame</code> as returned by <code>compute.treatment.episodes()</code>
or an <code>CMA_per_episode object</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>There are cases where it is interesting to know which events belong to which
episodes and which events have been actually used in computing the simple CMA
for each episode.
This information can be returned by <code>compute.treatment.episodes()</code> and
<code>CMA_per_episode()</code> if the parameter <code>return.mapping.events.episodes</code>
is set to <code>TRUE</code>.
</p>


<h3>Value</h3>

<p>The mapping between events and episodes, if it exists either as the
attribute <code>mapping.episodes.to.events</code> of the <code>data.frame</code> or as the
<code>mapping.episodes.to.events</code> component of the <code>CMA_per_episode object</code>
object, or <code>NULL</code> otherwise.
</p>

<hr>
<h2 id='getEventsToSlidingWindowsMapping'>getEventsToSlidingWindowsMapping</h2><span id='topic+getEventsToSlidingWindowsMapping'></span>

<h3>Description</h3>

<p>This function returns the event-to-sliding-window mapping, if this information exists.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getEventsToSlidingWindowsMapping(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getEventsToSlidingWindowsMapping_+3A_x">x</code></td>
<td>
<p>is an <code>CMA_sliding_window object</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>There are cases where it is interesting to know which events belong to which
sliding windows and which events have been actually used in computing the simple CMA
for each sliding window
This information can be returned by <code>CMA_sliding_window()</code> if the
parameter <code>return.mapping.events.episodes</code> is set to <code>TRUE</code>.
</p>


<h3>Value</h3>

<p>The mapping between events and episodes, if it exists as the
<code>mapping.windows.to.events</code> component of the <code>CMA_sliding_window object</code>
object, or <code>NULL</code> otherwise.
</p>

<hr>
<h2 id='getInnerEventInfo'>Access the inner event info from a complex CMA object.</h2><span id='topic+getInnerEventInfo'></span>

<h3>Description</h3>

<p>Retrieve the event info encapsulated in a complex (i.e., per episode
or sliding window) CMA object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getInnerEventInfo(
  x,
  flatten.medication.groups = FALSE,
  medication.groups.colname = ".MED_GROUP_ID"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getInnerEventInfo_+3A_x">x</code></td>
<td>
<p>a CMA object.</p>
</td></tr>
<tr><td><code id="getInnerEventInfo_+3A_flatten.medication.groups">flatten.medication.groups</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> and there are
medication groups defined, then the return value is flattened to a single
<code>data.frame</code> with an extra column containing the medication group (its
name is given by <code>medication.groups.colname</code>).</p>
</td></tr>
<tr><td><code id="getInnerEventInfo_+3A_medication.groups.colname">medication.groups.colname</code></td>
<td>
<p>a <em>string</em> (defaults to &quot;.MED_GROUP_ID&quot;)
giving the name of the column storing the group name when
<code>flatten.medication.groups</code> is <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <em>data.frame</em> containing the CMA estimate(s).
</p>

<hr>
<h2 id='getMGs'>Access the medication groups of a CMA object.</h2><span id='topic+getMGs'></span>

<h3>Description</h3>

<p>Retrieve the medication groups and the observations they refer to (if any).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getMGs(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getMGs_+3A_x">x</code></td>
<td>
<p>a CMA object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <em>list</em> with two members:
</p>

<ul>
<li> <p><code>defs</code> A <code>data.frame</code> containing the names and definitions of
the medication classes; please note that there is an extra class
<em>__ALL_OTHERS__</em> containing all the observations not selected by any of
the explicitly given medication classes.
</p>
</li>
<li> <p><code>obs</code> A <code>logical matrix</code> where the columns are the medication
classes (the last being <em>__ALL_OTHERS__</em>), and the rows the observations in
the x's data; element <code class="reqn">(i,j)</code> is <code>TRUE</code> iff observation <code class="reqn">j</code> was
selected by medication class <code class="reqn">i</code>.
</p>
</li></ul>


<hr>
<h2 id='last.plot.get.info'>Access last adherence plot info.</h2><span id='topic+last.plot.get.info'></span>

<h3>Description</h3>

<p>Returns the full info the last adherence plot, to be used to modify and/or to
add new elements to this plot.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>last.plot.get.info()
</code></pre>


<h3>Details</h3>

<p>This is intended for advanced users only.
It may return <code>NULL</code> if no plotting was generated yet, but if one was, a
list contaning one named element for each type of plot produced (currently only
<em>baseR</em> and <em>SVG</em> are used).
For all types of plots there are a set of <em>mapping</em> functions useful for
transforming events in plotting coordinates: <code>.map.event.x(x)</code> takes a
number of days <code>x</code>, <code>.map.event.date(d, adjust.for.earliest.date=TRUE)</code>
takes a <code>Date</code> <code>d</code> (and implictely adjusts for the earilerst date
plotted), and  <code>.map.event.y(y)</code> takes a row (&quot;event&quot; number) <code>y</code>.
Besides the shared elements (see the returned value), there are specific ones
as well.
For <em>baseR</em>, the members <em>old.par</em> and <em>used.par</em> contain the
original (pre-plot) <code>par()</code> environment and the one used within
<code>plot()</code>, respectively, in case these need restoring.
</p>


<h3>Value</h3>

<p>A <code>list</code> (possibly empty) contaning one named element for each type
of plot produced (currently only <em>baseR</em> and <em>SVG</em>). Each may contain
shared and specific fields concerning:
</p>

<ul>
<li><p> the values of the parameters with which <code>plot()</code> was invoked.
</p>
</li>
<li><p> actual plot size and other characteristics.
</p>
</li>
<li><p> actual title, axis names and labels and their position and size.
</p>
</li>
<li><p> legend size, position and size and position of its components.
</p>
</li>
<li><p> expanded <code>cma$data</code> contaning, for each event, info about its
plotting, including the corresponding fullow-uo and observation windows,
event start and end, dose text (if any) and other graphical elements.
</p>
</li>
<li><p> position, size of the partial CMAs (if any) and of their components.
</p>
</li>
<li><p> position, size of the plotted CMAs (if any) and of their components.
</p>
</li>
<li><p> rescaling function(s) useful for mapping events to plotting coordinates.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>cma7 &lt;- CMA7(data=med.events[med.events$PATIENT_ID %in% c(1,2),],
             ID.colname="PATIENT_ID",
             event.date.colname="DATE",
             event.duration.colname="DURATION",
             event.daily.dose.colname="PERDAY",
             medication.class.colname="CATEGORY",
             followup.window.start=0,
             followup.window.start.unit="days",
             followup.window.duration=2*365,
             followup.window.duration.unit="days",
             observation.window.start=30,
             observation.window.start.unit="days",
             observation.window.duration=365,
             observation.window.duration.unit="days",
             date.format="%m/%d/%Y",
             summary="Base CMA");
plot(cma7);
tmp &lt;- last.plot.get.info();
names(tmp);
tmp$baseR$legend$box; # legend position and size
head(tmp$baseR$cma$data); # events + plotting info
# Add a transparent blue rect between days 270 and 900:
rect(tmp$baseR$.map.event.x(270), tmp$baseR$.map.event.y(1-0.5),
     tmp$baseR$.map.event.x(900), tmp$baseR$.map.event.y(nrow(tmp$baseR$cma$data)+0.5),
     col=adjustcolor("blue",alpha.f=0.5), border="blue");
# Add a transparent rect rect between dates 03/15/2036 and 03/15/2037:
rect(tmp$baseR$.map.event.date(as.Date("03/15/2036", format="%m/%d/%Y")),
     tmp$baseR$.map.event.y(1-0.5),
     tmp$baseR$.map.event.date(as.Date("03/15/2037", format="%m/%d/%Y")),
     tmp$baseR$.map.event.y(nrow(tmp$baseR$cma$data)+0.5),
     col=adjustcolor("red",alpha.f=0.5), border="blue");
</code></pre>

<hr>
<h2 id='map.event.coords.to.plot'>Map from event to plot coordinates.</h2><span id='topic+map.event.coords.to.plot'></span>

<h3>Description</h3>

<p>Maps the (x,y) coordinates in the event space to the plotting space.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>map.event.coords.to.plot(
  x = NA,
  y = NA,
  x.is.Date = FALSE,
  x.date.format = "%m/%d/%Y",
  adjust.for.earliest.date = TRUE,
  plot.type = c("baseR", "SVG")[1],
  suppress.warnings = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="map.event.coords.to.plot_+3A_x">x</code></td>
<td>
<p>The <em>x</em> coordinate in the event space, either a <code>number</code> giving the
number of days since the earliest plotted date, or a <code>Date</code> or a <code>string</code> in
the format given by the <em>x.date.format</em> parameter giving the actual calendar date.</p>
</td></tr>
<tr><td><code id="map.event.coords.to.plot_+3A_y">y</code></td>
<td>
<p>The <em>y</em> coordinate in the event space, thus a <code>number</code> giving the
plot row.</p>
</td></tr>
<tr><td><code id="map.event.coords.to.plot_+3A_x.is.date">x.is.Date</code></td>
<td>
<p>A <code>logical</code>, being <code>TRUE</code> if <em>x</em> is a string giving the
date in the <em>x.date.format</em> format.</p>
</td></tr>
<tr><td><code id="map.event.coords.to.plot_+3A_x.date.format">x.date.format</code></td>
<td>
<p>A <code>string</code> giving the format of the <em>x</em> date, if
<em>x.is.Date</em> id <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="map.event.coords.to.plot_+3A_adjust.for.earliest.date">adjust.for.earliest.date</code></td>
<td>
<p>A <code>logical</code> which is <code>TRUE</code> if <em>x</em> is a
calendar date that must be adjusted for the earliest plotted date (by default
<code>TRUE</code>).</p>
</td></tr>
<tr><td><code id="map.event.coords.to.plot_+3A_plot.type">plot.type</code></td>
<td>
<p>Can be either &quot;baseR&quot; or &quot;SVG&quot; and specifies to which type of plotting
the mapping applies.</p>
</td></tr>
<tr><td><code id="map.event.coords.to.plot_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any
warnings.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is intended for advanced users only.
In the event space, the <em>x</em> coordinate can be either given as the number of
days since the first plotted event, or as an actual calendar date (either as a
<code>Date</code> object or a string with a given format; a date may or may not be corrected
relative to the first displayed date). On the <em>y</em> coordinate, the plotting is
divided in equally spaced rows, each row corresponding to a single event or an element
of a partial CMA plot (one can specify in between rows using fractions). Any or both of
<em>x</em> and <em>y</em> can be missing.
</p>


<h3>Value</h3>

<p>A numeric vector with <em>x</em> and <em>y</em> components giving the plotting
coordinates, or <code>NULL</code> in case of error.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cma7 &lt;- CMA7(data=med.events[med.events$PATIENT_ID %in% c(1,2),],
             ID.colname="PATIENT_ID",
             event.date.colname="DATE",
             event.duration.colname="DURATION",
             event.daily.dose.colname="PERDAY",
             medication.class.colname="CATEGORY",
             followup.window.start=0,
             followup.window.start.unit="days",
             followup.window.duration=2*365,
             followup.window.duration.unit="days",
             observation.window.start=30,
             observation.window.start.unit="days",
             observation.window.duration=365,
             observation.window.duration.unit="days",
             date.format="%m/%d/%Y",
             summary="Base CMA");
plot(cma7);
# Add a transparent blue rect:
rect(map.event.coords.to.plot(x=270),
     get.event.plotting.area()["y.min"]-1,
     map.event.coords.to.plot(x="03/15/2037", x.is.Date=TRUE, x.date.format="%m/%d/%Y"),
     get.event.plotting.area()["y.max"]+1,
     col=adjustcolor("blue",alpha.f=0.5), border="blue");
</code></pre>

<hr>
<h2 id='med.events'>Example medication events records for 100 patients.</h2><span id='topic+med.events'></span>

<h3>Description</h3>

<p>An artificial dataset containing medication events (one per row) for 100
patients (1080 events in total). This is the dataset format appropriate for
medication adherence analyses performed with the R package AdhereR.
Medication events represent individual records of prescribing or dispensing
a specific medication for a patient at a given date. Dosage and medication
type is optional (only needed if calculation of adherence or persistence
takes into account changes in dosage and type of medication).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>med.events
</code></pre>


<h3>Format</h3>

<p>A data frame with 1080 rows and 5 variables:
</p>

<dl>
<dt>PATIENT_ID</dt><dd><p><em>integer</em> here; patient unique identifier. Can also
be <em>string</em></p>
</dd></dl>
<p>.
</p>
<dl>
<dt>DATE</dt><dd><p><em>character</em>;the medication event date, by default in the
mm/dd/yyyy format. It may represent a prescribing or dispensing date.</p>
</dd>
<dt>PERDAY</dt><dd><p><em>integer</em>; the daily dosage prescribed for the
medication supplied at this medication event (i.e. how many doses should
be taken daily according to the prescription). This column is optional,
as it is not considered in all functions but may be relevant for specific
research or clinical contexts. All values should be &gt; 0.</p>
</dd>
<dt>CATEGORY</dt><dd><p><em>character</em>; the medication type, here two placeholder
labels, 'medA' and 'medB'. This is a researcher-defined classification
depending on study aims (e.g., based on therapeutic use, mechanism of
action, chemical molecule, or pharmaceutical formulation). This column is
optional, as it is not considered in all functions but may be relevant for
specific research or clinical contexts.</p>
</dd>
<dt>DURATION</dt><dd><p><em>integer</em>; the medication event duration in days (i.e.
how many days the mediation supplied would last if used as prescribed);
may be available in the extraction or computed based on quantity supplied
(the number of doses prescribed or dispensed on that occasion) and daily
dosage. All values should be &gt; 0.</p>
</dd>
</dl>


<hr>
<h2 id='med.events.ATC'>Example of medication events with ATC codes.</h2><span id='topic+med.events.ATC'></span>

<h3>Description</h3>

<p>An artificial dataset containing medication events (one per row) for 16
patients (1564 events in total), containing ATC codes. This dataset is
derived from the <code>durcomp</code> datasets using the <code>compute_event_durations</code>
function. See @med.events for more details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>med.events.ATC
</code></pre>


<h3>Format</h3>

<p>A data frame with 1564 rows and 7 variables:
</p>

<dl>
<dt>PATIENT_ID</dt><dd><p>the patient unique identifier.</p>
</dd>
<dt>DATE</dt><dd><p>the medication event date.</p>
</dd>
<dt>DURATION</dt><dd><p>the duration in days.</p>
</dd>
<dt>PERDAY</dt><dd><p>the daily dosage.</p>
</dd>
<dt>CATEGORY</dt><dd><p>the ATC code.</p>
</dd>
<dt>CATEGORY_L1</dt><dd><p>explicitation of the first field of the ATC code (e.g.,
&quot;A&quot;=&quot;ALIMENTARY TRACT AND METABOLISM&quot;).</p>
</dd>
<dt>CATEGORY_L2</dt><dd><p>explicitation of the first and second fields of the ATC
code (e.g., &quot;A02&quot;=&quot;DRUGS FOR ACID RELATED DISORDERS&quot;).</p>
</dd>
</dl>


<hr>
<h2 id='med.groups'>Example of medication groups.</h2><span id='topic+med.groups'></span>

<h3>Description</h3>

<p>An example defining 6 medication groups for <code>med.events.ATC</code>.
It is a <em>named character vector</em>, where the names are the medication
group unique <em>names</em> (e.g., &quot;Vitamines&quot;) and the elements are the medication
group <em>definitions</em> (e.g., &quot;(CATEGORY_L2 == 'VITAMINS')&quot;).
The definitions are <code>R</code> logical expressions using <em>column names</em> and
<em>values</em> that appear in the dataset, as well as references to other
medication groups using the construction <em>&quot;NAME&quot;</em>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>med.groups
</code></pre>


<h3>Format</h3>

<p>An object of class <code>character</code> of length 6.
</p>


<h3>Details</h3>

<p>In the above example, &quot;CATEGORY_L2&quot; is a column name in the <code>med.events.ATC</code>
dataset, and 'VITAMINS' one of its possible values, and which selects all events
that have prescribed ATC codes &quot;A11&quot; (aka &quot;VITAMINS&quot;).
Another example is &quot;NotVita&quot; defined as &quot;(!Vitamines)&quot;, which selects all
events that do not have Vitamines prescribed.
</p>
<p>For more details, please see the acompanying vignette.
</p>

<hr>
<h2 id='plot_interactive_cma'>Interactive exploration and CMA computation.</h2><span id='topic+plot_interactive_cma'></span>

<h3>Description</h3>

<p>Interactively plot a given patient's data, allowing the real-time exploration
of the various CMAs and their parameters.
It can use <code>Rstudio</code>'s <code>manipulate</code> library or <code>Shiny</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_interactive_cma(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_interactive_cma_+3A_...">...</code></td>
<td>
<p>Parameters to be passed to <code>plot_interactive_cma()</code> in package
<code>AdhereRViz</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is merely a stub for the actual implementation in package
<code>AdhereRViz</code>: it just checks if this package is installed and functional,
in which case it calls the actual implementation, otherwise warns the user that
<code>AdhereRViz</code> must be instaled.
</p>


<h3>Value</h3>

<p>Nothing
</p>


<h3>See Also</h3>

<p>Function <code><a href="#topic+plot_interactive_cma">plot_interactive_cma</a></code> in package
<code>AdhereRViz</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
plot_interactive_cma(med.events,
                     ID.colname="PATIENT_ID",
                     event.date.colname="DATE",
                     event.duration.colname="DURATION",
                     event.daily.dose.colname="PERDAY",
                     medication.class.colname="CATEGORY");
## End(Not run)
</code></pre>

<hr>
<h2 id='plot.CMA_per_episode'>Plot CMA_per_episode and CMA_sliding_window objects.</h2><span id='topic+plot.CMA_per_episode'></span><span id='topic+plot.CMA_sliding_window'></span>

<h3>Description</h3>

<p>Plots the event data and the estimated CMA per treatment episode and sliding
window, respectively.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'CMA_per_episode'
plot(
  x,
  patients.to.plot = NULL,
  duration = NA,
  align.all.patients = FALSE,
  align.first.event.at.zero = FALSE,
  show.period = c("dates", "days")[2],
  period.in.days = 90,
  show.legend = TRUE,
  legend.x = "right",
  legend.y = "bottom",
  legend.bkg.opacity = 0.5,
  legend.cex = 0.75,
  legend.cex.title = 1,
  cex = 1,
  cex.axis = 0.75,
  cex.lab = 1,
  show.cma = TRUE,
  xlab = c(dates = "Date", days = "Days"),
  ylab = c(withoutCMA = "patient", withCMA = "patient (&amp; CMA)"),
  title = c(aligned = "Event patterns (all patients aligned)", notaligned =
    "Event patterns"),
  col.cats = rainbow,
  unspecified.category.label = "drug",
  medication.groups.to.plot = NULL,
  medication.groups.separator.show = TRUE,
  medication.groups.separator.lty = "solid",
  medication.groups.separator.lwd = 2,
  medication.groups.separator.color = "blue",
  medication.groups.allother.label = "*",
  lty.event = "solid",
  lwd.event = 2,
  pch.start.event = 15,
  pch.end.event = 16,
  show.event.intervals = FALSE,
  show.overlapping.event.intervals = c("first", "last", "min gap", "max gap",
    "average")[1],
  plot.events.vertically.displaced = TRUE,
  print.dose = FALSE,
  cex.dose = 0.75,
  print.dose.outline.col = "white",
  print.dose.centered = FALSE,
  plot.dose = FALSE,
  lwd.event.max.dose = 8,
  plot.dose.lwd.across.medication.classes = FALSE,
  col.na = "lightgray",
  col.continuation = "black",
  lty.continuation = "dotted",
  lwd.continuation = 1,
  print.CMA = TRUE,
  CMA.cex = 0.5,
  plot.CMA = TRUE,
  plot.CMA.as.histogram = TRUE,
  plot.partial.CMAs.as = c("stacked", "overlapping", "timeseries")[1],
  plot.partial.CMAs.as.stacked.col.bars = "gray90",
  plot.partial.CMAs.as.stacked.col.border = "gray30",
  plot.partial.CMAs.as.stacked.col.text = "black",
  plot.partial.CMAs.as.timeseries.vspace = 7,
  plot.partial.CMAs.as.timeseries.start.from.zero = TRUE,
  plot.partial.CMAs.as.timeseries.col.dot = "darkblue",
  plot.partial.CMAs.as.timeseries.col.interval = "gray70",
  plot.partial.CMAs.as.timeseries.col.text = "firebrick",
  plot.partial.CMAs.as.timeseries.interval.type = c("none", "segments", "arrows",
    "lines", "rectangles")[2],
  plot.partial.CMAs.as.timeseries.lwd.interval = 1,
  plot.partial.CMAs.as.timeseries.alpha.interval = 0.25,
  plot.partial.CMAs.as.timeseries.show.0perc = TRUE,
  plot.partial.CMAs.as.timeseries.show.100perc = FALSE,
  plot.partial.CMAs.as.overlapping.alternate = TRUE,
  plot.partial.CMAs.as.overlapping.col.interval = "gray70",
  plot.partial.CMAs.as.overlapping.col.text = "firebrick",
  CMA.plot.ratio = 0.1,
  CMA.plot.col = "lightgreen",
  CMA.plot.border = "darkgreen",
  CMA.plot.bkg = "aquamarine",
  CMA.plot.text = CMA.plot.border,
  highlight.followup.window = TRUE,
  followup.window.col = "green",
  highlight.observation.window = TRUE,
  observation.window.col = "yellow",
  observation.window.opacity = 0.3,
  print.episode.or.sliding.window = FALSE,
  alternating.bands.cols = c("white", "gray95"),
  bw.plot = FALSE,
  rotate.text = -60,
  force.draw.text = FALSE,
  min.plot.size.in.characters.horiz = 0,
  min.plot.size.in.characters.vert = 0,
  max.patients.to.plot = 100,
  export.formats = NULL,
  export.formats.fileprefix = "AdhereR-plot",
  export.formats.height = NA,
  export.formats.width = NA,
  export.formats.save.svg.placeholder = TRUE,
  export.formats.svg.placeholder.type = c("jpg", "png", "webp")[2],
  export.formats.svg.placeholder.embed = FALSE,
  export.formats.html.template = NULL,
  export.formats.html.javascript = NULL,
  export.formats.html.css = NULL,
  export.formats.directory = NA,
  generate.R.plot = TRUE,
  do.not.draw.plot = FALSE,
  suppress.warnings = FALSE,
  ...
)

## S3 method for class 'CMA_sliding_window'
plot(
  x,
  patients.to.plot = NULL,
  duration = NA,
  align.all.patients = FALSE,
  align.first.event.at.zero = FALSE,
  show.period = c("dates", "days")[2],
  period.in.days = 90,
  show.legend = TRUE,
  legend.x = "right",
  legend.y = "bottom",
  legend.bkg.opacity = 0.5,
  legend.cex = 0.75,
  legend.cex.title = 1,
  cex = 1,
  cex.axis = 0.75,
  cex.lab = 1,
  show.cma = TRUE,
  xlab = c(dates = "Date", days = "Days"),
  ylab = c(withoutCMA = "patient", withCMA = "patient (&amp; CMA)"),
  title = c(aligned = "Event patterns (all patients aligned)", notaligned =
    "Event patterns"),
  col.cats = rainbow,
  unspecified.category.label = "drug",
  medication.groups.to.plot = NULL,
  medication.groups.separator.show = TRUE,
  medication.groups.separator.lty = "solid",
  medication.groups.separator.lwd = 2,
  medication.groups.separator.color = "blue",
  medication.groups.allother.label = "*",
  lty.event = "solid",
  lwd.event = 2,
  pch.start.event = 15,
  pch.end.event = 16,
  show.event.intervals = FALSE,
  show.overlapping.event.intervals = c("first", "last", "min gap", "max gap",
    "average")[1],
  plot.events.vertically.displaced = TRUE,
  print.dose = FALSE,
  cex.dose = 0.75,
  print.dose.outline.col = "white",
  print.dose.centered = FALSE,
  plot.dose = FALSE,
  lwd.event.max.dose = 8,
  plot.dose.lwd.across.medication.classes = FALSE,
  col.na = "lightgray",
  col.continuation = "black",
  lty.continuation = "dotted",
  lwd.continuation = 1,
  print.CMA = TRUE,
  CMA.cex = 0.5,
  plot.CMA = TRUE,
  plot.CMA.as.histogram = TRUE,
  plot.partial.CMAs.as = c("stacked", "overlapping", "timeseries")[1],
  plot.partial.CMAs.as.stacked.col.bars = "gray90",
  plot.partial.CMAs.as.stacked.col.border = "gray30",
  plot.partial.CMAs.as.stacked.col.text = "black",
  plot.partial.CMAs.as.timeseries.vspace = 7,
  plot.partial.CMAs.as.timeseries.start.from.zero = TRUE,
  plot.partial.CMAs.as.timeseries.col.dot = "darkblue",
  plot.partial.CMAs.as.timeseries.col.interval = "gray70",
  plot.partial.CMAs.as.timeseries.col.text = "firebrick",
  plot.partial.CMAs.as.timeseries.interval.type = c("none", "segments", "arrows",
    "lines", "rectangles")[2],
  plot.partial.CMAs.as.timeseries.lwd.interval = 1,
  plot.partial.CMAs.as.timeseries.alpha.interval = 0.25,
  plot.partial.CMAs.as.timeseries.show.0perc = TRUE,
  plot.partial.CMAs.as.timeseries.show.100perc = FALSE,
  plot.partial.CMAs.as.overlapping.alternate = TRUE,
  plot.partial.CMAs.as.overlapping.col.interval = "gray70",
  plot.partial.CMAs.as.overlapping.col.text = "firebrick",
  CMA.plot.ratio = 0.1,
  CMA.plot.col = "lightgreen",
  CMA.plot.border = "darkgreen",
  CMA.plot.bkg = "aquamarine",
  CMA.plot.text = CMA.plot.border,
  highlight.followup.window = TRUE,
  followup.window.col = "green",
  highlight.observation.window = TRUE,
  observation.window.col = "yellow",
  observation.window.opacity = 0.3,
  print.episode.or.sliding.window = FALSE,
  alternating.bands.cols = c("white", "gray95"),
  bw.plot = FALSE,
  rotate.text = -60,
  force.draw.text = FALSE,
  min.plot.size.in.characters.horiz = 0,
  min.plot.size.in.characters.vert = 0,
  max.patients.to.plot = 100,
  export.formats = NULL,
  export.formats.fileprefix = "AdhereR-plot",
  export.formats.height = NA,
  export.formats.width = NA,
  export.formats.save.svg.placeholder = TRUE,
  export.formats.svg.placeholder.type = c("jpg", "png", "webp")[2],
  export.formats.svg.placeholder.embed = FALSE,
  export.formats.html.template = NULL,
  export.formats.html.javascript = NULL,
  export.formats.html.css = NULL,
  export.formats.directory = NA,
  generate.R.plot = TRUE,
  do.not.draw.plot = FALSE,
  suppress.warnings = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.CMA_per_episode_+3A_x">x</code></td>
<td>
<p>A <em><code>CMA0</code></em> or derived object, representing the CMA to
plot</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_patients.to.plot">patients.to.plot</code></td>
<td>
<p>A vector of <em>strings</em> containing the list of
patient IDs to plot (a subset of those in the <code>cma</code> object), or
<code>NULL</code> for all</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_duration">duration</code></td>
<td>
<p>A <em>number</em>, the total duration (in days) of the whole
period to plot; in <code>NA</code> it is automatically determined from the event
data such that the whole dataset fits.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_align.all.patients">align.all.patients</code></td>
<td>
<p><em>Logical</em>, should all patients be aligned
(i.e., the actual dates are discarded and all plots are relative to the
earliest date)?</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_align.first.event.at.zero">align.first.event.at.zero</code></td>
<td>
<p><em>Logical</em>, should the first event be
placed at the origin of the time axis (at 0)?</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_show.period">show.period</code></td>
<td>
<p>A <em>string</em>, if &quot;dates&quot; show the actual dates at the
regular grid intervals, while for &quot;days&quot; (the default) shows the days since
the beginning; if <code>align.all.patients == TRUE</code>, <code>show.period</code> is
taken as &quot;days&quot;.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_period.in.days">period.in.days</code></td>
<td>
<p>The <em>number</em> of days at which the regular grid is
drawn (or 0 for no grid).</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_show.legend">show.legend</code></td>
<td>
<p><em>Logical</em>, should the legend be drawn?</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_legend.x">legend.x</code></td>
<td>
<p>The position of the legend on the x axis; can be &quot;left&quot;,
&quot;right&quot; (default), or a <em>numeric</em> value.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_legend.y">legend.y</code></td>
<td>
<p>The position of the legend on the y axis; can be &quot;bottom&quot;
(default), &quot;top&quot;, or a <em>numeric</em> value.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_legend.bkg.opacity">legend.bkg.opacity</code></td>
<td>
<p>A <em>number</em> between 0.0 and 1.0 specifying the
opacity of the legend background.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_legend.cex">legend.cex</code>, <code id="plot.CMA_per_episode_+3A_legend.cex.title">legend.cex.title</code></td>
<td>
<p>The legend and legend title font sizes.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_cex">cex</code>, <code id="plot.CMA_per_episode_+3A_cex.axis">cex.axis</code>, <code id="plot.CMA_per_episode_+3A_cex.lab">cex.lab</code></td>
<td>
<p><em>numeric</em> values specifying the cex of the
various types of text.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_show.cma">show.cma</code></td>
<td>
<p><em>Logical</em>, should the CMA type be shown in the title?</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_xlab">xlab</code></td>
<td>
<p>Named vector of x-axis labels to show for the two types of periods
(&quot;days&quot; and &quot;dates&quot;), or a single value for both, or <code>NULL</code> for nothing.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_ylab">ylab</code></td>
<td>
<p>Named vector of y-axis labels to show without and with CMA estimates,
or a single value for both, or <code>NULL</code> for nonthing.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_title">title</code></td>
<td>
<p>Named vector of titles to show for and without alignment, or a
single value for both, or <code>NULL</code> for nonthing.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_col.cats">col.cats</code></td>
<td>
<p>A <em>color</em> or a <em>function</em> that specifies the single
colour or the colour palette used to plot the different medication; by
default <code>rainbow</code>, but we recommend, whenever possible, a
colorblind-friendly palette such as <code>viridis</code> or <code>colorblind_pal</code>.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_unspecified.category.label">unspecified.category.label</code></td>
<td>
<p>A <em>string</em> giving the name of the
unspecified (generic) medication category.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_medication.groups.to.plot">medication.groups.to.plot</code></td>
<td>
<p>the names of the medication groups to plot or
<code>NULL</code> (the default) for all.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_medication.groups.separator.show">medication.groups.separator.show</code></td>
<td>
<p>a <em>boolean</em>, if <code>TRUE</code> (the
default) visually mark the medication groups the belong to the same patient,
using horizontal lines and alternating vertical lines.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_medication.groups.separator.lty">medication.groups.separator.lty</code>, <code id="plot.CMA_per_episode_+3A_medication.groups.separator.lwd">medication.groups.separator.lwd</code>, <code id="plot.CMA_per_episode_+3A_medication.groups.separator.color">medication.groups.separator.color</code></td>
<td>
<p>graphical parameters (line type, line width and colour describing the visual
marking og medication groups as beloning to the same patient.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_medication.groups.allother.label">medication.groups.allother.label</code></td>
<td>
<p>a <em>string</em> giving the label to
use for the implicit <code>__ALL_OTHERS__</code> medication group (defaults to &quot;*&quot;).</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_lty.event">lty.event</code>, <code id="plot.CMA_per_episode_+3A_lwd.event">lwd.event</code>, <code id="plot.CMA_per_episode_+3A_pch.start.event">pch.start.event</code>, <code id="plot.CMA_per_episode_+3A_pch.end.event">pch.end.event</code></td>
<td>
<p>The style of the
event (line style, width, and start and end symbols).</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_show.event.intervals">show.event.intervals</code></td>
<td>
<p><em>Logical</em>, should the actual event intervals
be shown? As per-episode and sliding windows might have overlapping intervals,
it is better not to show them by default (<code>FALSE</code>).</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_show.overlapping.event.intervals">show.overlapping.event.intervals</code></td>
<td>
<p>specifies how to plot the event
intervals that appear in multiple sliding windows or episodes. We can plot
how thye look in the <em>first</em> sliding window or episode (the default),
how they appear in the <em>last</em>, pick the one that minimizes the gap
(<em>min gap</em>) or maximizes it (<em>max gap</em>), or compute their
<em>average</em> across all sliding windows or episodes containing them.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_plot.events.vertically.displaced">plot.events.vertically.displaced</code></td>
<td>
<p>Should consecutive events be plotted
on separate rows (i.e., separated vertically, the default) or on the same row?</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_print.dose">print.dose</code>, <code id="plot.CMA_per_episode_+3A_cex.dose">cex.dose</code>, <code id="plot.CMA_per_episode_+3A_print.dose.outline.col">print.dose.outline.col</code>, <code id="plot.CMA_per_episode_+3A_print.dose.centered">print.dose.centered</code></td>
<td>
<p>Print daily
dose as a number and, if so, how (color, size, position...).</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_plot.dose">plot.dose</code>, <code id="plot.CMA_per_episode_+3A_lwd.event.max.dose">lwd.event.max.dose</code>, <code id="plot.CMA_per_episode_+3A_plot.dose.lwd.across.medication.classes">plot.dose.lwd.across.medication.classes</code></td>
<td>
<p>Show dose through the width of the event lines and, if so, what the maximum
width should be, and should this maximum be by medication class or overall.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_col.na">col.na</code></td>
<td>
<p>The colour used for missing event data.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_col.continuation">col.continuation</code>, <code id="plot.CMA_per_episode_+3A_lty.continuation">lty.continuation</code>, <code id="plot.CMA_per_episode_+3A_lwd.continuation">lwd.continuation</code></td>
<td>
<p>The color, style
and width of the contuniation lines connecting consecutive events.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_print.cma">print.CMA</code></td>
<td>
<p><em>Logical</em>, should the CMA values be printed?</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_cma.cex">CMA.cex</code></td>
<td>
<p>... and, if printed, what cex (<em>numeric</em>) to use?</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_plot.cma">plot.CMA</code></td>
<td>
<p><em>Logical</em>, should the distribution of the CMA values
across episodes/sliding windows be plotted? If <code>TRUE</code> (the default), the
distribution is shown on the left-hand side of the plot, otherwise it is not.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_plot.cma.as.histogram">plot.CMA.as.histogram</code></td>
<td>
<p><em>Logical</em>, should the CMA plot be a
histogram or a (truncated) density plot? Please note that it is TRUE by
deafult for CMA_per_episode and FALSE for CMA_sliding_window, because
usually there are more sliding windows than episodes. Also, the density
estimate cannot be estimated for less than three different values.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_plot.partial.cmas.as">plot.partial.CMAs.as</code></td>
<td>
<p>Should the partial CMAs be plotted? Possible values
are &quot;stacked&quot;, &quot;overlapping&quot; or &quot;timeseries&quot;, or <code>NULL</code> for no partial
CMA plots. Please note that <code>plot.CMA</code> and <code>plot.partial.CMAs.as</code>
are independent of each other.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_plot.partial.cmas.as.stacked.col.bars">plot.partial.CMAs.as.stacked.col.bars</code>, <code id="plot.CMA_per_episode_+3A_plot.partial.cmas.as.stacked.col.border">plot.partial.CMAs.as.stacked.col.border</code>, <code id="plot.CMA_per_episode_+3A_plot.partial.cmas.as.stacked.col.text">plot.partial.CMAs.as.stacked.col.text</code></td>
<td>
<p>If plotting the partial CMAs as stacked bars, define their graphical attributes.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_plot.partial.cmas.as.timeseries.vspace">plot.partial.CMAs.as.timeseries.vspace</code>, <code id="plot.CMA_per_episode_+3A_plot.partial.cmas.as.timeseries.start.from.zero">plot.partial.CMAs.as.timeseries.start.from.zero</code>, <code id="plot.CMA_per_episode_+3A_plot.partial.cmas.as.timeseries.col.dot">plot.partial.CMAs.as.timeseries.col.dot</code>, <code id="plot.CMA_per_episode_+3A_plot.partial.cmas.as.timeseries.col.interval">plot.partial.CMAs.as.timeseries.col.interval</code>, <code id="plot.CMA_per_episode_+3A_plot.partial.cmas.as.timeseries.col.text">plot.partial.CMAs.as.timeseries.col.text</code>, <code id="plot.CMA_per_episode_+3A_plot.partial.cmas.as.timeseries.interval.type">plot.partial.CMAs.as.timeseries.interval.type</code>, <code id="plot.CMA_per_episode_+3A_plot.partial.cmas.as.timeseries.lwd.interval">plot.partial.CMAs.as.timeseries.lwd.interval</code>, <code id="plot.CMA_per_episode_+3A_plot.partial.cmas.as.timeseries.alpha.interval">plot.partial.CMAs.as.timeseries.alpha.interval</code>, <code id="plot.CMA_per_episode_+3A_plot.partial.cmas.as.timeseries.show.0perc">plot.partial.CMAs.as.timeseries.show.0perc</code>, <code id="plot.CMA_per_episode_+3A_plot.partial.cmas.as.timeseries.show.100perc">plot.partial.CMAs.as.timeseries.show.100perc</code></td>
<td>
<p>If plotting the partial CMAs as imeseries, these are their graphical attributes.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_plot.partial.cmas.as.overlapping.alternate">plot.partial.CMAs.as.overlapping.alternate</code>, <code id="plot.CMA_per_episode_+3A_plot.partial.cmas.as.overlapping.col.interval">plot.partial.CMAs.as.overlapping.col.interval</code>, <code id="plot.CMA_per_episode_+3A_plot.partial.cmas.as.overlapping.col.text">plot.partial.CMAs.as.overlapping.col.text</code></td>
<td>
<p>If plotting the partial CMAs as overlapping segments, these are their
graphical attributes.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_cma.plot.ratio">CMA.plot.ratio</code></td>
<td>
<p>A <em>number</em>, the proportion of the total horizontal
plot space to be allocated to the CMA plot.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_cma.plot.col">CMA.plot.col</code>, <code id="plot.CMA_per_episode_+3A_cma.plot.border">CMA.plot.border</code>, <code id="plot.CMA_per_episode_+3A_cma.plot.bkg">CMA.plot.bkg</code>, <code id="plot.CMA_per_episode_+3A_cma.plot.text">CMA.plot.text</code></td>
<td>
<p><em>Strings</em>
giving the colours of the various components of the CMA plot.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_highlight.followup.window">highlight.followup.window</code></td>
<td>
<p><em>Logical</em>, should the follow-up window
be plotted?</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_followup.window.col">followup.window.col</code></td>
<td>
<p>The follow-up window colour.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_highlight.observation.window">highlight.observation.window</code></td>
<td>
<p><em>Logical</em>, should the observation
window be plotted?</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_observation.window.col">observation.window.col</code>, <code id="plot.CMA_per_episode_+3A_observation.window.opacity">observation.window.opacity</code></td>
<td>
<p>Attributes of the observation window (colour, transparency).</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_print.episode.or.sliding.window">print.episode.or.sliding.window</code></td>
<td>
<p><em>Logical</em>, should we show which
events belong to which episode or sliding window? To work, the CMA must have
been constructed with <code>return.mapping.events.episodes</code> or
<code>return.mapping.events.sliding.window</code> set to <code>TRUE</code>, respectively.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_alternating.bands.cols">alternating.bands.cols</code></td>
<td>
<p>The colors of the alternating vertical bands
distinguishing the patients; can be <code>NULL</code> = don't draw the bandes;
or a vector of colors.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_bw.plot">bw.plot</code></td>
<td>
<p><em>Logical</em>, should the plot use grayscale only (i.e., the
<code><a href="grDevices.html#topic+gray.colors">gray.colors</a></code> function)?</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_rotate.text">rotate.text</code></td>
<td>
<p><em>Numeric</em>, the angle by which certain text elements
(e.g., axis labels) should be rotated.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_force.draw.text">force.draw.text</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code>, always draw text even
if too big or too small</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_min.plot.size.in.characters.horiz">min.plot.size.in.characters.horiz</code>, <code id="plot.CMA_per_episode_+3A_min.plot.size.in.characters.vert">min.plot.size.in.characters.vert</code></td>
<td>
<p><em>Numeric</em>, the minimum size of the plotting surface in characters;
horizontally (min.plot.size.in.characters.horiz) refers to the the whole
duration of the events to plot; vertically (min.plot.size.in.characters.vert)
refers to a single event. If the plotting is too small, possible solutions
might be: if within <code>RStudio</code>, try to enlarge the &quot;Plots&quot; panel, or
(also valid outside <code>RStudio</code> but not if using <code>RStudio server</code>
start a new plotting device (e.g., using <code>X11()</code>, <code>quartz()</code>
or <code>windows()</code>, depending on OS) or (works always) save to an image
(e.g., <code>jpeg(...); ...; dev.off()</code>) and display it in a viewer.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_max.patients.to.plot">max.patients.to.plot</code></td>
<td>
<p><em>Numeric</em>, the maximum patients to attempt
to plot.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_export.formats">export.formats</code></td>
<td>
<p>a <em>string</em> giving the formats to export the figure
to (by default <code>NULL</code>, meaning no exporting); can be any combination of
&quot;svg&quot; (just an <code>SVG</code> file), &quot;html&quot; (<code>SVG</code> + <code>HTML</code> + <code>CSS</code>
+ <code>JavaScript</code>, all embedded within one <code>HTML</code> document), &quot;jpg&quot;,
&quot;png&quot;, &quot;webp&quot;, &quot;ps&quot; or &quot;pdf&quot;.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_export.formats.fileprefix">export.formats.fileprefix</code></td>
<td>
<p>a <em>string</em> giving the file name prefix
for the exported formats (defaults to &quot;AdhereR-plot&quot;).</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_export.formats.height">export.formats.height</code>, <code id="plot.CMA_per_episode_+3A_export.formats.width">export.formats.width</code></td>
<td>
<p><em>numbers</em> giving the
desired dimensions (in pixels) for the exported figure (defaults to sane
values if <code>NA</code>).</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_export.formats.save.svg.placeholder">export.formats.save.svg.placeholder</code></td>
<td>
<p>a <em>logical</em>, if TRUE, save an
image placeholder of type given by <code>export.formats.svg.placeholder.type</code>
for the <code>SVG</code> image.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_export.formats.svg.placeholder.type">export.formats.svg.placeholder.type</code></td>
<td>
<p>a <em>string</em>, giving the type of
placeholder for the <code>SVG</code> image to save; can be &quot;jpg&quot;,
&quot;png&quot; (the default) or &quot;webp&quot;.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_export.formats.svg.placeholder.embed">export.formats.svg.placeholder.embed</code></td>
<td>
<p>a <em>logical</em>, if <code>TRUE</code>,
embed the placeholder image in the HTML document (if any) using <code>base64</code>
encoding, otherwise (the default) leave it as an external image file (works
only when an <code>HTML</code> document is exported and only for <code>JPEG</code> or
<code>PNG</code> images.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_export.formats.html.template">export.formats.html.template</code>, <code id="plot.CMA_per_episode_+3A_export.formats.html.javascript">export.formats.html.javascript</code>, <code id="plot.CMA_per_episode_+3A_export.formats.html.css">export.formats.html.css</code></td>
<td>
<p><em>character strings</em> or <code>NULL</code> (the default) giving the path to the
<code>HTML</code>, <code>JavaScript</code> and <code>CSS</code> templates, respectively, to be
used when generating the HTML+CSS semi-interactive plots; when <code>NULL</code>,
the default ones included with the package will be used. If you decide to define
new templates please use the default ones for inspiration and note that future
version are not guaranteed to be backwards compatible!</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_export.formats.directory">export.formats.directory</code></td>
<td>
<p>a <em>string</em>; if exporting, which directory
to export to; if <code>NA</code> (the default), creates the files in a temporary
directory.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_generate.r.plot">generate.R.plot</code></td>
<td>
<p>a <em>logical</em>, if <code>TRUE</code> (the default),
generate the standard (base <code>R</code>) plot for plotting within <code>R</code>.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_do.not.draw.plot">do.not.draw.plot</code></td>
<td>
<p>a <em>logical</em>, if <code>TRUE</code> (<em>not</em> the default),
does not draw the plot itself, but only the legend (if <code>show.legend</code> is
<code>TRUE</code>) at coordinates (0,0) irrespective of the given legend coordinates.
This is intended to allow (together with the <code>get.legend.plotting.area()</code>
function) the separate plotting of the legend.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any
warnings.</p>
</td></tr>
<tr><td><code id="plot.CMA_per_episode_+3A_...">...</code></td>
<td>
<p>other parameters (to be passed to the estimation and plotting of
the simple CMA)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The x-axis represents time (either in days since the earliest date or as
actual dates), with consecutive events represented as ascending on the y-axis.
</p>
<p>Each event is represented as a segment with style <code>lty.event</code> and line
width <code>lwd.event</code> starting with a <code>pch.start.event</code> and ending with
a <code>pch.end.event</code> character, coloured with a unique color as given by
<code>col.cats</code>, extending from its start date until its end date.
Consecutive events are thus represented on consecutive levels of the y-axis
and are connected by a &quot;continuation&quot; line with <code>col.continuation</code>
colour, <code>lty.continuation</code> style and <code>lwd.continuation</code> width;
these continuation lines are purely visual guides helping to perceive the
sequence of events, and carry no information about the avilability of
medicine in this interval.
</p>
<p>Above these, the treatment episodes or the sliding windows are represented in
a stacked manner from the earlieast (left, bottom of the stack) to the latest
(right, top of the stack), each showing the CMA as percent fill (capped at
100% even if CMA values may be higher) and also as text.
</p>
<p>The follow-up and the observation windows are plotted as empty an rectangle
and as shaded rectangle, respectively (for some CMAs the observation window
might be adjusted in which case the adjustment may also be plotted using a
different shading).
</p>
<p>The kernel density (&quot;smoothed histogram&quot;) of the CMA estimates across
treatment episodes/sliding windows (if more than 2) can be visually
represented as well in the left side of the figure (NB, their horizontal
scales may be different across patients).
</p>
<p>When several patients are displayed on the same plot, they are organized
vertically, and alternating bands (white and gray) help distinguish
consecutive patients.
Implicitely, all patients contained in the <code>cma</code> object will be plotted,
but the <code>patients.to.plot</code> parameter allows the selection of a subset
of patients.
</p>
<p>Finally, the y-axis shows the patient ID and possibly the CMA estimate as
well.
</p>
<p>Any not explicitely defined arguments are passed to the simple CMA estimation
and plotting function; therefore, for more info about possible estimation
parameters plese see the help for the appropriate simple CMA, and for possible
aesthetic tweaks, please see the help for their plotting.
</p>


<h3>See Also</h3>

<p>See the simple CMA estimation <code><a href="#topic+CMA1">CMA1</a></code>
to <code><a href="#topic+CMA9">CMA9</a></code> and plotting <code><a href="#topic+plot.CMA1">plot.CMA1</a></code>
functions for extra parameters.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
cmaW &lt;- CMA_sliding_window(CMA=CMA1,
                        data=med.events,
                        ID.colname="PATIENT_ID",
                        event.date.colname="DATE",
                        event.duration.colname="DURATION",
                        event.daily.dose.colname="PERDAY",
                        medication.class.colname="CATEGORY",
                        carry.only.for.same.medication=FALSE,
                        consider.dosage.change=FALSE,
                        followup.window.start=0,
                        observation.window.start=0,
                        observation.window.duration=365,
                        sliding.window.start=0,
                        sliding.window.start.unit="days",
                        sliding.window.duration=90,
                        sliding.window.duration.unit="days",
                        sliding.window.step.duration=7,
                        sliding.window.step.unit="days",
                        sliding.window.no.steps=NA,
                        date.format="%m/%d/%Y"
                       );
plot(cmaW, patients.to.plot=c("1","2"));
cmaE &lt;- CMA_per_episode(CMA=CMA1,
                        data=med.events,
                        ID.colname="PATIENT_ID",
                        event.date.colname="DATE",
                        event.duration.colname="DURATION",
                        event.daily.dose.colname="PERDAY",
                        medication.class.colname="CATEGORY",
                        carry.only.for.same.medication=FALSE,
                        consider.dosage.change=FALSE,
                        followup.window.start=0,
                        observation.window.start=0,
                        observation.window.duration=365,
                        date.format="%m/%d/%Y"
                       );
plot(cmaE, patients.to.plot=c("1","2"));
## End(Not run)
</code></pre>

<hr>
<h2 id='plot.CMA0'>Plot CMA0 objects.</h2><span id='topic+plot.CMA0'></span>

<h3>Description</h3>

<p>Plots the events (prescribing or dispensing) data encapsulated in a basic
CMA0 object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'CMA0'
plot(
  x,
  ...,
  patients.to.plot = NULL,
  duration = NA,
  align.all.patients = FALSE,
  align.first.event.at.zero = FALSE,
  show.period = c("dates", "days")[2],
  period.in.days = 90,
  show.legend = TRUE,
  legend.x = "right",
  legend.y = "bottom",
  legend.bkg.opacity = 0.5,
  legend.cex = 0.75,
  legend.cex.title = 1,
  cex = 1,
  cex.axis = 0.75,
  cex.lab = 1,
  xlab = c(dates = "Date", days = "Days"),
  ylab = c(withoutCMA = "patient", withCMA = "patient (&amp; CMA)"),
  title = c(aligned = "Event patterns (all patients aligned)", notaligned =
    "Event patterns"),
  col.cats = rainbow,
  unspecified.category.label = "drug",
  medication.groups.to.plot = NULL,
  medication.groups.separator.show = TRUE,
  medication.groups.separator.lty = "solid",
  medication.groups.separator.lwd = 2,
  medication.groups.separator.color = "blue",
  medication.groups.allother.label = "*",
  lty.event = "solid",
  lwd.event = 2,
  pch.start.event = 15,
  pch.end.event = 16,
  plot.events.vertically.displaced = TRUE,
  print.dose = FALSE,
  cex.dose = 0.75,
  print.dose.outline.col = "white",
  print.dose.centered = FALSE,
  plot.dose = FALSE,
  lwd.event.max.dose = 8,
  plot.dose.lwd.across.medication.classes = FALSE,
  col.continuation = "black",
  lty.continuation = "dotted",
  lwd.continuation = 1,
  col.na = "lightgray",
  highlight.followup.window = TRUE,
  followup.window.col = "green",
  highlight.observation.window = TRUE,
  observation.window.col = "yellow",
  observation.window.density = 35,
  observation.window.angle = -30,
  observation.window.opacity = 0.3,
  alternating.bands.cols = c("white", "gray95"),
  rotate.text = -60,
  force.draw.text = FALSE,
  bw.plot = FALSE,
  min.plot.size.in.characters.horiz = 0,
  min.plot.size.in.characters.vert = 0,
  suppress.warnings = FALSE,
  max.patients.to.plot = 100,
  export.formats = NULL,
  export.formats.fileprefix = "AdhereR-plot",
  export.formats.height = NA,
  export.formats.width = NA,
  export.formats.save.svg.placeholder = TRUE,
  export.formats.svg.placeholder.type = c("jpg", "png", "webp")[2],
  export.formats.svg.placeholder.embed = FALSE,
  export.formats.html.template = NULL,
  export.formats.html.javascript = NULL,
  export.formats.html.css = NULL,
  export.formats.directory = NA,
  generate.R.plot = TRUE,
  do.not.draw.plot = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.CMA0_+3A_x">x</code></td>
<td>
<p>A <em><code>CMA0</code></em> or derived object, representing the CMA to
plot</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_...">...</code></td>
<td>
<p>other possible parameters</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_patients.to.plot">patients.to.plot</code></td>
<td>
<p>A vector of <em>strings</em> containing the list of
patient IDs to plot (a subset of those in the <code>cma</code> object), or
<code>NULL</code> for all</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_duration">duration</code></td>
<td>
<p>A <em>number</em>, the total duration (in days) of the whole
period to plot; in <code>NA</code> it is automatically determined from the event
data such that the whole dataset fits.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_align.all.patients">align.all.patients</code></td>
<td>
<p><em>Logical</em>, should all patients be aligned
(i.e., the actual dates are discarded and all plots are relative to the
earliest date)?</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_align.first.event.at.zero">align.first.event.at.zero</code></td>
<td>
<p><em>Logical</em>, should the first event be
placed at the origin of the time axis (at 0)?</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_show.period">show.period</code></td>
<td>
<p>A <em>string</em>, if &quot;dates&quot; show the actual dates at the
regular grid intervals, while for &quot;days&quot; (the default) shows the days since
the beginning; if <code>align.all.patients == TRUE</code>, <code>show.period</code> is
taken as &quot;days&quot;.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_period.in.days">period.in.days</code></td>
<td>
<p>The <em>number</em> of days at which the regular grid is
drawn (or 0 for no grid).</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_show.legend">show.legend</code></td>
<td>
<p><em>Logical</em>, should the legend be drawn?</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_legend.x">legend.x</code></td>
<td>
<p>The position of the legend on the x axis; can be &quot;left&quot;,
&quot;right&quot; (default), or a <em>numeric</em> value.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_legend.y">legend.y</code></td>
<td>
<p>The position of the legend on the y axis; can be &quot;bottom&quot;
(default), &quot;top&quot;, or a <em>numeric</em> value.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_legend.bkg.opacity">legend.bkg.opacity</code></td>
<td>
<p>A <em>number</em> between 0.0 and 1.0 specifying the
opacity of the legend background.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_cex">cex</code>, <code id="plot.CMA0_+3A_cex.axis">cex.axis</code>, <code id="plot.CMA0_+3A_cex.lab">cex.lab</code>, <code id="plot.CMA0_+3A_legend.cex">legend.cex</code>, <code id="plot.CMA0_+3A_legend.cex.title">legend.cex.title</code></td>
<td>
<p><em>numeric</em> values
specifying the cex of the various types of text.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_xlab">xlab</code></td>
<td>
<p>Named vector of x-axis labels to show for the two types of periods
(&quot;days&quot; and &quot;dates&quot;), or a single value for both, or <code>NULL</code> for nothing.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_ylab">ylab</code></td>
<td>
<p>Named vector of y-axis labels to show without and with CMA estimates,
or a single value for both, or <code>NULL</code> for nonthing.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_title">title</code></td>
<td>
<p>Named vector of titles to show for and without alignment, or a
single value for both, or <code>NULL</code> for nonthing.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_col.cats">col.cats</code></td>
<td>
<p>A <em>color</em> or a <em>function</em> that specifies the single
colour or the colour palette used to plot the different medication; by
default <code>rainbow</code>, but we recommend, whenever possible, a
colorblind-friendly palette such as <code>viridis</code> or <code>colorblind_pal</code>.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_unspecified.category.label">unspecified.category.label</code></td>
<td>
<p>A <em>string</em> giving the name of the
unspecified (generic) medication category.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_medication.groups.to.plot">medication.groups.to.plot</code></td>
<td>
<p>the names of the medication groups to plot or
<code>NULL</code> (the default) for all.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_medication.groups.separator.show">medication.groups.separator.show</code></td>
<td>
<p>a <em>boolean</em>, if <code>TRUE</code> (the
default) visually mark the medication groups the belong to the same patient,
using horizontal lines and alternating vertical lines.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_medication.groups.separator.lty">medication.groups.separator.lty</code>, <code id="plot.CMA0_+3A_medication.groups.separator.lwd">medication.groups.separator.lwd</code>, <code id="plot.CMA0_+3A_medication.groups.separator.color">medication.groups.separator.color</code></td>
<td>
<p>graphical parameters (line type, line width and colour describing the visual
marking og medication groups as beloning to the same patient.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_medication.groups.allother.label">medication.groups.allother.label</code></td>
<td>
<p>a <em>string</em> giving the label to
use for the implicit <code>__ALL_OTHERS__</code> medication group (defaults to &quot;*&quot;).</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_lty.event">lty.event</code>, <code id="plot.CMA0_+3A_lwd.event">lwd.event</code>, <code id="plot.CMA0_+3A_pch.start.event">pch.start.event</code>, <code id="plot.CMA0_+3A_pch.end.event">pch.end.event</code></td>
<td>
<p>The style of the
event (line style, width, and start and end symbols).</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_plot.events.vertically.displaced">plot.events.vertically.displaced</code></td>
<td>
<p>Should consecutive events be plotted
on separate rows (i.e., separated vertically, the default) or on the same row?</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_print.dose">print.dose</code></td>
<td>
<p><em>Logical</em>, should the daily dose be printed as text?</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_cex.dose">cex.dose</code></td>
<td>
<p><em>Numeric</em>, if daily dose is printed, what text size
to use?</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_print.dose.outline.col">print.dose.outline.col</code></td>
<td>
<p>If <em><code>NA</code></em>, don't print dose text with
outline, otherwise a color name/code for the outline.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_print.dose.centered">print.dose.centered</code></td>
<td>
<p><em>Logical</em>, print the daily dose centered on
the segment or slightly below it?</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_plot.dose">plot.dose</code></td>
<td>
<p><em>Logical</em>, should the daily dose be indicated through
segment width?</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_lwd.event.max.dose">lwd.event.max.dose</code></td>
<td>
<p><em>Numeric</em>, the segment width corresponding to
the maximum daily dose (must be &gt;= lwd.event but not too big either).</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_plot.dose.lwd.across.medication.classes">plot.dose.lwd.across.medication.classes</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code>,
the line width of the even is scaled relative to all medication classes (i.e.,
relative to the global minimum and maximum doses), otherwise it is scale
relative only to its medication class.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_col.continuation">col.continuation</code>, <code id="plot.CMA0_+3A_lty.continuation">lty.continuation</code>, <code id="plot.CMA0_+3A_lwd.continuation">lwd.continuation</code></td>
<td>
<p>The style of the
&quot;continuation&quot; lines connecting consecutive events (colour, line style and
width).</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_col.na">col.na</code></td>
<td>
<p>The colour used for missing event data.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_highlight.followup.window">highlight.followup.window</code></td>
<td>
<p><em>Logical</em>, should the follow-up window
be plotted?</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_followup.window.col">followup.window.col</code></td>
<td>
<p>The follow-up window's colour.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_highlight.observation.window">highlight.observation.window</code></td>
<td>
<p><em>Logical</em>, should the observation
window be plotted?</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_observation.window.col">observation.window.col</code>, <code id="plot.CMA0_+3A_observation.window.density">observation.window.density</code>, <code id="plot.CMA0_+3A_observation.window.angle">observation.window.angle</code>, <code id="plot.CMA0_+3A_observation.window.opacity">observation.window.opacity</code></td>
<td>
<p>Attributes of the observation window (colour, shading density, angle and
opacity).</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_alternating.bands.cols">alternating.bands.cols</code></td>
<td>
<p>The colors of the alternating vertical bands
distinguishing the patients; can be <code>NULL</code> = don't draw the bandes;
or a vector of colors.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_rotate.text">rotate.text</code></td>
<td>
<p><em>Numeric</em>, the angle by which certain text elements
(e.g., axis labels) should be rotated.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_force.draw.text">force.draw.text</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code>, always draw text even
if too big or too small</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_bw.plot">bw.plot</code></td>
<td>
<p><em>Logical</em>, should the plot use grayscale only (i.e., the
<code><a href="grDevices.html#topic+gray.colors">gray.colors</a></code> function)?</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_min.plot.size.in.characters.horiz">min.plot.size.in.characters.horiz</code>, <code id="plot.CMA0_+3A_min.plot.size.in.characters.vert">min.plot.size.in.characters.vert</code></td>
<td>
<p><em>Numeric</em>, the minimum size of the plotting surface in characters;
horizontally (min.plot.size.in.characters.horiz) refers to the the whole
duration of the events to plot; vertically (min.plot.size.in.characters.vert)
refers to a single event. If the plotting is too small, possible solutions
might be: if within <code>RStudio</code>, try to enlarge the &quot;Plots&quot; panel, or
(also valid outside <code>RStudio</code> but not if using <code>RStudio server</code>
start a new plotting device (e.g., using <code>X11()</code>, <code>quartz()</code>
or <code>windows()</code>, depending on OS) or (works always) save to an image
(e.g., <code>jpeg(...); ...; dev.off()</code>) and display it in a viewer.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>: show or hide the warnings?</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_max.patients.to.plot">max.patients.to.plot</code></td>
<td>
<p><em>Numeric</em>, the maximum patients to attempt
to plot.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_export.formats">export.formats</code></td>
<td>
<p>a <em>string</em> giving the formats to export the figure
to (by default <code>NULL</code>, meaning no exporting); can be any combination of
&quot;svg&quot; (just an <code>SVG</code> file), &quot;html&quot; (<code>SVG</code> + <code>HTML</code> + <code>CSS</code>
+ <code>JavaScript</code>, all embedded within one <code>HTML</code> document), &quot;jpg&quot;,
&quot;png&quot;, &quot;webp&quot;, &quot;ps&quot; or &quot;pdf&quot;.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_export.formats.fileprefix">export.formats.fileprefix</code></td>
<td>
<p>a <em>string</em> giving the file name prefix
for the exported formats (defaults to &quot;AdhereR-plot&quot;).</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_export.formats.height">export.formats.height</code>, <code id="plot.CMA0_+3A_export.formats.width">export.formats.width</code></td>
<td>
<p><em>numbers</em> giving the
desired dimensions (in pixels) for the exported figure (defaults to sane
values if <code>NA</code>).</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_export.formats.save.svg.placeholder">export.formats.save.svg.placeholder</code></td>
<td>
<p>a <em>logical</em>, if TRUE, save an
image placeholder of type given by <code>export.formats.svg.placeholder.type</code>
for the <code>SVG</code> image.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_export.formats.svg.placeholder.type">export.formats.svg.placeholder.type</code></td>
<td>
<p>a <em>string</em>, giving the type of
placeholder for the <code>SVG</code> image to save; can be &quot;jpg&quot;,
&quot;png&quot; (the default) or &quot;webp&quot;.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_export.formats.svg.placeholder.embed">export.formats.svg.placeholder.embed</code></td>
<td>
<p>a <em>logical</em>, if <code>TRUE</code>,
embed the placeholder image in the HTML document (if any) using <code>base64</code>
encoding, otherwise (the default) leave it as an external image file (works
only when an <code>HTML</code> document is exported and only for <code>JPEG</code> or
<code>PNG</code> images.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_export.formats.html.template">export.formats.html.template</code>, <code id="plot.CMA0_+3A_export.formats.html.javascript">export.formats.html.javascript</code>, <code id="plot.CMA0_+3A_export.formats.html.css">export.formats.html.css</code></td>
<td>
<p><em>character strings</em> or <code>NULL</code> (the default) giving the path to the
<code>HTML</code>, <code>JavaScript</code> and <code>CSS</code> templates, respectively, to be
used when generating the HTML+CSS semi-interactive plots; when <code>NULL</code>,
the default ones included with the package will be used. If you decide to define
new templates please use the default ones for inspiration and note that future
version are not guaranteed to be backwards compatible!</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_export.formats.directory">export.formats.directory</code></td>
<td>
<p>a <em>string</em>; if exporting, which directory
to export to; if <code>NA</code> (the default), creates the files in a temporary
directory.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_generate.r.plot">generate.R.plot</code></td>
<td>
<p>a <em>logical</em>, if <code>TRUE</code> (the default),
generate the standard (base <code>R</code>) plot for plotting within <code>R</code>.</p>
</td></tr>
<tr><td><code id="plot.CMA0_+3A_do.not.draw.plot">do.not.draw.plot</code></td>
<td>
<p>a <em>logical</em>, if <code>TRUE</code> (<em>not</em> the default),
does not draw the plot itself, but only the legend (if <code>show.legend</code> is
<code>TRUE</code>) at coordinates (0,0) irrespective of the given legend coordinates.
This is intended to allow (together with the <code>get.legend.plotting.area()</code>
function) the separate plotting of the legend.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The x-axis represents time (either in days since the earliest date or as
actual dates), with consecutive events represented as ascending on the y-axis.
</p>
<p>Each event is represented as a segment with style <code>lty.event</code> and line
width <code>lwd.event</code> starting with a <code>pch.start.event</code> and ending with
a <code>pch.end.event</code> character, coloured with a unique color as given by
<code>col.cats</code>, extending from its start date until its end date.
Consecutive events are thus represented on consecutive levels of the y-axis
and are connected by a &quot;continuation&quot; line with <code>col.continuation</code>
colour, <code>lty.continuation</code> style and <code>lwd.continuation</code> width;
these continuation lines are purely visual guides helping to perceive the
sequence of events, and carry no information about the availability of
medication in this interval.
</p>
<p>When several patients are displayed on the same plot, they are organized
vertically, and alternating bands (white and gray) help distinguish
consecutive patients.
Implicitly, all patients contained in the <code>cma</code> object will be plotted,
but the <code>patients.to.plot</code> parameter allows the selection of a subset
of patients.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cma0 &lt;- CMA0(data=med.events,
             ID.colname="PATIENT_ID",
             event.date.colname="DATE",
             event.duration.colname="DURATION",
             event.daily.dose.colname="PERDAY",
             medication.class.colname="CATEGORY",
             followup.window.start=0,
             followup.window.start.unit="days",
             followup.window.duration=2*365,
             followup.window.duration.unit="days",
             observation.window.start=30,
             observation.window.start.unit="days",
             observation.window.duration=365,
             observation.window.duration.unit="days",
             date.format="%m/%d/%Y",
             summary="Base CMA");
plot(cma0, patients.to.plot=c("1","2"));
</code></pre>

<hr>
<h2 id='plot.CMA1'>Plot CMA0-derived objects.</h2><span id='topic+plot.CMA1'></span><span id='topic+plot.CMA2'></span><span id='topic+plot.CMA3'></span><span id='topic+plot.CMA4'></span><span id='topic+plot.CMA5'></span><span id='topic+plot.CMA6'></span><span id='topic+plot.CMA7'></span><span id='topic+plot.CMA8'></span><span id='topic+plot.CMA9'></span>

<h3>Description</h3>

<p>Plots the event data and estimated CMA encapsulated in objects derived from
<code>CMA0</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'CMA1'
plot(
  x,
  ...,
  patients.to.plot = NULL,
  duration = NA,
  align.all.patients = FALSE,
  align.first.event.at.zero = FALSE,
  show.period = c("dates", "days")[2],
  period.in.days = 90,
  show.legend = TRUE,
  legend.x = "right",
  legend.y = "bottom",
  legend.bkg.opacity = 0.5,
  legend.cex = 0.75,
  legend.cex.title = 1,
  cex = 1,
  cex.axis = 0.75,
  cex.lab = 1,
  show.cma = TRUE,
  col.cats = rainbow,
  unspecified.category.label = "drug",
  medication.groups.to.plot = NULL,
  medication.groups.separator.show = TRUE,
  medication.groups.separator.lty = "solid",
  medication.groups.separator.lwd = 2,
  medication.groups.separator.color = "blue",
  medication.groups.allother.label = "*",
  lty.event = "solid",
  lwd.event = 2,
  pch.start.event = 15,
  pch.end.event = 16,
  show.event.intervals = TRUE,
  col.na = "lightgray",
  print.CMA = TRUE,
  CMA.cex = 0.5,
  plot.CMA = TRUE,
  CMA.plot.ratio = 0.1,
  CMA.plot.col = "lightgreen",
  CMA.plot.border = "darkgreen",
  CMA.plot.bkg = "aquamarine",
  CMA.plot.text = CMA.plot.border,
  highlight.followup.window = TRUE,
  followup.window.col = "green",
  highlight.observation.window = TRUE,
  observation.window.col = "yellow",
  observation.window.density = 35,
  observation.window.angle = -30,
  observation.window.opacity = 0.3,
  show.real.obs.window.start = TRUE,
  real.obs.window.density = 35,
  real.obs.window.angle = 30,
  print.dose = FALSE,
  cex.dose = 0.75,
  print.dose.outline.col = "white",
  print.dose.centered = FALSE,
  plot.dose = FALSE,
  lwd.event.max.dose = 8,
  plot.dose.lwd.across.medication.classes = FALSE,
  alternating.bands.cols = c("white", "gray95"),
  bw.plot = FALSE,
  rotate.text = -60,
  force.draw.text = FALSE,
  min.plot.size.in.characters.horiz = 0,
  min.plot.size.in.characters.vert = 0,
  max.patients.to.plot = 100,
  export.formats = NULL,
  export.formats.fileprefix = "AdhereR-plot",
  export.formats.height = NA,
  export.formats.width = NA,
  export.formats.save.svg.placeholder = TRUE,
  export.formats.svg.placeholder.type = c("jpg", "png", "webp")[2],
  export.formats.svg.placeholder.embed = FALSE,
  export.formats.directory = NA,
  export.formats.html.template = NULL,
  export.formats.html.javascript = NULL,
  export.formats.html.css = NULL,
  generate.R.plot = TRUE,
  do.not.draw.plot = FALSE
)

## S3 method for class 'CMA2'
plot(...)

## S3 method for class 'CMA3'
plot(...)

## S3 method for class 'CMA4'
plot(...)

## S3 method for class 'CMA5'
plot(...)

## S3 method for class 'CMA6'
plot(...)

## S3 method for class 'CMA7'
plot(...)

## S3 method for class 'CMA8'
plot(...)

## S3 method for class 'CMA9'
plot(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.CMA1_+3A_x">x</code></td>
<td>
<p>A <em><code>CMA0</code></em> or derived object, representing the CMA to
plot</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_...">...</code></td>
<td>
<p>other possible parameters</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_patients.to.plot">patients.to.plot</code></td>
<td>
<p>A vector of <em>strings</em> containing the list of
patient IDs to plot (a subset of those in the <code>cma</code> object), or
<code>NULL</code> for all</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_duration">duration</code></td>
<td>
<p>A <em>number</em>, the total duration (in days) of the whole
period to plot; in <code>NA</code> it is automatically determined from the event
data such that the whole dataset fits.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_align.all.patients">align.all.patients</code></td>
<td>
<p><em>Logical</em>, should all patients be aligned
(i.e., the actual dates are discarded and all plots are relative to the
earliest date)?</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_align.first.event.at.zero">align.first.event.at.zero</code></td>
<td>
<p><em>Logical</em>, should the first event be
placed at the origin of the time axis (at 0)?</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_show.period">show.period</code></td>
<td>
<p>A <em>string</em>, if &quot;dates&quot; show the actual dates at the
regular grid intervals, while for &quot;days&quot; (the default) shows the days since
the beginning; if <code>align.all.patients == TRUE</code>, <code>show.period</code> is
taken as &quot;days&quot;.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_period.in.days">period.in.days</code></td>
<td>
<p>The <em>number</em> of days at which the regular grid is
drawn (or 0 for no grid).</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_show.legend">show.legend</code></td>
<td>
<p><em>Logical</em>, should the legend be drawn?</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_legend.x">legend.x</code></td>
<td>
<p>The position of the legend on the x axis; can be &quot;left&quot;,
&quot;right&quot; (default), or a <em>numeric</em> value.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_legend.y">legend.y</code></td>
<td>
<p>The position of the legend on the y axis; can be &quot;bottom&quot;
(default), &quot;top&quot;, or a <em>numeric</em> value.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_legend.bkg.opacity">legend.bkg.opacity</code></td>
<td>
<p>A <em>number</em> between 0.0 and 1.0 specifying the
opacity of the legend background.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_cex">cex</code>, <code id="plot.CMA1_+3A_cex.axis">cex.axis</code>, <code id="plot.CMA1_+3A_cex.lab">cex.lab</code>, <code id="plot.CMA1_+3A_legend.cex">legend.cex</code>, <code id="plot.CMA1_+3A_legend.cex.title">legend.cex.title</code>, <code id="plot.CMA1_+3A_cma.cex">CMA.cex</code></td>
<td>
<p><em>numeric</em>
values specifying the <code>cex</code> of the various types of text.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_show.cma">show.cma</code></td>
<td>
<p><em>Logical</em>, should the CMA type be shown in the title?</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_col.cats">col.cats</code></td>
<td>
<p>A <em>color</em> or a <em>function</em> that specifies the single
colour or the colour palette used to plot the different medication; by
default <code>rainbow</code>, but we recommend, whenever possible, a
colorblind-friendly palette such as <code>viridis</code> or <code>colorblind_pal</code>.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_unspecified.category.label">unspecified.category.label</code></td>
<td>
<p>A <em>string</em> giving the name of the
unspecified (generic) medication category.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_medication.groups.to.plot">medication.groups.to.plot</code></td>
<td>
<p>the names of the medication groups to plot or
<code>NULL</code> (the default) for all.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_medication.groups.separator.show">medication.groups.separator.show</code></td>
<td>
<p>a <em>boolean</em>, if <code>TRUE</code> (the
default) visually mark the medication groups the belong to the same patient,
using horizontal lines and alternating vertical lines.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_medication.groups.separator.lty">medication.groups.separator.lty</code>, <code id="plot.CMA1_+3A_medication.groups.separator.lwd">medication.groups.separator.lwd</code>, <code id="plot.CMA1_+3A_medication.groups.separator.color">medication.groups.separator.color</code></td>
<td>
<p>graphical parameters (line type, line width and colour describing the visual
marking og medication groups as beloning to the same patient.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_medication.groups.allother.label">medication.groups.allother.label</code></td>
<td>
<p>a <em>string</em> giving the label to
use for the implicit <code>__ALL_OTHERS__</code> medication group (defaults to &quot;*&quot;).</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_lty.event">lty.event</code>, <code id="plot.CMA1_+3A_lwd.event">lwd.event</code>, <code id="plot.CMA1_+3A_pch.start.event">pch.start.event</code>, <code id="plot.CMA1_+3A_pch.end.event">pch.end.event</code></td>
<td>
<p>The style of the
event (line style, width, and start and end symbols).</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_show.event.intervals">show.event.intervals</code></td>
<td>
<p><em>Logical</em>, should the actual event intervals
be shown?</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_col.na">col.na</code></td>
<td>
<p>The colour used for missing event data.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_print.cma">print.CMA</code></td>
<td>
<p><em>Logical</em>, should the CMA values be printed?</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_plot.cma">plot.CMA</code></td>
<td>
<p><em>Logical</em>, should the CMA values be represented
graphically?</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_cma.plot.ratio">CMA.plot.ratio</code></td>
<td>
<p>A <em>number</em>, the proportion of the total horizontal
plot space to be allocated to the CMA plot.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_cma.plot.col">CMA.plot.col</code>, <code id="plot.CMA1_+3A_cma.plot.border">CMA.plot.border</code>, <code id="plot.CMA1_+3A_cma.plot.bkg">CMA.plot.bkg</code>, <code id="plot.CMA1_+3A_cma.plot.text">CMA.plot.text</code></td>
<td>
<p><em>Strings</em>
giving the colours of the various components of the CMA plot.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_highlight.followup.window">highlight.followup.window</code></td>
<td>
<p><em>Logical</em>, should the follow-up window
be plotted?</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_followup.window.col">followup.window.col</code></td>
<td>
<p>The follow-up window's colour.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_highlight.observation.window">highlight.observation.window</code></td>
<td>
<p><em>Logical</em>, should the observation
window be plotted?</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_observation.window.col">observation.window.col</code>, <code id="plot.CMA1_+3A_observation.window.density">observation.window.density</code>, <code id="plot.CMA1_+3A_observation.window.angle">observation.window.angle</code>, <code id="plot.CMA1_+3A_observation.window.opacity">observation.window.opacity</code></td>
<td>
<p>Attributes of the observation window (colour, shading density, angle and
opacity).</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_show.real.obs.window.start">show.real.obs.window.start</code>, <code id="plot.CMA1_+3A_real.obs.window.density">real.obs.window.density</code>, <code id="plot.CMA1_+3A_real.obs.window.angle">real.obs.window.angle</code></td>
<td>
<p>For some CMAs, the observation window might
be adjusted, in which case should it be plotted and with that attributes?</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_print.dose">print.dose</code></td>
<td>
<p><em>Logical</em>, should the daily dose be printed as text?</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_cex.dose">cex.dose</code></td>
<td>
<p><em>Numeric</em>, if daily dose is printed, what text size
to use?</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_print.dose.outline.col">print.dose.outline.col</code></td>
<td>
<p>If <em><code>NA</code></em>, don't print dose text with
outline, otherwise a color name/code for the outline.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_print.dose.centered">print.dose.centered</code></td>
<td>
<p><em>Logical</em>, print the daily dose centered on
the segment or slightly below it?</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_plot.dose">plot.dose</code></td>
<td>
<p><em>Logical</em>, should the daily dose be indicated through
segment width?</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_lwd.event.max.dose">lwd.event.max.dose</code></td>
<td>
<p><em>Numeric</em>, the segment width corresponding to
the maximum daily dose (must be &gt;= lwd.event but not too big either).</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_plot.dose.lwd.across.medication.classes">plot.dose.lwd.across.medication.classes</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code>,
the line width of the even is scaled relative to all medication classes (i.e.,
relative to the global minimum and maximum doses), otherwise it is scale
relative only to its medication class.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_alternating.bands.cols">alternating.bands.cols</code></td>
<td>
<p>The colors of the alternating vertical bands
distinguishing the patients; can be <code>NULL</code> = don't draw the bandes;
or a vector of colors.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_bw.plot">bw.plot</code></td>
<td>
<p><em>Logical</em>, should the plot use grayscale only (i.e., the
<code><a href="grDevices.html#topic+gray.colors">gray.colors</a></code> function)?</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_rotate.text">rotate.text</code></td>
<td>
<p><em>Numeric</em>, the angle by which certain text elements
(e.g., axis labels) should be rotated.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_force.draw.text">force.draw.text</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code>, always draw text even
if too big or too small</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_min.plot.size.in.characters.horiz">min.plot.size.in.characters.horiz</code>, <code id="plot.CMA1_+3A_min.plot.size.in.characters.vert">min.plot.size.in.characters.vert</code></td>
<td>
<p><em>Numeric</em>, the minimum size of the plotting surface in characters;
horizontally (min.plot.size.in.characters.horiz) refers to the the whole
duration of the events to plot; vertically (min.plot.size.in.characters.vert)
refers to a single event. If the plotting is too small, possible solutions
might be: if within <code>RStudio</code>, try to enlarge the &quot;Plots&quot; panel, or
(also valid outside <code>RStudio</code> but not if using <code>RStudio server</code>
start a new plotting device (e.g., using <code>X11()</code>, <code>quartz()</code>
or <code>windows()</code>, depending on OS) or (works always) save to an image
(e.g., <code>jpeg(...); ...; dev.off()</code>) and display it in a viewer.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_max.patients.to.plot">max.patients.to.plot</code></td>
<td>
<p><em>Numeric</em>, the maximum patients to attempt
to plot.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_export.formats">export.formats</code></td>
<td>
<p>a <em>string</em> giving the formats to export the figure
to (by default <code>NULL</code>, meaning no exporting); can be any combination of
&quot;svg&quot; (just an <code>SVG</code> file), &quot;html&quot; (<code>SVG</code> + <code>HTML</code> + <code>CSS</code>
+ <code>JavaScript</code>, all embedded within one <code>HTML</code> document), &quot;jpg&quot;,
&quot;png&quot;, &quot;webp&quot;, &quot;ps&quot; or &quot;pdf&quot;.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_export.formats.fileprefix">export.formats.fileprefix</code></td>
<td>
<p>a <em>string</em> giving the file name prefix
for the exported formats (defaults to &quot;AdhereR-plot&quot;).</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_export.formats.height">export.formats.height</code>, <code id="plot.CMA1_+3A_export.formats.width">export.formats.width</code></td>
<td>
<p><em>numbers</em> giving the
desired dimensions (in pixels) for the exported figure (defaults to sane
values if <code>NA</code>).</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_export.formats.save.svg.placeholder">export.formats.save.svg.placeholder</code></td>
<td>
<p>a <em>logical</em>, if TRUE, save an
image placeholder of type given by <code>export.formats.svg.placeholder.type</code>
for the <code>SVG</code> image.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_export.formats.svg.placeholder.type">export.formats.svg.placeholder.type</code></td>
<td>
<p>a <em>string</em>, giving the type of
placeholder for the <code>SVG</code> image to save; can be &quot;jpg&quot;,
&quot;png&quot; (the default) or &quot;webp&quot;.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_export.formats.svg.placeholder.embed">export.formats.svg.placeholder.embed</code></td>
<td>
<p>a <em>logical</em>, if <code>TRUE</code>,
embed the placeholder image in the HTML document (if any) using <code>base64</code>
encoding, otherwise (the default) leave it as an external image file (works
only when an <code>HTML</code> document is exported and only for <code>JPEG</code> or
<code>PNG</code> images.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_export.formats.directory">export.formats.directory</code></td>
<td>
<p>a <em>string</em>; if exporting, which directory
to export to; if <code>NA</code> (the default), creates the files in a temporary
directory.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_export.formats.html.template">export.formats.html.template</code>, <code id="plot.CMA1_+3A_export.formats.html.javascript">export.formats.html.javascript</code>, <code id="plot.CMA1_+3A_export.formats.html.css">export.formats.html.css</code></td>
<td>
<p><em>character strings</em> or <code>NULL</code> (the default) giving the path to the
<code>HTML</code>, <code>JavaScript</code> and <code>CSS</code> templates, respectively, to be
used when generating the HTML+CSS semi-interactive plots; when <code>NULL</code>,
the default ones included with the package will be used. If you decide to define
new templates please use the default ones for inspiration and note that future
version are not guaranteed to be backwards compatible!</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_generate.r.plot">generate.R.plot</code></td>
<td>
<p>a <em>logical</em>, if <code>TRUE</code> (the default),
generate the standard (base <code>R</code>) plot for plotting within <code>R</code>.</p>
</td></tr>
<tr><td><code id="plot.CMA1_+3A_do.not.draw.plot">do.not.draw.plot</code></td>
<td>
<p>a <em>logical</em>, if <code>TRUE</code> (<em>not</em> the default),
does not draw the plot itself, but only the legend (if <code>show.legend</code> is
<code>TRUE</code>) at coordinates (0,0) irrespective of the given legend coordinates.
This is intended to allow (together with the <code>get.legend.plotting.area()</code>
function) the separate plotting of the legend.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Please note that this function plots objects inheriting from <code>CMA0</code> but
not objects of type <code>CMA0</code> itself (these are plotted by
<code><a href="#topic+plot.CMA0">plot.CMA0</a></code>).
</p>
<p>The x-axis represents time (either in days since the earliest date or as
actual dates), with consecutive events represented as ascending on the y-axis.
</p>
<p>Each event is represented as a segment with style <code>lty.event</code> and line
width <code>lwd.event</code> starting with a <code>pch.start.event</code> and ending with
a <code>pch.end.event</code> character, coloured with a unique color as given by
<code>col.cats</code>, extending from its start date until its end date.
Superimposed on these are shown the event intervals and gap days as estimated
by the particular CMA method, more precisely plotting the start and end of
the available events as solid filled-in rectangles, and the event gaps as
shaded rectangles.
</p>
<p>The follow-up and the observation windows are plotted as an empty rectangle
and as shaded rectangle, respectively (for some CMAs the observation window
might be adjusted in which case the adjustment may also be plotted using a
different shading).
</p>
<p>The CMA estimates can be visually represented as well in the left side of the
figure using bars (sometimes the estimates can go above 100%, in which case
the maximum possible bar filling is adjusted to reflect this).
</p>
<p>When several patients are displayed on the same plot, they are organized
vertically, and alternating bands (white and gray) help distinguish
consecutive patients.
Implicitely, all patients contained in the <code>cma</code> object will be plotted,
but the <code>patients.to.plot</code> parameter allows the selection of a subset of
patients.
</p>
<p>Finally, the y-axis shows the patient ID and possibly the CMA estimate as
well.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cma1 &lt;- CMA1(data=med.events,
             ID.colname="PATIENT_ID",
             event.date.colname="DATE",
             event.duration.colname="DURATION",
             followup.window.start=30,
             observation.window.start=30,
             observation.window.duration=365,
             date.format="%m/%d/%Y"
            );
plot(cma1, patients.to.plot=c("1","2"));
</code></pre>

<hr>
<h2 id='print.CMA0'>Print CMA0 (and derived) objects.</h2><span id='topic+print.CMA0'></span><span id='topic+print.CMA1'></span><span id='topic+print.CMA2'></span><span id='topic+print.CMA3'></span><span id='topic+print.CMA4'></span><span id='topic+print.CMA5'></span><span id='topic+print.CMA6'></span><span id='topic+print.CMA7'></span><span id='topic+print.CMA8'></span><span id='topic+print.CMA9'></span><span id='topic+print.CMA_per_episode'></span><span id='topic+print.CMA_sliding_window'></span>

<h3>Description</h3>

<p>Prints and summarizes a basic CMA0, or derived, object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'CMA0'
print(
  x,
  ...,
  inline = FALSE,
  format = c("text", "latex", "markdown"),
  print.params = TRUE,
  print.data = TRUE,
  exclude.params = c("event.info", "real.obs.windows"),
  skip.header = FALSE,
  cma.type = class(cma)[1]
)

## S3 method for class 'CMA1'
print(...)

## S3 method for class 'CMA2'
print(...)

## S3 method for class 'CMA3'
print(...)

## S3 method for class 'CMA4'
print(...)

## S3 method for class 'CMA5'
print(...)

## S3 method for class 'CMA6'
print(...)

## S3 method for class 'CMA7'
print(...)

## S3 method for class 'CMA8'
print(...)

## S3 method for class 'CMA9'
print(...)

## S3 method for class 'CMA_per_episode'
print(
  x,
  ...,
  inline = FALSE,
  format = c("text", "latex", "markdown"),
  print.params = TRUE,
  print.data = TRUE,
  exclude.params = c("event.info", "inner.event.info", "mapping.episodes.to.events"),
  skip.header = FALSE,
  cma.type = class(x)[1]
)

## S3 method for class 'CMA_sliding_window'
print(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.CMA0_+3A_x">x</code></td>
<td>
<p>A <em><code>CMA0</code></em> or derived object, representing the CMA to
print.</p>
</td></tr>
<tr><td><code id="print.CMA0_+3A_...">...</code></td>
<td>
<p>other possible parameters</p>
</td></tr>
<tr><td><code id="print.CMA0_+3A_inline">inline</code></td>
<td>
<p><em>Logical</em>, should print inside a line of text or as a
separate, extended object?</p>
</td></tr>
<tr><td><code id="print.CMA0_+3A_format">format</code></td>
<td>
<p>A <em>string</em>, the type of output: plain text (&quot;text&quot;;
default), LaTeX (&quot;latex&quot;) or R Markdown (&quot;markdown&quot;).</p>
</td></tr>
<tr><td><code id="print.CMA0_+3A_print.params">print.params</code></td>
<td>
<p><em>Logical</em>, should print the parameters?</p>
</td></tr>
<tr><td><code id="print.CMA0_+3A_print.data">print.data</code></td>
<td>
<p><em>Logical</em>, should print a summary of the data?</p>
</td></tr>
<tr><td><code id="print.CMA0_+3A_exclude.params">exclude.params</code></td>
<td>
<p>A vector of <em>strings</em>, the names of the object
fields to exclude from printing (usually, internal information irrelevant to
the end-user).</p>
</td></tr>
<tr><td><code id="print.CMA0_+3A_skip.header">skip.header</code></td>
<td>
<p><em>Logical</em>, should the header be printed?</p>
</td></tr>
<tr><td><code id="print.CMA0_+3A_cma.type">cma.type</code></td>
<td>
<p>A <em>string</em>, used to override the reported object's class.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Can produce output for the console (text), R Markdown or LaTeX,
showing various types of information.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cma0 &lt;- CMA0(data=med.events,
             ID.colname="PATIENT_ID",
             event.date.colname="DATE",
             event.duration.colname="DURATION",
             event.daily.dose.colname="PERDAY",
             medication.class.colname="CATEGORY",
             followup.window.start=0,
             followup.window.start.unit="days",
             followup.window.duration=2*365,
             followup.window.duration.unit="days",
             observation.window.start=30,
             observation.window.start.unit="days",
             observation.window.duration=365,
             observation.window.duration.unit="days",
             date.format="%m/%d/%Y",
             summary="Base CMA");
cma0;
print(cma0, format="markdown");
cma1 &lt;- CMA1(data=med.events,
             ID.colname="PATIENT_ID",
             event.date.colname="DATE",
             event.duration.colname="DURATION",
             followup.window.start=30,
             observation.window.start=30,
             observation.window.duration=365,
             date.format="%m/%d/%Y"
            );
cma1;
</code></pre>

<hr>
<h2 id='prune_event_durations'>Prune event durations.</h2><span id='topic+prune_event_durations'></span>

<h3>Description</h3>

<p>Flags or removes leftover supply durations after dosage changes, the end of a special period,
or treatment interruption.
The function accepts the raw list output of <code>compute_event_durations</code> and additional arguments
to specify event durations that need to be removed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prune_event_durations(
  data,
  include = c("special periods", "treatment interruptions", "dosage changes"),
  medication.class.colnames = data$medication.class.colnames,
  days.within.out.date.1,
  days.within.out.date.2,
  keep.all = TRUE,
  suppress.warnings = FALSE,
  return.data.table = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="prune_event_durations_+3A_data">data</code></td>
<td>
<p>A <em><code>list</code></em>, the output of <code>compute_event_durations</code>.</p>
</td></tr>
<tr><td><code id="prune_event_durations_+3A_include">include</code></td>
<td>
<p>A <em><code>Vector</code></em> of <em>strings</em> indicating whether to include
dosage changes, special periods, and/or treatment interruptions.</p>
</td></tr>
<tr><td><code id="prune_event_durations_+3A_medication.class.colnames">medication.class.colnames</code></td>
<td>
<p>A <em><code>Vector</code></em> of <em>strings</em>, the
name(s) of the column(s) in the <code>event_durations</code> element of <code>data</code> to
identify medication classes. Defaults to the columns used in <code>compute_event_durations</code>.</p>
</td></tr>
<tr><td><code id="prune_event_durations_+3A_days.within.out.date.1">days.within.out.date.1</code></td>
<td>
<p>event durations from before the dosage change, special period, or
treatment interruptions are removed if there is a new dispensing event within the
number of days specified as <em>integer</em> after the dosage change or end of the special
period/treatment interruption.</p>
</td></tr>
<tr><td><code id="prune_event_durations_+3A_days.within.out.date.2">days.within.out.date.2</code></td>
<td>
<p>event durations from before dosage change, special period,
or treatment interruption are removed if there is <em>NO</em> new dispensing event within the
number of days specified as <em>integer</em> after the dosage change or end of the special
period/treatment interruption.</p>
</td></tr>
<tr><td><code id="prune_event_durations_+3A_keep.all">keep.all</code></td>
<td>
<p><em>Logical</em>, should events be kept and marked for removal?
If <code>TRUE</code>, a new column <code>.prune.event</code> will be added to <code>event_durations</code>,
if <code>FALSE</code> the events will be removed from the output.</p>
</td></tr>
<tr><td><code id="prune_event_durations_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any
warnings.</p>
</td></tr>
<tr><td><code id="prune_event_durations_+3A_return.data.table">return.data.table</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> return a
<code>data.table</code> object, otherwise a <code>data.frame</code>.</p>
</td></tr>
<tr><td><code id="prune_event_durations_+3A_...">...</code></td>
<td>
<p>other possible parameters.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Dosage changes, special periods, and treatment interruptions may lead to overestimation of
implementation, e.g. if patients get a refill after discharge from hospital and don't continue to use
their previous supply. Likewise, it may also lead to overestimation of persistence, e.g. when
patients discontinue treatments after the end of a special period or treatment interruption.
</p>


<h3>Value</h3>

<p>A <code>data.frame</code> or <code>data.table</code>, the pruned event_durations.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# select medication class of interest and compute event durations

disp_data &lt;- durcomp.dispensing[ID == 3 &amp; grepl("J01EE01", ATC.CODE)]
presc_data &lt;- durcomp.prescribing[ID == 3 &amp; grepl("J01EE01", ATC.CODE)]

# compute event durations
event_durations_list &lt;- compute_event_durations(disp.data = disp_data,
                                                presc.data = presc_data,
                                                special.periods.data = durcomp.hospitalisation,
                                                ID.colname = "ID",
                                                presc.date.colname = "DATE.PRESC",
                                                disp.date.colname = "DATE.DISP",
                                                date.format = "%Y-%m-%d",
                                                medication.class.colnames = c("ATC.CODE",
                                                                              "UNIT",
                                                                              "FORM"),
                                                total.dose.colname = "TOTAL.DOSE",
                                                presc.daily.dose.colname = "DAILY.DOSE",
                                                presc.duration.colname = "PRESC.DURATION",
                                                visit.colname = "VISIT",
                                                force.init.presc = TRUE,
                                                force.presc.renew = TRUE,
                                                split.on.dosage.change = TRUE,
                                                trt.interruption = "carryover",
                                                special.periods.method = "carryover",
                                                suppress.warnings = FALSE,
                                                return.data.table = TRUE,
                                                progress.bar = FALSE)

# prune event durations
event_durations &lt;- prune_event_durations(event_durations_list,
                                         include = c("special periods"),
                                         medication.class.colnames = "ATC.CODE",
                                         days.within.out.date.1 = 7,
                                         days.within.out.date.2 = 30,
                                         keep.all = FALSE)
       
## End(Not run)
</code></pre>

<hr>
<h2 id='subsetCMA'>Restrict a CMA object to a subset of patients.</h2><span id='topic+subsetCMA'></span>

<h3>Description</h3>

<p>Restrict a CMA object to a subset of patients.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>subsetCMA(cma, patients, suppress.warnings)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="subsetCMA_+3A_cma">cma</code></td>
<td>
<p>a CMA object.</p>
</td></tr>
<tr><td><code id="subsetCMA_+3A_patients">patients</code></td>
<td>
<p>a list of patient IDs to keep.</p>
</td></tr>
<tr><td><code id="subsetCMA_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any
warnings.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a CMA object containing only the information for the given patients.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cma1 &lt;- CMA1(data=med.events,
             ID.colname="PATIENT_ID",
             event.date.colname="DATE",
             event.duration.colname="DURATION",
             followup.window.start=30,
             observation.window.start=30,
             observation.window.duration=365,
             date.format="%m/%d/%Y"
            );
getCMA(cma1);
cma1a &lt;- subsetCMA(cma1, patients=c(1:3,7));
cma1a; getCMA(cma1a);
</code></pre>

<hr>
<h2 id='time_to_initiation'>Computation of initiation times.</h2><span id='topic+time_to_initiation'></span>

<h3>Description</h3>

<p>Computes the time between the start of a prescription episode and the first dispensing
event for each medication class.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>time_to_initiation(
  presc.data = NULL,
  disp.data = NULL,
  ID.colname = NA,
  medication.class.colnames = NA,
  presc.start.colname = NA,
  disp.date.colname = NA,
  date.format = "%d.%m.%Y",
  suppress.warnings = FALSE,
  return.data.table = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="time_to_initiation_+3A_presc.data">presc.data</code></td>
<td>
<p>A <em><code>data.frame</code></em> or <em><code>data.table</code></em> containing
the prescription episodes. Must contain, at a minimum, the patient unique ID,
one medication identifier, and the start date of the prescription episode, and might
also contain additional columns to identify and group medications (the actual
column names are defined in the <em><code>medication.class.colnames</code></em> parameter).</p>
</td></tr>
<tr><td><code id="time_to_initiation_+3A_disp.data">disp.data</code></td>
<td>
<p>A <em><code>data.frame</code></em> or <em><code>data.table</code></em> containing
the dispensing events. Must contain, at a minimum, the patient unique ID, one
medication identifier, the dispensing date, and might also contain additional
columns to identify and group medications (the actual column names are defined
in the <em><code>medication.class.colnames</code></em> parameter).</p>
</td></tr>
<tr><td><code id="time_to_initiation_+3A_id.colname">ID.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in <code>presc.data</code>
and <code>disp.data</code> containing the unique patient ID, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="time_to_initiation_+3A_medication.class.colnames">medication.class.colnames</code></td>
<td>
<p>A <em><code>Vector</code></em> of <em>strings</em>, the
name(s) of the column(s) in <code>data</code> containing the classes/types/groups of
medication, or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="time_to_initiation_+3A_presc.start.colname">presc.start.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>presc.data</code> containing the prescription date (in the format given in
the <code>date.format</code> parameter), or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="time_to_initiation_+3A_disp.date.colname">disp.date.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>disp.data</code> containing the dispensing date (in the format given in
the <code>date.format</code> parameter), or <code>NA</code> if not defined.</p>
</td></tr>
<tr><td><code id="time_to_initiation_+3A_date.format">date.format</code></td>
<td>
<p>A <em>string</em> giving the format of the dates used in
the <code>data</code> and the other parameters; see the <code>format</code> parameters
of the <code><a href="base.html#topic+as.Date">as.Date</a></code> function for details (NB, this concerns
only the dates given as strings and not as <code>Date</code> objects).</p>
</td></tr>
<tr><td><code id="time_to_initiation_+3A_suppress.warnings">suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any
warnings.</p>
</td></tr>
<tr><td><code id="time_to_initiation_+3A_return.data.table">return.data.table</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> return a
<code>data.table</code> object, otherwise a <code>data.frame</code>.</p>
</td></tr>
<tr><td><code id="time_to_initiation_+3A_...">...</code></td>
<td>
<p>other possible parameters</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The period between the start of a prescription episode and the first dose administration
may impact health outcomes differently than omitting doses once on treatment or
interrupting medication for longer periods of time. Primary non-adherence (not
acquiring the first prescription) or delayed initiation may have a negative
impact on health outcomes. The function <code>time_to_initiation</code> calculates
the time between the start of a prescription episode and the first dispensing event, taking
into account multiple variables to differentiate between treatments.
</p>


<h3>Value</h3>

<p>A <code>data.frame</code> or <code>data.table</code> with the following columns:
</p>

<ul>
<li> <p><code>ID.colname</code> the unique patient ID, as given by the <code>ID.colname</code>
parameter.
</p>
</li>
<li> <p><code>medication.class.colnames</code> the column(s) with classes/types/groups
of medication, as given by the  <code>medication.class.colnames</code> parameter.
</p>
</li>
<li> <p><code>episode.start</code> the date of the first prescription event.
</p>
</li>
<li> <p><code>first.disp</code> the date of the first dispensing event.
</p>
</li>
<li> <p><code>time.to.initiation</code> the difference in days between the first
dispensing date and the  first prescription date.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>time_init &lt;- time_to_initiation(presc.data = durcomp.prescribing,
                                disp.data = durcomp.dispensing,
                                ID.colname = "ID",
                                medication.class.colnames = c("ATC.CODE", "FORM", "UNIT"),
                                presc.start.colname = "DATE.PRESC",
                                disp.date.colname = "DATE.DISP",
                                date.format = "%Y-%m-%d",
                                suppress.warnings = FALSE,
                                return.data.table = TRUE);
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
