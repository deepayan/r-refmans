<!DOCTYPE html><html lang="en"><head><title>Help for package eva3dm</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {eva3dm}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#eva3dm-package'><p>eva3dm: Evaluation of 3D Meteorological and Air Quality Models</p></a></li>
<li><a href='#+25at+25'><p>Combine stats and site list to overlay plot</p></a></li>
<li><a href='#+25IN+25'><p>Returns the common columns</p></a></li>
<li><a href='#atr'><p>Read and write attributes on a NetCDF file</p></a></li>
<li><a href='#cate'><p>Calculate categorical statistics in related to a threshold</p></a></li>
<li><a href='#daily'><p>Calculate daily mean, min or max</p></a></li>
<li><a href='#eva'><p>Model statistical evaluation</p></a></li>
<li><a href='#extract_max_8h'><p>Create a NetCDF file with the surface maximum of O3</p></a></li>
<li><a href='#extract_mean'><p>Create a NetCDF file with the surface mean</p></a></li>
<li><a href='#extract_serie'><p>Extract time series of wrf file list of lat/lon</p></a></li>
<li><a href='#get_distances'><p>Get the distance in kilometers between two points</p></a></li>
<li><a href='#hourly'><p>Calculate hourly mean, min or max</p></a></li>
<li><a href='#interp'><p>Interpolation (project and resample)</p></a></li>
<li><a href='#legend_range'><p>Plot a legend with the range of values</p></a></li>
<li><a href='#ma8h'><p>Calculate 8-hour moving average</p></a></li>
<li><a href='#mda8'><p>Maximum Daily 8-hr Average</p></a></li>
<li><a href='#ncdump'><p>Print a 'ncdump -h' command</p></a></li>
<li><a href='#overlay'><p>Plot or add points using a color scale</p></a></li>
<li><a href='#plot_diff'><p>Plot the difference from two SpatRaster objects</p></a></li>
<li><a href='#plot_rast'><p>Plot rast (SpatRaster) object</p></a></li>
<li><a href='#q2rh'><p>Convert absolute humidity to relative humidity</p></a></li>
<li><a href='#rain'><p>conversion of model precipitation to hourly precipitation</p></a></li>
<li><a href='#rast_to_netcdf'><p>Function to convert/save a SpatRaster array/Netcdf</p></a></li>
<li><a href='#read_stat'><p>Function to read stats and evaluation</p></a></li>
<li><a href='#rh2q'><p>Convert relative humidity to absolute humidity</p></a></li>
<li><a href='#sat'><p>Functions to model evaluation using satellite</p></a></li>
<li><a href='#stat'><p>Calculate evaluation statistics from numerical vectors</p></a></li>
<li><a href='#template'><p>Create templates for model evaluation</p></a></li>
<li><a href='#uv2wd'><p>Function to calculate model wind direction</p></a></li>
<li><a href='#uv2ws'><p>Function to calculate model wind speed</p></a></li>
<li><a href='#vars'><p>Function to return variable names</p></a></li>
<li><a href='#wrf_rast'><p>Creates SpatRaster object from wrf file</p></a></li>
<li><a href='#write_stat'><p>Functions to write stats and evaluation</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Evaluation of 3D Meteorological and Air Quality Models</td>
</tr>
<tr>
<td>Version:</td>
<td>0.99.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-11-24</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides tools for post-process, evaluate and visualize results from 3d Meteorological and Air Quality models against point observations (i.e. surface stations) and grid (i.e. satellite) observations.</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Daniel Schuch &lt;underschuch@gmail.com&gt;</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Imports:</td>
<td>terra, ncdf4, utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>riem, testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/Schuch666/eva3dm/issues/">https://github.com/Schuch666/eva3dm/issues/</a></td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://schuch666.github.io/eva3dm/">https://schuch666.github.io/eva3dm/</a></td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-11-24 20:15:49 UTC; under</td>
</tr>
<tr>
<td>Author:</td>
<td>Daniel Schuch <a href="https://orcid.org/0000-0001-5977-4519"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-11-25 08:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='eva3dm-package'>eva3dm: Evaluation of 3D Meteorological and Air Quality Models</h2><span id='topic+eva3dm'></span><span id='topic+eva3dm-package'></span>

<h3>Description</h3>

<p><img src="../help/figures/logo.png" style='float: right' alt='logo' width='120' />
</p>
<p>Provides tools for post-process, evaluate and visualize results from 3d Meteorological and Air Quality models against point observations (i.e. surface stations) and grid (i.e. satellite) observations.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Daniel Schuch <a href="mailto:underschuch@gmail.com">underschuch@gmail.com</a> (<a href="https://orcid.org/0000-0001-5977-4519">ORCID</a>)
</p>


<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://schuch666.github.io/eva3dm/">https://schuch666.github.io/eva3dm/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/Schuch666/eva3dm/issues/">https://github.com/Schuch666/eva3dm/issues/</a>
</p>
</li></ul>


<hr>
<h2 id='+25at+25'>Combine stats and site list to overlay plot</h2><span id='topic++25at+25'></span>

<h3>Description</h3>

<p>combines the stats (from individual station evaluation) and site list in a SpatVector using row.names
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stat %at% site
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="+2B25at+2B25_+3A_stat">stat</code></td>
<td>
<p>data.frame with stats or other variable (containing row.names and other variables)</p>
</td></tr>
<tr><td><code id="+2B25at+2B25_+3A_site">site</code></td>
<td>
<p>data.frame with site list (containing row.names, lat and lon)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>SpatVector (terra package)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
sites&lt;- readRDS(paste0(system.file("extdata",package="eva3dm"),"/sites_AQ_BR.Rds"))
model&lt;- readRDS(paste0(system.file("extdata",package="eva3dm"),"/model.Rds"))
obs  &lt;- readRDS(paste0(system.file("extdata",package="eva3dm"),"/obs.Rds"))

stats &lt;- eva(mo = model, ob = obs, site = 'Americana')
stats &lt;- eva(mo = model, ob = obs, site = 'SAndre',table = stats)
stats &lt;- eva(mo = model, ob = obs, site = 'VVIbes',table = stats)

print(stats)

geo_stats &lt;- stats %at% sites

print(geo_stats)

</code></pre>

<hr>
<h2 id='+25IN+25'>Returns the common columns</h2><span id='topic++25IN+25'></span>

<h3>Description</h3>

<p>results of 'd01 in d02' style syntax
</p>


<h3>Usage</h3>

<pre><code class='language-R'>x %IN% y
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="+2B25IN+2B25_+3A_x">x</code></td>
<td>
<p>data.frame</p>
</td></tr>
<tr><td><code id="+2B25IN+2B25_+3A_y">y</code></td>
<td>
<p>data.frame or character string</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame with common columns or a cropped SpatRaster
</p>


<h3>Note</h3>

<p>a message is always displayed to keep easy to track and debug issues (with the results and the evaluation process).
</p>
<p>can be used to crop rast objects, such as arguments of sat() function
</p>


<h3>Examples</h3>

<pre><code class='language-R'>times &lt;- seq(as.POSIXct('2024-01-01',tz = 'UTC'),
             as.POSIXct('2024-01-02',tz = 'UTC'),
             by = 'hour')
randon_stuff &lt;- rnorm(25,10)

observation &lt;- data.frame(date   = times,
                          site_1 = randon_stuff,
                          site_3 = randon_stuff,
                          site_4 = randon_stuff,
                          site_5 = randon_stuff,
                          site_6 = randon_stuff,
                          site_7 = randon_stuff)

model_d01 &lt;- data.frame(date  = times,
                        site_1=randon_stuff+1,
                        site_2=randon_stuff+2,
                        site_3=randon_stuff+3,
                        site_4=randon_stuff+4)

model_d02 &lt;- data.frame(date  = times,
                        site_1=randon_stuff-1,
                        site_3=randon_stuff-3)

# multiline
model_d01_in_d02 &lt;- model_d01 %IN% model_d02
eva(mo = model_d01_in_d02, ob = observation, rname = 'd01 in d02')

# or single line
eva(mo = model_d01 %IN% model_d02, ob = observation, rname = 'd01 in d02')
# or
eva(mo = model_d01, ob = observation %IN% model_d02, rname = 'd01 in d02')

</code></pre>

<hr>
<h2 id='atr'>Read and write attributes on a NetCDF file</h2><span id='topic+atr'></span>

<h3>Description</h3>

<p>Read and write metadata information of a NetCDF files
</p>


<h3>Usage</h3>

<pre><code class='language-R'>atr(file = NA, var = "?", att = NA, action = "get", value = NA, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="atr_+3A_file">file</code></td>
<td>
<p>file name</p>
</td></tr>
<tr><td><code id="atr_+3A_var">var</code></td>
<td>
<p>variable name, 0 to global and &quot;?&quot; to show options</p>
</td></tr>
<tr><td><code id="atr_+3A_att">att</code></td>
<td>
<p>attribute names (NA for get all attnames)</p>
</td></tr>
<tr><td><code id="atr_+3A_action">action</code></td>
<td>
<p>&quot;get&quot; (default), &quot;write&quot; or &quot;print&quot; (return the value) of an attribute</p>
</td></tr>
<tr><td><code id="atr_+3A_value">value</code></td>
<td>
<p>value to write</p>
</td></tr>
<tr><td><code id="atr_+3A_verbose">verbose</code></td>
<td>
<p>display additional information</p>
</td></tr>
</table>


<h3>Value</h3>

<p>string with the NetCDF attribute value
</p>


<h3>Examples</h3>

<pre><code class='language-R'>nc &lt;- paste0(system.file("extdata",package="eva3dm"),'/wrfinput_d01')
atr(nc,0)
atr(nc,'Times')
atr(nc,'XLAT')
atr(nc,'XLONG')

atr(nc,'XLONG','MemoryOrder')
atr(nc,'XLONG','description')
atr(nc,'XLONG','units')
atr(nc,'XLONG','stagger')
atr(nc,'XLONG','FieldType')

</code></pre>

<hr>
<h2 id='cate'>Calculate categorical statistics in related to a threshold</h2><span id='topic+cate'></span>

<h3>Description</h3>

<p>Calculate traditional statistics related to a threshold
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cate(
  model,
  observation,
  threshold,
  cutoff = NA,
  nobs = 8,
  rname,
  to.plot = FALSE,
  col = "#4444bb",
  pch = 19,
  lty = 3,
  lcol = "#333333",
  lim,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cate_+3A_model">model</code></td>
<td>
<p>numeric vector with paired model data</p>
</td></tr>
<tr><td><code id="cate_+3A_observation">observation</code></td>
<td>
<p>numeric vector with paired observation data</p>
</td></tr>
<tr><td><code id="cate_+3A_threshold">threshold</code></td>
<td>
<p>reference value</p>
</td></tr>
<tr><td><code id="cate_+3A_cutoff">cutoff</code></td>
<td>
<p>(optionally the maximum) valid value for observation</p>
</td></tr>
<tr><td><code id="cate_+3A_nobs">nobs</code></td>
<td>
<p>minimum number of observations</p>
</td></tr>
<tr><td><code id="cate_+3A_rname">rname</code></td>
<td>
<p>row name</p>
</td></tr>
<tr><td><code id="cate_+3A_to.plot">to.plot</code></td>
<td>
<p>TRUE to plot a scatter-plot</p>
</td></tr>
<tr><td><code id="cate_+3A_col">col</code></td>
<td>
<p>color for points</p>
</td></tr>
<tr><td><code id="cate_+3A_pch">pch</code></td>
<td>
<p>pch of points</p>
</td></tr>
<tr><td><code id="cate_+3A_lty">lty</code></td>
<td>
<p>lty of threshold lines</p>
</td></tr>
<tr><td><code id="cate_+3A_lcol">lcol</code></td>
<td>
<p>col of threshold lines</p>
</td></tr>
<tr><td><code id="cate_+3A_lim">lim</code></td>
<td>
<p>limit for x and y</p>
</td></tr>
<tr><td><code id="cate_+3A_verbose">verbose</code></td>
<td>
<p>display additional information</p>
</td></tr>
<tr><td><code id="cate_+3A_...">...</code></td>
<td>
<p>arguments passed to plot</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a data.frame including: Accuracy (A); Critical Success Index (CSI); Probability of Detection (POD); Bias(B); False Alarm Ratio (FAR); Heidke Skill Score (HSS); Pearce skill Score (PSS) in 
</p>


<h3>References</h3>

<p>Yu, S., Mathur, R., Schere, K., Kang, D., Pleim, J., Young, J., ... &amp; Rao, S. T. (2008).
Evaluation of real‐time PM2. 5 forecasts and process analysis for PM2. 5 formation over
the eastern United States using the Eta‐CMAQ forecast model during the 2004 ICARTT study.
Journal of Geophysical Research: Atmospheres, 113(D6).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data &lt;- 0.02 * 1:100
set.seed(666)
model  &lt;- abs(rnorm(100,0.01))

oldpar &lt;- par(pty="s")
cate(model = model, observation = data, threshold = 1,
     to.plot = TRUE, rname = 'example')
par(oldpar)

</code></pre>

<hr>
<h2 id='daily'>Calculate daily mean, min or max</h2><span id='topic+daily'></span>

<h3>Description</h3>

<p>function to calculate daily mean, min or max of a data.frame
</p>


<h3>Usage</h3>

<pre><code class='language-R'>daily(
  data,
  time = "date",
  var,
  stat = mean,
  min_offset = 0,
  hour_offset = 0,
  numerical = TRUE,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="daily_+3A_data">data</code></td>
<td>
<p>data.frame with time column and variable columns to be processed</p>
</td></tr>
<tr><td><code id="daily_+3A_time">time</code></td>
<td>
<p>name of the time column (default is date) in POSIXct</p>
</td></tr>
<tr><td><code id="daily_+3A_var">var</code></td>
<td>
<p>name of the columns to be calculated</p>
</td></tr>
<tr><td><code id="daily_+3A_stat">stat</code></td>
<td>
<p>function of the statistics to calculate (default is mean)</p>
</td></tr>
<tr><td><code id="daily_+3A_min_offset">min_offset</code></td>
<td>
<p>minutes of observation from previous hour (default is 0)</p>
</td></tr>
<tr><td><code id="daily_+3A_hour_offset">hour_offset</code></td>
<td>
<p>hours of observation from previous day (default is 0)</p>
</td></tr>
<tr><td><code id="daily_+3A_numerical">numerical</code></td>
<td>
<p>TRUE (defoult) include only numerical columns</p>
</td></tr>
<tr><td><code id="daily_+3A_verbose">verbose</code></td>
<td>
<p>display additional information</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame with time and the daily mean, min or max
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sites &lt;- c("OAKB")
for(site in sites){
cat('downloading METAR from:',site,'...\n')
DATA &lt;- riem::riem_measures(station    = sites,
                            date_start = "2012-01-01",
                            date_end   = "2012-02-01")
}
data_daily_mean &lt;- daily(DATA,time = 'valid')
data_daily_min  &lt;- daily(DATA[1:7],time = 'valid',stat = min)
data_daily_max  &lt;- daily(DATA[1:7],time = 'valid',stat = max)

</code></pre>

<hr>
<h2 id='eva'>Model statistical evaluation</h2><span id='topic+eva'></span>

<h3>Description</h3>

<p>Statistical (or categorical) evaluation from 2 data.frames. The input data.frames (model and observation)
must contain a &quot;date&quot; column (containing POSIXlt). The function perform some simple case tests and
perform the time pairing of observations and model data and can calculate the statistical evaluation or
categorical evaluation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>eva(
  mo,
  ob,
  rname = site,
  table = NULL,
  site = "ALL",
  wd = FALSE,
  fair = NULL,
  cutoff = NA,
  cutoff_NME = NA,
  no_tz = FALSE,
  nobs = 8,
  eval_function = stat,
  time = "date",
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="eva_+3A_mo">mo</code></td>
<td>
<p>data.frame with model data</p>
</td></tr>
<tr><td><code id="eva_+3A_ob">ob</code></td>
<td>
<p>data.frame with observation data</p>
</td></tr>
<tr><td><code id="eva_+3A_rname">rname</code></td>
<td>
<p>row name of the output (default is site argument)</p>
</td></tr>
<tr><td><code id="eva_+3A_table">table</code></td>
<td>
<p>data.frame to append the results</p>
</td></tr>
<tr><td><code id="eva_+3A_site">site</code></td>
<td>
<p>name of the stations or &quot;ALL&quot; (default), see notes</p>
</td></tr>
<tr><td><code id="eva_+3A_wd">wd</code></td>
<td>
<p>default is FALSE, see notes</p>
</td></tr>
<tr><td><code id="eva_+3A_fair">fair</code></td>
<td>
<p>model data.frame (or list of names) to perform a fair comparison, see notes</p>
</td></tr>
<tr><td><code id="eva_+3A_cutoff">cutoff</code></td>
<td>
<p>minimum (optionally the maximum) valid value for observation</p>
</td></tr>
<tr><td><code id="eva_+3A_cutoff_nme">cutoff_NME</code></td>
<td>
<p>minimum (optionally the maximum) valid value for observation for NME</p>
</td></tr>
<tr><td><code id="eva_+3A_no_tz">no_tz</code></td>
<td>
<p>ignore tz from input (force GMT)</p>
</td></tr>
<tr><td><code id="eva_+3A_nobs">nobs</code></td>
<td>
<p>minimum number of valid observations, default is 8</p>
</td></tr>
<tr><td><code id="eva_+3A_eval_function">eval_function</code></td>
<td>
<p>evaluation function (default is stat)</p>
</td></tr>
<tr><td><code id="eva_+3A_time">time</code></td>
<td>
<p>name of the time column (containing time in POSIXct)</p>
</td></tr>
<tr><td><code id="eva_+3A_verbose">verbose</code></td>
<td>
<p>display additional information</p>
</td></tr>
<tr><td><code id="eva_+3A_...">...</code></td>
<td>
<p>arguments to be passing to stats and plot</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame with statistical values from stat or cate functions.
</p>


<h3>Note</h3>

<p>fair can be a data.frame or a character string to be used for the analysis, alternatively the function 
</p>
<p>for wind direction a rotation of 360 (or -360) is applied to minimize the wind direction difference.
</p>
<p>If site == 'ALL' (default) all the columns from observations are combined in one column
(same for observation) and all the columns are evaluated together.
</p>
<p>Special thanks to Kiarash and Libo to help to test the wind direction option.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+stat">stat</a></code> for additional information about the statistical evaluation and <code><a href="#topic+cate">cate</a></code> for categorical evaluation.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>model &lt;- readRDS(paste0(system.file("extdata",package="eva3dm"),
                        "/model.Rds"))
obs   &lt;- readRDS(paste0(system.file("extdata",package="eva3dm"),
                        "/obs.Rds"))

# if there is no observed data
# the function return an empty row
table &lt;- eva(mo = model, ob = obs, site = "VVIbes")
print(table)

# if the site are not in the input data frame a message is displayed
# and the function return an empty row
table &lt;- eva(mo = model, ob = obs, site = "Ibirapuera")
print(table)

# calculating statistical with a few observed values
table &lt;- eva(mo = model, ob = obs, site = "Americana")
print(table)

# calculating categorical (using 2 for threshold) with a few observed values
table &lt;- eva(mo = model, ob = obs, site = "Americana",
             eval_function = cate, threshold = 2)
print(table)

# calculating categorical (using 2 for threshold) with a few observed values
table &lt;- eva(mo = model, ob = obs, site = "Americana",
             eval_function = cate, threshold = 10)
print(table)

</code></pre>

<hr>
<h2 id='extract_max_8h'>Create a NetCDF file with the surface maximum of O3</h2><span id='topic+extract_max_8h'></span>

<h3>Description</h3>

<p>Read the values from o3 and T2, convert o3 to ug m-3 and calculate the maximum of 8-hour moving avarage from a list of files.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_max_8h(
  filelist,
  variable = "o3",
  field = "4d",
  prefix = "max_8h",
  units = "ug m-3",
  meta = TRUE,
  filename,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="extract_max_8h_+3A_filelist">filelist</code></td>
<td>
<p>list of files to be read</p>
</td></tr>
<tr><td><code id="extract_max_8h_+3A_variable">variable</code></td>
<td>
<p>variable name</p>
</td></tr>
<tr><td><code id="extract_max_8h_+3A_field">field</code></td>
<td>
<p>'4d' (default), '3d', '2d' or '2dz' see notes</p>
</td></tr>
<tr><td><code id="extract_max_8h_+3A_prefix">prefix</code></td>
<td>
<p>to output file, default is serie</p>
</td></tr>
<tr><td><code id="extract_max_8h_+3A_units">units</code></td>
<td>
<p>units on netcdf file (default is ug m-3), change to skip unit conversion</p>
</td></tr>
<tr><td><code id="extract_max_8h_+3A_meta">meta</code></td>
<td>
<p>use Times, XLONG and XLAT data (only works with 2d variable for file)</p>
</td></tr>
<tr><td><code id="extract_max_8h_+3A_filename">filename</code></td>
<td>
<p>name for the file, in this case prefix is not used</p>
</td></tr>
<tr><td><code id="extract_max_8h_+3A_verbose">verbose</code></td>
<td>
<p>display additional information</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value
</p>


<h3>Note</h3>

<p>The field argument '4d' / '2dz' is used to read a 4d/3d variable droping the 3rd dimention (z).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dir.create(file.path(tempdir(), "MDA8"))
folder &lt;- system.file("extdata",package="eva3dm")
wrf_file &lt;- paste0(folder,"/test_small_o3.nc")
extract_max_8h(filelist = wrf_file,
               prefix = paste0(file.path(tempdir(),"MDA8"),'/mean'),
               field = '3d')

</code></pre>

<hr>
<h2 id='extract_mean'>Create a NetCDF file with the surface mean</h2><span id='topic+extract_mean'></span>

<h3>Description</h3>

<p>Read and calculate the mean value of a variable from a list of wrf output files.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_mean(
  filelist,
  variable = "o3",
  field = "4d",
  prefix = "mean",
  units = "ppmv",
  meta = TRUE,
  filename,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="extract_mean_+3A_filelist">filelist</code></td>
<td>
<p>list of files to be read</p>
</td></tr>
<tr><td><code id="extract_mean_+3A_variable">variable</code></td>
<td>
<p>variable name</p>
</td></tr>
<tr><td><code id="extract_mean_+3A_field">field</code></td>
<td>
<p>'4d' (default), '3d', '2d' or '2dz' see notes</p>
</td></tr>
<tr><td><code id="extract_mean_+3A_prefix">prefix</code></td>
<td>
<p>to output file, default is serie</p>
</td></tr>
<tr><td><code id="extract_mean_+3A_units">units</code></td>
<td>
<p>units on netcdf file (default is ppmv)</p>
</td></tr>
<tr><td><code id="extract_mean_+3A_meta">meta</code></td>
<td>
<p>use Times, XLONG and XLAT data (only works with 2d variable for file)</p>
</td></tr>
<tr><td><code id="extract_mean_+3A_filename">filename</code></td>
<td>
<p>name for the file, in this case prefix is not used</p>
</td></tr>
<tr><td><code id="extract_mean_+3A_verbose">verbose</code></td>
<td>
<p>display additional information</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value
</p>


<h3>Note</h3>

<p>The field argument '4d' / '2dz' is used to read a 4d/3d variable droping the 3rd dimention (z).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dir.create(file.path(tempdir(), "MEAN"))
folder &lt;- system.file("extdata",package="eva3dm")
wrf_file &lt;- paste0(folder,"/wrf.day1.o3.nc")
extract_mean(filelist = wrf_file,prefix = paste0(file.path(tempdir(),"MEAN"),'/mean'))

</code></pre>

<hr>
<h2 id='extract_serie'>Extract time series of wrf file list of lat/lon</h2><span id='topic+extract_serie'></span>

<h3>Description</h3>

<p>Read and extract data from a list of wrf output files and a table of lat/lon points based on the distance of the points and the center of model grid points, points outside the domain (and points on domain boundary) are not extracted.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_serie(
  filelist,
  point,
  variable = "o3",
  field = "4d",
  prefix = "serie",
  new = "check",
  return.nearest = FALSE,
  fast = FALSE,
  use_ij = FALSE,
  latitude = "XLAT",
  longitude = "XLONG",
  use_TFLAG = FALSE,
  use_datesec = FALSE,
  id = "id",
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="extract_serie_+3A_filelist">filelist</code></td>
<td>
<p>list of files to be read</p>
</td></tr>
<tr><td><code id="extract_serie_+3A_point">point</code></td>
<td>
<p>data.frame with lat/lon</p>
</td></tr>
<tr><td><code id="extract_serie_+3A_variable">variable</code></td>
<td>
<p>variable name</p>
</td></tr>
<tr><td><code id="extract_serie_+3A_field">field</code></td>
<td>
<p>'4d' (defoult), '3d', '2d' or '2dz' see notes</p>
</td></tr>
<tr><td><code id="extract_serie_+3A_prefix">prefix</code></td>
<td>
<p>to output file, default is serie</p>
</td></tr>
<tr><td><code id="extract_serie_+3A_new">new</code></td>
<td>
<p>TRUE, FALSE of 'check' see notes</p>
</td></tr>
<tr><td><code id="extract_serie_+3A_return.nearest">return.nearest</code></td>
<td>
<p>return the data.frame of nearest points instead of extract the serie</p>
</td></tr>
<tr><td><code id="extract_serie_+3A_fast">fast</code></td>
<td>
<p>faster calculation of grid distances but less precise</p>
</td></tr>
<tr><td><code id="extract_serie_+3A_use_ij">use_ij</code></td>
<td>
<p>logical, use i and j from input instead of calculate</p>
</td></tr>
<tr><td><code id="extract_serie_+3A_latitude">latitude</code></td>
<td>
<p>name of latitude coordinate variable in the netcdf</p>
</td></tr>
<tr><td><code id="extract_serie_+3A_longitude">longitude</code></td>
<td>
<p>name of longitude coordinate variable in the netcdf</p>
</td></tr>
<tr><td><code id="extract_serie_+3A_use_tflag">use_TFLAG</code></td>
<td>
<p>use the variable TFLAG (CMAQ / smoke) instead of Times (WRF)</p>
</td></tr>
<tr><td><code id="extract_serie_+3A_use_datesec">use_datesec</code></td>
<td>
<p>use the variable date and datesec (WACCM / CAM-Chem) instead of Times (WRF)</p>
</td></tr>
<tr><td><code id="extract_serie_+3A_id">id</code></td>
<td>
<p>name of the column with station names, if point is a SpatVector (points) from terra package</p>
</td></tr>
<tr><td><code id="extract_serie_+3A_verbose">verbose</code></td>
<td>
<p>display additional information</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value
</p>


<h3>Note</h3>

<p>The field argument '4d' or '2dz' is used to read a 4d/3d variable droping the 3rd dimention (z).
</p>
<p>new = TRUE create a new file, new = FALSE append the data in a old file, and new = 'check' check if the file exist and append if the file exist and create if the file doesnt exist
</p>
<p>FOR CAMx time-series, use the options: use_TFLAG=T, latitude='latitude', longitude='longitude', new=T
</p>
<p>FOR WACCM time-series, use the options: use_datesec=T, latitude='lat', longitude='lon', new=T
</p>
<p>The site-list of two global data-sets (METAR and AERONET) are provided on examples and site-list for stations on Brazil (INMET and Air Quality stations).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>cat('Example 1: METAR site list\n')
sites &lt;- readRDS(paste0(system.file("extdata",package="eva3dm"),"/sites_METAR.Rds"))

cat('Example 2: AERONET site list\n')
sites &lt;- readRDS(paste0(system.file("extdata",package="eva3dm"),"/sites_AERONET.Rds"))

cat('Example 3: list of INMET stations on Brazil\n')
sites &lt;- readRDS(paste0(system.file("extdata",package="eva3dm"),"/sites_INMET.Rds"))

cat('Example 4: list of Air Quality stations on Brazil\n')
sites &lt;- readRDS(paste0(system.file("extdata",package="eva3dm"),"/sites_AQ_BR.Rds"))

files    &lt;- dir(path = system.file("extdata",package="eva3dm"),
                pattern = 'wrf.day',
                full.names = TRUE)
dir.create(file.path(tempdir(),"SERIE"))
folder &lt;- file.path(tempdir(),"SERIE")

# extract data for 3 locations
extract_serie(filelist = files, point = sites[1:3,],prefix = paste0(folder,'/serie'))

</code></pre>

<hr>
<h2 id='get_distances'>Get the distance in kilometers between two points</h2><span id='topic+get_distances'></span>

<h3>Description</h3>

<p>Get the distance in kilometers between two points
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_distances(lat1, long1, lat2, long2, R = 6371)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_distances_+3A_lat1">lat1</code></td>
<td>
<p>Latitude in decimals</p>
</td></tr>
<tr><td><code id="get_distances_+3A_long1">long1</code></td>
<td>
<p>Longitude in decimals</p>
</td></tr>
<tr><td><code id="get_distances_+3A_lat2">lat2</code></td>
<td>
<p>Latitude in decimals</p>
</td></tr>
<tr><td><code id="get_distances_+3A_long2">long2</code></td>
<td>
<p>Longitude in decimals</p>
</td></tr>
<tr><td><code id="get_distances_+3A_r">R</code></td>
<td>
<p>Radius of the earth in kmdescription (R=6371)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector with the distance in kilometers.
</p>
<p>#' source: https://github.com/gustavobio/brclimate/blob/master/R/get_distances.R
</p>

<hr>
<h2 id='hourly'>Calculate hourly mean, min or max</h2><span id='topic+hourly'></span>

<h3>Description</h3>

<p>function to calculate Ozone Maximum Daily 8-hr Average or 8-hr moving Average for a data.frame
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hourly(
  data,
  time = "date",
  var,
  stat = mean,
  min_offset = 30,
  numerical = TRUE,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="hourly_+3A_data">data</code></td>
<td>
<p>data.frame with time column and variable columns to be processed</p>
</td></tr>
<tr><td><code id="hourly_+3A_time">time</code></td>
<td>
<p>name of the time column (default is date) in POSIXct</p>
</td></tr>
<tr><td><code id="hourly_+3A_var">var</code></td>
<td>
<p>name of the columns to be calculated</p>
</td></tr>
<tr><td><code id="hourly_+3A_stat">stat</code></td>
<td>
<p>function of the statistics to calculate (default is mean)</p>
</td></tr>
<tr><td><code id="hourly_+3A_min_offset">min_offset</code></td>
<td>
<p>minutes of observation from previous hour (default is 30)</p>
</td></tr>
<tr><td><code id="hourly_+3A_numerical">numerical</code></td>
<td>
<p>TRUE (default) includes only numerical columns</p>
</td></tr>
<tr><td><code id="hourly_+3A_verbose">verbose</code></td>
<td>
<p>display additional information</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame including only numerical columns
</p>
<p>data.frame with time and the hourly mean, min or max
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sites &lt;- c("OAHR")
for(site in sites){
cat('downloading METAR from:',site,'...\n')
DATA &lt;- riem::riem_measures(station    = sites,
                            date_start = "2012-01-01",
                            date_end   = "2012-02-01")
}
data_hourly_mean &lt;- hourly(DATA,time = 'valid')
data_hourly_min  &lt;- hourly(DATA[1:7],time = 'valid',stat = min)
data_hourly_max  &lt;- hourly(DATA[1:7],time = 'valid',stat = max)

</code></pre>

<hr>
<h2 id='interp'>Interpolation (project and resample)</h2><span id='topic+interp'></span>

<h3>Description</h3>

<p>function to project and interpolate rast
</p>


<h3>Usage</h3>

<pre><code class='language-R'>interp(x, y, method = "bilinear", mask, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="interp_+3A_x">x</code></td>
<td>
<p>rast to be interpolated</p>
</td></tr>
<tr><td><code id="interp_+3A_y">y</code></td>
<td>
<p>target rast of the interpolation</p>
</td></tr>
<tr><td><code id="interp_+3A_method">method</code></td>
<td>
<p>passed to terra::resample</p>
</td></tr>
<tr><td><code id="interp_+3A_mask">mask</code></td>
<td>
<p>optional SpatVector to mask the results</p>
</td></tr>
<tr><td><code id="interp_+3A_verbose">verbose</code></td>
<td>
<p>display additional information (not used)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>SpatRaster (terra package)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>model_o3 &lt;- terra::rast(paste0(system.file("extdata",package="eva3dm"),
                              "/camx_no2.Rds"))
omi_o3   &lt;- terra::rast(paste0(system.file("extdata",package="eva3dm"),
                              "/omi_no2.Rds"))

# interpolate omi O3 column to model grid
omi_o3c_interp_model &lt;- interp(omi_o3,model_o3)

# interpolate model o3 column to omi grid
model_o3c_interp_omi &lt;- interp(omi_o3,model_o3)

</code></pre>

<hr>
<h2 id='legend_range'>Plot a legend with the range of values</h2><span id='topic+legend_range'></span>

<h3>Description</h3>

<p>Plot a legend with the range of values
</p>


<h3>Usage</h3>

<pre><code class='language-R'>legend_range(
  x,
  y,
  text.width = NULL,
  dig = c(2, 2, 2),
  xjust = 0.005,
  yjust = 0.95,
  horiz = TRUE,
  y.intersp = 0.5,
  x.intersp = 0.5,
  show.mean = TRUE,
  unit = "",
  label_mean = "ALL:",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="legend_range_+3A_x">x</code></td>
<td>
<p>rast or array</p>
</td></tr>
<tr><td><code id="legend_range_+3A_y">y</code></td>
<td>
<p>rast or array to mean (x is used only for the range in this case)</p>
</td></tr>
<tr><td><code id="legend_range_+3A_text.width">text.width</code></td>
<td>
<p>Longitude in decimals</p>
</td></tr>
<tr><td><code id="legend_range_+3A_dig">dig</code></td>
<td>
<p>vector with number of digits for plot</p>
</td></tr>
<tr><td><code id="legend_range_+3A_xjust">xjust</code></td>
<td>
<p>passed to legend</p>
</td></tr>
<tr><td><code id="legend_range_+3A_yjust">yjust</code></td>
<td>
<p>passed to legend</p>
</td></tr>
<tr><td><code id="legend_range_+3A_horiz">horiz</code></td>
<td>
<p>passed to legend</p>
</td></tr>
<tr><td><code id="legend_range_+3A_y.intersp">y.intersp</code></td>
<td>
<p>passed to legend</p>
</td></tr>
<tr><td><code id="legend_range_+3A_x.intersp">x.intersp</code></td>
<td>
<p>passed to legend</p>
</td></tr>
<tr><td><code id="legend_range_+3A_show.mean">show.mean</code></td>
<td>
<p>set TRUE to hide mean value</p>
</td></tr>
<tr><td><code id="legend_range_+3A_unit">unit</code></td>
<td>
<p>a string for units</p>
</td></tr>
<tr><td><code id="legend_range_+3A_label_mean">label_mean</code></td>
<td>
<p>label in case y is provided</p>
</td></tr>
<tr><td><code id="legend_range_+3A_...">...</code></td>
<td>
<p>extra arguments passed to legend</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value
</p>


<h3>Note</h3>

<p>for use with rast use before any change of projection
</p>
<p>text.width can vary depending on map dimensions
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x &lt;- 1:10 + rnorm(10,sd = .4)
plot(x,ty='l')
legend_range(x)

</code></pre>

<hr>
<h2 id='ma8h'>Calculate 8-hour moving average</h2><span id='topic+ma8h'></span>

<h3>Description</h3>

<p>function to calculate Ozone 8-hour moving average for a data.frame
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ma8h(data, time = "date", var, verbose = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ma8h_+3A_data">data</code></td>
<td>
<p>data.frame with time column and variable columns to be processed</p>
</td></tr>
<tr><td><code id="ma8h_+3A_time">time</code></td>
<td>
<p>name of the time column (default is date) in POSIXct</p>
</td></tr>
<tr><td><code id="ma8h_+3A_var">var</code></td>
<td>
<p>name of the columns to be calculated</p>
</td></tr>
<tr><td><code id="ma8h_+3A_verbose">verbose</code></td>
<td>
<p>display additional information</p>
</td></tr>
<tr><td><code id="ma8h_+3A_...">...</code></td>
<td>
<p>parameters passed to hourly</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame with time and the 8-hour moving average
</p>


<h3>Examples</h3>

<pre><code class='language-R'>model_file &lt;- paste(system.file("extdata", package = "eva3dm"),
                                "/model_o3_ugm3_36km.Rds", sep="")
model      &lt;- readRDS(model_file)
model_8h   &lt;- ma8h(model)
plot(model$date,model$Campinas, pch = 19,
     main = expression(O[3]~~'['*mu*g*m^-3*']'))
points(model_8h$date,model_8h$Campinas, col = 'blue', pch = 19)
legend('topleft',bty = 'n',
       pch = 19,
       legend = c('hourly','8h-mov average'),
       col = c('black','blue'))
</code></pre>

<hr>
<h2 id='mda8'>Maximum Daily 8-hr Average</h2><span id='topic+mda8'></span>

<h3>Description</h3>

<p>function to calculate Ozone Maximum Daily 8-hr Average or 8-hr moving Average for a data.frame
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mda8(data, time = "date", var, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mda8_+3A_data">data</code></td>
<td>
<p>data.frame with time column and variable columns to be processed</p>
</td></tr>
<tr><td><code id="mda8_+3A_time">time</code></td>
<td>
<p>name of the time column (default is date) in POSIXct</p>
</td></tr>
<tr><td><code id="mda8_+3A_var">var</code></td>
<td>
<p>name of the columns to be calculated</p>
</td></tr>
<tr><td><code id="mda8_+3A_verbose">verbose</code></td>
<td>
<p>display additional information</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame with time and the maximum daily 8-hr average
</p>


<h3>Examples</h3>

<pre><code class='language-R'>model_file &lt;- paste(system.file("extdata", package = "eva3dm"),
                    "/model_o3_ugm3_36km.Rds", sep="")
model      &lt;- readRDS(model_file)
model_mda8 &lt;- mda8(model)
model_8h   &lt;- ma8h(model)
plot(model$date,model$Campinas, pch = 19,
     main = expression(O[3]~~'['*mu*g*m^-3*']'))
points(model_8h$date,model_8h$Campinas, col = 'blue', pch = 19)
points(model_mda8$date + 17*60*60,model_mda8$Campinas,
       col = 'red', pch = 4, cex = 2)
legend('topleft',bty = 'n',
       pch = c(19,19,4),
       legend = c('hourly','8h-mov average','MD8A'),
       col = c('black','blue','red'))
</code></pre>

<hr>
<h2 id='ncdump'>Print a 'ncdump -h' command</h2><span id='topic+ncdump'></span>

<h3>Description</h3>

<p>Read a NetCDF and print the medatada
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ncdump(file = file.choose())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ncdump_+3A_file">file</code></td>
<td>
<p>file name</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, only display information
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ncdump(file = paste0(system.file("extdata",package="eva3dm"),
                     '/wrfinput_d01'))

</code></pre>

<hr>
<h2 id='overlay'>Plot or add points using a color scale</h2><span id='topic+overlay'></span>

<h3>Description</h3>

<p>Custon plot for SpatRaster (terra R-package) object based on terra package
</p>


<h3>Usage</h3>

<pre><code class='language-R'>overlay(
  p,
  z,
  col,
  lim = range(z, na.rm = TRUE),
  symmetry = TRUE,
  pch = 19,
  cex = 1,
  outside = TRUE,
  add = FALSE,
  plg = list(tic = "none", shrink = 1),
  pax = list(),
  expand = 1.15,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="overlay_+3A_p">p</code></td>
<td>
<p>SpatVector points</p>
</td></tr>
<tr><td><code id="overlay_+3A_z">z</code></td>
<td>
<p>column name or a vector of values to plot</p>
</td></tr>
<tr><td><code id="overlay_+3A_col">col</code></td>
<td>
<p>color</p>
</td></tr>
<tr><td><code id="overlay_+3A_lim">lim</code></td>
<td>
<p>range of values for scale</p>
</td></tr>
<tr><td><code id="overlay_+3A_symmetry">symmetry</code></td>
<td>
<p>calculate symmetrical scale</p>
</td></tr>
<tr><td><code id="overlay_+3A_pch">pch</code></td>
<td>
<p>type of point</p>
</td></tr>
<tr><td><code id="overlay_+3A_cex">cex</code></td>
<td>
<p>character expansion for the points</p>
</td></tr>
<tr><td><code id="overlay_+3A_outside">outside</code></td>
<td>
<p>to include values outside range</p>
</td></tr>
<tr><td><code id="overlay_+3A_add">add</code></td>
<td>
<p>add to existing plot</p>
</td></tr>
<tr><td><code id="overlay_+3A_plg">plg</code></td>
<td>
<p>list of parameters passed to terra::add_legend</p>
</td></tr>
<tr><td><code id="overlay_+3A_pax">pax</code></td>
<td>
<p>list of parameters passed to graphics::axis</p>
</td></tr>
<tr><td><code id="overlay_+3A_expand">expand</code></td>
<td>
<p>to expand the plot region</p>
</td></tr>
<tr><td><code id="overlay_+3A_...">...</code></td>
<td>
<p>arguments to be passing to terra::plot</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sp&lt;- terra::vect(paste0(system.file("extdata",package="eva3dm"),"/masp.shp"))
BR&lt;- terra::vect(paste0(system.file("extdata",package="eva3dm"),"/BR.shp"))

p    &lt;- readRDS(paste0(system.file("extdata",package="eva3dm"),"/sites_AQ_BR.Rds"))
p$id      &lt;- row.names(p)
point     &lt;- terra::vect(p)
point$NMB &lt;- 1:45 - 20 # some values to plot

terra::plot(BR, main = 'add points',xlim = c(-52,-37),ylim = c(-25,-18))
terra::lines(BR)
terra::lines(sp, col = 'gray')
overlay(point,point$NMB,cex = 1.4, add = TRUE)

overlay(point,point$NMB,cex = 1.4, add = FALSE, main = 'new plot')
terra::lines(BR)
terra::lines(sp, col = 'gray')

</code></pre>

<hr>
<h2 id='plot_diff'>Plot the difference from two SpatRaster objects</h2><span id='topic+plot_diff'></span>

<h3>Description</h3>

<p>Custom difference (x - y) plots for SpatRaster object (based on terra package)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_diff(
  x,
  y,
  col,
  absolute = TRUE,
  relative = TRUE,
  lim_1 = NA,
  lim_2 = NA,
  unit = c(units(x), expression("%")),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_diff_+3A_x">x</code></td>
<td>
<p>SpatVector points</p>
</td></tr>
<tr><td><code id="plot_diff_+3A_y">y</code></td>
<td>
<p>values to plot</p>
</td></tr>
<tr><td><code id="plot_diff_+3A_col">col</code></td>
<td>
<p>color</p>
</td></tr>
<tr><td><code id="plot_diff_+3A_absolute">absolute</code></td>
<td>
<p>to plot absolute difference</p>
</td></tr>
<tr><td><code id="plot_diff_+3A_relative">relative</code></td>
<td>
<p>to plot relative difference</p>
</td></tr>
<tr><td><code id="plot_diff_+3A_lim_1">lim_1</code></td>
<td>
<p>range of values for scale</p>
</td></tr>
<tr><td><code id="plot_diff_+3A_lim_2">lim_2</code></td>
<td>
<p>calculate symmetrical scale</p>
</td></tr>
<tr><td><code id="plot_diff_+3A_unit">unit</code></td>
<td>
<p>annotation for units</p>
</td></tr>
<tr><td><code id="plot_diff_+3A_...">...</code></td>
<td>
<p>arguments to be passing to plot_raster</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
folder &lt;- system.file("extdata",package="eva3dm")
wrf    &lt;- paste0(folder,"/wrfinput_d01")
A      &lt;- wrf_rast(wrf,'XLAT')
terra::units(A) &lt;- 'degrees'
B      &lt;- wrf_rast(wrf,'XLONG')
plot_diff(A,B,int = 2)
</code></pre>

<hr>
<h2 id='plot_rast'>Plot rast (SpatRaster) object</h2><span id='topic+plot_rast'></span>

<h3>Description</h3>

<p>Custon plot for SpatRaster (terra R-package) object based on terra package
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_rast(
  r,
  color,
  ncolor = 21,
  proj = FALSE,
  plg = list(tic = "none", shrink = 1),
  pax = list(),
  latitude = TRUE,
  longitude = TRUE,
  int = 10,
  grid = FALSE,
  grid_int = int,
  grid_col = "#666666",
  add_range = FALSE,
  ndig = 2,
  log = FALSE,
  range,
  min = -3,
  max,
  unit,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_rast_+3A_r">r</code></td>
<td>
<p>raster</p>
</td></tr>
<tr><td><code id="plot_rast_+3A_color">color</code></td>
<td>
<p>color scale, or name of a custom color scale (see notes)</p>
</td></tr>
<tr><td><code id="plot_rast_+3A_ncolor">ncolor</code></td>
<td>
<p>number of colors</p>
</td></tr>
<tr><td><code id="plot_rast_+3A_proj">proj</code></td>
<td>
<p>TRUE to project the raster to lat-lon</p>
</td></tr>
<tr><td><code id="plot_rast_+3A_plg">plg</code></td>
<td>
<p>list of parameters passed to terra::add_legend</p>
</td></tr>
<tr><td><code id="plot_rast_+3A_pax">pax</code></td>
<td>
<p>list of parameters passed to graphics::axis</p>
</td></tr>
<tr><td><code id="plot_rast_+3A_latitude">latitude</code></td>
<td>
<p>add a latitude axis</p>
</td></tr>
<tr><td><code id="plot_rast_+3A_longitude">longitude</code></td>
<td>
<p>add a longitude axis</p>
</td></tr>
<tr><td><code id="plot_rast_+3A_int">int</code></td>
<td>
<p>interval of latitude and longitude lines</p>
</td></tr>
<tr><td><code id="plot_rast_+3A_grid">grid</code></td>
<td>
<p>add grid (graticule style)</p>
</td></tr>
<tr><td><code id="plot_rast_+3A_grid_int">grid_int</code></td>
<td>
<p>interval of grid lines</p>
</td></tr>
<tr><td><code id="plot_rast_+3A_grid_col">grid_col</code></td>
<td>
<p>color for grid lines</p>
</td></tr>
<tr><td><code id="plot_rast_+3A_add_range">add_range</code></td>
<td>
<p>add legend with max, average and min r values</p>
</td></tr>
<tr><td><code id="plot_rast_+3A_ndig">ndig</code></td>
<td>
<p>number of digits for legend_range</p>
</td></tr>
<tr><td><code id="plot_rast_+3A_log">log</code></td>
<td>
<p>TRUE to plot in log-scale</p>
</td></tr>
<tr><td><code id="plot_rast_+3A_range">range</code></td>
<td>
<p>range of original values to plot</p>
</td></tr>
<tr><td><code id="plot_rast_+3A_min">min</code></td>
<td>
<p>minimum log value for log scale (defoul is -3)</p>
</td></tr>
<tr><td><code id="plot_rast_+3A_max">max</code></td>
<td>
<p>maximum log value for log scale</p>
</td></tr>
<tr><td><code id="plot_rast_+3A_unit">unit</code></td>
<td>
<p>title for color bar (defoult is )</p>
</td></tr>
<tr><td><code id="plot_rast_+3A_...">...</code></td>
<td>
<p>arguments to be passing to terra::plot</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value
</p>


<h3>Note</h3>

<p>color scale includes: 'eva3r' (default), 'eva4', 'blues' and 'diff'
</p>


<h3>Examples</h3>

<pre><code class='language-R'>wrf &lt;- paste(system.file("extdata", package = "eva3dm"),
                         "/wrfinput_d01", sep="")

r &lt;- wrf_rast(file=wrf, name='XLAT')

plot_rast(r)

</code></pre>

<hr>
<h2 id='q2rh'>Convert absolute humidity to relative humidity</h2><span id='topic+q2rh'></span>

<h3>Description</h3>

<p>function to convert absolute humidity to relative humidity.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>q2rh(q, t = 15, p = 101325)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="q2rh_+3A_q">q</code></td>
<td>
<p>vector (or data.frame) of absolute humidity (in g/Kg)</p>
</td></tr>
<tr><td><code id="q2rh_+3A_t">t</code></td>
<td>
<p>vector (or data.frame) of temperature (in Celcius)</p>
</td></tr>
<tr><td><code id="q2rh_+3A_p">p</code></td>
<td>
<p>vector (or data.frame) of pressure (in Pa)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector or data.frame with time and the relative humidity, units are 
</p>


<h3>Note</h3>

<p>default values are from standard atmosphere (288.15 K (15C) / 101325 Pa)
</p>
<p>if rh and temp arguments are data.frame, both need to have the same number of lines and columns, first column (time column) will be ignored.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># for a single value (or same length vectors)
q2rh(q = 0.0002038, t = 29.3, p = 100800)

# using all data.frames
times &lt;- seq(as.POSIXct('2024-01-01',tz = 'UTC'),
             as.POSIXct('2024-01-02',tz = 'UTC'),
             by = 'hour')[1:5]
q2   &lt;- data.frame(time = times, a = rep(0.0002038,5))
temp &lt;- data.frame(time = times, a = rep(     29.3,5))
pres &lt;- data.frame(time = times, a = rep(   100800,5))
q2rh(q = q2, t = temp, p = pres)

# using data.frame for q and t (p is cte.)
q2rh(q = q2, t = temp, p = 100000)

# using data.frame for q and p (t is cte.)
q2rh(q = q2, t = 26, p = pres)

# using data.frame only for q (p and t are cte.)
q2rh(q = q2, t = 26, p = 100000)

</code></pre>

<hr>
<h2 id='rain'>conversion of model precipitation to hourly precipitation</h2><span id='topic+rain'></span>

<h3>Description</h3>

<p>function that converts model accumulated precipitation to hourly precipitation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rain(rainc, rainnc, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rain_+3A_rainc">rainc</code></td>
<td>
<p>data.frame or SpatRaster with RAINC variable</p>
</td></tr>
<tr><td><code id="rain_+3A_rainnc">rainnc</code></td>
<td>
<p>data.frame or SpatRaster with RAINNC variable</p>
</td></tr>
<tr><td><code id="rain_+3A_verbose">verbose</code></td>
<td>
<p>set TRUE to display additional information</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame time and the hourly precipitation or SpatRaster hourly precipitation
</p>


<h3>Examples</h3>

<pre><code class='language-R'>times &lt;- seq(as.POSIXct('2024-01-01',tz = 'UTC'),
             as.POSIXct('2024-01-01 04:00:00',tz = 'UTC'),
             by = 'hour')
RNC   &lt;- data.frame(date = times, aa = c(0.149,0.149,0.149,0.149,0.149))
RNNC  &lt;- data.frame(date = times, aa = c(0.919,1.0,1.1,1.1,2.919))
rain(rainc = RNC, rainnc = RNNC)
</code></pre>

<hr>
<h2 id='rast_to_netcdf'>Function to convert/save a SpatRaster array/Netcdf</h2><span id='topic+rast_to_netcdf'></span>

<h3>Description</h3>

<p>Conversion of SpatRaster to array and optionally save on a Netcdf File.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rast_to_netcdf(r, file, name, unit = units(r), XY = FALSE, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rast_to_netcdf_+3A_r">r</code></td>
<td>
<p>SpatRaster object</p>
</td></tr>
<tr><td><code id="rast_to_netcdf_+3A_file">file</code></td>
<td>
<p>Netcdf file name</p>
</td></tr>
<tr><td><code id="rast_to_netcdf_+3A_name">name</code></td>
<td>
<p>variable name on a Netcdf file</p>
</td></tr>
<tr><td><code id="rast_to_netcdf_+3A_unit">unit</code></td>
<td>
<p>unit of the variable (set to NA to don't change unit)</p>
</td></tr>
<tr><td><code id="rast_to_netcdf_+3A_xy">XY</code></td>
<td>
<p>set to true if MemoryOrder is XY (only if file is missing)</p>
</td></tr>
<tr><td><code id="rast_to_netcdf_+3A_verbose">verbose</code></td>
<td>
<p>display additional information</p>
</td></tr>
</table>


<h3>Value</h3>

<p>numerical array
</p>


<h3>Note</h3>

<p>eva3dm::wrf_rast support 3d SpatRaster, in case of a 4d variable use other approach to save on file.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>folder   &lt;- system.file("extdata",package="eva3dm")
wrf_file &lt;- paste0(folder,"/wrf.day1.o3.nc")

Rast     &lt;- wrf_rast(wrf_file,'o3')
A        &lt;- rast_to_netcdf(Rast)

</code></pre>

<hr>
<h2 id='read_stat'>Function to read stats and evaluation</h2><span id='topic+read_stat'></span>

<h3>Description</h3>

<p>Function to read stats and evaluation output
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_stat(file, sep = ";", dec = ".", verbose = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="read_stat_+3A_file">file</code></td>
<td>
<p>model data.frame</p>
</td></tr>
<tr><td><code id="read_stat_+3A_sep">sep</code></td>
<td>
<p>the field separator string, passed to read.table function</p>
</td></tr>
<tr><td><code id="read_stat_+3A_dec">dec</code></td>
<td>
<p>he string to use for decimal points, passed to read.table function</p>
</td></tr>
<tr><td><code id="read_stat_+3A_verbose">verbose</code></td>
<td>
<p>display additional information</p>
</td></tr>
<tr><td><code id="read_stat_+3A_...">...</code></td>
<td>
<p>arguments passed to read.table functions</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sample &lt;- read_stat(file    = paste0(system.file("extdata", package = "eva3dm"),"/sample.txt"),
                    verbose = TRUE)

sample &lt;- read_stat(file    = paste0(system.file("extdata", package = "eva3dm"),"/sample.csv"),
                    verbose = TRUE)

</code></pre>

<hr>
<h2 id='rh2q'>Convert relative humidity to absolute humidity</h2><span id='topic+rh2q'></span>

<h3>Description</h3>

<p>function to convert humidity to absolute humidity using Tetens formula, assuming standard atmosphere conditions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rh2q(rh, temp = 15)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rh2q_+3A_rh">rh</code></td>
<td>
<p>vector (or data.frame) of relative humidity (in percentage)</p>
</td></tr>
<tr><td><code id="rh2q_+3A_temp">temp</code></td>
<td>
<p>vector (or data.frame) of temperature (in Celsius)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>value of data.frame with time and the absolute humidity, units are g/g
</p>


<h3>Note</h3>

<p>default values are from standard atmosphere (288.15 K / 15 C)
</p>
<p>if rh and temp arguments are data.frame, both need to have the same number of lines and columns, first column (time column) will be ignored.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># for a singfle value
rh2q(rh = 99, temp = 25)

# vector of rh values
rh2q(rh = c(0,seq(1,100, by = 4)), temp = 25)

# vector of values for rh and temp
rh2q(rh = c(0,seq(1,100, by = 4)), temp = 10:35)

# rh is data.frame and temp is a value
times &lt;- seq(as.POSIXct('2024-01-01',tz = 'UTC'),
             as.POSIXct('2024-01-02',tz = 'UTC'),
             by = 'hour')
rh2q(rh   = data.frame(time = times, a = seq(1,100, by = 4)),temp = 25)

# using both rh and temp are data.frames
rh2q(rh   = data.frame(time = times, a = seq(1,100, by = 4)),
     temp = data.frame(time = times, a = 11:35))
</code></pre>

<hr>
<h2 id='sat'>Functions to model evaluation using satellite</h2><span id='topic+sat'></span>

<h3>Description</h3>

<p>functions to evaluate the spatial performance using satellite
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sat(
  mo,
  ob,
  rname,
  table = NULL,
  n = 6,
  min = NA,
  max = NA,
  method = "bilinear",
  eval_function = stat,
  mask,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sat_+3A_mo">mo</code></td>
<td>
<p>SpatRaster or raster with model</p>
</td></tr>
<tr><td><code id="sat_+3A_ob">ob</code></td>
<td>
<p>SpatRaster or raster with observations</p>
</td></tr>
<tr><td><code id="sat_+3A_rname">rname</code></td>
<td>
<p>passed to stat</p>
</td></tr>
<tr><td><code id="sat_+3A_table">table</code></td>
<td>
<p>data.frame to append the results</p>
</td></tr>
<tr><td><code id="sat_+3A_n">n</code></td>
<td>
<p>number of points from the boundary removed, default is 5</p>
</td></tr>
<tr><td><code id="sat_+3A_min">min</code></td>
<td>
<p>minimum value cutoff</p>
</td></tr>
<tr><td><code id="sat_+3A_max">max</code></td>
<td>
<p>maximum value cutoff</p>
</td></tr>
<tr><td><code id="sat_+3A_method">method</code></td>
<td>
<p>passed to terra::resample</p>
</td></tr>
<tr><td><code id="sat_+3A_eval_function">eval_function</code></td>
<td>
<p>evaluation function (default is stat)</p>
</td></tr>
<tr><td><code id="sat_+3A_mask">mask</code></td>
<td>
<p>optional SpatVector to mask the results</p>
</td></tr>
<tr><td><code id="sat_+3A_verbose">verbose</code></td>
<td>
<p>set TRUE to display additional information</p>
</td></tr>
<tr><td><code id="sat_+3A_...">...</code></td>
<td>
<p>other arguments passed to stat</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a data.frame
</p>


<h3>Note</h3>

<p>If a YOU DIED error message appears, means you are removing all the valid values using the arguments min or max.
</p>
<p>If cate() is used for eval_function, the argument threshold must be included (see example).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>model_o3 &lt;- terra::rast(paste0(system.file("extdata",package="eva3dm"),
                              "/camx_no2.Rds"))
omi_o3   &lt;- terra::rast(paste0(system.file("extdata",package="eva3dm"),
                              "/omi_no2.Rds"))

# generate the statistical indexes
sat(mo = model_o3,ob = omi_o3,rname = 'NO2_statistical')

# generate categorical evaluation using 3.0 as threshold
sat(mo = model_o3,ob = omi_o3,rname = 'NO2_categorical',
    eval_function = cate, threshold = 3.0)

</code></pre>

<hr>
<h2 id='stat'>Calculate evaluation statistics from numerical vectors</h2><span id='topic+stat'></span>

<h3>Description</h3>

<p>Calculate statistical indexes (Number of pairs, observation average, model average, correlation, Index Of Agreement, Factor of 2, Root Mean Square Error, Mean Bias, Mean error, Normalized Mean Bias, and Normalized Mean Bias) for model evaluation
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stat(
  model,
  observation,
  wd = FALSE,
  cutoff = NA,
  cutoff_NME = NA,
  nobs = 8,
  rname,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="stat_+3A_model">model</code></td>
<td>
<p>numeric vector with paired model data</p>
</td></tr>
<tr><td><code id="stat_+3A_observation">observation</code></td>
<td>
<p>numeric vector with paired observation data</p>
</td></tr>
<tr><td><code id="stat_+3A_wd">wd</code></td>
<td>
<p>logical, set true to apply a rotation on wind direction, see notes</p>
</td></tr>
<tr><td><code id="stat_+3A_cutoff">cutoff</code></td>
<td>
<p>(optionally the maximum) valid value for observation</p>
</td></tr>
<tr><td><code id="stat_+3A_cutoff_nme">cutoff_NME</code></td>
<td>
<p>(optionally the maximum) valid value for observation for NME, MFB and MFE</p>
</td></tr>
<tr><td><code id="stat_+3A_nobs">nobs</code></td>
<td>
<p>minimum number of observations</p>
</td></tr>
<tr><td><code id="stat_+3A_rname">rname</code></td>
<td>
<p>row name</p>
</td></tr>
<tr><td><code id="stat_+3A_verbose">verbose</code></td>
<td>
<p>display additional information</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame with calculated Number of pairs, observation average, model average, correlation, Index Of Agreement, Factor of 2, Root Mean Square Error, Mean Bias, Mean error, Normalized Mean Bias, and Normalized Mean Bias
</p>


<h3>Note</h3>

<p>the option wd = TRUE applies a rotation of 360 on model wind direction to minimize the angular difference.
</p>


<h3>References</h3>

<p>Emery, C. and Tai., E. 2001. Enhanced Meteorological Modeling and Performance Evaluation
for Two Texas Ozone Episodes.
</p>
<p>Monk, K. et al. 2019. Evaluation of Regional Air Quality Models over Sydney and Australia:
Part 1—Meteorological Model Comparison. Atmosphere 10(7), p. 374. doi: 10.3390/atmos10070374.
</p>
<p>Ramboll. 2018. PacWest Newport Meteorological Performance Evaluation.
</p>
<p>Zhang, Y. et al. 2019. Multiscale Applications of Two Online-Coupled Meteorology-Chemistry
Models during Recent Field Campaigns in Australia, Part I: Model Description and WRF/Chem-ROMS
Evaluation Using Surface and Satellite Data and Sensitivity to Spatial Grid Resolutions.
Atmosphere 10(4), p. 189. doi: 10.3390/atmos10040189.
</p>
<p>Emery, C., Liu, Z., Russell, A.G., Odman, M.T., Yarwood, G. and Kumar, N. 2017.
Recommendations on statistics and benchmarks to assess photochemical model performance.
Journal of the Air &amp; Waste Management Association 67(5), pp. 582–598.
doi: 10.1080/10962247.2016.1265027.
</p>
<p>Zhai, H., Huang, L., Emery, C., Zhang, X., Wang, Y., Yarwood, G., ... &amp; Li, L. (2024).
Recommendations on benchmarks for photochemical air quality model applications
in China—NO2, SO2, CO and PM10. Atmospheric Environment, 319, 120290.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>model &lt;- 1:100
data  &lt;- model + rnorm(100,0.2)
stat(model = model, observation = data)

</code></pre>

<hr>
<h2 id='template'>Create templates for model evaluation</h2><span id='topic+template'></span>

<h3>Description</h3>

<p>Create templates of code (r-scripts and bash job-submission script) to read, post-process and evaluate model results.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>template(
  root,
  template = "WRF",
  case = "case",
  env = "rspatial",
  scheduler = "SBATCH",
  partition = "main",
  project = "PROJECT",
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="template_+3A_root">root</code></td>
<td>
<p>directory to create the template</p>
</td></tr>
<tr><td><code id="template_+3A_template">template</code></td>
<td>
<p>template type (see notes)</p>
</td></tr>
<tr><td><code id="template_+3A_case">case</code></td>
<td>
<p>case to be evaluated</p>
</td></tr>
<tr><td><code id="template_+3A_env">env</code></td>
<td>
<p>name of the conda environment</p>
</td></tr>
<tr><td><code id="template_+3A_scheduler">scheduler</code></td>
<td>
<p>job scheduler used (SBATCH or PBS)</p>
</td></tr>
<tr><td><code id="template_+3A_partition">partition</code></td>
<td>
<p>partition name</p>
</td></tr>
<tr><td><code id="template_+3A_project">project</code></td>
<td>
<p>project name</p>
</td></tr>
<tr><td><code id="template_+3A_verbose">verbose</code></td>
<td>
<p>display additional information</p>
</td></tr>
</table>


<h3>Value</h3>

<p>no value returned, create folders and other template scripts
</p>


<h3>Note</h3>

<p>Templates types available:<br />
- WRF (model post-process for METAR + INMET)<br />
- WRF-Chem (model post-process for METAR, AQS in Brazil and AERONET)<br />
- EXP (model post-process for one experimental site including PBL variables)<br />
- METAR (download observations)<br />
- MET (evaluation of meteorology)<br />
- AQ (evaluation of air quality)<br />
- PSA (model post-processing with CDO for satellite evaluation)<br />
- SAT (evaluation of precipitation using GPCP satellite)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>temp &lt;- file.path(tempdir(),"POST")
template(root = temp,template = 'WRF', case = 'WRF-only')

</code></pre>

<hr>
<h2 id='uv2wd'>Function to calculate model wind direction</h2><span id='topic+uv2wd'></span>

<h3>Description</h3>

<p>Function to calculate model wind direction
</p>


<h3>Usage</h3>

<pre><code class='language-R'>uv2wd(u, v, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="uv2wd_+3A_u">u</code></td>
<td>
<p>data.frame with model time-series of U10</p>
</td></tr>
<tr><td><code id="uv2wd_+3A_v">v</code></td>
<td>
<p>data.frame with model time-series of V10</p>
</td></tr>
<tr><td><code id="uv2wd_+3A_verbose">verbose</code></td>
<td>
<p>display additional information</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector or data.frame with time and the wind direction, units are degree north
</p>


<h3>Examples</h3>

<pre><code class='language-R'>times &lt;- seq(as.POSIXct('2024-01-01',tz = 'UTC'),
             as.POSIXct('2024-01-02',tz = 'UTC'),
             by = 'hour')
U10 = data.frame(times = times,
                 test1 = c(3.29,2.07,1.96,2.82,3.73,
                           4.11,4.96,6.33,7.39,7.59,
                           7.51,7.22,6.81,6.43,5.81,
                           4.02,3.03,2.68,2.40,2.20,
                           2.09,1.95,1.66,1.39,1.4),
                 test2 = c(6.29,4.87,6.16,7.12,8.77,
                           10.16,10.85,11.45,11.21,11.04,
                           11.09,10.67,10.48,10.00,8.96,
                           6.36,5.62,5.83,5.83,5.25,
                           4.11,3.08,2.26,1.14,-0.10))
V10 = data.frame(times = times,
                 test1 = c(-8.87,-4.23,-2.81,-2.59,-4.58,
                           -4.80,-5.33,-5.86,-6.12,-6.13,
                           -6.11,-5.76,-5.91,-5.60,-5.09,
                           -3.33,-2.50,-2.29,-2.14,-2.07,
                           -1.95,-1.97,-2.04,-2.03,-1.9),
                 test2 = c(11.80,5.88,5.74,5.56,6.87,
                           8.39,8.68,8.33,7.90,7.42,
                           6.96,6.87,6.36,5.61,5.16,
                           4.16,4.25,4.59,4.51,3.90,
                           2.97,1.98,1.04,-0.08,-0.44))

uv2wd(u = U10, v = V10)

</code></pre>

<hr>
<h2 id='uv2ws'>Function to calculate model wind speed</h2><span id='topic+uv2ws'></span>

<h3>Description</h3>

<p>Function to calculate model wind speed
</p>


<h3>Usage</h3>

<pre><code class='language-R'>uv2ws(u, v, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="uv2ws_+3A_u">u</code></td>
<td>
<p>data.frame with model time-series of U10</p>
</td></tr>
<tr><td><code id="uv2ws_+3A_v">v</code></td>
<td>
<p>data.frame with model time-series of V10</p>
</td></tr>
<tr><td><code id="uv2ws_+3A_verbose">verbose</code></td>
<td>
<p>display additional information</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector or data.frame with time and the wind sped, units are m/s
</p>


<h3>Examples</h3>

<pre><code class='language-R'>times &lt;- seq(as.POSIXct('2024-01-01',tz = 'UTC'),
             as.POSIXct('2024-01-02',tz = 'UTC'),
             by = 'hour')

U10 = data.frame(times = times,
                 test1 = c(3.29,2.07,1.96,2.82,3.73,
                           4.11,4.96,6.33,7.39,7.59,
                           7.51,7.22,6.81,6.43,5.81,
                           4.02,3.03,2.68,2.40,2.20,
                           2.09,1.95,1.66,1.39,1.4),
                 test2 = c(6.29,4.87,6.16,7.12,8.77,
                           10.16,10.85,11.45,11.21,11.04,
                           11.09,10.67,10.48,10.00,8.96,
                           6.36,5.62,5.83,5.83,5.25,
                           4.11,3.08,2.26,1.14,-0.10))
V10 = data.frame(times = times,
                 test1 = c(-8.87,-4.23,-2.81,-2.59,-4.58,
                           -4.80,-5.33,-5.86,-6.12,-6.13,
                           -6.11,-5.76,-5.91,-5.60,-5.09,
                           -3.33,-2.50,-2.29,-2.14,-2.07,
                           -1.95,-1.97,-2.04,-2.03,-1.9),
                 test2 = c(11.80,5.88,5.74,5.56,6.87,
                           8.39,8.68,8.33,7.90,7.42,
                           6.96,6.87,6.36,5.61,5.16,
                           4.16,4.25,4.59,4.51,3.90,
                           2.97,1.98,1.04,-0.08,-0.44))

uv2ws(u = U10, v = V10)

</code></pre>

<hr>
<h2 id='vars'>Function to return variable names</h2><span id='topic+vars'></span>

<h3>Description</h3>

<p>Return variable names of a NetCDF
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vars(file = NA, action = "get", verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="vars_+3A_file">file</code></td>
<td>
<p>file name</p>
</td></tr>
<tr><td><code id="vars_+3A_action">action</code></td>
<td>
<p>'get' to return variable names or 'print' to print</p>
</td></tr>
<tr><td><code id="vars_+3A_verbose">verbose</code></td>
<td>
<p>display additional information</p>
</td></tr>
</table>


<h3>Value</h3>

<p>string
</p>


<h3>Examples</h3>

<pre><code class='language-R'>vars(paste0(system.file("extdata",package="eva3dm"),'/wrfinput_d01'))

</code></pre>

<hr>
<h2 id='wrf_rast'>Creates SpatRaster object from wrf file</h2><span id='topic+wrf_rast'></span>

<h3>Description</h3>

<p>Creates a SpatRaster (terra R-package) object from a variable from wrf file (or another compatible NetCDF)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>wrf_rast(
  file = file.choose(),
  name = NA,
  map,
  level = 1,
  times,
  latlon = FALSE,
  method = "bilinear",
  as_polygons = FALSE,
  flip_h = FALSE,
  flip_v = FALSE,
  verbose = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="wrf_rast_+3A_file">file</code></td>
<td>
<p>wrf file</p>
</td></tr>
<tr><td><code id="wrf_rast_+3A_name">name</code></td>
<td>
<p>variable name</p>
</td></tr>
<tr><td><code id="wrf_rast_+3A_map">map</code></td>
<td>
<p>(optional) file with lat-lon variables and grid information</p>
</td></tr>
<tr><td><code id="wrf_rast_+3A_level">level</code></td>
<td>
<p>only for 4d data, numeric, default is 1 for surface (include all times)</p>
</td></tr>
<tr><td><code id="wrf_rast_+3A_times">times</code></td>
<td>
<p>only for 4d data, numeric, set to select time instead of levels (include all levels)</p>
</td></tr>
<tr><td><code id="wrf_rast_+3A_latlon">latlon</code></td>
<td>
<p>logical (default is FALSE), set TRUE project the output to &quot;+proj=longlat +datum=WGS84 +no_defs&quot;</p>
</td></tr>
<tr><td><code id="wrf_rast_+3A_method">method</code></td>
<td>
<p>method passed to terra::projection, default is bilinear</p>
</td></tr>
<tr><td><code id="wrf_rast_+3A_as_polygons">as_polygons</code></td>
<td>
<p>logical, true to return a SpatVector instead of SpatRaster</p>
</td></tr>
<tr><td><code id="wrf_rast_+3A_flip_h">flip_h</code></td>
<td>
<p>horizontal flip (by rows)</p>
</td></tr>
<tr><td><code id="wrf_rast_+3A_flip_v">flip_v</code></td>
<td>
<p>vertical flip (by cols)</p>
</td></tr>
<tr><td><code id="wrf_rast_+3A_verbose">verbose</code></td>
<td>
<p>display additional information</p>
</td></tr>
<tr><td><code id="wrf_rast_+3A_...">...</code></td>
<td>
<p>extra arguments passed to ncdf4::ncvar_get</p>
</td></tr>
</table>


<h3>Value</h3>

<p>SpatRaster object (terra package)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>{

wrf &lt;- paste(system.file("extdata", package = "eva3dm"),
                         "/wrfinput_d01", sep="")

r &lt;- wrf_rast(file=wrf, name='XLAT')

plot_rast(r)
}
</code></pre>

<hr>
<h2 id='write_stat'>Functions to write stats and evaluation</h2><span id='topic+write_stat'></span>

<h3>Description</h3>

<p>Functions to write the output from evaluation functions. If the file name ends with .csv
the function write.csv is used otherwise the function write.table is used.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_stat(stat, file, sep = ";", dec = ".", verbose = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="write_stat_+3A_stat">stat</code></td>
<td>
<p>observed data.frame</p>
</td></tr>
<tr><td><code id="write_stat_+3A_file">file</code></td>
<td>
<p>model data.frame</p>
</td></tr>
<tr><td><code id="write_stat_+3A_sep">sep</code></td>
<td>
<p>the field separator string, passed to write.table function</p>
</td></tr>
<tr><td><code id="write_stat_+3A_dec">dec</code></td>
<td>
<p>he string to use for decimal points, passed to write.table function</p>
</td></tr>
<tr><td><code id="write_stat_+3A_verbose">verbose</code></td>
<td>
<p>display additional information</p>
</td></tr>
<tr><td><code id="write_stat_+3A_...">...</code></td>
<td>
<p>arguments passed to write.table and write.csv functions</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
sample &lt;- read_stat(paste0(system.file("extdata", package = "eva3dm"),"/sample.csv"),
                    verbose = TRUE)
dir.create(file.path(tempdir(), "stats"))

write_stat(file    = paste0(file.path(tempdir(), "stats"),'/sample.txt'),
           stat    = sample,
           verbose = TRUE)

write_stat(file    = paste0(file.path(tempdir(), "stats"),'/sample.csv'),
           stat    = sample,
           verbose = TRUE)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
