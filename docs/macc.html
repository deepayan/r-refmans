<!DOCTYPE html><html><head><title>Help for package macc</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {macc}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#macc-package'>
<p>Causal Mediation Analysis under Correlated Errors</p></a></li>
<li><a href='#env.single'><p> Simulated single-level dataset</p></a></li>
<li><a href='#env.three'><p> Simulated three-level dataset</p></a></li>
<li><a href='#env.two'><p> Simulated two-level dataset</p></a></li>
<li><a href='#macc'><p> Mediation Analysis of Causality under Confounding</p></a></li>
<li><a href='#sim.data.multi'><p> Generate two/three-level simulation data</p></a></li>
<li><a href='#sim.data.single'><p> Generate single-level simulation data</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Mediation Analysis of Causality under Confounding</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2017-08-20</td>
</tr>
<tr>
<td>Author:</td>
<td>Yi Zhao &lt;yi_zhao@alumni.brown.edu&gt;, Xi Luo &lt;xi.rossi.luo@gmail.com&gt;</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Yi Zhao &lt;yi_zhao@alumni.brown.edu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Performs causal mediation analysis under confounding or correlated errors. This package includes a single level mediation model, a two-level mediation model, and a three-level mediation model for data with hierarchical structures. Under the two/three-level mediation model, the correlation parameter is identifiable and is estimated based on a hierarchical-likelihood, a marginal-likelihood or a two-stage method. See Zhao, Y., &amp; Luo, X. (2014), Estimating Mediation Effects under Correlated Errors with an Application to fMRI, &lt;<a href="https://doi.org/10.48550/arXiv.1410.7217">doi:10.48550/arXiv.1410.7217</a>&gt; for details.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Depends:</td>
<td>lme4, nlme, optimx, MASS, car</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2017-08-23 19:36:42 UTC; yizhao</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2017-08-23 20:03:54 UTC</td>
</tr>
</table>
<hr>
<h2 id='macc-package'>
Causal Mediation Analysis under Correlated Errors
</h2><span id='topic+macc-package'></span>

<h3>Description</h3>

<p>macc performs causal mediation analysis under confounding or correlated errors. This package includes a single level mediation model, a two-level mediation model and a three-level mediation model for data with hierarchical structure. Under the two/three-level mediation model, the correlation parameter is identifiable and estimated based on a hierarchical-likelihood or a two-stage method.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> macc </td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package </td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.0.1 </td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2017-08-20 </td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL (&gt;=2) </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Yi Zhao &lt;yi_zhao@alumni.brown.edu&gt; and Xi Luo &lt;xi.rossi.luo@gmail.com&gt; <br />
</p>
<p>Maintainer: Yi Zhao &lt;yi_zhao@alumni.brown.edu&gt;
</p>


<h3>References</h3>

<p>Zhao, Y., &amp; Luo, X. (2014). <em>Estimating Mediation Effects under Correlated Errors with an Application to fMRI.</em> arXiv preprint arXiv:1410.7217.
</p>

<hr>
<h2 id='env.single'> Simulated single-level dataset
</h2><span id='topic+env.single'></span>

<h3>Description</h3>

<p> &quot;env.single&quot; is an R environment containing a data frame of data generated from 100 trials, the true coefficients and the coavariance matrix of the model errors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("env.single")</code></pre>


<h3>Format</h3>

<p> An R environment.
</p>

<dl>
<dt><code>data1</code></dt><dd><p>a data frame with <code>Z</code> the treatment assignment, <code>M</code> the mediator and <code>R</code> the interested outcome.</p>
</dd>
<dt><code>Theta</code></dt><dd><p>a 2 by 2 matrix, which is the coefficients of the model.</p>
</dd>
<dt><code>Sigma</code></dt><dd><p>a 2 by 2 matrix, which is the covariance matrix of the model errors.</p>
</dd>
</dl>



<h3>Details</h3>

<p> The number of subjects is 100. The coefficients are set to be <code class="reqn">A = 0.5</code>, <code class="reqn">C = 0.5</code> and <code class="reqn">B = -1</code>. The variances of the model errors are <code class="reqn">\sigma_1^2 = 1</code>, <code class="reqn">\sigma_2^2 = 4</code> and the correlation is <code class="reqn">\delta = 0.5</code>. See Section 5.1 of the reference.
</p>


<h3>References</h3>

<p>Zhao, Y., &amp; Luo, X. (2014). <em>Estimating Mediation Effects under Correlated Errors with an Application to fMRI.</em> arXiv preprint arXiv:1410.7217.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(env.single)
dt&lt;-get("data1",env.single)
</code></pre>

<hr>
<h2 id='env.three'> Simulated three-level dataset
</h2><span id='topic+env.three'></span>

<h3>Description</h3>

<p> &quot;env.three&quot; is an R environment containing a data <code>list</code> generated from 50 subjects and 4 sessions, and the parameter settings used to generate the data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("env.three")</code></pre>


<h3>Format</h3>

<p> An R environment.
</p>

<dl>
<dt><code>data3</code></dt><dd><p>a list of length 50, each contains a list of length 4 of a data frame with 3 variables.</p>
</dd>
<dt><code>Theta</code></dt><dd><p>a 2 by 2 matrix, which is the value of the fixed effects.</p>
</dd>
<dt><code>Sigma</code></dt><dd><p>the covariance matrix of the model error terms for the single level model.</p>
</dd>
<dt><code>n</code></dt><dd><p>a 50 by 4 matrix, is the number of trials for each subject each session.</p>
</dd>
<dt><code>Psi</code></dt><dd><p>the covariance matrix of the random effects in the mixed effects model.</p>
</dd>
<dt><code>Lambda</code></dt><dd><p>the covariance matrix of the model errors in the mixed effects model.</p>
</dd>
<dt><code>A</code></dt><dd><p>a 50 by 4 matrix, is the <code>A</code> value in the single-level for each subject each session.</p>
</dd>
<dt><code>B</code></dt><dd><p>a 50 by 4 matrix, is the <code>B</code> value in the single-level for each subject each session.</p>
</dd>
<dt><code>C</code></dt><dd><p>a 50 by 4 matrix, is the <code>C</code> value in the single-level for each subject each session.</p>
</dd>
</dl>



<h3>Details</h3>

<p> The number of subjects is <code class="reqn">N = 50</code> and the number of sessions is <code class="reqn">K = 4</code>. Under each session of each subject, the number of trials is a random draw from a Poisson distribution with mean 100. The fixed effects are set to be <code class="reqn">A = 0.5</code>, <code class="reqn">C = 0.5</code>, and <code class="reqn">B = -1</code>, and the variances of the model errors are <code class="reqn">\sigma_{1_{ik}}^2 = 1</code>, <code class="reqn">\sigma_{2_{ik}}^2 = 4</code> and the correlation is <code class="reqn">\delta = 0.5</code>. See Section 5.2 of the reference for details.
</p>


<h3>References</h3>

<p>Zhao, Y., &amp; Luo, X. (2014). <em>Estimating Mediation Effects under Correlated Errors with an Application to fMRI.</em> arXiv preprint arXiv:1410.7217.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(env.three)
dt&lt;-get("data3",env.three)
</code></pre>

<hr>
<h2 id='env.two'> Simulated two-level dataset
</h2><span id='topic+env.two'></span>

<h3>Description</h3>

<p> &quot;env.three&quot; is an R environment containing a data list generated from 50 subjects, and the parameter settings used to generate the data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("env.two")</code></pre>


<h3>Format</h3>

<p> An R environment.
</p>

<dl>
<dt><code>data2</code></dt><dd><p>a list of length 50, each contains a data frame with 3 variables.</p>
</dd>
<dt><code>Theta</code></dt><dd><p>a 2 by 2 matrix, which is the population level model coefficients.</p>
</dd>
<dt><code>Sigma</code></dt><dd><p>the covariance matrix of the model error terms for the single level model.</p>
</dd>
<dt><code>n</code></dt><dd><p>a 50 by 1 matrix, is the number of trials for each subject.</p>
</dd>
<dt><code>Lambda</code></dt><dd><p>the covariance matrix of the model errors in the coefficient regression model.</p>
</dd>
<dt><code>A</code></dt><dd><p>a vector of length 50, is the <code>A</code> value in the single-level for each subject each session.</p>
</dd>
<dt><code>B</code></dt><dd><p>a vector of length 50, is the <code>B</code> value in the single-level for each subject each session.</p>
</dd>
<dt><code>C</code></dt><dd><p>a vector of length 50, is the <code>C</code> value in the single-level for each subject each session.</p>
</dd>
</dl>



<h3>Details</h3>

<p> The number of subjects is <code class="reqn">N = 50</code>. For each subject, the number of trials is a random draw from a Poisson distribution with mean 100. The population level coefficients are set to be <code class="reqn">A = 0.5</code>, <code class="reqn">C = 0.5</code> and <code class="reqn">B = -1</code>, and the variances of the model errors are <code class="reqn">\sigma_{1_{i}}^2 = 1</code>, <code class="reqn">\sigma_{2_{i}}^2 = 4</code> and the correlation is <code class="reqn">\delta = 0.5</code>. See Section 5.2 of the reference for details. This is a special case of the three-level data with <code class="reqn">K=1</code>.
</p>


<h3>References</h3>

<p>Zhao, Y., &amp; Luo, X. (2014). <em>Estimating Mediation Effects under Correlated Errors with an Application to fMRI.</em> arXiv preprint arXiv:1410.7217.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(env.two)
dt&lt;-get("data2",env.two)
</code></pre>

<hr>
<h2 id='macc'> Mediation Analysis of Causality under Confounding
</h2><span id='topic+macc'></span>

<h3>Description</h3>

<p> This function performs causal mediation analysis under confounding or correlated errors for single level, two-level, and three-level mediation models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>macc(dat, model.type = c("single", "multilevel", "twolevel"), 
  method = c("HL", "TS", "HL-TS"), delta = NULL, interval = c(-0.9, 0.9), 
  tol = 0.001, max.itr = 500, conf.level = 0.95, 
  optimizer = c("optimx", "bobyqa", "Nelder_Mead"), mix.pkg = c("nlme", "lme4"), 
  random.indep = TRUE, random.var.equal = FALSE, u.int = FALSE, Sigma.update = TRUE, 
  var.constraint = TRUE, random.var.update = TRUE, logLik.type = c("logLik", "HL"), 
  error.indep = TRUE, error.var.equal = FALSE, 
  sens.plot = FALSE, sens.interval = seq(-1, 1, by = 0.01), legend.pos = "topright", 
  xlab = expression(delta), ylab = expression(hat(AB)), cex.lab = 1, cex.axis = 1, 
  lgd.cex = 1, lgd.pt.cex = 1, plot.delta0 = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="macc_+3A_dat">dat</code></td>
<td>
<p> a data frame or a list of data. When it is a data frame, it contains <code>Z</code> as the treatment/exposure assignment, <code>M</code> as the mediator and <code>R</code> as the interested outcome and <code>model.type</code> should be &quot;single&quot;. <code>Z</code>, <code>M</code> and <code>R</code> are all in one column. When it is a list, the list length is the number of subjects. For a two-level dataset, each list contains one data frame with <code>Z</code>, <code>M</code> and <code>R</code>, and <code>model.type</code> should be &quot;twolevel&quot;; for a three-level dataset, each subject list consists of <code>K</code> lists of data frame, and <code>model.type</code> should be &quot;multilevel&quot;.
</p>
</td></tr>
<tr><td><code id="macc_+3A_model.type">model.type</code></td>
<td>
<p>a character of model type, &quot;single&quot; for single level model, &quot;multilevel&quot; for three-level model and &quot;twolevel&quot; for two-level model.
</p>
</td></tr>
<tr><td><code id="macc_+3A_method">method</code></td>
<td>
<p> a character of method that is used for the two/three-level mediation model. When <code>delta</code> is given, the method can be either &quot;HL&quot; (hierarchical-likelihood) or &quot;TS&quot; (two-stage); when <code>delta</code> is not given, the method can be &quot;HL&quot;, &quot;TS&quot; or &quot;HL-TS&quot;. The &quot;HL-TS&quot; method estimates <code>delta</code> by the &quot;HL&quot; method first and uses the &quot;TS&quot; method to estimate the rest parameters. For three-level model, when <code>method = "HL"</code> and <code>u.int = TRUE</code>, the parameters are estimated through a marginal-likelihood method.
</p>
</td></tr>
<tr><td><code id="macc_+3A_delta">delta</code></td>
<td>
<p> a number gives the correlation between the model errors. Default value is <code>NULL</code>. When <code>model.type = "single"</code>, the default will be <code>0</code>. For two/three-level model, if <code>delta = NULL</code>, the value of <code>delta</code> will be estimated.
</p>
</td></tr>
<tr><td><code id="macc_+3A_interval">interval</code></td>
<td>
<p> a vector of length two indicates the searching interval when estimating <code>delta</code>. Default is (-0.9,0.9).
</p>
</td></tr>
<tr><td><code id="macc_+3A_tol">tol</code></td>
<td>
<p> a number indicates the tolerence of convergence for the &quot;HL&quot; method. Default is 0.001.
</p>
</td></tr>
<tr><td><code id="macc_+3A_max.itr">max.itr</code></td>
<td>
<p> an integer indicates the maximum number of interation for the &quot;HL&quot; method. Default is 500.
</p>
</td></tr>
<tr><td><code id="macc_+3A_conf.level">conf.level</code></td>
<td>
<p> a number indicates the significance level of the confidence intervals. Default is 0.95.
</p>
</td></tr>
<tr><td><code id="macc_+3A_optimizer">optimizer</code></td>
<td>
<p> a character of the name of optimizing function(s) in the mixed effects model. This is used only for three-level model. For details, see <code><a href="lme4.html#topic+lmerControl">lmerControl</a></code>.
</p>
</td></tr>
<tr><td><code id="macc_+3A_mix.pkg">mix.pkg</code></td>
<td>
<p> a character of the package used for the mixed effects model in a three-level mediation model. 
</p>
</td></tr>
<tr><td><code id="macc_+3A_random.indep">random.indep</code></td>
<td>
<p> a logic value indicates if the random effects in the mixed effects model are independent. Default is <code>TRUE</code> assuming the random effects are independent. This is used for <code>model.type = "multilevel"</code> only.
</p>
</td></tr>
<tr><td><code id="macc_+3A_random.var.equal">random.var.equal</code></td>
<td>
<p> a logic value indicates if the variances of the random effects are identical. Default is <code>FALSE</code> assuming the variances are not identical. This is used for <code>model.type = "multilevel"</code> only.
</p>
</td></tr>
<tr><td><code id="macc_+3A_u.int">u.int</code></td>
<td>
<p> a logic value. Default is <code>FALSE</code>. When <code>u.int = TRUE</code>, a marginal-likelihood method, which integrates out the random effects in the mixed effects model, is used to estimate the parameters. This is used when <code>model.type = "multilevel"</code> and <code>method = "HL"</code> or <code>method = "HL-TS"</code>.
</p>
</td></tr>
<tr><td><code id="macc_+3A_sigma.update">Sigma.update</code></td>
<td>
<p> a logic value. Default is <code>TRUE</code>, and the estimated variances of the errors in the single level model will be updated in each iteration when running a two/three-level mediation model.
</p>
</td></tr>
<tr><td><code id="macc_+3A_var.constraint">var.constraint</code></td>
<td>
<p> a logic value. Default is <code>TRUE</code>, and an interval constraint is added on the variance components in the two/three-level mediation model.
</p>
</td></tr>
<tr><td><code id="macc_+3A_random.var.update">random.var.update</code></td>
<td>
<p> a logic value. Default is <code>TRUE</code>, and the estimates of the variance of the random effects in the mixed effects model are updated in each iteration. This is used when <code>model.type = "multilevel"</code> and <code>method = "HL"</code> or <code>method = "HL-TS"</code>.
</p>
</td></tr>
<tr><td><code id="macc_+3A_loglik.type">logLik.type</code></td>
<td>
<p> a character value indicating the type of likelihood value returned. It is used for &quot;TS&quot; method. When <code>logLik.type = "logLik"</code>, the log-likelihood of the mixed effects model is maximized; when <code>logLik.type = "HL"</code>, the summation of log-likelihood of the single level model and the mixed effects model is maximized. This is used for <code>model.type = "multilevel"</code>. 
</p>
</td></tr>
<tr><td><code id="macc_+3A_error.indep">error.indep</code></td>
<td>
<p> a logic value. Default is <code>TRUE</code>. This is used for <code>model.type = "twolevel"</code>. When <code>error.indep = TRUE</code>, the error terms in the three linear models for <code class="reqn">A</code>, <code class="reqn">B</code> and <code class="reqn">C</code> are independent.
</p>
</td></tr>
<tr><td><code id="macc_+3A_error.var.equal">error.var.equal</code></td>
<td>
<p> a logic value, Default is <code>FALSE</code>, This is used for <code>model.type = "twolevel"</code>. When <code>error.var.equal = TRUE</code>, the variances of the error terms in the three linear models for <code class="reqn">A</code>, <code class="reqn">B</code> and <code class="reqn">C</code> are assumed to be identical.
</p>
</td></tr>
<tr><td><code id="macc_+3A_sens.plot">sens.plot</code></td>
<td>
<p> a logic value. Default is <code>FALSE</code>. This is used only for single level model. When <code>sens.plot = TRUE</code>, the sensitivity analysis will be performed and plotted. 
</p>
</td></tr>
<tr><td><code id="macc_+3A_sens.interval">sens.interval</code></td>
<td>
<p> a sequence of <code>delta</code> values under which the sensitivity analysis is performed. Default is a sequence from -1 to 1 with increment 0.01. The elements with absolute value 1 will be excluded from the analysis.
</p>
</td></tr>
<tr><td><code id="macc_+3A_legend.pos">legend.pos</code></td>
<td>
<p> a character indicates the location of the legend when <code>sens.plot = TRUE</code>. This is used for single level model.
</p>
</td></tr>
<tr><td><code id="macc_+3A_xlab">xlab</code></td>
<td>
<p> a title for <code>x</code> axis in the sensitivity plot. 
</p>
</td></tr>
<tr><td><code id="macc_+3A_ylab">ylab</code></td>
<td>
<p> a title for <code>y</code> axis in the sensitivity plot.
</p>
</td></tr>
<tr><td><code id="macc_+3A_cex.lab">cex.lab</code></td>
<td>
<p> the magnigication to be used for <code>x</code> and <code>y</code> labels relative to the current setting of <code>cex</code>.
</p>
</td></tr>
<tr><td><code id="macc_+3A_cex.axis">cex.axis</code></td>
<td>
<p> the magnification to be used for axis annotation relative to the current setting of <code>cex</code>.
</p>
</td></tr>
<tr><td><code id="macc_+3A_lgd.cex">lgd.cex</code></td>
<td>
<p> the magnification to be used for legend relative to the current setting of <code>cex</code>.
</p>
</td></tr>
<tr><td><code id="macc_+3A_lgd.pt.cex">lgd.pt.cex</code></td>
<td>
<p> the magnification to be used for the points in legend relative to the current setting of <code>cex</code>.
</p>
</td></tr>
<tr><td><code id="macc_+3A_plot.delta0">plot.delta0</code></td>
<td>
<p> a logic value. Default is <code>TRUE</code>. When <code>plot.delta0 = TRUE</code>, the estimates when <code class="reqn">\delta=0</code> is plotted.
</p>
</td></tr>
<tr><td><code id="macc_+3A_...">...</code></td>
<td>
<p> additional argument to be passed.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p> The single level mediation model is
</p>
<p style="text-align: center;"><code class="reqn">M=ZA+E_1,</code>
</p>

<p style="text-align: center;"><code class="reqn">R=ZC+MB+E_2.</code>
</p>

<p>A correlation between the model errors <code class="reqn">E_1</code> and <code class="reqn">E_2</code> is assumed to be <code class="reqn">\delta</code>. The coefficients are estimated by maximizing the log-likelihood function. The confidence intervals of the coefficients are calculated based on the asymptotic joint distribution. The variance of <code class="reqn">AB</code> estimator based on either the product method or the difference method is obtained from the Delta method. Under this single level model, <code class="reqn">\delta</code> is not identifiable. Sensitivity analysis for the indirect effect (<code class="reqn">AB</code>) can be used to assess the deviation of the findings, when assuming <code class="reqn">\delta=0</code> violates the independence assumption. 
</p>
<p>The two/three-level mediation models are proposed to estimate <code class="reqn">\delta</code> from data without sensitivity analysis. They address the within/between-subject variation issue for datasets with hierarchical structure. For simplicity, we refer to the three levels of data by trials, sessions and subjects, respectively. See reference for more details. Under the two-level mediation model, the data consists of <code class="reqn">N</code> independent subjects and <code class="reqn">n_i</code> trials for subject <code class="reqn">i</code>; under the three-level mediation model, the data consists of <code class="reqn">N</code> independent subjects, <code class="reqn">K</code> sessions for each and <code class="reqn">n_{ik}</code> trials. Under the two-level (three-level) models, the single level mediation model is first applied on the trials from (the same session of) a single subject. The coefficients then follow a linear (mixed effects) model. Here we enforce the assumption that <code class="reqn">\delta</code> is a constant across (sessions and) subjects. The parameters are estimated through a hierarchical-likelihood (or marginal likelihood) or a two-stage method.
</p>


<h3>Value</h3>

<p> When <code>model.type = "single"</code>,
</p>
<table>
<tr><td><code>Coefficients</code></td>
<td>
<p>point estimate of the coefficients, as well as the corresponding standard error and confidence interval. The indirect effect is estimated by both the product (<code>ABp</code>) and the difference (<code>ABd</code>) methods.</p>
</td></tr>
<tr><td><code>D</code></td>
<td>
<p>point estimate of the regression coefficients in matrix form.</p>
</td></tr>
<tr><td><code>Sigma</code></td>
<td>
<p>estimated covariance matrix of the model errors.</p>
</td></tr>
<tr><td><code>delta</code></td>
<td>
<p>the <code class="reqn">\delta</code> value used to estimate the rest parameters.</p>
</td></tr>
<tr><td><code>time</code></td>
<td>
<p>the CPU time used, see <code><a href="base.html#topic+system.time">system.time</a></code>.</p>
</td></tr>
</table>
<p>When <code>model.type = "multilevel"</code>,
</p>
<table>
<tr><td><code>delta</code></td>
<td>
<p>the specified or estimated value of correlation.</p>
</td></tr>
<tr><td><code>Coefficients</code></td>
<td>
<p>the estimated fixed effects in the mixed effects model for the coefficients, as well as the corresponding confidence intervals and standard errors. Here confidence intervals and standard errors are the estimates directly from the mixed effects model, the variation of estimating these parameters is not accounted for.</p>
</td></tr>
<tr><td><code>Cor.comp</code></td>
<td>
<p>estimated correlation matrix of the random effects in the mixed effects model.</p>
</td></tr>
<tr><td><code>Var.comp</code></td>
<td>
<p>estimated variance components in the mixed effects model.</p>
</td></tr>
<tr><td><code>Var.C2</code></td>
<td>
<p>estimated variance components for <code class="reqn">C'</code>, the total effect, if a mixed effects model is considered.</p>
</td></tr>
<tr><td><code>logLik</code></td>
<td>
<p>the value of maximized log-likelihood of the mixed effects model.</p>
</td></tr>
<tr><td><code>HL</code></td>
<td>
<p>the value of hierarchical-likelihood.</p>
</td></tr>
<tr><td><code>convergence</code></td>
<td>
<p>the logic value indicating if the method converges.</p>
</td></tr>
<tr><td><code>time</code></td>
<td>
<p>the CPU time used, see <code><a href="base.html#topic+system.time">system.time</a></code></p>
</td></tr></table>
<p>.
</p>
<p>When <code>model.type = "twolevel"</code>
</p>
<table>
<tr><td><code>delta</code></td>
<td>
<p>the specified or estimated value of correlation.</p>
</td></tr>
<tr><td><code>Coefficients</code></td>
<td>
<p>the estimated population level effect in the regression models.</p>
</td></tr>
<tr><td><code>Lambda</code></td>
<td>
<p>the estimated covariance matrix of the model errors in the coefficient regression models.</p>
</td></tr>
<tr><td><code>Sigma</code></td>
<td>
<p>the estimated variances of <code class="reqn">E_1</code> and <code class="reqn">E_2</code> for each subject.</p>
</td></tr>
<tr><td><code>HL</code></td>
<td>
<p>the value of full-likelihood (hierarchical-likelihood).</p>
</td></tr>
<tr><td><code>convergence</code></td>
<td>
<p>the logic value indicating if the method converges.</p>
</td></tr>
<tr><td><code>Var.constraint</code></td>
<td>
<p>the interval constraints used for the variances in the coefficient regression models.</p>
</td></tr>
<tr><td><code>time</code></td>
<td>
<p>the CPU time used, see <code><a href="base.html#topic+system.time">system.time</a></code></p>
</td></tr></table>
<p>.
</p>


<h3>Author(s)</h3>

<p> Yi Zhao, Brown University, <a href="mailto:yi_zhao@brown.edu">yi_zhao@brown.edu</a>;
Xi Luo, Brown University, <a href="mailto:xi.rossi.luo@gmail.com">xi.rossi.luo@gmail.com</a>.
</p>


<h3>References</h3>

<p>Zhao, Y., &amp; Luo, X. (2014). <em>Estimating Mediation Effects under Correlated Errors with an Application to fMRI.</em> arXiv preprint arXiv:1410.7217.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Examples with simulated data
  
  ##############################################################################
  # Single level mediation model
  # Data was generated with 500 independent trials. The correlation between model errors is 0.5.
  data(env.single)
  data.SL&lt;-get("data1",env.single)
  
  ## Example 1: Given delta is 0.5.
  macc(data.SL,model.type="single",delta=0.5)
  # $Coefficients
  #       Estimate        SE          LB          UB
  # A    0.3572722 0.1483680  0.06647618  0.64806816
  # C    0.8261253 0.2799667  0.27740060  1.37485006
  # B   -0.9260217 0.1599753 -1.23956743 -0.61247594
  # C2   0.4952836 0.2441369  0.01678400  0.97378311
  # ABp -0.3308418 0.1488060 -0.62249617 -0.03918738
  # ABd -0.3308418 0.3714623 -1.05889442  0.39721087
  
  ## Example 2: Assume the errors are independent.
  macc(data.SL,model.type="single",delta=0)
  # $Coefficients
  #          Estimate         SE          LB        UB
  # A    0.3572721688 0.14836803  0.06647618 0.6480682
  # C    0.4961424716 0.24413664  0.01764345 0.9746415
  # B   -0.0024040905 0.15997526 -0.31594984 0.3111417
  # C2   0.4952835570 0.24413691  0.01678400 0.9737831
  # ABp -0.0008589146 0.05715582 -0.11288227 0.1111644
  # ABd -0.0008589146 0.34526154 -0.67755910 0.6758413
  
  ## Example 3: Sensitivity analysis (given delta is 0.5).
  macc(data.SL,model.type="single",delta=0.5,sens.plot=TRUE)
  ##############################################################################
  
  ##############################################################################
  # Three-level mediation model
  # Data was generated with 50 subjects and 4 sessions. 
  # The correlation between model errors in the single level is 0.5.
  # We comment out our examples due to the computation time.
  data(env.three)
  data.ML&lt;-get("data3",env.three)
  
  ## Example 1: Correlation is unknown and to be estimated.
  # Assume random effects are independent
  # Add an interval constraint on the variance components.
  
  # "HL" method
  # macc(data.ML,model.type="multilevel",method="HL")
  # $delta
  # [1] 0.5224803

  # $Coefficients
  #            Estimate         LB         UB         SE
  # A        0.51759400  0.3692202  0.6659678 0.07570229
  # C        0.56882035  0.3806689  0.7569718 0.09599742
  # B       -1.13624114 -1.3688690 -0.9036133 0.11868988
  # C2      -0.06079748 -0.4163135  0.2947186 0.18138908
  # AB.prod -0.58811160 -0.7952826 -0.3809406 0.10570145
  # AB.diff -0.62961784 -1.0318524 -0.2273833 0.20522549
  # 
  # $time
  #    user  system elapsed 
  #   44.34    3.53   17.71 
  
  # "ML" method
  # macc(data.ML,model.type="multilevel",method="HL",u.int=TRUE)
  # $delta
  # [1] 0.5430744

  # $Coefficients
  #            Estimate         LB         UB         SE
  # A        0.51764821  0.3335094  0.7017871 0.09395011
  # C        0.59652821  0.3715001  0.8215563 0.11481236
  # B       -1.19426328 -1.4508665 -0.9376601 0.13092240
  # C2      -0.06079748 -0.4163135  0.2947186 0.18138908
  # AB.prod -0.61820825 -0.8751214 -0.3612951 0.13108056
  # AB.diff -0.65732570 -1.0780742 -0.2365772 0.21467155
  # 
  # $time
  #    user  system elapsed 
  #  125.49    9.52   39.10 
  
  # "TS" method
  # macc(data.ML,model.type="multilevel",method="TS")
  # $delta
  # [1] 0.5013719

  # $Coefficients
  #            Estimate         LB         UB         SE
  # A        0.51805823  0.3316603  0.7044561 0.09510271
  # C        0.53638546  0.3066109  0.7661601 0.11723409
  # B       -1.07930526 -1.3386926 -0.8199179 0.13234293
  # C2      -0.06079748 -0.4163135  0.2947186 0.18138908
  # AB.prod -0.55914297 -0.8010745 -0.3172114 0.12343672
  # AB.diff -0.59718295 -1.0204890 -0.1738769 0.21597645
  # 
  # $time
  #    user  system elapsed 
  #   19.53    0.00   19.54
  
  ## Example 2: Given the correlation is 0.5.
  # Assume random effects are independent.
  # Add an interval constraint on the variance components.
  
  # "HL" method
  macc(data.ML,model.type="multilevel",method="HL",delta=0.5)
  # $delta
  # [1] 0.5

  # $Coefficients
  #            Estimate         LB         UB         SE
  # A        0.51760568  0.3692319  0.6659794 0.07570229
  # C        0.53916412  0.3512951  0.7270331 0.09585330
  # B       -1.07675116 -1.3093989 -0.8441035 0.11869999
  # C2      -0.06079748 -0.4163135  0.2947186 0.18138908
  # AB.prod -0.55733252 -0.7573943 -0.3572708 0.10207419
  # AB.diff -0.59996161 -1.0020641 -0.1978591 0.20515811
  # 
  # $time
  #    user  system elapsed 
  #    2.44    0.22    1.03 
  ##############################################################################
  
  ##############################################################################
  # Two-level mediation model
  # Data was generated with 50 subjects. 
  # The correlation between model errors in the single level is 0.5.
  # We comment out our examples due to the computation time.
  data(env.two)
  data.TL&lt;-get("data2",env.two)
  
  ## Example 1: Correlation is unknown and to be estimated.
  # Assume errors in the coefficients regression models are independent.
  # Add an interval constraint on the variance components. 
  
  # "HL" method
  # macc(data.TL,model.type="twolevel",method="HL")
  # $delta
  # [1] 0.5066551

  # $Coefficients
  #            Estimate
  # A        0.51714224
  # C        0.54392056
  # B       -1.05048406
  # C2      -0.02924135
  # AB.prod -0.54324968
  # AB.diff -0.57316190
  # 
  # $time
  #    user  system elapsed 
  #    3.07    0.00    3.07 
  
  # "TS" method
  # macc(data.TL,model.type="twolevel",method="TS")
  # $delta
  # [1] 0.4481611

  # $Coefficients
  #            Estimate
  # A        0.52013697
  # C        0.47945755
  # B       -0.90252718
  # C2      -0.02924135
  # AB.prod -0.46943775
  # AB.diff -0.50869890
  # 
  # $time
  #    user  system elapsed 
  #    1.60    0.00    1.59 
  
  ## Example 2: Given the correlation is 0.5.
  # Assume random effects are independent.
  # Add an interval constraint on the variance components.
  
  # "HL" method
  macc(data.TL,model.type="twolevel",method="HL",delta=0.5)
  # $delta
  # [1] 0.5

  # $Coefficients
  #            Estimate
  # A        0.51718063
  # C        0.53543300
  # B       -1.03336668
  # C2      -0.02924135
  # AB.prod -0.53443723
  # AB.diff -0.56467434
  # 
  # $time
  #    user  system elapsed 
  #    0.21    0.00    0.20 
  ##############################################################################
</code></pre>

<hr>
<h2 id='sim.data.multi'> Generate two/three-level simulation data
</h2><span id='topic+sim.data.multi'></span>

<h3>Description</h3>

<p> This function generates a two/three-level dataset with given parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim.data.multi(Z.list, N, K = 1, Theta, Sigma, 
    Psi = diag(rep(1, 3)), Lambda = diag(rep(1, 3)))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sim.data.multi_+3A_z.list">Z.list</code></td>
<td>
<p> a list of data. When <code>K = 1</code> (a two-level dataset), each list is a vector containing the treatment/exposure assignment of the trials for each subject; When <code>K &gt; 1</code> (a three-level dataset), each list is a list of length <code>K</code>, and each contains a vector of treatment/exposure assignment.
</p>
</td></tr>
<tr><td><code id="sim.data.multi_+3A_n">N</code></td>
<td>
<p> an integer, indicates the number of subjects.
</p>
</td></tr>
<tr><td><code id="sim.data.multi_+3A_k">K</code></td>
<td>
<p> an integer, indicates the number of sessions of each subject. 
</p>
</td></tr>
<tr><td><code id="sim.data.multi_+3A_theta">Theta</code></td>
<td>
<p> a 2 by 2 matrix, containing the population level model coefficients.
</p>
</td></tr>
<tr><td><code id="sim.data.multi_+3A_sigma">Sigma</code></td>
<td>
<p> a 2 by 2 matrix, is the covariance matrix of the model errors in the single-level model.
</p>
</td></tr>
<tr><td><code id="sim.data.multi_+3A_psi">Psi</code></td>
<td>
<p> the covariance matrix of the random effects in the mixed effects model of the model coefficients. This is used only when <code>K &gt; 1</code>. Default is a 3-dimensional identity matrix.
</p>
</td></tr>
<tr><td><code id="sim.data.multi_+3A_lambda">Lambda</code></td>
<td>
<p> the covariance matrix of the model errors in the mixed effects model if <code>K &gt; 1</code> or the linear model if <code>K = 1</code> of the model coefficients.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p> When <code>K &gt; 1</code> (three-level data), for the <code class="reqn">n_{ik}</code> trials in each session of each subject, the single level mediation model is
</p>
<p style="text-align: center;"><code class="reqn">M_{ik}=Z_{ik}A_{ik}+E_{1ik},</code>
</p>

<p style="text-align: center;"><code class="reqn">R_{ik}=Z_{ik}C_{ik}+M_{ik}B_{ik}+E_{2ik},</code>
</p>

<p>where <code class="reqn">Z_{ik}</code>, <code class="reqn">M_{ik}</code>, <code class="reqn">R_{ik}</code>, <code class="reqn">E_{1ik}</code>, and <code class="reqn">E_{2ik}</code> are vectors of length <code class="reqn">n_{ik}</code>. <code>Sigma</code> is the covariance matrix of <code class="reqn">(E_{1ik},E_{2ik})</code> (for simplicity, <code>Sigma</code> is the same across sessions and subjects). For coefficients <code class="reqn">A_{ik}</code>, <code class="reqn">B_{ik}</code> and <code class="reqn">C_{ik}</code>, we assume a mixed effects model. The random effects are from a trivariate normal distribution with mean zero and covariance <code>Psi</code>; and the model errors are from a trivariate normal distribution with mean zero and covariance <code>Lambda</code>. For the fixed effects <code class="reqn">A</code>, <code class="reqn">B</code> and <code class="reqn">C</code>, the values are specified in <code>Theta</code> with <code>Theta[1,1] = A</code>, <code>Theta[1,2] = C</code> and <code>Theta[2,2] = B</code>.
</p>
<p>When <code>K = 1</code> (two-level data), the single-level model coefficients <code class="reqn">A_{i}</code>, <code class="reqn">B_{i}</code> and <code class="reqn">C_{i}</code> are assumed to follow a trivariate linear regression model, where the population level coefficients are specified in <code>Theta</code> and the model errors are from a trivariate normal distribution with mean zero and covariance <code>Lambda</code>. 
</p>
<p>See Section 5.2 of the reference for details.
</p>


<h3>Value</h3>

<table>
<tr><td><code>data</code></td>
<td>
<p>a list of data. When <code>K = 1</code>, each list is a contains a dataframe; when <code>K &gt; 1</code>, each list is a list of length <code>K</code>, and within each list is a dataframe.</p>
</td></tr>
<tr><td><code>A</code></td>
<td>
<p>the value of <code class="reqn">A</code>s. When <code>K = 1</code>, it is a vector of length <code>N</code>; when <code>K &gt; 1</code>, it is a <code>N</code> by <code>K</code> matrix.</p>
</td></tr>
<tr><td><code>B</code></td>
<td>
<p>the value of <code class="reqn">B</code>s. When <code>K = 1</code>, it is a vector of length <code>N</code>; when <code>K &gt; 1</code>, it is a <code>N</code> by <code>K</code> matrix.</p>
</td></tr>
<tr><td><code>C</code></td>
<td>
<p>the value of <code class="reqn">C</code>s. When <code>K = 1</code>, it is a vector of length <code>N</code>; when <code>K &gt; 1</code>, it is a <code>N</code> by <code>K</code> matrix.</p>
</td></tr>
<tr><td><code>type</code></td>
<td>
<p>a character indicates the type of the dataset. When <code>K = 1</code>, <code>type = twolevel</code>; when <code>K &gt; 1</code>, <code>type = multilevel</code></p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p> Yi Zhao, Brown University, <a href="mailto:yi_zhao@brown.edu">yi_zhao@brown.edu</a>;
Xi Luo, Brown University, <a href="mailto:xi.rossi.luo@gmail.com">xi.rossi.luo@gmail.com</a>
</p>


<h3>References</h3>

<p>Zhao, Y., &amp; Luo, X. (2014). <em>Estimating Mediation Effects under Correlated Errors with an Application to fMRI.</em> arXiv preprint arXiv:1410.7217.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>   ###################################################
    # Generate a two-level dataset

    # covariance matrix of errors
    delta&lt;-0.5
    Sigma&lt;-matrix(c(1,2*delta,2*delta,4),2,2)

    # model coefficients
    A0&lt;-0.5
    B0&lt;--1
    C0&lt;-0.5

    Theta&lt;-matrix(c(A0,0,C0,B0),2,2)

    # number of subjects, and trials of each
    set.seed(2000)
    N&lt;-50
    K&lt;-1
    n&lt;-matrix(NA,N,K)
    for(i in 1:N)
    {
      n0&lt;-rpois(1,100)
      n[i,]&lt;-rpois(K,n0)
    }

    # treatment assignment list
    set.seed(100000)
    Z.list&lt;-list()
    for(i in 1:N)
    {
      Z.list[[i]]&lt;-rbinom(n[i,1],size=1,prob=0.5)
    }

    # Lambda
    rho.AB=rho.AC=rho.BC&lt;-0
    Lambda&lt;-matrix(0,3,3)
    lambda2.alpha=lambda2.beta=lambda2.gamma&lt;-0.5
    Lambda[1,2]=Lambda[2,1]&lt;-rho.AB*sqrt(lambda2.alpha*lambda2.beta)
    Lambda[1,3]=Lambda[3,1]&lt;-rho.AC*sqrt(lambda2.alpha*lambda2.gamma)
    Lambda[2,3]=Lambda[3,2]&lt;-rho.BC*sqrt(lambda2.beta*lambda2.gamma)
    diag(Lambda)&lt;-c(lambda2.alpha,lambda2.beta,lambda2.gamma)

    # Data
    set.seed(5000)
    re.dat&lt;-sim.data.multi(Z.list=Z.list,N=N,K=K,Theta=Theta,Sigma=Sigma,Lambda=Lambda)
    data2&lt;-re.dat$data
    ###################################################

    ###################################################
    # Generate a three-level dataset

    # covariance matrix of errors
    delta&lt;-0.5
    Sigma&lt;-matrix(c(1,2*delta,2*delta,4),2,2)

    # model coefficients
    A0&lt;-0.5
    B0&lt;--1
    C0&lt;-0.5

    Theta&lt;-matrix(c(A0,0,C0,B0),2,2)

    # number of subjects, and trials of each
    set.seed(2000)
    N&lt;-50
    K&lt;-4
    n&lt;-matrix(NA,N,K)
    for(i in 1:N)
    {
      n0&lt;-rpois(1,100)
      n[i,]&lt;-rpois(K,n0)
    }

    # treatment assignment list
    set.seed(100000)
    Z.list&lt;-list()
    for(i in 1:N)
    {
      Z.list[[i]]&lt;-list()
      for(j in 1:K)
      {
        Z.list[[i]][[j]]&lt;-rbinom(n[i,j],size=1,prob=0.5)
      }
    }

    # Psi and Lambda
    sigma2.alpha=sigma2.beta=sigma2.gamma&lt;-0.5
    theta2.alpha=theta2.beta=theta2.gamma&lt;-0.5
    Psi&lt;-diag(c(sigma2.alpha,sigma2.beta,sigma2.gamma))
    Lambda&lt;-diag(c(theta2.alpha,theta2.beta,theta2.gamma))

    # Data
    set.seed(5000)
    re.dat&lt;-sim.data.multi(Z.list,N,K,Theta,Sigma,Psi,Lambda)
    data3&lt;-re.dat$data
    ###################################################
</code></pre>

<hr>
<h2 id='sim.data.single'> Generate single-level simulation data
</h2><span id='topic+sim.data.single'></span>

<h3>Description</h3>

<p> This function generates a single-level dataset with given parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim.data.single(Z, Theta, Sigma)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sim.data.single_+3A_z">Z</code></td>
<td>
<p> a vector of treatment/exposure assignment.
</p>
</td></tr>
<tr><td><code id="sim.data.single_+3A_theta">Theta</code></td>
<td>
<p> a 2 by 2 matrix, containing the model coefficients.
</p>
</td></tr>
<tr><td><code id="sim.data.single_+3A_sigma">Sigma</code></td>
<td>
<p> a 2 by 2 matrix, is the covariance matrix of the model errors.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p> The single level mediation model is
</p>
<p style="text-align: center;"><code class="reqn">M=ZA+E_1,</code>
</p>

<p style="text-align: center;"><code class="reqn">R=ZC+MB+E_2.</code>
</p>

<p><code>Theta[1,1] = A</code>, <code>Theta[1,2] = C</code> and <code>Theta[2,2] = B</code>; <code>Sigma</code> is the covariance matrix of <code class="reqn">(E_1,E_2)</code>.
</p>


<h3>Value</h3>

<p> The function returns a dataframe with variables <code>Z</code>, <code>M</code> and <code>R</code>.
</p>


<h3>Author(s)</h3>

<p> Yi Zhao, Brown University, <a href="mailto:yi_zhao@brown.edu">yi_zhao@brown.edu</a>;
Xi Luo, Brown University, <a href="mailto:xi.rossi.luo@gmail.com">xi.rossi.luo@gmail.com</a>
</p>


<h3>References</h3>

<p>Zhao, Y., &amp; Luo, X. (2014). <em>Estimating Mediation Effects under Correlated Errors with an Application to fMRI.</em> arXiv preprint arXiv:1410.7217.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  ###################################################
  # Generate a single-level dataset

  # covariance matrix of errors
  delta&lt;-0.5
  Sigma&lt;-matrix(c(1,2*delta,2*delta,4),2,2)

  # model coefficients
  A0&lt;-0.5
  B0&lt;--1
  C0&lt;-0.5

  Theta&lt;-matrix(c(A0,0,C0,B0),2,2)

  # number of trials
  n&lt;-100

  # generate a treatment assignment vector
  set.seed(100)
  Z&lt;-matrix(rbinom(n,size=1,0.5),n,1)

  # Data
  set.seed(5000)
  data.single&lt;-sim.data.single(Z,Theta,Sigma)
  ###################################################
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
