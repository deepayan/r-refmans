<!DOCTYPE html><html><head><title>Help for package RobustBayesianCopas</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {RobustBayesianCopas}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#antidepressants'><p>A Meta-Analysis on the Efficacy of Antidepressants</p></a></li>
<li><a href='#Barlow2014'><p>A Meta-Analysis on the Effect of Parent Training Programs vs. Control for Improving Parental Psychosocial Health Within 4 Weeks After Intervention</p></a></li>
<li><a href='#BayesNonBiasCorrected'><p>Non-bias-corrected robust Bayesian meta-analysis model</p></a></li>
<li><a href='#CopasLikeSelection'><p>Copas-like selection model</p></a></li>
<li><a href='#D.measure'><p>D Measure for Quantifying Publication Bias</p></a></li>
<li><a href='#Hackshaw1997'><p>A Meta-Analysis on the Relationship Between Second-hand Tobacco Smoke and Lung Cancer</p></a></li>
<li><a href='#RobustBayesianCopas'><p>Robust Bayesian Copas selection model</p></a></li>
<li><a href='#StandardMetaAnalysis'><p>Standard meta-analysis</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Robust Bayesian Copas Selection Model</td>
</tr>
<tr>
<td>Version:</td>
<td>2.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2021-01-05</td>
</tr>
<tr>
<td>Author:</td>
<td>Ray Bai</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Ray Bai &lt;raybaistat@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Fits the robust Bayesian Copas (RBC) selection model of Bai et al. (2020) &lt;<a href="https://arxiv.org/abs/2005.02930">arXiv:2005.02930</a>&gt; for correcting and quantifying publication bias in univariate meta-analysis. Also fits standard random effects meta-analysis and the Copas-like selection model of Ning et al. (2017) &lt;<a href="https://doi.org/10.1093%2Fbiostatistics%2Fkxx004">doi:10.1093/biostatistics/kxx004</a>&gt;. </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.6.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats, statip, rjags</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-01-05 18:59:43 UTC; rayba</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-01-06 15:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='antidepressants'>A Meta-Analysis on the Efficacy of Antidepressants</h2><span id='topic+antidepressants'></span>

<h3>Description</h3>

<p>This data set contains 73 studies with results on the effectiveness of antidepressants that were reported to the FDA. However, only 50 of these studies were subsequently published. Since studies reported their outcomes on different scales, effect sizes were all expressed as standardized mean differences by means of Hedges' <em>g</em> scores, accompanied by corresponding variances. This data set was originally analyzed by Turner et al. (2008).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(antidepressants)</code></pre>


<h3>Format</h3>

<p>A dataframe with 73 studies with the following seven variables. 
</p>

<dl>
<dt><code>Drug</code>:</dt><dd><p>Antidepressant name.</p>
</dd>
<dt><code>Study</code>:</dt><dd><p>Study identifier.</p>
</dd>
<dt><code>Published</code>:</dt><dd><p>A binary variable indicating whether the study was published: &quot;1&quot;=published, &quot;0&quot;=not published.</p>
</dd>
<dt><code>Nonstandardized_effect_size</code>:</dt><dd><p>Estimated mean improvement in depression symptoms (nonstandardized).</p>
</dd>
<dt><code>Nonstandardized_SE</code>:</dt><dd><p>Estimated standard error (nonstandardized).</p>
</dd>
<dt><code>Standardized_effect_size</code></dt><dd><p>Estimated mean improvement in depression symptoms (standardized). Note that the standardized values are only available for the <em>published</em> studies (<code>NA</code> if not published). The <em>non</em>-missing data in this column should be used as <code>y</code> in the selection model.</p>
</dd>
<dt><code>Standardized_SE</code>:</dt><dd><p>Estimated standard error (standardized). Note that the standardized values are only available for the <em>published</em> studies (<code>NA</code> if not published). The <em>non</em>-missing data in this column should be used as <code>s</code> in the selection model. </p>
</dd>
</dl>



<h3>Source</h3>

 
<p>Turner, E. H., Matthews, A. M., Linardatos, E., Tell, R. A., and Rosenthal, R. (2008). &quot;Selective publication of antidepressant trials and its influence on apparent efficacy.&quot; <em>New England Journal of Medicine</em>, <b>358</b>(3):252-260.
</p>

<hr>
<h2 id='Barlow2014'>A Meta-Analysis on the Effect of Parent Training Programs vs. Control for Improving Parental Psychosocial Health Within 4 Weeks After Intervention</h2><span id='topic+Barlow2014'></span>

<h3>Description</h3>

<p>This data set contains 26 studies with the standardized mean differences between the improvement in parental psychosocial health for subjects who were enrolled in parent training programs vs. those who were not. This data set is also available in the <code>R</code> package <code>altmeta</code>, along with many other useful data sets.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(Barlow2014)</code></pre>


<h3>Format</h3>

<p>A dataframe with 26 studies with the following five variables within each study.
</p>

<dl>
<dt><code>y</code>:</dt><dd><p>Standardized mean differences in improvement of parental psychosocial health.</p>
</dd>
<dt><code>s</code>:</dt><dd><p>Sample standard errors of standardized mean differences.</p>
</dd>
<dt><code>n1</code>:</dt><dd><p>Sample sizes in treatment group 1 (parent training programs).</p>
</dd>
<dt><code>n2</code>:</dt><dd><p>Sample sizes in treatment group 2 (control).</p>
</dd>
<dt><code>n</code>:</dt><dd><p>Total sample size.</p>
</dd>
</dl>



<h3>Source</h3>

 
<p>Barlow J, Smailagic N, Huband N, Roloff V, Bennett C (2014). &quot;Group-based parent training programmes for improving parental psychosocial health.&quot; <em>Cochrane Database of Systematic Reviews</em>,<b>5</b>, Art. No.: CD002020. &lt;doi: 10.1002/14651858.CD002020.pub4&gt;
</p>

<hr>
<h2 id='BayesNonBiasCorrected'>Non-bias-corrected robust Bayesian meta-analysis model</h2><span id='topic+BayesNonBiasCorrected'></span>

<h3>Description</h3>

<p>This function implements the <em>non</em>-bias-corrected Robust Bayesian Copas selection model of Bai et al. (2020) when there is no publication bias (i.e. <code class="reqn">\rho=0</code>). In this case, the Copas selection model reduces to the standard random effects meta-analysis model:
</p>
<p style="text-align: center;"><code class="reqn">y_i = \theta + \tau u_i + s_i \epsilon_i,</code>
</p>

<p>where <code class="reqn">y_i</code> is the reported treatment effect for the <code class="reqn">i</code>th study, <code class="reqn">s_i</code> is the reported standard error for the <code class="reqn">i</code>th study, <code class="reqn">\theta</code> is the population treatment effect of interest, <code class="reqn">\tau &gt; 0</code> is a heterogeneity parameter, <code class="reqn">\epsilon_i</code> is distributed as <code class="reqn">N(0,1)</code>, and <code class="reqn">u_i</code> and <code class="reqn">\epsilon_i</code> are independent.
</p>
<p>For the <em>non</em>-bias-corrected model, we place noninformative priors on <code class="reqn">(\theta, \tau^2)</code> (see Bai et al. (2020) for details). For the random effects <code class="reqn">u_i, i=1, \ldots, n</code>, we give the option for using normal, Student's t, Laplace, or slash distributions for the random effects. If this function is being run in order to quantify publication bias with the robust Bayesian Copas selection model, then the practitioner should use the <em>same</em> random effects distribution that they used for <code>RobustBayesianCopas</code>.  
</p>


<h3>Usage</h3>

<pre><code class='language-R'>BayesNonBiasCorrected(y, s, re.dist=c("normal", "StudentsT", "Laplace", "slash"),
                      t.df = 4, slash.shape = 1, init=NULL, seed=NULL,
                      burn=10000, nmc=10000)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="BayesNonBiasCorrected_+3A_y">y</code></td>
<td>
<p>An <code class="reqn">n \times 1</code> vector of reported treatment effects.</p>
</td></tr>
<tr><td><code id="BayesNonBiasCorrected_+3A_s">s</code></td>
<td>
<p>An <code class="reqn">n \times 1</code> vector of reported within-study standard errors.</p>
</td></tr>
<tr><td><code id="BayesNonBiasCorrected_+3A_re.dist">re.dist</code></td>
<td>
<p>Distribution for the between-study random effects <code class="reqn">u_i, i=1, \ldots, n</code>. The user may specify the normal, Student's t, Laplace, or slash distribution. The default is <code>StudentsT</code> with 4 degrees of freedom.</p>
</td></tr>
<tr><td><code id="BayesNonBiasCorrected_+3A_t.df">t.df</code></td>
<td>
<p>Degrees of freedom for t-distribution. Only used if <code>StudentsT</code> is specified for <code>re.dist</code>. Default is 4.</p>
</td></tr>
<tr><td><code id="BayesNonBiasCorrected_+3A_slash.shape">slash.shape</code></td>
<td>
<p>Shape parameter in the slash distribution. Only used if <code>slash</code> is specified for <code>re.dist</code>. Default is 1.</p>
</td></tr>
<tr><td><code id="BayesNonBiasCorrected_+3A_init">init</code></td>
<td>
<p>Optional initialization values for <code class="reqn">(\theta, \tau)</code>. If specified, they must be provided in this exact order. If they are not provided, the program estimates initial values from the data.</p>
</td></tr>
<tr><td><code id="BayesNonBiasCorrected_+3A_seed">seed</code></td>
<td>
<p>Optional seed. This needs to be specified if you want to reproduce the exact results of your analysis. </p>
</td></tr>
<tr><td><code id="BayesNonBiasCorrected_+3A_burn">burn</code></td>
<td>
<p>Number of burn-in samples. Default is <code>burn=10000</code>.</p>
</td></tr>
<tr><td><code id="BayesNonBiasCorrected_+3A_nmc">nmc</code></td>
<td>
<p>Number of posterior samples to save. Default is <code>nmc=10000</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The function returns a list containing the following components:
</p>
<table>
<tr><td><code>theta.hat</code></td>
<td>
<p>posterior mean for <code class="reqn">\theta</code>. </p>
</td></tr>
<tr><td><code>theta.samples</code></td>
<td>
<p>MCMC samples for <code class="reqn">\theta</code> after burn-in. Used for plotting the posterior for <code class="reqn">\theta</code> and performing inference of <code class="reqn">\theta</code>.</p>
</td></tr>
<tr><td><code>tau.hat</code></td>
<td>
<p>posterior mean for <code class="reqn">\tau</code>. </p>
</td></tr>
<tr><td><code>tau.samples</code></td>
<td>
<p>MCMC samples for <code class="reqn">\tau</code> after burn-in. Used for plotting the posterior for <code class="reqn">\tau</code> and performing inference of <code class="reqn">\tau</code>.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Bai, R., Lin, L., Boland, M. R., and Chen, Y. (2020). &quot;A robust Bayesian Copas selection model for quantifying and correcting publication bias.&quot; <em>arXiv preprint arXiv:2005.02930.</em>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
######################################
# Example on the Barlow2014 data set #
######################################
data(Barlow2014)
attach(Barlow2014)
# Observed treatment effect
y.obs = Barlow2014[,1]
# Observed standard error
s.obs = Barlow2014[,2]

####################################
# Fit the non-bias-corrected model #
####################################

# NOTE: Use default burn-in (burn=10000) and post-burn-in samples (nmc=10000)
# Fit the model with Laplace errors.
RBCNoBias.mod = BayesNonBiasCorrected(y=y.obs, s=s.obs, re.dist="Laplace", burn=500, nmc=500)

# Point estimate for theta
theta.hat.RBCNoBias = RBCNoBias.mod$theta.hat 
# Standard error for theta
theta.se.RBCNoBias = sd(RBCNoBias.mod$theta.samples)
# 95% posterior credible interval for theta
theta.cred.int = quantile(RBCNoBias.mod$theta.samples, probs=c(0.025,0.975))

# Display results
theta.hat.RBCNoBias 
theta.se.RBCNoBias  
theta.cred.int      

# Plot the posterior for theta
hist(RBCNoBias.mod$theta.samples)

</code></pre>

<hr>
<h2 id='CopasLikeSelection'>Copas-like selection model</h2><span id='topic+CopasLikeSelection'></span>

<h3>Description</h3>

<p>This function performs maximum likelihood estimation (MLE) of <code class="reqn">(\theta, \tau, \rho, \gamma_0, \gamma_1)</code> using the EM algorithm of Ning et al. (2017) for the Copas selection model,
</p>
<p style="text-align: center;"><code class="reqn">y_i | (z_i&gt;0) = \theta + \tau u_i + s_i \epsilon_i,</code>
</p>

<p style="text-align: center;"><code class="reqn">z_i = \gamma_0 + \gamma_1 / s_i + \delta_i,</code>
</p>

<p style="text-align: center;"><code class="reqn">corr(\epsilon_i, \delta_i) = \rho,</code>
</p>

<p>where <code class="reqn">y_i</code> is the reported treatment effect for the <code class="reqn">i</code>th study, <code class="reqn">s_i</code> is the reported standard error for the <code class="reqn">i</code>th study, <code class="reqn">\theta</code> is the population treatment effect of interest, <code class="reqn">\tau &gt; 0</code> is a heterogeneity parameter, and <code class="reqn">u_i</code>, <code class="reqn">\epsilon_i</code>, and <code class="reqn">\delta_i</code> are marginally distributed as <code class="reqn">N(0,1)</code>, and <code class="reqn">u_i</code> and <code class="reqn">\epsilon_i</code> are independent. 
</p>
<p>In the Copas selection model, <code class="reqn">y_i</code> is published (selected) if and only if the corresponding propensity score <code class="reqn">z_i</code> (or the propensity to publish) is greater than zero. The propensity score <code class="reqn">z_i</code> contains two parameters: <code class="reqn">\gamma_0</code> controls the overall probability of publication, and <code class="reqn">\gamma_1</code> controls how the chance of publication depends on study sample size. The reported treatment effects and propensity scores are correlated through <code class="reqn">\rho</code>. If <code class="reqn">\rho=0</code>, then there is no publication bias and the Copas selection model reduces to the standard random effects meta-analysis model.  
</p>
<p>This is called the &quot;Copas-like selection model&quot; because to find the MLE, the EM algorithm utilizes a latent variable <code class="reqn">m</code> that is treated as missing data. See Ning et al. (2017) for more details. An alternative funtion for implementing the Copas selection model using a grid search for <code class="reqn">(\gamma_0, \gamma_1)</code> is available in the <code>R</code> package <code>metasens</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CopasLikeSelection(y, s, init = NULL, tol=1e-20, maxit=1000)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CopasLikeSelection_+3A_y">y</code></td>
<td>
<p>An <code class="reqn">n \times 1</code> vector of reported treatment effects.</p>
</td></tr>
<tr><td><code id="CopasLikeSelection_+3A_s">s</code></td>
<td>
<p>An <code class="reqn">n \times 1</code> vector of reported within-study standard errors.</p>
</td></tr>
<tr><td><code id="CopasLikeSelection_+3A_init">init</code></td>
<td>
<p>Optional initialization values for <code class="reqn">(\theta, \tau, \rho, \gamma_0, \gamma_1)</code>. If specified, they must be provided in this exact order. If they are not provided, the program estimates initial values from the data.</p>
</td></tr>
<tr><td><code id="CopasLikeSelection_+3A_tol">tol</code></td>
<td>
<p>Convergence criterion for the Copas-like EM algorithm for finding the MLE. Default is <code>tol=1e-20</code>.</p>
</td></tr>
<tr><td><code id="CopasLikeSelection_+3A_maxit">maxit</code></td>
<td>
<p>Maximum number of iterations for the Copas-like EM algorithm for finding the MLE. Default is <code>maxit=1000</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The function returns a list containing the following components:
</p>
<table>
<tr><td><code>theta.hat</code></td>
<td>
<p>MLE of <code class="reqn">\theta</code>. </p>
</td></tr>
<tr><td><code>tau.hat</code></td>
<td>
<p>MLE of <code class="reqn">\tau</code>. </p>
</td></tr>
<tr><td><code>rho.hat</code></td>
<td>
<p>MLE of <code class="reqn">\rho</code>. </p>
</td></tr>
<tr><td><code>gamma0.hat</code></td>
<td>
<p>MLE of <code class="reqn">\gamma_0</code>.</p>
</td></tr>
<tr><td><code>gamma1.hat</code></td>
<td>
<p>MLE of <code class="reqn">\gamma_1</code>.</p>
</td></tr>
<tr><td><code>H</code></td>
<td>
<p><code class="reqn">5 \times 5</code> Hessian matrix for the estimates of <code class="reqn">(\theta, \tau, \rho, \gamma_0, \gamma_1)</code>. The square root of the diagonal entries of <code class="reqn">H</code> can be used to estimate the standard errors for <code class="reqn">(\theta, \tau, \rho, \gamma_0, \gamma_1)</code>. </p>
</td></tr>
<tr><td><code>conv</code></td>
<td>
<p>&quot;1&quot; if the optimization algorithm converged, &quot;0&quot; if algorithm did not converge. If <code>conv=0</code>, then using <code class="reqn">H</code> to estimate the standard errors may not be reliable.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Ning, J., Chen, Y., and Piao, J. (2017). &quot;Maximum likelihood estimation and EM algorithm of Copas-like selection model for publication bias correction.&quot; <em>Biostatistics</em>, <b>18</b>(3):495-504.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
####################################
# Example on the Hackshaw data set #
####################################
data(Hackshaw1997)
attach(Hackshaw1997)
# Extract the log OR
y.obs = Hackshaw1997[,2]
# Extract the observed standard error
s.obs = Hackshaw1997[,3]

##################################
# Fit Copas-like selection model #
##################################

# First fit RBC model with normal errors
RBC.mod = RobustBayesianCopas(y=y.obs, s=s.obs, re.dist="normal", seed=123, burn=500, nmc=500)

# Fit CLS model with initial values given from RBC model fit.
# Initialization is not necessary but the algorithm will converge faster with initialization.
CLS.mod = CopasLikeSelection(y=y.obs, s=s.obs, init=c(RBC.mod$theta.hat, RBC.mod$tau.hat,
                                                       RBC.mod$rho.hat, RBC.mod$gamma0.hat,
                                                    RBC.mod$gamma1.hat))

# Point estimate for theta 
CLS.theta.hat = CLS.mod$theta.hat  

# Use Hessian to estimate standard error for theta
CLS.Hessian = CLS.mod$H
# Standard error estimate for theta
CLS.theta.se = sqrt(CLS.Hessian[1,1]) # 

# 95 percent confidence interval 
CLS.interval = c(CLS.theta.hat-1.96*CLS.theta.se, CLS.theta.hat+1.96*CLS.theta.se)

# Display results
CLS.theta.hat  
CLS.theta.se  
CLS.interval   

# Other parameters controlling the publication bias
CLS.mod$rho.hat 
CLS.mod$gamma0.hat
CLS.mod$gamma1.hat

</code></pre>

<hr>
<h2 id='D.measure'>D Measure for Quantifying Publication Bias</h2><span id='topic+D.measure'></span>

<h3>Description</h3>

<p>This function computes Bai's <code class="reqn">D</code> measure for quantifying publication bias based on the robust Bayesian Copas (RBC) selection model. Let <code class="reqn">\pi_{rbc}(\theta | y)</code> be the posterior distribution for <code class="reqn">\theta</code> under the full RBC (bias-corrected) model, and let <code class="reqn">\pi_{\rho=0} (\theta | y)</code> be the posterior distribution for <code class="reqn">\theta</code> under the <em>non</em>-bias corrected model (when <code class="reqn">\rho</code> is fixed at <code class="reqn">\rho=0</code>). The <code class="reqn">D</code> measure is the Hellinger distance <code class="reqn">H</code> between the bias-corrected and <em>non</em>-bias-corrected posteriors.
</p>
<p style="text-align: center;"><code class="reqn">D = H(\pi_{rbc}(\theta | y), \pi_{\rho=0} (\theta | y)).</code>
</p>
 
<p><code class="reqn">D</code> is always between 0 and 1, with <code class="reqn">D \approx 0</code> indicating negligible publication bias and <code class="reqn">D \approx 1</code> indicating a very high magnitude of publication bias.
</p>
<p>The random effects distributions for the bias-corrected and <em>non</em>-bias-corrected models should be the same in order for the <code class="reqn">D</code> measure to be valid. The posterior densities for <code class="reqn">\pi_{rbc}(\theta | y)</code> and <code class="reqn">\pi_{\rho=0} (\theta | y)</code> are approximated using MCMC samples. Numerical integration is used to compute the Hellinger distance between them.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>D.measure(samples.RBCmodel, samples.nobiasmodel)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="D.measure_+3A_samples.rbcmodel">samples.RBCmodel</code></td>
<td>
<p>A vector of the MCMC samples from the RBC model. These can be obtained from the output of the function <code>RobustBayesianCopas</code>.</p>
</td></tr>
<tr><td><code id="D.measure_+3A_samples.nobiasmodel">samples.nobiasmodel</code></td>
<td>
<p>A vector of the MCMC samples from the non-bias-corrected model. These can be obtained from the output of the function <code>BayesNonBiasCorrected</code>. In order for the <em>D</em> measure to be valid, the random effects distribution used in <code>BayesNonBiasCorrected</code> should be the <em>same</em> as the random effects distribution used in <code>RobustBayesianCopas</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The function returns Bai's <code class="reqn">D</code> measure, a value between 0 and 1. <code class="reqn">D \approx 0</code> means negligible publication bias, and <code class="reqn">D \approx 1</code> means a very high magnitude of publication bias.</p>


<h3>References</h3>

<p>Bai, R., Lin, L., Boland, M. R., and Chen, Y. (2020). &quot;A robust Bayesian Copas selection model for quantifying and correcting publication bias.&quot; <em>arXiv preprint arXiv:2005.02930.</em>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
######################################
# Example on the Barlow2014 data set #
######################################
data(Barlow2014)
attach(Barlow2014)
# Observed treatment effect
y.obs = Barlow2014[,1]
# Observed standard error
s.obs = Barlow2014[,2]

#############################################
# Compute D measure using posterior samples #
#############################################
# Fit RBC (bias-corrected) model with t-distributed random effects.
# NOTE: Use default burn-in (burn=10000) and post-burn-in samples (nmc=10000)
RBC.mod = RobustBayesianCopas(y=y.obs, s=s.obs, re.dist="StudentsT", burn=500, nmc=500)

# Fit non-bias-corrected model with t-distributed random effects.
# NOTE: Use default burn-in (burn=10000) and post-burn-in samples (nmc=10000)
RBCNoBias.mod = BayesNonBiasCorrected(y=y.obs, s=s.obs, re.dist="StudentsT", burn=500, nmc=500)

# Compute the D measure based on posterior samples for theta
D = D.measure(RBC.mod$theta.samples, RBCNoBias.mod$theta.samples)




############################################
# Example on the antidepressants data set. #
# This is from Section 6.2 of the paper    #
# by Bai et al. (2020).                    #
############################################

# Set seed, so we can reproduce the exact same results as in the paper.
seed = 123
set.seed(seed)

# Load the full data
data(antidepressants)
attach(antidepressants)

# Extract the 50 published studies
published.data = antidepressants[which(antidepressants$Published==1),]

# Observed treatment effect
y.obs = published.data$Standardized_effect_size

# Observed standard error
s.obs = published.data$Standardized_SE


################################
# Compute the D measure for    #
# quantifying publication bias #
################################

# Fit RBC model with different random effects distributions and compare them using DIC.

# Normal
RBC.mod.normal = RobustBayesianCopas(y=y.obs, s=s.obs, re.dist="normal", seed=seed) 
RBC.mod.normal$DIC # DIC=369.3126
# Student's t
RBC.mod.StudentsT = RobustBayesianCopas(y=y.obs, s=s.obs, re.dist="StudentsT", seed=seed)
RBC.mod.StudentsT$DIC # DIC=515.5151
# Laplace
RBC.mod.laplace = RobustBayesianCopas(y=y.obs, s=s.obs, re.dist="Laplace", seed=seed)
RBC.mod.laplace$DIC # DIC=475.5845
# Slash
RBC.mod.slash = RobustBayesianCopas(y=y.obs, s=s.obs, re.dist="slash", seed=seed)
RBC.mod.slash$DIC # DIC=381.2705

# The model with normal random effects gave the lowest DIC, so we use the model
# with normal study-specific effects for our final analysis.

RBC.mod.normal$rho.hat # rho.hat=0.804
# Plot posterior for rho, which suggests strong publication bias.
hist(RBC.mod.normal$rho.samples) 

# Fit non-biased-corrected model. Make sure that we specify the random effects as normal.
RBCNoBias.mod = BayesNonBiasCorrected(y=y.obs, s=s.obs, re.dist="normal", seed=seed)

# Compute D measure using posterior samples for theta
D.RBC = D.measure(RBC.mod.normal$theta.samples, RBCNoBias.mod$theta.samples) # D=0.95

</code></pre>

<hr>
<h2 id='Hackshaw1997'>A Meta-Analysis on the Relationship Between Second-hand Tobacco Smoke and Lung Cancer</h2><span id='topic+Hackshaw1997'></span>

<h3>Description</h3>

<p>This data set contains 37 studies analyzed by Hackshaw et al. (1997). Hackshaw et al. (1997) evaluated the risk of developing lung cancer in women who were lifelong nonsmokers but whose husbands smoked, compared to women whose husbands had never smoked.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(Hackshaw1997)</code></pre>


<h3>Format</h3>

<p>A dataframe with 37 studies with the following four variables within each study. 
</p>

<dl>
<dt><code>Study</code>:</dt><dd><p>Study identifier.</p>
</dd>
<dt><code>log_OR</code>:</dt><dd><p>The reported log-odds ratio. Use this as the treatment effect in meta-analysis.</p>
</dd>
<dt><code>SE</code>:</dt><dd><p>The reported standard error.</p>
</dd>
<dt><code>weight</code>:</dt><dd><p>The percent weight that the study contributes to the pooled log-odds ratio.</p>
</dd>
</dl>



<h3>Source</h3>

 
<p>Hackshaw, A. K., Law, M. R., and Wald, N. J. (1997). &quot;The accumulated evidence on lung cancer and environmental tobacco smoke.&quot; <em>BMJ</em>, <b>315</b>(7114):980-988.
</p>

<hr>
<h2 id='RobustBayesianCopas'>Robust Bayesian Copas selection model</h2><span id='topic+RobustBayesianCopas'></span>

<h3>Description</h3>

<p>This function implements the Robust Bayesian Copas selection model of Bai et al. (2020) for the Copas selection model,
</p>
<p style="text-align: center;"><code class="reqn">y_i | (z_i&gt;0) = \theta + \tau u_i + s_i \epsilon_i,</code>
</p>

<p style="text-align: center;"><code class="reqn">z_i = \gamma_0 + \gamma_1 / s_i + \delta_i,</code>
</p>

<p style="text-align: center;"><code class="reqn">corr(\epsilon_i, \delta_i) = \rho,</code>
</p>

<p>where <code class="reqn">y_i</code> is the reported treatment effect for the <code class="reqn">i</code>th study, <code class="reqn">s_i</code> is the reported standard error for the <code class="reqn">i</code>th study, <code class="reqn">\theta</code> is the population treatment effect of interest, <code class="reqn">\tau &gt; 0</code> is a heterogeneity parameter, and <code class="reqn">\epsilon_i</code>, and <code class="reqn">\delta_i</code> are marginally distributed as <code class="reqn">N(0,1)</code> and <code class="reqn">u_i</code>, and <code class="reqn">\epsilon_i</code> are independent. 
</p>
<p>In the Copas selection model, <code class="reqn">y_i</code> is published (selected) if and only if the corresponding propensity score <code class="reqn">z_i</code> (or the propensity to publish) is greater than zero. The propensity score <code class="reqn">z_i</code> contains two parameters: <code class="reqn">\gamma_0</code> controls the overall probability of publication, and <code class="reqn">\gamma_1</code> controls how the probability of publication depends on study sample size. The reported treatment effects and propensity scores are correlated through <code class="reqn">\rho</code>. If <code class="reqn">\rho=0</code>, then there is no publication bias and the Copas selection model reduces to the standard random effects meta-analysis model.  
</p>
<p>The RBC model places noninformative priors on <code class="reqn">(\theta, \tau^2, \rho, \gamma_0, \gamma_1)</code> (see Bai et al. (2020) for details). For the random effects <code class="reqn">u_i, i=1, \ldots, n</code>, we give the option for using normal, Student's t, Laplace, or slash distributions for the random effects. The function returns the Deviance Information Criterion (DIC), which can be used to select the appropriate distribution to use for the final analysis. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>RobustBayesianCopas(y, s, re.dist=c("normal", "StudentsT", "Laplace", "slash"),
                    t.df = 4, slash.shape = 1, init=NULL, seed=NULL, 
                    burn=10000, nmc=10000)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="RobustBayesianCopas_+3A_y">y</code></td>
<td>
<p>An <code class="reqn">n \times 1</code> vector of reported treatment effects.</p>
</td></tr>
<tr><td><code id="RobustBayesianCopas_+3A_s">s</code></td>
<td>
<p>An <code class="reqn">n \times 1</code> vector of reported within-study standard errors.</p>
</td></tr>
<tr><td><code id="RobustBayesianCopas_+3A_re.dist">re.dist</code></td>
<td>
<p>Distribution for the between-study random effects <code class="reqn">u_i, i=1, \ldots, n</code>. The user may specify the normal, Student's T, Laplace, or slash distribution. The default is <code>StudentsT</code> with 4 degrees of freedom.</p>
</td></tr>
<tr><td><code id="RobustBayesianCopas_+3A_t.df">t.df</code></td>
<td>
<p>Degrees of freedom for t-distribution. Only used if <code>StudentsT</code> is specified for <code>re.dist</code>. Default is 4.</p>
</td></tr>
<tr><td><code id="RobustBayesianCopas_+3A_slash.shape">slash.shape</code></td>
<td>
<p>Shape parameter in the slash distribution. Only used if <code>slash</code> is specified for <code>re.dist</code>. Default is 1.</p>
</td></tr>
<tr><td><code id="RobustBayesianCopas_+3A_init">init</code></td>
<td>
<p>Optional initialization values for <code class="reqn">(\theta, \tau, \rho, \gamma_0, \gamma_1)</code>. If specified, they must be provided in this exact order. If they are not provided, the program estimates initial values from the data.</p>
</td></tr>
<tr><td><code id="RobustBayesianCopas_+3A_seed">seed</code></td>
<td>
<p>Optional seed. This needs to be specified if you want to reproduce the exact results of your analysis. </p>
</td></tr>
<tr><td><code id="RobustBayesianCopas_+3A_burn">burn</code></td>
<td>
<p>Number of burn-in samples. Default is <code>burn=10000</code>.</p>
</td></tr>
<tr><td><code id="RobustBayesianCopas_+3A_nmc">nmc</code></td>
<td>
<p>Number of posterior samples to save. Default is <code>nmc=10000</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The function returns a list containing the following components:
</p>
<table>
<tr><td><code>DIC</code></td>
<td>
<p>Deviance Information Criterion (DIC), a measure of model fit. This can be used to compare the results for different random effects distributions. The model that gives the lowest DIC gives the best fit to the data.</p>
</td></tr>
<tr><td><code>theta.hat</code></td>
<td>
<p>Posterior mean for <code class="reqn">\theta</code>. </p>
</td></tr>
<tr><td><code>theta.samples</code></td>
<td>
<p>MCMC samples for <code class="reqn">\theta</code> after burn-in. Used for plotting the posterior for <code class="reqn">\theta</code> and performing inference of <code class="reqn">\theta</code>.</p>
</td></tr>
<tr><td><code>tau.hat</code></td>
<td>
<p>Posterior mean for <code class="reqn">\tau</code>. </p>
</td></tr>
<tr><td><code>tau.samples</code></td>
<td>
<p>MCMC samples for <code class="reqn">\tau</code> after burn-in. Used for plotting the posterior for <code class="reqn">\tau</code> and performing inference of <code class="reqn">\tau</code>.</p>
</td></tr>
<tr><td><code>rho.hat</code></td>
<td>
<p>Posterior median for <code class="reqn">\rho</code>. </p>
</td></tr>
<tr><td><code>rho.samples</code></td>
<td>
<p>MCMC samples for <code class="reqn">\rho</code> after burn-in. Used for plotting the posterior for <code class="reqn">\rho</code> and performing inference of <code class="reqn">\rho</code>.</p>
</td></tr>
<tr><td><code>gamma0.hat</code></td>
<td>
<p>Posterior median for <code class="reqn">\gamma_0</code>. </p>
</td></tr>
<tr><td><code>gamma0.samples</code></td>
<td>
<p>MCMC samples for <code class="reqn">\gamma_0</code> after burn-in. Used for plotting the posterior for <code class="reqn">\gamma_0</code> and performing inference of <code class="reqn">\gamma_0</code>.</p>
</td></tr>
<tr><td><code>gamma1.hat</code></td>
<td>
<p>Posterior median for <code class="reqn">\gamma_1</code>. </p>
</td></tr>
<tr><td><code>gamma1.samples</code></td>
<td>
<p>MCMC samples for <code class="reqn">\gamma_1</code> after burn-in. Used for plotting the posterior for <code class="reqn">\gamma_1</code> and performing inference of <code class="reqn">\gamma_1</code>.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Bai, R., Lin, L., Boland, M. R., and Chen, Y. (2020). &quot;A robust Bayesian Copas selection model for quantifying and correcting publication bias.&quot; <em>arXiv preprint arXiv:2005.02930.</em>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>######################################
# Example on the Barlow2014 data set #
######################################
# Load data
data(Barlow2014)
attach(Barlow2014)

# Observed treatment effect
y.obs = Barlow2014[,1]
# Observed standard error
s.obs = Barlow2014[,2]

###############################################
# Fit the RBC model with slash random effects #
###############################################
# NOTE: Use default burn-in (burn=10000) and post-burn-in samples (nmc=10000)
# Fit model with slash errors
RBC.mod = RobustBayesianCopas(y=y.obs, s=s.obs, re.dist="slash", burn=500, nmc=500)

# Point estimate for rho
rho.hat.RBC = RBC.mod$rho.hat
rho.hat.RBC
# Plot posterior for rho
hist(RBC.mod$rho.samples)

# Point estimate for theta
theta.hat.RBC = RBC.mod$theta.hat 
# Standard error for theta
theta.se.RBC = sd(RBC.mod$theta.samples)
# 95% posterior credible interval for theta
theta.cred.int = quantile(RBC.mod$theta.samples, probs=c(0.025,0.975))

# Display results
theta.hat.RBC
theta.se.RBC
theta.cred.int

# Plot the posterior for theta
hist(RBC.mod$theta.samples)




############################################
# Example on second-hand smoking data set. #
# This is from Section 6.1 of the paper by #
# Bai et al. (2020).                       #
############################################

# Set seed, so we can reproduce the exact same result as in the paper.
seed = 1234
set.seed(seed)

# Load the full data
data(Hackshaw1997)
attach(Hackshaw1997)
# Extract the log OR
y.obs = Hackshaw1997[,2]
# Extract the observed standard error
s.obs = Hackshaw1997[,3]


###################################################
# Fit the RBC model with different random effects #
# distributions and compare them using the DIC.   #
###################################################

# Normal
RBC.mod.normal = RobustBayesianCopas(y=y.obs, s=s.obs, re.dist="normal", seed=seed) 
RBC.mod.normal$DIC # DIC=429.7854
# Student's t
RBC.mod.StudentsT = RobustBayesianCopas(y=y.obs, s=s.obs, re.dist="StudentsT", seed=seed) 
RBC.mod.StudentsT$DIC # DIC=399.1955
# Laplace
RBC.mod.Laplace = RobustBayesianCopas(y=y.obs, s=s.obs, re.dist="Laplace", seed=seed) 
RBC.mod.Laplace$DIC # DIC=410.9086
# Slash
RBC.mod.slash = RobustBayesianCopas(y=y.obs, s=s.obs, re.dist="slash", seed=seed)
RBC.mod.slash$DIC # DIC=407.431


#######################################################
# Use the model with t-distributed random errors for  #
# the final analysis since it gave the lowest DIC.    #
#######################################################

# Point estimate for rho
rho.hat.RBC = RBC.mod.StudentsT$rho.hat # rho.hat=0.459 (moderate publication bias)
# Plot posterior for rho
hist(RBC.mod.StudentsT$rho.samples)

# Point estimate for theta
theta.hat.RBC = RBC.mod.StudentsT$theta.hat # theta.hat=0.1672
# 95% posterior credible interval for theta
theta.cred.int = quantile(RBC.mod.StudentsT$theta.samples, probs=c(0.025,0.975))
# Plot the posterior for theta
hist(RBC.mod.StudentsT$theta.samples)

# Obtain odds ratio estimates
OR.samples.RBC = exp(RBC.mod.StudentsT$theta.samples) # Samples of exp(theta)
# Posterior mean OR
OR.RBC.hat = mean(OR.samples.RBC) # OR.hat=1.185
# 95% posterior credible interval for OR
OR.RBC.credint = quantile(OR.samples.RBC, probs=c(0.025,0.975)) # (1.018, 1.350)


##############################################
# Use D measure to quantify publication bias #
##############################################

# Make sure that we specify the random effects as Student's t, since that is
# the distribution that we used for our final analysis.
Bayes.nobias.mod = BayesNonBiasCorrected(y=y.obs, s=s.obs, re.dist="StudentsT", seed=seed)

# Compute D measure based on posterior samples of theta
D.RBC = D.measure(RBC.mod.StudentsT$theta.samples, Bayes.nobias.mod$theta.samples)
D.RBC # D=0.33

</code></pre>

<hr>
<h2 id='StandardMetaAnalysis'>Standard meta-analysis</h2><span id='topic+StandardMetaAnalysis'></span>

<h3>Description</h3>

<p>This function performs maximum likelihood estimation (MLE) of <code class="reqn">(\theta, \tau)</code> for the standard random effects meta-analysis model,
</p>
<p style="text-align: center;"><code class="reqn">y_i = \theta + \tau u_i + s_i \epsilon_i,</code>
</p>
 
<p>where <code class="reqn">y_i</code> is the reported treatment effect for the <code class="reqn">i</code>th study, <code class="reqn">s_i</code> is the reported standard error for the <code class="reqn">i</code>th study, <code class="reqn">\theta</code> is the population treatment effect of interest, <code class="reqn">\tau &gt; 0</code> is a heterogeneity parameter, and <code class="reqn">u_i</code> and <code class="reqn">\epsilon_i</code> are independent and distributed as <code class="reqn">N(0,1)</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>StandardMetaAnalysis(y, s, init = NULL, tol=1e-10, maxit=1000)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="StandardMetaAnalysis_+3A_y">y</code></td>
<td>
<p>An <code class="reqn">n \times 1</code> vector of reported treatment effects.</p>
</td></tr>
<tr><td><code id="StandardMetaAnalysis_+3A_s">s</code></td>
<td>
<p>An <code class="reqn">n \times 1</code> vector of reported within-study standard errors.</p>
</td></tr>
<tr><td><code id="StandardMetaAnalysis_+3A_init">init</code></td>
<td>
<p>Optional initialization values for <code class="reqn">(\theta, \tau)</code>. If specified, they must be provided in this order. If they are not provided, the program estimates initial values from the data.</p>
</td></tr>
<tr><td><code id="StandardMetaAnalysis_+3A_tol">tol</code></td>
<td>
<p>Convergence criterion for the optimization algorithm for finding the MLE. Default is <code>tol=1e-10</code>.</p>
</td></tr>
<tr><td><code id="StandardMetaAnalysis_+3A_maxit">maxit</code></td>
<td>
<p>Maximum number of iterations for the optimization algorithm for finding the MLE. Default is <code>maxit=1000</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The function returns a list containing the following components:
</p>
<table>
<tr><td><code>theta.hat</code></td>
<td>
<p>MLE of <code class="reqn">\theta</code>. </p>
</td></tr>
<tr><td><code>tau.hat</code></td>
<td>
<p>MLE of <code class="reqn">\tau</code>. </p>
</td></tr>
<tr><td><code>H</code></td>
<td>
<p><code class="reqn">2 \times 2</code> Hessian matrix for the estimates of <code class="reqn">(\theta, \tau)</code>. The square root of the diagonal entries of <code class="reqn">H</code> can be used to estimate the standard errors for <code class="reqn">(\theta, \tau)</code>. </p>
</td></tr>
<tr><td><code>conv</code></td>
<td>
<p>&quot;1&quot; if the optimization algorithm converged, &quot;0&quot; if algorithm did not converge. If <code>conv=0</code>, then using <code class="reqn">H</code> to estimate the standard errors may not be reliable.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Bai, R., Lin, L., Boland, M. R., and Chen, Y. (2020). &quot;A robust Bayesian Copas selection model for quantifying and correcting publication bias.&quot; <em>arXiv preprint arXiv:2005.02930.</em>
</p>
<p>Ning, J., Chen, Y., and Piao, J. (2017). &quot;Maximum likelihood estimation and EM algorithm of Copas-like selection model for publication bias correction.&quot; <em>Biostatistics</em>, <b>18</b>(3):495-504.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
############################################
# Example on the antidepressants data set. #
# This is from Section 6.2 of the paper by #
# Bai et al. (2020).                       #
############################################
# Load the full data
data(antidepressants)
attach(antidepressants)

# Extract the 50 published studies
published.data = antidepressants[which(antidepressants$Published==1),]
# Observed treatment effect
y.obs = published.data$Standardized_effect_size
# Observed standard error
s.obs = published.data$Standardized_SE

#################################
# Fit a standard meta-analysis  #
# that ignores publication bias #
#################################

# Set seed
set.seed(123)

SMA.mod = StandardMetaAnalysis(y=y.obs, s=s.obs)

# Point estimate for theta
SMA.theta.hat = SMA.mod$theta.hat
# Use Hessian to estimate standard error for theta
SMA.Hessian = SMA.mod$H
# Standard error estimate for theta
SMA.theta.se = sqrt(SMA.Hessian[1,1]) 
# 95 percent confidence interval 
SMA.interval = c(SMA.theta.hat-1.96*SMA.theta.se, SMA.theta.hat+1.96*SMA.theta.se)

# Display results
SMA.theta.hat
SMA.theta.se
SMA.interval
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
