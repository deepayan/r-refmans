<!DOCTYPE html><html><head><title>Help for package SpATS</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {SpATS}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#controlSpATS'>
<p>Used to set various parameters controlling the fitting process</p></a></li>
<li><a href='#getHeritability'>
<p>Calculate heritabilities from <code>SpATS</code> objects</p></a></li>
<li><a href='#obtain.spatialtrend'>
<p>Predictions of the spatial trend from an <code>SpATS</code> object</p></a></li>
<li><a href='#plot.SpATS'>
<p>Default SpATS plotting</p></a></li>
<li><a href='#plot.variogram.SpATS'>
<p>Default variogram.SpATS plotting</p></a></li>
<li><a href='#predict.SpATS'>
<p>Predictions from an <code>SpATS</code> object</p></a></li>
<li><a href='#print.SpATS'>
<p>Print method for <code>SpATS</code> objects</p></a></li>
<li><a href='#PSANOVA'>
<p>Define a two-dimensional penalised tensor-product of marginal B-Spline basis functions based on the P-spline ANOVA (PSANOVA) approach.</p></a></li>
<li><a href='#SAP'>
<p>Define a two-dimensional penalised tensor-product of marginal B-Spline basis functions.</p></a></li>
<li><a href='#SpATS'>
<p>Spatial analysis of field trials with splines</p></a></li>
<li><a href='#SpATS-package'>
<p>Spatial analysis of field trials with splines</p></a></li>
<li><a href='#summary.SpATS'>
<p>Summary method for <code>SpATS</code> objects</p></a></li>
<li><a href='#variogram'>
<p>Sample variogram</p></a></li>
<li><a href='#wheatdata'>
<p>Wheat yield in South Australia</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Spatial Analysis of Field Trials with Splines</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0-18</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-11-07</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats, grDevices, graphics, fields, spam, data.table, methods</td>
</tr>
<tr>
<td>Description:</td>
<td>Analysis of field trial experiments by modelling spatial trends using two-dimensional Penalised spline (P-spline) models.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL]</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-11-07 10:52:16 UTC; mrodriguez</td>
</tr>
<tr>
<td>Author:</td>
<td>Maria Xose Rodriguez-Alvarez [aut, cre],
  Martin Boer [aut],
  Paul Eilers [aut],
  Fred van Eeuwijk [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Maria Xose Rodriguez-Alvarez &lt;mxrodriguez@uvigo.es&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-11-07 11:40:19 UTC</td>
</tr>
</table>
<hr>
<h2 id='controlSpATS'>
Used to set various parameters controlling the fitting process
</h2><span id='topic+controlSpATS'></span>

<h3>Description</h3>

<p>This function can be used to modify some default parameters that control the estimation of an SpATS model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>controlSpATS(maxit = 200, tolerance = 0.001, monitoring = 2, update.psi = FALSE, 
	update.psi.gauss = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="controlSpATS_+3A_maxit">maxit</code></td>
<td>
<p>numerical value indicating the maximum number of iterations. Default set to 200 (see Details).</p>
</td></tr>
<tr><td><code id="controlSpATS_+3A_tolerance">tolerance</code></td>
<td>
<p>numerical value indicating the tolerance for the convergence criterion. Default set to 0.001 (see Details).</p>
</td></tr>
<tr><td><code id="controlSpATS_+3A_monitoring">monitoring</code></td>
<td>
<p>numerical value determining the level of printing which is done during the estimation. The value of 0 means that no printing is produced, a value of 1 means that only the computing times are printed, and a value of 2 means that, at each iteration, the (REML) deviance and the effective dimensions of the random components are printed. Default set to 2.</p>
</td></tr>
<tr><td><code id="controlSpATS_+3A_update.psi">update.psi</code></td>
<td>
<p>logical. If TRUE, the dispersion parameter of the exponential family is updated at each iteration of the estimation algorithm. Default is FALSE, except for <code>family = gaussian()</code>, where the dispersion parameter (or residual variance), is updated (jointly with the rest of variance components) unless <code>update.psi.gauss</code> is set to FALSE.</p>
</td></tr>
<tr><td><code id="controlSpATS_+3A_update.psi.gauss">update.psi.gauss</code></td>
<td>
<p>logical. Only applies to <code>family = gaussian()</code>. If set to FALSE (default is TRUE) the residual variance is not updated at each iteration of the estimation algorithm but fixed at 1.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The estimation procedure implemented in the SpATS package is an extension of the SAP (Separation of anisotropic penalties) algorithm by Rodriguez - Alvarez et al. (2015). In this case, besides the spatial trend, modelled as a two-dimensional P-spline, the estimation algorithm allows for the incorporation of both fixed and (sets of i.i.d) random effects on the (generalised) linear mixed model. 
For Gaussian response variables, the algorithm is an iterative procedure, with the fixed and random effects as well as the variance components being updated at each iteration. To check the convergence of this iterative procedure, the (REML) deviance is monitored.
For non-Gaussian response variables, estimation is based on Penalized Quasi-likelihood (PQL) methods. Here, the algorithm is a two-loop algorithm: the outer loop corresponds to the Fisher-Scoring algorithm (monitored on the basis of the change in the linear predictor between consecutive iterations), and the inner loop corresponds to that described for the Gaussian case. 
</p>


<h3>Value</h3>

<p>a list with components for each of the possible arguments.
</p>


<h3>References</h3>

<p>Rodriguez-Alvarez, M.X., Lee, D.-J., Kneib, T., Durban, M., and Eilers, P.H.C. (2015). Fast smoothing parameter separation in multidimensional generalized P-splines: the SAP algorithm. Statistics and Computing, 25, 941 - 957.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+SpATS">SpATS</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(SpATS)
data(wheatdata)
wheatdata$R &lt;- as.factor(wheatdata$row)
wheatdata$C &lt;- as.factor(wheatdata$col)

# Default control parameters
m0 &lt;- SpATS(response = "yield", spatial = ~ SAP(col, row, nseg = c(10,20)), 
 genotype = "geno", fixed = ~ colcode + rowcode, random = ~ R + C, 
 data = wheatdata)

# Modified the number of iterations, the tolerance, and the monitoring
m1 &lt;- SpATS(response = "yield", spatial = ~ SAP(col, row, nseg = c(10,20)), 
 genotype = "geno", fixed = ~ colcode + rowcode, random = ~ R + C, 
 data = wheatdata, control = list(maxit = 50, tolerance = 1e-06, monitoring = 1))
</code></pre>

<hr>
<h2 id='getHeritability'>
Calculate heritabilities from <code>SpATS</code> objects
</h2><span id='topic+getHeritability'></span>

<h3>Description</h3>

<p>For the genotype (when random), the function returns the generalized heritability proposed by Oakey (2006).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getHeritability(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getHeritability_+3A_object">object</code></td>
<td>
<p>an object of class <code>SpATS</code> as produced by <code>SpATS()</code></p>
</td></tr>
<tr><td><code id="getHeritability_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods. Not yet implemented.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A numeric vector (usually of length 1) with the heritabilities.
</p>


<h3>References</h3>

<p>Oakey, H., A. Verbyla, W. Pitchford, B. Cullis, and H. Kuchel (2006). Joint modeling of additive and non-additive genetic line effects in single field trials. Theoretical and Applied Genetics, 113, 809 - 819.
</p>
<p>Rodriguez-Alvarez, M.X, Boer, M.P., van Eeuwijk, F.A., and Eilers, P.H.C. (2018). Correcting for spatial heterogeneity in plant breeding experiments with P-splines. Spatial Statistics, 23, 52 - 71. https://doi.org/10.1016/j.spasta.2017.10.003.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+SpATS">SpATS</a></code>, <code><a href="#topic+summary.SpATS">summary.SpATS</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(SpATS)
data(wheatdata)
wheatdata$R &lt;- as.factor(wheatdata$row)
wheatdata$C &lt;- as.factor(wheatdata$col)

m0 &lt;- SpATS(response = "yield", spatial = ~ SAP(col, row, nseg = c(10,20), degree = 3, pord = 2), 
 genotype = "geno", genotype.as.random = TRUE,
 fixed = ~ colcode + rowcode, random = ~ R + C, data = wheatdata, 
 control =  list(tolerance = 1e-03))

getHeritability(m0)
</code></pre>

<hr>
<h2 id='obtain.spatialtrend'>
Predictions of the spatial trend from an <code>SpATS</code> object 
</h2><span id='topic+obtain.spatialtrend'></span>

<h3>Description</h3>

<p>Takes a fitted <code>SpATS</code> object produced by <code>SpATS()</code> and produces predictions of the spatial trend on a regular two-dimensional array.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>obtain.spatialtrend(object, grid = c(100, 100), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="obtain.spatialtrend_+3A_object">object</code></td>
<td>
<p>an object of class <code>SpATS</code> as produced by <code>SpATS()</code></p>
</td></tr>
<tr><td><code id="obtain.spatialtrend_+3A_grid">grid</code></td>
<td>
<p>a numeric vector with the number of grid points along the x- and y- coordinates respectively. Atomic values are recycled. The default is 100.</p>
</td></tr>
<tr><td><code id="obtain.spatialtrend_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods. Not yet implemented.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For each spatial coordinate, <code>grid[k]</code> equally spaced values between the minimum and the maximum are computed (k = 1, 2). The spatial trend is then predicted on the regular two-dimensional array defined by each combination of the x- and y- coordinate values. 
</p>


<h3>Value</h3>

<p>A list with the following components:
</p>
<table>
<tr><td><code>col.p</code></td>
<td>
<p>x-coordinate values at which predictions have been computed.</p>
</td></tr>
<tr><td><code>row.p</code></td>
<td>
<p>y-coordinate values at which predictions have been computed</p>
</td></tr>
<tr><td><code>fit</code></td>
<td>
<p>a matrix of dimension length(row.p) x length(col.p) with the predicted spatial trend (excluding the intercept).</p>
</td></tr>
<tr><td><code>pfit</code></td>
<td>
<p>for the PS-ANOVA approach, a list with 6 matrices of dimension length(row.p) x length(col.p) with each predicted spatial component (bilinear component, 2 main effects, 2 linear-by-smooth components and 1 smooth-by-smooth component).</p>
</td></tr>
</table>


<h3>References</h3>

<p>Lee, D.-J., Durban, M., and Eilers, P.H.C. (2013). Efficient two-dimensional smoothing with P-spline ANOVA mixed models and nested bases. Computational Statistics and Data Analysis, 61, 22 - 37.
</p>
<p>Rodriguez-Alvarez, M.X, Boer, M.P., van Eeuwijk, F.A., and Eilers, P.H.C. (2018). Correcting for spatial heterogeneity in plant breeding experiments with P-splines. Spatial Statistics, 23, 52 - 71. https://doi.org/10.1016/j.spasta.2017.10.003.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+SpATS">SpATS</a></code>, <code><a href="#topic+plot.SpATS">plot.SpATS</a></code>, <code><a href="#topic+predict.SpATS">predict.SpATS</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(SpATS)
data(wheatdata)
wheatdata$R &lt;- as.factor(wheatdata$row)
wheatdata$C &lt;- as.factor(wheatdata$col)

m0 &lt;- SpATS(response = "yield", spatial = ~ SAP(col, row, nseg = c(10,20)), 
 genotype = "geno", fixed = ~ colcode + rowcode, random = ~ R + C, 
 data = wheatdata, control =  list(tolerance = 1e-03))

spat.trend.1 &lt;- obtain.spatialtrend(m0)
spat.trend.2 &lt;- obtain.spatialtrend(m0, grid = c(10, 10))

colors = topo.colors(100)
op &lt;- par(mfrow = c(1,2))
fields::image.plot(spat.trend.1$col.p, spat.trend.1$row.p, t(spat.trend.1$fit), 
 main = "Prediction on a grid of 100 x 100", col = colors, xlab = "Columns", ylab = "Rows")
fields::image.plot(spat.trend.2$col.p, spat.trend.2$row.p, t(spat.trend.2$fit), 
 main = "Prediction on a grid of 10 x 10", col = colors, xlab = "Columns", ylab = "Rows")
par(op)
</code></pre>

<hr>
<h2 id='plot.SpATS'>
Default SpATS plotting
</h2><span id='topic+plot.SpATS'></span>

<h3>Description</h3>

<p>Takes a fitted <code>SpATS</code> object produced by <code>SpATS()</code> and plots six different graphics (see Details).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'SpATS'
plot(x, all.in.one = TRUE, main = NULL, annotated = FALSE, 
	depict.missing = FALSE, spaTrend = c("raw", "percentage"), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.SpATS_+3A_x">x</code></td>
<td>
<p>an object of class <code>SpATS</code> as produced by <code>SpATS()</code>.</p>
</td></tr>
<tr><td><code id="plot.SpATS_+3A_all.in.one">all.in.one</code></td>
<td>
<p>logical. If TRUE, the four plots are depicted in one window. Default is TRUE</p>
</td></tr>
<tr><td><code id="plot.SpATS_+3A_main">main</code></td>
<td>
<p>character string specifying the main title to appear on the plot. By default (i.e. when main = NULL), the variable under study is incorporated in the title of the plot.</p>
</td></tr>
<tr><td><code id="plot.SpATS_+3A_annotated">annotated</code></td>
<td>
<p>logical. If TRUE, the variable under study and the models used is added to the plot. Only applied when argument <code>all.in.one</code> is TRUE.</p>
</td></tr>
<tr><td><code id="plot.SpATS_+3A_depict.missing">depict.missing</code></td>
<td>
<p>logical. If TRUE, the estimated spatial trend is depicted for all plots in the field, even for those with missing values.</p>
</td></tr>
<tr><td><code id="plot.SpATS_+3A_spatrend">spaTrend</code></td>
<td>
<p>a character string indicating how the spatial trend should be displayed. Either &quot;raw&quot; (original scale), or &quot;percentage&quot;. If 'percentage', the estimated spatial trend is scaled (i.e., divided by the average of the observed response variable of interest across the field) and results are shown as a percentage.</p>
</td></tr>
<tr><td><code id="plot.SpATS_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods. Not yet implemented.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The following graphics are depicted: the raw data, the fitted data (on the response scale), the (deviance) residuals, the (original scaler or in percentage) estimated spatial trend (excluding the intercept), the genotypic BLUEs (or BLUPs) and their histogram. Except for the histogram, the plots are depicted in terms of the spatial coordinates (e.g., the rows and columns of the field).  
</p>


<h3>References</h3>

<p>Rodriguez-Alvarez, M.X, Boer, M.P., van Eeuwijk, F.A., and Eilers, P.H.C. (2018). Correcting for spatial heterogeneity in plant breeding experiments with P-splines. Spatial Statistics, 23, 52 - 71. https://doi.org/10.1016/j.spasta.2017.10.003.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+SpATS">SpATS</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(SpATS)
data(wheatdata)
wheatdata$R &lt;- as.factor(wheatdata$row)
wheatdata$C &lt;- as.factor(wheatdata$col)

m0 &lt;- SpATS(response = "yield", spatial = ~ SAP(col, row, nseg = c(10,20), degree = 3, pord = 2), 
 genotype = "geno", fixed = ~ colcode + rowcode, random = ~ R + C, data = wheatdata, 
 control =  list(tolerance = 1e-03))

# Default plotting
plot(m0)
# Annotated
plot(m0, annotated = TRUE, main = "Wheat data (Gilmour et al., 1997)")
</code></pre>

<hr>
<h2 id='plot.variogram.SpATS'>
Default variogram.SpATS plotting
</h2><span id='topic+plot.variogram.SpATS'></span>

<h3>Description</h3>

<p>Takes a fitted <code>variogram.SpATS</code> object produced by <code>variogram.SpATS()</code> and plots the associated sample variogram using an RGL 3D perspective plot (package <code>plot3Drgl</code>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'variogram.SpATS'
plot(x, min.length = 30, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.variogram.SpATS_+3A_x">x</code></td>
<td>
<p>an object of class <code>variogram.SpATS</code> as produced by <code>variogram.SpATS()</code>.</p>
</td></tr>
<tr><td><code id="plot.variogram.SpATS_+3A_min.length">min.length</code></td>
<td>
<p>numerical value. The sample variogram is depicted including only those pairs with more than <code>min.length</code> observations (see <code><a href="#topic+variogram.SpATS">variogram.SpATS</a></code>).</p>
</td></tr>
<tr><td><code id="plot.variogram.SpATS_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods. Not yet implemented.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function as well as function <code>variogram.SpATS()</code> can only be used for regular two dimensional data.
</p>


<h3>References</h3>

<p>Gilmour, A.R., Cullis, B.R., and Verbyla, A.P. (1997). Accounting for Natural and Extraneous Variation in the Analysis of Field Experiments. Journal of Agricultural, Biological, and Environmental Statistics, 2, 269 - 293.
</p>
<p>Stefanova, K.T., Smith, A.B., and Cullis, B.R. (2009). Enhanced Diagnostics for the Spatial Analysis of Field Trials. Journal of Agricultural, Biological, and Environmental Statistics, 14, 392 - 410.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+SpATS">SpATS</a></code>, <code><a href="#topic+variogram.SpATS">variogram.SpATS</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(SpATS)
data(wheatdata)
wheatdata$R &lt;- as.factor(wheatdata$row)
wheatdata$C &lt;- as.factor(wheatdata$col)

m0 &lt;- SpATS(response = "yield", spatial = ~ SAP(col, row, nseg = c(10,20), degree = 3, pord = 2), 
 genotype = "geno", fixed = ~ colcode + rowcode, random = ~ R + C, data = wheatdata, 
 control =  list(tolerance = 1e-03))

# Compute the variogram
var.m0 &lt;- variogram(m0)
# Plot the variogram
plot(var.m0)
</code></pre>

<hr>
<h2 id='predict.SpATS'>
Predictions from an <code>SpATS</code> object 
</h2><span id='topic+predict.SpATS'></span>

<h3>Description</h3>

<p>Takes a fitted <code>SpATS</code> object produced by <code>SpATS()</code> and produces predictions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'SpATS'
predict(object, newdata = NULL, which = NULL, 
	predFixed = c("conditional", "marginal"), return.vcov.matrix = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict.SpATS_+3A_object">object</code></td>
<td>
<p>an object of class <code>SpATS</code> as produced by <code>SpATS()</code>.</p>
</td></tr>
<tr><td><code id="predict.SpATS_+3A_newdata">newdata</code></td>
<td>
<p>an optional data frame to be used for obtaining the predictions.</p>
</td></tr>
<tr><td><code id="predict.SpATS_+3A_which">which</code></td>
<td>
<p>an optional character string with the variables that define the margins of the multiway table to be predicted (see Details).</p>
</td></tr>
<tr><td><code id="predict.SpATS_+3A_predfixed">predFixed</code></td>
<td>
<p>a character string indicating how predictions for fixed factor are computed. Either &quot;conditional&quot; or &quot;marginal&quot; (see Details).</p>
</td></tr>
<tr><td><code id="predict.SpATS_+3A_return.vcov.matrix">return.vcov.matrix</code></td>
<td>
<p>logical. If TRUE, the variance-covariance matrix for the predictions is returned.</p>
</td></tr>
<tr><td><code id="predict.SpATS_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods. Not yet implemented.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function allows to produce predictions, either specifying: (1) the data frame on which to obtain the predictions (argument <code>newdata</code>), or (2) those variables that define the margins of the multiway table to be predicted (argument <code>which</code>). In the first case, all fixed components (including genotype when fixed) and the spatial coordinates must be present in the data frame. As for the random effects is concerned, they are excluded from the predictions when the value is missing in the data frame. In the second case, predictions are obtained for each combination of values of the specified variables that is present in the data set used to fit the model. For those variables not specified in the argument <code>which</code>, the following rules have been considered: (a) random factors and the spatial trend are ignored in the predictions, (b) for fixed numeric variables, the mean value is considered; and (c) for fixed factors, there are two possibilities according to argument 'predFixed': (c1) if predFixed = 'conditional', the reference level is used; and (c2) predFixed = 'marginal', predictions are obtained averaging over all levels of the fixed factor.
</p>


<h3>Value</h3>

<p>The data frame used for obtaining the predictions, jointly with the predicted values and the corresponding standard errors. The label &ldquo;Excluded&rdquo; has been used to indicate those cases where a covariate has been excluded or ignored for the prediction (as for instance the random effect). 
</p>


<h3>References</h3>

<p>Welham, S., Cullis, B., Gogel, B., Gilmour, A., and Thompson, R. (2004). Prediction in linear mixed models. Australian and New Zealand Journal of Statistics, 46, 325 - 347.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+SpATS">SpATS</a></code>, <code><a href="#topic+obtain.spatialtrend">obtain.spatialtrend</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(SpATS)
data(wheatdata)
wheatdata$R &lt;- as.factor(wheatdata$row)
wheatdata$C &lt;- as.factor(wheatdata$col)

m0 &lt;- SpATS(response = "yield", spatial = ~ SAP(col, row, nseg = c(10,20)), 
 genotype = "geno", fixed = ~ colcode + rowcode, random = ~ R + C, 
 data = wheatdata, control =  list(tolerance = 1e-03))

# Fitted values: prediction on the dataset used for fitting the model
pred1.m0 &lt;- predict(m0, newdata = wheatdata)
pred1.m0[1:5,]

# Genotype prediction
pred2.m0 &lt;- predict(m0, which = "geno")
pred2.m0[1:5,]

</code></pre>

<hr>
<h2 id='print.SpATS'>
Print method for <code>SpATS</code> objects
</h2><span id='topic+print.SpATS'></span>

<h3>Description</h3>

<p>Default print method for objects fitted with <code>SpATS()</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'SpATS'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.SpATS_+3A_x">x</code></td>
<td>
<p>an object of class <code>SpATS</code> as produced by <code>SpATS()</code></p>
</td></tr>
<tr><td><code id="print.SpATS_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods. Not yet implemented.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A short summary is printed including: the variable under study (response), the variable containing the genotypes, the spatial model, and the random and fixed components (when appropriate). Besides this information, the number of observations used to fit the model, as well as of those deleted due to missingness or zero weights are reported. Finally, the effective degrees of freedom (effective dimension) of the fitted model and the (REML) deviance is also printed.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+SpATS">SpATS</a></code>, <code><a href="#topic+summary.SpATS">summary.SpATS</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(SpATS)
data(wheatdata)
wheatdata$R &lt;- as.factor(wheatdata$row)
wheatdata$C &lt;- as.factor(wheatdata$col)

m0 &lt;- SpATS(response = "yield", spatial = ~ SAP(col, row, nseg = c(10,20), degree = 3, pord = 2), 
 genotype = "geno", fixed = ~ colcode + rowcode, random = ~ R + C, data = wheatdata, 
 control =  list(tolerance = 1e-03))

m0
</code></pre>

<hr>
<h2 id='PSANOVA'>
Define a two-dimensional penalised tensor-product of marginal B-Spline basis functions based on the P-spline ANOVA (PSANOVA) approach.
</h2><span id='topic+PSANOVA'></span>

<h3>Description</h3>

<p>Auxiliary function used for modelling the spatial or environmental effect as a two-dimensional penalised tensor-product of marginal B-spline basis functions with anisotropic penalties on the basis of the PSANOVA approach by Lee et al. (2013).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>PSANOVA(..., nseg = c(10,10), pord = c(2,2), degree = c(3,3), nest.div = c(1,1), 
	center = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="PSANOVA_+3A_...">...</code></td>
<td>
<p>a list of the covariates that this smooth component is a function of. Currently, only two-dimensional tensor-product smoothers are implemented: the first covariate is assumed to define the x-spatial coordinate (e.g., column position) of each plot in the field, and the second argument the y-spatial coordinate (i.e., the row position). Both covariates should be numerical.</p>
</td></tr>
<tr><td><code id="PSANOVA_+3A_nseg">nseg</code></td>
<td>
<p>numerical vector of length 2 containing the number of segments for each marginal (strictly <code>nseg</code> - 1 is the number of internal knots in the domain of the covariate). Atomic values are also valid, being recycled. Default set to 10.</p>
</td></tr>
<tr><td><code id="PSANOVA_+3A_pord">pord</code></td>
<td>
<p>numerical vector of length 2 containing the penalty order for each marginal. Atomic values are also valid, being recycled. Default set to 2 (second order). Currently, only second order penalties are allowed.</p>
</td></tr>
<tr><td><code id="PSANOVA_+3A_degree">degree</code></td>
<td>
<p>numerical vector of length 2 containing the order of the polynomial of the B-spline basis for each marginal. Atomic values are also valid, being recycled. Default set to 3 (cubic B-splines).</p>
</td></tr>
<tr><td><code id="PSANOVA_+3A_nest.div">nest.div</code></td>
<td>
<p>numerical vector of length 2 containing the divisor of the number of segments (<code>nseg</code>) to be used for the construction of the nested B-spline basis for the smooth-by-smooth interaction component. In this case, the nested B-spline basis will be constructed assuming a total of <code>nseg</code>/<code>nest.div</code> segments. Default set to 1, which implies that nested basis are not used. See <code><a href="#topic+SAP">SAP</a></code> for more details.</p>
</td></tr>
<tr><td><code id="PSANOVA_+3A_center">center</code></td>
<td>
<p>logical. If TRUE, the fitted spatial trend (2D surface) will be centered at zero for the observed data (i.e., the average of the fitted spatial trend will be zero at the observed data). By default FALSE (for compatibility with versions of the package previous to 1.0-13.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The approach implemented here represents an alternative method to the <code><a href="#topic+SAP">SAP</a></code> function. In this case, the smooth bivariate surface (or spatial trend) is decomposed in five different components each of them depending on a single smoothing parameter (see Lee et al., 2013).
</p>


<h3>References</h3>

<p>Gilmour, A.R., Cullis, B.R., and Verbyla, A.P. (1997). Accounting for Natural and Extraneous Variation in the Analysis of Field Experiments. Journal of Agricultural, Biological, and Environmental Statistics, 2, 269 - 293.
</p>
<p>Lee, D.-J., Durban, M., and Eilers, P.H.C. (2013). Efficient two-dimensional smoothing with P-spline ANOVA mixed models and nested bases. Computational Statistics and Data Analysis, 61, 22 - 37.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+SpATS">SpATS</a></code>, <code><a href="#topic+SAP">SAP</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(SpATS)
data(wheatdata)
wheatdata$R &lt;- as.factor(wheatdata$row)
wheatdata$C &lt;- as.factor(wheatdata$col)

# Without nested basis
m0 &lt;- SpATS(response = "yield", spatial = ~ PSANOVA(col, row, nseg = c(10,20)), 
 genotype = "geno", fixed = ~ colcode + rowcode, random = ~ R + C, data = wheatdata, 
 control =  list(tolerance = 1e-03))

summary(m0)

# With nested basis
m1 &lt;- SpATS(response = "yield", spatial = ~ PSANOVA(col, row, nseg = c(10,20), nest.div = 2), 
genotype = "geno", fixed = ~ colcode + rowcode, random = ~ R + C, data = wheatdata, 
control =  list(tolerance = 1e-03))

summary(m1)
</code></pre>

<hr>
<h2 id='SAP'>
Define a two-dimensional penalised tensor-product of marginal B-Spline basis functions.
</h2><span id='topic+SAP'></span>

<h3>Description</h3>

<p>Auxiliary function used for modelling the spatial or environmental effect as a two-dimensional penalised tensor-product of marginal B-spline basis functions with anisotropic penalties. The approach implemented here corresponds to the Separation of Anisotropic Penalties (SAP) algorithm introduced by Rodriguez-Alvarez et al. (2015). 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SAP(..., nseg = c(10,10), pord = c(2,2), degree = c(3,3), nest.div = c(1,1), 
	ANOVA = FALSE, center = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SAP_+3A_...">...</code></td>
<td>
<p>a list of the covariates that this smooth component is a function of. Currently, only two-dimensional tensor-product smoothers are implemented: the first covariate is assumed to define the x-spatial coordinate (e.g., column position) of each plot in the field, and the second argument the y-spatial coordinate (i.e., the row position). Both covariates should be numerical.</p>
</td></tr>
<tr><td><code id="SAP_+3A_nseg">nseg</code></td>
<td>
<p>numerical vector of length 2 containing the number of segments for each marginal (strictly <code>nseg</code> - 1 is the number of internal knots in the domain of the covariate). Atomic values are also valid, being recycled. Default set to 10.</p>
</td></tr>
<tr><td><code id="SAP_+3A_pord">pord</code></td>
<td>
<p>numerical vector of length 2 containing the penalty order for each marginal. Atomic values are also valid, being recycled. Default set to 2 (second order).</p>
</td></tr>
<tr><td><code id="SAP_+3A_degree">degree</code></td>
<td>
<p>numerical vector of length 2 containing the order of the polynomial of the B-spline basis for each marginal. Atomic values are also valid, being recycled. Default set to 3 (cubic B-splines).</p>
</td></tr>
<tr><td><code id="SAP_+3A_nest.div">nest.div</code></td>
<td>
<p>numerical vector of length 2 containing the divisor of the number of segments (<code>nseg</code>) to be used for the construction of the nested B-spline basis for the smooth-by-smooth interaction component. In this case, the nested B-spline basis will be constructed assuming a total of <code>nseg</code>/<code>nest.div</code> segments. Default set to 1, which implies that nested basis are not used. See details.</p>
</td></tr>
<tr><td><code id="SAP_+3A_anova">ANOVA</code></td>
<td>
<p>logical. If TRUE, four different smoothing parameters are considered: two for the main effects and two for the smooth interaction. See details.</p>
</td></tr>
<tr><td><code id="SAP_+3A_center">center</code></td>
<td>
<p>logical. If TRUE, the fitted spatial trend (2D surface) will be centered at zero for the observed data (i.e., the average of the fitted spatial trend will be zero at the observed data). By default FALSE (for compatibility with versions of the package previous to 1.0-13.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Within the P-spline framework, anisotropic low-rank tensor-product smoothers have become the general approach for modelling multidimensional surfaces (Eilers and Marx 2003; Wood 2006). In this package, we propose to model the spatial or environmental effect by means of the tensor-product of B-splines basis functions. In other words, we propose to model the spatial trend as a smooth bivariate surface jointly defined over the the spatial coordinates. Accordingly, the current function has been designed to allow the user to specify the spatial coordinates that the spatial trend is a function of. There is no restriction about how the spatial coordinates shall be specified: these can be the longitude and latitude of the position of the plot on the field or the column and row numbers. The only restriction is that the variables defining the spatial coordinates should be numeric (in contrast to factors).
</p>
<p>As far as estimation is concerned, we have used in this package the equivalence between P-splines and linear mixed models (Currie and Durban, 2002). Under this approach, the smoothing parameters are expressed as the ratio between variance components. Moreover, the smooth components are decomposed in two parts: one which is not penalised (and treated as fixed) and one with is penalised (and treated as random). For the two-dimensional case, the mixed model representation leads also to a very interesting decomposition of the penalised part of the bivariate surface in three different components (Lee and Durban, 2011): (a) a component that contains the smooth main effect (smooth trend)	along one of the covariates that the surface is a function of (as, e.g, the x-spatial coordinate or column position of the plot in the field), (b) a component that contains the smooth main effect (smooth trend) along the other covariate (i.e., the y-spatial coordinate or row position); and (c) a smooth interaction component (sum of the linear-by-smooth interaction components and the smooth-by-smooth interaction component). 
The default implementation used in this function (<code>ANOVA</code> = <code>FALSE</code>) assumes two different smoothing parameters, i.e., one for each covariate in the smooth component. Accordingly, the same smoothing parameters are used for both, the main effects and the smooth interaction. However, this approach can be extended to deal with the ANOVA-type decomposition presented in Lee and Durban (2011). In their approach, four different smoothing parameters are considered for the smooth surface, that are in concordance with the aforementioned decomposition: (a) two smoothing parameter, one for each of the main effects; and (b) two smoothing parameter for the smooth interaction component. Here, this decomposition can be obtained by specifying the argument <code>ANOVA = TRUE</code>.  
</p>
<p>It should be noted that, the computational burden associated with the estimation of the two-dimensional tensor-product smoother might be prohibitive if the dimension of the marginal bases is large. In these cases, Lee et al. (2013) propose to reduce the computational cost by using nested bases. The idea is to reduce the dimension of the marginal bases (and therefore the associated number of parameters to be estimated), but only for the smooth-by-smooth interaction component. As pointed out by the authors, this simplification can be justified by the fact that the main effects would in fact explain most of the structure (or spatial trend) presented in the data, and so a less rich representation of the smooth-by-smooth interaction component could be needed. In order to ensure that the reduced bivariate surface is in fact nested to the model including only the main effects, Lee et al. (2013) show that the number of segments used for the nested basis should be a divisor of the number of segments used in
the original basis (<code>nseg</code> argument). In the present function, the divisor of the number of segments is specified through the argument <code>nest.div</code>. For a more detailed review on this topic, see Lee (2010) and Lee et al. (2013).
</p>


<h3>References</h3>

<p>Currie, I., and Durban, M. (2002). Flexible smoothing with P-splines: a unified approach. Statistical Modelling, 4, 333 - 349.
</p>
<p>Eilers, P.H.C., and Marx, B.D. (2003). Multivariate calibration with temperature interaction using two-dimensional penalised signal regression. Chemometrics and Intelligent Laboratory Systems, 66, 159 - 174.
</p>
<p>Gilmour, A.R., Cullis, B.R., and Verbyla, A.P. (1997). Accounting for Natural and Extraneous Variation in the Analysis of Field Experiments. Journal of Agricultural, Biological, and Environmental Statistics, 2, 269 - 293.
</p>
<p>Lee, D.-J., 2010. Smothing mixed model for spatial and spatio-temporal data. Ph.D. Thesis, Department of Statistics, Universidad Carlos III de Madrid, Spain.
</p>
<p>Lee, D.-J., and Durban, M. (2011). P-spline ANOVA-type interaction models for spatio-temporal smoothing. Statistical Modelling 11, 49 - 69.
</p>
<p>Lee, D.-J., Durban, M., and Eilers, P.H.C. (2013). Efficient two-dimensional smoothing with P-spline ANOVA mixed models and nested bases. Computational Statistics and Data Analysis, 61, 22 - 37.
</p>
<p>Rodriguez-Alvarez, M.X., Lee, D.-J., Kneib, T., Durban, M., and Eilers, P.H.C. (2015). Fast smoothing parameter separation in multidimensional generalized P-splines: the SAP algorithm. Statistics and Computing, 25, 941 - 957.
</p>
<p>Wood, S.N. (2006). Low-rank scale-invariant tensor product smooths for generalized additive models. Journal of the Royal Statistical Society: Series B, 70, 495 - 518.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+SpATS">SpATS</a></code>, <code><a href="#topic+PSANOVA">PSANOVA</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(SpATS)
data(wheatdata)
wheatdata$R &lt;- as.factor(wheatdata$row)
wheatdata$C &lt;- as.factor(wheatdata$col)

# Original anisotropic approach: two smoothing parameters
m0 &lt;- SpATS(response = "yield", spatial = ~ SAP(col, row, nseg = c(10,20)), 
 genotype = "geno", fixed = ~ colcode + rowcode, random = ~ R + C, 
 data = wheatdata, control =  list(tolerance = 1e-03))
summary(m0)

# ANOVA decomposition: four smoothing parameters
## Not run: 
m1 &lt;- SpATS(response = "yield", spatial = ~ SAP(col, row, nseg = c(10,20), ANOVA = TRUE), 
 genotype = "geno", fixed = ~ colcode + rowcode, random = ~ R + C, data = wheatdata, 
 control =  list(tolerance = 1e-03))
summary(m1)

## End(Not run)
</code></pre>

<hr>
<h2 id='SpATS'>
Spatial analysis of field trials with splines
</h2><span id='topic+SpATS'></span>

<h3>Description</h3>

<p>Function specifically designed for the analysis of field trials experiments with the spatial trend being modelled by means of two-dimensional P-splines.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>SpATS(response, genotype, geno.decomp = NULL, genotype.as.random = FALSE, spatial, 
 fixed = NULL, random = NULL, data, family = gaussian(), offset = 0, weights = NULL, 
 control = controlSpATS())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="SpATS_+3A_response">response</code></td>
<td>
<p>a character string with the name of the variable that contains the response variable of interest.</p>
</td></tr>
<tr><td><code id="SpATS_+3A_genotype">genotype</code></td>
<td>
<p>a character string with the name of the variable that contains the genotypes or varieties. This variable must be a factor on the data frame.</p>
</td></tr>
<tr><td><code id="SpATS_+3A_geno.decomp">geno.decomp</code></td>
<td>
<p>an optional character string with the name of a factor variable according which genotypes are grouped, with different genetic variance being assumed for each group. Only applies when genotype is random</p>
</td></tr>
<tr><td><code id="SpATS_+3A_genotype.as.random">genotype.as.random</code></td>
<td>
<p>logical. If TRUE, the genotype is included as random effect in the model. The default is FALSE.</p>
</td></tr>
<tr><td><code id="SpATS_+3A_spatial">spatial</code></td>
<td>
<p>a right hand <code><a href="stats.html#topic+formula">formula</a></code> object specifying the spatial P-Spline model. See <code><a href="#topic+SAP">SAP</a></code> and <code><a href="#topic+PSANOVA">PSANOVA</a></code> for more details about how to specify the spatial trend.</p>
</td></tr>
<tr><td><code id="SpATS_+3A_fixed">fixed</code></td>
<td>
<p>an optional right hand <code><a href="stats.html#topic+formula">formula</a></code> object specifying the fixed effects.</p>
</td></tr>
<tr><td><code id="SpATS_+3A_random">random</code></td>
<td>
<p>an optional right hand <code><a href="stats.html#topic+formula">formula</a></code> object specifying the random effects. Currently, only sets of independent and identically distributed random effects can be incorporated.</p>
</td></tr>
<tr><td><code id="SpATS_+3A_data">data</code></td>
<td>
<p>data frame containing all needed variables</p>
</td></tr>
<tr><td><code id="SpATS_+3A_family">family</code></td>
<td>
<p>object of class <code><a href="stats.html#topic+family">family</a></code> specifying the distribution and link function.</p>
</td></tr>
<tr><td><code id="SpATS_+3A_offset">offset</code></td>
<td>
<p>an optional numerical vector containing an a priori known component to be included in the linear predictor during fitting. </p>
</td></tr>
<tr><td><code id="SpATS_+3A_weights">weights</code></td>
<td>
<p>an optional numerical vector of weights to be used in the fitting process. By default, the weights are considered to be one.</p>
</td></tr>
<tr><td><code id="SpATS_+3A_control">control</code></td>
<td>
<p>a list of control values to replace the default values returned by the function <code><a href="#topic+controlSpATS">controlSpATS</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function fits a (generalised) linear mixed model, with the variance components being estimated by the restricted log-likelihood (REML). The estimation procedure is an extension of the SAP (Separation of anisotropic penalties) algorithm by Rodriguez - Alvarez et al. (2015). In this package, besides the spatial trend, modelled as a two-dimensional P-spline, the implemented estimation algorithm also allows for the incorporation of both fixed and (sets of i.i.d) random effects on the (generalised) linear mixed model.
As far as the implementation of the algorithm is concerned, the sparse structure of the design matrix associated with the genotype has been taken into account. The combination of both the SAP algorithm and this sparse structure makes the algorithm computational efficient, allowing the proposal to be applied for the analysis of large datasets.  
</p>


<h3>Value</h3>

<p>A list with the following components:
</p>
<table>
<tr><td><code>call</code></td>
<td>
<p>the matched call.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>the original supplied data argument with a new column with the weights used during the fitting process.</p>
</td></tr>
<tr><td><code>model</code></td>
<td>
<p>a list with the model components: response, spatial, genotype, fixed and/or random.</p>
</td></tr>
<tr><td><code>fitted</code></td>
<td>
<p>a numeric vector with the fitted values.</p>
</td></tr>
<tr><td><code>residuals</code></td>
<td>
<p>a numeric vector with deviance residuals.</p>
</td></tr>
<tr><td><code>psi</code></td>
<td>
<p>a two-length vector with the values of the dispersion parameter at convergence. For Gaussian responses both elements coincide, being the (REML) estimate of dispersion parameter. For non-Gaussian responses, the result depends on the argument <code>update.psi</code> of the <code><a href="#topic+controlSpATS">controlSpATS</a></code> function. If this argument was specified to <code>FALSE</code> (the default), the first component of the vector corresponds to the default value used for the dispersion parameter (usually 1). The second element, correspond to the (REML) estimate of the dispersion parameter at convergence. If the argument <code>update.psi</code> was specified to <code>TRUE</code>, both components coincide (as in the Gaussian case).</p>
</td></tr>
<tr><td><code>var.comp</code></td>
<td>
<p>a numeric vector with the (REML) variance component estimates. These vector contains the variance components associated with the spatial trend, as well as those related with the random model terms.</p>
</td></tr>
<tr><td><code>eff.dim</code></td>
<td>
<p>a numeric vector with the estimated effective dimension (or effective degrees of freedom) for each model component (genotype, spatial, fixed and/or random)</p>
</td></tr>
<tr><td><code>dim</code></td>
<td>
<p>a numeric vector with the (model) dimension of each model component (genotype, spatial, fixed and/or random). This value corresponds to the number of parameters to be estimated</p>
</td></tr>
<tr><td><code>dim.nom</code></td>
<td>
<p>a numeric vector with the (nominal) dimension of each component (genotype, spatial, fixed and/or random). For the random terms of the model, this value corresponds to upper bound for the effective dimension (i.e., the maximum effective dimension a random term can achive). This nominal dimension is <code class="reqn">rank[X, Z_k] - rank[X]</code>, where <code class="reqn">Z_k</code> is the design matrix of the k-th random factor and <code class="reqn">X</code> is the design matrix of the fixed part of the model. In most cases (but not always), the nominal dimension corresponds to the model dimension minus one, &ldquo;lost&rdquo; due to the implicit constraint that ensures the mean of the random effects to be zero.</p>
</td></tr>
<tr><td><code>nobs</code></td>
<td>
<p>number of observations used to fit the model</p>
</td></tr>
<tr><td><code>niterations</code></td>
<td>
<p>number of iterations EM-algorithm</p>
</td></tr>
<tr><td><code>deviance</code></td>
<td>
<p>the (REML) deviance at convergence (i.e., - 2 times the restricted log-likelihood)</p>
</td></tr>
<tr><td><code>coeff</code></td>
<td>
<p>a numeric vector with the estimated fixed and random effect coefficients.</p>
</td></tr>
<tr><td><code>terms</code></td>
<td>
<p>a list with the model terms: response, spatial, genotype, fixed and/or random. The information provided here is useful for printing and prediction purposes.</p>
</td></tr>
<tr><td><code>vcov</code></td>
<td>
<p>inverse of the coefficient matrix of the mixed models equations. The inverse is needed for the computation of standard errors. For computational issues, the inverse is returned as a list: C11_inv corresponds to the coefficient matrix associated with the genotype; C22_inv corresponds to the coefficient matrix associated with the spatial, the fixed and the random components; and C12_inv and C21_inv correspond to the &ldquo;combination&rdquo; of both.</p>
</td></tr>
</table>


<h3>References</h3>

<p>Currie, I., and Durban, M. (2002). Flexible smoothing with P-splines: a unified approach. Statistical Modelling, 4, 333 - 349.
</p>
<p>Eilers, P.H.C., and Marx, B.D. (2003). Multivariate calibration with temperature interaction using two-dimensional penalised signal regression. Chemometrics and Intelligent Laboratory Systems, 66, 159 - 174.
</p>
<p>Eilers, P.H.C., Marx, B.D., Durban, M. (2015). Twenty years of P-splines. SORT, 39(2), 149 - 186.
</p>
<p>Gilmour, A.R., Cullis, B.R., and Verbyla, A.P. (1997). Accounting for Natural and Extraneous Variation in the Analysis of Field Experiments. Journal of Agricultural, Biological, and Environmental Statistics, 2, 269 - 293.
</p>
<p>Lee, D.-J., Durban, M., and Eilers, P.H.C. (2013). Efficient two-dimensional smoothing with P-spline ANOVA mixed models and nested bases. Computational Statistics and Data Analysis, 61, 22 - 37.
</p>
<p>Rodriguez-Alvarez, M.X, Boer, M.P., van Eeuwijk, F.A., and Eilers, P.H.C. (2018). Correcting for spatial heterogeneity in plant breeding experiments with P-splines. Spatial Statistics, 23, 52 - 71. https://doi.org/10.1016/j.spasta.2017.10.003.
</p>
<p>Rodriguez-Alvarez, M.X., Lee, D.-J., Kneib, T., Durban, M., and Eilers, P.H.C. (2015). Fast smoothing parameter separation in multidimensional generalized P-splines: the SAP algorithm. Statistics and Computing, 25, 941 - 957.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+SpATS-package">SpATS-package</a></code>, <code><a href="#topic+controlSpATS">controlSpATS</a></code>, <code><a href="#topic+SAP">SAP</a></code>, <code><a href="#topic+PSANOVA">PSANOVA</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(SpATS)
data(wheatdata)
summary(wheatdata)

# Create factor variable for row and columns
wheatdata$R &lt;- as.factor(wheatdata$row)
wheatdata$C &lt;- as.factor(wheatdata$col)

m0 &lt;- SpATS(response = "yield", spatial = ~ SAP(col, row, nseg = c(10,20), degree = 3, pord = 2), 
 genotype = "geno", fixed = ~ colcode + rowcode, random = ~ R + C, data = wheatdata, 
 control =  list(tolerance = 1e-03))
# Brief summary
m0
# More information: dimensions
summary(m0) # summary(fit.m2, which = "dimensions") 
# More information: variances
summary(m0, which = "variances") 
# More information: all
summary(m0, which = "all") 

# Plot results
plot(m0)
plot(m0, all.in.one = FALSE)

# Variogram
var.m0 &lt;- variogram(m0)
plot(var.m0)
</code></pre>

<hr>
<h2 id='SpATS-package'>
Spatial analysis of field trials with splines
</h2><span id='topic+SpATS-package'></span>

<h3>Description</h3>

<p>This package allows the use of two-dimensional (2D) penalised splines (P-splines) in the context of agricultural field trials. Traditionally, the modelling of the spatial or environmental effect in the expression of phenotypes has been done assuming correlated random noise (Gilmour et al, 1997). We, however, propose to model the spatial variation explicitly using 2D P-splines (Rodriguez-Alvarez et al., 2018). Besides the existence of fast and stable algorithms for estimation (Rodriguez-Alvarez et al., 2015; Lee et al., 2013), the direct and nice interpretation of the spatial trend that this approach provides makes it attractive for the analysis of field experiments.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> SpATS</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.0-18</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2022-11-07</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Maria Xose Rodriguez-Alvarez, Martin Boer, Paul Eilers, Fred van Eeuwijk 
</p>
<p>Maintainer: Maria Xose Rodriguez-Alvarez &lt;mxrodriguez@uvigo.es&gt;
</p>


<h3>References</h3>

<p>Gilmour, A.R., Cullis, B.R., and Verbyla, A.P. (1997). Accounting for Natural and Extraneous Variation in the Analysis of Field Experiments. Journal of Agricultural, Biological, and Environmental Statistics, 2, 269 - 293.
</p>
<p>Lee, D.-J., Durban, M., and Eilers, P.H.C. (2013). Efficient two-dimensional smoothing with P-spline ANOVA mixed models and nested bases. Computational Statistics and Data Analysis, 61, 22 - 37.
</p>
<p>Rodriguez-Alvarez, M.X., Lee, D.-J., Kneib, T., Durban, M., and Eilers, P.H.C. (2015). Fast smoothing parameter separation in multidimensional generalized P-splines: the SAP algorithm. Statistics and Computing, 25, 941 - 957.
</p>
<p>Rodriguez-Alvarez, M.X, Boer, M.P., van Eeuwijk, F.A., and Eilers, P.H.C. (2018). Correcting for spatial heterogeneity in plant breeding experiments with P-splines. Spatial Statistics, 23, 52 - 71. https://doi.org/10.1016/j.spasta.2017.10.003.
</p>

<hr>
<h2 id='summary.SpATS'>
Summary method for <code>SpATS</code> objects
</h2><span id='topic+summary.SpATS'></span>

<h3>Description</h3>

<p>Default summary method for objects fitted with <code>SpATS()</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'SpATS'
summary(object, which = c("dimensions", "variances", "all"), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.SpATS_+3A_object">object</code></td>
<td>
<p>an object of class <code>SpATS</code> as produced by <code>SpATS()</code></p>
</td></tr>
<tr><td><code id="summary.SpATS_+3A_which">which</code></td>
<td>
<p>character vector indicating the information to be shown on the screen. &ldquo;dimensions&rdquo;: prints the dimensions associated to each component of the fitted model (see details), &ldquo;variances&rdquo;: prints the variance components and standard deviation (SD), the residual variance, and the ratio between the residual variance and the variance components (in log10 scale); and, &ldquo;all&rdquo;: both dimensions and variances are printed. </p>
</td></tr>
<tr><td><code id="summary.SpATS_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods. Not yet implemented.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function provides relevant information about the fitted model. The dimensions associated to each model term, as well as the variance components (jointly with the standard deviation), can be obtained. Specifically, the following information is shown:
</p>
 
<dl>
<dt>dimensions</dt><dd><p>dimensions associated to each model term (genotype, spatial, fixed and/or random):
</p>
 
<ul>
<li><p> Effective: the effective dimension or effective degrees of freedom. The concept of effective dimension is well known in the smoothing framework. However, its use has been less recognized in the mixed model framework. The effective dimension of a fitted model is defined as the trace of the so-called hat matrix (Hastie and Tibshirani, 1990). For each model term, the effective dimension is then defined as the trace of the block of the hat matrix corresponding to this term. For fixed effects, the effective dimension coincides with the model dimension (see below). For random and smooth terms, however, the effective dimension is usually lower than the model dimension. In these cases, the effective dimension or effective degrees of freedom can be interpreted as the effective number of estimated parameters. It is worth nothing that for the specification of the spatial trend using the <code><a href="#topic+SAP">SAP</a></code> function, the effective dimension associated to each spatial coordinates is shown (see Rodriguez-Alvarez et al. (2015) for details), as well as the global effective dimension (the sum of these two values). For the ANOVA-type decomposition using <code><a href="#topic+SAP">SAP</a></code>, besides the former information, the effective dimension associated to each main effect is also shown. This is in concordance with the number of smoothing parameters (or variance components in the mixed model framework), used to model the spatial trend. Accordingly, for the spatial trend specified using the function <code><a href="#topic+PSANOVA">PSANOVA</a></code>, the effective dimension of each of the five components is shown (and no global summary is reported). More information can be found in Rodriguez-Alvarez et al. (2018).  
</p>
</li>
<li><p> Model: the model dimension corresponds to the number of parameters to be estimated. For the specification of the spatial trend using the <code><a href="#topic+SpATS">SpATS</a></code> function, the model and nominal dimensions are only specified for the global term (and for the main effects when using the ANOVA-type decomposition).
</p>
</li>
<li><p> Nominal: for the random terms of the model, the nominal dimension corresponds to upper bound for the effective dimension (i.e., the maximum effective dimension a random term can achive). This nominal dimension is <code class="reqn">rank[X, Z_k] - rank[X]</code>, where <code class="reqn">Z_k</code> is the design matrix of the k-th random factor and <code class="reqn">X</code> is the design matrix of the fixed part of the model. In most cases (but not always), the nominal dimension corresponds to the model dimension minus one, &ldquo;lost&rdquo; due to the implicit constraint that ensures the mean of the random effects to be zero.
</p>
</li>
<li><p> Ratio: ratio between the effective dimension and the nominal dimension. For the genotype (when random), this ratio corresponds to the generalized heritability proposed by Oakey (2006). A deeper discussion can be found in Rodriguez - Alvarez et al. (2018) 
</p>
</li>
<li><p> Type: Model term type 'F' Fixed, 'R' Random, and 'S' Smooth (spatial trend). 
</p>
</li></ul>
</dd>
<dt>variances</dt><dd><p>variance components associated to the random terms and the smooth spatial trend, as well as the ratio between the residual variance and the variance components (in log10 scale). In the smoothing framework, this ratio corresponds to the smoothing parameter.</p>
</dd>
</dl>



<h3>Value</h3>

<p>Returns an object of class <code>summary.SpATS</code> with the same components as an <code>SpATS</code> object (see <code><a href="#topic+SpATS">SpATS</a></code>) plus:
</p>
<table>
<tr><td><code>p.table.dim</code></td>
<td>
<p>a matrix containing all the information related to the dimensions of the fitted model.</p>
</td></tr>
<tr><td><code>p.table.vc</code></td>
<td>
<p>a matrix containing all the information related to the variance components of the fitted model</p>
</td></tr>
</table>


<h3>References</h3>

<p>Hastie, T., and Tibshirani, R. (1990). Generalized Additive Models. In: Monographs on Statistics and Applied Probability, Chapman and Hall, London.
</p>
<p>Oakey, H., A. Verbyla, W. Pitchford, B. Cullis, and H. Kuchel (2006). Joint modeling of additive and non-additive genetic line effects in single field trials. Theoretical and Applied Genetics, 113, 809 - 819.
</p>
<p>Rodriguez-Alvarez, M.X, Boer, M.P., van Eeuwijk, F.A., and Eilers, P.H.C. (2018). Correcting for spatial heterogeneity in plant breeding experiments with P-splines. Spatial Statistics, 23, 52 - 71. https://doi.org/10.1016/j.spasta.2017.10.003.
</p>
<p>Rodriguez-Alvarez, M.X., Lee, D.-J., Kneib, T., Durban, M., and Eilers, P.H.C. (2015). Fast smoothing parameter separation in multidimensional generalized P-splines: the SAP algorithm. Statistics and Computing, 25, 941 - 957.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+SpATS">SpATS</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(SpATS)
data(wheatdata)
summary(wheatdata)

# Create factor variable for row and columns
wheatdata$R &lt;- as.factor(wheatdata$row)
wheatdata$C &lt;- as.factor(wheatdata$col)

m0 &lt;- SpATS(response = "yield", spatial = ~ SAP(col, row, nseg = c(10,20), degree = 3, pord = 2), 
 genotype = "geno", fixed = ~ colcode + rowcode, random = ~ R + C, data = wheatdata, 
 control =  list(tolerance = 1e-03))
# Brief summary
m0
# More information: dimensions
summary(m0) # summary(fit.m2, which = "dimensions") 
# More information: variances
summary(m0, which = "variances") 
# More information: all
summary(m0, which = "all") 
</code></pre>

<hr>
<h2 id='variogram'>
Sample variogram
</h2><span id='topic+variogram'></span><span id='topic+variogram.SpATS'></span>

<h3>Description</h3>

<p>Computes the sample variogram from an <code>SpATS</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'SpATS'
variogram(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="variogram_+3A_x">x</code></td>
<td>
<p>an object of class <code>SpATS</code> as produced by <code>SpATS()</code>.</p>
</td></tr>
<tr><td><code id="variogram_+3A_...">...</code></td>
<td>
<p>further arguments passed to or from other methods. Not yet implemented</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The present function computes the sample variogram on the basis of the (deviance) residuals of the fitted model. Currently, the function can only be applied for regular two-dimensional data, i.e, when the plots of the field are arranged in a regular two-dimensional array (usually defined by the column and row positions). 
For each pair of (deviance) residuals <code class="reqn">e_i</code> and <code class="reqn">e_j</code>, the half-squared difference is computed </p>
<p style="text-align: center;"><code class="reqn">v_{ij} = 0.5(e_i - e_j)^2,</code>
</p>
<p> as well as the corresponding column (<code class="reqn">cd_{ij}</code>) and row displacements (<code class="reqn">rd_{ij}</code>), with </p>
<p style="text-align: center;"><code class="reqn">cd_{ij} = |c_i - c_j|</code>
</p>
<p> and </p>
<p style="text-align: center;"><code class="reqn">rd_{ij} = |r_i - r_j|,</code>
</p>
<p> where <code class="reqn">c_k</code> and <code class="reqn">r_k</code> denote the column and row position of plot <code class="reqn">k</code> respectively. The sample variogram is then defined as the triplet </p>
<p style="text-align: center;"><code class="reqn">(cd_{ij}, rd_{ij}, \bar{v}_{ij}),</code>
</p>
<p> where <code class="reqn">\bar{v}_{ij}</code> denotes the average of the <code class="reqn">v_{ij}</code> that share the same column and row displacements. 
For a more detailed description, see Gilmour et al. (1997).  
</p>


<h3>Value</h3>

<p>An object of class <code>variogram.SpATS</code> with the following components:
</p>
<table>
<tr><td><code>data</code></td>
<td>
<p>data frame including the following information: &ldquo;value&rdquo;: the value of the sample variogram at each pair of column and row displacements; and &ldquo;length&rdquo;: the number of observations used to compute the sample variogram at the corresponding pair of displacements.</p>
</td></tr>
<tr><td><code>col.displacement</code></td>
<td>
<p>numerical vector containing the column displacements</p>
</td></tr>
<tr><td><code>row.displacement</code></td>
<td>
<p>numerical vector containing the row displacements</p>
</td></tr>
</table>


<h3>References</h3>

<p>Gilmour, A.R., Cullis, B.R., and Verbyla, A.P. (1997). Accounting for Natural and Extraneous Variation in the Analysis of Field Experiments. Journal of Agricultural, Biological, and Environmental Statistics, 2, 269 - 293.
</p>
<p>Stefanova, K.T., Smith, A.B. and Cullis, B.R. (2009). Enhanced Diagnostics for the Spatial Analysis of Field Trials. Journal of Agricultural, Biological, and Environmental Statistics, 14, 392 - 410.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+SpATS">SpATS</a></code>, <code><a href="#topic+plot.variogram.SpATS">plot.variogram.SpATS</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(SpATS)
data(wheatdata)
wheatdata$R &lt;- as.factor(wheatdata$row)
wheatdata$C &lt;- as.factor(wheatdata$col)

m0 &lt;- SpATS(response = "yield", spatial = ~ SAP(col, row, nseg = c(10,20), degree = 3, pord = 2), 
genotype = "geno", fixed = ~ colcode + rowcode, random = ~ R + C, data = wheatdata, 
control =  list(tolerance = 1e-03))

# Compute the variogram
var.m0 &lt;- variogram(m0)
# Plot the variogram
plot(var.m0)
</code></pre>

<hr>
<h2 id='wheatdata'>
Wheat yield in South Australia
</h2><span id='topic+wheatdata'></span>

<h3>Description</h3>

<p>A randomized complete block experiment of wheat in South Australia (Gilmour et al., 1997).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("wheatdata")</code></pre>


<h3>Format</h3>

<p>A data frame with 330 observations on the following 7 variables
</p>

<dl>
<dt><code>yield</code></dt><dd>
<p>yield, numeric</p>
</dd>
<dt><code>geno</code></dt><dd>
<p>wheat variety, a factor with 107 levels</p>
</dd>
<dt><code>rep</code></dt><dd>
<p>replicate factor, 3 levels</p>
</dd>
<dt><code>row</code></dt><dd>
<p>row position, numeric</p>
</dd>
<dt><code>col</code></dt><dd>
<p>column position, a numeric vector</p>
</dd>
<dt><code>rowcode</code></dt><dd>
<p>a factor with 2 levels. This factor is related to the way the trial and the plots were sown (see Details).</p>
</dd>
<dt><code>colcode</code></dt><dd>
<p>a factor with 3 levels. This factor is related to the way the plots were trimmed to an assumed equal length before harvest (see Details).</p>
</dd>
</dl>



<h3>Details</h3>

<p>A near complete block design experiment. In this experiment, a total of 107 varieties were sown in 3 replicates in a near complete block design (3 varieties were sown twice in each replicate). Each replicate consisted of 5 columns and 22 rows. Accordingly, the field consists on 15 columns and 22 rows (i.e. a total of 330 plots or observations). Trimming was done by spraying the wheat with herbicide. The sprayer travelled in a serpentine pattern up and down columns. More specifically, the plots were trimmed according to four possible combinations: up/down, down/down, down/up, and up/up. The <code>colcode</code> factor describe this 4-phase sequence. With respect to the way the trial was sown, the procedure was done in a serpentine manner with a planter that seeded three rows at a time (Left, Middle, Right). This fact led to a systematic effect on the yield due to sowing. The variable <code>rowcode</code> describes the position of each plot in the triplet (Left, Middle, Right). Level 1 was used for the middle plot, and 2 for those on the right or on the left of the triplet (see Gilmour et al. (1997) for more details).
</p>


<h3>Source</h3>

<p>Gilmour, A.R., Cullis, B.R., and Verbyla, A.P. (1997). Accounting for Natural and Extraneous Variation in the Analysis of Field Experiments. Journal of Agricultural, Biological, and Environmental Statistics, 2, 269 - 293.
</p>
<p>Kevin Wright (2015). agridat: Agricultural datasets. R package version 1.12. http://CRAN.R-project.org/package=agridat
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(SpATS)
data(wheatdata)
summary(wheatdata)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
