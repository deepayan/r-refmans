<!DOCTYPE html><html><head><title>Help for package transform.hazards</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {transform.hazards}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#pluginEstimate'><p>SDE plugin estimator solver</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Transforms Cumulative Hazards to Parameter Specified by ODE
System</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.1</td>
</tr>
<tr>
<td>Description:</td>
<td>Targets parameters that solve Ordinary Differential
    Equations (ODEs) driven by a vector of cumulative hazard functions.
    The package provides a method for estimating these parameters using
    an estimator defined by a corresponding Stochastic Differential Equation
    (SDE) system driven by cumulative hazard estimates. By providing cumulative
    hazard estimates as input, the package gives estimates of the parameter as
    output, along with pointwise (co)variances derived from an asymptotic
    expression. Examples of parameters that can be targeted in this way include
    the survival function, the restricted mean survival function, cumulative
    incidence functions, among others; see Ryalen, Stensrud, and Røysland (2018)
    &lt;<a href="https://doi.org/10.1093%2Fbiomet%2Fasy035">doi:10.1093/biomet/asy035</a>&gt;, and further applications in
    Stensrud, Røysland, and Ryalen (2019) &lt;<a href="https://doi.org/10.1111%2Fbiom.13102">doi:10.1111/biom.13102</a>&gt;
    and Ryalen et al. (2021) &lt;<a href="https://doi.org/10.1093%2Fbiostatistics%2Fkxab009">doi:10.1093/biostatistics/kxab009</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Suggests:</td>
<td>timereg, knitr, rmarkdown</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.1</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-06-06 09:30:43 UTC; paalcry</td>
</tr>
<tr>
<td>Author:</td>
<td>Pål Christie Ryalen
    <a href="https://orcid.org/0000-0002-3236-6782"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Pål Christie Ryalen &lt;p.c.ryalen@medisin.uio.no&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-06-06 12:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='pluginEstimate'>SDE plugin estimator solver</h2><span id='topic+pluginEstimate'></span>

<h3>Description</h3>

<p>Calculates recursive estimator for given hazard estimates, integrand function and gradients.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pluginEstimate(n, hazMatrix, F_fun, JacobianList, X0, V0, isLebesgue = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pluginEstimate_+3A_n">n</code></td>
<td>
<p>Total number of indiivduals</p>
</td></tr>
<tr><td><code id="pluginEstimate_+3A_hazmatrix">hazMatrix</code></td>
<td>
<p>Matrix consisting of hazards(rows) and their increments(columns) along the same time scale</p>
</td></tr>
<tr><td><code id="pluginEstimate_+3A_f_fun">F_fun</code></td>
<td>
<p>Integrand function F = (F_1,F_2,...) for the differential equation system</p>
</td></tr>
<tr><td><code id="pluginEstimate_+3A_jacobianlist">JacobianList</code></td>
<td>
<p>The Jacobian matrices of F_1, F_2, ... organized in a <code>list</code></p>
</td></tr>
<tr><td><code id="pluginEstimate_+3A_x0">X0</code></td>
<td>
<p>Matrix containing initial values for the parameter</p>
</td></tr>
<tr><td><code id="pluginEstimate_+3A_v0">V0</code></td>
<td>
<p>Matrix containing initial values for the variance</p>
</td></tr>
<tr><td><code id="pluginEstimate_+3A_islebesgue">isLebesgue</code></td>
<td>
<p>(Optional, to improve efficientcy) Provide the index of <code>A</code> (e.g. 2) that is a regular <code>dt</code> integral, i.e. not a cumulative hazard.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>list</code> containing the parameter estimate <code>X</code>, and its covariance estimates <code>V/n</code>
</p>


<h3>Author(s)</h3>

<p>Pål Christie Ryalen <a href="mailto:p.c.ryalen@medisin.uio.no">p.c.ryalen@medisin.uio.no</a>
</p>


<h3>References</h3>

<p>Ryalen, P.C., Stensrud, M.J., Røysland, K.: <em>Transforming cumulative hazards</em>, arXiv, to appear in Biometrika 2018.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>###############################################################
#########################  Survival  ##########################
###############################################################
library(timereg)

n &lt;- 100
dfr &lt;- data.frame(to = rexp(n,1),from=0,event=1)

fit &lt;- survfit(Surv(from,to,event==1)~1,data=dfr)

times &lt;- fit$time
dN &lt;- fit$n.event
Y &lt;- fit$n.risk
Y[1] &lt;- n

dA &lt;- matrix(dN/Y,nrow=1,ncol=length(dN))

# Function specification
F_fun_Survival &lt;- function(x)-matrix(x,1,1)
JacobianListSurvival &lt;- list(function(x)-matrix(1,1,1))
X0_Survival &lt;- matrix(1,1,1)
V0_Survival &lt;- matrix(0,1,1)

paramEst_survival &lt;- pluginEstimate(
  n,dA,F_fun_Survival,JacobianListSurvival,X0_Survival,V0_Survival
)

KM &lt;- cumprod(1 - dA)
Greenwood &lt;- KM^2 * cumsum(dA^2)

plot(
  times,paramEst_survival$X,type="s",main="SDE plugin survival estimates",
  ylab="",xlab="time"
)
lines(times,paramEst_survival$X + 1.96*sqrt(paramEst_survival$covariance[1,1,]),type="s")
lines(times,paramEst_survival$X - 1.96*sqrt(paramEst_survival$covariance[1,1,]),type="s")
lines(seq(0,10,length.out=100),exp(-seq(0,10,length.out=100)),col=2)
legend("topright",c("SDE plugin estimates","Exact"),lty=1,col=c(1,2),bty="n")

plot(
  times,paramEst_survival$covariance,type="s",
  main="SDE plugin variance vs Greenwood variance",ylab="",xlab="time"
)
lines(times,Greenwood,type="s",col=4,lty=1)
legend("topright",c("SDE plugin estimates","Greenwood"),lty=1,col=c(1,4),bty="n")

#################################################################################
############ Competing risks and Cumulative incidence(two states) ###############
#################################################################################

n &lt;- 200
x1 &lt;- rexp(n,1)
x2 &lt;- rexp(n,1.3)
to.states &lt;- ifelse(x1&lt;x2,0,1)

dfr &lt;- data.frame(from=0,to=c(x1[to.states==0],x2[to.states==1]),to.state=to.states)
dfr &lt;- dfr[order(dfr$to),]

nrisk &lt;- c(n,n:1)
dA1 &lt;- c(0,1*(dfr$to.state==0))/nrisk
dA2 &lt;- c(0,1*(dfr$to.state==1))/nrisk

hazMatrix &lt;- rbind(dA1,dA2)

F_fun_cuminc &lt;- function(X)rbind(c(X[2],0),c(-X[2],-X[2]))
JacobianList_cuminc &lt;- list( function(X)matrix(c(0,0,1,-1),nrow=2),
                             function(X)matrix(c(0,0,0,-1),nrow=2) )

X0_cuminc &lt;- matrix(c(0,1),nrow=2,ncol=1)
V0_cuminc &lt;- matrix(0,nrow=2,ncol=2)

paramEst_cuminc &lt;- pluginEstimate(n,hazMatrix,F_fun_cuminc,JacobianList_cuminc,X0_cuminc,V0_cuminc)

times &lt;- c(0,dfr$to)

plot(
  times,paramEst_cuminc$X[1,],type="s",ylab="",xlab="time",
  main="SDE plugin cumulative incidence estimate",ylim=c(0,0.7)
)
lines(times,paramEst_cuminc$X[1,] + 1.96*sqrt(paramEst_cuminc$covariance[1,1,]),type="s")
lines(times,paramEst_cuminc$X[1,] - 1.96*sqrt(paramEst_cuminc$covariance[1,1,]),type="s")
lines(seq(0,10,length.out = 1000),10/1000*cumsum(exp(-seq(0,10,length.out = 1000)*(1 + 1.3))),col=2)
legend("topright",c("SDE plugin estimates","Exact"),lty=1,col=c(1,2),bty="n")


##########################################################################################
####################  Relative survival(two different populations)  ######################
##########################################################################################

n &lt;- 300
t1 &lt;- sort(rexp(n,1))
t2 &lt;- sort(rexp(n,1.3))
times &lt;- sort(c(0,t1,t2))
nrisk &lt;- 300:1
dA1 &lt;- 1*(t1 %in% times)/nrisk
dA2 &lt;- 1*(t2 %in% times)/nrisk

tmatch1 &lt;- match(t1,times)
tmatch2 &lt;- match(t2,times)

hazMatrix &lt;- matrix(0,nrow=2,ncol=length(times))
hazMatrix[1,tmatch1] &lt;- dA1
hazMatrix[2,tmatch2] &lt;- dA2

F_fun_RelSurv &lt;- function(X)matrix(c(-X,X),ncol=2)
JacobianList_RelSurv &lt;- list(function(X)matrix(-1,nrow=1,ncol=1),
                             function(X)matrix(1,nrow=1,ncol=1))

X0_RelSurv &lt;- matrix(1,nrow=1,ncol=1)
V0_RelSurv &lt;- matrix(0,nrow=1,ncol=1)


paramEst_relsurv &lt;- pluginEstimate(
  n,hazMatrix,F_fun_RelSurv,JacobianList_RelSurv,X0_RelSurv,V0_RelSurv
)


plot(
  times,paramEst_relsurv$X[1,],type="s",ylab="",xlab="time",
  main="SDE plugin relative survival estimate",ylim=c(-1,5.8),xlim=c(0,4)
)
lines(times,paramEst_relsurv$X[1,] + 1.96*sqrt(paramEst_relsurv$covariance[1,,]),type="s")
lines(times,paramEst_relsurv$X[1,] - 1.96*sqrt(paramEst_relsurv$covariance[1,,]),type="s")
lines(seq(0,10,length.out = 100),exp(seq(0,10,length.out = 100)*(1.3-1)),col=2)
legend("topleft",c("SDE plugin estimates","Exact"),lty=1,col=c(1,2),bty="n")
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
