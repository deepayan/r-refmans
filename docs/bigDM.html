<!DOCTYPE html><html><head><title>Help for package bigDM</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {bigDM}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#bigDM-package'><p>Scalable Bayesian Disease Mapping Models for High-Dimensional Data</p></a></li>
<li><a href='#add_neighbour'><p>Add isolated areas (polygons) to its nearest neighbour</p></a></li>
<li><a href='#CAR_INLA'><p>Fit a (scalable) spatial Poisson mixed model to areal count data, where several CAR prior distributions can be specified for the spatial random effect.</p></a></li>
<li><a href='#Carto_SpainMUN'><p>Spanish colorectal cancer mortality data</p></a></li>
<li><a href='#clustering_partition'><p>Obtain a partition of the spatial domain using the density-based spatial clustering (DBSC) algorithm described in Santafé et al. (2021)</p></a></li>
<li><a href='#connect_subgraphs'><p>Merge disjoint connected subgraphs</p></a></li>
<li><a href='#Data_LungCancer'><p>Spanish lung cancer mortality data</p></a></li>
<li><a href='#Data_MultiCancer'><p>Spanish cancer mortality data for the joint analysis of multiple diseases</p></a></li>
<li><a href='#divide_carto'><p>Divide the spatial domain into subregions</p></a></li>
<li><a href='#MCAR_INLA'><p>Fit a (scalable) spatial multivariate Poisson mixed model to areal count data where dependence between spatial patterns of the diseases is addressed through the use of M-models (Botella-Rocamora et al. 2015).</p></a></li>
<li><a href='#mergeINLA'><p>Merge <code>inla</code> objects for partition models</p></a></li>
<li><a href='#Mmodel_compute_cor'><p>Compute correlation coefficients between diseases</p></a></li>
<li><a href='#Mmodel_icar'><p>Intrinsic multivariate CAR latent effect</p></a></li>
<li><a href='#Mmodel_iid'><p>Spatially non-structured multivariate latent effect</p></a></li>
<li><a href='#Mmodel_lcar'><p>Leroux et al. (1999) multivariate CAR latent effect</p></a></li>
<li><a href='#Mmodel_pcar'><p>Proper multivariate CAR latent effect</p></a></li>
<li><a href='#random_partition'><p>Define a random partition of the spatial domain based on a regular grid</p></a></li>
<li><a href='#STCAR_INLA'><p>Fit a (scalable) spatio-temporal Poisson mixed model to areal count data.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Scalable Bayesian Disease Mapping Models for High-Dimensional
Data</td>
</tr>
<tr>
<td>Version:</td>
<td>0.5.4</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-05-30</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Aritz Adin &lt;aritz.adin@unavarra.es&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Implements several spatial and spatio-temporal scalable disease mapping models for high-dimensional count data using the INLA technique for approximate Bayesian inference in latent Gaussian models (Orozco-Acosta et al., 2021 &lt;<a href="https://doi.org/10.1016%2Fj.spasta.2021.100496">doi:10.1016/j.spasta.2021.100496</a>&gt;; Orozco-Acosta et al., 2023 &lt;<a href="https://doi.org/10.1016%2Fj.cmpb.2023.107403">doi:10.1016/j.cmpb.2023.107403</a>&gt; and Vicente et al., 2023 &lt;<a href="https://doi.org/10.1007%2Fs11222-023-10263-x">doi:10.1007/s11222-023-10263-x</a>&gt;). The creation and develpment of this package has been supported by Project MTM2017-82553-R (AEI/FEDER, UE) and Project PID2020-113125RB-I00/MCIN/AEI/10.13039/501100011033. It has also been partially funded by the Public University of Navarra (project PJUPNA2001).</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/spatialstatisticsupna/bigDM">https://github.com/spatialstatisticsupna/bigDM</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/spatialstatisticsupna/bigDM/issues">https://github.com/spatialstatisticsupna/bigDM/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.0.0)</td>
</tr>
<tr>
<td>Additional_repositories:</td>
<td><a href="https://inla.r-inla-download.org/R/stable">https://inla.r-inla-download.org/R/stable</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>crayon, doParallel, fastDummies, foreach, future,
future.apply, geos, MASS, Matrix, methods, parallel,
RColorBrewer, Rdpack, sf, spatialreg, spdep, stats, utils,
rlist</td>
</tr>
<tr>
<td>Suggests:</td>
<td>bookdown, INLA (&ge; 22.12.16), knitr, rmarkdown, testthat (&ge;
3.0.0), tmap</td>
</tr>
<tr>
<td>RdMacros:</td>
<td>Rdpack</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>LazyDataCompression:</td>
<td>xz</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-05-30 09:04:23 UTC; aritz.adin</td>
</tr>
<tr>
<td>Author:</td>
<td>Aritz Adin <a href="https://orcid.org/0000-0003-3232-6147"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cre],
  Erick Orozco-Acosta
    <a href="https://orcid.org/0000-0002-1170-667X"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Maria Dolores Ugarte
    <a href="https://orcid.org/0000-0002-3505-8400"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-05-30 15:20:10 UTC</td>
</tr>
</table>
<hr>
<h2 id='bigDM-package'>Scalable Bayesian Disease Mapping Models for High-Dimensional Data</h2><span id='topic+bigDM-package'></span><span id='topic+bigDM'></span>

<h3>Description</h3>

<p>This package implements several (scalable) spatial and spatio-temporal Poisson mixed models for high-dimensional areal count data
in a fully Bayesian setting using the integrated nested Laplace approximation (INLA) technique.
</p>


<h3>Details</h3>

<p>Below, there is a list with a brief overview of all package functions:
</p>

<table>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+add_neighbour">add_neighbour</a></code></td><td style="text-align: left;"> Adds isolated areas (polygons) to its nearest neighbour </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+CAR_INLA">CAR_INLA</a></code> </td><td style="text-align: left;">  Fits several spatial CAR models for high-dimensional count data </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+clustering_partition">clustering_partition</a></code> </td><td style="text-align: left;"> Obtain a spatial partition using the DBSC algorithm </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+connect_subgraphs">connect_subgraphs</a></code> </td><td style="text-align: left;"> Merges disjoint connected subgraphs </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+divide_carto">divide_carto</a></code> </td><td style="text-align: left;"> Divides the spatial domain into subregions </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+MCAR_INLA">MCAR_INLA</a></code> </td><td style="text-align: left;">  Fits several spatial multivariate CAR models for high-dimensional count data </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+mergeINLA">mergeINLA</a></code> </td><td style="text-align: left;"> Merges <code>inla</code> objects for partition models </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+Mmodel_compute_cor">Mmodel_compute_cor</a></code> </td><td style="text-align: left;"> Computes between-diseases correlation coefficients for M-models </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+Mmodel_icar">Mmodel_icar</a></code> </td><td style="text-align: left;"> Implements the spatially non-structured multivariate latent effect </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+Mmodel_icar">Mmodel_icar</a></code> </td><td style="text-align: left;"> Implements the intrinsic multivariate CAR latent effect </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+Mmodel_lcar">Mmodel_lcar</a></code> </td><td style="text-align: left;"> Implements the Leroux et al. (1999) multivariate CAR latent effect </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+Mmodel_pcar">Mmodel_pcar</a></code> </td><td style="text-align: left;"> Implements the proper multivariate CAR latent effect </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+random_partition">random_partition</a></code> </td><td style="text-align: left;"> Defines a random partition of the spatial domain based on a regular grid </td>
</tr>
<tr>
 <td style="text-align: left;">
  <code><a href="#topic+STCAR_INLA">STCAR_INLA</a></code> </td><td style="text-align: left;"> Fits several spatio-temporal CAR models for high-dimensional count data </td>
</tr>
<tr>
 <td style="text-align: left;">
  ----------------------</td><td style="text-align: left;"> ---------------------------------------------------------------------------------- </td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Maintainer: Aritz Adin &lt;aritz.adin@unavarra.es&gt;
<br /> <br />
This work has been supported by Project MTM2017-82553-R (AEI/FEDER, UE) and Project PID2020-113125RB-I00/MCIN/AEI/10.13039/501100011033.
It has also been partially funded by the Public University of Navarra (project PJUPNA2001) and by la Caixa Foundation (ID 1000010434), Caja Navarra Foundation and UNED Pamplona, under agreement LCF/PR/PR15/51100007 (project REF P/13/20).
</p>


<h3>References</h3>

<p>Orozco-Acosta E, Adin A, Ugarte MD (2021).
&ldquo;Scalable Bayesian modeling for smoothing disease mapping risks in large spatial data sets using INLA.&rdquo;
<em>Spatial Statistics</em>, <b>41</b>, 100496.
<a href="https://doi.org/10.1016/j.spasta.2021.100496">doi:10.1016/j.spasta.2021.100496</a>.
</p>
<p>Orozco-Acosta E, Adin A, Ugarte MD (2023).
&ldquo;Big problems in spatio-temporal disease mapping: methods and software.&rdquo;
<em>Computer Methods and Programs in Biomedicine</em>, <b>231</b>, 107403.
<a href="https://doi.org/10.1016/j.cmpb.2023.107403">doi:10.1016/j.cmpb.2023.107403</a>.
</p>
<p>Vicente G, Adin A, Goicoa T, Ugarte MD (2023).
&ldquo;High-dimensional order-free multivariate spatial disease mapping.&rdquo;
<em>Statistics and Computing</em>, <b>33</b>(5), 104.
<a href="https://doi.org/10.1007/s11222-023-10263-x">doi:10.1007/s11222-023-10263-x</a>.
</p>


<h3>See Also</h3>

<p>See the following vignettes for further details and examples using this package:
</p>

<ol>
<li><p><a href="https://emi-sstcdapp.unavarra.es/bigDM/bigDM-1-fitting-spatial-models.html"><code>bigDM: fitting spatial models</code></a>
</p>
</li>
<li><p><a href="https://emi-sstcdapp.unavarra.es/bigDM/bigDM-2-parallel-and-distributed-modelling.html"><code>bigDM: parallel and distributed modelling</code></a>
</p>
</li>
<li><p><a href="https://emi-sstcdapp.unavarra.es/bigDM/bigDM-3-fitting-spatio-temporal-models.html"><code>bigDM: fitting spatio-temporal models</code></a>
</p>
</li>
<li><p><a href="https://emi-sstcdapp.unavarra.es/bigDM/bigDM-4-fitting-multivariate-spatial-models.html"><code>bigDM: fitting multivariate spatial models</code></a>
</p>
</li></ol>



<h3>Examples</h3>

<pre><code class='language-R'>## See the examples for CAR_INLA, MCAR_INLA and STCAR_INLA functions ##

</code></pre>

<hr>
<h2 id='add_neighbour'>Add isolated areas (polygons) to its nearest neighbour</h2><span id='topic+add_neighbour'></span>

<h3>Description</h3>

<p>The function returns a neighbour list of class <code>nb</code> and its associated spatial adjacency matrix
computed by adding isolated areas to its nearest neighbour (in terms of Euclidean distance between centroids) using the <code>knearneigh</code> function of 'spdep' package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_neighbour(carto, nb = NULL, plot = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="add_neighbour_+3A_carto">carto</code></td>
<td>
<p>object of class <code>SpatialPolygonsDataFrame</code> or <code>sf</code>.</p>
</td></tr>
<tr><td><code id="add_neighbour_+3A_nb">nb</code></td>
<td>
<p>optional argument with the neighbour list of class <code>nb</code>.
If <code>NULL</code> (default), this object is computed from the <code>carto</code> argument.</p>
</td></tr>
<tr><td><code id="add_neighbour_+3A_plot">plot</code></td>
<td>
<p>logical value (default <code>FALSE</code>), if <code>TRUE</code> then the computed neighbourhood graph is plotted.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>This function returns a list with the following two elements:
</p>

<ul>
<li> <p><code>nb</code>: the modified neighbours's list
</p>
</li>
<li> <p><code>W</code>: associated spatial adjacency matrix of class <code>CsparseMatrix</code>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>library(spdep)

## Load the Spanish colorectal cancer mortality data ##
data(Carto_SpainMUN)

## Compute the neighbour list from spatial polygons ##
nb_SpainMUN &lt;- poly2nb(Carto_SpainMUN)
summary(nb_SpainMUN) # 1 region with no links

## Add isolated area to its nearest neighbour ####
carto.mod &lt;- add_neighbour(carto=Carto_SpainMUN, nb=nb_SpainMUN)
summary(carto.mod$nb) # 0 region with no links

</code></pre>

<hr>
<h2 id='CAR_INLA'>Fit a (scalable) spatial Poisson mixed model to areal count data, where several CAR prior distributions can be specified for the spatial random effect.</h2><span id='topic+CAR_INLA'></span>

<h3>Description</h3>

<p>Fit a spatial Poisson mixed model to areal count data. The linear predictor is modelled as </p>
<p style="text-align: center;"><code class="reqn">\log{r_{i}}=\alpha+\mathbf{x_i}^{'}\mathbf{\beta} + \xi_i, \quad \mbox{for} \quad i=1,\ldots,n;</code>
</p>

<p>where <code class="reqn">\alpha</code> is a global intercept, <code class="reqn">\mathbf{x_i}^{'}=(x_{i1},\ldots,x_{ip})</code> is a p-vector of standardized covariates in the i-th area,
<code class="reqn">\mathbf{\beta}=(\beta_1,\ldots,\beta_p)</code> is the p-vector of fixed effects coefficients, and <code class="reqn">\xi_i</code> is a spatially structured random effect.
Several conditional autoregressive (CAR) prior distributions can be specified for the spatial random effect, such as the intrinsic CAR prior (Besag et al. 1991), the convolution or BYM prior (Besag et al. 1991),
the CAR prior proposed by Leroux et al. (1999), and the reparameterization of the BYM model given by Dean et al. (2001) named BYM2 (Riebler et al. 2016).
</p>
<p>If covariates are included in the model, two different approaches can be used to address the potential confounding issues between the fixed effects and the spatial random effects of the model: restricted regression and the use of orthogonality constraints.
At the moment, only continuous covariates can be included in the model as potential risk factors, which are automatically standardized before fitting the model. See Adin et al. (2021) for further details.
<br /><br />
Three main modelling approaches can be considered:
</p>

<ul>
<li><p> the usual model with a global spatial random effect whose dependence structure is based on the whole neighbourhood graph of the areal units (<code>model="global"</code> argument)
</p>
</li>
<li><p> a Disjoint model based on a partition of the whole spatial domain where independent spatial CAR models are simultaneously fitted in each partition (<code>model="partition"</code> and <code>k=0</code> arguments)
</p>
</li>
<li><p> a modelling approach where <em>k</em>-order neighbours are added to each partition to avoid border effects in the Disjoint model (<code>model="partition"</code> and <code>k&gt;0</code> arguments).
</p>
</li></ul>

<p>For both the Disjoint and k-order neighbour models, parallel or distributed computation strategies can be performed to speed up computations by using the 'future' package (Bengtsson 2021).
</p>
<p>Inference is conducted in a fully Bayesian setting using the integrated nested Laplace approximation (INLA; Rue et al. (2009)) technique through the R-INLA package (<a href="https://www.r-inla.org/">https://www.r-inla.org/</a>).
For the scalable model proposals (Orozco-Acosta et al. 2021), approximate values of the Deviance Information Criterion (DIC) and Watanabe-Akaike Information Criterion (WAIC) can also be computed.
</p>
<p>The function allows also to use the new hybrid approximate method that combines the Laplace method with a low-rank Variational Bayes correction to the posterior mean (van Niekerk et al. 2023) by including the <code>inla.mode="compact"</code> argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>CAR_INLA(
  carto = NULL,
  ID.area = NULL,
  ID.group = NULL,
  O = NULL,
  E = NULL,
  X = NULL,
  confounding = NULL,
  W = NULL,
  prior = "Leroux",
  model = "partition",
  k = 0,
  strategy = "simplified.laplace",
  PCpriors = FALSE,
  merge.strategy = "original",
  compute.intercept = NULL,
  compute.DIC = TRUE,
  n.sample = 1000,
  compute.fitted.values = FALSE,
  save.models = FALSE,
  plan = "sequential",
  workers = NULL,
  inla.mode = "classic",
  num.threads = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="CAR_INLA_+3A_carto">carto</code></td>
<td>
<p>object of class <code>SpatialPolygonsDataFrame</code> or <code>sf</code>.
This object must contain at least the target variables of interest specified in the arguments <code>ID.area</code>, <code>O</code> and <code>E</code>.</p>
</td></tr>
<tr><td><code id="CAR_INLA_+3A_id.area">ID.area</code></td>
<td>
<p>character; name of the variable that contains the IDs of spatial areal units.</p>
</td></tr>
<tr><td><code id="CAR_INLA_+3A_id.group">ID.group</code></td>
<td>
<p>character; name of the variable that contains the IDs of the spatial partition (grouping variable).
Only required if <code>model="partition"</code>.</p>
</td></tr>
<tr><td><code id="CAR_INLA_+3A_o">O</code></td>
<td>
<p>character; name of the variable that contains the observed number of disease cases for each areal units.</p>
</td></tr>
<tr><td><code id="CAR_INLA_+3A_e">E</code></td>
<td>
<p>character; name of the variable that contains either the expected number of disease cases or the population at risk for each areal unit.</p>
</td></tr>
<tr><td><code id="CAR_INLA_+3A_x">X</code></td>
<td>
<p>a character vector containing the names of the covariates within the <code>carto</code> object to be included in the model as fixed effects,
or a matrix object playing the role of the fixed effects design matrix. For the latter case, the row names must match with the IDs of the spatial units defined by the <code>ID.area</code> variable.
If <code>X=NULL</code> (default), only a global intercept is included in the model as fixed effect.</p>
</td></tr>
<tr><td><code id="CAR_INLA_+3A_confounding">confounding</code></td>
<td>
<p>one of either <code>NULL</code>, <code>"restricted"</code> (restricted regression) or <code>"constraints"</code> (orthogonal constraints), which specifies the estimation method used to alleviate spatial confounding between fixed and random effects.
If only an intercept is considered in the model (<code>X=NULL</code>), the default value <code>confounding=NULL</code> will be set.
At the moment, it only works for the <em>Global model</em> (specified through the <code>model="global"</code> argument).</p>
</td></tr>
<tr><td><code id="CAR_INLA_+3A_w">W</code></td>
<td>
<p>optional argument with the binary adjacency matrix of the spatial areal units.  If <code>NULL</code> (default), this object is computed from the <code>carto</code> argument (two areas are considered as neighbours if they share a common border).</p>
</td></tr>
<tr><td><code id="CAR_INLA_+3A_prior">prior</code></td>
<td>
<p>one of either <code>"Leroux"</code> (default), <code>"intrinsic"</code>, <code>"BYM"</code> or <code>"BYM2"</code>,
which specifies the prior distribution considered for the spatial random effect.</p>
</td></tr>
<tr><td><code id="CAR_INLA_+3A_model">model</code></td>
<td>
<p>one of either <code>"global"</code> or <code>"partition"</code> (default), which specifies the <em>Global model</em>
or one of the scalable model proposal's (<em>Disjoint model</em> and <em>k-order neighbourhood model</em>, respectively).</p>
</td></tr>
<tr><td><code id="CAR_INLA_+3A_k">k</code></td>
<td>
<p>numeric value with the neighbourhood order used for the partition model. Usually k=2 or 3 is enough to get good results.
If k=0 (default) the <em>Disjoint model</em> is considered. Only required if <code>model="partition"</code>.</p>
</td></tr>
<tr><td><code id="CAR_INLA_+3A_strategy">strategy</code></td>
<td>
<p>one of either <code>"gaussian"</code>, <code>"simplified.laplace"</code> (default), <code>"laplace"</code> or <code>"adaptive"</code>,
which specifies the approximation strategy considered in the <code>inla</code> function.</p>
</td></tr>
<tr><td><code id="CAR_INLA_+3A_pcpriors">PCpriors</code></td>
<td>
<p>logical value (default <code>FALSE</code>); if <code>TRUE</code> then penalised complexity (PC) priors are used for the precision parameter of the spatial random effect.
It only works if arguments <code>prior="intrinsic"</code> or <code>prior="BYM2"</code> are specified.</p>
</td></tr>
<tr><td><code id="CAR_INLA_+3A_merge.strategy">merge.strategy</code></td>
<td>
<p>one of either <code>"mixture"</code> or <code>"original"</code> (default), which specifies the merging strategy to compute posterior marginal estimates of the linear predictor. See <code><a href="#topic+mergeINLA">mergeINLA</a></code> for further details.</p>
</td></tr>
<tr><td><code id="CAR_INLA_+3A_compute.intercept">compute.intercept</code></td>
<td>
<p>CAUTION! This argument is deprecated from version 0.5.2.</p>
</td></tr>
<tr><td><code id="CAR_INLA_+3A_compute.dic">compute.DIC</code></td>
<td>
<p>logical value; if <code>TRUE</code> (default) then approximate values of the Deviance Information Criterion (DIC) and Watanabe-Akaike Information Criterion (WAIC) are computed.</p>
</td></tr>
<tr><td><code id="CAR_INLA_+3A_n.sample">n.sample</code></td>
<td>
<p>numeric; number of samples to generate from the posterior marginal distribution of the linear predictor when computing approximate DIC/WAIC values. Default to 1000.</p>
</td></tr>
<tr><td><code id="CAR_INLA_+3A_compute.fitted.values">compute.fitted.values</code></td>
<td>
<p>logical value (default <code>FALSE</code>); if <code>TRUE</code> transforms the posterior marginal distribution of the linear predictor to the exponential scale (risks or rates).</p>
</td></tr>
<tr><td><code id="CAR_INLA_+3A_save.models">save.models</code></td>
<td>
<p>logical value (default <code>FALSE</code>); if <code>TRUE</code> then a list with all the <code>inla</code> submodels is saved in '/temp/' folder, which can be used as input argument for the <code><a href="#topic+mergeINLA">mergeINLA</a></code> function.</p>
</td></tr>
<tr><td><code id="CAR_INLA_+3A_plan">plan</code></td>
<td>
<p>one of either <code>"sequential"</code> or <code>"cluster"</code>, which specifies the computation strategy used for model fitting using the 'future' package.
If <code>plan="sequential"</code> (default) the models are fitted sequentially and in the current R session (local machine). If <code>plan="cluster"</code> the models are fitted in parallel on external R sessions (local machine) or distributed in remote computing nodes.</p>
</td></tr>
<tr><td><code id="CAR_INLA_+3A_workers">workers</code></td>
<td>
<p>character or vector (default <code>NULL</code>) containing the identifications of the local or remote workers where the models are going to be processed. Only required if <code>plan="cluster"</code>.</p>
</td></tr>
<tr><td><code id="CAR_INLA_+3A_inla.mode">inla.mode</code></td>
<td>
<p>one of either <code>"classic"</code> (default) or <code>"compact"</code>, which specifies the approximation method used by INLA. See <code>help(inla)</code> for further details.</p>
</td></tr>
<tr><td><code id="CAR_INLA_+3A_num.threads">num.threads</code></td>
<td>
<p>maximum number of threads the inla-program will use. See <code>help(inla)</code> for further details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For a full model specification and further details see the vignettes accompanying this package.
</p>


<h3>Value</h3>

<p>This function returns an object of class <code>inla</code>. See the <code><a href="#topic+mergeINLA">mergeINLA</a></code> function for details.
</p>


<h3>References</h3>

<p>Adin A, Goicoa T, Hodges JS, Schnell P, Ugarte MD (2021).
&ldquo;Alleviating confounding in spatio-temporal areal models with an application on crimes against women in India.&rdquo;
<em>Statistical Modelling</em>, 1471082X211015452.
<a href="https://doi.org/10.1177/1471082X211015452">doi:10.1177/1471082X211015452</a>.
</p>
<p>Bengtsson H (2021).
&ldquo;A unifying framework for parallel and distributed processing in R using futures.&rdquo;
<em>The R Journal</em>, <b>13</b>(2), 273&ndash;291.
<a href="https://doi.org/10.32614/RJ-2021-048">doi:10.32614/RJ-2021-048</a>.
</p>
<p>Besag J, York J, Mollié A (1991).
&ldquo;Bayesian image restoration, with two applications in spatial statistics.&rdquo;
<em>Annals of the Institute of Statistical Mathematics</em>, <b>43</b>(1), 1&ndash;20.
<a href="https://doi.org/10.1007/bf00116466">doi:10.1007/bf00116466</a>.
</p>
<p>Dean CB, Ugarte MD, Militino AF (2001).
&ldquo;Detecting interaction between random region and fixed age effects in disease mapping.&rdquo;
<em>Biometrics</em>, <b>57</b>(1), 197&ndash;202.
<a href="https://doi.org/10.1111/j.0006-341x.2001.00197.x">doi:10.1111/j.0006-341x.2001.00197.x</a>.
</p>
<p>Leroux BG, Lei X, Breslow N (1999).
&ldquo;Estimation of disease rates in small areas: A new mixed model for spatial dependence.&rdquo;
In Halloran ME, Berry D (eds.), <em>Statistical Models in Epidemiology, the Environment, and Clinical Trials</em>, 179&ndash;191.
Springer-Verlag: New York.
</p>
<p>Riebler A, Sørbye SH, Simpson D, Rue H (2016).
&ldquo;An intuitive Bayesian spatial model for disease mapping that accounts for scaling.&rdquo;
<em>Statistical methods in medical research</em>, <b>25</b>(4), 1145&ndash;1165.
<a href="https://doi.org/10.1177/0962280216660421">doi:10.1177/0962280216660421</a>.
</p>
<p>Rue H, Martino S, Chopin N (2009).
&ldquo;Approximate Bayesian inference for latent Gaussian models by using integrated nested Laplace approximations.&rdquo;
<em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em>, <b>71</b>(2), 319&ndash;392.
<a href="https://doi.org/10.1111/j.1467-9868.2008.00700.x">doi:10.1111/j.1467-9868.2008.00700.x</a>.
</p>
<p>Orozco-Acosta E, Adin A, Ugarte MD (2021).
&ldquo;Scalable Bayesian modeling for smoothing disease mapping risks in large spatial data sets using INLA.&rdquo;
<em>Spatial Statistics</em>, <b>41</b>, 100496.
<a href="https://doi.org/10.1016/j.spasta.2021.100496">doi:10.1016/j.spasta.2021.100496</a>.
</p>
<p>van Niekerk J, Krainski E, Rustand D, Rue H (2023).
&ldquo;A new avenue for Bayesian inference with INLA.&rdquo;
<em>Computational Statistics &amp; Data Analysis</em>, <b>181</b>, 107692.
<a href="https://doi.org/10.1016/j.csda.2023.107692">doi:10.1016/j.csda.2023.107692</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

if(require("INLA", quietly=TRUE)){

  ## Load the Spain colorectal cancer mortality data ##
  data(Carto_SpainMUN)

  ## Global model with a Leroux CAR prior distribution ##
  Global &lt;- CAR_INLA(carto=Carto_SpainMUN, ID.area="ID", O="obs", E="exp",
                     prior="Leroux", model="global", strategy="gaussian")

  summary(Global)

  ## Disjoint model with a Leroux CAR prior distribution  ##
  ## using 4 local clusters to fit the models in parallel ##
  Disjoint &lt;- CAR_INLA(carto=Carto_SpainMUN, ID.area="ID", ID.group="region", O="obs", E="exp",
                       prior="Leroux", model="partition", k=0, strategy="gaussian",
                       plan="cluster", workers=rep("localhost",4))
  summary(Disjoint)

  ## 1st-order neighbourhood model with a Leroux CAR prior distribution ##
  ## using 4 local clusters to fit the models in parallel               ##
  order1 &lt;- CAR_INLA(carto=Carto_SpainMUN, ID.area="ID", ID.group="region", O="obs", E="exp",
                     prior="Leroux", model="partition", k=1, strategy="gaussian",
                     plan="cluster", workers=rep("localhost",4))
  summary(order1)

  ## 2nd-order neighbourhood model with a Leroux CAR prior distribution ##
  ## using 4 local clusters to fit the models in parallel               ##
  order2 &lt;- CAR_INLA(carto=Carto_SpainMUN, ID.area="ID", ID.group="region", O="obs", E="exp",
                     prior="Leroux", model="partition", k=2, strategy="gaussian",
                     plan="cluster", workers=rep("localhost",4))
  summary(order2)
}

## End(Not run)

</code></pre>

<hr>
<h2 id='Carto_SpainMUN'>Spanish colorectal cancer mortality data</h2><span id='topic+Carto_SpainMUN'></span>

<h3>Description</h3>

<p><code>sf</code> object containing the polygons of the municipalities of continental Spain
and simulated colorectal cancer mortality data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Carto_SpainMUN
</code></pre>


<h3>Format</h3>

<p>Formal class <code>sf</code>; the data contains a data.frame with 7907 rows and 9 variables.
</p>

<ul>
<li><p> ID: character vector of geographic identifiers
</p>
</li>
<li><p> name: character vector of municipality names
</p>
</li>
<li><p> area: municipality polygon areas (in square meters)
</p>
</li>
<li><p> perimeter: municipality polygon perimeters (in meters)
</p>
</li>
<li><p> obs: observed number of cases
</p>
</li>
<li><p> exp: expected number of cases
</p>
</li>
<li><p> SMR: standardized mortality ratios
</p>
</li>
<li><p> region: character vector of autonomous regions
</p>
</li>
<li><p> geometry: sfc_MULTIPOLYGON
</p>
</li></ul>


<hr>
<h2 id='clustering_partition'>Obtain a partition of the spatial domain using the density-based spatial clustering (DBSC) algorithm described in Santafé et al. (2021)</h2><span id='topic+clustering_partition'></span>

<h3>Description</h3>

<p>The function takes an object of class <code>SpatialPolygonsDataFrame</code> or <code>sf</code> and defines a spatial partition using the DBSC algorithm described in Santafé et al. (2021).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>clustering_partition(
  carto,
  ID.area = NULL,
  var = NULL,
  n.cluster = 10,
  min.size = NULL,
  W = NULL,
  l = 1,
  Wk = NULL,
  distance = "euclidean",
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="clustering_partition_+3A_carto">carto</code></td>
<td>
<p>object of class <code>SpatialPolygonsDataFrame</code> or <code>sf</code>.</p>
</td></tr>
<tr><td><code id="clustering_partition_+3A_id.area">ID.area</code></td>
<td>
<p>character; name of the variable that contains the IDs of spatial areal units.</p>
</td></tr>
<tr><td><code id="clustering_partition_+3A_var">var</code></td>
<td>
<p>character; name of the variable that contains the data of interest to compute spatial clusters, usually the vector of log-SMR.</p>
</td></tr>
<tr><td><code id="clustering_partition_+3A_n.cluster">n.cluster</code></td>
<td>
<p>numeric; value to fix the number of cluster centers in the DBSC algorithm. Default to 10.</p>
</td></tr>
<tr><td><code id="clustering_partition_+3A_min.size">min.size</code></td>
<td>
<p>numeric (default <code>NULL</code>); value to fix the minimum size of areas in each spatial partition.</p>
</td></tr>
<tr><td><code id="clustering_partition_+3A_w">W</code></td>
<td>
<p>optional argument with the binary adjacency matrix of the spatial areal units. If <code>NULL</code> (default), this object is computed from the <code>carto</code> argument (two areas are considered as neighbours if they share a common border).</p>
</td></tr>
<tr><td><code id="clustering_partition_+3A_l">l</code></td>
<td>
<p>numeric value with the neighbourhood order used to assign areas to each cluster. If <code>k=1</code> (default), only areas that share a common border are considered.</p>
</td></tr>
<tr><td><code id="clustering_partition_+3A_wk">Wk</code></td>
<td>
<p>previously computed binary adjacency matrix of l-order neighbours. If this argument is included (default <code>NULL</code>), the parameter <code>l</code> is ignored.</p>
</td></tr>
<tr><td><code id="clustering_partition_+3A_distance">distance</code></td>
<td>
<p>the distance measure to be used (default <code>"euclidean"</code>). See the <code>method</code> argument of <code><a href="stats.html#topic+dist">dist</a></code> function for other options.</p>
</td></tr>
<tr><td><code id="clustering_partition_+3A_verbose">verbose</code></td>
<td>
<p>logical value (default <code>TRUE</code>); indicates if the function runs in verbose mode.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The DBSC algorithm implemented in this function is a new spatial clustering algorithm based on the density clustering algorithm introduced by Rodriguez and Laio (2014) and the posterior modification presented by Wang and Song (2016).
This algorithm is able to obtain a single clustering partition of the data by automatically detecting clustering centers and assigning each area to its nearest cluster centroid.
The algorithm has its basis in the assumption that cluster centers are points with high local density and relatively large distance to other points with higher local densities.
See Santafé et al. (2021) for more details.
</p>


<h3>Value</h3>

<p><code>sf</code> object with the original data and a grouping variable named 'ID.group'.
</p>


<h3>References</h3>

<p>Rodriguez A, Laio A (2014).
&ldquo;Clustering by fast search and find of density peaks.&rdquo;
<em>Science</em>, <b>344</b>(6191), 1492&ndash;1496.
<a href="https://doi.org/10.1126/science.1242072">doi:10.1126/science.1242072</a>.
</p>
<p>Santafé G, Adin A, Lee D, Ugarte MD (2021).
&ldquo;Dealing with risk discontinuities to estimate cancer mortality risks when the number of small areas is large.&rdquo;
<em>Statistical Methods in Medical Research</em>, <b>30</b>(1), 6&ndash;21.
<a href="https://doi.org/10.1177/0962280220946502">doi:10.1177/0962280220946502</a>.
</p>
<p>Wang G, Song Q (2016).
&ldquo;Automatic clustering via outward statistical testing on density metrics.&rdquo;
<em>IEEE Transactions on Knowledge and Data Engineering</em>, <b>28</b>(8), 1971&ndash;1985.
<a href="https://doi.org/10.1109/TKDE.2016.2535209">doi:10.1109/TKDE.2016.2535209</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(sf)
library(tmap)

## Load the Spain colorectal cancer mortality data ##
data(Carto_SpainMUN)

## Define a spatial partition using the DBSC algorithm ##
Carto_SpainMUN$logSMR &lt;- log(Carto_SpainMUN$obs/Carto_SpainMUN$exp+0.0001)

carto.new &lt;- clustering_partition(carto=Carto_SpainMUN, ID.area="ID", var="logSMR",
                                  n.cluster=20, l=2, min.size=100, verbose=TRUE)
table(carto.new$ID.group)

## Plot of the grouping variable 'ID.group' ##
carto.data &lt;- st_set_geometry(carto.new, NULL)
carto.partition &lt;- aggregate(carto.new[,"geometry"], list(ID.group=carto.data[,"ID.group"]), head)

tm_shape(carto.new) +
        tm_polygons(col="ID.group") +
        tm_shape(carto.partition) +
        tm_borders(col="black", lwd=2) +
        tm_layout(legend.outside=TRUE)

## End(Not run)

</code></pre>

<hr>
<h2 id='connect_subgraphs'>Merge disjoint connected subgraphs</h2><span id='topic+connect_subgraphs'></span>

<h3>Description</h3>

<p>The function returns a neighbour list of class <code>nb</code> and its associated spatial adjacency matrix
computed by merging disjoint connected subgraphs through its nearest polygon centroids.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>connect_subgraphs(carto, ID.area = NULL, nb = NULL, plot = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="connect_subgraphs_+3A_carto">carto</code></td>
<td>
<p>object of class <code>SpatialPolygonsDataFrame</code> or <code>sf</code>.</p>
</td></tr>
<tr><td><code id="connect_subgraphs_+3A_id.area">ID.area</code></td>
<td>
<p>character vector of geographic identifiers.</p>
</td></tr>
<tr><td><code id="connect_subgraphs_+3A_nb">nb</code></td>
<td>
<p>optional argument with the neighbours list of class <code>nb</code>.
If <code>NULL</code> (default), this object is computed from the <code>carto</code> argument.</p>
</td></tr>
<tr><td><code id="connect_subgraphs_+3A_plot">plot</code></td>
<td>
<p>logical value (default <code>FALSE</code>), if <code>TRUE</code> then the computed neighbourhood graph is ploted.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function first calls the <code><a href="#topic+add_neighbour">add_neighbour</a></code> function to search for isolated areas.
</p>


<h3>Value</h3>

<p>This function returns a list with the following two elements:
</p>

<ul>
<li> <p><code>nb</code>: the modified neighbours list
</p>
</li>
<li> <p><code>W</code>: associated spatial adjacency matrix of class <code>CsparseMatrix</code>
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>library(spdep)

## Load the Spain colorectal cancer mortality data ##
data(Carto_SpainMUN)

## Select the polygons (municipalities) of the 'Comunidad Valenciana' region ##
carto &lt;- Carto_SpainMUN[Carto_SpainMUN$region=="Comunidad Valenciana",]

carto.nb &lt;- poly2nb(carto)
n.comp.nb(carto.nb)$nc # 2 disjoint connected subgraphs

## Plot the spatial polygons and its neighbourhood graph
op &lt;- par(mfrow=c(1,2), pty="s")

plot(carto$geometry, main="Original neighbourhood graph")
plot(carto.nb, st_centroid(st_geometry(carto), of_largest_polygon=TRUE),
     pch=19, cex=0.5, col="red", add=TRUE)

## Use the 'connect_subgraphs' function ##
carto.mod &lt;- connect_subgraphs(carto=carto, ID.area="ID", nb=carto.nb, plot=TRUE)
title(main="Modified neighbourhood graph")

n.comp.nb(carto.mod$nb)$nc==1

par(op)

</code></pre>

<hr>
<h2 id='Data_LungCancer'>Spanish lung cancer mortality data</h2><span id='topic+Data_LungCancer'></span>

<h3>Description</h3>

<p><code>data.frame</code> object containing simulated lung cancer mortality data in the 7907 municipalities of continental Spain during the period 1991-2015.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Data_LungCancer
</code></pre>


<h3>Format</h3>

<p>Formal class <code>data.frame</code> with 197.675 rows and 5 colunmns.
</p>

<ul>
<li><p> ID: character vector of geographic identifiers
</p>
</li>
<li><p> year: numeric vector of year's identifiers
</p>
</li>
<li><p> obs: observed number of cases
</p>
</li>
<li><p> exp: expected number of cases
</p>
</li>
<li><p> SMR: standardized mortality ratios
</p>
</li>
<li><p> pop: population at risk
</p>
</li></ul>


<hr>
<h2 id='Data_MultiCancer'>Spanish cancer mortality data for the joint analysis of multiple diseases</h2><span id='topic+Data_MultiCancer'></span>

<h3>Description</h3>

<p><code>data.frame</code> object containing simulated cancer mortality data for three diseases in the 7907 municipalities of continental Spain.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Data_MultiCancer
</code></pre>


<h3>Format</h3>

<p>Formal class <code>data.frame</code> with 237.271 rows and 5 colunmns.
</p>

<ul>
<li><p> ID: character vector of geographic identifiers
</p>
</li>
<li><p> disease: numeric vector of disease identifiers
</p>
</li>
<li><p> obs: observed number of cases
</p>
</li>
<li><p> exp: expected number of cases
</p>
</li>
<li><p> SMR: standardized mortality ratios
</p>
</li></ul>


<hr>
<h2 id='divide_carto'>Divide the spatial domain into subregions</h2><span id='topic+divide_carto'></span>

<h3>Description</h3>

<p>The function takes an object of class <code>SpatialPolygonsDataFrame</code> or <code>sf</code>
and divides it into subregions according to some grouping variable.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>divide_carto(carto, ID.group = NULL, k = 0, plot = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="divide_carto_+3A_carto">carto</code></td>
<td>
<p>object of class <code>SpatialPolygonsDataFrame</code> or <code>sf</code>.</p>
</td></tr>
<tr><td><code id="divide_carto_+3A_id.group">ID.group</code></td>
<td>
<p>character vector of grouping identifiers.</p>
</td></tr>
<tr><td><code id="divide_carto_+3A_k">k</code></td>
<td>
<p>numeric value with the neighbourhood order to add polygons at the border of the spatial subdomains.
If k=0 (default) a disjoint partition is defined.</p>
</td></tr>
<tr><td><code id="divide_carto_+3A_plot">plot</code></td>
<td>
<p>logical value (default <code>FALSE</code>), if <code>TRUE</code> then the spatial polygons within each subdomain are ploted.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of <code>sf</code> objects with the spatial polygons of each subdomain.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(tmap)

## Load the Spain colorectal cancer mortality data ##
data(Carto_SpainMUN)

## Plot of the grouping variable 'region' ##
tm_shape(Carto_SpainMUN) +
  tm_polygons(col="region") +
  tm_layout(legend.outside=TRUE)

## Disjoint partition ##
carto.k0 &lt;- divide_carto(carto=Carto_SpainMUN, ID.group="region", k=0)

## Partition + 1st order neighbours ##
carto.k1 &lt;- divide_carto(carto=Carto_SpainMUN, ID.group="region", k=1)

## Partition + 2nd order neighbours ##
carto.k2 &lt;- divide_carto(carto=Carto_SpainMUN, ID.group="region", k=2)

## Plot the spatial polygons for the autonomous region of Castilla y Leon ##
plot(carto.k2$`Castilla y Leon`$geometry, col="dodgerblue4", main="Castilla y Leon")
plot(carto.k1$`Castilla y Leon`$geometry, col="dodgerblue", add=TRUE)
plot(carto.k0$`Castilla y Leon`$geometry, col="lightgrey", add=TRUE)

## End(Not run)

</code></pre>

<hr>
<h2 id='MCAR_INLA'>Fit a (scalable) spatial multivariate Poisson mixed model to areal count data where dependence between spatial patterns of the diseases is addressed through the use of M-models (Botella-Rocamora et al. 2015).</h2><span id='topic+MCAR_INLA'></span>

<h3>Description</h3>

<p>Fit a spatial multivariate Poisson mixed model to areal count data. The linear predictor is modelled as </p>
<p style="text-align: center;"><code class="reqn">\log{r_{ij}}=\alpha_j + \theta_{ij}, \quad \mbox{for} \quad i=1,\ldots,n; \quad j=1,\ldots,J</code>
</p>

<p>where <code class="reqn">\alpha_j</code> is a disease-specific intercept and <code class="reqn">\theta_{ij}</code> is the spatial main effect of area <code class="reqn">i</code> for the <code class="reqn">j</code>-th disease.
Following Botella-Rocamora et al. (2015), we rearrange the spatial effects into the matrix <code class="reqn">\mathbf{\Theta} = \{ \theta_{ij}: i=1, \ldots, I; j=1, \ldots, J \}</code> whose columns are spatial random effects and its joint distribution specifies how dependence within-diseases and between-diseases is defined.
Several conditional autoregressive (CAR) prior distributions can be specified to deal with spatial dependence within-diseases, such as the intrinsic CAR prior (Besag et al. 1991), the CAR prior proposed by Leroux et al. (1999), and the proper CAR prior distribution.
<br /><br />
As in the <code><a href="#topic+CAR_INLA">CAR_INLA</a></code> function, three main modelling approaches can be considered:
</p>

<ul>
<li><p> the usual model with a global spatial random effect whose dependence structure is based on the whole neighbourhood graph of the areal units (<code>model="global"</code> argument)
</p>
</li>
<li><p> a Disjoint model based on a partition of the whole spatial domain where independent spatial CAR models are simultaneously fitted in each partition (<code>model="partition"</code> and <code>k=0</code> arguments)
</p>
</li>
<li><p> a modelling approach where <em>k</em>-order neighbours are added to each partition to avoid border effects in the Disjoint model (<code>model="partition"</code> and <code>k&gt;0</code> arguments).
</p>
</li></ul>

<p>For both the Disjoint and k-order neighbour models, parallel or distributed computation strategies can be performed to speed up computations by using the 'future' package (Bengtsson 2021).
</p>
<p>Inference is conducted in a fully Bayesian setting using the integrated nested Laplace approximation (INLA; Rue et al. (2009)) technique through the R-INLA package (<a href="https://www.r-inla.org/">https://www.r-inla.org/</a>).
For the scalable model proposals (Orozco-Acosta et al. 2021), approximate values of the Deviance Information Criterion (DIC) and Watanabe-Akaike Information Criterion (WAIC) can also be computed.
</p>
<p>The function allows also to use the new hybrid approximate method that combines the Laplace method with a low-rank Variational Bayes correction to the posterior mean (van Niekerk et al. 2023) by including the <code>inla.mode="compact"</code> argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MCAR_INLA(
  carto = NULL,
  data = NULL,
  ID.area = NULL,
  ID.disease = NULL,
  ID.group = NULL,
  O = NULL,
  E = NULL,
  W = NULL,
  prior = "intrinsic",
  model = "partition",
  k = 0,
  strategy = "simplified.laplace",
  merge.strategy = "original",
  compute.intercept = NULL,
  compute.DIC = TRUE,
  n.sample = 1000,
  compute.fitted.values = FALSE,
  save.models = FALSE,
  plan = "sequential",
  workers = NULL,
  inla.mode = "classic",
  num.threads = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="MCAR_INLA_+3A_carto">carto</code></td>
<td>
<p>object of class <code>SpatialPolygonsDataFrame</code> or <code>sf</code>. This object must contain at least the variable with the identifiers of the spatial areal units specified in the argument <code>ID.area</code>.</p>
</td></tr>
<tr><td><code id="MCAR_INLA_+3A_data">data</code></td>
<td>
<p>object of class <code>data.frame</code> that must contain the target variables of interest specified in the arguments <code>ID.area</code>, <code>ID.disease</code>, <code>O</code> and <code>E</code>.</p>
</td></tr>
<tr><td><code id="MCAR_INLA_+3A_id.area">ID.area</code></td>
<td>
<p>character; name of the variable that contains the IDs of spatial areal units. The values of this variable must match those given in the <code>carto</code> and <code>data</code> variable.</p>
</td></tr>
<tr><td><code id="MCAR_INLA_+3A_id.disease">ID.disease</code></td>
<td>
<p>character; name of the variable that contains the IDs of the diseases.</p>
</td></tr>
<tr><td><code id="MCAR_INLA_+3A_id.group">ID.group</code></td>
<td>
<p>character; name of the variable that contains the IDs of the spatial partition (grouping variable). Only required if <code>model="partition"</code>.</p>
</td></tr>
<tr><td><code id="MCAR_INLA_+3A_o">O</code></td>
<td>
<p>character; name of the variable that contains the observed number of cases for each areal unit and disease.</p>
</td></tr>
<tr><td><code id="MCAR_INLA_+3A_e">E</code></td>
<td>
<p>character; name of the variable that contains either the expected number of cases or the population at risk for each areal unit and disease.</p>
</td></tr>
<tr><td><code id="MCAR_INLA_+3A_w">W</code></td>
<td>
<p>optional argument with the binary adjacency matrix of the spatial areal units. If <code>NULL</code> (default), this object is computed from the <code>carto</code> argument (two areas are considered as neighbours if they share a common border).</p>
</td></tr>
<tr><td><code id="MCAR_INLA_+3A_prior">prior</code></td>
<td>
<p>one of either <code>"intrinsic"</code> (default), <code>"Leroux"</code>, <code>"proper"</code>, or <code>"iid"</code> which specifies the prior distribution considered for the spatial random effect.</p>
</td></tr>
<tr><td><code id="MCAR_INLA_+3A_model">model</code></td>
<td>
<p>one of either <code>"global"</code> or <code>"partition"</code> (default), which specifies the <em>Global model</em> or one of the scalable model proposal's (<em>Disjoint model</em> and <em>k-order neighbourhood model</em>, respectively).</p>
</td></tr>
<tr><td><code id="MCAR_INLA_+3A_k">k</code></td>
<td>
<p>numeric value with the neighbourhood order used for the partition model. Usually k=2 or 3 is enough to get good results. If k=0 (default) the <em>Disjoint model</em> is considered. Only required if <code>model="partition"</code>.</p>
</td></tr>
<tr><td><code id="MCAR_INLA_+3A_strategy">strategy</code></td>
<td>
<p>one of either <code>"gaussian"</code>, <code>"simplified.laplace"</code> (default), <code>"laplace"</code> or <code>"adaptive"</code>, which specifies the approximation strategy considered in the <code>inla</code> function.</p>
</td></tr>
<tr><td><code id="MCAR_INLA_+3A_merge.strategy">merge.strategy</code></td>
<td>
<p>one of either <code>"mixture"</code> or <code>"original"</code> (default), which specifies the merging strategy to compute posterior marginal estimates of relative risks. See <code><a href="#topic+mergeINLA">mergeINLA</a></code> for further details.</p>
</td></tr>
<tr><td><code id="MCAR_INLA_+3A_compute.intercept">compute.intercept</code></td>
<td>
<p>CAUTION! This argument is deprecated from version 0.5.2.</p>
</td></tr>
<tr><td><code id="MCAR_INLA_+3A_compute.dic">compute.DIC</code></td>
<td>
<p>logical value; if <code>TRUE</code> (default) then approximate values of the Deviance Information Criterion (DIC) and Watanabe-Akaike Information Criterion (WAIC) are computed.</p>
</td></tr>
<tr><td><code id="MCAR_INLA_+3A_n.sample">n.sample</code></td>
<td>
<p>numeric; number of samples to generate from the posterior marginal distribution of the linear predictor when computing approximate DIC/WAIC values. Default to 1000.</p>
</td></tr>
<tr><td><code id="MCAR_INLA_+3A_compute.fitted.values">compute.fitted.values</code></td>
<td>
<p>logical value (default <code>FALSE</code>); if <code>TRUE</code> transforms the posterior marginal distribution of the linear predictor to the exponential scale (risks or rates).</p>
</td></tr>
<tr><td><code id="MCAR_INLA_+3A_save.models">save.models</code></td>
<td>
<p>logical value (default <code>FALSE</code>); if <code>TRUE</code> then a list with all the <code>inla</code> submodels is saved in '/temp/' folder, which can be used as input argument for the <code><a href="#topic+mergeINLA">mergeINLA</a></code> function.</p>
</td></tr>
<tr><td><code id="MCAR_INLA_+3A_plan">plan</code></td>
<td>
<p>one of either <code>"sequential"</code> or <code>"cluster"</code>, which specifies the computation strategy used for model fitting using the 'future' package.
If <code>plan="sequential"</code> (default) the models are fitted sequentially and in the current R session (local machine). If <code>plan="cluster"</code> the models are fitted in parallel on external R sessions (local machine) or distributed in remote compute nodes.</p>
</td></tr>
<tr><td><code id="MCAR_INLA_+3A_workers">workers</code></td>
<td>
<p>character or vector (default <code>NULL</code>) containing the identifications of the local or remote workers where the models are going to be processed. Only required if <code>plan="cluster"</code>.</p>
</td></tr>
<tr><td><code id="MCAR_INLA_+3A_inla.mode">inla.mode</code></td>
<td>
<p>one of either <code>"classic"</code> (default) or <code>"compact"</code>, which specifies the approximation method used by INLA. See <code>help(inla)</code> for further details.</p>
</td></tr>
<tr><td><code id="MCAR_INLA_+3A_num.threads">num.threads</code></td>
<td>
<p>maximum number of threads the inla-program will use. See <code>help(inla)</code> for further details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For a full model specification and further details see the vignettes accompanying this package.
</p>


<h3>Value</h3>

<p>This function returns an object of class <code>inla</code>. See the <code><a href="#topic+mergeINLA">mergeINLA</a></code> function for details.
</p>


<h3>References</h3>

<p>Bengtsson H (2021).
&ldquo;A unifying framework for parallel and distributed processing in R using futures.&rdquo;
<em>The R Journal</em>, <b>13</b>(2), 273&ndash;291.
<a href="https://doi.org/10.32614/RJ-2021-048">doi:10.32614/RJ-2021-048</a>.
</p>
<p>Besag J, York J, Mollié A (1991).
&ldquo;Bayesian image restoration, with two applications in spatial statistics.&rdquo;
<em>Annals of the Institute of Statistical Mathematics</em>, <b>43</b>(1), 1&ndash;20.
<a href="https://doi.org/10.1007/bf00116466">doi:10.1007/bf00116466</a>.
</p>
<p>Botella-Rocamora P, Martinez-Beneito MA, Banerjee S (2015).
&ldquo;A unifying modeling framework for highly multivariate disease mapping.&rdquo;
<em>Statistics in Medicine</em>, <b>34</b>(9), 1548&ndash;1559.
<a href="https://doi.org/10.1002/sim.6423">doi:10.1002/sim.6423</a>.
</p>
<p>Leroux BG, Lei X, Breslow N (1999).
&ldquo;Estimation of disease rates in small areas: A new mixed model for spatial dependence.&rdquo;
In Halloran ME, Berry D (eds.), <em>Statistical Models in Epidemiology, the Environment, and Clinical Trials</em>, 179&ndash;191.
Springer-Verlag: New York.
</p>
<p>Rue H, Martino S, Chopin N (2009).
&ldquo;Approximate Bayesian inference for latent Gaussian models by using integrated nested Laplace approximations.&rdquo;
<em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em>, <b>71</b>(2), 319&ndash;392.
<a href="https://doi.org/10.1111/j.1467-9868.2008.00700.x">doi:10.1111/j.1467-9868.2008.00700.x</a>.
</p>
<p>Vicente G, Adin A, Goicoa T, Ugarte MD (2023).
&ldquo;High-dimensional order-free multivariate spatial disease mapping.&rdquo;
<em>Statistics and Computing</em>, <b>33</b>(5), 104.
<a href="https://doi.org/10.1007/s11222-023-10263-x">doi:10.1007/s11222-023-10263-x</a>.
</p>
<p>van Niekerk J, Krainski E, Rustand D, Rue H (2023).
&ldquo;A new avenue for Bayesian inference with INLA.&rdquo;
<em>Computational Statistics &amp; Data Analysis</em>, <b>181</b>, 107692.
<a href="https://doi.org/10.1016/j.csda.2023.107692">doi:10.1016/j.csda.2023.107692</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
if(require("INLA", quietly=TRUE)){

  ## Load the sf object that contains the spatial polygons of the municipalities of Spain ##
  data(Carto_SpainMUN)
  str(Carto_SpainMUN)

  ## Load the simulated cancer mortality data (three diseases) ##
  data(Data_MultiCancer)
  str(Data_MultiCancer)

  ## Fit the Global model with an iCAR prior for the within-disease random effects ##
  Global &lt;- MCAR_INLA(carto=Carto_SpainMUN, data=Data_MultiCancer,
                      ID.area="ID", ID.disease="disease", O="obs", E="exp",
                      prior="intrinsic", model="global", strategy="gaussian")
  summary(Global)

  ## Fit the Disjoint model with an iCAR prior for the within-disease random effects ##
  ## using 4 local clusters to fit the models in parallel                            ##
  Disjoint &lt;- MCAR_INLA(carto=Carto_SpainMUN, data=Data_MultiCancer,
                        ID.area="ID", ID.disease="disease", O="obs", E="exp", ID.group="region",
                        prior="intrinsic", model="partition", k=0, strategy="gaussian",
                        plan="cluster", workers=rep("localhost",4))
  summary(Disjoint)

  ## 1st-order neighbourhood model with an iCAR prior for the within-disease random effects ##
  ## using 4 local clusters to fit the models in parallel                                   ##
  order1 &lt;- MCAR_INLA(carto=Carto_SpainMUN, data=Data_MultiCancer,
                      ID.area="ID", ID.disease="disease", O="obs", E="exp", ID.group="region",
                      prior="intrinsic", model="partition", k=1, strategy="gaussian",
                      plan="cluster", workers=rep("localhost",4))
  summary(order1)
}

## End(Not run)

</code></pre>

<hr>
<h2 id='mergeINLA'>Merge <code>inla</code> objects for partition models</h2><span id='topic+mergeINLA'></span>

<h3>Description</h3>

<p>The function takes local models fitted for each subregion of the whole spatial domain and unifies them into a single <code>inla</code> object.
This function is valid for both disjoint and <em>k</em>-order neighbourhood models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mergeINLA(
  inla.models = list(),
  k = NULL,
  ID.area = "Area",
  ID.year = NULL,
  ID.disease = NULL,
  O = "O",
  E = "E",
  merge.strategy = "original",
  compute.DIC = TRUE,
  n.sample = 1000,
  compute.fitted.values = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mergeINLA_+3A_inla.models">inla.models</code></td>
<td>
<p>list of multiple objects of class <code>inla</code>.</p>
</td></tr>
<tr><td><code id="mergeINLA_+3A_k">k</code></td>
<td>
<p>numeric value with the neighbourhood order used for the partition model. If k=0 the <em>Disjoint model</em> is considered.</p>
</td></tr>
<tr><td><code id="mergeINLA_+3A_id.area">ID.area</code></td>
<td>
<p>character; name of the variable that contains the IDs of spatial areal units. Default to <code>"Area"</code>.</p>
</td></tr>
<tr><td><code id="mergeINLA_+3A_id.year">ID.year</code></td>
<td>
<p>character; name of the variable that contains the IDs of time points. Default to <code>"NULL"</code> (for spatial models).</p>
</td></tr>
<tr><td><code id="mergeINLA_+3A_id.disease">ID.disease</code></td>
<td>
<p>character; name of the variable that contains the IDs of the diseases. Default to <code>"NULL"</code> (only required for multivariate models).</p>
</td></tr>
<tr><td><code id="mergeINLA_+3A_o">O</code></td>
<td>
<p>character; name of the variable that contains the observed number of disease cases for each areal units. Default to <code>"O"</code>.</p>
</td></tr>
<tr><td><code id="mergeINLA_+3A_e">E</code></td>
<td>
<p>character; name of the variable that contains either the expected number of disease cases or the population at risk for each areal unit. Default to <code>"E"</code>.</p>
</td></tr>
<tr><td><code id="mergeINLA_+3A_merge.strategy">merge.strategy</code></td>
<td>
<p>one of either <code>"mixture"</code> or <code>"original"</code> (default), which specifies the merging strategy to compute posterior marginal estimates of the linear predictor (log-risks or log-rates).</p>
</td></tr>
<tr><td><code id="mergeINLA_+3A_compute.dic">compute.DIC</code></td>
<td>
<p>logical value; if <code>TRUE</code> (default) then approximate values of the Deviance Information Criterion (DIC) and Watanabe-Akaike Information Criterion (WAIC) are computed.</p>
</td></tr>
<tr><td><code id="mergeINLA_+3A_n.sample">n.sample</code></td>
<td>
<p>numeric; number of samples to generate from the posterior marginal distribution of the linear predictor when computing approximate DIC/WAIC values. Default to 1000.</p>
</td></tr>
<tr><td><code id="mergeINLA_+3A_compute.fitted.values">compute.fitted.values</code></td>
<td>
<p>logical value (default <code>FALSE</code>); if <code>TRUE</code> transforms the posterior marginal distribution of the linear predictor to the exponential scale (risks or rates). CAUTION: This method might be time consuming.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If the disjoint model is fitted (<code>k=0</code> argument), the log-risk surface is just the union of the posterior estimates of each submodel.
<br /> <br />
If the <em>k</em>-order neighbourhood model is fitted (<code>k&gt;0</code> argument), note that the final log-risk surface <code class="reqn">\log{\bf r}=(\log{r_1},\ldots,\log{r_{nT}})^{'}</code> is no longer the union of the posterior estimates obtained from each submodel.
Since multiple log-risk estimates can be obtained for some areal-time units from the different local submodel, their posterior estimates must be properly combined to obtain a single posterior distribution for each <code class="reqn">\log{r_{it}}</code>.
Two different merging strategies could be considered. If the <code>merge.strategy="mixture"</code> argument is specified, mixture distributions of the estimated posterior probability density functions with weights proportional to the conditional predictive ordinates (CPO) are computed.
If the <code>merge.strategy="original"</code> argument is specified (default option), the posterior marginal estimate ot the areal-unit corresponding to the original submodel is selected.
<br /> <br />
See Orozco-Acosta et al. (2021) and Orozco-Acosta et al. (2023) for more details.
</p>


<h3>Value</h3>

<p>This function returns an object of class <code>inla</code> containing the following elements:
</p>
<table>
<tr><td><code>summary.fixed</code></td>
<td>
<p>A data.frame containing the mean, standard deviation and quantiles of the model's fixed effects. This feature is EXPERIMENTAL for the moment.</p>
</td></tr>
<tr><td><code>marginals.fixed</code></td>
<td>
<p>A list containing the posterior marginal density of the model's fixed effects. This feature is EXPERIMENTAL for the moment.</p>
</td></tr>
<tr><td><code>summary.fixed.partition</code></td>
<td>
<p>A data.frame containing the mean, standard deviation and quantiles of the model's fixed effects in each partition.</p>
</td></tr>
<tr><td><code>marginals.fixed.partition</code></td>
<td>
<p>A list containing the posterior marginal density of the model's fixed effects in each partition.</p>
</td></tr>
<tr><td><code>summary.random</code></td>
<td>
<p>If <code>k=0</code> a list with a data.frame containing the mean, standard deviation and quantiles of the model's random effects.</p>
</td></tr>
<tr><td><code>marginals.random</code></td>
<td>
<p>If <code>k=0</code> a list containing the posterior marginal densities of the model's random effects.</p>
</td></tr>
<tr><td><code>summary.linear.predictor</code></td>
<td>
<p>If <code>k=0</code> a data.frame containing the mean, standard deviation and quantiles of the log-risks (or log-rates) in the model.</p>
</td></tr>
<tr><td><code>marginals.linear.predictor</code></td>
<td>
<p>If <code>k=0</code> a list containing the posterior marginal densities of the log-risks (or log-rates) in the model.</p>
</td></tr>
<tr><td><code>summary.fitted.values</code></td>
<td>
<p>A data.frame containing the mean, standard deviation, quantiles, mode and cdf of the risks (or rates) in the model. Available only if <code>compute.fitted.values=TRUE</code>.</p>
</td></tr>
<tr><td><code>marginals.fitted.values</code></td>
<td>
<p>A list containing the posterior marginal densities of the risks (or rates) in the model. Available only if <code>compute.fitted.values=TRUE</code>.</p>
</td></tr>
<tr><td><code>summary.cor</code></td>
<td>
<p>A data.frame containing the mean, standard deviation, quantiles and mode of the between-disease correlation coefficients. Only for the multivariate spatial models fitted using the <code><a href="#topic+MCAR_INLA">MCAR_INLA</a></code> function.</p>
</td></tr>
<tr><td><code>marginals.cor</code></td>
<td>
<p>A list containing the posterior marginal densities of the between-disease correlation coefficients. Only for the multivariate spatial models fitted using the <code><a href="#topic+MCAR_INLA">MCAR_INLA</a></code> function.</p>
</td></tr>
<tr><td><code>summary.cor.partition</code></td>
<td>
<p>A data.frame containing the mean, standard deviation, quantiles and mode of the between-disease correlation coefficients in each partition. Only for the multivariate spatial models fitted using the <code><a href="#topic+MCAR_INLA">MCAR_INLA</a></code> function.</p>
</td></tr>
<tr><td><code>marginals.cor.partition</code></td>
<td>
<p>A list containing the posterior marginal densities of the between-disease correlation coefficients in each partition. Only for the multivariate spatial models fitted using the <code><a href="#topic+MCAR_INLA">MCAR_INLA</a></code> function.</p>
</td></tr>
<tr><td><code>summary.var</code></td>
<td>
<p>A data.frame containing the mean, standard deviation, quantiles and mode of the within-disease variances for each disease. Only for the multivariate spatial models fitted using the <code><a href="#topic+MCAR_INLA">MCAR_INLA</a></code> function.</p>
</td></tr>
<tr><td><code>marginals.var</code></td>
<td>
<p>A list containing the posterior marginal densities of the within-disease variances for each disease. Only for the multivariate spatial models fitted using the <code><a href="#topic+MCAR_INLA">MCAR_INLA</a></code> function.</p>
</td></tr>
<tr><td><code>summary.var.partition</code></td>
<td>
<p>A data.frame containing the mean, standard deviation, quantiles and mode of the within-disease variances in each partition. Only for the multivariate spatial models fitted using the <code><a href="#topic+MCAR_INLA">MCAR_INLA</a></code> function.</p>
</td></tr>
<tr><td><code>marginals.var.partition</code></td>
<td>
<p>A list containing the posterior marginal densities of the within-disease variances in each partition. Only for the multivariate spatial models fitted using the <code><a href="#topic+MCAR_INLA">MCAR_INLA</a></code> function.</p>
</td></tr>
<tr><td><code>logfile</code></td>
<td>
<p>A list of the log files of each submodel.</p>
</td></tr>
<tr><td><code>version</code></td>
<td>
<p>A list containing information about the R-INLA version.</p>
</td></tr>
<tr><td><code>cpu.used</code></td>
<td>
<p>The sum of cpu times used by the <code>inla</code> function for each submodel (<code>Pre</code>, <code>Running</code> and <code>Post</code>), and the cpu time of the merging process <code>Merging</code>.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>## See the vignettes accompanying this package ##

</code></pre>

<hr>
<h2 id='Mmodel_compute_cor'>Compute correlation coefficients between diseases</h2><span id='topic+Mmodel_compute_cor'></span>

<h3>Description</h3>

<p>This function takes a <code>inla</code> object fitted using the <code><a href="#topic+MCAR_INLA">MCAR_INLA</a></code> function and computes the correlation coefficients between diseases.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Mmodel_compute_cor(model, n.sample = 10000)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Mmodel_compute_cor_+3A_model">model</code></td>
<td>
<p>object of class <code>inla</code> fitted using the <code><a href="#topic+MCAR_INLA">MCAR_INLA</a></code> function.</p>
</td></tr>
<tr><td><code id="Mmodel_compute_cor_+3A_n.sample">n.sample</code></td>
<td>
<p>numeric; number of samples to generate from the approximated joint posterior for the hyperparameters (see <code>help(inla.hyperpar.sample)</code>). Default to 1000.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The input <code>inla</code> object with two additional elements:
</p>
<table>
<tr><td><code>summary.cor</code></td>
<td>
<p>A data.frame containing the mean, standard deviation, quantiles and mode of the correlation coefficients between diseases.</p>
</td></tr>
<tr><td><code>marginals.cor</code></td>
<td>
<p>A list containing the posterior marginal densities of the correlation coefficients between diseases.</p>
</td></tr>
<tr><td><code>summary.var</code></td>
<td>
<p>A data.frame containing the mean, standard deviation, quantiles and mode of the variances for each disease.</p>
</td></tr>
<tr><td><code>marginals.var</code></td>
<td>
<p>A list containing the posterior marginal densities of the variances for each disease.</p>
</td></tr>
</table>

<hr>
<h2 id='Mmodel_icar'>Intrinsic multivariate CAR latent effect</h2><span id='topic+Mmodel_icar'></span>

<h3>Description</h3>

<p>M-model implementation of the intrinsic multivariate CAR latent effect using the <code>rgeneric</code> model of INLA.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Mmodel_icar(
  cmd = c("graph", "Q", "mu", "initial", "log.norm.const", "log.prior", "quit"),
  theta = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Mmodel_icar_+3A_cmd">cmd</code></td>
<td>
<p>Internal functions used by the <code>rgeneric</code> model to define the latent effect.</p>
</td></tr>
<tr><td><code id="Mmodel_icar_+3A_theta">theta</code></td>
<td>
<p>Vector of hyperparameters.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function considers an intrinsic CAR prior for the spatial latent effects of the different diseases and introduces correlation between them using the M-model proposal of Botella-Rocamora et al. (2015).
Putting the spatial latent effects for each disease in a matrix, the between disease dependence is introduced through the M matrix as <code class="reqn">\Theta=\Phi M</code>, where the columns of <code class="reqn">\Phi</code> follow an intrinsic CAR prior distribution (within-disease correlation).
A Wishart prior for the between covariance matrix <code class="reqn">M'M</code> is considered using the Bartlett decomposition.
<br /><br />
The following arguments are required to be defined before calling the functions:
</p>

<ul>
<li> <p><code>W</code>: binary adjacency matrix of the spatial areal units
</p>
</li>
<li> <p><code>J</code>: number of diseases
</p>
</li>
<li> <p><code>initial.values</code>: initial values defined for the cells of the M-matrix
</p>
</li></ul>



<h3>Value</h3>

<p>This is used internally by the <code>INLA::inla.rgeneric.define()</code> function.
</p>


<h3>References</h3>

<p>Botella-Rocamora P, Martinez-Beneito MA, Banerjee S (2015).
&ldquo;A unifying modeling framework for highly multivariate disease mapping.&rdquo;
<em>Statistics in Medicine</em>, <b>34</b>(9), 1548&ndash;1559.
<a href="https://doi.org/10.1002/sim.6423">doi:10.1002/sim.6423</a>.
</p>

<hr>
<h2 id='Mmodel_iid'>Spatially non-structured multivariate latent effect</h2><span id='topic+Mmodel_iid'></span>

<h3>Description</h3>

<p>M-model implementation of the spatially non-structured multivariate latent effect using the <code>rgeneric</code> model of INLA.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Mmodel_iid(
  cmd = c("graph", "Q", "mu", "initial", "log.norm.const", "log.prior", "quit"),
  theta = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Mmodel_iid_+3A_cmd">cmd</code></td>
<td>
<p>Internal functions used by the <code>rgeneric</code> model to define the latent effect.</p>
</td></tr>
<tr><td><code id="Mmodel_iid_+3A_theta">theta</code></td>
<td>
<p>Vector of hyperparameters.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function considers a spatially non-structured prior for the spatial latent effects of the different diseases and introduces correlation between them using the M-model proposal of Botella-Rocamora et al. (2015).
Putting the latent effects for each disease in a matrix, the between disease dependence is introduced through the M matrix as <code class="reqn">\Theta=\Phi M</code>, where the columns of <code class="reqn">\Phi</code> follow an IID (independent and identically distributed) prior distribution (within-disease correlation).
A Wishart prior for the between covariance matrix <code class="reqn">M'M</code> is considered using the Bartlett decomposition.
<br /><br />
The following arguments are required to be defined before calling the functions:
</p>

<ul>
<li> <p><code>W</code>: binary adjacency matrix of the spatial areal units
</p>
</li>
<li> <p><code>J</code>: number of diseases
</p>
</li>
<li> <p><code>initial.values</code>: initial values defined for the cells of the M-matrix
</p>
</li></ul>



<h3>Value</h3>

<p>This is used internally by the <code>INLA::inla.rgeneric.define()</code> function.
</p>


<h3>References</h3>

<p>Botella-Rocamora P, Martinez-Beneito MA, Banerjee S (2015).
&ldquo;A unifying modeling framework for highly multivariate disease mapping.&rdquo;
<em>Statistics in Medicine</em>, <b>34</b>(9), 1548&ndash;1559.
<a href="https://doi.org/10.1002/sim.6423">doi:10.1002/sim.6423</a>.
</p>

<hr>
<h2 id='Mmodel_lcar'>Leroux et al. (1999) multivariate CAR latent effect</h2><span id='topic+Mmodel_lcar'></span>

<h3>Description</h3>

<p>M-model implementation of the Leroux et al. (1999) multivariate CAR latent effect with different spatial smoothing parameters using the <code>rgeneric</code> model of INLA.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Mmodel_lcar(
  cmd = c("graph", "Q", "mu", "initial", "log.norm.const", "log.prior", "quit"),
  theta = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Mmodel_lcar_+3A_cmd">cmd</code></td>
<td>
<p>Internal functions used by the <code>rgeneric</code> model to define the latent effect.</p>
</td></tr>
<tr><td><code id="Mmodel_lcar_+3A_theta">theta</code></td>
<td>
<p>Vector of hyperparameters.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function considers a Leroux et al. (1999) CAR prior (denoted as LCAR) for the spatial latent effects of the different diseases and introduces correlation between them using the M-model proposal of Botella-Rocamora et al. (2015).
Putting the spatial latent effects for each disease in a matrix, the between disease dependence is introduced through the M matrix as <code class="reqn">\Theta=\Phi M</code>, where the columns of <code class="reqn">\Phi</code> follow a LCAR prior distribution (within-disease correlation).
A Wishart prior for the between covariance matrix <code class="reqn">M'M</code> is considered using the Bartlett decomposition.
Uniform prior distributions on the interval [<code>alpha.min</code>, <code>alpha.max</code>] are considered for all the spatial smoothing parameters.
<br /><br />
The following arguments are required to be defined before calling the functions:
</p>

<ul>
<li> <p><code>W</code>: binary adjacency matrix of the spatial areal units
</p>
</li>
<li> <p><code>J</code>: number of diseases
</p>
</li>
<li> <p><code>initial.values</code>: initial values defined for the cells of the M-matrix
</p>
</li>
<li> <p><code>alpha.min</code>: lower limit defined for the uniform prior distribution of the spatial smoothing parameters
</p>
</li>
<li> <p><code>alpha.max</code>: upper limit defined for the uniform prior distribution of the spatial smoothing parameters
</p>
</li></ul>



<h3>Value</h3>

<p>This is used internally by the <code>INLA::inla.rgeneric.define()</code> function.
</p>


<h3>Note</h3>

<p>The M-model implementation of this model using R-INLA requires the use of <code class="reqn">J \times (J+3)/2</code> hyperparameters. So, the results must be carefully checked.
</p>


<h3>References</h3>

<p>Botella-Rocamora P, Martinez-Beneito MA, Banerjee S (2015).
&ldquo;A unifying modeling framework for highly multivariate disease mapping.&rdquo;
<em>Statistics in Medicine</em>, <b>34</b>(9), 1548&ndash;1559.
<a href="https://doi.org/10.1002/sim.6423">doi:10.1002/sim.6423</a>.
</p>
<p>Leroux BG, Lei X, Breslow N (1999).
&ldquo;Estimation of disease rates in small areas: A new mixed model for spatial dependence.&rdquo;
In Halloran ME, Berry D (eds.), <em>Statistical Models in Epidemiology, the Environment, and Clinical Trials</em>, 179&ndash;191.
Springer-Verlag: New York.
</p>

<hr>
<h2 id='Mmodel_pcar'>Proper multivariate CAR latent effect</h2><span id='topic+Mmodel_pcar'></span>

<h3>Description</h3>

<p>M-model implementation of the proper multivariate CAR latent effect with different spatial autocorrelation parameters using the <code>rgeneric</code> model of INLA.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Mmodel_pcar(
  cmd = c("graph", "Q", "mu", "initial", "log.norm.const", "log.prior", "quit"),
  theta = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Mmodel_pcar_+3A_cmd">cmd</code></td>
<td>
<p>Internal functions used by the <code>rgeneric</code> model to define the latent effect.</p>
</td></tr>
<tr><td><code id="Mmodel_pcar_+3A_theta">theta</code></td>
<td>
<p>Vector of hyperparameters.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function considers a proper CAR prior (denoted as pCAR) for the spatial latent effects of the different diseases and introduces correlation between them using the M-model proposal of Botella-Rocamora et al. (2015).
Putting the spatial latent effects for each disease in a matrix, the between disease dependence is introduced through the M matrix as <code class="reqn">\Theta=\Phi M</code>, where the columns of <code class="reqn">\Phi</code> follow a pCAR prior distribution (within-disease correlation).
A Wishart prior for the between covariance matrix <code class="reqn">M'M</code> is considered using the Bartlett decomposition.
Uniform prior distributions on the interval [<code>alpha.min</code>, <code>alpha.max</code>] are considered for all the spatial autocorrelation parameters.
<br /><br />
The following arguments are required to be defined before calling the functions:
</p>

<ul>
<li> <p><code>W</code>: binary adjacency matrix of the spatial areal units
</p>
</li>
<li> <p><code>J</code>: number of diseases
</p>
</li>
<li> <p><code>initial.values</code>: initial values defined for the cells of the M-matrix
</p>
</li>
<li> <p><code>alpha.min</code>: lower limit defined for the uniform prior distribution of the spatial smoothing parameters
</p>
</li>
<li> <p><code>alpha.max</code>: upper limit defined for the uniform prior distribution of the spatial smoothing parameters
</p>
</li></ul>



<h3>Value</h3>

<p>This is used internally by the <code>INLA::inla.rgeneric.define()</code> function.
</p>


<h3>Note</h3>

<p>The M-model implementation of this model using R-INLA requires the use of <code class="reqn">J \times (J+3)/2</code> hyperparameters. So, the results must be carefully checked.
</p>


<h3>References</h3>

<p>Botella-Rocamora P, Martinez-Beneito MA, Banerjee S (2015).
&ldquo;A unifying modeling framework for highly multivariate disease mapping.&rdquo;
<em>Statistics in Medicine</em>, <b>34</b>(9), 1548&ndash;1559.
<a href="https://doi.org/10.1002/sim.6423">doi:10.1002/sim.6423</a>.
</p>

<hr>
<h2 id='random_partition'>Define a random partition of the spatial domain based on a regular grid</h2><span id='topic+random_partition'></span>

<h3>Description</h3>

<p>The function takes an object of class <code>SpatialPolygonsDataFrame</code> or <code>sf</code> and
defines a random partition of the spatial polygons based on a regular grid over the whole domain
using the <code>st_make_grid</code> function of the <code>sf</code> package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>random_partition(
  carto,
  rows = 3,
  columns = 3,
  min.size = 50,
  max.size = 1000,
  prop.zero = NULL,
  O = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="random_partition_+3A_carto">carto</code></td>
<td>
<p>object of class <code>SpatialPolygonsDataFrame</code> or <code>sf</code>.</p>
</td></tr>
<tr><td><code id="random_partition_+3A_rows">rows</code></td>
<td>
<p>integer; number of rows to define the regular grid. Default to 3.</p>
</td></tr>
<tr><td><code id="random_partition_+3A_columns">columns</code></td>
<td>
<p>integer; number of columns to define the regular grid. Default to 3.</p>
</td></tr>
<tr><td><code id="random_partition_+3A_min.size">min.size</code></td>
<td>
<p>numeric; value to fix the minimum number of areas in each spatial partition (if <code>NULL</code>, this step is skipped). Default to 50.</p>
</td></tr>
<tr><td><code id="random_partition_+3A_max.size">max.size</code></td>
<td>
<p>numeric; value to fix the maximum number of areas in each spatial partition (if <code>NULL</code>, this step is skipped). Default to 600.</p>
</td></tr>
<tr><td><code id="random_partition_+3A_prop.zero">prop.zero</code></td>
<td>
<p>numeric; value between 0 and 1 that indicates the maximum proportion of areas with no cases for each spatial partition.</p>
</td></tr>
<tr><td><code id="random_partition_+3A_o">O</code></td>
<td>
<p>character; name of the variable that contains the observed number of disease cases for each areal units. Only required if <code>prop.zero</code> argument is set.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>After defining a random partition of the spatial polygons based on a regular grid, the subregions with number of areas smaller than the value given by the <code>min.size</code> are merged to its nearest neighbour.
Then, the subregions with number of areas greater than the value given by the <code>max.size</code> argument are divided.
Finally, if <code>prop.zero</code> argument is set, the subregions with proportion of areas with zero cases below that threshold are merged to its smallest neighbour.
</p>


<h3>Value</h3>

<p><code>sf</code> object with the original data and a grouping variable named 'ID.group'
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(tmap)

## Load the Spain colorectal cancer mortality data ##
data(Carto_SpainMUN)

## Random partition based on a 3x3 regular grid (with no size restrictions) ##
carto.r1 &lt;- random_partition(carto=Carto_SpainMUN, rows=3, columns=3,
                             min.size=NULL, max.size=NULL)
table(carto.r1$ID.group)

part1 &lt;- aggregate(carto.r1[,"geometry"], by=list(ID.group=carto.r1$ID.group), head)

tm_shape(carto.r1) +
  tm_polygons(col="ID.group") +
  tm_shape(part1) + tm_borders(col="black", lwd=2) +
  tm_layout(main.title="3x3 regular grid (with no size restrictions)",
            main.title.position="center", main.title.size=1,
            legend.outside=TRUE)


## Random partition based on a 6x4 regular grid (with size restrictions) ##
carto.r2 &lt;- random_partition(carto=Carto_SpainMUN, rows=6, columns=4,
                             min.size=50, max.size=600)
table(carto.r2$ID.group)

part2 &lt;- aggregate(carto.r2[,"geometry"], by=list(ID.group=carto.r2$ID.group), head)

tm_shape(carto.r2) +
  tm_polygons(col="ID.group") +
  tm_shape(part2) + tm_borders(col="black", lwd=2) +
  tm_layout(main.title="6x4 regular grid (min.size=50, max.size=600)",
            main.title.position="center", main.title.size=1,
            legend.outside=TRUE)


## Random partition based on a 6x4 regular grid (with size and proportion of zero restrictions) ##
carto.r3 &lt;- random_partition(carto=Carto_SpainMUN, rows=6, columns=4,
                             min.size=50, max.size=600, prop.zero=0.5, O="obs")
table(carto.r3$ID.group)

part3 &lt;- aggregate(carto.r3[,"geometry"], by=list(ID.group=carto.r3$ID.group), head)

tm_shape(carto.r3) +
  tm_polygons(col="ID.group") +
  tm_shape(part3) + tm_borders(col="black", lwd=2) +
  tm_layout(main.title="6x4 regular grid (min.size=50, max.size=600, prop.zero=0.5)",
            main.title.position="center", main.title.size=1,
            legend.outside=TRUE)

## End(Not run)

</code></pre>

<hr>
<h2 id='STCAR_INLA'>Fit a (scalable) spatio-temporal Poisson mixed model to areal count data.</h2><span id='topic+STCAR_INLA'></span>

<h3>Description</h3>

<p>Fit a spatio-temporal Poisson mixed model to areal count data, where several CAR prior distributions for the spatial random effects, first and second order random walk priors for the temporal random effects, and different types of spatio-temporal interactions described in Knorr-Held (2000) can be specified.
The linear predictor is modelled as </p>
<p style="text-align: center;"><code class="reqn">\log{r_{it}}=\alpha + \mathbf{x_{it}}^{'}\mathbf{\beta} + \xi_i+\gamma_t+\delta_{it}, \quad \mbox{for} \quad i=1,\ldots,n; \quad t=1,\ldots,T</code>
</p>

<p>where <code class="reqn">\alpha</code> is a global intercept, <code class="reqn">\mathbf{x_{it}}^{'}=(x_{it1},\ldots,x_{itp})</code> is a p-vector of standardized covariates in the i-th area and time period t, <code class="reqn">\mathbf{\beta}=(\beta_1,\ldots,\beta_p)</code> is the p-vector of fixed effects coefficients,
<code class="reqn">\xi_i</code> is a spatially structured random effect, <code class="reqn">\gamma_t</code> is a temporally structured random effect, and <code class="reqn">\delta_{it}</code> is the space-time interaction effect. If the interaction term is dropped, an additive model is obtained.
To ensure model identifiability, sum-to-zero constraints are imposed over the random effects of the model. Details on the derivation of these constraints can be found in Goicoa et al. (2018).
<br /><br />
As in the <code><a href="#topic+CAR_INLA">CAR_INLA</a></code> function, three main modelling approaches can be considered:
</p>

<ul>
<li><p> the usual model with a global spatial random effect whose dependence structure is based on the whole neighbourhood graph of the areal units (<code>model="global"</code> argument)
</p>
</li>
<li><p> a Disjoint model based on a partition of the whole spatial domain where independent spatial CAR models are simultaneously fitted in each partition (<code>model="partition"</code> and <code>k=0</code> arguments)
</p>
</li>
<li><p> a modelling approach where <em>k</em>-order neighbours are added to each partition to avoid border effects in the Disjoint model (<code>model="partition"</code> and <code>k&gt;0</code> arguments).
</p>
</li></ul>

<p>For both the Disjoint and k-order neighbour models, parallel or distributed computation strategies can be performed to speed up computations by using the 'future' package (Bengtsson 2021).
</p>
<p>Inference is conducted in a fully Bayesian setting using the integrated nested Laplace approximation (INLA; Rue et al. (2009)) technique through the R-INLA package (<a href="https://www.r-inla.org/">https://www.r-inla.org/</a>).
For the scalable model proposals (Orozco-Acosta et al. 2023), approximate values of the Deviance Information Criterion (DIC) and Watanabe-Akaike Information Criterion (WAIC) can also be computed.
</p>
<p>The function allows also to use the new hybrid approximate method that combines the Laplace method with a low-rank Variational Bayes correction to the posterior mean (van Niekerk et al. 2023) by including the <code>inla.mode="compact"</code> argument.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>STCAR_INLA(
  carto = NULL,
  data = NULL,
  ID.area = NULL,
  ID.year = NULL,
  ID.group = NULL,
  O = NULL,
  E = NULL,
  X = NULL,
  W = NULL,
  spatial = "Leroux",
  temporal = "rw1",
  interaction = "TypeIV",
  model = "partition",
  k = 0,
  strategy = "simplified.laplace",
  scale.model = NULL,
  PCpriors = FALSE,
  merge.strategy = "original",
  compute.intercept = NULL,
  compute.DIC = TRUE,
  n.sample = 1000,
  compute.fitted.values = FALSE,
  save.models = FALSE,
  plan = "sequential",
  workers = NULL,
  inla.mode = "classic",
  num.threads = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="STCAR_INLA_+3A_carto">carto</code></td>
<td>
<p>object of class <code>SpatialPolygonsDataFrame</code> or <code>sf</code>. This object must contain at least the variable with the identifiers of the spatial areal units specified in the argument <code>ID.area</code>.</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_data">data</code></td>
<td>
<p>object of class <code>data.frame</code> that must contain the target variables of interest specified in the arguments <code>ID.area</code>, <code>ID.year</code>, <code>O</code> and <code>E</code>.</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_id.area">ID.area</code></td>
<td>
<p>character; name of the variable that contains the IDs of spatial areal units. The values of this variable must match those given in the <code>carto</code> and <code>data</code> variable.</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_id.year">ID.year</code></td>
<td>
<p>character; name of the variable that contains the IDs of time points.</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_id.group">ID.group</code></td>
<td>
<p>character; name of the variable that contains the IDs of the spatial partition (grouping variable). Only required if <code>model="partition"</code>.</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_o">O</code></td>
<td>
<p>character; name of the variable that contains the observed number of disease cases for each areal and time point.</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_e">E</code></td>
<td>
<p>character; name of the variable that contains either the expected number of disease cases or the population at risk for each areal unit and time point.</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_x">X</code></td>
<td>
<p>a character vector containing the names of the covariates within the <code>data</code> object to be included in the model as fixed effects, or a matrix object playing the role of the fixed effects design matrix.
If <code>X=NULL</code> (default), only a global intercept is included in the model as fixed effect.</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_w">W</code></td>
<td>
<p>optional argument with the binary adjacency matrix of the spatial areal units. If <code>NULL</code> (default), this object is computed from the <code>carto</code> argument (two areas are considered as neighbours if they share a common border).</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_spatial">spatial</code></td>
<td>
<p>one of either <code>"Leroux"</code> (default), <code>"intrinsic"</code>, <code>"BYM"</code> or <code>"BYM2"</code>, which specifies the prior distribution considered for the spatial random effect.</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_temporal">temporal</code></td>
<td>
<p>one of either <code>"rw1"</code> (default) or <code>"rw2"</code>, which specifies the prior distribution considered for the temporal random effect.</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_interaction">interaction</code></td>
<td>
<p>one of either <code>"none"</code>, <code>"TypeI"</code>, <code>"TypeII"</code>, <code>"TypeIII"</code> or <code>"TypeIV"</code> (default), which specifies the prior distribution for the space-time interaction random effect.</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_model">model</code></td>
<td>
<p>one of either <code>"global"</code> or <code>"partition"</code> (default), which specifies the <em>Global model</em> or one of the scalable model proposal's (<em>Disjoint model</em> and <em>k-order neighbourhood model</em>, respectively).</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_k">k</code></td>
<td>
<p>numeric value with the neighbourhood order used for the partition model. Usually k=2 or 3 is enough to get good results. If k=0 (default) the <em>Disjoint model</em> is considered. Only required if <code>model="partition"</code>.</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_strategy">strategy</code></td>
<td>
<p>one of either <code>"gaussian"</code>, <code>"simplified.laplace"</code> (default), <code>"laplace"</code> or <code>"adaptive"</code>, which specifies the approximation strategy considered in the <code>inla</code> function.</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_scale.model">scale.model</code></td>
<td>
<p>logical value (default <code>NULL</code>); if <code>TRUE</code> the structure matrices of the model are scaled so their generalized variances are equal to 1.
It only works if arguments <code>spatial="intrinsic"</code> or <code>spatial="BYM2"</code> are specified.</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_pcpriors">PCpriors</code></td>
<td>
<p>logical value (default <code>FALSE</code>); if <code>TRUE</code> then penalised complexity (PC) priors are used for the precision parameter of the spatial random effect.
It only works if arguments <code>spatial="intrinsic"</code> or <code>spatial="BYM2"</code> are specified.</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_merge.strategy">merge.strategy</code></td>
<td>
<p>one of either <code>"mixture"</code> or <code>"original"</code> (default), which specifies the merging strategy to compute posterior marginal estimates of the linear predictor. See <code><a href="#topic+mergeINLA">mergeINLA</a></code> for further details.</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_compute.intercept">compute.intercept</code></td>
<td>
<p>CAUTION! This argument is deprecated from version 0.5.2.</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_compute.dic">compute.DIC</code></td>
<td>
<p>logical value; if <code>TRUE</code> (default) then approximate values of the Deviance Information Criterion (DIC) and Watanabe-Akaike Information Criterion (WAIC) are computed.</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_n.sample">n.sample</code></td>
<td>
<p>numeric; number of samples to generate from the posterior marginal distribution of the linear predictor when computing approximate DIC/WAIC values. Default to 1000.</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_compute.fitted.values">compute.fitted.values</code></td>
<td>
<p>logical value (default <code>FALSE</code>); if <code>TRUE</code> transforms the posterior marginal distribution of the linear predictor to the exponential scale (risks or rates). CAUTION: This method might be time consuming.</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_save.models">save.models</code></td>
<td>
<p>logical value (default <code>FALSE</code>); if <code>TRUE</code> then a list with all the <code>inla</code> submodels is saved in '/temp/' folder, which can be used as input argument for the <code><a href="#topic+mergeINLA">mergeINLA</a></code> function.</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_plan">plan</code></td>
<td>
<p>one of either <code>"sequential"</code> or <code>"cluster"</code>, which specifies the computation strategy used for model fitting using the 'future' package.
If <code>plan="sequential"</code> (default) the models are fitted sequentially and in the current R session (local machine). If <code>plan="cluster"</code> the models are fitted in parallel on external R sessions (local machine) or distributed in remote computing nodes.</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_workers">workers</code></td>
<td>
<p>character or vector (default <code>NULL</code>) containing the identifications of the local or remote workers where the models are going to be processed. Only required if <code>plan="cluster"</code>.</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_inla.mode">inla.mode</code></td>
<td>
<p>one of either <code>"classic"</code> (default) or <code>"compact"</code>, which specifies the approximation method used by INLA. See <code>help(inla)</code> for further details.</p>
</td></tr>
<tr><td><code id="STCAR_INLA_+3A_num.threads">num.threads</code></td>
<td>
<p>maximum number of threads the inla-program will use. See <code>help(inla)</code> for further details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For a full model specification and further details see the vignettes accompanying this package.
</p>


<h3>Value</h3>

<p>This function returns an object of class <code>inla</code>. See the <code><a href="#topic+mergeINLA">mergeINLA</a></code> function for details.
</p>


<h3>References</h3>

<p>Goicoa T, Adin A, Ugarte MD, Hodges JS (2018).
&ldquo;In spatio-temporal disease mapping models, identifiability constraints affect PQL and INLA results.&rdquo;
<em>Stochastic Environmental Research and Risk Assessment</em>, <b>32</b>(3), 749&ndash;770.
<a href="https://doi.org/10.1007/s00477-017-1405-0">doi:10.1007/s00477-017-1405-0</a>.
</p>
<p>Knorr-Held L (2000).
&ldquo;Bayesian modelling of inseparable space-time variation in disease risk.&rdquo;
<em>Statistics in Medicine</em>, <b>19</b>(17-18), 2555&ndash;2567.
</p>
<p>Orozco-Acosta E, Adin A, Ugarte MD (2021).
&ldquo;Scalable Bayesian modeling for smoothing disease mapping risks in large spatial data sets using INLA.&rdquo;
<em>Spatial Statistics</em>, <b>41</b>, 100496.
<a href="https://doi.org/10.1016/j.spasta.2021.100496">doi:10.1016/j.spasta.2021.100496</a>.
</p>
<p>Orozco-Acosta E, Adin A, Ugarte MD (2023).
&ldquo;Big problems in spatio-temporal disease mapping: methods and software.&rdquo;
<em>Computer Methods and Programs in Biomedicine</em>, <b>231</b>, 107403.
<a href="https://doi.org/10.1016/j.cmpb.2023.107403">doi:10.1016/j.cmpb.2023.107403</a>.
</p>
<p>van Niekerk J, Krainski E, Rustand D, Rue H (2023).
&ldquo;A new avenue for Bayesian inference with INLA.&rdquo;
<em>Computational Statistics &amp; Data Analysis</em>, <b>181</b>, 107692.
<a href="https://doi.org/10.1016/j.csda.2023.107692">doi:10.1016/j.csda.2023.107692</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
if(require("INLA", quietly=TRUE)){

  ## Load the sf object that contains the spatial polygons of the municipalities of Spain ##
  data(Carto_SpainMUN)
  str(Carto_SpainMUN)

  ## Create province IDs ##
  Carto_SpainMUN$ID.prov &lt;- substr(Carto_SpainMUN$ID,1,2)

  ## Load simulated data of lung cancer mortality data during the period 1991-2015 ##
  data("Data_LungCancer")
  str(Data_LungCancer)

  ## Disjoint model with a BYM2 spatial random effect, RW1 temporal random effect and      ##
  ## Type I interaction random effect using 4 local clusters to fit the models in parallel ##
  Disjoint &lt;- STCAR_INLA(carto=Carto_SpainMUN, data=Data_LungCancer,
                         ID.area="ID", ID.year="year", O="obs", E="exp", ID.group="ID.prov",
                         spatial="BYM2", temporal="rw1", interaction="TypeI",
                         model="partition", k=0, strategy="gaussian",
                         plan="cluster", workers=rep("localhost",4))
  summary(Disjoint)

  ## 1st-order nb. model with a BYM2 spatial random effect, RW1 temporal random effect and ##
  ## Type I interaction random effect using 4 local clusters to fit the models in parallel ##
  order1 &lt;- STCAR_INLA(carto=Carto_SpainMUN, data=Data_LungCancer,
                       ID.area="ID", ID.year="year", O="obs", E="exp", ID.group="ID.prov",
                       spatial="BYM2", temporal="rw1", interaction="TypeI",
                       model="partition", k=1, strategy="gaussian",
                       plan="cluster", workers=rep("localhost",4))
  summary(order1)
}

## End(Not run)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
