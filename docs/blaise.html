<!DOCTYPE html><html><head><title>Help for package blaise</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {blaise}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#read_fwf_blaise'><p>Read a fixed width datafile using a blaise datamodel</p></a></li>
<li><a href='#write_fwf_blaise'><p>Write a fixed width ascii datafile and accompanying blaise datamodel</p></a></li>
<li><a href='#write_fwf_blaise_with_model'><p>Write a fixed width ascii datafile based on a given blaise datamodel</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Read and Write FWF Files in the 'Blaise' Format</td>
</tr>
<tr>
<td>Version:</td>
<td>1.3.11</td>
</tr>
<tr>
<td>Description:</td>
<td>Can be used to read and write a fwf with an accompanying 'Blaise' datamodel.
    Blaise is the software suite built by Statistics Netherlands (CBS). It is essentially a 
    way to write and collect surveys and perform statistical analysis on the data. It stores its data in 
    fixed width format with an accompanying metadata file, this is the Blaise format. The package automatically 
    interprets this metadata and reads the file into an R dataframe.
    When supplying a datamodel for writing, the dataframe will be automatically converted 
    to that format and checked for compatibility.
    Supports dataframes, tibbles and LaF objects.
    For more information about 'Blaise', see <a href="https://blaise.com/products/general-information">https://blaise.com/products/general-information</a>. </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr (&ge; 0.7.2), readr (&ge; 1.1.1), stringr (&ge; 1.2.0), utils
(&ge; 3.4.1), tibble (&ge; 1.3.3), tools (&ge; 3.4.1), methods (&ge;
3.4.1), stats (&ge; 3.4.1)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat, LaF (&ge; 0.6.3), knitr, rmarkdown</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Collate:</td>
<td>'clean_model.R' 'generics.R' 'utils.R' 'variable.R' 'model.R'
'convert_df.R' 'convert_type.R' 'get_model.R'
'read_custom_types.R' 'read_data.R' 'read_data_laf.R'
'read_fwf_blaise.R' 'read_model.R' 'variable_custom.R'
'variable_date.R' 'variable_dummy.R' 'variable_enum.R'
'variable_integer.R' 'variable_real.R' 'variable_string.R'
'write_data.R' 'write_datamodel.R' 'write_fwf_blaise.R'
'write_fwf_blaise_with_model.R'</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-12-08 10:40:26 UTC; rstudio</td>
</tr>
<tr>
<td>Author:</td>
<td>Sjoerd Ophof [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Sjoerd Ophof &lt;sjoerd.ophof@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-12-08 11:00:09 UTC</td>
</tr>
</table>
<hr>
<h2 id='read_fwf_blaise'>Read a fixed width datafile using a blaise datamodel</h2><span id='topic+read_fwf_blaise'></span>

<h3>Description</h3>

<p>Use this function to read a fwf that is described by a blaise datamodel.
If this function throws a warning, try using readr::problems() on the result,
this will for instance show an error in the used locale.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_fwf_blaise(
  datafile,
  modelfile,
  locale = readr::locale(),
  numbered_enum = TRUE,
  output = "data.frame"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="read_fwf_blaise_+3A_datafile">datafile</code></td>
<td>
<p>the fwf file containing the data</p>
</td></tr>
<tr><td><code id="read_fwf_blaise_+3A_modelfile">modelfile</code></td>
<td>
<p>the datamodel describing the data</p>
</td></tr>
<tr><td><code id="read_fwf_blaise_+3A_locale">locale</code></td>
<td>
<p>locale as specified with readr::locale(). Uses &quot;.&quot; as default
decimal separator. Can be used to change decimal separator, date_format, timezone, encoding, etc.</p>
</td></tr>
<tr><td><code id="read_fwf_blaise_+3A_numbered_enum">numbered_enum</code></td>
<td>
<p>use actual labels instead of numbers for enums that use non-
standard numbering in the datamodel. With the default (TRUE) (Male (1), Female (2), Unknown (9))
will be read as a factor with labels (1, 2, 9). With FALSE it will be read as a factor
(Male, Female, Unknown). beware that writing a dataframe read with FALSE will result in an
enum with levels (1, 2, 3) unless overruled by an existing model, since R does not support
custom numbering for factors.</p>
</td></tr>
<tr><td><code id="read_fwf_blaise_+3A_output">output</code></td>
<td>
<p>Define which output to use. Either &quot;data.frame&quot; (default) or &quot;LaF&quot;. LaF does not support
Datetypes, so these are converted to character vectors. Using LaF, DUMMY variables also can't
be ignored, these are read as empty character vectors. Using LaF basically takes over
the parsing of the datamodel from LaF, since this is more robust and accepts more types of input.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Handles the following types:
</p>

<ul>
<li><p> STRING
</p>
</li>
<li><p> INTEGER
</p>
</li>
<li><p> REAL
</p>
</li>
<li><p> DATETYPE
</p>
</li>
<li><p> ENUM (if numbered it will be converted to a factor with the numbers as labels)
</p>
</li>
<li><p> custom types (same as a numbered ENUM)
</p>
</li></ul>

<p>If you want the numbered enums to be converted to their labels, this is possible
by changing the &quot;numbered_enum&quot; parameter
</p>


<h3>Examples</h3>

<pre><code class='language-R'>model = "
DATAMODEL Test
FIELDS
A     : STRING[1]
B     : INTEGER[1]
C     : REAL[3,1]
D     : REAL[3]
E     : (Male, Female)
F     : 1..20
G     : 1.00..100.00
ENDMODEL
"
data =
"A12.3.121 1  1.00
B23.41.2210 20.20
C34.512.120100.00"

blafile = tempfile('testbla', fileext = '.bla')
writeLines(model, con = blafile)
datafile = tempfile('testdata', fileext = '.asc')
writeLines(data, con = datafile)

df = read_fwf_blaise(datafile, blafile)
unlink(blafile)
unlink(datafile)

</code></pre>

<hr>
<h2 id='write_fwf_blaise'>Write a fixed width ascii datafile and accompanying blaise datamodel</h2><span id='topic+write_fwf_blaise'></span>

<h3>Description</h3>

<p>Write a datafile in the blaise format (fwf ascii without separators)
will always write out a blaise datamodel describing the datafile as well
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_fwf_blaise(
  df,
  output_data,
  output_model = NULL,
  decimal.mark = ".",
  digits = getOption("digits"),
  justify = "right",
  write_model = TRUE,
  model_name = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="write_fwf_blaise_+3A_df">df</code></td>
<td>
<p>dataframe to write</p>
</td></tr>
<tr><td><code id="write_fwf_blaise_+3A_output_data">output_data</code></td>
<td>
<p>path and name to output datafile. Will add .asc if no extension</p>
</td></tr>
<tr><td><code id="write_fwf_blaise_+3A_output_model">output_model</code></td>
<td>
<p>path and name to output datamodel. If NULL will use the
same name as output_data with .bla extension.</p>
</td></tr>
<tr><td><code id="write_fwf_blaise_+3A_decimal.mark">decimal.mark</code></td>
<td>
<p>decimal mark to use. Default is &quot;.&quot;.</p>
</td></tr>
<tr><td><code id="write_fwf_blaise_+3A_digits">digits</code></td>
<td>
<p>how many significant digits are to be used for numeric and
complex x. The default uses getOption(&quot;digits&quot;). This is a suggestion:
enough decimal places will be used so that the smallest (in magnitude) number
has this many significant digits.</p>
</td></tr>
<tr><td><code id="write_fwf_blaise_+3A_justify">justify</code></td>
<td>
<p>direction of padding for STRING type when data is smaller than the width.
Defaults to right-justified (padded on the left), can be &quot;left&quot;, &quot;right&quot; or &quot;centre&quot;.</p>
</td></tr>
<tr><td><code id="write_fwf_blaise_+3A_write_model">write_model</code></td>
<td>
<p>logical that can be used to disable the automatic writing of a
datamodel</p>
</td></tr>
<tr><td><code id="write_fwf_blaise_+3A_model_name">model_name</code></td>
<td>
<p>Custom name that can be given to the datamodel. Default is the
name of the dataframe</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Currently supports the following dataformats:
</p>

<ul>
<li><p> character =&gt; STRING,
</p>
</li>
<li><p> integer =&gt; INTEGER,
</p>
</li>
<li><p> numeric =&gt; REAL,
</p>
</li>
<li><p> Date =&gt; DATETYPE,
</p>
</li>
<li><p> factor =&gt; ENUM (will convert factor with numbers as labels to STRING)
</p>
</li>
<li><p> logical =&gt; INTEGER
</p>
</li></ul>



<h3>Value</h3>

<p>output as it is written to file as a character vector.
Does so invisibly, will not print but can be assigned.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>datafilename = tempfile('testdata', fileext = '.asc')
blafilename = tempfile('testbla', fileext = '.bla')
data = data.frame(1, 1:10, sample(LETTERS[1:3], 10, replace = TRUE), runif(10, 1, 10))
write_fwf_blaise(data, datafilename)
unlink(c(datafilename, blafilename))

</code></pre>

<hr>
<h2 id='write_fwf_blaise_with_model'>Write a fixed width ascii datafile based on a given blaise datamodel</h2><span id='topic+write_fwf_blaise_with_model'></span>

<h3>Description</h3>

<p>Write a datafile in the blaise format (fwf ascii without separators)
using an existing datamodel. will not write out a datamodel unless explicitly asked to.
Tries to automatically match colummns by name using Levenshtein distance and will
change types if required and possible.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_fwf_blaise_with_model(
  df,
  output_data,
  input_model,
  output_model = NULL,
  decimal.mark = ".",
  digits = getOption("digits"),
  justify = "right",
  max.distance = 0L
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="write_fwf_blaise_with_model_+3A_df">df</code></td>
<td>
<p>dataframe to write</p>
</td></tr>
<tr><td><code id="write_fwf_blaise_with_model_+3A_output_data">output_data</code></td>
<td>
<p>path and name to output datafile. Will add .asc if no extension</p>
</td></tr>
<tr><td><code id="write_fwf_blaise_with_model_+3A_input_model">input_model</code></td>
<td>
<p>the datamodel used to convert the dataframe and write the output</p>
</td></tr>
<tr><td><code id="write_fwf_blaise_with_model_+3A_output_model">output_model</code></td>
<td>
<p>path and name to output datamodel. If NULL will not write anything.
default is NULL</p>
</td></tr>
<tr><td><code id="write_fwf_blaise_with_model_+3A_decimal.mark">decimal.mark</code></td>
<td>
<p>decimal mark to use. Default is &quot;.&quot;.</p>
</td></tr>
<tr><td><code id="write_fwf_blaise_with_model_+3A_digits">digits</code></td>
<td>
<p>how many significant digits are to be used for numeric vectors.
The default uses getOption(&quot;digits&quot;). This is a suggestion:
enough decimal places will be used so that the smallest (in magnitude) number
has this many significant digits.</p>
</td></tr>
<tr><td><code id="write_fwf_blaise_with_model_+3A_justify">justify</code></td>
<td>
<p>direction of padding for STRING type when data is smaller than the width.
Defaults to right-justified (padded on the left), can be &quot;left&quot;, &quot;right&quot; or &quot;centre&quot;.</p>
</td></tr>
<tr><td><code id="write_fwf_blaise_with_model_+3A_max.distance">max.distance</code></td>
<td>
<p>maximum Levenshtein distance to match columns. ignores case changes.
Set to 0 (default) to only accept exact matches ignoring case. 4 appears to be
a good number in general. Will prevent double matches and will pick te best match
for each variable in the datamodel.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>output as it is written to file as a character vector.
Does so invisibly, will not print but can be assigned.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>datafilename = tempfile('testdata', fileext = '.asc')
blafilename = tempfile('testbla', fileext = '.bla')

model = "
DATAMODEL Test
FIELDS
A     : STRING[1]
B     : INTEGER[1]
C     : REAL[3,1]
D     : REAL[3]
E     : (Male, Female)
F     : 1..20
G     : 1.00..100.00
H     : DATETYPE
ENDMODEL
"
writeLines(model, con = blafilename)

  df = data.frame(
list(
  A = rep('t',3),
  B = 1:3,
  C = 1.1:3.3,
  D = 1.0:3.0,
  E = factor(c(1,2,1), labels = c('Male', 'Female')),
  F = 1:3,
  G = c(1., 99.9, 78.5),
  H = as.Date(rep('2001-01-01', 3))
)
)
write_fwf_blaise_with_model(df, datafilename, blafilename)


model = "
DATAMODEL Test
FIELDS
A     : STRING[1]
B     : STRING[1]
C     : STRING[3]
E     : STRING[1]
H     : STRING[8]
ENDMODEL
"
writeLines(model, con = blafilename)

df = data.frame(
list(
A = rep('t',3),
E = factor(c(1,2,1), labels = c('Male', 'Female')),
B = 1:3,
C = 1.1:3.3,
H = as.Date(rep('2001-01-01', 3))
),
stringsAsFactors = FALSE
)
write_fwf_blaise_with_model(df, datafilename, blafilename)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
