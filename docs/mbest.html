<!DOCTYPE html><html><head><title>Help for package mbest</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {mbest}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#effects'>
<p>Mixed Effects</p></a></li>
<li><a href='#firthglm.fit'>
<p>Fitting Generalized Linear Models with Firth's Bias Reduction</p></a></li>
<li><a href='#mbest-package'>
<p>Moment-Based Estimation for Hierarchical Models</p></a></li>
<li><a href='#mhglm'>
<p>Fitting Moment Hierarchical Generalized Linear Models</p></a></li>
<li><a href='#mhglm_sim'>
<p>Simulate response patterns</p></a></li>
<li><a href='#mhglm.control'>
<p>Auxiliary for Controlling Moment Heirarchical GLM Fitting</p></a></li>
<li><a href='#model.matrix.mhglm'>
<p>Terms and Model Matrix</p></a></li>
<li><a href='#predict'>
<p>Prediction</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Version:</td>
<td>0.6</td>
</tr>
<tr>
<td>Date:</td>
<td>2018-05-24</td>
</tr>
<tr>
<td>Title:</td>
<td>Moment-Based Estimation for Hierarchical Models</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Patrick O. Perry &lt;patperry@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Fast moment-based hierarchical model fitting. Implements
    methods from the papers
    "Fast Moment-Based Estimation for Hierarchical Models," by Perry (2017)
    and
    "Fitting a Deeply Nested Hierarchical Model to a Large Book Review
    Dataset Using a Moment-Based Estimator," by Zhang, Schmaus, and Perry
    (2018).</td>
</tr>
<tr>
<td>Depends:</td>
<td>nlme (&ge; 3.1-124)</td>
</tr>
<tr>
<td>Imports:</td>
<td>abind, bigmemory, foreach, lme4, logging</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat</td>
</tr>
<tr>
<td>LazyData:</td>
<td>Yes</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License (== 2.0)</a> | file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/patperry/r-mbest">https://github.com/patperry/r-mbest</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2018-05-24 20:52:57 UTC; ptrck</td>
</tr>
<tr>
<td>Author:</td>
<td>Patrick O. Perry [aut, cre],
  Timothy Sweetser [ctb],
  Kyle Schmaus [ctb],
  Ningshan Zhang [aut, ctb]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2018-05-25 07:26:56 UTC</td>
</tr>
</table>
<hr>
<h2 id='effects'>
Mixed Effects
</h2><span id='topic+fixef'></span><span id='topic+fixef.mhglm'></span><span id='topic+fixef.mhglm_ml'></span><span id='topic+ranef'></span><span id='topic+ranef.mhglm'></span><span id='topic+ranef.mhglm_ml'></span><span id='topic+VarCorr'></span><span id='topic+VarCorr.mhglm'></span><span id='topic+VarCorr.mhglm_ml'></span><span id='topic+vcov.mhglm'></span><span id='topic+vcov.mhglm_ml'></span>

<h3>Description</h3>

<p>Get the fixed effects, random effect variances, and empirical Bayes random
effect estimates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mhglm'
fixef(object, ...)

## S3 method for class 'mhglm'
ranef(object, condVar = FALSE, ...) 

## S3 method for class 'mhglm'
vcov(object, ...)

## S3 method for class 'mhglm'
VarCorr(x, sigma = 1, ...)

## S3 method for class 'mhglm_ml'
fixef(object, ...)

## S3 method for class 'mhglm_ml'
ranef(object, condVar = FALSE, ...) 

## S3 method for class 'mhglm_ml'
vcov(object, ...)

## S3 method for class 'mhglm_ml'
VarCorr(x, sigma = 1, ...)

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="effects_+3A_object">object</code>, <code id="effects_+3A_x">x</code></td>
<td>

<p>an <code>mhglm</code> object.
</p>
</td></tr>
<tr><td><code id="effects_+3A_sigma">sigma</code></td>
<td>

<p>a factor by which to scale the random effect variance-covariance matrix.
</p>
</td></tr>
<tr><td><code id="effects_+3A_condvar">condVar</code></td>
<td>

<p>a logical indicating whether conditional covariance matrices for the
random effects should be returned.
</p>
</td></tr>
<tr><td><code id="effects_+3A_...">...</code></td>
<td>

<p>further arguments passed to or from other methods.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>fixef</code> returnes the fixed effects, while <code>vcov</code> returns the
variance-covariance matrix of the fixed effect estimates.
</p>
<p><code>VarCorr</code> returns the random effect covariance matrix.  <code>ranef</code>
returns the empirical Bayes random effect estimates.
</p>
<p>These functions behave like their counterparts in the <a href="https://CRAN.R-project.org/package=nlme"><span class="pkg">nlme</span></a> package.
</p>


<h3>See Also</h3>

<p><code><a href="nlme.html#topic+fixef">fixef</a></code>, <code><a href="nlme.html#topic+ranef">ranef</a></code>, <code><a href="nlme.html#topic+VarCorr">VarCorr</a></code>,
from package <a href="https://CRAN.R-project.org/package=nlme"><span class="pkg">nlme</span></a>.
</p>

<hr>
<h2 id='firthglm.fit'>
Fitting Generalized Linear Models with Firth's Bias Reduction
</h2><span id='topic+firthglm.fit'></span><span id='topic+firthglm.control'></span>

<h3>Description</h3>

<p>A drop-in replacement for <code><a href="stats.html#topic+glm.fit">glm.fit</a></code> which uses Firth's
bias-reduced estimates instead of maximum likelihood.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>firthglm.fit(x, y, weights = rep(1, nobs),
             start = NULL, etastart = NULL, mustart = NULL,
             offset = rep(0, nobs), family = gaussian(),
             control = list(...), intercept = TRUE, singular.ok = TRUE, ...)

firthglm.control(epsilon = 1e-8, maxit = 25, qr.tol = 1e-7,
                 improve.tol = 1e-4, curvature.tol = 0.9,
                 linesearch.method = "linesearch",
                 linesearch.maxit = 20, trace = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="firthglm.fit_+3A_x">x</code>, <code id="firthglm.fit_+3A_y">y</code>, <code id="firthglm.fit_+3A_weights">weights</code>, <code id="firthglm.fit_+3A_start">start</code>, <code id="firthglm.fit_+3A_etastart">etastart</code>, <code id="firthglm.fit_+3A_mustart">mustart</code>, <code id="firthglm.fit_+3A_offset">offset</code>, <code id="firthglm.fit_+3A_family">family</code>, <code id="firthglm.fit_+3A_control">control</code>, <code id="firthglm.fit_+3A_intercept">intercept</code>, <code id="firthglm.fit_+3A_singular.ok">singular.ok</code>, <code id="firthglm.fit_+3A_...">...</code></td>
<td>

<p>arguments that have the same functions as for <code><a href="stats.html#topic+glm.fit">glm.fit</a></code>.
</p>
</td></tr>
<tr><td><code id="firthglm.fit_+3A_qr.tol">qr.tol</code></td>
<td>

<p>tolerance parameter for determining the rank of <code>x</code>.
</p>
</td></tr>
<tr><td><code id="firthglm.fit_+3A_epsilon">epsilon</code>, <code id="firthglm.fit_+3A_maxit">maxit</code></td>
<td>

<p>convergence parameters for the quasi-Newton method.
</p>
</td></tr>
<tr><td><code id="firthglm.fit_+3A_linesearch.method">linesearch.method</code></td>
<td>

<p>line search methods (one of &quot;linesearch&quot;, &quot;backtrack&quot;, or &quot;blindsearch&quot;)
</p>
</td></tr>
<tr><td><code id="firthglm.fit_+3A_improve.tol">improve.tol</code>, <code id="firthglm.fit_+3A_curvature.tol">curvature.tol</code>, <code id="firthglm.fit_+3A_linesearch.maxit">linesearch.maxit</code></td>
<td>

<p>tolerance parameters for the linesearch procedure.
</p>
</td></tr>
<tr><td><code id="firthglm.fit_+3A_trace">trace</code></td>
<td>

<p>logical indicating if output should be produced for each iteration.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Firth's modified score function gives rise to estimates with smaller biases
than their maximum likelihood counterparts.  Unlike the maximum likelihood
estimates, if the design matrix is of full rank, then the Firth bias-reduced
estimate is finite.
</p>
<p>By default, the fitting procedure uses a quasi-Newton optimization method,
with a More-Thuente linesearch.
</p>


<h3>Value</h3>

<p><code>firthglm.fit</code> returns an object having the same components that a call
to <code><a href="stats.html#topic+glm.fit">glm.fit</a></code> would produce.
</p>


<h3>Note</h3>

<p>Currently, only families with canonical link functions are supported.
</p>


<h3>Author(s)</h3>

<p>Patrick O. Perry
</p>


<h3>References</h3>

<p>Firth, D. (1993) Bias reduction of maximum likelihood estimates.
<em>Biometrika</em> <b>80</b>, 27-â€“38.
</p>
<p>More, J. J. and Thuente, D. J. (1994) Line search algorithms with
guaranteed sufficient decrease.
<em>ACM Transactions on Mathematical Software</em> <b>20</b> 286&ndash;307. 
</p>


<h3>See Also</h3>

<p><code><a href="logistf.html#topic+logistf">logistf</a></code> (package <a href="https://CRAN.R-project.org/package=logistf"><span class="pkg">logistf</span></a>) and
<code><a href="brglm.html#topic+brglm">brglm</a></code> (package <a href="https://CRAN.R-project.org/package=brglm"><span class="pkg">brglm</span></a>) for alternative
implementations of Firth's bias-reduced estimators.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Dobson (1990) Page 93: Randomized Controlled Trial :
counts &lt;- c(18,17,15,20,10,20,25,13,12)
outcome &lt;- gl(3,1,9)
treatment &lt;- gl(3,3)

## Use firthglm.fit instead of glm.fit:
glm.D93 &lt;- glm(counts ~ outcome + treatment, family = poisson(),
               method="firthglm.fit")
summary(glm.D93)
</code></pre>

<hr>
<h2 id='mbest-package'>
Moment-Based Estimation for Hierarchical Models
</h2><span id='topic+mbest-package'></span><span id='topic+mbest'></span>

<h3>Description</h3>

<p>Fast moment-based hierarchical model fitting. Implements
methods from the papers
&quot;Fast Moment-Based Estimation for Hierarchical Models,&quot; by Perry (2017)
and
&quot;Fitting a Deeply Nested Hierarchical Model to a Large Book Review
Dataset Using a Moment-Based Estimator,&quot; by Zhang, Schmaus, and Perry
(2018).
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> mbest</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 0.6</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2018-05-24</td>
</tr>
<tr>
 <td style="text-align: left;">
Title: </td><td style="text-align: left;"> Moment-Based Estimation for Hierarchical Models</td>
</tr>
<tr>
 <td style="text-align: left;">
Authors@R: </td><td style="text-align: left;"> c(person(c("Patrick", "O."), "Perry", role = c("aut", "cre"),
                    email = "patperry@gmail.com"),
             person("Timothy", "Sweetser", role = "ctb"),
             person("Kyle", "Schmaus", role = "ctb"),
             person("Ningshan", "Zhang", role = c("aut", "ctb")))</td>
</tr>
<tr>
 <td style="text-align: left;">
Maintainer: </td><td style="text-align: left;"> Patrick O. Perry &lt;patperry@gmail.com&gt;</td>
</tr>
<tr>
 <td style="text-align: left;">
Description: </td><td style="text-align: left;"> Fast moment-based hierarchical model fitting. Implements
    methods from the papers
    "Fast Moment-Based Estimation for Hierarchical Models," by Perry (2017)
    and
    "Fitting a Deeply Nested Hierarchical Model to a Large Book Review
    Dataset Using a Moment-Based Estimator," by Zhang, Schmaus, and Perry
    (2018).</td>
</tr>
<tr>
 <td style="text-align: left;">
Depends: </td><td style="text-align: left;"> nlme (&gt;= 3.1-124)</td>
</tr>
<tr>
 <td style="text-align: left;">
Imports: </td><td style="text-align: left;"> abind,
bigmemory,
foreach,
lme4,
logging</td>
</tr>
<tr>
 <td style="text-align: left;">
Suggests: </td><td style="text-align: left;"> testthat</td>
</tr>
<tr>
 <td style="text-align: left;">
LazyData: </td><td style="text-align: left;"> Yes</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> Apache License (== 2.0) | file LICENSE</td>
</tr>
<tr>
 <td style="text-align: left;">
URL: </td><td style="text-align: left;"> https://github.com/patperry/r-mbest</td>
</tr>
<tr>
 <td style="text-align: left;">
Encoding: </td><td style="text-align: left;"> UTF-8</td>
</tr>
<tr>
 <td style="text-align: left;">
Author: </td><td style="text-align: left;"> Patrick O. Perry [aut, cre],
  Timothy Sweetser [ctb],
  Kyle Schmaus [ctb],
  Ningshan Zhang [aut, ctb]</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>Index of help topics:
</p>
<pre>
firthglm.fit            Fitting Generalized Linear Models with Firth's
                        Bias Reduction
fixef                   Mixed Effects
mbest-package           Moment-Based Estimation for Hierarchical Models
mhglm                   Fitting Moment Hierarchical Generalized Linear
                        Models
mhglm.control           Auxiliary for Controlling Moment Heirarchical
                        GLM Fitting
mhglm_sim               Simulate response patterns
model.matrix.mhglm      Terms and Model Matrix
predict.mhglm           Prediction
</pre>
<p>Basic usage is to call <code><a href="#topic+mhglm">mhglm</a></code>.
</p>


<h3>References</h3>

<p>P. O. Perry (2017)
&quot;Fast moment-based estimation for hierarchical models.&quot;
</p>
<p>N. Zhang, K. Schmaus, and P. O. Perry (2018)
&quot;Fitting deeply-nested hierarchical models to a large book review dataset using moment-based estimators.&quot;
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mhglm">mhglm</a></code>,
<code><a href="#topic+fixef.mhglm">fixef.mhglm</a></code>,
<code><a href="#topic+ranef.mhglm">ranef.mhglm</a></code>,
<code><a href="#topic+VarCorr.mhglm">VarCorr.mhglm</a></code>,
<code><a href="#topic+predict.mhglm">predict.mhglm</a></code>.
</p>

<hr>
<h2 id='mhglm'>
Fitting Moment Hierarchical Generalized Linear Models
</h2><span id='topic+mhglm'></span><span id='topic+mhglm.fit'></span><span id='topic+mhglm_ml'></span><span id='topic+mhglm_ml.fit'></span>

<h3>Description</h3>

<p><code>mhglm</code> is used to fit a moment hierarchical generalized linear model of one level.
<code>mhglm_ml</code> is used to fit a moment hierarchical generalized linear model of arbitrary number of levels 
(including one level).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mhglm(formula, family = gaussian, data, weights, subset,
      na.action, start = NULL, etastart, mustart, offset,
      control = list(), model = TRUE, method = "mhglm.fit",
      x = FALSE, z = FALSE, y = TRUE, group = TRUE,
      contrasts = NULL)

mhglm.fit(x, z, y, group, weights = rep(1, nobs),
          start = NULL, etastart = NULL, mustart = NULL,
          offset = rep(0, nobs), family = gaussian(), 
          control = list(), intercept = TRUE, dispersion = NULL)

mhglm_ml(formula, family = gaussian, data, weights, subset,
         na.action, start = NULL, etastart, mustart, offset,
         control = list(), model = TRUE, method = "mhglm_ml.fit",
         x = FALSE, z = FALSE, y = TRUE, group = TRUE,
         contrasts = NULL)

mhglm_ml.fit(x, z, y, group, weights = rep(1, nobs),
             start = NULL, etastart = NULL, mustart = NULL,
             offset = rep(0, nobs), family = gaussian(), 
             control = list(), intercept = TRUE)

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mhglm_+3A_formula">formula</code>, <code id="mhglm_+3A_family">family</code>, <code id="mhglm_+3A_data">data</code>, <code id="mhglm_+3A_weights">weights</code>, <code id="mhglm_+3A_subset">subset</code>, <code id="mhglm_+3A_na.action">na.action</code>, <code id="mhglm_+3A_start">start</code>, <code id="mhglm_+3A_etastart">etastart</code>, <code id="mhglm_+3A_mustart">mustart</code>, <code id="mhglm_+3A_offset">offset</code>, <code id="mhglm_+3A_model">model</code>, <code id="mhglm_+3A_contrasts">contrasts</code>, <code id="mhglm_+3A_intercept">intercept</code></td>
<td>
<p>These arguments
are analogous to the similarly-named arguments for the <code><a href="stats.html#topic+glm">glm</a></code> and
<code><a href="stats.html#topic+glm.fit">glm.fit</a></code> functions.
</p>
</td></tr>
<tr><td><code id="mhglm_+3A_control">control</code></td>
<td>
<p>a list of parameters for controlling the fitting
process.  For <code>mhglm.fit</code> this is passed to
<code><a href="#topic+mhglm.control">mhglm.control</a></code>.</p>
</td></tr>
<tr><td><code id="mhglm_+3A_method">method</code></td>
<td>
<p>the method to be used in fitting the model.  The default
method <code>"mhglm.fit"</code> uses moment-based estimates;
the alternative <code>"model.frame"</code> returns the model frame
and does no fitting.
</p>
</td></tr>
<tr><td><code id="mhglm_+3A_x">x</code>, <code id="mhglm_+3A_z">z</code>, <code id="mhglm_+3A_y">y</code>, <code id="mhglm_+3A_group">group</code></td>
<td>
<p> For <code>mhglm</code> and <code>mhglm_ml</code>:
logical values indicating whether the response vector, model matrices,
and grouping factor used in the fitting process should be returned as
components of the returned value.
</p>
<p>For <code>mhglm.fit</code>: <code>x</code> is a fixed effect design matrix of
dimension <code>n * p</code>, <code>z</code> is a random effect design matrix of
dimension <code>n * q</code>, <code>y</code> is a vector of observations of length
<code>n</code>, and <code>group</code> is a grouping factor vector of length
<code>n</code>.
</p>
<p>For <code>mhglm_ml.fit</code>: <code>x</code> is a fixed effect design matrix of
dimension <code>n * p</code>, <code>z</code> is a list of L elements, with L
the depth of nested hierarchies, each element of <code>z</code> 
is a random effect design matrix of dimension <code>n * q_i</code>, with
q_i the feature dimension on tree depth i, 
<code>y</code> is a vector of observations of length <code>n</code>, 
and <code>group</code> is a list of L elements (same L as <code>z</code>), 
each element of <code>group</code> is a grouping factor vector of length <code>n</code>.
</p>
</td></tr>
<tr><td><code id="mhglm_+3A_dispersion">dispersion</code></td>
<td>
<p>If <code>NULL</code>, will estimate from data; otherwise use this argument as 
dispersion parameter.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>These functions are analogues of <code><a href="stats.html#topic+glm">glm</a></code> and
<code><a href="stats.html#topic+glm.fit">glm.fit</a></code>, meant to be used for fitting hierarchical
generalized linear models.  A typical predictor has the form
<code>response ~ terms + (reterms | group)</code> where
<code>response</code> is the (numeric) response vector, <code>terms</code> is a
series of terms which specifies a linear predictor for
<code>response</code>, <code>reterms</code> is a series of terms with random
coefficients (effects), and <code>group</code> is a grouping factor; observations
with the same grouping factor share the same random effects.
</p>
<p><code>mhglm</code> and <code>mhglm.fit</code> only allow one random effect term,
along with a single level of hierarchy. 
<code>mghlm_ml</code> and <code>mhglm_ml.fit</code> allow multiple random effect terms so 
long as levels of random effects are hierarchically nested. If the random 
effect design matrices are the same for each level, a predictor has the form
<code>response ~ terms + (reterms | g1/.../gQ)</code>. If the random effects design
matrices differ from level to level, colons are used to delineate the nesting
structure; for example, 
<code>response ~ fe + (re1 | g1) + (re2 | g2:g1) + (re3 | g3:g2:g1)</code>.
</p>
<p><code>mhglm</code> allows <code>||</code> in the formula
<code>response ~ terms + (reterms || group)</code> to indicate that random effects
are independent, that is the random effects covariance matrix has non-zero 
value only on its diagonal.
<code>mhglm_ml</code> currently does not support <code>||</code>, to indicate indpenedent
random effects, set <code>control=list(diagcov = TRUE)</code>.
</p>


<h3>Value</h3>

<p><code>mhglm</code> returns an object of class inheriting from <code>"mhglm"</code>.
<code>mhglm_ml</code> returns an object of class inheriting from <code>"mhglm_ml"</code>.
</p>
<p>The function <code><a href="base.html#topic+summary">summary</a></code> can be used to obtain or print a summary
of the results.
</p>
<p>The generic accessor functions <code><a href="#topic+fixef">fixef</a></code>, <code><a href="#topic+ranef">ranef</a></code>,
<code><a href="#topic+VarCorr">VarCorr</a></code>, <code><a href="#topic+sigma">sigma</a></code>, <code>fitted.values</code> and
<code>residuals</code> can be used to extract various useful features of the
value returned by <code>mhglm</code> or <code>mhglm_ml</code>.
</p>


<h3>Note</h3>

<p>If the moment-based random effect covariance is not positive-semidefinite, then
a warning will be issued, and a projection of the estimate to the
positive-semidefinite cone will be used instead.
</p>


<h3>References</h3>

<p>P. O. Perry (2017)
&quot;Fast moment-based estimation for hierarchical models.&quot;
</p>
<p>N. Zhang, K. Schmaus, and P. O. Perry (2018)
&quot;Fitting deeply-nested hierarchical models to a large book review dataset using moment-based estimators.&quot;
</p>


<h3>See Also</h3>

<p><code><a href="#topic+terms.mhglm">terms.mhglm</a></code>, <code><a href="#topic+model.matrix.mhglm">model.matrix.mhglm</a></code>, and
<code><a href="#topic+predict.mhglm">predict.mhglm</a></code> for <code>mhglm</code> methods, and the
generic functions <code><a href="stats.html#topic+fitted.values">fitted.values</a></code>, <code><a href="stats.html#topic+residuals">residuals</a></code>,
<code><a href="base.html#topic+summary">summary</a></code>, <code><a href="stats.html#topic+vcov">vcov</a></code>, and <code><a href="stats.html#topic+weights">weights</a></code>.
</p>
<p>Generic functions <code><a href="#topic+fixef">fixef</a></code>, <code><a href="#topic+ranef">ranef</a></code>,
<code><a href="#topic+VarCorr">VarCorr</a></code>, and <code><a href="#topic+sigma">sigma</a></code> for features
related to mixed effect models.
</p>
<p><code><a href="lme4.html#topic+glmer">glmer</a></code> (package <a href="https://CRAN.R-project.org/package=lme4"><span class="pkg">lme4</span></a>) for
fitting generalized linear mixed models with likelihood-based estimates.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(lme4)
## The following examples are adapted from lme4:
(fm1 &lt;- mhglm(Reaction ~ Days + (Days | Subject), gaussian, sleepstudy))

(fm2 &lt;- mhglm(Reaction ~ Days + (Days || Subject), gaussian, sleepstudy))

(gm &lt;- mhglm(cbind(incidence, size - incidence) ~ period + (1 | herd),
             data = cbpp, family = binomial))

## The following examples are for multilevel models
g_data &lt;- mhglm_sim(n = 30, m_per_level = c(10, 5, 2), sd_intercept = c(1, 1, 1),
                    sd_slope = c(1, 1, 1), family = "gaussian", seed = 12345)

(m1 &lt;- mhglm_ml(y ~ 1 + x + (1 + x | g1/g2/g3), gaussian, g_data))
# or equivalent
(m2 &lt;- mhglm_ml(y ~ 1 + x + (1 + x | g1) + (1 + x | g2:g1) + (1 + x | g3:g2:g1),
                gaussian, g_data))
</code></pre>

<hr>
<h2 id='mhglm_sim'>
Simulate response patterns
</h2><span id='topic+mhglm_sim'></span>

<h3>Description</h3>

<p>Simulate response patterns for generalized linear models of <code>gaussian</code> or
<code>binomial</code> families, with both an intercept and slope covariate. Used
primarily for testing purposes. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mhglm_sim(n, m_per_level, sd_intercept, sd_slope,
          family = c("gaussian", "binomial"), seed)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mhglm_sim_+3A_n">n</code></td>
<td>

<p>an integer scalar, the number of observations at the lowest grouping level.
</p>
</td></tr>
<tr><td><code id="mhglm_sim_+3A_m_per_level">m_per_level</code></td>
<td>

<p>an integer vector, the number of grouping levels nested under the level above.
</p>
</td></tr>
<tr><td><code id="mhglm_sim_+3A_sd_intercept">sd_intercept</code></td>
<td>

<p>a numeric vector, the standard deviations of the intercept random effects. 
</p>
</td></tr>
<tr><td><code id="mhglm_sim_+3A_sd_slope">sd_slope</code></td>
<td>

<p>a numeric vector, the standard deviations of the slope random effects. 
</p>
</td></tr>
<tr><td><code id="mhglm_sim_+3A_family">family</code></td>
<td>

<p>a character scalar, either <code>"gaussian"</code> or <code>"binomial"</code>.
</p>
</td></tr>
<tr><td><code id="mhglm_sim_+3A_seed">seed</code></td>
<td>

<p>a single value, interpreted as an integer, or <code>NULL</code> as in <code>set.seed</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>returns a data.frame with design matrix, response, and group levels. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>mhglm_sim(n = 2, m_per_level = c(3, 3), sd_intercept = c(1, 2), 
        sd_slope = c(2, 1), family = "gaussian", seed = 123)

mhglm_sim(n = 2, m_per_level = c(3, 3), sd_intercept = c(1, 2), 
        sd_slope = c(2, 1), family = "binomial", seed = 123)
</code></pre>

<hr>
<h2 id='mhglm.control'>
Auxiliary for Controlling Moment Heirarchical GLM Fitting
</h2><span id='topic+mhglm.control'></span><span id='topic+mhglm_ml.control'></span>

<h3>Description</h3>

<p>Auxiliary function for <code><a href="#topic+mhglm">mhglm</a></code> fitting. Typically only used
internally by <code><a href="#topic+mhglm.fit">mhglm.fit</a></code>, but may be used to construct a
control argument to either function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mhglm.control(standardize = TRUE, steps = 1, parallel = FALSE, diagcov = FALSE,
        fit.method = "firthglm.fit", fixef.rank.warn = FALSE, cov.rank.warn = FALSE,
        cov.psd.warn = TRUE, fit.control = list(...), ...)

mhglm_ml.control(standardize = FALSE, steps = 1, parallel = FALSE, diagcov = FALSE,
              fit.method = "firthglm.fit", fixef.rank.warn = FALSE, cov.rank.warn = FALSE,
              cov.psd.warn = FALSE, fit.control = list(...), ...)

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mhglm.control_+3A_standardize">standardize</code></td>
<td>

<p>logitcal indicating if predictors should be standardized before
moment-based fitted
</p>
</td></tr>
<tr><td><code id="mhglm.control_+3A_steps">steps</code></td>
<td>

<p>number of refinement steps
</p>
</td></tr>
<tr><td><code id="mhglm.control_+3A_parallel">parallel</code></td>
<td>

<p>fit the group-specific estimates in parallel rather than sequentially
</p>
</td></tr>
<tr><td><code id="mhglm.control_+3A_diagcov">diagcov</code></td>
<td>

<p>estimate random effect covairance matrix with diagonal approximation 
</p>
</td></tr>
<tr><td><code id="mhglm.control_+3A_fit.method">fit.method</code></td>
<td>

<p>method for obtaining group-specific effect estimates
</p>
</td></tr>
<tr><td><code id="mhglm.control_+3A_fixef.rank.warn">fixef.rank.warn</code></td>
<td>

<p>if TRUE, print warnings when fixef is unidentifiable
</p>
</td></tr>
<tr><td><code id="mhglm.control_+3A_cov.rank.warn">cov.rank.warn</code></td>
<td>

<p>if TRUE, print warnings when covariance matrix is unidentifiable
</p>
</td></tr>
<tr><td><code id="mhglm.control_+3A_cov.psd.warn">cov.psd.warn</code></td>
<td>

<p>if TRUE, print warnings when moment based estimates of covariance matrix is 
not positive semi-definite
</p>
</td></tr>
<tr><td><code id="mhglm.control_+3A_fit.control">fit.control</code></td>
<td>

<p>control parameters for <code>fit.method</code>
</p>
</td></tr>
<tr><td><code id="mhglm.control_+3A_...">...</code></td>
<td>

<p>arguments to be used to form the <code>fit.control</code> argument if
it is not supplied directly.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Setting <code>standardize = TRUE</code> ensures that the procedure is equivariant,
and generally leads to better estimation performance.
Right now <code>standardize = TRUE</code> is not allowed for <code>mhglm_ml</code>.
</p>
<p>The <code>steps</code> argument gives the number of refinement steps for the moment
based parameters.  In each step, the previous fixed effect and random effect
covariance matrix estimates are used to weight the subpopulation-specific
effect estimates.  In principle, higher values of <code>steps</code> could lead to
more accurate estimates, but in simulations, the differences are negligible.
</p>


<h3>Value</h3>

<p>A list with components named as the arguments.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+mhglm.fit">mhglm.fit</a></code>, the fitting procedure used by
<code><a href="#topic+mhglm">mhglm</a></code>.
</p>
<p><code><a href="#topic+firthglm.fit">firthglm.fit</a></code>, the default subpopulation-specific fitting method.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(lme4) # for cbpp data

# The default fitting method uses Firth's bias-corrected estimates
(gm.firth &lt;- mhglm(cbind(incidence, size - incidence) ~ period + (1 | herd),
                   data = cbpp, family = binomial,
                   control=mhglm.control(fit.method="firthglm.fit")))

# Using maximum likelihood estimates is less reliable
(gm.ml &lt;- mhglm(cbind(incidence, size - incidence) ~ period + (1 | herd),
                data = cbpp, family = binomial,
                control=mhglm.control(fit.method="glm.fit")))
</code></pre>

<hr>
<h2 id='model.matrix.mhglm'>
Terms and Model Matrix
</h2><span id='topic+model.matrix.mhglm'></span><span id='topic+model.matrix.mhglm_ml'></span><span id='topic+terms.mhglm'></span><span id='topic+terms.mhglm_ml'></span>

<h3>Description</h3>

<p>Get the terms or model matrix from an <code>mhglm</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  ## S3 method for class 'mhglm'
model.matrix(object, type = c("fixed", "random"), ...)
  ## S3 method for class 'mhglm_ml'
model.matrix(object, type = c("fixed", "random"), ...)

  ## S3 method for class 'mhglm'
terms(x, type = c("fixed", "random"), ...)
  ## S3 method for class 'mhglm_ml'
terms(x, type = c("fixed", "random"), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="model.matrix.mhglm_+3A_object">object</code>, <code id="model.matrix.mhglm_+3A_x">x</code></td>
<td>

<p>an <code>mhglm</code> object.
</p>
</td></tr>
<tr><td><code id="model.matrix.mhglm_+3A_type">type</code></td>
<td>

<p>which terms to get (for the fixed or for the random effects).
</p>
</td></tr>
<tr><td><code id="model.matrix.mhglm_+3A_...">...</code></td>
<td>

<p>further arguments passed to or from other methods.
</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+model.matrix">model.matrix</a></code>, <code><a href="stats.html#topic+terms">terms</a></code>
</p>

<hr>
<h2 id='predict'>
Prediction
</h2><span id='topic+predict.mhglm'></span><span id='topic+predict.mhglm_ml'></span><span id='topic+sigma'></span><span id='topic+sigma.mhglm'></span><span id='topic+sigma.mhglm_ml'></span>

<h3>Description</h3>

<p><code>predict</code> gives empirical Bayes predictions of the response, while
<code>sigma</code> gives the dispersion parameter.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'mhglm'
predict(object, newdata = NULL, type = c("link", "response"),
      se.fit = FALSE, na.action = na.pass, ...)

## S3 method for class 'mhglm'
sigma(object, ...)

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict_+3A_object">object</code></td>
<td>

<p>an <code>mhglm</code> object
</p>
</td></tr>
<tr><td><code id="predict_+3A_newdata">newdata</code>, <code id="predict_+3A_type">type</code>, <code id="predict_+3A_se.fit">se.fit</code>, <code id="predict_+3A_na.action">na.action</code></td>
<td>

<p>these arguments behave as in <code><a href="stats.html#topic+predict.glm">predict.glm</a></code>.  See Details, below.
</p>
</td></tr>
<tr><td><code id="predict_+3A_...">...</code></td>
<td>

<p>further arguments passed to or from other methods.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>predict</code> function gives empirical Bayes posterior mean estimates of
response values.  If <code>se.fit = TRUE</code>, then the conditional variances of
the random effects are used along with the fixed effect variance-covariance
matrix to estimate the standard errors.
</p>
<p>The <code>sigma</code> function gives the square root of the dispersion parameter
or the model; for linear models, this is the error standard deviation.
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+predict">predict</a></code>.
</p>
<p><code><a href="lme4.html#topic+sigma">sigma</a></code>, from package <a href="https://CRAN.R-project.org/package=lme4"><span class="pkg">lme4</span></a>.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
