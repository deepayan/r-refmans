<!DOCTYPE html><html><head><title>Help for package brainR</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {brainR}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#brainR-package'><p>Functions to render 3D brain images in html</p></a></li>
<li><a href='#makeScene'><p>Make Leveled Scene</p></a></li>
<li><a href='#scene4d'><p>Wrapper to write a 4D scene</p></a></li>
<li><a href='#write4D'><p>Wrapper to write a 4D scene</p></a></li>
<li><a href='#write4D.file'><p>Write a 4D scene</p></a></li>
<li><a href='#writeTrianglesSTL'><p>Write STL triangles (without recalling the ids)</p></a></li>
<li><a href='#writeWebGL_split'><p>Write WebGL with split triangles</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Helper Functions to 'misc3d' and 'rgl' Packages for Brain
Imaging</td>
</tr>
<tr>
<td>Version:</td>
<td>1.6.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2019-12-03</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>John Muschelli &lt;muschellij2@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>This includes functions for creating 3D and 4D images using 
    'WebGL', 'rgl', and 'JavaScript' commands.  
    This package relies on the X toolkit ('XTK',
    <a href="https://github.com/xtk/X#readme">https://github.com/xtk/X#readme</a>).</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Depends:</td>
<td>rgl, misc3d, oro.nifti</td>
</tr>
<tr>
<td>Imports:</td>
<td>grDevices</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.0.1</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Suggests:</td>
<td>servr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2019-12-04 22:43:49 UTC; johnmuschelli</td>
</tr>
<tr>
<td>Author:</td>
<td>John Muschelli [aut, cre]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2019-12-05 06:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='brainR-package'>Functions to render 3D brain images in html</h2><span id='topic+brainR-package'></span><span id='topic+brainR'></span>

<h3>Description</h3>

<p>Brain Template from Copyright (C) 1993-2009 Louis Collins, McConnell Brain Imaging Centre, 
Montreal Neurological Institute, McGill University
6th generation non-linear symmetric brain
</p>


<h3>Author(s)</h3>

<p>John Muschelli <a href="mailto:muschellij2@gmail.com">muschellij2@gmail.com</a>
</p>


<h3>References</h3>

<p>G. Grabner, A. L. Janke, M. M. Budge, D. Smith, J. Pruessner, and
D. L. Collins, &quot;Symmetric atlasing and model based segmentation:
an application to the hippocampus in older adults&quot;, Med Image Comput
Comput Assist Interv Int Conf Med Image Comput Comput Assist Interv,
vol. 9, pp. 58-66, 2006.
</p>


<h3>See Also</h3>

<p><code><a href="misc3d.html#topic+contour3d">contour3d</a></code>, <code><a href="rgl.html#topic+rgl">rgl</a></code>
</p>

<hr>
<h2 id='makeScene'>Make Leveled Scene</h2><span id='topic+makeScene'></span>

<h3>Description</h3>

<p>Make scene returns a list of levels - but makes them mutually distinct.
So if cutoff 0.1, 0.2, then 0.1&lt;= x &lt; 0.2 is an roi, not &gt; 0.1 and &gt; 0.2.
Different than <code><a href="misc3d.html#topic+contour3d">contour3d</a></code> as these are mutually exclusive levels.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>makeScene(data, cutoffs, alpha, cols)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="makeScene_+3A_data">data</code></td>
<td>
<p>- 3D array of values (can be <a href="oro.nifti.html#topic+nifti-class">nifti-class</a>)</p>
</td></tr>
<tr><td><code id="makeScene_+3A_cutoffs">cutoffs</code></td>
<td>
<p>- series of levels to be created</p>
</td></tr>
<tr><td><code id="makeScene_+3A_alpha">alpha</code></td>
<td>
<p>- alpha levels for each contour</p>
</td></tr>
<tr><td><code id="makeScene_+3A_cols">cols</code></td>
<td>
<p>- colors for each contour</p>
</td></tr>
</table>


<h3>Value</h3>

<p>scene with multiple objects - can be passed to <a href="#topic+write4D">write4D</a>
</p>

<hr>
<h2 id='scene4d'>Wrapper to write a 4D scene</h2><span id='topic+scene4d'></span>

<h3>Description</h3>

<p>This function takes in filenames, levels, and creates an output html file,
with 4D elements.  The html is based on XTK (https://github.com/xtk/X#readme)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>scene4d(
  files,
  fnames = NULL,
  outfile = "index_4D_stl.html",
  levels = NULL,
  alpha = NULL,
  color = "white",
  useTemp = FALSE,
  MNITemp = c("1mm", "2mm"),
  objtype = "stl",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="scene4d_+3A_files">files</code></td>
<td>
<p>(character) vector of filenames (first being a brain file if useTemp=FALSE)</p>
</td></tr>
<tr><td><code id="scene4d_+3A_fnames">fnames</code></td>
<td>
<p>(character) filenames for the 3D surfaces in the scene - needs to 
be the same length as files</p>
</td></tr>
<tr><td><code id="scene4d_+3A_outfile">outfile</code></td>
<td>
<p>(character) html filename</p>
</td></tr>
<tr><td><code id="scene4d_+3A_levels">levels</code></td>
<td>
<p>(numeric/list) levels to make contours/surfaces for each file. 
Either a numeric vector may be passed, one level for each file.  Or a list of numeric vectors of multiple
levels for each file. Will be coerced to a list.</p>
</td></tr>
<tr><td><code id="scene4d_+3A_alpha">alpha</code></td>
<td>
<p>(numeric/list) alpha opacities for each contours/surface for each file. Will be coerced to list
similarly as levels</p>
</td></tr>
<tr><td><code id="scene4d_+3A_color">color</code></td>
<td>
<p>(character/list) colors for each contours/surface for each file. Will be coerced to list
similarly as levels</p>
</td></tr>
<tr><td><code id="scene4d_+3A_usetemp">useTemp</code></td>
<td>
<p>(logical) whether to use template from brainR as the brain figure</p>
</td></tr>
<tr><td><code id="scene4d_+3A_mnitemp">MNITemp</code></td>
<td>
<p>(character) if (useTemp = TRUE) either &quot;1mm&quot; or &quot;2mm&quot; denoting the resolution 
of the template used</p>
</td></tr>
<tr><td><code id="scene4d_+3A_objtype">objtype</code></td>
<td>
<p>(character) object type to write the files to.  Either &quot;stl&quot;, &quot;obj&quot;, or &quot;ply&quot; to write.</p>
</td></tr>
<tr><td><code id="scene4d_+3A_...">...</code></td>
<td>
<p>other options to be passed to <a href="#topic+write4D">write4D</a></p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>### Faster - 8mm resampled but very coarse
imgs &lt;- paste("Visit_", 1:5, "_8mm.nii.gz", sep="") 
ifiles &lt;- sapply(imgs, system.file, package='brainR')
files = file.path(tempdir(), basename(ifiles))
file.copy(ifiles, files)
outfile &lt;-  file.path(tempdir(), "index_4D_stl.html")
scene4d(files, levels=rep(0.99, length(files)), 
outfile = outfile, color= rep("blue", length(files)), useTemp=TRUE, 
MNITemp = "8mm", alpha = rep(1, length(files)), rescale=TRUE  )
## Not run: 
imgs &lt;- paste("Visit_", 1:5, ".nii.gz", sep="") 
ifiles &lt;- sapply(imgs, system.file, package='brainR')
files = file.path(tempdir(), basename(ifiles))
file.copy(ifiles, files)
scene4d(files, levels=rep(0.99, length(files)), 
outfile = outfile,
color= rep("blue", length(files)), useTemp=TRUEge, 
MNITemp = "8mm", alpha = rep(1, length(files)), rescale=TRUE  )

## End(Not run)
</code></pre>

<hr>
<h2 id='write4D'>Wrapper to write a 4D scene</h2><span id='topic+write4D'></span>

<h3>Description</h3>

<p>This function takes in a scene and writes it out to a series of files
either with the stl format or obj format (see <a href="rgl.html#topic+writeOBJ">writeOBJ</a> and
<a href="rgl.html#topic+writeSTL">writeSTL</a>)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write4D(
  scene,
  outfile,
  fnames = NULL,
  captions = NULL,
  writefiles = TRUE,
  reprint = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="write4D_+3A_scene">scene</code></td>
<td>
<p>list of 3D triangles (see <a href="misc3d.html#topic+contour3d">contour3d</a>).  If a multicolored
object is to be rendered (multiple contours with one control) - it must be in a
list</p>
</td></tr>
<tr><td><code id="write4D_+3A_outfile">outfile</code></td>
<td>
<p>html filename that is to be exported</p>
</td></tr>
<tr><td><code id="write4D_+3A_fnames">fnames</code></td>
<td>
<p>filenames for the 3D surfaces in the scene - needs to
be the same length as scene</p>
</td></tr>
<tr><td><code id="write4D_+3A_captions">captions</code></td>
<td>
<p>labels for checkboxes on html webpage</p>
</td></tr>
<tr><td><code id="write4D_+3A_writefiles">writefiles</code></td>
<td>
<p>(experimental) simply run the code to create the html and not write the .obj or .stl files</p>
</td></tr>
<tr><td><code id="write4D_+3A_reprint">reprint</code></td>
<td>
<p>(logical, experimental) do you want to reprint the rgl before saving (common use by rgl functions)</p>
</td></tr>
<tr><td><code id="write4D_+3A_...">...</code></td>
<td>
<p>other options to be passed to <a href="#topic+write4D.file">write4D.file</a></p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>#Brain Template from Copyright (C) 1993-2009 Louis Collins,
#McConnell Brain Imaging Centre,
#Montreal Neurological Institute, McGill University
#6th generation non-linear symmetric brain
##Downsampled to 8mm using FSL fslmaths -subsamp2

template &lt;- readNIfTI(system.file("MNI152_T1_8mm_brain.nii.gz", package="brainR")
, reorient=FALSE)
dtemp &lt;- dim(template)
### 4500 - value that empirically value that presented a brain with gyri
### lower values result in a smoother surface
brain &lt;- contour3d(template, x=1:dtemp[1], y=1:dtemp[2],
z=1:dtemp[3], level = 4500, alpha = 0.8, draw = FALSE)

### Example data courtesy of Daniel Reich
### Each visit is a binary mask of lesions in the brain
imgs &lt;- paste("Visit_", 1:5, "_8mm.nii.gz", sep="")
files &lt;- sapply(imgs, system.file, package='brainR')
scene &lt;- list(brain)
## loop through images and thresh
nimgs &lt;- length(imgs)
cols &lt;- rainbow(nimgs)
for (iimg in 1:nimgs) {
mask &lt;- readNIfTI(files[iimg], reorient=FALSE)
if (length(dim(mask)) &gt; 3) mask &lt;- mask[,,,1]
### use 0.99 for level of mask - binary
  activation &lt;- contour3d(mask, level = c(0.99), alpha = 1,
  add = TRUE, color=cols[iimg], draw=FALSE)
## add these triangles to the list
scene &lt;- c(scene, list(activation))
}
## make output image names from image names
fnames &lt;- c("brain.stl", gsub(".nii.gz", ".stl", imgs, fixed=TRUE))
fnames = file.path(tempdir(), fnames)
outfile &lt;-  file.path(tempdir(), "index.html")
write4D(scene=scene, fnames=fnames, outfile=outfile, standalone=TRUE, 
rescale=TRUE)
if (interactive()) {
if (requireNamespace("servr", quietly = TRUE)) {
   servr::httd(tempdir())
}
}
unlink(outfile)

</code></pre>

<hr>
<h2 id='write4D.file'>Write a 4D scene</h2><span id='topic+write4D.file'></span>

<h3>Description</h3>

<p>This function takes in a scene and writes it out to a series of files
either with the stl format or obj format
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write4D.file(
  scene = NULL,
  outfile = "index_4D.html",
  fnames,
  visible = TRUE,
  opacity = 1,
  colors = NULL,
  captions = "",
  standalone = FALSE,
  rescale = FALSE,
  index.file = system.file("index_template.html", package = "brainR"),
  toggle = "checkbox",
  xtkgui = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="write4D.file_+3A_scene">scene</code></td>
<td>
<p>- list of 3D triangles (see <a href="misc3d.html#topic+contour3d">contour3d</a>).  If a multicolored
object is to be rendered (multiple contours with one control) - it must be in a 
list</p>
</td></tr>
<tr><td><code id="write4D.file_+3A_outfile">outfile</code></td>
<td>
<p>- html filename that is to be exported</p>
</td></tr>
<tr><td><code id="write4D.file_+3A_fnames">fnames</code></td>
<td>
<p>- filenames for the 3D surfaces in the scene - needs to 
be the same length as scene</p>
</td></tr>
<tr><td><code id="write4D.file_+3A_visible">visible</code></td>
<td>
<p>- logical vector indicating which structures are visible in 
html file</p>
</td></tr>
<tr><td><code id="write4D.file_+3A_opacity">opacity</code></td>
<td>
<p>- list of alpha values - same length as scene; if sub-structures
are present, then the each list element has length the number of structures</p>
</td></tr>
<tr><td><code id="write4D.file_+3A_colors">colors</code></td>
<td>
<p>- character vector of colors (col2rgb is applied)</p>
</td></tr>
<tr><td><code id="write4D.file_+3A_captions">captions</code></td>
<td>
<p>- labels for checkboxes on html webpage</p>
</td></tr>
<tr><td><code id="write4D.file_+3A_standalone">standalone</code></td>
<td>
<p>- logical - should this be able to be rendered offline?</p>
</td></tr>
<tr><td><code id="write4D.file_+3A_rescale">rescale</code></td>
<td>
<p>- rescale the scene? - in beta</p>
</td></tr>
<tr><td><code id="write4D.file_+3A_index.file">index.file</code></td>
<td>
<p>- template html file used</p>
</td></tr>
<tr><td><code id="write4D.file_+3A_toggle">toggle</code></td>
<td>
<p>- (experimental) &quot;checkbox&quot; (default) or &quot;radio&quot; for radio or checkboxes to switch thing</p>
</td></tr>
<tr><td><code id="write4D.file_+3A_xtkgui">xtkgui</code></td>
<td>
<p>- (experimental) Logical to use xtkgui for objects</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="rgl.html#topic+writeOBJ">writeOBJ</a></code>, <code><a href="rgl.html#topic+writeSTL">writeSTL</a></code>, 
<code><a href="misc3d.html#topic+contour3d">contour3d</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
template &lt;- readNIfTI(system.file("MNI152_T1_8mm_brain.nii.gz", package="brainR")
, reorient=FALSE)
dtemp &lt;- dim(template)
### 4500 - value that empirically value that presented a brain with gyri
### lower values result in a smoother surface
brain &lt;- contour3d(template, x=1:dtemp[1], y=1:dtemp[2],
z=1:dtemp[3], level = 4500, alpha = 0.8, draw = FALSE)

### Example data courtesy of Daniel Reich
### Each visit is a binary mask of lesions in the brain
imgs &lt;- paste("Visit_", 1:5, "_8mm.nii.gz", sep="")
files &lt;- sapply(imgs, system.file, package='brainR')
scene &lt;- list(brain)
## loop through images and thresh
nimgs &lt;- length(imgs)
cols &lt;- rainbow(nimgs)
for (iimg in 1:nimgs) {
mask &lt;- readNIfTI(files[iimg], reorient=FALSE)
if (length(dim(mask)) &gt; 3) mask &lt;- mask[,,,1]
### use 0.99 for level of mask - binary
  activation &lt;- contour3d(mask, level = c(0.99), alpha = 1,
  add = TRUE, color=cols[iimg], draw=FALSE)
## add these triangles to the list
scene &lt;- c(scene, list(activation))
}
## make output image names from image names
fnames &lt;- c("brain.stl", gsub(".nii.gz", ".stl", imgs, fixed=TRUE))
fnames = file.path(tempdir(), fnames)
outfile &lt;-  file.path(tempdir(), "index.html")
write4D.file(
scene=scene, fnames=fnames, 
visible = FALSE,
outfile=outfile, standalone=TRUE, rescale=TRUE)



unlink(outfile)
unlink(fnames)
</code></pre>

<hr>
<h2 id='writeTrianglesSTL'>Write STL triangles (without recalling the ids)</h2><span id='topic+writeTrianglesSTL'></span>

<h3>Description</h3>

<p>This is code extracted from <code><a href="rgl.html#topic+writeSTL">writeSTL</a></code> in 
<code>rgl</code>.  This allows users to write the triangles in STL
without reprinting the rgl (which takes time)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>writeTrianglesSTL(scene, con, ascii = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="writeTrianglesSTL_+3A_scene">scene</code></td>
<td>
<p>list of triangles (that have class Triangles3D)</p>
</td></tr>
<tr><td><code id="writeTrianglesSTL_+3A_con">con</code></td>
<td>
<p>filename or connection of stl file to write</p>
</td></tr>
<tr><td><code id="writeTrianglesSTL_+3A_ascii">ascii</code></td>
<td>
<p>indicator if the file should be written in
ascii or binary</p>
</td></tr>
</table>


<h3>Value</h3>

<p>filename (invisible) of stl object
</p>

<hr>
<h2 id='writeWebGL_split'>Write WebGL with split triangles</h2><span id='topic+writeWebGL_split'></span>

<h3>Description</h3>

<p>Adapted <a href="rgl.html#topic+writeWebGL">writeWebGL</a> function that splits the triangles into 
65535 vertices
</p>


<h3>Usage</h3>

<pre><code class='language-R'>writeWebGL_split(ids = rgl.ids()$id, writeIt = TRUE, verb = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="writeWebGL_split_+3A_ids">ids</code></td>
<td>
<p>- rgl ids (see <a href="rgl.html#topic+rgl.ids">rgl.ids</a>)</p>
</td></tr>
<tr><td><code id="writeWebGL_split_+3A_writeit">writeIt</code></td>
<td>
<p>- (logical) write the file out</p>
</td></tr>
<tr><td><code id="writeWebGL_split_+3A_verb">verb</code></td>
<td>
<p>- verbose output</p>
</td></tr>
<tr><td><code id="writeWebGL_split_+3A_...">...</code></td>
<td>
<p>- further arguments passed to <a href="rgl.html#topic+writeWebGL">writeWebGL</a></p>
</td></tr>
</table>


<h3>Value</h3>

<p>if writeIt is TRUE, then returns the value from <a href="rgl.html#topic+writeWebGL">writeWebGL</a>.
Otherwise, returns the split triangles from the rgl objects
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
#Brain Template from Copyright (C) 1993-2009 Louis Collins, 
#McConnell Brain Imaging Centre, 
#Montreal Neurological Institute, McGill University
#6th generation non-linear symmetric brain
template &lt;- readNIfTI(system.file("MNI152_T1_2mm_brain.nii.gz", package="brainR")
, reorient=FALSE) 
dtemp &lt;- dim(template)
### 4500 - value that empirically value that presented a brain with gyri
### lower values result in a smoother surface
brain &lt;- contour3d(template, x=1:dtemp[1], y=1:dtemp[2], 
z=1:dtemp[3], level = 4500, alpha = 0.1, draw = FALSE)
drawScene.rgl(brain)
### this would be the ``activation'' or surface you want to render - 
# hyper-intense white matter
contour3d(template, level = c(8200, 8250), 
alpha = c(0.5, 0.8), add = TRUE, color=c("yellow", "red"))
### add text
text3d(x=dtemp[1]/2, y=dtemp[2]/2, z = dtemp[3]*0.98, text="Top")
text3d(x=-0.98, y=dtemp[2]/2, z = dtemp[3]/2, text="Right")
fname &lt;- "knitted_webGL.html"
writeWebGL_split(dir=getwd(), filename =fname, 
template = system.file("my_template.html", package="brainR"), width=500, 
writeIt=TRUE)
browseURL(fname)

## End(Not run)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
