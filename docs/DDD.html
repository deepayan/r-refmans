<!DOCTYPE html><html><head><title>Help for package DDD</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {DDD}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#DDD-package'><p>DDD: Diversity-Dependent Diversification</p></a></li>
<li><a href='#bd_loglik'><p>Loglikelihood for diversity-independent diversification model</p></a></li>
<li><a href='#bd_ML'><p>Maximization of the loglikelihood under the diversity-independent, possibly</p>
time-dependent diversification model</a></li>
<li><a href='#brts2phylo'><p>Function to convert a set of branching times into a</p>
phylogeny with random topology
This code is taken from the package TESS by Sebastian Hoehna, where the function
is called tess.create.phylo</a></li>
<li><a href='#conv'><p>Function to do convolution of two vectors</p></a></li>
<li><a href='#dd_KI_loglik'><p>Loglikelihood for diversity-dependent diversification models with decoupling</p>
of a subclade from a main clade at time t = t_d</a></li>
<li><a href='#dd_KI_ML'><p>Maximization of the loglikelihood under a diversity-dependent</p>
diversification model with decoupling of a subclade's diversication dynamics
from the main clade's dynamics</a></li>
<li><a href='#dd_KI_sim'><p>Function to simulate a key innovation in macro-evolution with the innovative</p>
clade decoupling from the diversity-dependent diversification dynamics of
the main clade</a></li>
<li><a href='#dd_loglik'><p>Loglikelihood for diversity-dependent diversification models</p></a></li>
<li><a href='#dd_LR'><p>Bootstrap likelihood ratio test of diversity-dependent diversification model</p></a></li>
<li><a href='#dd_ML'><p>Maximization of the loglikelihood under a diversity-dependent</p>
diversification model</a></li>
<li><a href='#dd_MS_loglik'><p>Loglikelihood for macro-evolutionary succession under diversity-dependent</p>
diversification with the key innovation at time t = t_d</a></li>
<li><a href='#dd_MS_ML'><p>Maximization of the loglikelihood under a diversity-dependent</p>
diversification model with decoupling of a subclade's diversication dynamics
from the main clade's dynamics</a></li>
<li><a href='#dd_MS_sim'><p>Function to simulate the macro-evolutionary succession process assuming</p>
diversity-dependent diversification</a></li>
<li><a href='#dd_multiple_KI_loglik'><p>Loglikelihood for diversity-dependent diversification models with multiple</p>
decoupling (rate shift) events</a></li>
<li><a href='#dd_sim'><p>Function to simulate the diversity-dependent diversification process</p></a></li>
<li><a href='#dd_SR_loglik'><p>Loglikelihood for diversity-dependent diversification models with a shift in</p>
the parameters at time t = tshift</a></li>
<li><a href='#dd_SR_ML'><p>Maximization of the loglikelihood under a diversity-dependent</p>
diversification model with a shift in the parameters</a></li>
<li><a href='#dd_SR_sim'><p>Function to simulate the diversity-dependent diversification process with a</p>
shift in one or more of the parameters</a></li>
<li><a href='#L2brts'><p>Function to convert a table with speciation and extinction events to a set</p>
of branching times</a></li>
<li><a href='#L2phylo'><p>Function to convert a table with speciation and extinction events to a</p>
phylogeny</a></li>
<li><a href='#optimizer'><p>Carries out optimization (finding a minimum)</p></a></li>
<li><a href='#phylo2L'><p>Function to convert phylogeny to a table with speciation and extinction</p>
events</a></li>
<li><a href='#rng_respecting_sample'><p>Sampling in which zero probabilities are removed</p></a></li>
<li><a href='#roundn'><p>Rounds up in the usual manner</p></a></li>
<li><a href='#sample2'><p>Takes samples in the usual manner</p></a></li>
<li><a href='#simplex'><p>Carries out optimization using a simplex algorithm (finding a minimum)</p></a></li>
<li><a href='#td_sim'><p>Simulation of a diversity-dependent-like time-dependent process</p></a></li>
<li><a href='#transform_pars'><p>Transforming parameters from -Inf to Inf into parameters</p>
from -1 to 1</a></li>
<li><a href='#untransform_pars'><p>Untransforming parameters from -1 to 1 into parameters</p>
from -Inf to Inf.</a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Diversity-Dependent Diversification</td>
</tr>
<tr>
<td>Version:</td>
<td>5.2.2</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-07-10</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>deSolve, ape, phytools, subplex, DEoptim, Matrix, expm,
SparseM, Rcpp (&ge; 1.0.10)</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp (&ge; 1.0.10), RcppEigen, BH (&ge; 1.81.0-1)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat (&ge; 3.0.0), testit, igraph</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Description:</td>
<td>
 Implements maximum likelihood and bootstrap methods based on
 the diversity-dependent birth-death process to test whether
 speciation or extinction are diversity-dependent, under various
 models including various types of key innovations.
 See Etienne et al. 2012, Proc. Roy. Soc. B 279: 1300-1309,
 &lt;<a href="https://doi.org/10.1098%2Frspb.2011.1439">doi:10.1098/rspb.2011.1439</a>&gt;,
 Etienne &amp; Haegeman 2012, Am. Nat. 180: E75-E89,
 &lt;<a href="https://doi.org/10.1086%2F667574">doi:10.1086/667574</a>&gt;,
 Etienne et al. 2016. Meth. Ecol. Evol. 7: 1092-1099,
 &lt;<a href="https://doi.org/10.1111%2F2041-210X.12565">doi:10.1111/2041-210X.12565</a>&gt; and
 Laudanno et al. 2021. Syst. Biol. 70: 389–407,
 &lt;<a href="https://doi.org/10.1093%2Fsysbio%2Fsyaa048">doi:10.1093/sysbio/syaa048</a>&gt;.
 Also contains functions to simulate the diversity-dependent
 process.</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-07-10 11:00:23 UTC; rampa</td>
</tr>
<tr>
<td>Author:</td>
<td>Rampal S. Etienne <a href="https://orcid.org/0000-0003-2142-7612"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Bart Haegeman <a href="https://orcid.org/0000-0003-2325-4727"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Hanno Hildenbrandt
    <a href="https://orcid.org/0000-0002-6784-1037"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [ctb],
  Giovanni Laudanno <a href="https://orcid.org/0000-0002-2952-3345"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Rampal S. Etienne &lt;r.s.etienne@rug.nl&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-07-10 23:40:47 UTC</td>
</tr>
</table>
<hr>
<h2 id='DDD-package'>DDD: Diversity-Dependent Diversification</h2><span id='topic+DDD'></span><span id='topic+DDD-package'></span>

<h3>Description</h3>

<p>Implements maximum likelihood and bootstrap methods based on the diversity-dependent birth-death process to test whether speciation or extinction are diversity-dependent, under various models including various types of key innovations. See Etienne et al. 2012, Proc. Roy. Soc. B 279: 1300-1309, <a href="https://doi.org/10.1098/rspb.2011.1439">doi:10.1098/rspb.2011.1439</a>, Etienne &amp; Haegeman 2012, Am. Nat. 180: E75-E89, <a href="https://doi.org/10.1086/667574">doi:10.1086/667574</a>, Etienne et al. 2016. Meth. Ecol. Evol. 7: 1092-1099, <a href="https://doi.org/10.1111/2041-210X.12565">doi:10.1111/2041-210X.12565</a> and Laudanno et al. 2021. Syst. Biol. 70: 389–407, <a href="https://doi.org/10.1093/sysbio/syaa048">doi:10.1093/sysbio/syaa048</a>. Also contains functions to simulate the diversity-dependent process.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Rampal S. Etienne <a href="mailto:r.s.etienne@rug.nl">r.s.etienne@rug.nl</a> (<a href="https://orcid.org/0000-0003-2142-7612">ORCID</a>)
</p>
<p>Authors:
</p>

<ul>
<li><p> Bart Haegeman <a href="mailto:bart.haegeman@sete.cnrs.fr">bart.haegeman@sete.cnrs.fr</a> (<a href="https://orcid.org/0000-0003-2325-4727">ORCID</a>)
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> Hanno Hildenbrandt <a href="mailto:h.hildenbrandt@rug.nl">h.hildenbrandt@rug.nl</a> (<a href="https://orcid.org/0000-0002-6784-1037">ORCID</a>) [contributor]
</p>
</li>
<li><p> Giovanni Laudanno <a href="mailto:glaudanno@gmail.com">glaudanno@gmail.com</a> (<a href="https://orcid.org/0000-0002-2952-3345">ORCID</a>) [contributor]
</p>
</li></ul>


<hr>
<h2 id='bd_loglik'>Loglikelihood for diversity-independent diversification model</h2><span id='topic+bd_loglik'></span>

<h3>Description</h3>

<p>This function computes loglikelihood of a diversity-independent
diversification model for a given set of branching times and parameter
values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bd_loglik(
  pars1,
  pars2,
  brts,
  missnumspec,
  methode = "odeint::runge_kutta_cash_karp54"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bd_loglik_+3A_pars1">pars1</code></td>
<td>
<p>Vector of parameters:
<br /> <br /> <code>pars1[1]</code> corresponds to
lambda0 (speciation rate)
<br /> <code>pars1[2]</code> corresponds to mu0 (extinction
rate)
<br /> <code>pars1[3]</code> corresponds to lambda1 (decline parameter in
speciation rate) or K in diversity-dependence-like models
<br /> <code>pars1[4]</code> corresponds to mu1 (decline parameter in extinction rate)</p>
</td></tr>
<tr><td><code id="bd_loglik_+3A_pars2">pars2</code></td>
<td>
<p>Vector of model settings:
<br /> <br /> <code>pars2[1]</code> sets the
model of time-dependence:
<br /> - <code>pars2[1] == 0</code> no time dependence
<br /> - <code>pars2[1] == 1</code> speciation and/or extinction rate is exponentially
declining with time
<br /> - <code>pars2[1] == 2</code> stepwise decline in
speciation rate as in diversity-dependence without extinction
<br /> - <code>pars2[1] == 3</code> decline in speciation rate following deterministic
logistic equation for ddmodel = 1
<br /> - <code>pars2[1] == 4</code> decline in
speciation rate such that the expected number of species matches with that
of ddmodel = 1 with the same mu
<br /> <br /> <code>pars2[2]</code> sets the
conditioning:
<br /> - <code>pars[2] == 0</code> conditioning on stem or crown age
<br /> - <code>pars[2] == 1</code> conditioning on stem or crown age and
non-extinction of the phylogeny
<br /> - <code>pars[2] == 2</code> conditioning on
stem or crown age and on the total number of extant taxa (including missing
species)
<br /> - <code>pars[2] == 3</code> conditioning on the total number of
extant taxa (including missing species)
<br /> <br /> <code>pars2[3]</code> sets whether
the likelihood is for the branching times (0) or the phylogeny (1)
<br /> <br /> <code>pars2[4]</code> sets whether the parameters and likelihood should be 
shown
on screen (1) or not (0)
<br /> <br /> <code>pars2[5]</code> sets whether the first data
point is stem age (1) or crown age (2)</p>
</td></tr>
<tr><td><code id="bd_loglik_+3A_brts">brts</code></td>
<td>
<p>A set of branching times of a phylogeny, all positive</p>
</td></tr>
<tr><td><code id="bd_loglik_+3A_missnumspec">missnumspec</code></td>
<td>
<p>The number of species that are in the clade but missing
in the phylogeny</p>
</td></tr>
<tr><td><code id="bd_loglik_+3A_methode">methode</code></td>
<td>
<p>The method used to solve the master equation, default is
'odeint::runge_kutta_cash_karp54'.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The loglikelihood
</p>


<h3>Author(s)</h3>

<p>Rampal S. Etienne, Bart Haegeman &amp; Cesar Martinez
</p>


<h3>References</h3>

<p>- Etienne, R.S. et al. 2012, Proc. Roy. Soc. B 279: 1300-1309,
doi: 10.1098/rspb.2011.1439 <br /> - Etienne, R.S. &amp; B. Haegeman 2012. Am. Nat.
180: E75-E89, doi: 10.1086/667574
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bd_ML">bd_ML</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>bd_loglik(pars1 = c(0.5,0.1), pars2 = c(0,1,1,0,2), brts = 1:10, 
missnumspec = 0)
</code></pre>

<hr>
<h2 id='bd_ML'>Maximization of the loglikelihood under the diversity-independent, possibly
time-dependent diversification model</h2><span id='topic+bd_ML'></span>

<h3>Description</h3>

<p>This function computes the maximum likelihood estimates of the parameters of
a diversity-independent diversification model for a given set of
phylogenetic branching times.  It also outputs the corresponding
loglikelihood that can be used in model comparisons.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bd_ML(
  brts,
  initparsopt = c(0.1, 0.05 * (tdmodel &lt;= 1) + 10 * (length(brts) + missnumspec) *
    (tdmodel &gt; 1)),
  idparsopt = c(1, 2 + (tdmodel &gt; 1)),
  idparsfix = (1:4)[-idparsopt],
  parsfix = rep(0, 4)[idparsfix],
  missnumspec = 0,
  tdmodel = 0,
  cond = 1,
  btorph = 1,
  soc = 2,
  tol = c(0.001, 1e-04, 1e-06),
  maxiter = 1000 * round((1.25)^length(idparsopt)),
  changeloglikifnoconv = FALSE,
  optimmethod = "subplex",
  num_cycles = 1,
  methode = "odeint::runge_kutta_cash_karp54",
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bd_ML_+3A_brts">brts</code></td>
<td>
<p>A set of branching times of a phylogeny, all positive</p>
</td></tr>
<tr><td><code id="bd_ML_+3A_initparsopt">initparsopt</code></td>
<td>
<p>The initial values of the parameters that must be
optimized</p>
</td></tr>
<tr><td><code id="bd_ML_+3A_idparsopt">idparsopt</code></td>
<td>
<p>The ids of the parameters that must be optimized, e.g. 1:3
for intrinsic speciation rate, extinction rate and carrying capacity.  The
ids are defined as follows: <br /> id == 1 corresponds to lambda0 (speciation
rate) <br /> id == 2 corresponds to mu0 (extinction rate) <br /> id == 3
corresponds to lamda1 (parameter controlling decline in speciation rate with
time) <br /> id == 4 corresponds to mu1 (parameter controlling decline in
extinction rate with time)</p>
</td></tr>
<tr><td><code id="bd_ML_+3A_idparsfix">idparsfix</code></td>
<td>
<p>The ids of the parameters that should not be optimized,
e.g. c(1,3) if lambda0 and lambda1 should not be optimized, but only mu0 and
mu1. In that case idparsopt must be c(2,4). The default is to fix all
parameters not specified in idparsopt.</p>
</td></tr>
<tr><td><code id="bd_ML_+3A_parsfix">parsfix</code></td>
<td>
<p>The values of the parameters that should not be optimized</p>
</td></tr>
<tr><td><code id="bd_ML_+3A_missnumspec">missnumspec</code></td>
<td>
<p>The number of species that are in the clade but missing
in the phylogeny</p>
</td></tr>
<tr><td><code id="bd_ML_+3A_tdmodel">tdmodel</code></td>
<td>
<p>Sets the model of time-dependence: <br />
tdmodel == 0 : constant speciation and extinction rates <br />
tdmodel == 1 : speciation and/or extinction rate is exponentially declining
with time <br />
tdmodel == 2 : stepwise decline in speciation rate as in diversity-dependence
without extinction <br />
tdmodel == 3 : decline in speciation rate following deterministic logistic
equation for ddmodel = 1 <br />
tdmodel == 4 : decline in speciation rate such that the expected number of species matches with
that of ddmodel = 1 with the same mu</p>
</td></tr>
<tr><td><code id="bd_ML_+3A_cond">cond</code></td>
<td>
<p>Conditioning: <br />
cond == 0 : conditioning on stem or crown age <br />
cond == 1 : conditioning on stem or crown age and non-extinction of the
phylogeny <br />
cond == 2 : conditioning on stem or crown age and on the total
number of extant taxa (including missing species) <br />
cond == 3 : conditioning on the total number of extant taxa (including missing species)</p>
</td></tr>
<tr><td><code id="bd_ML_+3A_btorph">btorph</code></td>
<td>
<p>Sets whether the likelihood is for the branching times (0) or
the phylogeny (1)</p>
</td></tr>
<tr><td><code id="bd_ML_+3A_soc">soc</code></td>
<td>
<p>Sets whether stem or crown age should be used (1 or 2)</p>
</td></tr>
<tr><td><code id="bd_ML_+3A_tol">tol</code></td>
<td>
<p>Sets the tolerances in the optimization. Consists of: <br />
reltolx = relative tolerance of parameter values in optimization <br />
reltolf = relative tolerance of function value in optimization <br />
abstolx = absolute tolerance of parameter values in optimization</p>
</td></tr>
<tr><td><code id="bd_ML_+3A_maxiter">maxiter</code></td>
<td>
<p>Sets the maximum number of iterations in the optimization</p>
</td></tr>
<tr><td><code id="bd_ML_+3A_changeloglikifnoconv">changeloglikifnoconv</code></td>
<td>
<p>if TRUE the loglik will be set to -Inf if ML
does not converge</p>
</td></tr>
<tr><td><code id="bd_ML_+3A_optimmethod">optimmethod</code></td>
<td>
<p>Method used in optimization of the likelihood. Current
default is 'subplex'. Alternative is 'simplex' (default of previous
versions)</p>
</td></tr>
<tr><td><code id="bd_ML_+3A_num_cycles">num_cycles</code></td>
<td>
<p>the number of cycles of opimization. If set at Inf, it will
do as many cycles as needed to meet the tolerance set for the target function.</p>
</td></tr>
<tr><td><code id="bd_ML_+3A_methode">methode</code></td>
<td>
<p>The method used to solve the master equation under tdmodel =
4, default is 'odeint::runge_kutta_cash_karp54'.</p>
</td></tr>
<tr><td><code id="bd_ML_+3A_verbose">verbose</code></td>
<td>
<p>Show the parameters and loglikelihood for every call to the
loglik function</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The output is a dataframe containing estimated parameters and maximum
loglikelihood. The computed loglikelihood contains the factor q! m! / (q +
m)! where q is the number of species in the phylogeny and m is the number of
missing species, as explained in the supplementary material to Etienne et
al. 2012.
</p>


<h3>Value</h3>

<p>A dataframe with the following elements:<br />
</p>
<table>
<tr><td><code>lambda0</code></td>
<td>
<p> gives the maximum likelihood estimate of lambda0</p>
</td></tr>
<tr><td><code>mu0</code></td>
<td>
<p> gives the maximum likelihood estimate of mu0</p>
</td></tr>
<tr><td><code>lambda1</code></td>
<td>
<p>gives the maximum likelihood estimate of lambda1</p>
</td></tr>
<tr><td><code>mu1</code></td>
<td>
<p> gives the
maximum likelihood estimate of mu1</p>
</td></tr>
<tr><td><code>loglik</code></td>
<td>
<p> gives the maximum
loglikelihood</p>
</td></tr>
<tr><td><code>df</code></td>
<td>
<p> gives the number of estimated parameters, i.e.
degrees of feedom</p>
</td></tr>
<tr><td><code>conv</code></td>
<td>
<p> gives a message on convergence of optimization; conv = 0 means
convergence</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Rampal S. Etienne &amp; Bart Haegeman
</p>


<h3>References</h3>

<p>- Etienne, R.S. et al. 2012, Proc. Roy. Soc. B 279: 1300-1309,
doi: 10.1098/rspb.2011.1439 <br /> - Etienne, R.S. &amp; B. Haegeman 2012. Am. Nat.
180: E75-E89, doi: 10.1086/667574
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bd_loglik">bd_loglik</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
cat("Estimating parameters for a set of branching times brts with the default settings:")
brts = 1:20
bd_ML(brts = brts, cond = 1)

</code></pre>

<hr>
<h2 id='brts2phylo'>Function to convert a set of branching times into a
phylogeny with random topology
This code is taken from the package TESS by Sebastian Hoehna, where the function
is called tess.create.phylo</h2><span id='topic+brts2phylo'></span>

<h3>Description</h3>

<p>Converting a set of branching times to a phylogeny
</p>


<h3>Usage</h3>

<pre><code class='language-R'>brts2phylo(times, root = FALSE, tip.label = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="brts2phylo_+3A_times">times</code></td>
<td>
<p>Set of branching times</p>
</td></tr>
<tr><td><code id="brts2phylo_+3A_root">root</code></td>
<td>
<p>When root is FALSE, the largest branching time will be assumed to be
the crown age. When root is TRUE, it will be the stem age.</p>
</td></tr>
<tr><td><code id="brts2phylo_+3A_tip.label">tip.label</code></td>
<td>
<p>Tip labels. If set to NULL, the labels will be t1, t2, etc.</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>phy</code></td>
<td>
<p> A phylogeny of the phylo type </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Rampal S. Etienne
</p>


<h3>References</h3>

<p>- Etienne, R.S. et al. 2012, Proc. Roy. Soc. B 279: 1300-1309,
doi: 10.1098/rspb.2011.1439 <br /> - Etienne, R.S. &amp; B. Haegeman 2012. Am. Nat.
180: E75-E89, doi: 10.1086/667574
</p>

<hr>
<h2 id='conv'>Function to do convolution of two vectors</h2><span id='topic+conv'></span>

<h3>Description</h3>

<p>Convolution of two vectors
</p>


<h3>Usage</h3>

<pre><code class='language-R'>conv(x, y)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="conv_+3A_x">x</code></td>
<td>
<p>first vector</p>
</td></tr>
<tr><td><code id="conv_+3A_y">y</code></td>
<td>
<p>second vector</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector that is the convolution of x and y
</p>


<h3>Author(s)</h3>

<p>Rampal S. Etienne
</p>


<h3>References</h3>

<p>- Etienne, R.S. et al. 2012, Proc. Roy. Soc. B 279: 1300-1309,
doi: 10.1098/rspb.2011.1439 <br /> - Etienne, R.S. &amp; B. Haegeman 2012. Am. Nat.
180: E75-E89, doi: 10.1086/667574
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
conv(1:10,1:10)

</code></pre>

<hr>
<h2 id='dd_KI_loglik'>Loglikelihood for diversity-dependent diversification models with decoupling
of a subclade from a main clade at time t = t_d</h2><span id='topic+dd_KI_loglik'></span>

<h3>Description</h3>

<p>This function computes loglikelihood of a diversity-dependent
diversification model for a given set of branching times and parameter
values where the diversity-dependent dynamics of a subclade decouple from
the dynamics of the main clade at time t_d, potentially accompanied by a
shift in parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dd_KI_loglik(
  pars1,
  pars2,
  brtsM,
  brtsS,
  missnumspec,
  methode = "odeint::runge_kutta_cash_karp54"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dd_KI_loglik_+3A_pars1">pars1</code></td>
<td>
<p>Vector of parameters: <br /> <br />
<code>pars1[1]</code> corresponds to
lambda_M (speciation rate) of the main clade <br />
<code>pars1[2]</code> corresponds
to mu_M (extinction rate) of the main clade <br /> 
<code>pars1[3]</code> corresponds
to K_M (clade-level carrying capacity) of the main clade <br />
<code>pars1[4]</code> corresponds to lambda_S (speciation rate) of the subclade <br />
<code>pars1[5]</code> corresponds to mu_S (extinction rate) of the subclade <br />
<code>pars1[6]</code> corresponds to K_S (clade-level carrying capacity) of the
subclade <br />
<code>pars1[7]</code> corresponds to t_d (the time of decoupling)</p>
</td></tr>
<tr><td><code id="dd_KI_loglik_+3A_pars2">pars2</code></td>
<td>
<p>Vector of model settings: <br /> <br />
<code>pars2[1]</code> sets the
maximum number of species for which a probability must be computed.  This
must be larger than 1 + missnumspec + length(brts). <br /> <br />
<code>pars2[2]</code> sets the model of diversity-dependence: <br />
- <code>pars2[2] == 1</code> linear
dependence in speciation rate with parameter K (= diversity where speciation
= extinction)<br />
- <code>pars2[2] == 1.3</code> linear dependence in speciation
rate with parameter K' (= diversity where speciation = 0)<br />
- <code>pars2[2] == 2</code> exponential dependence in speciation rate with
parameter K (= diversity where speciation = extinction)<br /> 
- <code>pars2[2] == 2.1</code> variant of exponential dependence in speciation rate with offset at
infinity<br />
- <code>pars2[2] == 2.2</code> 1/n dependence in speciation rate<br />
- <code>pars2[2] == 2.3</code> exponential dependence in speciation rate with
parameter x (= exponent)<br />
- <code>pars2[2] == 3</code> linear dependence in
extinction rate <br />
- <code>pars2[2] == 4</code> exponential dependence in
extinction rate <br />
- <code>pars2[2] == 4.1</code> variant of exponential
dependence in extinction rate with offset at infinity<br />
- <code>pars2[2] == 4.2</code> 1/n dependence in extinction rate<br /><br />
<code>pars2[3]</code> sets the
conditioning: <br />
- <code>pars2[3] == 0</code> no conditioning (or just crown age) <br />
- <code>pars2[3] == 1</code> conditioning on non-extinction of the phylogeny <br />
- <code>pars2[3] == 2</code> conditioning on number of species and crown age;
not yet implemented <br />
- <code>pars2[3] == 3</code> conditioning on number of species only;
not yet implemented <br />
- <code>pars2[3] == 4</code> conditioning on survival of the subclade <br />
- <code>pars2[3] == 5</code> conditioning on survival of all subclades
and of both crown lineages in the main clade. This assumes that subclades
that have already shifted do not undergo another shift, i.e. shifts only
occur in the main clade. <br /> <br />
<code>pars2[4]</code> Obsolete. <br /> <br />
<code>pars2[5]</code> sets whether the parameters and likelihood should be
shown on screen (1) or not (0) <br /> <br />
<code>pars2[6]</code> sets whether the first data point is stem age (1) or crown age (2) <br /><br />
<code>pars2[7]</code> sets whether the old (incorrect) likelihood should be used (0),
or whether the new corrected likelihood should be used (1).</p>
</td></tr>
<tr><td><code id="dd_KI_loglik_+3A_brtsm">brtsM</code></td>
<td>
<p>A set of branching times of the main clade in the phylogeny,
all positive</p>
</td></tr>
<tr><td><code id="dd_KI_loglik_+3A_brtss">brtsS</code></td>
<td>
<p>A set of branching times of the subclade in the phylogeny, all
positive</p>
</td></tr>
<tr><td><code id="dd_KI_loglik_+3A_missnumspec">missnumspec</code></td>
<td>
<p>The number of species that are in the clade but missing
in the phylogeny. One can specify the sum of the missing species in main
clade and subclade or a vector c(missnumspec_M,missnumspec_S) with missing
species in main clade and subclade respectively.</p>
</td></tr>
<tr><td><code id="dd_KI_loglik_+3A_methode">methode</code></td>
<td>
<p>The method used to solve the master equation, default is
'analytical' which uses matrix exponentiation; alternatively numerical ODE
solvers can be used, such as 'odeint::runge_kutta_cash_karp54'. These were used in the
package before version 3.1.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The loglikelihood
</p>


<h3>Author(s)</h3>

<p>Rampal S. Etienne &amp; Bart Haegeman
</p>


<h3>References</h3>

<p>- Etienne, R.S. et al. 2012, Proc. Roy. Soc. B 279: 1300-1309,
doi: 10.1098/rspb.2011.1439 <br /> - Etienne, R.S. &amp; B. Haegeman 2012. Am. Nat.
180: E75-E89, doi: 10.1086/667574
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dd_KI_ML">dd_KI_ML</a></code>, <code><a href="#topic+dd_loglik">dd_loglik</a></code>
<code><a href="#topic+dd_SR_loglik">dd_SR_loglik</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
pars1 = c(0.25,0.12,25.51,1.0,0.16,8.61,9.8)
pars2 = c(200,1,0,18.8,1,2)
missnumspec = 0
brtsM = c(25.2,24.6,24.0,22.5,21.7,20.4,19.9,19.7,18.8,17.1,15.8,11.8,9.7,8.9,5.7,5.2)
brtsS = c(9.6,8.6,7.4,4.9,2.5)
dd_KI_loglik(pars1,pars2,brtsM,brtsS,missnumspec)

</code></pre>

<hr>
<h2 id='dd_KI_ML'>Maximization of the loglikelihood under a diversity-dependent
diversification model with decoupling of a subclade's diversication dynamics
from the main clade's dynamics</h2><span id='topic+dd_KI_ML'></span>

<h3>Description</h3>

<p>This function computes the maximum likelihood estimates of the parameters of
a diversity-dependent diversification model with decoupling of the
diversification dynamics of a subclade from the dynamics of the main clade
for a given set of phylogenetic branching times of main clade and subclade
and the time of splitting of the lineage that will form the subclade.  It
also outputs the corresponding loglikelihood that can be used in model
comparisons.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dd_KI_ML(
  brtsM,
  brtsS,
  tsplit,
  initparsopt = c(0.5, 0.1, 2 * (1 + length(brtsM) + missnumspec[1]), 2 * (1 +
    length(brtsS) + missnumspec[length(missnumspec)]), (tsplit + max(brtsS))/2),
  parsfix = NULL,
  idparsopt = c(1:3, 6:7),
  idparsfix = NULL,
  idparsnoshift = (1:7)[c(-idparsopt, (-1)^(length(idparsfix) != 0) * idparsfix)],
  res = 10 * (1 + length(c(brtsM, brtsS)) + sum(missnumspec)),
  ddmodel = 1,
  missnumspec = 0,
  cond = 1,
  soc = 2,
  tol = c(0.001, 1e-04, 1e-06),
  maxiter = 1000 * round((1.25)^length(idparsopt)),
  changeloglikifnoconv = FALSE,
  optimmethod = "subplex",
  num_cycles = 1,
  methode = "analytical",
  correction = TRUE,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dd_KI_ML_+3A_brtsm">brtsM</code></td>
<td>
<p>A set of branching times of the main clade in a phylogeny, all
positive</p>
</td></tr>
<tr><td><code id="dd_KI_ML_+3A_brtss">brtsS</code></td>
<td>
<p>A set of branching times of the subclade in a phylogeny, all
positive</p>
</td></tr>
<tr><td><code id="dd_KI_ML_+3A_tsplit">tsplit</code></td>
<td>
<p>The branching time at which the lineage forming the subclade
branches off, positive</p>
</td></tr>
<tr><td><code id="dd_KI_ML_+3A_initparsopt">initparsopt</code></td>
<td>
<p>The initial values of the parameters that must be
optimized</p>
</td></tr>
<tr><td><code id="dd_KI_ML_+3A_parsfix">parsfix</code></td>
<td>
<p>The values of the parameters that should not be optimized</p>
</td></tr>
<tr><td><code id="dd_KI_ML_+3A_idparsopt">idparsopt</code></td>
<td>
<p>The ids of the parameters that must be optimized, e.g. 1:7
for all parameters.  The ids are defined as follows: <br /> id == 1 corresponds
to lambda_M (speciation rate) of the main clade <br /> id == 2 corresponds to
mu_M (extinction rate) of the main clade <br /> id == 3 corresponds to K_M
(clade-level carrying capacity) of the main clade <br /> id == 4 corresponds to
lambda_S (speciation rate) of the subclade <br /> id == 5 corresponds to mu_S
(extinction rate) of the subclade <br /> id == 6 corresponds to K_S
(clade-level carrying capacity) of the subclade <br /> id == 7 corresponds to
t_d (the time of decoupling)</p>
</td></tr>
<tr><td><code id="dd_KI_ML_+3A_idparsfix">idparsfix</code></td>
<td>
<p>The ids of the parameters that should not be optimized,
e.g. c(1,3,4,6) if lambda and K should not be optimized, but only mu. In
that case idparsopt must be c(2,5,7). The default is to fix all parameters
not specified in idparsopt.</p>
</td></tr>
<tr><td><code id="dd_KI_ML_+3A_idparsnoshift">idparsnoshift</code></td>
<td>
<p>The ids of the parameters that should not shift; This
can only apply to ids 4, 5 and 6, e.g. idparsnoshift = c(4,5) means that
lambda and mu have the same values before and after tshift</p>
</td></tr>
<tr><td><code id="dd_KI_ML_+3A_res">res</code></td>
<td>
<p>sets the maximum number of species for which a probability must
be computed, must be larger than 1 + max(length(brtsM),length(brtsS))</p>
</td></tr>
<tr><td><code id="dd_KI_ML_+3A_ddmodel">ddmodel</code></td>
<td>
<p>sets the model of diversity-dependence: <br />
<code>ddmodel == 1</code> : linear dependence in speciation rate with parameter K (= diversity
where speciation = extinction)<br />
<code>ddmodel == 1.3</code> : linear dependence
in speciation rate with parameter K' (= diversity where speciation = 0)<br />
<code>ddmodel == 2</code> : exponential dependence in speciation rate with
parameter K (= diversity where speciation = extinction)<br />
<code>ddmodel == 2.1</code> : variant of exponential dependence in speciation rate with offset at
infinity<br />
<code>ddmodel == 2.2</code> : 1/n dependence in speciation rate<br />
<code>ddmodel == 2.3</code> : exponential dependence in speciation rate with
parameter x (= exponent)<br /> <code>ddmodel == 3</code> : linear dependence in
extinction rate <br />
<code>ddmodel == 4</code> : exponential dependence in
extinction rate <br />
<code>ddmodel == 4.1</code> : variant of exponential
dependence in extinction rate with offset at infinity <br />
<code>ddmodel == 4.2</code> : 1/n dependence in extinction rate with offset at infinity <br /></p>
</td></tr>
<tr><td><code id="dd_KI_ML_+3A_missnumspec">missnumspec</code></td>
<td>
<p>The number of species that are in the clade but missing
in the phylogeny. One can specify the sum of the missing species in main
clade and subclade or a vector c(missnumspec_M,missnumspec_S) with missing
species in main clade and subclade respectively.</p>
</td></tr>
<tr><td><code id="dd_KI_ML_+3A_cond">cond</code></td>
<td>
<p>Conditioning: <br />
cond == 0 : no conditioning <br />
cond == 1 : conditioning on non-extinction of the phylogeny <br /></p>
</td></tr>
<tr><td><code id="dd_KI_ML_+3A_soc">soc</code></td>
<td>
<p>Sets whether stem or crown age should be used (1 or 2); stem age
only works when cond = 0</p>
</td></tr>
<tr><td><code id="dd_KI_ML_+3A_tol">tol</code></td>
<td>
<p>Sets the tolerances in the optimization. Consists of: <br />
reltolx = relative tolerance of parameter values in optimization <br />
reltolf = relative tolerance of function value in optimization <br />
abstolx = absolute tolerance of parameter values in optimization</p>
</td></tr>
<tr><td><code id="dd_KI_ML_+3A_maxiter">maxiter</code></td>
<td>
<p>Sets the maximum number of iterations in the optimization</p>
</td></tr>
<tr><td><code id="dd_KI_ML_+3A_changeloglikifnoconv">changeloglikifnoconv</code></td>
<td>
<p>if TRUE the loglik will be set to -Inf if ML
does not converge</p>
</td></tr>
<tr><td><code id="dd_KI_ML_+3A_optimmethod">optimmethod</code></td>
<td>
<p>Method used in optimization of the likelihood. Current
default is 'subplex'. Alternative is 'simplex' (default of previous
versions)</p>
</td></tr>
<tr><td><code id="dd_KI_ML_+3A_num_cycles">num_cycles</code></td>
<td>
<p>the number of cycles of opimization. If set at Inf, it will
do as many cycles as needed to meet the tolerance set for the target function.</p>
</td></tr>
<tr><td><code id="dd_KI_ML_+3A_methode">methode</code></td>
<td>
<p>The method used to solve the master equation, default is
'analytical' which uses matrix exponentiation; alternatively numerical ODE
solvers can be used, such as 'odeint::runge_kutta_cash_karp54'. These were used in the
package before version 3.1.</p>
</td></tr>
<tr><td><code id="dd_KI_ML_+3A_correction">correction</code></td>
<td>
<p>Sets whether the correction should be applied (TRUE) or
not (FALSE)</p>
</td></tr>
<tr><td><code id="dd_KI_ML_+3A_verbose">verbose</code></td>
<td>
<p>Show the parameters and loglikelihood for every call to the
loglik function</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The output is a dataframe containing estimated parameters and maximum
loglikelihood. The computed loglikelihood contains the factor q! m!/(q + m)!
where q is the number of species in the phylogeny and m is the number of
missing species, as explained in the supplementary material to Etienne et
al. 2012.
</p>


<h3>Value</h3>

<table>
<tr><td><code>lambda_M</code></td>
<td>
<p> gives the maximum likelihood estimate of lambda of
the main clade</p>
</td></tr> <tr><td><code>mu_M</code></td>
<td>
<p> gives the maximum likelihood estimate of mu of
the main clade</p>
</td></tr> <tr><td><code>K_M</code></td>
<td>
<p> gives the maximum likelihood estimate of K of
the main clade</p>
</td></tr> <tr><td><code>lambda_2</code></td>
<td>
<p> gives the maximum likelihood estimate of
lambda of the subclade</p>
</td></tr> <tr><td><code>mu_S</code></td>
<td>
<p> gives the maximum likelihood estimate
of mu of the subclade</p>
</td></tr> <tr><td><code>K_S</code></td>
<td>
<p> gives the maximum likelihood estimate of
K of the subclade</p>
</td></tr> <tr><td><code>t_d</code></td>
<td>
<p> gives the time of the decoupling event</p>
</td></tr>
<tr><td><code>loglik</code></td>
<td>
<p> gives the maximum loglikelihood</p>
</td></tr> <tr><td><code>df</code></td>
<td>
<p> gives the number
of estimated parameters, i.e. degrees of feedom</p>
</td></tr> <tr><td><code>conv</code></td>
<td>
<p> gives a
message on convergence of optimization; conv = 0 means convergence</p>
</td></tr>
</table>


<h3>Note</h3>

<p>The optimization may get trapped in local optima. Try different
starting values to search for the global optimum.
</p>


<h3>Author(s)</h3>

<p>Rampal S. Etienne &amp; Bart Haegeman
</p>


<h3>References</h3>

<p>- Etienne, R.S. et al. 2012, Proc. Roy. Soc. B 279: 1300-1309,
doi: 10.1098/rspb.2011.1439 <br /> - Etienne, R.S. &amp; B. Haegeman 2012. Am. Nat.
180: E75-E89, doi: 10.1086/667574
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dd_KI_loglik">dd_KI_loglik</a></code>, <code><a href="#topic+dd_ML">dd_ML</a></code>,
<code><a href="#topic+dd_SR_ML">dd_SR_ML</a></code>,
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
cat("This will estimate parameters for two sets of branching times brtsM, brtsS\n")
cat("without conditioning.\n")
cat("The tolerance of the optimization is set high so runtime is fast in this example.\n")
cat("In real applications, use the default or more stringent settins for tol.\n")
brtsM = 4:10
brtsS = seq(0.1,3.5,0.7)
tsplit = 5
dd_KI_ML(brtsM = brtsM, brtsS = brtsS, tsplit = tsplit, idparsopt = c(1:3,6,7),
  initparsopt = c(0.885, 2e-14, 6.999, 6.848, 4.001), idparsfix = NULL,
  parsfix = NULL,idparsnoshift = c(4,5), cond = 0, tol = c(3E-1,3E-1,3E-1),
  optimmethod = 'simplex')

</code></pre>

<hr>
<h2 id='dd_KI_sim'>Function to simulate a key innovation in macro-evolution with the innovative
clade decoupling from the diversity-dependent diversification dynamics of
the main clade</h2><span id='topic+dd_KI_sim'></span>

<h3>Description</h3>

<p>Simulating a diversity-dependent diversification process where at a given
time a new clade emerges with different inherent speciation rate and
extinction rate and clade-level carrying capacity and with decoupled
dynamics
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dd_KI_sim(pars, age, ddmodel = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dd_KI_sim_+3A_pars">pars</code></td>
<td>
<p>Vector of parameters: <br /> <br /> <code>pars[1]</code> corresponds to
lambda_M (speciation rate of the main clade) <br /> <code>pars[2]</code> corresponds
to mu_M (extinction rate of the main clade) <br /> <code>pars[3]</code> corresponds
to K_M (clade-level carrying capacity of the main clade) <code>pars[4]</code>
corresponds to lambda_S (speciation rate of the subclade) <br /> <code>pars[5]</code>
corresponds to mu_S (extinction rate of the subclade) <br /> <code>pars[5]</code>
corresponds to K_S (clade-level carrying capacity of the subclade) <br />
<code>pars[7]</code> tinn, the time the shift in rates occurs in the lineage
leading to the subclade</p>
</td></tr>
<tr><td><code id="dd_KI_sim_+3A_age">age</code></td>
<td>
<p>Sets the crown age for the simulation</p>
</td></tr>
<tr><td><code id="dd_KI_sim_+3A_ddmodel">ddmodel</code></td>
<td>
<p>Sets the model of diversity-dependence: <br /> <code>ddmodel ==
1</code> : linear dependence in speciation rate with parameter K (= diversity
where speciation = extinction)<br /> <code>ddmodel == 1.3</code> : linear dependence
in speciation rate with parameter K' (= diversity where speciation = 0)<br />
<code>ddmodel == 2</code> : exponential dependence in speciation rate with
parameter K (= diversity where speciation = extinction)<br /> <code>ddmodel ==
2.1</code> : variant of exponential dependence in speciation rate with offset at
infinity<br /> <code>ddmodel == 2.2</code> : 1/n dependence in speciation rate<br />
<code>ddmodel == 2.3</code> : exponential dependence in speciation rate with
parameter x (= exponent)<br /> <code>ddmodel == 3</code> : linear dependence in
extinction rate <br /> <code>ddmodel == 4</code> : exponential dependence in
extinction rate <br /> <code>ddmodel == 4.1</code> : variant of exponential
dependence in extinction rate with offset at infinity <br /> <code>ddmodel ==
4.2</code> : 1/n dependence in extinction rate with offset at infinity</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>out</code></td>
<td>
<p> A list with the following elements: The first element
is the tree of extant species in phylo format <br /> The second element is the
tree of all species, including extinct species, in phylo format <br /> The
third element is a matrix of all species where <br /> - the first column is the
time at which a species is born <br /> - the second column is the label of the
parent of the species; positive and negative values only indicate whether
the species belongs to the left or right crown lineage <br /> - the third
column is the label of the daughter species itself; positive and negative
values only indicate whether the species belongs to the left or right crown
lineage <br /> - the fourth column is the time of extinction of the species <br />
If the fourth element equals -1, then the species is still extant.<br /> - the
fifth column indicates whether the species belong to the main clade (0) or
the subclade (1)<br /> The fourth element is the subclade tree of extant
species (without stem) <br /> The fifth element is the subclade tree of all
species (without stem) <br /> The sixth element is the same as the first,
except that it has attributed 0 for the main clade and 1 for the subclade<br />
The seventh element is the same as the Second, except that it has attributed
0 for the main clade and 1 for the subclade<br /> The sixth and seventh element
will be NULL if the subclade does not exist (because it went extinct).  </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Rampal S. Etienne
</p>


<h3>References</h3>

<p>- Etienne, R.S. et al. 2012, Proc. Roy. Soc. B 279: 1300-1309,
doi: 10.1098/rspb.2011.1439 <br /> - Etienne, R.S. &amp; B. Haegeman 2012. Am. Nat.
180: E75-E89, doi: 10.1086/667574
</p>


<h3>Examples</h3>

<pre><code class='language-R'> dd_KI_sim(c(0.2,0.1,20,0.1,0.05,30,4),10) 
</code></pre>

<hr>
<h2 id='dd_loglik'>Loglikelihood for diversity-dependent diversification models</h2><span id='topic+dd_loglik'></span>

<h3>Description</h3>

<p>This function computes loglikelihood of a diversity-dependent
diversification model for a given set of branching times and parameter
values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dd_loglik(pars1, pars2, brts, missnumspec, methode = "analytical")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dd_loglik_+3A_pars1">pars1</code></td>
<td>
<p>Vector of parameters: 
<br /> <br /> <code>pars1[1]</code> corresponds to
lambda (speciation rate)
<br /> <code>pars1[2]</code> corresponds to mu (extinction
rate)
<br /> <code>pars1[3]</code> corresponds to K (clade-level carrying capacity)</p>
</td></tr>
<tr><td><code id="dd_loglik_+3A_pars2">pars2</code></td>
<td>
<p>Vector of model settings: 
<br /> <br /> <code>pars2[1]</code> sets the
maximum number of species for which a probability must be computed.  This
must be larger than 1 + missnumspec + length(brts).
<br /> <br /> <code>pars2[2]</code>
sets the model of diversity-dependence:
<br /> - <code>pars2[2] == 1</code> linear
dependence in speciation rate with parameter K (= diversity where speciation
= extinction)
<br /> - <code>pars2[2] == 1.3</code> linear dependence in speciation
rate with parameter K' (= diversity where speciation = 0)
<br /> - <code>pars2[2] == 1.4</code> : positive diversity-dependence in speciation rate
with parameter K' (= diversity where speciation rate reaches half its
maximum); lambda = lambda0 * S/(S + K') where S is species richness
<br /> - <code>pars2[2] == 1.5</code> : positive and negative diversity-dependence in
speciation rate with parameter K' (= diversity where speciation = 0); lambda
= lambda0 * S/K' * (1 - S/K') where S is species richness
<br /> - <code>pars2[2] == 2</code> exponential dependence in speciation rate with
parameter K (= diversity where speciation = extinction)
<br /> - <code>pars2[2]
== 2.1</code> variant of exponential dependence in speciation rate with offset at
infinity
<br /> - <code>pars2[2] == 2.2</code> 1/n dependence in speciation rate
<br /> - <code>pars2[2] == 2.3</code> exponential dependence in speciation rate with
parameter x (= exponent)
<br /> - <code>pars2[2] == 3</code> linear dependence in
extinction rate
<br /> - <code>pars2[2] == 4</code> exponential dependence in
extinction rate
<br /> - <code>pars2[2] == 4.1</code> variant of exponential
dependence in extinction rate with offset at infinity
<br /> - <code>pars2[2] ==
4.2</code> 1/n dependence in extinction rate
<br /> - <code>pars2[2] == 5</code> linear
dependence in speciation and extinction rate
<br /> <br /> <code>pars2[3]</code> sets
the conditioning:
<br /> - <code>pars2[3] == 0</code> conditioning on stem or crown
age
<br /> - <code>pars2[3] == 1</code> conditioning on stem or crown age and
non-extinction of the phylogeny
<br /> - <code>pars2[3] == 2</code> conditioning on
stem or crown age and on the total number of extant taxa (including missing
species)
<br /> - <code>pars2[3] == 3</code> conditioning on the total number of
extant taxa (including missing species)
<br /> <br /> <code>pars2[4]</code> sets whether
the likelihood is for the branching times (0) or the phylogeny (1)
<br /> <br /> <code>pars2[5]</code> sets whether the parameters and likelihood should be shown
on screen (1) or not (0)
<br /> <br /> <code>pars2[6]</code> sets whether the first data
point is stem age (1) or crown age (2)</p>
</td></tr>
<tr><td><code id="dd_loglik_+3A_brts">brts</code></td>
<td>
<p>A set of branching times of a phylogeny, all positive</p>
</td></tr>
<tr><td><code id="dd_loglik_+3A_missnumspec">missnumspec</code></td>
<td>
<p>The number of species that are in the clade but missing
in the phylogeny</p>
</td></tr>
<tr><td><code id="dd_loglik_+3A_methode">methode</code></td>
<td>
<p>The method used to solve the master equation, default is
'analytical' which uses matrix exponentiation; alternatively numerical ODE
solvers can be used. Before version 3.1 these were solvers from the deSolve
package such as 'lsoda' and 'ode45'. Currently solvers from odeint are used,
such as 'odeint::runge_kutta_cash_karp54', 'odeint::runge_kutta_fehlberg78',
'odeint::runge_kutta_dopri5', or odeint::bulirsch_stoer'. The first two are
recommended in most cases.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The loglikelihood
</p>


<h3>Author(s)</h3>

<p>Rampal S. Etienne &amp; Bart Haegeman
</p>


<h3>References</h3>

<p>- Etienne, R.S. et al. 2012, Proc. Roy. Soc. B 279: 1300-1309,
doi: 10.1098/rspb.2011.1439 <br /> - Etienne, R.S. &amp; B. Haegeman 2012. Am. Nat.
180: E75-E89, doi: 10.1086/667574
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dd_ML">dd_ML</a></code>, <code><a href="#topic+dd_SR_loglik">dd_SR_loglik</a></code>,
<code><a href="#topic+dd_KI_loglik">dd_KI_loglik</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dd_loglik(pars1 = c(0.5,0.1,100), pars2 = c(100,1,1,1,0,2), brts = 1:10, missnumspec = 0) 
</code></pre>

<hr>
<h2 id='dd_LR'>Bootstrap likelihood ratio test of diversity-dependent diversification model</h2><span id='topic+dd_LR'></span>

<h3>Description</h3>

<p>This function computes the maximum likelihood and the associated estimates
of the parameters of a diversity-dependent diversification model for a given
set of phylogenetic branching times. It then performs a bootstrap likelihood
ratio test of the diversity-dependent (DD) model against the constant-rates
(CR) birth-death model. Finally, it computes the power of this test.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dd_LR(
  brts,
  initparsoptDD,
  initparsoptCR,
  missnumspec,
  outputfilename = NULL,
  seed = 42,
  endmc = 1000,
  alpha = 0.05,
  plotit = TRUE,
  res = 10 * (1 + length(brts) + missnumspec),
  ddmodel = 1,
  cond = 1,
  btorph = 1,
  soc = 2,
  tol = c(0.001, 1e-04, 1e-06),
  maxiter = 2000,
  changeloglikifnoconv = FALSE,
  optimmethod = "subplex",
  methode = "analytical"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dd_LR_+3A_brts">brts</code></td>
<td>
<p>A set of branching times of a phylogeny, all positive</p>
</td></tr>
<tr><td><code id="dd_LR_+3A_initparsoptdd">initparsoptDD</code></td>
<td>
<p>The initial values of the parameters that must be
optimized for the diversity-dependent (DD) model: lambda_0, mu and K</p>
</td></tr>
<tr><td><code id="dd_LR_+3A_initparsoptcr">initparsoptCR</code></td>
<td>
<p>The initial values of the parameters that must be
optimized for the constant-rates (CR) model: lambda and mu</p>
</td></tr>
<tr><td><code id="dd_LR_+3A_missnumspec">missnumspec</code></td>
<td>
<p>The number of species that are in the clade but missing
in the phylogeny</p>
</td></tr>
<tr><td><code id="dd_LR_+3A_outputfilename">outputfilename</code></td>
<td>
<p>The name (and location) of the file where the output
will be saved. Default is no save.</p>
</td></tr>
<tr><td><code id="dd_LR_+3A_seed">seed</code></td>
<td>
<p>The seed for the pseudo random number generator for simulating
the bootstrap data</p>
</td></tr>
<tr><td><code id="dd_LR_+3A_endmc">endmc</code></td>
<td>
<p>The number of bootstraps</p>
</td></tr>
<tr><td><code id="dd_LR_+3A_alpha">alpha</code></td>
<td>
<p>The significance level of the test</p>
</td></tr>
<tr><td><code id="dd_LR_+3A_plotit">plotit</code></td>
<td>
<p>Boolean to plot results or not</p>
</td></tr>
<tr><td><code id="dd_LR_+3A_res">res</code></td>
<td>
<p>Sets the maximum number of species for which a probability must
be computed, must be larger than 1 + length(brts)</p>
</td></tr>
<tr><td><code id="dd_LR_+3A_ddmodel">ddmodel</code></td>
<td>
<p>Sets the model of diversity-dependence: <br /> <code>ddmodel ==
1</code> : linear dependence in speciation rate with parameter K (= diversity
where speciation = extinction)<br /> <code>ddmodel == 1.3</code> : linear dependence
in speciation rate with parameter K' (= diversity where speciation = 0)<br />
<code>ddmodel == 2</code> : exponential dependence in speciation rate with
parameter K (= diversity where speciation = extinction)<br /> <code>ddmodel ==
2.1</code> : variant of exponential dependence in speciation rate with offset at
infinity<br /> <code>ddmodel == 2.2</code> : 1/n dependence in speciation rate<br />
<code>ddmodel == 2.3</code> : exponential dependence in speciation rate with
parameter x (= exponent)<br /> <code>ddmodel == 3</code> : linear dependence in
extinction rate <br /> <code>ddmodel == 4</code> : exponential dependence in
extinction rate <br /> <code>ddmodel == 4.1</code> : variant of exponential
dependence in extinction rate with offset at infinity <br /> <code>ddmodel ==
4.2</code> : 1/n dependence in extinction rate with offset at infinity <br />
<code>ddmodel == 5</code> : linear dependence in speciation and extinction rate
<br /></p>
</td></tr>
<tr><td><code id="dd_LR_+3A_cond">cond</code></td>
<td>
<p>Conditioning: <br /> cond == 0 : conditioning on stem or crown age
<br /> cond == 1 : conditioning on stem or crown age and non-extinction of the
phylogeny <br /> cond == 2 : conditioning on stem or crown age and on the total
number of extant taxa (including missing species) <br /> cond == 3 :
conditioning on the total number of extant taxa (including missing species)
<br /> Note: cond == 3 assumes a uniform prior on stem age, as is the standard
in constant-rate birth-death models, see e.g. D. Aldous &amp; L. Popovic 2004.
Adv. Appl. Prob. 37: 1094-1115 and T. Stadler 2009. J. Theor. Biol. 261:
58-66.</p>
</td></tr>
<tr><td><code id="dd_LR_+3A_btorph">btorph</code></td>
<td>
<p>Sets whether the likelihood is for the branching times (0) or
the phylogeny (1)</p>
</td></tr>
<tr><td><code id="dd_LR_+3A_soc">soc</code></td>
<td>
<p>Sets whether stem or crown age should be used (1 or 2)</p>
</td></tr>
<tr><td><code id="dd_LR_+3A_tol">tol</code></td>
<td>
<p>Sets the tolerances in the optimization. Consists of: <br /> reltolx
= relative tolerance of parameter values in optimization <br /> reltolf =
relative tolerance of function value in optimization <br /> abstolx = absolute
tolerance of parameter values in optimization</p>
</td></tr>
<tr><td><code id="dd_LR_+3A_maxiter">maxiter</code></td>
<td>
<p>Sets the maximum number of iterations in the optimization</p>
</td></tr>
<tr><td><code id="dd_LR_+3A_changeloglikifnoconv">changeloglikifnoconv</code></td>
<td>
<p>if TRUE the loglik will be set to -Inf if ML
does not converge</p>
</td></tr>
<tr><td><code id="dd_LR_+3A_optimmethod">optimmethod</code></td>
<td>
<p>Method used in optimization of the likelihood. Current
default is 'subplex'. Alternative is 'simplex' (default of previous
versions)</p>
</td></tr>
<tr><td><code id="dd_LR_+3A_methode">methode</code></td>
<td>
<p>The method used to solve the master equation, default is
'analytical' which uses matrix exponentiation; alternatively numerical ODE
solvers can be used, such as 'odeint::runge_kutta_cash_karp54'. These were used in the
package before version 3.1.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The output is a list with 3 elements:
</p>


<h3>Value</h3>

<table>
<tr><td><code>treeCR</code></td>
<td>
<p>a list of trees generated under the constant-rates
model using the ML parameters under the CR model</p>
</td></tr> <tr><td><code>treeDD</code></td>
<td>
<p>a list of
trees generated under the diversity-dependent model using the ML parameters
under the diversity-dependent model</p>
</td></tr> <tr><td><code>out</code></td>
<td>
<p>a dataframe with the
parameter estimates and maximum likelihoods for diversity-dependent and
constant-rates models <code>$model</code> - the model used to generate the data. 0
= unknown (for real data), 1 = CR, 2 = DD <br /> <code>$mc</code> - the simulation
number for each model <br /> <code>$lambda_CR</code> - speciation rate estimated
under CR <br /> <code>$mu_CR</code> - extinction rate estimated under CR <br />
<code>$LL_CR</code> - maximum likelihood estimated under CR <br /> <code>$conv_CR</code> -
convergence code for likelihood optimization; conv = 0 means convergence <br />
<code>$lambda_DD1</code> - initial speciation rate estimated under DD for first
set of initial values<br /> <code>$mu_DD1</code> - extinction rate estimated under DD
for first set of initial values <br /> <code>$K_DD1</code> - clade-wide
carrying-capacity estimated under DD for first set of initial values <br />
<code>$LL_DD1</code> - maximum likelihood estimated under DD for first set of
initial values <br /> <code>$conv_DD1</code> - convergence code for likelihood
optimization for first set of initial values; conv = 0 means convergence <br />
<code>$lambda_DD2</code> - initial speciation rate estimated under DD for second
set of initial values<br /> <code>$mu_DD2</code> - extinction rate estimated under DD
for second set of initial values <br /> <code>$K_DD2</code> - clade-wide
carrying-capacity estimated under DD for second set of initial values <br />
<code>$LL_DD2</code> - maximum likelihood estimated under DD for second set of
initial values <br /> <code>$conv_DD2</code> - convergence code for likelihood
optimization for second set of initial values; conv = 0 means convergence
<br /> <code>$LR</code> - likelihood ratio between DD and CR </p>
</td></tr> <tr><td><code>pvalue</code></td>
<td>
<p>p-value
of the test</p>
</td></tr> <tr><td><code>LRalpha</code></td>
<td>
<p>Likelihood ratio at the signifiance level alpha</p>
</td></tr>
<tr><td><code>poweroftest</code></td>
<td>
<p>power of the test for significance level alpha</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Rampal S. Etienne &amp; Bart Haegeman
</p>


<h3>References</h3>

<p>- Etienne, R.S. et al. 2016. Meth. Ecol. Evol. 7: 1092-1099,
doi: 10.1111/2041-210X.12565 <br /> - Etienne, R.S. et al. 2012, Proc. Roy.
Soc. B 279: 1300-1309, doi: 10.1098/rspb.2011.1439 <br /> - Etienne, R.S. &amp; B.
Haegeman 2012. Am. Nat. 180: E75-E89, doi: 10.1086/667574
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dd_loglik">dd_loglik</a></code>, <code><a href="#topic+dd_ML">dd_ML</a></code>
</p>

<hr>
<h2 id='dd_ML'>Maximization of the loglikelihood under a diversity-dependent
diversification model</h2><span id='topic+dd_ML'></span>

<h3>Description</h3>

<p>This function computes the maximum likelihood estimates of the parameters of
a diversity-dependent diversification model for a given set of phylogenetic
branching times.  It also outputs the corresponding loglikelihood that can
be used in model comparisons.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dd_ML(
  brts,
  initparsopt = initparsoptdefault(ddmodel, brts, missnumspec),
  idparsopt = 1:length(initparsopt),
  idparsfix = (1:(3 + (ddmodel == 5)))[-idparsopt],
  parsfix = parsfixdefault(ddmodel, brts, missnumspec, idparsopt),
  res = 10 * (1 + length(brts) + missnumspec),
  ddmodel = 1,
  missnumspec = 0,
  cond = 1,
  btorph = 1,
  soc = 2,
  tol = c(0.001, 1e-04, 1e-06),
  maxiter = 1000 * round((1.25)^length(idparsopt)),
  changeloglikifnoconv = FALSE,
  optimmethod = "subplex",
  num_cycles = 1,
  methode = "analytical",
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dd_ML_+3A_brts">brts</code></td>
<td>
<p>A set of branching times of a phylogeny, all positive</p>
</td></tr>
<tr><td><code id="dd_ML_+3A_initparsopt">initparsopt</code></td>
<td>
<p>The initial values of the parameters that must be
optimized</p>
</td></tr>
<tr><td><code id="dd_ML_+3A_idparsopt">idparsopt</code></td>
<td>
<p>The ids of the parameters that must be optimized, e.g. 1:3
for intrinsic speciation rate, extinction rate and carrying capacity.  The
ids are defined as follows: <br /> id == 1 corresponds to lambda (speciation
rate) <br /> id == 2 corresponds to mu (extinction rate) <br /> id == 3
corresponds to K (clade-level carrying capacity) <br /> id == 4 corresponds to
r (r = b/a where mu = mu_0 + b * N and lambda = lambda_0 - a * N) (This is
only available when ddmodel = 5)</p>
</td></tr>
<tr><td><code id="dd_ML_+3A_idparsfix">idparsfix</code></td>
<td>
<p>The ids of the parameters that should not be optimized,
e.g. c(1,3) if lambda and K should not be optimized, but only mu. In that
case idparsopt must be 2. The default is to fix all parameters not specified
in idparsopt.</p>
</td></tr>
<tr><td><code id="dd_ML_+3A_parsfix">parsfix</code></td>
<td>
<p>The values of the parameters that should not be optimized</p>
</td></tr>
<tr><td><code id="dd_ML_+3A_res">res</code></td>
<td>
<p>Sets the maximum number of species for which a probability must
be computed, must be larger than 1 + length(brts)</p>
</td></tr>
<tr><td><code id="dd_ML_+3A_ddmodel">ddmodel</code></td>
<td>
<p>Sets the model of diversity-dependence: <br />
<code>ddmodel == 1</code> : linear dependence in speciation rate with parameter K (= diversity
where speciation = extinction)<br />
<code>ddmodel == 1.3</code> : linear dependence
in speciation rate with parameter K' (= diversity where speciation = 0)<br />
<code>ddmodel == 1.4</code> : positive diversity-dependence in speciation rate
with parameter K' (= diversity where speciation rate reaches half its
maximum); lambda = lambda0 * S/(S + K') where S is species richness<br />
<code>ddmodel == 1.5</code> : positive and negative dependence in speciation rate
with parameter K' (= diversity where speciation = 0); lambda = lambda0 *
S/K' * (1 - S/K') where S is species richness<br />
<code>ddmodel == 2</code> : exponential dependence in speciation rate with parameter
K (= diversity where speciation = extinction)<br />
<code>ddmodel == 2.1</code> : variant of exponential dependence in speciation rate
with offset at infinity<br />
<code>ddmodel == 2.2</code> : 1/n dependence in speciation rate<br /> 
<code>ddmodel == 2.3</code> : exponential dependence in speciation rate with parameter x (=
exponent)<br />
<code>ddmodel == 3</code> : linear dependence in extinction rate <br />
<code>ddmodel == 4</code> : exponential dependence in extinction rate <br />
<code>ddmodel == 4.1</code> : variant of exponential dependence in extinction rate
with offset at infinity <br />
<code>ddmodel == 4.2</code> : 1/n dependence in extinction rate with offset at infinity <br /> <code>ddmodel == 5</code> : linear
dependence in speciation and extinction rate <br /></p>
</td></tr>
<tr><td><code id="dd_ML_+3A_missnumspec">missnumspec</code></td>
<td>
<p>The number of species that are in the clade but missing
in the phylogeny</p>
</td></tr>
<tr><td><code id="dd_ML_+3A_cond">cond</code></td>
<td>
<p>Conditioning: <br />
cond == 0 : conditioning on stem or crown age<br />
cond == 1 : conditioning on stem or crown age and non-extinction of the
phylogeny <br />
cond == 2 : conditioning on stem or crown age and on the total
number of extant taxa (including missing species) <br />
cond == 3 : conditioning on the total number of extant taxa (including missing species)<br />
Note: cond == 3 assumes a uniform prior on stem age, as is the standard
in constant-rate birth-death models, see e.g. D. Aldous &amp; L. Popovic 2004.
Adv. Appl. Prob. 37: 1094-1115 and T. Stadler 2009. J. Theor. Biol. 261:
58-66.</p>
</td></tr>
<tr><td><code id="dd_ML_+3A_btorph">btorph</code></td>
<td>
<p>Sets whether the likelihood is for the branching times (0) or
the phylogeny (1)</p>
</td></tr>
<tr><td><code id="dd_ML_+3A_soc">soc</code></td>
<td>
<p>Sets whether stem or crown age should be used (1 or 2)</p>
</td></tr>
<tr><td><code id="dd_ML_+3A_tol">tol</code></td>
<td>
<p>Sets the tolerances in the optimization. Consists of: <br /> reltolx
= relative tolerance of parameter values in optimization <br /> reltolf =
relative tolerance of function value in optimization <br /> abstolx = absolute
tolerance of parameter values in optimization</p>
</td></tr>
<tr><td><code id="dd_ML_+3A_maxiter">maxiter</code></td>
<td>
<p>Sets the maximum number of iterations in the optimization</p>
</td></tr>
<tr><td><code id="dd_ML_+3A_changeloglikifnoconv">changeloglikifnoconv</code></td>
<td>
<p>if TRUE the loglik will be set to -Inf if ML
does not converge</p>
</td></tr>
<tr><td><code id="dd_ML_+3A_optimmethod">optimmethod</code></td>
<td>
<p>Method used in optimization of the likelihood. Current
default is 'subplex'. Alternative is 'simplex' (default of previous
versions)</p>
</td></tr>
<tr><td><code id="dd_ML_+3A_num_cycles">num_cycles</code></td>
<td>
<p>the number of cycles of opimization. If set at Inf, it will
do as many cycles as needed to meet the tolerance set for the target function.</p>
</td></tr>
<tr><td><code id="dd_ML_+3A_methode">methode</code></td>
<td>
<p>The method used to solve the master equation, default is
'analytical' which uses matrix exponentiation; alternatively numerical ODE
solvers can be used, such as 'odeint::runge_kutta_cash_karp54'. These were used in the
package before version 3.1.</p>
</td></tr>
<tr><td><code id="dd_ML_+3A_verbose">verbose</code></td>
<td>
<p>Show the parameters and loglikelihood for every call to the
loglik function</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The output is a dataframe containing estimated parameters and maximum
loglikelihood. The computed loglikelihood contains the factor q! m! / (q +
m)! where q is the number of species in the phylogeny and m is the number of
missing species, as explained in the supplementary material to Etienne et
al. 2012.
</p>


<h3>Value</h3>

<table>
<tr><td><code>lambda</code></td>
<td>
<p> gives the maximum likelihood estimate of lambda</p>
</td></tr>
<tr><td><code>mu</code></td>
<td>
<p> gives the maximum likelihood estimate of mu</p>
</td></tr> <tr><td><code>K</code></td>
<td>
<p> gives the
maximum likelihood estimate of K</p>
</td></tr> <tr><td><code>r</code></td>
<td>
<p> (only if ddmodel == 5) gives the
ratio of linear dependencies in speciation and extinction rates</p>
</td></tr>
<tr><td><code>loglik</code></td>
<td>
<p> gives the maximum loglikelihood</p>
</td></tr> <tr><td><code>df</code></td>
<td>
<p> gives the number
of estimated parameters, i.e. degrees of feedom</p>
</td></tr> <tr><td><code>conv</code></td>
<td>
<p> gives a
message on convergence of optimization; conv = 0 means convergence</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Rampal S. Etienne &amp; Bart Haegeman
</p>


<h3>References</h3>

<p>- Etienne, R.S. et al. 2012, Proc. Roy. Soc. B 279: 1300-1309,
doi: 10.1098/rspb.2011.1439 <br /> - Etienne, R.S. &amp; B. Haegeman 2012. Am. Nat.
180: E75-E89, doi: 10.1086/667574
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dd_loglik">dd_loglik</a></code>, <code><a href="#topic+dd_SR_ML">dd_SR_ML</a></code>,
<code><a href="#topic+dd_KI_ML">dd_KI_ML</a></code>,
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
cat("Estimating the intrinsic speciation rate lambda and the carrying capacity K")
cat("for a fixed extinction rate of 0.1, conditioning on clade survival and two missing species:")
brts = 1:5
dd_ML(brts = brts,initparsopt = c(1.3078,7.4188), idparsopt = c(1,3), parsfix = 0.1,
      cond = 1, missnumspec = 2, tol = c(1E-3,1E-3,1E-4), optimmethod = 'simplex')

</code></pre>

<hr>
<h2 id='dd_MS_loglik'>Loglikelihood for macro-evolutionary succession under diversity-dependent
diversification with the key innovation at time t = t_d</h2><span id='topic+dd_MS_loglik'></span>

<h3>Description</h3>

<p>This function computes the loglikelihood of a diversity-dependent
diversification model for a given set of branching times and parameter
values where the diversity-dependent dynamics of an innovative subclade have
different parameters from the dynamics of the main clade from time t_d, but
both are governed by the same carrying capacity and experience each other's
diversity.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dd_MS_loglik(
  pars1,
  pars2,
  brtsM,
  brtsS,
  missnumspec,
  methode = "odeint::runge_kutta_cash_karp54"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dd_MS_loglik_+3A_pars1">pars1</code></td>
<td>
<p>Vector of parameters: <br /> <br />
<code>pars1[1]</code> corresponds to lambda_M (speciation rate) of the main clade <br />
<code>pars1[2]</code> corresponds to mu_M (extinction rate) of the main clade <br />
<code>pars1[3]</code> corresponds to K_M (clade-level carrying capacity) of
the main clade <br />
<code>pars1[4]</code> corresponds to lambda_M (speciation rate) of the subclade <br />
<code>pars1[5]</code> corresponds to mu_S (extinction rate) of the subclade <br />
<code>pars1[6]</code> corresponds to t_d (the time of the key innovation)</p>
</td></tr>
<tr><td><code id="dd_MS_loglik_+3A_pars2">pars2</code></td>
<td>
<p>Vector of model settings: <br /> <br />
<code>pars2[1]</code> sets the
maximum number of species for which a probability must be computed. This
must be larger than 1 + missnumspec + length(brts). <br /> <br />
<code>pars2[2]</code> sets the model of diversity-dependence: <br />
- <code>pars2[2] == 1</code> linear dependence in speciation rate with parameter K
(= diversity where speciation = extinction)<br />
- <code>pars2[2] == 1.3</code> linear dependence in speciation rate with parameter
K' (= diversity where speciation = 0)<br />
- <code>pars2[2] == 2</code> exponential dependence in speciation rate with
parameter K (= diversity where speciation = extinction)<br />
- <code>pars2[2] == 2.1</code> variant of exponential dependence in speciation rate with offset at
infinity<br />
- <code>pars2[2] == 2.2</code> 1/n dependence in speciation rate<br />
- <code>pars2[2] == 2.3</code> exponential dependence in speciation rate with
parameter x (= exponent)<br />
- <code>pars2[2] == 3</code> linear dependence in extinction rate <br />
- <code>pars2[2] == 4</code> exponential dependence in extinction rate <br />
- <code>pars2[2] == 4.1</code> variant of exponential dependence in extinction rate
with offset at infinity<br />
- <code>pars2[2] == 4.2</code> 1/n dependence in extinction rate<br /><br />
<code>pars2[3]</code> sets the conditioning: <br />
- <code>pars2[3] == 0</code> no conditioning <br />
- <code>pars2[3] == 1</code> conditioning on non-extinction of the phylogeny <br /> <br />
<code>pars2[4]</code> sets the time of splitting of the branch that will undergo
the key innovation leading to different parameters <br /> <br />
<code>pars2[5]</code> sets whether the parameters and likelihood should be shown on
screen (1) or not (0) <br /> <br />
<code>pars2[6]</code> sets whether the first data point is stem age (1) or crown
age (2)
<code>pars2[7]</code> sets whether the old (incorrect) likelihood should be used (0)
or whether new corrected version should be used (1)</p>
</td></tr>
<tr><td><code id="dd_MS_loglik_+3A_brtsm">brtsM</code></td>
<td>
<p>A set of branching times of the main clade in the phylogeny,
all positive</p>
</td></tr>
<tr><td><code id="dd_MS_loglik_+3A_brtss">brtsS</code></td>
<td>
<p>A set of branching times of the subclade in the phylogeny, all
positive</p>
</td></tr>
<tr><td><code id="dd_MS_loglik_+3A_missnumspec">missnumspec</code></td>
<td>
<p>The number of species that are in the clade but missing
in the phylogeny. One can specify the sum of the missing species in main
clade and subclade or a vector c(missnumspec_M,missnumspec_S) with missing
species in main clade and subclade respectively.</p>
</td></tr>
<tr><td><code id="dd_MS_loglik_+3A_methode">methode</code></td>
<td>
<p>The method used to solve the master equation, default is
'analytical' which uses matrix exponentiation; alternatively numerical ODE
solvers can be used, such as 'odeint::runge_kutta_cash_karp54'. These were used in the
package before version 3.1.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The loglikelihood
</p>


<h3>Author(s)</h3>

<p>Rampal S. Etienne &amp; Bart Haegeman
</p>


<h3>References</h3>

<p>- Etienne, R.S. et al. 2012, Proc. Roy. Soc. B 279: 1300-1309,
doi: 10.1098/rspb.2011.1439 <br /> - Etienne, R.S. &amp; B. Haegeman 2012. Am. Nat.
180: E75-E89, doi: 10.1086/667574
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dd_MS_ML">dd_MS_ML</a></code>, <code><a href="#topic+dd_loglik">dd_loglik</a></code>,
<code><a href="#topic+dd_KI_loglik">dd_KI_loglik</a></code>, <code><a href="#topic+dd_SR_loglik">dd_SR_loglik</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
pars1 = c(0.2,0.1,40,1.0,0.1,9.8)
pars2 = c(200,1,0,18.8,1,2)
missnumspec = 0
brtsM = c(25.2,24.6,24.0,22.5,21.7,20.4,19.9,19.7,18.8,17.1,15.8,11.8,9.7,8.9,5.7,5.2)
brtsS = c(9.6,8.6,7.4,4.9,2.5)
dd_MS_loglik(pars1,pars2,brtsM,brtsS,missnumspec)

</code></pre>

<hr>
<h2 id='dd_MS_ML'>Maximization of the loglikelihood under a diversity-dependent
diversification model with decoupling of a subclade's diversication dynamics
from the main clade's dynamics</h2><span id='topic+dd_MS_ML'></span>

<h3>Description</h3>

<p>This function computes the maximum likelihood estimates of the parameters of
a diversity-dependent diversification model where the diversity-dependent
dynamics of an innovative subclade have different parameters from the
dynamics of the main clade from time t_d, but both are governed by the same
carrying capacity and experience each other's diversity.  Required isa given
set of phylogenetic branching times of main clade and subclade and the time
of splitting of the lineage that will form the subclade.  The function also
outputs the corresponding loglikelihood that can be used in model
comparisons.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dd_MS_ML(
  brtsM,
  brtsS,
  tsplit,
  initparsopt = c(0.5, 0.1, 2 * (1 + length(brtsM) + length(brtsS) + sum(missnumspec)),
    (tsplit + max(brtsS))/2),
  parsfix = NULL,
  idparsopt = c(1:3, 6),
  idparsfix = NULL,
  idparsnoshift = (1:6)[c(-idparsopt, (-1)^(length(idparsfix) != 0) * idparsfix)],
  res = 10 * (1 + length(c(brtsM, brtsS)) + sum(missnumspec)),
  ddmodel = 1.3,
  missnumspec = 0,
  cond = 0,
  soc = 2,
  tol = c(0.001, 1e-04, 1e-06),
  maxiter = 1000 * round((1.25)^length(idparsopt)),
  changeloglikifnoconv = FALSE,
  optimmethod = "subplex",
  num_cycles = 1,
  methode = "ode45",
  correction = FALSE,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dd_MS_ML_+3A_brtsm">brtsM</code></td>
<td>
<p>A set of branching times of the main clade in a phylogeny, all
positive</p>
</td></tr>
<tr><td><code id="dd_MS_ML_+3A_brtss">brtsS</code></td>
<td>
<p>A set of branching times of the subclade in a phylogeny, all
positive</p>
</td></tr>
<tr><td><code id="dd_MS_ML_+3A_tsplit">tsplit</code></td>
<td>
<p>The branching time at which the lineage forming the subclade
branches off, positive</p>
</td></tr>
<tr><td><code id="dd_MS_ML_+3A_initparsopt">initparsopt</code></td>
<td>
<p>The initial values of the parameters that must be
optimized</p>
</td></tr>
<tr><td><code id="dd_MS_ML_+3A_parsfix">parsfix</code></td>
<td>
<p>The values of the parameters that should not be optimized</p>
</td></tr>
<tr><td><code id="dd_MS_ML_+3A_idparsopt">idparsopt</code></td>
<td>
<p>The ids of the parameters that must be optimized, e.g. 1:7
for all parameters.  The ids are defined as follows: <br />
id == 1 corresponds to lambda_M (speciation rate) of the main clade <br />
id == 2 corresponds to mu_M (extinction rate) of the main clade <br />
id == 3 corresponds to K_M (clade-level carrying capacity) of the main clade <br /> id == 4 corresponds to
lambda_S (speciation rate) of the subclade <br />
id == 5 corresponds to mu_S (extinction rate) of the subclade <br />
id == 6 corresponds to t_d (the time of the key innovation)</p>
</td></tr>
<tr><td><code id="dd_MS_ML_+3A_idparsfix">idparsfix</code></td>
<td>
<p>The ids of the parameters that should not be optimized,
e.g. c(1,3,4,6) if lambda and K should not be optimized, but only mu. In
that case idparsopt must be c(2,5,7). The default is to fix all parameters
not specified in idparsopt.</p>
</td></tr>
<tr><td><code id="dd_MS_ML_+3A_idparsnoshift">idparsnoshift</code></td>
<td>
<p>The ids of the parameters that should not shift; This
can only apply to ids 4, 5 and 6, e.g. idparsnoshift = c(4,5) means that
lambda and mu have the same values before and after tshift</p>
</td></tr>
<tr><td><code id="dd_MS_ML_+3A_res">res</code></td>
<td>
<p>sets the maximum number of species for which a probability must
be computed, must be larger than 1 + max(length(brtsM),length(brtsS))</p>
</td></tr>
<tr><td><code id="dd_MS_ML_+3A_ddmodel">ddmodel</code></td>
<td>
<p>sets the model of diversity-dependence: <br />
<code>ddmodel == 1</code> : linear dependence in speciation rate with parameter K (= diversity
where speciation = extinction)<br />
<code>ddmodel == 1.3</code> : linear dependence in speciation rate with parameter K' (= diversity where speciation = 0)<br />
<code>ddmodel == 2</code> : exponential dependence in speciation rate with
parameter K (= diversity where speciation = extinction)<br /> 
<code>ddmodel == 2.1</code> : variant of exponential dependence in speciation rate with offset at
infinity<br />
<code>ddmodel == 2.2</code> : 1/n dependence in speciation rate<br />
<code>ddmodel == 2.3</code> : exponential dependence in speciation rate with
parameter x (= exponent)<br />
<code>ddmodel == 3</code> : linear dependence in extinction rate <br />
<code>ddmodel == 4</code> : exponential dependence in
extinction rate <br />
<code>ddmodel == 4.1</code> : variant of exponential dependence in extinction rate
with offset at infinity <br />
<code>ddmodel == 4.2</code> : 1/n dependence in extinction rate with offset at
infinity <br /></p>
</td></tr>
<tr><td><code id="dd_MS_ML_+3A_missnumspec">missnumspec</code></td>
<td>
<p>The number of species that are in the clade but missing
in the phylogeny. One can specify the sum of the missing species in main
clade and subclade or a vector c(missnumspec_M,missnumspec_S) with missing
species in main clade and subclade respectively.</p>
</td></tr>
<tr><td><code id="dd_MS_ML_+3A_cond">cond</code></td>
<td>
<p>Conditioning: <br /> cond == 0 : no conditioning <br /> cond == 1 :
conditioning on non-extinction of the phylogeny <br /></p>
</td></tr>
<tr><td><code id="dd_MS_ML_+3A_soc">soc</code></td>
<td>
<p>Sets whether stem or crown age should be used (1 or 2); stem age
only works when cond = 0</p>
</td></tr>
<tr><td><code id="dd_MS_ML_+3A_tol">tol</code></td>
<td>
<p>Sets the tolerances in the optimization. Consists of: <br /> reltolx
= relative tolerance of parameter values in optimization <br /> reltolf =
relative tolerance of function value in optimization <br /> abstolx = absolute
tolerance of parameter values in optimization</p>
</td></tr>
<tr><td><code id="dd_MS_ML_+3A_maxiter">maxiter</code></td>
<td>
<p>Sets the maximum number of iterations in the optimization</p>
</td></tr>
<tr><td><code id="dd_MS_ML_+3A_changeloglikifnoconv">changeloglikifnoconv</code></td>
<td>
<p>if TRUE the loglik will be set to -Inf if ML
does not converge</p>
</td></tr>
<tr><td><code id="dd_MS_ML_+3A_optimmethod">optimmethod</code></td>
<td>
<p>Method used in optimization of the likelihood. Current
default is 'subplex'. Alternative is 'simplex' (default of previous
versions)</p>
</td></tr>
<tr><td><code id="dd_MS_ML_+3A_num_cycles">num_cycles</code></td>
<td>
<p>the number of cycles of opimization. If set at Inf, it will
do as many cycles as needed to meet the tolerance set for the target function.</p>
</td></tr>
<tr><td><code id="dd_MS_ML_+3A_methode">methode</code></td>
<td>
<p>The method used in the ode solver. This can be either 'analytical'
for explicit matrix exponentation or any of the solvers in the deSolve package.</p>
</td></tr>
<tr><td><code id="dd_MS_ML_+3A_correction">correction</code></td>
<td>
<p>Sets whether the correction should be applied (TRUE) or
not (FALSE)</p>
</td></tr>
<tr><td><code id="dd_MS_ML_+3A_verbose">verbose</code></td>
<td>
<p>Show the parameters and loglikelihood for every call to the
loglik function</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The output is a dataframe containing estimated parameters and maximum
loglikelihood. The computed loglikelihood contains the factor q! m!/(q + m)!
where q is the number of species in the phylogeny and m is the number of
missing species, as explained in the supplementary material to Etienne et
al. 2012.
</p>


<h3>Value</h3>

<table>
<tr><td><code>lambda_M</code></td>
<td>
<p> gives the maximum likelihood estimate of lambda of
the main clade</p>
</td></tr> <tr><td><code>mu_M</code></td>
<td>
<p> gives the maximum likelihood estimate of mu of
the main clade</p>
</td></tr> <tr><td><code>K_M</code></td>
<td>
<p> gives the maximum likelihood estimate of K of
the main clade</p>
</td></tr> <tr><td><code>lambda_2</code></td>
<td>
<p> gives the maximum likelihood estimate of
lambda of the subclade</p>
</td></tr> <tr><td><code>mu_S</code></td>
<td>
<p> gives the maximum likelihood estimate
of mu of the subclade</p>
</td></tr> <tr><td><code>t_d</code></td>
<td>
<p> gives the time of the key innovation
event</p>
</td></tr> <tr><td><code>loglik</code></td>
<td>
<p> gives the maximum loglikelihood</p>
</td></tr> <tr><td><code>df</code></td>
<td>
<p> gives the
number of estimated parameters, i.e. degrees of feedom</p>
</td></tr> <tr><td><code>conv</code></td>
<td>
<p> gives a
message on convergence of optimization; conv = 0 means convergence</p>
</td></tr>
</table>


<h3>Note</h3>

<p>The optimization may get trapped in local optima. Try different
starting values to search for the global optimum.
</p>


<h3>Author(s)</h3>

<p>Rampal S. Etienne &amp; Bart Haegeman
</p>


<h3>References</h3>

<p>- Etienne, R.S. et al. 2012, Proc. Roy. Soc. B 279: 1300-1309,
doi: 10.1098/rspb.2011.1439 <br /> - Etienne, R.S. &amp; B. Haegeman 2012. Am. Nat.
180: E75-E89, doi: 10.1086/667574
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dd_MS_loglik">dd_MS_loglik</a></code>, <code><a href="#topic+dd_ML">dd_ML</a></code>,
<code><a href="#topic+dd_KI_ML">dd_KI_ML</a></code>, <code><a href="#topic+dd_SR_ML">dd_SR_ML</a></code>,
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
cat("This will estimate parameters for two sets of branching times brtsM, brtsS\n")
cat("without conditioning.\n")
cat("The tolerance of the optimization is set high so runtime is fast in this example.\n")
cat("In real applications, use the default or more stringent settins for tol.\n")
brtsM = 4:10
brtsS = seq(0.1,3.5,0.7)
tsplit = 5
dd_MS_ML(brtsM = brtsM, brtsS = brtsS, tsplit = tsplit, idparsopt = c(1:3,6),
          initparsopt = c(0.885, 2e-14, 10, 4.001), idparsfix = NULL, parsfix = NULL,
          idparsnoshift = c(4,5), cond = 0, tol = c(3E-1,3E-1,3E-1))

</code></pre>

<hr>
<h2 id='dd_MS_sim'>Function to simulate the macro-evolutionary succession process assuming
diversity-dependent diversification</h2><span id='topic+dd_MS_sim'></span>

<h3>Description</h3>

<p>Simulating a diversity-dependent diversification process where at a given
time a new clade emerges with different inherent speciation rate and
extinction rate
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dd_MS_sim(pars, age, ddmodel = 1.3)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dd_MS_sim_+3A_pars">pars</code></td>
<td>
<p>Vector of parameters: <br /> <br /> <code>pars[1]</code> corresponds to
lambda_M (speciation rate of the main clade) <br /> <code>pars[2]</code> corresponds
to mu_M (extinction rate of the main clade) <br /> <code>pars[3]</code> corresponds
to K' (maximum number of species or a proxy for it in case of exponential
decline in speciation rate) <code>pars[4]</code> corresponds to lambda_S
(speciation rate of the novel subclade) <br /> <code>pars[5]</code> corresponds to
mu_S (extinction rate) <br /> <code>pars[6]</code> tinn, the time the shift in rates
occurs in the lineage leading to the subclade</p>
</td></tr>
<tr><td><code id="dd_MS_sim_+3A_age">age</code></td>
<td>
<p>Sets the crown age for the simulation</p>
</td></tr>
<tr><td><code id="dd_MS_sim_+3A_ddmodel">ddmodel</code></td>
<td>
<p>Sets the model of diversity-dependence: <br /> <code>ddmodel ==
1.3</code> : linear dependence in speciation rate with parameter K' (= diversity
where speciation = 0); ddmodel = 1 will be interpreted as this model <br />
<code>ddmodel == 2.1</code> : variant of exponential dependence in speciation rate
with offset at infinity; ddmodel = 2 will be interpreted as this model <br />
<code>ddmodel == 2.2</code> : 1/n dependence in speciation rate<br /> <code>ddmodel
== 2.3</code> : exponential dependence in speciation rate with parameter x (=
exponent)</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>out</code></td>
<td>
<p> A list with the following elements: The first element
is the tree of extant species in phylo format <br /> The second element is the
tree of all species, including extinct species, in phylo format <br /> The
third element is a matrix of all species where <br /> - the first column is the
time at which a species is born <br /> - the second column is the label of the
parent of the species; positive and negative values only indicate whether
the species belongs to the left or right crown lineage <br /> - the third
column is the label of the daughter species itself; positive and negative
values only indicate whether the species belongs to the left or right crown
lineage <br /> - the fourth column is the time of extinction of the species <br />
If the fourth element equals -1, then the species is still extant.<br /> - the
fifth column indicates whether the species belong to the main clade (0) or
the subclade (1)<br /> The fourth element is the subclade tree of extant
species (without stem) <br /> The fifth element is the subclade tree of all
species (without stem) <br /> The sixth element is the same as the first,
except that it has attributed 0 for the main clade and 1 for the subclade<br />
The seventh element is the same as the Second, except that it has attributed
0 for the main clade and 1 for the subclade<br /> The sixth and seventh element
will be NULL if the subclade does not exist (because it went extinct).  </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Rampal S. Etienne
</p>


<h3>References</h3>

<p>- Etienne, R.S. et al. 2012, Proc. Roy. Soc. B 279: 1300-1309,
doi: 10.1098/rspb.2011.1439 <br /> - Etienne, R.S. &amp; B. Haegeman 2012. Am. Nat.
180: E75-E89, doi: 10.1086/667574
</p>


<h3>Examples</h3>

<pre><code class='language-R'> dd_MS_sim(c(0.2,0.1,20,0.1,0.05,4),10) 
</code></pre>

<hr>
<h2 id='dd_multiple_KI_loglik'>Loglikelihood for diversity-dependent diversification models with multiple
decoupling (rate shift) events</h2><span id='topic+dd_multiple_KI_loglik'></span>

<h3>Description</h3>

<p>This function computes loglikelihood of a diversity-dependent
diversification model for a given set of branching times and parameter
values where the diversity-dependent dynamics of subclades decouple from
the dynamics of main clades, potentially accompanied by a
shift in parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dd_multiple_KI_loglik(
  pars1_list,
  pars2,
  brts_k_list,
  missnumspec_list,
  reltol = 1e-14,
  abstol = 1e-16,
  methode = "odeint::runge_kutta_cash_karp54"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dd_multiple_KI_loglik_+3A_pars1_list">pars1_list</code></td>
<td>
<p>list of paramater sets one for each rate regime (subclade).
The parameters are: lambda (speciation rate), mu (extinction rate), and K
(clade-level carrying capacity).</p>
</td></tr>
<tr><td><code id="dd_multiple_KI_loglik_+3A_pars2">pars2</code></td>
<td>
<p>Vector of model settings: <br /> <br />
<code>pars2[1]</code> sets the
maximum number of species for which a probability must be computed.  This
must be larger than 1 + missnumspec + length(brts). <br /> <br />
<code>pars2[2]</code> sets the model of diversity-dependence: <br />
- <code>pars2[2] == 1</code> linear
dependence in speciation rate with parameter K (= diversity where speciation
= extinction)<br />
- <code>pars2[2] == 1.3</code> linear dependence in speciation
rate with parameter K' (= diversity where speciation = 0)<br />
- <code>pars2[2] == 2</code> exponential dependence in speciation rate with
parameter K (= diversity where speciation = extinction)<br /> 
- <code>pars2[2] == 2.1</code> variant of exponential dependence in speciation rate with offset at
infinity<br />
- <code>pars2[2] == 2.2</code> 1/n dependence in speciation rate<br />
- <code>pars2[2] == 2.3</code> exponential dependence in speciation rate with
parameter x (= exponent)<br />
- <code>pars2[2] == 3</code> linear dependence in
extinction rate <br />
- <code>pars2[2] == 4</code> exponential dependence in
extinction rate <br />
- <code>pars2[2] == 4.1</code> variant of exponential
dependence in extinction rate with offset at infinity<br />
- <code>pars2[2] == 4.2</code> 1/n dependence in extinction rate<br /><br />
<code>pars2[3]</code> sets the
conditioning: <br />
- <code>pars2[3] == 0</code> no conditioning (or just crown age) <br />
- <code>pars2[3] == 1</code> conditioning on non-extinction of the phylogeny <br />
- <code>pars2[3] == 2</code> conditioning on number of species and crown age;
not yet implemented <br />
- <code>pars2[3] == 3</code> conditioning on number of species only;
not yet implemented <br />
- <code>pars2[3] == 4</code> conditioning on survival of the subclade <br />
- <code>pars2[3] == 5</code> conditioning on survival of all subclades
and of both crown lineages in the main clade. This assumes that subclades
that have already shifted do not undergo another shift, i.e. shifts only
occur in the main clade. <br /> <br />
<code>pars2[4]</code> Obsolete. <br /> <br />
<code>pars2[5]</code> sets whether the parameters and likelihood should be
shown on screen (1) or not (0) <br /> <br />
<code>pars2[6]</code> sets whether the first data point is stem age (1) or crown age (2) <br /><br />
<code>pars2[7]</code> sets whether the old (incorrect) likelihood should be used (0),
or whether the new corrected likelihood should be used (1).</p>
</td></tr>
<tr><td><code id="dd_multiple_KI_loglik_+3A_brts_k_list">brts_k_list</code></td>
<td>
<p>list of matrices, one for each rate regime (subclade). Each
matrix has in the first row the branching times including the shift/decoupling time
and the present time (0) in negative time (i.e. 10 mya = -10). In the second row 
it has the number of lineages, i.e. starting at 2 for a phylogeny with a crown 
and increasing by one at each branching time and decreasing by one at each
decoupling/shift time. The last element is the same as the second last.</p>
</td></tr>
<tr><td><code id="dd_multiple_KI_loglik_+3A_missnumspec_list">missnumspec_list</code></td>
<td>
<p>list containing the number of missing species for each clade.
If only a single number m of missing species is known for the entire phylogeny, then each
element of the list should be 0:m. One can also create this from m using the function
create_missnumspec_list</p>
</td></tr>
<tr><td><code id="dd_multiple_KI_loglik_+3A_reltol">reltol</code></td>
<td>
<p>relative tolerance in integration of the ODE system, default at 1e-14</p>
</td></tr>
<tr><td><code id="dd_multiple_KI_loglik_+3A_abstol">abstol</code></td>
<td>
<p>tolerance tolerance in integration of the ODE system, default at 1e-16</p>
</td></tr>
<tr><td><code id="dd_multiple_KI_loglik_+3A_methode">methode</code></td>
<td>
<p>The method used to solve the master equation, default is
'analytical' which uses matrix exponentiation; alternatively numerical ODE
solvers can be used, such as 'odeint::runge_kutta_cash_karp54'. These were used in the
package before version 3.1.</p>
</td></tr>
</table>

<hr>
<h2 id='dd_sim'>Function to simulate the diversity-dependent diversification process</h2><span id='topic+dd_sim'></span>

<h3>Description</h3>

<p>Simulating the diversity-dependent diversification process
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dd_sim(pars, age, ddmodel = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dd_sim_+3A_pars">pars</code></td>
<td>
<p>Vector of parameters: <br /> <br /> <code>pars[1]</code> corresponds to
lambda (speciation rate) <br /> <code>pars[2]</code> corresponds to mu (extinction
rate) <br /> <code>pars[3]</code> corresponds to K (clade-level carrying capacity)</p>
</td></tr>
<tr><td><code id="dd_sim_+3A_age">age</code></td>
<td>
<p>Sets the crown age for the simulation</p>
</td></tr>
<tr><td><code id="dd_sim_+3A_ddmodel">ddmodel</code></td>
<td>
<p>Sets the model of diversity-dependence: <br /> <code>ddmodel ==
1</code> : linear dependence in speciation rate with parameter K (= diversity
where speciation = extinction)<br /> <code>ddmodel == 1.3</code> : linear dependence
in speciation rate with parameter K' (= diversity where speciation = 0)<br />
<code>ddmodel == 2</code> : exponential dependence in speciation rate with
parameter K (= diversity where speciation = extinction)<br /> <code>ddmodel ==
2.1</code> : variant of exponential dependence in speciation rate with offset at
infinity<br /> <code>ddmodel == 2.2</code> : 1/n dependence in speciation rate<br />
<code>ddmodel == 2.3</code> : exponential dependence in speciation rate with
parameter x (= exponent)<br /> <code>ddmodel == 3</code> : linear dependence in
extinction rate <br /> <code>ddmodel == 4</code> : exponential dependence in
extinction rate <br /> <code>ddmodel == 4.1</code> : variant of exponential
dependence in extinction rate with offset at infinity <br /> <code>ddmodel ==
4.2</code> : 1/n dependence in extinction rate with offset at infinity <br />
<code>ddmodel == 5</code> : linear dependence in speciation and extinction rate</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>out</code></td>
<td>
<p> A list with the following four elements: The first
element is the tree of extant species in phylo format <br /> The second element
is the tree of all species, including extinct species, in phylo format <br />
The third element is a matrix of all species where <br /> - the first column is
the time at which a species is born <br /> - the second column is the label of
the parent of the species; positive and negative values only indicate
whether the species belongs to the left or right crown lineage <br /> - the
third column is the label of the daughter species itself; positive and
negative values only indicate whether the species belongs to the left or
right crown lineage <br /> - the fourth column is the time of extinction of the
species. If this equals -1, then the species is still extant.<br /> The fourth
element is the set of branching times of the tree of extant species.<br /> </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Rampal S. Etienne
</p>


<h3>References</h3>

<p>- Etienne, R.S. et al. 2012, Proc. Roy. Soc. B 279: 1300-1309,
doi: 10.1098/rspb.2011.1439 <br /> - Etienne, R.S. &amp; B. Haegeman 2012. Am. Nat.
180: E75-E89, doi: 10.1086/667574
</p>


<h3>Examples</h3>

<pre><code class='language-R'> dd_sim(c(0.2,0.1,20),10) 
</code></pre>

<hr>
<h2 id='dd_SR_loglik'>Loglikelihood for diversity-dependent diversification models with a shift in
the parameters at time t = tshift</h2><span id='topic+dd_SR_loglik'></span>

<h3>Description</h3>

<p>This function computes loglikelihood of a diversity-dependent
diversification model for a given set of branching times and parameter
values where the parameters are allowed to shift at time t = tshift
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dd_SR_loglik(pars1, pars2, brts, missnumspec, methode = "analytical")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dd_SR_loglik_+3A_pars1">pars1</code></td>
<td>
<p>Vector of parameters: <br /> <br /> <code>pars1[1]</code> corresponds to
lambda (speciation rate) before the shift <br /> <code>pars1[2]</code> corresponds to
mu (extinction rate) before the shift <br /> <code>pars1[3]</code> corresponds to K
(clade-level carrying capacity) before the shift <br /> <code>pars1[4]</code>
corresponds to lambda (speciation rate) after the shift <br /> <code>pars1[5]</code>
corresponds to mu (extinction rate) after the shift <br /> <code>pars1[6]</code>
corresponds to K (clade-level carrying capacity) after the shift <br />
<code>pars1[7]</code> corresponds to tshift (the time of shift)</p>
</td></tr>
<tr><td><code id="dd_SR_loglik_+3A_pars2">pars2</code></td>
<td>
<p>Vector of model settings: <br /> <br /> <code>pars2[1]</code> sets the
maximum number of species for which a probability must be computed.  This
must be larger than 1 + missnumspec + length(brts). <br /> <br /> <code>pars2[2]</code>
sets the model of diversity-dependence: <br /> - <code>pars2[2] == 1</code> linear
dependence in speciation rate with parameter K (= diversity where speciation
= extinction)<br /> - <code>pars2[2] == 1.3</code> linear dependence in speciation
rate with parameter K' (= diversity where speciation = 0)<br /> -
<code>pars2[2] == 2</code> exponential dependence in speciation rate with
parameter K (= diversity where speciation = extinction)<br /> - <code>pars2[2]
== 2.1</code> variant of exponential dependence in speciation rate with offset at
infinity<br /> - <code>pars2[2] == 2.2</code> 1/n dependence in speciation rate<br /> -
<code>pars2[2] == 2.3</code> exponential dependence in speciation rate with
parameter x (= exponent)<br /> - <code>pars2[2] == 3</code> linear dependence in
extinction rate <br /> - <code>pars2[2] == 4</code> exponential dependence in
extinction rate <br /> - <code>pars2[2] == 4.1</code> variant of exponential
dependence in extinction rate with offset at infinity<br /> - <code>pars2[2] ==
4.2</code> 1/n dependence in extinction rate<br /><br /> <code>pars2[3]</code> sets the
conditioning: <br /> - <code>pars2[3] == 0</code> no conditioning <br /> -
<code>pars2[3] == 1</code> conditioning on non-extinction of the phylogeny <br /> -
<code>pars2[3] == 2</code> conditioning on non-extinction of the phylogeny and on
the total number of extant taxa (including missing species) <br /> <br />
<code>pars2[4]</code> sets whether the likelihood is for the branching times (0)
or the phylogeny (1) <br /> <br /> <code>pars2[5]</code> sets whether the parameters and
likelihood should be shown on screen (1) or not (0) <br /> <br /> <code>pars2[6]</code>
sets whether the first data point is stem age (1) or crown age (2)</p>
</td></tr>
<tr><td><code id="dd_SR_loglik_+3A_brts">brts</code></td>
<td>
<p>A set of branching times of a phylogeny, all positive</p>
</td></tr>
<tr><td><code id="dd_SR_loglik_+3A_missnumspec">missnumspec</code></td>
<td>
<p>The number of species that are in the clade but missing
in the phylogeny</p>
</td></tr>
<tr><td><code id="dd_SR_loglik_+3A_methode">methode</code></td>
<td>
<p>The method used to solve the master equation, default is
'analytical' which uses matrix exponentiation; alternatively numerical ODE
solvers can be used, such as 'odeint::runge_kutta_cash_karp54'. These were used in the
package before version 3.1.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The loglikelihood
</p>


<h3>Author(s)</h3>

<p>Rampal S. Etienne &amp; Bart Haegeman
</p>


<h3>References</h3>

<p>- Etienne, R.S. et al. 2012, Proc. Roy. Soc. B 279: 1300-1309,
doi: 10.1098/rspb.2011.1439 <br /> - Etienne, R.S. &amp; B. Haegeman 2012. Am. Nat.
180: E75-E89, doi: 10.1086/667574
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dd_SR_ML">dd_SR_ML</a></code>, <code><a href="#topic+dd_loglik">dd_loglik</a></code>,
<code><a href="#topic+dd_KI_loglik">dd_KI_loglik</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>dd_SR_loglik(pars1 = c(0.2,0.1,50,0.2,0.1,70,5), pars2 = c(100,1,1,1,0,2),
   brts = 1:10, missnumspec = 0) 
</code></pre>

<hr>
<h2 id='dd_SR_ML'>Maximization of the loglikelihood under a diversity-dependent
diversification model with a shift in the parameters</h2><span id='topic+dd_SR_ML'></span>

<h3>Description</h3>

<p>This function computes the maximum likelihood estimates of the parameters of
a diversity-dependent diversification model with shifting parameters at time
t = tshift for a given set of phylogenetic branching times.  It also outputs
the corresponding loglikelihood that can be used in model comparisons.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dd_SR_ML(
  brts,
  initparsopt = c(0.5, 0.1, 2 * (1 + length(brts) + missnumspec), 2 * (1 + length(brts) +
    missnumspec), max(brts)/2),
  parsfix = NULL,
  idparsopt = c(1:3, 6:7),
  idparsfix = NULL,
  idparsnoshift = (1:7)[c(-idparsopt, (-1)^(length(idparsfix) != 0) * idparsfix)],
  res = 10 * (1 + length(brts) + missnumspec),
  ddmodel = 1,
  missnumspec = 0,
  cond = 1,
  btorph = 1,
  soc = 2,
  allbp = FALSE,
  tol = c(0.001, 1e-04, 1e-06),
  maxiter = 1000 * round((1.25)^length(idparsopt)),
  changeloglikifnoconv = FALSE,
  optimmethod = "subplex",
  num_cycles = 1,
  methode = "analytical",
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dd_SR_ML_+3A_brts">brts</code></td>
<td>
<p>A set of branching times of a phylogeny, all positive</p>
</td></tr>
<tr><td><code id="dd_SR_ML_+3A_initparsopt">initparsopt</code></td>
<td>
<p>The initial values of the parameters that must be
optimized</p>
</td></tr>
<tr><td><code id="dd_SR_ML_+3A_parsfix">parsfix</code></td>
<td>
<p>The values of the parameters that should not be optimized</p>
</td></tr>
<tr><td><code id="dd_SR_ML_+3A_idparsopt">idparsopt</code></td>
<td>
<p>The ids of the parameters that must be optimized, e.g. 1:7
for all parameters.  The ids are defined as follows: <br /> id == 1 corresponds
to lambda (speciation rate) before the shift <br /> id == 2 corresponds to mu
(extinction rate) before the shift <br /> id == 3 corresponds to K (clade-level
carrying capacity) before the shift <br /> id == 4 corresponds to lambda
(speciation rate) after the shift <br /> id == 5 corresponds to mu (extinction
rate) after the shift <br /> id == 6 corresponds to K (clade-level carrying
capacity) after the shift <br /> id == 7 corresponds to tshift (the time of
shift)</p>
</td></tr>
<tr><td><code id="dd_SR_ML_+3A_idparsfix">idparsfix</code></td>
<td>
<p>The ids of the parameters that should not be optimized,
e.g. c(1,3,4,6) if lambda and K should not be optimized, but only mu. In
that case idparsopt must be c(2,5,7). The default is to fix all parameters
not specified in idparsopt.</p>
</td></tr>
<tr><td><code id="dd_SR_ML_+3A_idparsnoshift">idparsnoshift</code></td>
<td>
<p>The ids of the parameters that should not shift; This
can only apply to ids 4, 5 and 6, e.g. idparsnoshift = c(4,5) means that
lambda and mu have the same values before and after tshift</p>
</td></tr>
<tr><td><code id="dd_SR_ML_+3A_res">res</code></td>
<td>
<p>sets the maximum number of species for which a probability must
be computed, must be larger than 1 + length(brts)</p>
</td></tr>
<tr><td><code id="dd_SR_ML_+3A_ddmodel">ddmodel</code></td>
<td>
<p>sets the model of diversity-dependence: <br />
ddmodel == 1 : linear dependence in speciation rate <br />
ddmodel == 2 : exponential dependence in speciation rate <br />
ddmodel == 2.1 : variant of exponential dependence in speciation rate with offset at infinity<br /> ddmodel == 2.2 :
1/n dependence in speciation rate<br />
ddmodel == 3 : linear dependence in extinction rate <br />
ddmodel == 4 : exponential dependence in extinction rate<br />
ddmodel == 4.1 : variant of exponential dependence in extinction rate
with offset at infinity<br />
ddmodel == 4.2 : 1/n dependence in extinction rate
with offset at infinity</p>
</td></tr>
<tr><td><code id="dd_SR_ML_+3A_missnumspec">missnumspec</code></td>
<td>
<p>The number of species that are in the clade but missing
in the phylogeny</p>
</td></tr>
<tr><td><code id="dd_SR_ML_+3A_cond">cond</code></td>
<td>
<p>Conditioning: <br />
cond == 0 : no conditioning <br />
cond == 1 : conditioning on non-extinction of the phylogeny <br />
cond == 2 : conditioning on non-extinction of the phylogeny and on the total
number of extant taxa (including missing species) <br />
cond == 3 : conditioning on the total number of extant taxa (including missing
species) <br />
<br /> Note: cond == 3 assumes a uniform prior on stem age, as is the standard
in constant-rate birth-death models, see e.g. D. Aldous &amp; L. Popovic 2004.
Adv. Appl. Prob. 37: 1094-1115 and T. Stadler 2009. J. Theor. Biol. 261:
58-66.</p>
</td></tr>
<tr><td><code id="dd_SR_ML_+3A_btorph">btorph</code></td>
<td>
<p>Sets whether the likelihood is for the branching times (0) or
the phylogeny (1)</p>
</td></tr>
<tr><td><code id="dd_SR_ML_+3A_soc">soc</code></td>
<td>
<p>Sets whether stem or crown age should be used (1 or 2)</p>
</td></tr>
<tr><td><code id="dd_SR_ML_+3A_allbp">allbp</code></td>
<td>
<p>Sets whether a search should be done with various initial
conditions, with tshift at each of the branching points (TRUE/FALSE)</p>
</td></tr>
<tr><td><code id="dd_SR_ML_+3A_tol">tol</code></td>
<td>
<p>Sets the tolerances in the optimization. Consists of: <br /> reltolx
= relative tolerance of parameter values in optimization <br /> reltolf =
relative tolerance of function value in optimization <br /> abstolx = absolute
tolerance of parameter values in optimization</p>
</td></tr>
<tr><td><code id="dd_SR_ML_+3A_maxiter">maxiter</code></td>
<td>
<p>Sets the maximum number of iterations in the optimization</p>
</td></tr>
<tr><td><code id="dd_SR_ML_+3A_changeloglikifnoconv">changeloglikifnoconv</code></td>
<td>
<p>if TRUE the loglik will be set to -Inf if ML
does not converge</p>
</td></tr>
<tr><td><code id="dd_SR_ML_+3A_optimmethod">optimmethod</code></td>
<td>
<p>Method used in optimization of the likelihood. Current
default is 'subplex'. Alternative is 'simplex' (default of previous
versions)</p>
</td></tr>
<tr><td><code id="dd_SR_ML_+3A_num_cycles">num_cycles</code></td>
<td>
<p>the number of cycles of opimization. If set at Inf, it will
do as many cycles as needed to meet the tolerance set for the target function.</p>
</td></tr>
<tr><td><code id="dd_SR_ML_+3A_methode">methode</code></td>
<td>
<p>The method used to solve the master equation, default is
'analytical' which uses matrix exponentiation; alternatively numerical ODE
solvers can be used, such as 'odeint::runge_kutta_cash_karp54'. These were used in the
package before version 3.1.</p>
</td></tr>
<tr><td><code id="dd_SR_ML_+3A_verbose">verbose</code></td>
<td>
<p>Show the parameters and loglikelihood for every call to the
loglik function</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The output is a dataframe containing estimated parameters and maximum
loglikelihood. The computed loglikelihood contains the factor q! m!/(q + m)!
where q is the number of species in the phylogeny and m is the number of
missing species, as explained in the supplementary material to Etienne et
al. 2012.
</p>


<h3>Value</h3>

<table>
<tr><td><code>lambda_1</code></td>
<td>
<p> gives the maximum likelihood estimate of lambda
before the shift</p>
</td></tr> <tr><td><code>mu_1</code></td>
<td>
<p> gives the maximum likelihood estimate of mu
before the shift</p>
</td></tr> <tr><td><code>K_1</code></td>
<td>
<p> gives the maximum likelihood estimate of K
before the shift</p>
</td></tr> <tr><td><code>lambda_2</code></td>
<td>
<p> gives the maximum likelihood estimate of
lambda after the shift</p>
</td></tr> <tr><td><code>mu_2</code></td>
<td>
<p> gives the maximum likelihood estimate
of mu after the shift</p>
</td></tr> <tr><td><code>K_2</code></td>
<td>
<p> gives the maximum likelihood estimate of
K after the shift</p>
</td></tr> <tr><td><code>t_shift</code></td>
<td>
<p> gives the time of the shift</p>
</td></tr>
<tr><td><code>loglik</code></td>
<td>
<p> gives the maximum loglikelihood</p>
</td></tr> <tr><td><code>df</code></td>
<td>
<p> gives the number
of estimated parameters, i.e. degrees of feedom</p>
</td></tr> <tr><td><code>conv</code></td>
<td>
<p> gives a
message on convergence of optimization; conv = 0 means convergence</p>
</td></tr>
</table>


<h3>Note</h3>

<p>The optimization may get trapped in local optima. Try different
starting values to search for the global optimum.
</p>


<h3>Author(s)</h3>

<p>Rampal S. Etienne &amp; Bart Haegeman
</p>


<h3>References</h3>

<p>- Etienne, R.S. et al. 2012, Proc. Roy. Soc. B 279: 1300-1309,
doi: 10.1098/rspb.2011.1439 <br /> - Etienne, R.S. &amp; B. Haegeman 2012. Am. Nat.
180: E75-E89, doi: 10.1086/667574
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dd_SR_loglik">dd_SR_loglik</a></code>, <code><a href="#topic+dd_ML">dd_ML</a></code>,
<code><a href="#topic+dd_KI_ML">dd_KI_ML</a></code>,
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
cat("This will estimate parameters for a sets of branching times brts without conditioning.\n")
cat("The tolerance of the optimization is set ridiculously high to make runtime fast.\n")
cat("In real applications, use the default or more stringent settings for tol.\n")
brts = 1:10
dd_SR_ML(brts = brts, initparsopt = c(0.4581, 1E-6, 17.69, 11.09, 8.9999), idparsopt = c(1:3,6,7),
         idparsfix = NULL, parsfix = NULL, idparsnoshift = c(4,5), cond = 0,
         tol = c(1E-1,1E-1,1E-1),optimmethod = 'simplex'
)

</code></pre>

<hr>
<h2 id='dd_SR_sim'>Function to simulate the diversity-dependent diversification process with a
shift in one or more of the parameters</h2><span id='topic+dd_SR_sim'></span>

<h3>Description</h3>

<p>Simulating the diversity-dependent diversification process with a parameter
shift at a certain time
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dd_SR_sim(pars, age, ddmodel = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dd_SR_sim_+3A_pars">pars</code></td>
<td>
<p>Vector of parameters: <br /> <br /> <code>pars[1]</code> corresponds to
lambda1 (speciation rate before the rate shift) <br /> <code>pars[2]</code>
corresponds to mu1 (extinction rate before the rate shift) <br />
<code>pars[3]</code> corresponds to K1 (clade-level carrying capacity before the
rate shift) <br /> <code>pars[4]</code> corresponds to lambda2 (speciation rate after
the rate shift) <br /> <code>pars[5]</code> corresponds to mu2 (extinction rate after
the rate shift) <br /> <code>pars[6]</code> corresponds to K2 (clade-level carrying
capacity after the rate shift) <br /> <code>pars[7]</code> corresponds to the time of
shift</p>
</td></tr>
<tr><td><code id="dd_SR_sim_+3A_age">age</code></td>
<td>
<p>Sets the crown age for the simulation</p>
</td></tr>
<tr><td><code id="dd_SR_sim_+3A_ddmodel">ddmodel</code></td>
<td>
<p>Sets the model of diversity-dependence: <br /> <code>ddmodel ==
1</code> : linear dependence in speciation rate with parameter K (= diversity
where speciation = extinction)<br /> <code>ddmodel == 1.3</code> : linear dependence
in speciation rate with parameter K' (= diversity where speciation = 0)<br />
<code>ddmodel == 2</code> : exponential dependence in speciation rate with
parameter K (= diversity where speciation = extinction)<br /> <code>ddmodel ==
2.1</code> : variant of exponential dependence in speciation rate with offset at
infinity<br /> <code>ddmodel == 2.2</code> : 1/n dependence in speciation rate<br />
<code>ddmodel == 2.3</code> : exponential dependence in speciation rate with
parameter x (= exponent)<br /> <code>ddmodel == 3</code> : linear dependence in
extinction rate <br /> <code>ddmodel == 4</code> : exponential dependence in
extinction rate <br /> <code>ddmodel == 4.1</code> : variant of exponential
dependence in extinction rate with offset at infinity <br /> <code>ddmodel ==
4.2</code> : 1/n dependence in extinction rate with offset at infinity <br />
<code>ddmodel == 5</code> : linear dependence in speciation and extinction rate</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>out</code></td>
<td>
<p> A list with the following four elements: The first
element is the tree of extant species in phylo format <br /> The second element
is the tree of all species, including extinct species, in phylo format <br />
The third element is a matrix of all species where <br /> - the first column is
the time at which a species is born <br /> - the second column is the label of
the parent of the species; positive and negative values only indicate
whether the species belongs to the left or right crown lineage <br /> - the
third column is the label of the daughter species itself; positive and
negative values only indicate whether the species belongs to the left or
right crown lineage <br /> - the fourth column is the time of extinction of the
species If this equals -1, then the species is still extant.<br /> The fourth
element is the set of branching times of the tree of extant species.<br /> </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Rampal S. Etienne
</p>


<h3>References</h3>

<p>- Etienne, R.S. et al. 2012, Proc. Roy. Soc. B 279: 1300-1309,
doi: 10.1098/rspb.2011.1439 <br /> - Etienne, R.S. &amp; B. Haegeman 2012. Am. Nat.
180: E75-E89, doi: 10.1086/667574
</p>


<h3>Examples</h3>

<pre><code class='language-R'> dd_SR_sim(c(0.2,0.1,20,0.2,0.1,40,5),10) 
</code></pre>

<hr>
<h2 id='L2brts'>Function to convert a table with speciation and extinction events to a set
of branching times</h2><span id='topic+L2brts'></span>

<h3>Description</h3>

<p>Converting a table with speciation and extinction events to a set of
branching times
</p>


<h3>Usage</h3>

<pre><code class='language-R'>L2brts(L, dropextinct = T)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="L2brts_+3A_l">L</code></td>
<td>
<p>Matrix of events as produced by dd_sim: <br /> <br /> - the first column
is the time at which a species is born in Mya<br /> - the second column is the
label of the parent of the species; positive and negative values indicate
whether the species belongs to the left or right crown lineage <br /> - the
third column is the label of the daughter species itself; positive and
negative values indicate whether the species belongs to the left or right
crown lineage <br /> - the fourth column is the time of extinction of the
species; if the fourth element equals -1, then the species is still extant.</p>
</td></tr>
<tr><td><code id="L2brts_+3A_dropextinct">dropextinct</code></td>
<td>
<p>Sets whether the phylogeny should drop species that are
extinct at the present</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>brts</code></td>
<td>
<p> A set of branching times </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Rampal S. Etienne
</p>


<h3>References</h3>

<p>- Etienne, R.S. et al. 2012, Proc. Roy. Soc. B 279: 1300-1309,
doi: 10.1098/rspb.2011.1439 <br /> - Etienne, R.S. &amp; B. Haegeman 2012. Am. Nat.
180: E75-E89, doi: 10.1086/667574
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
sim = dd_sim(c(0.2,0.1,20),10)
phy = L2brts(sim$L)
plot(phy)

</code></pre>

<hr>
<h2 id='L2phylo'>Function to convert a table with speciation and extinction events to a
phylogeny</h2><span id='topic+L2phylo'></span>

<h3>Description</h3>

<p>Converting a table with speciation and extinction events to a phylogeny
</p>


<h3>Usage</h3>

<pre><code class='language-R'>L2phylo(L, dropextinct = T)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="L2phylo_+3A_l">L</code></td>
<td>
<p>Matrix of events as produced by dd_sim: <br /> <br /> - the first column
is the time at which a species is born in Mya<br /> - the second column is the
label of the parent of the species; positive and negative values indicate
whether the species belongs to the left or right crown lineage <br /> - the
third column is the label of the daughter species itself; positive and
negative values indicate whether the species belongs to the left or right
crown lineage <br /> - the fourth column is the time of extinction of the
species; if the fourth element equals -1, then the species is still extant.</p>
</td></tr>
<tr><td><code id="L2phylo_+3A_dropextinct">dropextinct</code></td>
<td>
<p>Sets whether the phylogeny should drop species that are
extinct at the present</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>phy</code></td>
<td>
<p> A phylogeny of the phylo type </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Rampal S. Etienne
</p>


<h3>References</h3>

<p>- Etienne, R.S. et al. 2012, Proc. Roy. Soc. B 279: 1300-1309,
doi: 10.1098/rspb.2011.1439 <br /> - Etienne, R.S. &amp; B. Haegeman 2012. Am. Nat.
180: E75-E89, doi: 10.1086/667574
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
sim = dd_sim(c(0.2,0.1,20),10)
phy = L2phylo(sim$L)
plot(phy)

</code></pre>

<hr>
<h2 id='optimizer'>Carries out optimization (finding a minimum)</h2><span id='topic+optimizer'></span>

<h3>Description</h3>

<p>A wrapper to use several optimization routines, currently only 'simplex' (a
method adopted from Matlab, or 'subplex', from the R package subplex). The
function is called from several packages by the same author.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>optimizer(
  optimmethod = "simplex",
  optimpars = c(1e-04, 1e-04, 1e-06, 1000),
  num_cycles = 1,
  fun,
  trparsopt,
  jitter = 0,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="optimizer_+3A_optimmethod">optimmethod</code></td>
<td>
<p>The method to use for optimization, either 'simplex' or
'subplex'</p>
</td></tr>
<tr><td><code id="optimizer_+3A_optimpars">optimpars</code></td>
<td>
<p>Parameters of the optimization: relative tolerance in
function arguments, relative tolerance in function value, absolute tolerance
in function arguments, and maximum number of iterations</p>
</td></tr>
<tr><td><code id="optimizer_+3A_num_cycles">num_cycles</code></td>
<td>
<p>Number of cycles of the optimization. When set to Inf, the
optimization will be repeated until the result is, within the tolerance,
equal to the starting values, with a maximum of 10 cycles.</p>
</td></tr>
<tr><td><code id="optimizer_+3A_fun">fun</code></td>
<td>
<p>Function to be optimized</p>
</td></tr>
<tr><td><code id="optimizer_+3A_trparsopt">trparsopt</code></td>
<td>
<p>Initial guess of the parameters to be optimized</p>
</td></tr>
<tr><td><code id="optimizer_+3A_jitter">jitter</code></td>
<td>
<p>Perturbation of an initial parameter value when precisely equal to 0.5;
this is only relevant when subplex is chosen. The default value is 0, so no jitter
is applied. A recommended value when using it is 1E-5.</p>
</td></tr>
<tr><td><code id="optimizer_+3A_...">...</code></td>
<td>
<p>Any other arguments of the function to be optimimzed, or settings
of the optimization routine</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>out</code></td>
<td>
<p> A list containing optimal function arguments
(<code>par</code>, the optimal function value (<code>fvalues</code>) and whether the
optimization converged (<code>conv</code>)</p>
</td></tr></table>
<p>.
</p>


<h3>Author(s)</h3>

<p>Rampal S. Etienne
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
cat("No examples")

</code></pre>

<hr>
<h2 id='phylo2L'>Function to convert phylogeny to a table with speciation and extinction
events</h2><span id='topic+phylo2L'></span>

<h3>Description</h3>

<p>Converting a phylogeny to a table with speciation and extinction events
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phylo2L(phy)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="phylo2L_+3A_phy">phy</code></td>
<td>
<p>A phylogeny of the phylo type</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>L</code></td>
<td>
<p>Matrix of events as produced by dd_sim: <br /> <br /> - the first
column is the time at which a species is born in Mya<br /> - the second column
is the label of the parent of the species; positive and negative values
indicate whether the species belongs to the left or right crown lineage <br />
- the third column is the label of the daughter species itself; positive and
negative values indicate whether the species belongs to the left or right
crown lineage <br /> - the fourth column is the time of extinction of the
species; if the fourth element equals -1, then the species is still extant.
</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Liang Xu
</p>


<h3>References</h3>

<p>- Etienne, R.S. et al. 2012, Proc. Roy. Soc. B 279: 1300-1309,
doi: 10.1098/rspb.2011.1439 <br /> - Etienne, R.S. &amp; B. Haegeman 2012. Am. Nat.
180: E75-E89, doi: 10.1086/667574
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
sim = dd_sim(c(0.2,0.1,20),10)
phy = sim$tas
L = phylo2L(phy)
phy2 = L2phylo(L, dropextinct = FALSE)
graphics::par(mfrow = c(1,3))
graphics::plot(phy)
graphics::plot(phy2)
graphics::plot(L2phylo(sim$L, dropextinct = FALSE))

</code></pre>

<hr>
<h2 id='rng_respecting_sample'>Sampling in which zero probabilities are removed</h2><span id='topic+rng_respecting_sample'></span>

<h3>Description</h3>

<p>Sampling in which zero probabilities are removed
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rng_respecting_sample(x, size, replace, prob)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rng_respecting_sample_+3A_x">x</code></td>
<td>
<p>either a vector of one or more elements from which to choose,
or a positive integer.  See &lsquo;Details.&rsquo;</p>
</td></tr>
<tr><td><code id="rng_respecting_sample_+3A_size">size</code></td>
<td>
<p>a non-negative integer giving the number of items to choose.</p>
</td></tr>
<tr><td><code id="rng_respecting_sample_+3A_replace">replace</code></td>
<td>
<p>should sampling be with replacement?</p>
</td></tr>
<tr><td><code id="rng_respecting_sample_+3A_prob">prob</code></td>
<td>
<p>a vector of probability weights for obtaining the elements
of the vector being sampled.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a vector of length size with elements drawn 
from either x or from the integers 1:x.
</p>


<h3>Note</h3>

<p>thanks to Pedro Neves for finding this feature in base::sample
</p>


<h3>Author(s)</h3>

<p>Richel J.C. Bilderbeek
</p>


<h3>See Also</h3>

<p>See <code><a href="base.html#topic+sample">sample</a></code> for more details
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  # Number of draws
  n &lt;- 1000
  
  # Do normal sampling
  set.seed(42)
  draws_1 &lt;- DDD:::rng_respecting_sample(
    1:3, size = n, replace = TRUE, prob = c(1.0, 1.0, 1.0)
  )
  
  # Do a sampling with one element of probability zero
  set.seed(42)
  draws_2 &lt;- DDD:::rng_respecting_sample(
    1:4, size = n, replace = TRUE, prob = c(1.0, 1.0, 1.0, 0.0)
  )
  testit::assert(sum(draws_2 == 4) == 0)
  testit::assert(draws_1 == draws_2)
  
  # Use base sampling will give different results,
  # as it results in different RNG values
  set.seed(42)
  draws_3 &lt;- sample(
    1:4, size = n, replace = TRUE, prob = c(1.0, 1.0, 1.0, 0.0)
  )
  testit::assert(sum(draws_3 == 4) == 0)
  testit::assert(!all(draws_1 == draws_3))
  
</code></pre>

<hr>
<h2 id='roundn'>Rounds up in the usual manner</h2><span id='topic+roundn'></span>

<h3>Description</h3>

<p>The standard round function in R rounds x.5 to the nearest even integer.
This is odd behavior that is corrected in roundn
</p>


<h3>Usage</h3>

<pre><code class='language-R'>roundn(x, digits = 0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="roundn_+3A_x">x</code></td>
<td>
<p>Number to be rounded</p>
</td></tr>
<tr><td><code id="roundn_+3A_digits">digits</code></td>
<td>
<p>Sets the number of decimals in rounding.</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>n</code></td>
<td>
<p> A number </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Rampal S. Etienne
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
round(2.5)
roundn(2.5)
round(3.5)
roundn(3.5)
round(2.65,digits = 1)
roundn(2.65,digits = 1)
round(2.75,digits = 1)
roundn(2.75,digits = 1)

</code></pre>

<hr>
<h2 id='sample2'>Takes samples in the usual manner</h2><span id='topic+sample2'></span>

<h3>Description</h3>

<p>The standard sample function in R samples from n numbers when x = n. This is
unwanted behavior when the size of the vector to sample from changes
dynamically. This is corrected in sample2
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sample2(x, size, replace = FALSE, prob = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sample2_+3A_x">x</code></td>
<td>
<p>A vector of one or more elements</p>
</td></tr>
<tr><td><code id="sample2_+3A_size">size</code></td>
<td>
<p>A non-negative integer giving the number of items to choose.</p>
</td></tr>
<tr><td><code id="sample2_+3A_replace">replace</code></td>
<td>
<p>Should sampling be with replacement?</p>
</td></tr>
<tr><td><code id="sample2_+3A_prob">prob</code></td>
<td>
<p>A vector of probability weights for obtaining the elements of
the vector being sampled.</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>sam</code></td>
<td>
<p>A vector of length <code>size</code> that is sampled from
<code>x</code>. </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Rampal S. Etienne
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
sample(x = 10,size = 5,replace = TRUE)
sample2(x = 10,size = 5,replace = TRUE)

</code></pre>

<hr>
<h2 id='simplex'>Carries out optimization using a simplex algorithm (finding a minimum)</h2><span id='topic+simplex'></span>

<h3>Description</h3>

<p>Function to optimize target function using a
simplex method adopted from Matlab
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simplex(fun, trparsopt, optimpars, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simplex_+3A_fun">fun</code></td>
<td>
<p>Function to be optimized</p>
</td></tr>
<tr><td><code id="simplex_+3A_trparsopt">trparsopt</code></td>
<td>
<p>Initial guess of the parameters to be optimized</p>
</td></tr>
<tr><td><code id="simplex_+3A_optimpars">optimpars</code></td>
<td>
<p>Parameters of the optimization: relative tolerance in
function arguments, relative tolerance in function value, absolute tolerance
in function arguments, and maximum number of iterations</p>
</td></tr>
<tr><td><code id="simplex_+3A_...">...</code></td>
<td>
<p>Any other arguments of the function to be optimimzed, or settings
of the optimization routine</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>out</code></td>
<td>
<p> A list containing optimal function arguments
(<code>par</code>, the optimal function value (<code>fvalues</code>) and whether the
optimization converged (<code>conv</code>)</p>
</td></tr></table>
<p>.
</p>


<h3>Author(s)</h3>

<p>Rampal S. Etienne
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
cat("No examples")

</code></pre>

<hr>
<h2 id='td_sim'>Simulation of a diversity-dependent-like time-dependent process</h2><span id='topic+td_sim'></span>

<h3>Description</h3>

<p>Simulates a phylogenetic tree branching according to a 
time-dependent process calibrated on the expected number 
of species under a diversity-dependent process over time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>td_sim(pars, age, ddmodel = 1, methode = "ode45")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="td_sim_+3A_pars">pars</code></td>
<td>
<p>Vector of parameters:
<br /> <br /> <code>pars[1]</code> corresponds to
lambda0 (speciation rate)
<br /> <code>pars[2]</code> corresponds to mu0 (extinction
rate)
<br /> <code>pars[3]</code> corresponds to lambda1 (decline parameter in
speciation rate) or K in diversity-dependence-like models
<br /> <code>pars[4]</code> corresponds to mu1 (decline parameter in extinction rate)</p>
</td></tr>
<tr><td><code id="td_sim_+3A_age">age</code></td>
<td>
<p>crown age of the tree to simulate, i.e. the simulation time.</p>
</td></tr>
<tr><td><code id="td_sim_+3A_ddmodel">ddmodel</code></td>
<td>
<p>the diversity-dependent model used as reference for the 
time-dependent model.</p>
</td></tr>
<tr><td><code id="td_sim_+3A_methode">methode</code></td>
<td>
<p>The method used to solve the master equation. 
See <code>deSolve::ode()</code> documentation for possible inputs</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the following four elements: The first element is the 
tree of extant species in phylo format <br />
The second element is the tree of all species, including extinct species, 
in phylo format <br />
The third element is a matrix of all species where 
- the first column is the time at which a species is born <br />
- the second column is the label of the parent of the species; 
positive and negative values only indicate whether the species belongs to 
the left or right crown lineage <br />
- the third column is the label of the daughter species itself; 
positive and negative values only indicate whether the species belongs to 
the left or right crown lineage <br />
- the fourth column is the time of extinction of the species. If this 
equals -1, then the species is still extant.
</p>


<h3>Author(s)</h3>

<p>César Martinez, Rampal S. Etienne
</p>

<hr>
<h2 id='transform_pars'>Transforming parameters from -Inf to Inf into parameters
from -1 to 1</h2><span id='topic+transform_pars'></span>

<h3>Description</h3>

<p>Function to transform pars in a way that is more
useful for optimization: trpars &lt;- sign(pars) * pars/(sign(pars) + pars);
</p>


<h3>Usage</h3>

<pre><code class='language-R'>transform_pars(pars)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="transform_pars_+3A_pars">pars</code></td>
<td>
<p>Parameters to be transformed</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Transformed parameters
</p>


<h3>Author(s)</h3>

<p>Rampal S. Etienne
</p>

<hr>
<h2 id='untransform_pars'>Untransforming parameters from -1 to 1 into parameters
from -Inf to Inf.</h2><span id='topic+untransform_pars'></span>

<h3>Description</h3>

<p>Function to untransform pars after optimization:
pars &lt;- sign(trpars) * trpars/(sign(trpars) - trpars);
</p>


<h3>Usage</h3>

<pre><code class='language-R'>untransform_pars(trpars)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="untransform_pars_+3A_trpars">trpars</code></td>
<td>
<p>Parameters to be untransformed</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Untransformed parameters
</p>


<h3>Author(s)</h3>

<p>Rampal S. Etienne
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
