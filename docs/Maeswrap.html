<!DOCTYPE html><html><head><title>Help for package Maeswrap</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {Maeswrap}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#checkwatbal'><p>Checks MAESPA water balance by adding up fluxes for the soil water balance calculated by MAESPA. Prints the</p>
total fluxes (precipitation, transpiration, canopy interception, and so on),
and the difference between ingoing and outgoing. This is a
debugging/checking tool: if the model has serious problems, there will be a
missing sink or source.</a></li>
<li><a href='#maesparunall'><p>Functions for MAESPA batch runs</p></a></li>
<li><a href='#Maeswrap-package'><p>Bundle of functions for modifying MAESTRA/MAESPA input files, and reading</p>
output files.</a></li>
<li><a href='#maeswrapdefinitions'><p>Example Maeswrap definition file</p></a></li>
<li><a href='#parseFile'><p>Parse an input file</p></a></li>
<li><a href='#Plotstand'><p>Plot the stand in 3D</p></a></li>
<li><a href='#plotuspar'><p>Plot the understorey PAR points</p></a></li>
<li><a href='#randomstand'><p>Generate a simple random stand of trees</p></a></li>
<li><a href='#readdayflux'><p>Reads the dayflx.dat output file</p></a></li>
<li><a href='#readhrflux'><p>Reads the hrflux.dat MAESTRA/MAESPA output file</p></a></li>
<li><a href='#readmet'><p>Reads the met.dat input file</p></a></li>
<li><a href='#readNameList'><p>Read a namelist into a list</p></a></li>
<li><a href='#readwatbal'><p>Reads the watbal.dat MAESPA output file</p></a></li>
<li><a href='#replacemetdata'><p>Replace a weather variable</p></a></li>
<li><a href='#replaceNameList'><p>Replaces a namelist or a parameter</p></a></li>
<li><a href='#revchar'><p>Reverse a character string.</p></a></li>
<li><a href='#runfiletest'><p>Example Maeswrap run datafile.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Wrapper Functions for MAESTRA/MAESPA</td>
</tr>
<tr>
<td>Version:</td>
<td>1.7</td>
</tr>
<tr>
<td>Author:</td>
<td>Remko Duursma</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Remko Duursma &lt;remkoduursma@gmail.com&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>rgl,lattice,geometry,stringr,tools</td>
</tr>
<tr>
<td>Description:</td>
<td>A bundle of functions for modifying MAESTRA/MAESPA input files,reading output files, and visualizing the stand in 3D. Handy for running sensitivity analyses, scenario analyses, etc.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL]</td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2015-06-30 02:28:55 UTC; 30022860</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2015-06-30 09:22:04</td>
</tr>
</table>
<hr>
<h2 id='checkwatbal'>Checks MAESPA water balance by adding up fluxes for the soil water balance calculated by MAESPA. Prints the
total fluxes (precipitation, transpiration, canopy interception, and so on),
and the difference between ingoing and outgoing. This is a
debugging/checking tool: if the model has serious problems, there will be a
missing sink or source.</h2><span id='topic+checkwatbal'></span>

<h3>Description</h3>

<p>Checks MAESPA water balance by adding up fluxes for the soil water balance calculated by MAESPA. Prints the
total fluxes (precipitation, transpiration, canopy interception, and so on),
and the difference between ingoing and outgoing. This is a
debugging/checking tool: if the model has serious problems, there will be a
missing sink or source.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>checkwatbal(x = readwatbal(), usemeaset = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="checkwatbal_+3A_x">x</code></td>
<td>
<p>A dataframe returned by <code><a href="#topic+readwatbal">readwatbal</a></code>.</p>
</td></tr>
<tr><td><code id="checkwatbal_+3A_usemeaset">usemeaset</code></td>
<td>
<p>Whether to use measured ET from the met file, or simulated
(Default).</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Remko Duursma
</p>


<h3>See Also</h3>

<p><code><a href="#topic+readwatbal">readwatbal</a></code>
</p>

<hr>
<h2 id='maesparunall'>Functions for MAESPA batch runs</h2><span id='topic+maesparunall'></span><span id='topic+maestrarunall'></span><span id='topic+runmaespa'></span><span id='topic+runmaestra'></span>

<h3>Description</h3>

<p>Functions for running MAESTRA/MAESPA with parameters read from a .csv file.
To make multiple runs, create a comma-separated file (.csv) with each row
corresponding to a set of parameter values to be used in a simulation.  Each
column is for a different parameter, with its first entry being the name of
the parameter (see Details below).  Also needed is a text file with
definitions, i.e. how parameter names in the .csv file correspond to
parameter names in one of the MAESTRA input files, which file it is, and in
which namelist to look (see Details).  See Examples below for useage, and
how to deal with the results from a batch run.  Note that the batch
utilities use the executable 'maespa.exe' (runmaespa), or 'maestra.exe'
(runmaestra) by default, but you can use others. See Examples on how to set
this.
</p>
<p>Users will typically run <code>maesparunall</code>, which runs every row in the
comma-separated file denoted by <code>runfile</code>. Every column in this runfile
is named, with the name corresponding not directly to a parameter or
namelist in one of the fortran input files, but rather to an entry in the
definition file. This file (argument <code>deffile</code>) needs to be in the
current workspace. It is a space (or tab)-separated file, with four columns:
'parname', 'fileparname', 'filename' and 'namelist'. An example of this file
is provided with this package. Entries of each do not need to be quoted. The
namelist entry can be left blank, but it is recommended to provide the
namelist where the parameter occurs, for reliability.
</p>
<p>The default executable is <code>maespa.exe</code> when running <code>runmaespa</code>,
but others can of course be used.  The function <code>runmaestra</code> is exactly
the same as <code>runmaespa</code>, except that the default is to use the
executable 'maestra.exe'. To set the default for the rest of the session,
see the last Example below.
</p>
<p>Note that these functions should be general, in that they can be used for
any Fortran compiled program (.exe) that reads parameters from namelists.
</p>
<p>By default, Maes(tra/pa) reads and saves the 'hrflux.dat' and 'dayflux.dat'
files, and the 'watbal.dat' if it exists (i.e., if Maespa was used for the
simulation). The 'extrafiles' argument specified additional output files to
read and store.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>maesparunall(whichrows = NA, runfile = NA, whichcols = NA,
  quiet = FALSE, extrafiles = "", ...)

maestrarunall(executable = "maestra.exe", ...)

runmaespa(whichrow = 1, whichcols = NA, runfile = file.choose(),
  runit = TRUE, executable = "maespa.exe",
  deffile = "maeswrapdefinitions.txt", spinup = FALSE, ...)

runmaestra(executable = "maestra.exe", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="maesparunall_+3A_whichrows">whichrows</code></td>
<td>
<p>Which rows of the runfile to run in the simulations?</p>
</td></tr>
<tr><td><code id="maesparunall_+3A_runfile">runfile</code></td>
<td>
<p>Name of the runfile, needs to be a .csv file, quoted. If left
alone, a menu pops up.</p>
</td></tr>
<tr><td><code id="maesparunall_+3A_whichcols">whichcols</code></td>
<td>
<p>Which columns in the runfile contain parameters to be
changed in the simulations?</p>
</td></tr>
<tr><td><code id="maesparunall_+3A_quiet">quiet</code></td>
<td>
<p>If TRUE, no progress is written to the console.</p>
</td></tr>
<tr><td><code id="maesparunall_+3A_extrafiles">extrafiles</code></td>
<td>
<p>Additional files to read and store (See Details).</p>
</td></tr>
<tr><td><code id="maesparunall_+3A_...">...</code></td>
<td>
<p>Further parameters passed to <code>runmaespa</code> or <code>readPAR</code></p>
</td></tr>
<tr><td><code id="maesparunall_+3A_executable">executable</code></td>
<td>
<p>Name of the executable.</p>
</td></tr>
<tr><td><code id="maesparunall_+3A_whichrow">whichrow</code></td>
<td>
<p>For one run, which row to run?</p>
</td></tr>
<tr><td><code id="maesparunall_+3A_runit">runit</code></td>
<td>
<p>If FALSE, writes the input files but does not run the model.</p>
</td></tr>
<tr><td><code id="maesparunall_+3A_deffile">deffile</code></td>
<td>
<p>Text file with definitions of parameter names in the input
files, their locations in files and namelists. See Details.</p>
</td></tr>
<tr><td><code id="maesparunall_+3A_spinup">spinup</code></td>
<td>
<p>For Maespa only : if TRUE, the model is run once, and all
final values of soil water content and soil temperature are used to
initialize the next run, which is the run that is reported.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>For runmaespa, nothing is returned. Assuming you used runit=TRUE,
the model is run and output files are written to disk. The function
maesparunall returns a list with two components: daily and hourly. These
components are itself lists with each element a dataframe with the daily or
hourly results from the model output. These dataframes are read from the
files dayflux.dat and hrflux.dat.
</p>


<h3>Author(s)</h3>

<p>Remko Duursma
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

#-1. Run the second row of some csv file, using only entries in
# columns 2, 3 and 4. Note that all column names in the .csv
# file must be documented in the definition file, and that the
# definition file must be in the current working directory!
runmaespa(2, runfile="runfiletest.csv", runit=FALSE, whichcols=2:4)

#-2. Run all rows and all parameters from a comma-separated file.
runresults &lt;- maesparunall(runfile="runfiletest.csv")

#-3. Look at first run:
summary(runresults$daily[[1]])

#-4. Summarize across runs with statements like these.
# Sum net photosynthesis across runs:
sapply(runresults$daily, function(dfr)sum(dfr$netPs))

#-5. Or write all results to disk:
filenames &lt;- paste("MaespaDailyresults",1:length(runresults$daily),".txt",sep="")
for(f in 1:length(filenames)){
    write.table(runresults$daily[[f]],filenames[f],sep=" ",row.names=FALSE)
}

#-6. Use different executable:
runmaespa(executable="othermaestra.exe")

#-7. Or set this other executable as the default for the rest of the session,
# so that you only need to set it once (until you restart R anyway).
formals(runmaespa)$executable &lt;- "othermaestra.exe"

#-8. Specify additional output files to read and save:
myrun &lt;- maestrarunall(runfile="myrunfile.csv", extrafiles=c("layflx.dat","resp.dat"))
# These two files are then available in the 'myrun' list by names 'layflx' and 'resp'.


## End(Not run)
</code></pre>

<hr>
<h2 id='Maeswrap-package'>Bundle of functions for modifying MAESTRA/MAESPA input files, and reading
output files.</h2><span id='topic+Maeswrap'></span><span id='topic+Maeswrap-package'></span>

<h3>Description</h3>

<p>The main functions are <code><a href="#topic+runmaespa">runmaespa</a></code> and
<code><a href="#topic+maesparunall">maesparunall</a></code>, see their help pages. Functions that read
parameters, and modify parameters or whole namelists are
<code><a href="#topic+readPAR">readPAR</a></code>, <code><a href="#topic+replacePAR">replacePAR</a></code>,
<code><a href="#topic+replaceNameList">replaceNameList</a></code>, and <code><a href="#topic+parseFile">parseFile</a></code> to read an entire
file. Functions that read output are <code><a href="#topic+readdayflux">readdayflux</a></code>,
<code><a href="#topic+readhrflux">readhrflux</a></code>
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;"> Package: </td><td style="text-align: left;"> Maeswrap</td>
</tr>
<tr>
 <td style="text-align: left;"> Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;"> Version: </td><td style="text-align: left;">
1.2</td>
</tr>
<tr>
 <td style="text-align: left;"> Date: </td><td style="text-align: left;"> 2008-12-03</td>
</tr>
<tr>
 <td style="text-align: left;"> License: </td><td style="text-align: left;"> GPL</td>
</tr>
<tr>
 <td style="text-align: left;"> LazyLoad: </td><td style="text-align: left;"> yes</td>
</tr>
<tr>
 <td style="text-align: left;"> </td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Remko Duursma Maintainer: Remko Duursma &lt;remkoduursma@gmail.com&gt;
</p>


<h3>References</h3>

<p>See Belinda Medlyn's MAESTRA homepage at:
<a href="http://maespa.github.io">http://maespa.github.io</a>
</p>

<hr>
<h2 id='maeswrapdefinitions'>Example Maeswrap definition file</h2><span id='topic+maeswrapdefinitions'></span>

<h3>Description</h3>

<p>The MAESTRA/MAESPA wrapper needs a 'definition file', where names of
parameters are defined, together with their locations in parameter files and
namelists. The 'comment' column is ignored when parsing the definition file.
</p>


<h3>Format</h3>

<p>A white space separated dataset (readable with <code>read.table</code>).</p>


<h3>References</h3>

<p>None.
</p>

<hr>
<h2 id='parseFile'>Parse an input file</h2><span id='topic+parseFile'></span>

<h3>Description</h3>

<p>Takes an input file for MAESTRA/MAESPA, and reads all namelists into a
nested list. Also reads the first line of the file, which (optionally) contains a title,
to be used in Maestra/pa output files.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>parseFile(fn)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="parseFile_+3A_fn">fn</code></td>
<td>
<p>Filename</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a named list, each element contains a namelist and its
parameters.
</p>


<h3>See Also</h3>

<p>To read one namelist from a file, see <code><a href="#topic+readNameList">readNameList</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Parse a file
con &lt;- parseFile("confile.dat")

# Namelists in the file
names(con)

## End(Not run)
</code></pre>

<hr>
<h2 id='Plotstand'>Plot the stand in 3D</h2><span id='topic+Plotstand'></span><span id='topic+plottree'></span>

<h3>Description</h3>

<p>Reads the MAESTRA trees file, and plots the stand in 3D. Supports all
MAESTRA crown shapes except the box shape.  Looks for the 'trees.dat' file
in the current working directory, unless specified (see Examples).  The XY
coordinates *must be present* in the 'trees.dat' file. Users will typically
only use the 'Plotstand' function.
</p>
<p>Optionally reads the crown shape from the 'str.dat' file, and plots the
correct crown shape for each species in the stand by reading the
multi-species namelists in 'confile.dat' and 'trees.dat'.
</p>
<p>The target trees are colored red (unless specified otherwise, see Details),
if the 'itargets' is specified in the confile.
</p>
<p>Attempts to read indivradx, indivrady, indivhtcrown, indivdiam, and
indivhttrunk namelists from the 'trees.dat' file. If any of these fail, the
'all' versions are tried ('allradx', etc.).  Although MAESTRA runs fine when
no XY coordinates are provided, this plot function crashes. A future
implementation will calculate XY coordinates in the same way as MAESTRA.
</p>
<p>If the 'strfiles' parameter is set in 'confile.dat' (one str.dat file for
each species in the stand), these files are opened and used to set the crown
shape by species. Alternatively, you may specify crownshape as a parameter,
and override reading of str.dat by setting readstrfiles=FALSE.
</p>
<p>The 'nz' and 'nalpha' arguments specify the 'smoothness' of the crowns:
higher values provide more detailed triangulation of the crowns, at the
expense of speed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Plotstand(treesfile = "trees.dat", strfile = "str.dat",
  crownshape = c("cone", "ellipsoid", "round", "halfellipsoid", "paraboloid",
  "cylinder"), readstrfiles = TRUE, targethighlight = TRUE,
  addNarrow = TRUE, xyaxes = TRUE, labcex = 1, axiscex = 1,
  verbose = FALSE, idate = 1, path = "", ...)

plottree(crownshape = c("cone", "elipsoid", "ellipsoid", "round",
  "halfellipsoid", "paraboloid", "cylinder"), CL = 1, CW = 1, HCB = 1,
  X = 0, Y = 0, dbh = 0.3, crowncolor = "forestgreen",
  stemcolor = "brown", nz = 25, nalpha = 25, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Plotstand_+3A_treesfile">treesfile</code></td>
<td>
<p>By default, the 'trees.dat' file in the current dir.</p>
</td></tr>
<tr><td><code id="Plotstand_+3A_strfile">strfile</code></td>
<td>
<p>Not used, yet.</p>
</td></tr>
<tr><td><code id="Plotstand_+3A_crownshape">crownshape</code></td>
<td>
<p>Character,
&quot;cone&quot;,&quot;elipsoid&quot;,&quot;ellipsoid&quot;,&quot;halfellipsoid&quot;,&quot;paraboloid&quot;,&quot;cylinder&quot;, or
abbreviation.</p>
</td></tr>
<tr><td><code id="Plotstand_+3A_readstrfiles">readstrfiles</code></td>
<td>
<p>Read the 'str.dat' file(s) to find out crown shape?</p>
</td></tr>
<tr><td><code id="Plotstand_+3A_targethighlight">targethighlight</code></td>
<td>
<p>Plot the target trees in red?</p>
</td></tr>
<tr><td><code id="Plotstand_+3A_addnarrow">addNarrow</code></td>
<td>
<p>Logical. Add arrow pointing North?</p>
</td></tr>
<tr><td><code id="Plotstand_+3A_xyaxes">xyaxes</code></td>
<td>
<p>Logical. Add annotated X and Y axes?</p>
</td></tr>
<tr><td><code id="Plotstand_+3A_labcex">labcex</code></td>
<td>
<p>Relative size of X and Y axis labels.</p>
</td></tr>
<tr><td><code id="Plotstand_+3A_axiscex">axiscex</code></td>
<td>
<p>Relative size of X and Y axis annotation.</p>
</td></tr>
<tr><td><code id="Plotstand_+3A_verbose">verbose</code></td>
<td>
<p>If TRUE, writes more info to the screen while plotting.</p>
</td></tr>
<tr><td><code id="Plotstand_+3A_idate">idate</code></td>
<td>
<p>If multiple dates are provided for tree size variables, which
one to display.</p>
</td></tr>
<tr><td><code id="Plotstand_+3A_path">path</code></td>
<td>
<p>The folder where the input files are stored.</p>
</td></tr>
<tr><td><code id="Plotstand_+3A_cl">CL</code></td>
<td>
<p>Crown length (m).</p>
</td></tr>
<tr><td><code id="Plotstand_+3A_cw">CW</code></td>
<td>
<p>Crown width (m).</p>
</td></tr>
<tr><td><code id="Plotstand_+3A_hcb">HCB</code></td>
<td>
<p>Height of crown base (m).</p>
</td></tr>
<tr><td><code id="Plotstand_+3A_x">X</code>, <code id="Plotstand_+3A_y">Y</code></td>
<td>
<p>X- and Y-coordinates of tree stem base (m).</p>
</td></tr>
<tr><td><code id="Plotstand_+3A_dbh">dbh</code></td>
<td>
<p>Stem diameter (m). Converted to m if appears to be in cm.</p>
</td></tr>
<tr><td><code id="Plotstand_+3A_crowncolor">crowncolor</code></td>
<td>
<p>The color of the tree crowns. Default, obviously,
'forestgreen'.</p>
</td></tr>
<tr><td><code id="Plotstand_+3A_stemcolor">stemcolor</code></td>
<td>
<p>The color of the tree stems. Default 'brown'.</p>
</td></tr>
<tr><td><code id="Plotstand_+3A_nz">nz</code></td>
<td>
<p>Number of z divisions (increase number to get smoother crowns).</p>
</td></tr>
<tr><td><code id="Plotstand_+3A_nalpha">nalpha</code></td>
<td>
<p>Number of angular divisions (increase number to get smoother
crowns).</p>
</td></tr>
<tr><td><code id="Plotstand_+3A_...">...</code></td>
<td>
<p>Further parameters passed (to plottree, or triangles3d).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For large stands, the plot takes quite a while to complete. This code is far
from optimized for speed, because I am patient. Also, minimize the rgl window to greatly speed it up.
</p>


<h3>Value</h3>

<p>An rgl device is opened.
</p>


<h3>Author(s)</h3>

<p>Remko Duursma
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

# Plot the 'trees.dat' file in the current working directory:
Plotstand()

# Open a dialog box to select a trees.dat file:
Plotstand(file.choose())

# Save a snapshot to a .png file.
# Note: make sure to move the 3D plot into view
# (so that other windows are not blocking it!)
snapshot3d('myforest.png')

# For publication-quality graphs:
Plotstand(nz=50, nalpha=50)



## End(Not run)
</code></pre>

<hr>
<h2 id='plotuspar'>Plot the understorey PAR points</h2><span id='topic+plotuspar'></span><span id='topic+readuspar'></span>

<h3>Description</h3>

<p>Reads the 'uspar.dat' file in the current working directory, and plots the
incident or absorbed (or diffuse, or direct) PAR at the understorey points.
Either produces a plot, or makes a pdf with a plot for each hour of the
selected day.
</p>
<p>Reads the point-wise output file when the understorey was simulated.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plotuspar(what = c("PARbeam", "PARtotal", "PARdiffuse", "APAR"),
  dataset = NULL, day = 1, hour = NA, xlim = NULL, ylim = NULL,
  makepdf = FALSE, outputfile = "aparunderstorey.pdf", scaleeach = TRUE,
  addNarrow = TRUE)

readuspar(filename = "uspar.dat")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plotuspar_+3A_what">what</code></td>
<td>
<p>Either 'diff', 'apar', 'ipar', or 'beam' (the default).</p>
</td></tr>
<tr><td><code id="plotuspar_+3A_dataset">dataset</code></td>
<td>
<p>If left alone, reads the uspar dataset.</p>
</td></tr>
<tr><td><code id="plotuspar_+3A_day">day</code></td>
<td>
<p>Which day to use, if left alone uses the first day only.</p>
</td></tr>
<tr><td><code id="plotuspar_+3A_hour">hour</code></td>
<td>
<p>Which hour to plot. If left alone, makes a plot for each hour.</p>
</td></tr>
<tr><td><code id="plotuspar_+3A_xlim">xlim</code>, <code id="plotuspar_+3A_ylim">ylim</code></td>
<td>
<p>X- and Y-axis limits.</p>
</td></tr>
<tr><td><code id="plotuspar_+3A_makepdf">makepdf</code></td>
<td>
<p>Logical. If TRUE, produces a pdf in the working directory.</p>
</td></tr>
<tr><td><code id="plotuspar_+3A_outputfile">outputfile</code></td>
<td>
<p>Name of the pdf file.</p>
</td></tr>
<tr><td><code id="plotuspar_+3A_scaleeach">scaleeach</code></td>
<td>
<p>Logical. Rescale grey scale for each plot, or same for all
hours?</p>
</td></tr>
<tr><td><code id="plotuspar_+3A_addnarrow">addNarrow</code></td>
<td>
<p>Logical. Add an arrow pointing North.</p>
</td></tr>
<tr><td><code id="plotuspar_+3A_filename">filename</code></td>
<td>
<p>The understorey file</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If addNarrow is TRUE, attempts to read the trees.dat file in the current
working directory as well. Prints a warning when this file cannot be opened.
</p>


<h3>Value</h3>

<p>A lattice device, or a pdf.
</p>


<h3>Author(s)</h3>

<p>Remko Duursma
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

# Plot one hour of the first day, showing incident PAR on understorey:
plotuspar("ipar", day=1,hour=12,makepdf=FALSE)

# Make pdf of the whole day, plotting beam radiation:
plotuspar("beam", day=1, outputfile="beam uspar")


## End(Not run)
</code></pre>

<hr>
<h2 id='randomstand'>Generate a simple random stand of trees</h2><span id='topic+randomstand'></span>

<h3>Description</h3>

<p>Generates a stand of trees, given a LAI, stocking, and some basic allometry.
Very simple implementation that will be expanded (and eventually rolled into
Maes*).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>randomstand(LAI = 2, height = 20, cwcl = 0.8, ALAC = 0.5,
  stocking = 500, edge = 10, plotsize = c(25, 25), dbh = 0.3,
  crownshape = c("ELIP", "BOX", "CONE", "PARA", "CYL"), path = "",
  maxnotrees = 25)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="randomstand_+3A_lai">LAI</code></td>
<td>
<p>Leaf area index of the stand (m2 m-2)</p>
</td></tr>
<tr><td><code id="randomstand_+3A_height">height</code></td>
<td>
<p>Total tree height (m)</p>
</td></tr>
<tr><td><code id="randomstand_+3A_cwcl">cwcl</code></td>
<td>
<p>The ratio of crown width to crown length</p>
</td></tr>
<tr><td><code id="randomstand_+3A_alac">ALAC</code></td>
<td>
<p>The ratio of tree leaf area to crown surface area (m2 m-2)</p>
</td></tr>
<tr><td><code id="randomstand_+3A_stocking">stocking</code></td>
<td>
<p>Number of trees per hectare</p>
</td></tr>
<tr><td><code id="randomstand_+3A_edge">edge</code></td>
<td>
<p>An extra edge to be placed around the plot (in addition to plotsize!)</p>
</td></tr>
<tr><td><code id="randomstand_+3A_plotsize">plotsize</code></td>
<td>
<p>The size of the plot (m), as a vector (x,y)</p>
</td></tr>
<tr><td><code id="randomstand_+3A_dbh">dbh</code></td>
<td>
<p>Trunk diameter (not relevant, just for plotting) (m)</p>
</td></tr>
<tr><td><code id="randomstand_+3A_crownshape">crownshape</code></td>
<td>
<p>One of the Maestra crown shapes</p>
</td></tr>
<tr><td><code id="randomstand_+3A_path">path</code></td>
<td>
<p>Path to the directory where the Maestra files should be modified</p>
</td></tr>
<tr><td><code id="randomstand_+3A_maxnotrees">maxnotrees</code></td>
<td>
<p>Maximum number of target trees to be set in confile.dat (affects Maestra radiation calculations, not the plot and tree layout)</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Assuming your working directory contains the Maestra input files,
randomstand()
Plotstand()

## End(Not run)
</code></pre>

<hr>
<h2 id='readdayflux'>Reads the dayflx.dat output file</h2><span id='topic+readdayflux'></span>

<h3>Description</h3>

<p>Reads the dayflx.dat MAESTRA/MAESPA output file, returns a clean dataframe.
Names of the variables are read from the Columns: line.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>readdayflux(filename = "dayflx.dat")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="readdayflux_+3A_filename">filename</code></td>
<td>
<p>Default name of the daily flux file.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a dataframe.
</p>


<h3>Author(s)</h3>

<p>Remko Duursma
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Read it:
mysim1 &lt;- readdayflux()

## End(Not run)
</code></pre>

<hr>
<h2 id='readhrflux'>Reads the hrflux.dat MAESTRA/MAESPA output file</h2><span id='topic+readhrflux'></span>

<h3>Description</h3>

<p>Reads the hourly output file (hrflux.dat).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>readhrflux(filename = "hrflux.dat")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="readhrflux_+3A_filename">filename</code></td>
<td>
<p>Default name of the (half-)hourly output file.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a dataframe.
</p>


<h3>Author(s)</h3>

<p>Remko Duursma
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

# Simple as this:
mysim2 &lt;- readhrflux()

## End(Not run)
</code></pre>

<hr>
<h2 id='readmet'>Reads the met.dat input file</h2><span id='topic+readmet'></span>

<h3>Description</h3>

<p>Reads the meteorological input data in the met.dat file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>readmet(filename = "met.dat", nlines = -1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="readmet_+3A_filename">filename</code></td>
<td>
<p>Default name of the met.dat file.</p>
</td></tr>
<tr><td><code id="readmet_+3A_nlines">nlines</code></td>
<td>
<p>Optional, how many lines of the metfile to read?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a dataframe.
</p>


<h3>Author(s)</h3>

<p>Remko Duursma
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

# Simple as pi:
metdata &lt;- readmet()


## End(Not run)
</code></pre>

<hr>
<h2 id='readNameList'>Read a namelist into a list</h2><span id='topic+readNameList'></span><span id='topic+readPAR'></span>

<h3>Description</h3>

<p>Read a namelist into a list
</p>
<p>The <code>readPAR</code> function reads the value of any parameter in a namelist
in one of the MAESTRA/MAESPA input files.  Also works for other text files
that have the FORTRAN namelist input structure.  Optionally specifies in
which namelist to look for the parameter.
</p>
<p>To read an entire namelist into a list, use the <code>readNameList</code>
function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>readNameList(datfile, namelist)

readPAR(datfile, parname, namelist = NA, fail = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="readNameList_+3A_datfile">datfile</code></td>
<td>
<p>Name of the Maestra/Maespa input file (e.g. &quot;trees.dat&quot;)</p>
</td></tr>
<tr><td><code id="readNameList_+3A_namelist">namelist</code></td>
<td>
<p>Name of the namelist (e.g. &quot;plot&quot;)</p>
</td></tr>
<tr><td><code id="readNameList_+3A_parname">parname</code></td>
<td>
<p>Name of the parameter.</p>
</td></tr>
<tr><td><code id="readNameList_+3A_fail">fail</code></td>
<td>
<p>Logical. If TRUE, stops with an error when parameter is not
found (if FALSE, returns NA)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>For <code>readPAR</code>, either one value, or a vector, depending on how
many values are specified for the parameter in the input file.
</p>
<p>For <code>readNameList</code>, a named list.
</p>


<h3>Author(s)</h3>

<p>Remko Duursma. Thanks to Andreas Ibrom for reporting a bug.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+replacePAR">replacePAR</a></code>, <code><a href="#topic+readNameList">readNameList</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Read the number of trees in the plot:
readPAR("confile.dat", "notrees", "plot")

# Read the X and Y coordinates:
readPAR("confile.dat", "xycoords", "xy")

# Read entire namelist
readNameList("trees.dat", "plot")


## End(Not run)
</code></pre>

<hr>
<h2 id='readwatbal'>Reads the watbal.dat MAESPA output file</h2><span id='topic+readwatbal'></span>

<h3>Description</h3>

<p>Reads the hourly water balance output file (&quot;watbal.dat&quot;).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>readwatbal(filename = "watbal.dat")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="readwatbal_+3A_filename">filename</code></td>
<td>
<p>Default name of the (half-)hourly water balance output file.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a dataframe.
</p>


<h3>Author(s)</h3>

<p>Remko Duursma
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

# Simple as this:
mywatbalresult &lt;- readwatbal()

# If you want to select the water balance file with a menu:
readwatbal(file.choose())


## End(Not run)
</code></pre>

<hr>
<h2 id='replacemetdata'>Replace a weather variable</h2><span id='topic+replacemetdata'></span><span id='topic+replacemetvar'></span>

<h3>Description</h3>

<p>Replaces one (or more) of the weather variables in the met.dat file.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>replacemetdata(metdfr, oldmetfile = "met.dat", columns = NULL,
  newmetfile = "met.dat", khrs = NA, setdates = TRUE)

replacemetvar(replacevar, newvalues, oldmetfile = "met.dat",
  newmetfile = "metNEW.dat")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="replacemetdata_+3A_metdfr">metdfr</code></td>
<td>
<p>Dataframe with met data, to be pasted into a met.dat file.</p>
</td></tr>
<tr><td><code id="replacemetdata_+3A_oldmetfile">oldmetfile</code></td>
<td>
<p>Default name of the met.dat file that will be modified.</p>
</td></tr>
<tr><td><code id="replacemetdata_+3A_columns">columns</code></td>
<td>
<p>Optional character string : if the 'Columns' statement in the
met.dat file is to be replaced.</p>
</td></tr>
<tr><td><code id="replacemetdata_+3A_newmetfile">newmetfile</code></td>
<td>
<p>Name of the new met.dat file.</p>
</td></tr>
<tr><td><code id="replacemetdata_+3A_khrs">khrs</code></td>
<td>
<p>Optional. Number of timesteps per day (by default, read from the
met.dat file).</p>
</td></tr>
<tr><td><code id="replacemetdata_+3A_setdates">setdates</code></td>
<td>
<p>Logical. If TRUE, fixes the start and end date in the new met file.</p>
</td></tr>
<tr><td><code id="replacemetdata_+3A_replacevar">replacevar</code></td>
<td>
<p>Character. Name(s) of the variable to be replaced.</p>
</td></tr>
<tr><td><code id="replacemetdata_+3A_newvalues">newvalues</code></td>
<td>
<p>Vector of new values for the weather variable, has to be
the same length as the number of records in the met.dat file.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns nothing.
</p>


<h3>Author(s)</h3>

<p>Remko Duursma
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

#:::1.::: Replace precipitation with random number between 0 and 2.
# First find out how many records there are:
nrecords &lt;- nrow(readmet("met.dat"))

# Make new rain
newrain &lt;- runif(nrecords, 0, 2)

# And replace
replacemetvar("PPT",newrain,"met.dat", "newmet.dat")


#:::2.::: Replace multiple weather variables.
newtair &lt;- runif(nrecords, 0, 35)

# Have to make a matrix of the variables to be replaced:
newmat &lt;- matrix(cbind(newrain, newtair),ncol=2)

# And give a vector of variable names --in the same order as in the matrix!!--.
replacemetvar(c("PPT","TAIR"), newmat, "met.dat", "newmet.dat")



## End(Not run)
</code></pre>

<hr>
<h2 id='replaceNameList'>Replaces a namelist or a parameter</h2><span id='topic+replaceNameList'></span><span id='topic+replacePAR'></span>

<h3>Description</h3>

<p>The function <code>replaceNameList</code> replaces the whole namelist in an input file.
All parameters in the namelist must be provided, otherwise MAESTRA/MAESPA will likely crash. Or, you can use
<code>replacePAR</code> to replace a single parameter. If the new parameter value(s) is a vector (or a single value), the values #' will be placed on a single line in the parameter file. If instead a matrix is provided, each row of the matrix is placed on a separate line.
</p>
<p>WARNING : The input file is modified. Make sure to backup your original
input files!
</p>


<h3>Usage</h3>

<pre><code class='language-R'>replaceNameList(namelist, datfile, vals)

replacePAR(datfile, parname, namelist, newval, noquotes = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="replaceNameList_+3A_namelist">namelist</code></td>
<td>
<p>Name of the namelist.</p>
</td></tr>
<tr><td><code id="replaceNameList_+3A_datfile">datfile</code></td>
<td>
<p>Name of the input file.</p>
</td></tr>
<tr><td><code id="replaceNameList_+3A_vals">vals</code></td>
<td>
<p>A list of values (see example below).</p>
</td></tr>
<tr><td><code id="replaceNameList_+3A_parname">parname</code></td>
<td>
<p>Name of the parameter to replace the value of.</p>
</td></tr>
<tr><td><code id="replaceNameList_+3A_newval">newval</code></td>
<td>
<p>New value of the parameter. Can be a single value or a vector,
or a matrix (see Details).</p>
</td></tr>
<tr><td><code id="replaceNameList_+3A_noquotes">noquotes</code></td>
<td>
<p>Logical. If FALSE, does print quotes around character
values.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing is returned. The input file is modified.
</p>


<h3>Author(s)</h3>

<p>Remko Duursma
</p>


<h3>See Also</h3>

<p><code><a href="#topic+replacePAR">replacePAR</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Replace an entire namelist
replaceNameList(namelist="aerodyn",
    datfile="trees.dat", vals=list(zht=30,zpd=3,z0ht=0.6))

#' # Replace a parameter with a single value:
replacePAR("trees.dat", "notrees", "plot", newval=100)

# Replace a number of values:
replacePAR("trees.dat", "xycoords", "xy", newval=c(1,1,2,2,3,3))

# Replace a number of values in a different way : this may be useful in
# more complicated programs,
# rr when reading a string from a file (that should be interpreted as a vector).
replacePAR("trees.dat", "xycoords", "xy", newval="1 1 2 2 3 3", noquotes=TRUE)

# Replace a parameter so that the new values are placed on multiple rows.
# Useful for tree namelists with multiple dates and multiple trees
# (where each row corresponds to a tree, and each column to a date.)
m &lt;- matrix(c(1,2,3,4,5,6,7,8,9), nrow=3, byrow=TRUE)
replacePAR("trees.dat", "values", "indivlarea", newval=m)

## End(Not run)
</code></pre>

<hr>
<h2 id='revchar'>Reverse a character string.</h2><span id='topic+revchar'></span>

<h3>Description</h3>

<p>Reverses the characters in a character string, unless a vector is supplied,
in which case reverses the element of the vector.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>revchar(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="revchar_+3A_x">x</code></td>
<td>
<p>A character vector (typically of length 1).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When a character vector of length &gt; 1 is provided, reverses the elements of
the vector, not the characters itself.
</p>


<h3>Value</h3>

<p>A vector.
</p>


<h3>Author(s)</h3>

<p>Remko Duursma
</p>


<h3>References</h3>

<p>None.
</p>


<h3>See Also</h3>

<p><code><a href="base.html#topic+rev.default">rev.default</a></code>,<code><a href="base.html#topic+substr">substr</a></code>,<code><a href="base.html#topic+strsplit">strsplit</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Take a substring, counting from the end:
substrfromend &lt;- function(x,start,stop)revchar(substr(revchar(x),start,stop))
substrfromend('filename.txt', 1,3)

# Check if a word is a palindrome:
s &lt;- 'saippuakivikauppias'
s == revchar(s)

# A semordnilap:
cat('I am so stressed, I need to eat', revchar('stressed'),'\n')

## End(Not run)
</code></pre>

<hr>
<h2 id='runfiletest'>Example Maeswrap run datafile.</h2><span id='topic+runfiletest'></span>

<h3>Description</h3>

<p>Example of a 'run dataset', where each row corresponds to a simulation with
parameters set by the column names. The wrapper looks for the column names
in the definition file, and sets the parameters based on information in that
file.
</p>


<h3>Format</h3>

<p>A comma-separated file.</p>


<h3>References</h3>

<p>None.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
