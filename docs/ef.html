<!DOCTYPE html><html><head><title>Help for package ef</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ef}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#as.gam'><p>Coversion of an efp fit to a gam fit for plotting</p></a></li>
<li><a href='#BICadj'><p>Adjusted BIC function</p></a></li>
<li><a href='#ef_data'><p>Counts of salmon fry and parr from electrofishing.</p></a></li>
<li><a href='#ef-package'><p>Modelling Framework for the Estimation of Salmonid Abundance in Scottish Rivers</p></a></li>
<li><a href='#efp'><p>Estimate capture probabilites from electrofishing data</p></a></li>
<li><a href='#invlogit'><p>Inverse logistic transformation</p></a></li>
<li><a href='#logit'><p>Logistic transformation</p></a></li>
<li><a href='#overdispersion'><p>Estimating overdispersion</p></a></li>
<li><a href='#transpar'><p>Utility function to convert parameters to probabilities</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Modelling Framework for the Estimation of Salmonid Abundance</td>
</tr>
<tr>
<td>Version:</td>
<td>1.2.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2020-10-18</td>
</tr>
<tr>
<td>Description:</td>
<td>A set of functions to estimate capture probabilities and
  densities from multipass pass removal data.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.0), TMB</td>
</tr>
<tr>
<td>Imports:</td>
<td>Matrix, dplyr, methods, mgcv</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>TMB, RcppEigen</td>
</tr>
<tr>
<td>Suggests:</td>
<td>testthat</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>LazyData:</td>
<td>TRUE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-10-26 12:09:53 UTC; colin</td>
</tr>
<tr>
<td>Author:</td>
<td>Colin Millar [aut, cre],
  Rob Fryer [aut],
  Iain Malcolm [aut],
  Ross Glover [aut],
  Marine Scotland Science [cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Colin Millar &lt;colin.millar@ices.dk&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-11-03 12:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='as.gam'>Coversion of an efp fit to a gam fit for plotting</h2><span id='topic+as.gam'></span>

<h3>Description</h3>

<p>Coversion of an efp fit to a gam fit for plotting
</p>


<h3>Usage</h3>

<pre><code class='language-R'>as.gam(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="as.gam_+3A_object">object</code></td>
<td>
<p>an efp fitted model</p>
</td></tr>
</table>


<h3>Value</h3>

<p>gam type object
</p>

<hr>
<h2 id='BICadj'>Adjusted BIC function</h2><span id='topic+BICadj'></span>

<h3>Description</h3>

<p>Complete function for returning overdispersion estimates
</p>


<h3>Usage</h3>

<pre><code class='language-R'>BICadj(model, data, overdispersion.output)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="BICadj_+3A_model">model</code></td>
<td>
<p>a fitted ef model</p>
</td></tr>
<tr><td><code id="BICadj_+3A_data">data</code></td>
<td>
<p>the data used to fit the model</p>
</td></tr>
<tr><td><code id="BICadj_+3A_overdispersion.output">overdispersion.output</code></td>
<td>
<p>output form the function <a href="#topic+overdispersion">overdispersion</a></p>
</td></tr>
</table>


<h3>Value</h3>

<p>the adjusted BIC
</p>


<h3>Note</h3>

<p>When calling the function, you need to specify the data source for
the model so that the number of site visits can be determined.
You also need to specify the output from the overdispersion model
to get the measure
</p>

<hr>
<h2 id='ef_data'>Counts of salmon fry and parr from electrofishing.</h2><span id='topic+ef_data'></span>

<h3>Description</h3>

<p>A dataset containing counts from multipass electrofishing
samples over three sites and 5 years.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ef_data
</code></pre>


<h3>Format</h3>

<p>A data frame with 90 rows and 9 variables:
</p>

<dl>
<dt>siteID</dt><dd><p>Unique identifier for each elecrofishing site</p>
</dd>
<dt>year</dt><dd><p>year of data collection</p>
</dd>
<dt>date</dt><dd><p>date of data collections</p>
</dd>
<dt>EFpasscount:</dt><dd><p>the total number of electrofishing passes</p>
</dd>
<dt>pass</dt><dd><p>the electrofishing pass on which the fish were caught</p>
</dd>
<dt>species</dt><dd><p>fish species, Salmon</p>
</dd>
<dt>lifestage</dt><dd><p>fish lifestage, Fry or Parr</p>
</dd>
<dt>count</dt><dd><p>the number of fish caught per pass for each site visit and species, etc.</p>
</dd>
<dt>area</dt><dd><p>the area of river fished</p>
</dd>
</dl>



<h3>Source</h3>

<p><a href="https://www2.gov.scot/Topics/marine/Salmon-Trout-Coarse/Freshwater/Monitoring/temperature">https://www2.gov.scot/Topics/marine/Salmon-Trout-Coarse/Freshwater/Monitoring/temperature</a>
</p>

<hr>
<h2 id='ef-package'>Modelling Framework for the Estimation of Salmonid Abundance in Scottish Rivers</h2><span id='topic+ef-package'></span><span id='topic+ef'></span>

<h3>Description</h3>

<p>A set of functions to estimate capture probabilities and densities
from multipass pass removal data.
</p>

<hr>
<h2 id='efp'>Estimate capture probabilites from electrofishing data</h2><span id='topic+efp'></span>

<h3>Description</h3>

<p>This function uses the marginal likelihood of capture probabilities
to estimate model parameters
</p>


<h3>Usage</h3>

<pre><code class='language-R'>efp(
  formula,
  data = NULL,
  pass = pass,
  id = id,
  offset = NULL,
  verbose = FALSE,
  init = "0",
  hessian = TRUE,
  fit = TRUE,
  sample_re = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="efp_+3A_formula">formula</code></td>
<td>
<p>a formula object</p>
</td></tr>
<tr><td><code id="efp_+3A_data">data</code></td>
<td>
<p>a data.frame containing all relavent info</p>
</td></tr>
<tr><td><code id="efp_+3A_pass">pass</code></td>
<td>
<p>a vector of integers giving the pass number of the observation</p>
</td></tr>
<tr><td><code id="efp_+3A_id">id</code></td>
<td>
<p>a vector of integers identifying an observation (a set of electrofishing passes)</p>
</td></tr>
<tr><td><code id="efp_+3A_offset">offset</code></td>
<td>
<p>an possible offset for the linear predictor of capture probability</p>
</td></tr>
<tr><td><code id="efp_+3A_verbose">verbose</code></td>
<td>
<p>if TRUE stan optimiser messages are printed to the screen</p>
</td></tr>
<tr><td><code id="efp_+3A_init">init</code></td>
<td>
<p>should initialisatiom be random?</p>
</td></tr>
<tr><td><code id="efp_+3A_hessian">hessian</code></td>
<td>
<p>if TRUE the hessian is computed and the covariance matrix of the parameters is returned via Vb</p>
</td></tr>
<tr><td><code id="efp_+3A_fit">fit</code></td>
<td>
<p>if TRUE model is fitted if FALSE the data that would be passed to the optimiser is returned</p>
</td></tr>
<tr><td><code id="efp_+3A_sample_re">sample_re</code></td>
<td>
<p>should sample random effects be included</p>
</td></tr>
</table>


<h3>Value</h3>

<p>glm type object
</p>


<h3>Examples</h3>

<pre><code class='language-R'># create two electrofishing site visits with 3 and 4 passes and 2 lifestages
ef_data &lt;- data.frame(n      = c(100, 53, 24, 50, 26, 12,
                                 100, 53, 24, 50, 26, 12),
                      pass   = c(  1,  2,  3,  1,  2,  3,
                                   1,  2,  3,  1,  2,  3),
                      stage  = c(  1,  1,  1,  2,  2,  2,
                                   1,  1,  1,  2,  2,  2),
                      sample = c(  1,  1,  1,  2,  2,  2,
                                   3,  3,  3,  4,  4,  4))

ef_data2 &lt;- data.frame(n      = c(100, 53, 24, 50, 26, 12,
                                  100, 53, 24, 12, 50, 26, 12, 6),
                       pass   = c(  1,  2,  3,  1,  2,  3,
                                    1,  2,  3,  4,  1,  2,  3, 4),
                       stage  = c(  1,  1,  1,  2,  2,  2,
                                    1,  1,  1,  1,  2,  2,  2, 2),
                       sample = c(  1,  1,  1,  2,  2,  2,
                                    3,  3,  3,  3,  4,  4,  4, 4))

ef_data3 &lt;- data.frame(n      = c(100, 53, 24, 50, 26, 12, 40,
                                  100, 53, 24, 12, 50, 26, 12, 6, 40),
                       pass   = c(  1,  2,  3,  1,  2,  3, 1,
                                    1,  2,  3,  4,  1,  2,  3, 4, 1),
                       stage  = c(  1,  1,  1,  2,  2,  2, 1,
                                    1,  1,  1,  1,  2,  2,  2, 2, 2),
                       sample = c(  1,  1,  1,  2,  2,  2, 5,
                                    3,  3,  3,  3,  4,  4,  4, 4, 6))

# Fit a simple model
m2 &lt;- efp(n ~ 1 + factor(stage), data = ef_data, pass = pass, id = sample)
cbind(ef_data, fit = fitted(m2))
m3 &lt;- efp(n ~ 1 + factor(stage), data = ef_data2, pass = pass, id = sample)
cbind(ef_data2, fit = fitted(m3))
m4 &lt;- efp(n ~ 1 + factor(stage), data = ef_data3, pass = pass, id = sample)
cbind(ef_data3, fit = fitted(m4))

# create two electrofishing site visits with 3 and 4 passes and 2 lifestages
ef_data &lt;- data.frame(n      = c(200, 53, 24, 100, 26, 12,
                                 200, 53, 24, 100, 26, 12),
                      pass   = c(  1,  2,  3,  1,  2,  3,
                                   1,  2,  3,  1,  2,  3),
                      stage  = c(  1,  1,  1,  2,  2,  2,
                                   1,  1,  1,  2,  2,  2),
                      sample = c(  1,  1,  1,  2,  2,  2,
                                   3,  3,  3,  4,  4,  4))
# Fit a simple model
m2 &lt;- efp(n ~ 1 + factor(stage) + factor(replace(pass, pass&gt; 2, 2)),
          data = ef_data, pass = pass, id = sample)
out &lt;- cbind(ef_data, p = fitted(m2, type = "p"))
out

</code></pre>

<hr>
<h2 id='invlogit'>Inverse logistic transformation</h2><span id='topic+invlogit'></span>

<h3>Description</h3>

<p>This function transforms values on the logistic scale to values on
the probability scale.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>invlogit(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="invlogit_+3A_x">x</code></td>
<td>
<p>a numeric vector</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of values between 0 and 1
</p>

<hr>
<h2 id='logit'>Logistic transformation</h2><span id='topic+logit'></span>

<h3>Description</h3>

<p>This function transforms values on the probability scale to values on
the logistic scale.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>logit(p)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="logit_+3A_p">p</code></td>
<td>
<p>a numeric vector with values between 0 and 1</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of values between -Inf and Inf
</p>

<hr>
<h2 id='overdispersion'>Estimating overdispersion</h2><span id='topic+overdispersion'></span>

<h3>Description</h3>

<p>Complete function for returning overdispersion estimates
</p>


<h3>Usage</h3>

<pre><code class='language-R'>overdispersion(
  data,
  siteID,
  visitID,
  count = "count",
  pass = "pass",
  lifestage = "lifestage",
  pass12 = "pass12",
  id,
  largemodel
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="overdispersion_+3A_data">data</code></td>
<td>
<p>dataframe containing EF data</p>
</td></tr>
<tr><td><code id="overdispersion_+3A_siteid">siteID</code></td>
<td>
<p>site name or unique ID</p>
</td></tr>
<tr><td><code id="overdispersion_+3A_visitid">visitID</code></td>
<td>
<p>a number identifying each unique visit</p>
</td></tr>
<tr><td><code id="overdispersion_+3A_count">count</code></td>
<td>
<p>count of fish (defaults to &quot;count&quot;)</p>
</td></tr>
<tr><td><code id="overdispersion_+3A_pass">pass</code></td>
<td>
<p>the EF pass number (defaults to &quot;pass&quot;)</p>
</td></tr>
<tr><td><code id="overdispersion_+3A_lifestage">lifestage</code></td>
<td>
<p>the lifestage (defaults to &quot;lifestage&quot;)</p>
</td></tr>
<tr><td><code id="overdispersion_+3A_pass12">pass12</code></td>
<td>
<p>categorical variable with 2 levels where the 1st pass
and subsequent passes are treated separately (defaults to &quot;pass12&quot;)</p>
</td></tr>
<tr><td><code id="overdispersion_+3A_id">id</code></td>
<td>
<p>sample ID</p>
</td></tr>
<tr><td><code id="overdispersion_+3A_largemodel">largemodel</code></td>
<td>
<p>the large model that captures most of the systematic
variation in the data - this is specified before
running the overdispersion function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a data.frame summarising overdispersion
</p>


<h3>Note</h3>

<p>ensure column names in function call are in inverted commas
</p>

<hr>
<h2 id='transpar'>Utility function to convert parameters to probabilities</h2><span id='topic+transpar'></span>

<h3>Description</h3>

<p>The matrix G should be of dimension n x p,
and the parameter vector should be length p
</p>


<h3>Usage</h3>

<pre><code class='language-R'>transpar(par, G)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="transpar_+3A_par">par</code></td>
<td>
<p>fitted model parameters</p>
</td></tr>
<tr><td><code id="transpar_+3A_g">G</code></td>
<td>
<p>The design matrix for a model</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a data frame
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
