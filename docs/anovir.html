<!DOCTYPE html><html><head><title>Help for package anovir</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {anovir}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#anovir-package'><p>anovir: Analysis of Virulence</p></a></li>
<li><a href='#av_long_infected'><p>Average longevity: estimate for infected hosts</p></a></li>
<li><a href='#av_long_uninfected'><p>Average longevity: estimate for uninfected hosts</p></a></li>
<li><a href='#check_data'><p>Checks data are correctly described for models</p></a></li>
<li><a href='#conf_ints_virulence'><p>Approximate 95% confidence intervals for virulence</p></a></li>
<li><a href='#data_blanford'><p>Full data from Blanford et al (2012)</p></a></li>
<li><a href='#data_lorenz'><p>A subset of data from Lorenz &amp; Koella (2011)</p></a></li>
<li><a href='#data_parker'><p>Full data from Parker et al (2014)</p></a></li>
<li><a href='#etd_infected'><p>Expected time of death: infected hosts</p></a></li>
<li><a href='#etd_uninfected'><p>Expected time of death: uninfected hosts</p></a></li>
<li><a href='#nll_basic'><p>Negative log-likelihood function: basic model</p></a></li>
<li><a href='#nll_basic_logscale'><p>Negative log-likelihood function: basic model on logscale</p></a></li>
<li><a href='#nll_controls'><p>Negative log-likelihood function: control data only</p></a></li>
<li><a href='#nll_exposed_infected'><p>Negative log-likelihood function: exposed-infected</p></a></li>
<li><a href='#nll_frailty'><p>Negative log-likelihood function: frailty</p></a></li>
<li><a href='#nll_frailty_correlated'><p>Negative log-likelihood function: correlated frailty model</p></a></li>
<li><a href='#nll_frailty_logscale'><p>Negative log-likelihood function: frailty variables on logscale</p></a></li>
<li><a href='#nll_frailty_shared'><p>Negative log-likelihood function: frailty shared</p></a></li>
<li><a href='#nll_proportional_virulence'><p>Negative log-likelihood function: nll proportional virulence</p></a></li>
<li><a href='#nll_recovery'><p>Negative log-likelihood function: recovery model</p></a></li>
<li><a href='#nll_recovery_II'><p>Negative log-likelihood function: recovery model, no background mortality</p></a></li>
<li><a href='#nll_two_inf_subpops_obs'><p>Negative log-likelihood function:</p>
two observed subpopulations of infected hosts</a></li>
<li><a href='#nll_two_inf_subpops_unobs'><p>Negative log-likelihood function:</p>
two unobserved subpopulations of infected hosts</a></li>
<li><a href='#recovery_data'><p>Simulated recovery data</p></a></li>
<li><a href='#recovery_data_II'><p>Simulated recovery data, with no background mortality</p></a></li>
<li><a href='#sim_data_nll_basic'><p>Function simulating survival data for nll_basic</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Analysis of Virulence</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Philip Agnew &lt;philip.agnew@ird.fr&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Epidemiological population dynamics models traditionally define 
    a pathogen's virulence as the increase in the per capita rate of mortality 
    of infected hosts due to infection. This package provides functions 
    allowing virulence to be estimated by maximum likelihood techniques. The 
    approach is based on the analysis of relative survival comparing survival 
    in matching cohorts of infected vs. uninfected hosts (Agnew 2019) 
    &lt;<a href="https://doi.org/10.1101%2F530709">doi:10.1101/530709</a>&gt;. </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>Depends:</td>
<td>bbmle, R (&ge; 2.10), stats4</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, stats, testthat</td>
</tr>
<tr>
<td>Collate:</td>
<td>'anovir-package.R' 'private_functions.R' 'nll_recovery.R'
'nll_recovery_II.R' 'data_descriptions.R' 'main.R'
'play_file.R' 'nll_functions.R' 'nll_frailty_correlated.R'</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://www.biorxiv.org/content/10.1101/530709v1">https://www.biorxiv.org/content/10.1101/530709v1</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-10-15 16:10:52 UTC; philipagnew</td>
</tr>
<tr>
<td>Author:</td>
<td>Philip Agnew [aut, cre],
  Jimmy Lopez [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-10-24 08:50:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='anovir-package'>anovir: Analysis of Virulence</h2><span id='topic+anovir'></span><span id='topic+anovir-package'></span>

<h3>Description</h3>

<p>Epidemiological population dynamics models traditionally define a
pathogen's virulence as the increase in the per capita rate of mortality
of infected hosts due to infection.
The ANOVIR package provides functions allowing virulence to be estimated
by maximum likelihood techniques.
The approach is based on the analysis of relative survival applied to
the comparison of survival in matching cohorts of experimentally-infected
vs. uninfected hosts (Agnew 2019).
</p>


<h3>Details</h3>

<p>The analysis of relative survival is a statistical method for estimating
excess mortality.
Excess mortality occurs when a target population experiences greater
mortality than would be expected for a given period of time.
Here excess mortality is estimated in the context of emprical studies
where survival in populations of experimentally infected hosts is
compared to that in matching populations of uninfected, or control, hosts.
In this context the relative survival approach assumes the
rate of mortality observed in the infected treatment arises as the sum of
two independent and mutually exclusive sources of mortality,
(i) the 'natural' or background rate of mortality, and
(ii) an addition rate of mortality due to infection.
</p>
<p>The background rate of mortality is the expected rate of mortality hosts in
the infected treatment would have experienced had they not been
exposed to infection; it is estimated from mortality
observed in the matching uninfected control treatment.
When there is background mortality, the rate of mortality of infected
hosts due to infection is not directly observed;
however it can be estimated from the difference in mortality observed
for an infected treatment and that observed in a matching control treatment.
</p>
<p>The two sources of mortality assumed in the relative survival approach,
and the additive effect of their rates for infected hosts, is also found
in the population dynamics models on which most epidemiological theory
is based.
The additional rate of mortality of infected hosts due to
infection is generally how these models define pathogen virulence.
</p>


<h3>Acknowledgements</h3>

<p>PA is grateful to the following people;
</p>
<p>- Yannis MICHALAKIS for affording me the time and
space at work to develop this project
</p>
<p>- Simon BLANFORD and Matthew THOMAS for generously providing the data from
their 2012 study and allowing it to be made publically available
</p>
<p>- Célia TOURAINE at the Institut du Cancer de Montpellier (ICM)
for reading the original manuscript and validating the general
approach of analysing relative survival as a means to
estimate virulence
</p>
<p>- Eric ELGUERO for useful input during discussions on models for
recovery from infection and estimating confidence intervals
</p>
<p>- François ROUSSET for helpful technical advice concerning R
</p>
<p>This work was funded by basic research funds from the French research
agencies of the Centre National de la Recherche Scientifique (CNRS)
and the Institut de Recherche pour le Développement (IRD).
</p>


<h3>Author(s)</h3>

<p>Philip AGNEW &amp; Jimmy LOPEZ
</p>


<h3>References</h3>

<p>Agnew P (2019) Estimating virulence from relative survival. bioRxiv: 530709
<a href="https://doi.org/10.1101/530709">doi</a>
</p>


<h3>See Also</h3>

<p>Vignettes for examples of how to use and modify
the functions in this package to estimate pathogen virulence
</p>

<hr>
<h2 id='av_long_infected'>Average longevity: estimate for infected hosts</h2><span id='topic+av_long_infected'></span>

<h3>Description</h3>

<p>Calculates expected longevity of infected hosts due to background mortality
and mortality due to infection
</p>


<h3>Usage</h3>

<pre><code class='language-R'>av_long_infected(a1, b1, a2, b2, d1 = "", d2 = "")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="av_long_infected_+3A_a1">a1</code>, <code id="av_long_infected_+3A_b1">b1</code></td>
<td>
<p>numeric: location &amp; scale parameters for background mortality,
respectively</p>
</td></tr>
<tr><td><code id="av_long_infected_+3A_a2">a2</code>, <code id="av_long_infected_+3A_b2">b2</code></td>
<td>
<p>numeric: location &amp; scale parameters for mortality due to
infection, respectively</p>
</td></tr>
<tr><td><code id="av_long_infected_+3A_d1">d1</code>, <code id="av_long_infected_+3A_d2">d2</code></td>
<td>
<p>character: probability distributions to describe background
mortality and mortality due to infection, respectively</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The expected average longevity is calculated as the integral
from zero to infinity for the product of the cumulative survival
functions for background mortality and mortality due to infection,
given values of a1, b1, d1, a2, b2, d2
</p>


<h3>Value</h3>

<p>a vector
</p>


<h3>See Also</h3>

<p><code><a href="#topic+av_long_uninfected">av_long_uninfected</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  av_long_infected(
    a1 = 3.0, b1 = 0.6, d1 = "Weibull",
    a2 = 2.5, b2 = 0.5, d2 = "Frechet") # 12.156
</code></pre>

<hr>
<h2 id='av_long_uninfected'>Average longevity: estimate for uninfected hosts</h2><span id='topic+av_long_uninfected'></span>

<h3>Description</h3>

<p>Calculates expected average longevity due only to background mortality
</p>


<h3>Usage</h3>

<pre><code class='language-R'>av_long_uninfected(a1, b1, d1 = "")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="av_long_uninfected_+3A_a1">a1</code>, <code id="av_long_uninfected_+3A_b1">b1</code></td>
<td>
<p>numeric: location &amp; scale parameters for background mortality,
respectively</p>
</td></tr>
<tr><td><code id="av_long_uninfected_+3A_d1">d1</code></td>
<td>
<p>character: probability distribution chosen to describe data</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The expected average longevity is calculated as the integral from
zero to infinity of the cumulative survival function for background
mortality,
given values of a1, b1, d1
</p>


<h3>Value</h3>

<p>a vector
</p>


<h3>See Also</h3>

<p><code><a href="#topic+av_long_infected">av_long_infected</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  av_long_uninfected(a1 = 3.0, b1 = 0.6, d1 = "Weibull") #17.947
</code></pre>

<hr>
<h2 id='check_data'>Checks data are correctly described for models</h2><span id='topic+check_data'></span>

<h3>Description</h3>

<p>Function checking 'time', 'censor' and 'infected treatment'
columns in data.frame are correctly specified for the
likelihood functions in this package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_data(
  data = data,
  time = time,
  censor = censor,
  infected_treatment = infected_treatment
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_data_+3A_data">data</code></td>
<td>
<p>Name of data.frame to be checked</p>
</td></tr>
<tr><td><code id="check_data_+3A_time">time</code></td>
<td>
<p>Name of column with time of event data (death or censoring);
</p>
<p>requires time &gt; 0 and numeric.</p>
</td></tr>
<tr><td><code id="check_data_+3A_censor">censor</code></td>
<td>
<p>Name of column containing censor status;
</p>
<p>'1' censored,
</p>
<p>'0' uncensored or died during experiment
</p>
<p>(needs to be numeric)</p>
</td></tr>
<tr><td><code id="check_data_+3A_infected_treatment">infected_treatment</code></td>
<td>
<p>Name of column for infection treatment status;
</p>
<p>'1' a treatment exposed to infection,
</p>
<p>'0' treatment not exposed to infection
</p>
<p>(needs to be numeric).
</p>
<p>NB Different likelihood models make different assumptions as to whether
all the individuals in an infected treatment are infected
or not (c.f. <code><a href="#topic+nll_exposed_infected">nll_exposed_infected</a></code>)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>An error message is also given if data contain rows 'NA';
these need removing.
</p>
<p>NB error messages triggered on 1st encounter with a fault.
Correct and check revised data for other faults.
</p>


<h3>Value</h3>

<p>Message, 'Checks completed' or error message
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# view head of data.frame to be checked
  head(data_blanford, 3)

# specify data.frame and names of columns for;
  # time, censor status, infection status
  check_data(data = data_blanford,
             time = t,
             censor = censor,
             infected_treatment = inf)

# create data.frame 't_zero' with t = 0 in first row of data.frame
t_zero &lt;- data_blanford
t_zero[1, 8] &lt;- 0
head(t_zero, 3)

check_data(data = t_zero,
           time = t,
           censor = censor,
           infected_treatment = inf)

# correct '0' and make first row of column 'censor' = NA
  t_zero[1, 8] &lt;- 1 ; t_zero[1, 5] &lt;- NA ; head(t_zero, 3)

check_data(data = t_zero,
           time = t,
           censor = censor,
           infected_treatment = inf)

# remove row(s) with 'NA'
  t_zero_II &lt;- na.omit(t_zero) # NB applies to whole data.frame
  check_data(data = t_zero_II,
           time = t,
           censor = censor,
           infected_treatment = inf)


</code></pre>

<hr>
<h2 id='conf_ints_virulence'>Approximate 95% confidence intervals for virulence</h2><span id='topic+conf_ints_virulence'></span>

<h3>Description</h3>

<p>Function calculating the 95% confidence intervals
for a hazard function based on the variance and covariance
of its location and scale parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>conf_ints_virulence(
  a2 = a2,
  b2 = b2,
  var_a2 = var_a2,
  var_b2 = var_b2,
  cov_a2b2 = cov_a2b2,
  d2 = "",
  tmax = 21
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="conf_ints_virulence_+3A_a2">a2</code></td>
<td>
<p>numeric. Estimated value of location parameter describing
mortality due to infection</p>
</td></tr>
<tr><td><code id="conf_ints_virulence_+3A_b2">b2</code></td>
<td>
<p>numeric. Estimated value of scale parameter describing
mortality due to infection</p>
</td></tr>
<tr><td><code id="conf_ints_virulence_+3A_var_a2">var_a2</code></td>
<td>
<p>numeric. Estimated variance of location parameter describing
mortality due to infection</p>
</td></tr>
<tr><td><code id="conf_ints_virulence_+3A_var_b2">var_b2</code></td>
<td>
<p>numeric. Estimated variance of scale parameter describing
mortality due to infection</p>
</td></tr>
<tr><td><code id="conf_ints_virulence_+3A_cov_a2b2">cov_a2b2</code></td>
<td>
<p>numeric. Estimated covariance of location and scale
parameters above</p>
</td></tr>
<tr><td><code id="conf_ints_virulence_+3A_d2">d2</code></td>
<td>
<p>character. Probability distribution assumed to describe
virulence; Weibull, Gumbel or Fréchet</p>
</td></tr>
<tr><td><code id="conf_ints_virulence_+3A_tmax">tmax</code></td>
<td>
<p>maximum time virulence will be calculated for. Default value;
tmax = 21</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The approach is based on the interval being estimated as a complementary
log-log function of the hazard function, h(t), with the variance
of virulence being estimated by the Delta method applied to log(h[t]).
</p>


<h3>Value</h3>

<p>matrix containing estimates of virulence over time ± approx. 95%
confidence intervals
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# the values, variance and covariance of the location and scale parameters
# [a2,a2] describing mortality due to infection were estimated as;
# a2 = 2.5807642
# b2 = 0.1831328
# var_a2 = 0.0008196927
# var_b2 = 0.0010007282
# cov_a2b2 = -0.0003119921

 ci_matrix01 &lt;- conf_ints_virulence(
   a2 = 2.5807642,
   b2 = 0.1831328,
   var_a2 = 0.0008196927,
   var_b2 = 0.0010007282,
   cov_a2b2 = -0.0003119921,
   d2 = "Weibull",
   tmax = 15)

 tail(ci_matrix01)

 plot(ci_matrix01[, 't'], ci_matrix01[, 'h2'],
   type = 'l', col = 'red',
   xlab = 'time', ylab = 'virulence (± 95% ci)')
   lines(ci_matrix01[, 'lower_ci'], col = 'grey')
   lines(ci_matrix01[, 'upper_ci'], col = 'grey')

</code></pre>

<hr>
<h2 id='data_blanford'>Full data from Blanford et al (2012)</h2><span id='topic+data_blanford'></span>

<h3>Description</h3>

<p>Complete data from the publication: Blanford S, Jenkins NE, Read AF, Thomas
MB (2012) Evaluating the lethal and pre-lethal effects of a range of fungi
against adult Anopheles stephensi mosquitoes. Malaria Journal. 11:365
<a href="https://doi.org/10.1186/1475-2875-11-365">doi</a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data_blanford
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 1320 rows and 9 columns.
</p>


<h3>Details</h3>


<dl>
<dt>block</dt><dd><p>experimental block within experiment (1 - 5)</p>
</dd>
<dt>treatment</dt><dd><p>experimental treatment</p>
</dd>
<dt>replicate cage</dt><dd><p>replicate cage within treatment (1 - 4)</p>
</dd>
<dt>day</dt><dd><p>time post-infection (days)</p>
</dd>
<dt>censor</dt><dd><p>'1' censored, '0' died </p>
</dd>
<dt>d</dt><dd><p>an indicator variable; '0' censored, '1' died</p>
</dd>
<dt>inf</dt><dd><p>'0' uninfected treatement, '1' infected treatment</p>
</dd>
<dt>t</dt><dd><p>time post-infection (days)</p>
</dd>
<dt>fq</dt><dd><p>frequency of individuals</p>
</dd>
</dl>



<h3>Source</h3>

<p>Simon Blanford and Matthew Thomas generously provided and allowed the
release of these data
</p>


<h3>Examples</h3>

<pre><code class='language-R'>head(data_blanford)
</code></pre>

<hr>
<h2 id='data_lorenz'>A subset of data from Lorenz &amp; Koella (2011)</h2><span id='topic+data_lorenz'></span>

<h3>Description</h3>

<p>Data on the longevity of 256 adult female mosquitoes and the number of
pathogen spores they harboured at the time of their death.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data_lorenz
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 256 rows and 8 columns.
</p>


<h3>Details</h3>

<p>These are the Lorenz &amp; Koella data analysed in Agnew (2019)
<a href="https://doi.org/10.1101/530709">doi</a>
</p>


<h3>Value</h3>

<p>A dataframe
</p>

<dl>
<dt>Infectious.dose</dt><dd><p>Number of spores larvae
were exposed to (spores/larva)</p>
</dd>
<dt>Food</dt><dd><p>food treatment: '50' or '100'</p>
</dd>
<dt>Sex</dt><dd><p>sex of mosquito: 'F' female</p>
</dd>
<dt>Spore.Count</dt><dd><p>number of spores harboured by mosquito at time of death</p>
</dd>
<dt>t</dt><dd><p>time of death to nearest half day</p>
</dd>
<dt>censored</dt><dd><p>'1' censored, '0' died</p>
</dd>
<dt>d</dt><dd><p>death indicator: '1' died during experiment, '0' right-censored</p>
</dd>
<dt>g</dt><dd><p>infection treatment indicator: '0' uninfected, '1' infected</p>
</dd>
</dl>



<h3>Source</h3>

<p>Lorenz LM &amp; Koella JC (2011) The microsporidian parasite
Vavraia culicis as a potential late life-acting control agent of malaria.
Evolutionary
Applications 4: 783-790
<a href="https://doi.org/10.1111/j.1752-4571.2011.00199.x">doi</a>
</p>
<p>The full dataset is available at Dryad
<a href="https://doi.org/10.5061/dryad.2s231">https://doi.org/10.5061/dryad.2s231</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>head(data_lorenz)
</code></pre>

<hr>
<h2 id='data_parker'>Full data from Parker et al (2014)</h2><span id='topic+data_parker'></span>

<h3>Description</h3>

<p>Complete data on the survival of adult female aphids exposed or
unexposed to fungal infection.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data_parker
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 328 rows and 11 columns.
</p>


<h3>Value</h3>

<p>A dataframe
</p>

<dl>
<dt>Genotype</dt><dd><p>names of host genotypes</p>
</dd>
<dt>SD</dt><dd><p>Spore Dose, concentration of fungal spores hosts were exposed to
(spores/mm^2)</p>
</dd>
<dt>Fecundity</dt><dd><p>total number of offspring produced by hosts over lifetime</p>
</dd>
<dt>Sporulation</dt><dd><p>'1' visual signs of sporulation at host death,
'0' no signs of sporulation</p>
</dd>
<dt>Status</dt><dd><p>'0' censored, '1' died</p>
</dd>
<dt>Time</dt><dd><p>time of death (days)</p>
</dd>
<dt>dose</dt><dd><p>dose treatments on ordinal scale of 1-3, controls 0</p>
</dd>
<dt>censored</dt><dd><p>'1' censored, '0' died</p>
</dd>
<dt>d</dt><dd><p>death indicator: '1' died, '0' censored</p>
</dd>
<dt>t</dt><dd><p>time of death (days)</p>
</dd>
<dt>g</dt><dd><p>infection treatment indicator; '1' infected, '0' uninfected</p>
</dd>
</dl>



<h3>Source</h3>

<p>Parker BJ, Garcia JR, Gerardo NM (2014)
Genetic variation in resistance and fecundity tolerance in a natural
host-pathogen interaction.
Evolution 68: 2421-2429 <a href="https://doi.org/10.1111/evo.12418">doi</a>
</p>
<p>The full dataset is available at Dryad
<a href="https://doi.org/10.5061/dryad.24gq7">https://doi.org/10.5061/dryad.24gq7</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>head(data_parker)
</code></pre>

<hr>
<h2 id='etd_infected'>Expected time of death: infected hosts</h2><span id='topic+etd_infected'></span>

<h3>Description</h3>

<p>Time when infected hosts are expected to have died due to their cumulative
exposure to background mortality and mortality due to infection.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>etd_infected(a1, b1, a2, b2, d1 = "", d2 = "", tmax = 100)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="etd_infected_+3A_a1">a1</code>, <code id="etd_infected_+3A_b1">b1</code></td>
<td>
<p>location &amp; scale parameters for background mortality</p>
</td></tr>
<tr><td><code id="etd_infected_+3A_a2">a2</code>, <code id="etd_infected_+3A_b2">b2</code></td>
<td>
<p>location &amp; scale parameters for mortality due to infection</p>
</td></tr>
<tr><td><code id="etd_infected_+3A_d1">d1</code>, <code id="etd_infected_+3A_d2">d2</code></td>
<td>
<p>character: name of probability distributions describing
background mortality and mortality due to infection, respectively</p>
</td></tr>
<tr><td><code id="etd_infected_+3A_tmax">tmax</code></td>
<td>
<p>numeric. Maximum value of t for which expected time of death
is searched; defaults to 100. Minimum time is zero (0)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It is the time t when, H1[t] + H2[t] = 1,
and cumulative survival is, S1[t].S2[t] = exp(-1) = 0.367
</p>


<h3>Value</h3>

<p>numeric
</p>


<h3>See Also</h3>

<p><code><a href="#topic+etd_uninfected">etd_uninfected</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>print(etd_infected(a1 = 2, b1 = 0.5, a2 = 30, b2 = 5,
                   d1 = "Weibull", d2 = "Gumbel")) # 7.34
print(etd_infected(a1 = 20, b1 = 5, a2 = 3, b2 = 0.6,
                   d1 = "Gumbel", d2 = "Frechet")) # 17.84
print(etd_infected(a1 = 3, b1 = 0.6, a2 = 2, b2 = 0.5,
                   d1 = "Frechet", d2 = "Weibull")) # 7.37
</code></pre>

<hr>
<h2 id='etd_uninfected'>Expected time of death: uninfected hosts</h2><span id='topic+etd_uninfected'></span>

<h3>Description</h3>

<p>Time when uninfected hosts are expected to have died due to their
cumulative exposure to background mortality.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>etd_uninfected(a1, b1, d1 = "", tmax = 100)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="etd_uninfected_+3A_a1">a1</code>, <code id="etd_uninfected_+3A_b1">b1</code></td>
<td>
<p>location &amp; scale parameters for background mortality</p>
</td></tr>
<tr><td><code id="etd_uninfected_+3A_d1">d1</code></td>
<td>
<p>character: name of probability distribution describing
background mortality</p>
</td></tr>
<tr><td><code id="etd_uninfected_+3A_tmax">tmax</code></td>
<td>
<p>numeric. Maximum value of t for which expected time of death
is searched; defaults to 100. Minimum time is zero (0)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It is the time t when, H1[t] = 1, and
cumulative survival is, S1[t] = exp(-1) = 0.367
</p>


<h3>Value</h3>

<p>numeric
</p>


<h3>See Also</h3>

<p><code><a href="#topic+etd_infected">etd_infected</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>print(etd_uninfected(a1 = 2, b1 = 0.5, d1 = "Weibull")) # 7.38
print(etd_uninfected(a1 = 20, b1 = 5, d1 = "Gumbel")) # 20
print(etd_uninfected(a1 = 3, b1 = 0.6, d1 = "Frechet")) # 32.06
</code></pre>

<hr>
<h2 id='nll_basic'>Negative log-likelihood function: basic model</h2><span id='topic+nll_basic'></span>

<h3>Description</h3>

<p>Function returning the negative log-likelihood (nll) for the 'basic' relative
survival model, given the functions' parameters and the observed data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nll_basic(
  a1 = a1,
  b1 = b1,
  a2 = a2,
  b2 = b2,
  data = data,
  time = time,
  censor = censor,
  infected_treatment = infected_treatment,
  d1 = "Weibull",
  d2 = "Weibull"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nll_basic_+3A_a1">a1</code>, <code id="nll_basic_+3A_b1">b1</code></td>
<td>
<p>location and scale parameters for background mortality</p>
</td></tr>
<tr><td><code id="nll_basic_+3A_a2">a2</code>, <code id="nll_basic_+3A_b2">b2</code></td>
<td>
<p>location and scale parameters for mortality due to infection</p>
</td></tr>
<tr><td><code id="nll_basic_+3A_data">data</code></td>
<td>
<p>name of data frame containing survival data</p>
</td></tr>
<tr><td><code id="nll_basic_+3A_time">time</code></td>
<td>
<p>name of data frame column identifying time of event; time &gt; 0</p>
</td></tr>
<tr><td><code id="nll_basic_+3A_censor">censor</code></td>
<td>
<p>name of data frame column identifying if event was death (0) or
right-censoring (1)</p>
</td></tr>
<tr><td><code id="nll_basic_+3A_infected_treatment">infected_treatment</code></td>
<td>
<p>name of data frame column identifying if data are
from an infected (1) or uninfected (0) treatment</p>
</td></tr>
<tr><td><code id="nll_basic_+3A_d1">d1</code>, <code id="nll_basic_+3A_d2">d2</code></td>
<td>
<p>names of probability distributions describing background
mortality and mortality due to infection, respectively; both default to the
Weibull distribution</p>
</td></tr>
</table>


<h3>Details</h3>

<p>By deafult, this function takes arguments for location and scale parameters
named; a1, b1, a2, b2. These parameters are components of survival functions
describing patterns of background mortality and mortality due to infection.
The particular form of these survival functions depends on the probability
distributions chosen to describe each source of mortality; d1, d2. The
function also takes arguments directing it to the data to be analysed and how
they are labelled; data, time, censor, etc.
</p>
<p>The nll returned by the function depends on the numerical values of the
location and scale parameters, which determine how well the likelihood model
describes the observed data. Maximum likelihood estimation functions, e.g.,
<code>mle2</code> of the package <code>bbmle</code>, can be used find values of the
location and scale parameters minimising the model's nll. The resulting
maximum likelihood estimates can be used to describe host mortality due to
background mortality and mortality due to infection, including the pathogen's
virulence.
</p>
<p>The model assumes all the individuals in the infected population are
infected. It is also assumes infections are homogeneous, i.e., each
infection has the same influence on host survival. Consequently a single
hazard function, with a single pair of values for its location and scale
parameters, can be used to describe the pattern of mortality due to infection
for the infected population as a whole.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># prepare subset of 'data_blanford'; treatments 'cont' and 'Bb06' of Block 3

  data01 &lt;- subset(data_blanford,
    (data_blanford$block == 3) &amp; (
      (data_blanford$treatment == 'cont') |
         (data_blanford$treatment == 'Bb06')) &amp;
           (data_blanford$day &gt; 0))

 head(data01, 4)

# step #1: 'prep function' linking 'nll_basic' to data
  # and identifying parameters to estimate
    m01_prep_function &lt;- function(a1 = a1, b1 = b1, a2 = a2, b2 = b2){
      nll_basic(
        a1 = a1, b1 = b1, a2 = a2, b2 = b2,
        data = data01,
        time = t,
        censor = censor,
        infected_treatment = inf,
        d1 = 'Weibull', d2 = 'Weibull')
        }

# step #2: send 'prep_function' to 'mle2' for maximum likelihood estimation
  #  starting values specified as
    m01 &lt;- mle2(m01_prep_function,
             start = list(a1 = 2, b1 = 0.5, a2 = 2.5, b2 = 0.25)
             )

    summary(m01)

</code></pre>

<hr>
<h2 id='nll_basic_logscale'>Negative log-likelihood function: basic model on logscale</h2><span id='topic+nll_basic_logscale'></span>

<h3>Description</h3>

<p>Function returning the negative log-likelihood (nll) for the 'basic' relative
survival model, given the functions' parameters and the observed data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nll_basic_logscale(
  a1 = a1,
  b1 = b1,
  a2 = a2,
  b2 = b2,
  data = data,
  time = time,
  censor = censor,
  infected_treatment = infected_treatment,
  d1 = "Weibull",
  d2 = "Weibull"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nll_basic_logscale_+3A_a1">a1</code>, <code id="nll_basic_logscale_+3A_b1">b1</code></td>
<td>
<p>location and scale parameters for background mortality
on a logscale</p>
</td></tr>
<tr><td><code id="nll_basic_logscale_+3A_a2">a2</code>, <code id="nll_basic_logscale_+3A_b2">b2</code></td>
<td>
<p>location and scale parameters for mortality due to infection
on a logscale</p>
</td></tr>
<tr><td><code id="nll_basic_logscale_+3A_data">data</code></td>
<td>
<p>name of data frame containing survival data</p>
</td></tr>
<tr><td><code id="nll_basic_logscale_+3A_time">time</code></td>
<td>
<p>name of data frame column identifying time of event; time &gt; 0</p>
</td></tr>
<tr><td><code id="nll_basic_logscale_+3A_censor">censor</code></td>
<td>
<p>name of data frame column identifying if event was death (0) or
right-censoring (1)</p>
</td></tr>
<tr><td><code id="nll_basic_logscale_+3A_infected_treatment">infected_treatment</code></td>
<td>
<p>name of data frame column identifying if data are
from an infected (1) or uninfected (0) treatment</p>
</td></tr>
<tr><td><code id="nll_basic_logscale_+3A_d1">d1</code>, <code id="nll_basic_logscale_+3A_d2">d2</code></td>
<td>
<p>names of probability distributions describing background
mortality and mortality due to infection, respectively; both default to the
Weibull distribution</p>
</td></tr>
</table>


<h3>Details</h3>

<p>By deafult, this function takes arguments for location and scale parameters
named; a1, b1, a2, b2. These parameters are components of survival functions
describing patterns of background mortality and mortality due to infection.
The particular form of these survival functions depends on the probability
distributions chosen to describe each source of mortality; d1, d2. The
function also takes arguments directing it to the data to be analysed and how
they are labelled; data, time, censor, etc.
</p>
<p>The nll returned by the function depends on the numerical values of the
location and scale parameters, which determine how well the likelihood model
describes the observed data. Maximum likelihood estimation functions, e.g.,
<code>mle2</code> of the package <code>bbmle</code>, can be used find values of the
location and scale parameters minimising the model's nll. The resulting
maximum likelihood estimates can be used to describe host mortality due to
background mortality and mortality due to infection, including the pathogen's
virulence.
</p>
<p>The model assumes all the individuals in the infected population are
infected. It is also assumes infections are homogeneous, i.e., each
infection has the same influence on host survival. Consequently a single
hazard function, with a single pair of values for its location and scale
parameters, can be used to describe the pattern of mortality due to infection
for the infected population as a whole.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># prepare subset of 'data_blanford'; treatments 'cont' and 'Bb06' of Block 3

  data01 &lt;- subset(data_blanford,
    (data_blanford$block == 3) &amp; (
      (data_blanford$treatment == 'cont') |
         (data_blanford$treatment == 'Bb06')) &amp;
           (data_blanford$day &gt; 0))

 head(data01, 4)

# step #1: 'prep function' linking 'nll_basic' to data
  # and identifying parameters to estimate
    m01_prep_function &lt;- function(a1 = a1, b1 = b1, a2 = a2, b2 = b2){
      nll_basic_logscale(
        a1 = a1, b1 = b1, a2 = a2, b2 = b2,
        data = data01,
        time = t,
        censor = censor,
        infected_treatment = inf,
        d1 = 'Weibull', d2 = 'Weibull')
        }

# step #2: send 'prep_function' to mle2 for maximum likelihood estimation with
        #  starting values specified
    m01 &lt;- mle2(m01_prep_function,
             start = list(a1 = 1, b1 = 1, a2 = 1, b2 = 1)
             )

    summary(m01)

</code></pre>

<hr>
<h2 id='nll_controls'>Negative log-likelihood function: control data only</h2><span id='topic+nll_controls'></span>

<h3>Description</h3>

<p>Function returning negative log-likelihood (nll) for data in a control
treatment.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nll_controls(
  a1 = a1,
  b1 = b1,
  data = data,
  time = time,
  censor = censor,
  d1 = "Weibull"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nll_controls_+3A_a1">a1</code>, <code id="nll_controls_+3A_b1">b1</code></td>
<td>
<p>location and scale parameters for background mortality</p>
</td></tr>
<tr><td><code id="nll_controls_+3A_data">data</code></td>
<td>
<p>name of data frame containing survival data</p>
</td></tr>
<tr><td><code id="nll_controls_+3A_time">time</code></td>
<td>
<p>name of data frame column identifying time of event; time &gt; 0</p>
</td></tr>
<tr><td><code id="nll_controls_+3A_censor">censor</code></td>
<td>
<p>name of data frame column idenifying if event was death (0) or
right-censoring (1)</p>
</td></tr>
<tr><td><code id="nll_controls_+3A_d1">d1</code></td>
<td>
<p>name of probability distribution describing background
mortality. Choice of; 'Weibull', 'Gumbel', 'Fréchet'; defaults to the
Weibull distribution</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function returns the nll based on two parameters, the location and scale parameters
used to describe background mortality.
</p>


<h3>Value</h3>

<p>numeric
</p>


<h3>See Also</h3>

<p><code><a href="#topic+nll_basic">nll_basic</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># prepare a subset of the Blanford data for analysis
  data01 &lt;- subset(data_blanford,
    (data_blanford$block == 3) &amp;
      (data_blanford$treatment == 'cont') &amp;
        (data_blanford$day &gt; 0))

# check data frame for names of columns
    head(data01)

# step #1: 'prep function' linking 'nll_controls' to data
  # and identifying parameters to estimate
    m01_prep_function &lt;- function(a1 = a1, b1 = b1){
      nll_controls(
        a1 = a1, b1 = b1,
        data = data01,
        time = t,
        censor = censor,
        d1 = 'Weibull'
        )}

# step #2: send 'prep_function' to mle2 for maximum likelihood estimation
  # specifying starting values
    m01 &lt;- mle2(m01_prep_function,
             start = list(a1 = 2, b1 = 0.5)
             )

    summary(m01)


</code></pre>

<hr>
<h2 id='nll_exposed_infected'>Negative log-likelihood function: exposed-infected</h2><span id='topic+nll_exposed_infected'></span>

<h3>Description</h3>

<p>Function returning negative log-likelihood (nll) for patterns of mortality in
infected and control treatments, where the infected population harbours an
unobserved proportion of hosts that were exposed to infection, but did not
become infected.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nll_exposed_infected(
  a1 = a1,
  b1 = b1,
  a2 = a2,
  b2 = b2,
  p1 = p1,
  data = data,
  time = time,
  censor = censor,
  infected_treatment = infected_treatment,
  d1 = "Weibull",
  d2 = "Weibull"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nll_exposed_infected_+3A_a1">a1</code>, <code id="nll_exposed_infected_+3A_b1">b1</code></td>
<td>
<p>location and scale parameters for background mortality</p>
</td></tr>
<tr><td><code id="nll_exposed_infected_+3A_a2">a2</code>, <code id="nll_exposed_infected_+3A_b2">b2</code></td>
<td>
<p>location and scale parameters for mortality due to infection</p>
</td></tr>
<tr><td><code id="nll_exposed_infected_+3A_p1">p1</code></td>
<td>
<p>unobserved proportion of hosts exposed to infection and infected; 0
&lt;= p1 &lt;= 1</p>
</td></tr>
<tr><td><code id="nll_exposed_infected_+3A_data">data</code></td>
<td>
<p>name of data frame containing survival data</p>
</td></tr>
<tr><td><code id="nll_exposed_infected_+3A_time">time</code></td>
<td>
<p>name of data frame column identifying time of event; time &gt; 0</p>
</td></tr>
<tr><td><code id="nll_exposed_infected_+3A_censor">censor</code></td>
<td>
<p>name of data frame column idenifying if event was death (0) or
right-censoring (1)</p>
</td></tr>
<tr><td><code id="nll_exposed_infected_+3A_infected_treatment">infected_treatment</code></td>
<td>
<p>name of data frame column identifying if data are
from an infected (1) or uninfected (0) treatment</p>
</td></tr>
<tr><td><code id="nll_exposed_infected_+3A_d1">d1</code>, <code id="nll_exposed_infected_+3A_d2">d2</code></td>
<td>
<p>names of probability distributions chosen to describe background
mortality and mortality due to infection, respectively'; both default to
the Weibull distribution</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function returns the nll based on five parameters, the location and
scale parameters for background mortality and mortality due to infection,
respectively, plus a parameter for the proportion of hosts that became
infected when exposed to infection.
</p>


<h3>Value</h3>

<p>numeric
</p>


<h3>See Also</h3>

<p><code><a href="#topic+nll_two_inf_subpops_obs">nll_two_inf_subpops_obs</a></code>
<code><a href="#topic+nll_two_inf_subpops_unobs">nll_two_inf_subpops_unobs</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># check column names in head of data frame with data to analyse
    head(data_parker)

# step #1: prepare nll function for analysis
    m01_prep_function &lt;- function(a1 = a1, b1 = b1, a2 = a2, b2 = b2, p1 = p1){
      nll_exposed_infected(
        a1 = a1, b1 = b1, a2 = a2, b2 = b2, p1 = p1,
        data = data_parker,
        time = t,
        censor = censored,
        infected_treatment = g,
        d1 = "Frechet",
        d2 = "Weibull")
        }

# step #2: send 'prep_function' to mle2 for maximum likelihood estimation
    m01 &lt;- mle2(m01_prep_function,
             start = list(a1 = 2.5, b1 = 1, a2 = 2, b2 = 0.5, p1 = 0.5)
             )

    summary(m01)

# model setting lower &amp; upper bounds to parameter estimates
  # including 0 &lt; p1 &lt; 1
    m02 &lt;- mle2(m01_prep_function,
             start = list(a1 = 2.5, b1 = 1.2, a2 = 1.9, b2 = 0.16, p1 = 0.48),
             method = "L-BFGS-B",
             lower = c(a1 = 0, b1 = 0, a2 = 0, b2 = 0, p1 = 0),
             upper = c(a1 = Inf, b1 = Inf, a2 = Inf, b2 = Inf, p1 = 1),
             )

    summary(m02)


</code></pre>

<hr>
<h2 id='nll_frailty'>Negative log-likelihood function: frailty</h2><span id='topic+nll_frailty'></span>

<h3>Description</h3>

<p>Function calculating negative log-likelihood (nll) for the observed patterns
of mortality in infected and uninfected treatments when it assumed there is
unobserved variation in virulence.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nll_frailty(
  a1 = a1,
  b1 = b1,
  a2 = a2,
  b2 = b2,
  theta = theta,
  data = data,
  time = time,
  censor = censor,
  infected_treatment = infected_treatment,
  d1 = "Weibull",
  d2 = "Weibull",
  d3 = ""
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nll_frailty_+3A_a1">a1</code>, <code id="nll_frailty_+3A_b1">b1</code></td>
<td>
<p>location and scale parameters describing background mortality</p>
</td></tr>
<tr><td><code id="nll_frailty_+3A_a2">a2</code>, <code id="nll_frailty_+3A_b2">b2</code></td>
<td>
<p>location and scale parameters describing mortality due to
infection</p>
</td></tr>
<tr><td><code id="nll_frailty_+3A_theta">theta</code></td>
<td>
<p>parameter describing variance of unobserved variation in
virulence</p>
</td></tr>
<tr><td><code id="nll_frailty_+3A_data">data</code></td>
<td>
<p>name of data frame containing survival data</p>
</td></tr>
<tr><td><code id="nll_frailty_+3A_time">time</code></td>
<td>
<p>name of data frame column identifying time of event; time &gt; 0</p>
</td></tr>
<tr><td><code id="nll_frailty_+3A_censor">censor</code></td>
<td>
<p>name of data frame column idenifying if event was death (0) or
right-censoring (1)</p>
</td></tr>
<tr><td><code id="nll_frailty_+3A_infected_treatment">infected_treatment</code></td>
<td>
<p>name of data frame column identifying if data are
from an infected (1) or uninfected (0) treatment</p>
</td></tr>
<tr><td><code id="nll_frailty_+3A_d1">d1</code>, <code id="nll_frailty_+3A_d2">d2</code></td>
<td>
<p>names of probability distributions chosen to describe background
mortality and mortality due to infection, respectively; both default to the
Weibull distribution</p>
</td></tr>
<tr><td><code id="nll_frailty_+3A_d3">d3</code></td>
<td>
<p>name of probability distribution chosen to describe unobserved
frailty; choice of 'gamma' or 'inverse Gaussian'</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function assumes the unobserved variation in the rate of mortality due to
infection is continuously distributed and follows either the gamma
distribution or the inverse Gaussian distribution, with mean = 1 and variance
= theta.
</p>
<p>The nll is based on five parameter functions for the location and
scale parameters for background mortality and mortality due to infection,
respectively, plus a parameter estimating the variance of the unobserved
variation in virulence.
</p>


<h3>Value</h3>

<p>numeric
</p>


<h3>Examples</h3>

<pre><code class='language-R'>### Example 1: unobserved variation in virulence described by gamma distribution

# step #1: parameterise nll function to be passed to 'mle2'
    m01_prep_function &lt;- function(a1 = a1, b1 = b1, a2 = a2, b2 = b2, theta = theta){
      nll_frailty(
        a1 = a1, b1 = b1, a2 = a2, b2 = b2, theta = theta,
        data = data_lorenz,
        time = t,
        censor = censored,
        infected_treatment = g,
        d1 = "Gumbel",
        d2 = "Weibull",
        d3 = "Gamma"
        )}

# step #2: send 'prep_function' to 'mle2' for maximum likelihood estimation
    m01 &lt;- mle2(
      m01_prep_function,
      start = list(a1 = 20, b1 = 5, a2 = 3, b2 = 0.1, theta = 2)
      )

    summary(m01)

### Example 2: unobserved variation in virulence described by inverse Gaussian distribution

    m02_prep_function &lt;- function(a1 = a1, b1 = b1, a2 = a2, b2 = b2, theta = theta){
      nll_frailty(
        a1 = a1, b1 = b1, a2 = a2, b2 = b2, theta = theta,
        data = data_lorenz,
        time = t,
        censor = censored,
        infected_treatment = g,
        d1 = "Gumbel",
        d2 = "Weibull",
        d3 = "Inverse Gaussian"
        )}

    m02 &lt;- mle2(
      m02_prep_function,
        start = list(a1 = 20, b1 = 5, a2 = 3, b2 = 0.1, theta = 2)
        )

    summary(m02)

# compare model estimates by AICc
    AICc(m01, m02, nobs = 256)

</code></pre>

<hr>
<h2 id='nll_frailty_correlated'>Negative log-likelihood function: correlated frailty model</h2><span id='topic+nll_frailty_correlated'></span>

<h3>Description</h3>

<p>Function calculating the negative log-likelihood (nll) for patterns of
mortality in infected and uninfected treatments when there is unobserved
variation in background mortality and mortality due to infection, where these
two sources of variation are positively correlated.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nll_frailty_correlated(
  a1 = a1,
  b1 = b1,
  a2 = a2,
  b2 = b2,
  theta01 = theta01,
  theta02 = theta02,
  rho = rho,
  data = data,
  time = time,
  censor = censor,
  infected_treatment = infected_treatment,
  d1 = "Weibull",
  d2 = "Weibull"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nll_frailty_correlated_+3A_a1">a1</code>, <code id="nll_frailty_correlated_+3A_b1">b1</code></td>
<td>
<p>location and scale parameters describing background mortality</p>
</td></tr>
<tr><td><code id="nll_frailty_correlated_+3A_a2">a2</code>, <code id="nll_frailty_correlated_+3A_b2">b2</code></td>
<td>
<p>location and scale parameters describing mortality due to
infection</p>
</td></tr>
<tr><td><code id="nll_frailty_correlated_+3A_theta01">theta01</code></td>
<td>
<p>parameter describing variance of unobserved variation in
background rate of mortality</p>
</td></tr>
<tr><td><code id="nll_frailty_correlated_+3A_theta02">theta02</code></td>
<td>
<p>parameter describing variance of unobserved variation in rate
of mortality due to infection</p>
</td></tr>
<tr><td><code id="nll_frailty_correlated_+3A_rho">rho</code></td>
<td>
<p>parameter for strength of positive correlation between theta01 and
theta02; rho &gt; 0</p>
</td></tr>
<tr><td><code id="nll_frailty_correlated_+3A_data">data</code></td>
<td>
<p>name of data frame containing survival data</p>
</td></tr>
<tr><td><code id="nll_frailty_correlated_+3A_time">time</code></td>
<td>
<p>name of data frame column identifying time of event; time &gt; 0</p>
</td></tr>
<tr><td><code id="nll_frailty_correlated_+3A_censor">censor</code></td>
<td>
<p>name of data frame column idenifying if event was death (0) or
right-censoring (1)</p>
</td></tr>
<tr><td><code id="nll_frailty_correlated_+3A_infected_treatment">infected_treatment</code></td>
<td>
<p>name of data frame column identifying if data are
from an infected (1) or uninfected (0) treatment</p>
</td></tr>
<tr><td><code id="nll_frailty_correlated_+3A_d1">d1</code>, <code id="nll_frailty_correlated_+3A_d2">d2</code></td>
<td>
<p>names of probability distributions chosen to describe background
mortality and mortality due to infection, respectively; both default to the
Weibull distribution</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function assumes both sources of unobserved variation follow the Gamma
distribution where both have a mean = 1.0, and variances 'theta01' and
'theta02', respectively. The nll function is calculated based on seven
parameters; location and scale parameters for background mortality and
mortality due to infection, respectively, the unobserved variance of in each
source of mortality, and the strength of the positive correlation between
them.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+nll_frailty">nll_frailty</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# step #1: parameterise nll function to be passed to 'mle2'
    m01_prep_function &lt;- function(
      a1 = a1, b1 = b1, a2 = a2, b2 = b2,
      theta01 = theta01, theta02 = theta02, rho = rho){
        nll_frailty_correlated(
          a1 = a1, b1 = b1, a2 = a2, b2 = b2,
          theta01 = theta01, theta02 = theta02, rho = rho,
          data = data_lorenz,
          time = t,
          censor = censored,
          infected_treatment = g,
          d1 = "Gumbel",
          d2 = "Gumbel"
          )}

# step #2: send 'prep_function' to 'mle2' for maximum likelihood estimation
#          lower bounds of estimates set to 1e-6
  m01 &lt;- mle2(m01_prep_function,
    start = list(a1 = 20, b1 = 5, a2 = 20, b2 = 4,
                 theta01 = 1, theta02 = 1, rho = 1),
    method = "L-BFGS-B",
    lower = list(a1 = 1e-6, b1 = 1e-6, a2 = 1e-6, b2 = 1e-6,
                 theta01 = 1e-6, theta02 = 1e-6, rho = 1e-6)
                 )

  summary(m01)

# NB no std. errors estimated and estimate of 'theta01' at lower boundary

# rerun model with theta01 set at lower boundary
    m02 &lt;- mle2(m01_prep_function,
      start = list(a1 = 20, b1 = 5, a2 = 20, b2 = 4,
                   theta01 = 1, theta02 = 1, rho = 1),
      fixed = list(theta01 = 1e-6),
      method = "L-BFGS-B",
      lower = list(a1 = 1e-6, b1 = 1e-6, a2 = 1e-6,
                   b2 = 1e-6, theta02 = 1e-6, rho = 1e-6)
      )

summary(m02)

# NB std. error of 'rho' crosses lower boundary

# rerun model with theta01 and rho set at lower limits
    m03 &lt;- mle2(m01_prep_function,
      start = list(a1 = 20, b1 = 5, a2 = 20, b2 = 4,
                   theta01 = 1, theta02 = 1, rho = 1),
      fixed = list(theta01 = 1e-6, rho = 1e-6),
      method = "L-BFGS-B",
      lower = list(a1 = 1e-6, b1 = 1e-6, a2 = 1e-6,
                   b2 = 1e-6, theta02 = 1e-6)
      )

    summary(m03)

# result of m03 corresponds with estimates from 'nll_frailty' model,
  # i.e., where it is assumed there is no unobserved variation in the
  # rate of background mortality and where the gamma distribution describes
  # the unobserved variation in virulence

# step #1: parameterise nll function to be passed to 'mle2'
    m04_prep_function &lt;- function(a1, b1, a2, b2, theta){
      nll_frailty(a1, b1, a2, b2, theta,
        data = data_lorenz,
        time = t,
        censor = censored,
        infected_treatment = g,
        d1 = "Gumbel",
        d2 = "Gumbel",
        d3 = "Gamma"
        )}

# step #2: send 'prep_function' to 'mle2' for maximum likelihood estimation
    m04 &lt;- mle2(m04_prep_function,
      start = list(a1 = 20, b1 = 5, a2 = 20, b2 = 5, theta = 2)
      )

    summary(m04)

# compare estimated values m03 vs. m04
    coef(m03) ; coef(m04)


</code></pre>

<hr>
<h2 id='nll_frailty_logscale'>Negative log-likelihood function: frailty variables on logscale</h2><span id='topic+nll_frailty_logscale'></span>

<h3>Description</h3>

<p>This negative log-likelihood (nll) function is the same as 'nll_frailty', except it assumes the variables to estimate are on a logscale.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nll_frailty_logscale(
  log.a1 = log.a1,
  log.b1 = log.b1,
  log.a2 = log.a2,
  log.b2 = log.b2,
  log.theta = log.theta,
  data = data,
  time = time,
  censor = censor,
  infected_treatment = infected_treatment,
  d1 = "Weibull",
  d2 = "Weibull",
  d3 = ""
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nll_frailty_logscale_+3A_log.a1">log.a1</code>, <code id="nll_frailty_logscale_+3A_log.b1">log.b1</code></td>
<td>
<p>location and scale parameters for background mortality,
on a logscale</p>
</td></tr>
<tr><td><code id="nll_frailty_logscale_+3A_log.a2">log.a2</code>, <code id="nll_frailty_logscale_+3A_log.b2">log.b2</code></td>
<td>
<p>location and scale parameters for mortality
due to infection, on a logscale</p>
</td></tr>
<tr><td><code id="nll_frailty_logscale_+3A_log.theta">log.theta</code></td>
<td>
<p>parameter describing variance of the unobserved variation
in virulence, on a logscale</p>
</td></tr>
<tr><td><code id="nll_frailty_logscale_+3A_data">data</code></td>
<td>
<p>name of data frame containing survival data</p>
</td></tr>
<tr><td><code id="nll_frailty_logscale_+3A_time">time</code></td>
<td>
<p>name of data frame column identifying time of event; time &gt; 0</p>
</td></tr>
<tr><td><code id="nll_frailty_logscale_+3A_censor">censor</code></td>
<td>
<p>name of data frame column idenifying if event was death (0)
or right-censoring (1)</p>
</td></tr>
<tr><td><code id="nll_frailty_logscale_+3A_infected_treatment">infected_treatment</code></td>
<td>
<p>name of data frame column identifying if data
are from an infected (1) or uninfected (0) treatment</p>
</td></tr>
<tr><td><code id="nll_frailty_logscale_+3A_d1">d1</code>, <code id="nll_frailty_logscale_+3A_d2">d2</code></td>
<td>
<p>names of probability distributions chosen to describe
background mortality and mortality due to infection, respectively;
both default to the Weibull distribution</p>
</td></tr>
<tr><td><code id="nll_frailty_logscale_+3A_d3">d3</code></td>
<td>
<p>name of probability distribution chosen to describe
unobserved frailty; choice of 'gamma' or 'inverse Gaussian'</p>
</td></tr>
</table>


<h3>Value</h3>

<p>numeric
</p>


<h3>See Also</h3>

<p><code><a href="#topic+nll_frailty">nll_frailty</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
### Example 1: unobserved variation in virulence with gamma distribution

# step #1: parameterise nll function to be passed to 'mle2'
    m01_prep_function &lt;- function(
      log.a1 = log.a1, log.b1 = log.b1,
      log.a2 = log.a2, log.b2 = log.b2,
      log.theta = log.theta){
        nll_frailty_logscale(
          log.a1 = log.a1, log.b1 = log.b1,
          log.a2 = log.a2, log.b2 = log.b2,
          log.theta = log.theta,
          data = data_lorenz,
          time = t,
          censor = censored,
          infected_treatment = g,
          d1 = "Gumbel", d2 = "Weibull", d3 = "Gamma"
          )}

# step #2: send 'prep_function' to 'mle2' for maximum likelihood estimation
    m01 &lt;- mle2(
      m01_prep_function,
      start = list(
        log.a1 = 3, log.b1 = 1.5, log.a2 = 0.7, log.b2 = -0.7, log.theta = 1
        )
      )

  summary(m01)

  exp(coef(m01))

</code></pre>

<hr>
<h2 id='nll_frailty_shared'>Negative log-likelihood function: frailty shared</h2><span id='topic+nll_frailty_shared'></span>

<h3>Description</h3>

<p>Function calculating negative log-likelihood (nll) for patterns of mortality
in infected and uninfected treatments where unobserved variation is assumed
to act equally on background mortality and mortality due to infection.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nll_frailty_shared(
  a1 = a1,
  b1 = b1,
  a2 = a2,
  b2 = b2,
  theta = theta,
  data = data,
  time = time,
  censor = censor,
  infected_treatment = infected_treatment,
  d1 = "",
  d2 = ""
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nll_frailty_shared_+3A_a1">a1</code>, <code id="nll_frailty_shared_+3A_b1">b1</code></td>
<td>
<p>location and scale parameters for background mortality</p>
</td></tr>
<tr><td><code id="nll_frailty_shared_+3A_a2">a2</code>, <code id="nll_frailty_shared_+3A_b2">b2</code></td>
<td>
<p>location and scale parameters for mortality due to infection</p>
</td></tr>
<tr><td><code id="nll_frailty_shared_+3A_theta">theta</code></td>
<td>
<p>parameter describing variance of unobserved variation acting on
mortality rates</p>
</td></tr>
<tr><td><code id="nll_frailty_shared_+3A_data">data</code></td>
<td>
<p>name of data frame containing survival data</p>
</td></tr>
<tr><td><code id="nll_frailty_shared_+3A_time">time</code></td>
<td>
<p>name of data frame column identifying time of event; time &gt; 0</p>
</td></tr>
<tr><td><code id="nll_frailty_shared_+3A_censor">censor</code></td>
<td>
<p>name of data frame column idenifying if event was death (0) or
right-censoring (1)</p>
</td></tr>
<tr><td><code id="nll_frailty_shared_+3A_infected_treatment">infected_treatment</code></td>
<td>
<p>name of data frame column identifying if data are
from an infected (1) or uninfected (0) treatment</p>
</td></tr>
<tr><td><code id="nll_frailty_shared_+3A_d1">d1</code>, <code id="nll_frailty_shared_+3A_d2">d2</code></td>
<td>
<p>names of probability distributions chosen to describe background
mortality and mortality due to infection, respectively; both default to the
Weibull distribution</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function assumes unobserved variation acting on both the background rate
of mortality and the rate of mortality due to infection is continuously
distributed and follows the gamma distribution, with mean = 1.0 and variance
= theta. The function returns the nll based on five parameters; the location
and scale parameters for background mortality and mortality due to infection,
plus the parameter describing the variance of the unobserved variation.
</p>


<h3>Value</h3>

<p>numeric
</p>


<h3>See Also</h3>

<p><code><a href="#topic+nll_frailty">nll_frailty</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# step #1: prepare nll function for analysis
  m01_prep_function &lt;- function(a1 = a1, b1 = b1, a2 = a2, b2 = b2, theta = theta){
    nll_frailty_shared(a1 = a1, b1 = b1, a2 = a2, b2 = b2, theta = theta,
      data = data_lorenz,
      time = t,
      censor = censored,
      infected_treatment = g,
      d1 = "Gumbel", d2 = "Gumbel"
      )}

# step #2: send 'prep_function' to mle2 for maximum likelihood estimation,
  # specifying starting values
  m01 &lt;- mle2(m01_prep_function,
            start = list(a1 = 23, b1 = 5, a2 = 10, b2 = 1, theta = 1),
            method = "Nelder-Mead",
            control = list(maxit = 5000)
            )

  summary(m01)

</code></pre>

<hr>
<h2 id='nll_proportional_virulence'>Negative log-likelihood function: nll proportional virulence</h2><span id='topic+nll_proportional_virulence'></span>

<h3>Description</h3>

<p>Function assuming hazard functions describing virulence are proportional
among infected treatments.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nll_proportional_virulence(
  a1 = a1,
  b1 = b1,
  a2 = a2,
  b2 = b2,
  theta = theta,
  data = data,
  time = time,
  censor = censor,
  infected_treatment = infected_treatment,
  reference_virulence = reference_virulence,
  d1 = "Weibull",
  d2 = "Weibull"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nll_proportional_virulence_+3A_a1">a1</code>, <code id="nll_proportional_virulence_+3A_b1">b1</code></td>
<td>
<p>location and scale parameters describing background mortality</p>
</td></tr>
<tr><td><code id="nll_proportional_virulence_+3A_a2">a2</code>, <code id="nll_proportional_virulence_+3A_b2">b2</code></td>
<td>
<p>location and scale parameters describing mortality due to
infection</p>
</td></tr>
<tr><td><code id="nll_proportional_virulence_+3A_theta">theta</code></td>
<td>
<p>a constant describing the proportional relationship
of virulence; theta &gt; 0</p>
</td></tr>
<tr><td><code id="nll_proportional_virulence_+3A_data">data</code></td>
<td>
<p>name of data frame containing survival data</p>
</td></tr>
<tr><td><code id="nll_proportional_virulence_+3A_time">time</code></td>
<td>
<p>name of data frame column identifying time of event; time &gt; 0</p>
</td></tr>
<tr><td><code id="nll_proportional_virulence_+3A_censor">censor</code></td>
<td>
<p>name of data frame column identifying if event was death (0) or
right-censoring (1)</p>
</td></tr>
<tr><td><code id="nll_proportional_virulence_+3A_infected_treatment">infected_treatment</code></td>
<td>
<p>name of data frame column identifying if data are
from an infected (1) or uninfected (0) treatment</p>
</td></tr>
<tr><td><code id="nll_proportional_virulence_+3A_reference_virulence">reference_virulence</code></td>
<td>
<p>name of data frame column identifying the
infected treatment to use as a reference when estimating virulence;
value of 1 the reference treatment and 2 for treatment to be compared</p>
</td></tr>
<tr><td><code id="nll_proportional_virulence_+3A_d1">d1</code>, <code id="nll_proportional_virulence_+3A_d2">d2</code></td>
<td>
<p>names of probability distributions describing background
mortality and mortality due to infection, respectively; both default to the
Weibull distribution</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The proportional hazards assumption requires, h1(t) / h2(t) = c,
where h1(t) and h2(t) are two hazard functions at time t,
and c is a constant. In this function the hazard functions for the
increased mortality due to infection are assumed to be proportional for
different infection treatments within the same experiment.
</p>
<p>In the default form, one infected treatment is denoted '1' and used as the
reference treatment for virulence against which the virulence in a second
infected population, '2', is scaled. The default function can be extended
to compare multiple treatments against the reference
(see vignette: Worked examples II)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data01 &lt;- data_lorenz

# create column 'reference_virulence' with values of 1 and 2 when
  # Infectious.dose = 5000 and 160000, respectively, otherwise 0

data01$reference_virulence &lt;- ifelse(data01$g == 0, 0,
 ifelse(data01$g == 1, ifelse(data01$Infectious.dose == 5000, 1,
   ifelse(data01$Infectious.dose == 160000, 2, 0)), 0)
 )

m01_prep_function &lt;- function(
  a1 = a1, b1 = b1, a2 = a2, b2 = b2, theta = theta){
    nll_proportional_virulence(
      a1 = a1, b1 = b1, a2 = a2, b2 = b2, theta = theta,
      data = data01,
      time = t,
      censor = censored,
      infected_treatment = g,
      reference_virulence = reference_virulence,
      d1 = 'Gumbel', d2 = 'Weibull')
      }

m01 &lt;- mle2(m01_prep_function,
  start = list(a1 = 23, b1 = 5, a2 = 4, b2 = 0.2, theta = 1)
  )

summary(m01)

# virulence in the high dose treatment is estimated as
 # ~ 6x greater than in the low dose treatment

</code></pre>

<hr>
<h2 id='nll_recovery'>Negative log-likelihood function: recovery model</h2><span id='topic+nll_recovery'></span>

<h3>Description</h3>

<p>Function returning negative log-likelihood (nll) for patterns of survival in
infected and uninfected treatments, when infected hosts can recover from
infection.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nll_recovery(
  a1 = a1,
  b1 = b1,
  a2 = a2,
  b2 = b2,
  a3 = a3,
  b3 = b3,
  data = data,
  d1 = "",
  d2 = "",
  d3 = ""
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nll_recovery_+3A_a1">a1</code>, <code id="nll_recovery_+3A_b1">b1</code></td>
<td>
<p>location &amp; scale parameters for background mortality</p>
</td></tr>
<tr><td><code id="nll_recovery_+3A_a2">a2</code>, <code id="nll_recovery_+3A_b2">b2</code></td>
<td>
<p>location &amp; scale parameters for mortality due to infection</p>
</td></tr>
<tr><td><code id="nll_recovery_+3A_a3">a3</code>, <code id="nll_recovery_+3A_b3">b3</code></td>
<td>
<p>location &amp; scale parameters for how long infection 'survives'</p>
</td></tr>
<tr><td><code id="nll_recovery_+3A_data">data</code></td>
<td>
<p>a data.frame with the data</p>
</td></tr>
<tr><td><code id="nll_recovery_+3A_d1">d1</code>, <code id="nll_recovery_+3A_d2">d2</code>, <code id="nll_recovery_+3A_d3">d3</code></td>
<td>
<p>probability distributions for background mortality, mortality
due to infection &amp; how long infection 'survives' (&quot;Weibull&quot;, &quot;Gumbel&quot;,
&quot;Frechet&quot;)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This model assumes all the hosts in an infected treatment are all initially
infected, and they can all potentially recover from infection. Recovered
hosts are assumed to only experience background mortality equivalent to that
experienced by matching uninfected or control individuals; no assumptions are
made as to whether they are still infected or infectious. It is also assumed
that the timing of recovery from infection is not directly observed, but an
individual's infected/recovery status can be determined after they have died
or been censored.
</p>
<p>The probability that an infection 'survives' over time, i.e., the host does
not recover from infection, is assumed to follow a probability distribution
which acts independently of the probability distributions determining
background mortality or mortality due to infection.
</p>
<p>This function only estimates location and scale parameters as constants, it
is not designed to estimate them as functions.
</p>


<h3>Value</h3>

<p>numeric
</p>


<h3>Warning</h3>

<p>requires the data to be specified in a specific format;
see vignette 'data format' for details
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# NB the data to analyse needs to be in a data frame of a specific form
  head(recovery_data)

# step #1: prepare nll function for analysis
  m01_prep_function &lt;- function(a1, b1, a2, b2, a3, b3){
    nll_recovery(a1, b1, a2, b2, a3, b3,
                 data = recovery_data,
                 d1 = "Weibull", d2 = "Weibull", d3 = "Weibull"
                 )}

# step #2: send 'prep_function' to mle2 for maximum likelihood estimation,
  # specifying starting values
  m01 &lt;- mle2(m01_prep_function,
    start = list(a1 = 2, b1 = 0.5, a2 = 2, b2 = 0.5, a3 = 2, b3 = 0.5)
    )

  summary(m01)

# values used to simulate data were for the Weibull distribution;
  # a1 = 2.8, b1 = 0.5, a2 = 2.2, b2 = 0.35, a3 = 2.35, b3 = 0.35
  
</code></pre>

<hr>
<h2 id='nll_recovery_II'>Negative log-likelihood function: recovery model, no background mortality</h2><span id='topic+nll_recovery_II'></span>

<h3>Description</h3>

<p>Function returning negative log-likelihood (nll) for patterns of survival in
infected and uninfected treatments, when infected hosts can recover from
infection and there is no background mortality.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nll_recovery_II(
  a2 = a2,
  b2 = b2,
  a3 = a3,
  b3 = b3,
  data = data,
  d2 = "",
  d3 = ""
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nll_recovery_II_+3A_a2">a2</code>, <code id="nll_recovery_II_+3A_b2">b2</code></td>
<td>
<p>location &amp; scale parameters for mortality due to infection</p>
</td></tr>
<tr><td><code id="nll_recovery_II_+3A_a3">a3</code>, <code id="nll_recovery_II_+3A_b3">b3</code></td>
<td>
<p>location &amp; scale parameters for how long infection 'survives'</p>
</td></tr>
<tr><td><code id="nll_recovery_II_+3A_data">data</code></td>
<td>
<p>a data.frame with the data</p>
</td></tr>
<tr><td><code id="nll_recovery_II_+3A_d2">d2</code>, <code id="nll_recovery_II_+3A_d3">d3</code></td>
<td>
<p>probability distributions for background mortality, mortality
due to infection &amp; how long infection 'survives' (&quot;Weibull&quot;, &quot;Gumbel&quot;,
&quot;Frechet&quot;)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This model assumes all the hosts in an infected treatment are all initially
infected, and they can all potentially recover from infection. Uninfected,
infected and recovered hosts are assumed to not experience any background
mortality during the period of the experiment. No assumptions are made as to
whether recovered hosts are still infected or infectious. It is also assumed
that the timing of recovery from infection is not directly observed, but and
individual's infected/recovery status can be determined after they have died
or been censored.
</p>
<p>The probability that an infection 'survives' over time, i.e., the host does
not recover from infection, is assumed to follow a probability distribution
which acts independently of the probability distributions determining
background mortality or mortality due to infection.
</p>
<p>This function only estimates location and scale parameters as constants, it
is not designed to estimate them as functions.
</p>
<p>The nll function also requires the data to be specified in a specific format
and requires columns detailing when and how many control individuals were
right-censored, even though these individuals do not contribute to the nll
estimated; see vignettes for details.
</p>


<h3>Value</h3>

<p>numeric
</p>


<h3>Warning</h3>

<p>requires the data to be specified in a specific format;
see vignette 'data format' for details
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# NB the data to analyse needs to be in a data frame of a specific form
     head(recovery_data_II)

# step #1: prepare nll function for analysis
    m01_prep_function &lt;- function(a2, b2, a3, b3){
      nll_recovery_II(a2, b2, a3, b3,
                   data = recovery_data_II, # data_recovery_II,
                   d2 = "Weibull", d3 = "Weibull"
                  )}

# step #2: send 'prep_function' to mle2 for maximum likelihood estimation,
  # specifying starting values
    m01 &lt;- mle2(m01_prep_function,
             start = list(a2 = 2, b2 = 0.5, a3 = 2, b3 = 0.5)
             )

    summary(m01)

# values used to simulate data were for the Weibull distribution;
  # a2 = 2.2, b2 = 0.35, a3 = 2.35, b3 = 0.35

</code></pre>

<hr>
<h2 id='nll_two_inf_subpops_obs'>Negative log-likelihood function:
two observed subpopulations of infected hosts</h2><span id='topic+nll_two_inf_subpops_obs'></span>

<h3>Description</h3>

<p>Function returning negative log-likelihood (nll) for patterns of mortality in
infected and uninfected treatments when an infected population harbours two
identified, or 'observed', subpopulations of hosts experiencing
different patterns of virulence,
e.g. with/without visible signs of infection.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nll_two_inf_subpops_obs(
  a1 = a1,
  b1 = b1,
  a2 = a2,
  b2 = b2,
  a3 = a3,
  b3 = b3,
  data = data,
  time = time,
  censor = censor,
  infected_treatment = infected_treatment,
  d1 = "Weibull",
  d2 = "Weibull",
  d3 = "Weibull",
  infsubpop = infsubpop
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nll_two_inf_subpops_obs_+3A_a1">a1</code>, <code id="nll_two_inf_subpops_obs_+3A_b1">b1</code></td>
<td>
<p>location and scale parameters describing background mortality</p>
</td></tr>
<tr><td><code id="nll_two_inf_subpops_obs_+3A_a2">a2</code>, <code id="nll_two_inf_subpops_obs_+3A_b2">b2</code></td>
<td>
<p>location and scale parameters describing mortality due to
infection in one subpopulation</p>
</td></tr>
<tr><td><code id="nll_two_inf_subpops_obs_+3A_a3">a3</code>, <code id="nll_two_inf_subpops_obs_+3A_b3">b3</code></td>
<td>
<p>location and scale parameters describing mortality due to
infection in the other subpopulation</p>
</td></tr>
<tr><td><code id="nll_two_inf_subpops_obs_+3A_data">data</code></td>
<td>
<p>name of data frame containing survival data</p>
</td></tr>
<tr><td><code id="nll_two_inf_subpops_obs_+3A_time">time</code></td>
<td>
<p>name of data frame column identifying time of event; time &gt; 0</p>
</td></tr>
<tr><td><code id="nll_two_inf_subpops_obs_+3A_censor">censor</code></td>
<td>
<p>name of data frame column idenifying if event was death (0)
or right-censoring (1)</p>
</td></tr>
<tr><td><code id="nll_two_inf_subpops_obs_+3A_infected_treatment">infected_treatment</code></td>
<td>
<p>name of data frame column identifying if data
are from an infected (1) or uninfected (0) treatment</p>
</td></tr>
<tr><td><code id="nll_two_inf_subpops_obs_+3A_d1">d1</code>, <code id="nll_two_inf_subpops_obs_+3A_d2">d2</code>, <code id="nll_two_inf_subpops_obs_+3A_d3">d3</code></td>
<td>
<p>names of probability distributions chosen to describe
background mortality and mortality due to infection, respectively;
each defaults to the Weibull distribution</p>
</td></tr>
<tr><td><code id="nll_two_inf_subpops_obs_+3A_infsubpop">infsubpop</code></td>
<td>
<p>name of data frame column identifying
the two subpopulations of infected hosts; '1' or '2'</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The nll is based on six parameters, the location and scale
parameters for background mortality,
plus separate location and scale parameters for each of
the two infected subpopulations.
</p>
<p>It is assumed the patterns of mortality within each subpopulation
act independently of one another.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+nll_exposed_infected">nll_exposed_infected</a></code>
<code><a href="#topic+nll_two_inf_subpops_unobs">nll_two_inf_subpops_unobs</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># example using data from Parker et al
    data01 &lt;- data_parker

# create column 'infsubpop' in data01, fill with '0'
    data01$infsubpop &lt;- 0

# infsubpop = '1' for individuals in infected treatments (g == 1)
  # with visible signs of sporulation (Sporulation = 1)
# infsubpop = '2' for individuals in infected treatments (g == 1)
  # with no visible signs of sporulation (Sporulation = 0)
    data01$infsubpop[data01$g == 1 &amp; data01$Sporulation == 1] &lt;- 1
    data01$infsubpop[data01$g == 1 &amp; data01$Sporulation == 0] &lt;- 2

    head(data01)

# step #1: parameterise nll function to be passed to 'mle2'
    m01_prep_function &lt;- function(
      a1 = a1, b1 = b1, a2 = a2, b2 = b2, a3 = a3, b3 = b3){
        nll_two_inf_subpops_obs(
          a1 = a1, b1 = b1, a2 = a2, b2 = b2, a3 = a3, b3 = b3,
          data = data01,
          time = t,
          censor = censored,
          infected_treatment = g,
          d1 = "Frechet",
          d2 = "Weibull",
          d3 = "Weibull",
          infsubpop = infsubpop
        )}

# step #2: send 'prep_function' to 'mle2' for maximum likelihood estimation
    m01 &lt;- mle2(
      m01_prep_function,
      start = list(a1 = 3, b1 = 1, a2 = 2, b2 = 0.5, a3 = 2, b3 = 0.5)
      )

    summary(m01)

</code></pre>

<hr>
<h2 id='nll_two_inf_subpops_unobs'>Negative log-likelihood function:
two unobserved subpopulations of infected hosts</h2><span id='topic+nll_two_inf_subpops_unobs'></span>

<h3>Description</h3>

<p>Function returning negative log-likelihood (nll) for patterns of mortality in
infected and uninfected treatments when an infected population is assumed
to harbour two distinct subpopulations of hosts experiencing different
virulence.
The nll is based on seven parameters, the location and scale
parameters for background mortality, separate location and scale parameters
for each of the two infected subpopulations, and a parameter estimating the
proportions of the two subpopulations
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nll_two_inf_subpops_unobs(
  a1 = a1,
  b1 = b1,
  a2 = a2,
  b2 = b2,
  a3 = a3,
  b3 = b3,
  p1 = p1,
  data = data,
  time = time,
  censor = censor,
  infected_treatment = infected_treatment,
  d1 = "Weibull",
  d2 = "Weibull",
  d3 = "Weibull"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nll_two_inf_subpops_unobs_+3A_a1">a1</code>, <code id="nll_two_inf_subpops_unobs_+3A_b1">b1</code></td>
<td>
<p>location and scale parameters describing background mortality</p>
</td></tr>
<tr><td><code id="nll_two_inf_subpops_unobs_+3A_a2">a2</code>, <code id="nll_two_inf_subpops_unobs_+3A_b2">b2</code></td>
<td>
<p>location and scale parameters describing mortality due to
infection in one subpopulation</p>
</td></tr>
<tr><td><code id="nll_two_inf_subpops_unobs_+3A_a3">a3</code>, <code id="nll_two_inf_subpops_unobs_+3A_b3">b3</code></td>
<td>
<p>location and scale parameters describing mortality due to
infection in the other subpopulation</p>
</td></tr>
<tr><td><code id="nll_two_inf_subpops_unobs_+3A_p1">p1</code></td>
<td>
<p>parameter estimating the proportion of infected hosts in the
first of the two subpopulations; 0 &lt;= p1 &lt;= 1</p>
</td></tr>
<tr><td><code id="nll_two_inf_subpops_unobs_+3A_data">data</code></td>
<td>
<p>name of data frame containing survival data</p>
</td></tr>
<tr><td><code id="nll_two_inf_subpops_unobs_+3A_time">time</code></td>
<td>
<p>name of data frame column identifying time of event; time &gt; 0</p>
</td></tr>
<tr><td><code id="nll_two_inf_subpops_unobs_+3A_censor">censor</code></td>
<td>
<p>name of data frame column idenifying if event was
death (0) or right-censoring (1)</p>
</td></tr>
<tr><td><code id="nll_two_inf_subpops_unobs_+3A_infected_treatment">infected_treatment</code></td>
<td>
<p>name of data frame column identifying if data are
from an infected (1) or uninfected (0) treatment</p>
</td></tr>
<tr><td><code id="nll_two_inf_subpops_unobs_+3A_d1">d1</code>, <code id="nll_two_inf_subpops_unobs_+3A_d2">d2</code>, <code id="nll_two_inf_subpops_unobs_+3A_d3">d3</code></td>
<td>
<p>names of probability distributions chosen to describe
background mortality and mortality due to infection in each subpopulation,
respectively; defaults to the Weibull distribution</p>
</td></tr>
</table>


<h3>Details</h3>

<p>p1 is the estimated proportion of hosts associated with the location and
scale parameters a2, b2; 0 &lt;= p1 &lt;= 1.
</p>
<p>It is assumed the patterns of mortality within each subpopulation
act independently of one another.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+nll_exposed_infected">nll_exposed_infected</a></code>
<code><a href="#topic+nll_two_inf_subpops_obs">nll_two_inf_subpops_obs</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># example using data from Parker et al
    data01 &lt;- data_parker

# step #1: parameterise nll function to be passed to 'mle2'
    m01_prep_function &lt;- function(
      a1 = a1, b1 = b1, a2 = a2, b2 = b2, a3 = a3, b3 = b3, p1 = p1){
        nll_two_inf_subpops_unobs(
          a1 = a1, b1 = b1, a2 = a2, b2 = b2, a3 = a3, b3 = b3, p1 = p1,
          data = data01,
          time = t,
          censor = censored,
          infected_treatment = g,
          d1 = "Frechet",
          d2 = "Weibull",
          d3 = "Weibull"
          )}

# step #2: send 'prep_function' to 'mle2' for maximum likelihood estimation
    m01 &lt;- mle2(
      m01_prep_function,
      start = list(a1 = 2, b1 = 1,
                   a2 = 2, b2 = 0.3,
                   a3 = 2, b3 = 0.7,
                   p1 = 0.5)
      )

    summary(m01)

</code></pre>

<hr>
<h2 id='recovery_data'>Simulated recovery data</h2><span id='topic+recovery_data'></span>

<h3>Description</h3>

<p>Simulated data allowing for recovery from infection,
where recovered individuals experience the same background mortality
as uninfected individuals.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>recovery_data
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 120 rows and 10 columns.
</p>


<h3>Value</h3>

<p>A dataframe
</p>

<dl>
<dt>columns 1-2</dt><dd><p>indicator variables identifying individuals
in the control treatment that died (control.d = 1)
or were censored (control.c = 1)</p>
</dd>
<dt>columns 3-4</dt><dd><p>indicator variables identifying individuals
in the infected treatment that died (infected.d = 1)
or were censored (infected.c = 1) while still infected</p>
</dd>
<dt>columns 5-6</dt><dd><p>indicator variables indenifying individuals
in the infected treatment that died (recovered.d = 1)
or were censored (recovered.c = 1) after recovering from infection</p>
</dd>
<dt>censor</dt><dd><p>'0' not censored, '1' censored</p>
</dd>
<dt>d</dt><dd><p>death indicator: '1' died, '0'</p>
</dd>
<dt>t</dt><dd><p>time of the event (death or censoring)</p>
</dd>
<dt>fq</dt><dd><p>frequence or number of individuals associated with the event
of death or censoring at time t</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>head(recovery_data) ; tail(recovery_data)
</code></pre>

<hr>
<h2 id='recovery_data_II'>Simulated recovery data, with no background mortality</h2><span id='topic+recovery_data_II'></span>

<h3>Description</h3>

<p>Simulated data allowing for recovery from infection,
when there is no background mortality.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>recovery_data_II
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 120 rows and 10 columns.
</p>


<h3>Value</h3>

<p>A dataframe
</p>

<dl>
<dt>columns 1-2</dt><dd><p>indicator variables identifying individuals
in the control treatment that died (control.d = 1)
or were censored (control.c = 1)</p>
</dd>
<dt>columns 3-4</dt><dd><p>indicator variables identifying individuals
in the infected treatment that died (infected.d = 1)
or were censored (infected.c = 1) while still infected</p>
</dd>
<dt>columns 5-6</dt><dd><p>indicator variables indenifying individuals
in the infected treatment that died (recovered.d = 1)
or were censored (recovered.c = 1) after recovering from infection</p>
</dd>
<dt>censor</dt><dd><p>'0' not censored, '1' censored</p>
</dd>
<dt>d</dt><dd><p>death indicator: '1' died, '0'</p>
</dd>
<dt>t</dt><dd><p>time of the event (death or censoring)</p>
</dd>
<dt>fq</dt><dd><p>frequence or number of individuals associated with the event
of death or censoring at time t</p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>head(recovery_data_II) ; tail(recovery_data_II)
</code></pre>

<hr>
<h2 id='sim_data_nll_basic'>Function simulating survival data for nll_basic</h2><span id='topic+sim_data_nll_basic'></span>

<h3>Description</h3>

<p>Function simulating survival data corresponding with assumptions of nll_basic
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sim_data_nll_basic(
  a1 = a1,
  b1 = b1,
  n1 = n1,
  a2 = a2,
  b2 = b2,
  n2 = n2,
  t_censor = 1000,
  d1 = "",
  d2 = ""
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sim_data_nll_basic_+3A_a1">a1</code>, <code id="sim_data_nll_basic_+3A_b1">b1</code>, <code id="sim_data_nll_basic_+3A_a2">a2</code>, <code id="sim_data_nll_basic_+3A_b2">b2</code></td>
<td>
<p>location and scale parameters describing background
mortality and mortality due to infection, respectively; values must be &gt; 0</p>
</td></tr>
<tr><td><code id="sim_data_nll_basic_+3A_n1">n1</code>, <code id="sim_data_nll_basic_+3A_n2">n2</code></td>
<td>
<p>size of populations to simulate data; uninfected and infected,
respectively; values must be &gt; 0</p>
</td></tr>
<tr><td><code id="sim_data_nll_basic_+3A_t_censor">t_censor</code></td>
<td>
<p>time when any individuals still alive are right-censored;
defaults to 1000 if not specified, must be &gt; 0</p>
</td></tr>
<tr><td><code id="sim_data_nll_basic_+3A_d1">d1</code>, <code id="sim_data_nll_basic_+3A_d2">d2</code></td>
<td>
<p>probability distribution(s) chosen to describe background
mortality and mortality due to infection, respectively;
choice of, Weibull, Gumbel, Fréchet</p>
</td></tr>
</table>


<h3>Details</h3>

<p>To generate data, the function collects the input variables for the
probability distributions chosen to describe the background mortality and
mortality due to infection, along with values for their location and scale
parameters, respectively.
These are used to parameterise cumulative survival functions for the two
sources of mortality. These functions are solved for time t, where the
value of S(t) is drawn from a random uniform distribution between 0 and 1;
this yields values of t corresponding with values of survival
drawn at random from the cumulative survival curve.
</p>
<p>Values of t are rounded up to the nearest integer.
This introduces a bias as recorded times of death are later than actual
times of death;
this bias occurs in real datasets when sampling occurs at discrete intervals.
This bias can be partially offset by taking the mid-point of sampling
intervals as the time of death.
Mid-point times of death are also provided, assuming sampling occurs at
each integer interval.
</p>
<p>In the case of hosts from infected treatments, two potential times of
death are calculated;
that due to background mortality and that due to infection.
The earlier of the two defines the time of death, providing it is not
later than the value of t_censor.
</p>
<p>The value of t_censor defines the time when any individuals remaining alive
are right-censored.
The act of censoring is assumed to occur after populations have been
sampled for mortality, i.e.,
if mortality is recorded daily and the last day of an experiment is day 14,
the populations are checked for mortality at the beginning of day 14 and
any individuals alive after this are classed as censored on day 14.
The timing of censoring is 'true' as individuals were known to be alive
at the time they were censored. Hence times of censoring do not vary for
'time' or 'mid-time', whereas they do for individuals dying at an unknown
time between two consecutive sampling times.
</p>


<h3>Warning</h3>

<p>The lower tail of Gumbel distribution can yield negative
estimates for times of death as the random variable replacing
cumulative survival approaches one; S(t) -&gt; 1.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  set.seed(34)

  sim_data &lt;- sim_data_nll_basic(
    a1 = 2.5, b1 = 0.9, n1 = 100, d1 = "Weibull",
    a2 = 2.0, b2 = 0.5, n2 = 100, d2 = "Weibull",
    t_censor = 14)

  head(sim_data, 10)

  sim_data$time[sim_data$infected_treatment == 0]

  sim_data$time[sim_data$infected_treatment == 1]

  # plot histogram for ages at death in infected population
      hist(
        sim_data$time[(sim_data$infected_treatment == 1 &amp; sim_data$censor == 0)],
        breaks = seq(0, 14, 1),
        xlim = c(0, 15),
        main = 'infected, died',
        xlab = 'time of death',
        xaxt = 'n')
      axis(side = 1, tick = TRUE, at = seq(0, 14, 1))

  # estimate location and scale parameters of simulated data with nll_basic
      m01_prep_function &lt;- function(a1, b1, a2, b2){
        nll_basic(a1, b1, a2, b2,
          data = sim_data,
          time = time,
          censor = censor,
          infected_treatment = infected_treatment,
          d1 = 'Weibull', d2 = 'Weibull'
          )}

    m01 &lt;- mle2(m01_prep_function,
             start = list(a1 = 2, b1 = 1, a2 = 2, b2 = 1)
             )

    confint(m01)

  # estimate using 'mid_time' instead of 'time'
      m02_prep_function &lt;- function(a1, b1, a2, b2){
        nll_basic(a1, b1, a2, b2,
          data = sim_data,
          time = mid_time,
          censor = censor,
          infected_treatment = infected_treatment,
          d1 = 'Weibull', d2 = 'Weibull'
          )}

      m02 &lt;- mle2(m02_prep_function,
             start = list(a1 = 2, b1 = 1, a2 = 2, b2 = 1)
             )

    confint(m02)

    # compare estimates
      AICc(m01, m02, nobs = 200)
      # for these data, m02 based on 'mid-time' provides a better
      # description of the data
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
