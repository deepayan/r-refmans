<!DOCTYPE html><html lang="en"><head><title>Help for package survex</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {survex}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#brier_score'><p>Calculate Brier score</p></a></li>
<li><a href='#c_index'><p>Compute the Harrell's Concordance index</p></a></li>
<li><a href='#cd_auc'><p>Calculate Cumulative/Dynamic AUC</p></a></li>
<li><a href='#cumulative_hazard_to_survival'><p>Transform Cumulative Hazard to Survival</p></a></li>
<li><a href='#explain_survival'><p>A model-agnostic explainer for survival models</p></a></li>
<li><a href='#extract_predict_survshap'><p>Extract Local SurvSHAP(t) from Global SurvSHAP(t)</p></a></li>
<li><a href='#integrated_brier_score'><p>Calculate integrated Brier score</p></a></li>
<li><a href='#integrated_cd_auc'><p>Calculate integrated C/D AUC</p></a></li>
<li><a href='#loss_adapt_mlr3proba'><p>Adapt mlr3proba measures for use with survex</p></a></li>
<li><a href='#loss_integrate'><p>Calculate integrated metrics based on time-dependent metrics.</p></a></li>
<li><a href='#loss_one_minus_c_index'><p>Calculate the Concordance index loss</p></a></li>
<li><a href='#loss_one_minus_cd_auc'><p>Calculate Cumulative/Dynamic AUC loss</p></a></li>
<li><a href='#loss_one_minus_integrated_cd_auc'><p>Calculate integrated C/D AUC loss</p></a></li>
<li><a href='#model_diagnostics'><p>Dataset Level Model Diagnostics</p></a></li>
<li><a href='#model_parts'><p>Dataset Level Variable Importance for Survival Models</p></a></li>
<li><a href='#model_performance'><p>Dataset Level Performance Measures</p></a></li>
<li><a href='#model_profile'><p>Dataset Level Variable Profile as Partial Dependence Explanations for Survival Models</p></a></li>
<li><a href='#model_profile_2d'><p>Dataset Level 2-Dimensional Variable Profile for Survival Models</p></a></li>
<li><a href='#model_survshap'><p>Global SHAP Values</p></a></li>
<li><a href='#plot.aggregated_surv_shap'><p>Plot Aggregated SurvSHAP(t) Explanations for Survival Models</p></a></li>
<li><a href='#plot.model_diagnostics_survival'><p>Plot Model Diagnostics for Survival Models</p></a></li>
<li><a href='#plot.model_parts_survival'><p>Plot Model Parts for Survival Models</p></a></li>
<li><a href='#plot.model_performance_survival'><p>Plot Model Performance for Survival Models</p></a></li>
<li><a href='#plot.model_profile_2d_survival'><p>Plot 2-Dimensional Model Profile for Survival Models</p></a></li>
<li><a href='#plot.model_profile_survival'><p>Plot Model Profile for Survival Models</p></a></li>
<li><a href='#plot.predict_parts_survival'><p>Plot Predict Parts for Survival Models</p></a></li>
<li><a href='#plot.predict_profile_survival'><p>Plot Predict Profile for Survival Models</p></a></li>
<li><a href='#plot.surv_feature_importance'><p>Plot Permutational Feature Importance for Survival Models</p></a></li>
<li><a href='#plot.surv_lime'><p>Plot SurvLIME Explanations for Survival Models</p></a></li>
<li><a href='#plot.surv_model_performance'><p>Plot Model Performance Metrics for Survival Models</p></a></li>
<li><a href='#plot.surv_model_performance_rocs'><p>Plot ROC Curves for Survival Models</p></a></li>
<li><a href='#plot.surv_shap'><p>Plot SurvSHAP(t) Explanations for Survival Models</p></a></li>
<li><a href='#predict_parts'><p>Instance Level Parts of Survival Model Predictions</p></a></li>
<li><a href='#predict_profile'><p>Instance Level Profile as Ceteris Paribus for Survival Models</p></a></li>
<li><a href='#predict.surv_explainer'><p>Model Predictions for Survival Models</p></a></li>
<li><a href='#risk_from_chf'><p>Generate Risk Prediction based on the Survival Function</p></a></li>
<li><a href='#set_theme_survex'><p>Default Theme for survex plots</p></a></li>
<li><a href='#surv_ceteris_paribus'><p>Helper functions for <code>predict_profile.R</code></p></a></li>
<li><a href='#surv_feature_importance'><p>Helper functions for <code>model_parts.R</code></p></a></li>
<li><a href='#surv_integrated_feature_importance'><p>Helper functions for <code>model_parts.R</code></p></a></li>
<li><a href='#surv_lime'><p>Helper functions for <code>predict_parts.R</code></p></a></li>
<li><a href='#surv_model_info'><p>Extract additional information from the model</p></a></li>
<li><a href='#surv_model_performance'><p>Helper functions for <code>model_performance.R</code></p></a></li>
<li><a href='#surv_shap'><p>Helper functions for <code>predict_parts.R</code></p></a></li>
<li><a href='#survival_to_cumulative_hazard'><p>Transform Survival to Cumulative Hazard</p></a></li>
<li><a href='#transform_to_stepfunction'><p>Transform Fixed Point Prediction into a Stepfunction</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Explainable Machine Learning in Survival Analysis</td>
</tr>
<tr>
<td>Version:</td>
<td>1.2.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Survival analysis models are commonly used in medicine and other areas. Many of them
    are too complex to be interpreted by human. Exploration and explanation is needed, but
    standard methods do not give a broad enough picture. 'survex' provides easy-to-apply
    methods for explaining survival models, both complex black-boxes and simpler statistical models.
    They include methods specific to survival analysis such as SurvSHAP(t) introduced in Krzyzinski et al., (2023)
    &lt;<a href="https://doi.org/10.1016%2Fj.knosys.2022.110234">doi:10.1016/j.knosys.2022.110234</a>&gt;, SurvLIME described in Kovalev et al., (2020) &lt;<a href="https://doi.org/10.1016%2Fj.knosys.2020.106164">doi:10.1016/j.knosys.2020.106164</a>&gt; as well as
    extensions of existing ones described in Biecek et al., (2021) &lt;<a href="https://doi.org/10.1201%2F9780429027192">doi:10.1201/9780429027192</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>DALEX (&ge; 2.2.1), ggplot2 (&ge; 3.4.0), kernelshap, pec,
survival, patchwork</td>
</tr>
<tr>
<td>Suggests:</td>
<td>censored (&ge; 0.2.0), covr, flexsurv, gbm, generics, glmnet,
ingredients, knitr (&ge; 1.42), mboost, parsnip, progressr,
randomForestSRC, ranger, reticulate, rmarkdown, rms, testthat
(&ge; 3.0.0), treeshap (&ge; 0.3.0), withr, xgboost</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://modeloriented.github.io/survex/">https://modeloriented.github.io/survex/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/ModelOriented/survex/issues">https://github.com/ModelOriented/survex/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-10-24 18:33:46 UTC; nick</td>
</tr>
<tr>
<td>Author:</td>
<td>Mikołaj Spytek <a href="https://orcid.org/0000-0001-7111-2286"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Mateusz Krzyziński
    <a href="https://orcid.org/0000-0001-6143-488X"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Sophie Langbein [aut],
  Hubert Baniecki <a href="https://orcid.org/0000-0001-6661-5364"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Lorenz A. Kapsner <a href="https://orcid.org/0000-0003-1866-860X"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Przemyslaw Biecek <a href="https://orcid.org/0000-0001-8423-1823"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Mikołaj Spytek &lt;mikolajspytek@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-10-24 18:50:07 UTC</td>
</tr>
</table>
<hr>
<h2 id='brier_score'>Calculate Brier score</h2><span id='topic+brier_score'></span><span id='topic+loss_brier_score'></span>

<h3>Description</h3>

<p>A function for calculating the Brier score for a survival model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>brier_score(y_true = NULL, risk = NULL, surv = NULL, times = NULL)

loss_brier_score(y_true = NULL, risk = NULL, surv = NULL, times = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="brier_score_+3A_y_true">y_true</code></td>
<td>
<p>a <code>survival::Surv</code> object containing the times and statuses of observations for which the metric will be evaluated</p>
</td></tr>
<tr><td><code id="brier_score_+3A_risk">risk</code></td>
<td>
<p>ignored, left for compatibility with other metrics</p>
</td></tr>
<tr><td><code id="brier_score_+3A_surv">surv</code></td>
<td>
<p>a matrix containing the predicted survival functions for the considered observations, each row represents a single observation, whereas each column one time point</p>
</td></tr>
<tr><td><code id="brier_score_+3A_times">times</code></td>
<td>
<p>a vector of time points at which the survival function was evaluated</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Brier score is used to evaluate the performance of a survival model, based on the squared distance between the predicted survival function and the actual event time, weighted to account for censored observations.
</p>


<h3>Value</h3>

<p>numeric from 0 to 1, lower scores are better (Brier score of 0.25 represents a model which returns always returns 0.5 as the predicted survival function)
</p>


<h3>References</h3>


<ul>
<li><p> [1] Brier, Glenn W. &quot;Verification of forecasts expressed in terms of probability.&quot; Monthly Weather Review 78.1 (1950): 1-3.
</p>
</li>
<li><p> [2] Graf, Erika, et al. &quot;Assessment and comparison of prognostic classification schemes for survival data.&quot; Statistics in Medicine 18.17‐18 (1999): 2529-2545.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+cd_auc">cd_auc()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(survival)
library(survex)

cph &lt;- coxph(Surv(time, status) ~ ., data = veteran, model = TRUE, x = TRUE, y = TRUE)
cph_exp &lt;- explain(cph)

y &lt;- cph_exp$y
times &lt;- cph_exp$times
surv &lt;- cph_exp$predict_survival_function(cph, cph_exp$data, times)

brier_score(y, surv = surv, times = times)
loss_brier_score(y, surv = surv, times = times)

</code></pre>

<hr>
<h2 id='c_index'>Compute the Harrell's Concordance index</h2><span id='topic+c_index'></span>

<h3>Description</h3>

<p>A function to compute the Harrell's concordance index of a survival model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>c_index(y_true = NULL, risk = NULL, surv = NULL, times = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="c_index_+3A_y_true">y_true</code></td>
<td>
<p>a <code>survival::Surv</code> object containing the times and statuses of observations for which the metric will be evaluated</p>
</td></tr>
<tr><td><code id="c_index_+3A_risk">risk</code></td>
<td>
<p>a numeric vector of risk scores corresponding to each observation</p>
</td></tr>
<tr><td><code id="c_index_+3A_surv">surv</code></td>
<td>
<p>ignored, left for compatibility with other metrics</p>
</td></tr>
<tr><td><code id="c_index_+3A_times">times</code></td>
<td>
<p>ignored, left for compatibility with other metrics</p>
</td></tr>
</table>


<h3>Value</h3>

<p>numeric from 0 to 1, higher values indicate better performance
</p>


<h3>References</h3>


<ul>
<li><p> [1] Harrell, F.E., Jr., et al. &quot;Regression modelling strategies for improved prognostic prediction.&quot; Statistics in Medicine 3.2 (1984): 143-152.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+loss_one_minus_c_index">loss_one_minus_c_index()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
library(survex)

rotterdam &lt;- survival::rotterdam
rotterdam$year &lt;- NULL
cox_rotterdam_rec &lt;- coxph(Surv(rtime, recur) ~ .,
    data = rotterdam,
    model = TRUE, x = TRUE, y = TRUE
)
coxph_explainer &lt;- explain(cox_rotterdam_rec)

risk &lt;- coxph_explainer$predict_function(coxph_explainer$model, coxph_explainer$data)
c_index(y_true = coxph_explainer$y, risk = risk)


</code></pre>

<hr>
<h2 id='cd_auc'>Calculate Cumulative/Dynamic AUC</h2><span id='topic+cd_auc'></span>

<h3>Description</h3>

<p>This function calculates the Cumulative/Dynamic AUC metric for a survival model. It is done using the
estimator proposed proposed by Uno et al. [1],
and Hung and Chang [2].
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cd_auc(y_true = NULL, risk = NULL, surv = NULL, times = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cd_auc_+3A_y_true">y_true</code></td>
<td>
<p>a <code>survival::Surv</code> object containing the times and statuses of observations for which the metric will be evaluated</p>
</td></tr>
<tr><td><code id="cd_auc_+3A_risk">risk</code></td>
<td>
<p>ignored, left for compatibility with other metrics</p>
</td></tr>
<tr><td><code id="cd_auc_+3A_surv">surv</code></td>
<td>
<p>a matrix containing the predicted survival functions for the considered observations, each row represents a single observation, whereas each column one time point</p>
</td></tr>
<tr><td><code id="cd_auc_+3A_times">times</code></td>
<td>
<p>a vector of time points at which the survival function was evaluated</p>
</td></tr>
</table>


<h3>Details</h3>

<p>C/D AUC is an extension of the AUC metric known from classification models.
Its values represent the model's performance at specific time points.
It can be integrated over the considered time range.
</p>


<h3>Value</h3>

<p>a numeric vector of length equal to the length of the times vector, each value (from the range from 0 to 1) represents the AUC metric at a specific time point, with higher values indicating better performance.
</p>


<h3>References</h3>


<ul>
<li><p> [1] Uno, Hajime, et al. &quot;Evaluating prediction rules for t-year survivors with censored regression models.&quot; Journal of the American Statistical Association 102.478 (2007): 527-537.
</p>
</li>
<li><p> [2] Hung, Hung, and Chin‐Tsang Chiang. &quot;Optimal composite markers for time dependent receiver operating characteristic curves with censored survival data.&quot; Scandinavian Journal of Statistics 37.4 (2010): 664-679.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+loss_one_minus_cd_auc">loss_one_minus_cd_auc()</a></code> <code><a href="#topic+integrated_cd_auc">integrated_cd_auc()</a></code> <code><a href="#topic+brier_score">brier_score()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(survival)
library(survex)

cph &lt;- coxph(Surv(time, status) ~ ., data = veteran, model = TRUE, x = TRUE, y = TRUE)
cph_exp &lt;- explain(cph)

y &lt;- cph_exp$y
times &lt;- cph_exp$times
surv &lt;- cph_exp$predict_survival_function(cph, cph_exp$data, times)

cd_auc(y, surv = surv, times = times)

</code></pre>

<hr>
<h2 id='cumulative_hazard_to_survival'>Transform Cumulative Hazard to Survival</h2><span id='topic+cumulative_hazard_to_survival'></span>

<h3>Description</h3>

<p>Helper function to transform between CHF and survival function
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cumulative_hazard_to_survival(hazard_functions)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cumulative_hazard_to_survival_+3A_hazard_functions">hazard_functions</code></td>
<td>
<p>matrix or vector, with each row representing a cumulative hazard function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix or vector transformed to the form of a survival function.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(survex)

vec &lt;- c(1, 2, 3, 4, 5)
matr &lt;- matrix(c(1, 2, 3, 2, 4, 6), ncol = 3)

cumulative_hazard_to_survival(vec)

cumulative_hazard_to_survival(matr)

</code></pre>

<hr>
<h2 id='explain_survival'>A model-agnostic explainer for survival models</h2><span id='topic+explain_survival'></span><span id='topic+explain'></span><span id='topic+explain.default'></span>

<h3>Description</h3>

<p>Black-box models have vastly different structures. <code>explain_survival()</code>
returns an explainer object that can be further processed for creating
prediction explanations and their visualizations. This function is used to manually
create explainers for models not covered by the <code>survex</code> package. For selected
models the extraction of information can be done automatically. To do
this, you can call the <code>explain()</code> function for survival models from  <code>mlr3proba</code>, <code>censored</code>,
<code>randomForestSRC</code>, <code>ranger</code>, <code>survival</code> packages and any other model
with <code>pec::predictSurvProb()</code> method.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>explain_survival(
  model,
  data = NULL,
  y = NULL,
  predict_function = NULL,
  predict_function_target_column = NULL,
  residual_function = NULL,
  weights = NULL,
  ...,
  label = NULL,
  verbose = TRUE,
  colorize = !isTRUE(getOption("knitr.in.progress")),
  model_info = NULL,
  type = NULL,
  times = NULL,
  times_generation = "survival_quantiles",
  predict_survival_function = NULL,
  predict_cumulative_hazard_function = NULL
)

explain(
  model,
  data = NULL,
  y = NULL,
  predict_function = NULL,
  predict_function_target_column = NULL,
  residual_function = NULL,
  weights = NULL,
  ...,
  label = NULL,
  verbose = TRUE,
  colorize = !isTRUE(getOption("knitr.in.progress")),
  model_info = NULL,
  type = NULL
)

## Default S3 method:
explain(
  model,
  data = NULL,
  y = NULL,
  predict_function = NULL,
  predict_function_target_column = NULL,
  residual_function = NULL,
  weights = NULL,
  ...,
  label = NULL,
  verbose = TRUE,
  colorize = !isTRUE(getOption("knitr.in.progress")),
  model_info = NULL,
  type = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="explain_survival_+3A_model">model</code></td>
<td>
<p>object - a survival model to be explained</p>
</td></tr>
<tr><td><code id="explain_survival_+3A_data">data</code></td>
<td>
<p>data.frame - data which will be used to calculate the explanations. If not provided, then it will be extracted from the model if possible. It should not contain the target columns. NOTE: If the target variable is present in the <code>data</code> some functionality breaks.</p>
</td></tr>
<tr><td><code id="explain_survival_+3A_y">y</code></td>
<td>
<p><code>survival::Surv</code> object containing event/censoring times and statuses corresponding to <code>data</code></p>
</td></tr>
<tr><td><code id="explain_survival_+3A_predict_function">predict_function</code></td>
<td>
<p>function taking 2 arguments - <code>model</code> and <code>newdata</code> and returning a single number for each observation - risk score. Observations with higher score are more likely to observe the event sooner.</p>
</td></tr>
<tr><td><code id="explain_survival_+3A_predict_function_target_column">predict_function_target_column</code></td>
<td>
<p>unused, left for compatibility with DALEX</p>
</td></tr>
<tr><td><code id="explain_survival_+3A_residual_function">residual_function</code></td>
<td>
<p>unused, left for compatibility with DALEX</p>
</td></tr>
<tr><td><code id="explain_survival_+3A_weights">weights</code></td>
<td>
<p>unused, left for compatibility with DALEX</p>
</td></tr>
<tr><td><code id="explain_survival_+3A_...">...</code></td>
<td>
<p>additional arguments, passed to <code>DALEX::explain()</code></p>
</td></tr>
<tr><td><code id="explain_survival_+3A_label">label</code></td>
<td>
<p>character - the name of the model. Used to differentiate on visualizations with multiple explainers. By default it's extracted from the 'class' attribute of the model if possible.</p>
</td></tr>
<tr><td><code id="explain_survival_+3A_verbose">verbose</code></td>
<td>
<p>logical, if TRUE (default) then diagnostic messages will be printed</p>
</td></tr>
<tr><td><code id="explain_survival_+3A_colorize">colorize</code></td>
<td>
<p>logical, if TRUE (default) then WARNINGS, ERRORS and NOTES are colorized. Will work only in the R console. By default it is FALSE while knitting and TRUE otherwise.</p>
</td></tr>
<tr><td><code id="explain_survival_+3A_model_info">model_info</code></td>
<td>
<p>a named list (<code>package</code>, <code>version</code>, <code>type</code>) containing information about model. If <code>NULL</code>, <code>survex</code> will seek for information on its own.</p>
</td></tr>
<tr><td><code id="explain_survival_+3A_type">type</code></td>
<td>
<p>type of a model, by default <code>"survival"</code></p>
</td></tr>
<tr><td><code id="explain_survival_+3A_times">times</code></td>
<td>
<p>numeric, a vector of times at which the survival function and cumulative hazard function should be evaluated for calculations</p>
</td></tr>
<tr><td><code id="explain_survival_+3A_times_generation">times_generation</code></td>
<td>
<p>either <code>"survival_quantiles"</code>, <code>"uniform"</code> or <code>"quantiles"</code>. Sets the way of generating the vector of times based on times provided in the <code>y</code> parameter. If <code>"survival_quantiles"</code> the vector contains unique time points out of 50 uniformly distributed survival quantiles based on the Kaplan-Meier estimator, and additional time point being the median survival time (if possible); if <code>"uniform"</code> the vector contains 50 equally spaced time points between the minimum and maximum observed times; if <code>"quantiles"</code> the vector contains unique time points out of 50 time points between 0th and 98th percentiles of observed times. Ignored if <code>times</code> is not <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="explain_survival_+3A_predict_survival_function">predict_survival_function</code></td>
<td>
<p>function taking 3 arguments <code>model</code>, <code>newdata</code> and <code>times</code>, and returning a matrix whose each row is a survival function evaluated at <code>times</code> for one observation from <code>newdata</code></p>
</td></tr>
<tr><td><code id="explain_survival_+3A_predict_cumulative_hazard_function">predict_cumulative_hazard_function</code></td>
<td>
<p>function taking 3 arguments <code>model</code>, <code>newdata</code> and <code>times</code>, and returning a matrix whose each row is a cumulative hazard function evaluated at <code>times</code> for one observation from <code>newdata</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>It is a list containing the following elements:
</p>

<ul>
<li> <p><code>model</code> - the explained model.
</p>
</li>
<li> <p><code>data</code> - the dataset used for training.
</p>
</li>
<li> <p><code>y</code> - response for observations from <code>data</code>.
</p>
</li>
<li> <p><code>residuals</code> - calculated residuals.
</p>
</li>
<li> <p><code>predict_function</code> - function that may be used for model predictions, shall return a single numerical value for each observation.
</p>
</li>
<li> <p><code>residual_function</code> - function that returns residuals, shall return a single numerical value for each observation.
</p>
</li>
<li> <p><code>class</code> - class/classes of a model.
</p>
</li>
<li> <p><code>label</code> - label of explainer.
</p>
</li>
<li> <p><code>model_info</code> - named list containing basic information about model, like package, version of package and type.
</p>
</li>
<li> <p><code>times</code> - a vector of times, that are used for evaluation of survival function and cumulative hazard function by default
</p>
</li>
<li> <p><code>predict_survival_function</code> - function that is used for model predictions in the form of survival function
</p>
</li>
<li> <p><code>predict_cumulative_hazard_function</code> - function that is used for model predictions in the form of cumulative hazard function
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
library(survex)

cph &lt;- survival::coxph(survival::Surv(time, status) ~ .,
    data = veteran,
    model = TRUE, x = TRUE
)
cph_exp &lt;- explain(cph)

rsf_ranger &lt;- ranger::ranger(survival::Surv(time, status) ~ .,
    data = veteran,
    respect.unordered.factors = TRUE, num.trees = 100, mtry = 3, max.depth = 5
)
rsf_ranger_exp &lt;- explain(rsf_ranger,
    data = veteran[, -c(3, 4)],
    y = Surv(veteran$time, veteran$status)
)

rsf_src &lt;- randomForestSRC::rfsrc(Surv(time, status) ~ ., data = veteran)
rsf_src_exp &lt;- explain(rsf_src)

library(censored, quietly = TRUE)

bt &lt;- parsnip::boost_tree() %&gt;%
    parsnip::set_engine("mboost") %&gt;%
    parsnip::set_mode("censored regression") %&gt;%
    generics::fit(survival::Surv(time, status) ~ ., data = veteran)
bt_exp &lt;- explain(bt, data = veteran[, -c(3, 4)], y = Surv(veteran$time, veteran$status))

###### explain_survival() ######

cph &lt;- coxph(Surv(time, status) ~ ., data = veteran)

veteran_data &lt;- veteran[, -c(3, 4)]
veteran_y &lt;- Surv(veteran$time, veteran$status)
risk_pred &lt;- function(model, newdata) predict(model, newdata, type = "risk")
surv_pred &lt;- function(model, newdata, times) pec::predictSurvProb(model, newdata, times)
chf_pred &lt;- function(model, newdata, times) -log(surv_pred(model, newdata, times))

manual_cph_explainer &lt;- explain_survival(
    model = cph,
    data = veteran_data,
    y = veteran_y,
    predict_function = risk_pred,
    predict_survival_function = surv_pred,
    predict_cumulative_hazard_function = chf_pred,
    label = "manual coxph"
)


</code></pre>

<hr>
<h2 id='extract_predict_survshap'>Extract Local SurvSHAP(t) from Global SurvSHAP(t)</h2><span id='topic+extract_predict_survshap'></span>

<h3>Description</h3>

<p>Helper function to extract local SurvSHAP(t) explanation from global one.
Can be can be useful for creating SurvSHAP(t) plots for single observations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_predict_survshap(aggregated_survshap, index)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="extract_predict_survshap_+3A_aggregated_survshap">aggregated_survshap</code></td>
<td>
<p>an object of class <code>aggregated_surv_shap</code> containing the computed global SHAP values</p>
</td></tr>
<tr><td><code id="extract_predict_survshap_+3A_index">index</code></td>
<td>
<p>a numeric value, position of an observation to be extracted in the result of global explanation</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of classes <code>c("predict_parts_survival", "surv_shap")</code>. It is a list with the element <code>result</code> containing the results of the explanation.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
veteran &lt;- survival::veteran
rsf_ranger &lt;- ranger::ranger(
    survival::Surv(time, status) ~ .,
    data = veteran,
    respect.unordered.factors = TRUE,
    num.trees = 100,
    mtry = 3,
    max.depth = 5
)
rsf_ranger_exp &lt;- explain(
    rsf_ranger,
    data = veteran[, -c(3, 4)],
    y = survival::Surv(veteran$time, veteran$status),
    verbose = FALSE
)

ranger_global_survshap &lt;- model_survshap(
    explainer = rsf_ranger_exp,
    new_observation = veteran[
        c(1:4, 17:20, 110:113, 126:129),
        !colnames(veteran) %in% c("time", "status")
    ]
)

local_survshap_1 &lt;- extract_predict_survshap(ranger_global_survshap, index = 1)
plot(local_survshap_1)


</code></pre>

<hr>
<h2 id='integrated_brier_score'>Calculate integrated Brier score</h2><span id='topic+integrated_brier_score'></span><span id='topic+loss_integrated_brier_score'></span>

<h3>Description</h3>

<p>This function calculates the integrated Brier score metric for a survival model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>integrated_brier_score(y_true = NULL, risk = NULL, surv = NULL, times = NULL)

loss_integrated_brier_score(
  y_true = NULL,
  risk = NULL,
  surv = NULL,
  times = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="integrated_brier_score_+3A_y_true">y_true</code></td>
<td>
<p>a <code>survival::Surv</code> object containing the times and statuses of observations for which the metric will be evaluated</p>
</td></tr>
<tr><td><code id="integrated_brier_score_+3A_risk">risk</code></td>
<td>
<p>ignored, left for compatibility with other metrics</p>
</td></tr>
<tr><td><code id="integrated_brier_score_+3A_surv">surv</code></td>
<td>
<p>a matrix containing the predicted survival functions for the considered observations, each row represents a single observation, whereas each column one time point</p>
</td></tr>
<tr><td><code id="integrated_brier_score_+3A_times">times</code></td>
<td>
<p>a vector of time points at which the survival function was evaluated</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It is useful to see how a model performs as a whole, not at specific time points, for example for easier comparison. This function allows for calculating the integral of Brier score metric numerically using the trapezoid method.
</p>


<h3>Value</h3>

<p>numeric from 0 to 1, lower values indicate better performance
</p>


<h3>References</h3>


<ul>
<li><p> [1] Brier, Glenn W. &quot;Verification of forecasts expressed in terms of probability.&quot; Monthly Weather Review 78.1 (1950): 1-3.
</p>
</li>
<li><p> [2] Graf, Erika, et al. &quot;Assessment and comparison of prognostic classification schemes for survival data.&quot; Statistics in Medicine 18.17‐18 (1999): 2529-2545.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+brier_score">brier_score()</a></code> <code><a href="#topic+integrated_cd_auc">integrated_cd_auc()</a></code> <code><a href="#topic+loss_one_minus_integrated_cd_auc">loss_one_minus_integrated_cd_auc()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
library(survex)

cph &lt;- coxph(Surv(time, status) ~ ., data = veteran, model = TRUE, x = TRUE, y = TRUE)
cph_exp &lt;- explain(cph)

y &lt;- cph_exp$y
times &lt;- cph_exp$times
surv &lt;- cph_exp$predict_survival_function(cph, cph_exp$data, times)

# calculating directly
integrated_brier_score(y, surv = surv, times = times)

</code></pre>

<hr>
<h2 id='integrated_cd_auc'>Calculate integrated C/D AUC</h2><span id='topic+integrated_cd_auc'></span>

<h3>Description</h3>

<p>This function calculates the integrated Cumulative/Dynamic AUC metric for a survival model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>integrated_cd_auc(y_true = NULL, risk = NULL, surv = NULL, times = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="integrated_cd_auc_+3A_y_true">y_true</code></td>
<td>
<p>a <code>survival::Surv</code> object containing the times and statuses of observations for which the metric will be evaluated</p>
</td></tr>
<tr><td><code id="integrated_cd_auc_+3A_risk">risk</code></td>
<td>
<p>ignored, left for compatibility with other metrics</p>
</td></tr>
<tr><td><code id="integrated_cd_auc_+3A_surv">surv</code></td>
<td>
<p>a matrix containing the predicted survival functions for the considered observations, each row represents a single observation, whereas each column one time point</p>
</td></tr>
<tr><td><code id="integrated_cd_auc_+3A_times">times</code></td>
<td>
<p>a vector of time points at which the survival function was evaluated</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It is useful to see how a model performs as a whole, not at specific time points, for example for easier comparison. This function allows for calculating the integral of the C/D AUC metric numerically using the trapezoid method.
</p>


<h3>Value</h3>

<p>numeric from 0 to 1, higher values indicate better performance
</p>
<p>#' @section References:
</p>

<ul>
<li><p> [1] Uno, Hajime, et al. &quot;Evaluating prediction rules for t-year survivors with censored regression models.&quot; Journal of the American Statistical Association 102.478 (2007): 527-537.
</p>
</li>
<li><p> [2] Hung, Hung, and Chin‐Tsang Chiang. &quot;Optimal composite markers for time‐dependent receiver operating characteristic curves with censored survival data.&quot; Scandinavian Journal of Statistics 37.4 (2010): 664-679.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+cd_auc">cd_auc()</a></code> <code><a href="#topic+loss_one_minus_cd_auc">loss_one_minus_cd_auc()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
library(survex)

cph &lt;- coxph(Surv(time, status) ~ ., data = veteran, model = TRUE, x = TRUE, y = TRUE)
cph_exp &lt;- explain(cph)

y &lt;- cph_exp$y
times &lt;- cph_exp$times
surv &lt;- cph_exp$predict_survival_function(cph, cph_exp$data, times)

integrated_cd_auc(y, surv = surv, times = times)

</code></pre>

<hr>
<h2 id='loss_adapt_mlr3proba'>Adapt mlr3proba measures for use with survex</h2><span id='topic+loss_adapt_mlr3proba'></span>

<h3>Description</h3>

<p>This function allows for usage of standardized measures from the mlr3proba package with <code>survex</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>loss_adapt_mlr3proba(measure, reverse = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="loss_adapt_mlr3proba_+3A_measure">measure</code></td>
<td>

<ul>
<li><p> a <code>MeasureSurv</code> object from the <code>mlr3proba</code> package, the object to adapt
</p>
</li></ul>
</td></tr>
<tr><td><code id="loss_adapt_mlr3proba_+3A_reverse">reverse</code></td>
<td>

<ul>
<li><p> boolean, FALSE by default, whether the metric should be reversed in order to be treated as loss (for permutational variable importance we need functions with lower values indicating better performance). If TRUE, the new metric value will be (1 - metric_value)
</p>
</li></ul>
</td></tr>
<tr><td><code id="loss_adapt_mlr3proba_+3A_...">...</code></td>
<td>

<ul>
<li><p> other parameters, currently ignored
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>a function with standardized parameters (<code>y_true</code>, <code>risk</code>, <code>surv</code>, <code>times</code>) that can be used to calculate loss
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
if(FALSE){
  measure &lt;- msr("surv.calib_beta")
  mlr_measure &lt;- loss_adapt_mlr3proba(measure)
}

</code></pre>

<hr>
<h2 id='loss_integrate'>Calculate integrated metrics based on time-dependent metrics.</h2><span id='topic+loss_integrate'></span>

<h3>Description</h3>

<p>This function allows for creating a function for calculation of integrated metrics based on a time dependent metric. A possibility to cut off the data at certain quantiles is implemented, as well as weighting the integrated metric by max time and marginal survival function [1]
</p>


<h3>Usage</h3>

<pre><code class='language-R'>loss_integrate(loss_function, ..., normalization = NULL, max_quantile = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="loss_integrate_+3A_loss_function">loss_function</code></td>
<td>

<ul>
<li><p> A time dependent loss function taking arguments (y_true, risk, surv, times)
</p>
</li></ul>
</td></tr>
<tr><td><code id="loss_integrate_+3A_...">...</code></td>
<td>

<ul>
<li><p> other parameters, currently ignored
</p>
</li></ul>
</td></tr>
<tr><td><code id="loss_integrate_+3A_normalization">normalization</code></td>
<td>

<ul>
<li><p> either NULL, &quot;t_max&quot; or &quot;survival&quot;. Decides what kind of weighting should be applied to the integrated metric. If &quot;t_max&quot;, then the integral is calculated using dw(t) where w(t) = t/t_max. If &quot;survival&quot;, then the integral is calculated using dw(t) where w(t) = (1 - S(t))/(1 - S(t_max)) and S(t) denotes the estimated marginal survival function. If NULL (default), the integral is calculated using dt.
</p>
</li></ul>
</td></tr>
<tr><td><code id="loss_integrate_+3A_max_quantile">max_quantile</code></td>
<td>

<ul>
<li><p> a number from the interval (0,1]. The integral will be calculated only up to the time value of <code>quantile(max_quantile)</code> of the observed event/censoring times in <code>y_true</code>.
</p>
</li></ul>
</td></tr>
</table>


<h3>Value</h3>

<p>a function that can be used to calculate metrics (with parameters <code>y_true</code>, <code>risk</code>, <code>surv</code>, and <code>times</code>)
</p>


<h3>References</h3>


<ul>
<li><p> [1] Graf, Erika, et al. &quot;Assessment and comparison of prognostic classification schemes for survival data.&quot; Statistics in Medicine 18.17‐18 (1999): 2529-2545.
</p>
</li></ul>


<hr>
<h2 id='loss_one_minus_c_index'>Calculate the Concordance index loss</h2><span id='topic+loss_one_minus_c_index'></span>

<h3>Description</h3>

<p>This function subtracts the C-index metric from one to obtain a loss function whose lower values indicate better model performance (useful for permutational feature importance)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>loss_one_minus_c_index(y_true = NULL, risk = NULL, surv = NULL, times = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="loss_one_minus_c_index_+3A_y_true">y_true</code></td>
<td>
<p>a <code>survival::Surv</code> object containing the times and statuses of observations for which the metric will be evaluated</p>
</td></tr>
<tr><td><code id="loss_one_minus_c_index_+3A_risk">risk</code></td>
<td>
<p>a numeric vector of risk scores corresponding to each observation</p>
</td></tr>
<tr><td><code id="loss_one_minus_c_index_+3A_surv">surv</code></td>
<td>
<p>ignored, left for compatibility with other metrics</p>
</td></tr>
<tr><td><code id="loss_one_minus_c_index_+3A_times">times</code></td>
<td>
<p>ignored, left for compatibility with other metrics</p>
</td></tr>
</table>


<h3>Value</h3>

<p>numeric from 0 to 1, lower values indicate better performance
</p>


<h3>References</h3>


<ul>
<li><p> [1] Harrell, F.E., Jr., et al. &quot;Regression modelling strategies for improved prognostic prediction.&quot; Statistics in Medicine 3.2 (1984): 143-152.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+c_index">c_index()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
library(survex)

rotterdam &lt;- survival::rotterdam
rotterdam$year &lt;- NULL
cox_rotterdam_rec &lt;- coxph(Surv(rtime, recur) ~ .,
    data = rotterdam,
    model = TRUE, x = TRUE, y = TRUE
)
coxph_explainer &lt;- explain(cox_rotterdam_rec)

risk &lt;- coxph_explainer$predict_function(coxph_explainer$model, coxph_explainer$data)
loss_one_minus_c_index(y_true = coxph_explainer$y, risk = risk)

</code></pre>

<hr>
<h2 id='loss_one_minus_cd_auc'>Calculate Cumulative/Dynamic AUC loss</h2><span id='topic+loss_one_minus_cd_auc'></span>

<h3>Description</h3>

<p>This function subtracts the C/D AUC metric from one to obtain a loss function whose lower values indicate better model performance (useful for permutational feature importance)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>loss_one_minus_cd_auc(y_true = NULL, risk = NULL, surv = NULL, times = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="loss_one_minus_cd_auc_+3A_y_true">y_true</code></td>
<td>
<p>a <code>survival::Surv</code> object containing the times and statuses of observations for which the metric will be evaluated</p>
</td></tr>
<tr><td><code id="loss_one_minus_cd_auc_+3A_risk">risk</code></td>
<td>
<p>ignored, left for compatibility with other metrics</p>
</td></tr>
<tr><td><code id="loss_one_minus_cd_auc_+3A_surv">surv</code></td>
<td>
<p>a matrix containing the predicted survival functions for the considered observations, each row represents a single observation, whereas each column one time point</p>
</td></tr>
<tr><td><code id="loss_one_minus_cd_auc_+3A_times">times</code></td>
<td>
<p>a vector of time points at which the survival function was evaluated</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a numeric vector of length equal to the length of the times vector, each value (from the range from 0 to 1) represents 1 - AUC metric at a specific time point, with lower values indicating better performance.
</p>
<p>#' @section References:
</p>

<ul>
<li><p> [1] Uno, Hajime, et al. &quot;Evaluating prediction rules for t-year survivors with censored regression models.&quot; Journal of the American Statistical Association 102.478 (2007): 527-537.
</p>
</li>
<li><p> [2] Hung, Hung, and Chin‐Tsang Chiang. &quot;Optimal composite markers for time‐dependent receiver operating characteristic curves with censored survival data.&quot; Scandinavian Journal of Statistics 37.4 (2010): 664-679.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+cd_auc">cd_auc()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(survival)
library(survex)

cph &lt;- coxph(Surv(time, status) ~ ., data = veteran, model = TRUE, x = TRUE, y = TRUE)
cph_exp &lt;- explain(cph)

y &lt;- cph_exp$y
times &lt;- cph_exp$times
surv &lt;- cph_exp$predict_survival_function(cph, cph_exp$data, times)

loss_one_minus_cd_auc(y, surv = surv, times = times)

</code></pre>

<hr>
<h2 id='loss_one_minus_integrated_cd_auc'>Calculate integrated C/D AUC loss</h2><span id='topic+loss_one_minus_integrated_cd_auc'></span>

<h3>Description</h3>

<p>This function subtracts integrated the C/D AUC metric from one to obtain a loss function whose lower values indicate better model performance (useful for permutational feature importance)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>loss_one_minus_integrated_cd_auc(
  y_true = NULL,
  risk = NULL,
  surv = NULL,
  times = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="loss_one_minus_integrated_cd_auc_+3A_y_true">y_true</code></td>
<td>
<p>a <code>survival::Surv</code> object containing the times and statuses of observations for which the metric will be evaluated</p>
</td></tr>
<tr><td><code id="loss_one_minus_integrated_cd_auc_+3A_risk">risk</code></td>
<td>
<p>ignored, left for compatibility with other metrics</p>
</td></tr>
<tr><td><code id="loss_one_minus_integrated_cd_auc_+3A_surv">surv</code></td>
<td>
<p>a matrix containing the predicted survival functions for the considered observations, each row represents a single observation, whereas each column one time point</p>
</td></tr>
<tr><td><code id="loss_one_minus_integrated_cd_auc_+3A_times">times</code></td>
<td>
<p>a vector of time points at which the survival function was evaluated</p>
</td></tr>
</table>


<h3>Value</h3>

<p>numeric from 0 to 1, lower values indicate better performance
</p>
<p>#' @section References:
</p>

<ul>
<li><p> [1] Uno, Hajime, et al. &quot;Evaluating prediction rules for t-year survivors with censored regression models.&quot; Journal of the American Statistical Association 102.478 (2007): 527-537.
</p>
</li>
<li><p> [2] Hung, Hung, and Chin‐Tsang Chiang. &quot;Optimal composite markers for time‐dependent receiver operating characteristic curves with censored survival data.&quot; Scandinavian Journal of Statistics 37.4 (2010): 664-679.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+integrated_cd_auc">integrated_cd_auc()</a></code> <code><a href="#topic+cd_auc">cd_auc()</a></code> <code><a href="#topic+loss_one_minus_cd_auc">loss_one_minus_cd_auc()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
library(survex)

cph &lt;- coxph(Surv(time, status) ~ ., data = veteran, model = TRUE, x = TRUE, y = TRUE)
cph_exp &lt;- explain(cph)

y &lt;- cph_exp$y
times &lt;- cph_exp$times
surv &lt;- cph_exp$predict_survival_function(cph, cph_exp$data, times)

# calculating directly
loss_one_minus_integrated_cd_auc(y, surv = surv, times = times)

</code></pre>

<hr>
<h2 id='model_diagnostics'>Dataset Level Model Diagnostics</h2><span id='topic+model_diagnostics'></span><span id='topic+model_diagnostics.surv_explainer'></span>

<h3>Description</h3>

<p>This function calculates martingale and deviance residuals.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>model_diagnostics(explainer)

## S3 method for class 'surv_explainer'
model_diagnostics(explainer)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="model_diagnostics_+3A_explainer">explainer</code></td>
<td>
<p>an explainer object - model preprocessed by the <code>explain()</code> function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>c("model_diagnostics_survival")</code>. It's a list with the explanations in the <code>result</code> element.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
library(survex)

cph &lt;- coxph(Surv(time, status) ~ ., data = veteran, model = TRUE, x = TRUE, y = TRUE)
rsf_ranger &lt;- ranger::ranger(Surv(time, status) ~ .,
  data = veteran,
  respect.unordered.factors = TRUE,
  num.trees = 100,
  mtry = 3,
  max.depth = 5
)

cph_exp &lt;- explain(cph)

rsf_ranger_exp &lt;- explain(rsf_ranger,
  data = veteran[, -c(3, 4)],
  y = Surv(veteran$time, veteran$status)
)

cph_residuals &lt;- model_diagnostics(cph_exp)
rsf_residuals &lt;- model_diagnostics(rsf_ranger_exp)

head(cph_residuals$result)
plot(cph_residuals, rsf_residuals, xvariable = "age")
plot(cph_residuals, rsf_residuals, plot_type = "Cox-Snell")


</code></pre>

<hr>
<h2 id='model_parts'>Dataset Level Variable Importance for Survival Models</h2><span id='topic+model_parts'></span><span id='topic+model_parts.surv_explainer'></span>

<h3>Description</h3>

<p>This function calculates variable importance as a change in the loss function after the variable values permutations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>model_parts(explainer, ...)

## S3 method for class 'surv_explainer'
model_parts(
  explainer,
  loss_function = survex::loss_brier_score,
  ...,
  type = "difference",
  output_type = "survival",
  N = 1000
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="model_parts_+3A_explainer">explainer</code></td>
<td>
<p>an explainer object - model preprocessed by the <code>explain()</code> function</p>
</td></tr>
<tr><td><code id="model_parts_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="#topic+surv_feature_importance">surv_feature_importance</a></code>, <code><a href="#topic+surv_integrated_feature_importance">surv_integrated_feature_importance</a></code>
</p>

<dl>
<dt><code>B</code></dt><dd><p>numeric, number of permutations to be calculated</p>
</dd>
<dt><code>variables</code></dt><dd><p>a character vector, names of variables to be included in the calculation</p>
</dd>
<dt><code>variable_groups</code></dt><dd><p>a list of character vectors of names of explanatory variables. For each vector, a single variable-importance measure is computed for the joint effect of the variables which names are provided in the vector. By default, variable_groups = NULL, in which case variable-importance measures are computed separately for all variables indicated in the variables argument</p>
</dd>
<dt><code>label</code></dt><dd><p>label of the model, if provides overrides x$label</p>
</dd>
</dl>
</td></tr>
<tr><td><code id="model_parts_+3A_loss_function">loss_function</code></td>
<td>
<p>a function that will be used to assess variable importance, by default <code>loss_brier_score</code> for survival models. The function can be supplied manually but has to have these named parameters (<code>y_true</code>, <code>risk</code>, <code>surv</code>, <code>times</code>), where <code>y_true</code> represents the <code>survival::Surv</code> object with observed times and statuses, <code>risk</code> is the risk score calculated by the model, and <code>surv</code> is the survival function for each observation evaluated at <code>times</code>.</p>
</td></tr>
<tr><td><code id="model_parts_+3A_type">type</code></td>
<td>
<p>a character vector, if <code>"raw"</code> the results are losses after the permutation, if <code>"ratio"</code> the results are in the form <code>loss/loss_full_model</code> and if <code>"difference"</code> the results are of the form <code>loss - loss_full_model</code>. Defaults to <code>"difference"</code>.</p>
</td></tr>
<tr><td><code id="model_parts_+3A_output_type">output_type</code></td>
<td>
<p>either <code>"survival"</code> or <code>"risk"</code> the type of survival model output that should be used for explanations. If <code>"survival"</code> the explanations are based on the survival function. Otherwise the scalar risk predictions are used by the <code>DALEX::model_profile</code> function.</p>
</td></tr>
<tr><td><code id="model_parts_+3A_n">N</code></td>
<td>
<p>number of observations that should be sampled for calculation of variable importance. If <code>NULL</code> then variable importance will be calculated on the whole dataset.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><em>Note</em>: This function can be run within <code>progressr::with_progress()</code> to display a progress bar, as the execution can take long, especially on large datasets.
</p>


<h3>Value</h3>

<p>An object of class <code>c("model_parts_survival", "surv_feature_importance")</code>. It's a list with the explanations in the <code>result</code> element.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
library(survex)

cph &lt;- coxph(Surv(time, status) ~ ., data = veteran, model = TRUE, x = TRUE, y = TRUE)
rsf_ranger &lt;- ranger::ranger(Surv(time, status) ~ .,
  data = veteran,
  respect.unordered.factors = TRUE,
  num.trees = 100,
  mtry = 3,
  max.depth = 5
)

cph_exp &lt;- explain(cph)

rsf_ranger_exp &lt;- explain(rsf_ranger,
  data = veteran[, -c(3, 4)],
  y = Surv(veteran$time, veteran$status)
)

cph_model_parts_brier &lt;- model_parts(cph_exp)
print(head(cph_model_parts_brier$result))
plot(cph_model_parts_brier)


rsf_ranger_model_parts &lt;- model_parts(rsf_ranger_exp)
print(head(rsf_ranger_model_parts$result))
plot(cph_model_parts_brier, rsf_ranger_model_parts)

</code></pre>

<hr>
<h2 id='model_performance'>Dataset Level Performance Measures</h2><span id='topic+model_performance'></span><span id='topic+model_performance.surv_explainer'></span>

<h3>Description</h3>

<p>This function calculates metrics for survival models. The metrics calculated are C/D AUC, Brier score, and their integrated versions, as well as concordance index. It also can calculate ROC curves for specific selected time points.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>model_performance(explainer, ...)

## S3 method for class 'surv_explainer'
model_performance(
  explainer,
  ...,
  type = "metrics",
  metrics = c(`C-index` = c_index, `Integrated C/D AUC` = integrated_cd_auc,
    `Brier score` = brier_score, `Integrated Brier score` = integrated_brier_score,
    `C/D AUC` = cd_auc),
  times = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="model_performance_+3A_explainer">explainer</code></td>
<td>
<p>an explainer object - model preprocessed by the <code>explain()</code> function</p>
</td></tr>
<tr><td><code id="model_performance_+3A_...">...</code></td>
<td>
<p>other parameters, currently ignored</p>
</td></tr>
<tr><td><code id="model_performance_+3A_type">type</code></td>
<td>
<p>character, either <code>"metrics"</code> or <code>"roc"</code>. If <code>"metrics"</code> then performance metrics are calculated, if <code>"roc"</code> ROC curves for selected time points are calculated.</p>
</td></tr>
<tr><td><code id="model_performance_+3A_metrics">metrics</code></td>
<td>
<p>a named vector containing the metrics to be calculated. The values should be standardized loss functions. The functions can be supplied manually but has to have these named parameters (<code>y_true</code>, <code>risk</code>, <code>surv</code>, <code>times</code>), where <code>y_true</code> represents the <code>survival::Surv</code> object with observed times and statuses, <code>risk</code> is the risk score calculated by the model, and <code>surv</code> is the survival function for each observation evaluated at <code>times</code>.</p>
</td></tr>
<tr><td><code id="model_performance_+3A_times">times</code></td>
<td>
<p>a numeric vector of times. If <code>type == "metrics"</code> then the survival function is evaluated at these times, if <code>type == "roc"</code> then the ROC curves are calculated at these times.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>"model_performance_survival"</code>. It's a list of metric values calculated for the model. It contains:
</p>

<ul>
<li><p> Harrell's concordance index [1]
</p>
</li>
<li><p> Brier score [2, 3]
</p>
</li>
<li><p> C/D AUC using the estimator proposed by Uno et. al [4]
</p>
</li>
<li><p> integral of the Brier score
</p>
</li>
<li><p> integral of the C/D AUC
</p>
</li></ul>



<h3>References</h3>


<ul>
<li><p> [1] Harrell, F.E., Jr., et al. &quot;Regression modelling strategies for improved prognostic prediction.&quot; Statistics in Medicine 3.2 (1984): 143-152.
</p>
</li>
<li><p> [2] Brier, Glenn W. &quot;Verification of forecasts expressed in terms of probability.&quot; Monthly Weather Review 78.1 (1950): 1-3.
</p>
</li>
<li><p> [3] Graf, Erika, et al. &quot;Assessment and comparison of prognostic classification schemes for survival data.&quot; Statistics in Medicine 18.17‐18 (1999): 2529-2545.
</p>
</li>
<li><p> [4] Uno, Hajime, et al. &quot;Evaluating prediction rules for t-year survivors with censored regression models.&quot; Journal of the American Statistical Association 102.478 (2007): 527-537.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
library(survex)


cph &lt;- coxph(Surv(time, status) ~ ., data = veteran, model = TRUE, x = TRUE, y = TRUE)
rsf_ranger &lt;- ranger::ranger(Surv(time, status) ~ .,
    data = veteran,
    respect.unordered.factors = TRUE,
    num.trees = 100,
    mtry = 3,
    max.depth = 5
)

rsf_src &lt;- randomForestSRC::rfsrc(Surv(time, status) ~ .,
    data = veteran
)

cph_exp &lt;- explain(cph)
rsf_ranger_exp &lt;- explain(rsf_ranger,
    data = veteran[, -c(3, 4)],
    y = Surv(veteran$time, veteran$status)
)
rsf_src_exp &lt;- explain(rsf_src)


cph_model_performance &lt;- model_performance(cph_exp)
rsf_ranger_model_performance &lt;- model_performance(rsf_ranger_exp)
rsf_src_model_performance &lt;- model_performance(rsf_src_exp)

print(cph_model_performance)

plot(rsf_ranger_model_performance, cph_model_performance,
    rsf_src_model_performance,
    metrics_type = "scalar"
)

plot(rsf_ranger_model_performance, cph_model_performance, rsf_src_model_performance)

cph_model_performance_roc &lt;- model_performance(cph_exp, type = "roc", times = c(100, 250, 500))
plot(cph_model_performance_roc)

</code></pre>

<hr>
<h2 id='model_profile'>Dataset Level Variable Profile as Partial Dependence Explanations for Survival Models</h2><span id='topic+model_profile'></span><span id='topic+model_profile.surv_explainer'></span>

<h3>Description</h3>

<p>This function calculates explanations on a dataset level that help explore model response as a function of selected variables.
The explanations are calculated as an extension of Partial Dependence Profiles with the inclusion of the time dimension.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>model_profile(
  explainer,
  variables = NULL,
  N = 100,
  ...,
  groups = NULL,
  k = NULL,
  type = "partial",
  center = FALSE,
  output_type = "survival"
)

## S3 method for class 'surv_explainer'
model_profile(
  explainer,
  variables = NULL,
  N = 100,
  ...,
  categorical_variables = NULL,
  grid_points = 51,
  variable_splits_type = "uniform",
  groups = NULL,
  k = NULL,
  center = FALSE,
  type = "partial",
  output_type = "survival"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="model_profile_+3A_explainer">explainer</code></td>
<td>
<p>an explainer object - model preprocessed by the <code>explain()</code> function</p>
</td></tr>
<tr><td><code id="model_profile_+3A_variables">variables</code></td>
<td>
<p>character, a vector of names of variables to be explained</p>
</td></tr>
<tr><td><code id="model_profile_+3A_n">N</code></td>
<td>
<p>number of observations used for the calculation of aggregated profiles. By default <code>100</code>. If <code>NULL</code> all observations are used.</p>
</td></tr>
<tr><td><code id="model_profile_+3A_...">...</code></td>
<td>
<p>other parameters passed to <code>DALEX::model_profile</code> if <code>output_type == "risk"</code>, otherwise ignored</p>
</td></tr>
<tr><td><code id="model_profile_+3A_groups">groups</code></td>
<td>
<p>if <code>output_type == "risk"</code> a variable name that will be used for grouping. By default <code>NULL</code>, so no groups are calculated. If <code>output_type == "survival"</code> then ignored</p>
</td></tr>
<tr><td><code id="model_profile_+3A_k">k</code></td>
<td>
<p>passed to <code>DALEX::model_profile</code> if <code>output_type == "risk"</code>, otherwise ignored</p>
</td></tr>
<tr><td><code id="model_profile_+3A_type">type</code></td>
<td>
<p>the type of variable profile, <code>"partial"</code> for Partial Dependence, <code>"accumulated"</code> for Accumulated Local Effects, or <code>"conditional"</code> (available only for <code>output_type == "risk"</code>)</p>
</td></tr>
<tr><td><code id="model_profile_+3A_center">center</code></td>
<td>
<p>logical, should profiles be centered around the average prediction</p>
</td></tr>
<tr><td><code id="model_profile_+3A_output_type">output_type</code></td>
<td>
<p>either <code>"survival"</code>, <code>"chf"</code> or <code>"risk"</code> the type of survival model output that should be considered for explanations. If <code>"survival"</code> the explanations are based on the survival function. If <code>"chf"</code> the explanations are based on the cumulative hazard function. Otherwise the scalar risk predictions are used by the <code>DALEX::predict_profile</code> function.</p>
</td></tr>
<tr><td><code id="model_profile_+3A_categorical_variables">categorical_variables</code></td>
<td>
<p>character, a vector of names of additional variables which should be treated as categorical (factors are automatically treated as categorical variables). If it contains variable names not present in the <code>variables</code> argument, they will be added at the end.</p>
</td></tr>
<tr><td><code id="model_profile_+3A_grid_points">grid_points</code></td>
<td>
<p>maximum number of points for profile calculations. Note that the final number of points may be lower than grid_points. Will be passed to internal function. By default <code>51</code>.</p>
</td></tr>
<tr><td><code id="model_profile_+3A_variable_splits_type">variable_splits_type</code></td>
<td>
<p>character, decides how variable grids should be calculated. Use <code>"quantiles"</code> for percentiles or <code>"uniform"</code> (default) to get uniform grid of points.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>model_profile_survival</code>. It is a list with the element <code>result</code> containing the results of the calculation.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
library(survex)

cph &lt;- coxph(Surv(time, status) ~ ., data = veteran, model = TRUE, x = TRUE, y = TRUE)
rsf_src &lt;- randomForestSRC::rfsrc(Surv(time, status) ~ ., data = veteran)

cph_exp &lt;- explain(cph)
rsf_src_exp &lt;- explain(rsf_src)

cph_model_profile &lt;- model_profile(cph_exp,
    output_type = "survival",
    variables = c("age")
)

head(cph_model_profile$result)

plot(cph_model_profile)

rsf_model_profile &lt;- model_profile(rsf_src_exp,
    output_type = "survival",
    variables = c("age", "celltype"),
    type = "accumulated"
)

head(rsf_model_profile$result)

plot(rsf_model_profile, variables = c("age", "celltype"), numerical_plot_type = "contours")


</code></pre>

<hr>
<h2 id='model_profile_2d'>Dataset Level 2-Dimensional Variable Profile for Survival Models</h2><span id='topic+model_profile_2d'></span><span id='topic+model_profile_2d.surv_explainer'></span>

<h3>Description</h3>

<p>This function calculates explanations on a dataset level that help explore model response as a function of selected pairs of variables.
The explanations are calculated as an extension of Partial Dependence Profiles or Accumulated Local Effects with the inclusion of the time dimension.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>model_profile_2d(
  explainer,
  variables = NULL,
  N = 100,
  categorical_variables = NULL,
  grid_points = 25,
  center = FALSE,
  variable_splits_type = "uniform",
  type = "partial",
  output_type = "survival"
)

## S3 method for class 'surv_explainer'
model_profile_2d(
  explainer,
  variables = NULL,
  N = 100,
  categorical_variables = NULL,
  grid_points = 25,
  center = FALSE,
  variable_splits_type = "uniform",
  type = "partial",
  output_type = "survival"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="model_profile_2d_+3A_explainer">explainer</code></td>
<td>
<p>an explainer object - model preprocessed by the <code>explain()</code> function</p>
</td></tr>
<tr><td><code id="model_profile_2d_+3A_variables">variables</code></td>
<td>
<p>list of character vectors of length 2, names of pairs of variables to be explained</p>
</td></tr>
<tr><td><code id="model_profile_2d_+3A_n">N</code></td>
<td>
<p>number of observations used for the calculation of aggregated profiles. By default <code>100</code>. If <code>NULL</code> all observations are used.</p>
</td></tr>
<tr><td><code id="model_profile_2d_+3A_categorical_variables">categorical_variables</code></td>
<td>
<p>character, a vector of names of additional variables which should be treated as categorical (factors are automatically treated as categorical variables). If it contains variable names not present in the <code>variables</code> argument, they will be added at the end.</p>
</td></tr>
<tr><td><code id="model_profile_2d_+3A_grid_points">grid_points</code></td>
<td>
<p>maximum number of points for profile calculations. Note that the final number of points may be lower than grid_points. Will be passed to internal function. By default <code>25</code>.</p>
</td></tr>
<tr><td><code id="model_profile_2d_+3A_center">center</code></td>
<td>
<p>logical, should profiles be centered around the average prediction</p>
</td></tr>
<tr><td><code id="model_profile_2d_+3A_variable_splits_type">variable_splits_type</code></td>
<td>
<p>character, decides how variable grids should be calculated. Use <code>"quantiles"</code> for quantiles or <code>"uniform"</code> (default) to get uniform grid of points. Used only if <code>type = "partial"</code>.</p>
</td></tr>
<tr><td><code id="model_profile_2d_+3A_type">type</code></td>
<td>
<p>the type of variable profile, <code>"partial"</code> for Partial Dependence or <code>"accumulated"</code> for Accumulated Local Effects</p>
</td></tr>
<tr><td><code id="model_profile_2d_+3A_output_type">output_type</code></td>
<td>
<p>either <code>"survival"</code>, <code>"chf"</code> or <code>"risk"</code> the type of survival model output that should be considered for explanations. If <code>"survival"</code> the explanations are based on the survival function. If <code>"chf"</code> the explanations are based on the cumulative hazard function. Otherwise the scalar risk predictions are used by the <code>DALEX::predict_profile</code> function.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>model_profile_2d_survival</code>. It is a list with the element <code>result</code> containing the results of the calculation.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
library(survex)

cph &lt;- coxph(Surv(time, status) ~ ., data = veteran, model = TRUE, x = TRUE, y = TRUE)
cph_exp &lt;- explain(cph)

cph_model_profile_2d &lt;- model_profile_2d(cph_exp,
    variables = list(c("age", "celltype"))
)
head(cph_model_profile_2d$result)
plot(cph_model_profile_2d)

cph_model_profile_2d_ale &lt;- model_profile_2d(cph_exp,
    variables = list(c("age", "karno")),
    type = "accumulated"
)
head(cph_model_profile_2d_ale$result)
plot(cph_model_profile_2d_ale)


</code></pre>

<hr>
<h2 id='model_survshap'>Global SHAP Values</h2><span id='topic+model_survshap'></span><span id='topic+model_survshap.surv_explainer'></span>

<h3>Description</h3>

<p>This function computes global SHAP values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>model_survshap(explainer, ...)

## S3 method for class 'surv_explainer'
model_survshap(
  explainer,
  new_observation = NULL,
  y_true = NULL,
  N = NULL,
  calculation_method = "kernelshap",
  aggregation_method = "integral",
  output_type = "survival",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="model_survshap_+3A_explainer">explainer</code></td>
<td>
<p>an explainer object - model preprocessed by the <code>explain()</code> function</p>
</td></tr>
<tr><td><code id="model_survshap_+3A_...">...</code></td>
<td>
<p>additional parameters, passed to internal functions</p>
</td></tr>
<tr><td><code id="model_survshap_+3A_new_observation">new_observation</code></td>
<td>
<p>new observations for which predictions need to be explained</p>
</td></tr>
<tr><td><code id="model_survshap_+3A_y_true">y_true</code></td>
<td>
<p>a two element numeric vector or matrix of one row and two columns, the first element being the true observed time and the second the status of the observation, used for plotting</p>
</td></tr>
<tr><td><code id="model_survshap_+3A_n">N</code></td>
<td>
<p>a positive integer, number of observations used as the background data</p>
</td></tr>
<tr><td><code id="model_survshap_+3A_calculation_method">calculation_method</code></td>
<td>
<p>a character, either <code>"kernelshap"</code> for use of <code>kernelshap</code> library (providing faster Kernel SHAP with refinements), <code>"exact_kernel"</code> for exact Kernel SHAP estimation, or <code>"treeshap"</code> for use of <code>treeshap</code> library (efficient implementation to compute SHAP values for tree-based models).</p>
</td></tr>
<tr><td><code id="model_survshap_+3A_aggregation_method">aggregation_method</code></td>
<td>
<p>a character, either <code>"integral"</code>, <code>"integral_absolute"</code>, <code>"mean_absolute"</code>, <code>"max_absolute"</code>, or <code>"sum_of_squares"</code></p>
</td></tr>
<tr><td><code id="model_survshap_+3A_output_type">output_type</code></td>
<td>
<p>a character, either <code>"survival"</code> or <code>"chf"</code>. Determines which type of prediction should be used for explanations.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If specifying <code>y_true</code>, also <code>new_observation</code> must be specified.
Using the argument <code>new_observation</code>, global SHAP values are computed for the provided data. Otherwise,
global SHAP values are computed for the data, the <code>explainer</code> was trained with.
</p>


<h3>Value</h3>

<p>An object of class <code>aggregated_surv_shap</code> containing the computed global SHAP values.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
veteran &lt;- survival::veteran
rsf_ranger &lt;- ranger::ranger(
    survival::Surv(time, status) ~ .,
    data = veteran,
    respect.unordered.factors = TRUE,
    num.trees = 100,
    mtry = 3,
    max.depth = 5
)
rsf_ranger_exp &lt;- explain(
    rsf_ranger,
    data = veteran[, -c(3, 4)],
    y = survival::Surv(veteran$time, veteran$status),
    verbose = FALSE
)

ranger_global_survshap &lt;- model_survshap(
    explainer = rsf_ranger_exp,
    new_observation = veteran[
        c(1:4, 17:20, 110:113, 126:129),
        !colnames(veteran) %in% c("time", "status")
    ],
    y_true = survival::Surv(
        veteran$time[c(1:4, 17:20, 110:113, 126:129)],
        veteran$status[c(1:4, 17:20, 110:113, 126:129)]
    ),
    aggregation_method = "integral",
    calculation_method = "kernelshap",
)
plot(ranger_global_survshap)
plot(ranger_global_survshap, geom = "beeswarm")
plot(ranger_global_survshap, geom = "profile", color_variable = "karno")


</code></pre>

<hr>
<h2 id='plot.aggregated_surv_shap'>Plot Aggregated SurvSHAP(t) Explanations for Survival Models</h2><span id='topic+plot.aggregated_surv_shap'></span>

<h3>Description</h3>

<p>This functions plots objects of class <code>aggregated_surv_shap</code> - aggregated time-dependent
explanations of survival models created using the <code>model_survshap()</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'aggregated_surv_shap'
plot(
  x,
  geom = "importance",
  ...,
  title = "default",
  subtitle = "default",
  max_vars = 7,
  colors = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.aggregated_surv_shap_+3A_x">x</code></td>
<td>
<p>an object of class <code>aggregated_surv_shap</code> to be plotted</p>
</td></tr>
<tr><td><code id="plot.aggregated_surv_shap_+3A_geom">geom</code></td>
<td>
<p>character, one of <code>"importance"</code>, <code>"beeswarm"</code>, <code>"profile"</code> or <code>"curves"</code>. Type of chart to be plotted; <code>"importance"</code> shows the importance of variables over time and aggregated, <code>"beeswarm"</code> shows the distribution of SurvSHAP(t) values for variables and observations, <code>"profile"</code> shows the dependence of SurvSHAP(t) values on variable values, <code>"curves"</code> shows all SurvSHAP(t) curves for selected variable colored by its value or with functional boxplot if <code>boxplot = TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot.aggregated_surv_shap_+3A_...">...</code></td>
<td>
<p>additional parameters passed to internal functions</p>
</td></tr>
<tr><td><code id="plot.aggregated_surv_shap_+3A_title">title</code></td>
<td>
<p>character, title of the plot</p>
</td></tr>
<tr><td><code id="plot.aggregated_surv_shap_+3A_subtitle">subtitle</code></td>
<td>
<p>character, subtitle of the plot, <code>'default'</code> automatically generates &quot;created for the XXX model (n = YYY)&quot;, where XXX is the explainer label and YYY is the number of observations used for calculations</p>
</td></tr>
<tr><td><code id="plot.aggregated_surv_shap_+3A_max_vars">max_vars</code></td>
<td>
<p>maximum number of variables to be plotted (least important variables are ignored), by default 7</p>
</td></tr>
<tr><td><code id="plot.aggregated_surv_shap_+3A_colors">colors</code></td>
<td>
<p>character vector containing the colors to be used for plotting variables (containing either hex codes &quot;#FF69B4&quot;, or names &quot;blue&quot;)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of the class <code>ggplot</code>.
</p>


<h3>Plot options</h3>



<h4><code>plot.aggregated_surv_shap(geom = "importance")</code></h4>


<ul>
<li> <p><code>rug</code> - character, one of <code>"all"</code>, <code>"events"</code>, <code>"censors"</code>, <code>"none"</code> or <code>NULL</code>. Which times to mark on the x axis in <code>geom_rug()</code>.
</p>
</li>
<li> <p><code>rug_colors</code> - character vector containing two colors (containing either hex codes &quot;#FF69B4&quot;, or names &quot;blue&quot;). The first color (red by default) will be used to mark event times, whereas the second (grey by default) will be used to mark censor times.
</p>
</li>
<li> <p><code style="white-space: pre;">&#8288;xlab_left, ylab_right&#8288;</code> - axis labels for left and right plots (due to different aggregation possibilities)
</p>
</li></ul>




<h4><code>plot.aggregated_surv_shap(geom = "beeswarm")</code></h4>


<ul>
<li><p> no additional parameters
</p>
</li></ul>




<h4><code>plot.aggregated_surv_shap(geom = "profile")</code></h4>


<ul>
<li> <p><code>variable</code> - variable for which the profile is to be plotted, by default first from result data
</p>
</li>
<li> <p><code>color_variable</code> - variable used to denote the color, by default equal to <code>variable</code>
</p>
</li></ul>




<h4><code>plot.aggregated_surv_shap(geom = "curves")</code></h4>


<ul>
<li> <p><code>variable</code> - variable for which SurvSHAP(t) curves are to be plotted, by default first from result data
</p>
</li>
<li> <p><code>boxplot</code> - whether to plot functional boxplot with marked outliers or all curves colored by variable value
</p>
</li>
<li> <p><code>coef</code> - length of the functional boxplot's whiskers as multiple of IQR, by default 1.5
</p>
</li></ul>




<h3>Examples</h3>

<pre><code class='language-R'>
veteran &lt;- survival::veteran
rsf_ranger &lt;- ranger::ranger(
    survival::Surv(time, status) ~ .,
    data = veteran,
    respect.unordered.factors = TRUE,
    num.trees = 100,
    mtry = 3,
    max.depth = 5
)
rsf_ranger_exp &lt;- explain(
    rsf_ranger,
    data = veteran[, -c(3, 4)],
    y = survival::Surv(veteran$time, veteran$status),
    verbose = FALSE
)

ranger_global_survshap &lt;- model_survshap(
    explainer = rsf_ranger_exp,
    new_observation = veteran[
        c(1:4, 17:20, 110:113, 126:129),
        !colnames(veteran) %in% c("time", "status")
    ],
    y_true = survival::Surv(
        veteran$time[c(1:4, 17:20, 110:113, 126:129)],
        veteran$status[c(1:4, 17:20, 110:113, 126:129)]
    ),
    aggregation_method = "integral",
    calculation_method = "kernelshap",
)
plot(ranger_global_survshap)
plot(ranger_global_survshap, geom = "beeswarm")
plot(ranger_global_survshap, geom = "profile",
     variable = "age", color_variable = "karno")
plot(ranger_global_survshap, geom = "curves",
     variable = "age")
plot(ranger_global_survshap, geom = "curves",
     variable = "age", boxplot = TRUE)


</code></pre>

<hr>
<h2 id='plot.model_diagnostics_survival'>Plot Model Diagnostics for Survival Models</h2><span id='topic+plot.model_diagnostics_survival'></span>

<h3>Description</h3>

<p>This function plots objects of class <code>"model_diagnostics_survival"</code> created
using the <code>model_diagnostics()</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'model_diagnostics_survival'
plot(
  x,
  ...,
  plot_type = "deviance",
  xvariable = "index",
  smooth = as.logical(xvariable != "index"),
  facet_ncol = NULL,
  title = "Model diagnostics",
  subtitle = "default",
  colors = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.model_diagnostics_survival_+3A_x">x</code></td>
<td>
<p>an object of class <code>model_diagnostics_survival</code> to be plotted</p>
</td></tr>
<tr><td><code id="plot.model_diagnostics_survival_+3A_...">...</code></td>
<td>
<p>additional objects of class <code>model_diagnostics_survival</code> to be plotted together</p>
</td></tr>
<tr><td><code id="plot.model_diagnostics_survival_+3A_plot_type">plot_type</code></td>
<td>
<p>character, either <code>"deviance"</code>, <code>"martingale"</code> or <code>"Cox-Snell"</code>. Selects the type of plot to be prepared. If <code>"deviance"</code> or <code style="white-space: pre;">&#8288;"martingale&#8288;</code> then deviance/martingale residuals are plotted against <code>xvariable</code>. If <code>"Cox-Snell"</code> then diagnostic plot of Cox-Snell residuals is prepared, which is CHF estimated based on Cox-Snell residuals against theoretical cumulative hazard trajectory of the Exp(1) &ndash; diagonal line.</p>
</td></tr>
<tr><td><code id="plot.model_diagnostics_survival_+3A_xvariable">xvariable</code></td>
<td>
<p>character, name of the variable to be plotted on x-axis (can be name of the variable to be drawn on the x-axis (can be any column from the <code>x$result</code>: explanatory variable, time, other residuals). By default <code>"index"</code> which gives the order of observations.</p>
</td></tr>
<tr><td><code id="plot.model_diagnostics_survival_+3A_smooth">smooth</code></td>
<td>
<p>logical, shall the smooth line be added. Only used when <code>plot_type = "deviance"</code> or <code>plot_type = "martingale"</code>.</p>
</td></tr>
<tr><td><code id="plot.model_diagnostics_survival_+3A_facet_ncol">facet_ncol</code></td>
<td>
<p>number of columns for arranging subplots</p>
</td></tr>
<tr><td><code id="plot.model_diagnostics_survival_+3A_title">title</code></td>
<td>
<p>character, title of the plot</p>
</td></tr>
<tr><td><code id="plot.model_diagnostics_survival_+3A_subtitle">subtitle</code></td>
<td>
<p>character, subtitle of the plot, <code>"default"</code> automatically generates &quot;created for XXX, YYY models&quot;, where XXX and YYY are the explainer labels</p>
</td></tr>
<tr><td><code id="plot.model_diagnostics_survival_+3A_colors">colors</code></td>
<td>
<p>character vector containing the colors to be used for plotting (containing either hex codes &quot;#FF69B4&quot;, or names &quot;blue&quot;).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of the class <code>ggplot</code>.
</p>

<hr>
<h2 id='plot.model_parts_survival'>Plot Model Parts for Survival Models</h2><span id='topic+plot.model_parts_survival'></span>

<h3>Description</h3>

<p>This function is a wrapper for plotting <code>model_parts</code> objects created for survival models
using the <code>model_parts()</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'model_parts_survival'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.model_parts_survival_+3A_x">x</code></td>
<td>
<p>an object of class <code>"model_parts_survival"</code> to be plotted</p>
</td></tr>
<tr><td><code id="plot.model_parts_survival_+3A_...">...</code></td>
<td>
<p>additional parameters passed to the <code>plot.surv_feature_importance</code> function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of the class <code>ggplot</code>.
</p>


<h3>Plot options</h3>


<ul>
<li> <p><code>title</code> - character, title of the plot
</p>
</li>
<li> <p><code>subtitle</code> - character, subtitle of the plot, if <code>NULL</code> automatically generated as &quot;created for XXX, YYY models&quot;, where XXX and YYY are explainer labels
</p>
</li>
<li> <p><code>max_vars</code> - maximum number of variables to be plotted (least important variables are ignored)
</p>
</li>
<li> <p><code>colors</code> - character vector containing the colors to be used for plotting variables (containing either hex codes &quot;#FF69B4&quot;, or names &quot;blue&quot;)
</p>
</li>
<li> <p><code>rug</code> - character, one of <code>"all"</code>, <code>"events"</code>, <code>"censors"</code>, <code>"none"</code> or <code>NULL</code>. Which times to mark on the x axis in <code>geom_rug()</code>.
</p>
</li>
<li> <p><code>rug_colors</code> - character vector containing two colors (containing either hex codes &quot;#FF69B4&quot;, or names &quot;blue&quot;). The first color (red by default) will be used to mark event times, whereas the second (grey by default) will be used to mark censor times.
</p>
</li></ul>



<h3>See Also</h3>

<p>Other functions for plotting 'model_parts_survival' objects: 
<code><a href="#topic+plot.surv_feature_importance">plot.surv_feature_importance</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
library(survex)

model &lt;- coxph(Surv(time, status) ~ ., data = veteran, x = TRUE, model = TRUE, y = TRUE)
explainer &lt;- explain(model)

mp &lt;- model_parts(explainer)

plot(mp)

</code></pre>

<hr>
<h2 id='plot.model_performance_survival'>Plot Model Performance for Survival Models</h2><span id='topic+plot.model_performance_survival'></span>

<h3>Description</h3>

<p>This function is a wrapper for plotting <code>model_performance</code> objects created for survival models
using the <code>model_performance()</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'model_performance_survival'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.model_performance_survival_+3A_x">x</code></td>
<td>
<p>an object of class <code>"model_performance_survival"</code> to be plotted</p>
</td></tr>
<tr><td><code id="plot.model_performance_survival_+3A_...">...</code></td>
<td>
<p>additional parameters passed to the <code>plot.surv_model_performance</code> or <code>plot.surv_model_performance_rocs</code> function</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of the class <code>ggplot</code>.
</p>


<h3>Plot options</h3>



<h4><code>plot.surv_model_performance</code></h4>


<ul>
<li> <p><code>x</code> - an object of class <code>"surv_model_performance"</code> to be plotted
</p>
</li>
<li> <p><code>...</code> - additional objects of class <code>"surv_model_performance"</code> to be plotted together
</p>
</li>
<li> <p><code>metrics</code> - character, names of metrics to be plotted (subset of C/D AUC&quot;, &quot;Brier score&quot; for <code>metrics_type %in% c("time_dependent", "functional")</code> or subset of &quot;C-index&quot;,&quot;Integrated Brier score&quot;, &quot;Integrated C/D AUC&quot; for <code>metrics_type == "scalar"</code>), by default (<code>NULL</code>) all metrics of a given type are plotted
</p>
</li>
<li> <p><code>metrics_type</code> - character, either one of <code>c("time_dependent","functional")</code> for functional metrics or <code>"scalar"</code> for scalar metrics
</p>
</li>
<li> <p><code>title</code> - character, title of the plot
</p>
</li>
<li> <p><code>subtitle</code> - character, subtitle of the plot, <code>'default'</code> automatically generates &quot;created for XXX, YYY models&quot;, where XXX and YYY are the explainer labels
</p>
</li>
<li> <p><code>facet_ncol</code> - number of columns for arranging subplots
</p>
</li>
<li> <p><code>colors</code> - character vector containing the colors to be used for plotting variables (containing either hex codes &quot;#FF69B4&quot;, or names &quot;blue&quot;)
</p>
</li>
<li> <p><code>rug</code> - character, one of <code>"all"</code>, <code>"events"</code>, <code>"censors"</code>, <code>"none"</code> or <code>NULL</code>. Which times to mark on the x axis in <code>geom_rug()</code>.
</p>
</li>
<li> <p><code>rug_colors</code> - character vector containing two colors (containing either hex codes &quot;#FF69B4&quot;, or names &quot;blue&quot;). The first color (red by default) will be used to mark event times, whereas the second (grey by default) will be used to mark censor times.
</p>
</li></ul>




<h4><code>plot.surv_model_performance_rocs</code></h4>


<ul>
<li> <p><code>x</code> - an object of class <code>"surv_model_performance_rocs"</code> to be plotted
</p>
</li>
<li> <p><code>...</code> - additional objects of class <code>"surv_model_performance_rocs"</code> to be plotted together
</p>
</li>
<li> <p><code>title</code> - character, title of the plot
</p>
</li>
<li> <p><code>subtitle</code> - character, subtitle of the plot, <code>'default'</code> automatically generates &quot;created for XXX, YYY models&quot;, where XXX and YYY are the explainer labels
</p>
</li>
<li> <p><code>colors</code> - character vector containing the colors to be used for plotting variables (containing either hex codes &quot;#FF69B4&quot;, or names &quot;blue&quot;)
</p>
</li>
<li> <p><code>facet_ncol</code> - number of columns for arranging subplots
</p>
</li></ul>




<h3>See Also</h3>

<p>Other functions for plotting 'model_performance_survival' objects: 
<code><a href="#topic+plot.surv_model_performance_rocs">plot.surv_model_performance_rocs</a>()</code>,
<code><a href="#topic+plot.surv_model_performance">plot.surv_model_performance</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
library(survex)

model &lt;- randomForestSRC::rfsrc(Surv(time, status) ~ ., data = veteran)
exp &lt;- explain(model)

m_perf &lt;- model_performance(exp)
plot(m_perf, metrics_type = "functional")

m_perf_roc &lt;- model_performance(exp, type = "roc", times = c(100, 300))
plot(m_perf_roc)

</code></pre>

<hr>
<h2 id='plot.model_profile_2d_survival'>Plot 2-Dimensional Model Profile for Survival Models</h2><span id='topic+plot.model_profile_2d_survival'></span>

<h3>Description</h3>

<p>This function plots objects of class <code>"model_profile_2d_survival"</code> created
using the <code>model_profile_2d()</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'model_profile_2d_survival'
plot(
  x,
  ...,
  variables = NULL,
  times = NULL,
  marginalize_over_time = FALSE,
  facet_ncol = NULL,
  title = "default",
  subtitle = "default",
  colors = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.model_profile_2d_survival_+3A_x">x</code></td>
<td>
<p>an object of class <code>model_profile_2d_survival</code> to be plotted</p>
</td></tr>
<tr><td><code id="plot.model_profile_2d_survival_+3A_...">...</code></td>
<td>
<p>additional objects of class <code>model_profile_2d_survival</code> to be plotted together</p>
</td></tr>
<tr><td><code id="plot.model_profile_2d_survival_+3A_variables">variables</code></td>
<td>
<p>list of character vectors of length 2, names of pairs of variables to be plotted</p>
</td></tr>
<tr><td><code id="plot.model_profile_2d_survival_+3A_times">times</code></td>
<td>
<p>numeric vector, times for which the profile should be plotted, the times must be present in the 'times' field of the explainer. If <code>NULL</code> (default) then the median survival time (if available) or the median time from the explainer object is used.</p>
</td></tr>
<tr><td><code id="plot.model_profile_2d_survival_+3A_marginalize_over_time">marginalize_over_time</code></td>
<td>
<p>logical, if <code>TRUE</code> then the profile is calculated for all times and then averaged over time, if <code>FALSE</code> (default) then the profile is calculated for each time separately</p>
</td></tr>
<tr><td><code id="plot.model_profile_2d_survival_+3A_facet_ncol">facet_ncol</code></td>
<td>
<p>number of columns for arranging subplots</p>
</td></tr>
<tr><td><code id="plot.model_profile_2d_survival_+3A_title">title</code></td>
<td>
<p>character, title of the plot. <code>'default'</code> automatically generates either &quot;2D partial dependence survival profiles&quot; or &quot;2D accumulated local effects survival profiles&quot; depending on the explanation type.</p>
</td></tr>
<tr><td><code id="plot.model_profile_2d_survival_+3A_subtitle">subtitle</code></td>
<td>
<p>character, subtitle of the plot, <code>'default'</code> automatically generates &quot;created for the XXX model&quot;, where XXX is the explainer labels, if <code>marginalize_over_time = FALSE</code>, time is also added to the subtitle</p>
</td></tr>
<tr><td><code id="plot.model_profile_2d_survival_+3A_colors">colors</code></td>
<td>
<p>character vector containing the colors to be used for plotting variables (containing either hex codes &quot;#FF69B4&quot;, or names &quot;blue&quot;)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A collection of <code>ggplot</code> objects arranged with the <code>patchwork</code> package.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
library(survex)

cph &lt;- coxph(Surv(time, status) ~ ., data = veteran, model = TRUE, x = TRUE, y = TRUE)
cph_exp &lt;- explain(cph)

cph_model_profile_2d &lt;- model_profile_2d(cph_exp,
    variables = list(
        c("age", "celltype"),
        c("age", "karno")
    )
)
head(cph_model_profile_2d$result)
plot(cph_model_profile_2d, variables = list(c("age", "celltype")), times = cph_exp$times[20])

cph_model_profile_2d_ale &lt;- model_profile_2d(cph_exp,
    variables = list(c("age", "karno")),
    type = "accumulated"
)
head(cph_model_profile_2d_ale$result)
plot(cph_model_profile_2d_ale, times = cph_exp$times[c(10, 20)], marginalize_over_time = TRUE)


</code></pre>

<hr>
<h2 id='plot.model_profile_survival'>Plot Model Profile for Survival Models</h2><span id='topic+plot.model_profile_survival'></span>

<h3>Description</h3>

<p>This function plots objects of class <code>"model_profile_survival"</code> created
using the <code>model_profile()</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'model_profile_survival'
plot(
  x,
  ...,
  geom = "time",
  variables = NULL,
  variable_type = NULL,
  facet_ncol = NULL,
  numerical_plot_type = "lines",
  times = NULL,
  marginalize_over_time = FALSE,
  plot_type = NULL,
  title = "default",
  subtitle = "default",
  colors = NULL,
  rug = "all",
  rug_colors = c("#dd0000", "#222222")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.model_profile_survival_+3A_x">x</code></td>
<td>
<p>an object of class <code>model_profile_survival</code> to be plotted</p>
</td></tr>
<tr><td><code id="plot.model_profile_survival_+3A_...">...</code></td>
<td>
<p>additional objects of class <code>model_profile_survival</code> to be plotted together. Only available for <code>geom = "time"</code>.</p>
</td></tr>
<tr><td><code id="plot.model_profile_survival_+3A_geom">geom</code></td>
<td>
<p>character, either <code>"time"</code> or <code>"variable"</code>. Selects the type of plot to be prepared. If <code>"time"</code> then the x-axis represents survival times, and variable is denoted by colors, if <code>"variable"</code> then the x-axis represents the variable values, and y-axis represents the predictions at selected time points.</p>
</td></tr>
<tr><td><code id="plot.model_profile_survival_+3A_variables">variables</code></td>
<td>
<p>character, names of the variables to be plotted. When <code>geom = "variable"</code> it needs to be a name of a single variable, when <code>geom = "time"</code> it can be a vector of variable names. If <code>NULL</code> (default) then first variable (for <code>geom = "variable"</code>) or all variables (for <code>geom = "time"</code>) are plotted.</p>
</td></tr>
<tr><td><code id="plot.model_profile_survival_+3A_variable_type">variable_type</code></td>
<td>
<p>character, either <code>"numerical"</code>, <code>"categorical"</code> or <code>NULL</code> (default), select only one type of variable for plotting, or leave <code>NULL</code> for all. Only used when <code>geom = "time"</code>.</p>
</td></tr>
<tr><td><code id="plot.model_profile_survival_+3A_facet_ncol">facet_ncol</code></td>
<td>
<p>number of columns for arranging subplots. Only used when <code>geom = "time"</code>.</p>
</td></tr>
<tr><td><code id="plot.model_profile_survival_+3A_numerical_plot_type">numerical_plot_type</code></td>
<td>
<p>character, either <code>"lines"</code>, or <code>"contours"</code> selects the type of numerical variable plots. Only used when <code>geom = "time"</code>.</p>
</td></tr>
<tr><td><code id="plot.model_profile_survival_+3A_times">times</code></td>
<td>
<p>numeric vector, times for which the profile should be plotted, the times must be present in the 'times' field of the explainer. If <code>NULL</code> (default) then the median survival time (if available) or the median time from the explainer object is used. Only used when <code>geom = "variable"</code> and <code>marginalize_over_time = FALSE</code>.</p>
</td></tr>
<tr><td><code id="plot.model_profile_survival_+3A_marginalize_over_time">marginalize_over_time</code></td>
<td>
<p>logical, if <code>TRUE</code> then the profile is calculated for all times and then averaged over time, if <code>FALSE</code> (default) then the profile is calculated for each time separately. Only used when <code>geom = "variable"</code>.</p>
</td></tr>
<tr><td><code id="plot.model_profile_survival_+3A_plot_type">plot_type</code></td>
<td>
<p>character, one of <code>"pdp"</code>, <code>"ice"</code>, <code>"pdp+ice"</code>, or <code>NULL</code> (default). If <code>NULL</code> then the type of plot is chosen automatically based on the number of variables to be plotted. Only used when <code>geom = "variable"</code>.</p>
</td></tr>
<tr><td><code id="plot.model_profile_survival_+3A_title">title</code></td>
<td>
<p>character, title of the plot</p>
</td></tr>
<tr><td><code id="plot.model_profile_survival_+3A_subtitle">subtitle</code></td>
<td>
<p>character, subtitle of the plot, <code>"default"</code> automatically generates &quot;created for XXX, YYY models&quot;, where XXX and YYY are the explainer labels</p>
</td></tr>
<tr><td><code id="plot.model_profile_survival_+3A_colors">colors</code></td>
<td>
<p>character vector containing the colors to be used for plotting variables (containing either hex codes &quot;#FF69B4&quot;, or names &quot;blue&quot;).</p>
</td></tr>
<tr><td><code id="plot.model_profile_survival_+3A_rug">rug</code></td>
<td>
<p>character, one of <code>"all"</code>, <code>"events"</code>, <code>"censors"</code>, <code>"none"</code> or <code>NULL</code>. Which times to mark on the x axis in <code>geom_rug()</code>. Only used when <code>geom = "time"</code>.</p>
</td></tr>
<tr><td><code id="plot.model_profile_survival_+3A_rug_colors">rug_colors</code></td>
<td>
<p>character vector containing two colors (containing either hex codes &quot;#FF69B4&quot;, or names &quot;blue&quot;). The first color (red by default) will be used to mark event times, whereas the second (grey by default) will be used to mark censor times.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A collection of <code>ggplot</code> objects arranged with the <code>patchwork</code> package.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
library(survex)

model &lt;- randomForestSRC::rfsrc(Surv(time, status) ~ ., data = veteran)
exp &lt;- explain(model)

m_prof &lt;- model_profile(exp, categorical_variables = "trt")

plot(m_prof)

plot(m_prof, numerical_plot_type = "contours")

plot(m_prof, variables = c("trt", "age"), facet_ncol = 1)

plot(m_prof, geom = "variable", variables = "karno", plot_type = "pdp+ice")

plot(m_prof, geom = "variable", times = exp$times[c(5, 10)],
     variables = "karno", plot_type = "pdp+ice")

plot(m_prof, geom = "variable", times = exp$times[c(5, 10)],
     variables = "trt", plot_type = "pdp+ice")


</code></pre>

<hr>
<h2 id='plot.predict_parts_survival'>Plot Predict Parts for Survival Models</h2><span id='topic+plot.predict_parts_survival'></span>

<h3>Description</h3>

<p>This function plots objects of class <code>"predict_parts_survival"</code> - local explanations
for survival models created using the <code>predict_parts()</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'predict_parts_survival'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.predict_parts_survival_+3A_x">x</code></td>
<td>
<p>an object of class  <code>"predict_parts_survival"</code> to be plotted</p>
</td></tr>
<tr><td><code id="plot.predict_parts_survival_+3A_...">...</code></td>
<td>
<p>additional parameters passed to the <code>plot.surv_shap</code> or <code>plot.surv_lime</code> functions</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of the class <code>ggplot</code>.
</p>


<h3>Plot options</h3>



<h4><code>plot.surv_shap</code></h4>


<ul>
<li> <p><code>x</code> - an object of class <code>"surv_shap"</code> to be plotted
</p>
</li>
<li> <p><code>...</code> - additional objects of class <code>surv_shap</code> to be plotted together
</p>
</li>
<li> <p><code>title</code> - character, title of the plot
</p>
</li>
<li> <p><code>subtitle</code> - character, subtitle of the plot, <code>'default'</code> automatically generates &quot;created for XXX, YYY models&quot;, where XXX and YYY are the explainer labels
</p>
</li>
<li> <p><code>max_vars</code> - maximum number of variables to be plotted (least important variables are ignored)
</p>
</li>
<li> <p><code>colors</code> - character vector containing the colors to be used for plotting variables (containing either hex codes &quot;#FF69B4&quot;, or names &quot;blue&quot;)
</p>
</li>
<li> <p><code>rug</code> - character, one of <code>"all"</code>, <code>"events"</code>, <code>"censors"</code>, <code>"none"</code> or <code>NULL</code>. Which times to mark on the x axis in <code>geom_rug()</code>.
</p>
</li>
<li> <p><code>rug_colors</code> - character vector containing two colors (containing either hex codes &quot;#FF69B4&quot;, or names &quot;blue&quot;). The first color (red by default) will be used to mark event times, whereas the second (grey by default) will be used to mark censor times.
</p>
</li></ul>




<h4><code>plot.surv_lime</code></h4>


<ul>
<li> <p><code>x</code> -  an object of class <code>"surv_lime"</code> to be plotted
</p>
</li>
<li> <p><code>type</code> -  character, either &quot;coefficients&quot; or &quot;local_importance&quot;, selects the type of plot
</p>
</li>
<li> <p><code>show_survival_function</code> -  logical, if the survival function of the explanations should be plotted next to the barplot
</p>
</li>
<li> <p><code>...</code> -  other parameters currently ignored
</p>
</li>
<li> <p><code>title</code> -  character, title of the plot
</p>
</li>
<li> <p><code>subtitle</code> -  character, subtitle of the plot, <code>'default'</code> automatically generates &quot;created for XXX, YYY models&quot;, where XXX and YYY are the explainer labels
</p>
</li>
<li> <p><code>max_vars</code> - maximum number of variables to be plotted (least important variables are ignored)
</p>
</li>
<li> <p><code>colors</code> -  character vector containing the colors to be used for plotting variables (containing either hex codes &quot;#FF69B4&quot;, or names &quot;blue&quot;)
</p>
</li></ul>




<h3>See Also</h3>

<p>Other functions for plotting 'predict_parts_survival' objects: 
<code><a href="#topic+plot.surv_lime">plot.surv_lime</a>()</code>,
<code><a href="#topic+plot.surv_shap">plot.surv_shap</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
library(survex)

model &lt;- randomForestSRC::rfsrc(Surv(time, status) ~ ., data = veteran)
exp &lt;- explain(model)

p_parts_shap &lt;- predict_parts(exp, veteran[1, -c(3, 4)], type = "survshap")
plot(p_parts_shap)

p_parts_lime &lt;- predict_parts(exp, veteran[1, -c(3, 4)], type = "survlime")
plot(p_parts_lime)

</code></pre>

<hr>
<h2 id='plot.predict_profile_survival'>Plot Predict Profile for Survival Models</h2><span id='topic+plot.predict_profile_survival'></span>

<h3>Description</h3>

<p>This function plots objects of class <code>"predict_profile_survival"</code> created using
the <code>predict_profile()</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'predict_profile_survival'
plot(
  x,
  ...,
  geom = "time",
  variables = NULL,
  variable_type = NULL,
  facet_ncol = NULL,
  numerical_plot_type = "lines",
  times = NULL,
  marginalize_over_time = FALSE,
  title = "default",
  subtitle = "default",
  colors = NULL,
  rug = "all",
  rug_colors = c("#dd0000", "#222222")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.predict_profile_survival_+3A_x">x</code></td>
<td>
<p>an object of class <code>predict_profile_survival</code> to be plotted</p>
</td></tr>
<tr><td><code id="plot.predict_profile_survival_+3A_...">...</code></td>
<td>
<p>additional objects of class <code>"predict_profile_survival"</code> to be plotted together. Only available for <code>geom = "time"</code>.</p>
</td></tr>
<tr><td><code id="plot.predict_profile_survival_+3A_geom">geom</code></td>
<td>
<p>character, either <code>"time"</code> or <code>"variable"</code>. Selects the type of plot to be prepared. If <code>"time"</code> then the x-axis represents survival times, and variable is denoted by colors, if <code>"variable"</code> then the x-axis represents the variable values, and y-axis represents the predictions at selected time points.</p>
</td></tr>
<tr><td><code id="plot.predict_profile_survival_+3A_variables">variables</code></td>
<td>
<p>character, names of the variables to be plotted. When <code>geom = "variable"</code> it needs to be a name of a single variable, when <code>geom = "time"</code> it can be a vector of variable names. If <code>NULL</code> (default) then first variable (for <code>geom = "variable"</code>) or all variables (for <code>geom = "time"</code>) are plotted.</p>
</td></tr>
<tr><td><code id="plot.predict_profile_survival_+3A_variable_type">variable_type</code></td>
<td>
<p>character, either <code>"numerical"</code>, <code>"categorical"</code> or <code>NULL</code> (default), select only one type of variable for plotting, or leave <code>NULL</code> for all.  Only used when <code>geom = "time"</code>.</p>
</td></tr>
<tr><td><code id="plot.predict_profile_survival_+3A_facet_ncol">facet_ncol</code></td>
<td>
<p>number of columns for arranging subplots.  Only used when <code>geom = "time"</code>.</p>
</td></tr>
<tr><td><code id="plot.predict_profile_survival_+3A_numerical_plot_type">numerical_plot_type</code></td>
<td>
<p>character, either <code>"lines"</code>, or <code>"contours"</code> selects the type of numerical variable plots.  Only used when <code>geom = "time"</code>.</p>
</td></tr>
<tr><td><code id="plot.predict_profile_survival_+3A_times">times</code></td>
<td>
<p>numeric vector, times for which the profile should be plotted, the times must be present in the 'times' field of the explainer. If <code>NULL</code> (default) then the median survival time (if available) or the median time from the explainer object is used. Only used when <code>geom = "variable"</code> and <code>marginalize_over_time = FALSE</code>.</p>
</td></tr>
<tr><td><code id="plot.predict_profile_survival_+3A_marginalize_over_time">marginalize_over_time</code></td>
<td>
<p>logical, if <code>TRUE</code> then the profile is calculated for all times and then averaged over time, if <code>FALSE</code> (default) then the profile is calculated for each time separately. Only used when <code>geom = "variable"</code>.</p>
</td></tr>
<tr><td><code id="plot.predict_profile_survival_+3A_title">title</code></td>
<td>
<p>character, title of the plot</p>
</td></tr>
<tr><td><code id="plot.predict_profile_survival_+3A_subtitle">subtitle</code></td>
<td>
<p>character, subtitle of the plot, <code>'default'</code> automatically generates &quot;created for XXX, YYY models&quot;, where XXX and YYY are the explainer labels</p>
</td></tr>
<tr><td><code id="plot.predict_profile_survival_+3A_colors">colors</code></td>
<td>
<p>character vector containing the colors to be used for plotting variables (containing either hex codes &quot;#FF69B4&quot;, or names &quot;blue&quot;)</p>
</td></tr>
<tr><td><code id="plot.predict_profile_survival_+3A_rug">rug</code></td>
<td>
<p>character, one of <code>"all"</code>, <code>"events"</code>, <code>"censors"</code>, <code>"none"</code> or <code>NULL</code>. Which times to mark on the x axis in <code>geom_rug()</code>.</p>
</td></tr>
<tr><td><code id="plot.predict_profile_survival_+3A_rug_colors">rug_colors</code></td>
<td>
<p>character vector containing two colors (containing either hex codes <code>"#FF69B4"</code>, or names <code>"blue"</code>). The first color (red by default) will be used to mark event times, whereas the second (grey by default) will be used to mark censor times.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A collection of <code>ggplot</code> objects arranged with the <code>patchwork</code> package.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
library(survex)

model &lt;- randomForestSRC::rfsrc(Surv(time, status) ~ ., data = veteran)
exp &lt;- explain(model)

p_profile &lt;- predict_profile(exp, veteran[1, -c(3, 4)])

plot(p_profile)

p_profile_with_cat &lt;- predict_profile(
    exp,
    veteran[1, -c(3, 4)],
    categorical_variables = c("trt", "prior")
)

plot(p_profile_with_cat)


</code></pre>

<hr>
<h2 id='plot.surv_feature_importance'>Plot Permutational Feature Importance for Survival Models</h2><span id='topic+plot.surv_feature_importance'></span>

<h3>Description</h3>

<p>This function plots feature importance objects created for survival models using the
<code>model_parts()</code> function with a time-dependent metric, that is <code>loss_one_minus_cd_auc()</code> or
<code>loss_brier_score()</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'surv_feature_importance'
plot(
  x,
  ...,
  title = "Time-dependent feature importance",
  subtitle = "default",
  max_vars = 7,
  colors = NULL,
  rug = "all",
  rug_colors = c("#dd0000", "#222222")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.surv_feature_importance_+3A_x">x</code></td>
<td>
<p>an object of class <code>"surv_feature_importance"</code> to be plotted</p>
</td></tr>
<tr><td><code id="plot.surv_feature_importance_+3A_...">...</code></td>
<td>
<p>additional objects of class <code>"surv_feature_importance"</code> to be plotted together</p>
</td></tr>
<tr><td><code id="plot.surv_feature_importance_+3A_title">title</code></td>
<td>
<p>character, title of the plot</p>
</td></tr>
<tr><td><code id="plot.surv_feature_importance_+3A_subtitle">subtitle</code></td>
<td>
<p>character, subtitle of the plot, <code>'default'</code> automatically generates &quot;created for XXX, YYY models&quot;, where XXX and YYY are the explainer labels</p>
</td></tr>
<tr><td><code id="plot.surv_feature_importance_+3A_max_vars">max_vars</code></td>
<td>
<p>maximum number of variables to be plotted (least important variables are ignored)</p>
</td></tr>
<tr><td><code id="plot.surv_feature_importance_+3A_colors">colors</code></td>
<td>
<p>character vector containing the colors to be used for plotting variables (containing either hex codes &quot;#FF69B4&quot;, or names &quot;blue&quot;)</p>
</td></tr>
<tr><td><code id="plot.surv_feature_importance_+3A_rug">rug</code></td>
<td>
<p>character, one of <code>"all"</code>, <code>"events"</code>, <code>"censors"</code>, <code>"none"</code> or <code>NULL</code>. Which times to mark on the x axis in <code>geom_rug()</code>.</p>
</td></tr>
<tr><td><code id="plot.surv_feature_importance_+3A_rug_colors">rug_colors</code></td>
<td>
<p>character vector containing two colors (containing either hex codes &quot;#FF69B4&quot;, or names &quot;blue&quot;). The first color (red by default) will be used to mark event times, whereas the second (grey by default) will be used to mark censor times.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of the class <code>ggplot</code>.
</p>


<h3>See Also</h3>

<p>Other functions for plotting 'model_parts_survival' objects: 
<code><a href="#topic+plot.model_parts_survival">plot.model_parts_survival</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
library(survex)

model &lt;- coxph(Surv(time, status) ~ ., data = veteran, x = TRUE, model = TRUE, y = TRUE)
model_rf &lt;- randomForestSRC::rfsrc(Surv(time, status) ~ ., data = veteran)
explainer &lt;- explain(model)
explainer_rf &lt;- explain(model_rf)

mp &lt;- model_parts(explainer)
mp_rf &lt;- model_parts(explainer_rf)

plot(mp, mp_rf)


</code></pre>

<hr>
<h2 id='plot.surv_lime'>Plot SurvLIME Explanations for Survival Models</h2><span id='topic+plot.surv_lime'></span>

<h3>Description</h3>

<p>This functions plots objects of class <code>surv_lime</code> - LIME explanations of survival models
created using <code>predict_parts(..., type="survlime")</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'surv_lime'
plot(
  x,
  type = "local_importance",
  show_survival_function = TRUE,
  ...,
  title = "SurvLIME",
  subtitle = "default",
  max_vars = 7,
  colors = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.surv_lime_+3A_x">x</code></td>
<td>
<p>an object of class <code>"surv_lime"</code> to be plotted</p>
</td></tr>
<tr><td><code id="plot.surv_lime_+3A_type">type</code></td>
<td>
<p>character, either &quot;coefficients&quot; or &quot;local_importance&quot; (default), selects the type of plot</p>
</td></tr>
<tr><td><code id="plot.surv_lime_+3A_show_survival_function">show_survival_function</code></td>
<td>
<p>logical, if the survival function of the explanations should be plotted next to the barplot</p>
</td></tr>
<tr><td><code id="plot.surv_lime_+3A_...">...</code></td>
<td>
<p>other parameters currently ignored</p>
</td></tr>
<tr><td><code id="plot.surv_lime_+3A_title">title</code></td>
<td>
<p>character, title of the plot</p>
</td></tr>
<tr><td><code id="plot.surv_lime_+3A_subtitle">subtitle</code></td>
<td>
<p>character, subtitle of the plot, <code>'default'</code> automatically generates &quot;created for XXX, YYY models&quot;, where XXX and YYY are the explainer labels</p>
</td></tr>
<tr><td><code id="plot.surv_lime_+3A_max_vars">max_vars</code></td>
<td>
<p>maximum number of variables to be plotted (least important variables are ignored)</p>
</td></tr>
<tr><td><code id="plot.surv_lime_+3A_colors">colors</code></td>
<td>
<p>character vector containing the colors to be used for plotting variables (containing either hex codes &quot;#FF69B4&quot;, or names &quot;blue&quot;)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of the class <code>ggplot</code>.
</p>


<h3>See Also</h3>

<p>Other functions for plotting 'predict_parts_survival' objects: 
<code><a href="#topic+plot.predict_parts_survival">plot.predict_parts_survival</a>()</code>,
<code><a href="#topic+plot.surv_shap">plot.surv_shap</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
library(survex)

model &lt;- randomForestSRC::rfsrc(Surv(time, status) ~ ., data = veteran)
exp &lt;- explain(model)

p_parts_lime &lt;- predict_parts(exp, veteran[1, -c(3, 4)], type = "survlime")
plot(p_parts_lime)

</code></pre>

<hr>
<h2 id='plot.surv_model_performance'>Plot Model Performance Metrics for Survival Models</h2><span id='topic+plot.surv_model_performance'></span>

<h3>Description</h3>

<p>This function plots objects of class <code>"surv_model_performance"</code> - visualization of
metrics of different models created using the <code>model_performance(..., type="metrics")</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'surv_model_performance'
plot(
  x,
  ...,
  metrics = NULL,
  metrics_type = "time_dependent",
  title = "Model performance",
  subtitle = "default",
  facet_ncol = NULL,
  colors = NULL,
  rug = "all",
  rug_colors = c("#dd0000", "#222222")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.surv_model_performance_+3A_x">x</code></td>
<td>
<p>an object of class <code>"surv_model_performance"</code> to be plotted</p>
</td></tr>
<tr><td><code id="plot.surv_model_performance_+3A_...">...</code></td>
<td>
<p>additional objects of class <code>"surv_model_performance"</code> to be plotted together</p>
</td></tr>
<tr><td><code id="plot.surv_model_performance_+3A_metrics">metrics</code></td>
<td>
<p>character, names of metrics to be plotted (subset of C/D AUC&quot;, &quot;Brier score&quot; for <code>metrics_type %in% c("time_dependent", "functional")</code> or subset of &quot;C-index&quot;,&quot;Integrated Brier score&quot;, &quot;Integrated C/D AUC&quot; for <code>metrics_type == "scalar"</code>), by default (<code>NULL</code>) all metrics of a given type are plotted</p>
</td></tr>
<tr><td><code id="plot.surv_model_performance_+3A_metrics_type">metrics_type</code></td>
<td>
<p>character, either one of <code>c("time_dependent","functional")</code> for functional metrics or <code>"scalar"</code> for scalar metrics</p>
</td></tr>
<tr><td><code id="plot.surv_model_performance_+3A_title">title</code></td>
<td>
<p>character, title of the plot</p>
</td></tr>
<tr><td><code id="plot.surv_model_performance_+3A_subtitle">subtitle</code></td>
<td>
<p>character, subtitle of the plot, <code>'default'</code> automatically generates &quot;created for XXX, YYY models&quot;, where XXX and YYY are the explainer labels</p>
</td></tr>
<tr><td><code id="plot.surv_model_performance_+3A_facet_ncol">facet_ncol</code></td>
<td>
<p>number of columns for arranging subplots</p>
</td></tr>
<tr><td><code id="plot.surv_model_performance_+3A_colors">colors</code></td>
<td>
<p>character vector containing the colors to be used for plotting variables (containing either hex codes &quot;#FF69B4&quot;, or names &quot;blue&quot;)</p>
</td></tr>
<tr><td><code id="plot.surv_model_performance_+3A_rug">rug</code></td>
<td>
<p>character, one of <code>"all"</code>, <code>"events"</code>, <code>"censors"</code>, <code>"none"</code> or <code>NULL</code>. Which times to mark on the x axis in <code>geom_rug()</code>.</p>
</td></tr>
<tr><td><code id="plot.surv_model_performance_+3A_rug_colors">rug_colors</code></td>
<td>
<p>character vector containing two colors (containing either hex codes &quot;#FF69B4&quot;, or names &quot;blue&quot;). The first color (red by default) will be used to mark event times, whereas the second (grey by default) will be used to mark censor times.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of the class <code>ggplot</code>.
</p>


<h3>See Also</h3>

<p>Other functions for plotting 'model_performance_survival' objects: 
<code><a href="#topic+plot.model_performance_survival">plot.model_performance_survival</a>()</code>,
<code><a href="#topic+plot.surv_model_performance_rocs">plot.surv_model_performance_rocs</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(survival)
library(survex)


model &lt;- randomForestSRC::rfsrc(Surv(time, status) ~ ., data = veteran)
exp &lt;- explain(model)

m_perf &lt;- model_performance(exp)
plot(m_perf)

</code></pre>

<hr>
<h2 id='plot.surv_model_performance_rocs'>Plot ROC Curves for Survival Models</h2><span id='topic+plot.surv_model_performance_rocs'></span>

<h3>Description</h3>

<p>This function plots objects of class <code>"surv_model_performance_rocs"</code> - ROC curves for
specific time points for survival models created using the <code>model_performance(..., type="roc")</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'surv_model_performance_rocs'
plot(
  x,
  ...,
  title = "ROC curves for selected time points",
  subtitle = "default",
  auc = TRUE,
  colors = NULL,
  facet_ncol = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.surv_model_performance_rocs_+3A_x">x</code></td>
<td>
<p>an object of class <code>"surv_model_performance_rocs"</code> to be plotted</p>
</td></tr>
<tr><td><code id="plot.surv_model_performance_rocs_+3A_...">...</code></td>
<td>
<p>additional objects of class <code>"surv_model_performance_rocs"</code> to be plotted together</p>
</td></tr>
<tr><td><code id="plot.surv_model_performance_rocs_+3A_title">title</code></td>
<td>
<p>character, title of the plot</p>
</td></tr>
<tr><td><code id="plot.surv_model_performance_rocs_+3A_subtitle">subtitle</code></td>
<td>
<p>character, subtitle of the plot, <code>'default'</code> automatically generates &quot;created for XXX, YYY models&quot;, where XXX and YYY are the explainer labels</p>
</td></tr>
<tr><td><code id="plot.surv_model_performance_rocs_+3A_auc">auc</code></td>
<td>
<p>boolean, whether the AUC values should be plotted</p>
</td></tr>
<tr><td><code id="plot.surv_model_performance_rocs_+3A_colors">colors</code></td>
<td>
<p>character vector containing the colors to be used for plotting variables (containing either hex codes &quot;#FF69B4&quot;, or names &quot;blue&quot;)</p>
</td></tr>
<tr><td><code id="plot.surv_model_performance_rocs_+3A_facet_ncol">facet_ncol</code></td>
<td>
<p>number of columns for arranging subplots</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of the class <code>ggplot</code>.
</p>


<h3>See Also</h3>

<p>Other functions for plotting 'model_performance_survival' objects: 
<code><a href="#topic+plot.model_performance_survival">plot.model_performance_survival</a>()</code>,
<code><a href="#topic+plot.surv_model_performance">plot.surv_model_performance</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
library(survex)

model &lt;- randomForestSRC::rfsrc(Surv(time, status) ~ ., data = veteran)
exp &lt;- explain(model)

m_perf_roc &lt;- model_performance(exp, type = "roc", times = c(100, 300))
plot(m_perf_roc)

</code></pre>

<hr>
<h2 id='plot.surv_shap'>Plot SurvSHAP(t) Explanations for Survival Models</h2><span id='topic+plot.surv_shap'></span>

<h3>Description</h3>

<p>This functions plots objects of class <code>surv_shap</code> - time-dependent explanations of
survival models created using the <code>predict_parts(..., type="survshap")</code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'surv_shap'
plot(
  x,
  ...,
  title = "SurvSHAP(t)",
  subtitle = "default",
  max_vars = 7,
  colors = NULL,
  rug = "all",
  rug_colors = c("#dd0000", "#222222")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.surv_shap_+3A_x">x</code></td>
<td>
<p>an object of class <code>surv_shap</code> to be plotted</p>
</td></tr>
<tr><td><code id="plot.surv_shap_+3A_...">...</code></td>
<td>
<p>additional objects of class <code>surv_shap</code> to be plotted together</p>
</td></tr>
<tr><td><code id="plot.surv_shap_+3A_title">title</code></td>
<td>
<p>character, title of the plot</p>
</td></tr>
<tr><td><code id="plot.surv_shap_+3A_subtitle">subtitle</code></td>
<td>
<p>character, subtitle of the plot, <code>'default'</code> automatically generates &quot;created for XXX, YYY models&quot;, where XXX and YYY are the explainer labels</p>
</td></tr>
<tr><td><code id="plot.surv_shap_+3A_max_vars">max_vars</code></td>
<td>
<p>maximum number of variables to be plotted (least important variables are ignored)</p>
</td></tr>
<tr><td><code id="plot.surv_shap_+3A_colors">colors</code></td>
<td>
<p>character vector containing the colors to be used for plotting variables (containing either hex codes &quot;#FF69B4&quot;, or names &quot;blue&quot;)</p>
</td></tr>
<tr><td><code id="plot.surv_shap_+3A_rug">rug</code></td>
<td>
<p>character, one of <code>"all"</code>, <code>"events"</code>, <code>"censors"</code>, <code>"none"</code> or <code>NULL</code>. Which times to mark on the x axis in <code>geom_rug()</code>.</p>
</td></tr>
<tr><td><code id="plot.surv_shap_+3A_rug_colors">rug_colors</code></td>
<td>
<p>character vector containing two colors (containing either hex codes &quot;#FF69B4&quot;, or names &quot;blue&quot;). The first color (red by default) will be used to mark event times, whereas the second (grey by default) will be used to mark censor times.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of the class <code>ggplot</code>.
</p>


<h3>See Also</h3>

<p>Other functions for plotting 'predict_parts_survival' objects: 
<code><a href="#topic+plot.predict_parts_survival">plot.predict_parts_survival</a>()</code>,
<code><a href="#topic+plot.surv_lime">plot.surv_lime</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
library(survex)

model &lt;- randomForestSRC::rfsrc(Surv(time, status) ~ ., data = veteran)
exp &lt;- explain(model)

p_parts_shap &lt;- predict_parts(exp, veteran[1, -c(3, 4)], type = "survshap")
plot(p_parts_shap)


</code></pre>

<hr>
<h2 id='predict_parts'>Instance Level Parts of Survival Model Predictions</h2><span id='topic+predict_parts'></span><span id='topic+predict_parts.surv_explainer'></span>

<h3>Description</h3>

<p>This function decomposes the model prediction into individual parts, which are attributions of particular variables. The explanations can be made via the SurvLIME and SurvSHAP(t) methods.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predict_parts(explainer, ...)

## S3 method for class 'surv_explainer'
predict_parts(
  explainer,
  new_observation,
  ...,
  N = NULL,
  type = "survshap",
  output_type = "survival",
  explanation_label = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict_parts_+3A_explainer">explainer</code></td>
<td>
<p>an explainer object - model preprocessed by the <code>explain()</code> function</p>
</td></tr>
<tr><td><code id="predict_parts_+3A_...">...</code></td>
<td>
<p>other parameters which are passed to <code>iBreakDown::break_down</code> if <code>output_type=="risk"</code>, or if <code>output_type=="survival"</code> to <code>surv_shap()</code> or <code>surv_lime()</code> functions depending on the selected type</p>
</td></tr>
<tr><td><code id="predict_parts_+3A_new_observation">new_observation</code></td>
<td>
<p>a new observation for which prediction need to be explained</p>
</td></tr>
<tr><td><code id="predict_parts_+3A_n">N</code></td>
<td>
<p>the number of observations used for calculation of attributions. If <code>NULL</code> (default) all explainer data will be used for SurvSHAP(t) and 100 neigbours for SurvLIME.</p>
</td></tr>
<tr><td><code id="predict_parts_+3A_type">type</code></td>
<td>
<p>if <code>output_type == "survival"</code> must be either <code>"survshap"</code> or <code>"survlime"</code>, otherwise refer to the <code>DALEX::predict_parts</code></p>
</td></tr>
<tr><td><code id="predict_parts_+3A_output_type">output_type</code></td>
<td>
<p>either <code>"survival"</code>, <code>"chf"</code> or <code>"risk"</code> the type of survival model output that should be considered for explanations. If <code>"survival"</code> the explanations are based on the survival function. If <code>"chf"</code> the explanations are based on the cumulative hazard function. Otherwise the scalar risk predictions are used by the <code>DALEX::predict_parts</code> function.</p>
</td></tr>
<tr><td><code id="predict_parts_+3A_explanation_label">explanation_label</code></td>
<td>
<p>a label that can overwrite explainer label (useful for multiple explanations for the same explainer/model)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>"predict_parts_survival"</code> and additional classes depending on the type of explanations. It is a list with the element <code>result</code> containing the results of the calculation.
</p>


<h3>Additional parameters</h3>

<p>There are additional parameters that are passed to internal functions
</p>

<ul>
<li><p> for <code>survlime</code>
</p>

<ul>
<li> <p><code>N</code> -  a positive integer, number of observations generated in the neighbourhood
</p>
</li>
<li> <p><code>distance_metric</code> -  character, name of the distance metric to be used, only <code>"euclidean"</code> is implemented
</p>
</li>
<li> <p><code>kernel_width</code> -  a numeric, parameter used for calculating weights, by default it's <code>sqrt(ncol(data)*0.75)</code>
</p>
</li>
<li> <p><code>sampling_method</code> -  character, name of the method of generating neighbourhood, only <code>"gaussian"</code> is implemented
</p>
</li>
<li> <p><code>sample_around_instance</code> -  logical, if the neighbourhood should be generated with the new observation as the center (default), or should the mean of the whole dataset be used as the center
</p>
</li>
<li> <p><code>max_iter</code> -  a numeric, maximal number of iteration for the optimization problem
</p>
</li>
<li> <p><code>categorical_variables</code> -  character vector, names of variables that should be treated as categories (factors are included by default)
</p>
</li>
<li> <p><code>k</code> -  a small positive number &gt; 1, added to chf before taking log, so that weigths aren't negative
</p>
</li></ul>

</li>
<li><p> for <code>survshap</code>
</p>

<ul>
<li> <p><code>y_true</code> -  a two element numeric vector or matrix of one row and two columns, the first element being the true observed time and the second the status of the observation, used for plotting
</p>
</li>
<li> <p><code>calculation_method</code> -  a character, either <code>"kernelshap"</code> for use of <code>kernelshap</code> library (providing faster Kernel SHAP with refinements) or <code>"exact_kernel"</code> for exact Kernel SHAP estimation
</p>
</li>
<li> <p><code>aggregation_method</code> -  a character, either <code>"mean_absolute"</code> or <code>"integral"</code>, <code>"max_absolute"</code>, <code>"sum_of_squares"</code>
</p>
</li></ul>

</li></ul>



<h3>References</h3>


<ul>
<li><p> [1] Krzyziński, Mateusz, et al. <a href="https://www.sciencedirect.com/science/article/pii/S0950705122013302">&quot;SurvSHAP(t): Time-dependent explanations of machine learning survival models.&quot;</a> Knowledge-Based Systems 262 (2023): 110234
</p>
</li>
<li><p> [2] Kovalev, Maxim S., et al. <a href="https://www.sciencedirect.com/science/article/pii/S0950705120304044?casa_token=6e9cyk_ji3AAAAAA:tbqo33MsZvNC9nrSGabZdLfPtZTsvsvZTHYQCM2aEhumLI5D46U7ovhr37EaYUhmKZrw45JzDhg">&quot;SurvLIME: A method for explaining machine learning survival models.&quot;</a> Knowledge-Based Systems 203 (2020): 106164.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
library(survex)

cph &lt;- coxph(Surv(time, status) ~ ., data = veteran, model = TRUE, x = TRUE, y = TRUE)
cph_exp &lt;- explain(cph)

cph_predict_parts_survshap &lt;- predict_parts(cph_exp, new_observation = veteran[1, -c(3, 4)])
head(cph_predict_parts_survshap$result)
plot(cph_predict_parts_survshap)

cph_predict_parts_survlime &lt;- predict_parts(
    cph_exp,
    new_observation = veteran[1, -c(3, 4)],
    type = "survlime"
)
head(cph_predict_parts_survlime$result)
plot(cph_predict_parts_survlime, type = "local_importance")


</code></pre>

<hr>
<h2 id='predict_profile'>Instance Level Profile as Ceteris Paribus for Survival Models</h2><span id='topic+predict_profile'></span><span id='topic+predict_profile.surv_explainer'></span>

<h3>Description</h3>

<p>This function calculates Ceteris Paribus Profiles for a specific observation with the possibility to take the time dimension into account.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predict_profile(
  explainer,
  new_observation,
  variables = NULL,
  categorical_variables = NULL,
  ...,
  type = "ceteris_paribus",
  output_type = "survival",
  variable_splits_type = "uniform",
  center = FALSE
)

## S3 method for class 'surv_explainer'
predict_profile(
  explainer,
  new_observation,
  variables = NULL,
  categorical_variables = NULL,
  ...,
  type = "ceteris_paribus",
  output_type = "survival",
  variable_splits_type = "uniform",
  center = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict_profile_+3A_explainer">explainer</code></td>
<td>
<p>an explainer object - model preprocessed by the <code>explain()</code> function</p>
</td></tr>
<tr><td><code id="predict_profile_+3A_new_observation">new_observation</code></td>
<td>
<p>a new observation for which the prediction need to be explained</p>
</td></tr>
<tr><td><code id="predict_profile_+3A_variables">variables</code></td>
<td>
<p>a character vector containing names of variables to be explained</p>
</td></tr>
<tr><td><code id="predict_profile_+3A_categorical_variables">categorical_variables</code></td>
<td>
<p>a character vector of names of additional variables which should be treated as categorical (factors are automatically treated as categorical variables). If it contains variable names not present in the <code>variables</code> argument, they will be added at the end.</p>
</td></tr>
<tr><td><code id="predict_profile_+3A_...">...</code></td>
<td>
<p>additional parameters passed to <code>DALEX::predict_profile</code> if <code>output_type =="risk"</code></p>
</td></tr>
<tr><td><code id="predict_profile_+3A_type">type</code></td>
<td>
<p>character, only <code>"ceteris_paribus"</code> is implemented</p>
</td></tr>
<tr><td><code id="predict_profile_+3A_output_type">output_type</code></td>
<td>
<p>either <code>"survival"</code>, <code>"chf"</code> or <code>"risk"</code> the type of survival model output that should be considered for explanations. If <code>"survival"</code> the explanations are based on the survival function. If <code>"chf"</code> the explanations are based on the cumulative hazard function. Otherwise the scalar risk predictions are used by the <code>DALEX::predict_profile</code> function.</p>
</td></tr>
<tr><td><code id="predict_profile_+3A_variable_splits_type">variable_splits_type</code></td>
<td>
<p>character, decides how variable grids should be calculated. Use <code>"quantiles"</code> for percentiles or <code>"uniform"</code> (default) to get uniform grid of points.</p>
</td></tr>
<tr><td><code id="predict_profile_+3A_center">center</code></td>
<td>
<p>logical, should profiles be centered around the average prediction</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An object of class <code>c("predict_profile_survival", "surv_ceteris_paribus")</code>. It is a list with the final result in the <code>result</code> element.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survival)
library(survex)

cph &lt;- coxph(Surv(time, status) ~ ., data = veteran, model = TRUE, x = TRUE, y = TRUE)
rsf_src &lt;- randomForestSRC::rfsrc(Surv(time, status) ~ ., data = veteran)

cph_exp &lt;- explain(cph)
rsf_src_exp &lt;- explain(rsf_src)

cph_predict_profile &lt;- predict_profile(cph_exp, veteran[2, -c(3, 4)],
    variables = c("trt", "celltype", "karno", "age"),
    categorical_variables = "trt"
)
plot(cph_predict_profile, facet_ncol = 2)


rsf_predict_profile &lt;- predict_profile(rsf_src_exp, veteran[5, -c(3, 4)], variables = "karno")
plot(cph_predict_profile, numerical_plot_type = "contours")


</code></pre>

<hr>
<h2 id='predict.surv_explainer'>Model Predictions for Survival Models</h2><span id='topic+predict.surv_explainer'></span>

<h3>Description</h3>

<p>This function allows for calculating model prediction in a unified way.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'surv_explainer'
predict(object, newdata = NULL, output_type = "survival", times = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict.surv_explainer_+3A_object">object</code></td>
<td>
<p>an explainer object - model preprocessed by the <code>explain()</code> function</p>
</td></tr>
<tr><td><code id="predict.surv_explainer_+3A_newdata">newdata</code></td>
<td>
<p>data used for the prediction</p>
</td></tr>
<tr><td><code id="predict.surv_explainer_+3A_output_type">output_type</code></td>
<td>
<p>character, either <code>"risk"</code>, <code>"survival"</code> or <code>"chf"</code> depending on the desired output</p>
</td></tr>
<tr><td><code id="predict.surv_explainer_+3A_times">times</code></td>
<td>
<p>a numeric vector of times for the survival and cumulative hazard function predictions to be evaluated at. If <code style="white-space: pre;">&#8288;"output_type == "risk"&#8288;</code> this argument is ignored, if left <code>NULL</code> then it is extracted from <code>object$times</code>.</p>
</td></tr>
<tr><td><code id="predict.surv_explainer_+3A_...">...</code></td>
<td>
<p>other arguments, currently ignored</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector or matrix containing the prediction.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(survival)
library(survex)


cph &lt;- coxph(Surv(time, status) ~ ., data = veteran, model = TRUE, x = TRUE, y = TRUE)
rsf_ranger &lt;- ranger::ranger(Surv(time, status) ~ .,
    data = veteran,
    respect.unordered.factors = TRUE,
    num.trees = 100,
    mtry = 3,
    max.depth = 5
)

cph_exp &lt;- explain(cph)

rsf_ranger_exp &lt;- explain(rsf_ranger,
    data = veteran[, -c(3, 4)],
    y = Surv(veteran$time, veteran$status)
)


predict(cph_exp, veteran[1, ], output_type = "survival")[, 1:10]

predict(cph_exp, veteran[1, ], output_type = "risk")

predict(rsf_ranger_exp, veteran[1, ], output_type = "chf")[, 1:10]

</code></pre>

<hr>
<h2 id='risk_from_chf'>Generate Risk Prediction based on the Survival Function</h2><span id='topic+risk_from_chf'></span>

<h3>Description</h3>

<p>Some models do not come with a ready to use risk prediction. This function allows for its generation based on the cumulative hazard function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>risk_from_chf(predict_cumulative_hazard_function, times)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="risk_from_chf_+3A_predict_cumulative_hazard_function">predict_cumulative_hazard_function</code></td>
<td>
<p>a function of three arguments (<code>model</code>, <code>newdata</code>, <code>times</code>) that allows for making cumulative hazard predictions.</p>
</td></tr>
<tr><td><code id="risk_from_chf_+3A_times">times</code></td>
<td>
<p>a numeric vector of times at which the function should be evaluated.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A function of two arguments (<code>model</code>, <code>newdata</code>) returning a vector of risks.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survex)
library(survival)

rsf_src &lt;- randomForestSRC::rfsrc(Surv(time, status) ~ ., data = veteran)

chf_function &lt;- transform_to_stepfunction(predict,
    type = "chf",
    prediction_element = "chf",
    times_element = "time.interest"
)
risk_function &lt;- risk_from_chf(chf_function, unique(veteran$time))

explainer &lt;- explain(rsf_src,
    predict_cumulative_hazard_function = chf_function,
    predict_function = risk_function
)

</code></pre>

<hr>
<h2 id='set_theme_survex'>Default Theme for survex plots</h2><span id='topic+set_theme_survex'></span><span id='topic+theme_default_survex'></span><span id='topic+theme_vertical_default_survex'></span>

<h3>Description</h3>

<p>Default Theme for survex plots
</p>


<h3>Usage</h3>

<pre><code class='language-R'>set_theme_survex(
  default_theme = "drwhy",
  default_theme_vertical = default_theme
)

theme_default_survex()

theme_vertical_default_survex()
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="set_theme_survex_+3A_default_theme">default_theme</code></td>
<td>
<p>object - string (&quot;drwhy&quot; or &quot;ema&quot;) or an object of ggplot theme class. Will be applied by default by <code>survex</code> to all horizontal plots</p>
</td></tr>
<tr><td><code id="set_theme_survex_+3A_default_theme_vertical">default_theme_vertical</code></td>
<td>
<p>object - string (&quot;drwhy&quot; or &quot;ema&quot;) or an object of ggplot theme class. Will be applied by default by <code>survex</code> to all vertical plots</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list with current default themes
</p>


<h3>Examples</h3>

<pre><code class='language-R'>old &lt;- set_theme_survex("ema")

library(survival)
library(survex)

model &lt;- randomForestSRC::rfsrc(Surv(time, status) ~ ., data = veteran)
exp &lt;- explain(model)

p_parts_lime &lt;- predict_parts(exp, veteran[1, -c(3, 4)], type = "survlime")
old &lt;- set_theme_survex("drwhy")
plot(p_parts_lime)
old &lt;- set_theme_survex(ggplot2::theme_void(), ggplot2::theme_void())
plot(p_parts_lime)


</code></pre>

<hr>
<h2 id='surv_ceteris_paribus'>Helper functions for <code>predict_profile.R</code></h2><span id='topic+surv_ceteris_paribus'></span><span id='topic+surv_ceteris_paribus.surv_explainer'></span>

<h3>Description</h3>

<p>Helper functions for <code>predict_profile.R</code>
</p>
<p>Helper functions for <code>predict_profile.R</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>surv_ceteris_paribus(x, ...)

## S3 method for class 'surv_explainer'
surv_ceteris_paribus(
  x,
  new_observation,
  variables = NULL,
  categorical_variables = NULL,
  variable_splits = NULL,
  grid_points = 101,
  variable_splits_type = "uniform",
  center = FALSE,
  output_type = "survival",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="surv_ceteris_paribus_+3A_x">x</code></td>
<td>
<p>an explainer object - model preprocessed by the <code>explain()</code> function</p>
</td></tr>
<tr><td><code id="surv_ceteris_paribus_+3A_...">...</code></td>
<td>
<p>other parameters, currently ignored</p>
</td></tr>
<tr><td><code id="surv_ceteris_paribus_+3A_new_observation">new_observation</code></td>
<td>
<p>a new observation for which predictions need to be explained</p>
</td></tr>
<tr><td><code id="surv_ceteris_paribus_+3A_variables">variables</code></td>
<td>
<p>character, names of the variables to be included in the calculations</p>
</td></tr>
<tr><td><code id="surv_ceteris_paribus_+3A_categorical_variables">categorical_variables</code></td>
<td>
<p>character vector, names of variables that should be treated as categories (factors are included by default)</p>
</td></tr>
<tr><td><code id="surv_ceteris_paribus_+3A_variable_splits">variable_splits</code></td>
<td>
<p>named list of splits for variables, in most cases created with internal functions. If NULL then it will be calculated based on validation data available in the explainer</p>
</td></tr>
<tr><td><code id="surv_ceteris_paribus_+3A_grid_points">grid_points</code></td>
<td>
<p>maximum number of points for profile calculations. Note that the final number of points may be lower than grid_points. Will be passed to internal function. By default <code>101</code>.</p>
</td></tr>
<tr><td><code id="surv_ceteris_paribus_+3A_variable_splits_type">variable_splits_type</code></td>
<td>
<p>character, decides how variable grids should be calculated. Use <code>"quantiles"</code> for percentiles or <code>"uniform"</code> (default) to get uniform grid of points.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame containing the result of the calculation.
</p>

<hr>
<h2 id='surv_feature_importance'>Helper functions for <code>model_parts.R</code></h2><span id='topic+surv_feature_importance'></span><span id='topic+surv_feature_importance.surv_explainer'></span>

<h3>Description</h3>

<p>This function is used to calculate permutational feature importance using
a time-dependent metric. The result is the change in loss function at each
time point after permuting each selected variable.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>surv_feature_importance(x, ...)

## S3 method for class 'surv_explainer'
surv_feature_importance(
  x,
  loss_function = NULL,
  ...,
  type = c("raw", "ratio", "difference"),
  B = 10,
  variables = NULL,
  variable_groups = NULL,
  N = NULL,
  label = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="surv_feature_importance_+3A_x">x</code></td>
<td>
<p>an explainer object - model preprocessed by the <code>explain()</code> function</p>
</td></tr>
<tr><td><code id="surv_feature_importance_+3A_...">...</code></td>
<td>
<p>other parameters, currently ignored</p>
</td></tr>
<tr><td><code id="surv_feature_importance_+3A_loss_function">loss_function</code></td>
<td>
<p>a function that will be used to assess variable importance, by default <code>loss_brier_score</code> for survival models. The function can be supplied manually but has to have these named parameters (<code>y_true</code>, <code>risk</code>, <code>surv</code>, <code>times</code>), where <code>y_true</code> represents the <code>survival::Surv</code> object with observed times and statuses, <code>risk</code> is the risk score calculated by the model, and <code>surv</code> is the survival function for each observation evaluated at <code>times</code>.</p>
</td></tr>
<tr><td><code id="surv_feature_importance_+3A_type">type</code></td>
<td>
<p>a character vector, if <code>"raw"</code> the results are losses after the permutation, if <code>"ratio"</code> the results are in the form <code>loss/loss_full_model</code> and if <code>"difference"</code> the results are of the form loss - loss_full_model'</p>
</td></tr>
<tr><td><code id="surv_feature_importance_+3A_b">B</code></td>
<td>
<p>numeric, number of permutations to be calculated</p>
</td></tr>
<tr><td><code id="surv_feature_importance_+3A_variables">variables</code></td>
<td>
<p>a character vector, names of variables to be included in the calculation</p>
</td></tr>
<tr><td><code id="surv_feature_importance_+3A_variable_groups">variable_groups</code></td>
<td>
<p>a list of character vectors of names of explanatory variables. For each vector, a single variable importance measure is computed for the joint effect of the variables which names are provided in the vector. By default, <code>variable_groups = NULL</code>, in which case variable importance measures are computed separately for all variables indicated in the <code>variables</code> argument.</p>
</td></tr>
<tr><td><code id="surv_feature_importance_+3A_n">N</code></td>
<td>
<p>numeric, number of observations that are to be sampled from the dataset for the purpose of calculation</p>
</td></tr>
<tr><td><code id="surv_feature_importance_+3A_label">label</code></td>
<td>
<p>label of the model, if provided overrides <code>explainer$label</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p><em>Note</em>: This function can be run within <code>progressr::with_progress()</code> to display a progress bar, as the execution can take long, especially on large datasets.
</p>


<h3>Value</h3>

<p>A data.frame containing results of the calculation.
</p>

<hr>
<h2 id='surv_integrated_feature_importance'>Helper functions for <code>model_parts.R</code></h2><span id='topic+surv_integrated_feature_importance'></span>

<h3>Description</h3>

<p>This function is used to calculate permutational feature importance using
an aggregate (for now only integral) of a time dependent metric. The result is
the combined change in loss function across all time points - a single value.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>surv_integrated_feature_importance(
  x,
  loss_function = DALEX::loss_root_mean_square,
  ...,
  type = c("raw", "ratio", "difference"),
  B = 10,
  variables = NULL,
  variable_groups = NULL,
  N = NULL,
  label = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="surv_integrated_feature_importance_+3A_x">x</code></td>
<td>
<p>an explainer object - model preprocessed by the <code>explain()</code> function</p>
</td></tr>
<tr><td><code id="surv_integrated_feature_importance_+3A_loss_function">loss_function</code></td>
<td>
<p>a function that will be used to assess variable importance, by default <code>loss_brier_score</code> for survival models. The function should take can be supplied manually but has to have these named parameters (<code>y_true</code>, <code>risk</code>, <code>surv</code>, <code>times</code>), where <code>y_true</code> represents the <code>survival::Surv</code> object with observed times and statuses, <code>risk</code> is the risk score calculated by the model, and <code>surv</code> is the survival function for each observation evaluated at <code>times</code></p>
</td></tr>
<tr><td><code id="surv_integrated_feature_importance_+3A_...">...</code></td>
<td>
<p>other parameters, currently ignored</p>
</td></tr>
<tr><td><code id="surv_integrated_feature_importance_+3A_type">type</code></td>
<td>
<p>a character vector, if <code>"raw"</code> the results are losses after the permutation, if <code>"ratio"</code> the results are in the form <code>loss/loss_full_model</code> and if <code>"difference"</code> the results are of the form loss - loss_full_model'</p>
</td></tr>
<tr><td><code id="surv_integrated_feature_importance_+3A_b">B</code></td>
<td>
<p>numeric, number of permutations to be calculated</p>
</td></tr>
<tr><td><code id="surv_integrated_feature_importance_+3A_variables">variables</code></td>
<td>
<p>a character vector, names of variables to be included in the calculation</p>
</td></tr>
<tr><td><code id="surv_integrated_feature_importance_+3A_variable_groups">variable_groups</code></td>
<td>
<p>a list of character vectors of names of explanatory variables. For each vector, a single variable-importance measure is computed for the joint effect of the variables which names are provided in the vector. By default, variable_groups = NULL, in which case variable-importance measures are computed separately for all variables indicated in the variables argument</p>
</td></tr>
<tr><td><code id="surv_integrated_feature_importance_+3A_n">N</code></td>
<td>
<p>numeric, number of observations that are to be sampled from the dataset for the purpose of calculation</p>
</td></tr>
<tr><td><code id="surv_integrated_feature_importance_+3A_label">label</code></td>
<td>
<p>label of the model, if provides overrides x$label</p>
</td></tr>
</table>


<h3>Details</h3>

<p><em>Note</em>: This function can be run within <code>progressr::with_progress()</code> to display a progress bar, as the execution can take long, especially on large datasets.
</p>


<h3>Value</h3>

<p>A data.frame containing results of the calculation.
</p>

<hr>
<h2 id='surv_lime'>Helper functions for <code>predict_parts.R</code></h2><span id='topic+surv_lime'></span>

<h3>Description</h3>

<p>Helper functions for <code>predict_parts.R</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>surv_lime(
  explainer,
  new_observation,
  ...,
  N = 100,
  distance_metric = "euclidean",
  kernel_width = NULL,
  sampling_method = "gaussian",
  sample_around_instance = TRUE,
  max_iter = 10000,
  categorical_variables = NULL,
  k = 1 + 1e-04
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="surv_lime_+3A_explainer">explainer</code></td>
<td>
<p>an explainer object - model preprocessed by the <code>explain()</code> function</p>
</td></tr>
<tr><td><code id="surv_lime_+3A_new_observation">new_observation</code></td>
<td>
<p>a new observation for which predictions need to be explained</p>
</td></tr>
<tr><td><code id="surv_lime_+3A_...">...</code></td>
<td>
<p>additional parameters, passed to internal functions</p>
</td></tr>
<tr><td><code id="surv_lime_+3A_n">N</code></td>
<td>
<p>a positive integer, number of observations generated in the neighbourhood</p>
</td></tr>
<tr><td><code id="surv_lime_+3A_distance_metric">distance_metric</code></td>
<td>
<p>character, name of the distance metric to be used, only <code>"euclidean"</code> is implemented</p>
</td></tr>
<tr><td><code id="surv_lime_+3A_kernel_width">kernel_width</code></td>
<td>
<p>a numeric, parameter used for calculating weights, by default it's <code>sqrt(ncol(data)*0.75)</code></p>
</td></tr>
<tr><td><code id="surv_lime_+3A_sampling_method">sampling_method</code></td>
<td>
<p>character, name of the method of generating neighbourhood, only <code>"gaussian"</code> is implemented</p>
</td></tr>
<tr><td><code id="surv_lime_+3A_sample_around_instance">sample_around_instance</code></td>
<td>
<p>logical, if the neighbourhood should be generated with the new observation as the center (default), or should the mean of the whole dataset be used as the center</p>
</td></tr>
<tr><td><code id="surv_lime_+3A_max_iter">max_iter</code></td>
<td>
<p>a numeric, maximal number of iteration for the optimization problem</p>
</td></tr>
<tr><td><code id="surv_lime_+3A_categorical_variables">categorical_variables</code></td>
<td>
<p>character vector, names of variables that should be treated as categories (factors are included by default)</p>
</td></tr>
<tr><td><code id="surv_lime_+3A_k">k</code></td>
<td>
<p>a small positive number &gt; 1, added to chf before taking log, so that weigths aren't negative</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list, with the SurvLIME result in the <code style="white-space: pre;">&#8288;$result&#8288;</code> field.
</p>


<h3>References</h3>


<ul>
<li><p> [1] Kovalev, Maxim S., et al. <a href="https://www.sciencedirect.com/science/article/pii/S0950705120304044?casa_token=6e9cyk_ji3AAAAAA:tbqo33MsZvNC9nrSGabZdLfPtZTsvsvZTHYQCM2aEhumLI5D46U7ovhr37EaYUhmKZrw45JzDhg">&quot;SurvLIME: A method for explaining machine learning survival models.&quot;</a> Knowledge-Based Systems 203 (2020): 106164.
</p>
</li></ul>


<hr>
<h2 id='surv_model_info'>Extract additional information from the model</h2><span id='topic+surv_model_info'></span><span id='topic+surv_model_info.coxph'></span><span id='topic+surv_model_info.rfsrc'></span><span id='topic+surv_model_info.ranger'></span><span id='topic+surv_model_info.model_fit'></span><span id='topic+surv_model_info.cph'></span><span id='topic+surv_model_info.LearnerSurv'></span><span id='topic+surv_model_info.sksurv'></span><span id='topic+surv_model_info.flexsurvreg'></span><span id='topic+surv_model_info.default'></span>

<h3>Description</h3>

<p>This generic function let user extract base information about model. The function returns a named list of class <code>model_info</code> that
contain information about package of model, version and task type. For wrappers like <code>mlr</code> or <code>parsnip</code> both, package and wrapper
information are stored
</p>


<h3>Usage</h3>

<pre><code class='language-R'>surv_model_info(model, ...)

## S3 method for class 'coxph'
surv_model_info(model, ...)

## S3 method for class 'rfsrc'
surv_model_info(model, ...)

## S3 method for class 'ranger'
surv_model_info(model, ...)

## S3 method for class 'model_fit'
surv_model_info(model, ...)

## S3 method for class 'cph'
surv_model_info(model, ...)

## S3 method for class 'LearnerSurv'
surv_model_info(model, ...)

## S3 method for class 'sksurv'
surv_model_info(model, ...)

## S3 method for class 'flexsurvreg'
surv_model_info(model, ...)

## Default S3 method:
surv_model_info(model, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="surv_model_info_+3A_model">model</code></td>
<td>

<ul>
<li><p> model object
</p>
</li></ul>
</td></tr>
<tr><td><code id="surv_model_info_+3A_...">...</code></td>
<td>

<ul>
<li><p> other arguments
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>Currently supported packages are:
</p>

<ul>
<li><p> class <code>coxph</code> - Cox proportional hazards regression model created with <span class="pkg">survival</span> package
</p>
</li>
<li><p> class <code>model_fit</code> - models created with <span class="pkg">parsnip</span> package
</p>
</li>
<li><p> class <code>ranger</code> - random survival forest models created with <span class="pkg">ranger</span> package
</p>
</li>
<li><p> class <code>rfsrc</code> - random forest models created with <span class="pkg">randomForestSRC</span> package
</p>
</li></ul>



<h3>Value</h3>

<p>A named list of class <code>model_info</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(survival)
library(survex)
cph &lt;- survival::coxph(survival::Surv(time, status) ~ .,
    data = veteran,
    model = TRUE, x = TRUE, y = TRUE
)
surv_model_info(cph)


library(ranger)
rsf_ranger &lt;- ranger::ranger(survival::Surv(time, status) ~ .,
    data = veteran,
    num.trees = 50, mtry = 3, max.depth = 5
)
surv_model_info(rsf_ranger)


</code></pre>

<hr>
<h2 id='surv_model_performance'>Helper functions for <code>model_performance.R</code></h2><span id='topic+surv_model_performance'></span>

<h3>Description</h3>

<p>Helper functions for <code>model_performance.R</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>surv_model_performance(
  explainer,
  ...,
  times = NULL,
  type = "metrics",
  metrics = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="surv_model_performance_+3A_explainer">explainer</code></td>
<td>
<p>an explainer object - model preprocessed by the <code>explain()</code> function</p>
</td></tr>
<tr><td><code id="surv_model_performance_+3A_...">...</code></td>
<td>
<p>other parameters, currently ignored</p>
</td></tr>
<tr><td><code id="surv_model_performance_+3A_times">times</code></td>
<td>
<p>a numeric vector, time points at which ROC curves are calculated if <code>type == "roc"</code> or at which metrics are calculated if <code>type == "metrics"</code>. Note: if <code>type=="roc"</code> this parameter is obligatory</p>
</td></tr>
<tr><td><code id="surv_model_performance_+3A_type">type</code></td>
<td>
<p>character, either <code>"metrics"</code> which calculates performance metrics or <code>"roc"</code> which calculates ROC curves at specific time points</p>
</td></tr>
<tr><td><code id="surv_model_performance_+3A_metrics">metrics</code></td>
<td>
<p>a named vector containing the metrics to be calculated. The values should be standardized loss functions. The functions can be supplied manually but has to have these named parameters (<code>y_true</code>, <code>risk</code>, <code>surv</code>, <code>times</code>), where <code>y_true</code> represents the <code>survival::Surv</code> object with observed times and statuses, <code>risk</code> is the risk score calculated by the model, and <code>surv</code> is the survival function for each observation evaluated at <code>times</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Either a list when <code>type == "metrics"</code> or a data.frame if <code>type == "roc"</code>
</p>

<hr>
<h2 id='surv_shap'>Helper functions for <code>predict_parts.R</code></h2><span id='topic+surv_shap'></span>

<h3>Description</h3>

<p>Helper functions for <code>predict_parts.R</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>surv_shap(
  explainer,
  new_observation,
  output_type,
  ...,
  N = NULL,
  y_true = NULL,
  calculation_method = c("kernelshap", "exact_kernel", "treeshap"),
  aggregation_method = c("integral", "mean_absolute", "max_absolute", "sum_of_squares")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="surv_shap_+3A_explainer">explainer</code></td>
<td>
<p>an explainer object - model preprocessed by the <code>explain()</code> function</p>
</td></tr>
<tr><td><code id="surv_shap_+3A_new_observation">new_observation</code></td>
<td>
<p>new observations for which predictions need to be explained</p>
</td></tr>
<tr><td><code id="surv_shap_+3A_output_type">output_type</code></td>
<td>
<p>a character, either <code>"survival"</code> or <code>"chf"</code>. Determines which type of prediction should be used for explanations.</p>
</td></tr>
<tr><td><code id="surv_shap_+3A_...">...</code></td>
<td>
<p>additional parameters, passed to internal functions</p>
</td></tr>
<tr><td><code id="surv_shap_+3A_n">N</code></td>
<td>
<p>a positive integer, number of observations used as the background data</p>
</td></tr>
<tr><td><code id="surv_shap_+3A_y_true">y_true</code></td>
<td>
<p>a two element numeric vector or matrix of one row and two columns, the first element being the true observed time and the second the status of the observation, used for plotting</p>
</td></tr>
<tr><td><code id="surv_shap_+3A_calculation_method">calculation_method</code></td>
<td>
<p>a character, either <code>"kernelshap"</code> for use of <code>kernelshap</code> library (providing faster Kernel SHAP with refinements), <code>"exact_kernel"</code> for exact Kernel SHAP estimation, or <code>"treeshap"</code> for use of <code>treeshap</code> library (efficient implementation to compute SHAP values for tree-based models).</p>
</td></tr>
<tr><td><code id="surv_shap_+3A_aggregation_method">aggregation_method</code></td>
<td>
<p>a character, either <code>"integral"</code>, <code>"integral_absolute"</code>, <code>"mean_absolute"</code>, <code>"max_absolute"</code>, or <code>"sum_of_squares"</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list, containing the calculated SurvSHAP(t) results in the <code>result</code> field
</p>


<h3>References</h3>


<ul>
<li><p> [1] Krzyziński, Mateusz, et al. <a href="https://www.sciencedirect.com/science/article/pii/S0950705122013302">&quot;SurvSHAP(t): Time-dependent explanations of machine learning survival models.&quot;</a> Knowledge-Based Systems 262 (2023): 110234
</p>
</li></ul>


<hr>
<h2 id='survival_to_cumulative_hazard'>Transform Survival to Cumulative Hazard</h2><span id='topic+survival_to_cumulative_hazard'></span>

<h3>Description</h3>

<p>Helper function to transform between survival function and CHF
</p>


<h3>Usage</h3>

<pre><code class='language-R'>survival_to_cumulative_hazard(survival_functions, epsilon = 0)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="survival_to_cumulative_hazard_+3A_survival_functions">survival_functions</code></td>
<td>
<p>matrix or vector, with each row representing a survival function</p>
</td></tr>
<tr><td><code id="survival_to_cumulative_hazard_+3A_epsilon">epsilon</code></td>
<td>
<p>a positive numeric number to add, so that the logarithm can be taken</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix or vector transformed to the form of a cumulative hazard function.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(survex)

vec &lt;- c(1, 0.9, 0.8, 0.7, 0.6)
matr &lt;- matrix(c(1, 0.9, 0.8, 1, 0.8, 0.6), ncol = 3)

survival_to_cumulative_hazard(vec)

survival_to_cumulative_hazard(matr)

</code></pre>

<hr>
<h2 id='transform_to_stepfunction'>Transform Fixed Point Prediction into a Stepfunction</h2><span id='topic+transform_to_stepfunction'></span>

<h3>Description</h3>

<p>Some models return the survival function or cumulative hazard function prediction at the times of events present in the training data set. This is a convenient utility to allow the prediction to be evaluated at any time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>transform_to_stepfunction(
  predict_function,
  eval_times = NULL,
  ...,
  type = NULL,
  prediction_element = NULL,
  times_element = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="transform_to_stepfunction_+3A_predict_function">predict_function</code></td>
<td>
<p>a function making the prediction based on <code>model</code> and <code>newdata</code> arguments, the <code>...</code> parameter is also passed to this function. It has to return either a numeric vector of the same length as <code>eval_times</code>, a matrix with this number of columns and the same number of rows as <code>nrow(newdata)</code>. It can also return a list, with one of the elements containing such an object.</p>
</td></tr>
<tr><td><code id="transform_to_stepfunction_+3A_eval_times">eval_times</code></td>
<td>
<p>a numeric vector of times, at which the fixed predictions are made. This can be <code>NULL</code>, if <code>predict_function</code> returns a list which contains such a vector.</p>
</td></tr>
<tr><td><code id="transform_to_stepfunction_+3A_...">...</code></td>
<td>
<p>other parameters passed to predict_function</p>
</td></tr>
<tr><td><code id="transform_to_stepfunction_+3A_type">type</code></td>
<td>
<p>the type of function to be returned, either <code>"survival"</code>, <code>"chf"</code> or <code>NULL</code> this chooses the value of the step function before the first prediction time. If <code>"survival"</code> then it is 1, if <code>"chf"</code> then 0, otherwise, it is the value of the prediction for the first time in numerical order.</p>
</td></tr>
<tr><td><code id="transform_to_stepfunction_+3A_prediction_element">prediction_element</code></td>
<td>
<p>if <code>predict_function</code> returns a list with the matrix as one of its elements, this parameter should contain the name of this element</p>
</td></tr>
<tr><td><code id="transform_to_stepfunction_+3A_times_element">times_element</code></td>
<td>
<p>if <code>predict_function</code> returns a list with the matrix as one of its elements, this parameter should contain the name of this element</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The function returns a function with three arguments, (<code>model</code>, <code>newdata</code>, <code>times</code>), ready to supply it to an explainer.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(survex)
library(survival)

rsf_src &lt;- randomForestSRC::rfsrc(Surv(time, status) ~ ., data = veteran)

chf_function &lt;- transform_to_stepfunction(predict,
    type = "chf",
    prediction_element = "chf",
    times_element = "time.interest"
)

explainer &lt;- explain(rsf_src, predict_cumulative_hazard_function = chf_function)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
