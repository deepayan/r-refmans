<!DOCTYPE html><html><head><title>Help for package BHMSMAfMRI</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {BHMSMAfMRI}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#BHMSMA'><p>Bayesian hierarchical multi-subject multiscale analysis (BHMSMA) of functional MRI data or other multiscale data</p></a></li>
<li><a href='#BHMSMAfMRI-package'><p>Bayesian Hierarchical Multi-Subject Multiscale Analysis (BHMSMA) of Functional MRI Data</p></a></li>
<li><a href='#fmridata'><p>A simulated fMRI data for 3 subjects</p></a></li>
<li><a href='#glmcoef'><p>Fit GLM (general linear model) to the fMRI time-series of all voxels within a single 2D brain slice</p></a></li>
<li><a href='#hyperparamest'><p>Obtain estimates of the hyperparameters of the BHMSMA model</p></a></li>
<li><a href='#postglmcoef'><p>Obtain posterior estimate of a 2D GLM coefficients map of a regressor</p></a></li>
<li><a href='#postgroupglmcoef'><p>Obtain posterior group estimate of a 2D GLM coefficients map of a regressor</p></a></li>
<li><a href='#postmixprob'><p>Obtain estimates of the mixture probabilities defining the BHMSMA posterior wavelet coefficients distributions</p></a></li>
<li><a href='#postsamples'><p>Obtain samples from the posterior distribution of a 2D GLM coefficient map.</p></a></li>
<li><a href='#postwaveletcoef'><p>Obtain posterior estimates of the BHMSMA wavelet coefficients</p></a></li>
<li><a href='#readfmridata'><p>Import fMRI data from various fMRI image files</p></a></li>
<li><a href='#substituteWaveletCoef'><p>Substitute 2D wavelet transform coefficients with user-given values</p></a></li>
<li><a href='#waveletcoef'><p>Apply discrete wavelet transform (DWT) to a 2D GLM coefficient map of a regressor</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Bayesian Hierarchical Multi-Subject Multiscale Analysis of
Functional MRI (fMRI) Data</td>
</tr>
<tr>
<td>Version:</td>
<td>2.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-10-01</td>
</tr>
<tr>
<td>Description:</td>
<td>Package BHMSMAfMRI performs Bayesian hierarchical multi-subject multiscale analysis of fMRI data as described in Sanyal &amp; Ferreira (2012) &lt;<a href="https://doi.org/10.1016%2Fj.neuroimage.2012.08.041">doi:10.1016/j.neuroimage.2012.08.041</a>&gt;, or other multiscale data, using wavelet based prior that borrows strength across subjects and provides posterior smoothed images of the effect sizes and samples from the posterior distribution.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Imports:</td>
<td>Rcpp (&ge; 1.0.9), oro.nifti, wavethresh</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp, RcppArmadillo</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, bookdown</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://nilotpalsanyal.github.io/BHMSMAfMRI/">https://nilotpalsanyal.github.io/BHMSMAfMRI/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/nilotpalsanyal/BHMSMAfMRI/issues">https://github.com/nilotpalsanyal/BHMSMAfMRI/issues</a></td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-10-02 04:38:28 UTC; nsanyal</td>
</tr>
<tr>
<td>Author:</td>
<td>Nilotpal Sanyal <a href="https://orcid.org/0000-0003-4814-7602"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Marco A.R. Ferreira [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Nilotpal Sanyal &lt;nilotpal.sanyal@gmail.com&gt;</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-10-02 06:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='BHMSMA'>Bayesian hierarchical multi-subject multiscale analysis (BHMSMA) of functional MRI data or other multiscale data</h2><span id='topic+BHMSMA'></span>

<h3>Description</h3>

<p><code>BHMSMA</code> is the main function that performs BHMSMA (Sanyal &amp; Ferreira, 2012) of fMRI data, or other multiscale data, using wavelet-based prior that borrows strength across subjects and provides posterior smooth estimates of the effect sizes. Specifically, <code>BHMSMA</code> constructs a 2D regression coefficient map (e.g., corresponding to a single brain slice) of a given regressor and returns its posterior smoothed version based on multi-subject or single subject analyses.</p>


<h3>Usage</h3>

<pre><code class='language-R'>BHMSMA(n, grid, data, designmat, k, analysis="multi", 
  truecoef=NULL, wave.family="DaubLeAsymm", filter.number=6, 
  bc="periodic")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="BHMSMA_+3A_n">n</code></td>
<td>
<p>Number of subjects.</p>
</td></tr>
<tr><td><code id="BHMSMA_+3A_grid">grid</code></td>
<td>
<p>The number of voxels in one row (or column) of the brain slice of interest. Must be a power of 2. The total number of voxels is <code>grid^2</code>. The maximum value of <code>grid</code> for this package is 512.</p>
</td></tr>
<tr><td><code id="BHMSMA_+3A_data">data</code></td>
<td>
<p>The data in the form of an array with dimension <code>(n,grid,grid,ntime)</code>, where ntime is the size of the time series for each voxel. The rows (first dimension) must correspond to <code>n</code>.</p>
</td></tr>
<tr><td><code id="BHMSMA_+3A_designmat">designmat</code></td>
<td>
<p>The design matrix used to generate the data. The rows must correspond to <code>n</code>. It should include an intercept column if desired. No intercept column will be added by the function. The GLM fit will include all the columns of <code>designmat</code>.</p>
</td></tr>
<tr><td><code id="BHMSMA_+3A_k">k</code></td>
<td>
<p>Index of the regressor chosen for analysis, consistently with <code>designmat</code>. After fitting GLM, the regression coefficients of this regressor will be considered for the rest of the analysis.</p>
</td></tr>
<tr><td><code id="BHMSMA_+3A_analysis">analysis</code></td>
<td>
<p>&quot;MSA&quot; or &quot;SSA&quot;, depending on whether performing multi-subject analysis or single subject analysis.</p>
</td></tr>
<tr><td><code id="BHMSMA_+3A_truecoef">truecoef</code></td>
<td>
<p>If available, the true GLM coefficients in the form of an array with dimension <code>(n,grid,grid)</code>. NULL by default.</p>
</td></tr>
<tr><td><code id="BHMSMA_+3A_wave.family">wave.family</code></td>
<td>
<p>The family of wavelets to use - &quot;DaubExPhase&quot; or &quot;DaubLeAsymm&quot;. Default is &quot;DaubLeAsymm&quot;.</p>
</td></tr>
<tr><td><code id="BHMSMA_+3A_filter.number">filter.number</code></td>
<td>
<p>The number of vanishing moments of the wavelet. Default is 6.</p>
</td></tr>
<tr><td><code id="BHMSMA_+3A_bc">bc</code></td>
<td>
<p>The boundary condition to use - &quot;periodic&quot; or &quot;symmetric&quot;. Default is &quot;periodic&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The wavelet computations are performed by using the R package <span class="pkg">wavethresh</span>.</p>


<h3>Value</h3>

<p>A list containing the following.
</p>
<table>
<tr><td><code>GLMCoefStandardized</code></td>
<td>
<p>An array of dimension <code>(n,grid,grid)</code>, containing for each subject the standardized GLM coefficients obtained by fitting GLM to the time-series corresponding to the voxels.</p>
</td></tr>
<tr><td><code>GLMCoefSE</code></td>
<td>
<p>An array of dimension <code>(n,grid,grid)</code>, containing for each subject the estimated standard errors of the GLM coefficients.</p>
</td></tr>
<tr><td><code>WaveletCoefficientMatrix</code></td>
<td>
<p>A matrix of dimension <code>(n,grid^2-1)</code>, containing for each subject the wavelet coefficients of all levels stacked together (by the increasing order of resolution level). </p>
</td></tr>
<tr><td><code>hyperparam</code></td>
<td>
<p>A vector containing the estimates of the six hyperparameters.</p>
</td></tr>
<tr><td><code>hyperparamVar</code></td>
<td>
<p>Estimated covariance matrix of the hyperparameters.</p>
</td></tr>
<tr><td><code>posteriorMixProb</code></td>
<td>
<p>A matrix of dimension <code>(n,grid^2-1)</code>, containing the piklj.bar values (see Reference for details).</p>
</td></tr>
<tr><td><code>PostMeanWaveletCoef</code></td>
<td>
<p>A matrix of size <code>(n,grid^2-1)</code>, containing for each subject the posterior mean of the wavelet coefficients of all levels stacked together (by the increasing order of resolution level). </p>
</td></tr>
<tr><td><code>GLMcoefposterior</code></td>
<td>
<p>An array of dimension <code>(n,grid,grid)</code>, containing for each subject the posterior means of the standardized GLM coefficients.</p>
</td></tr>
<tr><td><code>MSE</code></td>
<td>
<p>MSE of the posterior estimates of the GLM coefficients, if the true values of the GLM coefficients are available.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Nilotpal Sanyal, Marco Ferreira
</p>
<p>Maintainer: Nilotpal Sanyal &lt;nilotpal.sanyal@gmail.com&gt;
</p>


<h3>References</h3>

<p>Sanyal, Nilotpal, and Ferreira, Marco A.R. (2012). Bayesian hierarchical multi-subject multiscale analysis of functional MRI data. Neuroimage, 63, 3, 1519-1531.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+readfmridata">readfmridata</a></code>, <code><a href="#topic+glmcoef">glmcoef</a></code>, <code><a href="#topic+waveletcoef">waveletcoef</a></code>, <code><a href="#topic+hyperparamest">hyperparamest</a></code>, <code><a href="#topic+postmixprob">postmixprob</a></code>, <code><a href="#topic+postwaveletcoef">postwaveletcoef</a></code>, <code><a href="#topic+substituteWaveletCoef">substituteWaveletCoef</a></code>, <code><a href="#topic+postglmcoef">postglmcoef</a></code>, <code><a href="wavethresh.html#topic+imwd">imwd</a></code>, <code><a href="wavethresh.html#topic+imwr">imwr</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># BHMSMA multi-subject analysis for simulated (fMRI) 
# data at 4 timepoints over an 8x8 grid (of a brain 
# slice) for 3 subjects
set.seed(1)
n &lt;- 3
grid &lt;- 8
ntime &lt;- 4
data &lt;- array(rnorm(n*grid*grid*ntime),
  dim=c(n,grid,grid,ntime))
designmat &lt;- cbind(c(1,1,1,1),c(1,0,1,0))
k &lt;- 2
analysis &lt;- "multi"
BHMSMAmulti &lt;- BHMSMA(n, grid, data, designmat, 
  k, analysis)

zlim = c(0,max(abs(BHMSMAmulti$GLMCoefStandardized)))
par(mfrow=c(1,2))
image( abs(BHMSMAmulti$GLMCoefStandardized[1,,,k]),
  col=heat.colors(12),zlim=zlim,main="GLM coef map")
image( abs(BHMSMAmulti$GLMcoefposterior[1,,]),
  col=heat.colors(12),zlim=zlim,main="GLM coef posterior map")


## Not run: 
# BHMSMA multi-subject analysis for simulated (fMRI) 
# data at 100 timepoints over an 64x64 grid (of a 
# brain slice) for 15 subjects
# (takes ~12s in a 2.8 GHz Quad-Core Intel Core i7 processor)
set.seed(1)
n &lt;- 15
grid &lt;- 64
ntime &lt;- 100
data &lt;- array(rnorm(n*grid*grid*ntime),
          dim=c(n,grid,grid,ntime))
designmat &lt;- cbind(rep(1,ntime),runif(ntime))
k &lt;- 2
analysis &lt;- "multi"
system.time({BHMSMAmulti &lt;- BHMSMA(n,grid,data, 
  designmat,k,analysis)})

## End(Not run)
</code></pre>

<hr>
<h2 id='BHMSMAfMRI-package'>Bayesian Hierarchical Multi-Subject Multiscale Analysis (BHMSMA) of Functional MRI Data</h2><span id='topic+BHMSMAfMRI'></span>

<h3>Description</h3>

<p>The <span class="pkg">BHMSMAfMRI</span> package performs BHMSMA (Sanyal &amp; Ferreira, 2012) of fMRI data, or other multiscale data, using wavelet based prior that borrows strength across subjects and provides posterior smoothed images of the effect sizes and samples from the posterior distribution. The package currently considers analysis of 2D slices/grids only.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> BHMSMAfMRI</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 2.1</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2022-10-01</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL (&gt;= 2)</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>Import fMRI data using: <br />
<code><a href="#topic+readfmridata">readfmridata</a></code>
</p>
<p>The main analysis function, which provides subject-specific posterior estimates, is: <br />
<code><a href="#topic+BHMSMA">BHMSMA</a></code>
</p>
<p>The main function sucessively calls the following functions: <br />
<code><a href="#topic+glmcoef">glmcoef</a></code> (get regression coefficients) <br />
<code><a href="#topic+waveletcoef">waveletcoef</a></code> (get wavelet coefficients) <br />
<code><a href="#topic+hyperparamest">hyperparamest</a></code> (estimate model hyperparameters) <br />
<code><a href="#topic+postmixprob">postmixprob</a></code> (estimate posterior mixture probabilities of wavelet coefficients) <br />
<code><a href="#topic+postwaveletcoef">postwaveletcoef</a></code> (compute posterior estimates of wavelet coefficients) <br />
<code><a href="#topic+postglmcoef">postglmcoef</a></code> (compute posterior estimates of regression coefficients)
</p>
<p>For posterior group estimates of regression coefficients use: <br />
<code><a href="#topic+postgroupglmcoef">postgroupglmcoef</a></code>
</p>
<p>For posterior uncertainty estimates use: <br />
<code><a href="#topic+postsamples">postsamples</a></code>
</p>
<p>Internal sample data: <br />
<code><a href="#topic+fmridata">fmridata</a></code>
</p>
<p>Miscellaneous: <br />
<code><a href="#topic+substituteWaveletCoef">substituteWaveletCoef</a></code>
</p>


<h3>Author(s)</h3>

<p>Nilotpal Sanyal &lt;nilotpal.sanyal@gmail.com&gt;, Marco Ferreira &lt;marf@vt.edu&gt;
</p>
<p>Maintainer: Nilotpal Sanyal &lt;nilotpal.sanyal@gmail.com&gt;
</p>


<h3>References</h3>

<p>Sanyal, Nilotpal, and Ferreira, Marco A.R. (2012). Bayesian hierarchical multi-subject multiscale analysis of functional MRI data. Neuroimage, 63, 3, 1519-1531.
</p>

<hr>
<h2 id='fmridata'>A simulated fMRI data for 3 subjects
</h2><span id='topic+fmridata'></span>

<h3>Description</h3>

<p>A simulated fMRI data containing true regression coefficients images for three subjects and design matrix
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(fmridata)
</code></pre>


<h3>Format</h3>

<p>A list containing the following. 
</p>

<ul>
<li><p>grid  =32. The image dimension is 32 by 32.
</p>
</li>
<li><p>nsubject  =3.
</p>
</li>
<li><p>TrueCoeff  An array of dimension (3,32,32), containing the true regression coefficients for the 3 subjects.
</p>
</li>
<li><p>DesignMatrix  A matrix with 9 columns and 2 rows. The first column is a column of ones.
</p>
</li></ul>



<h3>Details</h3>

<p>This dataset contains only the true coefficients. The noisy fMRI data, which are generated by adding Gaussian random noise to these true coefficients, are included in the extdata directory within the package directory. The function <em>readfmridata</em> can be used to read those data files. The true coefficients and the noisy data both are generated using the R package neuRosim. The following specifications were used to generate the data: totaltime=18, onsets=seq(1,18,by=8), durations=1, TR=2, effectsize=1, hrf=&quot;double-gamma&quot;, regions=3, radius=c(1,1,1), form=&quot;sphere&quot;, fading=1, SNR=1.5, noise=&quot;white&quot;. The centers of the activation regions were chosen manually. For information regarding the specifications, see neuRosim help.</p>

<hr>
<h2 id='glmcoef'>Fit GLM (general linear model) to the fMRI time-series of all voxels within a single 2D brain slice
</h2><span id='topic+glmcoef'></span>

<h3>Description</h3>

<p><code>glmcoef</code> fits a GLM to the fMRI time-series of all voxels within a single 2D brain slice for each subject, and returns standardized GLM coefficients along with their standard error for the included regressors (it does not add any intercept by itself).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>glmcoef(n, grid, data, designmat)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="glmcoef_+3A_n">n</code></td>
<td>
<p>Number of subjects.</p>
</td></tr>
<tr><td><code id="glmcoef_+3A_grid">grid</code></td>
<td>
<p>The number of voxels in one row (or, one column) of the brain slice of interest. Must be a power of 2. The total number of voxels is <code>grid^2</code>. The maximum value of <code>grid</code> for this package is 512.</p>
</td></tr>
<tr><td><code id="glmcoef_+3A_data">data</code></td>
<td>
<p>The data in the form of an array with dimension <code>(n,grid,grid,ntime)</code>, where ntime is the size of the time series for each voxel.</p>
</td></tr>
<tr><td><code id="glmcoef_+3A_designmat">designmat</code></td>
<td>
<p>The design matrix used to generate the data. An intercept column should be included unless not desired.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following.
</p>
<table>
<tr><td><code>GLMCoefStandardized</code></td>
<td>
<p>An array of dimension <code>(n,grid,grid)</code>, containing for each subject the standardized GLM coefficients obtained by fitting GLM to the time-series corresponding to the voxels.</p>
</td></tr>
<tr><td><code>GLMCoefSE</code></td>
<td>
<p>An array of dimension <code>(n,grid,grid)</code>, containing for each subject the estimated standard errors of the GLM coefficients.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Nilotpal Sanyal, Marco Ferreira
</p>
<p>Maintainer: Nilotpal Sanyal &lt;nilotpal.sanyal@gmail.com&gt;
</p>


<h3>References</h3>

<p>Friston, K.J., Holmes, A.P., Worsley, K.J., Poline, J., Frith, C.D., Frackowiak, R.S.J., 1994. Statistical parametric maps in functional imaging: a general linear approach. Hum. Brain Mapp. 2 (4), 189-210.
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+lm">lm</a></code>, <code><a href="#topic+waveletcoef">waveletcoef</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(1)
n &lt;- 3
grid &lt;- 8
ntime &lt;- 10
designmat &lt;- cbind(rep(1,10),c(rep(c(1,0),5)))
data &lt;- array(dim=c(n,grid,grid,ntime),
  rnorm(n*grid*grid*ntime))
glm.fit &lt;- glmcoef(n,grid,data,designmat)
dim(glm.fit$GLMCoefStandardized)
#[1] 3 8 8
</code></pre>

<hr>
<h2 id='hyperparamest'>Obtain estimates of the hyperparameters of the BHMSMA model
</h2><span id='topic+hyperparamest'></span>

<h3>Description</h3>

<p><code>hyperparamest</code> computes the MLEs (maximum likelihood estimates) of the hyperparameters of the BHMSMA model using an empirical Bayes approach for multi-subject or single subject analyses, and returns the hyperparameters estimates along with their covariance matrix estimate (see References).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hyperparamest(n, grid, waveletcoefmat, analysis)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hyperparamest_+3A_n">n</code></td>
<td>
<p>Number of subjects.</p>
</td></tr>
<tr><td><code id="hyperparamest_+3A_grid">grid</code></td>
<td>
<p>The number of voxels in one row (or, one column) of the brain slice of interest. Must be a power of 2. The total number of voxels is <code>grid^2</code>. The maximum value of <code>grid</code> for this package is 512.</p>
</td></tr>
<tr><td><code id="hyperparamest_+3A_waveletcoefmat">waveletcoefmat</code></td>
<td>
<p>A matrix of dimension <code>(n,grid^2-1)</code>, containing for each subject the wavelet coefficients of all levels stacked together (by the increasing order of resolution level). </p>
</td></tr>
<tr><td><code id="hyperparamest_+3A_analysis">analysis</code></td>
<td>
<p>&quot;multi&quot; or &quot;single&quot;, depending on whether performing multi-subject analysis or single subject analysis.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following.
</p>
<table>
<tr><td><code>hyperparam</code></td>
<td>
<p>A vector containing the estimates of the six hyperparameters of the BHMSMA model.</p>
</td></tr>
<tr><td><code>hyperparamVar</code></td>
<td>
<p>Estimated covariance matrix of the hyperparameters.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Nilotpal Sanyal, Marco Ferreira
</p>
<p>Maintainer: Nilotpal Sanyal &lt;nilotpal.sanyal@gmail.com&gt;
</p>


<h3>References</h3>

<p>Sanyal, Nilotpal, and Ferreira, Marco A.R. (2012). Bayesian hierarchical multi-subject multiscale analysis of functional MRI data. Neuroimage, 63, 3, 1519-1531.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+waveletcoef">waveletcoef</a></code>, <code><a href="stats.html#topic+nlminb">nlminb</a></code>, <code><a href="#topic+postmixprob">postmixprob</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(1)
n &lt;- 3
grid &lt;- 8
waveletcoefmat &lt;- array(dim=c(n,grid^2-1),
  rnorm(n*(grid^2-1)))
analysis &lt;- "multi"
hyperest &lt;- hyperparamest(n,grid,waveletcoefmat,analysis)
hyperest$hyperparam
# [1]  1.00000  1.00000  1.00000  1.00000  0.00000 28.37678
</code></pre>

<hr>
<h2 id='postglmcoef'>Obtain posterior estimate of a 2D GLM coefficients map of a regressor
</h2><span id='topic+postglmcoef'></span>

<h3>Description</h3>

<p><code>postglmcoef</code> computes posterior mean (or median) of a 2D GLM coefficients map (e.g., corresponding to a single brain slice) of a regressor using the posterior mean (or median) of the corresponding wavelet coefficients in the inverse discrete wavelet transform for each subject based on multi-subject or single subject analyses (see References).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>postglmcoef(n, grid, glmcoefstd, postmeanwaveletcoef, 
wave.family="DaubLeAsymm", filter.number=6, bc="periodic")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="postglmcoef_+3A_n">n</code></td>
<td>
<p>Number of subjects.</p>
</td></tr>
<tr><td><code id="postglmcoef_+3A_grid">grid</code></td>
<td>
<p>The number of voxels in one row (or, one column) of the brain slice of interest. Must be a power of 2. The total number of voxels is <code>grid^2</code>. The maximum value of <code>grid</code> for this package is 512.</p>
</td></tr>
<tr><td><code id="postglmcoef_+3A_glmcoefstd">glmcoefstd</code></td>
<td>
<p>An array of dimension <code>(n,grid,grid)</code>, containing for each subject the standardized GLM coefficients obtained by fitting GLM to the time-series corresponding to the voxels.</p>
</td></tr>
<tr><td><code id="postglmcoef_+3A_postmeanwaveletcoef">postmeanwaveletcoef</code></td>
<td>
<p>A matrix of size <code>(n,grid^2-1)</code>, containing for each subject the posterior mean of the wavelet coefficients of all levels stacked together (by the increasing order of resolution level). </p>
</td></tr>
<tr><td><code id="postglmcoef_+3A_wave.family">wave.family</code></td>
<td>
<p>The family of wavelets to use - &quot;DaubExPhase&quot; or &quot;DaubLeAsymm&quot;. Default is &quot;DaubLeAsymm&quot;.</p>
</td></tr>
<tr><td><code id="postglmcoef_+3A_filter.number">filter.number</code></td>
<td>
<p>The number of vanishing moments of the wavelet. Default is 6.</p>
</td></tr>
<tr><td><code id="postglmcoef_+3A_bc">bc</code></td>
<td>
<p>The boundary condition to use - &quot;periodic&quot; or &quot;symmetric&quot;. Default is &quot;periodic&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The wavelet transformation and reconstruction are performed by using the functions <code><a href="wavethresh.html#topic+imwd">imwd</a></code> and <code><a href="wavethresh.html#topic+imwr">imwr</a></code>, respectively.</p>


<h3>Value</h3>

<p>A list containing the following.
</p>
<table>
<tr><td><code>GLMcoefposterior</code></td>
<td>
<p>An array of dimension <code>(n,grid,grid)</code>, containing for each subject the posterior means of the standardized GLM coefficients.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Nilotpal Sanyal, Marco Ferreira
</p>
<p>Maintainer: Nilotpal Sanyal &lt;nilotpal.sanyal@gmail.com&gt;
</p>


<h3>See Also</h3>

<p><code><a href="#topic+glmcoef">glmcoef</a></code>, <code><a href="#topic+postwaveletcoef">postwaveletcoef</a></code>, <code><a href="#topic+substituteWaveletCoef">substituteWaveletCoef</a></code>, <code><a href="wavethresh.html#topic+imwr">imwr</a></code>, <code><a href="#topic+postgroupglmcoef">postgroupglmcoef</a></code>, <code><a href="#topic+postsamples">postsamples</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(1)
n &lt;- 3
grid &lt;- 8
glmcoefstd &lt;- array(rnorm(n*grid*grid),
  dim=c(n,grid,grid))
postmeanwaveletcoef &lt;- array(rnorm(n*(grid^2-1)),
  dim=c(n,(grid^2-1)))
postmeanglmcoef &lt;- postglmcoef(n,grid,glmcoefstd,
  postmeanwaveletcoef)
dim(postmeanglmcoef$GLMcoefposterior)
#[1] 3 8 8
</code></pre>

<hr>
<h2 id='postgroupglmcoef'>Obtain posterior group estimate of a 2D GLM coefficients map of a regressor
</h2><span id='topic+postgroupglmcoef'></span>

<h3>Description</h3>

<p><code>postgroupglmcoef</code> computes posterior group mean (or group median) of a 2D GLM coefficients map (e.g., corresponding to a single brain slice) of a regressor using the posterior means (or medians) of the corresponding wavelet coefficients from all subjects in the inverse discrete wavelet transform based on multi-subject or single subject analyses (see References).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>postgroupglmcoef( n, grid, glmcoefstd, postmeanwaveletcoef, 
wave.family="DaubLeAsymm", filter.number=6, bc="periodic" )
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="postgroupglmcoef_+3A_n">n</code></td>
<td>
<p>Number of subjects.</p>
</td></tr>
<tr><td><code id="postgroupglmcoef_+3A_grid">grid</code></td>
<td>
<p>The number of voxels in one row (or, one column) of the brain slice of interest. Must be a power of 2. The total number of voxels is <code>grid^2</code>. The maximum value of <code>grid</code> for this package is 512.</p>
</td></tr>
<tr><td><code id="postgroupglmcoef_+3A_glmcoefstd">glmcoefstd</code></td>
<td>
<p>An array of dimension <code>(n,grid,grid)</code>, containing for each subject the standardized GLM coefficients obtained by fitting GLM to the time-series corresponding to the voxels.</p>
</td></tr>
<tr><td><code id="postgroupglmcoef_+3A_postmeanwaveletcoef">postmeanwaveletcoef</code></td>
<td>
<p>A matrix of size <code>(n,grid^2-1)</code>, containing for each subject the posterior mean of the wavelet coefficients of all levels stacked together (by the increasing order of resolution level). </p>
</td></tr>
<tr><td><code id="postgroupglmcoef_+3A_wave.family">wave.family</code></td>
<td>
<p>The family of wavelets to use - &quot;DaubExPhase&quot; or &quot;DaubLeAsymm&quot;. Default is &quot;DaubLeAsymm&quot;.</p>
</td></tr>
<tr><td><code id="postgroupglmcoef_+3A_filter.number">filter.number</code></td>
<td>
<p>The number of vanishing moments of the wavelet. Default is 6.</p>
</td></tr>
<tr><td><code id="postgroupglmcoef_+3A_bc">bc</code></td>
<td>
<p>The boundary condition to use - &quot;periodic&quot; or &quot;symmetric&quot;. Default is &quot;periodic&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The wavelet transformation and reconstruction are performed by using the functions <code><a href="wavethresh.html#topic+imwd">imwd</a></code> and <code><a href="wavethresh.html#topic+imwr">imwr</a></code>, respectively.</p>


<h3>Value</h3>

<p>A list containing the following.
</p>
<table>
<tr><td><code>groupcoef</code></td>
<td>
<p>A matrix of dimension (grid, grid), containing the posterior group coefficients obtained by BHMSMA methodology.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Nilotpal Sanyal, Marco Ferreira
</p>
<p>Maintainer: Nilotpal Sanyal &lt;nilotpal.sanyal@gmail.com&gt;
</p>


<h3>References</h3>

<p>Sanyal, Nilotpal, and Ferreira, Marco A.R. (2012). Bayesian hierarchical multi-subject multiscale analysis of functional MRI data. Neuroimage, 63, 3, 1519-1531.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+readfmridata">readfmridata</a></code>, <code><a href="#topic+glmcoef">glmcoef</a></code>, <code><a href="#topic+postglmcoef">postglmcoef</a></code>, <code><a href="#topic+postwaveletcoef">postwaveletcoef</a></code>, <code><a href="#topic+substituteWaveletCoef">substituteWaveletCoef</a></code>, <code><a href="wavethresh.html#topic+imwd">imwd</a></code>, <code><a href="wavethresh.html#topic+imwr">imwr</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(1)
n &lt;- 3
grid &lt;- 8
glmcoefstd &lt;- array(rnorm(n*grid*grid),
  dim=c(n,grid,grid))
postmeanwaveletcoef &lt;- array(rnorm(n*(grid^2-1)),
  dim=c(n,grid^2-1))
post.groupcoef &lt;- postgroupglmcoef(n,grid,glmcoefstd,
  postmeanwaveletcoef)
dim(post.groupcoef$groupcoef)
#[1] 8 8
</code></pre>

<hr>
<h2 id='postmixprob'>Obtain estimates of the mixture probabilities defining the BHMSMA posterior wavelet coefficients distributions
</h2><span id='topic+postmixprob'></span>

<h3>Description</h3>

<p><code>postmixprob</code> computes the mixture probabilities (piklj.bar), which define the marginal posterior distribution of the wavelet coefficients of the BHMSMA model, using Newton Cotes algorithm for each subject based on multi-subject or single subject analyses, and returns the same (see References).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>postmixprob(n, grid, waveletcoefmat, hyperparam, analysis)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="postmixprob_+3A_n">n</code></td>
<td>
<p>Number of subjects.</p>
</td></tr>
<tr><td><code id="postmixprob_+3A_grid">grid</code></td>
<td>
<p>The number of voxels in one row (or, one column) of the brain slice of interest. Must be a power of 2. The total number of voxels is <code>grid^2</code>. The maximum value of <code>grid</code> for this package is 512.</p>
</td></tr>
<tr><td><code id="postmixprob_+3A_waveletcoefmat">waveletcoefmat</code></td>
<td>
<p>A matrix of dimension <code>(n,grid^2-1)</code>, containing for each subject the wavelet coefficients of all levels stacked together (by the increasing order of resolution level). </p>
</td></tr>
<tr><td><code id="postmixprob_+3A_hyperparam">hyperparam</code></td>
<td>
<p>A vector containing the estimates of the six hyperparameters.</p>
</td></tr>
<tr><td><code id="postmixprob_+3A_analysis">analysis</code></td>
<td>
<p>&quot;MSA&quot; or &quot;SSA&quot;, depending on whether performing multi-subject analysis or single subject analysis.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following.
</p>
<table>
<tr><td><code>pkljbar</code></td>
<td>
<p>A matrix of dimension <code>(n,grid^2-1)</code>, containing the piklj bar values.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Nilotpal Sanyal, Marco Ferreira
</p>
<p>Maintainer: Nilotpal Sanyal &lt;nilotpal.sanyal@gmail.com&gt;
</p>


<h3>References</h3>

<p>Sanyal, Nilotpal, and Ferreira, Marco A.R. (2012). Bayesian hierarchical multi-subject multiscale analysis of functional MRI data. Neuroimage, 63, 3, 1519-1531.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+waveletcoef">waveletcoef</a></code>, <code><a href="#topic+hyperparamest">hyperparamest</a></code>, <code><a href="#topic+postwaveletcoef">postwaveletcoef</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(1)
n &lt;- 3
grid &lt;- 8
waveletcoefmat &lt;- matrix(nrow=n,ncol=grid^2-1)
for(i in 1:n) waveletcoefmat[i,] &lt;- rnorm(grid^2-1)
hyperparam &lt;- rep(.1,6)
analysis &lt;- "multi"
pkljbar &lt;- postmixprob(n,grid,waveletcoefmat,hyperparam,
  analysis)
dim(pkljbar$pkljbar)
#[1]  3 63
</code></pre>

<hr>
<h2 id='postsamples'>Obtain samples from the posterior distribution of a 2D GLM coefficient map.
</h2><span id='topic+postsamples'></span>

<h3>Description</h3>

<p><code>postsamples</code> generates samples from the posterior distribution of a 2D GLM coefficient map (e.g., corresponding to a single brain slice) of a regressor in the BHMSMA model for each subject based on multi-subject or single subject analyses (see References).</p>


<h3>Usage</h3>

<pre><code class='language-R'>postsamples(nsample, n, grid, glmcoefstd, waveletcoefmat, 
hyperparam, pkljbar, analysis, wave.family="DaubLeAsymm", 
filter.number=6, bc="periodic", seed)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="postsamples_+3A_nsample">nsample</code></td>
<td>
<p>Number of samples to be generated.</p>
</td></tr>
<tr><td><code id="postsamples_+3A_n">n</code></td>
<td>
<p>Number of subjects.</p>
</td></tr>
<tr><td><code id="postsamples_+3A_grid">grid</code></td>
<td>
<p>The number of voxels in one row (or, one column) of the brain slice of interest. Must be a power of 2. The total number of voxels is <code>grid^2</code>. The maximum value of <code>grid</code> for this package is 512.</p>
</td></tr>
<tr><td><code id="postsamples_+3A_glmcoefstd">glmcoefstd</code></td>
<td>
<p>An array of dimension <code>(n,grid,grid)</code>, containing for each subject the standardized GLM coefficients obtained by fitting GLM to the time-series corresponding to the voxels.</p>
</td></tr>
<tr><td><code id="postsamples_+3A_waveletcoefmat">waveletcoefmat</code></td>
<td>
<p>A matrix of dimension <code>(n,grid^2-1)</code>, containing for each subject the wavelet coefficients of all levels stacked together (by the increasing order of resolution level). </p>
</td></tr>
<tr><td><code id="postsamples_+3A_hyperparam">hyperparam</code></td>
<td>
<p>A vector containing the estimates of the six hyperparameters.</p>
</td></tr>
<tr><td><code id="postsamples_+3A_pkljbar">pkljbar</code></td>
<td>
<p>A matrix of dimension <code>(n,grid^2-1)</code>, containing the piklj bar values (see References for details).</p>
</td></tr>
<tr><td><code id="postsamples_+3A_analysis">analysis</code></td>
<td>
<p>&quot;MSA&quot; or &quot;SSA&quot;, depending on whether performing multi-subject analysis or single subject analysis.</p>
</td></tr>
<tr><td><code id="postsamples_+3A_wave.family">wave.family</code></td>
<td>
<p>The family of wavelets to use - &quot;DaubExPhase&quot; or &quot;DaubLeAsymm&quot;. Default is &quot;DaubLeAsymm&quot;.</p>
</td></tr>
<tr><td><code id="postsamples_+3A_filter.number">filter.number</code></td>
<td>
<p>The number of vanishing moments of the wavelet. Default is 6.</p>
</td></tr>
<tr><td><code id="postsamples_+3A_bc">bc</code></td>
<td>
<p>The boundary condition to use - &quot;periodic&quot; or &quot;symmetric&quot;. Default is &quot;periodic&quot;.</p>
</td></tr>
<tr><td><code id="postsamples_+3A_seed">seed</code></td>
<td>
<p>Must be a positive integer. Provide to set random number generation seed for reproducibility.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The wavelet computations are performed by using the R package <span class="pkg">wavethresh</span>.</p>


<h3>Value</h3>

<p>A list containing the following.
</p>
<table>
<tr><td><code>samples</code></td>
<td>
<p>An array of dimension <code>(n,grid,grid,nsample)</code>, containing for each subject the posterior samples of the GLM coefficients.</p>
</td></tr>
<tr><td><code>postdiscovery</code></td>
<td>
<p>An array of dimension <code>(n,grid,grid)</code>, containing for each subject the posterior discovery maps of the GLM coefficients (for details see Morris et al. (2011)).</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Nilotpal Sanyal, Marco Ferreira
</p>
<p>Maintainer: Nilotpal Sanyal &lt;nilotpal.sanyal@gmail.com&gt;
</p>


<h3>References</h3>

<p>Sanyal, Nilotpal, and Ferreira, Marco A.R. (2012). Bayesian hierarchical multi-subject multiscale analysis of functional MRI data. Neuroimage, 63, 3, 1519-1531.
</p>
<p>Morris, J.S. et al. (2011). Automated analysis of quantitative image data using isomorphic functional mixed models, with application to proteomic data. Ann. Appl. Stat. 5, 894-923.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+readfmridata">readfmridata</a></code>, <code><a href="#topic+glmcoef">glmcoef</a></code>, <code><a href="#topic+waveletcoef">waveletcoef</a></code>, <code><a href="#topic+hyperparamest">hyperparamest</a></code>, <code><a href="#topic+postmixprob">postmixprob</a></code>, <code><a href="#topic+postwaveletcoef">postwaveletcoef</a></code>, <code><a href="#topic+substituteWaveletCoef">substituteWaveletCoef</a></code>, <code><a href="#topic+postglmcoef">postglmcoef</a></code>, <code><a href="wavethresh.html#topic+imwd">imwd</a></code>, <code><a href="wavethresh.html#topic+imwr">imwr</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(1)
n &lt;- 3
grid &lt;- 8
nsample &lt;- 5
glmcoefstd &lt;- array(rnorm(n*grid*grid),
  dim=c(n,grid,grid))
waveletcoefmat &lt;- array(rnorm(n*(grid^2-1)),
  dim=c(n,(grid^2-1)))
hyperparam &lt;- rep(.2,6)
pkljbar &lt;- array(runif(n*(grid^2-1)),
  dim=c(n,(grid^2-1)))
analysis &lt;- "multi"
postsample &lt;- postsamples(nsample,n,grid,glmcoefstd, 
waveletcoefmat, hyperparam,pkljbar,analysis,seed=1)
dim(postsample$samples)
#[1] 3 8 8 5
</code></pre>

<hr>
<h2 id='postwaveletcoef'>Obtain posterior estimates of the BHMSMA wavelet coefficients
</h2><span id='topic+postwaveletcoef'></span>

<h3>Description</h3>

<p><code>postwaveletcoef</code> computes posterior mean and posterior median of the wavelet coefficients of the BHMSMA model for each subject based on multi-subject or single subject analyses (see References).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>postwaveletcoef(n, grid, waveletcoefmat, hyperparam, 
pkljbar, analysis)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="postwaveletcoef_+3A_n">n</code></td>
<td>
<p>Number of subjects.</p>
</td></tr>
<tr><td><code id="postwaveletcoef_+3A_grid">grid</code></td>
<td>
<p>The number of voxels in one row (or, one column) of the brain slice of interest. Must be a power of 2. The total number of voxels is <code>grid^2</code>. The maximum value of <code>grid</code> for this package is 512.</p>
</td></tr>
<tr><td><code id="postwaveletcoef_+3A_waveletcoefmat">waveletcoefmat</code></td>
<td>
<p>A matrix of dimension <code>(n,grid^2-1)</code>, containing for each subject the wavelet coefficients of all levels stacked together (by the increasing order of resolution level). </p>
</td></tr>
<tr><td><code id="postwaveletcoef_+3A_hyperparam">hyperparam</code></td>
<td>
<p>A vector containing the estimates of the six hyperparameters.</p>
</td></tr>
<tr><td><code id="postwaveletcoef_+3A_pkljbar">pkljbar</code></td>
<td>
<p>A matrix of dimension <code>(n,grid^2-1)</code>, containing the piklj bar values.</p>
</td></tr>
<tr><td><code id="postwaveletcoef_+3A_analysis">analysis</code></td>
<td>
<p>&quot;MSA&quot; or &quot;SSA&quot;, depending on whether performing multi-subject analysis or single subject analysis.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the following.
</p>
<table>
<tr><td><code>PostMeanWaveletCoef</code></td>
<td>
<p>A matrix of size <code>(n,grid^2-1)</code>, containing for each subject the posterior mean of the wavelet coefficients of all levels stacked together (by the increasing order of resolution level). </p>
</td></tr>
<tr><td><code>PostMedianWaveletCoef</code></td>
<td>
<p>A matrix of size <code>(n,grid^2-1)</code>, containing for each subject the posterior median of the wavelet coefficients of all levels stacked together.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Nilotpal Sanyal, Marco Ferreira
</p>
<p>Maintainer: Nilotpal Sanyal &lt;nilotpal.sanyal@gmail.com&gt;
</p>


<h3>References</h3>

<p>Sanyal, Nilotpal, and Ferreira, Marco A.R. (2012). Bayesian hierarchical multi-subject multiscale analysis of functional MRI data. Neuroimage, 63, 3, 1519-1531.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+waveletcoef">waveletcoef</a></code>, <code><a href="#topic+hyperparamest">hyperparamest</a></code>, <code><a href="#topic+postmixprob">postmixprob</a></code>, <code><a href="#topic+postglmcoef">postglmcoef</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(1)
n &lt;- 3
grid &lt;- 8
nsample &lt;- 5
waveletcoefmat &lt;- array(rnorm(n*(grid^2-1)),
  dim=c(n,grid^2-1))
hyperparam &lt;- rep(.2,6)
pkljbar &lt;- array(runif(n*(grid^2-1)),
  dim=c(n,grid^2-1))
analysis &lt;- "multi"
postwavecoef &lt;- postwaveletcoef(n,grid,waveletcoefmat, 
hyperparam,pkljbar,analysis)
dim(postwavecoef$PostMeanWaveletCoef)
#[1]  3 63
</code></pre>

<hr>
<h2 id='readfmridata'>Import fMRI data from various fMRI image files
</h2><span id='topic+readfmridata'></span>

<h3>Description</h3>

<p><code>readfmridata</code> reads and imports fMRI data from various fMRI image files (Analyze, NIFTI and AFNI) into a 4D array. It is just a convenient wrapper around the data importing functions provided by the <span class="pkg">oro.nifti</span> package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>readfmridata( directory, format, prefix, nimages, dim.image, 
  nii=TRUE )
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="readfmridata_+3A_directory">directory</code></td>
<td>
<p>Location of the directory where the fMRI image files are stored. Insert within quotations (&quot;&quot;).</p>
</td></tr>
<tr><td><code id="readfmridata_+3A_format">format</code></td>
<td>
<p>The format of the data file. One of &quot;Analyze&quot; (.img/.hdr files), &quot;Nifti&quot; (.img/.hdr files or .nii files) or &quot;Afni&quot; (.HEAD/.BRIK files).</p>
</td></tr>
<tr><td><code id="readfmridata_+3A_prefix">prefix</code></td>
<td>
<p>If format is &quot;Analyze&quot; or &quot;Nifti&quot;, then the part of the fMRI image file name appearing before the image number. The image number is assumed to have four digit representation, that is, the lowest number is 0001 and the highest possible number is 9999. If format is &quot;Afni&quot;, then the file name. Insert within quotations(&quot;&quot;).</p>
</td></tr>
<tr><td><code id="readfmridata_+3A_nimages">nimages</code></td>
<td>
<p>If format is &quot;Analyze&quot;, number of images to be read beginning from the first image. If format is &quot;Afni&quot;, not necessary.</p>
</td></tr>
<tr><td><code id="readfmridata_+3A_dim.image">dim.image</code></td>
<td>
<p>Size of the 3D fMRI image. A vector with three elements.</p>
</td></tr>
<tr><td><code id="readfmridata_+3A_nii">nii</code></td>
<td>
<p>Necessary only for &quot;Nifti&quot; format. nii=TRUE (default) indicates the image files are in .nii files . nii=FALSE indicates the image files are .img/.hdr files.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function uses package <span class="pkg">oro.nifti</span> for reading from fMRI data files.</p>


<h3>Value</h3>

<p>A list containing the following:
</p>
<table>
<tr><td><code>fmridata</code></td>
<td>
<p>An array of dimension (dim.image, nimages), containing the image data for all images/time-points.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Nilotpal Sanyal, Marco Ferreira
Maintainer: Nilotpal Sanyal &lt;nilotpal.sanyal@gmail.com&gt;
</p>


<h3>See Also</h3>

<p><code><a href="oro.nifti.html#topic+readANALYZE">readANALYZE</a></code>, <code><a href="oro.nifti.html#topic+readNIfTI">readNIfTI</a></code>, <code><a href="oro.nifti.html#topic+readAFNI">readAFNI</a></code>, <code><a href="#topic+BHMSMA">BHMSMA</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># import simmulated fMRI data from image files provided within this package
fpath &lt;- system.file("extdata", package="BHMSMAfMRI")
untar(paste0(fpath,"/fmridata.tar"), exdir=tempdir())
data &lt;- array(dim=c(3,32,32,9))
for(subject in 1:3)
{
  directory &lt;- paste0(tempdir(),"/fmridata","/s0",subject,"/")
  a &lt;- readfmridata(directory, format="Analyze", prefix=paste0("s0",subject,"_t"),
  nimages=9, dim.image=c(32,32,1))
  data[subject,,,] &lt;- a[,,1,]
}
dim(a)
</code></pre>

<hr>
<h2 id='substituteWaveletCoef'>Substitute 2D wavelet transform coefficients with user-given values
</h2><span id='topic+substituteWaveletCoef'></span>

<h3>Description</h3>

<p><code>substituteWaveletCoef</code> substitutes the wavelet coefficients stored wavelet object generated through 2D wavelet transform with user-given values and returns the modified wavelet object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>substituteWaveletCoef(grid, waveletobj, values)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="substituteWaveletCoef_+3A_grid">grid</code></td>
<td>
<p>The number of voxels in one row (or, one column) of the brain slice of interest. Must be a power of 2. The total number of voxels is <code>grid^2</code>. The maximum value of <code>grid</code> for this package is 512.</p>
</td></tr>
<tr><td><code id="substituteWaveletCoef_+3A_waveletobj">waveletobj</code></td>
<td>
<p>A wavelet object of class <code>imwd.object</code>, usually obtained by performing 2D wavelet transformion through the function <code>imwd</code> of package <span class="pkg">wavethresh</span>.</p>
</td></tr>
<tr><td><code id="substituteWaveletCoef_+3A_values">values</code></td>
<td>
<p>The values with which the wavelet coefficients are to be replaced. The order should be consistent with <code>imwd.object</code> class.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The maximum value of <code>grid</code> for this package is 512.</p>


<h3>Value</h3>

<p>A wavelet object of class <code>imwd.object</code> with updated wavelet coefficients.
</p>


<h3>Author(s)</h3>

<p>Nilotpal Sanyal, Marco Ferreira
</p>
<p>Maintainer: Nilotpal Sanyal &lt;nilotpal.sanyal@gmail.com&gt;
</p>


<h3>See Also</h3>

<p><code><a href="wavethresh.html#topic+imwd">imwd</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(1)
n &lt;- 3
grid &lt;- 8
ntime &lt;- 10
designmat &lt;- cbind( rep(1,10), c(rep(c(1,0),5)) )
data &lt;- array(dim=c(n,grid,grid,ntime),
  rnorm(n*grid*grid*ntime))
glm.fit &lt;- glmcoef(n, grid, data, designmat)
glmcoefstd &lt;- glm.fit$GLMCoefStandardized[,,,1]
dwt = wavethresh::imwd(glmcoefstd[1,,],type="wavelet",
  family="DaubLeAsymm",filter.number=6,bc="periodic")
dwt

values = rnorm(grid^2-1)
dwtnew = substituteWaveletCoef(grid,dwt,values)
dwtnew
</code></pre>

<hr>
<h2 id='waveletcoef'>Apply discrete wavelet transform (DWT) to a 2D GLM coefficient map of a regressor
</h2><span id='topic+waveletcoef'></span>

<h3>Description</h3>

<p><code>waveletcoef</code> applies DWT to a 2D GLM coefficient map (e.g., corresponding to a single brain slice) of a regressor for each subject, and returns the wavelet coefficients at all resolution levels. This function wraps around the wavelet transformation function <code><a href="wavethresh.html#topic+imwd">imwd</a></code> of the <span class="pkg">wavethresh</span> package. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>waveletcoef(n, grid, glmcoefstd, wave.family="DaubLeAsymm", 
  filter.number=6, bc="periodic")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="waveletcoef_+3A_n">n</code></td>
<td>
<p>Number of subjects.</p>
</td></tr>
<tr><td><code id="waveletcoef_+3A_grid">grid</code></td>
<td>
<p>The number of voxels in one row (or, one column) of the brain slice of interest. Must be a power of 2. The total number of voxels is <code>grid^2</code>. The maximum value of <code>grid</code> for this package is 512.</p>
</td></tr>
<tr><td><code id="waveletcoef_+3A_glmcoefstd">glmcoefstd</code></td>
<td>
<p>An array of dimension <code>(n,grid,grid)</code>, containing for each subject the standardized GLM coefficients of a regressor obtained by fitting GLM to the time-series corresponding to the voxels.</p>
</td></tr>
<tr><td><code id="waveletcoef_+3A_wave.family">wave.family</code></td>
<td>
<p>The family of wavelets to use - &quot;DaubExPhase&quot; or &quot;DaubLeAsymm&quot;. Default is &quot;DaubLeAsymm&quot;.</p>
</td></tr>
<tr><td><code id="waveletcoef_+3A_filter.number">filter.number</code></td>
<td>
<p>The number of vanishing moments of the wavelet. Default is 6.</p>
</td></tr>
<tr><td><code id="waveletcoef_+3A_bc">bc</code></td>
<td>
<p>The boundary condition to use - &quot;periodic&quot; or &quot;symmetric&quot;. Default is &quot;periodic&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The wavelet decomposition is performed by using the function <code><a href="wavethresh.html#topic+imwd">imwd</a></code>.</p>


<h3>Value</h3>

<p>A list containing the following.
</p>
<table>
<tr><td><code>WaveletCoefficientMatrix</code></td>
<td>
<p>A matrix of dimension <code>(n,grid^2-1)</code>, containing for each subject the wavelet coefficients of all levels stacked together (by the increasing order of resolution level). </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Nilotpal Sanyal, Marco Ferreira
</p>
<p>Maintainer: Nilotpal Sanyal &lt;nilotpal.sanyal@gmail.com&gt;
</p>


<h3>See Also</h3>

<p><code><a href="wavethresh.html#topic+imwd">imwd</a></code>, <code><a href="#topic+hyperparamest">hyperparamest</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(1)
n &lt;- 3
grid &lt;- 8
ntime &lt;- 10
designmat &lt;- cbind( rep(1,10), c(rep(c(1,0),5)) )
data &lt;- array(dim=c(n,grid,grid,ntime),
  rnorm(n*grid*grid*ntime))
glm.fit &lt;- glmcoef(n,grid,data,designmat)
glmcoefstd &lt;- glm.fit$GLMCoefStandardized[,,,1]
wavecoef &lt;- waveletcoef(n,grid,glmcoefstd)
dim(wavecoef$WaveletCoefficientMatrix)
#[1]  3 63
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
