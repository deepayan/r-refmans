<!DOCTYPE html><html lang="en"><head><title>Help for package anomaly</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {anomaly}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#anomaly-package'>
<p>Detecting Anomalies in Data</p></a></li>
<li><a href='#bard'><p>Detection of multivariate anomalous segments using BARD.</p></a></li>
<li><a href='#capa'><p>A technique for detecting anomalous segments and points based on CAPA.</p></a></li>
<li><a href='#collective_anomalies'><p>Collective anomaly location, lags, and mean/variance changes.</p></a></li>
<li><a href='#machinetemp'><p>Machine temperature data.</p></a></li>
<li><a href='#pass'><p>Detection of multivariate anomalous segments using PASS.</p></a></li>
<li><a href='#plot'><p>Visualisation of data, collective and point anomalies.</p></a></li>
<li><a href='#point_anomalies'><p>Point anomaly location and strength.</p></a></li>
<li><a href='#sampler'><p>Post processing of BARD results.</p></a></li>
<li><a href='#show'><p>Displays S4 objects produced by capa methods.</p></a></li>
<li><a href='#sim.data'><p>Simulated data.</p></a></li>
<li><a href='#summary'><p>Summary of collective and point anomalies.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Detecting Anomalies in Data</td>
</tr>
<tr>
<td>Version:</td>
<td>4.3.3</td>
</tr>
<tr>
<td>Date:</td>
<td>2024-08-19</td>
</tr>
<tr>
<td>Description:</td>
<td>Implements Collective And Point Anomaly (CAPA) Fisch, Eckley, and Fearnhead (2022) &lt;<a href="https://doi.org/10.1002%2Fsam.11586">doi:10.1002/sam.11586</a>&gt;, Multi-Variate Collective And Point Anomaly (MVCAPA) Fisch, Eckley, and Fearnhead (2021) &lt;<a href="https://doi.org/10.1080%2F10618600.2021.1987257">doi:10.1080/10618600.2021.1987257</a>&gt;, Proportion Adaptive Segment Selection (PASS) Jeng, Cai, and Li (2012) &lt;<a href="https://doi.org/10.1093%2Fbiomet%2Fass059">doi:10.1093/biomet/ass059</a>&gt;, and Bayesian Abnormal Region Detector (BARD) Bardwell and Fearnhead (2015) &lt;<a href="https://doi.org/10.1214%2F16-BA998">doi:10.1214/16-BA998</a>&gt;. These methods are for the detection of anomalies in time series data. Further information regarding the use of this package along with detailed examples can be found in Fisch, Grose, Eckley, Fearnhead, and Bardwell (2024) &lt;<a href="https://doi.org/10.18637%2Fjss.v110.i01">doi:10.18637/jss.v110.i01</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL]</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr,tidyr,methods,ggplot2,Rcpp (&ge;
0.12.18),xts,zoo,Rdpack,cowplot</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp,BH</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>RdMacros:</td>
<td>Rdpack</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Collate:</td>
<td>'RcppExports.R' 'anomaly-package.R' 'generics.R' 'bard.R'
'capa.R' 'data.R' 'pass.R' 'pass.class.R'</td>
</tr>
<tr>
<td>Suggests:</td>
<td>robustbase</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-08-19 15:37:28 UTC; grosed</td>
</tr>
<tr>
<td>Author:</td>
<td>Alex Fisch [aut],
  Daniel Grose [aut, cre],
  Lawrence Bardwell [aut, ctb],
  Idris Eckley [aut, ths],
  Paul Fearnhead [aut, ths]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Daniel Grose &lt;dan.grose@lancaster.ac.uk&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-08-19 18:40:07 UTC</td>
</tr>
</table>
<hr>
<h2 id='anomaly-package'>
Detecting Anomalies in Data
</h2><span id='topic+anomaly-package'></span><span id='topic+anomaly'></span>

<h3>Description</h3>

<p>The <span class="pkg">anomaly</span> package provides methods for detecting collective and point anomalies in both univariate and multivariate settings.
</p>


<h3>Introduction</h3>

<p>The <span class="pkg">anomaly</span> package implements a number of recently proposed methods for anomaly detection. For univariate data there is the Collective And Point Anomaly (CAPA)
method of Fisch, Eckley and Fearnhead (2022a), which can detect both collective and point anomalies. For multivariate data there are three methods, the multivariate extension of CAPA
of Fisch, Eckley and Fearnhead (2022b), the Proportion Adaptive Segment
Selection (PASS) method of Jeng, Cai and Li, and a Bayesian approach, Bayesian Abnormal
Region Detector, of Bardwell and Fearnhead.
</p>
<p>The multivariate CAPA method and PASS are similar in that, for a given segment they use a likelihood-based approach to measure the evidence that it is anomalous for each component of the
multivariate data stream, and then merge this evidence across
components. They differ in how they merge this evidence, with PASS using
higher criticism (Donoho and Jin) and CAPA using
a penalised
likelihood approach. One disadvantage of the higher criticism approach for merging evidence is that it can lose power when only one or a very small number of components are anomalous. Furthermore,
CAPA also allows for point anomalies in otherwise normal segments of data, and can be more robust to detecting collective anomalies when there are point anomalies in the data. CAPA can also allow for
the anomalies segments to be slightly mis-aligned across different components. 
</p>
<p>The BARD method considers a similar model to that of CAPA or PASS, but is Bayesian and so its basic output are samples from the posterior distribution for where the collective anomalies are, and which
components are anomalous. It does not allow for point anomalies. As with any Bayesian method, it requires the user to specify suitable priors, but the output is more flexible, and can more directly
allow for quantifying uncertainty about the anomalies.
</p>


<h3>References</h3>

<p>Fisch ATM, Grose D, Eckley IA, Fearnhead P, Bardwell L (2024).
&ldquo;anomaly: Detection of Anomalous Structure in Time Series Data.&rdquo;
<em>Journal of Statistical Software</em>, <b>110</b>(1), 1&ndash;24.
<a href="https://doi.org/10.18637/jss.v110.i01">doi:10.18637/jss.v110.i01</a>.
</p>
<p>Fisch ATM, Eckley IA, Fearnhead P (2022a).
&ldquo;A linear time method for the detection of collective and point anomalies.&rdquo;
<em>Statistical Analysis and Data Mining: The ASA Data Science Journal</em>, <b>15</b>(4), 494-508.
<a href="https://doi.org/10.1002/sam.11586">doi:10.1002/sam.11586</a>.
</p>
<p>Fisch ATM, Eckley IA, Fearnhead P (2022b).
&ldquo;Subset Multivariate Collective and Point Anomaly Detection.&rdquo;
<em>Journal of Computational and Graphical Statistics</em>, <b>31</b>(2), 574-585.
<a href="https://doi.org/10.1080/10618600.2021.1987257">doi:10.1080/10618600.2021.1987257</a>.
</p>
<p>Jeng XJ, Cai TT, Li H (2012).
&ldquo;Simultaneous discovery of rare and common segment variants.&rdquo;
<em>Biometrika</em>, <b>100</b>(1), 157-172.
ISSN 0006-3444, <a href="https://doi.org/10.1093/biomet/ass059">doi:10.1093/biomet/ass059</a>, <a href="https://academic.oup.com/biomet/article/100/1/157/193108">https://academic.oup.com/biomet/article/100/1/157/193108</a>.
</p>
<p>Bardwell L, Fearnhead P (2017).
&ldquo;Bayesian Detection of Abnormal Segments in Multiple Time Series.&rdquo;
<em>Bayesian Anal.</em>, <b>12</b>(1), 193&ndash;218.
</p>
<p>Donoho D, Jin J (2004).
&ldquo;Higher Criticism for Detecting Sparse Heterogeneous Mixtures.&rdquo;
<em>The Annals of Statistics</em>, <b>32</b>(3), 962&ndash;994.
<a href="https://doi.org/10.1214/009053604000000265">doi:10.1214/009053604000000265</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Use univariate CAPA to analyse simulated data
library("anomaly")
set.seed(0)
x &lt;- rnorm(5000)
x[401:500] &lt;- rnorm(100, 4, 1)
x[1601:1800] &lt;- rnorm(200, 0, 0.01)
x[3201:3500] &lt;- rnorm(300, 0, 10)
x[c(1000, 2000, 3000, 4000)] &lt;- rnorm(4, 0, 100)
x &lt;- (x - median(x)) / mad(x)
res &lt;- capa(x)
# view results
summary(res)
# visualise results
plot(res)

# Use multivariate CAPA to analyse simulated data
library("anomaly")
data("simulated")
# set penalties
beta &lt;- 2 * log(ncol(sim.data):1)
beta[1] &lt;- beta[1] + 3 * log(nrow(sim.data))
res &lt;- capa(sim.data, type= "mean", min_seg_len = 2,beta = beta)
# view results
summary(res)
# visualise results
plot(res, subset = 1:20)

# Use PASS to analyse simulated mutivariate data
library("anomaly")
data("simulated")
res &lt;- pass(sim.data, max_seg_len = 20, alpha = 3)
# view results
collective_anomalies(res)
# visualise results
plot(res)

# Use BARD to analyse simulated mutivariate data
library("anomaly")
data("simulated")
bard.res &lt;- bard(sim.data)
# sample from the BARD result
sampler.res &lt;- sampler(bard.res, gamma = 1/3, num_draws = 1000)
# view results
show(sampler.res)
# visualise results
plot(sampler.res, marginals = TRUE)

</code></pre>

<hr>
<h2 id='bard'>Detection of multivariate anomalous segments using BARD.</h2><span id='topic+bard'></span>

<h3>Description</h3>

<p>Implements the BARD (Bayesian Abnormal Region Detector) procedure of Bardwell and Fearnhead (2017). 
BARD is a fully Bayesian inference procedure which is able to give measures of uncertainty about the 
number and location of anomalous regions. It uses negative binomial prior distributions on the lengths 
of anomalous and non-anomalous regions as well as a uniform prior for the means of anomalous regions. 
Inference is conducted by solving a set of recursions. To reduce computational and storage costs a resampling 
step is included.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>bard(
  x,
  p_N = 1/(nrow(x) + 1),
  p_A = 5/nrow(x),
  k_N = 1,
  k_A = (5 * p_A)/(1 - p_A),
  pi_N = 0.9,
  paffected = 0.05,
  lower = 2 * sqrt(log(nrow(x))/nrow(x)),
  upper = max(x),
  alpha = 1e-04,
  h = 0.25
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="bard_+3A_x">x</code></td>
<td>
<p>A numeric matrix with n rows and p columns containing the data which is to be inspected. The time series data classes ts, xts, and zoo are also supported.</p>
</td></tr>
<tr><td><code id="bard_+3A_p_n">p_N</code></td>
<td>
<p>Hyper-parameter of the negative binomial distribution for the length of non-anomalous segments (probability of success). Defaults to <code class="reqn">\frac{1}{n+1}.</code></p>
</td></tr>
<tr><td><code id="bard_+3A_p_a">p_A</code></td>
<td>
<p>Hyper-parameter of the negative binomial distribution for the length of anomalous segments (probability of success). Defaults to <code class="reqn">\frac{5}{n}.</code></p>
</td></tr>
<tr><td><code id="bard_+3A_k_n">k_N</code></td>
<td>
<p>Hyper-parameter of the negative binomial distribution for the length of non-anomalous segments (size). Defaults to 1.</p>
</td></tr>
<tr><td><code id="bard_+3A_k_a">k_A</code></td>
<td>
<p>Hyper-parameter of the negative binomial distribution for the length of anomalous segments (size). Defaults to <code class="reqn">\frac{5p_A}{1- p_A}.</code></p>
</td></tr>
<tr><td><code id="bard_+3A_pi_n">pi_N</code></td>
<td>
<p>Probability that an anomalous segment is followed by a non-anomalous segment. Defaults to 0.9.</p>
</td></tr>
<tr><td><code id="bard_+3A_paffected">paffected</code></td>
<td>
<p>Proportion of the variates believed to be affected by any given anomalous segment. Defaults to 5%. 
This parameter is relatively robust to being mis-specified and is studied empirically in Section 5.1 of Bardwell and Fearnhead (2017).</p>
</td></tr>
<tr><td><code id="bard_+3A_lower">lower</code></td>
<td>
<p>The lower limit of the the prior uniform distribution for the mean of an anomalous segment <code class="reqn">\mu</code>. Defaults to <code class="reqn">2\sqrt{\frac{\log(n)}{n}}.</code></p>
</td></tr>
<tr><td><code id="bard_+3A_upper">upper</code></td>
<td>
<p>The upper limit of the prior uniform distribution for the mean of an anomalous segment <code class="reqn">\mu</code>. 
Defaults to the largest value of x.</p>
</td></tr>
<tr><td><code id="bard_+3A_alpha">alpha</code></td>
<td>
<p>Threshold used to control the resampling in the approximation of the posterior distribution at each time step. A sensible default is 1e-4.
Decreasing alpha increases the accuracy of the posterior distribution but also increases the computational complexity of the algorithm.</p>
</td></tr>
<tr><td><code id="bard_+3A_h">h</code></td>
<td>
<p>The step size in the numerical integration used to find the marginal likelihood. 
The quadrature points are located from <code>lower</code> to <code>upper</code> in steps of <code>h</code>. Defaults to 0.25. 
Decreasing this parameter increases the accuracy of the calculation for the marginal likelihood but increases computational complexity.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An instance of the S4 object of type <code>.bard.class</code> containing the data <code>x</code>, procedure parameter values, and the results.
</p>


<h3>Notes on default hyper-parameters</h3>

<p>This function gives certain default hyper-parameters for the two segment length distributions.
We chose these to be quite flexible for a range of problems. For non-anomalous segments a geometric distribution
was selected having an average segment length of <code class="reqn">n</code> with the standard deviation being of the same order. 
For anomalous segments we chose parameters that gave an average length of 5 and a variance of <code class="reqn">n</code>. 
These may not be suitable for all problems and the user is encouraged to tune these parameters.
</p>


<h3>References</h3>

<p>Bardwell L, Fearnhead P (2017).
&ldquo;Bayesian Detection of Abnormal Segments in Multiple Time Series.&rdquo;
<em>Bayesian Anal.</em>, <b>12</b>(1), 193&ndash;218.
</p>
<p>Fisch ATM, Grose D, Eckley IA, Fearnhead P, Bardwell L (2024).
&ldquo;anomaly: Detection of Anomalous Structure in Time Series Data.&rdquo;
<em>Journal of Statistical Software</em>, <b>110</b>(1), 1&ndash;24.
<a href="https://doi.org/10.18637/jss.v110.i01">doi:10.18637/jss.v110.i01</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+sampler">sampler</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(anomaly)
data(simulated)
# run bard
bard.res&lt;-bard(sim.data, alpha = 1e-3, h = 0.5)
sampler.res&lt;-sampler(bard.res)
collective_anomalies(sampler.res)

plot(sampler.res,marginals=TRUE)

</code></pre>

<hr>
<h2 id='capa'>A technique for detecting anomalous segments and points based on CAPA.</h2><span id='topic+capa'></span>

<h3>Description</h3>

<p>A technique for detecting anomalous segments and points based on CAPA (Collective And Point Anomalies) by Fisch et al. (2022).
This is a generic method that can be used for both univariate and multivariate data. The specific method that is used for the analysis is deduced by <code>capa</code> from the dimensions of the data.
The inputted data is either a vector (in the case of a univariate time-series) or a array with p columns (if the the time-series is p-dimensional). The CAPA procedure assumes that each component
of the time-series is standardised so that the non-anomalous segments of each component have mean 0 and variance 1. This may require pre-processing/standardising.
For example, using the median of each component as a robust estimate of its mean, and the mad (median absolute deviation from the median) estimator to get a robust estimate of the variance.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>capa(
  x,
  beta,
  beta_tilde,
  type = "meanvar",
  min_seg_len = 10,
  max_seg_len = Inf,
  max_lag = 0
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="capa_+3A_x">x</code></td>
<td>
<p>A numeric matrix with n rows and p columns containing the data which is to be inspected. The time series data classes ts, xts, and zoo are also supported.</p>
</td></tr>
<tr><td><code id="capa_+3A_beta">beta</code></td>
<td>
<p>A numeric vector of length p giving the marginal penalties. If beta is missing and p == 1 then beta = 3log(n) when the type is &quot;mean&quot; or &quot;robustmean&quot;, and beta = 4log(n) otherwise.
If beta is missing and p &gt; 1, type =&quot;meanvar&quot; or type = &quot;mean&quot; and max_lag &gt; 0 then it defaults to the penalty
regime 2' described in Fisch, Eckley and Fearnhead (2022). If beta is missing and p &gt; 1, type = &quot;mean&quot;/&quot;meanvar&quot; and max_lag = 0 it defaults to the pointwise minimum of the penalty regimes
1, 2, and 3 in Fisch, Eckley and Fearnhead (2022).</p>
</td></tr>
<tr><td><code id="capa_+3A_beta_tilde">beta_tilde</code></td>
<td>
<p>A numeric constant indicating the penalty for adding an additional point anomaly. If beta_tilda is missing it defaults to 3log(np), where n and p are the data dimensions.</p>
</td></tr>
<tr><td><code id="capa_+3A_type">type</code></td>
<td>
<p>A string indicating which type of deviations from the baseline are considered. Can be &quot;meanvar&quot; for collective anomalies characterised by joint changes in mean and
variance (the default), &quot;mean&quot; for collective anomalies characterised by changes in mean only, or &quot;robustmean&quot; (only allowed when p = 1) for collective anomalies characterised by changes in mean only which can be polluted by outliers.</p>
</td></tr>
<tr><td><code id="capa_+3A_min_seg_len">min_seg_len</code></td>
<td>
<p>An integer indicating the minimum length of epidemic changes. It must be at least 2 and defaults to 10.</p>
</td></tr>
<tr><td><code id="capa_+3A_max_seg_len">max_seg_len</code></td>
<td>
<p>An integer indicating the maximum length of epidemic changes. It must be at least min_seg_len and defaults to Inf.</p>
</td></tr>
<tr><td><code id="capa_+3A_max_lag">max_lag</code></td>
<td>
<p>A non-negative integer indicating the maximum start or end lag. Only useful for multivariate data. Default value is 0.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An instance of an S4 class of type capa.class.
</p>


<h3>References</h3>

<p>Fisch ATM, Eckley IA, Fearnhead P (2022).
&ldquo;A linear time method for the detection of collective and point anomalies.&rdquo;
<em>Statistical Analysis and Data Mining: The ASA Data Science Journal</em>, <b>15</b>(4), 494-508.
<a href="https://doi.org/10.1002/sam.11586">doi:10.1002/sam.11586</a>.
</p>
<p>Fisch ATM, Grose D, Eckley IA, Fearnhead P, Bardwell L (2024).
&ldquo;anomaly: Detection of Anomalous Structure in Time Series Data.&rdquo;
<em>Journal of Statistical Software</em>, <b>110</b>(1), 1&ndash;24.
<a href="https://doi.org/10.18637/jss.v110.i01">doi:10.18637/jss.v110.i01</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(anomaly)
# generate some multivariate data
data(simulated)
res&lt;-capa(sim.data,type="mean",min_seg_len=2,max_lag=5)
collective_anomalies(res)
plot(res)

</code></pre>

<hr>
<h2 id='collective_anomalies'>Collective anomaly location, lags, and mean/variance changes.</h2><span id='topic+collective_anomalies'></span><span id='topic+collective_anomalies+2Cbard.sampler.class-method'></span><span id='topic+collective_anomalies+2Ccapa.class-method'></span><span id='topic+collective_anomalies+2Cpass.class-method'></span>

<h3>Description</h3>

<p>Creates a data frame containing collective anomaly locations, lags and changes in mean and variance as detected by <code><a href="#topic+capa">capa</a></code>, <code><a href="#topic+pass">pass</a></code>, and <code><a href="#topic+sampler">sampler</a></code>. 
</p>
<p>For an object created by <code><a href="#topic+capa">capa</a></code> returns a data frame with columns containing the start and end position of the anomaly, the change in mean
due to the anomaly. For multivariate data a data frame with columns containing the start and end position of the anomaly, the variates 
affected by the anomaly, as well as their the start and end lags. When <code>type="mean"/"robustmean"</code> only the change in mean is reported. When <code>type="meanvar"</code> both the change in mean and
change in variance are included. If <code>merged=FALSE</code> (the default), then all the collective anomalies are processed individually even if they are common across multiple variates.
If <code>merged=TRUE</code>, then the collective anomalies are grouped together across all variates that they appear in.
</p>
<p>For an object produced by <code><a href="#topic+pass">pass</a></code> or <code>sampler</code> returns a data frame containing the start, end and strength of the collective anomalies.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>collective_anomalies(object, ...)

## S4 method for signature 'bard.sampler.class'
collective_anomalies(object)

## S4 method for signature 'capa.class'
collective_anomalies(object, epoch = nrow(object@data), merged = FALSE)

## S4 method for signature 'pass.class'
collective_anomalies(object)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="collective_anomalies_+3A_object">object</code></td>
<td>
<p>An instance of an S4 class produced by <code><a href="#topic+capa">capa</a></code>.</p>
</td></tr>
<tr><td><code id="collective_anomalies_+3A_...">...</code></td>
<td>
<p>TODO</p>
</td></tr>
<tr><td><code id="collective_anomalies_+3A_epoch">epoch</code></td>
<td>
<p>Positive integer. CAPA methods are sequential and as such, can generate results up to, and including, any epoch within the data series. This can be controlled by the value
of <code>epoch</code> and is useful for examining how the inferred anomalies are modified as the data series grows. The default value for <code>epoch</code> is the length of the data series.</p>
</td></tr>
<tr><td><code id="collective_anomalies_+3A_merged">merged</code></td>
<td>
<p>Boolean value. If <code>merged=TRUE</code> then collective anomalies that are common across multiple variates are merged together. This is useful when comparing the relative strength
of multivariate collective anomalies. Default value is <code>merged=FALSE</code>. Note - <code>merged=TRUE</code> is currently only available when <code>type="mean"</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+capa">capa</a></code>,<code><a href="#topic+pass">pass</a></code>,<code><a href="#topic+sampler">sampler</a></code>.
</p>

<hr>
<h2 id='machinetemp'>Machine temperature data.</h2><span id='topic+machinetemp'></span>

<h3>Description</h3>

<p>Temperature sensor data of an internal component of a large, industrial machine. The data contains three known anomalies.
The first anomaly is a planned shutdown of the machine. The second anomaly is difficult to detect and directly led to the third anomaly, a catastrophic failure of the machine.
The data consists of 22695 observations of machine temperature recorded at 5 minute intervals along with the date and time of the measurement. The data was obtained from the Numenta
Anomaly Benchmark (Ahmad et al. 2017), which can be found at https://github.com/numenta/NAB.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(machinetemp)
</code></pre>


<h3>Format</h3>

<p>A dataframe with 22695 rows and 2 columns. The first column contains the date and time of the temperature measurement. The second column contains the
machine temperature.
</p>


<h3>References</h3>

<p>Ahmad S, Lavin A, Purdy S, Agha Z (2017).
&ldquo;Unsupervised real-time anomaly detection for streaming data.&rdquo;
<em>Neurocomputing</em>, <b>262</b>, 134 - 147.
ISSN 0925-2312, <a href="https://doi.org/10.1016/j.neucom.2017.04.070">doi:10.1016/j.neucom.2017.04.070</a>, Online Real-Time Learning Strategies for Data Streams, <a href="https://www.sciencedirect.com/science/article/pii/S0925231217309864/">https://www.sciencedirect.com/science/article/pii/S0925231217309864/</a>.
</p>

<hr>
<h2 id='pass'>Detection of multivariate anomalous segments using PASS.</h2><span id='topic+pass'></span>

<h3>Description</h3>

<p>Implements the PASS (Proportion Adaptive Segment Selection) procedure of Jeng et al. (2012). PASS uses a higher criticism statistic to pool the information about the 
presence or absence of a collective anomaly across the components. It uses Circular Binary Segmentation to detect multiple collective anomalies.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pass(x, alpha = 2, lambda = NULL, max_seg_len = 10, min_seg_len = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pass_+3A_x">x</code></td>
<td>
<p>A numeric matrix with n rows and p columns containing the data which is to be inspected. The time series data classes ts, xts, and zoo are also supported.</p>
</td></tr>
<tr><td><code id="pass_+3A_alpha">alpha</code></td>
<td>
<p>A positive integer &gt; 0. This value is used to stabilise the higher criticism based test statistic used by PASS leading to a better finite sample familywise error rate. 
Anomalies affecting fewer than alpha components will however in all likelihood escape detection. The default is 2.</p>
</td></tr>
<tr><td><code id="pass_+3A_lambda">lambda</code></td>
<td>
<p>A positive real value setting the threshold value for the familywise Type 1 error. The default value
is <code class="reqn">(1.1 {\rm log}(n \times max\_seg\_len) +2 {\rm log}({\rm log}(p))) / \sqrt{{\rm log}({\rm log}(p))}</code>.</p>
</td></tr>
<tr><td><code id="pass_+3A_max_seg_len">max_seg_len</code></td>
<td>
<p>A positive integer (<code>max_seg_len</code> &gt; 0) corresponding to the maximum interval length. This parameter corresponds to L in Jeng et al. (2012). The default value is 10.</p>
</td></tr>
<tr><td><code id="pass_+3A_min_seg_len">min_seg_len</code></td>
<td>
<p>A positive integer (<code>max_seg_len</code> &gt;= <code>min_seg_len</code> &gt; 0) corresponding to the minimum segment length.
The default value is 1.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An instance of an S4 object of type <code>.pass.class</code> containing the data <code>X</code>, procedure parameter values, and the results.
</p>


<h3>References</h3>

<p>Jeng XJ, Cai TT, Li H (2012).
&ldquo;Simultaneous discovery of rare and common segment variants.&rdquo;
<em>Biometrika</em>, <b>100</b>(1), 157-172.
ISSN 0006-3444, <a href="https://doi.org/10.1093/biomet/ass059">doi:10.1093/biomet/ass059</a>, <a href="https://academic.oup.com/biomet/article/100/1/157/193108">https://academic.oup.com/biomet/article/100/1/157/193108</a>.
</p>
<p>Fisch ATM, Grose D, Eckley IA, Fearnhead P, Bardwell L (2024).
&ldquo;anomaly: Detection of Anomalous Structure in Time Series Data.&rdquo;
<em>Journal of Statistical Software</em>, <b>110</b>(1), 1&ndash;24.
<a href="https://doi.org/10.18637/jss.v110.i01">doi:10.18637/jss.v110.i01</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(anomaly)
# generate some multivariate data
data(simulated)
res&lt;-pass(sim.data)
summary(res)
plot(res,variate_names=TRUE)

</code></pre>

<hr>
<h2 id='plot'>Visualisation of data, collective and point anomalies.</h2><span id='topic+plot+2Cbard.sampler.class-method'></span><span id='topic+plot+2Cbard.sampler.class'></span><span id='topic+plot+2Ccapa.class-method'></span><span id='topic+plot+2Ccapa.class'></span><span id='topic+plot+2Cpass.class-method'></span><span id='topic+plot+2Cpass.class'></span>

<h3>Description</h3>

<p>Plot methods for S4 objects returned by <code><a href="#topic+capa">capa</a></code>, <code><a href="#topic+pass">pass</a></code>, and <code><a href="#topic+sampler">sampler</a></code>. 
</p>
<p>The plot can either be a line plot or a tile plot, the type produced depending on the options provided to the <code>plot</code> function and/or the dimensions of the
data associated with the S4 object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'bard.sampler.class'
plot(x, subset, variate_names, tile_plot, marginals = FALSE)

## S4 method for signature 'capa.class'
plot(x, subset, variate_names = FALSE, tile_plot, epoch = nrow(x@data))

## S4 method for signature 'pass.class'
plot(x, subset, variate_names = FALSE, tile_plot)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_+3A_x">x</code></td>
<td>
<p>An instance of an S4 class produced by <code><a href="#topic+capa">capa</a></code>, <code><a href="#topic+pass">pass</a></code>, or <code><a href="#topic+sampler">sampler</a></code>.</p>
</td></tr>
<tr><td><code id="plot_+3A_subset">subset</code></td>
<td>
<p>A numeric vector specifying a subset of the variates to be displayed. Default value is all of the variates present in the data.</p>
</td></tr>
<tr><td><code id="plot_+3A_variate_names">variate_names</code></td>
<td>
<p>Logical value indicating if variate names should be displayed on the plot. This is useful when a large number of variates are being displayed
as it makes the visualisation easier to interpret. Default value is FALSE.</p>
</td></tr>
<tr><td><code id="plot_+3A_tile_plot">tile_plot</code></td>
<td>
<p>Logical value. If TRUE then a tile plot of the data is produced. The data displayed in the tile plot is normalised to values in [0,1] for each variate.
This type of plot is useful when the data contains are large number of variates. The default value is TRUE if the number of variates is greater than 20.</p>
</td></tr>
<tr><td><code id="plot_+3A_marginals">marginals</code></td>
<td>
<p>Logical value. If <code>marginals=TRUE</code> the plot will include visualisations of the marginal probablities of each time point being anomalous.
The defualt is <code>marginals=FALSE</code>.</p>
</td></tr>
<tr><td><code id="plot_+3A_epoch">epoch</code></td>
<td>
<p>Positive integer. CAPA methods are sequential and as such, can generate results up to, and including, any epoch within the data series. This can be controlled by the value
of <code>epoch</code> and is useful for examining how the inferred anomalies are modified as the data series grows. The default value for <code>epoch</code> is the length of the data series.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A ggplot object.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+capa">capa</a></code>,<code><a href="#topic+pass">pass</a></code>,<code><a href="#topic+sampler">sampler</a></code>.
</p>

<hr>
<h2 id='point_anomalies'>Point anomaly location and strength.</h2><span id='topic+point_anomalies'></span><span id='topic+point_anomalies+2Ccapa.class-method'></span>

<h3>Description</h3>

<p>Creates a data frame containing point anomaly locations and strengths as detected by <code><a href="#topic+capa">capa</a></code>.
</p>
<p>Returns a data frame with columns containing the position, strength, and (for multivariate data) the variate number.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>point_anomalies(object, ...)

## S4 method for signature 'capa.class'
point_anomalies(object, epoch = nrow(object@data))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="point_anomalies_+3A_object">object</code></td>
<td>
<p>An instance of an S4 class produced by <code><a href="#topic+capa">capa</a></code>.</p>
</td></tr>
<tr><td><code id="point_anomalies_+3A_...">...</code></td>
<td>
<p>TODO</p>
</td></tr>
<tr><td><code id="point_anomalies_+3A_epoch">epoch</code></td>
<td>
<p>Positive integer. CAPA methods are sequential and as such, can generate results up to, and including, any epoch within the data series. This can be controlled by the value
of <code>epoch</code> and is useful for examining how the inferred anomalies are modified as the data series grows. The default value for <code>epoch</code> is the length of the data series.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+capa">capa</a></code>.
</p>

<hr>
<h2 id='sampler'>Post processing of BARD results.</h2><span id='topic+sampler'></span>

<h3>Description</h3>

<p>Draw samples from the posterior distribution to give the locations of anomalous segments.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sampler(bard_result, gamma = 1/3, num_draws = 1000)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sampler_+3A_bard_result">bard_result</code></td>
<td>
<p>An instance of the S4 class <code>.bard.class</code> containing a result returned by the <code>bard</code> function.</p>
</td></tr>
<tr><td><code id="sampler_+3A_gamma">gamma</code></td>
<td>
<p>Parameter of loss function giving the cost of a false negative i.e. incorrectly allocating an anomalous point as being non-anomalous. 
For more details see Section 3.5 of Bardwell and Fearnhead (2017).</p>
</td></tr>
<tr><td><code id="sampler_+3A_num_draws">num_draws</code></td>
<td>
<p>Number of samples to draw from the posterior distribution.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns an S4 class of type <code>bard.sampler.class</code>.
</p>


<h3>References</h3>

<p>Bardwell L, Fearnhead P (2017).
&ldquo;Bayesian Detection of Abnormal Segments in Multiple Time Series.&rdquo;
<em>Bayesian Anal.</em>, <b>12</b>(1), 193&ndash;218.
</p>
<p>Fisch ATM, Grose D, Eckley IA, Fearnhead P, Bardwell L (2024).
&ldquo;anomaly: Detection of Anomalous Structure in Time Series Data.&rdquo;
<em>Journal of Statistical Software</em>, <b>110</b>(1), 1&ndash;24.
<a href="https://doi.org/10.18637/jss.v110.i01">doi:10.18637/jss.v110.i01</a>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+bard">bard</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(anomaly)
data(simulated)
# run bard
res&lt;-bard(sim.data, alpha = 1e-3, h = 0.5)
# sample 
sampler(res)

</code></pre>

<hr>
<h2 id='show'>Displays S4 objects produced by capa methods.</h2><span id='topic+show'></span><span id='topic+show+2Cbard.class-method'></span><span id='topic+show+2Cbard.sampler.class-method'></span><span id='topic+show+2Ccapa.class-method'></span><span id='topic+show+2Cpass.class-method'></span>

<h3>Description</h3>

<p>Displays S4 object produced by <code><a href="#topic+capa">capa</a></code>, <code><a href="#topic+pass">pass</a></code>, <code><a href="#topic+bard">bard</a></code>, and <code><a href="#topic+sampler">sampler</a></code>.
The output displayed depends on the type of S4 object passed to the method. For all types, the output indicates whether the data is univariate or
multivariate, the number of observations in the data, and the type of change being detected.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'bard.class'
show(object)

## S4 method for signature 'bard.sampler.class'
show(object)

## S4 method for signature 'capa.class'
show(object)

## S4 method for signature 'pass.class'
show(object)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="show_+3A_object">object</code></td>
<td>
<p>An instance of an S4 class produced by <code><a href="#topic+capa">capa</a></code>, <code><a href="#topic+pass">pass</a></code>, <code><a href="#topic+bard">bard</a></code>, or <code><a href="#topic+sampler">sampler</a></code>.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+capa">capa</a></code>,<code><a href="#topic+pass">pass</a></code>,<code><a href="#topic+bard">bard</a></code>,<code><a href="#topic+sampler">sampler</a></code>.
</p>

<hr>
<h2 id='sim.data'>Simulated data.</h2><span id='topic+sim.data'></span>

<h3>Description</h3>

<p>A simulated data set for use in the examples and vignettes. The data consists of 500 observations on 20 variates drawn from the standard normal distribution.
Within the data there are three multivariate anomalies of length 15 located at t=100, t=200, and t=300 for which the mean changes from 0 to 2. The anomalies affect
variates 1 to 8, 1 to 12 and 1 to 16 respectively.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(simulated)
</code></pre>


<h3>Format</h3>

<p>A matrix with 500 rows and 40 columns.
</p>

<hr>
<h2 id='summary'>Summary of collective and point anomalies.</h2><span id='topic+summary'></span><span id='topic+summary+2Cbard.class-method'></span><span id='topic+summary+2Cbard.sampler.class-method'></span><span id='topic+summary+2Ccapa.class-method'></span><span id='topic+summary+2Cpass.class-method'></span>

<h3>Description</h3>

<p>Summary methods for S4 objects returned by <code><a href="#topic+capa">capa</a></code>, 
<code><a href="#topic+pass">pass</a></code>, and <code><a href="#topic+sampler">sampler</a></code>.  The output displayed
depends on the type of object passed to summary. For all types, the output indicates whether the data is univariate or
multivariate, the number of observations in the data, and the type of change being detected.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'bard.class'
summary(object, ...)

## S4 method for signature 'bard.sampler.class'
summary(object, ...)

## S4 method for signature 'capa.class'
summary(object, epoch = nrow(object@data))

## S4 method for signature 'pass.class'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary_+3A_object">object</code></td>
<td>
<p>An instance of an S4 class produced by <code><a href="#topic+capa">capa</a></code> or <code><a href="#topic+pass">pass</a></code>.</p>
</td></tr>
<tr><td><code id="summary_+3A_...">...</code></td>
<td>
<p>Ignored.</p>
</td></tr>
<tr><td><code id="summary_+3A_epoch">epoch</code></td>
<td>
<p>Positive integer. CAPA methods are sequential and as such, can generate results up to, and including, any epoch within the data series. This can be controlled by the value
of <code>epoch</code> and is useful for examining how the inferred anomalies are modified as the data series grows. The default value for <code>epoch</code> is the length of the data series.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+capa">capa</a></code>, <code><a href="#topic+pass">pass</a></code>,<code><a href="#topic+sampler">sampler</a></code>.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
