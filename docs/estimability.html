<!DOCTYPE html><html><head><title>Help for package estimability</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {estimability}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#epredict'>
<p>Estimability Enhancements for <code>lm</code> and Relatives</p></a></li>
<li><a href='#estble.subspace'><p>Find an estimable subspace</p></a></li>
<li><a href='#estimability-package'>
<p>Estimability Tools for Linear Models</p></a></li>
<li><a href='#nonest.basis'><p>Estimability Tools</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Tools for Assessing Estimability of Linear Predictions</td>
</tr>
<tr>
<td>Version:</td>
<td>1.4.1</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-08-05</td>
</tr>
<tr>
<td>Depends:</td>
<td>stats</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides tools for determining estimability of linear functions 
  of regression coefficients, and 'epredict' methods that handle 
  non-estimable cases correctly. Estimability theory is discussed in
  many linear-models textbooks including Chapter 3 of Monahan, JF (2008), 
  "A Primer on Linear Models", Chapman and Hall (ISBN 978-1-4200-6201-4).</td>
</tr>
<tr>
<td>ByteCompile:</td>
<td>yes</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-08-04 17:40:33 UTC; rlenth</td>
</tr>
<tr>
<td>Author:</td>
<td>Russell Lenth [aut, cre, cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Russell Lenth &lt;russell-lenth@uiowa.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-08-05 15:00:13 UTC</td>
</tr>
<tr>
<td>Built:</td>
<td>R 4.3.0; ; 2022-11-15 09:13:50 UTC; unix</td>
</tr>
</table>
<hr>
<h2 id='epredict'>
Estimability Enhancements for <code>lm</code> and Relatives
</h2><span id='topic+epredict'></span><span id='topic+epredict.lm'></span><span id='topic+epredict.glm'></span><span id='topic+epredict.mlm'></span><span id='topic+eupdate'></span><span id='topic+eupdate.lm'></span>

<h3>Description</h3>

<p>These functions call the corresponding S3 <code>predict</code> methods in the <span class="pkg">stats</span> package, but with a check for estimability of new predictions, and with appropriate actions for non-estimable cases.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'lm'
epredict(object, newdata, ..., 
    type = c("response", "terms", "matrix", "estimability"), 
    nonest.tol = 1e-8, nbasis = object$nonest)
## S3 method for class 'glm'
epredict(object, newdata, ..., 
    type = c("link", "response", "terms", "matrix", "estimability"), 
    nonest.tol = 1e-8, nbasis = object$nonest)
## S3 method for class 'mlm'
epredict(object, newdata, ..., 
    type = c("response", "matrix", "estimability"), 
    nonest.tol = 1e-8, nbasis = object$nonest)
    
eupdate(object, ...)    
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="epredict_+3A_object">object</code></td>
<td>
<p>An object ingeriting from <code>lm</code></p>
</td></tr>
<tr><td><code id="epredict_+3A_newdata">newdata</code></td>
<td>
<p>A <code>data.frame</code> containing predictor combinations for new predictions</p>
</td></tr>
<tr><td><code id="epredict_+3A_...">...</code></td>
<td>
<p>Arguments passed to <code><a href="stats.html#topic+predict">predict</a></code> or <code><a href="stats.html#topic+update">update</a></code></p>
</td></tr>
<tr><td><code id="epredict_+3A_nonest.tol">nonest.tol</code></td>
<td>
<p>Tolerance used by <code><a href="estimability.html#topic+is.estble">is.estble</a></code> to check estimability of new predictions</p>
</td></tr>
<tr><td><code id="epredict_+3A_type">type</code></td>
<td>
<p>Character string specifying the desired result. See Details.</p>
</td></tr>
<tr><td><code id="epredict_+3A_nbasis">nbasis</code></td>
<td>
<p>Basis for the null space, e.g., a result of a call to <code><a href="estimability.html#topic+nonest.basis">nonest.basis</a></code>. If <code>nbasis</code> is <code>NULL</code>, a basis is constructed from <code>object</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>newdata</code> is missing or <code>object</code> is not rank-deficient, this method passes its arguments directly to the same method in the <span class="pkg">stats</span> library. In rank-deficient cases with <code>newdata</code> provided, each row of <code>newdata</code> is tested for estimability against the null basis provided in <code>nbasis</code>. Any non-estimable cases found are replaced with <code>NA</code>s.
</p>
<p>The <code>type</code> argument is passed to <code><a href="stats.html#topic+predict">predict</a></code> when it is one of <code>"response"</code>, <code>"link"</code>, or <code>"terms"</code>. With <code>newdata</code> present and <code>type = "matrix"</code>, the model matrix for <code>newdata</code> is returned, with an attribute <code>"estble"</code> that is a logical vector of length &lsquo;<span class="samp">&#8288;nrow(newdata)&#8288;</span>&rsquo; indicating whether each row is estimable. With <code>type = "estimability"</code>, just the logical vector is returned.
</p>
<p>If you anticipate making several <code>epredict</code> calls with new data, it improves efficiency to either obtain the null basis and provide it in the call, or add it to <code>object</code> with the name <code>"nonest"</code> (perhaps via a call to <code>eupdate</code>).
</p>
<p><code>eupdate</code> is an S3 generic function with a method provided for <code>"lm"</code> objects. It updates the object according to any arguments in <code>...</code>, then obtains the updated object's nonestimable basis and returns it in <code>object$nonest</code>.
</p>


<h3>Value</h3>

<p>The same as the result of a call to the <code>predict</code> method in the <span class="pkg">stats</span> package, except rows or elements corresponding to non-estimable predictor combinations are set to <code>NA</code>. The value for <code>type</code> is  <code>"matrix"</code> or <code>"estimability"</code> is explained under details.</p>


<h3>Note</h3>

<p>The usual rank-deficiency warning from <code>stats::predict</code> is suppressed; but when non-estimable cases are found, a message is displayed explaining that these results were replaced by <code>NA</code>. If you wish that message suppressed, use &lsquo;<span class="samp">&#8288;options(estimability.quiet = TRUE)&#8288;</span>&rsquo;.
</p>


<h3>Author(s)</h3>

<p>Russell V. Lenth &lt;russell-lenth@uiowa.edu&gt;
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+predict.lm">predict.lm</a></code> in the <span class="pkg">stats</span> package;   
<code><a href="estimability.html#topic+nonest.basis">nonest.basis</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>require("estimability")

# Fake data where x3 and x4 depend on x1, x2, and intercept
x1 &lt;- -4:4
x2 &lt;- c(-2,1,-1,2,0,2,-1,1,-2)
x3 &lt;- 3*x1 - 2*x2
x4 &lt;- x2 - x1 + 4
y &lt;- 1 + x1 + x2 + x3 + x4 + c(-.5,.5,.5,-.5,0,.5,-.5,-.5,.5)

# Different orderings of predictors produce different solutions
mod1234 &lt;- lm(y ~ x1 + x2 + x3 + x4)
mod4321 &lt;- eupdate(lm(y ~ x4 + x3 + x2 + x1))
# (Estimability checking with mod4321 will be more efficient because
#  it will not need to recreate the basis)
mod4321$nonest

 
# test data:
testset &lt;- data.frame( 
              x1 = c(3,  6,  6,  0,  0,  1), 
              x2 = c(1,  2,  2,  0,  0,  2), 
              x3 = c(7, 14, 14,  0,  0,  3), 
              x4 = c(2,  4,  0,  4,  0,  4))

# Look at predictions when we don't check estimability
suppressWarnings( # Disable the warning from stats::predict.lm
    rbind(p1234 = predict(mod1234, newdata = testset),
          p4321 = predict(mod4321, newdata = testset)))

# Compare with results when we do check:
rbind(p1234 = epredict(mod1234, newdata = testset),
      p4321 = epredict(mod4321, newdata = testset))

# Note that estimable cases have the same predictions

# change mod1234 and include nonest basis 
mod134 &lt;- eupdate(mod1234, . ~ . - x2, subset = -c(3, 7))
mod134$nonest

# When row spaces are the same, bases are interchangeable
# so long as you account for the ordering of parameters:
epredict(mod4321, newdata = testset, type = "estimability",
    nbasis = nonest.basis(mod1234)[c(1,5:2), ])
    
## Not run: 
### Additional illustration
example(nonest.basis)  ## creates model objects warp.lm1 and warp.lm2

# The two models have different contrast specs. But the empty cell
# is correctly identified in both:
fac.cmb &lt;- expand.grid(wool = c("A", "B"), tension = c("L", "M", "H"))
cbind(fac.cmb, 
      pred1 = epredict(warp.lm1, newdata = fac.cmb), 
      pred2 = epredict(warp.lm2, newdata = fac.cmb))

## End(Not run) 

</code></pre>

<hr>
<h2 id='estble.subspace'>Find an estimable subspace</h2><span id='topic+estble.subspace'></span>

<h3>Description</h3>

<p>Determine a transformation <code>B</code> of the rows of a matrix <code>L</code>
such that <code>B %*% L</code> is estimable.
A practical example is in jointly testing a set of contrasts <code>L</code>
in a linear model, and we need to restrict to the subspace spanned by
the rows of <code>L</code> that are estimable.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estble.subspace (L, nbasis, tol = 1e-8)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="estble.subspace_+3A_l">L</code></td>
<td>
<p>A matrix of dimensions <em>k</em> by <em>p</em></p>
</td></tr>
<tr><td><code id="estble.subspace_+3A_nbasis">nbasis</code></td>
<td>
<p>A <em>k</em> by <em>b</em> matrix whose columns form a
basis for non-estimable linear functions &ndash; such as is returned 
by <code><a href="estimability.html#topic+nonest.basis">nonest.basis</a></code></p>
</td></tr>
<tr><td><code id="estble.subspace_+3A_tol">tol</code></td>
<td>
<p>Numeric tolerance for assessing nonestimability. See
<code><a href="estimability.html#topic+is.estble">is.estble</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>We require <code>B</code> such that all the rows of <code>M = B %*% L</code>
are estimable, i.e. orthogonal to the columns of <code>nbasis</code>.
Thus, we need <code>B %*% L %*% nbasis</code> to be zero, or equivalently,
<code>t(B)</code> must be in the null space of <code>t(L %*% nbasis)</code>.
This can be found using <code><a href="estimability.html#topic+nonest.basis">nonest.basis</a></code>.
</p>


<h3>Value</h3>

<p>An <em>r</em> by <em>p</em> matrix <code>M = B %*% L</code> 
whose rows are all orthogonal to the columns of 
<code>nbasis</code>. The matrix <code>B</code> is attached as <code>attr(M, "B")</code>.
Note that if any rows of <code>L</code> were non-estimable, then <em>r</em>
will be less than <em>k</em>. In fact, if there are no estimable functions 
in the row space of <code>L</code>, then <em>r</em> = 0.
</p>


<h3>Author(s)</h3>

<p>Russell V. Lenth &lt;russell-lenth@uiowa.edu&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>### Find a set of estimable interaction contrasts for a 3 x 4 design 
### with two empty cells.
des &lt;- expand.grid(A = factor(1:3), B = factor(1:4))
des &lt;- des[-c(5, 12), ]  # cells (2,2) and (3,4) are empty

X &lt;- model.matrix(~ A * B, data = des)
N &lt;- nonest.basis(X)

L &lt;- cbind(matrix(0, nrow = 6, ncol = 6), diag(6))
# i.e., give nonzero weight only to interaction effects

estble.subspace(L, N)

# Tougher demo: create a variation where all rows of L are non-estimable
LL &lt;- matrix(rnorm(36), ncol = 6) %*% L
estble.subspace(LL, N)
</code></pre>

<hr>
<h2 id='estimability-package'>
Estimability Tools for Linear Models
</h2><span id='topic+estimability-package'></span><span id='topic+estimability'></span>

<h3>Description</h3>

<p>Provides tools for determining estimability of linear functions of regression coefficients, 
and alternative <code>epredict</code> methods for <code>lm</code>, <code>glm</code>, and <code>mlm</code> objects that handle non-estimable cases correctly.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> estimability</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Details: </td><td style="text-align: left;"> See DESCRIPTION file</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>When a linear model is not of full rank, the regression coefficients are not 
uniquely estimable. However, the predicted values are unique, as are other linear 
combinations where the coefficients lie in the row space of the data matrix. Thus, 
estimability of a linear function of regression coefficients can be determined by 
testing whether the coefficients lie in this row space &ndash; or equivalently, are 
orthogonal to the corresponding null space. 
</p>
<p>This package provides functions <code><a href="estimability.html#topic+nonest.basis">nonest.basis</a></code> and 
<code><a href="estimability.html#topic+is.estble">is.estble</a></code> to facilitate such an estimability test. 
Package developers may find these useful for incorporating in their 
<code>predict</code> methods when new predictor settings are involved.
</p>
<p>The function <code><a href="estimability.html#topic+estble.subspace">estble.subspace</a></code> is useful for projecting
a matrix onto an estimable subspace whose rows are all estimable.
</p>
<p>The package also provides <code><a href="estimability.html#topic+epredict">epredict</a></code> methods &ndash; 
alternatives to the <code><a href="stats.html#topic+predict">predict</a></code> methods in the <span class="pkg">stats</span> 
package for <code>"lm"</code>, <code>"glm"</code>, and <code>"mlm"</code> objects. 
When the <code>newdata</code> argument is specified, estimability of each 
new prediction is checked and any non-estimable cases are replaced by <code>NA</code>. 
</p>


<h3>Author(s)</h3>

<p>Russell V. Lenth &lt;russell-lenth@uiowa.edu&gt;
</p>


<h3>References</h3>

<p>Monahan, John F. (2008) <em>A Primer on Linear Models</em>, CRC Press. (Chapter 3)
</p>

<hr>
<h2 id='nonest.basis'>Estimability Tools</h2><span id='topic+nonest.basis'></span><span id='topic+nonest.basis.qr'></span><span id='topic+nonest.basis.matrix'></span><span id='topic+nonest.basis.lm'></span><span id='topic+nonest.basis.svd'></span><span id='topic+nonest.basis.default'></span><span id='topic+all.estble'></span><span id='topic+is.estble'></span>

<h3>Description</h3>

<p>This documents the functions needed to test estimability of linear functions of regression coefficients.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nonest.basis(x, ...)
## Default S3 method:
nonest.basis(x, ...)
## S3 method for class 'qr'
nonest.basis(x, ...)
## S3 method for class 'matrix'
nonest.basis(x, ...)
## S3 method for class 'lm'
nonest.basis(x, ...)
## S3 method for class 'svd'
nonest.basis(x, tol = 5e-8, ...)

all.estble

is.estble(x, nbasis, tol = 1e-8)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nonest.basis_+3A_x">x</code></td>
<td>
<p>For <code>nonest.basis</code>, an object of a class in &lsquo;<span class="samp">&#8288;methods("nonest.basis")&#8288;</span>&rsquo;. Or, in <code>is.estble</code>, a numeric vector or matrix for assessing estimability of &lsquo;<span class="samp">&#8288;sum(x * beta)&#8288;</span>&rsquo;, where <code>beta</code> is the vector of regression coefficients.</p>
</td></tr>
<tr><td><code id="nonest.basis_+3A_nbasis">nbasis</code></td>
<td>
<p>Matrix whose columns span the null space of the model matrix. Such a matrix is returned by <code>nonest.basis</code>.</p>
</td></tr>
<tr><td><code id="nonest.basis_+3A_tol">tol</code></td>
<td>
<p>Numeric tolerance for assessing rank or nonestimability. 
For determining rank, singular values less than <code>tol</code> times the largest singular value are regarded as zero.
For determining estimability with a nonzero <code class="reqn">x</code>, <code class="reqn">\beta'x</code> is assessed by whether or not <code class="reqn">||N'x||^2 &lt; \tau ||x'x||^2</code>, where <code class="reqn">N</code> and <code class="reqn">\tau</code> denote <code>nbasis</code> and <code>tol</code>, respectively.</p>
</td></tr>
<tr><td><code id="nonest.basis_+3A_...">...</code></td>
<td>
<p>Additional arguments passed to other methods.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Consider a linear model <code class="reqn">y = X\beta + E</code>. If <code class="reqn">X</code> is not of full rank, it is not possible to estimate <code class="reqn">\beta</code> uniquely. However, <code class="reqn">X\beta</code> <em>is</em> uniquely estimable, and so is <code class="reqn">a'X\beta</code> for any conformable vector <code class="reqn">a</code>. Since <code class="reqn">a'X</code> comprises a linear combination of the rows of <code class="reqn">X</code>, it follows that we can estimate any linear function where the coefficients lie in the row space of <code class="reqn">X</code>. Equivalently, we can check to ensure that the coefficients are orthogonal to the null space of <code class="reqn">X</code>.
</p>
<p>The <code>nonest.basis</code> method for class <code>'svd'</code> is not really functional as a method because there is no <code>"svd"</code> class (at least in R &lt;= 4.2.0). But the function <code>nonest.basis.svd</code> is exported and may be called directly; it works with results of <code><a href="base.html#topic+svd">svd</a></code> or <code><a href="base.html#topic+La.svd">La.svd</a></code>. We <em>require</em> <code>x$v</code> to be the complete matrix of right singular values; but we do not need <code>x$u</code> at all.
</p>
<p>The <code>default</code> method does serve as an <code>svd</code> method, in that it only works if <code>x</code> has the required elements of an SVD result, in which case it passes it to <code>nonest.basis.svd</code>.
The <code>matrix</code> method runs <code>nonest.basis.svd(svd(x, nu = 0))</code>. The <code>lm</code> method runs the <code>qr</code> method on <code>x$qr</code>.
</p>
<p>The constant <code>all.estble</code> is simply a 1 x 1 matrix of <code>NA</code>. This specifies a trivial non-estimability basis, and using it as <code>nbasis</code> will cause everything to test as estimable. 
</p>


<h3>Value</h3>

<p>When <code class="reqn">X</code> is not full-rank, the methods for <code>nonest.basis</code> return a basis for the null space of <code class="reqn">X</code>. The number of rows is equal to the number of regression coefficients (<em>including</em> any <code>NA</code>s); and the number of columns is equal to the rank deficiency of the model matrix. The columns are orthonormal. If the model is full-rank, then <code>nonest.basis</code> returns <code>all.estble</code>. The <code>matrix</code> method uses <code class="reqn">X</code> itself, the <code>qr</code> method uses the <code class="reqn">QR</code> decomposition of <code class="reqn">X</code>, and the <code>lm</code> method recovers the required information from the object.
</p>
<p>The function <code>is.estble</code> returns a logical value (or vector, if <code>x</code> is a matrix) that is <code>TRUE</code> if the function is estimable and <code>FALSE</code> if not. 
</p>


<h3>Author(s)</h3>

<p>Russell V. Lenth &lt;russell-lenth@uiowa.edu&gt;
</p>


<h3>References</h3>

<p>Monahan, John F. (2008) <em>A Primer on Linear Models</em>, CRC Press. (Chapter 3)
</p>


<h3>Examples</h3>

<pre><code class='language-R'>require(estimability)

X &lt;- cbind(rep(1,5), 1:5, 5:1, 2:6)
( nb &lt;- nonest.basis(X) )

SVD &lt;- svd(X, nu = 0)    # we don't need the U part of UDV'
nonest.basis.svd(SVD)    # same result as above

# Test estimability of some linear functions for this X matrix
lfs &lt;- rbind(c(1,4,2,5), c(2,3,9,5), c(1,2,2,1), c(0,1,-1,1))
is.estble(lfs, nb)

# Illustration on 'lm' objects:
warp.lm1 &lt;- lm(breaks ~ wool * tension, data = warpbreaks, 
    subset = -(26:38), 
    contrasts = list(wool = "contr.treatment", tension = "contr.treatment"))
zapsmall(warp.nb1 &lt;- nonest.basis(warp.lm1))

warp.lm2 &lt;- update(warp.lm1, 
    contrasts = list(wool = "contr.sum", tension = "contr.helmert"))
zapsmall(warp.nb2 &lt;- nonest.basis(warp.lm2))

# These bases look different, but they both correctly identify the empty cell
wcells = with(warpbreaks, expand.grid(wool = levels(wool), tension = levels(tension)))
epredict(warp.lm1, newdata = wcells, nbasis = warp.nb1)
epredict(warp.lm2, newdata = wcells, nbasis = warp.nb2)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
