<!DOCTYPE html><html><head><title>Help for package etasFLP</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {etasFLP}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#etasFLP-package'><p>Mixed FLP and ML Estimation of ETAS Space-Time Point Processes</p></a></li>
<li><a href='#b.guten'>
<p>Estimates the parameter of the Gutenberg-Richter law.</p></a></li>
<li><a href='#bwd.nrd'>
<p>Silverman's rule optimal for the estimation of a kernel bandwidth</p></a></li>
<li><a href='#californiacatalog'><p>Sample catalog of North California earthquakes</p></a></li>
<li><a href='#catalog.withcov'><p>Small sample catalog of italian earthquakes with covariates</p></a></li>
<li><a href='#compare.etasclass'>
<p>Compare two etasclass objects</p></a></li>
<li><a href='#daily.etasclass'><p>Title daily.etasclass</p></a></li>
<li><a href='#eqcat'>
<p>Check earthquake catalog</p></a></li>
<li><a href='#etas.starting'><p>Guess starting values of ETAS parameters (beta-version). Only from package version 1.2.0</p></a></li>
<li><a href='#etasclass'><p>Mixed estimation of an ETAS model (renewed in version 2.0)</p></a></li>
<li><a href='#etasFLP-internal'><p>Internal etasFLP functions</p></a></li>
<li><a href='#italycatalog'><p>Small sample catalog of italian earthquakes</p></a></li>
<li><a href='#kde2dnew.fortran'><p>A 2-d normal kernel estimator</p></a></li>
<li><a href='#magn.plot'>
<p>Transformed plot of the magnitudes distribution of an earthquakes catalog</p></a></li>
<li><a href='#MLA.freq'><p>Display a pretty frequency table</p></a></li>
<li><a href='#plot.etasclass'><p>Plot method for etasclass objects</p></a></li>
<li><a href='#plot.profile.etasclass'><p>plot method for profile.etasclass objects (profile likelihood of ETAS model)</p></a></li>
<li><a href='#print.etasclass'><p>Print method for etasclass objects</p></a></li>
<li><a href='#profile.etasclass'><p>profile method for etasclass objects (ETAS model) (To be checked)</p></a></li>
<li><a href='#simpson.coeff'>
<p>Computes Simpson integration rule coefficients</p></a></li>
<li><a href='#summary.etasclass'><p>Summary method for etasclass objects</p></a></li>
<li><a href='#time2date'>
<p>Date time conversion tools</p></a></li>
<li><a href='#timeupdate.etasclass'><p>timeupdate.etasclass</p></a></li>
<li><a href='#update.etasclass'><p>update.etasclass</p></a></li>
<li><a href='#xy.grid'>
<p>Creates a 2-d grid</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Mixed FLP and ML Estimation of ETAS Space-Time Point Processes
for Earthquake Description</td>
</tr>
<tr>
<td>Version:</td>
<td>2.2.2</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-09-14</td>
</tr>
<tr>
<td>Description:</td>
<td>Estimation of the components of an ETAS (Epidemic Type Aftershock Sequence) model for earthquake description. Non-parametric background seismicity can be estimated through FLP (Forward Likelihood Predictive). New version 2.0.0: covariates have been introduced to explain the effects of external factors on the induced seismicity; the parametrization has been changed; Chiodi, Adelfio (2017)&lt;<a href="https://doi.org/10.18637%2Fjss.v076.i03">doi:10.18637/jss.v076.i03</a>&gt;.</td>
</tr>
<tr>
<td>Imports:</td>
<td>fields,maps</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0), mapdata</td>
</tr>
<tr>
<td>Author:</td>
<td>Marcello Chiodi [aut, cre],
  Giada Adelfio [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Marcello Chiodi &lt;marcello.chiodi@unipa.it&gt;</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-09-14 13:22:09 UTC; marcello</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-09-14 14:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='etasFLP-package'>Mixed FLP and ML Estimation of ETAS Space-Time Point Processes
</h2><span id='topic+etasFLP-package'></span><span id='topic+etasFLP'></span>

<h3>Description</h3>

<p><em>New  version 2.2.0</em>. Covariates have been introduced to explain the effects of external factors on the induced seismicity. Since the parametrization is changed, the etasclass object created with the previous versions are not compatible with the one obtained with the current version. Estimation of the components of an ETAS (Epidemic Type Aftershock Sequence) model for earthquake description. Non-parametric background seismicity can be estimated through FLP (Forward Likelihood Predictive), while parametric components are estimated through maximum likelihood. The two estimation steps are alternated until convergence is obtained. For each event the probability of being a background event is estimated and used as a weight for declustering steps. Many options to control the estimation process are present, together with some diagnostic tools.
Some descriptive functions for earthquakes catalogs are  included; also <code>plot</code>, <code>print</code>, <code>summary</code>, <code>profile</code> methods are defined for main output (objects of class <code>etasclass</code>); update methods are now present.</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> etasFLP</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 2.2.2</td>
</tr>
<tr>
 <td style="text-align: left;">  
Date: </td><td style="text-align: left;"> 2023-09-14</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL (&gt;=2) </td>
</tr>
<tr>
 <td style="text-align: left;">
Imports: fields,maps
Depends: </td><td style="text-align: left;"> R (&gt;= 3.5.0), mapdata </td>
</tr>
<tr>
 <td style="text-align: left;">
Suggests: </td><td style="text-align: left;"> MASS </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p><code>etasclass</code> is the main function of the package <code>etasFLP</code>: strongly renewed from version 2.0.
<code>update.etasclass</code> and <code>timeupdate.etasclass</code> two new different kind of updating existing <code>etasclass</code> objects. Very useful for large catalogues 
</p>


<h3>Note</h3>

<p>The package is intended for the estimation of the ETAS model for seismicity description (introduced by Ogata (1988), see reference),
but theoretically it can be used for other fields of application.
</p>


<h3>Author(s)</h3>

<p>Marcello Chiodi and Giada Adelfio
</p>
<p>Maintainer: Marcello Chiodi&lt;marcello.chiodi@unipa.it&gt;
</p>


<h3>References</h3>

<p>Adelfio G., Chiodi, M. (2009). Second-Order Diagnostics for Space-Time Point Processes with
Application to Seismic Events. <em>Environmetrics</em>, <b>20</b>(8), 895-911. doi:10.1002/env.961.
</p>
<p>Adelfio, G.,  Chiodi, M. (2013) Mixed estimation technique in semi-parametric space-time point processes for earthquake description. 
<em>Proceedings of the 28th International Workshop on Statistical Modelling 8-13 July, 2013, Palermo</em> (Muggeo VMR, Capursi V, Boscaino G, Lovison G, editors). Vol. <b>1</b>. pp.65-70.
</p>
<p>Adelfio, G., Chiodi, M. (2015) Alternated estimation in semi-parametric space-time branching-type point processes with application to seismic catalogs. 
<em>Stochastic Environmental Research and Risk Assessment</em>    <b>29</b>(2), pp. 443-450. DOI: 10.1007/s00477-014-0873-8
</p>
<p>Adelfio G., Chiodi, M. (2015). FLP Estimation of Semi-Parametric Models for Space-Time
Point Processes and Diagnostic Tools. <em>Spatial Statistics</em>, <b>14</b>(B), 119-132. doi:10.1016/j.spasta.2015.06.004.
</p>
<p>Adelfio G., Chiodi, M. (2020). Including covariates in a space-time point process with application to seismicity. <em>Statistical Methods and Applications
</em>,  doi:10.1007/s10260-020-00543-5.
</p>
<p>Adelfio G., Schoenberg, FP (2009). Point Process Diagnostics Based on Weighted Second-
Order Statistics and Their Asymptotic Properties. <em>The Annals of the Institute of Statistical
Mathematics</em>, <b>61</b>(4), 929-948. doi:10.1007/s10463-008-0177-1.
</p>
<p>Chiodi, M., Adelfio, G., (2011) Forward Likelihood-based predictive approach for space-time processes. <em>Environmetrics</em>, vol. <b>22</b> (6), pp. 749-757. DOI:10.1002/env.1121.
</p>
<p>Chiodi, M., Adelfio, G., (2017) Mixed Non-Parametric and Parametric Estimation Techniques in R Package etasFLP for Earthquakes' Description. <em>Journal of Statistical Software</em>, vol. <b>76</b> (3), pp. 1-29.
DOI: 10.18637/jss.v076.i03 
</p>
<p>Console, R.,  Jackson,   D. D. and  Kagan, Y. Y.
Using the ETAS model for Catalog Declustering and Seismic
Background Assessment. <em>Pure Applied Geophysics</em>
<b>167</b>, 819&ndash;830 (2010). DOI:10.1007/s00024-010-0065-5.
</p>
<p>Nicolis, O., Chiodi, M. and Adelfio G. (2015) Windowed ETAS models with application to the Chilean seismic catalogs, <em>Spatial Statistics</em>, Volume <b>14</b>, Part B, November 2015, Pages 151-165, ISSN 2211-6753, http://dx.doi.org/10.1016/j.spasta.2015.05.006.
</p>
<p>Ogata, Y.   Statistical models for earthquake
occurrences and residual analysis for point processes.
<em>Journal of the American Statistical Association</em>,
<b>83</b>,  9&ndash;27 (1988).
</p>
<p>Veen, A. , Schoenberg, F.P.  Estimation of space-time
branching process models in seismology using an EM-type algorithm.
<em>Journal of the American Statistical Association</em>, <b>103</b>(482), 614&ndash;624 (2008).
</p>
<p>Zhuang, J., Ogata, Y.  and Vere-Jones, D.
Stochastic declustering of space-time earthquake occurrences.
<em>Journal of the American Statistical Association</em>,
<b>97</b>,  369&ndash;379 (2002). DOI:10.1198/016214502760046925.
</p>

<hr>
<h2 id='b.guten'>
Estimates the parameter of the Gutenberg-Richter law.</h2><span id='topic+b.guten'></span>

<h3>Description</h3>

<p>Estimates the parameter of the Gutenberg-Richter law for the magnitude distribution   of earthquakes, given a threshold magnitude; it
uses moment estimator on transformed data.</p>


<h3>Usage</h3>

<pre><code class='language-R'>b.guten(magn, m0=min(magn))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="b.guten_+3A_magn">magn</code></td>
<td>

<p>a vector of magnitudes  coming from an earthquake catalog.
</p>
</td></tr>
<tr><td><code id="b.guten_+3A_m0">m0</code></td>
<td>
<p>A threshold value. Only values of <code>magn</code> not less than <code>m0</code> will be used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Maximum likelihodd estimation for the Gutenberg-Richter Law:
</p>
<p style="text-align: center;"><code class="reqn">\log_{10} N(&gt;m) = a - b \ M  </code>
</p>

<p>where <code class="reqn">N(&gt;m)</code> is the number of events exceeding a magnitude <code class="reqn">m</code> and <code class="reqn">a,b</code> are two parameters: <code class="reqn">a</code>  is related to the total seismicity rate of the region while <code class="reqn">b</code>, to be estimated, should be usually near 1.
</p>
<p>Catalog is assumed to be complete (in a certain space-time region) at least for a magnitude <code>m0</code>,
that is, every earthquake of magnitude at least <code>m0</code> in that space-time region, is certainly present in the catalog.</p>


<h3>Value</h3>

<table>
<tr><td><code>b</code></td>
<td>
<p>estimate of the parameter  <code class="reqn">b</code> of the Gutenberg-Richter Law.</p>
</td></tr>
<tr><td><code>se</code></td>
<td>
<p>estimate of the standard error of  the estimate <code>b</code>.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>the plot produced by <code>magn.plot</code> can be used to have an idea, for a given catalog, of the magnitude threshold value.</p>


<h3>Author(s)</h3>

<p>Marcello Chiodi
</p>


<h3>References</h3>

<p>Gutenberg, B. and Richter, C. F. (1944). Frequency of earthquakes in California.
<em>Bulletin of the Seismological Society of America</em>, 34, 185-188.
</p>


<h3>See Also</h3>

 <p><code><a href="#topic+magn.plot">magn.plot</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>
data(italycatalog)
b.guten(italycatalog$magn1)
</code></pre>

<hr>
<h2 id='bwd.nrd'>
Silverman's rule optimal for the estimation of a kernel bandwidth</h2><span id='topic+bwd.nrd'></span>

<h3>Description</h3>

<p>Computes the optimal bandwidth with the Silverman's rule of thumb,
to be used for a kernel estimator with given points and weights.</p>


<h3>Usage</h3>

<pre><code class='language-R'>bwd.nrd(x, w=replicate(length(x),1), d = 2)</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="bwd.nrd_+3A_x">x</code></td>
<td>
<p>numeric vector: sample points to be used for a normal kernel estimator.</p>
</td></tr>
<tr><td><code id="bwd.nrd_+3A_w">w</code></td>
<td>
<p>numeric vector of the same length of <code>x</code>: weights to give to the elements of <code>x</code>. Default is a vector of ones</p>
</td></tr>
<tr><td><code id="bwd.nrd_+3A_d">d</code></td>
<td>
<p>number of dimensions of the kernel estimator.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Computes the optimal bandwidth with the Silverman rule, for a kernel
estimator with points <code>x</code> and weights <code>w</code>. 
If a multivariate kernel is used, (i.e. <code>d</code> &gt; 1),   
<code>bwd.nrd</code> must be called for each variable. It computes dispersion only with the weighted standard deviation, with no robust alternative. Called by <code>kde2dnew.fortran</code>.</p>


<h3>Value</h3>

<p>The value of the bandwidth for a sample <code>x</code> and weights <code>w</code>.
</p>


<h3>Note</h3>

<p>It is used in connection with the the declustering method of <code>etasFLP</code>. Points with an higher probability of being part of the background seismicity will weight more in the estimation of the background seismicity.</p>


<h3>Note</h3>

<p>This is a slight  modification of <code><a href="stats.html#topic+bw.nrd">bw.nrd</a></code>.</p>


<h3>Author(s)</h3>

<p>Marcello Chiodi</p>


<h3>References</h3>

<p>Silverman, B.W. (1986). <em>Density Estimation for Statistics and Data Analysis</em>. Chapman and Hall: London.</p>


<h3>Examples</h3>

<pre><code class='language-R'>#####
</code></pre>

<hr>
<h2 id='californiacatalog'>Sample catalog of North California earthquakes</h2><span id='topic+californiacatalog'></span>

<h3>Description</h3>

<p>Sample catalog of North California earthquakes of magnitude at least 3.0 from year 1968 to year 2012.</p>


<h3>Usage</h3>

<pre><code class='language-R'>californiacatalog</code></pre>


<h3>Format</h3>

<p>a data matrix with 18,545 observations and 5 variables:  <code>time</code>, <code>lat</code>, <code>long</code>, <code>z</code>, <code>magn1</code>.
</p>


<h3>Source</h3>

<p>Northern California Earthquake Data Center.</p>


<h3>References</h3>

<p>Northern California Earthquake Catalog Search: <a href="http://www.ncedc.org/ncedc/catalog-search.html">http://www.ncedc.org/ncedc/catalog-search.html</a>.</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(californiacatalog)
str(californiacatalog)
</code></pre>

<hr>
<h2 id='catalog.withcov'>Small sample catalog of italian earthquakes with covariates</h2><span id='topic+catalog.withcov'></span>

<h3>Description</h3>

<p>A small sample catalog of  italian earthquakes of magnitude at least 2.5 from May 2012 to May 2016 with extra information.</p>


<h3>Usage</h3>

<pre><code class='language-R'>catalog.withcov</code></pre>


<h3>Format</h3>

<p>a data matrix with 2,226 observations and 11 variables:
<code>Date</code>, <code>id_ev</code>,  <code>time</code>, <code>lat</code>, <code>long</code>, <code>z</code>, <code>magn1</code>, <code>err_h_rev</code>, <code>min_distance_rev</code>, <code>rms_rev</code>, <code>nstaloc_rev</code>           .
</p>


<h3>Details</h3>

<p>A small sample catalog of  italian earthquakes of magnitude at least 2.5 from May 2012 to May 2016 with extra information.
<code>Date</code> is the date, <code>id_ev</code> is an identifier of the events,  <code>time</code>, <code>lat</code>, <code>long</code>, <code>z</code>, <code>magn1</code> are time (days from 1900-01-01), latitude, longitude, depth, magnitude, <code>err_h_rev</code> is an estimate of hypocentral uncertainty,  <code>min_distance_rev</code> is the distance from the nearest station, <code>rms_rev</code> is a measure of the quality of the location, <code>nstaloc_rev</code> is the number of stations that registered the event, <code>distmin</code> is the
distance from the nearest fault</p>


<h3>Source</h3>

<p>INGV (Istituto Nazionale di Geofisica e Vulcanologia) ISIDE Data Base.</p>


<h3>References</h3>

<p>INGV  home page: <a href="https://www.ingv.it/">https://www.ingv.it/</a>.</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(catalog.withcov)
str(catalog.withcov)
</code></pre>

<hr>
<h2 id='compare.etasclass'>
Compare two etasclass objects</h2><span id='topic+compare.etasclass'></span>

<h3>Description</h3>

<p>Compare the results of two <code>etasclass</code> executions through the comparison of some elements of two <code>etasclass</code> objects.</p>


<h3>Usage</h3>

<pre><code class='language-R'>compare.etasclass(etas1,etas2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="compare.etasclass_+3A_etas1">etas1</code></td>
<td>
<p>an <code>etasclass</code> object.</p>
</td></tr>
<tr><td><code id="compare.etasclass_+3A_etas2">etas2</code></td>
<td>
<p>an <code>etasclass</code> object.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Compare the results of two <code>etasclass</code> executions through the comparison of some elements of two <code>etasclass</code> objects estimated on the same catalog
</p>


<h3>Value</h3>

<table>
<tr><td><code>diffstd.params</code></td>
<td>
<p>Standardized comparison of the estimated parameters, included covariates.</p>
</td></tr>
<tr><td><code>AIC</code></td>
<td>
<p>Difference of AIC values.</p>
</td></tr>
<tr><td><code>weigths</code></td>
<td>
<p>Comparison of the weights <code>rho.weights</code> of the two input objects.</p>
</td></tr>
<tr><td><code>rho.weigths</code></td>
<td>
<p>Standardized comparison of the weights <code>rho.weights</code> of the two input objects.</p>
</td></tr>
<tr><td><code>cor.weights</code></td>
<td>
<p>Correlation between the weights <code>rho.weights</code> of the two input objects</p>
</td></tr>
<tr><td><code>cor.trig</code></td>
<td>
<p>Correlation between the triggered intensities of the two input objects</p>
</td></tr>
<tr><td><code>cor.back</code></td>
<td>
<p>Correlation between the background intensities  of the two input objects</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Marcello Chiodi</p>


<h3>See Also</h3>

 <p><code><a href="#topic+etasclass">etasclass</a></code></p>

<hr>
<h2 id='daily.etasclass'>Title daily.etasclass</h2><span id='topic+daily.etasclass'></span>

<h3>Description</h3>

<p>A daily  estimation on a space grid is made
</p>


<h3>Usage</h3>

<pre><code class='language-R'>daily.etasclass(x, ngrid = 201, nclass = 20, tfixed = 0, flag.log = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="daily.etasclass_+3A_x">x</code></td>
<td>
<p>an etasclass object</p>
</td></tr>
<tr><td><code id="daily.etasclass_+3A_ngrid">ngrid</code></td>
<td>
<p>subdivisions of x and y axis for grid computation of intensities</p>
</td></tr>
<tr><td><code id="daily.etasclass_+3A_nclass">nclass</code></td>
<td>
<p>number of class for horizontal and vertical axes of the output grid</p>
</td></tr>
<tr><td><code id="daily.etasclass_+3A_tfixed">tfixed</code></td>
<td>
<p>day of computation</p>
</td></tr>
<tr><td><code id="daily.etasclass_+3A_flag.log">flag.log</code></td>
<td>
<p>if log intensity must be used</p>
</td></tr>
<tr><td><code id="daily.etasclass_+3A_...">...</code></td>
<td>
<p>other optional parameters</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a grid with daily theoretical intensities
</p>

<hr>
<h2 id='eqcat'>
Check earthquake catalog</h2><span id='topic+eqcat'></span><span id='topic+summary.eqcat'></span><span id='topic+plot.eqcat'></span>

<h3>Description</h3>

<p>Preliminary check of the names of an earthquake catalog. <code>summary</code> and <code>plot</code> methods for earthquake catalogs are defined.</p>


<h3>Usage</h3>

<pre><code class='language-R'>eqcat(x)
## S3 method for class 'eqcat'
plot(x,extended=TRUE,...)
## S3 method for class 'eqcat'
summary(object,extended=TRUE,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="eqcat_+3A_x">x</code></td>
<td>
<p>an earthquake catalog.</p>
</td></tr>
<tr><td><code id="eqcat_+3A_object">object</code></td>
<td>
<p>an <code>eqcat</code> object.</p>
</td></tr>
<tr><td><code id="eqcat_+3A_extended">extended</code></td>
<td>
<p>if <code>TRUE</code> some extra summary functions are computed.</p>
</td></tr>
<tr><td><code id="eqcat_+3A_...">...</code></td>
<td>
<p>other arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Minimal check of an earthquake catalog; checks only if it is suitable for the use as argument of the functions of <code>etasFLP</code> (mainly <code>etasclass</code>); checks only the presence of
variables with the names <code>time</code>,  <code>lat</code>,   <code>long</code>,  <code>z</code>,     <code>magn1</code>.
<code>summary</code> and <code>plot</code> methods are defined for earthquake catalogs.
and the input object can be the <code>cat</code> output of <code>eqcat</code>
</p>


<h3>Value</h3>

<p>If the catalog passes the check, then the catalog is returned in the object <code>cat</code> with the new class name <code>eqcat</code>; otherwise an error message is printed.
</p>
<table>
<tr><td><code>cat</code></td>
<td>
<p>the input catalog is returned. If the check is ok, this is an <code>eqcat</code> class object.</p>
</td></tr>
<tr><td><code>ok</code></td>
<td>
<p>A flag: <code>TRUE</code> if the check is ok; <code>FALSE</code> elsewhere.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>In this first version if you have a catalog without the depth (<code>z</code>), please insert however a constant column. The depth can be used only in some plot and not in the estimation routines of the package etasFLP; <code>etasclass</code> uses only
<code>time</code>,  <code>lat</code>,   <code>long</code>,  <code>magn1</code>.
From version 2.0 you could use <code>z</code> as a covariate for the triggered component 
</p>


<h3>Author(s)</h3>

<p>Marcello Chiodi</p>


<h3>See Also</h3>

 <p><code><a href="#topic+etasclass">etasclass</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data(italycatalog)
f=eqcat(italycatalog)
print(f$ok)
summary(f$cat)
plot(f$cat)

## End(Not run)</code></pre>

<hr>
<h2 id='etas.starting'>Guess starting values of ETAS parameters (beta-version). Only from package version 1.2.0</h2><span id='topic+etas.starting'></span>

<h3>Description</h3>

<p><code>etas.starting</code> is a simple function to give starting values of the 7 ETAS parameters for the function <code>etasclass</code>.
</p>
<p>It gives only rough approximations, based on some assumptions, intended to give only the order of magnitude of each parameter (but should be better than nothing).
Returns a list with starting values. In the present version user can give manually the output of this function in the input of <code>etasclass</code>. Otherwise, the function is called by <code>etasclass</code> at first steps, to supply initial values to start estimation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>etas.starting(cat.orig,
magn.threshold=2.5,
p.start=1,
gamma.start=0.5,
q.start=2,
betacov.start=.7,
longlat.to.km=TRUE,
sectoday=FALSE,
onlytime=FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="etas.starting_+3A_cat.orig">cat.orig</code></td>
<td>

<p>An  earthquake catalog, possibly an object of class <code>eqcat</code>, or however a <code>data.frame</code> with variables of names <code>time</code>,  <code>lat</code>,   <code>long</code>,  <code>z</code>,     <code>magn1</code>. No missing values are allowed.
</p>
</td></tr>
<tr><td><code id="etas.starting_+3A_magn.threshold">magn.threshold</code></td>
<td>

<p>Threshold magnitude (only events with a magnitude at least <code>magn.threshold</code> will be used).  Default value = 2.5.
</p>
</td></tr>
<tr><td><code id="etas.starting_+3A_p.start">p.start</code></td>
<td>
<p>Parameter 4  of the ETAS model; the exponent of the Omori law for temporal decay rate of aftershocks; see details. Default value = 1.0.
</p>
</td></tr>
<tr><td><code id="etas.starting_+3A_gamma.start">gamma.start</code></td>
<td>
<p>Parameter 5 (<code class="reqn">\gamma</code>) of the ETAS model; together with  <code>a</code> is related to the efficiency of an event of given magnitude 
in generating aftershocks; see details. Default value = 0.5.
</p>
</td></tr>
<tr><td><code id="etas.starting_+3A_q.start">q.start</code></td>
<td>
<p>Parameter 7 of the ETAS model; parameter related to the spatial influence of the
mainshock; see details. Default value = 2.
</p>
</td></tr>
<tr><td><code id="etas.starting_+3A_betacov.start">betacov.start</code></td>
<td>
<p>coefficient of the covariate (as default the magnitude). Default value = 0.7.
</p>
</td></tr>
<tr><td><code id="etas.starting_+3A_sectoday">sectoday</code></td>
<td>
<p> if <code>TRUE</code>, then <code>time</code> variable of <code>cat.orig</code> is converted from seconds to days.  Default value = <code>TRUE</code>.
</p>
</td></tr>
<tr><td><code id="etas.starting_+3A_longlat.to.km">longlat.to.km</code></td>
<td>
<p> if <code>TRUE</code>, then <code>long</code> and <code>lat</code> variables of <code>cat.orig</code> are treated as geographical coordinates and converted to kilometers.  Default value = <code>TRUE</code>.
</p>
</td></tr>
<tr><td><code id="etas.starting_+3A_onlytime">onlytime</code></td>
<td>
<p>if <code>TRUE</code>  then a time process is fitted to data , regardless to space location (in this case <code>is.backconstant</code> is set to <code>TRUE</code> and <code>declustering</code>, <code>flp</code> are set to <code>FALSE</code>). Default value = <code>FALSE</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It is a beta-version of a very crude method to give 
starting values for the seven parameters of an ETAS  (Epidemic type aftershock sequences) model
for the description of the seismicity of a space-time region. 
These starting values can be used as input for the function <code>etasclass</code> 
<code>sectoday</code> and <code> longlat.to.km</code> flags must the same that will be used in <code>etasclass</code>.
</p>
<p>In this first attempt to give starting values for the ETAS model, many approximations are used 
</p>
<p>It gives only rough approximation, based on some assumptions, intended to give only the order of magnitude of each parameter (but it should be better than nothing). It
returns a list with 7 starting values. With this beta-version user must give manually the output of this function in the input of <code>etasclass</code>. 
</p>
<p>The values of <code>p.start</code>,  <code>gamma.start</code> and  <code>q.start</code> must be however given by the user (we did not find anything reasonable). Default choices for <code>p</code> and <code>q</code> (<code>p.start=1</code>, <code>q.start=2</code>) are strongly reccomended.
</p>
<p><code>c</code> and <code>d</code> are estimated from the emprical distributions of time differences and space distances, respectively.
<code>mu</code> and <code>k0</code> are then estimated given the other starting values, solving the two ML equations, that is derivatives of the whole likelihood with respect to  <code>mu</code> and <code>k0</code> equated to zero. 
In the computation of the likelihood an approximation for the integral of the intensity function is used (quoted also in 
Schoenberg (2013)).
</p>


<h3>Value</h3>

<p>returns a list:
</p>
<table>
<tr><td><code>mu.start</code></td>
<td>
<p>guess value for <code>mu</code></p>
</td></tr>
<tr><td><code>k0.start</code></td>
<td>
<p>guess value for <code>k0</code></p>
</td></tr>
<tr><td><code>c.start</code></td>
<td>
<p>guess value for <code>c</code></p>
</td></tr>
<tr><td><code>p.start</code></td>
<td>
<p>guess value for <code>p</code> (the same as input value)</p>
</td></tr>
<tr><td><code>gamma.start</code></td>
<td>
<p>guess value for <code>gamma</code> (the same as input value)</p>
</td></tr>
<tr><td><code>d.start</code></td>
<td>
<p>guess value for <code>d</code></p>
</td></tr>
<tr><td><code>q.start</code></td>
<td>
<p>guess value for <code>q</code> (the same as input value)</p>
</td></tr>
<tr><td><code>longlat.to.km</code></td>
<td>
<p><code>longlat.to.km</code> (the same as input value)</p>
</td></tr>
<tr><td><code>sectoday</code></td>
<td>
<p><code>sectoday</code> (the same as input value)</p>
</td></tr>
</table>


<h3>Note</h3>

<p>The optimization algorithm used in <code>etasclass</code>  depends on the choice of initial values. Some default guess choice is performed in the present beta-version of the function <code>etas.starting</code>. If convergence problem are experienced, a useful strategy can be to start  with an high magnitude threshold value <code class="reqn">m_0</code> (that is, with a smaller catalog with bigger earthquakes), and then using this first output as starting  guess for a running with a lower magnitude threshold value <code class="reqn">m_0</code>. 
In this trial executions avoid declustering (<code>declustering=FALSE</code>) or at least use a small value of <code>ndeclust</code>; small values of <code>iterlim</code> and <code>ntheta</code> can speed first executions.
</p>
<p>Quicker executions are obtained using smaller values of <code>iterlim</code> and <code>ntheta</code> in the input.
</p>
<p>Also a first execution with <code>is.backconstant = TRUE</code>, to fit a first approximation model with constant background, can be useful.
</p>
<p>Some other useful information can be obtained estimating a pure time process, that can give a good guess at least for some  parameters, like  <code class="reqn">\mu, \kappa_0, c,p</code>.
</p>
<p>Input times are expected in days, and so final intensities are expected number of events per day. If input values are in seconds, then set <code>sectoday=TRUE</code>
</p>


<h3>Author(s)</h3>

<p>Marcello Chiodi, Giada Adelfio</p>


<h3>References</h3>

<p>Schoenberg, F. P. (2013).Facilitated Estimation of ETAS. <em>Bulletin of the Seismological Society of America</em>, Vol. 103, No. 1, pp. 601-605, February 2013, doi: 10.1785/0120120146
</p>


<h3>See Also</h3>

 <p><code><a href="#topic+etasclass">etasclass</a></code></p>

<hr>
<h2 id='etasclass'>Mixed estimation of an ETAS model (renewed in version 2.0)</h2><span id='topic+etasclass'></span>

<h3>Description</h3>

<p><code>etasclass</code> is the main function of the package <code>etasFLP</code>.
</p>
<p><code>etassclass</code> <em>objects of previous versions
are not compatible with the  current version</em>
</p>
<p>Performs the estimation of the components of the ETAS (Epidemic Type Aftershock Sequence) model for the description of the seismicity in a space-time region. Background seismicity is estimated non-parametrically, while triggered seismicity is estimated by MLE. In particular also the bandwidth for a kernel smoothing can be estimated through the Forward Likelihood Predictive (FLP) approach. For each event the probability of being a background event or a triggered one is estimated. 
</p>
<p><strong>New in version 2.0.0:</strong>
<em>Covariates have been introduced to explain the effects of external factors on the induced seismicity. Since the parametrization is changed, the etasclass object created with the previous versions are not compatible with the one obtained with the current version.</em>
</p>
<p><strong>New in version 2.2.0:</strong>
<em>New algoruthm for starting values. A new argument (n.iterweight) and an update method and a <code>timeupdate</code> option</em>
</p>
<p>An ETAS with up to 7+<code>ncov</code> parameters can be estimated, with several options and different methods.
</p>
<p>Returns an <code>etasclass</code> object, for which <code>plot</code>, <code>summary</code>, <code>print</code> and <code>profile</code> methods are defined. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>etasclass(cat.orig,
           time.update=FALSE,
           magn.threshold	=2.5,
           magn.threshold.back=magn.threshold+2,	
           tmax		=max(cat.orig$time),
           long.range=range(cat.orig$long),
           lat.range=range(cat.orig$lat),
           ##### starting values for parameters
           mu		=1,
           k0		=1,
           c		=0.5,
           p		=1.01,
           gamma	=.5,
           d		=1.,
           q		=1.5,
           betacov         =0.7,
           ### indicators: if params.ind[i] i-th parameter will be estimated
           params.ind=replicate(7,TRUE),
#           params.lim=c(0,0,0,1.0,0,0,0),
           ### formula for covariates (magnitude should always be included):
           formula1            ="time~magnitude-1",
           offset              =0,
           hdef=c(1,1),
           w		=replicate(nrow(cat.orig),1),
           hvarx  =replicate(nrow(cat.orig),1),
           hvary  =replicate(nrow(cat.orig),1),
           ### flags for the kind of declustering and smoothing:
           declustering	   =TRUE,
           thinning	       =FALSE,
           flp		         =TRUE,
           m1		           =NULL,
           ndeclust        =5,
           n.iterweight    =1,
           onlytime	=FALSE,
           is.backconstant	=FALSE,
           ##### end of  main input arguments. 
           ##### Control and secondary arguments:
           description	="",
           cat.back   	=NULL,
           back.smooth	=1.0,
           sectoday	=FALSE,
           longlat.to.km   =TRUE,
#           fastML=FALSE, #### not yet implemented
#           fast.eps=0.001, #### not yet implemented
           usenlm		=TRUE,
           method		="BFGS",
           compsqm 	=TRUE,
           epsmax		= 0.0001,
           iterlim		=50,      
           ntheta		=36)  
 				</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="etasclass_+3A_cat.orig">cat.orig</code></td>
<td>

<p>An  earthquake catalog, possibly an object of class <code>eqcat</code>, or however a <code>data.frame</code> with variables of names <code>time</code>,  <code>lat</code>,   <code>long</code>,  <code>z</code>,     <code>magn1</code>. No missing values are allowed.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_time.update">time.update</code></td>
<td>

<p>Logical. It is <code>TRUE</code> if the excution is called by <code>time.update</code> to update to new time maximum. Default value = <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_magn.threshold">magn.threshold</code></td>
<td>

<p>Threshold magnitude (only events with a magnitude at least <code>magn.threshold</code> will be used).  Default value = 2.5.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_magn.threshold.back">magn.threshold.back</code></td>
<td>

<p>Threshold magnitude used to build the  catalog <code>cat.back</code> for
the first estimation of the background seismicity. Default value = <code>magn.threshold+2</code>.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_tmax">tmax</code></td>
<td>

<p>Maximum value of time. Only observations before <code>tmax</code> will be used for estimation. Default value = <code>max(cat.orig$time)</code>.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_long.range">long.range</code></td>
<td>

<p>Longitude range. Only observations with <code>long</code>  in the range <code>long.range</code> will be used for estimation. Default value = <code>range(cat.orig$long)</code>.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_lat.range">lat.range</code></td>
<td>

<p>Latitude range. Only observations with <code>lat</code>  in the range <code>lat.range</code> will be used for estimation. Default value = <code>range(cat.orig$lat)</code>.
</p>
</td></tr>
</table>
<p><em>Values for the 7 parameters of the ETAS   model</em> (starting values or fixed values according to  <code>params.ind</code>):
</p>
<table>
<tr><td><code id="etasclass_+3A_mu">mu</code></td>
<td>
<p>Parameter 1 (<code class="reqn">\mu</code>) of the ETAS model: background general intensity; see details. Default value = 1.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_k0">k0</code></td>
<td>
<p>Parameter 2 (<code class="reqn">\kappa_0</code>) of the ETAS model: measures the strength
of the aftershock activity; see details. Default value = 1.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_c">c</code></td>
<td>
<p>Parameter 3 of the ETAS model; a shift parameter of the Omori law for temporal decay rate of aftershocks; see details. Default value = 0.5.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_p">p</code></td>
<td>
<p>Parameter 4  of the ETAS model; the exponent of the Omori law for temporal decay rate of aftershocks; see details. Default value = 1.01.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_gamma">gamma</code></td>
<td>
<p>Parameter 5 (<code class="reqn">\gamma</code>) of the ETAS model; together with  <code>a</code> is related to the efficiency of an event of given magnitude 
in generating aftershocks; see details. Default value = 0.5.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_d">d</code></td>
<td>
<p>Parameter 6 of the ETAS model; parameter related to the spatial influence of the
mainshock; see details. Default value = 1.
</p>
</td></tr> 
<tr><td><code id="etasclass_+3A_q">q</code></td>
<td>
<p>Parameter 7 of the ETAS model; parameter related to the spatial influence of the
mainshock; see details. Default value = 1.5.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_betacov">betacov</code></td>
<td>
<p>Numerical array. Parameters of the covariates ETAS model (the parameters <code class="reqn">\beta_j</code>); 
see details. Default value = 0.7. Parameters in <code>betacov</code> are not limited
</p>
</td></tr>
</table>
<p><em>End of model pararameter input</em>
</p>
<table>
<tr><td><code id="etasclass_+3A_params.ind">params.ind</code></td>
<td>
<p>vector of 7 logical values: <code>params.ind[i] = TRUE</code> means that the i-th parameter must be estimated.  <code>params.ind[i] = FALSE</code>  means that the i-th parameter is fixed to its input value  (the order of parametrs is: <code>mu</code>, <code>k0</code>, <code>c</code>, <code>p</code>, <code>gamma</code>, <code>d</code>, <code>q</code>).
Default value = <code>replicate(7,TRUE)</code>, that is, <code>etasclass</code> estimates all parameters.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_params.lim">params.lim</code></td>
<td>
<p>vector of 7 numerical values: <code>params.lim[i] = theta0</code> means that the i-th parameter must be greater than <code>theta0</code>  (the default limits of parametrs are: 0 for <code>mu</code>, <code>k0</code>, <code>c</code>, 1 for <code>p</code>, 0 for <code>gamma</code>, <code>d</code>, <code>q</code>).
Default value = <code>replicate(7,TRUE)</code>, that is, <code>etasclass</code> estimates all parameters.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_formula1">formula1</code></td>
<td>
<p>a character variable: Formula which defines the covariates acting on the induced seismicity. In classical etas model   the covariate is the magnitude. The left side (dummy) element must be the time, which is a variable certainly present in the data set. The right part of the formula determines <code>ncov</code> the number of covariates. Default value=<code>"time~magnitude-1"</code>; input <em>must</em> be a character value: it is converted in a formula inside the program</p>
</td></tr>
<tr><td><code id="etasclass_+3A_offset">offset</code></td>
<td>
<p>An offset, for which no parameter will be estimated. Default value=0</p>
</td></tr>
</table>
<p><em>Flags for the kind of declustering and smoothing</em>:
</p>
<table>
<tr><td><code id="etasclass_+3A_hdef">hdef</code></td>
<td>
<p>Starting values for the <code>x,y</code> bandwidths used in the kernel estimator of background seismicity. Default value = <code>1,1</code>.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_w">w</code></td>
<td>
<p>Starting values for the weigths used in the kernel estimator of background seismicity. The length must be equal to the number of events of the catalog after event selection (can be less than <code>nrow(cat.orig)</code>). 
</p>
<p>Default value = <code>replicate(nrow(cat.orig),1).</code>
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_hvarx">hvarx</code></td>
<td>
<p>Longitude bandwidths adjustement used in the kernel estimator of background seismicity. The length must be equal to the number of events of the catalog after event selection (can be less than <code>nrow(cat.orig)</code>). Default value = NULL</p>
</td></tr>
<tr><td><code id="etasclass_+3A_hvary">hvary</code></td>
<td>
<p>Longitude bandwidths adjustement used in the kernel estimator of background seismicity. The length must be equal to the number of events of the catalog after event selection (can be less than <code>nrow(cat.orig)</code>). Default value = NULL</p>
</td></tr>
<tr><td><code id="etasclass_+3A_declustering">declustering</code></td>
<td>
<p>if <code>TRUE</code> the catalog is iteratively declustered to optimally estimate the background intensity (through thinning, if <code>thinning=TRUE</code>, or through weighting if <code>thinning=FALSE</code>). Default value = <code>TRUE</code>.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_thinning">thinning</code></td>
<td>
<p>if <code>thinning=TRUE</code> a background catalog is obtained sampling from the original catalog with probabilities estimated during the iterations. Default value =<code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_flp">flp</code></td>
<td>
<p>if <code>flp=TRUE</code> then background seismicity is estimated through Forward Likelihood Predictive (see details). Otherwise the Silverman rule is used. Default value =<code>TRUE</code>.
</p>
</td></tr> 
<tr><td><code id="etasclass_+3A_m1">m1</code></td>
<td>
<p>Used only if <code>flp=TRUE</code>. Indicates the range of points used for the FLP steps. See details. If missing it is set  to <code>nrow(cat)/2</code>.
</p>
</td></tr> 
<tr><td><code id="etasclass_+3A_ndeclust">ndeclust</code></td>
<td>
<p>maximum number of iterations for the general declustering procedure. Default=5.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_n.iterweight">n.iterweight</code></td>
<td>
<p>New in version 2.2. The weighting and the density computations will be alternated  <code>n.iterweight</code> times after each maximum likelihood step: in many situations this improves the general convergence procedure. Default=1.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_onlytime">onlytime</code></td>
<td>
<p>if <code>TRUE</code>  then a time process is fitted to data , regardless to space location (in this case <code>is.backconstant</code> is set to <code>TRUE</code> and <code>declustering</code>, <code>flp</code> are set to <code>FALSE</code>). Default value = <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_is.backconstant">is.backconstant</code></td>
<td>
<p>if <code>TRUE</code>  then background seismicity is assumed to be homogeneous in space  (and <code>declustering, flp</code> are set to <code>FALSE</code>).  Default value = <code>FALSE</code>.
</p>
</td></tr>
</table>
<p><em>Other control parameters</em>:
</p>
<table>
<tr><td><code id="etasclass_+3A_description">description</code></td>
<td>
<p>a description string used for the output. Default value = &quot;&quot;.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_cat.back">cat.back</code></td>
<td>
<p> external catalog used for the estimation of the background seismicity. 
Default value = <code>NULL</code>.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_back.smooth">back.smooth</code></td>
<td>

<p>Controls the level of smoothing for the background seismicity (meaningful only if <code>flp=FALSE</code>). Default value = 1.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_sectoday">sectoday</code></td>
<td>
<p> if <code>TRUE</code>, then <code>time</code> variable of <code>cat.orig</code> is converted from seconds to days.  Default value = <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_longlat.to.km">longlat.to.km</code></td>
<td>
<p> if <code>TRUE</code>, then <code>long</code> and <code>lat</code> variables of <code>cat.orig</code> are treated as geographical coordinates and converted to kilometers.  Default value = <code>TRUE</code>.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_usenlm">usenlm</code></td>
<td>
<p>if <code>TRUE</code>, then <code>nlm</code> function (gauss-newton method) is used in the maximum likelihood steps; if <code>FALSE</code>, then <code>optim</code> function is used (with <code>method</code> <code>=method</code> ).  Default value = <code>TRUE</code>.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_method">method</code></td>
<td>
<p>used if <code>usenlm=FALSE</code>: method used  by <code>optim</code>.  Default value = <code>"BFGS"</code>.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_compsqm">compsqm</code></td>
<td>
<p>if <code>TRUE</code>, then standard errors are computed.  Default value = <code>TRUE</code>.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_epsmax">epsmax</code></td>
<td>
<p>maximum allowed difference between estimates in subsequent iterations (default = 0.0001).
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_iterlim">iterlim</code></td>
<td>
<p>maximum number of iterations in the maximum likelihood steps (used in <code>nlm</code> or <code>optim</code>). Default value = 100.
</p>
</td></tr>
<tr><td><code id="etasclass_+3A_ntheta">ntheta</code></td>
<td>
<p>number of subdivisions of the round angle, used in the approximation of the integral involved in the likelihood computation of the ETAS model. Default value = 100.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Estimates the components of an ETAS (Epidemic type aftershock sequence)
model for the description of the seismicity of a space-time region. 
Background seismicity is estimated nonparametrically, while triggered seismicity is estimated by MLE.
</p>
<p>From version 2.0 of package <code>etasFLP</code> covariates are allowed to improve the fitting of the triggered part, through the input <code>formula1</code>, which as a default values of <code>"time ~ magnitude - 1"</code>, which corresponds to the previous version of package <code>etasFLP</code>, that is, magnitude as the only covariate which influence the average number of aftershocks.
</p>
<p>The bandwidth of the kernel density estimator is estimated through the 
Forward Likelihood Predictive approach (FLP),
(theoretical reference on Adelfio and Chiodi, 2013) if <code>flp</code> is set to <code>TRUE</code>. 
Otherwise the bandwidth is estimated trough the Silverman's rule.
FLP steps for the estimation of nonparametric background component  is alternated with the Maximum Likelihood step for the estimation
of parametric components (only if <code>declustering=TRUE</code>).
For each event the probability of being a background event or a triggered one is estimated,
according to a declustering procedure in a way similar to the proposal of Zhuang,  Ogata,  and Vere-Jones (2002).
</p>
<p>The ETAS model for conditional space time intensity <code class="reqn">\lambda(x,y,t)</code> is given by:
</p>
<p style="text-align: center;"><code class="reqn">\lambda(x,y,t)=\mu f(x,y)+\kappa_0 \sum_{t_j&lt;t}\frac{ e^{\eta_j}}{(t-t_j +c)^p}
\left\{ \frac{(x-x_j)^2+(y-y_j)^2}{e^{\gamma \ (m_j-m_0)}}+d \right\}^{-q}</code>
</p>

<p>where <code class="reqn">\eta_j=\sum_{j=1,ncov}\beta_j cov_{ij}</code>
</p>
<p>parameters <code class="reqn">\beta_j</code> are the elements of the array variable <code>betacov</code>
</p>
<p><code class="reqn">f(x,y)</code> is estimated through a weighted kernel gaussian estimator; if <code>flp</code> is set to <code>TRUE</code>
then the bandwidth is estimated through a FLP step.
</p>
<p>Weights (computed only if <code>declustering=TRUE</code>) are given by the estimated probabilities of being  a background event; for the i-th event this is given by
<code class="reqn">\rho_i=\frac{\mu f(x_i,y_i)}{\lambda(x_i,y_i,t_i)}</code>.
The weights <code class="reqn">\rho_i</code> are updated after a whole iteration. 
</p>
<p><code>mu</code> (<code class="reqn">\mu</code>) measures the background general intensity (which is assumed temporally homogeneous);
</p>
<p><code>k0</code> (<code class="reqn">\kappa_0</code>) is a scale parameter related to the importance of the induced seismicity;
</p>
<p><code>c</code> and <code>p</code> are the characteristic parameters of the seismic
activity of the given region; <code>c</code> is a shift parameter while <code>p</code>, which characterizes the pattern of seismicity, is the exponent parameter of the modified Omori law for temporal decay rate of aftershocks; 
</p>
<p><code class="reqn">\eta_j=\sum_{j=1,ncov}\beta_j cov_{ij}</code> measures the efficiency of an event of a given magnitude in generating aftershock sequences;
</p>
<p><code>d</code> and <code>q</code> are two parameters related to the spatial influence of the mainshocks.
</p>
<p>Many kinds of ETAS models can be estimated, managing some control input arguments. 
The eight ETAS parameters can be fixed  to some input value, or can be estimated, according to <code>params.ind</code>:
if <code>params.ind</code>[i]=FALSE the i-th parameter is kept fixed to its input value, otherwise, if <code>params.ind[i]</code> <code> = TRUE</code>,  the i-th parameter is estimated and the input value is used as a starting value. 
</p>
<p>By default <code>params.ind=c(TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE)</code>, and so a full 7+<code>ncov</code> parameters ETAS model will be estimated.
</p>
<p>The seven parameters are internally ordered in this way: <code>params</code> = (<code>mu</code>, <code>k0</code>, <code>c</code>, <code>p</code>,  <code>gamma</code>, <code>d</code>, <code>q</code>); for example
a model with a fixed value <code>p=1</code> (and  <code>params.ind</code>[4] = FALSE) can be estimated  and compared with the model where <code>p</code> is estimated (<code>params.ind</code>[4]=TRUE);
</p>
<p>for example  a 6+<code>ncov</code> parameters model can be fitted with <code>gamma=0</code> and <code>params.ind[5]</code>=<code>FALSE</code>, 
so that  input must be in this case: <code>params.ind=c(TRUE,TRUE,TRUE,TRUE,FALSE,TRUE,TRUE)</code>; 
</p>
<p>if <code>onlytime=TRUE</code> a time process is fitted to data (with a maximum of 5 parameters), regardless to space location (however the input catalog <code>cat.orig</code> must contain  three columns named <code>long</code>, <code>lat, z</code>);
</p>
<p>if <code>is.backconstant=TRUE</code> a process (space-time or time) with a constant background intensity <code class="reqn">\mu</code> is fitted;
</p>
<p>if <code>mu</code> is fixed to a very low value a process with very low background intensity is fitted, that is  with only clustered intensity (useful to fit a model to a single  cluster of events).
</p>
<p>If <code>flp=TRUE</code> the bandwidth for the kernel estimation of the background intensity is evaluated maximizing the  
Forward Likelihood Predictive (FLP) quantity, given by
(Chiodi, Adelfio, 2011; Adelfio, Chiodi, 2013):
</p>
<p style="text-align: center;"><code class="reqn">FLP_{k_1,k_2}(\hat{\boldsymbol{\psi}})\equiv\sum_{k=k_1}^{n-1}\delta_{k,{k+1}}(\hat{\boldsymbol{\psi}}(H_{t_k});
H_{t_{k+1}})</code>
</p>

<p>with <code class="reqn">k_1=\frac{n}{2},k_2=n-1</code> and where <code class="reqn">\delta_{k,k+1}(\hat{\boldsymbol{\psi}}(H_{t_k});
H_{t_{k+1}})</code> is 
the <em>predictive information</em>
of the first <code class="reqn">k</code> observations on the <code class="reqn">k+1</code>-th observation, and is so defined:
</p>
<p style="text-align: center;"><code class="reqn">\delta_{k,k+1}(\hat{\boldsymbol{\psi}}(H_{t_k});
H_{t_{k+1}})\equiv \log L(\hat{\boldsymbol{\psi}}(H_{t_k}); H_{t_{k+1}} )-\log L(\hat{\boldsymbol{\psi}}(H_{t_k});H_{t_k})</code>
</p>

<p>where <code class="reqn">H_k</code> is the  history of the process until time <code class="reqn">t_k</code> and 
<code class="reqn">\hat{\boldsymbol{\psi}}(H_{t_k})</code> is an estimate based only on history until the <code class="reqn">k-th</code> observation.
</p>
<p>In the ML step, the vector of parameter <code class="reqn">\theta=(\mu, \kappa_0, c , p, \alpha, \gamma, d, q)</code> is estimated maximizing the sample log-likelihood given by:
</p>
<p style="text-align: center;"><code class="reqn">\log L(\boldsymbol{\theta}; H_{t_n}) = \sum_{i=1}^{n}
\log \lambda(x_i,y_i,t_i; \boldsymbol{\theta})-
\int_{T_0}^{T_{max}} \int \int_{\Omega_{(x,y)}}\,
\lambda(x,y,t;\boldsymbol{\theta})\,d x \, d y \,d t
</code>
</p>



<h3>Value</h3>

<p>returns an object of class <code>etasclass</code>.
</p>
<p>The main items of the output are:
</p>
<table>
<tr><td><code>this.call</code></td>
<td>
<p>reports the exact call of the function</p>
</td></tr>
<tr><td><code>params.ind</code></td>
<td>
<p>indicates which parameters have been estimated (see details)</p>
</td></tr>
<tr><td><code>params</code></td>
<td>
<p>ML estimates of the ETAS parameters.</p>
</td></tr>
<tr><td><code>sqm</code></td>
<td>
<p>Estimates of standard errors of the ML estimates of the ETAS parameters (<code>sqm[i]</code>=0 if <code>params.ind[i]</code>=<code>FALSE</code> or where the hessian is not computed or near to singularity). </p>
</td></tr>
<tr><td><code>AIC.iter</code></td>
<td>
<p>AIC values at each iteration.</p>
</td></tr>
<tr><td><code>hdef</code></td>
<td>
<p>final bandwidth used for the kernel estimation of background spatial intensity (however estimated, with <code>flp=TRUE</code> or <code>flp=FALSE</code>).</p>
</td></tr>
<tr><td><code>rho.weights</code></td>
<td>
<p>Estimated probability for each event to be a background event (<code class="reqn">\rho</code>).</p>
</td></tr>
<tr><td><code>time.res</code></td>
<td>
<p>rescaled time residuals (for time processes only).</p>
</td></tr>
<tr><td><code>params.iter</code></td>
<td>
<p>A matrix with estimates values at each iteration.</p>
</td></tr>
<tr><td><code>sqm.iter</code></td>
<td>
<p>A matrix with the estimates of the standard errors at each iteration.</p>
</td></tr>
<tr><td><code>rho.weights.iter</code></td>
<td>
<p>A matrix with the values of <code>rho.weights</code> at each iteration.</p>
</td></tr>
<tr><td><code>l</code></td>
<td>
<p>A vector with estimated intensities, corresponding to observed points</p>
</td></tr>
</table>
<p><code>summary</code>,
<code>print</code> and
<code>plot</code> methods are defined for an object of class <code>etasclass</code> to obtain main output. 
</p>
<p>A <code>profile</code> method (<code><a href="#topic+profile.etasclass">profile.etasclass</a></code>
) is also defined  to make approximate inference on a single parameter   
</p>


<h3>Note</h3>

<p>In this version the x-y space region, where the point process is defined, is  a rectangle embedding the catalog values.
</p>
<p>The optimization algorithm  depends on the choice of initial values. Some default guess choice is performed 
inside the function for parameters without input starting values; the function <code>etas.starting</code> gives rough first guess for initial values. If convergence problem are experienced, a useful strategy can be starting  with an higher magnitude threshold value <code class="reqn">m_0</code> (that is, with a smaller catalog with bigger earthquakes), and then using this first output as starting  guess for a running with a lower magnitude threshold value <code class="reqn">m_0</code>. 
In this trial executions avoid declustering (<code>declustering=FALSE</code>) or at least use a small value of <code>ndeclust</code>; small values of <code>iterlim</code> and <code>ntheta</code> can speed first executions.
</p>
<p>Quicker executions are obtained using smaller values of <code>iterlim</code> and <code>ntheta</code> in the input.
</p>
<p>Also a first execution with <code>is.backconstant = TRUE</code>, to fit a first approximation model with constant background, can be useful.
</p>
<p>Some other useful information can be obtained estimating a pure time process, that can give a good guess at least for some  parameters, like  <code class="reqn">\mu, \kappa_0, \alpha,c,p</code>.
</p>
<p>Input times are expected in days, and so final intensities are expected number of events per day. If input values are in seconds, then set <code>sectoday=TRUE</code>
</p>


<h3>Author(s)</h3>

<p>Marcello Chiodi, Giada Adelfio</p>


<h3>References</h3>

<p>Adelfio, G. and Chiodi, M. (2013) Mixed estimation technique in semi-parametric space-time point processes for earthquake description. 
<em>Proceedings of the 28th International Workshop on Statistical Modelling 8-13 July, 2013, Palermo</em> (Muggeo V.M.R., Capursi V., Boscaino G., Lovison G., editors). Vol. <b>1</b> pp.65-70. 
</p>
<p>Adelfio G, Chiodi M (2015). Alternated Estimation in Semi-Parametric Space-Time
Branching-Type Point Processes with Application to Seismic Catalogs. <em>Stochastic Environmental Research and Risk Assessment</em>, <b>29</b>(2), 443-450. doi:10.1007/s00477-014-0873-8.
</p>
<p>Adelfio G, Chiodi M (2015). FLP Estimation of Semi-Parametric Models for Space-Time
Point Processes and Diagnostic Tools. <em>Spatial Statistics</em>, <b>14</b>(B), 119-132. doi:10.1016/j.spasta.2015.06.004.
</p>
<p>Adelfio G., Chiodi, M. (2020). Including covariates in a space-time point process with application to seismicity. <em>Statistical Methods and Applications</em>,  doi:10.1007/s10260-020-00543-5.
</p>
<p>Chiodi, M. and Adelfio, G., (2011) Forward Likelihood-based predictive approach for space-time processes. <em>Environmetrics</em>, vol. <b>22</b> (6), pp. 749-757. DOI:10.1002/env.1121.
</p>
<p>Chiodi, M. and Adelfio, G., (2017) Mixed Non-Parametric and Parametric Estimation Techniques in R Package etasFLP for Earthquakes' Description. <em>Journal of Statistical Software</em>, vol. <b>76</b> (3), pp. 1-29.
DOI: 10.18637/jss.v076.i03.
</p>
<p>Zhuang, J., Ogata, Y.  and Vere-Jones, D.
Stochastic declustering of space-time earthquake occurrences.
<em>Journal of the American Statistical Association</em>,
<b>97</b>,  369&ndash;379 (2002). DOI:10.1198/016214502760046925.
</p>


<h3>See Also</h3>

 <p><code><a href="#topic+eqcat">eqcat</a></code>, <code><a href="#topic+plot.etasclass">plot.etasclass</a></code>,<code><a href="#topic+print.etasclass">print.etasclass</a></code>, <code><a href="#topic+summary.etasclass">summary.etasclass</a></code>, <code><a href="#topic+profile.etasclass">profile.etasclass</a></code>, <code><a href="#topic+etas.starting">etas.starting</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data("italycatalog")
# load a sample catalog of the italian seismicity
esecov1&lt;-etasclass(cat.orig = catalog.withcov, magn.threshold = 2.5, magn.threshold.back = 3.9, 
mu = 0.3, k0 = 0.02, c = 0.015, p = 0.99, gamma = 0, d = 1, 
q = 1.5, params.ind = c(TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, 
TRUE), formula1 = "time ~  magnitude- 1", declustering = TRUE, 
thinning = FALSE, flp = TRUE, ndeclust = 15, onlytime = FALSE, 
is.backconstant = FALSE, sectoday = FALSE, usenlm = TRUE, 
compsqm = TRUE, epsmax = 1e-04, iterlim = 100, ntheta = 36)

# execution of etasclass for events with minimum magnitude of 3.0. 
# The events with magnitude at least 3.5 are used to build a first approximation
# for the background intensity function
# (magn.threshold.back=3.5)
# The magnitude effect is given by the covariate magnitude 
# in the formula "time ~  magnitude- 1"
# magnitude is the internal name for magn1-magn.threshold
# print method for the etasclass object

print(esecov1)

&gt; print(esecov1)
Call: 
 
etasclass(cat.orig = catalog.withcov, magn.threshold = 2.5, magn.threshold.back = 3.9, 
    mu = 0.3, k0 = 0.02, c = 0.015, p = 0.99, gamma = 0, d = 1, 
    q = 1.5, params.ind = c(TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, 
        TRUE), formula1 = "time ~  magnitude- 1", declustering = TRUE, 
    thinning = FALSE, flp = TRUE, ndeclust = 15, onlytime = FALSE, 
    is.backconstant = FALSE, sectoday = FALSE, usenlm = TRUE, 
    compsqm = TRUE, epsmax = 1e-04, iterlim = 100, ntheta = 36)

 
 
 
Number of observations             2226 
ETAS Parameters: 
        mu         k0          c          p      gamma          d          q 
  0.667509   0.022393   0.014769   1.110059   0.000000   1.905461   1.947223 
magnitude 
  0.740109 
# summary method for more informative output etasclass object

summary(esecov1)
# plot results with maps of intensities and diagnostic tools 

plot(esecov1)

## an application with 5 covariates
esecov5&lt;-etasclass(cat.orig = catalog.withcov, magn.threshold = 2.5, magn.threshold.back = 3.9, 
mu = 0.3, k0 = 0.02, c = 0.015, p = 0.99, gamma = 0, d = 1, 
q = 1.5, params.ind = c(TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, TRUE), 
formula1 = "time ~ z + magnitude +nstaloc_rev +min_distance_rev+distmin- 1", 
declustering = TRUE, thinning = FALSE, flp = TRUE, ndeclust = 15, 
onlytime = FALSE, is.backconstant = FALSE, sectoday = FALSE, 
usenlm = TRUE, compsqm = TRUE, epsmax = 1e-04, iterlim = 100, 
ntheta = 36)

## print results, more out put with summary
 print(esecov5)
Call: 
 
etasclass(cat.orig = catalog.withcov, magn.threshold = 2.5, magn.threshold.back = 3.9, 
    mu = 0.3, k0 = 0.02, c = 0.015, p = 0.99, gamma = 0, d = 1, 
    q = 1.5, params.ind = c(TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, 
        TRUE), formula1 = "time ~ z + magnitude +nstaloc_rev +min_distance_rev+distmin- 1", 
    declustering = TRUE, thinning = FALSE, flp = TRUE, ndeclust = 15, 
    onlytime = FALSE, is.backconstant = FALSE, sectoday = FALSE, 
    usenlm = TRUE, compsqm = TRUE, epsmax = 1e-04, iterlim = 100, 
    ntheta = 36)

 
 
 
Number of observations             2226 
ETAS Parameters: 
              mu               k0                c                p 
        0.705351         0.073070         0.019396         1.154186 
           gamma                d                q                z 
        0.000000         1.942929         2.004915        -0.041256 
      magnitude      nstaloc_rev min_distance_rev          distmin 
        1.157698        -0.009010        -0.011020        -1.826717 


## End(Not run)
</code></pre>

<hr>
<h2 id='etasFLP-internal'>Internal etasFLP functions</h2><span id='topic+triangle.alphabetac.b'></span><span id='topic+triangle.abgamma.c'></span><span id='topic+triangle.abc.gamma'></span><span id='topic+triangle.abgamma.alpha'></span><span id='topic+embedding.rect.eps'></span><span id='topic+embedding.rect.cat.eps'></span><span id='topic+angle.positive'></span><span id='topic+cartesian2polar2D'></span><span id='topic+region.P'></span><span id='topic+flpkspace'></span><span id='topic+etas.mod2NEW'></span><span id='topic+flp1.etas.nlmNEW'></span><span id='topic+longlat.to.km'></span><span id='topic+timechar.to.seq'></span><span id='topic+generaloptimizationNEW'></span><span id='topic+cat.select'></span>

<h3>Description</h3>

<p>Internal functions used in the package etasFLP </p>


<h3>Details</h3>

<p>These are not intended to be used directly by users</p>


<h3>Author(s)</h3>

<p>Marcello Chiodi</p>

<hr>
<h2 id='italycatalog'>Small sample catalog of italian earthquakes</h2><span id='topic+italycatalog'></span>

<h3>Description</h3>

<p>A small sample catalog of italian earthquakes of magnitude at least 3.0 from year 2005 to year 2013.</p>


<h3>Usage</h3>

<pre><code class='language-R'>italycatalog</code></pre>


<h3>Format</h3>

<p>a data matrix with 2,158 observations and 5 variables: <code>time</code>, <code>lat</code>, <code>long</code>, <code>z</code>, <code>magn1</code>.
</p>


<h3>Source</h3>

<p>INGV (Istituto Nazionale di Geofisica e Vulcanologia) ISIDE Data Base.</p>


<h3>References</h3>

<p>INGV  home page: <a href="https://www.ingv.it/">https://www.ingv.it/</a>.</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(italycatalog)
str(italycatalog)
</code></pre>

<hr>
<h2 id='kde2dnew.fortran'>A 2-d normal kernel estimator</h2><span id='topic+kde2dnew.fortran'></span><span id='topic+kde2d.integral'></span>

<h3>Description</h3>

<p>A simple and quick 2-d weighted normal kernel estimator, with fixed bandwidth 
and relative integral.</p>


<h3>Usage</h3>

<pre><code class='language-R'>kde2dnew.fortran(
#        parallel=FALSE,
         xkern,ykern,gx,gy,h,
         factor.xy=1,eps=0,w=replicate(length(xkern),1),
hvarx=replicate(length(xkern),1),hvary=replicate(length(xkern),1)
)

kde2d.integral(xkern,ykern,gx=xkern,gy=ykern,eps=0,factor.xy=1,
           h  = c(   bwd.nrd(xkern,w),bwd.nrd(ykern,w)),w=replicate(length(xkern),1),
           hvarx=replicate(length(xkern),1),hvary=replicate(length(xkern),1)
           )

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="kde2dnew.fortran_+3A_xkern">xkern</code></td>
<td>
<p>x-values of kernel points of length <code>n</code> (<code>n</code>=<code>length(xkern)</code>).</p>
</td></tr>
<tr><td><code id="kde2dnew.fortran_+3A_ykern">ykern</code></td>
<td>
<p>y-values of kernel points of length <code>n</code>.</p>
</td></tr>
<tr><td><code id="kde2dnew.fortran_+3A_gx">gx</code></td>
<td>
<p>x-values of the points where densities must be estimated.</p>
</td></tr>
<tr><td><code id="kde2dnew.fortran_+3A_gy">gy</code></td>
<td>
<p>y-values of the points where densities must be estimated.</p>
</td></tr>
<tr><td><code id="kde2dnew.fortran_+3A_h">h</code></td>
<td>
<p>bandwidths: a length 2 numerical vector.</p>
</td></tr>
<tr><td><code id="kde2dnew.fortran_+3A_eps">eps</code></td>
<td>
<p>enlargment factor for the region of interest.</p>
</td></tr>
<tr><td><code id="kde2dnew.fortran_+3A_factor.xy">factor.xy</code></td>
<td>
<p>expansion factor for bandwidths (density will be smoother if  <code>factor.xy</code>&gt;1).</p>
</td></tr>
<tr><td><code id="kde2dnew.fortran_+3A_w">w</code></td>
<td>
<p>vector of weights to give to observed points (length <code>n</code>).</p>
</td></tr></table>
<p>[]
</p>
<table>
<tr><td><code id="kde2dnew.fortran_+3A_hvarx">hvarx</code></td>
<td>
<p>Longitude bandwidths adjustement used in the kernel estimator of background seismicity. The length must be equal to the number of events of the catalog after event selection (can be less than <code>nrow(cat.orig)</code>). Default value = <code>replicate(length(xkern),1)</code> </p>
</td></tr>
<tr><td><code id="kde2dnew.fortran_+3A_hvary">hvary</code></td>
<td>
<p>Longitude bandwidths adjustement used in the kernel estimator of background seismicity. The length must be equal to the number of events of the catalog after event selection (can be less than <code>nrow(cat.orig)</code>).Default value = <code>replicate(length(xkern),1)</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>A standard bivariate normal kernel estimator.</p>


<h3>Value</h3>

<p>grid values and estimated densities.
</p>


<h3>Author(s)</h3>

<p>Marcello Chiodi.</p>


<h3>References</h3>

<p>Venables, W. N. and Ripley, B. D. (2002) <em>Modern Applied Statistics with S</em>. 
Fourth edition. Springer.
Wand, M.P and Jones, M.C. (1995). <em>Kernel Smoothing</em>. London: Chapman &amp; Hall/CRC. 
</p>

<hr>
<h2 id='magn.plot'>
Transformed plot of the magnitudes distribution of an earthquakes catalog</h2><span id='topic+magn.plot'></span>

<h3>Description</h3>

<p>Plots the logarithm of the cumulative frequency of eccedence vs. magnitude in an earthquake catalog.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>magn.plot(catalog, main = "Transformed plot of magnitude frequencies", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="magn.plot_+3A_catalog">catalog</code></td>
<td>
<p>should be a <code>eqcat</code> object, or at least must contain a column with name <code>magn1</code>.</p>
</td></tr>
<tr><td><code id="magn.plot_+3A_main">main</code></td>
<td>
<p>Title to give to the plot</p>
</td></tr>
<tr><td><code id="magn.plot_+3A_...">...</code></td>
<td>
<p>other arguments to be passed to <code>plot()</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>For each magnitude <code class="reqn">m_j</code>, if <code class="reqn">N_j</code> is the number of values of <code>magn1</code> greater than <code class="reqn">m_j</code>,
the values of  <code class="reqn">\log(N_j)</code> vs. <code class="reqn">m_j</code> are plotted.
</p>
<p>According to the Gutenberg-Richter law, this plot should be linear. If there is a linear behaviour only for values greater 
than a given <code class="reqn">m_0</code>, then  <code class="reqn">m_0</code> is probably the magnitude threshold of the catalog.
</p>


<h3>Value</h3>

<p>A new plot is printed (see details).</p>


<h3>Author(s)</h3>

<p>Marcello Chiodi.</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data(italycatalog)
magn.plot(italycatalog) 

## End(Not run)
</code></pre>

<hr>
<h2 id='MLA.freq'>Display a pretty frequency table
</h2><span id='topic+MLA.freq'></span>

<h3>Description</h3>

<p>Display a pretty frequency table. It is only a wrapper to the function <code>table</code>
but with a richer  output, at least for numerical variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MLA.freq(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="MLA.freq_+3A_x">x</code></td>
<td>
<p>a numeric vector.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The output gives the different kinds of frequencies and cumulated frequencies:
single frequencies, cumulated and back cumulated (absolute and relatives).
</p>


<h3>Value</h3>

<p>return a matrix with 7 columns: the modaldistinct values of <code>x</code>, frequencies, relative frequencies, cumulated frequencies,
cumulated relative frequencies,  back cumulated frequencies
and back cumulated relative frequencies.
</p>


<h3>Author(s)</h3>

<p>Marcello Chiodi</p>


<h3>Examples</h3>

<pre><code class='language-R'>
x=trunc(runif(1000)*10)
MLA.freq(x)

data(italycatalog)
MLA.freq(italycatalog$magn1)

</code></pre>

<hr>
<h2 id='plot.etasclass'>Plot method for etasclass objects</h2><span id='topic+plot.etasclass'></span>

<h3>Description</h3>

<p>This is the main method  to  visualize graphically the output of an object of class <code>etasclass</code>.
</p>
<p>By default the space-time region is the same used for the estimation of the ETAS model. 
Background, triggered and total space intensities
are also plotted for a grid of values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'etasclass'
plot(x,pdf=FALSE,file ="etasplot",  ngrid=201,nclass=10,tfixed=0,flag.log=FALSE,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.etasclass_+3A_x">x</code></td>
<td>
<p>an <code>etaclass</code> object.</p>
</td></tr>
<tr><td><code id="plot.etasclass_+3A_pdf">pdf</code></td>
<td>
<p>If <code>TRUE</code>, then 2D plots are sent to a pdf file</p>
</td></tr>
<tr><td><code id="plot.etasclass_+3A_file">file</code></td>
<td>
<p>name of the pdf file</p>
</td></tr>
<tr><td><code id="plot.etasclass_+3A_ngrid">ngrid</code></td>
<td>
<p>number of points for each direction (<code>x</code>, <code>y</code>) of a <code>ngrid*ngrid</code> grid where estimated  intensities must be evaluated. Default value= 201.</p>
</td></tr>
<tr><td><code id="plot.etasclass_+3A_nclass">nclass</code></td>
<td>
<p>number of class for each direction (<code>x</code>, <code>y</code>) of a grid of <code>nclass*nclass</code> cells where estimated  intensities must be evaluated.
Must divide <code>ngrid-1</code>. Default value= 10.</p>
</td></tr>
<tr><td><code id="plot.etasclass_+3A_tfixed">tfixed</code></td>
<td>
<p>If a positive value is given, then the triggered intensity at time <code>tfixed</code> is estimated and visualized.</p>
</td></tr>
<tr><td><code id="plot.etasclass_+3A_flag.log">flag.log</code></td>
<td>
<p>If <code>TRUE</code> then a  <code>log</code> scale is used to plot intensities.</p>
</td></tr>
<tr><td><code id="plot.etasclass_+3A_...">...</code></td>
<td>
<p>other arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Different plots of the output of an object of class <code>etasclass</code>.
</p>
<p>By default the space-time region is the same used for the estimation of the ETAS model. 
Background, triggered and total space intensities
are also computed and plotted for a grid of values.
</p>
<p>If a positive value is given for <code>tfixed</code>, then the triggered intensity at time <code>tfixed</code> is estimated and visualized.
A tipical use can be with <code>tfixed</code> a day after a big earthquake.
</p>
<p>For space dimension, four plot are drawn with triggered, observed, total intensity, and total intensity with points.
</p>
<p>Starting with the package version 1.2.0 different kind of residual analysis are computed and visualized, separately for the space and time dimensions. (8 plot on three windows for the space and 2 plots on one window for the time)
</p>
<p>Then two plots are printed for space residuals for total and background intensities
</p>
<p>Space residuals are computed dividing the observed rectangular space area in
a equally spaced  grid of <code>nclass</code> intervals for each dimension, so to
divide the observed space area in <code>nclass</code> x <code>nclass</code> rectangular cells.
We obtain the classical comparison between observed and
theoretical frequencies. All frequencies are related to the whole time interval (and thus theoretical frequencies are obtained integrating estimated intensities with respect to time).
</p>
<p>Fifth graph (image plot)
</p>
<p>We define  <code>nclass</code> x <code>nclass</code> standardized
residuals:
</p>
<p style="text-align: center;"><code class="reqn">
z_{\ell j} \ = \frac{n_{\ell j}-\hat{\nu}_{\ell j}}{\sqrt{\hat{\nu}_{\ell j}}}
\qquad (\ell =1,2,...,nclass; \ j=1,2,...,nclass)
 </code>
</p>

<p>For each cell <code class="reqn">\ell j</code> we have observed (<code class="reqn">n_{\ell j}</code>) and
theoretical frequency (<code class="reqn">\hat{\nu}_{\ell j}</code>).
</p>
<p>Sixth graph (image plot)
</p>
<p>We used a similar technique  to compute residuals for the
background seismicity only, to check if at least the estimation of
the  background component is appropriate. To this purpose the
observed background frequencies (<code class="reqn">{}_b n_{ \ell j}</code>) are now
computed  by the sum of the estimated weights <code>rho.weights</code> and the theoretical background frequency <code class="reqn">{}_b \hat{\nu}_{\ell j}</code> by the  estimated
marginal space background intensity in each cell.
</p>
<p>From these quantities we obtain
<code>nclass</code> x <code>nclass</code> standardized residuals for the background intensity
only:
</p>
<p style="text-align: center;"><code class="reqn">
{}_b z_{\ell j} \ = \frac{{}_b n_{\ell j} \ - \ {}_b
\hat{\nu}_{\ell j}}{\sqrt{{}_b \hat{\nu}_{\ell j}}} \qquad (\ell =1,2,...,nclass; \
j=1,2,...,nclass)
</code>
</p>

<p>seventh plot: (space intensities (integrated over time))
</p>
<p>A 3x2 plot: first column for observed vs.theoretical  , second column  for standardized residuals vs theoretical values. First row for total intensity, second row for background intensity, and third row for their difference, the triggered intensities
</p>
<p>eight-th graph:
</p>
<p>To check departure of the model for the time dimension, we first
integrated the estimated intensity function with respect to the
observed space region, so to obtain an estimated time process (a
one dimensional ETAS model):
</p>
<p style="text-align: center;"><code class="reqn">\hat{\lambda}(t)=
 \int \int_{\Omega_{(x,y)}}\,
\hat{\lambda}(x,y,t)\,d x \, d y </code>
</p>

<p>As known, a non-homogeneous time
process can be transformed to a homogeneous one through the
integral transformation:
</p>
<p style="text-align: center;"><code class="reqn">\tau_i = 
\int_{t_0}^{t_{i}} 
\hat{\lambda}(t) \ d t
</code>
</p>

<p>Then, a plot of <code class="reqn">\tau_i</code> versus
<code class="reqn">i</code> can give information about the departures of the models in the
time dimension. In particular, this plot, together with a plot of
the estimated time intensities, drawn on the same graphic winodw, can inform  on the time at which
departures are more evident
</p>
<p>If <code>pdf=TRUE</code> all graphs are printed on a pdf file, as spcified by <code>file</code>; otherwise 
default screen device is used. 
</p>


<h3>Value</h3>

<p>This 
<code>plot</code> method computes, among others, <code>back.grid</code>, <code>trig.grid</code>, 
with coordinates <code>x.grid</code> and <code>y.grid</code>  used to obtain image plots of background, triggered and total spatial estimated intensities
(see <code><a href="#topic+etasclass">etasclass</a></code> to see the details of the mixed estimation method used).
</p>
<table>
<tr><td><code>x.grid</code></td>
<td>
<p>x grid values.</p>
</td></tr>
<tr><td><code>y.grid</code></td>
<td>
<p>y grid values.</p>
</td></tr>
<tr><td><code>back.grid</code></td>
<td>
<p>background intensity estimated on a <code>ngrid</code> x <code>ngrid</code> grid.</p>
</td></tr>
<tr><td><code>trig.grid</code></td>
<td>
<p>triggered intensities estimated on a grid of <code>ngrid</code> x <code>ngrid</code> points.</p>
</td></tr>
<tr><td><code>tot.grid</code></td>
<td>
<p>total intensities estimated on a grid of <code>ngrid</code> x <code>ngrid</code> points.</p>
</td></tr>
<tr><td><code>tfixed</code></td>
<td>
<p>the fixed time for which intensity is estimated and visualized.</p>
</td></tr>
<tr><td><code>totfixed.grid</code></td>
<td>
<p>total intensities estimated on a grid of <code>ngrid</code> x <code>ngrid</code> points at time <code>tfixed</code>.</p>
</td></tr>
<tr><td><code>back.grid</code></td>
<td>
<p>background space intensity estimated for observed points.</p>
</td></tr>
<tr><td><code>trig.grid</code></td>
<td>
<p>triggered space intensities estimated for observed points.</p>
</td></tr>
<tr><td><code>tot.grid</code></td>
<td>
<p>total space intensities estimated for observed points.</p>
</td></tr>
<tr><td><code>teo1</code></td>
<td>
<p>matrix of <code>nclass*nclass</code> cells with theoretical total space intensities.</p>
</td></tr>
<tr><td><code>teo2</code></td>
<td>
<p>matrix of <code>nclass*nclass</code> cells with theoretical background space intensities.</p>
</td></tr>
<tr><td><code>emp1</code></td>
<td>
<p>matrix of <code>nclass*nclass</code> cells with empirical total space intensities.</p>
</td></tr>
<tr><td><code>emp2</code></td>
<td>
<p>matrix of <code>nclass*nclass</code> cells with empirical background space intensities.</p>
</td></tr>
<tr><td><code>t.trasf</code></td>
<td>
<p>vector  of transformed times.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>In this first version the x-y space region, where the point process is defined, by default is  a rectangle embedding the catalog values.
</p>


<h3>Author(s)</h3>

<p>Marcello Chiodi, Giada Adelfio</p>


<h3>References</h3>

<p>Adelfio G, Chiodi M (2009).Second-Order Diagnostics for Space-Time Point Processes with
Application to Seismic Events. <em>Environmetrics</em>, <b>20</b>(8), 895-911. doi:10.1002/env.961.
</p>
<p>Adelfio G, Chiodi M (2015). FLP Estimation of Semi-Parametric Models for Space-Time
Point Processes and Diagnostic Tools. <em>Spatial Statistics</em>, <b>14</b>(B), 119-132. doi:10.1016/j.spasta.2015.06.004.
</p>
<p>Adelfio G, Schoenberg FP (2009). Point Process Diagnostics Based on Weighted Second-
Order Statistics and Their Asymptotic Properties. <em>The Annals of the Institute of Statistical
Mathematics</em>, <b>61</b>(4), 929-948. doi:10.1007/s10463-008-0177-1.
</p>
<p>Chiodi, M. and Adelfio, G., (2017) Mixed Non-Parametric and Parametric Estimation Techniques in R Package etasFLP for Earthquakes' Description. <em>Journal of Statistical Software</em>, vol. <b>76</b> (3), pp. 1-28.
DOI: 10.18637/jss.v076.i03.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+etasclass">etasclass</a></code>,  <code><a href="#topic+eqcat">eqcat</a></code>, <code><a href="#topic+profile.etasclass">profile.etasclass</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
data("italycatalog")
# load a sample catalog of the italian seismicity

class(italycatalog)&lt;-"eqcat"


# plot method

plot(\code{an etasclass object})


## End(Not run)
</code></pre>

<hr>
<h2 id='plot.profile.etasclass'>plot method for profile.etasclass objects (profile likelihood of ETAS model)</h2><span id='topic+plot.profile.etasclass'></span>

<h3>Description</h3>

<p><code>plot</code> method for <code>profile.etasclass</code> objects (profile likelihood of ETAS model). Plots a smooth interpolation of the profile likelihood of a parameter of an ETAS model, as output from <code>profile.etasclass</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'profile.etasclass'
plot(x,prob=c(0.90,0.95,0.99), use.main = TRUE,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.profile.etasclass_+3A_x">x</code></td>
<td>
<p>An object of the class  <code>profile.etasclass</code>.</p>
</td></tr>
<tr><td><code id="plot.profile.etasclass_+3A_prob">prob</code></td>
<td>
<p>A vector of coverage probability for the asymptotic confidence interval computed using  -2log(LR). Default value <code>prob</code>=c(0.90,0.95,0.99).</p>
</td></tr>
<tr><td><code id="plot.profile.etasclass_+3A_use.main">use.main</code></td>
<td>
<p>Logical. If <code>use.main=TRUE</code> then a title is printed in the profile plot</p>
</td></tr>
<tr><td><code id="plot.profile.etasclass_+3A_...">...</code></td>
<td>
<p>other arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Plots a spline interpolation of the profile likelihood for a parameter of the ETAS model for earthquake seismicity, computed with <code>profile.etasclass</code>; 
</p>
<p>the order of parametrs is: (<code>mu</code>, <code>k0</code>, <code>c</code>, <code>p</code>, <code>a</code>, <code>gamma</code>, <code>d</code>, <code>q</code>).
</p>
<p>A <code>plot</code> method is defined for <code>profile.etasclass</code> objects. A number of grid points <code>nprofile</code>  of 7 (the default) usually is enough to have a good interpolation of the profile likelihood.
</p>


<h3>Value</h3>

<p>Plots a profile likelihood (in the scale -2log(LR)), and plots horizontal lines corresponding to the percentiles of a 1df chi-square variable of levels <code>prob</code>; the approximate confidence intervals corresponding to the levels <code>prob</code> are printed. Returns a list:
</p>
<table>
<tr><td><code>spline.profile</code></td>
<td>
<p>The spline interpolation of the profile likelihood.</p>
</td></tr>
<tr><td><code>conf</code></td>
<td>
<p>The approximate confidence intervals corresponding to the levels <code>prob</code>.</p>
</td></tr>
<tr><td><code>prob</code></td>
<td>
<p>The <code>prob</code> values used.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>A odd number of grid points <code>nprofile</code>  is adviced, so that the central point is the unconstrained ML estimate for the profiled parameter, and the interpolation of the profile likelihood will have a better quality.</p>


<h3>Author(s)</h3>

<p>Marcello Chiodi, Giada Adelfio</p>


<h3>See Also</h3>

 <p><code><a href="#topic+eqcat">eqcat</a></code>, <code><a href="#topic+etasclass">etasclass</a></code>, <code><a href="#topic+profile.etasclass">profile.etasclass</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
## see example in profile.etasclass

## End(Not run)</code></pre>

<hr>
<h2 id='print.etasclass'>Print method for etasclass objects</h2><span id='topic+print.etasclass'></span>

<h3>Description</h3>

<p>Print method for an object of class <code>etasclass</code>.
</p>
<p>Gives some information on the execution and gives estimates of the ETAS parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'etasclass'
print(x,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.etasclass_+3A_x">x</code></td>
<td>
<p>an <code>etaclass</code> object.</p>
</td></tr>
<tr><td><code id="print.etasclass_+3A_...">...</code></td>
<td>
<p>other arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Print brief information about an object of class <code>etasclass</code>. More output is obtained with <code>summary</code>.
</p>


<h3>Value</h3>

<p>Displays parameters estimates and information on the execution of the <code>etasclass</code>
estimation process. Displays also  the exact call of the function that generated <code>etasclass</code>
</p>


<h3>Author(s)</h3>

<p>Marcello Chiodi, Giada Adelfio</p>


<h3>See Also</h3>

 <p><code><a href="#topic+etasclass">etasclass</a></code>,<code><a href="#topic+eqcat">eqcat</a></code>, <code><a href="#topic+profile.etasclass">profile.etasclass</a></code></p>

<hr>
<h2 id='profile.etasclass'>profile method for etasclass objects (ETAS model) (To be checked)</h2><span id='topic+profile.etasclass'></span>

<h3>Description</h3>

<p> profile method for etasclass objects (ETAS model).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'etasclass'
profile(fitted,iprofile		=1,
				 nprofile	=7,
				 kprofile	=3,
				 profile.approx	=FALSE,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="profile.etasclass_+3A_fitted">fitted</code></td>
<td>
<p>An object of the class  <code>etasclass</code></p>
</td></tr></table>
<p>.
</p>
<table>
<tr><td><code id="profile.etasclass_+3A_iprofile">iprofile</code></td>
<td>
<p>An integer in the range 1-7. Profile likelihood will be computed with respect to the parameter of index <code>iprofile</code>. The order of parametrs is: <code>mu</code>, <code>k0</code>, <code>c</code>, <code>p</code>, <code>a</code>, <code>gamma</code>, <code>d</code>, <code>q</code>.
In this version 2.0.0 <code>profile</code> only for etas parameters, not for covariates parameters. It will added future versions  				 
</p>
</td></tr>
<tr><td><code id="profile.etasclass_+3A_nprofile">nprofile</code></td>
<td>
<p>Number of values of <code>params[iprofile]</code> for which profile likelihood must be computed.  Default value= 7.
</p>
</td></tr>
<tr><td><code id="profile.etasclass_+3A_kprofile">kprofile</code></td>
<td>
<p>Maximum absolute standardized value for <code>params[iprofile]</code>. Profile likelihood will be computed in the standardized range [-<code>kprofile</code>, <code>kprofile</code>].  Default value= 3.
</p>
</td></tr>
<tr><td><code id="profile.etasclass_+3A_profile.approx">profile.approx</code></td>
<td>
<p>if <code>TRUE</code>, then a conditional-likelihood approach is used as a first value for  each maximization step in profile likelihood computation.  Default value= <code>FALSE</code>.
</p>
</td></tr>
<tr><td><code id="profile.etasclass_+3A_...">...</code></td>
<td>
<p>other arguments.</p>
</td></tr>  
</table>


<h3>Details</h3>

<p>Profile likelihood for the <code>iprofile</code>-th parameter of the ETAS model for earthquake seismicity, estimated with <code>etasclass</code>; the order of parameters is: <code>mu</code>,<code>k0</code>,<code>c</code>,<code>p</code>,<code>gamma</code>,<code>d</code>,<code>q</code> and <code>betacov</code>.
</p>
<p>A <code>plot</code> method is defined for <code>profile.etasclass</code> objects. A number of grid points <code>nprofile</code>  of 7 (the default) usually is enough to have a good interpolation of the profile likelihood. The profile is computed using the final estimation of the background seismicity used to obtain the object <code>etas</code> of class <code>etasclass</code> and regardless to the method used. The computing time (for each of the <code>nprofile</code> values) is generally less than a single execution of <code>etasclass</code> without clustering, because only ML estimation is performed. Parameters not estimated in <code>etas</code> (with <code>params.ind[i]=FALSE</code>) will remain fixed do the value <code>params.fix[i]</code>.
</p>
<p>To obtain profiles for different parameters, run <code>profile.etasclass</code> with different values of <code>iprofile</code>.
</p>


<h3>Value</h3>

<p>Returns a list:
</p>
<table>
<tr><td><code>params.vec</code></td>
<td>
<p>vector of values of the parameter <code>iprofile</code> used to evaluate the profile likelihood.</p>
</td></tr>
<tr><td><code>logl.vec</code></td>
<td>
<p>vector of likelihoods corresponding to the values of <code>params.vec</code></p>
</td></tr>
</table>
<p><code>plot</code> method is defined to represent  profile likelihood (in  scale -2log(LR)), using a spline interpolation through  grid points, with superimposition of approximate confidence intervals.
</p>


<h3>Note</h3>

<p>A odd number of grid points <code>nprofile</code>  is adviced, so that the central point is the unconstrained ML estimate for the profiled parameter, and the interpolation of the profile likelihood will have a better quality.</p>


<h3>Author(s)</h3>

<p>Marcello Chiodi, Giada Adelfio</p>


<h3>See Also</h3>

 <p><code><a href="#topic+eqcat">eqcat</a></code>, <code><a href="#topic+etasclass">etasclass</a></code>, <code><a href="#topic+plot.profile.etasclass">plot.profile.etasclass</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: ##
data("italycatalog")
# load a sample catalog of italian seismicity  

   etas.flp&lt;-etasclass(italycatalog,  
   magn.threshold = 3.0,  magn.threshold.back = 3.5,
   k0 = 0.005, c = 0.005, p = 1.01, gamma = 0.6, q = 1.52, d = 1.1,
   params.ind = c(TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE),
   formula1 = "time ~  magnitude- 1", declustering = TRUE, 
   thinning = FALSE, flp = TRUE, ndeclust = 15,
   onlytime = FALSE, is.backconstant = FALSE,
   description = "etas flp",sectoday = TRUE,
   usenlm = TRUE, epsmax = 0.001)
    # execution of etasclass for events with minimum magnitude of 3.0. 
    # The events with magnitude at least 3.5 are used to build a first approximation
    # for the background intensity function
    # (magn.threshold.back=3.5)
    
## compute profile likelihood for the first parameter (mu)
 system.time( prof.flp &lt;- profile(etas.flp, nprofile = 7, iprofile = 1))
 plot(prof.flp)
#### output:
Asymptotic  confidence  intervals: 
  Coverage Lower Upper
1     0.90 0.335 0.376
2     0.95 0.334 0.378
3     0.99 0.329 0.385


## End(Not run)</code></pre>

<hr>
<h2 id='simpson.coeff'>
Computes Simpson integration rule coefficients</h2><span id='topic+simpson.coeff'></span><span id='topic+simpson.kD'></span>

<h3>Description</h3>

<p>Computes Simpson integration rule coefficients.</p>


<h3>Usage</h3>

<pre><code class='language-R'>simpson.coeff(n)
simpson.kD(n,k=2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="simpson.coeff_+3A_n">n</code></td>
<td>

<p>number of points of the simpson formula a single dimension</p>
</td></tr>
<tr><td><code id="simpson.coeff_+3A_k">k</code></td>
<td>

<p>number of dimensions</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>simpson.coeff</code> computes the coefficients of the standard Simpson rule (for unit spaced points), according to the sequence (1+4+2+4+...+2+4+1)/3 for each dimension. <code>simpson.kD</code> expand the formula over a grid of <code class="reqn">n^k</code> points in <code>k</code> dimensions.</p>


<h3>Value</h3>

<p>a vector of <code>n</code> coefficients (for <code>simpson.coeff</code>), a k-dimensions array with a total of <code class="reqn">n^k</code> elements for <code>simpson.kD</code>.</p>


<h3>Author(s)</h3>

<p>Marcello Chiodi
</p>

<hr>
<h2 id='summary.etasclass'>Summary method for etasclass objects</h2><span id='topic+summary.etasclass'></span>

<h3>Description</h3>

<p>This is the main method  to  summarize the output of an object of class <code>etasclass</code>.
</p>
<p>It gives some information on the execution and gives estimates of the ETAS parameters together with the standard errors.
</p>
<p>More detailed output is avaliable by inspecting <code>str(etasclass.object)</code>, and printing single objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'etasclass'
summary(object,full=FALSE,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.etasclass_+3A_object">object</code></td>
<td>
<p>an <code>etaclass</code> object to pass to <code>summary</code>.</p>
</td></tr>
<tr><td><code id="summary.etasclass_+3A_full">full</code></td>
<td>
<p> logical. New in version 2.2. If <code>TRUE</code> the full original call will be displayed together with some more output.</p>
</td></tr>
<tr><td><code id="summary.etasclass_+3A_...">...</code></td>
<td>
<p>other arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Displays summary information about an object of class <code>etasclass</code>.
</p>


<h3>Value</h3>

<p>Displays AIC values, parameters estimates and their standard errors, together with some information on the execution of the <code>etasclass</code>
estimation process.  Displays also  the exact call of the function that generated <code>etasclass</code>
</p>


<h3>Author(s)</h3>

<p>Marcello Chiodi, Giada Adelfio</p>


<h3>See Also</h3>

 <p><code><a href="#topic+etasclass">etasclass</a></code>,<code><a href="#topic+eqcat">eqcat</a></code>, <code><a href="#topic+profile.etasclass">profile.etasclass</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# summary method for the etasclass object esecov1 and esecov5 

(see examples in \code{\link{etasclass}})

## only with one covariate, the magnitude, classical ETAS model
&gt;   summary(esecov1)
Call: 
 
etasclass(cat.orig = catalog.withcov, magn.threshold = 2.5, magn.threshold.back = 3.9, 
    mu = 0.3, k0 = 0.02, c = 0.015, p = 0.99, gamma = 0, d = 1, 
    q = 1.5, params.ind = c(TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, 
        TRUE), formula1 = "time ~  magnitude- 1", declustering = TRUE, 
    thinning = FALSE, flp = TRUE, ndeclust = 15, onlytime = FALSE, 
    is.backconstant = FALSE, sectoday = FALSE, usenlm = TRUE, 
    compsqm = TRUE, epsmax = 1e-04, iterlim = 100, ntheta = 36)

 
 
 
Execution started:                  2020-05-03 00:24:08 
Elapsed time of execution (hours)   0.2294818 
Number of observations             2226 
Magnitude threshold                2.5 
declustering                        TRUE 
Number of declustering iterations   6 
Kind of declustering                weighting 
flp                                 TRUE 
sequence of AIC values for each iteration 
44887.75 43348.46 43250.77 43249.77 43249.27 43249.19 
 
final AIC value 
44887.75 43348.46 43250.77 43249.77 43249.27 43249.19 
 
------------------------------------------------------- 
 
formula for covariates of the triggered components: 
time ~ magnitude - 1
&lt;environment: 0x55968d6fd660&gt;
ETAS Parameters: 
                 Estimates       std.err.
mu                0.667509       0.022620
k0                0.022393       0.005781
c                 0.014769       0.002708
p                 1.110059       0.015709
gamma             0.000000       0.000000
d                 1.905461       0.260360
q                 1.947223       0.077627
magnitude        0.740109       0.092558
------------------------------------------------------- 

#### using covariates
&gt;   summary(esecov5)
Call: 
 
etasclass(cat.orig = catalog.withcov, magn.threshold = 2.5, magn.threshold.back = 3.9, 
    mu = 0.3, k0 = 0.02, c = 0.015, p = 0.99, gamma = 0, d = 1, 
    q = 1.5, params.ind = c(TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, 
        TRUE), formula1 = "time ~ z + magnitude +nstaloc_rev +min_distance_rev+distmin- 1", 
    declustering = TRUE, thinning = FALSE, flp = TRUE, ndeclust = 15, 
    onlytime = FALSE, is.backconstant = FALSE, sectoday = FALSE, 
    usenlm = TRUE, compsqm = TRUE, epsmax = 1e-04, iterlim = 100, 
    ntheta = 36)

 
 
 
Execution started:                  2020-05-03 12:22:31 
Elapsed time of execution (hours)   0.4827933 
Number of observations             2226 
Magnitude threshold                2.5 
declustering                        TRUE 
Number of declustering iterations   3 
Kind of declustering                weighting 
flp                                 TRUE 
sequence of AIC values for each iteration 
44693.04 42884.07 42706.16 
 
final AIC value 
44693.04 42884.07 42706.16 
 
------------------------------------------------------- 
 
formula for covariates of the triggered components: 
time ~ z + magnitude + nstaloc_rev + min_distance_rev + distmin - 
    1
&lt;environment: 0x55968d5ed118&gt;
ETAS Parameters: 
                       Estimates       std.err.
mu                      0.705351       0.022740
k0                      0.073070       0.021194
c                       0.019396       0.003435
p                       1.154186       0.016874
gamma                   0.000000       0.000000
d                       1.942929       0.272434
q                       2.004915       0.084784
z                      -0.041256       0.005779
magnitude              1.157698       0.085360
nstaloc_rev            -0.009010       0.001817
min_distance_rev       -0.011020       0.002804
distmin                -1.826717       0.298649
------------------------------------------------------- 



## End(Not run)
</code></pre>

<hr>
<h2 id='time2date'>
Date time conversion tools</h2><span id='topic+time2date'></span><span id='topic+timecharunique2seq'></span>

<h3>Description</h3>

<p>Date time conversion tools, useful in connection with package etasFLP for earthquake description. Base date is Jan. 1st 1900.</p>


<h3>Usage</h3>

<pre><code class='language-R'>time2date(t)

timecharunique2seq(timestring)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="time2date_+3A_t">t</code></td>
<td>
<p>seconds elapsed from 1900-1-1.</p>
</td></tr>
<tr><td><code id="time2date_+3A_timestring">timestring</code></td>
<td>
<p>A time string.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>time2date</code> converts sequential time in seconds into character string;
<code>timecharunique2seq</code>  converts character times of catalogs into sequential time (seconds elapsed from the base date): the input is a single string.</p>


<h3>Value</h3>

<p><code>time2date</code> returns a character string; <code>timecharunique2seq</code> returns a list:
</p>
<table>
<tr><td><code>char</code></td>
<td>
<p>the input string.</p>
</td></tr>
<tr><td><code>sec</code></td>
<td>
<p>seconds elapsed from the base date.</p>
</td></tr>
<tr><td><code>day</code></td>
<td>
<p>days elapsed from the base date.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Marcello Chiodi</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
tchar="1960-11-06 11:09:35.000"
tsec =timecharunique2seq(tchar)[["sec"]]
time2date(tsec)

## End(Not run)</code></pre>

<hr>
<h2 id='timeupdate.etasclass'>timeupdate.etasclass</h2><span id='topic+timeupdate.etasclass'></span>

<h3>Description</h3>

<p>New in version 2.2. A time updating of an etasclass objects: a very experimental version that can be used only on etasclass objects obtained from etasflp versions 2.2 or newer.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>timeupdate.etasclass(object, params.estimation = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="timeupdate.etasclass_+3A_object">object</code></td>
<td>
<p>an etasclass object  obtained from <code>etasFLP</code> versions 2.2 or newer that will be updated for a new time window with new events.</p>
</td></tr>
<tr><td><code id="timeupdate.etasclass_+3A_params.estimation">params.estimation</code></td>
<td>
<p>logical. if <code>TRUE</code> parameters will be  estimated again even if quickly, with few optimizations steps. Elsewhere ETAS estimates of input object will be mantained</p>
</td></tr>
<tr><td><code id="timeupdate.etasclass_+3A_...">...</code></td>
<td>
<p>optional arguments that will override the corresponding arguments in <code>object</code>, possibly including a new catalog input or a new <code>tmax</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>It is a beta version. 
A new ETAS model is fitted to a previous object of class etasclass with a new catalog which must be a catalog which extends the previous one on a wider time window, that is a catalog with new observations.  
</p>
<p>As a default a new quick execution is made, with one quick iteration for parameter updating and an iteration for background density estimation.
</p>


<h3>Value</h3>

<p>a new <code>etasclass</code> object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+update.etasclass">update.etasclass</a></code>
</p>

<hr>
<h2 id='update.etasclass'>update.etasclass</h2><span id='topic+update.etasclass'></span>

<h3>Description</h3>

<p>New in version 2.2. A method update for etasclass objects: a very experimental version that can be used only on etasclass objects obtained from etasflp versions 2.2 or newer.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'etasclass'
update(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="update.etasclass_+3A_object">object</code></td>
<td>
<p>an etasclass object  obtained from etasflp versions 2.2 or newer that will be updated.</p>
</td></tr>
<tr><td><code id="update.etasclass_+3A_...">...</code></td>
<td>
<p>optional arguments that will override the corresponding arguments in <code>object</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>It is a beta version. The catalog must be the same, and options in &quot;...&quot; must leave unchanged the number of observations used for estimation. Arguments given in &quot;...&quot; will override arguments already present in <code>object</code>. Not all arguments are suitable for updating: among them <code>formula</code> and <code>params.ind</code> should not be included in &quot;...&quot; list (to update such parameters it is better to assign them to a variable and then pass the variable name) . A new etasclass execution will start, using as arguments  values of input <code>object</code>, eventually integrated with the list in &quot;...&quot;. Tipically a first execution can be given with low values of iterlim, ndeclust, ntheta and high values of epsmax (e.g. iterlim=5, ndeclust=1, ntheta=24, epsmax=0.01), to obtain good starting values for parameters and for weights. Then an update can be run with better values such as iterlim=50, ndeclust=10, ntheta=60, epsmax=0.0001.
</p>


<h3>Value</h3>

<p>un updated <code>etasclass</code> object
</p>


<h3>See Also</h3>

<p><code><a href="#topic+timeupdate.etasclass">timeupdate.etasclass</a></code>
</p>

<hr>
<h2 id='xy.grid'>
Creates a 2-d grid</h2><span id='topic+xy.grid'></span>

<h3>Description</h3>

<p>Creates a 2-d grid.</p>


<h3>Usage</h3>

<pre><code class='language-R'>xy.grid(rangex, rangey, nx, ny = nx)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="xy.grid_+3A_rangex">rangex</code></td>
<td>
<p>A length 2 numeric vector: the range of the x-variable.</p>
</td></tr>
<tr><td><code id="xy.grid_+3A_rangey">rangey</code></td>
<td>
<p>A length 2 numeric vector: the range of the y-variable.</p>
</td></tr>
<tr><td><code id="xy.grid_+3A_nx">nx</code></td>
<td>
<p>The number of points of the grid in the x-direction.</p>
</td></tr>
<tr><td><code id="xy.grid_+3A_ny">ny</code></td>
<td>
<p>The number of points of the grid in the y-direction.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A grid of the coordinates of  <code>nx*ny</code> points on the x-y plane, expanded in a matrix of <code>nx*ny</code> rows and 2 columns: 
a row gives the (x,y) coordinates of a point.</p>


<h3>Examples</h3>

<pre><code class='language-R'>xy.grid(c(3,7),c(11,17),nx=5,ny=4)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
