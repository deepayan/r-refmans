<!DOCTYPE html><html><head><title>Help for package spflow</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {spflow}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#spflow-package'><p>Spatial econometric interaction models in R</p></a></li>
<li><a href='#%p%'><p>Additional infix operators for more concise code</p></a></li>
<li><a href='#add_details'><p>Internal method to add details to a <code>spflow_model-class()</code></p></a></li>
<li><a href='#assert_errors'><p>A set of functions to create customized error messages</p></a></li>
<li><a href='#by_source_model_matrix'><p>Internal functions to generate model matrices</p></a></li>
<li><a href='#custom_primitives'><p>A set of primitive functions to test conditions</p></a></li>
<li><a href='#dat'><p>Generic for accessing the data inside</p>
spflow network classes</a></li>
<li><a href='#define_variable_roles'><p>Internal functions to generate model matrices</p></a></li>
<li><a href='#derive_log_det_calculator'><p>Fill the lookup table created by <code>multinom_lookup_template()</code> with values</p></a></li>
<li><a href='#example_data'><p>Simulated data for stylized versions of Germany and the USA</p></a></li>
<li><a href='#expand_flow_neighborhood'><p>Derive the flow neighborhood matrices</p></a></li>
<li><a href='#id'><p>Generic for accessing the ids of</p>
spflow network classes</a></li>
<li><a href='#maybe'><p>Functions that replace errors by <code>NULL</code></p></a></li>
<li><a href='#mcmc_results'><p>Access the sampling results of a <code>spflow_model_mcmc-class()</code></p></a></li>
<li><a href='#moment_empirical_var'><p>Compute the moment expression in an interaction model in matrix form</p></a></li>
<li><a href='#multinom_coef'><p>Compute the multinomial coefficient</p></a></li>
<li><a href='#multinom_lookup_template'><p>Create a lookup table for the multinomial coefficient</p></a></li>
<li><a href='#named_list'><p>Some helpers to create lookups that allow to program with key value pairs</p></a></li>
<li><a href='#neighborhood'><p>Generic for accessing the neighborhood matrix inside</p>
spflow network classes</a></li>
<li><a href='#nnodes'><p>Generic for accessing the node count of</p>
spflow network classes</a></li>
<li><a href='#npairs'><p>Generic for accessing the node pairs count of a</p>
<code>sp_network_pair-class()</code></a></li>
<li><a href='#pair_merge'><p>Generic for merging information on origins and destination to node</p>
pairs inside spflow network classes</a></li>
<li><a href='#paris_data'><p>Example data for commuting flows within Paris</p></a></li>
<li><a href='#pull_member'><p>Generic for accessing a <code>sp_network_pair-class()</code> or a</p>
<code>sp_network_nodes-class()</code> inside a <code>sp_multi_network-class()</code></a></li>
<li><a href='#results'><p>Generic for accessing the results of a <code>spflow_model-class()</code>.</p></a></li>
<li><a href='#results_flat'><p>Access results of a <code>spflow_model()</code> as a one row data.frame</p></a></li>
<li><a href='#results&lt;-'><p>Replacement method for internal purposes</p></a></li>
<li><a href='#sd_error'><p>Generic for accessing the standard deviation of the residual inside</p>
a <code>spflow_model-class()</code>.</a></li>
<li><a href='#sp_multi_network'><p>Create an S4 class that contains <code>sp_network_nodes()</code> and <code>sp_network_pair()</code> for one or multiple networks</p></a></li>
<li><a href='#sp_multi_network-class'><p>Class sp_multi_network</p></a></li>
<li><a href='#sp_network_nodes'><p>Create a <code>sp_network_nodes-class()</code></p></a></li>
<li><a href='#sp_network_nodes-class'><p>sp_network_nodes Class</p></a></li>
<li><a href='#sp_network_pair'><p>Create an S4 object that contains information on origin-destination pairs</p></a></li>
<li><a href='#sp_network_pair-class'><p>Class sp_network_pair</p></a></li>
<li><a href='#spatial_filter'><p>Derive the spatial filter of an interaction model</p></a></li>
<li><a href='#spatial_model_order'><p>Derive the order of the spatial model</p></a></li>
<li><a href='#spflow'><p>Estimate spatial interaction models that incorporate spatial dependence</p></a></li>
<li><a href='#spflow_control'><p>Define details of the estimation procedure with the <code>spflow()</code> function.</p></a></li>
<li><a href='#spflow_model'><p>Internal function to construct a <code>spflow_model-class()</code></p></a></li>
<li><a href='#spflow_model_matrix'><p>Generate design matrices for the spatial interaction model</p></a></li>
<li><a href='#spflow_model_moments'><p>Compute the principal moments for a spatial flow model</p></a></li>
<li><a href='#spflow_model-class'><p>Class spflow_model</p></a></li>
<li><a href='#spflow_network_classes'><p>spflow network classes</p></a></li>
<li><a href='#spflow_sim'><p>Simulate spatial interactions</p></a></li>
<li><a href='#spflow-deprecated'><p>Deprecated functions in package <span class="pkg">spflow</span>.</p></a></li>
<li><a href='#translist'><p>Additional list operators that allow a more concise and</p>
functional programming style</a></li>
<li><a href='#varcov'><p>Generic for accessing the variance-covariance matrix of the</p>
parameters inside a <code>spflow_model-class()</code>.</a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Spatial Econometric Interaction Models</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2021-09-08</td>
</tr>
<tr>
<td>Description:</td>
<td>
    Efficient estimation of spatial econometric models of origin-destination flows, which may exhibit spatial autocorrelation in the dependent variable, the explanatory variables or both.
    The model is the one proposed by LeSage and Pace (2008) &lt;<a href="https://doi.org/10.1111%2Fj.1467-9787.2008.00573.x">doi:10.1111/j.1467-9787.2008.00573.x</a>&gt;, who develop a matrix formulation that exploits the relational structure of flow data.
    The estimation procedures follow most closely those outlined by Dargel (2021) (preprint available at <a href="https://www.tse-fr.eu/fr/publications/revisiting-estimation-methods-spatial-econometric-interaction-models">https://www.tse-fr.eu/fr/publications/revisiting-estimation-methods-spatial-econometric-interaction-models</a>).</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>RdMacros:</td>
<td>Rdpack</td>
</tr>
<tr>
<td>Imports:</td>
<td>coda, Matrix, methods, RSpectra, Rdpack, utils</td>
</tr>
<tr>
<td>Collate:</td>
<td>'spflow-package.R' 'utils_classes.R'
'class_0_generics-and-maybe-classes.R'
'class_sp-network-pair.R' 'class_sp-network-nodes.R'
'class_sp-network-meta.R' 'class_sp-network-multi.R'
'class_spflow-model-meta.R' 'class_spflow-model-children.R'
'example_data.R' 'fit-spflow-mcmc.R' 'fit-spflow-mle.R'
'fit-spflow-mle_hessian.R' 'fit-spflow-ols.R'
'fit-spflow-s2sls.R' 'spflow-control.R' 'spflow-formula.R'
'spflow-likelihood.R' 'spflow-logdet.R'
'spflow-model-estimation.R' 'spflow-model-matrix_1.R'
'spflow-model-matrix_2-transformations.R'
'spflow-model-matrix_3-spatial-lags.R'
'spflow-model-moments_1.R' 'spflow-model-moments_2-blocks.R'
'spflow-simulations.R' 'spflow.R' 'utils.R' 'utils_error.R'
'utils_formula.R' 'utils_fp.R' 'utils_math.R' 'utils_matrix.R'
'utils_strings.R'</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/LukeCe/spflow">https://github.com/LukeCe/spflow</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/LukeCe/spflow/issues">https://github.com/LukeCe/spflow/issues</a></td>
</tr>
<tr>
<td>Suggests:</td>
<td>covr, knitr, sf, sp, spdep, tinytest, rmarkdown</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>ByteCompile:</td>
<td>true</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-09-08 14:18:48 UTC; lukece</td>
</tr>
<tr>
<td>Author:</td>
<td>Lukas Dargel <a href="https://orcid.org/0000-0002-4839-506X"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Thibault Laurent <a href="https://orcid.org/0000-0001-7487-7671"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Christine Thomas [ths, ctb],
  Paula Margaretic [ctb],
  Gabriel Watkinson [ctb],
  Roger Bivand [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Lukas Dargel &lt;lukas.dargel@mailbox.org&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-09-09 09:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='spflow-package'>Spatial econometric interaction models in R</h2><span id='topic+spflow-package'></span><span id='topic+_PACKAGE'></span>

<h3>Description</h3>

<p>The <code>spflow</code> package provides function to estimate models of
origin-destination flows with spatial autocorrelation.
The implementation exploits the efficiency gains of the matrix formulation
that avoids duplication of the data that describes the origins and
the destinations.
It offers new data structures and a convenient formula interface
that allows to estimate the models with maximal efficiency and minimal
effort for the user.
The estimators are detailed in Dargel (2021).
</p>


<h3>Network data</h3>

<p>The package provides a new class for representing network data.
<a href="#topic+spflow_network_classes">These classes</a> help to exploit the relational
structure of the data and ensure that all origins and destinations are
correctly identified.
</p>


<h3>Model estimation</h3>

<p>The <code><a href="#topic+spflow">spflow()</a></code> function is the main function for estimation and can be used
out of the box using the default configuration, which corresponds to the
most general model possible.
Fine grained control over the estimation procedure is given via the
<code><a href="#topic+spflow_control">spflow_control()</a></code> argument through which the user can change, for example,
the estimation method or the way in which the covariates should be used.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Lukas Dargel <a href="mailto:lukas.dargel@mailbox.org">lukas.dargel@mailbox.org</a> (<a href="https://orcid.org/0000-0002-4839-506X">ORCID</a>)
</p>
<p>Authors:
</p>

<ul>
<li><p> Thibault Laurent <a href="mailto:thibault.laurent@tse-fr.eu">thibault.laurent@tse-fr.eu</a> (<a href="https://orcid.org/0000-0001-7487-7671">ORCID</a>)
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> Christine Thomas <a href="mailto:christine.thomas@tse-fr.eu">christine.thomas@tse-fr.eu</a> [thesis advisor, contributor]
</p>
</li>
<li><p> Paula Margaretic [contributor]
</p>
</li>
<li><p> Gabriel Watkinson [contributor]
</p>
</li>
<li><p> Roger Bivand [contributor]
</p>
</li></ul>



<h3>References</h3>

<p>Dargel L (2021).
&ldquo;Revisiting Estimation Methods for Spatial Econometric Interaction Models.&rdquo;
Toulouse School of Economics.
</p>


<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/LukeCe/spflow">https://github.com/LukeCe/spflow</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/LukeCe/spflow/issues">https://github.com/LukeCe/spflow/issues</a>
</p>
</li></ul>


<hr>
<h2 id='+25p+25'>Additional infix operators for more concise code</h2><span id='topic++25p+25'></span><span id='topic++25T+25'></span><span id='topic++25+7C+7C+25'></span><span id='topic++25+7C+21+7C+25'></span>

<h3>Description</h3>

<p>Additional infix operators for more concise code
</p>


<h3>Usage</h3>

<pre><code class='language-R'>x %p% y

x %T% y

x %||% y

x %|!|% y
</code></pre>


<h3>Author(s)</h3>

<p>Lukas Dargel
</p>

<hr>
<h2 id='add_details'>Internal method to add details to a <code><a href="#topic+spflow_model-class">spflow_model-class()</a></code></h2><span id='topic+add_details'></span>

<h3>Description</h3>

<p>Internal method to add details to a <code><a href="#topic+spflow_model-class">spflow_model-class()</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>add_details(object, ...)

## S4 method for signature 'spflow_model'
add_details(object, model_matrices, flow_control, model_moments)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="add_details_+3A_object">object</code></td>
<td>
<p>A <code><a href="#topic+spflow_model-class">spflow_model-class()</a></code></p>
</td></tr>
<tr><td><code id="add_details_+3A_model_matrices">model_matrices</code></td>
<td>
<p>A list as returned by <code><a href="#topic+spflow_model_matrix">spflow_model_matrix()</a></code></p>
</td></tr>
<tr><td><code id="add_details_+3A_flow_control">flow_control</code></td>
<td>
<p>A list as returned by <code><a href="#topic+spflow_control">spflow_control()</a></code></p>
</td></tr>
<tr><td><code id="add_details_+3A_model_moments">model_moments</code></td>
<td>
<p>A list as returned by <code><a href="#topic+spflow_model_moments">spflow_model_moments()</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The method adds the design matrix and the coefficient names to an
<code><a href="#topic+spflow_model-class">spflow_model-class()</a></code> object.
It also calculates the fitted values and the residuals as well as a
goodness-of-fit measure.
</p>


<h3>Value</h3>

<p>An object of class spflow_model
</p>

<hr>
<h2 id='assert_errors'>A set of functions to create customized error messages</h2><span id='topic+assert_errors'></span><span id='topic+assert'></span><span id='topic+assert_is'></span><span id='topic+assert_inherits'></span><span id='topic+assert_is_one_of'></span><span id='topic+assert_is_single_x'></span><span id='topic+assert_valid_case'></span>

<h3>Description</h3>

<p>The functions are build on top of <code><a href="base.html#topic+sprintf">sprintf()</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>assert(expr, error_msg = "ERROR", ..., warn = FALSE)

assert_is(obj, .class)

assert_inherits(obj, .class)

assert_is_one_of(obj, .classes)

assert_is_single_x(obj, x)

assert_valid_case(argument, cases)
</code></pre>


<h3>Value</h3>

<p>Functions called for their side effect, raises warning or error
</p>


<h3>Author(s)</h3>

<p>Lukas Dargel
</p>

<hr>
<h2 id='by_source_model_matrix'>Internal functions to generate model matrices</h2><span id='topic+by_source_model_matrix'></span>

<h3>Description</h3>

<p>Internal functions to generate model matrices
</p>


<h3>Usage</h3>

<pre><code class='language-R'>by_source_model_matrix(formula_parts, data_sources)
</code></pre>


<h3>Details</h3>

<p>Sources describe the data.frames holding the original information on
the nodes and the node pairs. There are three possible source data.frame
which are referred to as &quot;pair&quot;, &quot;orig&quot;, or &quot;dest&quot;.
All formulas (normal, sdm, and instrument) are combined to generate an
overall model matrix which is only expanded once for each source.
</p>


<h3>Value</h3>

<p>A list of matrices
</p>

<hr>
<h2 id='custom_primitives'>A set of primitive functions to test conditions</h2><span id='topic+custom_primitives'></span><span id='topic+is_one_of'></span><span id='topic+is_single_character'></span><span id='topic+is_single_logical'></span><span id='topic+is_single_numeric'></span><span id='topic+has_equal_elements'></span><span id='topic+has_distinct_elements'></span><span id='topic+none'></span>

<h3>Description</h3>

<p>A set of primitive functions to test conditions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>is_one_of(.obj, .classes)

is_single_character(x)

is_single_logical(x)

is_single_numeric(x)

has_equal_elements(obj)

has_distinct_elements(obj)

none(x)
</code></pre>


<h3>Value</h3>

<p>A logical
</p>


<h3>Author(s)</h3>

<p>Lukas Dargel
</p>

<hr>
<h2 id='dat'>Generic for accessing the data inside
<a href="#topic+spflow_network_classes">spflow network classes</a></h2><span id='topic+dat'></span><span id='topic+dat-set'></span><span id='topic+dat+3C-'></span>

<h3>Description</h3>

<p>For details on the methods see the documentation of the
corresponding classes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dat(object, ...)

dat(object) &lt;- value
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dat_+3A_object">object</code></td>
<td>
<p>An object belonging to the <a href="#topic+spflow_network_classes">spflow network classes</a></p>
</td></tr>
<tr><td><code id="dat_+3A_...">...</code></td>
<td>
<p>Arguments to be passed to methods</p>
</td></tr>
<tr><td><code id="dat_+3A_value">value</code></td>
<td>
<p>A data.frame to replace existing data</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A the data.frame describing the set of nodes or node-pairs
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spflow_network_classes">spflow_network_classes()</a></code>
</p>

<hr>
<h2 id='define_variable_roles'>Internal functions to generate model matrices</h2><span id='topic+define_variable_roles'></span>

<h3>Description</h3>

<p>Internal functions to generate model matrices
</p>


<h3>Usage</h3>

<pre><code class='language-R'>define_variable_roles(formula_parts, data_sources)
</code></pre>


<h3>Details</h3>

<p>The function generates a list for each role <code>c("Y_","G_","O_","D_","I_")</code>
which indicates whether a variable in the design matrix is used as
<code>c("norm", "sdm", "inst")</code>.
</p>


<h3>Value</h3>

<p>A list of lists, with information on the way variables are used
in the model. (e.g. origin vs destination and the number of lags)
</p>

<hr>
<h2 id='derive_log_det_calculator'>Fill the lookup table created by <code><a href="#topic+multinom_lookup_template">multinom_lookup_template()</a></code> with values</h2><span id='topic+derive_log_det_calculator'></span>

<h3>Description</h3>

<p>Fill the lookup table created by <code><a href="#topic+multinom_lookup_template">multinom_lookup_template()</a></code> with values
</p>


<h3>Usage</h3>

<pre><code class='language-R'>derive_log_det_calculator(OW_traces = NULL, DW_traces = NULL, n_o, n_d, model)
</code></pre>

<hr>
<h2 id='example_data'>Simulated data for stylized versions of Germany and the USA</h2><span id='topic+example_data'></span><span id='topic+multi_net_usa_ge'></span><span id='topic+germany_grid'></span><span id='topic+usa_net'></span><span id='topic+usa_grid'></span><span id='topic+germany_net'></span><span id='topic+simulation_params'></span>

<h3>Description</h3>

<p>The package uses the same stylized country examples as those presented by
Yang et al. (2017).
The first example is a stylized version of Germany with 16 states.
The second example is a stylized version of the USA with 51 states.
</p>
<p>We provide spatial objects that contain the geography of our example,
as well as two <code><a href="#topic+sp_network_nodes-class">sp_network_nodes-class()</a></code> objects.
Finally, there is an <code><a href="#topic+sp_multi_network-class">sp_multi_network-class()</a></code> containing the two networks
and four network pair objects based on the same example.
</p>
<p>The simulation parameters are given as <code>rho</code> for the auto-regressive
parameter, <code>delta</code> for the impact of the exogenous variables and <code>sd_error</code>
for standard deviation of the simulated Gaussian noise.
They are used to simulate two flow vectors <code>y2</code> and <code>y9</code> for each network
pair inside the <code>multi_net_usa_ge</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>multi_net_usa_ge

germany_grid

usa_net

usa_grid

germany_net

simulation_params
</code></pre>


<h3>Format</h3>

<p>An object of class <code>sp_multi_network</code> of length 1.
</p>
<p>An object of class <code>sf</code> (inherits from <code>data.frame</code>) with 16 rows and 3 columns.
</p>
<p>An object of class <code>sp_network_nodes</code> of length 1.
</p>
<p>An object of class <code>sf</code> (inherits from <code>data.frame</code>) with 51 rows and 3 columns.
</p>
<p>An object of class <code>sp_network_nodes</code> of length 1.
</p>
<p>An object of class <code>list</code> of length 3.
</p>


<h3>Source</h3>

<p>Simulated data inspired by
https://ialab.it.monash.edu/~dwyer/papers/maptrix.pdf
</p>


<h3>References</h3>

<p>Yang Y, Dwyer T, Goodwin S, Marriott K (2017).
&ldquo;Many-to-Many Geographically-Embedded Flow Visualisation: An Evaluation.&rdquo;
<em>IEEE Transactions on Visualization and Computer Graphics</em>, 411&ndash;420.
</p>

<hr>
<h2 id='expand_flow_neighborhood'>Derive the flow neighborhood matrices</h2><span id='topic+expand_flow_neighborhood'></span>

<h3>Description</h3>

<p>Use the neighborhood matrices of origins and destinations to derive the
three neighborhood matrices of the origin-destination flows.
This function is used for simulations or for comparisons with the vectorized
formulations of the model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expand_flow_neighborhood(
  OW,
  DW,
  n_o = OW %|!|% nrow(OW),
  n_d = DW %|!|% nrow(DW),
  model = "model_9"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="expand_flow_neighborhood_+3A_ow">OW</code></td>
<td>
<p>Origin neighborhood matrix</p>
</td></tr>
<tr><td><code id="expand_flow_neighborhood_+3A_dw">DW</code></td>
<td>
<p>Destination neighborhood matrix</p>
</td></tr>
<tr><td><code id="expand_flow_neighborhood_+3A_n_o">n_o</code></td>
<td>
<p>A numeric indicating the number of origins</p>
</td></tr>
<tr><td><code id="expand_flow_neighborhood_+3A_n_d">n_d</code></td>
<td>
<p>A numeric indicating the number of destinations</p>
</td></tr>
<tr><td><code id="expand_flow_neighborhood_+3A_model">model</code></td>
<td>
<p>A character indicating the model identifier</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other spflow simulation functions: 
<code><a href="#topic+spatial_filter">spatial_filter</a>()</code>,
<code><a href="#topic+spflow_sim">spflow_sim</a>()</code>
</p>

<hr>
<h2 id='id'>Generic for accessing the ids of
<a href="#topic+spflow_network_classes">spflow network classes</a></h2><span id='topic+id'></span><span id='topic+id-set'></span><span id='topic+id+3C-'></span>

<h3>Description</h3>

<p>For details on the methods see the documentation of the
corresponding classes.
</p>
<p>For details see the documentation of the corresponding classes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>id(object, ...)

id(object, ...) &lt;- value
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="id_+3A_object">object</code></td>
<td>
<p>A <a href="#topic+spflow_network_classes">spflow network class</a></p>
</td></tr>
<tr><td><code id="id_+3A_...">...</code></td>
<td>
<p>Arguments to be passed to methods</p>
</td></tr>
<tr><td><code id="id_+3A_value">value</code></td>
<td>
<p>A character replacing the existing id</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A character, corresponding to the id
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spflow_network_classes">spflow_network_classes()</a></code>
</p>

<hr>
<h2 id='maybe'>Functions that replace errors by <code>NULL</code></h2><span id='topic+maybe'></span>

<h3>Description</h3>

<p>Functions that replace errors by <code>NULL</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>maybe(expr)
</code></pre>


<h3>Author(s)</h3>

<p>Lukas Dargel
</p>

<hr>
<h2 id='mcmc_results'>Access the sampling results of a <code><a href="#topic+spflow_model_mcmc-class">spflow_model_mcmc-class()</a></code></h2><span id='topic+mcmc_results'></span>

<h3>Description</h3>

<p>For details see the documentation of the corresponding class.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mcmc_results(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="mcmc_results_+3A_object">object</code></td>
<td>
<p>A <code><a href="#topic+spflow_model_mcmc-class">spflow_model_mcmc-class()</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>An mcmc object, containing the draws of the sampled parameters
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spflow_model_mcmc-class">spflow_model_mcmc-class()</a></code>
</p>

<hr>
<h2 id='moment_empirical_var'>Compute the moment expression in an interaction model in matrix form</h2><span id='topic+moment_empirical_var'></span>

<h3>Description</h3>

<p>Compute the moment expression in an interaction model in matrix form
</p>


<h3>Usage</h3>

<pre><code class='language-R'>moment_empirical_var(model_matrices, N, n_d, n_o)
</code></pre>


<h3>Details</h3>

<p>The moment (U'U) moment matrix is grouped into (4x4) blocks.
These 16 blocks are derived as interactions from the four blocks
alpha, alpha_I, beta, gamma.
Only ten blocks are unique and the remaining six are inferred by symmetry.
The developments follow the theory presented in
Dargel (2021).
</p>


<h3>References</h3>

<p>Dargel L (2021).
&ldquo;Revisiting Estimation Methods for Spatial Econometric Interaction Models.&rdquo;
Toulouse School of Economics.
</p>

<hr>
<h2 id='multinom_coef'>Compute the multinomial coefficient</h2><span id='topic+multinom_coef'></span>

<h3>Description</h3>

<p>Compute the multinomial coefficient
</p>


<h3>Usage</h3>

<pre><code class='language-R'>multinom_coef(...)
</code></pre>


<h3>Details</h3>

<p>The coefficient is computed for each row in a data.frame where the
rows correspond to the power and the columns for one element
</p>

<hr>
<h2 id='multinom_lookup_template'>Create a lookup table for the multinomial coefficient</h2><span id='topic+multinom_lookup_template'></span>

<h3>Description</h3>

<p>Create a lookup table for the multinomial coefficient
</p>


<h3>Usage</h3>

<pre><code class='language-R'>multinom_lookup_template(max_power, coef_names)
</code></pre>

<hr>
<h2 id='named_list'>Some helpers to create lookups that allow to program with key value pairs</h2><span id='topic+named_list'></span><span id='topic+lookup'></span><span id='topic+list_lookup'></span><span id='topic+collect'></span><span id='topic+sort_names'></span>

<h3>Description</h3>

<p>Some helpers to create lookups that allow to program with key value pairs
</p>


<h3>Usage</h3>

<pre><code class='language-R'>named_list(names, init = NULL)

lookup(values, names = as.character(values))

list_lookup(values, names = as.character(values))

collect(names)

sort_names(x)
</code></pre>


<h3>Author(s)</h3>

<p>Lukas Dargel
</p>

<hr>
<h2 id='neighborhood'>Generic for accessing the neighborhood matrix inside
<a href="#topic+spflow_network_classes">spflow network classes</a></h2><span id='topic+neighborhood'></span><span id='topic+neighborhood+3C-'></span>

<h3>Description</h3>

<p>For details on the methods see the documentation of the
corresponding classes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>neighborhood(object, ...)

neighborhood(object) &lt;- value
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="neighborhood_+3A_object">object</code></td>
<td>
<p>One of <code><a href="#topic+sp_network_nodes-class">sp_network_nodes-class()</a></code>, <code><a href="#topic+sp_multi_network-class">sp_multi_network-class()</a></code></p>
</td></tr>
<tr><td><code id="neighborhood_+3A_...">...</code></td>
<td>
<p>Arguments to be passed to methods</p>
</td></tr>
<tr><td><code id="neighborhood_+3A_value">value</code></td>
<td>
<p>A neighborhood matrix to replace the existing one</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix (optionally sparse), representing the neighborhood links
betweem the nodes
</p>


<h3>See Also</h3>

<p><code><a href="#topic+sp_network_nodes-class">sp_network_nodes-class()</a></code> <code><a href="#topic+sp_multi_network-class">sp_multi_network-class()</a></code>
</p>

<hr>
<h2 id='nnodes'>Generic for accessing the node count of
<a href="#topic+spflow_network_classes">spflow network classes</a></h2><span id='topic+nnodes'></span>

<h3>Description</h3>

<p>For details on the methods see the documentation of the
corresponding classes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nnodes(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="nnodes_+3A_object">object</code></td>
<td>
<p>One of <code><a href="#topic+sp_network_nodes-class">sp_network_nodes-class()</a></code>, <code><a href="#topic+sp_network_pair-class">sp_network_pair-class()</a></code></p>
</td></tr>
<tr><td><code id="nnodes_+3A_...">...</code></td>
<td>
<p>Arguments to be passed to methods</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric, corresponding to the number of nodes
</p>


<h3>See Also</h3>

<p><code><a href="#topic+sp_network_nodes-class">sp_network_nodes-class()</a></code> <code><a href="#topic+sp_network_pair-class">sp_network_pair-class()</a></code>
</p>

<hr>
<h2 id='npairs'>Generic for accessing the node pairs count of a
<code><a href="#topic+sp_network_pair-class">sp_network_pair-class()</a></code></h2><span id='topic+npairs'></span>

<h3>Description</h3>

<p>For details on the method see the documentation of the
corresponding class.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>npairs(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="npairs_+3A_object">object</code></td>
<td>
<p>A <code><a href="#topic+sp_network_pair-class">sp_network_pair-class()</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric, corresponding to the number of node-pairs
</p>


<h3>See Also</h3>

<p><code><a href="#topic+sp_network_pair-class">sp_network_pair-class()</a></code>
</p>

<hr>
<h2 id='pair_merge'>Generic for merging information on origins and destination to node
pairs inside <a href="#topic+spflow_network_classes">spflow network classes</a></h2><span id='topic+pair_merge'></span><span id='topic+pair_merge+2Csp_multi_network-method'></span>

<h3>Description</h3>

<p>For details on the methods see the documentation of the
corresponding classes.
</p>
<p>The method merges all available information on origins and destinations to
the data.frame describing the pairs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pair_merge(object, ...)

## S4 method for signature 'sp_multi_network'
pair_merge(object, network_pair_id, all_pairs = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pair_merge_+3A_object">object</code></td>
<td>
<p>A <code><a href="#topic+sp_multi_network-class">sp_multi_network-class()</a></code></p>
</td></tr>
<tr><td><code id="pair_merge_+3A_...">...</code></td>
<td>
<p>Arguments to be passed to methods</p>
</td></tr>
<tr><td><code id="pair_merge_+3A_network_pair_id">network_pair_id</code></td>
<td>
<p>A character indicating the id of a <code><a href="#topic+sp_network_pair-class">sp_network_pair-class()</a></code></p>
</td></tr>
<tr><td><code id="pair_merge_+3A_all_pairs">all_pairs</code></td>
<td>
<p>A logical, when set to <code>TRUE</code> the resulting data.frame contains all
possible pairs of origins and destination, even if the data in the
<code><a href="#topic+sp_network_pair-class">sp_network_pair-class()</a></code> does not have them.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A single data.frame, combining all available information on origins, destinations and OD pairs
</p>


<h3>See Also</h3>

<p><code><a href="#topic+sp_multi_network-class">sp_multi_network-class()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># long form data for flows from Germany to Germany
pair_merge(multi_net_usa_ge,"ge_ge")

# long form data for flows from Germany to USA
pair_merge(multi_net_usa_ge,"ge_usa")
</code></pre>

<hr>
<h2 id='paris_data'>Example data for commuting flows within Paris</h2><span id='topic+paris_data'></span><span id='topic+paris10km_municipalities'></span><span id='topic+paris10km_commuteflows'></span><span id='topic+paris10km_neighborhood'></span>

<h3>Description</h3>

<p>The package includes an example data set that contains home-to-work
commuting flows for 71 municipalities around the center of Paris.
The data for the example is stored in three objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>paris10km_municipalities

paris10km_commuteflows

paris10km_neighborhood
</code></pre>


<h3>Format</h3>

<p>An object of class <code>sf</code> (inherits from <code>data.frame</code>) with 71 rows and 6 columns.
</p>
<p>An object of class <code>data.frame</code> with 5041 rows and 4 columns.
</p>
<p>An object of class <code>list</code> of length 3.
</p>


<h3>Details</h3>


<ol>
<li> <p><code>paris10km_municipalities</code> contains information on the municipalities.
It contains some socio-economic variables, the identifier of the
municipality and a geometry column.
The geometry is a MULTIPOLYGON that describes the shape of the region.
</p>
</li>
<li> <p><code>paris10km_commuteflows</code> contains information on pairs of municipalities.
It is a data.frame with origin and destination identifiers and contains
the information on the size of the commuting flows and the distance.
</p>
</li>
<li> <p><code>paris10km_neighborhood</code> contains three sparse matrices that represent
alternative definitions of the neighborhood of the municipalities.
The first is based on contiguity, the second one on distance and the third
one is based on the three nearest neighbours.
</p>
</li></ol>



<h3>Source</h3>

<p>The data combines different public sources (last accessed 2021-05-05).
</p>
<p>Three data sets are provided by INSEE.
More information on the rights to use and diffuse this data is provided <a href="https://www.insee.fr/fr/information/2008466">here</a>.
</p>

<ul>
<li><p> Commuting flows (https://www.insee.fr/fr/statistiques/fichier/3566477/base-texte-flux-mobilite-domicile-lieu-travail-2015.zip)
</p>
</li>
<li><p> Number of companies (https://www.insee.fr/fr/statistiques/2021271)
</p>
</li>
<li><p> Median income (https://www.insee.fr/fr/statistiques/3560121)
</p>
</li></ul>

<p>The geographies, population, and area of the municipalities come from <a href="https://public.opendatasoft.com/explore/?sort=modified">OpenDataSoft</a> and are available <a href="https://public.opendatasoft.com/explore/dataset/code-postal-code-insee-2015/export/?flg=fr&amp;location=2,18.52839,-2.98471&amp;basemap=jawg.streets">here</a>.
This data  set is published under an <a href="https://www.etalab.gouv.fr/wp-content/uploads/2014/05/Licence_Ouverte.pdf">OPEN LICENCE</a>.
</p>

<hr>
<h2 id='pull_member'>Generic for accessing a <code><a href="#topic+sp_network_pair-class">sp_network_pair-class()</a></code> or a
<code><a href="#topic+sp_network_nodes-class">sp_network_nodes-class()</a></code> inside a <code><a href="#topic+sp_multi_network-class">sp_multi_network-class()</a></code></h2><span id='topic+pull_member'></span>

<h3>Description</h3>

<p>For details on the method see the documentation of the
corresponding class.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pull_member(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pull_member_+3A_object">object</code></td>
<td>
<p>A <code><a href="#topic+sp_multi_network-class">sp_multi_network-class()</a></code></p>
</td></tr>
<tr><td><code id="pull_member_+3A_...">...</code></td>
<td>
<p>Arguments to be passed to methods</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code><a href="#topic+sp_network_pair-class">sp_network_pair-class()</a></code> or a <code><a href="#topic+sp_network_nodes-class">sp_network_nodes-class()</a></code>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+sp_multi_network-class">sp_multi_network-class()</a></code>
</p>

<hr>
<h2 id='results'>Generic for accessing the results of a <code><a href="#topic+spflow_model-class">spflow_model-class()</a></code>.</h2><span id='topic+results'></span>

<h3>Description</h3>

<p>For details on the methods see the documentation of the
corresponding classes.
</p>
<p>For details see the documentation of the corresponding class.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>results(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="results_+3A_object">object</code></td>
<td>
<p>A <code><a href="#topic+spflow_model-class">spflow_model-class()</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame, summarizing the results of the estimation
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spflow_model-class">spflow_model-class()</a></code>
</p>

<hr>
<h2 id='results_flat'>Access results of a <code><a href="#topic+spflow_model">spflow_model()</a></code> as a one row data.frame</h2><span id='topic+results_flat'></span><span id='topic+results_flat+2Cspflow_model-method'></span>

<h3>Description</h3>

<p>Access results of a <code><a href="#topic+spflow_model">spflow_model()</a></code> as a one row data.frame
</p>
<p>Reshaped version of the estimation results that can be used to compare
results in simulation studies.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>results_flat(object, ...)

## S4 method for signature 'spflow_model'
results_flat(
  object,
  res_info = c("est", "sd"),
  cntrol_info = c("estimation_method")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="results_flat_+3A_object">object</code></td>
<td>
<p>spflow_model_meta</p>
</td></tr>
<tr><td><code id="results_flat_+3A_...">...</code></td>
<td>
<p>Arguments to be passed to methods</p>
</td></tr>
</table>

<hr>
<h2 id='results+26lt+3B-'>Replacement method for internal purposes</h2><span id='topic+results+3C-'></span>

<h3>Description</h3>

<p>Replacement method for internal purposes
</p>


<h3>Usage</h3>

<pre><code class='language-R'>results(object) &lt;- value
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="results+2B26lt+2B3B-_+3A_object">object</code></td>
<td>
<p>A <code><a href="#topic+spflow_model">spflow_model()</a></code></p>
</td></tr>
<tr><td><code id="results+2B26lt+2B3B-_+3A_value">value</code></td>
<td>
<p>A data.frame of results</p>
</td></tr>
</table>

<hr>
<h2 id='sd_error'>Generic for accessing the standard deviation of the residual inside
a <code><a href="#topic+spflow_model-class">spflow_model-class()</a></code>.</h2><span id='topic+sd_error'></span>

<h3>Description</h3>

<p>For details on the methods see the documentation of the
corresponding classes.
</p>
<p>For details see the documentation of the corresponding class.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sd_error(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sd_error_+3A_object">object</code></td>
<td>
<p>A <code><a href="#topic+spflow_model-class">spflow_model-class()</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric, representing the estimated standard deviation of the error term
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spflow_model-class">spflow_model-class()</a></code>
</p>

<hr>
<h2 id='sp_multi_network'>Create an S4 class that contains <code><a href="#topic+sp_network_nodes">sp_network_nodes()</a></code> and <code><a href="#topic+sp_network_pair">sp_network_pair()</a></code> for one or multiple networks</h2><span id='topic+sp_multi_network'></span>

<h3>Description</h3>

<p>Create an S4 class that contains <code><a href="#topic+sp_network_nodes">sp_network_nodes()</a></code> and <code><a href="#topic+sp_network_pair">sp_network_pair()</a></code> for one or multiple networks
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sp_multi_network(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sp_multi_network_+3A_...">...</code></td>
<td>
<p>objects of type <code><a href="#topic+sp_network_nodes">sp_network_nodes()</a></code> and <code><a href="#topic+sp_network_pair">sp_network_pair()</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>An S4 class of type <code><a href="#topic+sp_multi_network-class">sp_multi_network-class()</a></code>
</p>


<h3>See Also</h3>

<p>Other Constructors for spflow network classes: 
<code><a href="#topic+sp_network_nodes">sp_network_nodes</a></code>,
<code><a href="#topic+sp_network_pair">sp_network_pair</a></code>,
<code><a href="#topic+spflow_network_classes">spflow_network_classes</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sp_multi_network() # empty
sp_multi_network(germany_net,usa_net) # two networks, no pairs
</code></pre>

<hr>
<h2 id='sp_multi_network-class'>Class sp_multi_network</h2><span id='topic+sp_multi_network-class'></span><span id='topic+id+2Csp_multi_network-method'></span><span id='topic+dat+2Csp_multi_network-method'></span><span id='topic+neighborhood+2Csp_multi_network-method'></span><span id='topic+pull_member+2Csp_multi_network-method'></span>

<h3>Description</h3>

<p>A S4 class that gathers information on one or multiple networks
<code><a href="#topic+sp_network_nodes">sp_network_nodes()</a></code> and origin-destination pairs <code><a href="#topic+sp_network_pair">sp_network_pair()</a></code>.
The class is constructed with the <code><a href="#topic+sp_multi_network">sp_multi_network()</a></code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'sp_multi_network'
id(object)

## S4 method for signature 'sp_multi_network'
dat(object, .id)

## S4 method for signature 'sp_multi_network'
neighborhood(object, .id = 1)

## S4 method for signature 'sp_multi_network'
pull_member(object, .id)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sp_multi_network-class_+3A_object">object</code></td>
<td>
<p>sp_multi_network-class</p>
</td></tr>
<tr><td><code id="sp_multi_network-class_+3A_.id">.id</code></td>
<td>
<p>A character indicating the id of a <code><a href="#topic+sp_network_nodes-class">sp_network_nodes-class()</a></code> or a
<code><a href="#topic+sp_network_pair-class">sp_network_pair-class()</a></code> inside the <code><a href="#topic+sp_multi_network-class">sp_multi_network-class()</a></code>.</p>
</td></tr>
</table>


<h3>Slots</h3>


<dl>
<dt><code>networks</code></dt><dd><p>A list of <code><a href="#topic+sp_network_nodes-class">sp_network_nodes-class()</a></code> objects</p>
</dd>
<dt><code>network_pairs</code></dt><dd><p>A list of <code><a href="#topic+sp_network_pair-class">sp_network_pair-class()</a></code> objects</p>
</dd>
</dl>


<h3>See Also</h3>

<p>Other spflow network classes: 
<code><a href="#topic+sp_network_nodes-class">sp_network_nodes-class</a></code>,
<code><a href="#topic+sp_network_pair-class">sp_network_pair-class</a></code>,
<code><a href="#topic+spflow_network_classes">spflow_network_classes</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## access the id of a networks or network_pairs inside a multi network

id(multi_net_usa_ge)$networks
id(multi_net_usa_ge)$network_pairs

## access the data of a network or a network_pair inside a multi_network

dat(multi_net_usa_ge, "ge")    # extract data of nodes
dat(multi_net_usa_ge, "ge_ge") # extract data of pairs

## access sp_network_nodes or sp_network_pair inside a sp_multi_network

pull_member(multi_net_usa_ge,"ge")
pull_member(multi_net_usa_ge,"usa")
pull_member(multi_net_usa_ge,"ge_ge")

</code></pre>

<hr>
<h2 id='sp_network_nodes'>Create a <code><a href="#topic+sp_network_nodes-class">sp_network_nodes-class()</a></code></h2><span id='topic+sp_network_nodes'></span>

<h3>Description</h3>

<p>Create a <code><a href="#topic+sp_network_nodes-class">sp_network_nodes-class()</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sp_network_nodes(
  network_id,
  node_neighborhood = NULL,
  node_data = NULL,
  node_key_column
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sp_network_nodes_+3A_network_id">network_id</code></td>
<td>
<p>A character that serves as an identifier for the network</p>
</td></tr>
<tr><td><code id="sp_network_nodes_+3A_node_neighborhood">node_neighborhood</code></td>
<td>
<p>A matrix that describes the neighborhood of the nodes</p>
</td></tr>
<tr><td><code id="sp_network_nodes_+3A_node_data">node_data</code></td>
<td>
<p>A data.frame that contains all information describing the nodes</p>
</td></tr>
<tr><td><code id="sp_network_nodes_+3A_node_key_column">node_key_column</code></td>
<td>
<p>A character indicating the column containing the identifiers for the nodes</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An S4 class of type <code><a href="#topic+sp_network_nodes-class">sp_network_nodes-class()</a></code>
</p>


<h3>See Also</h3>

<p>Other Constructors for spflow network classes: 
<code><a href="#topic+sp_multi_network">sp_multi_network</a></code>,
<code><a href="#topic+sp_network_pair">sp_network_pair</a></code>,
<code><a href="#topic+spflow_network_classes">spflow_network_classes</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>sp_network_nodes("germany",
                 spdep::nb2mat(spdep::poly2nb(germany_grid)),
                 as.data.frame(germany_grid),
                 "ID_STATE")
</code></pre>

<hr>
<h2 id='sp_network_nodes-class'>sp_network_nodes Class</h2><span id='topic+sp_network_nodes-class'></span><span id='topic+dat+2Csp_network_nodes-method'></span><span id='topic+dat+3C-+2Csp_network_nodes-method'></span><span id='topic+id+2Csp_network_nodes-method'></span><span id='topic+id+3C-+2Csp_network_nodes-method'></span><span id='topic+neighborhood+2Csp_network_nodes-method'></span><span id='topic+neighborhood+3C-+2Csp_network_nodes-method'></span><span id='topic+nnodes+2Csp_network_nodes-method'></span>

<h3>Description</h3>

<p>An S4 class that contains all information on a single network.
In this representation a network is composed of nodes which must be
identified uniquely by and ID.
Each node is described by variables stored in a data.frame.
The node neighborhood matrix describes strength of links between the nodes
of the network.
The class is constructed by the <code><a href="#topic+sp_network_nodes">sp_network_nodes()</a></code> function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'sp_network_nodes'
dat(object)

## S4 replacement method for signature 'sp_network_nodes'
dat(object) &lt;- value

## S4 method for signature 'sp_network_nodes'
id(object)

## S4 replacement method for signature 'sp_network_nodes'
id(object) &lt;- value

## S4 method for signature 'sp_network_nodes'
neighborhood(object)

## S4 replacement method for signature 'sp_network_nodes'
neighborhood(object) &lt;- value

## S4 method for signature 'sp_network_nodes'
nnodes(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sp_network_nodes-class_+3A_object">object</code></td>
<td>
<p>A sp_network_nodes-class</p>
</td></tr>
<tr><td><code id="sp_network_nodes-class_+3A_value">value</code></td>
<td>
<p>An object to replace the existing id/data/neighborhood</p>
</td></tr>
</table>


<h3>Slots</h3>


<dl>
<dt><code>network_id</code></dt><dd><p>A character that serves as an identifier for the network</p>
</dd>
<dt><code>nnodes</code></dt><dd><p>A numeric that indicates the number of nodes in the network</p>
</dd>
<dt><code>node_data</code></dt><dd><p>A data.frame that contains all information describing the nodes</p>
</dd>
<dt><code>node_neighborhood</code></dt><dd><p>A matrix that describes the neighborhood relations of the nodes</p>
</dd>
</dl>


<h3>See Also</h3>

<p>Other spflow network classes: 
<code><a href="#topic+sp_multi_network-class">sp_multi_network-class</a></code>,
<code><a href="#topic+sp_network_pair-class">sp_network_pair-class</a></code>,
<code><a href="#topic+spflow_network_classes">spflow_network_classes</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## access the data describing the nodes
new_dat &lt;- dat(germany_net)

# access the id of the network
germany_net2 &lt;- germany_net
id(germany_net2)
id(germany_net2) &lt;- "Germany"

# access the neighborhood matrix of the nodes
neighborhood(germany_net)

# access the number of nodes inside the network
nnodes(germany_net)

</code></pre>

<hr>
<h2 id='sp_network_pair'>Create an S4 object that contains information on origin-destination pairs</h2><span id='topic+sp_network_pair'></span>

<h3>Description</h3>

<p>Create an S4 object that contains information on origin-destination pairs
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sp_network_pair(
  orig_net_id,
  dest_net_id,
  pair_data = NULL,
  orig_key_column,
  dest_key_column
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sp_network_pair_+3A_orig_net_id">orig_net_id</code></td>
<td>
<p>A character that serves as identifier for the origin network</p>
</td></tr>
<tr><td><code id="sp_network_pair_+3A_dest_net_id">dest_net_id</code></td>
<td>
<p>A character that serves as identifier for the destination network</p>
</td></tr>
<tr><td><code id="sp_network_pair_+3A_pair_data">pair_data</code></td>
<td>
<p>A data.frame containing information on the origin-destination pairs</p>
</td></tr>
<tr><td><code id="sp_network_pair_+3A_orig_key_column">orig_key_column</code></td>
<td>
<p>A character indicating the name of the column containing the identifiers
of the origins</p>
</td></tr>
<tr><td><code id="sp_network_pair_+3A_dest_key_column">dest_key_column</code></td>
<td>
<p>A character indicating the name of the column containing the identifiers
of the destinations</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An S4 class of type <code><a href="#topic+sp_network_pair-class">sp_network_pair-class()</a></code>
</p>


<h3>See Also</h3>

<p>Other Constructors for spflow network classes: 
<code><a href="#topic+sp_multi_network">sp_multi_network</a></code>,
<code><a href="#topic+sp_network_nodes">sp_network_nodes</a></code>,
<code><a href="#topic+spflow_network_classes">spflow_network_classes</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>pair_frame &lt;- data.frame(
  ORIG_ID_STATE = rep(germany_grid$ID_STATE, times = 16),
  DEST_ID_STATE = rep(germany_grid$ID_STATE, each = 16))
sp_network_pair("ge","ge",pair_frame,"ORIG_ID_STATE","DEST_ID_STATE")
</code></pre>

<hr>
<h2 id='sp_network_pair-class'>Class sp_network_pair</h2><span id='topic+sp_network_pair-class'></span><span id='topic+dat+2Csp_network_pair-method'></span><span id='topic+dat+3C-+2Csp_network_pair-method'></span><span id='topic+id+2Csp_network_pair-method'></span><span id='topic+id+3C-+2Csp_network_pair-method'></span><span id='topic+npairs+2Csp_network_pair-method'></span><span id='topic+nnodes+2Csp_network_pair-method'></span>

<h3>Description</h3>

<p>An S4 class which holds information on origin-destination (OD) pairs.
Each OD pair is composed of two nodes (see <code><a href="#topic+sp_network_nodes-class">sp_network_nodes-class()</a></code>).
All origins belong to the same (origin-) network and all destination belong
to the same (destination-) network. It is possible to choose the same
network for origins and destinations, which enables to represent OD pairs
within the same network.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'sp_network_pair'
dat(object)

## S4 replacement method for signature 'sp_network_pair'
dat(object) &lt;- value

## S4 method for signature 'sp_network_pair'
id(object)

## S4 replacement method for signature 'sp_network_pair'
id(object) &lt;- value

## S4 method for signature 'sp_network_pair'
npairs(object)

## S4 method for signature 'sp_network_pair'
nnodes(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sp_network_pair-class_+3A_object">object</code></td>
<td>
<p>A sp_network_pair-class</p>
</td></tr>
<tr><td><code id="sp_network_pair-class_+3A_value">value</code></td>
<td>
<p>An object to replace the existing id/data</p>
</td></tr>
</table>


<h3>Slots</h3>


<dl>
<dt><code>orig_net_id</code></dt><dd><p>A character that serves as identifier for the origin network</p>
</dd>
<dt><code>orig_nnodes</code></dt><dd><p>A numeric that represents the number of nodes in the origin network</p>
</dd>
<dt><code>dest_net_id</code></dt><dd><p>A character that serves as identifier for the destination network</p>
</dd>
<dt><code>dest_nnodes</code></dt><dd><p>A numeric that represents the number of nodes in the destination network</p>
</dd>
<dt><code>network_pair_id</code></dt><dd><p>A character identifying the pair of networks</p>
</dd>
<dt><code>pair_data</code></dt><dd><p>A data.frame containing information on origin-destination pairs</p>
</dd>
<dt><code>npairs</code></dt><dd><p>A numeric indicating the number of origin-destination pairs</p>
</dd>
</dl>


<h3>See Also</h3>

<p>Other spflow network classes: 
<code><a href="#topic+sp_multi_network-class">sp_multi_network-class</a></code>,
<code><a href="#topic+sp_network_nodes-class">sp_network_nodes-class</a></code>,
<code><a href="#topic+spflow_network_classes">spflow_network_classes</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## access the data describing the node pairs

net_pair_ge_ge &lt;- pull_member(multi_net_usa_ge,"ge_ge")
dat(net_pair_ge_ge)

## access the id of a network pair

net_pair_ge_ge &lt;- pull_member(multi_net_usa_ge,"ge_ge")
id(net_pair_ge_ge)
id(net_pair_ge_ge) &lt;- "Germany_Germany"

## access the number of node pairs in a network pair

net_pair_ge_ge &lt;- pull_member(multi_net_usa_ge,"ge_ge")
npairs(net_pair_ge_ge)

## access the number of origin and destination nodes in a network pair
net_pair_ge_ge &lt;- pull_member(multi_net_usa_ge,"ge_ge")
nnodes(net_pair_ge_ge)
nnodes(net_pair_ge_ge)["orig"]
nnodes(net_pair_ge_ge)["dest"]
prod(nnodes(net_pair_ge_ge) == npairs(net_pair_ge_ge))

</code></pre>

<hr>
<h2 id='spatial_filter'>Derive the spatial filter of an interaction model</h2><span id='topic+spatial_filter'></span>

<h3>Description</h3>

<p>Use the neighborhood matrices of origins and destinations to derive the
three neighborhood matrices of the origin-destination flows.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spatial_filter(weight_matrices, autoreg_parameters)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="spatial_filter_+3A_weight_matrices">weight_matrices</code></td>
<td>
<p>List of flow neighborhood matrices</p>
</td></tr>
<tr><td><code id="spatial_filter_+3A_autoreg_parameters">autoreg_parameters</code></td>
<td>
<p>A numeric containing values for the
auto-regressive parameters</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other spflow simulation functions: 
<code><a href="#topic+expand_flow_neighborhood">expand_flow_neighborhood</a>()</code>,
<code><a href="#topic+spflow_sim">spflow_sim</a>()</code>
</p>

<hr>
<h2 id='spatial_model_order'>Derive the order of the spatial model</h2><span id='topic+spatial_model_order'></span>

<h3>Description</h3>

<p>The order of a spatial model corresponds to the number of neighborhood
matrices that is used to describe the spatial dependence.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spatial_model_order(model = "model_9")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="spatial_model_order_+3A_model">model</code></td>
<td>
<p>A character indicating the model number,  indicating different spatial
dependence structures (see documentation for details), should be one of
<code>paste0("model_", 1:9)</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>An integer corresponding to the number of weight matrices
</p>

<hr>
<h2 id='spflow'>Estimate spatial interaction models that incorporate spatial dependence</h2><span id='topic+spflow'></span>

<h3>Description</h3>

<p>We implement three different estimators of spatial econometric interaction
models (Dargel 2021) that allow the user to estimate
origin-destination flows with spatial autocorrelation.
</p>
<p>By default the estimation will include spatial dependence in the dependent
variable and the explanatory variables which leads to the spatial Durbin
model (SDM) (Anselin 1988).
Moreover, the model includes an additional set of parameters for intra
regional flows that start and end in the same geographic site (as proposed
by LeSage and Pace (2009)).
Both default options can be deactivated via the <code>flow_control</code> argument,
which gives fine grained control over the estimation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spflow(
  flow_formula,
  sp_multi_network,
  network_pair_id = id(sp_multi_network)[["network_pairs"]][[1]],
  flow_control = spflow_control()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="spflow_+3A_flow_formula">flow_formula</code></td>
<td>
<p>A formula specifying the spatial interaction model (for details see
section Formula interface)</p>
</td></tr>
<tr><td><code id="spflow_+3A_sp_multi_network">sp_multi_network</code></td>
<td>
<p>A <code><a href="#topic+sp_multi_network">sp_multi_network()</a></code> object that contains information on the origins,
and the destinations and their neighborhood structure</p>
</td></tr>
<tr><td><code id="spflow_+3A_network_pair_id">network_pair_id</code></td>
<td>
<p>A character indicating the id of a <code><a href="#topic+sp_network_pair">sp_network_pair()</a></code> (only relevant if
the <code><a href="#topic+sp_multi_network">sp_multi_network()</a></code> contains multiple <code>sp_network_pair</code>-objects:
defaults to the of them)</p>
</td></tr>
<tr><td><code id="spflow_+3A_flow_control">flow_control</code></td>
<td>
<p>A list generated by <code><a href="#topic+spflow_control">spflow_control()</a></code> that provides fine grained control
over the estimation procedure</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An S4 class of type <code><a href="#topic+spflow_model-class">spflow_model-class()</a></code>
</p>


<h3>Details</h3>

<p>Our estimation procedures makes use of the matrix formulation introduced by
LeSage and Pace (2008) and further developed by
Dargel (2021) to reduce the computational
effort and memory requirements.
The estimation procedure can be adjusted through the <code>estimation_method</code>
argument in <code><a href="#topic+spflow_control">spflow_control()</a></code>.
</p>


<h4>Maximum likelihood estimation (MLE)</h4>

<p>Maximum likelihood estimation is the default estimation procedure.
The matrix form estimation in the framework of this model was first
developed by LeSage and Pace (2008) and then improved by
Dargel (2021).
</p>



<h4>Spatial two-stage least squares (S2SLS)</h4>

<p>The S2SLS estimator is an adaptation of the one proposed by
Kelejian and Prucha (1998), to the case of origin-destination
flows, with up to three neighborhood matrices
Dargel (2021).
A similar estimation is done by Tamesue and Tsutsumi (2016).
The user can activate the S2SLS estimation via the <code>flow_control</code> argument
using the input <code>spflow_control(estimation_method = "s2sls")</code>.
</p>



<h4>Bayesian Markov Chain Monte Carlo (MCMC)</h4>

<p>The MCMC estimator is based on the ideas of
LeSage and Pace (2009) and incorporates the improvements
proposed in Dargel (2021).
The estimation is based on a tuned Metropolis-Hastings sampler for the
auto-regressive parameters, and for the remaining parameters it uses Gibbs
sampling.
The routine uses 5500 iterations of the sampling procedure and considers the
first 2500 as burn-in period.
The user can activate the S2SLS estimation via the <code>flow_control</code> argument
using the input <code>spflow_control(estimation_method = "mcmc")</code>.
</p>



<h4>Formula interface</h4>

<p>The function offers a formula interface adapted to spatial interaction
models, which has the following structure:
<code>Y ~ O_(X1) + D_(X2) + I_(X3) + G_(X4)</code>
This structure reflects the different data sources involved in such a model.
On the left hand side there is the independent variable <code>Y</code> which
corresponds to the vector of flows.
On the right hand side we have all the explanatory variables.
The functions <code>O_(...)</code> and <code>D_(...)</code> indicate which variables are used as
characteristics of the origins and destinations respectively.
Similarly, <code>I_(...)</code> indicates variables that should be used for the
intra-regional parameters.
Finally, <code>G_(...)</code> declares which variables describe origin-destination
pairs, which most frequently will include a measure of distance.
</p>
<p>All the declared variables must be available in the provided
<code><a href="#topic+sp_multi_network">sp_multi_network()</a></code> object, which gathers information on the origins and
destinations (inside <code><a href="#topic+sp_network_nodes">sp_network_nodes()</a></code> objects), as well as the
information on the origin-destination pairs (inside a <code><a href="#topic+sp_network_pair">sp_network_pair()</a></code>
object).
</p>
<p>Using the short notation <code>Y ~ .</code> is possible and will be interpreted as
usual, in the sense that we use all variables that are available for each
data source.
Also mixed formulas, such as <code>Y ~ . + G_(log(X4) + 1)</code>, are possible.
When the dot shortcut is combined with explicit declaration, it will only be
used for the non declared data sources.
The following examples illustrate this behaviour.
</p>



<h4>Formula interface (examples)</h4>

<p>Consider the case where we have the flow vector <code>Y</code> and the distance vector
<code>DIST</code> available as information on origin-destination pairs.
In addition we have  the explanatory variables <code style="white-space: pre;">&#8288;X1, X2&#8288;</code> and <code>X3</code> which
describe the regions that are at the same time origins and destinations of
the flows.
</p>
<p>For this example the four formulas below are equivalent and make use of all
explanatory variables <code style="white-space: pre;">&#8288;X1, X2&#8288;</code> and <code>X3</code> for origins, destinations and
intra-regional observations.
</p>

<ul>
<li> <p><code>Y ~ .</code>
</p>
</li>
<li> <p><code>Y ~ . + G_(DIST)</code>
</p>
</li>
<li> <p><code>Y ~ X1 + X2 + X3 + G_(DIST)</code>
</p>
</li>
<li> <p><code>Y ~ D_(X1 + X2 + X3) + O_(X1 + X2 + X3) + I_(X1 + X2 + X3)  + G_(DIST)</code>
</p>
</li></ul>

<p>Now if we only want to use X1 for the intra-regional model we can do the
following (again all four options below are equivalent).
</p>

<ul>
<li> <p><code>Y ~ . + I_(X1)</code>
</p>
</li>
<li> <p><code>Y ~ . + I_(X1) + G_(DIST)</code>
</p>
</li>
<li> <p><code>Y ~  X1 + X2 + X3 + I_(X1) + G_(DIST)</code>
</p>
</li>
<li> <p><code>Y ~ D_(X1 + X2 + X3) + O_(X1 + X2 + X3) + I_(X1)  + G_(DIST)</code>
</p>
</li></ul>

<p>This behaviour is easily combined with transformation of variables as the
two equivalent options below illustrate.
</p>

<ul>
<li> <p><code>log(Y + 1) ~ sqrt(X1) +  X2 + G_(log(DIST + 1))</code>
</p>
</li></ul>




<h3>References</h3>

<p>Anselin L (1988).
<em>Spatial Econometrics: Methods and Models</em>.
Springer Netherlands.<br /><br /> Dargel L (2021).
&ldquo;Revisiting Estimation Methods for Spatial Econometric Interaction Models.&rdquo;
Toulouse School of Economics.<br /><br /> Kelejian HH, Prucha IR (1998).
&ldquo;A Generalized Spatial Two-Stage Least Squares Procedure for Estimating a Spatial Autoregressive Model with Autoregressive Disturbances.&rdquo;
<em>The Journal of Real Estate Finance and Economics</em>, 99&ndash;121.<br /><br /> LeSage JP, Pace RK (2009).
<em>Introduction to Spatial Econometrics</em>.
CRC Press.<br /><br /> LeSage JP, Pace RK (2008).
&ldquo;Spatial Econometric Modeling of Origin-Destination Flows.&rdquo;
<em>Journal of Regional Science</em>, 941&ndash;967.<br /><br /> Tamesue K, Tsutsumi M (2016).
&ldquo;Dealing with Intraregional Flows in Spatial Econometric Gravity Models.&rdquo;
In Patuelli R, Arbia G (eds.), <em>Spatial Econometric Interaction Modelling</em>, chapter 6, 105&ndash;119.
Springer International Publishing.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spflow_control">spflow_control()</a></code> <code><a href="#topic+spflow_network_classes">spflow_network_classes()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Estimate flows between the states of Germany
spflow(flow_formula = y9 ~ . + G_(DISTANCE),
       sp_multi_network = multi_net_usa_ge,
       network_pair_id = "ge_ge")

# Same as above with explicit declaration of variables...
# ... X is the only variable available
# ... it is used for origins, destination and intra-state flows
spflow(flow_formula = y9 ~ X + G_(DISTANCE),
       sp_multi_network = multi_net_usa_ge,
       network_pair_id = "ge_ge")

# Same as above
spflow(flow_formula = y9 ~ O_(.) + D_(.) + I_(.) + G_(DISTANCE),
       sp_multi_network = multi_net_usa_ge,
       network_pair_id = "ge_ge")

# Same as above
spflow(flow_formula = y9 ~ O_(X) + D_(X) + I_(X) + G_(DISTANCE),
       sp_multi_network = multi_net_usa_ge,
       network_pair_id = "ge_ge")


</code></pre>

<hr>
<h2 id='spflow_control'>Define details of the estimation procedure with the <code><a href="#topic+spflow">spflow()</a></code> function.</h2><span id='topic+spflow_control'></span>

<h3>Description</h3>

<p>This function creates a list to fine tune the estimation of a spatial
interaction model with <code><a href="#topic+spflow">spflow()</a></code>.
The options allow to adjust the estimation method and give the user full
control over the use of the explanatory variables.
The user can also adjust the form of autocorrelation to be considered.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spflow_control(
  estimation_method = "mle",
  model = "model_9",
  use_intra = TRUE,
  sdm_variables = "same",
  weight_variable = NULL,
  parameter_space = "approx",
  loglik_det_aprox_order = 10,
  mle_hessian_method = "mixed",
  mle_optim_limit = 100,
  twosls_instrumental_variables = "same",
  twosls_decorrelate_instruments = FALSE,
  twosls_reduce_pair_instruments = TRUE,
  mcmc_iterations = 5500,
  mcmc_burn_in = 2500,
  mcmc_resampling_limit = 100
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="spflow_control_+3A_estimation_method">estimation_method</code></td>
<td>
<p>A character which indicates the estimation method, should be one of
<code>c("mle","s2sls","mcmc")</code></p>
</td></tr>
<tr><td><code id="spflow_control_+3A_model">model</code></td>
<td>
<p>A character indicating the model number,  indicating different spatial
dependence structures (see documentation for details), should be one of
<code>paste0("model_", 1:9)</code></p>
</td></tr>
<tr><td><code id="spflow_control_+3A_use_intra">use_intra</code></td>
<td>
<p>A logical which activates the option to use a separate set of parameters
for intra-regional flows (origin == destination)</p>
</td></tr>
<tr><td><code id="spflow_control_+3A_sdm_variables">sdm_variables</code></td>
<td>
<p>Either a formula or a character; the formula can be used to explicitly
declare the variables in SDM specification, the character should be one of
<code>c("same", "all")</code> which are short cuts for using all available variables
or the same as used in the main formula provided to <code><a href="#topic+spflow">spflow()</a></code></p>
</td></tr>
<tr><td><code id="spflow_control_+3A_weight_variable">weight_variable</code></td>
<td>
<p>A character indicating the name of one column in the node pair data.</p>
</td></tr>
<tr><td><code id="spflow_control_+3A_parameter_space">parameter_space</code></td>
<td>
<p>A character indicating how to define the limits of the parameter space.
The only available option is <code>c("approx")</code>.</p>
</td></tr>
<tr><td><code id="spflow_control_+3A_loglik_det_aprox_order">loglik_det_aprox_order</code></td>
<td>
<p>A numeric indicating the order of the Taylor expansion used to approximate
the value of the log-determinant term.</p>
</td></tr>
<tr><td><code id="spflow_control_+3A_mle_hessian_method">mle_hessian_method</code></td>
<td>
<p>A character which indicates the method for Hessian calculation</p>
</td></tr>
<tr><td><code id="spflow_control_+3A_mle_optim_limit">mle_optim_limit</code></td>
<td>
<p>A numeric indicating the number of trials given to the optimizer of the
likelihood function. A trial refers to a new initiation of the
optimization procedure using different (random) starting values for the
parameters. If the optimizer does not converge after the
indicated number of trails an error will be thrown after this limit.</p>
</td></tr>
<tr><td><code id="spflow_control_+3A_twosls_instrumental_variables">twosls_instrumental_variables</code></td>
<td>
<p>Either a formula or a character; the formula can be used to explicitly
declare the variables that should be used as instruments during S2SLS
estimation, the character should be one of <code>c("same", "all")</code> which
are short cuts for using all available variables or the same as used in
the main formula provided to <code><a href="#topic+spflow">spflow()</a></code></p>
</td></tr>
<tr><td><code id="spflow_control_+3A_twosls_decorrelate_instruments">twosls_decorrelate_instruments</code></td>
<td>
<p>A logical whether to perform a PCA to remove (linear) correlation from the
instruments generated for the S2SLS estimator</p>
</td></tr>
<tr><td><code id="spflow_control_+3A_twosls_reduce_pair_instruments">twosls_reduce_pair_instruments</code></td>
<td>
<p>A logical that indicates whether the number of instruments that are
derived from pair attributes should be reduced or not. The default is
<code>TRUE</code>, because constructing these instruments is often the most demanding
part of the estimation (Dargel 2021).</p>
</td></tr>
<tr><td><code id="spflow_control_+3A_mcmc_iterations">mcmc_iterations</code></td>
<td>
<p>A numeric indicating the number of iterations</p>
</td></tr>
<tr><td><code id="spflow_control_+3A_mcmc_burn_in">mcmc_burn_in</code></td>
<td>
<p>A numeric indicating the length of the burn in period</p>
</td></tr>
<tr><td><code id="spflow_control_+3A_mcmc_resampling_limit">mcmc_resampling_limit</code></td>
<td>
<p>A numeric indicating the maximal number of trials during rejection
sampling of the autoregressive parameters</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of parameters used to control the model estimation with
<code><a href="#topic+spflow">spflow()</a></code>
</p>


<h3>Details</h3>



<h4>Adjusting the form of autocorrelation</h4>

<p>The option <code>model</code> allows to declare one of nine different forms of
autocorrelation that follow the naming convention of
LeSage and Pace (2008).
The most general specification is &quot;model_9&quot;, leading to the model
<code class="reqn">y = \rho_dW_dy + \rho_o W_oy + \rho_wW_wy + Z\delta + \epsilon</code>.
All other models special cases of this one.
The constraints that lead to the different sub models are summarized in
this table.</p>

<table>
<tr>
 <td style="text-align: center;">
   <strong>Model Number</strong> </td><td style="text-align: center;"> <strong>Autocorrelation Parameters</strong> </td><td style="text-align: center;"> <strong>Constraints</strong> </td>
</tr>
<tr>
 <td style="text-align: center;">
   Model 9 </td><td style="text-align: center;"> <code class="reqn">\rho_d, \rho_o, \rho_w</code> </td><td style="text-align: center;"> unconstrained </td>
</tr>
<tr>
 <td style="text-align: center;">
   Model 8 </td><td style="text-align: center;"> <code class="reqn">\rho_d, \rho_o, \rho_w</code> </td><td style="text-align: center;"> <code class="reqn">\rho_w = - \rho_d \rho_o</code> </td>
</tr>
<tr>
 <td style="text-align: center;">
   Model 7 </td><td style="text-align: center;"> <code class="reqn">\rho_d, \rho_o</code> </td><td style="text-align: center;"> <code class="reqn">\rho_w = 0</code> </td>
</tr>
<tr>
 <td style="text-align: center;">
   Model 6 </td><td style="text-align: center;"> <code class="reqn">\rho_{dow}</code> </td><td style="text-align: center;"> <code class="reqn">\rho_d = \rho_o = \rho_w</code> </td>
</tr>
<tr>
 <td style="text-align: center;">
   Model 5 </td><td style="text-align: center;"> <code class="reqn">\rho_{do}</code> </td><td style="text-align: center;"> <code class="reqn">\rho_d = \rho_o, \rho_w = 0</code> </td>
</tr>
<tr>
 <td style="text-align: center;">
   Model 4 </td><td style="text-align: center;"> <code class="reqn">\rho_w</code> </td><td style="text-align: center;"> <code class="reqn">\rho_d = \rho_o = 0</code> </td>
</tr>
<tr>
 <td style="text-align: center;">
   Model 3 </td><td style="text-align: center;"> <code class="reqn">\rho_o</code> </td><td style="text-align: center;"> <code class="reqn">\rho_d = \rho_w = 0</code> </td>
</tr>
<tr>
 <td style="text-align: center;">
   Model 2 </td><td style="text-align: center;"> <code class="reqn">\rho_d</code> </td><td style="text-align: center;"> <code class="reqn">\rho_o = \rho_w = 0</code> </td>
</tr>
<tr>
 <td style="text-align: center;">
   Model 1 </td><td style="text-align: center;"> none </td><td style="text-align: center;"> <code class="reqn">\rho_d = \rho_o = \rho_w = 0</code> </td>
</tr>
<tr>
 <td style="text-align: center;">
</td>
</tr>

</table>




<h3>References</h3>

<p>Dargel L (2021).
&ldquo;Revisiting Estimation Methods for Spatial Econometric Interaction Models.&rdquo;
Toulouse School of Economics.<br /><br /> LeSage JP, Pace RK (2008).
&ldquo;Spatial Econometric Modeling of Origin-Destination Flows.&rdquo;
<em>Journal of Regional Science</em>, 941&ndash;967.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spflow">spflow()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# default is MLE estimation of the most comprehensive model
default_control &lt;- spflow_control()

# change the estimation method
custom_control &lt;- spflow_control(estimation_method = "mcmc")

# change the form of autocorrelation to be considered
custom_control &lt;- spflow_control(model = "model_7")

# declare precisely which variables are to be used in the SDM form
custom_control &lt;-
  spflow_control(sdm_variables = ~ O_(v1 + v2) + D_(v2 + v3) + I_(v1 + v4))

# deactivate the intra-regional coefficients and SDM variables
custom_control &lt;- spflow_control(use_intra = FALSE, sdm_variables = "none")
</code></pre>

<hr>
<h2 id='spflow_model'>Internal function to construct a <code><a href="#topic+spflow_model-class">spflow_model-class()</a></code></h2><span id='topic+spflow_model'></span>

<h3>Description</h3>

<p>Internal function to construct a <code><a href="#topic+spflow_model-class">spflow_model-class()</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spflow_model(
  ...,
  estimation_results,
  estimation_control,
  N,
  sd_error,
  R2_corr = NULL,
  resid = NULL,
  fitted = NULL,
  spatial_filter_matrix = NULL,
  design_matrix = NULL,
  model_moments = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="spflow_model_+3A_...">...</code></td>
<td>
<p>Further arguments passed to more specific classes in accordance to the
estimation method</p>
</td></tr>
<tr><td><code id="spflow_model_+3A_estimation_results">estimation_results</code></td>
<td>
<p>A data.frame of estimation <code><a href="#topic+results">results()</a></code></p>
</td></tr>
<tr><td><code id="spflow_model_+3A_estimation_control">estimation_control</code></td>
<td>
<p>A list of control parameters</p>
</td></tr>
<tr><td><code id="spflow_model_+3A_n">N</code></td>
<td>
<p>A numeric indicating the number of observations</p>
</td></tr>
<tr><td><code id="spflow_model_+3A_sd_error">sd_error</code></td>
<td>
<p>A numeric which reports the</p>
</td></tr>
<tr><td><code id="spflow_model_+3A_r2_corr">R2_corr</code></td>
<td>
<p>A numeric which reports a pseudo R^2 measure</p>
</td></tr>
<tr><td><code id="spflow_model_+3A_resid">resid</code></td>
<td>
<p>A numeric vector of regression residuals</p>
</td></tr>
<tr><td><code id="spflow_model_+3A_fitted">fitted</code></td>
<td>
<p>A numeric vector of fitted values</p>
</td></tr>
<tr><td><code id="spflow_model_+3A_spatial_filter_matrix">spatial_filter_matrix</code></td>
<td>
<p>A matrix which represents the spatial filter</p>
</td></tr>
<tr><td><code id="spflow_model_+3A_design_matrix">design_matrix</code></td>
<td>
<p>The design matrix/matrices of the model</p>
</td></tr>
</table>

<hr>
<h2 id='spflow_model_matrix'>Generate design matrices for the spatial interaction model</h2><span id='topic+spflow_model_matrix'></span>

<h3>Description</h3>

<p>Creates model matrices from a <code><a href="#topic+sp_multi_network">sp_multi_network()</a></code> network.
For efficiency the relational representation of origin and destination data
is preserved.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spflow_model_matrix(
  sp_multi_network,
  network_pair_id,
  formula_parts,
  estim_control
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="spflow_model_matrix_+3A_sp_multi_network">sp_multi_network</code></td>
<td>
<p>A <code><a href="#topic+sp_multi_network">sp_multi_network()</a></code> object that contains information on the origins,
and the destinations and their neighborhood structure</p>
</td></tr>
<tr><td><code id="spflow_model_matrix_+3A_network_pair_id">network_pair_id</code></td>
<td>
<p>A character indicating the id of a <code><a href="#topic+sp_network_pair">sp_network_pair()</a></code> (only relevant if
the <code><a href="#topic+sp_multi_network">sp_multi_network()</a></code> contains multiple <code>sp_network_pair</code>-objects:
defaults to the of them)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of design matrices for spatial interaction model
</p>

<hr>
<h2 id='spflow_model_moments'>Compute the principal moments for a spatial flow model</h2><span id='topic+spflow_model_moments'></span>

<h3>Description</h3>

<p>Compute the principal moments for a spatial flow model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spflow_model_moments(...)
</code></pre>

<hr>
<h2 id='spflow_model-class'>Class spflow_model</h2><span id='topic+spflow_model-class'></span><span id='topic+coef+2Cspflow_model-method'></span><span id='topic+fitted+2Cspflow_model-method'></span><span id='topic+nobs+2Cspflow_model-method'></span><span id='topic+predict+2Cspflow_model-method'></span><span id='topic+resid+2Cspflow_model-method'></span><span id='topic+results+2Cspflow_model-method'></span><span id='topic+sd_error+2Cspflow_model-method'></span><span id='topic+spflow_model_ols-class'></span><span id='topic+spflow_model_mle-class'></span><span id='topic+spflow_model_s2sls-class'></span><span id='topic+spflow_model_mcmc-class'></span><span id='topic+logLik+2Cspflow_model_mle-method'></span><span id='topic+varcov+2Cspflow_model_mle_s2sls_ols-method'></span><span id='topic+mcmc_results+2Cspflow_model_mcmc-method'></span>

<h3>Description</h3>

<p>An S4 class that contains the estimation results of spatial econometric
interaction models estimated by the <code><a href="#topic+spflow">spflow()</a></code> function.
</p>
<p>There are four subclasses that are specific to the chosen estimation method
(OLS, MLE, Bayesian MCMC or S2SLS).
They contain some additional information specific to the corresponding
method but most behaviours and data are identical among them.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S4 method for signature 'spflow_model'
coef(object)

## S4 method for signature 'spflow_model'
fitted(object)

## S4 method for signature 'spflow_model'
nobs(object)

## S4 method for signature 'spflow_model'
predict(object, ..., type = "BP")

## S4 method for signature 'spflow_model'
resid(object)

## S4 method for signature 'spflow_model'
results(object)

## S4 method for signature 'spflow_model'
sd_error(object)

## S4 method for signature 'spflow_model_mle'
logLik(object)

## S4 method for signature 'spflow_model_mle_s2sls_ols'
varcov(object)

## S4 method for signature 'spflow_model_mcmc'
mcmc_results(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="spflow_model-class_+3A_object">object</code></td>
<td>
<p>A <code><a href="#topic+spflow_model-class">spflow_model-class()</a></code></p>
</td></tr>
<tr><td><code id="spflow_model-class_+3A_...">...</code></td>
<td>
<p>Further arguments passed to the prediction function</p>
</td></tr>
<tr><td><code id="spflow_model-class_+3A_type">type</code></td>
<td>
<p>A character declaring the type of prediction (for now only &quot;BP&quot;)</p>
</td></tr>
</table>


<h3>Slots</h3>


<dl>
<dt><code>estimation_results</code></dt><dd><p>A data.frame that contains the main <code><a href="#topic+results">results()</a></code> of the estimation</p>
</dd>
<dt><code>estimation_control</code></dt><dd><p>A list that contains all control parameters of the estimation
(see <code><a href="#topic+spflow_control">spflow_control()</a></code>)</p>
</dd>
<dt><code>N</code></dt><dd><p>A numeric that corresponds to the number of origin-destination pairs
(the sample size in this model)</p>
</dd>
<dt><code>sd_error</code></dt><dd><p>A numeric representing the standard deviation of the residual</p>
</dd>
<dt><code>R2_corr</code></dt><dd><p>A numeric that serves as a goodness of fit criterion.
The R2_corr is computed as squared correlation between the fitted values
and the observed values of the dependent variable.</p>
</dd>
<dt><code>resid</code></dt><dd><p>A numeric vector of regression residuals</p>
</dd>
<dt><code>fitted</code></dt><dd><p>A numeric vector of fitted values computed as the in sample prediction
trend signal (TS) prediction described by @Goulard2017</p>
</dd>
<dt><code>spatial_filter_matrix</code></dt><dd><p>A matrix (can be sparse) or NULL</p>
</dd>
<dt><code>design_matrix</code></dt><dd><p>A matrix (can be sparse) or NULL</p>
</dd>
<dt><code>varcov</code></dt><dd><p>A matrix or NULL</p>
</dd>
<dt><code>ll</code></dt><dd><p>A numeric or NULL</p>
</dd>
<dt><code>AIC</code></dt><dd><p>A numeric or NULL</p>
</dd>
<dt><code>BIC</code></dt><dd><p>A numeric or NULL</p>
</dd>
<dt><code>mcmc_results</code></dt><dd><p>A data.frame containing the estimated parameters for each iteration of the
MCMC sampling procedure</p>
</dd>
</dl>


<h3>Main results</h3>

<p>The main results are accessed with the <code>results()</code> method.
They are given in the form of a data frame with the following columns;
</p>

<ul>
<li> <p><code>est</code>: value of the estimated parameter
</p>
</li>
<li> <p><code>sd</code>: value of the standard deviation of the parameter
</p>
</li>
<li> <p><code>t.test</code>: value of the t-statistic under the two-sided hypothesis that
the parameter value is 0.
</p>
</li>
<li> <p><code>p.val</code>: the p-value associated to the t-test
</p>
</li>
<li> <p><code>quant_025</code>: for Bayesian estimation the lower bound of 95% interval
</p>
</li>
<li> <p><code>quant_975</code>: for Bayesian estimation the upper bound of 95% interval
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+spflow">spflow()</a></code>, <code><a href="#topic+spflow_network_classes">spflow_network_classes()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
spflow_results &lt;- spflow(y9 ~ . + G_(DISTANCE),multi_net_usa_ge)

# General methods
results(spflow_results) # data.frame of main results
coef(spflow_results) # vector of estimated coefficients
fitted(spflow_results) # vector of fitted values
resid(spflow_results) # vector of residuals
nobs(spflow_results) # number of observations
sd_error(spflow_results) # standard deviation of the error term
predict(spflow_results) # computation of the in sample predictor

# MLE methods
logLik(spflow_results) # value of the likelihood function

# MLE, OLS and S2SLS methods
varcov(spflow_results) # variance covariance matrix of the estimators

# MCMC methods
spflow_results_mcmc &lt;- spflow(
  y2 ~ . + G_(DISTANCE),
  multi_net_usa_ge,
  flow_control = spflow_control(estimation_method = "mcmc",
                                model = "model_2"))
results(spflow_results)
mcmc_results(spflow_results_mcmc) # parameter values during the mcmc sampling

</code></pre>

<hr>
<h2 id='spflow_network_classes'>spflow network classes</h2><span id='topic+spflow_network_classes'></span>

<h3>Description</h3>

<p>The spflow package provides three additional classes to the R environment
that allow to handle origin-destination flow data efficiently.
</p>
<p>The main idea is to exploit the relational structure of origin-destination
data to reduce the memory requirements.
Data on origins and destinations are stored in the
<code><a href="#topic+sp_network_nodes-class">sp_network_nodes-class()</a></code> and data on the origin-destination pairs are
stored in an <code><a href="#topic+sp_network_pair-class">sp_network_pair-class()</a></code>.
</p>
<p>A third object of type <code><a href="#topic+sp_multi_network-class">sp_multi_network-class()</a></code> is then used to store
information on the nodes and pairs in an efficient relational storage.
It makes sure that all origin-destination pairs can be identified with the
nodes at the origin and destination.
</p>


<h3>See Also</h3>

<p>Other spflow network classes: 
<code><a href="#topic+sp_multi_network-class">sp_multi_network-class</a></code>,
<code><a href="#topic+sp_network_nodes-class">sp_network_nodes-class</a></code>,
<code><a href="#topic+sp_network_pair-class">sp_network_pair-class</a></code>
</p>
<p>Other Constructors for spflow network classes: 
<code><a href="#topic+sp_multi_network">sp_multi_network</a></code>,
<code><a href="#topic+sp_network_nodes">sp_network_nodes</a></code>,
<code><a href="#topic+sp_network_pair">sp_network_pair</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
### An example use case for the spflow network classes and model estimation
# load example data
data("paris10km_municipalities")
data("paris10km_neighborhood")
data("paris10km_commuteflows")

# define the sp_network_nodes...
# ... they are used as origins and destinations
# ... their neighborhood is based on contiguity
paris10km_net &lt;- sp_network_nodes(
  network_id = "paris10km",
  node_neighborhood = paris10km_neighborhood$by_contiguity,
  node_data = sf::st_drop_geometry(paris10km_municipalities),
  node_key_column = "ID_MUN")

# define the sp_network_pair...
# ... contains pairwise data (flows and distances)
# ... must be linked to an origin and a destination network
paris10km_net_pairs &lt;- sp_network_pair(
  orig_net_id = "paris10km",
  dest_net_id = "paris10km",
  pair_data = paris10km_commuteflows,
  orig_key_column = "ID_ORIG",
  dest_key_column = "ID_DEST")


# define the sp_network_pair...
# ... combines information on nodes and pairs
paris10km_multi_net &lt;- sp_multi_network(paris10km_net,paris10km_net_pairs)

clog &lt;- function(x) {
  y &lt;- log(x)
  y - mean(y)
}

# define the model that we use to explain the flows...
# ... D_() contains destination variables
# ... O_() contains origin variables
# ... D_() contains intra-regional variables (when origin == destination)
# ... G_() contains pair variables (distances)
flow_formula &lt;-
  log(COMMUTE_FLOW + 1) ~
  D_(log(NB_COMPANY) + clog(MED_INCOME)) +
  O_(log(POPULATION) + log(NB_COMPANY) + clog(MED_INCOME)) +
  I_(log(NB_COMPANY) + log(POPULATION)) +
  G_(log(DISTANCE + 1))

# define what variables to use in an SDM specification
# ... if not given all will be used
sdm_formula &lt;-
 ~ D_(log(NB_COMPANY) + clog(MED_INCOME))

# define the list of control parameters
flow_control &lt;- spflow_control(sdm_variables = sdm_formula)


# Estimate the model
spflow(flow_formula, paris10km_multi_net, flow_control = flow_control)
</code></pre>

<hr>
<h2 id='spflow_sim'>Simulate spatial interactions</h2><span id='topic+spflow_sim'></span>

<h3>Description</h3>

<p>Simulate spatial interactions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spflow_sim(
  exogenous_variables,
  model_coefficients,
  inverted_filter,
  noise_sd,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="spflow_sim_+3A_exogenous_variables">exogenous_variables</code></td>
<td>
<p>A matrix of exogenous variables</p>
</td></tr>
<tr><td><code id="spflow_sim_+3A_model_coefficients">model_coefficients</code></td>
<td>
<p>A numeric vector of coefficients</p>
</td></tr>
<tr><td><code id="spflow_sim_+3A_inverted_filter">inverted_filter</code></td>
<td>
<p>A matrix that represents an inverted spatial filter matrix
(see <code><a href="#topic+spatial_filter">spatial_filter()</a></code>)</p>
</td></tr>
<tr><td><code id="spflow_sim_+3A_noise_sd">noise_sd</code></td>
<td>
<p>A numeric which indicates the desired standard deviation of the simulated noise</p>
</td></tr>
<tr><td><code id="spflow_sim_+3A_verbose">verbose</code></td>
<td>
<p>A logical whether signal to noise ration should be printed</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector of simulated flows
</p>


<h3>See Also</h3>

<p>Other spflow simulation functions: 
<code><a href="#topic+expand_flow_neighborhood">expand_flow_neighborhood</a>()</code>,
<code><a href="#topic+spatial_filter">spatial_filter</a>()</code>
</p>

<hr>
<h2 id='spflow-deprecated'>Deprecated functions in package <span class="pkg">spflow</span>.</h2><span id='topic+spflow-deprecated'></span>

<h3>Description</h3>

<p>The functions listed below are deprecated and will be defunct in
the near future. When possible, alternative functions with similar
functionality are also mentioned. Help pages for deprecated functions are
available at <code>help("&lt;function&gt;-deprecated")</code>.
</p>
<p>The functions listed below are defunct. When possible,
alternative functions with similar functionality are also mentioned. Help
pages for deprecated functions are available at
<code>help("&lt;function&gt;-defunct")</code>.
</p>

<hr>
<h2 id='translist'>Additional list operators that allow a more concise and
functional programming style</h2><span id='topic+translist'></span><span id='topic+compact'></span><span id='topic+ilapply'></span><span id='topic+ulapply'></span><span id='topic+flatlist'></span>

<h3>Description</h3>

<p>Additional list operators that allow a more concise and
functional programming style
</p>


<h3>Usage</h3>

<pre><code class='language-R'>translist(.l)

compact(.x)

ilapply(.list, .f, MoreArgs = NULL)

ulapply(.list, .f, ..., recursive = TRUE, use.names = FALSE)

flatlist(lst, use.names = TRUE)
</code></pre>


<h3>Author(s)</h3>

<p>Lukas Dargel
</p>

<hr>
<h2 id='varcov'>Generic for accessing the variance-covariance matrix of the
parameters inside a <code><a href="#topic+spflow_model-class">spflow_model-class()</a></code>.</h2><span id='topic+varcov'></span>

<h3>Description</h3>

<p>For details on the methods see the documentation of the
corresponding classes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>varcov(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="varcov_+3A_object">object</code></td>
<td>
<p>A <code><a href="#topic+spflow_model-class">spflow_model-class()</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>The variance-covariance matrix of the fitted model parameters
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spflow_model-class">spflow_model-class()</a></code>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
