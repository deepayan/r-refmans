<!DOCTYPE html><html><head><title>Help for package facmodCS</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {facmodCS}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#calcFLAM'><p>calcFLAM</p></a></li>
<li><a href='#convert'><p>convert</p></a></li>
<li><a href='#convert.ffmSpec'><p>Function to convert to current class # mido to change to retroFit</p></a></li>
<li><a href='#dCornishFisher'><p>Cornish-Fisher expansion</p></a></li>
<li><a href='#extractRegressionStats'><p>extractRegressionStats</p></a></li>
<li><a href='#facmodCS-package'><p>facmodCS: Cross-Section Factor Models</p></a></li>
<li><a href='#fitFfm'><p>Fit a fundamental factor model using cross-sectional regression</p></a></li>
<li><a href='#fitFfmDT'><p>fitFfmDT</p></a></li>
<li><a href='#fmCov'><p>Covariance Matrix for assets' returns from fitted factor model.</p></a></li>
<li><a href='#fmEsDecomp'><p>Decompose ES into individual factor contributions</p></a></li>
<li><a href='#fmmcSemiParam'><p>Semi-parametric factor model Monte Carlo</p></a></li>
<li><a href='#fmRsq'><p>Factor Model R-Squared and Adj R-Squared Values</p></a></li>
<li><a href='#fmSdDecomp'><p>Decompose standard deviation into individual factor contributions</p></a></li>
<li><a href='#fmTstats'><p>fmTstats.ffm t-stats and plots for a fitted Fundamental Factor Model object</p></a></li>
<li><a href='#fmVaRDecomp'><p>Decompose VaR into individual factor contributions</p></a></li>
<li><a href='#lagExposures'><p>lagExposures allows the user to lag exposures by one time period</p></a></li>
<li><a href='#plot.ffm'><p>Plots from a fitted fundamental factor model</p></a></li>
<li><a href='#portEsDecomp'><p>Decompose portfolio ES into individual factor contributions</p></a></li>
<li><a href='#portSdDecomp'><p>Decompose portfolio standard deviation into individual factor contributions</p></a></li>
<li><a href='#portVaRDecomp'><p>Decompose portfolio VaR into individual factor contributions</p></a></li>
<li><a href='#predict.ffm'><p>Predicts asset returns based on a fitted fundamental factor model</p></a></li>
<li><a href='#print.ffm'><p>Prints a fitted fundamental factor model</p></a></li>
<li><a href='#print.ffmSpec'><p>print.ffmSpec</p></a></li>
<li><a href='#repExposures'><p>Portfolio Exposures Report</p></a></li>
<li><a href='#repReturn'><p>Portfolio return decomposition report</p></a></li>
<li><a href='#repRisk'><p>Decompose portfolio risk into individual factor contributions and provide tabular report</p></a></li>
<li><a href='#residualizeReturns'><p>residualizeReturns</p></a></li>
<li><a href='#riskDecomp.ffm'><p>Decompose Risk into individual factor contributions</p></a></li>
<li><a href='#roll.fitFfmDT'><p>roll.fitFfmDT</p></a></li>
<li><a href='#specFfm'><p>Specifies the elements of a fundamental factor model</p></a></li>
<li><a href='#standardizeExposures'><p>standardizeExposures</p></a></li>
<li><a href='#standardizeReturns'><p>standardizeReturns</p></a></li>
<li><a href='#summary.ffm'><p>Summarizing a fitted fundamental factor model</p></a></li>
<li><a href='#tsPlotMP'><p>Time Series Plots</p></a></li>
<li><a href='#vif'><p>Factor Model Variance Inflaction Factor Values</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Cross-Section Factor Models</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-06-04</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Mido Shammaa &lt;midoshammaa@yahoo.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Linear cross-section factor model fitting with least-squares 
    and robust fitting the 'lmrobdetMM()' function from 'RobStatTM'; related
    volatility, Value at Risk and Expected Shortfall risk and performance 
    attribution (factor-contributed vs idiosyncratic returns);
    tabular displays of risk and performance reports;
    factor model Monte Carlo. The package authors would like to thank Chicago
    Research on Security Prices,LLC for the cross-section of about 300
    CRSP stocks data (in the data.table object 'stocksCRSP', and S&amp;P GLOBAL MARKET
    INTELLIGENCE for contributing 14 factor scores (a.k.a "alpha factors".and
    "factor exposures") fundamental data on the 300 companies in the data.table
    object 'factorSPGMI'.  The 'stocksCRSP' and 'factorsSPGMI' data are not covered by
    the GPL-2 license, are not provided as open source of any kind, and they are
    not to be redistributed in any form.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5),</td>
</tr>
<tr>
<td>Imports:</td>
<td>data.table, xts, zoo, PerformanceAnalytics, lattice, methods,
sn, tseries, robustbase, RobStatTM,</td>
</tr>
<tr>
<td>Suggests:</td>
<td>PCRA, corrplot, lmtest, rugarch, HH</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/robustport/facmodCS">https://github.com/robustport/facmodCS</a></td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-06-14 22:03:53 UTC; Mahmoud</td>
</tr>
<tr>
<td>Author:</td>
<td>Mido Shammaa [aut, cre],
  Doug Martin [ctb, aut],
  Kirk Li [aut, ctb],
  Avinash Acharya [ctb],
  Lingjie Yi [ctb]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-06-15 17:20:08 UTC</td>
</tr>
</table>
<hr>
<h2 id='calcFLAM'>calcFLAM</h2><span id='topic+calcFLAM'></span>

<h3>Description</h3>

<p>function to calculate fundamental law of active management
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calcFLAM(
  specObj,
  modelStats,
  fitResults,
  analysis = c("ISM", "NEW"),
  targetedVol = 0.06,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="calcFLAM_+3A_specobj">specObj</code></td>
<td>
<p>an object as the output from specFfm function</p>
</td></tr>
<tr><td><code id="calcFLAM_+3A_modelstats">modelStats</code></td>
<td>
<p>output of the extractRegressionStats functions. 
Contains fit statistics of the factor model.</p>
</td></tr>
<tr><td><code id="calcFLAM_+3A_fitresults">fitResults</code></td>
<td>
<p>output from fitFfmDT</p>
</td></tr>
<tr><td><code id="calcFLAM_+3A_analysis">analysis</code></td>
<td>
<p>type character, choice of c(&quot;none&quot;, &quot;ISM&quot;,&quot;NEW&quot;). Default = &quot;none&quot;.
Corresponds to methods used in the analysis of fundamental law of active management.</p>
</td></tr>
<tr><td><code id="calcFLAM_+3A_targetedvol">targetedVol</code></td>
<td>
<p>numeric; the targeted portfolio volatility in the analysis. 
Default is 0.06.</p>
</td></tr>
<tr><td><code id="calcFLAM_+3A_...">...</code></td>
<td>
<p>additional arguments</p>
</td></tr>
</table>

<hr>
<h2 id='convert'>convert</h2><span id='topic+convert'></span>

<h3>Description</h3>

<p>function to convert the new ffm spec object to ffm object to make it
easier in plotting and reporting
</p>


<h3>Usage</h3>

<pre><code class='language-R'>convert(SpecObj, FitObj, RegStatsObj, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="convert_+3A_specobj">SpecObj</code></td>
<td>
<p>an object as the output from specFfm function</p>
</td></tr>
<tr><td><code id="convert_+3A_fitobj">FitObj</code></td>
<td>
<p>an object as the output from fitFfmDT function</p>
</td></tr>
<tr><td><code id="convert_+3A_regstatsobj">RegStatsObj</code></td>
<td>
<p>an object as the output from extractRegressionStats function</p>
</td></tr>
<tr><td><code id="convert_+3A_...">...</code></td>
<td>
<p>additional arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>returns an object of class ffm
</p>

<hr>
<h2 id='convert.ffmSpec'>Function to convert to current class # mido to change to retroFit</h2><span id='topic+convert.ffmSpec'></span>

<h3>Description</h3>

<p>Function to convert to current class # mido to change to retroFit
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ffmSpec'
convert(SpecObj, FitObj, RegStatsObj, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="convert.ffmSpec_+3A_specobj">SpecObj</code></td>
<td>
<p>an object as the output from specFfm function</p>
</td></tr>
<tr><td><code id="convert.ffmSpec_+3A_fitobj">FitObj</code></td>
<td>
<p>an object as the output from fitFfmDT function</p>
</td></tr>
<tr><td><code id="convert.ffmSpec_+3A_regstatsobj">RegStatsObj</code></td>
<td>
<p>an object as the output from extractRegressionStats function</p>
</td></tr>
<tr><td><code id="convert.ffmSpec_+3A_...">...</code></td>
<td>
<p>additional arguments</p>
</td></tr>
</table>


<h3>Value</h3>

<p>returns an object of class ffm
</p>

<hr>
<h2 id='dCornishFisher'>Cornish-Fisher expansion</h2><span id='topic+dCornishFisher'></span><span id='topic+Cornish-Fisher'></span><span id='topic+pCornishFisher'></span><span id='topic+qCornishFisher'></span><span id='topic+rCornishFisher'></span>

<h3>Description</h3>

<p>Density, distribution function, quantile function and random 
generation using Cornish-Fisher approximation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dCornishFisher(x, n, skew, ekurt)

pCornishFisher(q, n, skew, ekurt)

qCornishFisher(p, n, skew, ekurt)

rCornishFisher(n, sigma, skew, ekurt, dp = NULL, seed = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dCornishFisher_+3A_x">x</code>, <code id="dCornishFisher_+3A_q">q</code></td>
<td>
<p>vector of standardized quantiles.</p>
</td></tr>
<tr><td><code id="dCornishFisher_+3A_n">n</code></td>
<td>
<p>scalar; number of simulated values in random simulation, sample 
length in density, distribution and quantile functions.</p>
</td></tr>
<tr><td><code id="dCornishFisher_+3A_skew">skew</code></td>
<td>
<p>scalar; skewness.</p>
</td></tr>
<tr><td><code id="dCornishFisher_+3A_ekurt">ekurt</code></td>
<td>
<p>scalar; excess kurtosis.</p>
</td></tr>
<tr><td><code id="dCornishFisher_+3A_p">p</code></td>
<td>
<p>vector of probabilities.</p>
</td></tr>
<tr><td><code id="dCornishFisher_+3A_sigma">sigma</code></td>
<td>
<p>scalar standard deviation.</p>
</td></tr>
<tr><td><code id="dCornishFisher_+3A_dp">dp</code></td>
<td>
<p>a vector of length 3, whose elements represent sigma, skew and 
ekurt, respectively. If dp is specified, the individual parameters cannot be 
set. Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="dCornishFisher_+3A_seed">seed</code></td>
<td>
<p>scalar; set seed. Default is <code>NULL</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>CDF(q) = Pr(sqrt(n)*(x_bar-mu)/sigma &lt; q)
<code>dCornishFisher</code> Computes Cornish-Fisher density from two term Edgeworth 
expansion given mean, standard deviation, skewness and excess kurtosis.
<code>pCornishFisher</code> Computes Cornish-Fisher CDF from two term Edgeworth 
expansion given mean, standard deviation, skewness and excess kurtosis.
<code>qCornishFisher</code> Computes Cornish-Fisher quantiles from two term 
Edgeworth expansion given mean, standard deviation, skewness and excess 
kurtosis.
<code>rCornishFisher</code> simulates observations based on Cornish-Fisher quantile 
expansion given mean, standard deviation, skewness and excess kurtosis.
</p>


<h3>Value</h3>

<p><code>dCornishFisher</code> gives the density, <code>pCornishFisher</code> gives the 
distribution function, <code>qCornishFisher</code> gives the quantile function, 
and <code>rCornishFisher</code> generates <code>n</code> random simulations.
</p>


<h3>Author(s)</h3>

<p>Eric Zivot and Yi-An Chen.
</p>


<h3>References</h3>

<p>DasGupta, A. (2008). Asymptotic theory of statistics and probability. 
Springer.
Severini, T. A., (2000). Likelihood Methods in Statistics. Oxford University 
Press.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># generate 1000 observation from Cornish-Fisher distribution
rc &lt;- rCornishFisher(1000,1,0,5)
hist(rc, breaks=100, freq=FALSE, 
     main="simulation of Cornish Fisher Distribution", xlim=c(-10,10))
lines(seq(-10,10,0.1), dnorm(seq(-10,10,0.1), mean=0, sd=1), col=2)
# compare with standard normal curve

# exponential example from A.dasGupta p.188
# x is iid exp(1) distribution, sample size = 5
# then x_bar is Gamma(shape=5, scale=1/5) distribution
q &lt;- c(0,0.4,1,2)
# exact cdf
pgamma(q/sqrt(5)+1, shape=5, scale=1/5)
# use CLT
pnorm(q)
# use edgeworth expansion
pCornishFisher(q, n=5, skew=2, ekurt=6)

</code></pre>

<hr>
<h2 id='extractRegressionStats'>extractRegressionStats</h2><span id='topic+extractRegressionStats'></span>

<h3>Description</h3>

<p>function to compute or Extract objects to be returned
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extractRegressionStats(specObj, fitResults, full.resid.cov = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extractRegressionStats_+3A_specobj">specObj</code></td>
<td>
<p>fitFM object that has been already fit</p>
</td></tr>
<tr><td><code id="extractRegressionStats_+3A_fitresults">fitResults</code></td>
<td>
<p>output from fitFfmDT</p>
</td></tr>
<tr><td><code id="extractRegressionStats_+3A_full.resid.cov">full.resid.cov</code></td>
<td>
<p>an option to calculate the full residual covariance or not</p>
</td></tr>
</table>


<h3>Details</h3>

<p>this function operates on the specObje data and the output of fitFfm
to get information on the fundamental factor.
</p>


<h3>Value</h3>

<p>a structure of class ffm holding all the information
</p>


<h3>See Also</h3>

<p><code><a href="#topic+specFfm">specFfm</a></code> and <code><a href="#topic+fitFfmDT">fitFfmDT</a></code> for information on the definition of the specFfm 
object and the usage of fitFfmDT.
</p>

<hr>
<h2 id='facmodCS-package'>facmodCS: Cross-Section Factor Models</h2><span id='topic+facmodCS'></span><span id='topic+facmodCS-package'></span>

<h3>Description</h3>

<p>Linear cross-section factor model fitting with least-squares and robust fitting the 'lmrobdetMM()' function from 'RobStatTM'; related volatility, Value at Risk and Expected Shortfall risk and performance attribution (factor-contributed vs idiosyncratic returns); tabular displays of risk and performance reports; factor model Monte Carlo. The package authors would like to thank Chicago Research on Security Prices,LLC for the cross-section of about 300 CRSP stocks data (in the data.table object 'stocksCRSP', and S&amp;P GLOBAL MARKET INTELLIGENCE for contributing 14 factor scores (a.k.a &quot;alpha factors&quot;.and &quot;factor exposures&quot;) fundamental data on the 300 companies in the data.table object 'factorSPGMI'. The 'stocksCRSP' and 'factorsSPGMI' data are not covered by the GPL-2 license, are not provided as open source of any kind, and they are not to be redistributed in any form.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Mido Shammaa <a href="mailto:midoshammaa@yahoo.com">midoshammaa@yahoo.com</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> Doug Martin <a href="mailto:martinrd3d@gmail.com">martinrd3d@gmail.com</a> [contributor]
</p>
</li>
<li><p> Kirk Li <a href="mailto:cocokecoli@gmail.com">cocokecoli@gmail.com</a> [contributor]
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> Avinash Acharya <a href="mailto:Jon.Spinney@vestcor.org">Jon.Spinney@vestcor.org</a> [contributor]
</p>
</li>
<li><p> Lingjie Yi <a href="mailto:lingjy.uw@gmail.com">lingjy.uw@gmail.com</a> [contributor]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/robustport/facmodCS">https://github.com/robustport/facmodCS</a>
</p>
</li></ul>


<hr>
<h2 id='fitFfm'>Fit a fundamental factor model using cross-sectional regression</h2><span id='topic+fitFfm'></span><span id='topic+coef.ffm'></span><span id='topic+fitted.ffm'></span><span id='topic+residuals.ffm'></span>

<h3>Description</h3>

<p>Fit a fundamental (cross-sectional) factor model using ordinary
least squares or robust regression. Fundamental factor models use observable
asset specific characteristics (or) fundamentals, like industry
classification, market capitalization, style classification (value, growth)
etc. to calculate the common risk factors. An object of class <code>"ffm"</code>
is returned.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fitFfm(
  data,
  asset.var,
  ret.var,
  date.var,
  exposure.vars,
  weight.var = NULL,
  fit.method = c("LS", "WLS", "Rob", "W-Rob"),
  rob.stats = FALSE,
  full.resid.cov = FALSE,
  z.score = c("none", "crossSection", "timeSeries"),
  addIntercept = FALSE,
  lagExposures = TRUE,
  resid.scaleType = "stdDev",
  lambda = 0.9,
  GARCH.params = list(omega = 0.09, alpha = 0.1, beta = 0.81),
  GARCH.MLE = FALSE,
  stdReturn = FALSE,
  analysis = c("none", "ISM", "NEW"),
  targetedVol = 0.06,
  ...
)

## S3 method for class 'ffm'
coef(object, ...)

## S3 method for class 'ffm'
fitted(object, ...)

## S3 method for class 'ffm'
residuals(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fitFfm_+3A_data">data</code></td>
<td>
<p>data.frame of the balanced panel data containing the variables 
<code>asset.var</code>, <code>ret.var</code>, <code>exposure.vars</code>, <code>date.var</code> and 
optionally, <code>weight.var</code>.</p>
</td></tr>
<tr><td><code id="fitFfm_+3A_asset.var">asset.var</code></td>
<td>
<p>character; name of the variable for asset names.</p>
</td></tr>
<tr><td><code id="fitFfm_+3A_ret.var">ret.var</code></td>
<td>
<p>character; name of the variable for asset returns.</p>
</td></tr>
<tr><td><code id="fitFfm_+3A_date.var">date.var</code></td>
<td>
<p>character; name of the variable containing the dates 
coercible to class <code>Date</code>.</p>
</td></tr>
<tr><td><code id="fitFfm_+3A_exposure.vars">exposure.vars</code></td>
<td>
<p>vector; names of the variables containing the 
fundamental factor exposures.</p>
</td></tr>
<tr><td><code id="fitFfm_+3A_weight.var">weight.var</code></td>
<td>
<p>character; name of the variable containing the weights 
used when standarizing style factor exposures. Default is <code>NULL</code>. See 
Details.</p>
</td></tr>
<tr><td><code id="fitFfm_+3A_fit.method">fit.method</code></td>
<td>
<p>method for estimating factor returns; one of &quot;LS&quot;, &quot;WLS&quot; 
&quot;Rob&quot; or &quot;W-Rob&quot;. See details. Default is &quot;LS&quot;.</p>
</td></tr>
<tr><td><code id="fitFfm_+3A_rob.stats">rob.stats</code></td>
<td>
<p>logical; If <code>TRUE</code>, robust estimates of covariance, 
correlation, location and univariate scale are computed as appropriate (see 
Details). Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="fitFfm_+3A_full.resid.cov">full.resid.cov</code></td>
<td>
<p>logical; If <code>TRUE</code>, a full residual covariance 
matrix is estimated. Otherwise, a diagonal residual covariance matrix is 
estimated. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="fitFfm_+3A_z.score">z.score</code></td>
<td>
<p>method for exposure standardization; one of &quot;none&quot;, 
&quot;crossSection&quot;, or &quot;timeSeries&quot;. Default is <code>"none"</code>.</p>
</td></tr>
<tr><td><code id="fitFfm_+3A_addintercept">addIntercept</code></td>
<td>
<p>logical; If <code>TRUE</code>, intercept is added in the 
exposure matrix. Note, if 2 or more variables are categorical, this must be
false. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="fitFfm_+3A_lagexposures">lagExposures</code></td>
<td>
<p>logical; If <code>TRUE</code>, the style exposures in the 
exposure matrix are lagged by one time period. Default is <code>TRUE</code>,</p>
</td></tr>
<tr><td><code id="fitFfm_+3A_resid.scaletype">resid.scaleType</code></td>
<td>
<p>character; Only valid when fit.method is set to WLS or 
W-Rob. The weights used in the weighted regression are estimated  using 
sample variance, classic EWMA, robust EWMA or GARCH model. Valid values are 
<code>stdDev</code>, <code>EWMA</code>, <code>robEWMA</code>, or <code>GARCH</code>.Default is 
<code>stdDev</code> where the inverse of residual sample variances are used as the 
weights. If using GARCH option, make sure to install and load 
rugarch package.</p>
</td></tr>
<tr><td><code id="fitFfm_+3A_lambda">lambda</code></td>
<td>
<p>lambda value to be used for the EWMA estimation of residual 
variances. Default is 0.9</p>
</td></tr>
<tr><td><code id="fitFfm_+3A_garch.params">GARCH.params</code></td>
<td>
<p>list containing GARCH parameters omega, alpha, and beta. 
Default values are (0.09, 0.1, 0.81) respectively. Valid only when 
<code>GARCH.MLE</code> is set to <code>FALSE</code>. Estimation outsourced to the
rugarch package, please load it first.</p>
</td></tr>
<tr><td><code id="fitFfm_+3A_garch.mle">GARCH.MLE</code></td>
<td>
<p>boolean input (TRUE|FALSE), default value = <code>FALSE</code>. This
argument allows one to choose to compute GARCH parameters by maximum 
likelihood estimation. Estimation outsourced to the rugarch
package, please load it.</p>
</td></tr>
<tr><td><code id="fitFfm_+3A_stdreturn">stdReturn</code></td>
<td>
<p>logical; If <code>TRUE</code>, the returns will be standardized 
using GARCH(1,1) volatilities. Default is <code>FALSE</code>. Make sure to load 
rugarch package.</p>
</td></tr>
<tr><td><code id="fitFfm_+3A_analysis">analysis</code></td>
<td>
<p>method used in the analysis of fundamental law of active 
management; one of &quot;none&quot;, &quot;ISM&quot;, or &quot;NEW&quot;. Default is &quot;none&quot;.</p>
</td></tr>
<tr><td><code id="fitFfm_+3A_targetedvol">targetedVol</code></td>
<td>
<p>numeric; the targeted portfolio volatility in the analysis. 
Default is 0.06.</p>
</td></tr>
<tr><td><code id="fitFfm_+3A_...">...</code></td>
<td>
<p>potentially further arguments passed.</p>
</td></tr>
<tr><td><code id="fitFfm_+3A_object">object</code></td>
<td>
<p>a fit object of class <code>ffm</code> which is returned by 
<code>fitFfm</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Estimation method &quot;LS&quot; corresponds to ordinary least squares using 
<code><a href="stats.html#topic+lm">lm</a></code> and &quot;Rob&quot; is robust regression using 
<code><a href="RobStatTM.html#topic+lmrobdetMM">lmrobdetMM</a></code>. &quot;WLS&quot; is weighted least squares using estimates 
of the residual variances from LS regression as weights (feasible GLS). 
Similarly, &quot;W-Rob&quot; is weighted robust regression.
</p>
<p>The weights to be used in &quot;WLS&quot; or &quot;W-Rob&quot; can be set using 
<code>resid.scaleType</code> argument which computes the residual variances in one of the following ways - 
sample variace, EWMA, Robust EWMA and GARCH(1,1). The inverse of these residual variances
are used as the weights. For EWMA model, lambda = 0.9 is used as default and for GARCH(1,1) 
omega = 0.09, alpha = 0.1, and beta = 0.81 are used as default as mentioned in Martin &amp; Ding (2017).
These default parameters can be changed using the arguments <code>lambda</code>, 
<code>GARCH.params</code> for EWMA and GARCH respectively. To compute GARCH 
parameters via MLE, set <code>GARCH.MLE</code> to <code>TRUE</code>. Make sure you have
the rugarch package installed and loaded, as is merely listed as SUGGESTS.
</p>
<p>Standardizing style factor exposures: The exposures can be standardized into
z-scores using regular or robust (see <code>rob.stats</code>) measures of location 
and scale. Further, <code>weight.var</code>, a variable such as market-cap, can be 
used to compute the weighted mean exposure, and an equal-weighted standard 
deviation of the exposures about the weighted mean. This may help avoid an 
ill-conditioned covariance matrix. Default option equally weights exposures 
of different assets each period. 
</p>
<p>If <code>rob.stats=TRUE</code>, <code><a href="RobStatTM.html#topic+covRob">covRob</a></code> is used to compute a 
robust estimate of the factor covariance/correlation matrix, and, 
<code><a href="robustbase.html#topic+scaleTau2">scaleTau2</a></code> is used to compute robust tau-estimates 
of univariate scale for residuals during &quot;WLS&quot; or &quot;W-Rob&quot; regressions. When 
standardizing style exposures, the <code><a href="stats.html#topic+median">median</a></code> and 
<code><a href="stats.html#topic+mad">mad</a></code> are used for location and scale respectively.
When <code>resid.scaleType</code> is EWMA or GARCH, the residual covariance is equal to the 
diagonal matrix of the estimated residual variances in last time period.
</p>
<p>The original function was designed by Doug Martin and initially implemented
in S-PLUS by a number of University of Washington Ph.D. students:
Christopher Green, Eric Aldrich, and Yindeng Jiang. Guy Yollin ported the
function to R and Yi-An Chen modified that code. Sangeetha Srinivasan
re-factored, tested, corrected and expanded the functionalities and S3 
methods.
</p>


<h3>Value</h3>

<p><code>fitFfm</code> returns an object of class <code>"ffm"</code> for which 
<code>print</code>, <code>plot</code>, <code>predict</code> and <code>summary</code> methods exist. 
</p>
<p>The generic accessor functions <code>coef</code>, <code>fitted</code> and 
<code>residuals</code> extract various useful features of the fit object. 
Additionally, <code>fmCov</code> computes the covariance matrix for asset returns 
based on the fitted factor model.
</p>
<p>An object of class <code>"ffm"</code> is a list containing the following 
components:
</p>
<table>
<tr><td><code>factor.fit</code></td>
<td>
<p>list of fitted objects that estimate factor returns in each 
time period. Each fitted object is of class <code>lm</code> if 
<code>fit.method="LS" or "WLS"</code>, or, class <code>lmrobdetMM</code> if 
<code>fit.method="Rob" or "W-Rob"</code>.</p>
</td></tr>
<tr><td><code>beta</code></td>
<td>
<p>N x K matrix of factor exposures for the last time period.</p>
</td></tr>
<tr><td><code>factor.returns</code></td>
<td>
<p>xts object of K-factor returns (including intercept).</p>
</td></tr>
<tr><td><code>residuals</code></td>
<td>
<p>xts object of residuals for N-assets.</p>
</td></tr>
<tr><td><code>r2</code></td>
<td>
<p>length-T vector of R-squared values.</p>
</td></tr>
<tr><td><code>factor.cov</code></td>
<td>
<p>K x K covariance matrix of the factor returns.</p>
</td></tr>
<tr><td><code>g.cov</code></td>
<td>
<p> covariance matrix of the g coefficients for a Sector plus market and Sector plus Country plus global market models .</p>
</td></tr>
<tr><td><code>resid.cov</code></td>
<td>
<p>N x N covariance matrix of residuals.</p>
</td></tr>
<tr><td><code>return.cov</code></td>
<td>
<p>N x N return covariance estimated by the factor model, 
using the factor exposures from the last time period.</p>
</td></tr>
<tr><td><code>restriction.mat</code></td>
<td>
<p>The restriction matrix used in the computation of f=Rg.</p>
</td></tr>
<tr><td><code>resid.var</code></td>
<td>
<p>N x T matrix of estimated residual variances. It will be a length-N vector of sample residual variances when <code>resid.scaleType</code> is set to <code>stdDev</code> </p>
</td></tr>
<tr><td><code>call</code></td>
<td>
<p>the matched function call.</p>
</td></tr>
<tr><td><code>data</code></td>
<td>
<p>data frame object as input.</p>
</td></tr>
<tr><td><code>date.var</code></td>
<td>
<p>date.var as input</p>
</td></tr>
<tr><td><code>ret.var</code></td>
<td>
<p>ret.var as input</p>
</td></tr>
<tr><td><code>asset.var</code></td>
<td>
<p>asset.var as input.</p>
</td></tr>
<tr><td><code>exposure.vars</code></td>
<td>
<p>exposure.vars as input.</p>
</td></tr>
<tr><td><code>weight.var</code></td>
<td>
<p>weight.var as input.</p>
</td></tr>
<tr><td><code>fit.method</code></td>
<td>
<p>fit.method as input.</p>
</td></tr>
<tr><td><code>asset.names</code></td>
<td>
<p>length-N vector of asset names.</p>
</td></tr>
<tr><td><code>factor.names</code></td>
<td>
<p>length-K vector of factor.names.</p>
</td></tr>
<tr><td><code>time.periods</code></td>
<td>
<p>length-T vector of dates.</p>
</td></tr>
</table>
<p>Where N is the number of assets, K is the number of factors (including the 
intercept or dummy variables) and T is the number of unique time periods.
</p>
<table>
<tr><td><code>activeWeights</code></td>
<td>
<p>active weights obtaining from the fundamental law of active management</p>
</td></tr>
<tr><td><code>activeReturns</code></td>
<td>
<p>active returns corresponding to the active weights</p>
</td></tr>
<tr><td><code>IR</code></td>
<td>
<p>the vector of Granold-K, asymptotic IR, and finite-sample IR.</p>
</td></tr>
</table>
<p>Where N is the number of assets, K is the number of factors (including the 
intercept or dummy variables) and T is the number of unique time periods.
</p>


<h3>Author(s)</h3>

<p>Sangeetha Srinivasan, Guy Yollin,  Yi-An Chen, Avinash Acharya and Chindhanai Uthaisaad
</p>


<h3>References</h3>

<p>Menchero, J. (2010). The Characteristics of Factor Portfolios. Journal of
Performance Measurement, 15(1), 52-62.
</p>
<p>Grinold, R. C., &amp; Kahn, R. N. (2000). Active portfolio management (Second
Ed.). New York: McGraw-Hill.
</p>
<p>Ding, Z. and Martin, R. D. (2016). &quot;The Fundamental Law of Active Management Redux&quot;, SSRN 2730434.
</p>
<p>And, the following extractor functions: <code><a href="stats.html#topic+coef">coef</a></code>, 
<code><a href="stats.html#topic+fitted">fitted</a></code>, <code><a href="stats.html#topic+residuals">residuals</a></code>,
<code><a href="#topic+fmCov">fmCov</a></code>, <code><a href="#topic+fmSdDecomp">fmSdDecomp</a></code>, <code><a href="#topic+fmVaRDecomp">fmVaRDecomp</a></code> 
and <code><a href="#topic+fmEsDecomp">fmEsDecomp</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(PCRA)
# load data 
data(stocksCRSP)
data(factorsSPGMI)
dateRange &lt;- c("2006-01-31","2010-12-31")
stockItems &lt;-  c("Date", "TickerLast", "CapGroupLast", "Return",
                "Ret13WkBill","MktIndexCRSP","Sector")
                factorItems &lt;- c("BP","Beta60M","PM12M1M")
stocks_factors &lt;- selectCRSPandSPGMI("monthly", dateRange = dateRange, 
stockItems = stockItems, factorItems = factorItems, outputType ="data.table")
                                    

# fit a fundamental factor model with style variables BP and LogMktCap

fundamental_model &lt;- fitFfm(data = stocks_factors, 
                           asset.var = "TickerLast", 
                           ret.var = "Return", 
                           date.var = "Date", 
                           exposure.vars = c("BP", "PM12M1M")
                           )

  summary(fundamental_model)

# Fit a Fundamental Sector Factor Model with Intercept
 
 sector_model &lt;- fitFfm(data = stocks_factors, 
                        asset.var = "TickerLast", 
                        ret.var = "Return", 
                        date.var = "Date", 
                        exposure.vars = c("Sector", "BP"),
                        addIntercept = TRUE)

 summary(sector_model)

               

</code></pre>

<hr>
<h2 id='fitFfmDT'>fitFfmDT</h2><span id='topic+fitFfmDT'></span>

<h3>Description</h3>

<p>This function fits a fundamental factor model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fitFfmDT(
  ffMSpecObj,
  fit.method = c("LS", "WLS", "Rob", "W-Rob"),
  resid.scaleType = c("StdDev", "EWMA", "RobustEWMA", "GARCH"),
  lambda = 0.9,
  GARCH.params = list(omega = 0.09, alpha = 0.1, beta = 0.81),
  GARCH.MLE = FALSE,
  lmrobdet.control.para.list = lmrobdet.control(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fitFfmDT_+3A_ffmspecobj">ffMSpecObj</code></td>
<td>
<p>a specFFm object</p>
</td></tr>
<tr><td><code id="fitFfmDT_+3A_fit.method">fit.method</code></td>
<td>
<p>method for estimating factor returns; one of &quot;LS&quot;, &quot;WLS&quot;
&quot;ROB&quot; or &quot;W-ROB&quot;. See details. Default is &quot;LS&quot;.</p>
</td></tr>
<tr><td><code id="fitFfmDT_+3A_resid.scaletype">resid.scaleType</code></td>
<td>
<p>one of 4 choices &quot;StdDev&quot;,&quot;EWMA&quot;,&quot;RobustEWMA&quot;, &quot;GARCH&quot;</p>
</td></tr>
<tr><td><code id="fitFfmDT_+3A_lambda">lambda</code></td>
<td>
<p>the ewma parameter</p>
</td></tr>
<tr><td><code id="fitFfmDT_+3A_garch.params">GARCH.params</code></td>
<td>
<p>list containing GARCH parameters omega, alpha, and beta. 
Default values are (0.09, 0.1, 0.81) respectively. Valid only when 
<code>GARCH.MLE</code> is set to <code>FALSE</code>. Estimation outsourced to the
rugarch package, please load it first.</p>
</td></tr>
<tr><td><code id="fitFfmDT_+3A_garch.mle">GARCH.MLE</code></td>
<td>
<p>boolean input (TRUE|FALSE), default value = <code>FALSE</code>. This
argument allows one to choose to compute GARCH parameters by maximum 
likelihood estimation. Estimation outsourced to the rugarch
package, please load it.</p>
</td></tr>
<tr><td><code id="fitFfmDT_+3A_lmrobdet.control.para.list">lmrobdet.control.para.list</code></td>
<td>
<p>list of parameters to pass to lmrobdet.control().
Sets tuning parameters for the MM estimator implemented in lmrobdetMM of the
RobStatTM package. See <code><a href="RobStatTM.html#topic+lmrobdetMM">lmrobdetMM</a></code>.</p>
</td></tr>
<tr><td><code id="fitFfmDT_+3A_...">...</code></td>
<td>
<p>additional pass through arguments</p>
</td></tr>
</table>


<h3>Details</h3>

<p>this function operates on the data inside the specObj fits a fundamental factor
model to the data
</p>


<h3>Value</h3>

<p><code>fitFfm</code> returns a list with two object of class <code>"data.table"</code>
The first reg.listDT is object of class <code>"data.table"</code> is a list containing the following
components:
</p>
<table>
<tr><td><code>DATE</code></td>
<td>
<p>length-Time vector of dates.</p>
</td></tr>
<tr><td><code>id</code></td>
<td>
<p>length-N vector of asset id's for each date.</p>
</td></tr>
<tr><td><code>reg.list</code></td>
<td>
<p>list of fitted objects that estimate factor returns in each
time period. Each fitted object is of class <code>lm</code> if
<code>fit.method="LS" or "WLS"</code>, or, class <code>lmrobdetMM</code> if
<code>fit.method="Rob" or "W-Rob"</code>.</p>
</td></tr>
</table>
<p>The second betasDT is object of class <code>"data.table"</code> is a list containing the following
components:
</p>
<table>
<tr><td><code>DATE</code></td>
<td>
<p>length-Time vector of dates.</p>
</td></tr>
<tr><td><code>R_matrix</code></td>
<td>
<p>The K+1 by K restriction matrix where K is the number of categorical variables for each date.</p>
</td></tr>
</table>


<h3>See Also</h3>

<p><code><a href="#topic+specFfm">specFfm</a></code> for information on the definition of the specFfm object.
</p>

<hr>
<h2 id='fmCov'>Covariance Matrix for assets' returns from fitted factor model.</h2><span id='topic+fmCov'></span><span id='topic+fmCov.ffm'></span>

<h3>Description</h3>

<p>Computes the covariance matrix for assets' returns based on a 
fitted factor model. This is a generic function with methods for classes 
<code>tsfm</code>, <code>sfm</code> and <code>ffm</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fmCov(object, factor.cov, ...)

## S3 method for class 'ffm'
fmCov(object, factor.cov, use = "pairwise.complete.obs", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fmCov_+3A_object">object</code></td>
<td>
<p>fit object of class <code>tsfm</code>, <code>sfm</code> or <code>ffm</code>.</p>
</td></tr>
<tr><td><code id="fmCov_+3A_factor.cov">factor.cov</code></td>
<td>
<p>factor covariance matrix (optional); defaults to the 
sample covariance matrix.</p>
</td></tr>
<tr><td><code id="fmCov_+3A_...">...</code></td>
<td>
<p>optional arguments passed to <code><a href="stats.html#topic+cov">cov</a></code>.</p>
</td></tr>
<tr><td><code id="fmCov_+3A_use">use</code></td>
<td>
<p>method for computing covariances in the presence of missing 
values; one of &quot;everything&quot;, &quot;all.obs&quot;, &quot;complete.obs&quot;, &quot;na.or.complete&quot;, or 
&quot;pairwise.complete.obs&quot;. Default is &quot;pairwise.complete.obs&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>R(i, t)</code>, the return on asset <code>i</code> at time <code>t</code>, 
is assumed to follow a factor model of the form, <br /> <br /> 
<code>R(i,t) = alpha(i) + beta(i)*f(t) + e(i,t)</code>, <br /> <br />  
where, <code>alpha(i)</code> is the intercept, <code>f(t)</code> is a K x 1 vector of 
factor returns at time <code>t</code>, <code>beta(i)</code> is a <code>1 x K</code> vector of 
factor exposures and the error terms <code>e(i,t)</code> are serially 
uncorrelated across time and contemporaneously uncorrelated across assets 
so that <code>e(i,t) ~ iid(0,sig(i)^2)</code>. Thus, the variance of asset 
<code>i</code>'s return is given by <br /> <br />
<code>var(R(i)) = beta(i)*cov(F)*tr(beta(i)) + sig(i)^2</code>. <br /> <br />
And, the <code>N x N</code> covariance matrix of asset returns is <br /> <br />
<code>var(R) = B*cov(F)*tr(B) + D</code>, <br /> <br /> 
where, B is the <code>N x K</code> matrix of factor betas and <code>D</code> is a 
diagonal matrix with <code>sig(i)^2</code> along the diagonal.
</p>
<p>The method for computing covariance can be specified via the ... 
argument. Note that the default of <code>use="pairwise.complete.obs"</code> for 
handling NAs restricts the method to &quot;pearson&quot;.
</p>


<h3>Value</h3>

<p>The computed <code>N x N</code> covariance matrix for asset returns based 
on the fitted factor model.
</p>


<h3>Author(s)</h3>

<p>Eric Zivot, Yi-An Chen and Sangeetha Srinivasan.
</p>


<h3>References</h3>

<p>Zivot, E., &amp; Jia-hui, W. A. N. G. (2006). Modeling Financial Time 
Series with S-Plus Springer-Verlag.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitFfm">fitFfm</a></code>
</p>
<p><code><a href="stats.html#topic+cov">cov</a></code> for more details on arguments <code>use</code> and 
<code>method</code>.
</p>

<hr>
<h2 id='fmEsDecomp'>Decompose ES into individual factor contributions</h2><span id='topic+fmEsDecomp'></span><span id='topic+fmEsDecomp.ffm'></span>

<h3>Description</h3>

<p>Compute the factor contributions to Expected Tail Loss or 
Expected Shortfall (ES) of assets' returns  based on Euler's theorem, given 
the fitted factor model. The partial derivative of ES with respect to factor 
beta is computed as the expected factor return given fund return is less 
than or equal to its value-at-risk (VaR). Option to choose between 
non-parametric and Normal.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fmEsDecomp(object, ...)

## S3 method for class 'ffm'
fmEsDecomp(
  object,
  factor.cov,
  p = 0.05,
  type = c("np", "normal"),
  use = "pairwise.complete.obs",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fmEsDecomp_+3A_object">object</code></td>
<td>
<p>fit object of class <code>tsfm</code>, <code>sfm</code> or <code>ffm</code>.</p>
</td></tr>
<tr><td><code id="fmEsDecomp_+3A_...">...</code></td>
<td>
<p>other optional arguments passed to <code><a href="stats.html#topic+quantile">quantile</a></code>.</p>
</td></tr>
<tr><td><code id="fmEsDecomp_+3A_factor.cov">factor.cov</code></td>
<td>
<p>optional user specified factor covariance matrix with 
named columns; defaults to the sample covariance matrix.</p>
</td></tr>
<tr><td><code id="fmEsDecomp_+3A_p">p</code></td>
<td>
<p>tail probability for calculation. Default is 0.05.</p>
</td></tr>
<tr><td><code id="fmEsDecomp_+3A_type">type</code></td>
<td>
<p>one of &quot;np&quot; (non-parametric) or &quot;normal&quot; for calculating VaR. 
Default is &quot;np&quot;.</p>
</td></tr>
<tr><td><code id="fmEsDecomp_+3A_use">use</code></td>
<td>
<p>method for computing covariances in the presence of missing 
values; one of &quot;everything&quot;, &quot;all.obs&quot;, &quot;complete.obs&quot;, &quot;na.or.complete&quot;, or 
&quot;pairwise.complete.obs&quot;. Default is &quot;pairwise.complete.obs&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The factor model for an asset's return at time <code>t</code> has the 
form <br /> <br /> <code>R(t) = beta'f(t) + e(t) = beta.star'f.star(t)</code> <br /> <br /> 
where, <code>beta.star=(beta,sig.e)</code> and <code>f.star(t)=[f(t)',z(t)]'</code>. By 
Euler's theorem, the ES of the asset's return is given by:
<br /> <br /> <code>ES.fm = sum(cES_k) = sum(beta.star_k*mES_k)</code> <br /> <br />
where, summation is across the <code>K</code> factors and the residual, 
<code>cES</code> and <code>mES</code> are the component and marginal 
contributions to <code>ES</code> respectively. The marginal contribution to ES is
defined as the expected value of <code>F.star</code>, conditional on the loss 
being less than or equal to <code>VaR.fm</code>. This is estimated as a sample 
average of the observations in that data window. 
</p>
<p>Refer to Eric Zivot's slides (referenced) for formulas pertaining to the 
calculation of Normal ES (adapted from a portfolio context to factor models).
</p>


<h3>Value</h3>

<p>A list containing 
</p>
<table>
<tr><td><code>ES.fm</code></td>
<td>
<p>length-N vector of factor model ES of N-asset returns.</p>
</td></tr>
<tr><td><code>mES</code></td>
<td>
<p>N x (K+1) matrix of marginal contributions to VaR.</p>
</td></tr>
<tr><td><code>cES</code></td>
<td>
<p>N x (K+1) matrix of component contributions to VaR.</p>
</td></tr>
<tr><td><code>pcES</code></td>
<td>
<p>N x (K+1) matrix of percentage component contributions to VaR.</p>
</td></tr>
</table>
<p>Where, <code>K</code> is the number of factors and N is the number of assets.
</p>


<h3>Author(s)</h3>

<p>Eric Zviot, Sangeetha Srinivasan and Yi-An Chen
</p>


<h3>References</h3>

<p>Epperlein, E., &amp; Smillie, A. (2006). Portfolio risk analysis Cracking VAR 
with kernels. RISK-LONDON-RISK MAGAZINE LIMITED-, 19(8), 70.
</p>
<p>Hallerback (2003). Decomposing Portfolio Value-at-Risk: A General Analysis. 
The Journal of Risk, 5(2), 1-18.
</p>
<p>Meucci, A. (2007). Risk contributions from generic user-defined factors. 
RISK-LONDON-RISK MAGAZINE LIMITED-, 20(6), 84. 
</p>
<p>Yamai, Y., &amp; Yoshiba, T. (2002). Comparative analyses of expected shortfall 
and value-at-risk: their estimation error, decomposition, and optimization. 
Monetary and economic studies, 20(1), 87-121.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitFfm">fitFfm</a></code>
for the different factor model fitting functions.
</p>
<p><code><a href="#topic+fmSdDecomp">fmSdDecomp</a></code> for factor model SD decomposition.
<code><a href="#topic+fmVaRDecomp">fmVaRDecomp</a></code> for factor model VaR decomposition.
</p>

<hr>
<h2 id='fmmcSemiParam'>Semi-parametric factor model Monte Carlo</h2><span id='topic+fmmcSemiParam'></span>

<h3>Description</h3>

<p>Simulate asset returns using semi-parametric Monte Carlo, by 
making use of a fitted factor model. Residuals are randomly generated from a 
chosen parametric distribution (Normal, Cornish-Fisher or Skew-t). Factor 
returns are resampled through non-parametric or stationary bootstrap.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fmmcSemiParam(
  B = 1000,
  factor.ret,
  beta,
  alpha,
  resid.par,
  resid.dist = c("normal", "Cornish-Fisher", "skew-t", "empirical"),
  boot.method = c("random", "block"),
  seed = 123
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fmmcSemiParam_+3A_b">B</code></td>
<td>
<p>number of bootstrap samples. Default is 1000.</p>
</td></tr>
<tr><td><code id="fmmcSemiParam_+3A_factor.ret">factor.ret</code></td>
<td>
<p><code>T x K</code> matrix or data.frame of factor returns having
a complete history of data.</p>
</td></tr>
<tr><td><code id="fmmcSemiParam_+3A_beta">beta</code></td>
<td>
<p><code>N x K</code> matrix of factor betas.</p>
</td></tr>
<tr><td><code id="fmmcSemiParam_+3A_alpha">alpha</code></td>
<td>
<p><code>N x 1</code> matrix of factor alphas (intercepts). If missing, 
these are assumed to be 0 for all funds.</p>
</td></tr>
<tr><td><code id="fmmcSemiParam_+3A_resid.par">resid.par</code></td>
<td>
<p>matrix of parameters for the residual 
distribution. See <code>Details</code>.</p>
</td></tr>
<tr><td><code id="fmmcSemiParam_+3A_resid.dist">resid.dist</code></td>
<td>
<p>the residual distribution; one of &quot;normal&quot;, 
&quot;Cornish-Fisher&quot; or &quot;skew-t&quot;. Default is &quot;normal&quot;.</p>
</td></tr>
<tr><td><code id="fmmcSemiParam_+3A_boot.method">boot.method</code></td>
<td>
<p>the resampling method for factor returns; one of &quot;random&quot;
or &quot;block&quot;.</p>
</td></tr>
<tr><td><code id="fmmcSemiParam_+3A_seed">seed</code></td>
<td>
<p>integer to set random number generator state before resampling 
factor returns.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Refer to Yindeng Jiang's PhD thesis referenced below for motivation
and empirical results. An abstract can be found at 
&lt;http://gradworks.umi.com/33/77/3377280.html&gt;.
</p>
<p><code>T</code> is the no. of observations, <code>K</code> is the no. of factors, <code>N</code> 
is the no. of assets or funds, <code>P</code> is the no. of parameters for the 
residual distribution and <code>B</code> is the no. of bootstrap samples.
</p>
<p>The columns in <code>resid.par</code> depend on the choice of <code>resid.dist</code>. 
If <code>resid.dist = "normal"</code>, <code>resid.par</code> has one column for 
standard deviation. If <code>resid.dist = "Cornish-Fisher"</code>, <code>resid.par</code> 
has three columns for sigma=standard deviation, skew=skewness and ekurt=
excess kurtosis. If <code>resid.dist = "skew-t"</code>, <code>resid.par</code> has four 
columns for xi=location, omega=scale, alpha=shape, and nu=degrees of freedom. 
Cornish-Fisher distribution is based on the Cornish-Fisher expansion of the 
Normal quantile. If <code>resid.dist = "empirical"</code>, <code>resid.par</code> should be the TxN residuals
retunred by the ffm object. Skew-t is the skewed Student's t-distribution&ndash; Azzalini and 
Captiano. The parameters can differ across funds, though the type of 
distribution is the same. 
</p>
<p>Bootstrap method: &quot;random&quot; corresponds to random sampling with replacement, 
and &quot;block&quot; corresponds to stationary block bootstrap&ndash; Politis and Romano 
(1994).
</p>


<h3>Value</h3>

<p>A list containing the following components:
</p>
<table>
<tr><td><code>sim.fund.ret</code></td>
<td>
<p><code>B x N</code> matrix of simulated fund returns.</p>
</td></tr>
<tr><td><code>boot.factor.ret</code></td>
<td>
<p><code>B x K</code> matrix of resampled factor returns.</p>
</td></tr>
<tr><td><code>sim.residuals</code></td>
<td>
<p><code>B x N</code> matrix of simulated residuals.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Eric Zivot, Yi-An Chen, Sangeetha Srinivasan.
</p>


<h3>References</h3>

<p>Jiang, Y. (2009). Factor model Monte Carlo methods for general 
fund-of-funds portfolio management. University of Washington.
</p>


<h3>See Also</h3>

<p>http://gradworks.umi.com/33/77/3377280.html
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
#Empirical deistribution 
data("factorDataSetDjia5Yrs")
exposure.vars &lt;- 
fit.ffm &lt;- fitFfm(data = factorDataSetDjia5Yrs, 
                  asset.var = "TICKER",
                   ret.var = "RETURN", 
                   date.var = "DATE", 
                   exposure.vars = c("P2B", "MKTCAP", "SECTOR"), 
                   addIntercept = FALSE)
                   
resid.par &lt;- fit.ffm$residuals
fmmc.returns.ffm &lt;- fmmcSemiParam(factor.ret = fit.ffm$factor.returns,
                                   beta = fit.ffm$beta, 
                                   resid.par = resid.par,
                                   resid.dist = "empirical", 
                                   boot.method = "block")

## End(Not run)
</code></pre>

<hr>
<h2 id='fmRsq'>Factor Model R-Squared and Adj R-Squared Values</h2><span id='topic+fmRsq'></span>

<h3>Description</h3>

<p>Calcluate and plot the Factor Model R-Squared, Adjusted R-Squared for a portfolio of assets
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fmRsq(
  ffmObj,
  rsq = TRUE,
  rsqAdj = FALSE,
  plt.type = 2,
  digits = 2,
  isPrint = TRUE,
  isPlot = TRUE,
  lwd = 2,
  stripText.cex = 1,
  axis.cex = 1,
  title = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fmRsq_+3A_ffmobj">ffmObj</code></td>
<td>
<p>an object of class <code>ffm</code> produced by <code>fitFfm</code></p>
</td></tr>
<tr><td><code id="fmRsq_+3A_rsq">rsq</code></td>
<td>
<p>logical; if <code>TRUE</code>, Factor Model R-squared values are computed for the portfolio. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="fmRsq_+3A_rsqadj">rsqAdj</code></td>
<td>
<p>logical; if <code>TRUE</code>, Adjusted R-squared values are computed for the portfolio. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="fmRsq_+3A_plt.type">plt.type</code></td>
<td>
<p>a number to indicate the type of plot for plotting Factor Model R-squared/Adj. R-squared values.
1 indicates barplot, 2 indicates time series xy plot. Default is 2.</p>
</td></tr>
<tr><td><code id="fmRsq_+3A_digits">digits</code></td>
<td>
<p>an integer indicating the number of decimal places to be used for rounding. Default is 2.</p>
</td></tr>
<tr><td><code id="fmRsq_+3A_isprint">isPrint</code></td>
<td>
<p>logical. if <code>TRUE</code>, the time series of the computed factor model values is printed along with their mean values.
Else, only the mean values are printed. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="fmRsq_+3A_isplot">isPlot</code></td>
<td>
<p>logical. if <code>TRUE</code>, the time series of the output is plotted. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="fmRsq_+3A_lwd">lwd</code></td>
<td>
<p>line width relative to the default. Default is 2.</p>
</td></tr>
<tr><td><code id="fmRsq_+3A_striptext.cex">stripText.cex</code></td>
<td>
<p>a number indicating the amount by which strip text in the plot(s) should be scaled relative to the default. 1=default, 1.5 is 50% larger, 0.5 is 50% smaller, etc.</p>
</td></tr>
<tr><td><code id="fmRsq_+3A_axis.cex">axis.cex</code></td>
<td>
<p>a number indicating the amount by which axis in the plot(s) should be scaled relative to the default. 1=default, 1.5 is 50% larger, 0.5 is 50% smaller, etc.</p>
</td></tr>
<tr><td><code id="fmRsq_+3A_title">title</code></td>
<td>
<p>logical. if <code>TRUE</code>, the plots will have the main tiltle. default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="fmRsq_+3A_...">...</code></td>
<td>
<p>potentially further arguments passed.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>fmRsq</code> returns the sample mean values and plots the time series of corresponding R squared values
and the Variance Inflation factors depending on the values of <code>rsq</code>, <code>rsqAdj</code> and <code>VIF</code>.
The time series of the output values are also printed if <code>isPrint</code> is <code>TRUE</code>
</p>


<h3>Author(s)</h3>

<p>Avinash Acharya and Doug Martin
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#Load the data
# Fundamental Factor Model
library(PCRA)

dateRange &lt;- c("2006-01-31","2010-12-31")
stockItems &lt;-  c("Date", "TickerLast",  "Return","Sector")
factorItems &lt;- c("BP","Beta60M","PM12M1M")
facDatIT &lt;- selectCRSPandSPGMI("monthly",
                               dateRange = dateRange, 
                               stockItems = stockItems, 
                               factorItems = factorItems, 
                               outputType = "data.table")
asset.var="TickerLast" 
ret.var="Return" 
date.var = "Date"
exposure.vars= factorItems
asset.var="TickerLast" 
ret.var="Return" 
date.var = "Date"
spec1 &lt;- specFfm(data = facDatIT,asset.var = asset.var, ret.var = ret.var, 
                date.var = date.var, exposure.vars = exposure.vars,weight.var = NULL,
                 addIntercept = TRUE, rob.stats = FALSE)
# fit a fundamental factor model
mdlFit &lt;- fitFfmDT(spec1)
mdlRes &lt;- extractRegressionStats(spec1,mdlFit)
fit.cross &lt;- convert(SpecObj = spec1,FitObj = mdlFit, RegStatsObj = mdlRes)
#Calculate and plot the portfolio R-squared values
fmRsq(fit.cross)

#Plot and print the time series of Adj R-squared and VIF values
fmRsq(fit.cross, rsqAdj=TRUE, isPrint=TRUE, plt.type = 2)



</code></pre>

<hr>
<h2 id='fmSdDecomp'>Decompose standard deviation into individual factor contributions</h2><span id='topic+fmSdDecomp'></span><span id='topic+fmSdDecomp.ffm'></span>

<h3>Description</h3>

<p>Compute the factor contributions to standard deviation (SD) of 
assets' returns based on Euler's theorem, given the fitted factor model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fmSdDecomp(object, factor.cov, ...)

## S3 method for class 'ffm'
fmSdDecomp(object, factor.cov, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fmSdDecomp_+3A_object">object</code></td>
<td>
<p>fit object of class <code>tsfm</code> or <code>ffm</code>.</p>
</td></tr>
<tr><td><code id="fmSdDecomp_+3A_factor.cov">factor.cov</code></td>
<td>
<p>optional user specified factor covariance matrix with 
named columns; defaults to the sample covariance matrix.</p>
</td></tr>
<tr><td><code id="fmSdDecomp_+3A_...">...</code></td>
<td>
<p>optional arguments passed to <code><a href="stats.html#topic+cov">cov</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The factor model for an asset's return at time <code>t</code> has the 
form <br /> <br /> <code>R(t) = beta'f(t) + e(t) = beta.star'f.star(t)</code> <br /> <br /> 
where, <code>beta.star=(beta,sig.e)</code> and <code>f.star(t)=[f(t)',z(t)]'</code>. 
<br /> <br /> By Euler's theorem, the standard deviation of the asset's return 
is given as: <br /> <br /> 
<code>Sd.fm = sum(cSd_k) = sum(beta.star_k*mSd_k)</code> <br /> <br /> 
where, summation is across the <code>K</code> factors and the residual, 
<code>cSd</code> and <code>mSd</code> are the component and marginal 
contributions to <code>SD</code> respectively. Computing <code>Sd.fm</code> and 
<code>mSd</code> is very straight forward. The formulas are given below and 
details are in the references. The covariance term is approximated by the 
sample covariance. <br /> <br />
<code>Sd.fm = sqrt(beta.star''cov(F.star)beta.star)</code> <br /> 
<code>mSd = cov(F.star)beta.star / Sd.fm</code>
</p>


<h3>Value</h3>

<p>A list containing 
</p>
<table>
<tr><td><code>Sd.fm</code></td>
<td>
<p>length-N vector of factor model SDs of N-asset returns.</p>
</td></tr>
<tr><td><code>mSd</code></td>
<td>
<p>N x (K+1) matrix of marginal contributions to SD.</p>
</td></tr>
<tr><td><code>cSd</code></td>
<td>
<p>N x (K+1) matrix of component contributions to SD.</p>
</td></tr>
<tr><td><code>pcSd</code></td>
<td>
<p>N x (K+1) matrix of percentage component contributions to SD.</p>
</td></tr>
</table>
<p>Where, <code>K</code> is the number of factors and N is the number of assets.
</p>


<h3>Author(s)</h3>

<p>Eric Zivot, Yi-An Chen and Sangeetha Srinivasan
</p>


<h3>References</h3>

<p>Hallerback (2003). Decomposing Portfolio Value-at-Risk: A General Analysis. 
The Journal of Risk, 5(2), 1-18.
</p>
<p>Meucci, A. (2007). Risk contributions from generic user-defined factors. 
RISK-LONDON-RISK MAGAZINE LIMITED-, 20(6), 84. 
</p>
<p>Yamai, Y., &amp; Yoshiba, T. (2002). Comparative analyses of expected shortfall 
and value-at-risk: their estimation error, decomposition, and optimization. 
Monetary and economic studies, 20(1), 87-121.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitFfm">fitFfm</a></code>
for the different factor model fitting functions.
</p>
<p><code><a href="#topic+fmCov">fmCov</a></code> for factor model covariance.
<code><a href="#topic+fmVaRDecomp">fmVaRDecomp</a></code> for factor model VaR decomposition.
<code><a href="#topic+fmEsDecomp">fmEsDecomp</a></code> for factor model ES decomposition.
</p>

<hr>
<h2 id='fmTstats'>fmTstats.ffm t-stats and plots for a fitted Fundamental Factor Model object</h2><span id='topic+fmTstats'></span>

<h3>Description</h3>

<p>Calculate and plot the time series of t-statistic values and the
number of risk indices with significant t-stats for a fundamental factor 
model of class <code>ffm</code> produced by <code>fitFfm</code> or <code>fitFfmDT</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fmTstats(
  ffmObj,
  isPlot = TRUE,
  isPrint = FALSE,
  whichPlot = "tStats",
  color = c("black", "cyan"),
  lwd = 2,
  digits = 2,
  z.alpha = 1.96,
  layout = c(2, 3),
  type = "h",
  scale = "free",
  stripText.cex = 1,
  axis.cex = 1,
  title = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fmTstats_+3A_ffmobj">ffmObj</code></td>
<td>
<p>an object of class <code>ffm</code> produced by <code>fitFfm</code></p>
</td></tr>
<tr><td><code id="fmTstats_+3A_isplot">isPlot</code></td>
<td>
<p>logical. If <code>FALSE</code> no plots are displayed.</p>
</td></tr>
<tr><td><code id="fmTstats_+3A_isprint">isPrint</code></td>
<td>
<p>logical. if <code>TRUE</code>, the time series of the computed 
factor model values is printed. Default is <code>FALSE</code></p>
</td></tr>
<tr><td><code id="fmTstats_+3A_whichplot">whichPlot</code></td>
<td>
<p>string indicating the plot(s) to be plotted. Choose from 
(&quot;all&quot;, &quot;tStats&quot;, &quot;significantTstatsV&quot;, &quot;significantTstatsH&quot;, &quot;significantTstatsLikert&quot;).
Three variants of significantTstats stand for vertical, horizontal and likert barplots. 
Default is <code>tStats</code> plotting t-stats and significant t-stats with vertical bars.</p>
</td></tr>
<tr><td><code id="fmTstats_+3A_color">color</code></td>
<td>
<p>length 2 vector specifying the plotting color for t-stats plot 
and for barplot respectively. default is <code>c("black", "cyan")</code></p>
</td></tr>
<tr><td><code id="fmTstats_+3A_lwd">lwd</code></td>
<td>
<p>line width relative to the default. default is 2.</p>
</td></tr>
<tr><td><code id="fmTstats_+3A_digits">digits</code></td>
<td>
<p>an integer indicating the number of decimal places to be used 
for rounding. default is 2.</p>
</td></tr>
<tr><td><code id="fmTstats_+3A_z.alpha">z.alpha</code></td>
<td>
<p>critical value corresponding to the confidence interval. 
Default is 1.96 i.e 95% C.I</p>
</td></tr>
<tr><td><code id="fmTstats_+3A_layout">layout</code></td>
<td>
<p>numeric vector of length 2 or 3 giving the number of columns, 
rows, and pages (optional) in the xyplot of t-statistics. default is c(2,3).</p>
</td></tr>
<tr><td><code id="fmTstats_+3A_type">type</code></td>
<td>
<p>type character. Type of the xyplot of t-statistics; <code>"l"</code> 
for lines, <code>"p"</code> for points, <code>"h"</code> for histogram like (or high-density) 
vertical lines and <code>"b"</code> for both. Default is <code>"h"</code>.</p>
</td></tr>
<tr><td><code id="fmTstats_+3A_scale">scale</code></td>
<td>
<p>character. It determines how axis limits are calculated for each 
panel. Possible values are &quot;same&quot; , &quot;free&quot; (default) and &quot;sliced&quot;.</p>
</td></tr>
<tr><td><code id="fmTstats_+3A_striptext.cex">stripText.cex</code></td>
<td>
<p>a number indicating the amount by which strip text in 
the plot(s) should be scaled relative to the default. 1=default, 1.5 is 50% 
larger, 0.5 is 50% smaller, etc.</p>
</td></tr>
<tr><td><code id="fmTstats_+3A_axis.cex">axis.cex</code></td>
<td>
<p>a number indicating the amount by which axis in the plot(s) 
should be scaled relative to the default. Default = 1. 1.5 is 50% larger, 
0.5 is 50% smaller, etc.</p>
</td></tr>
<tr><td><code id="fmTstats_+3A_title">title</code></td>
<td>
<p>logical. if <code>TRUE</code>, the plots will have the main title. 
Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="fmTstats_+3A_...">...</code></td>
<td>
<p>potentially further arguments passed.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>fmTstats</code> plots the t-stats and significant t-stats values  
if <code>isPlot</code> is <code>TRUE</code> and returns a list with following components:
</p>
<table>
<tr><td><code>tstats</code></td>
<td>
<p> an xts object of t-stats values.</p>
</td></tr>
<tr><td><code>z.alpha</code></td>
<td>
<p> critical value corresponding to the confidence interval.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Avinash Acharya and Doug Martin
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(PCRA)
# load data 
data(stocksCRSP)
data(factorsSPGMI)
dateRange &lt;- c("2006-01-31","2010-12-31")
stockItems &lt;-  c("Date", "TickerLast", "CapGroupLast", "Return",
                "Ret13WkBill","MktIndexCRSP","Sector")
                factorItems &lt;- c("BP","Beta60M","PM12M1M")
stocks_factors &lt;- selectCRSPandSPGMI("monthly", dateRange = dateRange, 
stockItems = stockItems, factorItems = factorItems, outputType ="data.table")
                                    

# fit a fundamental factor model with style variables BP and LogMktCap

fundamental_model &lt;- fitFfm(data = stocks_factors, 
                           asset.var = "TickerLast", 
                           ret.var = "Return", 
                           date.var = "Date", 
                           exposure.vars = c("BP", "PM12M1M")
                           )

#Compute time series of t-stats and number of significant t-stats 
 stats = fmTstats(fundamental_model, isPlot = TRUE, lwd = 2, color = c("blue", "blue"), 
                  z.alpha = 1.96)
               
# Fit a SECTOR+COUNTRY+Style model with Intercept
# Create a COUNTRY column with just 3 countries
#
#  factorDataSetDjia5Yrs$COUNTRY = rep(rep(c(rep("US", 1 ), rep("GERMANY", 1 )), 11), 60)
# 
#  fit.MICM &lt;- fitFfm(data = factorDataSetDjia5Yrs, 
#                    asset.var = "TICKER",
#                    exposure.vars = c("SECTOR", "COUNTRY","P2B", "MKTCAP"),
#                    ret.var = "RETURN", 
#                    date.var = "DATE", 
#                    addIntercept = FALSE)
#  
 # Load library 'HH' to access the Likert option
#  library("HH")                   
#  stats = fmTstats(fit.MICM, isPlot = TRUE, z.alpha =1.96,
#                   whichPlot = "significantTstatsLikert")

</code></pre>

<hr>
<h2 id='fmVaRDecomp'>Decompose VaR into individual factor contributions</h2><span id='topic+fmVaRDecomp'></span><span id='topic+fmVaRDecomp.ffm'></span>

<h3>Description</h3>

<p>Compute the factor contributions to Value-at-Risk (VaR) of 
assets' returns based on Euler's theorem, given the fitted factor model. 
The partial derivative of VaR w.r.t. factor beta is computed as the expected 
factor return given fund return is equal to its VaR and approximated by a
kernel estimator. Option to choose between non-parametric and Normal.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fmVaRDecomp(object, ...)

## S3 method for class 'ffm'
fmVaRDecomp(
  object,
  factor.cov,
  p = 0.05,
  type = c("np", "normal"),
  use = "pairwise.complete.obs",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fmVaRDecomp_+3A_object">object</code></td>
<td>
<p>fit object of class <code>tsfm</code>, <code>sfm</code> or <code>ffm</code>.</p>
</td></tr>
<tr><td><code id="fmVaRDecomp_+3A_...">...</code></td>
<td>
<p>other optional arguments passed to <code><a href="stats.html#topic+quantile">quantile</a></code>.</p>
</td></tr>
<tr><td><code id="fmVaRDecomp_+3A_factor.cov">factor.cov</code></td>
<td>
<p>optional user specified factor covariance matrix with 
named columns; defaults to the sample covariance matrix.</p>
</td></tr>
<tr><td><code id="fmVaRDecomp_+3A_p">p</code></td>
<td>
<p>tail probability for calculation. Default is 0.05.</p>
</td></tr>
<tr><td><code id="fmVaRDecomp_+3A_type">type</code></td>
<td>
<p>one of &quot;np&quot; (non-parametric) or &quot;normal&quot; for calculating VaR. 
Default is &quot;np&quot;.</p>
</td></tr>
<tr><td><code id="fmVaRDecomp_+3A_use">use</code></td>
<td>
<p>method for computing covariances in the presence of missing 
values; one of &quot;everything&quot;, &quot;all.obs&quot;, &quot;complete.obs&quot;, &quot;na.or.complete&quot;, or 
&quot;pairwise.complete.obs&quot;. Default is &quot;pairwise.complete.obs&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The factor model for an asset's return at time <code>t</code> has the 
form <br /> <br /> <code>R(t) = beta'f(t) + e(t) = beta.star'f.star(t)</code> <br /> <br /> 
where, <code>beta.star=(beta,sig.e)</code> and <code>f.star(t)=[f(t)',z(t)]'</code>. By 
Euler's theorem, the VaR of the asset's return is given by: 
<br /> <br /> <code>VaR.fm = sum(cVaR_k) = sum(beta.star_k*mVaR_k)</code> <br /> <br /> 
where, summation is across the <code>K</code> factors and the residual, 
<code>cVaR</code> and <code>mVaR</code> are the component and marginal 
contributions to <code>VaR</code> respectively. The marginal contribution to VaR 
is defined as the expectation of <code>F.star</code>, conditional on the loss 
being equal to <code>VaR.fm</code>. This is approximated as described in 
Epperlein &amp; Smillie (2006); a triangular smoothing kernel is used here. 
</p>
<p>Refer to Eric Zivot's slides (referenced) for formulas pertaining to the 
calculation of Normal VaR (adapted from a portfolio context to factor models)
</p>


<h3>Value</h3>

<p>A list containing 
</p>
<table>
<tr><td><code>VaR.fm</code></td>
<td>
<p>length-N vector of factor model VaRs of N-asset returns.</p>
</td></tr>
<tr><td><code>n.exceed</code></td>
<td>
<p>length-N vector of number of observations beyond VaR for 
each asset.</p>
</td></tr>
<tr><td><code>idx.exceed</code></td>
<td>
<p>list of numeric vector of index values of exceedances.</p>
</td></tr>
<tr><td><code>mVaR</code></td>
<td>
<p>N x (K+1) matrix of marginal contributions to VaR.</p>
</td></tr>
<tr><td><code>cVaR</code></td>
<td>
<p>N x (K+1) matrix of component contributions to VaR.</p>
</td></tr>
<tr><td><code>pcVaR</code></td>
<td>
<p>N x (K+1) matrix of percentage component contributions to VaR.</p>
</td></tr>
</table>
<p>Where, <code>K</code> is the number of factors and N is the number of assets.
</p>


<h3>Author(s)</h3>

<p>Eric Zivot, Yi-An Chen and Sangeetha Srinivasan
</p>


<h3>References</h3>

<p>Hallerback (2003). Decomposing Portfolio Value-at-Risk: A General Analysis. 
The Journal of Risk, 5(2), 1-18.
</p>
<p>Meucci, A. (2007). Risk contributions from generic user-defined factors. 
RISK-LONDON-RISK MAGAZINE LIMITED-, 20(6), 84. 
</p>
<p>Yamai, Y., &amp; Yoshiba, T. (2002). Comparative analyses of expected shortfall 
and value-at-risk: their estimation error, decomposition, and optimization. 
Monetary and economic studies, 20(1), 87-121.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitFfm">fitFfm</a></code>
for the different factor model fitting functions.
</p>
<p><code><a href="#topic+fmSdDecomp">fmSdDecomp</a></code> for factor model SD decomposition.
<code><a href="#topic+fmEsDecomp">fmEsDecomp</a></code> for factor model ES decomposition.
</p>

<hr>
<h2 id='lagExposures'>lagExposures allows the user to lag exposures by one time period</h2><span id='topic+lagExposures'></span>

<h3>Description</h3>

<p>Function lag the style exposures in the exposure matrix
by one time period.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>lagExposures(specObj)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="lagExposures_+3A_specobj">specObj</code></td>
<td>
<p>an ffm specification object of of class <code>"ffmSpec"</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>this function operates on the data inside the specObj and applies a lag to 
it
</p>


<h3>Value</h3>

<p>specObj an ffm spec Object that has been lagged
</p>


<h3>See Also</h3>

<p><code><a href="#topic+specFfm">specFfm</a></code> for information on the definition of the specFfm object.
</p>

<hr>
<h2 id='plot.ffm'>Plots from a fitted fundamental factor model</h2><span id='topic+plot.ffm'></span>

<h3>Description</h3>

<p>Generic <code>plot</code> method for object of class <code>ffm</code>.
Plots chosen characteristic(s) for one or more assets.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ffm'
plot(
  x,
  which = NULL,
  f.sub = 1:2,
  a.sub = 1:6,
  plot.single = FALSE,
  asset.name,
  asset.variable,
  colorset = c("royalblue", "dimgray", "olivedrab", "firebrick", "goldenrod",
    "mediumorchid", "deepskyblue", "chocolate", "darkslategray"),
  legend.loc = "topleft",
  las = 1,
  lwd = 2,
  maxlag = 15,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.ffm_+3A_x">x</code></td>
<td>
<p>an object of class <code>ffm</code> produced by <code>fitFfm</code>.</p>
</td></tr>
<tr><td><code id="plot.ffm_+3A_which">which</code></td>
<td>
<p>a number to indicate the type of plot. If multiple plots are
required, specify a subset from 1:12 for group plots and 1:13 for individual
plots. If <code>which=NULL</code> (default), the following menu appears: <br /> <br />
For plots of a group of assets: <br />
1 = Distribution of factor returns, <br />
2 = Factor exposures from the last period, <br />
3 = Actual and Fitted asset returns, <br />
4 = Time-series of R-squared values, <br />
5 = Residual variance across assets, x <br />
6 = Scatterplot matrix of residuals, with histograms, density overlays, correlations and significance stars, <br />
7 = Factor Model Residual Correlation <br />
8 = Factor Model Return Correlation,<br />
9 = Factor Contribution to SD,<br />
10 = Factor Contribution to ES,<br />
11 = Factor Contribution to VaR, <br />
12 = Time series of factor returns, <br /> <br />
For individual asset plots:<br />
1 = Actual and fitted,<br />
2 = Actual vs. fitted,<br />
3 = Residuals vs. fitted, <br />
4 = Residuals with standard error bands, <br />
5 = Time series of squared residuals, <br />
6 = Time series of absolute residuals,<br />
7 = SACF and PACF of residuals,<br />
8 = SACF and PACF of squared residuals,<br />
9 = SACF and PACF of absolute residuals,<br />
10 = Non-parametric density of residuals with normal overlaid, <br />
11 = Non-parametric density of residuals with skew-t overlaid, <br />
12 = Histogram of residuals with non-parametric density and normal overlaid,<br />
13 = QQ-plot of residuals</p>
</td></tr>
<tr><td><code id="plot.ffm_+3A_f.sub">f.sub</code></td>
<td>
<p>numeric/character vector; subset of indexes/names of factors to
include for group plots. Default is 1:2.</p>
</td></tr>
<tr><td><code id="plot.ffm_+3A_a.sub">a.sub</code></td>
<td>
<p>numeric/character vector; subset of indexes/names of assets to
include for group plots. At least 2 assets must be selected. Default is 1:6.</p>
</td></tr>
<tr><td><code id="plot.ffm_+3A_plot.single">plot.single</code></td>
<td>
<p>logical; If <code>TRUE</code> plots the characteristics of an
individual asset's factor model. The type of plot is given by
<code>which</code>. Default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="plot.ffm_+3A_asset.name">asset.name</code></td>
<td>
<p>name of the individual asset to be plotted. Is necessary
if <code>x</code> contains multiple asset fits and <code>plot.single=TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot.ffm_+3A_asset.variable">asset.variable</code></td>
<td>
<p>the name of asset variable.</p>
</td></tr>
<tr><td><code id="plot.ffm_+3A_colorset">colorset</code></td>
<td>
<p>color palette to use for all the plots. The 1st element will
be used for individual time series plots or the 1st object plotted, the 2nd
element for the 2nd object in the plot and so on.</p>
</td></tr>
<tr><td><code id="plot.ffm_+3A_legend.loc">legend.loc</code></td>
<td>
<p>places a legend into one of nine locations on the chart:
&quot;bottomright&quot;, &quot;bottom&quot;, &quot;bottomleft&quot;, &quot;left&quot;, &quot;topleft&quot;, &quot;top&quot;, &quot;topright&quot;,
&quot;right&quot;, or &quot;center&quot;. Default is &quot;bottomright&quot;. Use <code>legend.loc=NULL</code>
to suppress the legend.</p>
</td></tr>
<tr><td><code id="plot.ffm_+3A_las">las</code></td>
<td>
<p>one of 0, 1, 2, 3 to set the direction of axis labels, same as
in <code>plot</code>. Default is 1.</p>
</td></tr>
<tr><td><code id="plot.ffm_+3A_lwd">lwd</code></td>
<td>
<p>set the line width, same as in <code><a href="graphics.html#topic+plot">plot</a></code>. Default is 2.</p>
</td></tr>
<tr><td><code id="plot.ffm_+3A_maxlag">maxlag</code></td>
<td>
<p>optional number of lags to be calculated for ACF. Default is 15.</p>
</td></tr>
<tr><td><code id="plot.ffm_+3A_...">...</code></td>
<td>
<p>further arguments to be passed to other plotting functions.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function can be used for group plots and individual plots. User can
select the type of plot either from the menu prompt (default) or directly
via argument <code>which</code>.
</p>
<p>In case multiple plots are needed, the menu is repeated after each plot
(enter 0 to exit). User can also input a numeric vector of plot options via
<code>which</code>.
</p>
<p>Group plots are the default. The selected assets in <code>a.sub</code> and
selected factors in <code>f.sub</code> are plotted depending on the
characteristic chosen. The default is to show the first 2 factors and first
6 assets.
</p>
<p>Setting <code>plot.single=TRUE</code> enables individual plots. If there is more
than one asset fit by <code>x</code>, <code>asset.name</code> should be specified.
In case the <code>ffm</code> object <code>x</code> contains only a single asset fit,
plot.ffm can infer <code>asset.name</code> without user input.
</p>


<h3>Value</h3>

<p>Does not return a value, used for plotting
</p>


<h3>Author(s)</h3>

<p>Eric Zivot, Sangeetha Srinivasan and Yi-An Chen
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitFfm">fitFfm</a></code>, <code><a href="#topic+residuals.ffm">residuals.ffm</a></code>,
<code><a href="#topic+fitted.ffm">fitted.ffm</a></code>, <code><a href="#topic+fmCov.ffm">fmCov.ffm</a></code> and
<code><a href="#topic+summary.ffm">summary.ffm</a></code> for time series factor model fitting and related
S3 methods. Refer to <code><a href="#topic+fmSdDecomp">fmSdDecomp</a></code>, <code><a href="#topic+fmEsDecomp">fmEsDecomp</a></code>,
<code><a href="#topic+fmVaRDecomp">fmVaRDecomp</a></code> for factor model risk measures.
</p>
<p>Here is a list of plotting functions used. (I=individual, G=Group)
I(1,5,6,7), G(3,4,12) - <code><a href="PerformanceAnalytics.html#topic+chart.TimeSeries">chart.TimeSeries</a></code>,
I(2,3,4,19), G(12) - <code><a href="graphics.html#topic+plot.default">plot.default</a></code>,
I(3,4) - <code><a href="graphics.html#topic+panel.smooth">panel.smooth</a></code>,
I(8,9,10) - <code><a href="PerformanceAnalytics.html#topic+chart.ACFplus">chart.ACFplus</a></code>,
I(11,12) - <code><a href="stats.html#topic+plot.density">plot.density</a></code>,
I(13) - <code><a href="PerformanceAnalytics.html#topic+chart.Histogram">chart.Histogram</a></code>,
I(14) - <code><a href="PerformanceAnalytics.html#topic+chart.QQPlot">chart.QQPlot</a></code>,
I(15,16,17) - <code><a href="strucchange.html#topic+plot.efp">plot.efp</a></code> (requires strucchange package),
I(18) - <code><a href="zoo.html#topic+plot.zoo">plot.zoo</a></code>,
G(1) - <code><a href="PerformanceAnalytics.html#topic+chart.Boxplot">chart.Boxplot</a></code>,
G(2,5,9,10,11) - <code><a href="lattice.html#topic+barchart">barchart</a></code>,
G(6) - <code><a href="PerformanceAnalytics.html#topic+chart.Correlation">chart.Correlation</a></code> and
G(7,8) - <code><a href="corrplot.html#topic+corrplot.mixed">corrplot.mixed</a></code> (requires corrplot package).
</p>

<hr>
<h2 id='portEsDecomp'>Decompose portfolio ES into individual factor contributions</h2><span id='topic+portEsDecomp'></span><span id='topic+portEsDecomp.ffm'></span>

<h3>Description</h3>

<p>Compute the factor contributions to Expected Tail Loss or 
Expected Shortfall (ES) of portfolio returns  based on Euler's theorem, given 
the fitted factor model. The partial derivative of ES with respect to factor 
beta is computed as the expected factor return given portfolio return is less 
than or equal to its value-at-risk (VaR). Option to choose between 
non-parametric and Normal.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>portEsDecomp(object, ...)

## S3 method for class 'ffm'
portEsDecomp(
  object,
  weights = NULL,
  factor.cov,
  p = 0.05,
  type = c("np", "normal"),
  invert = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="portEsDecomp_+3A_object">object</code></td>
<td>
<p>fit object of class  <code>ffm</code>.</p>
</td></tr>
<tr><td><code id="portEsDecomp_+3A_...">...</code></td>
<td>
<p>other optional arguments passed to <code><a href="stats.html#topic+quantile">quantile</a></code> and 
optional arguments passed to <code><a href="stats.html#topic+cov">cov</a></code></p>
</td></tr>
<tr><td><code id="portEsDecomp_+3A_weights">weights</code></td>
<td>
<p>a vector of weights of the assets in the portfolio, names of 
the vector should match with asset names. Default is NULL, in which case an 
equal weights will be used.</p>
</td></tr>
<tr><td><code id="portEsDecomp_+3A_factor.cov">factor.cov</code></td>
<td>
<p>optional user specified factor covariance matrix with 
named columns; defaults to the sample covariance matrix.</p>
</td></tr>
<tr><td><code id="portEsDecomp_+3A_p">p</code></td>
<td>
<p>tail probability for calculation. Default is 0.05.</p>
</td></tr>
<tr><td><code id="portEsDecomp_+3A_type">type</code></td>
<td>
<p>one of &quot;np&quot; (non-parametric) or &quot;normal&quot; for calculating Es. 
Default is &quot;np&quot;.</p>
</td></tr>
<tr><td><code id="portEsDecomp_+3A_invert">invert</code></td>
<td>
<p>a logical variable to choose if change ES to positive number, default
is False</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The factor model for a portfolio's return at time <code>t</code> has the 
form <br /> <br /> <code>R(t) = beta'f(t) + e(t) = beta.star'f.star(t)</code> <br /> <br /> 
where, <code>beta.star=(beta,sig.e)</code> and <code>f.star(t)=[f(t)',z(t)]'</code>. By 
Euler's theorem, the ES of the portfolio's return is given by:
<br /> <br /> <code>ES.fm = sum(cES_k) = sum(beta.star_k*mES_k)</code> <br /> <br />
where, summation is across the <code>K</code> factors and the residual, 
<code>cES</code> and <code>mES</code> are the component and marginal 
contributions to <code>ES</code> respectively. The marginal contribution to ES is
defined as the expected value of <code>F.star</code>, conditional on the loss 
being less than or equal to <code>portVaR</code>. This is estimated as a sample 
average of the observations in that data window.
</p>


<h3>Value</h3>

<p>A list containing 
</p>
<table>
<tr><td><code>portES</code></td>
<td>
<p>factor model ES of portfolio returns.</p>
</td></tr>
<tr><td><code>mES</code></td>
<td>
<p>length-(K + 1) vector of marginal contributions to Es.</p>
</td></tr>
<tr><td><code>cES</code></td>
<td>
<p>length-(K + 1) vector of component contributions to Es.</p>
</td></tr>
<tr><td><code>pcES</code></td>
<td>
<p>length-(K + 1) vector of percentage component contributions to Es.</p>
</td></tr>
</table>
<p>Where, K is the number of factors.
</p>


<h3>Author(s)</h3>

<p>Douglas Martin, Lingjie Yi
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitFfm">fitFfm</a></code>
for the different factor model fitting functions.
</p>
<p><code><a href="#topic+portSdDecomp">portSdDecomp</a></code> for factor model Sd decomposition.
<code><a href="#topic+portVaRDecomp">portVaRDecomp</a></code> for factor model VaR decomposition.
</p>

<hr>
<h2 id='portSdDecomp'>Decompose portfolio standard deviation into individual factor contributions</h2><span id='topic+portSdDecomp'></span><span id='topic+portSdDecomp.ffm'></span>

<h3>Description</h3>

<p>Compute the factor contributions to standard deviation (Sd) of 
portfolio returns based on Euler's theorem, given the fitted factor model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>portSdDecomp(object, ...)

## S3 method for class 'ffm'
portSdDecomp(object, weights = NULL, factor.cov, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="portSdDecomp_+3A_object">object</code></td>
<td>
<p>fit object of class <code>tsfm</code>, or <code>ffm</code>.</p>
</td></tr>
<tr><td><code id="portSdDecomp_+3A_...">...</code></td>
<td>
<p>optional arguments passed to <code><a href="stats.html#topic+cov">cov</a></code>.</p>
</td></tr>
<tr><td><code id="portSdDecomp_+3A_weights">weights</code></td>
<td>
<p>a vector of weights of the assets in the portfolio. Default is NULL, 
in which case an equal weights will be used.</p>
</td></tr>
<tr><td><code id="portSdDecomp_+3A_factor.cov">factor.cov</code></td>
<td>
<p>optional user specified factor covariance matrix with 
named columns; defaults to the sample covariance matrix.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The factor model for a portfolio's return at time <code>t</code> has the 
form <br /> <br /> <code>R(t) = beta'f(t) + e(t) = beta.star'f.star(t)</code> <br /> <br /> 
where, <code>beta.star=(beta,sig.e)</code> and <code>f.star(t)=[f(t)',z(t)]'</code>. 
<br /> <br /> By Euler's theorem, the standard deviation of the portfolio's return 
is given as: <br /> <br /> 
<code>portSd = sum(cSd_k) = sum(beta.star_k*mSd_k)</code> <br /> <br /> 
where, summation is across the <code>K</code> factors and the residual, 
<code>cSd</code> and <code>mSd</code> are the component and marginal 
contributions to <code>Sd</code> respectively. Computing <code>portSd</code> and 
<code>mSd</code> is very straight forward. The formulas are given below and 
details are in the references. The covariance term is approximated by the 
sample covariance. <br /> <br />
<code>portSd = sqrt(beta.star''cov(F.star)beta.star)</code> <br /> 
<code>mSd = cov(F.star)beta.star / portSd</code>
</p>


<h3>Value</h3>

<p>A list containing 
</p>
<table>
<tr><td><code>portSd</code></td>
<td>
<p>factor model Sd of portfolio return.</p>
</td></tr>
<tr><td><code>mSd</code></td>
<td>
<p>length-(K + 1) vector of marginal contributions to Sd.</p>
</td></tr>
<tr><td><code>cSd</code></td>
<td>
<p>length-(K + 1) vector of component contributions to Sd.</p>
</td></tr>
<tr><td><code>pcSd</code></td>
<td>
<p>length-(K + 1) vector of percentage component contributions to Sd.</p>
</td></tr>
</table>
<p>Where, K is the number of factors.
</p>


<h3>Author(s)</h3>

<p>Douglas Martin, Lingjie Yi
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitFfm">fitFfm</a></code>
for the different factor model fitting functions.
</p>
<p><code><a href="#topic+portVaRDecomp">portVaRDecomp</a></code> for portfolio factor model VaR decomposition.
<code><a href="#topic+portEsDecomp">portEsDecomp</a></code> for portfolio factor model ES decomposition.
</p>

<hr>
<h2 id='portVaRDecomp'>Decompose portfolio VaR into individual factor contributions</h2><span id='topic+portVaRDecomp'></span><span id='topic+portVaRDecomp.ffm'></span>

<h3>Description</h3>

<p>Compute the factor contributions to Value-at-Risk (VaR) of 
portfolio returns based on Euler's theorem, given the fitted factor model. 
The partial derivative of VaR w.r.t. factor beta is computed as the expected 
factor return given portfolio return is equal to its VaR and approximated by a
kernel estimator. Option to choose between non-parametric and Normal.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>portVaRDecomp(object, ...)

## S3 method for class 'ffm'
portVaRDecomp(
  object,
  weights = NULL,
  factor.cov,
  p = 0.05,
  type = c("np", "normal"),
  invert = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="portVaRDecomp_+3A_object">object</code></td>
<td>
<p>fit object of class <code>tsfm</code>, or <code>ffm</code>.</p>
</td></tr>
<tr><td><code id="portVaRDecomp_+3A_...">...</code></td>
<td>
<p>other optional arguments passed to <code><a href="stats.html#topic+quantile">quantile</a></code> and 
optional arguments passed to <code><a href="stats.html#topic+cov">cov</a></code></p>
</td></tr>
<tr><td><code id="portVaRDecomp_+3A_weights">weights</code></td>
<td>
<p>a vector of weights of the assets in the portfolio. Default is NULL, 
in which case an equal weights will be used.</p>
</td></tr>
<tr><td><code id="portVaRDecomp_+3A_factor.cov">factor.cov</code></td>
<td>
<p>optional user specified factor covariance matrix with 
named columns; defaults to the sample covariance matrix.</p>
</td></tr>
<tr><td><code id="portVaRDecomp_+3A_p">p</code></td>
<td>
<p>tail probability for calculation. Default is 0.05.</p>
</td></tr>
<tr><td><code id="portVaRDecomp_+3A_type">type</code></td>
<td>
<p>one of &quot;np&quot; (non-parametric) or &quot;normal&quot; for calculating VaR. 
Default is &quot;np&quot;.</p>
</td></tr>
<tr><td><code id="portVaRDecomp_+3A_invert">invert</code></td>
<td>
<p>a logical variable to choose if change VaR to positive number, default
is False</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The factor model for a portfolio's return at time <code>t</code> has the 
form <br /> <br /> <code>R(t) = beta'f(t) + e(t) = beta.star'f.star(t)</code> <br /> <br /> 
where, <code>beta.star=(beta,sig.e)</code> and <code>f.star(t)=[f(t)',z(t)]'</code>. By 
Euler's theorem, the VaR of the asset's return is given by: 
<br /> <br /> <code>VaR.fm = sum(cVaR_k) = sum(beta.star_k*mVaR_k)</code> <br /> <br /> 
where, summation is across the <code>K</code> factors and the residual, 
<code>cVaR</code> and <code>mVaR</code> are the component and marginal 
contributions to <code>VaR</code> respectively. The marginal contribution to VaR 
is defined as the expectation of <code>F.star</code>, conditional on the loss 
being equal to <code>portVaR</code>. This is approximated as described in 
Epperlein &amp; Smillie (2006); a triangular smoothing kernel is used here.
</p>


<h3>Value</h3>

<p>A list containing 
</p>
<table>
<tr><td><code>portVaR</code></td>
<td>
<p>factor model VaR of portfolio return.</p>
</td></tr>
<tr><td><code>n.exceed</code></td>
<td>
<p>number of observations beyond VaR.</p>
</td></tr>
<tr><td><code>idx.exceed</code></td>
<td>
<p>a numeric vector of index values of exceedances.</p>
</td></tr>
<tr><td><code>mVaR</code></td>
<td>
<p>length-(K + 1) vector of marginal contributions to VaR.</p>
</td></tr>
<tr><td><code>cVaR</code></td>
<td>
<p>length-(K + 1) vector of component contributions to VaR.</p>
</td></tr>
<tr><td><code>pcVaR</code></td>
<td>
<p>length-(K + 1) vector of percentage component contributions to VaR.</p>
</td></tr>
</table>
<p>Where, K is the number of factors.
</p>


<h3>Author(s)</h3>

<p>Douglas Martin, Lingjie Yi
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitFfm">fitFfm</a></code>
for the different factor model fitting functions.
</p>
<p><code><a href="#topic+portSdDecomp">portSdDecomp</a></code> for factor model Sd decomposition.
<code><a href="#topic+portEsDecomp">portEsDecomp</a></code> for factor model ES decomposition.
</p>

<hr>
<h2 id='predict.ffm'>Predicts asset returns based on a fitted fundamental factor model</h2><span id='topic+predict.ffm'></span>

<h3>Description</h3>

<p>S3 <code>predict</code> method for object of class <code>ffm</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ffm'
predict(object, newdata = NULL, pred.date = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict.ffm_+3A_object">object</code></td>
<td>
<p>an object of class <code>ffm</code> produced by <code>fitFfm</code>.</p>
</td></tr>
<tr><td><code id="predict.ffm_+3A_newdata">newdata</code></td>
<td>
<p>data.frame containing the variables <code>asset.var</code>, 
<code>date.var</code> and the same exact <code>exposure.vars</code> used in the fitted
<code>ffm</code> object. If omitted, the predictions are based on the data used 
for the fit.</p>
</td></tr>
<tr><td><code id="predict.ffm_+3A_pred.date">pred.date</code></td>
<td>
<p>character; unique date used to base the predictions. Should 
be coercible to class <code>Date</code> and match one of the dates in the data used
in the fiited <code>object</code>.</p>
</td></tr>
<tr><td><code id="predict.ffm_+3A_...">...</code></td>
<td>
<p>optional arguments passed to <code>predict.lm</code> or 
<code><a href="robustbase.html#topic+predict.lmrob">predict.lmrob</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The estimated factor returns and potentially new factor exposures 
are used to predict the asset returns during all dates from the fitted 
<code>ffm</code> object. For predictions based on estimated factor returns from a 
specific period use the <code>pred.date</code> argument.
</p>


<h3>Value</h3>

<p><code>predict.ffm</code> produces a N x T matrix of predicted asset returns, where 
T is the number of time periods and N is the number of assets. T=1 if 
<code>pred.date</code> is specified.
</p>


<h3>Author(s)</h3>

<p>Sangeetha Srinivasan
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitFfm">fitFfm</a></code>, <code><a href="#topic+summary.ffm">summary.ffm</a></code>, 
<code><a href="stats.html#topic+predict.lm">predict.lm</a></code>, <code><a href="robustbase.html#topic+predict.lmrob">predict.lmrob</a></code>
</p>

<hr>
<h2 id='print.ffm'>Prints a fitted fundamental factor model</h2><span id='topic+print.ffm'></span>

<h3>Description</h3>

<p>S3 <code>print</code> method for object of class <code>ffm</code>. Prints 
the call, factor model dimension and summary statistics for the estimated
factor returns, cross-sectional r-squared values and residual variances 
from the fitted object. 
</p>
<p>Refer to <code><a href="#topic+summary.ffm">summary.ffm</a></code> for a more detailed summary of the fit at 
each time period.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ffm'
print(x, digits = max(3, .Options$digits - 3), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.ffm_+3A_x">x</code></td>
<td>
<p>an object of class <code>ffm</code> produced by <code>fitFfm</code>.</p>
</td></tr>
<tr><td><code id="print.ffm_+3A_digits">digits</code></td>
<td>
<p>an integer value, to indicate the required number of 
significant digits. Default is 3.</p>
</td></tr>
<tr><td><code id="print.ffm_+3A_...">...</code></td>
<td>
<p>optional arguments passed to the <code>print</code> method.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns an object of class <code>print.ffm</code>.
</p>


<h3>Author(s)</h3>

<p>Yi-An Chen and Sangeetha Srinivasan
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitFfm">fitFfm</a></code>, <code><a href="#topic+summary.ffm">summary.ffm</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(PCRA)
data(stocksCRSP)
data("factorDataSetDjia5Yrs")
# fit a fundamental factor model
fit.style.sector &lt;- fitFfm(data=factorDataSetDjia5Yrs, 
                           asset.var="TICKER", 
                           ret.var="RETURN", 
                           date.var="DATE", 
                           exposure.vars = c("P2B", "MKTCAP"))
print(fit.style.sector)

## End(Not run)
</code></pre>

<hr>
<h2 id='print.ffmSpec'>print.ffmSpec</h2><span id='topic+print.ffmSpec'></span>

<h3>Description</h3>

<p>print.ffmSpec
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ffmSpec'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.ffmSpec_+3A_x">x</code></td>
<td>
<p>an object of class ffmSpec</p>
</td></tr>
<tr><td><code id="print.ffmSpec_+3A_...">...</code></td>
<td>
<p>any other option</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for displaying attributes
</p>

<hr>
<h2 id='repExposures'>Portfolio Exposures Report</h2><span id='topic+repExposures'></span>

<h3>Description</h3>

<p>Calculate k factor time series based on fundamental factor model. This method takes fundamental factor model fit, 'ffm' object, and portfolio weight as inputs and generates numeric summary and plot visualization.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>repExposures(
  ffmObj,
  weights = NULL,
  isPlot = TRUE,
  isPrint = TRUE,
  scaleType = "free",
  stripText.cex = 1,
  axis.cex = 1,
  stripLeft = TRUE,
  layout = NULL,
  color = "blue",
  notch = FALSE,
  digits = 1,
  titleText = TRUE,
  which = NULL,
  type = "b",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="repExposures_+3A_ffmobj">ffmObj</code></td>
<td>
<p>an object of class ffm returned by fitFfm.</p>
</td></tr>
<tr><td><code id="repExposures_+3A_weights">weights</code></td>
<td>
<p>a vector of weights of the assets in the portfolio. Default is NULL.</p>
</td></tr>
<tr><td><code id="repExposures_+3A_isplot">isPlot</code></td>
<td>
<p>logical variable to generate plot or not.</p>
</td></tr>
<tr><td><code id="repExposures_+3A_isprint">isPrint</code></td>
<td>
<p>logical variable to print numeric summary or not.</p>
</td></tr>
<tr><td><code id="repExposures_+3A_scaletype">scaleType</code></td>
<td>
<p>scaleType controls if use a same scale of y-axis, choose from c('same', 'free')</p>
</td></tr>
<tr><td><code id="repExposures_+3A_striptext.cex">stripText.cex</code></td>
<td>
<p>a number indicating the amount by which strip text in the plot(s) should be scaled relative to the default. 1=default, 1.5 is 50% larger, 0.5 is 50% smaller, etc.</p>
</td></tr>
<tr><td><code id="repExposures_+3A_axis.cex">axis.cex</code></td>
<td>
<p>a number indicating the amount by which axis in the plot(s) should be scaled relative to the default. 1=default, 1.5 is 50% larger, 0.5 is 50% smaller, etc.</p>
</td></tr>
<tr><td><code id="repExposures_+3A_stripleft">stripLeft</code></td>
<td>
<p>logical variable to choose the position of strip, 'TRUE' for drawing strips on the left of each panel, 'FALSE' for drawing strips on the top of each panel. Used only when isPlot = 'TRUE'</p>
</td></tr>
<tr><td><code id="repExposures_+3A_layout">layout</code></td>
<td>
<p>layout is a numeric vector of length 2 or 3 giving the number of columns, rows, and pages (optional) in a multipanel display. Used only when isPlot = 'TRUE'</p>
</td></tr>
<tr><td><code id="repExposures_+3A_color">color</code></td>
<td>
<p>character specifying the plotting color for all the plots</p>
</td></tr>
<tr><td><code id="repExposures_+3A_notch">notch</code></td>
<td>
<p>logical. if notch is <code>TRUE</code>, a notch is drawn in each side of the boxes. If the notches of two plots do not overlap this is strong evidence that the two medians differ (Chambers et al, 1983, p. 62).Default values is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="repExposures_+3A_digits">digits</code></td>
<td>
<p>digits of printout numeric summary. Used only when isPrint = 'TRUE'</p>
</td></tr>
<tr><td><code id="repExposures_+3A_titletext">titleText</code></td>
<td>
<p>logical varible to choose display plot title or not. Default is 'TRUE', and used only when isPlot = 'TRUE'.</p>
</td></tr>
<tr><td><code id="repExposures_+3A_which">which</code></td>
<td>
<p>a number to indicate the type of plot. If a subset of the plots 
is required, specify a subset of the numbers 1:3 for plots. If <code>which=NULL</code> (default), the following menu 
appears: <br /> <br />
For plots of a group of assets: <br />
1 = Time series plot of style factor exposures, <br />
2 = Boxplot of style factor exposures, <br />
3 = Barplot of means and vols of style factor exposures, and means of sector exposures (which have no vol). <br /> <br /></p>
</td></tr>
<tr><td><code id="repExposures_+3A_type">type</code></td>
<td>
<p>character. type of lattice plot when which=1; 'l' denotes a line, 'p' denotes a point, and 'b' and 'o' both denote both together.deafault is 'b'.</p>
</td></tr>
<tr><td><code id="repExposures_+3A_...">...</code></td>
<td>
<p>other graphics parameters available in tsPlotMP(time series plot only) can be passed in through the ellipses</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing mean and standard deviation of all the factors
</p>


<h3>Author(s)</h3>

<p>Douglas Martin, Lingjie Yi, Avinash
</p>

<hr>
<h2 id='repReturn'>Portfolio return decomposition report</h2><span id='topic+repReturn'></span>

<h3>Description</h3>

<p>Decompostite return of portfolio into return of different factors based on fundamental factor model. This method takes fundamental factor model fit, &quot;ffm&quot; object, and portfolio weight as inputs and generates numeric summary and plot visualization.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>repReturn(
  ffmObj,
  weights = NULL,
  isPlot = TRUE,
  isPrint = TRUE,
  layout = NULL,
  scaleType = "free",
  stripLeft = TRUE,
  stripText.cex = 1,
  axis.cex = 1,
  digits = 1,
  titleText = TRUE,
  which = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="repReturn_+3A_ffmobj">ffmObj</code></td>
<td>
<p>an object of class ffm returned by fitFfm.</p>
</td></tr>
<tr><td><code id="repReturn_+3A_weights">weights</code></td>
<td>
<p>a vector of weights of the assets in the portfolio. Default is NULL.</p>
</td></tr>
<tr><td><code id="repReturn_+3A_isplot">isPlot</code></td>
<td>
<p>logical variable to generate plot or not.</p>
</td></tr>
<tr><td><code id="repReturn_+3A_isprint">isPrint</code></td>
<td>
<p>logical variable to print numeric summary or not.</p>
</td></tr>
<tr><td><code id="repReturn_+3A_layout">layout</code></td>
<td>
<p>layout is a numeric vector of length 2 or 3 giving the number of columns, rows, and pages (optional) in a multipanel display.</p>
</td></tr>
<tr><td><code id="repReturn_+3A_scaletype">scaleType</code></td>
<td>
<p>scaleType controls if use a same scale of y-axis, choose from c('same', 'free')</p>
</td></tr>
<tr><td><code id="repReturn_+3A_stripleft">stripLeft</code></td>
<td>
<p>logical variable to choose the position of strip, &quot;TRUE&quot; for drawing strips on the left of each panel, &quot;FALSE&quot; for drawing strips on the top of each panel. Used only when isPlot = 'TRUE'</p>
</td></tr>
<tr><td><code id="repReturn_+3A_striptext.cex">stripText.cex</code></td>
<td>
<p>a number indicating the amount by which strip text in the plot(s) should be scaled relative to the default. 1=default, 1.5 is 50% larger, 0.5 is 50% smaller, etc.</p>
</td></tr>
<tr><td><code id="repReturn_+3A_axis.cex">axis.cex</code></td>
<td>
<p>a number indicating the amount by which axis in the plot(s) should be scaled relative to the default. 1=default, 1.5 is 50% larger, 0.5 is 50% smaller, etc.</p>
</td></tr>
<tr><td><code id="repReturn_+3A_digits">digits</code></td>
<td>
<p>digits of printout numeric summary. Used only when isPrint = 'TRUE'</p>
</td></tr>
<tr><td><code id="repReturn_+3A_titletext">titleText</code></td>
<td>
<p>logical varible to choose display plot title or not. Default is 'TRUE', and used only when isPlot = 'TRUE'.</p>
</td></tr>
<tr><td><code id="repReturn_+3A_which">which</code></td>
<td>
<p>a number to indicate the type of plot. If a subset of the plots 
is required, specify a subset of the numbers 1:4 for plots. If <code>which=NULL</code> (default), the following menu 
appears: <br /> <br />
For plots of a group of assets: <br />
1 = Time Series plot of portfolio returns decomposition, <br />
2 = Time Series plot of portfolio style factors returns, <br />
3 = Time Series plot of portfolio sector returns, <br />
4 = Boxplot of Portfolio Factor Returns Components. <br /> <br /></p>
</td></tr>
<tr><td><code id="repReturn_+3A_...">...</code></td>
<td>
<p>other graphics parameters available in tsPlotMP(time series plot only) can be passed in through the ellipses</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A K x 2 matrix containing mean and standard deviation of K factors
</p>


<h3>Author(s)</h3>

<p>Douglas Martin, Lingjie Yi
</p>


<h3>Examples</h3>

<pre><code class='language-R'>args(repReturn)
</code></pre>

<hr>
<h2 id='repRisk'>Decompose portfolio risk into individual factor contributions and provide tabular report</h2><span id='topic+repRisk'></span><span id='topic+repRisk.ffm'></span>

<h3>Description</h3>

<p>Compute the factor contributions to standard deviation (SD), Value-at-Risk (VaR), 
Expected Tail Loss or Expected Shortfall (ES) of the return of individual asset within a portfolio 
return of a portfolio based on Euler's theorem, given the fitted factor model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>repRisk(object, ...)

## S3 method for class 'ffm'
repRisk(
  object,
  weights = NULL,
  risk = c("Sd", "VaR", "ES"),
  decomp = c("FMCR", "FCR", "FPCR"),
  digits = NULL,
  invert = FALSE,
  nrowPrint = 20,
  p = 0.05,
  type = c("np", "normal"),
  sliceby = c("factor", "asset", "riskType"),
  isPrint = TRUE,
  isPlot = FALSE,
  layout = NULL,
  stripText.cex = 1,
  axis.cex = 1,
  portfolio.only = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="repRisk_+3A_object">object</code></td>
<td>
<p>fit object of class <code>tsfm</code>, or <code>ffm</code>.</p>
</td></tr>
<tr><td><code id="repRisk_+3A_...">...</code></td>
<td>
<p>other optional arguments passed to <code><a href="stats.html#topic+quantile">quantile</a></code> and 
optional arguments passed to <code><a href="stats.html#topic+cov">cov</a></code></p>
</td></tr>
<tr><td><code id="repRisk_+3A_weights">weights</code></td>
<td>
<p>a vector of weights of the assets in the portfolio, names of 
the vector should match with asset names. Default is NULL, in which case an 
equal weights will be used.</p>
</td></tr>
<tr><td><code id="repRisk_+3A_risk">risk</code></td>
<td>
<p>one of 'Sd' (standard deviation), 'VaR' (Value-at-Risk) or 'ES' (Expected Tail 
Loss or Expected Shortfall for calculating risk decompositon. Default is 'Sd'</p>
</td></tr>
<tr><td><code id="repRisk_+3A_decomp">decomp</code></td>
<td>
<p>one of 'FMCR' (factor marginal contribution to risk), 
'FCR' 'factor contribution to risk' or 'FPCR' (factor percent contribution to risk).</p>
</td></tr>
<tr><td><code id="repRisk_+3A_digits">digits</code></td>
<td>
<p>digits of number in the resulting table. Default is NULL, in which case digtis = 3 will be
used for decomp = ( 'FMCR', 'FCR'), digits = 1 will be used for decomp = 'FPCR'. Used only when 
isPrint = 'TRUE'</p>
</td></tr>
<tr><td><code id="repRisk_+3A_invert">invert</code></td>
<td>
<p>a logical variable to change VaR/ES to positive number, default
is False and will return positive values.</p>
</td></tr>
<tr><td><code id="repRisk_+3A_nrowprint">nrowPrint</code></td>
<td>
<p>a numerical value deciding number of assets/portfolio in result vector/table to print
or plot</p>
</td></tr>
<tr><td><code id="repRisk_+3A_p">p</code></td>
<td>
<p>tail probability for calculation. Default is 0.05.</p>
</td></tr>
<tr><td><code id="repRisk_+3A_type">type</code></td>
<td>
<p>one of &quot;np&quot; (non-parametric) or &quot;normal&quot; for calculating VaR &amp; Es. 
Default is &quot;np&quot;.</p>
</td></tr>
<tr><td><code id="repRisk_+3A_sliceby">sliceby</code></td>
<td>
<p>one of 'factor' (slice/condition by factor) or 'asset' (slice/condition by asset) or 'riskType'
Used only when isPlot = 'TRUE'</p>
</td></tr>
<tr><td><code id="repRisk_+3A_isprint">isPrint</code></td>
<td>
<p>logical variable to print numeric output or not.</p>
</td></tr>
<tr><td><code id="repRisk_+3A_isplot">isPlot</code></td>
<td>
<p>logical variable to generate plot or not.</p>
</td></tr>
<tr><td><code id="repRisk_+3A_layout">layout</code></td>
<td>
<p>layout is a numeric vector of length 2 or 3 giving the number of columns, rows, and pages (optional) in a multipanel display.</p>
</td></tr>
<tr><td><code id="repRisk_+3A_striptext.cex">stripText.cex</code></td>
<td>
<p>a number indicating the amount by which strip text in the plot(s) should be scaled relative to the default. 1=default, 1.5 is 50% larger, 0.5 is 50% smaller, etc.</p>
</td></tr>
<tr><td><code id="repRisk_+3A_axis.cex">axis.cex</code></td>
<td>
<p>a number indicating the amount by which axis in the plot(s) should be scaled relative to the default. 1=default, 1.5 is 50% larger, 0.5 is 50% smaller, etc.</p>
</td></tr>
<tr><td><code id="repRisk_+3A_portfolio.only">portfolio.only</code></td>
<td>
<p>logical variable to choose if to calculate portfolio only decomposition, in which case multiple risk measures are 
allowed.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A table containing 
</p>
<table>
<tr><td><code>decomp = 'FMCR'</code></td>
<td>
<p>(N + 1) * (K + 1) matrix of marginal contributions to risk of portfolio 
return as well assets return, with first row of values for the portfolio and the remaining rows for 
the assets in the portfolio, with  (K + 1) columns containing values for the K risk factors and the
residual respectively</p>
</td></tr>
<tr><td><code>decomp = 'FCR'</code></td>
<td>
<p>(N + 1) * (K + 2) matrix of component contributions to risk of portfolio 
return as well assets return, with first row of values for the portfolio and the remaining rows for 
the assets in the portfolio, with  first column containing portfolio and asset risk values and remaining
(K + 1) columns containing values for the K risk factors and the residual respectively</p>
</td></tr>
<tr><td><code>decomp = 'FPCR'</code></td>
<td>
<p>(N + 1) * (K + 1) matrix of percentage component contributions to risk 
of portfolio return as well assets return, with first row of values for the portfolio and the remaining rows for 
the assets in the portfolio, with  (K + 1) columns containing values for the K risk factors and the
residual respectively</p>
</td></tr>
</table>
<p>Where, K is the number of factors, N is the number of assets.
</p>


<h3>Author(s)</h3>

<p>Douglas Martin, Lingjie Yi
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitFfm">fitFfm</a></code>
for the different factor model fitting functions.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>

# Fundamental Factor Model
library(PCRA)

dateRange &lt;- c("2006-01-31","2010-12-31")
stockItems &lt;-  c("Date", "TickerLast",  "Return","Sector")
factorItems &lt;- c("BP","Beta60M","PM12M1M")
facDatIT &lt;- selectCRSPandSPGMI("monthly",
                               dateRange = dateRange, 
                               stockItems = stockItems, 
                               factorItems = factorItems, 
                               outputType = "data.table")
asset.var="TickerLast" 
ret.var="Return" 
date.var = "Date"
exposure.vars= factorItems
asset.var="TickerLast" 
ret.var="Return" 
date.var = "Date"
spec1 &lt;- specFfm(data = facDatIT,asset.var = asset.var, ret.var = ret.var, 
                date.var = date.var, exposure.vars = exposure.vars,weight.var = NULL,
                 addIntercept = TRUE, rob.stats = FALSE)
# fit a fundamental factor model
mdlFit &lt;- fitFfmDT(spec1)
mdlRes &lt;- extractRegressionStats(spec1,mdlFit)
fit.cross &lt;- convert(SpecObj = spec1,FitObj = mdlFit, RegStatsObj = mdlRes)
repRisk(fit.cross, risk = "Sd", decomp = 'FCR', nrowPrint = 10,  digits = 4) 
# get the factor contributions of risk 
repRisk(fit.cross, risk = "Sd", decomp = 'FPCR', 
        nrowPrint = 10)       
           
# portfolio only decomposition
repRisk(fit.cross, risk = c("VaR", "ES"), decomp = 'FPCR', 
        portfolio.only = TRUE)    
           
# plot
repRisk(fit.cross, risk = "Sd", decomp = 'FPCR', 
        isPrint = FALSE, nrowPrint = 15, isPlot = TRUE, layout = c(4,2))  

</code></pre>

<hr>
<h2 id='residualizeReturns'>residualizeReturns</h2><span id='topic+residualizeReturns'></span>

<h3>Description</h3>

<p>#' function to Residualize the returns via regressions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>residualizeReturns(specObj, benchmark, rfRate, isBenchExcess = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="residualizeReturns_+3A_specobj">specObj</code></td>
<td>
<p>specObj is a ffmSpec object,</p>
</td></tr>
<tr><td><code id="residualizeReturns_+3A_benchmark">benchmark</code></td>
<td>
<p>we might need market returns</p>
</td></tr>
<tr><td><code id="residualizeReturns_+3A_rfrate">rfRate</code></td>
<td>
<p>risk free rate</p>
</td></tr>
<tr><td><code id="residualizeReturns_+3A_isbenchexcess">isBenchExcess</code></td>
<td>
<p>toggle to select whether to calculate excess returns</p>
</td></tr>
</table>


<h3>Details</h3>

<p>this function operates on the data inside the specObj and residualizes
the returns to create residual return using regressions of returns on a 
benchmark.
</p>


<h3>Value</h3>

<p>the ffmSpec object with resturns residualized
</p>


<h3>See Also</h3>

<p><code><a href="#topic+specFfm">specFfm</a></code> for information on the definition of the specFfm object.
</p>

<hr>
<h2 id='riskDecomp.ffm'>Decompose Risk into individual factor contributions</h2><span id='topic+riskDecomp.ffm'></span>

<h3>Description</h3>

<p>Compute the factor contributions to Sd, VaR and ES of returns based on Euler's theorem, given 
the fitted factor model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>riskDecomp.ffm(
  object,
  risk,
  weights = NULL,
  portDecomp = TRUE,
  factor.cov,
  p = 0.05,
  type = c("np", "normal"),
  invert = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="riskDecomp.ffm_+3A_object">object</code></td>
<td>
<p>fit object of class <code>tsfm</code>, or <code>ffm</code>.</p>
</td></tr>
<tr><td><code id="riskDecomp.ffm_+3A_risk">risk</code></td>
<td>
<p>one of &quot;Sd&quot; (Standard Deviation) or &quot;VaR&quot; (Value at Risk) or &quot;ES&quot; (Expected Shortfall)</p>
</td></tr>
<tr><td><code id="riskDecomp.ffm_+3A_weights">weights</code></td>
<td>
<p>a vector of weights of the assets in the portfolio, names of 
the vector should match with asset names. Default is NULL, in which case an 
equal weights will be used.</p>
</td></tr>
<tr><td><code id="riskDecomp.ffm_+3A_portdecomp">portDecomp</code></td>
<td>
<p>logical. If <code>True</code> the decomposition of risk is done for the portfolio based on the weights.
Else, the decomposition of risk is done for each asset. <code>Default</code> is <code>TRUE</code></p>
</td></tr>
<tr><td><code id="riskDecomp.ffm_+3A_factor.cov">factor.cov</code></td>
<td>
<p>optional user specified factor covariance matrix with 
named columns; defaults to the sample covariance matrix.</p>
</td></tr>
<tr><td><code id="riskDecomp.ffm_+3A_p">p</code></td>
<td>
<p>tail probability for calculation. Default is 0.05.</p>
</td></tr>
<tr><td><code id="riskDecomp.ffm_+3A_type">type</code></td>
<td>
<p>one of &quot;np&quot; (non-parametric) or &quot;normal&quot; for calculating Es. 
Default is &quot;np&quot;.</p>
</td></tr>
<tr><td><code id="riskDecomp.ffm_+3A_invert">invert</code></td>
<td>
<p>a logical variable to choose if change ES to positive number, default
is False</p>
</td></tr>
<tr><td><code id="riskDecomp.ffm_+3A_...">...</code></td>
<td>
<p>other optional arguments passed to <code><a href="stats.html#topic+quantile">quantile</a></code> and 
optional arguments passed to <code><a href="stats.html#topic+cov">cov</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing 
</p>
<table>
<tr><td><code>portES</code></td>
<td>
<p>factor model ES of portfolio returns.</p>
</td></tr>
<tr><td><code>mES</code></td>
<td>
<p>length-(K + 1) vector of marginal contributions to Es.</p>
</td></tr>
<tr><td><code>cES</code></td>
<td>
<p>length-(K + 1) vector of component contributions to Es.</p>
</td></tr>
<tr><td><code>pcES</code></td>
<td>
<p>length-(K + 1) vector of percentage component contributions to Es.</p>
</td></tr>
</table>
<p>Where, K is the number of factors.
</p>


<h3>Author(s)</h3>

<p>Eric Zivot, Yi-An Chen, Sangeetha Srinivasan, Lingjie Yi and Avinash Acharya
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitFfm">fitFfm</a></code>
for the different factor model fitting functions.
</p>
<p><code><a href="#topic+portSdDecomp">portSdDecomp</a></code> for factor model Sd decomposition.
<code><a href="#topic+portVaRDecomp">portVaRDecomp</a></code> for factor model VaR decomposition.
</p>

<hr>
<h2 id='roll.fitFfmDT'>roll.fitFfmDT</h2><span id='topic+roll.fitFfmDT'></span>

<h3>Description</h3>

<p>roll.fitFfmDT rolls the fundamental factor model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>roll.fitFfmDT(
  ffMSpecObj,
  windowSize = 60,
  refitEvery = 1,
  refitWindow = c("Expanding", "Rolling"),
  stdExposuresControl = list(Std.Type = "timeSeries", lambda = 0.9),
  stdReturnControl = list(GARCH.params = list(omega = 0.09, alpha = 0.1, beta = 0.81)),
  fitControl = list(fit.method = c("LS", "WLS", "Rob", "W-Rob"), resid.scaleType =
    c("STDDEV", "EWMA", "ROBEWMA", "GARCH"), lambda = 0.9, GARCH.params = list(omega =
    0.09, alpha = 0.1, beta = 0.81), GARCH.MLE = FALSE),
  full.resid.cov = TRUE,
  analysis = c("ISM", "NEW")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="roll.fitFfmDT_+3A_ffmspecobj">ffMSpecObj</code></td>
<td>
<p>a specFFm object</p>
</td></tr>
<tr><td><code id="roll.fitFfmDT_+3A_windowsize">windowSize</code></td>
<td>
<p>the size of the fit window</p>
</td></tr>
<tr><td><code id="roll.fitFfmDT_+3A_refitevery">refitEvery</code></td>
<td>
<p>the frequency of fitting</p>
</td></tr>
<tr><td><code id="roll.fitFfmDT_+3A_refitwindow">refitWindow</code></td>
<td>
<p>choice of expanding or rolling</p>
</td></tr>
<tr><td><code id="roll.fitFfmDT_+3A_stdexposurescontrol">stdExposuresControl</code></td>
<td>
<p>for exposure standardization; (give the Std.Type and lambda)</p>
</td></tr>
<tr><td><code id="roll.fitFfmDT_+3A_stdreturncontrol">stdReturnControl</code></td>
<td>
<p>choices to standardize the returns using GARCH controls</p>
</td></tr>
<tr><td><code id="roll.fitFfmDT_+3A_fitcontrol">fitControl</code></td>
<td>
<p>list of options for fitting the ffm</p>
</td></tr>
<tr><td><code id="roll.fitFfmDT_+3A_full.resid.cov">full.resid.cov</code></td>
<td>
<p>True or False toggle</p>
</td></tr>
<tr><td><code id="roll.fitFfmDT_+3A_analysis">analysis</code></td>
<td>
<p>choice of &quot;ISM&quot; or &quot;NEW&quot;</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list object containing a list of objects describing the fitted analysis.
</p>

<hr>
<h2 id='specFfm'>Specifies the elements of a fundamental factor model</h2><span id='topic+specFfm'></span>

<h3>Description</h3>

<p>Factor models have a few parameters that describe how the 
fitting is done.  This function summarizes them and returns a spec object for
cross-sectional regressions.  It also preps the data. An object of class 
<code>"ffmSpec"</code> is returned.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>specFfm(
  data,
  asset.var,
  ret.var,
  date.var,
  exposure.vars,
  weight.var = NULL,
  addIntercept = FALSE,
  rob.stats = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="specFfm_+3A_data">data</code></td>
<td>
<p>data.frame of the balanced panel data containing the variables
<code>asset.var</code>, <code>ret.var</code>, <code>exposure.vars</code>, <code>date.var</code> and
optionally, <code>weight.var</code>.</p>
</td></tr>
<tr><td><code id="specFfm_+3A_asset.var">asset.var</code></td>
<td>
<p>character; name of the variable  for asset names.</p>
</td></tr>
<tr><td><code id="specFfm_+3A_ret.var">ret.var</code></td>
<td>
<p>character; name of the variable for asset returns.</p>
</td></tr>
<tr><td><code id="specFfm_+3A_date.var">date.var</code></td>
<td>
<p>character; name of the variable containing the dates
coercible to class <code>Date</code>.</p>
</td></tr>
<tr><td><code id="specFfm_+3A_exposure.vars">exposure.vars</code></td>
<td>
<p>vector; names of the variables containing the
fundamental factor exposures.</p>
</td></tr>
<tr><td><code id="specFfm_+3A_weight.var">weight.var</code></td>
<td>
<p>character; name of the variable containing the weights
used when standardizing style factor exposures. Default is <code>NULL</code>. See
Details.</p>
</td></tr>
<tr><td><code id="specFfm_+3A_addintercept">addIntercept</code></td>
<td>
<p>logical; If <code>TRUE</code>, intercept is added in
the exposure matrix. Default is <code>FALSE</code>,</p>
</td></tr>
<tr><td><code id="specFfm_+3A_rob.stats">rob.stats</code></td>
<td>
<p>logical; If <code>TRUE</code>, robust estimates of covariance,
correlation, location and univariate scale are computed as appropriate (see
Details). Default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an object of class ffmSpec holding the details of the analysis
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(PCRA)

dateRange &lt;- c("2006-01-31","2010-12-31")
stockItems &lt;-  c("Date", "TickerLast",  "Return","Sector")
factorItems &lt;- c("BP","Beta60M","PM12M1M")
facDatIT &lt;- selectCRSPandSPGMI("monthly",
                               dateRange = dateRange, 
                               stockItems = stockItems, 
                               factorItems = factorItems, 
                               outputType = "data.table")
asset.var="TickerLast" 
ret.var="Return" 
date.var = "Date"
exposure.vars= c("BP","Beta60M","PM12M1M")
spec1 &lt;- specFfm(data = facDatIT,asset.var = asset.var, ret.var = ret.var, 
                 date.var = date.var, exposure.vars = exposure.vars,weight.var = NULL,
                 addIntercept = TRUE, rob.stats = FALSE)
spec1$exposure.vars

#lag the exposures
spec1 &lt;- lagExposures(spec1)
# standardize the exposures Cross-Sectionally
spec1 &lt;- standardizeExposures(spec1, Std.Type = "CrossSection") 
# fit the model
mdlFit &lt;- fitFfmDT(spec1) 
class(mdlFit)
class(mdlFit$reg.listDT)

</code></pre>

<hr>
<h2 id='standardizeExposures'>standardizeExposures</h2><span id='topic+standardizeExposures'></span>

<h3>Description</h3>

<p>function to calculate z-scores for numeric exposure using weights weight.var
</p>


<h3>Usage</h3>

<pre><code class='language-R'>standardizeExposures(
  specObj,
  Std.Type = c("None", "CrossSection", "TimeSeries"),
  lambda = 0.9
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="standardizeExposures_+3A_specobj">specObj</code></td>
<td>
<p>is a ffmSpec object,</p>
</td></tr>
<tr><td><code id="standardizeExposures_+3A_std.type">Std.Type</code></td>
<td>
<p>method for exposure standardization; one of &quot;none&quot;,
&quot;CrossSection&quot;, or &quot;TimeSeries&quot;.
Default is <code>"none"</code>.</p>
</td></tr>
<tr><td><code id="standardizeExposures_+3A_lambda">lambda</code></td>
<td>
<p>lambda value to be used for the EWMA estimation of residual 
variances. Default is 0.9</p>
</td></tr>
</table>


<h3>Details</h3>

<p>this function operates on the data inside the specObj and applies a 
standardization to it.  The user can choose CrossSectional or timeSeries standardization
</p>


<h3>Value</h3>

<p>the ffmSpec object with exposures z-scored
</p>


<h3>See Also</h3>

<p><code><a href="#topic+specFfm">specFfm</a></code> for information on the definition of the specFfm object.
</p>

<hr>
<h2 id='standardizeReturns'>standardizeReturns</h2><span id='topic+standardizeReturns'></span>

<h3>Description</h3>

<p>Standardize the returns using GARCH(1,1) volatilities.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>standardizeReturns(
  specObj,
  GARCH.params = list(omega = 0.09, alpha = 0.1, beta = 0.81)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="standardizeReturns_+3A_specobj">specObj</code></td>
<td>
<p>is a ffmSpec object</p>
</td></tr>
<tr><td><code id="standardizeReturns_+3A_garch.params">GARCH.params</code></td>
<td>
<p>fixed Garch(1,1) parameters</p>
</td></tr>
</table>


<h3>Details</h3>

<p>this function operates on the data inside the specObj and standardizes
the returns to create scaled return.
</p>


<h3>Value</h3>

<p>an ffmSpec Object with the standardized returns added
</p>


<h3>See Also</h3>

<p><code><a href="#topic+specFfm">specFfm</a></code> for information on the definition of the specFfm object.
</p>

<hr>
<h2 id='summary.ffm'>Summarizing a fitted fundamental factor model</h2><span id='topic+summary.ffm'></span><span id='topic+print.summary.ffm'></span>

<h3>Description</h3>

<p><code>summary</code> method for object of class <code>ffm</code>. 
Returned object is of class summary.ffm.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ffm'
summary(object, ...)

## S3 method for class 'summary.ffm'
print(x, digits = 3, labels = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.ffm_+3A_object">object</code></td>
<td>
<p>an object of class <code>ffm</code> returned by <code>fitFfm</code>.</p>
</td></tr>
<tr><td><code id="summary.ffm_+3A_...">...</code></td>
<td>
<p>futher arguments passed to or from other methods.</p>
</td></tr>
<tr><td><code id="summary.ffm_+3A_x">x</code></td>
<td>
<p>an object of class <code>summary.ffm</code>.</p>
</td></tr>
<tr><td><code id="summary.ffm_+3A_digits">digits</code></td>
<td>
<p>number of significant digits to use when printing. 
Default is 3.</p>
</td></tr>
<tr><td><code id="summary.ffm_+3A_labels">labels</code></td>
<td>
<p>option to print labels and legend in the summary. Default is 
<code>TRUE</code>. When <code>FALSE</code>, only the coefficient matrx with standard 
errors is printed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The default <code>summary</code> method for a fitted <code>lm</code> object 
computes the standard errors and t-statistics under the assumption of 
homoscedasticity.
</p>
<p>Note: This gives a summary of the fitted factor returns at each time period. 
If <code>T</code> is large, you might prefer the more succinct summary produced by 
<code><a href="#topic+print.ffm">print.ffm</a></code>.
</p>


<h3>Value</h3>

<p>Returns an object of class <code>summary.ffm</code>. 
The print method for class <code>summary.ffm</code> outputs the call, 
coefficients (with standard errors and t-statistics), r-squared and 
residual volatilty (under the homoskedasticity assumption) for all assets. 
</p>
<p>Object of class <code>summary.ffm</code> is a list of length N + 2 containing:
</p>
<table>
<tr><td><code>call</code></td>
<td>
<p>the function call to <code>fitFfm</code></p>
</td></tr>
<tr><td><code>sum.list</code></td>
<td>
<p>list of summaries of the T fit objects (of class <code>lm</code> or 
<code>lmRob</code>) for each time period in the factor model.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Sangeetha Srinivasan &amp; Yi-An Chen.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+fitFfm">fitFfm</a></code>, <code><a href="stats.html#topic+summary.lm">summary.lm</a></code>
</p>

<hr>
<h2 id='tsPlotMP'>Time Series Plots</h2><span id='topic+tsPlotMP'></span>

<h3>Description</h3>

<p>Plot time series with specific plotting parameters
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tsPlotMP(
  ret,
  add.grid = FALSE,
  layout = NULL,
  type = "l",
  yname = "RETURNS (%)",
  Pct = FALSE,
  scaleType = "free",
  stripLeft = TRUE,
  main = NULL,
  lwd = 1,
  stripText.cex = 1,
  axis.cex = 1,
  color = "black",
  zeroLine = TRUE,
  panel = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tsPlotMP_+3A_ret">ret</code></td>
<td>
<p>an time series exposure/return object</p>
</td></tr>
<tr><td><code id="tsPlotMP_+3A_add.grid">add.grid</code></td>
<td>
<p>logical variable.If 'TRUE', type = c('l', 'g'); If 'FALSE', type = c('l')</p>
</td></tr>
<tr><td><code id="tsPlotMP_+3A_layout">layout</code></td>
<td>
<p>layout is a numeric vector of length 2 or 3 giving the number of columns, rows, and pages (optional) in a multipanel display.</p>
</td></tr>
<tr><td><code id="tsPlotMP_+3A_type">type</code></td>
<td>
<p>character. type of the plot; 'l' denotes a line, 'p' denotes a point, and 'b' and 'o' both denote both together.deafault is 'l'.</p>
</td></tr>
<tr><td><code id="tsPlotMP_+3A_yname">yname</code></td>
<td>
<p>character or expression giving label(s) for the y-axis</p>
</td></tr>
<tr><td><code id="tsPlotMP_+3A_pct">Pct</code></td>
<td>
<p>Pct controls if use the percentage value.</p>
</td></tr>
<tr><td><code id="tsPlotMP_+3A_scaletype">scaleType</code></td>
<td>
<p>scaleType controls if use a same scale of y-axis, choose from c('same', 'free')</p>
</td></tr>
<tr><td><code id="tsPlotMP_+3A_stripleft">stripLeft</code></td>
<td>
<p>logical variable to choose the position of strip, 'TRUE' for drawing strips on the left of each panel, 'FALSE' for drawing strips on the top of each panel</p>
</td></tr>
<tr><td><code id="tsPlotMP_+3A_main">main</code></td>
<td>
<p>Typically a character string or expression describing the main title.</p>
</td></tr>
<tr><td><code id="tsPlotMP_+3A_lwd">lwd</code></td>
<td>
<p>The line width, a positive number, defaulting to 1</p>
</td></tr>
<tr><td><code id="tsPlotMP_+3A_striptext.cex">stripText.cex</code></td>
<td>
<p>a number indicating the amount by which strip text in the plot(s) should be scaled relative to the default. 1=default, 1.5 is 50% larger, 0.5 is 50% smaller, etc.</p>
</td></tr>
<tr><td><code id="tsPlotMP_+3A_axis.cex">axis.cex</code></td>
<td>
<p>a number indicating the amount by which axis in the plot(s) should be scaled relative to the default. 1=default, 1.5 is 50% larger, 0.5 is 50% smaller, etc.</p>
</td></tr>
<tr><td><code id="tsPlotMP_+3A_color">color</code></td>
<td>
<p>A specification for the default plotting color. Default is black.</p>
</td></tr>
<tr><td><code id="tsPlotMP_+3A_zeroline">zeroLine</code></td>
<td>
<p>logical varible to choose add a dotted horizontal line at the zero vertical distance</p>
</td></tr>
<tr><td><code id="tsPlotMP_+3A_panel">panel</code></td>
<td>
<p>function to add customized lines to the lattice plot. See examples.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, called for plotting
</p>


<h3>Author(s)</h3>

<p>Douglas Martin, Lingjie Yi
</p>

<hr>
<h2 id='vif'>Factor Model Variance Inflaction Factor Values</h2><span id='topic+vif'></span>

<h3>Description</h3>

<p>Calculate and plot the Factor Model Variance Inflaction Factor Values for a fitted model.
A VIF for a single explanatory variable (style factor) is obtained using the time series of R-squared values obtained from 
the regression of that variable against all other explanatory variables.
So, at least 2 explanatory variables are required in <code>exposure.vars</code> of fitted model to find the VIF.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>vif(
  ffmObj,
  digits = 2,
  isPrint = TRUE,
  isPlot = TRUE,
  lwd = 2,
  stripText.cex = 1,
  axis.cex = 1,
  title = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="vif_+3A_ffmobj">ffmObj</code></td>
<td>
<p>an object of class <code>ffm</code> produced by <code>fitFfm</code></p>
</td></tr>
<tr><td><code id="vif_+3A_digits">digits</code></td>
<td>
<p>an integer indicating the number of decimal places to be used for rounding. Default is 2.</p>
</td></tr>
<tr><td><code id="vif_+3A_isprint">isPrint</code></td>
<td>
<p>logical. if <code>TRUE</code>, the time series of the computed factor model values is printed along with their mean values.
Else, only the mean values are printed. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="vif_+3A_isplot">isPlot</code></td>
<td>
<p>logical. if <code>TRUE</code>, the time series of the output is plotted. Default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="vif_+3A_lwd">lwd</code></td>
<td>
<p>line width relative to the default. Default is 2.</p>
</td></tr>
<tr><td><code id="vif_+3A_striptext.cex">stripText.cex</code></td>
<td>
<p>a number indicating the amount by which strip text in the plot(s) should be scaled relative to the default. 1=default, 1.5 is 50% larger, 0.5 is 50% smaller, etc.</p>
</td></tr>
<tr><td><code id="vif_+3A_axis.cex">axis.cex</code></td>
<td>
<p>a number indicating the amount by which axis in the plot(s) should be scaled relative to the default. 1=default, 1.5 is 50% larger, 0.5 is 50% smaller, etc.</p>
</td></tr>
<tr><td><code id="vif_+3A_title">title</code></td>
<td>
<p>logical. This argument is mainly used for the documentation purpose when you need a plot without any title.
If <code>TRUE</code>, the plots will have the main tiltle. default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="vif_+3A_...">...</code></td>
<td>
<p>potentially further arguments passed.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>ffmRsq</code> returns the sample mean values and plots the time series of corresponding R squared values
and the Variance Inflation factors depending on the values of <code>rsq</code>, <code>rsqAdj</code> and <code>VIF</code>.
The time series of the output values are also printed if <code>isPrint</code> is <code>TRUE</code>
</p>


<h3>Author(s)</h3>

<p>Avinash Acharya
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(PCRA)
# load data 
data(stocksCRSP)
data(factorsSPGMI)
dateRange &lt;- c("2006-01-31","2010-12-31")
stockItems &lt;-  c("Date", "TickerLast", "CapGroupLast", "Return",
                "Ret13WkBill","MktIndexCRSP","Sector")
                factorItems &lt;- c("BP","Beta60M","PM12M1M")
stocks_factors &lt;- selectCRSPandSPGMI("monthly", dateRange = dateRange, 
stockItems = stockItems, factorItems = factorItems, outputType ="data.table")
                                    

# fit a fundamental factor model with style variables BP and LogMktCap

fundamental_model &lt;- fitFfm(data = stocks_factors, 
                           asset.var = "TickerLast", 
                           ret.var = "Return", 
                           date.var = "Date", 
                           exposure.vars = c("BP", "PM12M1M")
                           )

#Plot and print the time series of VIF values
vif(fundamental_model,isPrint=TRUE)
 
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
