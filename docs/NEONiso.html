<!DOCTYPE html><html lang="en-US"><head><title>Help for package NEONiso</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {NEONiso}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#NEONiso-package'><p>NEONiso</p></a></li>
<li><a href='#calculate_12CO2'><p>Calculate 12C-CO2 Mole Fractions</p></a></li>
<li><a href='#calculate_13CO2'><p>Calculate 13C-CO2 Mole Fractions</p></a></li>
<li><a href='#calibrate_ambient_carbon_gainoffset'><p>Calibrate ambient carbon isotope data using gain-and-offset method</p></a></li>
<li><a href='#calibrate_ambient_carbon_linreg'><p>Calibrate ambient carbon isotope data using linear regression</p></a></li>
<li><a href='#calibrate_ambient_water_linreg'><p>calibrate_ambient_water_isotopes</p></a></li>
<li><a href='#calibrate_carbon'><p>Calibrate NEON carbon isotope data using validation data sets.</p></a></li>
<li><a href='#calibrate_water'><p>Calibrate NEON water isotope ratios using validation data sets.</p></a></li>
<li><a href='#carbon_regression_plots'><p>Make plots of carbon calibration data for debugging</p></a></li>
<li><a href='#convert_NEONhdf5_to_POSIXct_time'><p>Convert NEON HDF5 file time to POSIXct</p></a></li>
<li><a href='#convert_POSIXct_to_NEONhdf5_time'><p>Convert a POSIXct object to the format used in NEON HDF5 files</p></a></li>
<li><a href='#correct_carbon_ref_cval'><p>correct_carbon_ref_cval</p></a></li>
<li><a href='#correct_carbon_ref_output'><p>Correct carbon ref output</p></a></li>
<li><a href='#delta_to_R'><p>Converts delta value to heavy-to-light isotope ratio</p></a></li>
<li><a href='#estimate_calibration_error'><p>Produce estimates of the calibration error.</p></a></li>
<li><a href='#extract_carbon_cal_data'><p>Extract only the data corresponding to validation/calibration time periods.</p></a></li>
<li><a href='#extract_water_calibration_data'><p>Extract only the data corresponding to validation/calibration time periods.</p></a></li>
<li><a href='#filter_median_brock86'><p>Apply a median absolute deviation filter</p></a></li>
<li><a href='#fit_carbon_regression'><p>Estimate slope/intercept of carbon isotope calibration regression</p></a></li>
<li><a href='#fit_water_regression'><p>Estimate slope/intercept of water isotope calibration regression</p></a></li>
<li><a href='#get_Rstd'><p>Return heavy-to-light isotope ratio of primary standard.</p></a></li>
<li><a href='#ingest_data'><p>Ingest and stack variables needed in calibration.</p></a></li>
<li><a href='#loocv'><p>Leave-one-out cross validation</p></a></li>
<li><a href='#manage_local_EC_archive'><p>Manage a local eddy covariance (EC) data archive.</p></a></li>
<li><a href='#R_to_delta'><p>Convert heavy-to-light isotope ratio to delta values.</p></a></li>
<li><a href='#restructure_carbon_variables'><p>Restructure ingested variables for the carbon isotope system.</p></a></li>
<li><a href='#restructure_variables'><p>Restructures data.frames imported by ingest_data to shorten variable names</p>
and  Wrapper function around restructure_carbon_variables
and restructure_water_variables.</a></li>
<li><a href='#restructure_water_variables'><p>Restructure ingested variables for the water isotope system.</p></a></li>
<li><a href='#select_daily_reference_data'><p>Select validation data corresponding to a particular day</p></a></li>
<li><a href='#setup_output_file'><p>Structure a new HDF5 file</p></a></li>
<li><a href='#swap_standard_isotoperatios'><p>swap_standard_isotoperatios</p></a></li>
<li><a href='#terrestrial_core_sites'><p>List terrestrial core sites</p></a></li>
<li><a href='#terrestrial_gradient_sites'><p>List terrestrial gradient sites</p></a></li>
<li><a href='#validate_analyte'><p>Standardize analyte names</p></a></li>
<li><a href='#validate_output_file'><p>Validate output file.</p></a></li>
<li><a href='#water_isotope_sites'><p>List sites with water vapor isotope ratios.</p></a></li>
<li><a href='#write_carbon_ambient_data'><p>Write calibrated carbon ambient data to file</p></a></li>
<li><a href='#write_carbon_calibration_data'><p>Write carbon calibrations to file</p></a></li>
<li><a href='#write_water_ambient_data'><p>Write calibrated ambient water isotope ratio observations to file.</p></a></li>
<li><a href='#write_water_calibration_data'><p>Write water calibration parameters to file</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Tools to Calibrate and Work with NEON Atmospheric Isotope Data</td>
</tr>
<tr>
<td>Version:</td>
<td>0.7.2</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Rich Fiorella &lt;rfiorella@lanl.gov&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.0.0)</td>
</tr>
<tr>
<td>Description:</td>
<td>Functions for downloading,
    calibrating, and analyzing atmospheric isotope data bundled
    into the eddy covariance data products of the National Ecological
    Observatory Network (NEON) <a href="https://www.neonscience.org">https://www.neonscience.org</a>. 
    Calibration tools are provided for carbon and water isotope products.
    Carbon isotope calibration details are found in Fiorella et al. (2021)
    &lt;<a href="https://doi.org/10.1029%2F2020JG005862">doi:10.1029/2020JG005862</a>&gt;, and the readme 
    file at <a href="https://github.com/lanl/NEONiso">https://github.com/lanl/NEONiso</a>. Tools for calibrating water 
    isotope products have been added as of 0.6.0, but have known deficiencies
    and should be considered experimental and unsupported.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/lanl/NEONiso/issues">https://github.com/lanl/NEONiso/issues</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/lanl/NEONiso">https://github.com/lanl/NEONiso</a>, <a href="https://lanl.github.io/NEONiso/">https://lanl.github.io/NEONiso/</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr, zoo, httr, lubridate, neonUtilities (&ge; 2.1.1),
magrittr, rhdf5 (&ge; 2.33.7), R.utils, tidyselect, data.table,
rlang, caret, ggplot2, gridExtra</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat (&ge; 3.0.0), lifecycle, fasttime</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-02-13 05:10:11 UTC; rfiorella</td>
</tr>
<tr>
<td>Author:</td>
<td>Rich Fiorella <a href="https://orcid.org/0000-0002-0824-4777"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-02-13 05:30:14 UTC</td>
</tr>
</table>
<hr>
<h2 id='NEONiso-package'>NEONiso</h2><span id='topic+NEONiso'></span><span id='topic+NEONiso-package'></span>

<h3>Description</h3>

<p>Functions for downloading,
calibrating, and analyzing atmospheric isotope data bundled
into the eddy covariance data products of the National Ecological
Observatory Network (NEON)
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a> (<a href="https://orcid.org/0000-0002-0824-4777">ORCID</a>)
</p>


<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/lanl/NEONiso">https://github.com/lanl/NEONiso</a>
</p>
</li>
<li> <p><a href="https://lanl.github.io/NEONiso/">https://lanl.github.io/NEONiso/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/lanl/NEONiso/issues">https://github.com/lanl/NEONiso/issues</a>
</p>
</li></ul>


<hr>
<h2 id='calculate_12CO2'>Calculate 12C-CO2 Mole Fractions</h2><span id='topic+calculate_12CO2'></span>

<h3>Description</h3>

<p>This function calculates mole fractions of 12CO2 based on the total CO2 mole
fraction, the delta13C value of the mixture, and the assumed fraction of CO2
that does not correspond to 12CO2 or 13CO2 (assumed fixed at 0.00474, e.g.,
Griffis et al. 2004 Agricultural and Forest Meteorology)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_12CO2(total_co2, delta13c, f = 0.00474)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calculate_12CO2_+3A_total_co2">total_co2</code></td>
<td>
<p>Vector of CO2 mole fractions.</p>
</td></tr>
<tr><td><code id="calculate_12CO2_+3A_delta13c">delta13c</code></td>
<td>
<p>Vector of d13C values.</p>
</td></tr>
<tr><td><code id="calculate_12CO2_+3A_f">f</code></td>
<td>
<p>Fraction of CO2 that is not 12CO2 or 13CO2. Assumed fixed
at 0.00474</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Vector of 12CO2 mole fractions.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>calculate_12CO2(total_co2 = 410, delta13c = -8.5)

</code></pre>

<hr>
<h2 id='calculate_13CO2'>Calculate 13C-CO2 Mole Fractions</h2><span id='topic+calculate_13CO2'></span>

<h3>Description</h3>

<p>This function calculates mole fractions of 13CO2 based on the total CO2 mole
fraction, the delta13C value of the mixture, and the assumed fraction of CO2
that does not correspond to 12CO2 or 13CO2 (assumed fixed at 0.00474, e.g.,
Griffis et al. 2004 Agricultural and Frest Meteorology)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_13CO2(total_co2, delta13c, f = 0.00474)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calculate_13CO2_+3A_total_co2">total_co2</code></td>
<td>
<p>Vector of CO2 mole fractions.</p>
</td></tr>
<tr><td><code id="calculate_13CO2_+3A_delta13c">delta13c</code></td>
<td>
<p>Vector of d13C values.</p>
</td></tr>
<tr><td><code id="calculate_13CO2_+3A_f">f</code></td>
<td>
<p>Fraction of CO2 that is not 12CO2 or 13CO2. Assumed fixed
at 0.00474</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Vector of 13CO2 mole fractions.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>calculate_13CO2(total_co2 = 410, delta13c = -8.5)

</code></pre>

<hr>
<h2 id='calibrate_ambient_carbon_gainoffset'>Calibrate ambient carbon isotope data using gain-and-offset method</h2><span id='topic+calibrate_ambient_carbon_gainoffset'></span>

<h3>Description</h3>

<p>Function called by <code>calibrate_carbon_bymonth()</code> to apply
gain and offset parameters to the ambient datasets (000_0x0_09m and
000_0x0_30m). This function should generally not be used independently,
but should be used in coordination with
<code>calibrate_carbon_bymonth()</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calibrate_ambient_carbon_gainoffset(
  amb_data_list,
  caldf,
  site,
  filter_data = TRUE,
  force_to_end = TRUE,
  force_to_beginning = TRUE,
  gap_fill_parameters = FALSE,
  r2_thres = 0.9
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calibrate_ambient_carbon_gainoffset_+3A_amb_data_list">amb_data_list</code></td>
<td>
<p>List containing an ambient d13C dataset.
Will include all variables in 000_0x0_xxm. (character)</p>
</td></tr>
<tr><td><code id="calibrate_ambient_carbon_gainoffset_+3A_caldf">caldf</code></td>
<td>
<p>Calibration data frame containing gain and offset values for
12C and 13C isotopologues.</p>
</td></tr>
<tr><td><code id="calibrate_ambient_carbon_gainoffset_+3A_site">site</code></td>
<td>
<p>Four-letter NEON code corresponding to site being processed.</p>
</td></tr>
<tr><td><code id="calibrate_ambient_carbon_gainoffset_+3A_filter_data">filter_data</code></td>
<td>
<p>Apply median absolute deviation filter from Brock 86 to
remove impulse spikes?</p>
</td></tr>
<tr><td><code id="calibrate_ambient_carbon_gainoffset_+3A_force_to_end">force_to_end</code></td>
<td>
<p>In given month, calibrate ambient data later than last
calibration, using the last calibration? (default true)</p>
</td></tr>
<tr><td><code id="calibrate_ambient_carbon_gainoffset_+3A_force_to_beginning">force_to_beginning</code></td>
<td>
<p>In given month, calibrate ambient data before than
first calibration, using the firs t calibration? (default true)</p>
</td></tr>
<tr><td><code id="calibrate_ambient_carbon_gainoffset_+3A_gap_fill_parameters">gap_fill_parameters</code></td>
<td>
<p>Should function attempt to 'gap-fill' across a
bad calibration by carrying the last known good calibration
forward? Implementation is fairly primitive currently, as
it only carries the last known good calibration that's
available forward rather than interpolating, etc. Default FALSE.</p>
</td></tr>
<tr><td><code id="calibrate_ambient_carbon_gainoffset_+3A_r2_thres">r2_thres</code></td>
<td>
<p>Minimum r2 value for calibration to be considered &quot;good&quot; and
applied to ambient data.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Depends on <code>write_to_file</code> argument.
If true, returns nothing to environment;
but returns calibrated ambient observations to the output file.
If false, returns modified version of amb_data_list that include
calibrated ambient data.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>

<hr>
<h2 id='calibrate_ambient_carbon_linreg'>Calibrate ambient carbon isotope data using linear regression</h2><span id='topic+calibrate_ambient_carbon_linreg'></span>

<h3>Description</h3>

<p>Function called by <code>calibrate_ambient_carbon_linreg</code> to apply
gain and offset parameters to the ambient datasets (000_0x0_09m and
000_0x0_30m). This function should generally not be used independently,
but should be used with <code>calibrate_ambient_carbon_linreg</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calibrate_ambient_carbon_linreg(
  amb_data_list,
  caldf,
  site,
  filter_data = TRUE,
  force_to_end = TRUE,
  force_to_beginning = TRUE,
  gap_fill_parameters = FALSE,
  r2_thres = 0.9
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calibrate_ambient_carbon_linreg_+3A_amb_data_list">amb_data_list</code></td>
<td>
<p>List containing an ambient d13C dataset.
Will include all variables in 000_0x0_xxm. (character)</p>
</td></tr>
<tr><td><code id="calibrate_ambient_carbon_linreg_+3A_caldf">caldf</code></td>
<td>
<p>Calibration data frame containing gain and offset values for
12C and 13C isotopologues.</p>
</td></tr>
<tr><td><code id="calibrate_ambient_carbon_linreg_+3A_site">site</code></td>
<td>
<p>Four-letter NEON code corresponding to site being processed.</p>
</td></tr>
<tr><td><code id="calibrate_ambient_carbon_linreg_+3A_filter_data">filter_data</code></td>
<td>
<p>Apply median absolute deviation filter from Brock 86 to
remove impulse spikes? Inherited from
<code>calibrate_ambient_carbon_linreg</code></p>
</td></tr>
<tr><td><code id="calibrate_ambient_carbon_linreg_+3A_force_to_end">force_to_end</code></td>
<td>
<p>In given month, calibrate ambient data later than last
calibration, using the last calibration? (default true)</p>
</td></tr>
<tr><td><code id="calibrate_ambient_carbon_linreg_+3A_force_to_beginning">force_to_beginning</code></td>
<td>
<p>In given month, calibrate ambient data before than
first calibration, using the first calibration? (default true)</p>
</td></tr>
<tr><td><code id="calibrate_ambient_carbon_linreg_+3A_gap_fill_parameters">gap_fill_parameters</code></td>
<td>
<p>Should function attempt to 'gap-fill' across a
bad calibration by carrying the last good calibration forward?
Implementation is fairly primitive currently, as it only carries
the last known good calibration that's available forward rather
than interpolating, etc. Default FALSE.</p>
</td></tr>
<tr><td><code id="calibrate_ambient_carbon_linreg_+3A_r2_thres">r2_thres</code></td>
<td>
<p>Minimum r2 value for calibration to be considered &quot;good&quot; and
applied to ambient data.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing to environment; returns calibrated ambient observations to
the function orchestrating calibration (calibrate_carbon).
This function is not designed to be called on its own,
and is not exported to the namespace.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>

<hr>
<h2 id='calibrate_ambient_water_linreg'>calibrate_ambient_water_isotopes</h2><span id='topic+calibrate_ambient_water_linreg'></span>

<h3>Description</h3>

<p>Function called by <code>calibrate_ambient_water_linreg</code> to apply
slope and intercept parameters to the ambient datasets (000_0x0_09m and
000_0x0_30m) to correct to the VSMOW scale.
This function should generally not be used independently,
but should be used with <code>calibrate_ambient_water_linreg</code>.
Note that in this version <em>NO CORRECTION FOR HUMIDITY</em> is performed.
Use with caution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calibrate_ambient_water_linreg(
  amb_data_list,
  caldf,
  outname,
  site,
  filter_data = TRUE,
  force_to_end = TRUE,
  force_to_beginning = TRUE,
  r2_thres = 0.9
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calibrate_ambient_water_linreg_+3A_amb_data_list">amb_data_list</code></td>
<td>
<p>List containing ambient d18O/d2H datasets.
Will include all variables in 000_0x0_xxm. (character)</p>
</td></tr>
<tr><td><code id="calibrate_ambient_water_linreg_+3A_caldf">caldf</code></td>
<td>
<p>Calibration data frame containing slope and intercept values
for d18O and d2H values.</p>
</td></tr>
<tr><td><code id="calibrate_ambient_water_linreg_+3A_outname">outname</code></td>
<td>
<p>Output variable name. Inherited from
<code>calibrate_ambient_water_linreg</code></p>
</td></tr>
<tr><td><code id="calibrate_ambient_water_linreg_+3A_site">site</code></td>
<td>
<p>Four-letter NEON code corresponding to site being processed.</p>
</td></tr>
<tr><td><code id="calibrate_ambient_water_linreg_+3A_filter_data">filter_data</code></td>
<td>
<p>Apply a median filter to output ambient data? inherited.</p>
</td></tr>
<tr><td><code id="calibrate_ambient_water_linreg_+3A_force_to_end">force_to_end</code></td>
<td>
<p>In given month, calibrate ambient data later than last
calibration, using the last calibration? (default true)</p>
</td></tr>
<tr><td><code id="calibrate_ambient_water_linreg_+3A_force_to_beginning">force_to_beginning</code></td>
<td>
<p>In given month, calibrate ambient data before than
first calibration, using the first calibration? (default true)</p>
</td></tr>
<tr><td><code id="calibrate_ambient_water_linreg_+3A_r2_thres">r2_thres</code></td>
<td>
<p>Minimum r2 value for calibration to be considered &quot;good&quot; and
applied to ambient data.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing to environment; returns calibrated ambient observations to
the output file. This function is not designed to be called on its own.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>

<hr>
<h2 id='calibrate_carbon'>Calibrate NEON carbon isotope data using validation data sets.</h2><span id='topic+calibrate_carbon'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
This function drives a workflow that reads in NEON carbon isotope data
of atmospheric CO2, calibrates it to the VPDB scale, and (optionally)
writes the calibrated data to a new HDF5 file. Two different approaches
are possible: a) a calibration on 12CO2 and 13CO2 isotopologues
independently, after Bowling et al. 2003 (Agr. For. Met.), or b) a direct
calibration of d13C and CO2 values using linear regression. Most of the time
the results generated are extremely similar to each other.
Wen et al. 2013 compared several different carbon
isotope calibration techniques and found this to be the superior method
under most circumstances. We also found this to be the case for NEON data
(Fiorella et al. 2021; JGR-Biogeosciences).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calibrate_carbon(
  inname,
  outname,
  site,
  method = "Bowling_2003",
  calibration_half_width = 0.5,
  force_cal_to_beginning = TRUE,
  force_cal_to_end = TRUE,
  gap_fill_parameters = FALSE,
  filter_ambient = TRUE,
  r2_thres = 0.95,
  correct_ref_data = TRUE,
  write_to_file = TRUE,
  remove_known_bad_months = TRUE,
  plot_regression_data = FALSE,
  plot_directory = NULL,
  avg = 6,
  min_nobs = NA,
  standards = c("co2Low", "co2Med", "co2High")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calibrate_carbon_+3A_inname">inname</code></td>
<td>
<p>Input file(s) that are to be calibrated. If a single file is
given, output will be a single file per site per month. If a
list of files corresponding to a timeseries at a given site
is provided, will calibrate the whole time series.</p>
</td></tr>
<tr><td><code id="calibrate_carbon_+3A_outname">outname</code></td>
<td>
<p>Name of the output file. (character)</p>
</td></tr>
<tr><td><code id="calibrate_carbon_+3A_site">site</code></td>
<td>
<p>Four letter NEON site code for site being processed. (character)</p>
</td></tr>
<tr><td><code id="calibrate_carbon_+3A_method">method</code></td>
<td>
<p>Are we using the Bowling et al. 2003 method
(&quot;Bowling_2003&quot;) or direct linear regression of
d13C and CO2 mole fractions (&quot;linreg&quot;)?</p>
</td></tr>
<tr><td><code id="calibrate_carbon_+3A_calibration_half_width">calibration_half_width</code></td>
<td>
<p>Determines the period (in days)
from which reference data are selected (period
is 2*calibration_half_width).</p>
</td></tr>
<tr><td><code id="calibrate_carbon_+3A_force_cal_to_beginning">force_cal_to_beginning</code></td>
<td>
<p>Extend first calibration to the beginning
of the file? (default true)</p>
</td></tr>
<tr><td><code id="calibrate_carbon_+3A_force_cal_to_end">force_cal_to_end</code></td>
<td>
<p>Extend last calibration to the end of the file?
(default true)</p>
</td></tr>
<tr><td><code id="calibrate_carbon_+3A_gap_fill_parameters">gap_fill_parameters</code></td>
<td>
<p>Should function attempt to 'gap-fill' across a
bad calibration by carrying the last good calibration forward?
Implementation is fairly primitive currently, as it only carries
the last known good calibration that's available forward rather
than interpolating, etc. Default FALSE.</p>
</td></tr>
<tr><td><code id="calibrate_carbon_+3A_filter_ambient">filter_ambient</code></td>
<td>
<p>Apply the median absolute deviation filter (Brock 86)
to remove impulse spikes in output ambient data?
(logical; default true)</p>
</td></tr>
<tr><td><code id="calibrate_carbon_+3A_r2_thres">r2_thres</code></td>
<td>
<p>Minimum r2 threshold of an &quot;acceptable&quot; calibration. Acts to
remove calibration periods where a measurement error makes
relationship nonlinear. Default = 0.95</p>
</td></tr>
<tr><td><code id="calibrate_carbon_+3A_correct_ref_data">correct_ref_data</code></td>
<td>
<p>NEON has indicated there are a few instances where
reported d13C or CO2 reference values are wrong. If set to true,
correct known incorrect values. This argument will (hopefully,
eventually) go away after NEON has fixed the reference database.
Users will be warned prior to removal of this argument.</p>
</td></tr>
<tr><td><code id="calibrate_carbon_+3A_write_to_file">write_to_file</code></td>
<td>
<p>Write calibrated ambient data to file?
(Mostly used for testing)</p>
</td></tr>
<tr><td><code id="calibrate_carbon_+3A_remove_known_bad_months">remove_known_bad_months</code></td>
<td>
<p>There are a few site months with known
spectral issues where the isotope ratios are likely unrecoverable.
This parameter allows removal of these files, but allows them to
remain in archive.</p>
</td></tr>
<tr><td><code id="calibrate_carbon_+3A_plot_regression_data">plot_regression_data</code></td>
<td>
<p>Default false; this is useful for diagnostics.</p>
</td></tr>
<tr><td><code id="calibrate_carbon_+3A_plot_directory">plot_directory</code></td>
<td>
<p>Only used if plot_regression_data is TRUE, but specify
where to write out diagnostic plot of regression data.</p>
</td></tr>
<tr><td><code id="calibrate_carbon_+3A_avg">avg</code></td>
<td>
<p>The averaging interval to extract, in minutes. Default 6.</p>
</td></tr>
<tr><td><code id="calibrate_carbon_+3A_min_nobs">min_nobs</code></td>
<td>
<p>Minimum number of high-frequency observations to define
a peak.</p>
</td></tr>
<tr><td><code id="calibrate_carbon_+3A_standards">standards</code></td>
<td>
<p>Which reference gases (standards) to use? Default is all,
but can pass a subset of &quot;co2Low&quot;, &quot;co2Med&quot;, and &quot;co2High&quot; as a vector
to this argument as well.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The 'linreg' method simply takes measured and reference d13C and CO2 values
and generates a transfer function between them using <code>lm()</code>. For the
gain-and-offset method, d13C and CO2 values are converted to 12CO2 and 13CO2
mole fractions. Gain and offset parameters are calculated for each
isotopologue independently, and are analogous to regression slope and
intercepts, but jointly correct for CO2 concentration dependence
and place d13C values on the VPDB scale.
The gain and offset parameters are defined by:
</p>
<p style="text-align: center;"><code class="reqn">G = (X_{2,ref}-X_{1,ref})/(X_{2,meas}-X_{1,meas})</code>
</p>

<p style="text-align: center;"><code class="reqn">O = X_{2,ref}- G X_{2,meas}</code>
</p>

<p>Calibrated ambient isotopologues are then given as:
</p>
<p style="text-align: center;"><code class="reqn">X_{cal} = X_{meas} G + O</code>
</p>

<p>Measurements of reference materials were considered &quot;good&quot; if the following
conditions were met:
</p>

<ul>
<li><p> Measured CO2 concentrations were within 10 ppm
of known &quot;reference&quot; concentrations.
</p>
</li>
<li><p> Variance of the CO2 concentration in standard peak was &lt; 5 ppm.
</p>
</li>
<li><p> Measured d13C value must be within 5 per mil
of known &quot;reference&quot; d13C value.
</p>
</li></ul>

<p>The first two criteria are intended to filter out periods where there is
a clear issue with the gas delivery system (i.e., nearly empty gas tank,
problem with a valve in the manifold, etc.); the third criterion was adopted
after visual inspection of data timeseries revealed that often the first
standard measurement following an instrument issue had higher-than-expected
error. This criterion clips clearly poor values. Selection of these criteria
will become a function argument, and therefore customizable,
in a future release.
</p>
<p>The behavior of this function will be a bit different depending on what
is supplied as <code>inname</code>. If a single file is provided, the output will be
monthly. However, a list of files corresponding to a site can also be
provided, and then a single output file per site will be generated.
</p>


<h3>Value</h3>

<p>Returns nothing to the environment, but creates a new output HDF5
file containing calibrated carbon isotope values.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: fin &lt;- system.file('extdata',
'NEON.D15.ONAQ.DP4.00200.001.nsae.2019-05.basic.20201020T211037Z.packed.h5',
         package = 'NEONiso', mustWork = TRUE)
calibrate_carbon_bymonth(inname = fin, outname = 'out.h5',
         site = 'ONAQ', write_to_file = FALSE)
calibrate_carbon_bymonth(inname = fin, outname = 'out.h5',
         site = 'ONAQ', method = 'linreg', write_to_file = FALSE)
## End(Not run)

</code></pre>

<hr>
<h2 id='calibrate_water'>Calibrate NEON water isotope ratios using validation data sets.</h2><span id='topic+calibrate_water'></span>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt='[Experimental]' /></a>
This function uses NEON validation data to apply drift corrections to
measured ambient water isotope ratios. In brief, ambient water isotope
ratios are calibrated by generating regressions using reference water
measurements bracketing an ambient period. Three reference waters are
measured once per day, with several injections per reference water.
Due to memory effects, only the last three are used currently to generate
calibration equations. Regressions between measured d18O and d2H values
and NEON-provisioned known reference values are generated, and used to
calibrate the period of ambient measurements between them if the r2 of
the regression is greater than a threshold value (by default, this is 0.95).
Most of this function deals with selecting the appropriate calibration data
and determining calibration quality. This function also contains a wrapper
for <code>calibrate_ambient_water_linreg</code>, which calibrates the ambient
water data using the calibration parameters generated in this function.
This function also copies over data in the qfqm and ucrt hdf5 data groups.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calibrate_water(
  inname,
  outname,
  site,
  calibration_half_width = 14,
  filter_data = TRUE,
  force_cal_to_beginning = FALSE,
  force_cal_to_end = FALSE,
  r2_thres = 0.95,
  slope_tolerance = 9999,
  correct_ref_data = TRUE,
  write_to_file = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calibrate_water_+3A_inname">inname</code></td>
<td>
<p>Input file(s) that are to be calibrated. If a single file is
given, output will be a single file per site per month. If a
list of files corresponding to a timeseries at a given site
is provided, will calibrate the whole time series.</p>
</td></tr>
<tr><td><code id="calibrate_water_+3A_outname">outname</code></td>
<td>
<p>Name of the output file. (character)</p>
</td></tr>
<tr><td><code id="calibrate_water_+3A_site">site</code></td>
<td>
<p>Four-letter NEON code for site being processed.</p>
</td></tr>
<tr><td><code id="calibrate_water_+3A_calibration_half_width">calibration_half_width</code></td>
<td>
<p>Determines the range of standard measurements
to use in determining the calibration regression dataset. Creates
a moving window that is <code>2*calibration_half_width</code> days wide.
Default is set to 14 for a 28 day moving window.</p>
</td></tr>
<tr><td><code id="calibrate_water_+3A_filter_data">filter_data</code></td>
<td>
<p>Apply median absolute deviation filter from Brock 86 to
remove impulse spikes?</p>
</td></tr>
<tr><td><code id="calibrate_water_+3A_force_cal_to_beginning">force_cal_to_beginning</code></td>
<td>
<p>Extend first calibration to
the beginning of the file?</p>
</td></tr>
<tr><td><code id="calibrate_water_+3A_force_cal_to_end">force_cal_to_end</code></td>
<td>
<p>Extend last calibration to the end of the file?</p>
</td></tr>
<tr><td><code id="calibrate_water_+3A_r2_thres">r2_thres</code></td>
<td>
<p>Minimum r2 threshold of an &quot;acceptable&quot; calibration. Acts to
remove calibration periods where a measurement error makes
relationship nonlinear. Default = 0.95</p>
</td></tr>
<tr><td><code id="calibrate_water_+3A_slope_tolerance">slope_tolerance</code></td>
<td>
<p>How different from 1 should we allow
'passing' regression slopes to be? Experimental parameter,
off by default (e.g., default slope parameter = 9999)</p>
</td></tr>
<tr><td><code id="calibrate_water_+3A_correct_ref_data">correct_ref_data</code></td>
<td>
<p>There are a few instances where the reference d18O
and d2H values may have been switched, causing very anomalous
d-excess values. If TRUE, implement a switch that corrects this
issue.</p>
</td></tr>
<tr><td><code id="calibrate_water_+3A_write_to_file">write_to_file</code></td>
<td>
<p>Write calibrated ambient data to file?
(Mostly used for testing)</p>
</td></tr>
</table>


<h3>Details</h3>

<p><em>IMPORTANT NOTE</em> Currently this function does not apply a correction for
humidity dependence of Picarro isotopic measurements. This is because the
data to implement these corrections is not yet publicly available.
Caution is suggested when analyzing data at low humidities, below ~5000 ppm,
with likely higher biases at lower humidity values.
</p>
<p>Additionally, please note that this function is meant to work on <em>all</em> files
for a given site at the same time. A more flexible version that can handle
all files or monthly files will be added to a future release.
</p>


<h3>Value</h3>

<p>nothing to the workspace, but creates a new output file of
calibrated water isotope data.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>

<hr>
<h2 id='carbon_regression_plots'>Make plots of carbon calibration data for debugging</h2><span id='topic+carbon_regression_plots'></span>

<h3>Description</h3>

<p>Makes plots of carbon calibration data regressions, primarily for
debugging and validation purposes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>carbon_regression_plots(caldata, plot_filename, method, mtitle)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="carbon_regression_plots_+3A_caldata">caldata</code></td>
<td>
<p>Data frame corresponding to a specific calibration
period.</p>
</td></tr>
<tr><td><code id="carbon_regression_plots_+3A_plot_filename">plot_filename</code></td>
<td>
<p>What should the output file name for diagnostic plot be?</p>
</td></tr>
<tr><td><code id="carbon_regression_plots_+3A_method">method</code></td>
<td>
<p>Which method are we using? Currently works for gain/offset.</p>
</td></tr>
<tr><td><code id="carbon_regression_plots_+3A_mtitle">mtitle</code></td>
<td>
<p>Fed from above routine - what should the plot title be?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing to the environment, but a pdf plot to a file.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>

<hr>
<h2 id='convert_NEONhdf5_to_POSIXct_time'>Convert NEON HDF5 file time to POSIXct</h2><span id='topic+convert_NEONhdf5_to_POSIXct_time'></span>

<h3>Description</h3>

<p>Converts the date time string in NEON HDF5 files to a POSIXct object
for use in R.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>convert_NEONhdf5_to_POSIXct_time(intime)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="convert_NEONhdf5_to_POSIXct_time_+3A_intime">intime</code></td>
<td>
<p>Vector of datetimes in NEON data files (as string)
to convert to POSIXct class</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Vector of datetimes from NEON data file now in POSIXct format.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>convert_NEONhdf5_to_POSIXct_time("2019-06-01T12:00:00.000Z")
</code></pre>

<hr>
<h2 id='convert_POSIXct_to_NEONhdf5_time'>Convert a POSIXct object to the format used in NEON HDF5 files</h2><span id='topic+convert_POSIXct_to_NEONhdf5_time'></span>

<h3>Description</h3>

<p>Converts a POSIXct object back to the character format used by NEON in their
HDF eddy covariance files. Output format, using strptime syntax, is
%Y-%m-%dT%H:%M:%OSZ.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>convert_POSIXct_to_NEONhdf5_time(intime)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="convert_POSIXct_to_NEONhdf5_time_+3A_intime">intime</code></td>
<td>
<p>POSIXct vector to convert to NEON time format.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns character version of POSIXct object
matching NEON time variable format.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>convert_POSIXct_to_NEONhdf5_time(Sys.time())
</code></pre>

<hr>
<h2 id='correct_carbon_ref_cval'>correct_carbon_ref_cval</h2><span id='topic+correct_carbon_ref_cval'></span>

<h3>Description</h3>

<p>This ugly function is present out of necessity, and will
only exist for as long as it is necessary. It is an internal
correction within the NEONiso calibration routines that is
required as there are some mismatches between the 'true'
isotope reference values and those in the NEON HDF5 files.
NEON is working on correcting this, and after it has been
corrected, this function has no need to exist and will be
immediately deprecated. As a result, this function is
fairly messy but there is little incentive to improve it.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>correct_carbon_ref_cval(
  std_frame,
  site,
  omit_already_corrected = TRUE,
  co2_tol = 5,
  d13c_tol = 0.25
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="correct_carbon_ref_cval_+3A_std_frame">std_frame</code></td>
<td>
<p>Standard data frame to perform swap on.</p>
</td></tr>
<tr><td><code id="correct_carbon_ref_cval_+3A_site">site</code></td>
<td>
<p>NEON four letter site code.</p>
</td></tr>
<tr><td><code id="correct_carbon_ref_cval_+3A_omit_already_corrected">omit_already_corrected</code></td>
<td>
<p>Should we attempt correction, if it's
already been corrected in the raw files.</p>
</td></tr>
<tr><td><code id="correct_carbon_ref_cval_+3A_co2_tol">co2_tol</code></td>
<td>
<p>Tolerance to use to select co2 values that need to be
replaced, in ppm. Default = 5 ppm.</p>
</td></tr>
<tr><td><code id="correct_carbon_ref_cval_+3A_d13c_tol">d13c_tol</code></td>
<td>
<p>Tolerance to use to select d13C values that need to be
replaced, in ppm. Default = 0.25 per mil.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Current sites and time periods affected:
</p>


<h3>Value</h3>

<p>A data.frame, based on <code>std_frame</code>, where NEON-supplied
reference values have been corrected if a mismatch has previously
been identified.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>

<hr>
<h2 id='correct_carbon_ref_output'>Correct carbon ref output</h2><span id='topic+correct_carbon_ref_output'></span>

<h3>Description</h3>

<p>Corrects known mismatches in the database where standard values do not
actually match what they should in data files per calVal measurements.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>correct_carbon_ref_output(
  std_list,
  site,
  omit_already_corrected = TRUE,
  co2_tol = 5,
  d13c_tol = 0.25,
  ref_gas
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="correct_carbon_ref_output_+3A_std_list">std_list</code></td>
<td>
<p>List containing reference/validation gas measurements.</p>
</td></tr>
<tr><td><code id="correct_carbon_ref_output_+3A_site">site</code></td>
<td>
<p>Four-letter NEON site code.</p>
</td></tr>
<tr><td><code id="correct_carbon_ref_output_+3A_omit_already_corrected">omit_already_corrected</code></td>
<td>
<p>Skip correction if the reference gas
values have already been corrected in the files (default TRUE)
If you have older versions of the files, you may want to set
this to FALSE.</p>
</td></tr>
<tr><td><code id="correct_carbon_ref_output_+3A_co2_tol">co2_tol</code></td>
<td>
<p>Tolerance used to identify a mismatch in CO2 values. Will
correct measured CO2 values within +/- co2_tol within time period
identified as having incorrect reference values.</p>
</td></tr>
<tr><td><code id="correct_carbon_ref_output_+3A_d13c_tol">d13c_tol</code></td>
<td>
<p>Tolerance used to identify a mismatch in d13C values. Will
correct measured d13C values within +/- d13c_tol within time
period identified as having incorrect reference values.</p>
</td></tr>
<tr><td><code id="correct_carbon_ref_output_+3A_ref_gas">ref_gas</code></td>
<td>
<p>Which reference gas is being corrected? Expects &quot;co2High&quot;,
&quot;co2Med&quot;, or &quot;co2Low&quot;</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A version of std_list with corrected reference values.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>

<hr>
<h2 id='delta_to_R'>Converts delta value to heavy-to-light isotope ratio</h2><span id='topic+delta_to_R'></span>

<h3>Description</h3>

<p>Converts a delta value (in per mil) to the heavy-to-light
isotope ratio.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>delta_to_R(delta_values, element)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="delta_to_R_+3A_delta_values">delta_values</code></td>
<td>
<p>A vector of isotope ratios in delta notation.</p>
</td></tr>
<tr><td><code id="delta_to_R_+3A_element">element</code></td>
<td>
<p>Which element to return R values -
carbon, oxygen, or hydrogen.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Vector of isotope ratios (R values).
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>delta_to_R(delta_values = 0, element = 'oxygen') # 2005.2e-6 for VSMOW.

</code></pre>

<hr>
<h2 id='estimate_calibration_error'>Produce estimates of the calibration error.</h2><span id='topic+estimate_calibration_error'></span>

<h3>Description</h3>

<p>Estimate calibration error using a 5-fold cross-validation. A 5-fold
cross-validation was chosen as each calibration window should have
at least 6 data points (e.g., if only daily validation data are used for the
calibration) and therefore this ensures that the cross-validation should
always run. Model is fit using <code>lm</code> and the <code>caret</code> package, with
root-mean-square error (RMSE), the R-squared value, and mean-absolute
error (MAE) extracted from the cross-validation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate_calibration_error(formula, data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="estimate_calibration_error_+3A_formula">formula</code></td>
<td>
<p>Formula to pass to caret::train to perform cross validation.</p>
</td></tr>
<tr><td><code id="estimate_calibration_error_+3A_data">data</code></td>
<td>
<p>Data frame to perform cross-validation on.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>

<hr>
<h2 id='extract_carbon_cal_data'>Extract only the data corresponding to validation/calibration time periods.</h2><span id='topic+extract_carbon_cal_data'></span>

<h3>Description</h3>

<p>Extracts data matching a value of &quot;co2Low,&quot; &quot;co2Med,&quot; or &quot;co2High&quot; which
correspond to the validation gases of known CO2, d13C that are fed to the
analyzer daily.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_carbon_cal_data(
  data_list,
  standards = c("co2Low", "co2Med", "co2High")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="extract_carbon_cal_data_+3A_data_list">data_list</code></td>
<td>
<p>List containing data, from the /*/dp01/data/
group in NEON HDF5 file.</p>
</td></tr>
<tr><td><code id="extract_carbon_cal_data_+3A_standards">standards</code></td>
<td>
<p>Which reference gases (standards) to use? Default is all,
but can pass a subset of &quot;co2Low&quot;, &quot;co2Med&quot;, and &quot;co2High&quot; as a vector
to this argument as well.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns data frame of required variables.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>

<hr>
<h2 id='extract_water_calibration_data'>Extract only the data corresponding to validation/calibration time periods.</h2><span id='topic+extract_water_calibration_data'></span>

<h3>Description</h3>

<p>Extracts data matching a value of &quot;h2oLow,&quot; &quot;h2oMed,&quot; or &quot;h2oHigh&quot; which
correspond to the validation gases of known d18O, d2H that are fed to the
analyzer daily.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extract_water_calibration_data(data_list)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="extract_water_calibration_data_+3A_data_list">data_list</code></td>
<td>
<p>List containing data, from the /*/dp01/data/
group in NEON HDF5 file.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns data frame of required variables.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>

<hr>
<h2 id='filter_median_brock86'>Apply a median absolute deviation filter</h2><span id='topic+filter_median_brock86'></span>

<h3>Description</h3>

<p>Median absolute deviation filter of Brock 1986, with user specified
width and magnitude thresholds.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>filter_median_brock86(data, width = 7, threshold = 5)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="filter_median_brock86_+3A_data">data</code></td>
<td>
<p>Vector to filter.</p>
</td></tr>
<tr><td><code id="filter_median_brock86_+3A_width">width</code></td>
<td>
<p>Width of filter, in rows.</p>
</td></tr>
<tr><td><code id="filter_median_brock86_+3A_threshold">threshold</code></td>
<td>
<p>Only filter values that are <code>abs(threshold)</code>
away from median</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns filtered vector.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>

<hr>
<h2 id='fit_carbon_regression'>Estimate slope/intercept of carbon isotope calibration regression</h2><span id='topic+fit_carbon_regression'></span>

<h3>Description</h3>

<p>Performs regression between measured and known carbon isotope and mole
fractions to generate a transfer function and associated uncertainty
estimates using both 5-fold and leave-one-out cross-validation methods.
Regression occurs either on 12CO2/13CO2 mole fractions (gainoffset method)
or on the CO2 and d13C values (linreg).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_carbon_regression(
  ref_data,
  method,
  calibration_half_width,
  plot_regression_data = FALSE,
  plot_dir = "/dev/null",
  site,
  min_nobs = NA
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fit_carbon_regression_+3A_ref_data">ref_data</code></td>
<td>
<p>Reference data.frame from which to estimate
calibration parameters.</p>
</td></tr>
<tr><td><code id="fit_carbon_regression_+3A_method">method</code></td>
<td>
<p>Are we using the gain-and-offset method
(&quot;gainoffset&quot;), formerly called the Bowling et al. 2003 method
in this package, or direct linear regression of
d13C and CO2 mole fractions (&quot;linreg&quot;)?</p>
</td></tr>
<tr><td><code id="fit_carbon_regression_+3A_calibration_half_width">calibration_half_width</code></td>
<td>
<p>Determines the period (in days)
from which reference data are selected (period
is 2*calibration_half_width).</p>
</td></tr>
<tr><td><code id="fit_carbon_regression_+3A_plot_regression_data">plot_regression_data</code></td>
<td>
<p>True or false - should we plot the data used in
the regression? Useful for debugging.</p>
</td></tr>
<tr><td><code id="fit_carbon_regression_+3A_plot_dir">plot_dir</code></td>
<td>
<p>If plot_regression_data is true, where should the
plots be saved?</p>
</td></tr>
<tr><td><code id="fit_carbon_regression_+3A_site">site</code></td>
<td>
<p>Needed for regression plots.</p>
</td></tr>
<tr><td><code id="fit_carbon_regression_+3A_min_nobs">min_nobs</code></td>
<td>
<p>Minimum number of high-frequency observations
to define a peak.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a data.frame of calibration parameters. If
<code>method == "gainoffset"</code>, then data.frame includes
gain and offset parameters for 12CO2 and 13CO2, and r^2
values for each regression. If <code>method == "linreg"</code>,
then data.frame includes slope, intercept, and r^2 values
for d13C and CO2 values.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>

<hr>
<h2 id='fit_water_regression'>Estimate slope/intercept of water isotope calibration regression</h2><span id='topic+fit_water_regression'></span>

<h3>Description</h3>

<p>Performs regression between measured and known carbon isotope and mole
fractions to generate a transfer function and associated uncertainty
estimates using both 5-fold and leave-one-out cross-validation methods.
Regression occurs on d18O and d2H values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_water_regression(
  ref_data,
  calibration_half_width,
  slope_tolerance,
  r2_thres,
  plot_regression_data = FALSE,
  plot_dir = "/dev/null",
  site,
  min_nobs = NA
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="fit_water_regression_+3A_ref_data">ref_data</code></td>
<td>
<p>Reference data.frame from which to estimate
calibration parameters.</p>
</td></tr>
<tr><td><code id="fit_water_regression_+3A_calibration_half_width">calibration_half_width</code></td>
<td>
<p>Determines the period (in days)
from which reference data are selected (period
is 2*calibration_half_width).</p>
</td></tr>
<tr><td><code id="fit_water_regression_+3A_slope_tolerance">slope_tolerance</code></td>
<td>
<p>Allows for filtering of slopes that deviate
from 1 by slope_tolerance.</p>
</td></tr>
<tr><td><code id="fit_water_regression_+3A_r2_thres">r2_thres</code></td>
<td>
<p>What is the minimum r2 value permitted in a 'useful'
calibration relationship.</p>
</td></tr>
<tr><td><code id="fit_water_regression_+3A_plot_regression_data">plot_regression_data</code></td>
<td>
<p>True or false - should we plot the data used in
the regression? Useful for debugging.</p>
</td></tr>
<tr><td><code id="fit_water_regression_+3A_plot_dir">plot_dir</code></td>
<td>
<p>If plot_regression_data is true, where should the
plots be saved?</p>
</td></tr>
<tr><td><code id="fit_water_regression_+3A_site">site</code></td>
<td>
<p>Needed for regression plots.</p>
</td></tr>
<tr><td><code id="fit_water_regression_+3A_min_nobs">min_nobs</code></td>
<td>
<p>Minimum number of high-frequency observations to
define a peak.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a data.frame of calibration parameters.
Output data.frame includes slope, intercept, and r^2 values
for d13C and CO2 values.
</p>

<hr>
<h2 id='get_Rstd'>Return heavy-to-light isotope ratio of primary standard.</h2><span id='topic+get_Rstd'></span>

<h3>Description</h3>

<p>Returns the heavy-to-light isotope ratio of the dominant
standard for that element. Vienna Standard Mean Ocean Water
(VSMOW) for oxygen and hydrogen isotopes, Vienna Pee Dee
Belemnite (VPDB) for carbon stable isotopes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_Rstd(element)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_Rstd_+3A_element">element</code></td>
<td>
<p>Which element to return standard ratio -
carbon, oxygen, or hydrogen.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Heavy-to-light isotope ratio of most common
stable isotope standard. VSMOW for water,
VPDB for carbon.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>get_Rstd("carbon") # returns 0.0111797
get_Rstd("oxygen") # returns 2005.20e-6

</code></pre>

<hr>
<h2 id='ingest_data'>Ingest and stack variables needed in calibration.</h2><span id='topic+ingest_data'></span>

<h3>Description</h3>

<p>Opens and stacks isotope ratio and water/carbon dioxide mole fraction
variables from monthly HDF5 files. If a new enough version of <code>neonUtilities</code>
is available, this function will try to use <code>fasttime</code> in order to accelerate
data stacking.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ingest_data(inname, analyte, name_fix = TRUE, amb_avg, ref_avg)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ingest_data_+3A_inname">inname</code></td>
<td>
<p>A file (or list of files) to extract data from for calibration.</p>
</td></tr>
<tr><td><code id="ingest_data_+3A_analyte">analyte</code></td>
<td>
<p>Carbon (Co2) or water (H2o)?</p>
</td></tr>
<tr><td><code id="ingest_data_+3A_name_fix">name_fix</code></td>
<td>
<p>Fix to data frame required for next-generation calibration
functions, but breaks old 'by_month()' functions. This
parameter provides a necessary work around until these
functions are removed.</p>
</td></tr>
<tr><td><code id="ingest_data_+3A_amb_avg">amb_avg</code></td>
<td>
<p>The averaging interval of the ambient data to extract.</p>
</td></tr>
<tr><td><code id="ingest_data_+3A_ref_avg">ref_avg</code></td>
<td>
<p>The averaging interval of the reference data to extract.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of data frames, taken from files specified in <code>inname</code>
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>

<hr>
<h2 id='loocv'>Leave-one-out cross validation</h2><span id='topic+loocv'></span>

<h3>Description</h3>

<p>Calculate analytic leave-one-out cross variance error estimate
</p>


<h3>Usage</h3>

<pre><code class='language-R'>loocv(mod)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="loocv_+3A_mod">mod</code></td>
<td>
<p>Fitted model to estimate leave-one-out CV on.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>

<hr>
<h2 id='manage_local_EC_archive'>Manage a local eddy covariance (EC) data archive.</h2><span id='topic+manage_local_EC_archive'></span>

<h3>Description</h3>

<p>Utility function to help retrieve new EC data and/or prune duplicates,
as NEON provisions new data or re-provisions data for an existing site
and month.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>manage_local_EC_archive(
  file_dir,
  get = TRUE,
  unzip_files = TRUE,
  trim = FALSE,
  dry_run = TRUE,
  sites = "all",
  release = "RELEASE-2024"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="manage_local_EC_archive_+3A_file_dir">file_dir</code></td>
<td>
<p>Specify the root directory where the local EC store is kept.</p>
</td></tr>
<tr><td><code id="manage_local_EC_archive_+3A_get">get</code></td>
<td>
<p>Pull down data from NEON API that does not exist locally?</p>
</td></tr>
<tr><td><code id="manage_local_EC_archive_+3A_unzip_files">unzip_files</code></td>
<td>
<p>NEON gzips the hdf5 files, should we unzip any gzipped
files within file_dir? (Searches recursively)</p>
</td></tr>
<tr><td><code id="manage_local_EC_archive_+3A_trim">trim</code></td>
<td>
<p>Search through local holdings, and remove older file where
there are duplicates?</p>
</td></tr>
<tr><td><code id="manage_local_EC_archive_+3A_dry_run">dry_run</code></td>
<td>
<p>List files identified as duplicates, but do not actually
delete them? Default true to prevent unintended data loss.</p>
</td></tr>
<tr><td><code id="manage_local_EC_archive_+3A_sites">sites</code></td>
<td>
<p>Which sites to retrieve data from? Default will be all sites
with available data, but can specify a single site or a vector
here.</p>
</td></tr>
<tr><td><code id="manage_local_EC_archive_+3A_release">release</code></td>
<td>
<p>Download data corresponding to a specific release? Defaults
to &quot;RELEASE-2024.&quot; To download all data, including provisional
data, set to NULL.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns nothing to the environment, but will download new NEON HDF5
files for selected sites (if <code>get = TRUE</code>), unzip them in the local
file directory (if <code>unzip_files = TRUE</code>), and identify and remove
suspected duplicate files (if <code>trim = TRUE</code> and <code>dry_run = FALSE</code>).
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>

<hr>
<h2 id='R_to_delta'>Convert heavy-to-light isotope ratio to delta values.</h2><span id='topic+R_to_delta'></span>

<h3>Description</h3>

<p>Converts a heavy-to-light stable isotope ratio to
a corresponding delta value, in per mil values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>R_to_delta(R_values, element)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="R_to_delta_+3A_r_values">R_values</code></td>
<td>
<p>A vector of isotope ratios (e.g., R values).</p>
</td></tr>
<tr><td><code id="R_to_delta_+3A_element">element</code></td>
<td>
<p>Which element to return delta values -
carbon, oxygen, or hydrogen.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Vector of isotope ratios in delta notation.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>R_to_delta(R_values = 2005.20e-6, element = 'oxygen') # returns 0.
</code></pre>

<hr>
<h2 id='restructure_carbon_variables'>Restructure ingested variables for the carbon isotope system.</h2><span id='topic+restructure_carbon_variables'></span>

<h3>Description</h3>

<p>Restructures carbon isotope measurement system variables and shortens names
to simplify referencing variables elsewhere in calibration code.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>restructure_carbon_variables(dataframe, varname, mode, group)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="restructure_carbon_variables_+3A_dataframe">dataframe</code></td>
<td>
<p>Input data.frame, from <code>neonUtilities::stackEddy</code></p>
</td></tr>
<tr><td><code id="restructure_carbon_variables_+3A_varname">varname</code></td>
<td>
<p>Which variable are we applying this function to? There's
a list of ~10 common ones to write to the hdf5 file.</p>
</td></tr>
<tr><td><code id="restructure_carbon_variables_+3A_mode">mode</code></td>
<td>
<p>Are we fixing a reference data frame or an ambient data frame?</p>
</td></tr>
<tr><td><code id="restructure_carbon_variables_+3A_group">group</code></td>
<td>
<p>Data, ucrt, or qfqm?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame formatted for output to hdf5 file.
</p>

<hr>
<h2 id='restructure_variables'>Restructures data.frames imported by ingest_data to shorten variable names
and  Wrapper function around restructure_carbon_variables
and restructure_water_variables.</h2><span id='topic+restructure_variables'></span>

<h3>Description</h3>

<p>Restructures data.frames imported by ingest_data to shorten variable names
and  Wrapper function around restructure_carbon_variables
and restructure_water_variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>restructure_variables(dataframe, varname, mode, group, species)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="restructure_variables_+3A_dataframe">dataframe</code></td>
<td>
<p>Input data.frame, from <code>neonUtilities::stackEddy</code></p>
</td></tr>
<tr><td><code id="restructure_variables_+3A_varname">varname</code></td>
<td>
<p>Which variable are we applying this function to? There's
a list of ~10 common ones to write to the hdf5 file.</p>
</td></tr>
<tr><td><code id="restructure_variables_+3A_mode">mode</code></td>
<td>
<p>Are we fixing a reference data frame or an ambient data frame?</p>
</td></tr>
<tr><td><code id="restructure_variables_+3A_group">group</code></td>
<td>
<p>Data, ucrt, or qfqm?</p>
</td></tr>
<tr><td><code id="restructure_variables_+3A_species">species</code></td>
<td>
<p>Set to 'Co2' for carbon; 'H2o' for water</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame formatted for output to hdf5 file.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>

<hr>
<h2 id='restructure_water_variables'>Restructure ingested variables for the water isotope system.</h2><span id='topic+restructure_water_variables'></span>

<h3>Description</h3>

<p>Restructures water isotope measurement system variables and shortens names
to simplify referencing variables elsewhere in calibration code.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>restructure_water_variables(dataframe, varname, mode, group)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="restructure_water_variables_+3A_dataframe">dataframe</code></td>
<td>
<p>Input data.frame, from <code>neonUtilities::stackEddy</code></p>
</td></tr>
<tr><td><code id="restructure_water_variables_+3A_varname">varname</code></td>
<td>
<p>Which variable are we applying this function to? There's
a list of ~10 common ones to write to the hdf5 file.</p>
</td></tr>
<tr><td><code id="restructure_water_variables_+3A_mode">mode</code></td>
<td>
<p>Are we fixing a reference data frame or an ambient data frame?</p>
</td></tr>
<tr><td><code id="restructure_water_variables_+3A_group">group</code></td>
<td>
<p>Data, ucrt, or qfqm?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame formatted for output to hdf5 file.
</p>

<hr>
<h2 id='select_daily_reference_data'>Select validation data corresponding to a particular day</h2><span id='topic+select_daily_reference_data'></span>

<h3>Description</h3>

<p>Select validation data corresponding to a particular day
</p>


<h3>Usage</h3>

<pre><code class='language-R'>select_daily_reference_data(standard_df, analyte, min_nobs = NA)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="select_daily_reference_data_+3A_standard_df">standard_df</code></td>
<td>
<p>Input reference data.frame.</p>
</td></tr>
<tr><td><code id="select_daily_reference_data_+3A_analyte">analyte</code></td>
<td>
<p>Are we calibrating CO2 and H2O?
(Use argument 'co2' or 'h2o', or else function will throw error)</p>
</td></tr>
<tr><td><code id="select_daily_reference_data_+3A_min_nobs">min_nobs</code></td>
<td>
<p>Minimum number of high-frequency
observations to define a peak. If not supplied,
defaults are 200 for <code>analyte = 'co2'</code> or 30 for
<code>analyte = 'h2o'</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>Smaller data.frame where only the reference data selected
to use in the calibration routines is returned. Assumes that we are
calibrating on a daily basis, and not on a longer time scale. Data
are selected based on two criteria: cannot be missing, and must be
at least a certain number of high-frequency observations in order to
qualify as a valid measurement. For the water system, this function
also keeps only the last three injections for each reference water
per day.
</p>

<hr>
<h2 id='setup_output_file'>Structure a new HDF5 file</h2><span id='topic+setup_output_file'></span>

<h3>Description</h3>

<p>Creates a skeleton HDF5 file for the calibrated data,
essentially setting up the HDF5 groups at the /site/dp01/{data,ucrt,qfqm}
level.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>setup_output_file(inname, outname, site, analyte)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="setup_output_file_+3A_inname">inname</code></td>
<td>
<p>Input file name.</p>
</td></tr>
<tr><td><code id="setup_output_file_+3A_outname">outname</code></td>
<td>
<p>Output file name.</p>
</td></tr>
<tr><td><code id="setup_output_file_+3A_site">site</code></td>
<td>
<p>NEON 4-letter site code.</p>
</td></tr>
<tr><td><code id="setup_output_file_+3A_analyte">analyte</code></td>
<td>
<p>Carbon ('Co2') or water ('H2o') system?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing to the environment, but creates a new data file
with the most basic output HDF5 structure consistent with
NEON's data files.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>

<hr>
<h2 id='swap_standard_isotoperatios'>swap_standard_isotoperatios</h2><span id='topic+swap_standard_isotoperatios'></span>

<h3>Description</h3>

<p>There are a few suspected instances where the water
isotope ratios for oxygen and hydrogen have been flipped
in the reference data. This function corrects them until
they are corrected in the NEON database using a d-excess
filter.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>swap_standard_isotoperatios(std_frame, dxs_thres = 500)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="swap_standard_isotoperatios_+3A_std_frame">std_frame</code></td>
<td>
<p>Standard data frame to perform swap on.</p>
</td></tr>
<tr><td><code id="swap_standard_isotoperatios_+3A_dxs_thres">dxs_thres</code></td>
<td>
<p>d-excess threshold to indicate when to swap.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame based on <code>std_frame</code>, where d18O and
d2H values have been swapped from NEON input files if
determined to have a reference value mismatch. Mismatch
is determined based on the d-excess of the standard (=
d2H - 8*d18O), using a value of 500 by default.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>

<hr>
<h2 id='terrestrial_core_sites'>List terrestrial core sites</h2><span id='topic+terrestrial_core_sites'></span>

<h3>Description</h3>

<p>Returns a vector of four-letter NEON site codes for the
core terrestrial sites that have TIS instrumentation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>terrestrial_core_sites()
</code></pre>


<h3>Value</h3>

<p>A vector listing NEON core terrestrial sites.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>terrestrial_core_sites()
</code></pre>

<hr>
<h2 id='terrestrial_gradient_sites'>List terrestrial gradient sites</h2><span id='topic+terrestrial_gradient_sites'></span>

<h3>Description</h3>

<p>Returns a vector of four-letter NEON site codes for the
gradient terrestrial sites that have TIS instrumentation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>terrestrial_gradient_sites()
</code></pre>


<h3>Value</h3>

<p>A vector listing NEON gradient terrestrial sites.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>terrestrial_gradient_sites()
</code></pre>

<hr>
<h2 id='validate_analyte'>Standardize analyte names</h2><span id='topic+validate_analyte'></span>

<h3>Description</h3>

<p>Enforces standard capitalization and formatting of H2o and Co2
analyte names across calibration functions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>validate_analyte(analyte)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="validate_analyte_+3A_analyte">analyte</code></td>
<td>
<p>Co2 or H2o?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Standardized string for the water ('H2o') or
carbon ('Co2') systems to make sure strings
are standardized across package functions.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>

<hr>
<h2 id='validate_output_file'>Validate output file.</h2><span id='topic+validate_output_file'></span>

<h3>Description</h3>

<p>Function ensures that the output file has the correct
groups in it, as a check to ensure proper file structure at the
end of the calibration routines.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>validate_output_file(inname, outname, site, analyte)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="validate_output_file_+3A_inname">inname</code></td>
<td>
<p>Input file name.</p>
</td></tr>
<tr><td><code id="validate_output_file_+3A_outname">outname</code></td>
<td>
<p>Output file name.</p>
</td></tr>
<tr><td><code id="validate_output_file_+3A_site">site</code></td>
<td>
<p>NEON 4-letter site code.</p>
</td></tr>
<tr><td><code id="validate_output_file_+3A_analyte">analyte</code></td>
<td>
<p>Carbon ('Co2') or water ('H2o') system?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing to environment, simply checks to make sure expected groups
are in output.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>

<hr>
<h2 id='water_isotope_sites'>List sites with water vapor isotope ratios.</h2><span id='topic+water_isotope_sites'></span>

<h3>Description</h3>

<p>Returns a vector of four-letter NEON site codes for the
terrestrial sites that have water vapor isotope ratio instrumentation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>water_isotope_sites()
</code></pre>


<h3>Value</h3>

<p>A vector listing NEON sites measuring water vapor isotope ratios.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>water_isotope_sites()
</code></pre>

<hr>
<h2 id='write_carbon_ambient_data'>Write calibrated carbon ambient data to file</h2><span id='topic+write_carbon_ambient_data'></span>

<h3>Description</h3>

<p>Write out ambient observations from the NEON EC
towers where the isotope data (either H2O or CO2)
have been calibrated using this package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_carbon_ambient_data(outname, site, amb_data_list, to_file = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="write_carbon_ambient_data_+3A_outname">outname</code></td>
<td>
<p>Output file name.</p>
</td></tr>
<tr><td><code id="write_carbon_ambient_data_+3A_site">site</code></td>
<td>
<p>NEON 4-letter site code.</p>
</td></tr>
<tr><td><code id="write_carbon_ambient_data_+3A_amb_data_list">amb_data_list</code></td>
<td>
<p>Calibrated list of ambient data -
this is the output from one of the calibrate_ambient_carbon* functions.</p>
</td></tr>
<tr><td><code id="write_carbon_ambient_data_+3A_to_file">to_file</code></td>
<td>
<p>Write to file (TRUE) or to environment (FALSE).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing to the environment, but writes data in amb_data_list to file.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>

<hr>
<h2 id='write_carbon_calibration_data'>Write carbon calibrations to file</h2><span id='topic+write_carbon_calibration_data'></span>

<h3>Description</h3>

<p>Write a <code>data.frame</code> with slope, intercepts, and error estimates of
calibrations for carbon isotope system. If <code>gainoffset</code> method was used
the slopes/intercepts are called gain/offsets for each isotopologue.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_carbon_calibration_data(outname, site, cal_df, method, to_file = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="write_carbon_calibration_data_+3A_outname">outname</code></td>
<td>
<p>Output file name.</p>
</td></tr>
<tr><td><code id="write_carbon_calibration_data_+3A_site">site</code></td>
<td>
<p>NEON 4-letter site code.</p>
</td></tr>
<tr><td><code id="write_carbon_calibration_data_+3A_cal_df">cal_df</code></td>
<td>
<p>Calibration data frame -
this is the output from fit_carbon_regression</p>
</td></tr>
<tr><td><code id="write_carbon_calibration_data_+3A_method">method</code></td>
<td>
<p>Was the Bowling et al. 2003 or the linear regression
method used in fit_carbon_regression?</p>
</td></tr>
<tr><td><code id="write_carbon_calibration_data_+3A_to_file">to_file</code></td>
<td>
<p>Write to file (TRUE) or to environment (FALSE).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing to the environment, but writes out the
calibration parameters (e.g., gain and offset or
regression slopes and intercepts) to the output
hdf5 file.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>

<hr>
<h2 id='write_water_ambient_data'>Write calibrated ambient water isotope ratio observations to file.</h2><span id='topic+write_water_ambient_data'></span>

<h3>Description</h3>

<p>Write out ambient observations from the NEON EC
towers where the isotope data
have been calibrated using this package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_water_ambient_data(outname, site, amb_data_list)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="write_water_ambient_data_+3A_outname">outname</code></td>
<td>
<p>Output file name.</p>
</td></tr>
<tr><td><code id="write_water_ambient_data_+3A_site">site</code></td>
<td>
<p>NEON 4-letter site code.</p>
</td></tr>
<tr><td><code id="write_water_ambient_data_+3A_amb_data_list">amb_data_list</code></td>
<td>
<p>Calibrated list of ambient data -
this is the output from one of the calibrate_ambient_water* functions.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing to the environment, but writes data in amb_data_list to file.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>

<hr>
<h2 id='write_water_calibration_data'>Write water calibration parameters to file</h2><span id='topic+write_water_calibration_data'></span>

<h3>Description</h3>

<p>Write a <code>data.frame</code> with slope, intercepts, and error estimates of
calibrations for water isotope system.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_water_calibration_data(outname, site, cal_df)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="write_water_calibration_data_+3A_outname">outname</code></td>
<td>
<p>Output file name.</p>
</td></tr>
<tr><td><code id="write_water_calibration_data_+3A_site">site</code></td>
<td>
<p>NEON 4-letter site code.</p>
</td></tr>
<tr><td><code id="write_water_calibration_data_+3A_cal_df">cal_df</code></td>
<td>
<p>Calibration data frame -
this is the output from fit_water_regression</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Nothing to the environment, but writes out the
calibration parameters (e.g.,
regression slopes and intercepts) to the output
hdf5 file.
</p>


<h3>Author(s)</h3>

<p>Rich Fiorella <a href="mailto:rfiorella@lanl.gov">rfiorella@lanl.gov</a>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
