<!DOCTYPE html><html lang="en"><head><title>Help for package MChtest</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {MChtest}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#MChtest-package'>
<p>Monte Carlo hypothesis tests allowing sequential stopping</p></a></li>
<li><a href='#beta.ratio'><p>Calculation Ratio of two Beta functions</p></a></li>
<li><a href='#find.ab'><p>Find beta parameters to approximate distribution of p-values.</p></a></li>
<li><a href='#find.cb'><p> Finds cb=Kstar for B-value stopping rule</p></a></li>
<li><a href='#findB.design'><p>Calculates B-value stopping boundary</p></a></li>
<li><a href='#MCbound'><p>Create Monte Carlo stopping boundary</p></a></li>
<li><a href='#MCbound.precalc1'><p> Precalculated object of class MCbound</p></a></li>
<li><a href='#MCbound.type'><p>Create Monte Carlo Stopping Boundary: functions by type</p></a></li>
<li><a href='#MCtest'><p>Perform Monte Carlo hypothesis tests.</p></a></li>
<li><a href='#MCtest.default'><p>Internal function to calculation MC test</p></a></li>
<li><a href='#mult'><p>Calculation to Convert Stored cb values to K values.</p></a></li>
<li><a href='#p1.given.p0'><p>Find p0 (or p1) associated with p1 (or p0) that gives minimax tsprt</p></a></li>
<li><a href='#plot.MCbound'><p>Plot stopping boundary</p></a></li>
<li><a href='#print.MCtest'><p> prints objects of the class MCtest</p></a></li>
<li><a href='#rrisk'><p>Calculate resampling risk and expected resampling size</p></a></li>
<li><a href='#sorttheta'><p>Sort stopping boundary by standard ordering</p></a></li>
<li><a href='#tSPRT.to.Bvalue'><p>Convert between MCbound parameterizations</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Monte Carlo Hypothesis Tests with Sequential Stopping</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0-3</td>
</tr>
<tr>
<td>Date:</td>
<td>2019-05-14</td>
</tr>
<tr>
<td>Author:</td>
<td>Michael P. Fay</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Michael P. Fay &lt;mfay@niaid.nih.gov&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>stats</td>
</tr>
<tr>
<td>Description:</td>
<td>Performs Monte Carlo hypothesis tests, allowing a couple of different sequential stopping boundaries. For example, a truncated sequential probability ratio test boundary (Fay, Kim and Hachey, 2007 &lt;<a href="https://doi.org/10.1198%2F106186007X257025">doi:10.1198/106186007X257025</a>&gt;) and a boundary proposed by Besag and Clifford, 1991 &lt;<a href="https://doi.org/10.1093%2Fbiomet%2F78.2.301">doi:10.1093/biomet/78.2.301</a>&gt;. Gives valid p-values and confidence intervals on p-values.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL]</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://www.niaid.nih.gov/about/brb-staff-fay">https://www.niaid.nih.gov/about/brb-staff-fay</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2019-05-15 13:13:49 UTC; faym</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2019-05-16 13:10:03 UTC</td>
</tr>
</table>
<hr>
<h2 id='MChtest-package'>
Monte Carlo hypothesis tests allowing sequential stopping
</h2><span id='topic+MChtest-package'></span><span id='topic+MChtest'></span>

<h3>Description</h3>

<p>Performs Monte Carlo hypothesis tests. It allows a couple of different sequential 
stopping boundaries (a truncated sequential probability ratio test boundary and a boundary proposed 
by Besag and Clifford, 1991). Gives valid p-values and confidence intervals on p-values.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> MChtest</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.0-3</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2019-05-14</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>Use <code><a href="#topic+MCbound">MCbound</a></code> to create sequential stopping boundaries. These may take considerable set-up time, but once the 
stopping boundary is calculated then it can be used in <code><a href="#topic+MCtest">MCtest</a></code> to save time in computation of Monte Carlo 
hypothesis tests. The idea of the truncated sequential probability ratio test boundary is that it takes many resamples if 
the true p-value (i.e., the one from an infinite resample size) is close to the significance level (e.g., 0.05), 
but takes much fewer if the true p-value is far from the significance level.
</p>


<h3>Author(s)</h3>

<p>Michael P. Fay
</p>
<p>Maintainer: Michael P. Fay &lt;mfay@niaid.nih.gov&gt;
</p>


<h3>References</h3>

<p>Besag, J. and Clifford, P. (1991). Sequential Monte Carlo p-values. Biometrika. 78: 301-304.
</p>
<p>Fay, M.P., Kim, H-J. and Hachey, M. (2007). Using truncated sequential probability ratio test boundaries 
for Monte Carlo implementation of hypothesis tests. Journal of Computational and Graphical 
Statistics. 16(4):946-967. 
</p>


<h3>See Also</h3>

<p> Precalculated MCbound: <code><a href="#topic+MCbound.precalc1">MCbound.precalc1</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'>## Create a stopping boundary
##### May take a long time if Nmax is large
B&lt;-MCbound("tsprt",c(alpha0=.001,beta0=.01,Nmax=99,p0=.04,p1=.06))
## do Monte Carlo  test
x&lt;-data.frame(y=1:100,z=rnorm(100),group=c(rep(1,50),rep(2,50)))
stat&lt;-function(x){ cor(x[,1],x[,2]) }
### nonparametric bootstrap test on correlation between y and z
### low p-value means that such a large correlation unlikely due to chance
resamp&lt;-function(x){ n&lt;-dim(x)[[1]] ; x[sample(1:n,replace=TRUE),] }
MCtest(x,stat,resamp,bound=B) 
## Package comes with a large precalculated MC bound as the default
## the precalculated bound is good for testing at the 0.05 level
MCtest(x,stat,resamp)
</code></pre>

<hr>
<h2 id='beta.ratio'>Calculation Ratio of two Beta functions</h2><span id='topic+beta.ratio'></span>

<h3>Description</h3>

<p>beta.ratio(a,b,x,y) = beta(a,b)/beta(x,y), where beta(a,b)=(gamma(a)*gamma(b))/gamma(a+b)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>beta.ratio(a, b, x, y)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="beta.ratio_+3A_a">a</code></td>
<td>
<p> a numeric object</p>
</td></tr>
<tr><td><code id="beta.ratio_+3A_b">b</code></td>
<td>
<p> a numeric object </p>
</td></tr>
<tr><td><code id="beta.ratio_+3A_x">x</code></td>
<td>
<p> a numeric object </p>
</td></tr>
<tr><td><code id="beta.ratio_+3A_y">y</code></td>
<td>
<p> a numeric object</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function was created to avoid underflow problems when both beta(a,b) and beta(x,y) are very small.
Recall for integers i and j, beta(i+1,j+1) = <code class="reqn"> \frac{(i!j!)}{(i+j+1)!}</code>
</p>


<h3>Value</h3>

<p>a numeric value representing the ratio of two beta functions</p>


<h3>Author(s)</h3>

<p>Michael P. Fay</p>


<h3>See Also</h3>

 <p><code><a href="base.html#topic+beta">beta</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'>### The following equals 1001/1000=1.001
beta.ratio(999,1001,1000,1000)
### does not get the answer exactly correct
## but it is better than
## the following 
beta(999,1001)/beta(1000,1000)
</code></pre>

<hr>
<h2 id='find.ab'>Find beta parameters to approximate distribution of p-values.</h2><span id='topic+find.ab'></span>

<h3>Description</h3>

<p>Find parameters of a beta distribution to approximate distribution of a p-value derived from a 
normal test statistic with one-sided significance level=ALPHA and power=1-BETA.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>find.ab(n = 1e+05, ALPHA = 0.05, BETA = 0.2, higha = 100)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="find.ab_+3A_n">n</code></td>
<td>
<p>the number of divisions for the numeric integration used to estimate the mean of p-value distribution, H (see details). </p>
</td></tr>
<tr><td><code id="find.ab_+3A_alpha">ALPHA</code></td>
<td>
<p> one-sided significance level of normal test statistic </p>
</td></tr>
<tr><td><code id="find.ab_+3A_beta">BETA</code></td>
<td>
<p> type II error for normal test stastic </p>
</td></tr>
<tr><td><code id="find.ab_+3A_higha">higha</code></td>
<td>
<p>an upper bound on the beta parameter (see details).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The cumulative distribution function of the p-value from a normally distributed test statistic with one-sided significance level=ALPHA 
and power=1-BETA is H(p) = 1-pnorm( qnorm(1-p) - qnorm(1-ALPHA)+qnorm(BETA) ).
We approximate this distribution with a beta distribution, B, which has the same mean as H and has B(ALPHA)=1-BETA.
If two beta distributions meet both those criteria, we select the one closest to H in terms of integrated square error
of the cumulative distribution function. That error is estimated by the sample variance of the differences in the two CDFs
evaluated at (0:n)/n. Note that the two beta distributions come from the two roots of the following function: 
1-BETA - B(ALPHA)
We search for those two roots as the beta parameter within the range (1/higha, higha).
</p>


<h3>Value</h3>

<p>A list with two elements:
</p>
<table role = "presentation">
<tr><td><code>a</code></td>
<td>
<p>numeric value of one of the shape parameters of the beta distribution </p>
</td></tr>
<tr><td><code>b</code></td>
<td>
<p>numeric value of the other shape parameter of the beta distribution </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>M.P. Fay</p>


<h3>References</h3>

<p> Fay, M.P., and Follmann, D.A. (2002). &quot;Designing Monte Carlo implementations of 
permutation or bootstrap hypothesis tests&quot; American Statistician, 56: 63-70.</p>


<h3>Examples</h3>

<pre><code class='language-R'>## See first line of Table 1, Fay and Follmann, 2002 
find.ab(ALPHA=.05,BETA=.1)
</code></pre>

<hr>
<h2 id='find.cb'> Finds cb=Kstar for B-value stopping rule </h2><span id='topic+find.cb'></span>

<h3>Description</h3>

<p>Kstar=cb is the number of ways to get to each point in the stopping boundary times 
times beta(S+1,N-S+1). Called by <code><a href="#topic+MCbound.tsprt">MCbound.tsprt</a></code> or <code><a href="#topic+MCbound.Bvalue">MCbound.Bvalue</a></code></p>


<h3>Usage</h3>

<pre><code class='language-R'>find.cb(theta)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="find.cb_+3A_theta">theta</code></td>
<td>
<p>a matrix of 2 columns, first column is S second is N</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with components
</p>
<table role = "presentation">
<tr><td><code>w</code></td>
<td>
<p>S</p>
</td></tr>
<tr><td><code>m</code></td>
<td>
<p>N</p>
</td></tr>
<tr><td><code>cb</code></td>
<td>
<p>Kstar</p>
</td></tr>
<tr><td><code>done</code></td>
<td>
<p>logical</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Michael Fay</p>

<hr>
<h2 id='findB.design'>Calculates B-value stopping boundary</h2><span id='topic+findB.design'></span>

<h3>Description</h3>

<p>Internal function called by MCbound. Note same function also calculates stopping boundary for 
truncated sequential probability ratio test</p>


<h3>Author(s)</h3>

<p>M.P.Fay</p>

<hr>
<h2 id='MCbound'>Create Monte Carlo stopping boundary</h2><span id='topic+MCbound'></span>

<h3>Description</h3>

<p>Creates one of several different types of Monte Carlo stopping boundaries
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MCbound(type, parms, conf.level = 0.99)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="MCbound_+3A_type">type</code></td>
<td>
<p>a character vector of type of boundary, possible values: &quot;fixed&quot;, &quot;tsprt&quot;,&quot;Bvalue&quot;, and &quot;BC&quot;</p>
</td></tr>
<tr><td><code id="MCbound_+3A_parms">parms</code></td>
<td>
<p>a numeric vector of parameter values, different for each type (see details)</p>
</td></tr>
<tr><td><code id="MCbound_+3A_conf.level">conf.level</code></td>
<td>
<p>confidence level for intervals about Monte Carlo p-values</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Create Monte Carlo stopping boundaries for use with <code><a href="#topic+MCtest">MCtest</a></code>, where we keep resampling until hitting 
the stopping boundary. There are several possible types, each with a different length parameter vector. 
</p>

<table>
<tr>
 <td style="text-align: left;">
type="fixed"  </td><td style="text-align: left;"> then names(parms)=c("Nmax") </td>
</tr>
<tr>
 <td style="text-align: left;">
type="tsprt"  </td><td style="text-align: left;"> then names(parms)=c("p0","p1","A","B","Nmax") </td>
</tr>
<tr>
 <td style="text-align: left;">
              </td><td style="text-align: left;">  or  names(parms)=c("p0","p1","alpha0","beta0","Nmax") </td>
</tr>
<tr>
 <td style="text-align: left;">
type="Bvalue"  </td><td style="text-align: left;"> then names(parms)=c("Nmax","alpha","e0","e1") </td>
</tr>
<tr>
 <td style="text-align: left;"> 
type="BC"      </td><td style="text-align: left;"> then names(parms)=c("Nmax","Smax") </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>The object parms should be a named vector, although unnamed vectors will work if the parameters are in the above order 
(for the tsprt it assumes the first parameterization). For type=&quot;fixed&quot; we keep reampling until N=Nmax resamples. 
For type=&quot;tsprt&quot; we keep resampling until stopping for a truncated sequential probability ratio test for  a 
binary parmaeter. The parameterizations are the usual Wald notation, except alpha0=alpha and beta0=beta, where 
A=(1-beta0)/alpha0 and B=beta0/(1-alpha0). The Bvalue is a test that p=alpha or not and we stop if the B-value
at information time t, B(t), is B(t)<code class="reqn">&lt;=</code> qnorm(e0) or B <code class="reqn">&gt;=</code>qnorm(1-e1). Note that the B-value stopping boundary is 
just a reparameterization of the truncated sequential probability ratio test. For type=&quot;BC&quot; we keep resampling 
until N=Nmax or S=Smax following a design recommended by Besag and Clifford (1991). For each stopping boundary 
we calculate valid p-values at each stopping point ordering by S/N. For details see Fay, Kim and Hachey, 2006. 
</p>


<h3>Value</h3>

<p> An object of class MCbound.
A list with the following elements:
</p>
<table role = "presentation">
<tr><td><code>S</code></td>
<td>
<p>number of sucesses at points on the boundary</p>
</td></tr>
<tr><td><code>N</code></td>
<td>
<p>number of resamples at points on the boundary</p>
</td></tr>
<tr><td><code>p.value</code></td>
<td>
<p>valid p-value at each point on boundary, calculated using ordering by S/N</p>
</td></tr>
<tr><td><code>ci.lower</code></td>
<td>
<p>lower confidence limit of p-value at each boundary point</p>
</td></tr>
<tr><td><code>ci.upper</code></td>
<td>
<p>upper confidence limit of p-value at each boundary point</p>
</td></tr>
<tr><td><code>Kstar</code></td>
<td>
<p>number of ways to reach each point, (S,N), on boundary times beta(S+1,N-S+1) </p>
</td></tr>
<tr><td><code>conf.level</code></td>
<td>
<p>confidence level for intervals on p-values</p>
</td></tr>
<tr><td><code>type</code></td>
<td>
<p>type of boundary: either &quot;fixed&quot;, &quot;tsprt&quot;, &quot;Bvalue&quot; or &quot;BC&quot;</p>
</td></tr>
<tr><td><code>parms</code></td>
<td>
<p>parameter vector that defines boundary (see details) </p>
</td></tr>  
</table>


<h3>Author(s)</h3>

<p>Michael P. Fay</p>


<h3>References</h3>

<p>Besag, J. and Clifford, P. (1991). Sequential Monte Carlo p-values. Biometrika. 78: 301-304.
</p>
<p>Fay, M.P., Kim, H-J. and Hachey, M. (2007). Using truncated sequential probability ratio test boundaries 
for Monte Carlo implementation of hypothesis tests. Journal of Computational and Graphical 
Statistics. 16(4):946-967. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>MCbound("tsprt",c(alpha0=.001,beta0=.01,Nmax=99,p0=.06,p1=.04))
</code></pre>

<hr>
<h2 id='MCbound.precalc1'> Precalculated object of class MCbound</h2><span id='topic+MCbound.precalc1'></span>

<h3>Description</h3>

<p>Because the calculation of this truncated sequential probability ratio test stopping boundary
takes a long time, it is calculated ahead of time and included in the package. 
It is created with the following code, 
<code>MCbound("tsprt",parms=c(p0=p0.given.p1(0.04),p1=0.04,alpha0=.0001,beta0=0.0001,Nmax=9999),conf.level=.99)</code>. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MCbound.precalc1</code></pre>


<h3>Format</h3>

<p>The format is:
List of 10
</p>

<ul>
<li><p>S         : num [1:10000] 22 22 22 22 22 22 22 22 22 22 ...
</p>
</li>
<li><p>N         : num [1:10000] 22 23 24 25 26 27 28 29 30 31 ...
</p>
</li>
<li><p>p.value : num [1:10000] 1.000 0.957 0.917 0.880 0.846 ...
</p>
</li>
<li><p>ci.lower  : num [1:10000] 0.786 0.719 0.668 0.626 0.590 ...
</p>
</li>
<li><p>ci.upper  : num [1:10000] 1.000 1.000 0.995 0.985 0.972 ...
</p>
</li>
<li><p>Kstar     : num [1:10000] 0.0435 0.0399 0.0367 0.0338 0.0313 ...
</p>
</li>
<li><p>conf.level: num 0.99
</p>
</li>
<li><p>type      : chr &quot;tsprt&quot;
</p>
</li>
<li><p>parms     : Named num [1:5] 6.14e-02 4.00e-02 1.00e-04 1.00e-04 1.00e+04
</p>
</li>
<li><p>   ..- attr(*, &quot;names&quot;)= chr [1:5] &quot;p0&quot; &quot;p1&quot; &quot;alpha0&quot; &quot;beta0&quot; ...
</p>
</li>
<li><p>check      : num 1
</p>
</li>
<li><p> - attr(*, &quot;class&quot;)= chr &quot;MCbound&quot;
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>plot(MCbound.precalc1) 
</code></pre>

<hr>
<h2 id='MCbound.type'>Create Monte Carlo Stopping Boundary: functions by type</h2><span id='topic+MCbound.type'></span><span id='topic+MCbound.fixed'></span><span id='topic+MCbound.tsprt'></span><span id='topic+MCbound.Bvalue'></span><span id='topic+MCbound.BC'></span>

<h3>Description</h3>

<p>These functions are called by <code><a href="#topic+MCbound">MCbound</a></code>, see that help for details.
</p>


<h3>Author(s)</h3>

<p>Michael P. Fay</p>

<hr>
<h2 id='MCtest'>Perform Monte Carlo hypothesis tests.</h2><span id='topic+MCtest'></span><span id='topic+MCtest.fixed'></span>

<h3>Description</h3>

<p>Performs Monte Carlo hypothesis test with either a fixed number of resamples or a sequential stopping boundary on
the number of resamples. Outputs p-value and confidence 
interval for p-value. The program is very general and different bootstrap or permutation tests may be done 
by defining the statistic function and the resample function. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MCtest(x, statistic, resample, bound, extreme = "geq", seed = 1234325)
MCtest.fixed(x, statistic, resample, Nmax, extreme = "geq", 
    conf.level=.99, seed = 1234325)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="MCtest_+3A_x">x</code></td>
<td>
<p>data object</p>
</td></tr>
<tr><td><code id="MCtest_+3A_statistic">statistic</code></td>
<td>
<p>function that inputs data object, x, and outputs a scalar numeric</p>
</td></tr>
<tr><td><code id="MCtest_+3A_resample">resample</code></td>
<td>
<p>function that inputs data object,x, and outputs a &quot;resampling&quot; of x, 
an object of the same type as x</p>
</td></tr>
<tr><td><code id="MCtest_+3A_nmax">Nmax</code></td>
<td>
<p>the number of resamples for the fixed boundary</p>
</td></tr>
<tr><td><code id="MCtest_+3A_bound">bound</code></td>
<td>
<p>a object of class MCbound, can be created by <code><a href="#topic+MCbound">MCbound</a></code> see that help</p>
</td></tr>
<tr><td><code id="MCtest_+3A_extreme">extreme</code></td>
<td>
<p>character value either &quot;geq&quot; or &quot;leq&quot;. 
Defines which Monte Carlo outputs from statistic (T1,T2,...) are denoted extreme with respect to the original 
output (T0) ; extreme values are either all Ti &gt;= T0 (&quot;geq&quot;) or all Ti &lt;= T0 (&quot;leq&quot;). </p>
</td></tr> 
<tr><td><code id="MCtest_+3A_conf.level">conf.level</code></td>
<td>
<p>confidence level for interval about p-value</p>
</td></tr>
<tr><td><code id="MCtest_+3A_seed">seed</code></td>
<td>
<p>a numeric value used in set.seed</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Performs Monte Carlo hypothesis test. <code>MCtest</code> allows any types of Monte Carlo boundary created by <code><a href="#topic+MCbound">MCbound</a></code>,
while <code>MCtest.fixed</code> only performs Monte Carlo tests using fixed boundaries. The only advantage of <code>MCtest.fixed</code>
is that one can do the test without first creating the fixed stopping boundary through <code>MCbound</code>. The default boundary 
is described in <code><a href="#topic+MCbound.precalc1">MCbound.precalc1</a></code>. 
</p>
<p>Let T0=statistic(x) and let T1,T2,... be statistic(resample(x)). Then in the simplest type of boundary, 
the &quot;fixed&quot; type, then the resulting p-value is p=(S+1)/(N+1), where S=(\# Ti &gt;= T0) (if extreme is &quot;geq&quot;) or  
S=(\# Ti &lt;= T0) (if extreme is &quot;leq&quot;). The confidence interval on the p-value is calculated by an exact method.  
</p>
<p>There are several different types of MC designs that may be used for the MCtest. These are described in the 
<code><a href="#topic+MCbound">MCbound</a></code> help.
</p>


<h3>Value</h3>

<p>A LIST of class &quot;MCtest&quot;,with elements:
</p>
<table role = "presentation">
<tr><td><code>Ti</code></td>
<td>
<p>an N vector of the outputs of the resampled statistic</p>
</td></tr>
<tr><td><code>type</code></td>
<td>
<p>type of boundary: &quot;fixed&quot;, &quot;tsprt&quot;, &quot;Bvalue&quot; or &quot;BC&quot;</p>
</td></tr>
<tr><td><code>parms</code></td>
<td>
<p>vector of parameters that define boundary specified by type</p>
</td></tr>
<tr><td><code>T0</code></td>
<td>
<p>the value of the test statistic applied to the original data</p>
</td></tr>
<tr><td><code>p.value</code></td>
<td>
<p>p.value</p>
</td></tr>
<tr><td><code>pvalue.ci</code></td>
<td>
<p>confidence interval about the p-value</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>M.P. Fay</p>


<h3>References</h3>

 
<p>Fay, M.P., Kim, H-J. and Hachey, M. (2007). Using truncated sequential probability ratio test boundaries 
for Monte Carlo implementation of hypothesis tests. Journal of Computational and Graphical 
Statistics. 16(4):946-967. 
</p>


<h3>See Also</h3>

<p><code><a href="#topic+MCbound">MCbound</a></code>,<code><a href="#topic+MCbound.precalc1">MCbound.precalc1</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'>x&lt;-data.frame(y=1:100,z=rnorm(100),group=c(rep(1,50),rep(2,50)))
stat&lt;-function(x){ cor(x[,1],x[,2]) }
### nonparametric bootstrap test on correlation between y and z
### low p-value means that such a large correlation unlikely due to chance
resamp&lt;-function(x){ n&lt;-dim(x)[[1]] ; x[sample(1:n,replace=TRUE),] }
out&lt;-MCtest(x,stat,resamp,extreme="geq") 
out$p.value
out$p.value.ci
### permutation test, permuting y only within group
resamp&lt;-function(x){ 
    ug&lt;-unique(x[,"group"])
    y&lt;- x[,"y"]
    for (i in 1:length(ug)){
         pick.strata&lt;- x[,"group"]==ug[i]
         y[pick.strata]&lt;-sample(y[pick.strata],replace=FALSE)
    }
    x[,1]&lt;-y
    x 
}

out&lt;-MCtest.fixed(x,stat,resamp,N=199) 
out$p.value
out$p.value.ci
</code></pre>

<hr>
<h2 id='MCtest.default'>Internal function to calculation MC test</h2><span id='topic+MCtest.default'></span>

<h3>Description</h3>

<p>Called by <code><a href="#topic+MCtest">MCtest</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>MCtest.default(x, statistic, resample, bound, extreme = "geq", seed = 1234325)
</code></pre>


<h3>Arguments</h3>

<p>See <code><a href="#topic+MCtest">MCtest</a></code>
</p>


<h3>Author(s)</h3>

<p>M.P. Fay</p>


<h3>See Also</h3>

  <p><code><a href="#topic+MCtest">MCtest</a></code></p>

<hr>
<h2 id='mult'>Calculation to Convert Stored cb values to K values.</h2><span id='topic+mult'></span>

<h3>Description</h3>

<p> Calculates <code class="reqn"> \frac{(p^r)* ( (1-p)^(n-r) )}{ \beta(r,n-r)}</code>. This calculation is used to convert stored cb 
values to K values in MCdesign objects.
For internal use only. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mult(n, r, p)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mult_+3A_n">n</code></td>
<td>
<p> numeric </p>
</td></tr>
<tr><td><code id="mult_+3A_r">r</code></td>
<td>
<p> numeric </p>
</td></tr>
<tr><td><code id="mult_+3A_p">p</code></td>
<td>
<p> numeric </p>
</td></tr>
</table>


<h3>Value</h3>

<p> numeric value equal to 
<code class="reqn">\frac{(p^r)* ( (1-p)^(n-r) )}{ \beta(r,n-r)}</code>. 
</p>


<h3>Author(s)</h3>

<p>M.P. Fay</p>

<hr>
<h2 id='p1.given.p0'>Find p0 (or p1) associated with p1 (or p0) that gives minimax tsprt</h2><span id='topic+p1.given.p0'></span><span id='topic+p0.given.p1'></span>

<h3>Description</h3>

<p> Consider the SPRT for testing Ho:p=p0 vs H1:p=p1 where  p1<code class="reqn">&lt;</code> Alpha <code class="reqn">&lt;</code> p0. 
For Monte Carlo tests, we want to reject and conclude that p<code class="reqn">&lt;</code>Alpha. In terms of the 
resampling risk at p (i.e., the probability of reaching a wrong decision at p) the minimax 
SPRT has a particular relationship between p0 and p1. Here we calculate p1 given p0 or vise versa 
to obtain that relationship. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>p1.given.p0(p0, Alpha = 0.05, TOL = 10^-9)
p0.given.p1(p1, Alpha = 0.05, TOL = 10^-9)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="p1.given.p0_+3A_p0">p0</code></td>
<td>
<p>null such that p0<code class="reqn">&gt;</code>Alpha</p>
</td></tr>
<tr><td><code id="p1.given.p0_+3A_p1">p1</code></td>
<td>
<p>alternative such that p1<code class="reqn">&lt;</code>Alpha</p>
</td></tr>
<tr><td><code id="p1.given.p0_+3A_alpha">Alpha</code></td>
<td>
<p>want tsprt associated with testing p=Alpha or not</p>
</td></tr>
<tr><td><code id="p1.given.p0_+3A_tol">TOL</code></td>
<td>
<p>tolerance level input into call to <code><a href="stats.html#topic+uniroot">uniroot</a></code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>either p0 or p1</p>


<h3>Author(s)</h3>

<p>Michael P. Fay</p>


<h3>References</h3>

<p>Fay, M.P., Kim, H-J. and Hachey, M. (2007). Using truncated sequential probability ratio test boundaries 
for Monte Carlo implementation of hypothesis tests. Journal of Computational and Graphical 
Statistics. 16(4):946-967. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>p1.given.p0(.04)
</code></pre>

<hr>
<h2 id='plot.MCbound'>Plot stopping boundary</h2><span id='topic+plot.MCbound'></span>

<h3>Description</h3>

<p>Creates two plots of an object of class <code><a href="#topic+MCbound">MCbound</a></code>, an stopping boundary for use with Monte Carlo hypothesis tests. 
First, it plots the stopping boundary as number of replications (i.e., N)
vs. number of sucesses (S). Second, it plots the estimated p-values
vs. the confidence limits minus the estimated p-values (this nicely shows the width of the confidence intervals). </p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'MCbound'
plot(x, rdigit=4, plimit=500,...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.MCbound_+3A_x">x</code></td>
<td>
<p>an object of class MCbound</p>
</td></tr>
<tr><td><code id="plot.MCbound_+3A_rdigit">rdigit</code></td>
<td>
<p>the rounding digit for the parms values in the title</p>
</td></tr>
<tr><td><code id="plot.MCbound_+3A_plimit">plimit</code></td>
<td>
<p>if the number of points in the MCbound is &gt;plimit then plot lines, otherwise plot points</p>
</td></tr>
<tr><td><code id="plot.MCbound_+3A_...">...</code></td>
<td>
<p>additional arguments to both plot functions</p>
</td></tr>
</table>


<h3>Value</h3>

<p> Does not return any values. Does two plots only.
</p>


<h3>Author(s)</h3>

<p> M.P. Fay </p>


<h3>See Also</h3>

 <p><code><a href="#topic+MCbound">MCbound</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'>plot(MCbound.precalc1)
</code></pre>

<hr>
<h2 id='print.MCtest'> prints objects of the class MCtest </h2><span id='topic+print.MCtest'></span>

<h3>Description</h3>

<p> prints objects of the class MCtest 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'MCtest'
print(x,...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.MCtest_+3A_x">x</code></td>
<td>
<p> object of class MCtest</p>
</td></tr>
<tr><td><code id="print.MCtest_+3A_...">...</code></td>
<td>
<p>arguments passed to the print function for the parameter vector</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Michael Fay</p>

<hr>
<h2 id='rrisk'>Calculate resampling risk and expected resampling size</h2><span id='topic+rrisk'></span>

<h3>Description</h3>

<p>Calculates for a particular stopping boundary the resampling risk of making the wrong 
accept/reject decision. Can be calculated for different distributions of the p-value.
If type=&quot;p&quot; then assume point mass at pparms. If type=&quot;b&quot; then assume a beta distribution
with two shape parameters given by pparms.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rrisk(bound, pparms, sig.level = 0.05, type = "b")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rrisk_+3A_bound">bound</code></td>
<td>
<p>an object of class MCbound, i.e., a stopping boundary. See <code><a href="#topic+MCbound">MCbound</a></code> to create</p>
</td></tr>
<tr><td><code id="rrisk_+3A_pparms">pparms</code></td>
<td>
<p>either a vector of possible point mass p-value distributions (type=&quot;p&quot;), or a vector (or matrix with two columns) representing two beta shape parameters (type=&quot;b&quot;)</p>
</td></tr>
<tr><td><code id="rrisk_+3A_sig.level">sig.level</code></td>
<td>
<p>significance level for defining resampling risk</p>
</td></tr>
<tr><td><code id="rrisk_+3A_type">type</code></td>
<td>
<p>either &quot;p&quot; for point mass p-value distributions, or &quot;b&quot; for a beta distribution</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The resampling risk (RR) is defined as the probability of making an accept/reject decision different from complete enumeration.
In other words, for any Monte Carlo test the true p-value for any data is either below the sig.level (reject the null) or above
the sig.level (accept the null), and the RR is the probability of either deciding p&lt;=sig.level when p&gt;sig.level or vise versa.
We also calculate the expected resampling size for the assumed distributions on the p-values. As a check of the MCbound, we sum 
the probability of stopping at any point in the boundary over the entire stopping boundary for each assumed distribution on the 
p-values; the ouput value check should give a vector of all ones if the MCbound is calculated correctly. 
</p>


<h3>Value</h3>

<p>A list with the following elements:
</p>
<table role = "presentation">
<tr><td><code>check</code></td>
<td>
<p>Sum of the probabilities of the stopping boundary corresponding to the p-value distribution(s). Should be a vector with all values equal to 1.</p>
</td></tr>
<tr><td><code>rr</code></td>
<td>
<p>resampling risk corresponding to the p-value distribution(s)</p>
</td></tr>
<tr><td><code>EN</code></td>
<td>
<p>expected resampling size corresponding to the p-value distribution(s)</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Michael P. Fay</p>


<h3>References</h3>

<p>Fay, M.P., Kim, H-J. and Hachey, M. (2007). Using truncated sequential probability ratio test boundaries 
for Monte Carlo implementation of hypothesis tests. Journal of Computational and Graphical 
Statistics. 16(4):946-967. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>### caculate resampling risk and E(N) under null, i.e., uniform distribution on p-values 
rrisk(MCbound.precalc1,c(1,1))
</code></pre>

<hr>
<h2 id='sorttheta'>Sort stopping boundary by standard ordering</h2><span id='topic+sorttheta'></span>

<h3>Description</h3>

<p>Called by <code><a href="#topic+MCbound.Bvalue">MCbound.Bvalue</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sorttheta(theta)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="sorttheta_+3A_theta">theta</code></td>
<td>
<p>theta is a matrix with columns equal to the S and N values at the stopping boundary</p>
</td></tr>
</table>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>theta</code></td>
<td>
<p>sorted theta</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Michael P. Fay</p>

<hr>
<h2 id='tSPRT.to.Bvalue'>Convert between MCbound parameterizations</h2><span id='topic+tSPRT.to.Bvalue'></span><span id='topic+Bvalue.to.tSPRT'></span>

<h3>Description</h3>

<p>Convert from the tSPRT to the Bvalue parametrization or vice versa. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tSPRT.to.Bvalue(parms)
Bvalue.to.tSPRT(parms,p0,TOL=10^-8)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="tSPRT.to.Bvalue_+3A_parms">parms</code></td>
<td>
<p> named vector of parameters </p>
</td></tr>
<tr><td><code id="tSPRT.to.Bvalue_+3A_p0">p0</code></td>
<td>
<p> To pick a unique parameterization of the type tSPRT, you must specify p0</p>
</td></tr>
<tr><td><code id="tSPRT.to.Bvalue_+3A_tol">TOL</code></td>
<td>
<p>tolerance for solution of <code><a href="#topic+p1.given.p0">p1.given.p0</a></code> </p>
</td></tr>
</table>


<h3>Value</h3>

<p>Parameter vector of other parameterization. 
</p>


<h3>Note</h3>

 <p><code>tsprt.to.Bvalue</code> called by <code><a href="#topic+MCbound">MCbound</a></code> when type=&quot;tsprt&quot;. 
</p>


<h3>Author(s)</h3>

<p>Michael P. Fay</p>


<h3>See Also</h3>

<p><code><a href="#topic+MCbound">MCbound</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>temp&lt;-tSPRT.to.Bvalue(c(p0=.04,p1=p1.given.p0(.04),alpha0=.001,beta0=.001,Nmax=9999))
temp
Bvalue.to.tSPRT(temp,p0=.04)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
