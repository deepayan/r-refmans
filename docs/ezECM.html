<!DOCTYPE html><html lang="en"><head><title>Help for package ezECM</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ezECM}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#BayesECM'><p>Bayesian Event Matrix Categorization</p></a></li>
<li><a href='#becm_decision'><p>B-ECM performance metrics</p></a></li>
<li><a href='#cECM'><p>Multiple Discriminant Analysis</p></a></li>
<li><a href='#cECM_decision'><p>Decision Function for the C-ECM Model</p></a></li>
<li><a href='#export_ecm'><p>Saving and loading fitted ECM models</p></a></li>
<li><a href='#import_pvals'><p>Import p-values</p></a></li>
<li><a href='#P_wave_gen'><p>Generation of noisy p-wave arrival times</p></a></li>
<li><a href='#plot.cECM'><p>Plot the data and output of <code>cECM()</code> categorization</p></a></li>
<li><a href='#predict.BayesECM'><p>New Event Categorization With Bayesian Inference</p></a></li>
<li><a href='#pval_gen'><p>Simulate p-values from earthquakes and explosions</p></a></li>
<li><a href='#summary.BayesECMpred'><p>Summary of Unlabeled Event Categorization</p></a></li>
<li><a href='#time_fn'><p>P-wave arrival times simulation</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Event Categorization Matrix Classification for Nuclear
Detonations</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Implementation of an Event Categorization Matrix (ECM) detonation detection model and a Bayesian variant. Functions are provided for importing and exporting data, fitting models, and applying decision criteria for categorizing new events. This package implements methods described in the paper "Bayesian Event Categorization Matrix Approach for Nuclear Detonations" Koermer, Carmichael, and Williams (2024) available on arXiv at &lt;<a href="https://doi.org/10.48550%2FarXiv.2409.18227">doi:10.48550/arXiv.2409.18227</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, kableExtra, testthat (&ge; 3.0.0),
LaplacesDemon</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Imports:</td>
<td>ellipse, graphics, grDevices, klaR, lhs, MCMCpack, Rdpack,
stats, utils, mvnfast</td>
</tr>
<tr>
<td>RdMacros:</td>
<td>Rdpack</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/lanl/ezECM">https://github.com/lanl/ezECM</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/lanl/ezECM/issues">https://github.com/lanl/ezECM/issues</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-10-16 21:50:21 UTC; skoermer</td>
</tr>
<tr>
<td>Author:</td>
<td>Scott Koermer <a href="https://orcid.org/0000-0002-0325-7034"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre, cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Scott Koermer &lt;skoermer@lanl.gov&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-10-17 17:10:01 UTC</td>
</tr>
</table>
<hr>
<h2 id='BayesECM'>Bayesian Event Matrix Categorization</h2><span id='topic+BayesECM'></span>

<h3>Description</h3>

<p>Training a Bayesian ECM (B-ECM) model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>BayesECM(
  Y,
  BT = c(100, 1000),
  priors = "default",
  verb = FALSE,
  transform = "logit"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="BayesECM_+3A_y">Y</code></td>
<td>
<p><code>data.frame</code> of training data, with rows corresponding to <code class="reqn">N</code> individual observations, and columns corresponding to <code class="reqn">p</code> discriminants.  An additional column named <code>"event"</code> is required, which labels each row with the known event category.  Missing data is specified with <code>NA</code>.  <code>dim(Y)</code> must equal <code>c(N, p + 1)</code>.</p>
</td></tr>
<tr><td><code id="BayesECM_+3A_bt">BT</code></td>
<td>
<p>integer vector of length 2, stipulating the number of <code>c("Burn-in", "Total")</code> Markov-Chain Monte-Carlo samples drawn.</p>
</td></tr>
<tr><td><code id="BayesECM_+3A_priors">priors</code></td>
<td>
<p>list of parameters to be used in prior distributions.  See details.</p>
</td></tr>
<tr><td><code id="BayesECM_+3A_verb">verb</code></td>
<td>
<p>logical.  A setting of <code>TRUE</code> prints a progress bar as samples are drawn, as well as warnings when they occur.</p>
</td></tr>
<tr><td><code id="BayesECM_+3A_transform">transform</code></td>
<td>
<p>character string specifying the transform to use on the elements of <code>Y</code> before fitting the model.  Options are <code>"logit"</code> and <code>"arcsin"</code> with <code>"logit"</code> being the default.  See details.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The output of <code>BayesECM()</code> provides a trained Bayesian Event Categorization Matrix (B-ECM) model, utilizing the data and prior parameter settings .  If there are missing values in <code>Y</code>, these values are imputed.  A trained <code>BayesECM</code> model is then used with the <code><a href="#topic+predict.BayesECM">predict.BayesECM()</a></code> function to calculate expected category probabilities.
</p>


<h4>Data Preparation</h4>

<p>Before the data in <code>Y</code> is used with the model, the p-values <code class="reqn">\in (0,1]</code> are transformed in an effort to better align the data with some properties of the normal distribution.  When <code>transform == "logit"</code> the inverse of the logistic function <code class="reqn">Y_{N \times p} = \log\left(\texttt{Y}\right) - \log\left(1-\texttt{Y}\right)</code> maps the values to the real number line.  Values of <code>Y</code> exactly equal to 0 or 1 cannot be used when <code>transform == "logit"</code>.  Setting the argument <code>transform == "arcsin"</code> uses the transformation <code class="reqn">Y_{N\times p} = 2/\pi \times \mathrm{arcsin}\sqrt{Y}</code> further described in Anderson et al. (2007).  From here forward, the variable <code class="reqn">Y_{N \times p}</code> should be understood to be the transformation of <code>Y</code>, where <code class="reqn">N</code> is the total number of rows in <code>Y</code> and <code class="reqn">p</code> is the number of discriminant columns in <code>Y</code>.
</p>



<h4>The Model</h4>

<p>The B-ECM model structure can be found in a future publication, with some details from this publication are reproduced here.
</p>
<p>B-ECM assumes that all data is generated using a mixture of <code class="reqn">K</code> normal distributions, where <code class="reqn">K</code> is equal to the number of unique event categories. Each component of the mixture has a unique mean of <code class="reqn">\mu_k</code>, and covariance of <code class="reqn">\Sigma_k</code>, where <code class="reqn">k \in \{1 , \dots , K\}</code> indexes the mixture component.  The likelihood of the <code class="reqn">i^{\mathrm{th}}</code> event observation <code class="reqn">y^i_p</code> of <code class="reqn">p</code> discriminants can be written as the sum below.
</p>
<p style="text-align: center;"><code class="reqn">\sum_{k = 1}^K \pi_k \mathcal{N}(y^i_p; \mu_k, \Sigma_k)</code>
</p>

<p>Each Gaussian distribution in the sum is weighted by the scalar variable <code class="reqn">\pi_k</code>, where <code class="reqn">\sum_{k=1}^K \pi_k =1</code> so that the density integrates to 1.
</p>
<p>There are prior distributions on each <code class="reqn">\mu_k, \Sigma_k</code>, and <code class="reqn">\pi</code>, where <code class="reqn">\pi</code> is the vector of mixture weights <code class="reqn">\{\pi_1, \dots , \pi_K\}</code>.  These prior distributions are detailed below.  These parameters are important for understanding the model, however they are integrated out analytically to reduce computation time, resulting in a marginal likelihood <code class="reqn">p(Y_{N_k \times p}|\eta_k, \Psi_k, \nu_k)</code> which is a mixture of matrix t-distributions.  <code class="reqn">Y_{N_k \times p}</code> is a matrix of the total data for the <code class="reqn">k^{\mathrm{th}}</code> event category containing <code class="reqn">N_k</code> total event observations for training.  The totality of the training data can be written as <code class="reqn">Y_{N \times p}</code>, where <code class="reqn">N = N_1 + \dots + N_K</code>.
</p>
<p><code>BayesECM()</code> can handle observations where some of the <code class="reqn">p</code> discriminants of an observation are missing.  The properties of the conditional matrix t-distribution are used to impute the missing values, thereby accounting for the uncertainty related to the missing data.
</p>



<h4>Prior Distributions</h4>

<p>The posterior distributions  <code class="reqn">p(\mu_k|Y_{N_k \times p}, \eta_k)</code>, <code class="reqn">p(\Sigma_k|Y_{N_k \times p}, \Psi_k, \nu_k)</code>, and <code class="reqn">p(\pi|Y_{N \times p}, \alpha)</code> are dependent on the specifications of prior distributions <code class="reqn">p(\mu_k|\Sigma_k, \eta_k)</code>, <code class="reqn">p(\Sigma_k| \Psi_k, \nu_k)</code>, and <code class="reqn">p(\pi|\alpha)</code>.
</p>
<p><code class="reqn">p(\mu_k|\Sigma_k, \eta_k)</code> is a multivariate normal distribution with a mean vector of <code class="reqn">\eta_k</code> and is conditional on the covariance <code class="reqn">\Sigma_k</code>.   <code class="reqn">p(\Sigma_k|\Psi_k, \nu_k)</code> is an <a href="https://en.wikipedia.org/wiki/Wishart_distribution">Inverse Wishart</a> distribution with degrees of freedom parameter <code class="reqn">\nu_k</code>, or <code>nu</code>, and scale matrix <code class="reqn">\Psi_k</code>, or <code>Psi</code>.  <code class="reqn">p(\pi|\alpha)</code> is a <a href="https://en.wikipedia.org/wiki/Dirichlet_distribution">Dirichlet distribution</a> with the parameter vector <code class="reqn">\alpha</code> of length <code class="reqn">K</code>.
</p>
<p>The ability to use <code>"default"</code> priors has been included for ease of use with various settings of the <code>priors</code> function argument.  The default prior hyperparameter values differ for the argument of <code>transform</code> used, and the values can be inspected by examining the output of the <code>BayesECM()</code> function.  Simply setting <code>priors = "default"</code> provides the same default values for all <code class="reqn">\eta_k, \Psi_k, \nu_k</code> in the mixture.  If all prior parameters are to be shared between all event categories, but some non-default values are desirable then supplying a list of a similar structure as <code>priors = list(eta = rep(0, times = ncol(Y) - 1), Psi = "default", nu = "default", alpha = 10)</code> can be used, where setting a list element <code>"default"</code> can be exchanged for the correct data structure for the relevant data structure.
</p>
<p>If one wishes to use some default values, but not share all parameter values between each event category, or wishes to specify each parameter value individually with no defaults, we suggest running and saving the output <code>BayesECM(Y = Y, BT = c(1,2))$priors</code>.  Note that when specifying <code>eta</code> or <code>Psi</code> it is necessary that the row and column order of the supplied values corresponds to the column order of <code>Y</code>.
</p>



<h3>Value</h3>

<p>Returns an object of <code>class("BayesECM")</code>.  If there are missing data in the supplied argument <code>Y</code> the object contains Markov-chain Monte-Carlo samples of the imputed missing data.  Prior distribution parameters used are always included in the output.  The primary use of an object returned from <code><a href="#topic+BayesECM">BayesECM()</a></code> is to later use this object to categorize unlabeled data with the <code><a href="#topic+predict.BayesECM">predict.BayesECM()</a></code> function.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
csv_use &lt;- "good_training.csv"
file_path &lt;- system.file("extdata", csv_use, package = "ezECM")
training_data &lt;- import_pvals(file = file_path, header = TRUE, sep = ",", training = TRUE)

trained_model &lt;- BayesECM(Y = training_data)


</code></pre>

<hr>
<h2 id='becm_decision'>B-ECM performance metrics</h2><span id='topic+becm_decision'></span>

<h3>Description</h3>

<p>Outputs batch performance metrics of decisions using the output of <code><a href="#topic+predict.BayesECM">predict.BayesECM()</a></code> when the true category of testing events are known.  Can be used for empirically comparing different model fits.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>becm_decision(
  bayes_pred = NULL,
  vic = NULL,
  cat_truth = NULL,
  alphatilde = 0.05,
  pn = TRUE,
  C = matrix(c(0, 1, 1, 0), ncol = 2),
  rej = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="becm_decision_+3A_bayes_pred">bayes_pred</code></td>
<td>
<p>An object of class <code>"BayesECMpred"</code> returned from the <code><a href="#topic+predict.BayesECM">predict.BayesECM()</a></code> function.  Data and order of data provided to <code><a href="#topic+predict.BayesECM">predict.BayesECM()</a></code> must match the order of the <code>cat_truth</code> argument.</p>
</td></tr>
<tr><td><code id="becm_decision_+3A_vic">vic</code></td>
<td>
<p>Character string, indicating the &quot;Very Important Category&quot; (<code>vic</code>) used for calculating categorization metrics.  The return of <code>becm_decision()</code> provides information on if new observations should be categorized into <code>vic</code> or the remainder of the training categories grouped together.</p>
</td></tr>
<tr><td><code id="becm_decision_+3A_cat_truth">cat_truth</code></td>
<td>
<p>Vector of the same length as <code>nrow(bayes_pred$Ytilde)</code>, where <code>Ytilde</code> was previously supplied to the <code><a href="#topic+predict.BayesECM">predict.BayesECM()</a></code> function.  Used for accuracy calculations of a <code>BayesECM</code> fit and decision criteria when the true category of the new observations are known.</p>
</td></tr>
<tr><td><code id="becm_decision_+3A_alphatilde">alphatilde</code></td>
<td>
<p>Numeric scalar between 0 and 1 used for the significance level of typicality indices.</p>
</td></tr>
<tr><td><code id="becm_decision_+3A_pn">pn</code></td>
<td>
<p>Logical.  Acronym for &quot;false Positive, false Negative&quot;. <code>pn == FALSE</code> indicates that only accuracy of categorizations should be returned, while <code>pn == TRUE</code> indicates that false positives and false negatives should be returned in addition to accuracy.</p>
</td></tr>
<tr><td><code id="becm_decision_+3A_c">C</code></td>
<td>
<p>Square matrix of dimension 2 or the number of categories.  Used as the loss function in the decision theoretic framework.  The default is 0-1 loss for binary categorization.</p>
</td></tr>
<tr><td><code id="becm_decision_+3A_rej">rej</code></td>
<td>
<p><code>data.frame</code> of rejection via typicality index retrieved from a previous call to <code>becm_decision()</code>.  Useful for saving computation time when comparing the results from different supplied matrices for argument <code>C</code>, while using a constant value of <code>alphatilde</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The matrix <code>C</code> specifies the loss for a set of categorization actions for a single new observation <code class="reqn">\tilde{y}_{\tilde{p}}</code> given the probability of <code class="reqn">\tilde{y}_{\tilde{p}}</code> belonging to each of <code class="reqn">K</code> categories.  Actions are specified as the columns, and the event category random variables are specified as the rows.  See the vignette <code>vignette("syn-data-code", package = "ezECM")</code> for more mathematical details.
</p>
<p>The dimension of matrix <code>C</code> specifies the categorization type.  A dimension of 2 is binary categorization, with the first column and row always corresponding to the category chosen as the <code>vic</code> argument.  Otherwise, when the dimension of <code>C</code> is equal to the number of categories, the indices of the rows and columns of <code>C</code> are in the same order as the categories listed for <code>names(bayes_pred$BayesECMfit$Y)</code>.
</p>


<h3>Value</h3>

<p>A list of two data frames of logicals.  The rows in each data frame correspond to the rows in <code>bayes_pred$Ytilde</code>.  The first data frame, named <code>results</code>, has three columns named <code>correct</code>, <code>fn</code>, and <code>fp</code>. The <code>results</code> column indicates if the categorization is correct.  <code>fn</code> and <code>fp</code> stand for false negatives and false positives respectively.  <code>fn</code> and <code>fp</code> are found under binary categorization.  Values of <code>NA</code> are returned when a false positive or false negative is not relevant.  The second data frame, named <code>rej</code>, indicates the rejection of each new observation from each category via typicality index.  One can use <code>rej</code> to inspect if the typicality index played a role in categorization, or to supply to another call of <code>becm_decision</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
csv_use &lt;- "good_training.csv"
file_path &lt;- system.file("extdata", csv_use, package = "ezECM")
training_data &lt;- import_pvals(file = file_path, header = TRUE, sep = ",", training = TRUE)

trained_model &lt;- BayesECM(Y = training_data, BT = c(10,1000))

csv_use &lt;- "good_newdata.csv"
file_path &lt;- system.file("extdata", csv_use, package = "ezECM")
new_data &lt;- import_pvals(file = file_path, header = TRUE, sep = ",", training = TRUE)

bayespred &lt;- predict(trained_model,  Ytilde = new_data)

accuracy &lt;- becm_decision(bayes_pred = bayespred, vic = "explosion", cat_truth = new_data$event)


</code></pre>

<hr>
<h2 id='cECM'>Multiple Discriminant Analysis</h2><span id='topic+cECM'></span>

<h3>Description</h3>

<p>Fits a regularized discriminant analysis model to labeled training data and generates an aggregate p-value for categorizing newly obtained data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cECM(x, newdata = NULL, rda_params = NULL, transform = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cECM_+3A_x">x</code></td>
<td>
<p>Either a <code>data.frame</code> of training data or the <code>list</code> output from previous use of the <code>cECM</code> function.  If a <code>data.frame</code> is supplied, each row contains one point of training data.  Additionally, one column, with the name of <code>event</code>, must contain labels for the event of each row.  The remaining columns contain the observed <code>ncol(x) - 1</code> discriminant related p-value data.</p>
</td></tr>
<tr><td><code id="cECM_+3A_newdata">newdata</code></td>
<td>
<p>a <code>data.frame</code> containing new data for event categorization.  Must use a subset of the discriminants used in the training data.  If for a particular event a certain discriminant is unavailable, specifying <code>NA</code> in place of the p-value will allow for calculation of the aggregate p-value.</p>
</td></tr>
<tr><td><code id="cECM_+3A_rda_params">rda_params</code></td>
<td>
<p>a <code>list</code> of arguments passed to the <code><a href="klaR.html#topic+rda">klaR::rda()</a></code> function.  If arguments <code>rda_params$x</code> or <code>rda_params$grouping</code> are supplied, they are ignored.</p>
</td></tr>
<tr><td><code id="cECM_+3A_transform">transform</code></td>
<td>
<p>Logical indicating if the supplied p-values should be transformed by the function <code class="reqn">2/\pi \times \mathrm{asin}\sqrt{X}</code>.  Ignored if a <code>list</code> is supplied as the argument <code>x</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Details on regularized discriminant analysis (RDA) can be found in Friedman (1989).  Details on related implementation found in Anderson et al. (2007).
</p>


<h3>Value</h3>

<p>A list.  Any returned objects contain a list element indicating the value of <code>transform</code> supplied to the <code>cECM</code> function call, as well as a <code><a href="klaR.html#topic+rda">klaR::rda()</a></code> object related to relevant training data.  In addition if <code>newdata</code> argument is supplied, the returned list contains a <code>data.frame</code> specifying aggregate p-values for each new event (rows) for related event category (columns).
</p>


<h3>References</h3>

<p>Anderson DN, Fagan DK, Tinker MA, Kraft GD, Hutchenson KD (2007).
&ldquo;A mathematical statistics formulation of the teleseismic explosion identification problem with multiple discriminants.&rdquo;
<em>Bulletin of the Seismological Society of America</em>, <b>97</b>(5), 1730&ndash;1741.<br /><br /> Friedman JH (1989).
&ldquo;Regularized discriminant analysis.&rdquo;
<em>Journal of the American statistical association</em>, <b>84</b>(405), 165&ndash;175.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
x &lt;- pval_gen(sims = 20, pwave.arrival = list(optim.starts = 5))
s &lt;- sample(1:20, size = 2)

newdata &lt;- x[s,]
newdata &lt;- newdata[,-which(names(newdata) == "event")]

x &lt;- x[-s,]

pval_cat &lt;- cECM(x = x, transform = TRUE)

pval_cat &lt;- cECM(x = pval_cat, newdata = newdata)


</code></pre>

<hr>
<h2 id='cECM_decision'>Decision Function for the C-ECM Model</h2><span id='topic+cECM_decision'></span>

<h3>Description</h3>

<p>Returns category decisions for uncategorized events.  When the true category of such events are known performance metrics are returned.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cECM_decision(pval = NULL, alphatilde = NULL, vic = NULL, cat_truth = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cECM_decision_+3A_pval">pval</code></td>
<td>
<p>Class <code>"cECM"</code> object obtained from providing training and testing data to the <code><a href="#topic+cECM">cECM()</a></code> function.</p>
</td></tr>
<tr><td><code id="cECM_decision_+3A_alphatilde">alphatilde</code></td>
<td>
<p>Scalar numeric between 0 and 1, used as the significance level for hypothesis testing.</p>
</td></tr>
<tr><td><code id="cECM_decision_+3A_vic">vic</code></td>
<td>
<p>Character vector of length one, indicating the Very Important Category (VIC).  Used for judging accuracy, false negatives, and false positives for binary categorization.  Required when <code>cat_truth</code> is supplied.</p>
</td></tr>
<tr><td><code id="cECM_decision_+3A_cat_truth">cat_truth</code></td>
<td>
<p>Character vector corresponding to the true group of each row in the <code>newdata</code> argument, previously provided to the <code><a href="#topic+cECM">cECM()</a></code> function.  When supplied, along with <code>vic</code>, binary categorization accuracy is returned.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When <code>is.null(cat_truth) == TRUE</code>, categorization over all event categories is used, using the same framework seen in (Anderson et al. 2007).  The return value of <code>"indeterminant"</code> happens when there is a failure to reject multiple event categories. <code>"undefined"</code> is returned when all event categories are rejected.
</p>
<p>When the arguments <code>cat_truth</code> and <code>vic</code> are included, binary categorization is utilized instead of categorization over all training categories.  The definition of accuracy is more ambiguous when categorizing over all training categories and the user is encouraged to develop their own code for such a case.  The goal of binary categorization is to estimate if an uncategorized observation is or is not in the event category stipulated by <code>vic</code>.  Uncategorized events which are <code>"indeterminant"</code> or <code>"undefined"</code> are deemed to not be in the <code>vic</code> category.
</p>


<h3>Value</h3>

<p>When <code>is.null(cat_truth) == TRUE</code> a vector providing the categorization over all event categories is returned.  When the <code>cat_truth</code> and <code>vic</code> arguments are supplied a list is returned containing a <code>data.frame</code> detailing if each event was categorized accurately in a binary categorization framework, was a false positive, was a false negative, and the estimated event category.  A vector stating overall categorization accuracy, false positive rate, and false negative rate is included with the list.
</p>


<h3>References</h3>

<p>Anderson DN, Fagan DK, Tinker MA, Kraft GD, Hutchenson KD (2007).
&ldquo;A mathematical statistics formulation of the teleseismic explosion identification problem with multiple discriminants.&rdquo;
<em>Bulletin of the Seismological Society of America</em>, <b>97</b>(5), 1730&ndash;1741.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
file_path &lt;- system.file("extdata", "good_training.csv", package = "ezECM")
training_data &lt;- import_pvals(file = file_path, header = TRUE, sep = ",", training = TRUE)

newdata &lt;- training_data[1:10,]
cat_truth &lt;- newdata$event
newdata$event &lt;- NULL
training_data &lt;- training_data[-(1:10),]

pval &lt;- cECM(training_data, transform = TRUE, newdata = newdata)

binary_decision &lt;- cECM_decision(pval = pval, alphatilde = 0.05,
vic = "explosion", cat_truth = cat_truth)

decision &lt;- cECM_decision(pval = pval, alphatilde = 0.05)

</code></pre>

<hr>
<h2 id='export_ecm'>Saving and loading fitted ECM models</h2><span id='topic+export_ecm'></span><span id='topic+import_ecm'></span>

<h3>Description</h3>

<p><code>export_ecm()</code> saves an ECM model fit to training data for later use. The object can be the output of the <code><a href="#topic+cECM">cECM()</a></code> or <code><a href="#topic+BayesECM">BayesECM()</a></code> functions.  Object saved in user specified location.
</p>
<p><code>import_ecm()</code> loads a previously exported ECM model into the global environment.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>export_ecm(x = NULL, file = stop("'file' must be specified"), verb = TRUE)

import_ecm(file = NULL, verb = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="export_ecm_+3A_x">x</code></td>
<td>
<p>Name of ECM model to be exported. <code>class(x)</code> should be either <code>"cECM"</code> or <code>"BayesECM"</code>.</p>
</td></tr>
<tr><td><code id="export_ecm_+3A_file">file</code></td>
<td>
<p>Character string containing absolute or relative path of <code style="white-space: pre;">&#8288;*.rda&#8288;</code> file to be exported or imported.</p>
</td></tr>
<tr><td><code id="export_ecm_+3A_verb">verb</code></td>
<td>
<p>Logical indicating if a message indicating success should be printed to the console.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Saves file or imports file into global environment.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
x &lt;- pval_gen(sims = 20, pwave.arrival = list(optim.starts = 5))
pval_cat &lt;- cECM(x = x, transform = TRUE)

export_ecm(x = pval_cat, file = "example-ecm.rda", verb = FALSE)

reload_pval_cat &lt;- import_ecm(file = "example-ecm.rda")

## The below code shouldn't be used,
## it deletes the file created during the example

unlink("example-ecm.rda")



</code></pre>

<hr>
<h2 id='import_pvals'>Import p-values</h2><span id='topic+import_pvals'></span>

<h3>Description</h3>

<p>Imports and organizes observed p-values located in a <code style="white-space: pre;">&#8288;*.csv&#8288;</code> file for training or categorization using an existing model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>import_pvals(file = NULL, header = TRUE, sep = ",", training = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="import_pvals_+3A_file">file</code></td>
<td>
<p>Character string providing name of <code style="white-space: pre;">&#8288;*.csv&#8288;</code> file to be imported.  File name within current working directory or absolute path are acceptable.  Argument passed directly to <code><a href="utils.html#topic+read.table">utils::read.csv()</a></code>, see <code><a href="utils.html#topic+read.table">utils::read.csv()</a></code> for details.</p>
</td></tr>
<tr><td><code id="import_pvals_+3A_header">header</code></td>
<td>
<p>Logical indicating if first row of supplied <code style="white-space: pre;">&#8288;*.csv&#8288;</code> file contains column names.  See <code><a href="utils.html#topic+read.table">utils::read.csv()</a></code> for details.</p>
</td></tr>
<tr><td><code id="import_pvals_+3A_sep">sep</code></td>
<td>
<p>Character string indicating the field separator character for the supplied <code style="white-space: pre;">&#8288;*.csv&#8288;</code> file.</p>
</td></tr>
<tr><td><code id="import_pvals_+3A_training">training</code></td>
<td>
<p>Logical indicating if the supplied <code style="white-space: pre;">&#8288;*.csv&#8288;</code> file is to be used as training data.  Only serves to suppress warnings.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The purpose of this function is to give the user a way to import p-value data in which the data will be organized for use with the <code><a href="#topic+cECM">cECM()</a></code> and <code><a href="#topic+BayesECM">BayesECM()</a></code> functions.  Warnings are printed when potential issues may arise with the supplied file, and the function attempts to detect and correct simple formatting issues.
</p>
<p>Ideally, the user supplies a <code style="white-space: pre;">&#8288;*.csv&#8288;</code> file which contains a header row labeling the columns.  Each column contains the p-values of a particular discriminant, and each row must correspond to a single event.  If training data is to be imported, the column containing known event categories is labeled <code>"event"</code>.  If new data is imported to be used with an existing model fit, the order of the columns in the <code>new.data</code> file must be the same as the <code style="white-space: pre;">&#8288;*.csv&#8288;</code> file containing training data.
</p>


<h3>Value</h3>

<p>A <code><a href="base.html#topic+data.frame">base::data.frame()</a></code> of p-values with each row corresponding to a single event and each column corresponding to a particular discriminant.  If data labels are correctly provided in the supplied <code style="white-space: pre;">&#8288;*.csv&#8288;</code> file, an additional column labeled <code>event</code> will hold these values.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
file_path &lt;- system.file("extdata", "good_training.csv", package = "ezECM")
training_data &lt;- import_pvals(file = file_path, header = TRUE, sep = ",", training = TRUE)

</code></pre>

<hr>
<h2 id='P_wave_gen'>Generation of noisy p-wave arrival times</h2><span id='topic+P_wave_gen'></span>

<h3>Description</h3>

<p>Similar utility to <a href="#topic+time_fn">time_fn</a>, however multiple seismometer locations can be provided simultaneously and normally distributed noise is added to the arrival time.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>P_wave_gen(
  Si = NULL,
  S0 = NULL,
  Sig = NULL,
  neg.obs = TRUE,
  eps = sqrt(.Machine$double.eps)
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="P_wave_gen_+3A_si">Si</code></td>
<td>
<p>Numeric matrix providing seismometer locations.  Must contain 3 columns corresponding to (X,Y) corrdinates and depth.</p>
</td></tr>
<tr><td><code id="P_wave_gen_+3A_s0">S0</code></td>
<td>
<p>Numeric 3 element vector stipulating the location of an event, elements correspond to (X, Y, Z)</p>
</td></tr>
<tr><td><code id="P_wave_gen_+3A_sig">Sig</code></td>
<td>
<p>Numeric vector, or diagonal matrix, providing the variance in observed arrival times at each seismometer.</p>
</td></tr>
<tr><td><code id="P_wave_gen_+3A_neg.obs">neg.obs</code></td>
<td>
<p>Logical indicating whether to allow negative observations of time (eg. the observed time of p-wave arrival is before the true time for the event).</p>
</td></tr>
<tr><td><code id="P_wave_gen_+3A_eps">eps</code></td>
<td>
<p>Numeric.  If <code>neg.obs = FALSE</code> sets of observations are redrawn until all <code class="reqn">t_i - t_0 \leq</code> <code>eps</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Numeric vector of observation times that correspond to the rows of <code>Si</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
pwave.obs &lt;- P_wave_gen(Si = c(100,200,3), S0 = c(400, 500, 4), Sig = 0.05)

</code></pre>

<hr>
<h2 id='plot.cECM'>Plot the data and output of <code><a href="#topic+cECM">cECM()</a></code> categorization</h2><span id='topic+plot.cECM'></span>

<h3>Description</h3>

<p>Plot the data and output of <code><a href="#topic+cECM">cECM()</a></code> categorization
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'cECM'
plot(x, discriminants = c(1, 2), thenull = NULL, alphatilde = 0.05, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.cECM_+3A_x">x</code></td>
<td>
<p>an object of which is of class <code>"cECM"</code>, retrieved from the output of the <code><a href="#topic+cECM">cECM()</a></code> function.  The <code>"cECM"</code> object may or may not contain unlabeled data.</p>
</td></tr>
<tr><td><code id="plot.cECM_+3A_discriminants">discriminants</code></td>
<td>
<p>character or integer vector of length two.  If a character vector is provided, the character strings must match a subset of the column names for the training data, ie. <code>all(discriminants %in% names(x$x))</code> must be true.  If an integer vector is given, the elements of the vector select the column indices of the data to be plotted.</p>
</td></tr>
<tr><td><code id="plot.cECM_+3A_thenull">thenull</code></td>
<td>
<p>character string or <code>NULL</code>.  When unlabeled data is found within an <code>"cECM"</code> object, the name of one of the event categories can be provided as this argument.  When <code>"thenull"</code> is provided, unlabled data where the category hypothesis is rejected is colored red.</p>
</td></tr>
<tr><td><code id="plot.cECM_+3A_alphatilde">alphatilde</code></td>
<td>
<p>numeric value specifying hypothesis testing significance level.  Used in conjunction with <code>thenull</code>, aggregate p-values less than <code>alphatilde</code> are rejected and colored accordingly.</p>
</td></tr>
<tr><td><code id="plot.cECM_+3A_...">...</code></td>
<td>
<p>arguments passed to <code><a href="base.html#topic+plot">base::plot()</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The plot generated from plot.ecm() is first dependent on if the provided <code>x$newdata</code> contains a data frame of unlabled data.
</p>
<p>If unlabled data is not part of the <code>"cECM"</code> object, the labled data is simply plotted with the 0.68 and 0.95 confidence levels obtained from the distribution fits returned from <code><a href="#topic+cECM">cECM()</a></code>.
</p>
<p>If unlabled data <em><strong>is</strong></em> part of the <code>"cECM"</code> object, the unlabled data is plotted in addition to the distribution plots.  Each unlabled data point appears on the plot as an integer, which indexes the corresponding row of <code>x$newdata</code>.
</p>


<h3>Value</h3>

<p>Plot illustrating results of <code><a href="#topic+cECM">cECM()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
x &lt;- pval_gen(sims = 20, pwave.arrival = list(optim.starts = 5))
s &lt;- sample(1:20, size = 2)

newdata &lt;- x[s,]
newdata &lt;- newdata[,-which(names(newdata) == "event")]

x &lt;- x[-s,]

pval_cat &lt;- cECM(x = x, transform = TRUE)

pval_cat &lt;- cECM(x = pval_cat, newdata = newdata)

plot(x = pval_cat, thenull = "explosion")

</code></pre>

<hr>
<h2 id='predict.BayesECM'>New Event Categorization With Bayesian Inference</h2><span id='topic+predict.BayesECM'></span>

<h3>Description</h3>

<p>New Event Categorization With Bayesian Inference
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'BayesECM'
predict(object, Ytilde, thinning = 1, mixture_weights = "training", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict.BayesECM_+3A_object">object</code></td>
<td>
<p>an object of <code>class</code> <code>"BayesECM"</code> obtained as the trained model output using the <code><a href="#topic+BayesECM">BayesECM()</a></code> function.</p>
</td></tr>
<tr><td><code id="predict.BayesECM_+3A_ytilde">Ytilde</code></td>
<td>
<p><code>data.frame</code> of unlabeled observations to be categorized.  Must contain the same discriminant names as the training data used in the provided &quot;BayesECM&quot; object.  Each row is an individual observation.  Missing data is specified with <code>NA</code></p>
</td></tr>
<tr><td><code id="predict.BayesECM_+3A_thinning">thinning</code></td>
<td>
<p>integer, scalar.  Values greater than one can be provided to reduce computation time.  See details.</p>
</td></tr>
<tr><td><code id="predict.BayesECM_+3A_mixture_weights">mixture_weights</code></td>
<td>
<p>character string describing the weights of the distributions in the mixture to be used for prediction.  The default,<code>"training"</code> will utilize weights according to likelihood and prior specifications, while supplying the string <code>"equal"</code> will assume the marginal predictive distribution of each category is independent of the data and utilize equal weights.</p>
</td></tr>
<tr><td><code id="predict.BayesECM_+3A_...">...</code></td>
<td>
<p>not used</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The data in <code>Ytilde</code> should be the p-values <code class="reqn">\in (0,1]</code>.  The transformation applied to the data used to generate <code>object</code> is automatically applied to <code>Ytilde</code> within the <code>predict.BayesECM()</code> function.
</p>
<p>For a given event with an unknown category, a Bayesian ECM model seeks to predict the expected value of the latent variable <code class="reqn">\tilde{\mathbf{z}}_K</code>, where <code class="reqn">\tilde{\mathbf{z}}_K</code> is a vector of the length <code class="reqn">K</code>, and <code class="reqn">K</code> is the number of event categories.  A single observation of <code class="reqn">\tilde{\mathbf{z}}_K</code> is a draw from a <a href="https://en.wikipedia.org/wiki/Categorical_distribution">Categorical Distribution</a>.
</p>
<p>The expected probabilities stipulated within the categorical distribution of <code class="reqn">\tilde{\mathbf{z}}_K</code> are conditioned on any imputed missing data, prior hyperparameters, and individually each row of <code>Ytilde</code>. The output from <code><a href="#topic+predict.BayesECM">predict.BayesECM()</a></code> are draws from the distribution of <code class="reqn">\mathbf{E}[\tilde{\mathbf{z}}_K|\tilde{\mathbf{y}}_{\tilde{p}}, \mathbf{Y}^{+}, \mathbf{\eta}, \mathbf{\Psi}, \mathbf{\nu}, \mathbf{\alpha}] = p(\tilde{\mathbf{z}}_K|\tilde{\mathbf{y}}_{\tilde{p}}, \mathbf{Y}^{+}, \mathbf{\eta}, \mathbf{\Psi}, \mathbf{\nu}, \mathbf{\alpha})</code>, where <code class="reqn">\mathbf{Y}^{+}</code> represents the observed values within the training data.
</p>
<p>The argument <code>mixture_weights</code> controls the value of <code class="reqn">p(\tilde{\mathbf{z}}_K|\mathbf{Y}_{N \times p}, \mathbf{\alpha})</code>, the probability of each <code class="reqn">\tilde{z}_k = 1</code>, before <code class="reqn">\tilde{\mathbf{y}}_{\tilde{p}}</code> is observed.  The standard result is obtained from the prior hyperparameter values in <code class="reqn">\mathbf{\alpha}</code> and the number of unique events in each <code class="reqn">\mathbf{Y}_{N_k \times p}</code>.  Setting <code>mixture_weights = "training"</code> will utilize this standard result in prediction.  If the frequency of the number events used for each category in training is thought to be problematic, providing the argument <code>mixture_weights = "equal"</code> sets <code class="reqn">p(\tilde{z}_1 = 1|\mathbf{Y}_{N \times p}) =  \dots = p(\tilde{z}_K = 1|\mathbf{Y}_{N \times p}) = 1/K</code>.  If the user wants to use a set of <code class="reqn">p(\tilde{z}_k = 1|\mathbf{Y}_{N \times p})</code> which are not equal but also not informed by the data, we suggest setting the elements of the hyperparameter vector <code class="reqn">\mathbf{\alpha}</code> equal to values with a large magnitude and in the desired ratios for each category.  However, this can cause undesirable results in prediction if the magnitude of some elements of <code class="reqn">\mathbf{\alpha}</code> are orders larger than others.
</p>
<p>To save computation time, the user can specify an integer value for <code>thinning</code> greater than one.  Every <code>thinning</code>th Markov-chain Monte-Carlo sample is used for prediction.  This lets the user take a large number of samples during the training step, allowing for better mixing.  See details in a package vignette by running <code>vignette("syn-data-code", package = "ezECM")</code>
</p>


<h3>Value</h3>

<p>Returns a <code>list</code>.  The list element <code>epz</code> is a matrix with <code>nrow(Ytilde)</code> rows, corresponding to each event used for prediction, and <code>K</code> named columns.  Each column of <code>epz</code> is the expected category probability of the row stipulated event.  The remainder of the list elements hold data including <code>Ytilde</code>, information about additonal variables passed to <code>predict.BayesECM</code>, and data related to the previous <code><a href="#topic+BayesECM">BayesECM()</a></code> fit.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
csv_use &lt;- "good_training.csv"
file_path &lt;- system.file("extdata", csv_use, package = "ezECM")
training_data &lt;- import_pvals(file = file_path, header = TRUE, sep = ",", training = TRUE)

trained_model &lt;- BayesECM(Y = training_data, BT = c(10,1000))

csv_use &lt;- "good_newdata.csv"
file_path &lt;- system.file("extdata", csv_use, package = "ezECM")
new_data &lt;- import_pvals(file = file_path, header = TRUE, sep = ",", training = TRUE)

bayes_pred &lt;- predict(trained_model,  Ytilde = new_data)


</code></pre>

<hr>
<h2 id='pval_gen'>Simulate p-values from earthquakes and explosions</h2><span id='topic+pval_gen'></span>

<h3>Description</h3>

<p>p-values are simulated for depth and first polarity discriminants to use in testing classification models.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pval_gen(
  sims = 100,
  grid.dim = c(800, 800, 30),
  seismometer = list(N = 100, max.depth = 2, Sig = NULL, sig.draws = c(15, 2)),
  explosion = list(max.depth = 5, prob = 0.4),
  pwave.arrival = list(H0 = 5, V = 5.9, optim.starts = 15),
  first.polarity = list(read.err = 0.95)
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pval_gen_+3A_sims">sims</code></td>
<td>
<p>numeric stipulating the number of individual events to generate.</p>
</td></tr>
<tr><td><code id="pval_gen_+3A_grid.dim">grid.dim</code></td>
<td>
<p>numeric 3-vector providing the extent of the coordinate system in <code>c(X,Y,Z)</code> to be used in km.</p>
</td></tr>
<tr><td><code id="pval_gen_+3A_seismometer">seismometer</code></td>
<td>
<p>list stipulating variables relating to the seismometers. Providing an incomplete list reverts to the default values.  List elements are:
</p>

<ul>
<li> <p><code>N</code> a numeric stipulating the number of seismometers
</p>
</li>
<li> <p><code>max.depth</code> is a numeric providing the maximum depth for a seismometer location in km
</p>
</li>
<li> <p><code>Sig</code> supplying a numeric vector of length <code>N</code> to this argument will stipulate the variance in the error in observed arrival time of each of the <code>N</code> seismometers.
</p>
</li>
<li> <p><code>sig.draws</code>  a numeric 2-vector, if <code>Sig</code> is not provided the variance in arrival time at each station is drawn from <code><a href="MCMCpack.html#topic+InvGamma">MCMCpack::rinvgamma()</a></code> using <code>shape = sig.draws[1]</code> and <code>scale = sig.draws[2]</code>.
</p>
</li></ul>
</td></tr>
<tr><td><code id="pval_gen_+3A_explosion">explosion</code></td>
<td>
<p>list stipulating variables regarding a detonation event. Providing an incomplete list reverts to the default values.  List elements are:
</p>

<ul>
<li> <p><code>max.depth</code> is a numeric providing the maximum depth of an explosion in km
</p>
</li>
<li> <p><code>prob</code>  is the probability of an explosion, controlling the fraction of events which are explosions.  Value provided must be in the interval <code class="reqn">[0,1]</code>
</p>
</li></ul>
</td></tr>
<tr><td><code id="pval_gen_+3A_pwave.arrival">pwave.arrival</code></td>
<td>
<p>list stipulating variables regarding the depth from p-wave arrival discriminant. Providing an incomplete list reverts to the default values.  List elements are:
</p>

<ul>
<li> <p><code>H0</code> a numeric providing the value of depth in km for the null hypothesis
</p>
</li>
<li> <p><code>V</code>  a numeric stipulating the velocity of p-waves in km.  Used for simulating p-wave arrival times as an argument of <code><a href="#topic+time_fn">time_fn()</a></code>.
</p>
</li>
<li> <p><code>optim.starts</code> number of <code><a href="stats.html#topic+optim">stats::optim()</a></code> starts used to maximize likelihood of event location.
</p>
</li></ul>
</td></tr>
<tr><td><code id="pval_gen_+3A_first.polarity">first.polarity</code></td>
<td>
<p>list stipulating variables regarding the depth from the polarity of first motion discriminant.  List elements are:
</p>

<ul>
<li> <p><code>read.err</code>  numeric in the interval  <code class="reqn">[0,1]</code> providing the probability of an error in reading the true first polarity.
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>Methods are adapted from the discriminants listed in (Anderson et al. 2007).
</p>


<h3>Value</h3>

<p>A data frame, with the number of rows equal to <code>sims</code>.  Columns contain the p-values observed for each simulation along with the true event type.
</p>


<h3>Depth Discriminant</h3>

<p>The equation below is used to model p-wave arrival time <code class="reqn">t_i</code> at seismometer <code class="reqn">i</code>.
</p>
<p style="text-align: center;"><code class="reqn">t_i = t_0 + T(S_i, S_0) + \epsilon_i</code>
</p>

<p>Where <code class="reqn">t_0</code> is the time of the event, <code class="reqn">T()</code> is a function modeling the arrival time (in this case <a href="#topic+time_fn">time_fn</a>), <code class="reqn">S_i</code> is the location of seismometer <code class="reqn">i</code>, <code class="reqn">S_0</code> is the location of the event, and <code class="reqn">\epsilon_i</code> is normally distributed error with known variance <code class="reqn">\sigma^2_i</code>.  Given <code>N</code> seismometers, the MLE of the event time <code class="reqn">\hat{t}_0</code> can be solved as the following:
</p>
<p style="text-align: center;"><code class="reqn">\hat{t}_0 = \frac{\mathrm{tr}\left(\Sigma^{-1} T_i\right) - \mathrm{tr}\left(\Sigma^{-1}T(S,S_0)\right)}{\mathrm{tr}(\Sigma^{-1})}</code>
</p>

<p>Where <code class="reqn">\mathrm{tr}()</code> is the matrix trace operation, <code class="reqn">\Sigma</code> is a matrix containing the elements of each <code class="reqn">\sigma_i^2</code> on the diagonal, <code class="reqn">T_i</code> is a diagonal matrix containing each <code class="reqn">t_i</code>, and <code class="reqn">T(S, S_0)</code> is a diagonal matrix containing each <code class="reqn">T(S_i, S_0)</code>.  This result is then plugged back into the first equation, which is then used in a normal likelihood function.  Derivatives are taken of the likelihood so that a fast gradient based approch can be used to find the maximum likelihood estimate (MLE) of <code class="reqn">S_0</code>.
</p>
<p>The remainder of the calculation of the p-value is consistent with the <em>Depth from P-Wave Arrival Times</em> section of (Anderson et al. 2007).  First note <code class="reqn">S_0</code> is equal to the 3-vector <code class="reqn">(X_0, Y_0, Z_0)^{\top}</code>.  Given the null hypothesis for the depth of <code class="reqn">\mathrm{H}_0: Z_0 \leq z_0</code>, the MLE <code class="reqn">(\hat{X}_0, \hat{Y}_0)</code> given <code class="reqn">Z_0 = z_0</code> is found.  The sum of squared errors (SSE) is calculated as follows:
</p>
<p style="text-align: center;"><code class="reqn">\mathrm{SSE}(S_0, t_0) = \sum_{i = 1}^N\left(\frac{t_i - t_0 - T(S_i, S_0)}{\sigma_i}\right)^2</code>
</p>

<p>If <code class="reqn">\mathrm{H}_0</code> is true then the following statistic has a central <code class="reqn">F</code> distribution with <code class="reqn">1</code> and <code class="reqn">N-4</code> degrees of freedom.
</p>
<p style="text-align: center;"><code class="reqn">F_{1,N-4} = \frac{\mathrm{SSE}(S_0, t_0|Z_0 = z_0) - \mathrm{SSE}(S_0, t_0)}{\mathrm{SSE}(S_0, t_0)}</code>
</p>

<p>Because the test has directionality, the <code class="reqn">F</code> statistic is then converted to a <code class="reqn">T</code> statistic as such:
</p>
<p style="text-align: center;"><code class="reqn">T_{N-4} = \mathrm{sign}(\hat{Z}_0 - z_0)\sqrt{F_{1,n-4}}</code>
</p>

<p>This <code class="reqn">T</code> statistic is then used to compute the p-value
</p>


<h3>Polarity of First Motion</h3>

<p>Under the null hypothesis that the event is an explosion, (and therefore the true polarity of first motion is always one), the error rate for mistakenly identifying the polarity of first motion is stipulated as the argument <code>first.polarity$read.err</code>.  For an error rate of <code class="reqn">\theta</code> the p-value can then be calculated as follows:
</p>
<p style="text-align: center;"><code class="reqn">\sum_{i = 0}^n {N \choose i} \theta^i(1-\theta)^{N-i}</code>
</p>

<p>Where <code class="reqn">n</code> is the number of stations where a positive first motion was observed, and <code class="reqn">N</code> is the total number of stations.
</p>


<h3>References</h3>

<p>Anderson DN, Fagan DK, Tinker MA, Kraft GD, Hutchenson KD (2007).
&ldquo;A mathematical statistics formulation of the teleseismic explosion identification problem with multiple discriminants.&rdquo;
<em>Bulletin of the Seismological Society of America</em>, <b>97</b>(5), 1730&ndash;1741.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
test.data &lt;- pval_gen(sims = 5)


</code></pre>

<hr>
<h2 id='summary.BayesECMpred'>Summary of Unlabeled Event Categorization</h2><span id='topic+summary.BayesECMpred'></span>

<h3>Description</h3>

<p>Tabulates results from the <code><a href="#topic+predict.BayesECM">predict.BayesECM()</a></code> function for quick analysis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'BayesECMpred'
summary(object, index = 1, category = 1, C = 1 - diag(2), ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.BayesECMpred_+3A_object">object</code></td>
<td>
<p>an object of <code>class</code> <code>"BayesECMpred"</code> obtained as the output from the <code><a href="#topic+predict.BayesECM">predict.BayesECM()</a></code> function.</p>
</td></tr>
<tr><td><code id="summary.BayesECMpred_+3A_index">index</code></td>
<td>
<p>integer stipulating the event of interest.  Value corresponds to the row index of <code>Ytilde</code> previously supplied to <code><a href="#topic+predict.BayesECM">predict.BayesECM()</a></code></p>
</td></tr>
<tr><td><code id="summary.BayesECMpred_+3A_category">category</code></td>
<td>
<p>integer for the index of the category of interest for hypothesis testing.  Alternatively, a character string naming the category of interest can be provided.</p>
</td></tr>
<tr><td><code id="summary.BayesECMpred_+3A_c">C</code></td>
<td>
<p>square matrix of dimension 2, providing loss values to be used in hypothesis testing.  See Details.</p>
</td></tr>
<tr><td><code id="summary.BayesECMpred_+3A_...">...</code></td>
<td>
<p>not used</p>
</td></tr>
</table>


<h3>Details</h3>



<h4>Expected Loss</h4>

<p><code><a href="#topic+summary.BayesECMpred">summary.BayesECMpred()</a></code> prints expected loss for the binary hypothesis stipulated by <code>category</code>.  Expected loss is calculated using the loss matrix specified with argument <code>C</code>.  The default values for <code>C</code> result in 0-1 loss being used.  Format details for the loss matrix can be found in <code>vignette("syn-data-code")</code>.
</p>



<h4>Typicality</h4>

<p>Typicality indices are used in <code><a href="#topic+cECM_decision">cECM_decision()</a></code> as part of the decision criteria.  Here, we have adapted typicality indices for use with a Bayesian ECM model for outlier detection, when a new observation may not be related to the categories used for training.  Probability of the p-value being less than a significance level of 0.05 is reported.  If no missing data is used for training, this probability is either 0 or 1.
</p>



<h3>Value</h3>

<p>Prints a summary including probability of each category for the event stipulated by <code>index</code>, minimum expected loss for binary categorization, and probability of a-typicality of the event for the category specified by <code>category</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
csv_use &lt;- "good_training.csv"
file_path &lt;- system.file("extdata", csv_use, package = "ezECM")
training_data &lt;- import_pvals(file = file_path, header = TRUE, sep = ",", training = TRUE)

trained_model &lt;- BayesECM(Y = training_data, BT = c(10,1000))

csv_use &lt;- "good_newdata.csv"
file_path &lt;- system.file("extdata", csv_use, package = "ezECM")
new_data &lt;- import_pvals(file = file_path, header = TRUE, sep = ",", training = TRUE)

bayespred &lt;- predict(trained_model,  Ytilde = new_data)


</code></pre>

<hr>
<h2 id='time_fn'>P-wave arrival times simulation</h2><span id='topic+time_fn'></span>

<h3>Description</h3>

<p>Simulates the arrival time of p-waves (without noise) using a mean velocity and euclidian distance, without taking the curvature into account.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>time_fn(X = NULL, X0 = NULL, V = 7)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="time_fn_+3A_x">X</code></td>
<td>
<p>numeric three element vector stipulating the location of a seismometer.  Units of km</p>
</td></tr>
<tr><td><code id="time_fn_+3A_x0">X0</code></td>
<td>
<p>numeric three element vector stipulating the location of an event.  Units of km</p>
</td></tr>
<tr><td><code id="time_fn_+3A_v">V</code></td>
<td>
<p>numeric scalar supplying the p-wave velocity in km/s.  A quick google search (Jan 31st 2023) shows typical values range from 5 to 8 km/s.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Used for estimating event location, given a series of seismometer observations.
</p>


<h3>Value</h3>

<p>numeric scalar providing the time in seconds for a p-wave to arrive at a seismometer.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>  arrival.time &lt;- time_fn(X = c(100,200,10), X0  = c(500, 80, 25), V = 5)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
