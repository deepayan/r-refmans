<!DOCTYPE html><html><head><title>Help for package HMDHFDplus</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {HMDHFDplus}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#age2int'><p><code>age2int()</code> convert the Age column from standard HMD or HFD tables to integer</p></a></li>
<li><a href='#getCHMDprovinces'><p>get a named vector of CHMD province codes</p></a></li>
<li><a href='#getHFCcountries'><p>getHFCcountries a function to grab all present country codes used in the Human Fertility Collection</p></a></li>
<li><a href='#getHFDcountries'><p>internal function for grabbing the HFD country short codes.</p></a></li>
<li><a href='#getHFDdate'><p>internal function for grabbing the date of last update for a given HFD country</p></a></li>
<li><a href='#getHFDitemavail'><p>List the available data item names for a given HFD country.</p></a></li>
<li><a href='#getHMDcountries'><p>internal function for grabbing the HMD country short codes.</p></a></li>
<li><a href='#getHMDitemavail'><p>internal function for grabbing the available data item names for a given country.</p></a></li>
<li><a href='#getJMDprefectures'><p>get a named vector of JMD prefecture codes</p></a></li>
<li><a href='#HFCparse'><p>HFCparse internal function for modifying freshly read HCD data in its standard form</p></a></li>
<li><a href='#HFDparse'><p>internal function for modifying freshly read HFD data in its standard form</p></a></li>
<li><a href='#HMDparse'><p>internal function for modifying freshly read HMD data in its standard form</p></a></li>
<li><a href='#readCHMDweb'><p>read data from the Canadian Human Mortality Database into R</p></a></li>
<li><a href='#readHFD'><p><code>readHFD()</code> reads a standard HFD .txt table as a <code>data.frame</code></p></a></li>
<li><a href='#readHFDweb'><p>read an HFD data file directly from the web as an R data.frame</p></a></li>
<li><a href='#readHMD'><p><code>readHMD()</code> reads a standard HMD .txt table as a <code>data.frame</code></p></a></li>
<li><a href='#readHMDweb'><p>readHMDweb a basic HMD data grabber.</p></a></li>
<li><a href='#readJMDweb'><p>read data from the Japan Mortality Database into R</p></a></li>
<li><a href='#userInput'><p>userInput let the user type in a character string</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Read Human Mortality Database and Human Fertility Database Data
from the Web</td>
</tr>
<tr>
<td>Version:</td>
<td>2.0.3</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-06-20</td>
</tr>
<tr>
<td>Description:</td>
<td>Utilities for reading data from the Human Mortality Database (<a href="https://www.mortality.org">https://www.mortality.org</a>), Human Fertility Database (<a href="https://www.humanfertility.org">https://www.humanfertility.org</a>), and similar databases from the web or locally into an R session as data.frame objects. These are the two most widely used sources of demographic data to study basic demographic change, trends, and develop new demographic methods. Other supported databases at this time include the Human Fertility Collection (<a href="https://www.fertilitydata.org">https://www.fertilitydata.org</a>), The Japanese Mortality Database (<a href="https://www.ipss.go.jp/p-toukei/JMD/index-en.html">https://www.ipss.go.jp/p-toukei/JMD/index-en.html</a>), and the Canadian Human Mortality Database (<a href="http://www.bdlc.umontreal.ca/chmd/">http://www.bdlc.umontreal.ca/chmd/</a>). Arguments and data are standardized.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/timriffe/TR1">https://github.com/timriffe/TR1</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/timriffe/TR1/issues">https://github.com/timriffe/TR1/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.1),</td>
</tr>
<tr>
<td>Collate:</td>
<td>'age2int.R' 'HFDutils.R' 'HMDutils.R' 'readHFD.R' 'readHMD.R'
'userInput.R'</td>
</tr>
<tr>
<td>Imports:</td>
<td>httr, rvest, dplyr, janitor, lubridate, readr, stringr, tidyr,
rlang</td>
</tr>
<tr>
<td>Suggests:</td>
<td>RCurl</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>Language:</td>
<td>'en-US'</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-06-20 10:25:16 UTC; tim</td>
</tr>
<tr>
<td>Author:</td>
<td>Tim Riffe [aut, cre],
  Carl Boe [aut],
  Jason Hilton [aut],
  Josh Goldstein [ctb],
  Stephen Holzman [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Tim Riffe &lt;tim.riffe@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-06-20 10:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='age2int'><code>age2int()</code> convert the Age column from standard HMD or HFD tables to integer</h2><span id='topic+age2int'></span>

<h3>Description</h3>

<p>Long the bane of many an HMD/HFD user is that the age column must be read into R as a factor or character vector, yet we'd like to use it as integer or numeric. This function strips symbols that are used to indicate the open age groups (&quot;12-&quot;,&quot;55+&quot;,&quot;110+&quot;), and coerces to integer format. This function is called by <code>HFDparse()</code> and <code>HMDparse()</code>, and so forth.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>age2int(Age)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="age2int_+3A_age">Age</code></td>
<td>
<p>a vector of the Age column from and HMD or HFD data object that has been read directly into R. This may be a factor or character vector.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is written for the sake of various parse functions.
</p>


<h3>Value</h3>

<p>the same age vector as a clean integer.
</p>


<h3>Note</h3>

<p>original function submitted by Josh Goldstein, modified by Tim Riffe.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>AgeTest &lt;- c("12-","13","14","55+")
(AgeNew  &lt;- age2int(AgeTest))
AgeNew + .5 # sort of mid-interval

# also handles abrdiged ages properly:
AgeAbridged &lt;- c("0","1-4","5-9","10-14")
age2int(AgeAbridged)
</code></pre>

<hr>
<h2 id='getCHMDprovinces'>get a named vector of CHMD province codes</h2><span id='topic+getCHMDprovinces'></span>

<h3>Description</h3>

<p>This is a helper function to get a vector of 3-character province codes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getCHMDprovinces()
</code></pre>


<h3>Value</h3>

<p>a character vector of 3 character province codes.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run:  (provs &lt;- getCHMDprovinces()) 

</code></pre>

<hr>
<h2 id='getHFCcountries'>getHFCcountries a function to grab all present country codes used in the Human Fertility Collection</h2><span id='topic+getHFCcountries'></span>

<h3>Description</h3>

<p>The function returns a list of population codes used in the Human Fertility Collection (HFC). Optionally, it also can return a data.frame with both the full population name and short code.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getHFCcountries(names = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getHFCcountries_+3A_names">names</code></td>
<td>
<p>logical. Default <code>FALSE</code> Should a <code>data.frame</code> matching full country names to short codes be given?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>either a character vector of short codes (default) or a <code>data.frame</code> of country names and codes.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
getHFCcountries()
getHFCcountries(names = TRUE)

## End(Not run)
</code></pre>

<hr>
<h2 id='getHFDcountries'>internal function for grabbing the HFD country short codes.</h2><span id='topic+getHFDcountries'></span>

<h3>Description</h3>

<p>This function is called by <code>readHFDweb()</code> and is separated here for modularity. We include both main and provisional countries in the grab.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getHFDcountries()
</code></pre>


<h3>Value</h3>

<p>a 'tibble' with three columns 'Country', 'link' and 'CNTRY' (the country short code)
</p>

<hr>
<h2 id='getHFDdate'>internal function for grabbing the date of last update for a given HFD country</h2><span id='topic+getHFDdate'></span>

<h3>Description</h3>

<p>called by <code>readHFDweb()</code>. This assumes that <code>CNTRY</code> is actually available in the HFD.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getHFDdate(CNTRY)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getHFDdate_+3A_cntry">CNTRY</code></td>
<td>
<p>HFD country short code.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>character string of eight integers representing the date as <code>"yyyymmdd"</code>.
</p>

<hr>
<h2 id='getHFDitemavail'>List the available data item names for a given HFD country.</h2><span id='topic+getHFDitemavail'></span>

<h3>Description</h3>

<p>called by <code>readHFDweb()</code>. This assumes that <code>CNTRY</code> is actually available in the HFD.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getHFDitemavail(CNTRY)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getHFDitemavail_+3A_cntry">CNTRY</code></td>
<td>
<p>HFD country short code.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a tibble of all available data files for the selected country. There are several useful identifiers that can help determine the appropriate file, including the 'measure' and 'subtype' as detected from the html table properties, and 'lexis' and 'parity' as detected either from the file names or the table properties.
</p>

<hr>
<h2 id='getHMDcountries'>internal function for grabbing the HMD country short codes.</h2><span id='topic+getHMDcountries'></span>

<h3>Description</h3>

<p>This function is called by <code>readHMDweb()</code> and is separated here for modularity. Assumes you have an internet connection.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getHMDcountries()
</code></pre>


<h3>Value</h3>

<p>a vector of HMD country short codes.
</p>

<hr>
<h2 id='getHMDitemavail'>internal function for grabbing the available data item names for a given country.</h2><span id='topic+getHMDitemavail'></span>

<h3>Description</h3>

<p>called by <code>readHMDweb()</code> to find file urls. This assumes that <code>CNTRY</code> is actually available in the HFD.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getHMDitemavail(CNTRY)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getHMDitemavail_+3A_cntry">CNTRY</code></td>
<td>
<p>character. HMD country short code.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a tibble of all available data items for the selected country. There are several useful identifiers that can help determine the appropriate file, including the 'measure', 'lexis', 'sex' and interval information, as detected from the item names.
</p>

<hr>
<h2 id='getJMDprefectures'>get a named vector of JMD prefecture codes</h2><span id='topic+getJMDprefectures'></span>

<h3>Description</h3>

<p>This is a helper function for those familiar with prefecture names but not with prefecture codes (and vice versa). It is also useful for looped downloading of data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>getJMDprefectures()
</code></pre>


<h3>Value</h3>

<p>a character vector of 2-digit prefecture codes. Names correspond to the proper names given in the English version of the HMD webpage.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run:  (prefectures &lt;- getJMDprefectures()) 

</code></pre>

<hr>
<h2 id='HFCparse'>HFCparse internal function for modifying freshly read HCD data in its standard form</h2><span id='topic+HFCparse'></span>

<h3>Description</h3>

<p>called by <code>readHFC()</code> and <code>readHFCweb()</code>. We assume there are no factors in the given data.frame and that it has been read in from the raw text files using something like: <code> read.csv(file = filepath, stringsAsFactors = FALSE, na.strings = ".", strip.white = TRUE)</code>. This function is visible to users, but is not likely needed directly.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>HFCparse(DF)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="HFCparse_+3A_df">DF</code></td>
<td>
<p>a data.frame of HFC data, freshly read in.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This parse routine is based on the subjective opinions of the author...
</p>


<h3>Value</h3>

<p>DF same data.frame, modified so that columns are of a useful class. If there were open age categories, such as <code>"-"</code> or <code>"+"</code>, this information is stored in a new dummy column called <code>OpenInterval</code>. Values of 99 or -99 in the <code>AgeInterval</code> column are replaced with <code>"+"</code> and <code>"-"</code>, respectively. <code>Year</code> taken from <code>Year1</code>, and <code>YearInterval</code> is given, rather than <code>Year2</code>. Users wishing for a central time point should bear this is mind. The column <code>Country</code> is renamed <code>CNTRY</code>. Otherwise, columns in this database are kept in the <code>data.frame</code>, in case they may be useful.
</p>

<hr>
<h2 id='HFDparse'>internal function for modifying freshly read HFD data in its standard form</h2><span id='topic+HFDparse'></span>

<h3>Description</h3>

<p>called by <code>readHFD()</code> and <code>readHFDweb()</code>. We assume there are no factors in the given data.frame and that it has been read in from the raw text files using something like: <code> read.table(file = filepath, header = TRUE, skip = 2, na.strings = ".", as.is = TRUE)</code>. This function is visible to users, but is not likely needed directly.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>HFDparse(DF)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="HFDparse_+3A_df">DF</code></td>
<td>
<p>a data.frame of HFD data, freshly read in.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This parse routine is based on the subjective opinions of the author...
</p>


<h3>Value</h3>

<p>DF same data.frame, modified so that columns are of a useful class. If there were open age categories, such as <code>"-"</code> or <code>"+"</code>, this information is stored in a new dummy column called <code>OpenInterval</code>.
</p>

<hr>
<h2 id='HMDparse'>internal function for modifying freshly read HMD data in its standard form</h2><span id='topic+HMDparse'></span>

<h3>Description</h3>

<p>called by <code>readHMD()</code> and <code>readHMDweb()</code>. We assume there are no factors in the given data.frame and that it has been read in from the raw text files using something like: <code> read.table(file = filepath, header = TRUE, skip = 2, na.strings = ".", as.is = TRUE)</code>. This function is visible to users, but is not likely needed directly.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>HMDparse(DF, filepath)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="HMDparse_+3A_df">DF</code></td>
<td>
<p>a data.frame of HMD data, freshly read in.</p>
</td></tr>
<tr><td><code id="HMDparse_+3A_filepath">filepath</code></td>
<td>
<p>just to check if these are population counts from the name.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This parse routine is based on the subjective opinions of the author...
</p>


<h3>Value</h3>

<p>DF same data.frame, modified so that columns are of a useful class. If there were open age categories, such as <code>"-"</code> or <code>"+"</code>, this information is stored in a new dummy column called <code>OpenInterval</code>.
</p>

<hr>
<h2 id='readCHMDweb'>read data from the Canadian Human Mortality Database into R</h2><span id='topic+readCHMDweb'></span>

<h3>Description</h3>

<p>CHMD data are formatted exactly as HMD data. This function simply parses the necessary url together given a province code and data item (same nomenclature as HMD). Data is parsed using <code>HMDparse()</code>, which converts columns into useful and intuitive classes, for ready-use. See <code>?HMDparse</code> for more information on type conversions. No authentication is required for this database. Only a single item/prefecture is downloaded. Loop for more complex calls (See examples). The provID is not appended as a column, so be mindful of this if appending several items together into a single <code>data.frame</code>. Note that at the time of this writing, the finest Lexis resolution for prefectural lifetables is 5x5 (5-year, 5-year age groups). Raw data are, however, provided in 1x1 format, and deaths are also available in triangles. Note that cohort data are not produced for Canada at this time (but you could produce such data by starting with the <code>Deaths\_Lexis</code> file...).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>readCHMDweb(provID = "can", item = "Deaths_1x1", fixup = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="readCHMDweb_+3A_provid">provID</code></td>
<td>
<p>a single provID 3 character string, as returned by <code>getCHMDprovinces()</code>.</p>
</td></tr>
<tr><td><code id="readCHMDweb_+3A_item">item</code></td>
<td>
<p>the statistical product you want, e.g., <code>"fltper_5x5"</code>. Only 1.</p>
</td></tr>
<tr><td><code id="readCHMDweb_+3A_fixup">fixup</code></td>
<td>
<p>logical. Should columns be made more user-friendly, e.g., forcing Age to be integer?</p>
</td></tr>
<tr><td><code id="readCHMDweb_+3A_...">...</code></td>
<td>
<p>extra arguments ultimately passed to <code>read.table()</code>. Not likely needed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This database is curated independently from the HMD/HFD family, and so file types and locations may be subject to change. If this happens, please notify the package maintainer.
</p>


<h3>Value</h3>

<p><code>data.frame</code> of the data item is invisibly returned
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(HMDHFDplus)
# grab province codes (including All Canada)
provs &lt;- getCHMDprovinces()
# grab all mltper_5x5  
# and stick into long data.frame: 
mltper &lt;- do.call(rbind, lapply(provs, function(provID){
                   Dat        &lt;- readCHMDweb(provID = provID, item = "mltper_5x5", fixup = TRUE)
                   Dat$provID &lt;- provID
                   Dat
}))

## End(Not run)

</code></pre>

<hr>
<h2 id='readHFD'><code>readHFD()</code> reads a standard HFD .txt table as a <code>data.frame</code></h2><span id='topic+readHFD'></span>

<h3>Description</h3>

<p>This calls <code>read.table()</code> with all the necessary defaults to avoid annoying surprises. The Age column is also stripped of <code>"-"</code> and <code>"+"</code> and converted to integer, and a logical indicator column called <code>OpenInterval</code> is added to show where these were located. Output is invisibly returned, so you must assign it to take a look. This is to avoid lengthy console printouts.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>readHFD(filepath, fixup = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="readHFD_+3A_filepath">filepath</code></td>
<td>
<p>path or connection to the HFD text file, including .txt suffix.</p>
</td></tr>
<tr><td><code id="readHFD_+3A_fixup">fixup</code></td>
<td>
<p>logical. Should columns be made more user-friendly, e.g., forcing Age to be integer?</p>
</td></tr>
<tr><td><code id="readHFD_+3A_...">...</code></td>
<td>
<p>other arguments passed to <code>read.table</code>, not likely needed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>No details of note.
</p>


<h3>Value</h3>

<p>data.frame of standard HFD output, except the Age column has been cleaned, and a new open age indicator column has been added.
</p>


<h3>Note</h3>

<p>original function submitted by Josh Goldstein, modified by Tim Riffe.
</p>

<hr>
<h2 id='readHFDweb'>read an HFD data file directly from the web as an R data.frame</h2><span id='topic+readHFDweb'></span>

<h3>Description</h3>

<p>Read HFD data directly from the web. This function is useful for short reproducible examples, or to make code guaranteed to always use the most up to date version of a particular HFD data file. For working with the entire HFD for a comparative study, it may be more efficient to download the full HFD zip files and read in the elements using <code>readHFD()</code>. This function returns data formatted in the same way as <code>readHFD()</code>, that is, with Age columns (and others) converted to integer, and with open age group identifiers stored in a new logical column called <code>OpenInterval</code>. It is faster to specify <code>CNTRY</code> and <code>item</code> as arguments than to make the function figure out what's available. For repeated calls to this function, you can pass your username and password in as variables without having to include these in you R script by using <code>userInput()</code>&ndash; see example. The user also has the option of querying particular updates from the HFD revision history. If you wish to specify a particular update, you must know the date that a particular country was updated, in the format <code>"YYYYMMDD"</code>. These dates differ between countries, so keep a good record if you wish your work to be reproducible to that extent (as well as lightweight)!
</p>


<h3>Usage</h3>

<pre><code class='language-R'>readHFDweb(
  CNTRY = NULL,
  item = NULL,
  username = NULL,
  password = NULL,
  fixup = TRUE,
  Update = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="readHFDweb_+3A_cntry">CNTRY</code></td>
<td>
<p>character string of the HFD short code. Only one!</p>
</td></tr>
<tr><td><code id="readHFDweb_+3A_item">item</code></td>
<td>
<p>character string of the data product code, which is the base file name, but excluding the country code and file extension <code>.txt</code>. For instance, <code>"mabRR"</code> or <code>"tfrVHbo"</code>. If you're not sure, then leave it blank and a list will be shown. Only one item!</p>
</td></tr>
<tr><td><code id="readHFDweb_+3A_username">username</code></td>
<td>
<p>your HFD usernames, which is usually the email address you registered with</p>
</td></tr>
<tr><td><code id="readHFDweb_+3A_password">password</code></td>
<td>
<p>your HFD password. Don't make this a sensitive password, as things aren't encrypted.</p>
</td></tr>
<tr><td><code id="readHFDweb_+3A_fixup">fixup</code></td>
<td>
<p>logical. Should columns be made more user-friendly, e.g., forcing Age to be integer?</p>
</td></tr>
<tr><td><code id="readHFDweb_+3A_update">Update</code></td>
<td>
<p>character string of 8-digit date code of the format <code>"YYYYMMDD"</code>. Defaults to most recent update.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>You need to register for HFD to use this function: <a href="https://www.humanfertility.org">https://www.humanfertility.org</a>. It is advised to pass in your credentials as named vectors rather than directly as character strings, so that they are not saved directly in your code. See examples. One option is to just save them in your Rprofile file.
</p>


<h3>Value</h3>

<p>data.frame of the given HFD data file, modified in some friendly ways.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>### # this will ask you to enter your login details in the R console
### DAT &lt;- readHFDweb("JPN","tfrRR") 
###
### # ----------------------------------------
### # this is a good way to reuse your login credentials without 
### # having to reveal them in your R script.
### # if you want to do this in batch then I'm 
### # afraid you'll have to find a clever way to 
### # pass in your credentials without an interactive 
### # session, such as reading them in from a system file of your own.
### myusername &lt;- userInput()
### mypassword &lt;- userInput()
### DAT &lt;- readHMDweb("USA","mltper_1x1",mypassword,myusername)
###
### #-----------------------------------------
### # this also works, but you'll need to make two selections, 
### # plus enter data in the console twice:
### DAT &lt;- readHFDweb()

</code></pre>

<hr>
<h2 id='readHMD'><code>readHMD()</code> reads a standard HMD .txt table as a <code>data.frame</code></h2><span id='topic+readHMD'></span>

<h3>Description</h3>

<p>This calls <code>read.table()</code> with all the necessary defaults to avoid annoying surprises. The Age column is also stripped of <code>"+"</code> and converted to integer, and a logical indicator column called <code>OpenInterval</code> is added to show where these were located. If the file contains population counts, values are split into two columns for Jan 1 and Dec 31 of the year. Output is invisibly returned, so you must assign it to take a look. This is to avoid lengthy console printouts.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>readHMD(filepath, fixup = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="readHMD_+3A_filepath">filepath</code></td>
<td>
<p>path or connection to the HMD text file, including .txt suffix.</p>
</td></tr>
<tr><td><code id="readHMD_+3A_fixup">fixup</code></td>
<td>
<p>logical. Should columns be made more user-friendly, e.g., forcing Age to be integer?</p>
</td></tr>
<tr><td><code id="readHMD_+3A_...">...</code></td>
<td>
<p>other arguments passed to <code>read.table</code>, not likely needed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Population counts in the HMD typically refer to Jan 1st. One exception are years in which a territorial adjustment has been accounted for in estimates. For such years, 'YYYY-' refers to Dec 31 of the year before the adjustment, and 'YYYY+' refers to Jan 1 directly after the adjustment (adjustments are always made Jan 1st). In the data, it will just look like two different estimates for the same year, but in fact it is a definition change or similar. In order to remove headaches from potential territorial adjustments in the data, we simply create two columns, one for January 1st (e.g.,<code>"Female1"</code>) and another for Dec 31st (e.g.,<code>"Female2"</code>) . One can recover the adjustment coefficient for each year by taking the ratio $$Vx = P1(t+1) / P2(t)$$. In most years this will be 1, but in adjustment years there is a difference. This must always be accounted for when calculating rates and exposures. Argument <code>fixup</code> is outsourced to <code>HMDparse()</code>.
</p>


<h3>Value</h3>

<p>data.frame of standard HMD output, except the Age column has been cleaned, and a new open age indicator column has been added. If the file is Population.txt or Population5.txt, there will be two columns each for males and females.
</p>


<h3>Note</h3>

<p>function written by Tim Riffe.
</p>

<hr>
<h2 id='readHMDweb'>readHMDweb a basic HMD data grabber.</h2><span id='topic+readHMDweb'></span>

<h3>Description</h3>

<p>This is a basic HMD data grabber, based on Carl Boe's original <code>HMD2R()</code>. It will only grab a single HMD statistical product from a single country. Some typical R pitfalls are removed: The Age column is coerced to integer, while an AgeInterval column is created. Also Population counts are placed into two columns, for Jan. 1st and Dec. 31 of the same year, so as to remove headaches from population universe adjustments, such as territorial changes. Fewer options means less to break. To do more sophisticated data extraction, iterate over country codes or statistical items. Reformatting can be done outside this function using, e.g., <code>long2mat()</code>. Argument <code>fixup</code> is outsourced to <code>HMDparse()</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>readHMDweb(CNTRY, item, username, password, fixup = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="readHMDweb_+3A_cntry">CNTRY</code></td>
<td>
<p>character. HMD population letter code. If not spelled right, or not specified, the function provides a selection list. Only 1.</p>
</td></tr>
<tr><td><code id="readHMDweb_+3A_item">item</code></td>
<td>
<p>character. The statistical product you want, e.g., <code>"fltper_1x1"</code>. Only 1.</p>
</td></tr>
<tr><td><code id="readHMDweb_+3A_username">username</code></td>
<td>
<p>character. Your HMD user id, usually the email address you registered with the HMD under. If left blank, you'll be prompted. Do that if you don't mind the typing and prefer not to save your username in your code.</p>
</td></tr>
<tr><td><code id="readHMDweb_+3A_password">password</code></td>
<td>
<p>character. Your HMD password. If left blank, you'll be prompted. Do that if you don't mind the typing and prefer not to save your password in your code.</p>
</td></tr>
<tr><td><code id="readHMDweb_+3A_fixup">fixup</code></td>
<td>
<p>logical. Should columns be made more user-friendly, e.g., forcing Age to be integer?</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function points to the new HMD website (from June 2022) rather than the mirror of the old site that it temporarily pointed to; If your credentials fail then a likely reason is that you need to re-register at the new HMD website <a href="https://www.mortality.org/Account/UserAgreement">https://www.mortality.org/Account/UserAgreement</a>. As soon as you register, your new credentials should work.
</p>


<h3>Value</h3>

<p>data.frame of the HMD product, read as as <code>readHMD()</code> would read it.
</p>

<hr>
<h2 id='readJMDweb'>read data from the Japan Mortality Database into R</h2><span id='topic+readJMDweb'></span>

<h3>Description</h3>

<p>JMD data are formatted exactly as HMD data. This function simply parses the necessary url together given a prefecture code and data item (same nomenclature as HMD). Data is parsed using <code>HMDparse()</code>, which converts columns into useful and intuitive classes, for ready-use. See <code>?HMDparse</code> for more information on type conversions. No authentication is required for this database. Only a single item/prefecture is downloaded. Loop for more complex calls (See examples). The prefID is not appended as a column, so be mindful of this if appending several items together into a single <code>data.frame</code>. Note that at the time of this writing, the finest Lexis resolution for prefectural lifetables is 5x5 (5-year, 5-year age groups). Raw data are, however, provided in 1x1 format, and deaths are also available in triangles.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>readJMDweb(prefID = "01", item = "Deaths_5x5", fixup = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="readJMDweb_+3A_prefid">prefID</code></td>
<td>
<p>a single prefID 2-digit character string, ranging from <code>"00"</code> to <code>"47"</code>.</p>
</td></tr>
<tr><td><code id="readJMDweb_+3A_item">item</code></td>
<td>
<p>the statistical product you want, e.g., <code>"fltper_5x5"</code>. Only 1.</p>
</td></tr>
<tr><td><code id="readJMDweb_+3A_fixup">fixup</code></td>
<td>
<p>logical. Should columns be made more user-friendly, e.g., forcing Age to be integer?</p>
</td></tr>
<tr><td><code id="readJMDweb_+3A_...">...</code></td>
<td>
<p>extra arguments ultimately passed to <code>read.table()</code>. Not likely needed.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>No details of note. This database in independently maintained, so file types/locations are subject to change. If this happens, please notify the package maintainer.
</p>


<h3>Value</h3>

<p><code>data.frame</code> of the data item is invisibly returned
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(HMDHFDplus)
# grab prefecture codes (including All Japan)
prefectures &lt;- getJMDprefectures()
# grab all mltper_5x5
# and stick into long data.frame: 
mltper &lt;- do.call(rbind, lapply(prefectures, function(prefID){
                   Dat        &lt;- readJMDweb(prefID = prefID, item = "mltper_5x5", fixup = TRUE)
                   Dat$PrefID &lt;- prefID
                   Dat
}))

## End(Not run)

</code></pre>

<hr>
<h2 id='userInput'>userInput let the user type in a character string</h2><span id='topic+userInput'></span>

<h3>Description</h3>

<p>this is useful for asking the user for a username or password, so that it goes directly to a variable and doesn't get inadvertently saved into an R script. There are no arguments. This will only return a character string. This is low key, don't bother using it for data entry. Just type characters, no need to put it in quotes, pressing enter will cause the function to return. Output will not be printed to the console, but it can be assigned directly. This is useful to have as an auxiliary function in case multiple calls to functions such as <code>readHMDweb()</code> are desired.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>userInput(silent = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="userInput_+3A_silent">silent</code></td>
<td>
<p>logical should a little prompt be given, telling the user to enter text in the console?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a character string, as given by the user.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>### mypassword &lt;- userInput()
### myusername &lt;- userInput()
### DAT &lt;- readHMDweb("USA","mltper_1x1",mypassword,myusername)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
