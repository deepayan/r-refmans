<!DOCTYPE html><html lang="en-US"><head><title>Help for package ebci</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {ebci}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#cva'><p>Compute average coverage critical value under moment constraints.</p></a></li>
<li><a href='#cz'><p>Neighborhood effects data from Chetty and Hendren (2018)</p></a></li>
<li><a href='#ebci'><p>Compute empirical Bayes confidence intervals by shrinking toward regression</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Robust Empirical Bayes Confidence Intervals</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Computes empirical Bayes confidence estimators and confidence
    intervals in a normal means model. The intervals are robust in the sense
    that they achieve correct coverage regardless of the distribution of the
    means. If the means are treated as fixed, the intervals have an average
    coverage guarantee. The implementation is based on Armstrong, Kolesár and
    Plagborg-Møller (2020) &lt;<a href="https://doi.org/10.48550/arXiv.2004.03448">doi:10.48550/arXiv.2004.03448</a>&gt;.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.1.0)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Suggests:</td>
<td>spelling, testthat (&ge; 2.1.0), lpSolve, knitr, rmarkdown</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/kolesarm/ebci">https://github.com/kolesarm/ebci</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/kolesarm/ebci/issues">https://github.com/kolesarm/ebci/issues</a></td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-09-02 17:29:45 UTC; kolesarm</td>
</tr>
<tr>
<td>Author:</td>
<td>Michal Kolesár <a href="https://orcid.org/0000-0002-2482-7796"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Tim Armstrong [ctb],
  Mikkel Plagborg-Møller [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Michal Kolesár &lt;kolesarmi@googlemail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-09-06 08:40:05 UTC</td>
</tr>
</table>
<hr>
<h2 id='cva'>Compute average coverage critical value under moment constraints.</h2><span id='topic+cva'></span>

<h3>Description</h3>

<p>Computes the critical value <code class="reqn">cva_{\alpha}(m_{2}, \kappa)</code> from Armstrong, Kolesár, and Plagborg-Møller (2020).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cva(m2, kappa = Inf, alpha = 0.05, check = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cva_+3A_m2">m2</code></td>
<td>
<p>Bound on second moment of the normalized bias, <code class="reqn">m_{2}</code></p>
</td></tr>
<tr><td><code id="cva_+3A_kappa">kappa</code></td>
<td>
<p>Bound on the kurtosis of the normalized bias,
<code class="reqn">\kappa</code></p>
</td></tr>
<tr><td><code id="cva_+3A_alpha">alpha</code></td>
<td>
<p>Determines confidence level, <code class="reqn">1-\alpha</code>.</p>
</td></tr>
<tr><td><code id="cva_+3A_check">check</code></td>
<td>
<p>If <code>TRUE</code>, verify accuracy of the solution by checking that
the implied least favorable distribution satisfies the <code>m2</code> and
<code>kappa</code> constraints and yields the same non-coverage rate. If this
fails (perhaps due to numerical accuracy issues), solve a finite-grid
approximation (by discretizing the support of the normalized bias) to the
primal linear programming problem, and check that it agrees with the dual
solution.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a list with 4 components: </p>

<dl>
<dt><code>cv</code></dt><dd><p>Critical value for constructing two-sided confidence
intervals.</p>
</dd>
<dt><code>alpha</code></dt><dd><p>The argument <code>alpha</code>.</p>
</dd>
<dt><code>x</code></dt><dd><p>Support points for the least favorable distribution for the
squared normalized bias, <code class="reqn">b^2</code>.</p>
</dd>
<dt><code>p</code></dt><dd><p>Probabilities associated with the support points.</p>
</dd>
</dl>



<h3>References</h3>


<p><cite>Armstrong, Timothy B., Kolesár, Michal, and Plagborg-Møller, Mikkel
(2020): Robust Empirical Bayes Confidence Intervals,
<a href="https://arxiv.org/abs/2004.03448">https://arxiv.org/abs/2004.03448</a></cite>
</p>



<h3>Examples</h3>

<pre><code class='language-R'># Usual critical value
cva(m2=0, kappa=Inf, alpha=0.05)
# Larger critical value that takes bias into account. Only uses second moment
# constraint on normalized bias.
cva(m2=4, kappa=Inf, alpha=0.05)
# Add a constraint on kurtosis. This tightens the critical value.
cva(m2=4, kappa=3, alpha=0.05)
</code></pre>

<hr>
<h2 id='cz'>Neighborhood effects data from Chetty and Hendren (2018)</h2><span id='topic+cz'></span>

<h3>Description</h3>

<p>This dataset contains a subset of the publicly available data from Chetty and
Hendren (2018). It contains raw estimates and standard errors of neighborhood
effects at the commuting zone level
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cz
</code></pre>


<h3>Format</h3>

<p>A data frame with 741 rows corresponding to commuting zones (CZ) and
10 columns corresponding to the variables:
</p>

<dl>
<dt>cz</dt><dd><p>Commuting zone ID</p>
</dd>
<dt>czname</dt><dd><p>Name of CZ</p>
</dd>
<dt>state</dt><dd><p>2-digit state code</p>
</dd>
<dt>pop</dt><dd><p>Population according to the year 2000 Census</p>
</dd>
<dt>theta25</dt><dd><p>Fixed-effect estimate of the causal effect of living in the CZ
for one year on children's percentile rank in the national distribution of
household earnings at age 26 relative to others in the same birth cohort for
children growing up with parents at the 25th percentile of national income
distribution</p>
</dd>
<dt>theta75</dt><dd><p>Fixed-effect estimate of the causal effect of living in the CZ
for one year on children's percentile rank in the national distribution of
household earnings at age 26 relative to others in the same birth cohort for
children growing up with parents at the 75th percentile of national income
distribution</p>
</dd>
<dt>se25</dt><dd><p>Standard error of <code>theta25</code></p>
</dd>
<dt>se75</dt><dd><p>Standard error of <code>theta75</code></p>
</dd>
<dt>stayer25</dt><dd><p>Average percentile rank in the national distribution of
household earnings at age 26 relative to others in the same birth cohort for
stayers (children who grew up in the CZ and did not move) with parents at the
25th percentile of national income distribution.</p>
</dd>
<dt>stayer75</dt><dd><p>Average percentile rank in the national distribution of
household earnings at age 26 relative to others in the same birth cohort for
stayers (children who grew up in the CZ and did not move) with parents at the
75th percentile of national income distribution.</p>
</dd>
</dl>



<h3>Source</h3>

<p><a href="https://opportunityinsights.org/data/?paper_id=599">https://opportunityinsights.org/data/?paper_id=599</a>
</p>


<h3>References</h3>


<p><cite>Chetty, R., &amp; Hendren, N. (2018). The Impacts of Neighborhoods on
Intergenerational Mobility II: County-Level Estimates. The Quarterly Journal
of Economics, 133(3), 1163–1228. doi: <a href="https://doi.org/10.1093/qje/qjy006">10.1093/qje/qjy006</a></cite>
</p>


<hr>
<h2 id='ebci'>Compute empirical Bayes confidence intervals by shrinking toward regression</h2><span id='topic+ebci'></span>

<h3>Description</h3>

<p>Computes empirical Bayes estimators based on shrinking towards a regression,
and associated robust empirical Bayes confidence intervals (EBCIs), as well
as length-optimal robust EBCIs.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ebci(
  formula,
  data,
  se,
  weights = NULL,
  alpha = 0.1,
  kappa = NULL,
  wopt = FALSE,
  fs_correction = "PMT"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ebci_+3A_formula">formula</code></td>
<td>
<p>object of class <code>"formula"</code> (or one that can be coerced
to that class) of the form <code>Y ~ predictors</code>, where <code>Y</code> is a
preliminary unbiased estimator, and <code>predictors</code> are predictors
<code class="reqn">X</code> that guide the direction of shrinkage. For shrinking toward the
grand mean, use <code>Y ~ 1</code>, and for shrinking toward <code>0</code> use
<code>Y ~ 0</code></p>
</td></tr>
<tr><td><code id="ebci_+3A_data">data</code></td>
<td>
<p>optional data frame, list or environment (or object coercible by
<code>as.data.frame</code> to a data frame) containing the preliminary
estimator <code>Y</code> and the predictors. If not found in <code>data</code>, these
variables are taken from <code>environment(formula)</code>, typically the
environment from which the function is called.</p>
</td></tr>
<tr><td><code id="ebci_+3A_se">se</code></td>
<td>
<p>Standard errors <code class="reqn">\sigma</code> associated with the preliminary
estimates <code>Y</code></p>
</td></tr>
<tr><td><code id="ebci_+3A_weights">weights</code></td>
<td>
<p>An optional vector of weights to be used in the fitting
process in computing <code class="reqn">\delta</code>, <code class="reqn">\mu_2</code> and
<code class="reqn">\kappa</code>. Should be <code>NULL</code> or a numeric vector.</p>
</td></tr>
<tr><td><code id="ebci_+3A_alpha">alpha</code></td>
<td>
<p>Determines confidence level, <code class="reqn">1-\alpha</code>.</p>
</td></tr>
<tr><td><code id="ebci_+3A_kappa">kappa</code></td>
<td>
<p>If non-<code>NULL</code>, use pre-specified value for the kurtosis
<code class="reqn">\kappa</code> of <code class="reqn">\theta-X'\delta</code> (such as
<code>Inf</code>), instead of computing it.</p>
</td></tr>
<tr><td><code id="ebci_+3A_wopt">wopt</code></td>
<td>
<p>If <code>TRUE</code>, also compute length-optimal robust EBCIs. These
are robust EBCIs centered at estimates with the shrinkage factor
<code class="reqn">w_i</code> chosen to minimize the length of the resulting EBCI.</p>
</td></tr>
<tr><td><code id="ebci_+3A_fs_correction">fs_correction</code></td>
<td>
<p>Finite-sample correction method used to compute
<code class="reqn">\mu_2</code> and <code class="reqn">\kappa</code>. These corrections ensure that
we do not shrink the preliminary estimates <code>Y</code> all the way to zero.
If <code>"PMT"</code>, use posterior mean truncation, if <code>"FPLIB"</code> use
limited information Bayesian approach with a flat prior, and if
<code>"none"</code>, truncate the estimates at <code>0</code> for <code class="reqn">\mu_2</code>
and <code>1</code> for <code class="reqn">\kappa</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a list with the following components: </p>

<dl>
<dt><code>mu2</code></dt><dd><p>Estimated second moment of
<code class="reqn">\theta-X'\delta</code>, <code class="reqn">\mu_2</code>. Vector
of length 2, the first element corresponds to the estimate after the
finite-sample correction as specified by <code>fs_correction</code>, the second
element is the uncorrected estimate.</p>
</dd>
<dt><code>kappa</code></dt><dd><p>Estimated kurtosis <code class="reqn">\kappa</code> of
<code class="reqn">\theta-X'\delta</code>. Vector of length 2 with the same
structure as <code>mu2</code>.</p>
</dd>
<dt><code>delta</code></dt><dd><p>Estimated regression coefficients <code class="reqn">\delta</code></p>
</dd>
<dt><code>X</code></dt><dd><p>Matrix of regressors</p>
</dd>
<dt><code>alpha</code></dt><dd><p>Determines confidence level <code class="reqn">1-\alpha</code> used.</p>
</dd>
<dt><code>df</code></dt><dd><p>Data frame with components described below.</p>
</dd>
</dl>

<p><code>df</code> has the following components:
</p>

<dl>
<dt><code>w_eb</code></dt><dd><p>EB shrinkage factors,
<code class="reqn">\mu_{2}/(\mu_{2}+\sigma^2_i)</code></p>
</dd>
<dt><code>w_opt</code></dt><dd><p>Length-optimal shrinkage factors</p>
</dd>
<dt><code>ncov_pa</code></dt><dd><p>Maximal non-coverage of parametric EBCIs</p>
</dd>
<dt><code>len_eb</code></dt><dd><p>Half-length of robust EBCIs based on EB shrinkage, so
that the intervals take the form <code>cbind(th_eb-len_eb, th_eb+len_eb)</code></p>
</dd>
<dt><code>len_op</code></dt><dd><p>Half-length of robust EBCIs based on length-optimal
shrinkage, so that the intervals take the form <code>cbind(th_op-len_op,
th_op+len_op)</code></p>
</dd>
<dt><code>len_pa</code></dt><dd><p>Half-length of parametric EBCIs, which take the form
<code>cbind(th_eb-len_pa, th_eb+len_a)</code></p>
</dd>
<dt><code>len_us</code></dt><dd><p>Half-length of unshrunk CIs, which take the form
<code>cbind(th_us-len_us, th_us+len_us)</code></p>
</dd>
<dt><code>th_us</code></dt><dd><p>Unshrunk estimate <code class="reqn">Y</code></p>
</dd>
<dt><code>th_eb</code></dt><dd><p>EB estimate.</p>
</dd>
<dt><code>th_op</code></dt><dd><p>Estimate based on length-optimal shrinkage.</p>
</dd>
<dt><code>se</code></dt><dd><p>Standard error <code class="reqn">\sigma</code>, as supplied by the
argument <code>se</code></p>
</dd>
<dt><code>weights</code></dt><dd><p>Weights used</p>
</dd>
<dt><code>residuals</code></dt><dd><p>The residuals <code class="reqn">Y_i-X_i\delta</code></p>
</dd>
</dl>



<h3>References</h3>


<p><cite>Armstrong, Timothy B., Kolesár, Michal, and Plagborg-Møller, Mikkel
(2020): Robust Empirical Bayes Confidence Intervals,
<a href="https://arxiv.org/abs/2004.03448">https://arxiv.org/abs/2004.03448</a></cite>
</p>



<h3>Examples</h3>

<pre><code class='language-R'>## Same specification as in empirical example in Armstrong, Kolesár
## and Plagborg-Møller (2020), but only use data on NY commuting zones
r &lt;- ebci(theta25 ~ stayer25, data=cz[cz$state=="NY", ],
          se=se25, weights=1/se25^2)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
