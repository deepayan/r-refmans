<!DOCTYPE html><html><head><title>Help for package icsw</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {icsw}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#clip.small.probs'>
<p>Replace probabilities below threshold with threshold value</p></a></li>
<li><a href='#compliance.score'>
<p>Estimate compliance scores using covariates.</p></a></li>
<li><a href='#FoxDebate'><p>The effects of watching a Fox debate on Proposition 209.</p></a></li>
<li><a href='#icsw-package'>
<p>Inverse compliance score weighting</p></a></li>
<li><a href='#icsw.tsls'>
<p>Two-stage least squares with inverse complier score weighting</p></a></li>
<li><a href='#tsls.wfit'>
<p>Fit instrumental variables model via two-stage least squares, with weights.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Inverse Compliance Score Weighting</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2018-05-16</td>
</tr>
<tr>
<td>Author:</td>
<td>Peter M. Aronow &lt;peter.aronow@yale.edu&gt;, Dean Eckles &lt;icsw@deaneckles.com&gt; and Kyle Peyton &lt;kyle.peyton@yale.edu&gt;</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Kyle Peyton &lt;kyle.peyton@yale.edu&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides the necessary tools to estimate average treatment effects with an instrumental variable by re-weighting observations using a model of compliance. </td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>stats</td>
</tr>
<tr>
<td>Suggests:</td>
<td>rgenoud, minqa</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>6.0.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2018-05-16 22:36:58 UTC; kylepeyton</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2018-05-16 22:44:58 UTC</td>
</tr>
</table>
<hr>
<h2 id='clip.small.probs'>
Replace probabilities below threshold with threshold value
</h2><span id='topic+clip.small.probs'></span>

<h3>Description</h3>

<p>Return the provided vector with values smaller than the provided
threshold replaced with that threshold (i.e., clip the probabilities
below a certain value). If the threshold is chosen to match an empirical quantile
then this can be used to implement Winsorizing probabilities from below.
If no threshold is provided, the smallest value greater than zero is used.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>clip.small.probs(x, min.prob = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="clip.small.probs_+3A_x">x</code></td>
<td>

<p>Vector of probabilities.
</p>
</td></tr>
<tr><td><code id="clip.small.probs_+3A_min.prob">min.prob</code></td>
<td>

<p>Threshold. Values smaller than <code>min.prob</code> are replaced with
<code>min.prob</code>. If not provided, set to the smallest value in
<code>x</code> greater than 0.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Used to avoid small probabilities blowing up in inverse probability weighting.
</p>
<p>Produces warnings whenever values are actually replaced.
</p>


<h3>Value</h3>

<p>Vector the same length as <code>x</code> with, possibly, some entries replaced.
</p>


<h3>Author(s)</h3>

<p>Peter M. Aronow &lt;peter.aronow@yale.edu&gt;, Dean Eckles &lt;icsw@deaneckles.com&gt;, Kyle Peyton &lt;kyle.peyton@yale.edu&gt;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
probs &lt;- seq(0, .01, by = .001)
min(clip.small.probs(probs, .05))

# without min.prob, uses smallest value &gt; 0
min(clip.small.probs(probs))

</code></pre>

<hr>
<h2 id='compliance.score'>
Estimate compliance scores using covariates.
</h2><span id='topic+compliance.score'></span>

<h3>Description</h3>

<p>Estimate probability that units are compliers using generalized linear models for
probability of being a complier or always-taker and for being an always-taker conditional
on being a complier or always-taker. These compliance scores can be used in inverse
probability weighting to estimate average treatment effects. In the case of one-sided non-compliance,
this estimation is considerably simpler.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compliance.score(D, Z, W, weights = NULL,
  link = qnorm, inv.link = pnorm, genoud = TRUE,
  num.iter = ifelse(genoud, 200, 10000),
  one.sided = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="compliance.score_+3A_d">D</code></td>
<td>

<p>Binary treatment of interest.
</p>
</td></tr>
<tr><td><code id="compliance.score_+3A_z">Z</code></td>
<td>

<p>Binary instrument.
</p>
</td></tr>
<tr><td><code id="compliance.score_+3A_w">W</code></td>
<td>

<p>Matrix of covariates for compliance model.
</p>
</td></tr>
<tr><td><code id="compliance.score_+3A_weights">weights</code></td>
<td>

<p>Observation weights.
</p>
</td></tr>
<tr><td><code id="compliance.score_+3A_link">link</code></td>
<td>

<p>Link function applied for linear models. Defaults to probit link function.
</p>
</td></tr>
<tr><td><code id="compliance.score_+3A_inv.link">inv.link</code></td>
<td>

<p>Inverse link function (i.e., mean function) applied for linear models. Defaults to probit mean function.
</p>
</td></tr>
<tr><td><code id="compliance.score_+3A_genoud">genoud</code></td>
<td>

<p>Whether to use global optimization via genetic optimization from package <code>rgenoud</code>.
Default, and highly recommended because the likelihood need not be concave.
Otherwise, use the BOBYQA algorithm for constrained optimization from package <code>minqa</code>.
</p>
</td></tr>
<tr><td><code id="compliance.score_+3A_num.iter">num.iter</code></td>
<td>

<p>Number of iterations of optimization routine.
</p>
</td></tr>
<tr><td><code id="compliance.score_+3A_one.sided">one.sided</code></td>
<td>

<p>Whether non-compliance is one-sided (logical). When compliance is one-sided, the previous
four arguments are ignored, and the compliance scores are estimated with probit regression.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A unit <code class="reqn">i</code> is a complier if <code class="reqn">D_{i1} &gt; D_{i0}</code>, where <code class="reqn">D_{i1}</code> and
<code class="reqn">D_{i0}</code> are the potential treatments for unit <code class="reqn">i</code> when <code class="reqn">Z</code> is set to
1 and 0. This is a latent (unobserved) characteristic of individual units, since
each unit is only observed with one value of <code class="reqn">Z</code>.
</p>
<p>By default this function uses genetic optimization via <code>genoud</code> because
the loss function for the complier scores is not necessarily convex.
</p>


<h3>Value</h3>

<p>Vector of estimated probabilities of being a complier (i.e., compliance scores).
</p>


<h3>Note</h3>

<p>Requires <code>rgenoud</code> package if <code>genoud</code> = TRUE. Requires <code>minqa</code> package if <code>genoud</code> = FALSE. 
</p>


<h3>Author(s)</h3>

<p>Peter M. Aronow &lt;peter.aronow@yale.edu&gt;, Dean Eckles &lt;icsw@deaneckles.com&gt;, Kyle Peyton &lt;kyle.peyton@yale.edu&gt;
</p>


<h3>References</h3>

<p>Peter M. Aronow and Allison Carnegie. (2013). Beyond LATE: Estimation of the average treatment effect with an instrumental variable. <em>Political Analysis</em>.
</p>


<h3>See Also</h3>

<p>Used by <code><a href="#topic+icsw.tsls">icsw.tsls</a></code>. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load example dataset, see help(FoxDebate) for details
data(FoxDebate)

# Matrix of covariates
covmat &lt;- with(FoxDebate, cbind(partyid, pnintst, watchnat, educad, readnews, 
                                gender, income, white))

# Estimate compliance scores with covariates, assuming (default) 
#   case of two-sided non-compliance
cscoreout &lt;- with(FoxDebate, compliance.score(D = watchpro, Z = conditn,
                                              W = covmat))

# Extract vector of estimated compliance scores
cscore &lt;- cscoreout$C.score
summary(cscore)

</code></pre>

<hr>
<h2 id='FoxDebate'>The effects of watching a Fox debate on Proposition 209.</h2><span id='topic+FoxDebate'></span>

<h3>Description</h3>

<p>The data set (n=507) contains findings from the experiment described in Albertson and Lawrence (2009) 
in which a representative sample of survey respondents in Orange County, California, were randomly
assigned to receive encouragement to view a Fox debate on affirmative action, which would take
place on the eve of the 1996 presidential election. Shortly after the election, these respondents were
reinterviewed. The postelection questionnaire asked respondents whether they viewed the debate,
whether they supported a California proposition (209) to eliminate affirmative action (<code>support</code>), 
and how informed they felt about the proposition (<code>infopro</code>). The dataset can be used to reproduce 
Table 2 in Aronow and Carnegie (2013). Note that mean imputation was used to handle missing data so 
non-integer values are imputed. <code>support</code> and <code>infopro</code> are excepted and include missing values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(FoxDebate)</code></pre>


<h3>Format</h3>

<p>A data frame with 507 observations on the following 11 variables:
</p>

<dl>
<dt><code>partyid</code></dt><dd><p>An 11 point scale from &ldquo;strong Republican&rdquo; to &ldquo;strong Democrat&rdquo;.</p>
</dd>
<dt><code>pnintst</code></dt><dd><p>Respondent interest in politics and national affairs. Coded 1 = &quot;very interested&quot;, 2 = &quot;somewhat interested&quot;, 3 = &quot;only slightly interested&quot;, 4 = &quot;not interested at all&quot;.</p>
</dd>
<dt><code>watchnat</code></dt><dd><p>Frequency of national television news consumption. Coded 1 = &quot;never&quot;&quot;, 2 = &quot;less than once a month&quot;&quot;, 3 = &quot;once a month&quot;, 4 = &quot;several times a month&quot;, 5 = &quot;once a week&quot;, 6 = &quot;several times a week&quot;, 7 = &quot;every day&quot;.</p>
</dd>
<dt><code>educad</code></dt><dd><p>Education level of respondent. Coded 1 = &quot;eighth grade or less&quot;, 2 = &quot;beyond eighth grade, not high school&quot;, 3 = &quot;ged&quot;, 4 = &quot;high school&quot;, 5 = &quot;less than one year vocational school&quot;, 6 = &quot;one to two year vocational school&quot;, 7 = &quot;two years or more vocational school&quot;, 8 = &quot;less than two years of college&quot;, 9 = &quot;two or more years of college&quot;, 10 = &quot;finished a two-year college program&quot;, 11 = &quot;finished a four-year college program&quot;, 12 = &quot;master degree or equivalent&quot;, 13 = &quot;ph.d., m.d., or other advance degree&quot;.</p>
</dd>
<dt><code>readnews</code></dt><dd><p>How often respondent reads political news. Coded 1 = &quot;never&quot;&quot;, 2 = &quot;less than once a month&quot;&quot;, 3 = &quot;once a month&quot;, 4 = &quot;several times a month&quot;, 5 = &quot;once a week&quot;, 6 = &quot;several times a week&quot;, 7 = &quot;every day&quot;.</p>
</dd>
<dt><code>gender</code></dt><dd><p>Respondent gender. Coded 1 for female and 0 for male.</p>
</dd>
<dt><code>income</code></dt><dd><p>Family income from all sources. Coded 1 = &quot;under $10,000&quot;, 2 = &quot;between $10,000 and $20,000&quot;, 3 = &quot;between $20,000 and $30,000&quot;, 4 = &quot;between $30,000 and $40,000&quot;, 5 = &quot;between $40,000 and $50,000&quot;, 6 = &quot;between $50,000 and $60,000&quot;, 7 = &quot;between $60,000 and $70,000&quot;, 8 = &quot;between $70,000 and $80,000&quot;, 9 = &quot;between $80,000 and $90,000&quot;, 10 = &quot;between $90,000 and $100,000&quot;, 11 = &quot;$100,000 or more&quot;.</p>
</dd>
<dt><code>white</code></dt><dd><p>Binary indicator coded 1 if subject is white and 0 otherwise.</p>
</dd>
<dt><code>support</code></dt><dd><p>Support for Proposition 209. Coded 1 if subject voted against or opposed and 0 if subject voted for or favored</p>
</dd>
<dt><code>infopro</code></dt><dd><p>Information on Proposition 209. Coded from 1 to 4, with 4 meaning respondents had a great deal of information about Proposition 209 prior to the election, and 1 meaning respondents reported no information about the proposition before the election.</p>
</dd>
<dt><code>watchpro</code></dt><dd><p>Binary indicator coded 1 if subject watched the Fox Debate about affirmative action and 0 otherwise. This is the outcome (&quot;treatment&quot;) of interest.</p>
</dd>
<dt><code>conditn</code></dt><dd><p>Binary indicator coded 1 if subject was (randomly) prompted to watch the Fox Debate about affirmative action. This is the encouragement (instrumental) variable.</p>
</dd>
</dl>



<h3>References</h3>

<p>Bethany Albertson and Adria Lawrence. (2009). After the credits roll: The long-term effects of educational television on public knowledge and attitudes. <em>American Politics Research</em>. 37(2): 275-300.
</p>
<p>Peter M. Aronow and Allison Carnegie. (2013). Beyond LATE: Estimation of the average treatment effect with an instrumental variable. <em>Political Analysis</em>. 21.4 (2013): 492-506.
</p>
<p>Peter M. Aronow and Allison Carnegie. (2013). Replication data for: Beyond LATE: Estimation of the average treatment effect with an instrumental variable. <em>Dataverse Network.</em> http://hdl.handle.net/1902.1/21729 (accessed May 14, 2015).
</p>

<hr>
<h2 id='icsw-package'>
Inverse compliance score weighting
</h2><span id='topic+icsw-package'></span><span id='topic+icsw'></span>

<h3>Description</h3>

<p>Inverse compliance score weighting is a tool for estimating 
average treatment effects from local average treatment 
effects by weighting units using inverse probabilities of 
complying with an encouragement (instrument).
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> icsw</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
Version: </td><td style="text-align: left;"> 1.0.0</td>
</tr>
<tr>
 <td style="text-align: left;">
Date: </td><td style="text-align: left;"> 2018-05-16</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;">  MIT</td>
</tr>
<tr>
 <td style="text-align: left;">
LazyLoad: </td><td style="text-align: left;"> yes</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Peter M. Aronow &lt;peter.aronow@yale.edu&gt;; Dean Eckles &lt;icsw@deaneckles.com&gt;; Kyle Peyton &lt;kyle.peyton@yale.edu&gt;
</p>
<p>Maintainer: Kyle Peyton &lt;kyle.peyton@yale.edu&gt;
</p>


<h3>References</h3>

<p>Bethany Albertson and Adria Lawrence. (2009). After the credits roll: The long-term effects of educational television on public knowledge and attitudes. <em>American Politics Research</em>. 37(2): 275-300.
</p>
<p>Peter M. Aronow and Allison Carnegie. (2013). Beyond LATE: Estimation of the average treatment effect with an instrumental variable. <em>Political Analysis</em>. 21.4 (2013): 492-506.
</p>
<p>Peter M. Aronow and Allison Carnegie. (2013). Replication data for: Beyond LATE: Estimation of the average treatment effect with an instrumental variable. <em>Dataverse Network.</em> http://hdl.handle.net/1902.1/21729 (accessed May 14, 2015).
</p>

<hr>
<h2 id='icsw.tsls'>
Two-stage least squares with inverse complier score weighting
</h2><span id='topic+icsw.tsls'></span><span id='topic+icsw.tsls.fit'></span>

<h3>Description</h3>

<p>Estimate average treatment effects using two-stage least squares
with a binary instrument and binary treatment and weighting with
inverse complier scores (probabilities of compliance). Optionally,
bootstrap the entire estimation process for the purpose of hypothesis
testing and constructing confidence intervals.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>icsw.tsls(D, X, Y, Z, W, weights = NULL,
  R = 0, estimand = c("ATE", "ATT"),
  min.prob.quantile = NULL,
  min.prob = NULL, ...)

icsw.tsls.fit(D, X, Y, Z, W, weights,
  estimand = c("ATE", "ATT"),
  min.prob.quantile = NULL,
  min.prob = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="icsw.tsls_+3A_d">D</code></td>
<td>

<p>Binary treatment of interest.
</p>
</td></tr>
<tr><td><code id="icsw.tsls_+3A_x">X</code></td>
<td>

<p>Matrix of covariates for two-stage least squares. Add a constant if desired (see examples). 
</p>
</td></tr>
<tr><td><code id="icsw.tsls_+3A_y">Y</code></td>
<td>

<p>Outcome.
</p>
</td></tr>
<tr><td><code id="icsw.tsls_+3A_z">Z</code></td>
<td>

<p>Binary instrument.
</p>
</td></tr>
<tr><td><code id="icsw.tsls_+3A_w">W</code></td>
<td>

<p>Matrix of covariates for compliance model.
</p>
</td></tr>
<tr><td><code id="icsw.tsls_+3A_weights">weights</code></td>
<td>

<p>Observation weights.
</p>
</td></tr>
<tr><td><code id="icsw.tsls_+3A_r">R</code></td>
<td>

<p>Number of bootstrap replicates.
</p>
</td></tr>
<tr><td><code id="icsw.tsls_+3A_estimand">estimand</code></td>
<td>

<p>Whether to estimate average treatment effect (default) or
average treatment effect on the treated.
</p>
</td></tr>
<tr><td><code id="icsw.tsls_+3A_min.prob.quantile">min.prob.quantile</code></td>
<td>

<p>Compliance scores are truncated to this quantile of positive compliance scores.
</p>
</td></tr>
<tr><td><code id="icsw.tsls_+3A_min.prob">min.prob</code></td>
<td>

<p>Compliance scores are truncated to this value.
</p>
</td></tr>
<tr><td><code id="icsw.tsls_+3A_...">...</code></td>
<td>

<p>Additional arguments to <code>compliance.score</code>.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If R = 0 or icsw.tsls.fit is called directly, a model fit,
as described in <code><a href="stats.html#topic+lm.wfit">lm.wfit</a></code>.
</p>
<p>If R &gt; 0, a list with elements
</p>
<table>
<tr><td><code>fitted.model</code></td>
<td>

<p>A model fit, as returned by <code><a href="stats.html#topic+lm.wfit">lm.wfit</a></code>.
</p>
</td></tr>
<tr><td><code>coefs.boot</code></td>
<td>

<p>p by R matrix of model coefficients for each of R bootstrap replicates.
</p>
</td></tr>
<tr><td><code>coefs.se.boot</code></td>
<td>

<p>Vector of standard deviations of coefficients under bootstrap resampling
(i.e., bootstrap standard errors).
</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Peter M. Aronow &lt;peter.aronow@yale.edu&gt;; Dean Eckles &lt;icsw@deaneckles.com&gt;; Kyle Peyton &lt;kyle.peyton@yale.edu&gt;
</p>


<h3>References</h3>

<p>Peter M. Aronow and Allison Carnegie. (2013). Beyond LATE: Estimation of the average treatment effect with an instrumental variable. <em>Political Analysis</em>.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+compliance.score">compliance.score</a></code> for calculating compliance scores used in example. 
</p>
<p><code><a href="#topic+tsls.wfit">tsls.wfit</a></code> for regression via 2SLS with weights. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Load example dataset, see help(FoxDebate) for details
data(FoxDebate)

# Ipw reweighting step Aronow and Carnegie (2013) use for missing data
covmat &lt;- with(FoxDebate, cbind(partyid, pnintst, watchnat, educad, readnews, gender, 
                                income, white))

# IPW reweighting step Aronow and Carnegie (2013) use for missing data
Ymis &lt;- is.na(FoxDebate[, "infopro"])

IPWweight &lt;- 1 / (1 - predict(glm(Ymis ~ covmat, family = binomial(link = "probit")),
                                  type = "response"))
IPWweight[Ymis] &lt;- 0

N &lt;- length(FoxDebate[, "infopro"])
alpha &lt;- 0.275

# Compute the ATE of watching the Fox Debate on knowledge . This replicates the 
#   ATE from column 2 of Table 1 in Aronow and Carnegie (2013) 
icsw.out &lt;- with(FoxDebate, icsw.tsls(D = watchpro, X = cbind(1, covmat), 
                                          Y = infopro, Z = conditn, W = covmat,
                                          min.prob.quantile = 1 / (N^alpha),
                          weights = IPWweight))
round(icsw.out$coefficients["D"], 2)

# Example with bootstrap (this takes awhile!)
icsw.out &lt;- with(FoxDebate, icsw.tsls(D = watchpro, X = cbind(1, covmat), 
                                      Y = infopro, Z = conditn, W = covmat,
                                      min.prob.quantile = 1 / (N^alpha), 
                                      weights = IPWweight, R = 1000))

# Display vector of coefficients
icsw.out$coefficients

# Display vector of (bootstrapped) SEs
icsw.out$coefs.se.boot

</code></pre>

<hr>
<h2 id='tsls.wfit'>
Fit instrumental variables model via two-stage least squares, with weights.
</h2><span id='topic+tsls.wfit'></span>

<h3>Description</h3>

<p>Fits linear first- and second-stage models using weighted linear regression.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tsls.wfit(X, Y, Z, weights, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tsls.wfit_+3A_x">X</code></td>
<td>

<p>Matrix of covariates and treatment, including constant if intercept is desired.
</p>
</td></tr>
<tr><td><code id="tsls.wfit_+3A_y">Y</code></td>
<td>

<p>Vector outcome.
</p>
</td></tr>
<tr><td><code id="tsls.wfit_+3A_z">Z</code></td>
<td>

<p>Matrix of covariates and instrument, including constant if intercept is desired.
</p>
</td></tr>
<tr><td><code id="tsls.wfit_+3A_weights">weights</code></td>
<td>

<p>Observation weights.
</p>
</td></tr>
<tr><td><code id="tsls.wfit_+3A_...">...</code></td>
<td>

<p>Additional arguments to <code>lm.wfit</code>.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the second stage model fit,
as returned by <code>lm.wfit</code>.
</p>


<h3>Author(s)</h3>

<p>Peter Aronow &lt;peter.aronow@yale.edu&gt;, Dean Eckles &lt;dean@deaneckles.com&gt;, Kyle Peyton &lt;kyle.peyton@yale.edu&gt;
</p>


<h3>References</h3>

<p>Peter M. Aronow and Allison Carnegie. (2013). Beyond LATE: Estimation of the average treatment effect with an instrumental variable. <em>Political Analysis</em>.
</p>


<h3>See Also</h3>

<p><code><a href="stats.html#topic+lm.wfit">lm.wfit</a></code>.
</p>
<p><code><a href="#topic+compliance.score">compliance.score</a></code> for calculating compliance scores used in example. 
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Load example dataset, see help(FoxDebate) for details
data(FoxDebate)

# Estimate compliance scores with covariates, assuming (default) 
#   case of two-sided non-compliance.
covmat &lt;- with(FoxDebate, cbind(partyid, pnintst, watchnat, educad, readnews, gender, 
                                income, white))

cscoreout &lt;- with(FoxDebate, compliance.score(D = watchpro, Z = conditn,
                              W = covmat))

# Extract vector of estimated compliance scores
cscore &lt;- cscoreout$C.score

# Winsorising as described in Aronow and Carnegie (2013)
N &lt;- length(FoxDebate[, "infopro"])
alpha &lt;- 0.275
qcscore &lt;- quantile(cscore, 1 / (N^alpha))
cscore[cscore &lt; qcscore] &lt;- qcscore

# IPW reweighting step Aronow and Carnegie (2013) use for missing data
Ymis &lt;- is.na(FoxDebate[,"infopro"])

IPWweight &lt;- 1 / (1 - predict(glm(Ymis ~ covmat, family = binomial(link = "probit")), 
                              type = "response"))
IPWweight[Ymis] &lt;- 0

# Compute LATE via 2SLS with IPW weights. This replicates 
#   Table 2 Column 1 in Aronow and Carnegie (2013)
outputTSLS &lt;- with(FoxDebate, tsls.wfit(X = cbind(1, covmat, watchpro), Y = infopro, 
                        Z = cbind(1, covmat, conditn), weights = IPWweight))
round(outputTSLS$coefficients, 2)

# Compute ATE via 2SLS with (IPW weights / compliance scores). This
#   replicates Table 2 Column 2 in Aronow and Carnegie (2013)
outputICSW &lt;- with(FoxDebate, tsls.wfit(cbind(1, watchpro, covmat), infopro, 
                        cbind(1, conditn, covmat), w = IPWweight / cscore))
round(outputICSW$coefficients, 2) 

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
