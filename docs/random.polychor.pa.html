<!DOCTYPE html><html><head><title>Help for package random.polychor.pa</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {random.polychor.pa}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#NEWS'><p>News for Package <span class="pkg">random.polychor.pa</span></p></a></li>
<li><a href='#Parallel-Analysis-of-Polychoric-Correlations'>
<p>A Parallel Analysis with Random Polychoric Correlation Matrices</p></a></li>
<li><a href='#random.polychor.pa'><p>A Parallel Analysis with Randomly Generated Polychoric</p>
Correlation Matrices</a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>A Parallel Analysis with Polychoric Correlation Matrices</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1.4-5</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-06-29</td>
</tr>
<tr>
<td>Description:</td>
<td>The Function performs a parallel analysis using simulated polychoric correlation matrices. The nth-percentile of the eigenvalues distribution obtained from both the randomly generated and the real data polychoric correlation matrices is returned. A plot comparing the two types of eigenvalues (real and simulated) will help determine the number of real eigenvalues that outperform random data. The function is based on the idea that if real data are non-normal and the polychoric correlation matrix is needed to perform a Factor Analysis, then the Parallel Analysis method used to choose a non-random number of factors should also be based on randomly generated polychoric correlation matrices and not on Pearson correlation matrices. Random data sets are simulated assuming or a uniform or a multinomial distribution or via the bootstrap method of resampling (i.e., random permutations of cases). Also Multigroup Parallel analysis is made available for random (uniform and multinomial distribution and with or without difficulty factor) and bootstrap methods. An option to choose between default or full output is also available as well as a parameter to print Fit Statistics (Chi-squared, TLI, RMSEA, RMR and BIC) for the factor solutions indicated by the Parallel Analysis. Also weighted correlation matrices may be considered for PA. </td>
</tr>
<tr>
<td>Depends:</td>
<td>psych, nFactors, boot</td>
</tr>
<tr>
<td>Imports:</td>
<td>MASS, mvtnorm, sfsmisc</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>yes</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-07-15 09:18:12 UTC; fabio</td>
</tr>
<tr>
<td>Author:</td>
<td>Fabio Presaghi [aut, cre],
  Marta Desimoni [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Fabio Presaghi &lt;fabio.presaghi@uniroma1.it&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-07-15 09:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='NEWS'>News for Package <span class="pkg">random.polychor.pa</span></h2><span id='topic+news'></span>

<h3>Description</h3>

<p>The function performs a parallel analysis using simulated polychoric correlation matrices. The function will extract the eigenvalues from each random generated polychoric correlation matrix and from the polychoric correlation matrix of real data. A plot comparing eigenvalues   extracted from the specified real data with simulated data will help determine which of real eigenvalue outperform random data. A series of matrices comparing MAP vs PA-Polychoric vs PA-Pearson correlations methods, FA vs PCA solutions are finally presented. Random data sets are simulated assuming or a uniform or a multinomial distribution or via the bootstrap method of resampling (i.e., random permutations of cases). Also Multigroup Parallel analysis is made available for random (uniform and multinomial distribution and with or without difficulty factor) and bootstrap methods. An option to choose between default or full output is also available as well as a parameter to print Fit Statistics (Chi-squared, TLI, RMSEA, RMR and BIC) for the factor solutions indicated by the Parallel Analysis.
</p>


<h3>Changes in version 1.1.4-5</h3>


<p>Version 1.1.4-5 fixes some bugs.

</p>


<h3>Changes in version 1.1.4-4</h3>


<p>Version 1.1.4-4 the following parameters were added: 1) <code>weights</code> allows the reader to pass a vector of weights to compute a weighted random polychor (or pearson) correlation matrix and simulate weighted samples. If also <code>bootstrap</code> is selected then weighted samples will be bootstrapped. Finally if <code>multisample</code> is also selected then the <code>random.polychor.pa</code> function will simulate weighted random samples for each sub-sample.
Version 1.1.4-4 fixed the following issues: 1) if a value is passed for continuity check now the correct values is displayed in the output, and not the fixed values of .5 as was in previous version; 2) in previous versions if <code>fit.pa</code> parameter was selected it was not infrequent that the <code>random.polychor.pa()</code> function unexpectedly stopped after having run part of the simulations. The problem was due to the fact that for some simulated data, the function found non-valid value for RMSEA and/or for BIC indices. In the present version a series of checks were added to prevent the function to stop unxepectedly for these problems linked to fit indices estimation.

</p>


<h3>Changes in version 1.1.4-3</h3>


<p>Version 1.1.4-3 fixed two problems: in example 1 we use bfi data from psych package as data example. However the datafile has been moved to <code>psychTools</code> so the example is modified accordingly. The second problem concerns an unexpected crash of <code>random.polychoric.pa</code> when calling <code>polychoric</code> function (from <code>psych</code> package) due to the correction for continuity that is set by default to 0.5 (i.e. <code>correct=TRUE</code> in <code>polychoric</code> function. Correction for continuity is used for replacing cells with zero counts. This correction for continuity in some situations determines NAs that causes the <code>polychoric</code> function to stop. To handle such problem we added a parameter to the <code>random.polychor.pa</code> function to set to 0.0 the correction for continuity. Users are warned that polychoric correlation matrices with and without correction for continuity differ. 

</p>


<h3>Changes in version 1.1.4-2</h3>


<p>Version 1.1.4-2 fixed minor bugs when running the example 1, and when displaying the time needed to complete the simulations.

</p>


<h3>Changes in version 1.1.4-1</h3>


<p>Version 1.1.4-1 a problem with the <code>psych</code> dependency was fixed: 
</p>
<ul>
<li><p> the option (<code>polycor=TRUE</code>) in the <code>polychoric</code> function was removed and consequently it is also no more possible to call the polycor function in running the <code>random.polychor.pa</code> function
</p>
</li></ul>



<h3>Changes in version 1.1.4</h3>


<p>Version 1.1.4 added a number of cahnges: 
</p>
<ul>
<li><p> a parameter <code>distr</code> allows to shift the simulation from uniform distribtuion to multinomial distribution
</p>
</li>
<li><p> Bootstrap method (with random permutations of cases) was added
</p>
</li>
<li><p> Multi-Group for random and bootstrap version of the Parallel Analysis is made available
</p>
</li>
<li><p> Fit statistics (Chi-squared, TLI, RMSEA, RMR, BIC) for all factor solution indicated by Parallel Analysis
</p>
</li>
<li><p> option to print a default output (number of factors indicated by Parallel Analysis) or a full output (adds: matrices of simulated and empirical eigenvalues for random, bootstrap, and multigroup)
</p>
</li></ul>



<h3>Changes in version 1.1.3.6</h3>


<ul>
<li><p> In version 1.1.3.6 a check for the range of quantile (between 0 and 1) was added.
</p>
</li></ul>



<h3>Changes in version 1.1.3.5</h3>


<ul>
<li><p> The search for zeroes within the provided datafile was removed, so data with zeroes are now accepted.
</p>
</li></ul>



<h3>Changes in version 1.1.3.5</h3>


<ul>
<li><p> In version 1.1.3.5 a paramether was added, <code>diff.fact</code>, in order to simulate random dataset with the same probability of observing each category for each variable as that         observed in the provided (empirical) dataset.
</p>
</li></ul>



<h3>Changes in version 1.1.3</h3>


<p>Version 1.1.3 tackles two problems signalled by users: 
</p>
<ul>
<li><p> the possibility to make available the results of simulation for plotting them in other software. Now the <code>random.polychor.pa()</code> will show, upon request, all the data used in the scree-plot.
</p>
</li>
<li><p> The function <code>polichoric()</code> of the <code>psych()</code> package does not handle data matrices that include 0 as possible category and will cause the function to stop with error. So a check for the detection of the 0 code within the provided data.matrix is now added and will cause the random.polychor.pa function to stop with a warning message.
</p>
</li></ul>



<h3>Changes in version 1.1.2</h3>


<ul>
<li><p> Version 1.1.2 simply has updated the function that calculates the polychoric correlation matrix due to changes in the <code>psych()</code> package.
</p>
</li></ul>



<h3>Changes in version 1.1.1</h3>


<ul>
<li><p> Version 1.1.1, fixed a minor bug in the regarding the estimated time needed to complete the simulation. 
</p>
</li>
<li><p> Also in this version, the function is now able to manage supplied data.matrix in which variables representing factors (i.e., variables with ordered categories) are present and may cause an error when the Pearson correlation matrix is calculated. 
</p>
</li></ul>


<hr>
<h2 id='Parallel-Analysis-of-Polychoric-Correlations'>
A Parallel Analysis with Random Polychoric Correlation Matrices
</h2><span id='topic+random.polychor.pa-package'></span>

<h3>Description</h3>

<p>The function performs a parallel analysis using simulated polychoric correlation matrices. The function will extract the eigenvalues from each random generated polychoric correlation matrix and from the polychoric correlation matrix of real data. A plot comparing eigenvalues extracted from the specified real data with simulated data will help determine which of real eigenvalue outperform random data. A series of matrices comparing MAP vs PA-Polychoric vs PA-Pearson correlations methods, FA vs PCA solutions are finally presented.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
    Package: </td><td style="text-align: left;"> random.polychor.pa</td>
</tr>
<tr>
 <td style="text-align: left;">
    Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
    Version: </td><td style="text-align: left;"> 1.1.4-4</td>
</tr>
<tr>
 <td style="text-align: left;">
    Date: </td><td style="text-align: left;"> 2023-06-29</td>
</tr>
<tr>
 <td style="text-align: left;">
    License: </td><td style="text-align: left;"> GPL Version 2 or later</td>
</tr>
<tr>
 <td style="text-align: left;">
    LazyLoad: </td><td style="text-align: left;"> yes</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p>The function perform a parallel analysis (Horn, 1965) using randomly simulated polychoric correlations and generates <code>nrep</code> random samples of the same dimension of the empirical provided data.matrix(i.e, with the same number of participants and of variables). Items are allowed to have varying number of categories. The function will extract the eigenvalues from each randomly generated polychoric matrices and the declared quantile will be extracted. Eigenvalues from polychoric correlation matrix obtained from real data are also computed and compared, in a (scree) plot, with the eigenvalues extracted from the simulation (Polychoric matrices). Recently Cho, Li &amp; Bandalos (2009), showed that in using PA method, it is important to match the type of the correlation matrix used to recover the eigenvalues from real data with the type of correlation matrix used to estimate random eigenvalues. Crossing the type of correlations (using Polychoric correlation matrix to estimate real eigenvalues and random simulated Pearson correlation matrices) may result in a wrong decision (i.e., retaining less non-random factors than the needed). A comparison with eigenvalues extracted from both randomly simulated Pearson correlation matrices and real data is also also included. Finally, for both type of correlation matrix (Polychoric vs Pearson), the two versions (the classic squared coefficient and the 4th power coefficient) of Velicer's MAP criterion are calculated. In version 1.1.1, a minor bug in the regarding the estimated time needed to complete the simulation is fixed. Also in this version, the function is now able to manage supplied data.matrix in which variables representing factors (i.e., variables with ordered categories) are present and may cause an error when the Pearson correlation matrix is calculated. As the <code>poly.mat()</code> function used to calculate the polychoric correlation matrix is going to be deprecated in favor of poly.mat(polychoric()) function, the random.polychor.pa was consequently updated (version 1.1.2) to account for changes in <code>psych()</code> package.  Version 1.1.3 tackles two problems signaled by users: 1) the possibility to make available the results of simulation for plotting them in other software. Now the random.polychor.pa will show, upon request, all the data used in the scree-plot. 2) The function <code>polichoric()</code> of the <code>psych()</code> package does not handle data matrices that include 0 as possible category and will cause the function to stop with error. So a check for the detection of the 0 code within the provided data.matrix is now added and will cause the random.polychor.pa function to stop with a warning message. In version 1.1.3.5 a parameter was added, <code>diff.fact</code> in order to simulate random data set with the same probability of observing each category for each variable as that observed in the provided (empirical) data set. This parameter allows to simulate data sets that have the same item difficulties distribution as well as the same difficulty factors of the real data (Ledesma and Valero-Mora, 2007). Finally the search for zeroes within the provided data file was removed, so data with zeroes are now accepted. In version 1.1.3.6 a check for the range of quantile (between 0 and 1) was added. 
In version 1.1.4 was added the possibility to choose between uniform and multinomial distribution, between random and boostrap distribution and between single or multiple sample parallel analysis. Also two switches were added: one allows to print or a default output (including only the number of factors to retain following Parallel Analysis and the scree-plot) or a full output (including the eigenvalues distributions of simulated and empirical data sets); the other switch allows to print a further Fit Statistics for the factor solutions indicated by the Parallel Analysis. 
</p>
<p>The default value of the <code>comparison</code> is set to <code>random</code> and this means that random uniform samples (<code>runif()</code>) will be computed. Two types of distribution are available: the uniform distribution and the multinomial distribution (Liu and Rijmen, 2008). To switch between them just set accordingly the parameter <code>distr</code>. As method of resampling is now also available the bootstrap method that is based on random permutations of cases obtained via the <code>boot()</code> function. 
</p>
<p>Multigroup version of random samples may be obtained by setting the parameter <code>comparison</code> to <code>random-mg</code>. To perform multigroup Parallel Analysis simulating random samples with multinomial distributions the parameter  <code>distr</code> should be set to <code>multinomial</code>. Multigroup Parallel Analysis is also available for the bootstrap method by setting the <code>comparison</code> parameter to <code>bootstrap-mg</code>. When Multigroup Parallel Analysis is used, the first variable (column) of the dataset should be reserved to the factor used to identify the different samples (i.e., gender, agre groups, nationalities, etc.).  
</p>
<p>Fit statistics (Chi-squared, TLI, RMSEA, RMR, BIC) for all factor solutions indicated by Parallel Analysis are available when the parameter <code>fit.pa</code> is set to <code>TRUE</code>. Consider that in estimating the these Fit Statistic indexes not allways converge and this may break the computations for the parallel analysis. In this case switch the parameter off. Moreover the values of these indexes are not allways within the expected range. 
</p>
<p>The <code>print.all</code> parameter when set to  <code>TRUE</code> will show the table of eigenvalue distributions for simulated (random or boostrap) and empirical data. For boostrap simulation, also the bias and standard error will be printed. If the <code>diff.fact</code> is set to <code>TRUE</code> when random simulations are requested, then also the weighting matrix used to reproduce the item frequencies in random data set will be printed.
</p>
<p>The <code>continuity</code> parameter is passed to polychoric() function to handle the correction for continuity. In polychoric() function this correction for continuity is set by default to .5 (i.e. correct=TRUE). However in some cases this correction for continuity causes the polychorich() function to stop unexpectedly and consequently also random.polychor.pa() stops. So we added this parameter to allow users to bypass this problem. This parameter is set by default to 0.0 (i.e., no correction for continuity applied) and user may add the correction for continuity by setting the value to 0.5.
</p>
<p>The <code>wght</code> parameter allows the user to provide a vector of non-negative weights to compute a weighted random polychor (or pearson) correlation matrix and as well the simulation of weighted random samples. If <code>bootstrap</code> is also selected, then a weighted bootstrap samples will be extracted. Finally if <code>multisample</code> is also selected then it will be computed a random weighted samples for each sub-group. 
</p>


<h3>Author(s)</h3>

<p>Fabio Presaghi <a href="mailto:fabio.presaghi@uniroma1.it">fabio.presaghi@uniroma1.it</a> and Marta Desimoni <a href="mailto:marta.desimoni@uniroma1.it">marta.desimoni@uniroma1.it</a>
</p>


<h3>References</h3>

<p>Cho, S.J., Li, F., &amp; Bandalos, D., (2009). Accuracy of the Parallel Analysis Procedure With Polychoric Correlations. Educational and Psychological Measurement, 69, 748-759.
</p>
<p>Horn, J. L. (1965). A rationale and test for the number of factors in factor analysis. Psychometrika, 32, 179-185.
</p>
<p>Ledesma RD, Valero-Mora P (2007) Determining the number of factors to retain in EFA: an  easy to use computer program for carrying out parallel analysis. Practical Assessment, Research &amp; Evaluation 12:1–11
</p>
<p>O<kbd>'</kbd>Connor, B. P. (2000). SPSS and SAS programs for determining the number of components using parallel analysis and Velicer<kbd>'</kbd>s MAP test. Behavior Research Methods, Instrumentation, and Computers, 32, 396-402.
</p>
<p>Reckase, M.D. (2009). Multidimensional Item Response Theory. Springer. 
</p>
<p>Velicer, W. F. (1976). Determining the number of factors from the matrix of partial correlations. Psychometrika, 41, 321-327.
</p>
<p>Velicer, W. F., Eaton, C. A., &amp; Fava, J. L. (2000). Construct explication through factor or component analysis: A review and evaluation of alternative procedures for determining the number of factors or components. In R. D. Goffin &amp; E. Helmes (Eds.), Problems and solutions in human assessment: Honoring Douglas N. Jackson at seventy (pp. 41-72). Norwell, MA: Kluwer Academic.
</p>

<hr>
<h2 id='random.polychor.pa'>A Parallel Analysis with Randomly Generated Polychoric
Correlation Matrices
</h2><span id='topic+random.polychor.pa'></span>

<h3>Description</h3>

<p>The function performs a parallel analysis using simulated polychoric correlation matrices. The eigenvalues (extracted following both FA and PCA methods) from each random generated polychoric correlation matrix and from the polychoric correlation matrix of real solutions from Polychorich vs Pearson correlations, FA vs PCA and PA vs MAP are presented. Random data sets are simulated assuming or a uniform or a multinomial distribution or via the bootstrap method of resampling (i.e., random permutations of cases). Also Multigroup Parallel analysis is made available for random (uniform and multinomial distribution and with or without difficulty factor) and bootstrap methods. An option to choose between default or full output is also available as well as a parameter to print Fit Statistics (Chi-squared, TLI, RMSEA, RMR and BIC) for the factor solutions indicated by the Parallel Analysis.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>random.polychor.pa(nvar="NULL", n.ss="NULL", nrep, nstep="NULL", 
                  data.matrix, q.eigen, r.seed = "NULL", diff.fact=FALSE, distr="NULL", 
                  comparison = "random", fit.pa=FALSE, print.all=FALSE, continuity=0.0, 
                  wght="NULL") 
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="random.polychor.pa_+3A_nvar">nvar</code></td>
<td>
<p>Number of variables (items) in the raw data matrix. From 
version 1.1 of the function, it is no more needed to specificy nvar as 
this information is derived from the number of columns of the data.matrix. 
Default value is set to &quot;NULL&quot; for compatibility with past version of the 
function
</p>
</td></tr>
<tr><td><code id="random.polychor.pa_+3A_n.ss">n.ss</code></td>
<td>

<p>Number of participants of the raw data matrix. From version 1.1 of the 
function, it is no more needed to specify n.ss as this information is 
derived from the number of rows of the data.matrix. Default value is set 
to &quot;NULL&quot; for compatibility with past version of the function. 
</p>
</td></tr>
<tr><td><code id="random.polychor.pa_+3A_nrep">nrep</code></td>
<td>
<p>Number of random samples that should be simulated
</p>
</td></tr>
<tr><td><code id="random.polychor.pa_+3A_nstep">nstep</code></td>
<td>
<p>Number of ordered categories of the item (e.g., Likert-like 3 
ordered category item). This information is no longer needed as the new 
version of the function (1.1) allows also for items with varying number of 
categories. The number of categories from each item is derived directly from 
the data.matrix. A table summarizing the different groups of item with 
different number of categories will be showed. Default value is set to 
&quot;NULL&quot; for compatibility with past version of the function.
</p>
</td></tr>
<tr><td><code id="random.polychor.pa_+3A_data.matrix">data.matrix</code></td>
<td>

<p>the name of raw data matrix. The raw data.matrix should be numeric and 
none of the ordered category should be coded as 0 (zero). No automatic 
recode routine is provided within the function to deal with alphanumeric 
content of the ordered categories of manifest variables. So the user performs 
all these recodings before running the function.
</p>
</td></tr>
<tr><td><code id="random.polychor.pa_+3A_q.eigen">q.eigen</code></td>
<td>

<p>a number comprised within the interval of 0 and 1 and indicating the quantile 
that is used to choose the number of non-random factors (e.g., .50 or .95 
or .99)
</p>
</td></tr>
<tr><td><code id="random.polychor.pa_+3A_r.seed">r.seed</code></td>
<td>

<p>eventually, a preferred number that will be used to initialize the random 
generator. Default value: 1335031435.
</p>
</td></tr>
<tr><td><code id="random.polychor.pa_+3A_diff.fact">diff.fact</code></td>
<td>

<p>default value is FALSE and in this case the function will estimate random datasets without trying to reproduce each observed category with the same probability as that observed in the empirical dataset provided. If the paramether is set on TRUE, the function will simulate random samples with the same proportion of each category for each item as that of empirical dataset. This parameter allows to simulate data sets that have the same item difficulties distribution as well as the same difficulty factors of the real data (Ledesma and Valero-Mora, 2007)
</p>
</td></tr>
<tr><td><code id="random.polychor.pa_+3A_distr">distr</code></td>
<td>

<p>this parameter allows to choose between <code>uniform</code> (that is also the default) or <code>multinomial</code> distribution for the simulation of random data sets. 
</p>
</td></tr>
<tr><td><code id="random.polychor.pa_+3A_comparison">comparison</code></td>
<td>

<p>four methods are now available: random, bootstrap, multigroup-random, multigroup-bootstrap. Allowed values are: <code>random</code> for random simulated dataset; <code>bootstrap</code> for boostrap simulations with permutation as method of resampling; <code>random-mg</code> for random multi-group simulated datasets; <code>bootstrap-mg</code> for bootstrap multigroup simulated datasets. When bootstrap method is choosen, the bootstraped eigenvalue distribution is compared with that obtained from empirical data and the PA algorithm will indicate the number of empirical eigenvalues that are greater than the corresponding bootstraped eigenvalues.
</p>
</td></tr>
<tr><td><code id="random.polychor.pa_+3A_fit.pa">fit.pa</code></td>
<td>

<p>when set to TRUE, the fit statistics (Chi-squared, TLI, RMSEA, RMR, BIC) for all factor solutions indicated by Parallel Analysis will be printed. This parameter allows a call to the <code>fa()</code> function of the <code>psych</code> package, and passes just the number of factor to retain with all remaining values set to the default (i.e., <code>fm="minres"</code>, <code>rotate="oblimin"</code>, etc.)
</p>
</td></tr>
<tr><td><code id="random.polychor.pa_+3A_print.all">print.all</code></td>
<td>

<p>when set to TRUE, all the simulated (random or bootstrap) and empirical eigenvalue distributions will be printed for each samples. When <code>comparison</code> is equal to <code>bootstrap</code> or <code>bootstrap-mg</code> also the bootstrap bias and standard error estimates will be printed. 
</p>
</td></tr>
<tr><td><code id="random.polychor.pa_+3A_continuity">continuity</code></td>
<td>

<p>by default is set to 0.0 meaning no correction for continuity will be applied. However if needed users may add the correction for continuity by setting the parameter to 0.5 to handle zero count cells. The parameter is passed to the <code>polychoric</code> function of the <code>psych</code> package.
</p>
</td></tr>
<tr><td><code id="random.polychor.pa_+3A_wght">wght</code></td>
<td>

<p>a vector of positive and non-zero weights of the same length of the dataset and with no missing values can be passed to the function in order to compute a weighted polychoric (or pearson) correlation matrix. The default is set to &quot;NULL&quot; meaning that weights are all equal to 1/nrow(data.matrix)
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function perform a parallel analysis (Horn, 1976) using randomly simulated polychoric correlations and generates <code>nrep</code> random samples of simulated data with the same number of participants and of variables of the provided data.matrix. The function will read the entered data.matrix and extracts: the number of units (i.e., number of rows); the number of variables (i.e., number of columns); and the number of categories of each item. From version 1.1, the function accepts also variables with varying number of categories (e.g., three items with only two categories and two items with three categories, etc.). In version 1.1.1, the function is also able to manage supplied data.matrix in which variables represent factors (i.e., variables with ordered categories) may cause an error when the Pearson correlation matrix is calculated. The information in the supplied data.matrix are used to generate the <code>nrep</code> random raw datasets with the same characteristics of the original real data set. So only three information are needed for the problem to run: the number of replications (<code>nrep</code>), the data matrix (<code>data.matrix</code>) and the percentile to be used (<code>q.eigen</code>). 
</p>
<p>A check for missing values within the real dataset is present and if present will be treated LISTWISE. In this case a warning message will prompt the user signalling how NA were treated (LISTWISE is by now the only treatment considered) and the new sample size. No further checks are made on the raw data, so out-of-range values are not detected and it is on the behalf of the user to make a preliminary check on the reliability of data. A table summarizing the groups of items with different number of categories will be shown along with the main results of the PA. 
</p>
<p>The function will extract the eigenvalues from each randomly generated polychoric matrices and the requested percentile is returned. Eigenvalues from polychoric correlation matrix obtained from real data is also computed and  compared with the eigenvalues extracted from the simulation (Polychoric matrices) in a (scree) plot. Results from classical Factor Analysis and Principal Component Analysis are made available. Separated random data sets are simulated for the two analysis.
</p>
<p>Recently, Cho, Li &amp; Bandalos (2009) showed that, in using PA method, it is important to match the type of the correlation matrix used to recover the eigenvalues from real data with the type of correlation matrix used to estimate random eigenvalues. Crossing the type of correlations (using Polychoric correlation matrix to estimate real eigenvalues and random simulated Pearson correlation matrices) may result in a wrong decision (i.e., retaining more non-random factors than the needed). A comparison with eigenvalues extracted from both randomly simulated Pearson correlation matrices and real data is also included. 
</p>
<p>Finally, for both type of correlation matrix (Polychoric vs Pearson), the two versions (the classic squared coefficient and the 4th power coefficient) of   Velicer's MAP criterion are calculated (Velicer, 1976; Velicer, Eaton, &amp; Fava, 2000) by implementing under R the code released by O'Connor (2000) for SPSS, SAS and MATLAB. 
</p>
<p>As the <code>poly.mat()</code> function used to calculate the polychoric correlation matrix is going to be deprecated in favour of polychoric() function, the random.polychor.pa was consequently updated (version 1.1.2) to account for changes in <code>psych()</code> package. 
</p>
<p>Version 1.1.3 tackles two problems signalled by users: 1) the possibility to make available the results of simulation for plotting them in other softwares. Now the random.polychor.pa will show, upon request, all the data used in the scree-plot. 2) The function <code>polichoric()</code>  of the <code>psych()</code> package does not handle data matrices that include 0 as possible category and will cause the function to stop with error. So a check for the detection of the 0 code within the provided data.matrix is now added and will cause the random.polychor.pa function to stop with a warning message. 
</p>
<p>In version 1.1.3.5 a paramether was added, <code>diff.fact</code>, in order to simulate random dataset with the same probability of observing each category for each variable as that observed in the provided (empirical) dataset. This paramether was added for those reaserchers that want to replicate random datasets with the same distribution of item difficulties as the real data (Ledesma, Valero-Mora, 2007; Reckase, 2009, pp.216). Finally the search for zeroes within the provided datafile was removed, so data with zeroes are now accepted. 
</p>
<p>In version 1.1.3.6 a check for the range of quantile (beteen 0 and 1) was added.
</p>
<p>In version 1.1.4 was added the possibility to choose between uniform and multinomial distribution, between random and boostrap distribution and between single or multiple sample parallel analysis. Also two switches were added: one allows to print or a default output (including only the number of factors to retain following Parallel Analysis and the scree-plot) or a full output (including the eigenvalues distributions of simulated and empirical data sets); the other switch allows to print a further Fit Statistics for the factor solutions indicated by the Parallel Analysis. 
</p>
<p>The default value of the <code>comparison</code> is set to <code>random</code> and this means that random uniform samples (<code>runif()</code>) will be computed. Two types of distribution are available: the uniform distribution and the multinomial distribution (Liu and Rijmen, 2008). To switch between them just set accordingly the parameter <code>distr</code>. As method of resampling is now also available the bootstrap method that is based on random permutations of cases obtained via the <code>boot()</code> function. 
</p>
<p>Multigroup version of random uniform samples may be obtained by setting the parameter <code>comparison</code> to <code>random-mg</code>. To perform multigroup Parallel Analysis simulating random samples with multinomial distributions the parameter  <code>distr</code> should be set to <code>multinomial</code>. Multigroup Parallel Analysis is also available for the bootstrap method by setting the <code>comparison</code> parameter to <code>bootstrap-mg</code>. When Multigroup Parallel Analysis is used, the first variable (column) of the dataset should be reserved to the factor used to identify the different samples (i.e., gender, agre groups, nationalities, etc.).  
</p>
<p>Fit statistics (Chi-squared, TLI, RMSEA, RMR, BIC) for all factor solutions indicated by Parallel Analysis are available when the parameter <code>fit.pa</code> is set to <code>TRUE</code>. Consider that in estimating the these Fit Statistic indexes not allways converge and this may break the computations for the parallel analysis. In this case switch the parameter off. Moreover the values of these indexes are not allways within the expected range. 
</p>
<p>The <code>print.all</code> parameter when set to  <code>TRUE</code> will show the tables of eigenvalue distributions for simulated (random or boostrap) and empirical data. For boostrap simulation, also the bias and standard error will be printed. If the <code>diff.fact</code> is set to <code>TRUE</code> when random simulations are requested, then also the weighting matrix used to reproduce the item frequencies in random data set will be printed.
</p>
<p>The <code>continuity</code> parameter is passed to <code>polychoric</code> function to handle the correction for continuity. In <code>polychoric</code> function this correction for continuity is set by default to .5 (i.e. correct=TRUE). However in some cases this correction for continuity causes the <code>polychorich</code> function to stop unexpectedly and consequently also <code>random.polychor.pa</code> function stops unexpectedly. So we added this parameter to allow users to bypass this problem. This parameter is set by default to 0.0 (i.e., no correction for continuity applied) and user may add the correction for continuity by setting the value to 0.5.
</p>
<p>The <code>wght</code> parameter allows to compute a weighted correlation matrix. If a vector of weights is passed to the function, then a weighted polychoric (pearson) correlation matrix will be computed. Also simulated data will be weighted as well as bootstrap samples if select. In case of multisample option, user have to provide a vectors of weights opportunely set accordingly to grouping factor. Weights will affects all indices computed from Parallel Analysis including MAP
</p>


<h3>Value</h3>

<p>The default output (<code>print.all=FALSE</code>) prints the number of factors for Polychoric and Pearson Correlation PA methods for Factor Analysis and Principal Components Analysis (PCA) methods along with the number of factors chosen by the two Velicer's MAP criteria (original and 4th power) for both Polychoric and Pearson correlation matrices. Furthermore, the function will return the (scree) plot of the eigenvalues for real (Polychoric vs Pearson correlation matrices) and simulated data (Polychoric vs Pearson correlation matrices). If the parameter <code>print.all</code> is set to <code>TRUE</code> then other than the defaul output, it will also be printed the tables of eigenvalue distributions for simulated (random (uniform or multinomial) or boostrap) and empirical data. For boostrap simulation, also the bias and standard error will be printed. If the <code>diff.fact</code> is set to <code>TRUE</code> when random simulations are requested, then also the weighting matrix used to reproduce the item frequencies in random data set will be printed. 
</p>


<h3>Note</h3>

<p>In running the random.polychor.pa function it should be reminded that 
it may take a lot of time to complete the simulation. This is due in 
part to the fact that the estimation of the polychoric correlation matrix 
is cumbersome and in part to the fact that the code is not optimized, 
but simply it does the work.
</p>
<p>Occasionally, in calculating the polychoric correlation matrix it may 
occur an error when the matrix is non-positive definite. In this case 
you have to re-run the simulation.
</p>
<p>A note should be made concerning the method used (from version 1.1) to 
read the raw data.matrix supplied by the user and used to retrieve the 
three basic information needed to build the random matrices (number of 
rows, number of columns and the number of categories for each manifest 
variable). The number of categories for each variable is derived from the 
raw data.matrix, so if the possible number of categories for a specific 
item is for example 5, but subjects endorse only three out of the five 
categories then the random.polychor.pa function will simulate a variable 
with only three categories. This means that the function guarantees that 
the empirical and the simulated data matrix are similar, but this also 
means that by changing the sample of participants the simulated data will 
change (even if slightly). 
</p>
<p>In computing the polychoric correlation matrix for both simulated and empirical data sets, the parameter <code>global</code> of the <code>polychoric()</code> function is set to FALSE and the text message &quot;The items do not have an equal number of response alternatives, global set to FALSE&quot; is suppressed with the <code>suppressMessages()</code> function. 
</p>


<h3>Author(s)</h3>

<p>Fabio Presaghi <a href="mailto:fabio.presaghi@uniroma1.it">fabio.presaghi@uniroma1.it</a> and Marta Desimoni
<a href="mailto:marta.desimoni@uniroma1.it">marta.desimoni@uniroma1.it</a> 
</p>


<h3>References</h3>

<p>Cho, S.J., Li, F., &amp; Bandalos, D., (2009). Accuracy of the Parallel Analysis Procedure With Polychoric Correlations. Educational and Psychological Measurement, 69, 748-759.
</p>
<p>Horn, J. L. (1965). A rationale and test for the number of factors in factor analysis. Psychometrika, 32, 179-185.
</p>
<p>Ledesma RD, Valero-Mora P (2007) Determining the number of factors to retain in EFA: an  easy to use computer program for carrying out parallel analysis. Practical Assessment, Research &amp; Evaluation 12:1–11
</p>
<p>Liu, O.L., and Rijmen, F., (2008) A modified procedure for parallel analysis of ordered categorical data. Behavior Research Methods, 40 (2), 556-562. doi: 10.3758/BRM.40.2.556
</p>
<p>O<kbd>'</kbd>Connor, B. P. (2000). SPSS and SAS programs for determining the number of components using parallel analysis and Velicer<kbd>'</kbd>s MAP test. Behavior Research Methods, Instrumentation, and Computers, 32, 396-402.
</p>
<p>Reckase, M.D. (2009). Multidimensional Item Response Theory. Springer. 
</p>
<p>Velicer, W. F. (1976). Determining the number of factors from the matrix of partial correlations. Psychometrika, 41, 321-327.
</p>
<p>Velicer, W. F., Eaton, C. A., &amp; Fava, J. L. (2000). Construct explication through factor or component analysis: A review and evaluation of alternative procedures for determining the number of factors or components. In R. D. Goffin &amp; E. Helmes (Eds.), Problems and solutions in human assessment: Honoring Douglas N. Jackson at seventy (pp. 41-72). Norwell, MA: Kluwer Academic.
</p>


<h3>See Also</h3>

<p><code>nFactors</code>, <code>psych</code>, <code>paran</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>### EXAMPLE 1:
### basic use of the function with a subset of the bfi data from \code{psychTools}
### number of replications is held at minimum just for running the example. 
### You would raise this number to consitent values
# bfi data is attached to the psychTools() package, so if not already loaded, 
# load the package by running: require(psychTools)
data(bfi)
names(bfi)
bfi.data&lt;-na.exclude(as.matrix(bfi[1:200, 1:5])) 
head(bfi.data)
random.polychor.pa(nrep=3, data.matrix=bfi.data, q.eigen=.99)


### EXAMPLE 2:
### in this example one of the categories of item1 is recoded: 2=1
### so this item has 5 categories: 1 (2) 3 4 5 6
### category 1 is within brackets as it has frequency=0
### so this is a case where empirical data (0 2 3 4 5 6) diverge from
### theorethical data (0 1 2 3 4 5 6)
#require(psych)
#data(bfi)
#raw.data.1&lt;-as.matrix(bfi)
#raw.data.1 &lt;- (raw.data.1[1:200,1:25])
#for(i in 1:nrow(raw.data.1)) { if(raw.data.1[i,1]==2) raw.data.1[i,1]&lt;-1} 
#test.2&lt;-random.polychor.pa(nrep=100, data.matrix=raw.data.1, q.eigen=.99)
#test.2

### EXAMPLE 3:
######## for SPSS users ####
### the following instructions can used to load a SPSS data file (.sav).
### 1) load the library to read external datafile (e.g., SPSS datafile)
### 2) choose the SPSS datafile by pointing directly in the folder 
#      on your hard-disk
### 3) select only the variables (i.e., the items) needed to for 
#      Parallel Analysis
#&gt; library(foreign) ### load the needed library
#&gt; raw.data &lt;- read.spss(choose.files(), use.value.labels=TRUE,
#                       max.value.labels=Inf, to.data.frame=TRUE)
#&gt; raw.spss.item &lt;- na.exclude(raw.data[,2:4])
#&gt; summary (raw.spss.item)
#&gt; random.polychor.pa(nrep=5, data.matrix=raw.spss.item, q.eigen=.99)

### EXAMPLE 4a:
### in this case the paramether diff.fact is set to TRUE, so the function 
### will simulate random dataset with the same probability of occurrence
### of each category for each item in the observed dataset. 
### Dichotomous variables are used in this example.
#require(psych)
#data(bock)
### DICHTOMOUS
#random.polychor.pa(nrep=3, data.matrix=lsat6, q.eigen=.99, diff.fact=TRUE)

### EXAMPLE 4b:
### in this case the paramether diff.fact is set to TRUE, so the function 
### will simulate random dataset with the same probability of occurrence
### of each category for each item in the observed dataset. 
### Polythomous variables are used in this example.
#require(psych)
#data(bfi)
#raw.data.4a&lt;-as.matrix(bfi)
#raw.data.4a &lt;- (raw.data.4a[1:200,1:25])
### POLYTHOMOUS
#random.polychor.pa(nrep=100, data.matrix=raw.data.4a, q.eigen=.99, diff.fact=TRUE)

### EXAMPLE 5:
### RANDOM VS BOOSTRAP SIMULATED DATA
### UNIFORM VS MULTINOMIAL DISTRIBUTION
#require(psych)
#data(bfi)
#names(bfi)
#bfi.data&lt;-na.exclude(as.matrix(bfi[1:200, 1:5])) 
#head(bfi.data)
### RANDOM samples and UNIFORM distribution
#random.polychor.pa(nrep=100, data.matrix=bfi.data, q.eigen=.95, comparison=c("random"), 
#		distr="uniform", fit.pa=T, print.all=T) 
### RANDOM samples and MULTINOMIAL distribution
#random.polychor.pa(nrep=100, data.matrix=bfi.data, q.eigen=.95, comparison=c("random"), 
#		distr="multinomial", fit.pa=T, print.all=T) 

### BOOTSTRAP and UNIFORM distribution
#random.polychor.pa(nrep=100, data.matrix=bfi.data, q.eigen=.95, comparison=c("bootstrap"), 
#		distr="uniform", fit.pa=T, print.all=T) 
### BOOTSTRAP and MULTINOMIAL distribution
#random.polychor.pa(nrep=100, data.matrix=bfi.data, q.eigen=.95, comparison=c("bootstrap"), 
#		distr="multinomial", fit.pa=T, print.all=T) 


### EXAMPLE 6:
### MULTIGROUP PARALLEL ANALYSIS: 2 samples
#require(psych)
#data(bfi)
#names(bfi)
#table(bfi$gender)
#table(bfi$education)
#table(bfi$age)
#bfi.data.gender&lt;-cbind(bfi[1:200, 26], bfi[1:200, 1:5])
#head(bfi.data.gender)

# MULTIGROUP PARALLEL ANALYSIS: RANDOM UNIFORM
#random.polychor.pa(nrep=100, data.matrix=bfi.data.gender, q.eigen=.95, comparison=c("random-mg"),
#		distr="uniform", fit.pa=T, print.all=T) 
# MULTIGROUP PARALLEL ANALYSIS: RANDOM MULTINOMIAL
#random.polychor.pa(nrep=100, data.matrix=bfi.data.gender, q.eigen=.95, comparison=c("random-mg"),
#		distr="multinomial", fit.pa=T, print.all=T) 

# MULTIGROUP PARALLEL ANALYSIS: BOOTSTRAP UNIFORM
#random.polychor.pa(nrep=100, data.matrix=bfi.data.gender, q.eigen=.95, 
#		comparison=c("bootstrap-mg"), distr="uniform", fit.pa=T, print.all=T) 
# MULTIGROUP PARALLEL ANALYSIS: BOOTSTRAP MULTINOMIAL
#random.polychor.pa(nrep=100, data.matrix=bfi.data.gender, q.eigen=.95, 
#		comparison=c("bootstrap-mg"), distr="multinomial", fit.pa=T, print.all=T) 


### EXAMPLE 7:
### MULTIGROUP PARALLEL ANALYSIS: 11 samples
#require(psych)
#data(bfi)
#names(bfi)
#table(bfi$age)
#raw.data&lt;- subset(bfi, bfi$age&gt;=17 &amp; bfi$age&lt;=27)
#table(raw.data$age)
#bfi.data.age&lt;-cbind(raw.data[, 28], raw.data[, 1:10])
#head(bfi.data.age)

#random.polychor.pa(nrep=100, data.matrix=bfi.data.age, q.eigen=.95, comparison=c("random-mg"))


### EXAMPLE 8: 
### WEIGHTED SAMPLE
#require(psych)
#data(bfi)
#table(bfi$gender)
## computing weights for gender assuming gender distribution in population is: 1==.20; 2==.80 
#bfi$w.sex&lt;-(bfi$gender == 1)*(0.20)+(bfi$gender == 2)*(0.80)
#bfi.data&lt;-na.omit(cbind(bfi[, 1:10],bfi$w.sex))
#random.polychor.pa(nrep=100, data.matrix=bfi.data[, 1:10], q.eigen=.95, wght=bfi.data[,11])
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
