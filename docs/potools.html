<!DOCTYPE html><html lang="en"><head><title>Help for package potools</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {potools}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#potools-package'><p>potools: Tools for Internationalization and Portability in R Packages</p></a></li>
<li><a href='#check_cracked_messages'><p>Check for cracked messages more suitable for templating</p></a></li>
<li><a href='#check_potools_sys_reqs'><p>Check if the proper system utilities for running package translation are</p>
installed</a></li>
<li><a href='#check_untranslated_cat'><p>Check for untranslated messages emitted by cat</p></a></li>
<li><a href='#check_untranslated_src'><p>Check for cracked messages in C/C++ sources</p></a></li>
<li><a href='#get_message_data'><p>Extract user-visible messages from a package</p></a></li>
<li><a href='#po_compile'><p>Compile <code>.po</code> files to <code>.mo</code></p></a></li>
<li><a href='#po_create'><p>Create a new <code>.po</code> file</p></a></li>
<li><a href='#po_explain_plurals'><p>Explain plural message criteria verbally</p></a></li>
<li><a href='#po_extract'><p>Extract messages for translation into a <code>.pot</code> file</p></a></li>
<li><a href='#po_update'><p>Update all <code>.po</code> files with changes in <code>.pot</code></p></a></li>
<li><a href='#translate_package'><p>Interactively provide translations for a package's messages</p></a></li>
<li><a href='#write_po_file'><p>Write a .po or .pot file corresponding to a message database</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Tools for Internationalization and Portability in R Packages</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.4</td>
</tr>
<tr>
<td>Description:</td>
<td>Translating messages in R packages is managed using the po
    top-level directory and the 'gettext' program. This package provides
    some helper functions for building this support in R packages, e.g.
    common validation &amp; I/O tasks.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/MichaelChirico/potools">https://github.com/MichaelChirico/potools</a>,
<a href="https://michaelchirico.github.io/potools/">https://michaelchirico.github.io/potools/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/MichaelChirico/potools/issues">https://github.com/MichaelChirico/potools/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.0.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>data.table, glue</td>
</tr>
<tr>
<td>Suggests:</td>
<td>crayon, knitr, rmarkdown, testthat (&ge; 3.1.5), withr</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>gettext</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-10-30 05:14:35 UTC; michael</td>
</tr>
<tr>
<td>Author:</td>
<td>Michael Chirico [cre, aut],
  Hadley Wickham [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Michael Chirico &lt;MichaelChirico4@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-10-30 08:10:10 UTC</td>
</tr>
</table>
<hr>
<h2 id='potools-package'>potools: Tools for Internationalization and Portability in R Packages</h2><span id='topic+potools'></span><span id='topic+potools-package'></span>

<h3>Description</h3>

<p><img src="../help/figures/logo.png" style='float: right' alt='logo' width='120' />
</p>
<p>Translating messages in R packages is managed using the po top-level directory and the 'gettext' program. This package provides some helper functions for building this support in R packages, e.g. common validation &amp; I/O tasks.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Michael Chirico <a href="mailto:MichaelChirico4@gmail.com">MichaelChirico4@gmail.com</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> Hadley Wickham
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://github.com/MichaelChirico/potools">https://github.com/MichaelChirico/potools</a>
</p>
</li>
<li> <p><a href="https://michaelchirico.github.io/potools/">https://michaelchirico.github.io/potools/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/MichaelChirico/potools/issues">https://github.com/MichaelChirico/potools/issues</a>
</p>
</li></ul>


<hr>
<h2 id='check_cracked_messages'>Check for cracked messages more suitable for templating</h2><span id='topic+check_cracked_messages'></span>

<h3>Description</h3>

<p>Diagnose the R messages in a package to discover the presence of &quot;cracked&quot;
messages better served for translation by templating. See Details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_cracked_messages(message_data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_cracked_messages_+3A_message_data">message_data</code></td>
<td>
<p>A <code>data.table</code>, or object convertible to one.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Error messages built like
<code>stop("You gave ", n, " arguments, but ", m, " are needed.")</code> are
in general hard for translators &ndash; the correct
translation may be in a totally different order (e.g., this is often the
case for Japanese). It is preferable instead to use
<code><a href="base.html#topic+sprintf">base::gettextf()</a></code> to build a templated message like
<code>stop(gettextf("You gave %d arguments but %d are needed.", n, m))</code>.
Translators are then free to rearrange the template to put the numeric
pattern where it fits most naturally in the target language.
</p>


<h3>Value</h3>

<p>A <code>data.table</code> with columns <code>call</code>, <code>file</code>,
<code>line_number</code>, and <code>replacement</code> summarizing the results.
</p>


<h3>Author(s)</h3>

<p>Michael Chirico
</p>


<h3>See Also</h3>

<p><code><a href="#topic+translate_package">translate_package()</a></code>, <code><a href="tools.html#topic+update_pkg_po">update_pkg_po()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
pkg &lt;- file.path(system.file(package = 'potools'), 'pkg')
# copy to a temporary location to be able to read/write/update below
tmp_pkg &lt;- file.path(tempdir(), "pkg")
dir.create(tmp_pkg)
file.copy(pkg, dirname(tmp_pkg), recursive = TRUE)

# first, extract message data
message_data = get_message_data(tmp_pkg)

# now, diagnose the messages for any "cracked" ones
check_cracked_messages(message_data)

# cleanup
unlink(tmp_pkg, recursive = TRUE)
rm(pkg, tmp_pkg, message_data)
</code></pre>

<hr>
<h2 id='check_potools_sys_reqs'>Check if the proper system utilities for running package translation are
installed</h2><span id='topic+check_potools_sys_reqs'></span>

<h3>Description</h3>

<p>potools uses the same gettext command line tools that R itself does to run
translation. These are required for translation to work properly; this
function is mainly for testing use &amp; checks whether the current environment
is equipped for translation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_potools_sys_reqs(which = SYSTEM_REQUIREMENTS)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_potools_sys_reqs_+3A_which">which</code></td>
<td>
<p>Which requirements to test for. Defaults to all of
the command-line utilities on which potools relies, namely,
</p>

<ul>
<li> <p><code>msgmerge</code>
</p>
</li>
<li> <p><code>msgfmt</code>
</p>
</li>
<li> <p><code>msginit</code>
</p>
</li>
<li> <p><code>msgconv</code>
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p>Specifically, potools relies on these command-line utilities:
</p>


<h3>Value</h3>

<p><code>TRUE</code> if the system is ready for translation, otherwise a
message suggesting how to proceed.
</p>


<h3>Author(s)</h3>

<p>Michael Chirico
</p>


<h3>See Also</h3>

<p><code><a href="tools.html#topic+update_pkg_po">tools::update_pkg_po()</a></code>
</p>

<hr>
<h2 id='check_untranslated_cat'>Check for untranslated messages emitted by cat</h2><span id='topic+check_untranslated_cat'></span>

<h3>Description</h3>

<p>Diagnose the R messages in a package to discover the presence of messages
emitted by <code><a href="base.html#topic+cat">cat()</a></code> which haven't been translated (i.e., passed
through <code><a href="base.html#topic+gettext">gettext()</a></code>, <code><a href="base.html#topic+gettextf">gettextf()</a></code>, or
<code><a href="base.html#topic+ngettext">ngettext()</a></code>).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_untranslated_cat(message_data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_untranslated_cat_+3A_message_data">message_data</code></td>
<td>
<p>A <code>data.table</code>, or object convertible to one.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The function <code>cat</code> is commonly used to emit messages to users (e.g.,
for a <code>verbose</code> mode), but it is not equipped for translation. Instead,
messages must first be translated and then emitted. Any character literals
found in the package's R code used in <code>cat</code> but not translated will be
flagged by this function.
</p>
<p>For flagged calls, a potential replacement is offered, built using
<code>gettext</code> or <code>gettextf</code> (depending on whether one or more
<code>...</code> arguments are supplied to <code>cat</code>). For the <code>gettextf</code>
case, the suggested template is always <code style="white-space: pre;">&#8288;%s&#8288;</code> (string) since this works
for all inputs; the author should tighten this to the appropriate
<code><a href="base.html#topic+sprintf">sprintf()</a></code> template marker as appropriate, for example if the author
knows the input is an integer, use <code style="white-space: pre;">&#8288;%d&#8288;</code> or <code style="white-space: pre;">&#8288;%i&#8288;</code> instead of <code style="white-space: pre;">&#8288;%s&#8288;</code>.
</p>
<p>NB: not all <code>cat</code> calls are included &ndash; in particular, no <code>cat</code>
call specifying a non-default <code>file</code> are flagged, nor are any where the
supplied <code>sep</code> is not a character literal (e.g., <code>sep=x</code> instead
of <code>sep=""</code>)
</p>


<h3>Value</h3>

<p>A <code>data.table</code> with columns <code>call</code>, <code>file</code>,
<code>line_number</code>, and <code>replacement</code> summarizing the results.
</p>


<h3>Author(s)</h3>

<p>Michael Chirico
</p>


<h3>See Also</h3>

<p><code><a href="#topic+translate_package">translate_package()</a></code>, <code><a href="tools.html#topic+update_pkg_po">update_pkg_po()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
pkg &lt;- file.path(system.file(package = 'potools'), 'pkg')
# copy to a temporary location to be able to read/write/update below
tmp_pkg &lt;- file.path(tempdir(), "pkg")
dir.create(tmp_pkg)
file.copy(pkg, dirname(tmp_pkg), recursive = TRUE)

# first, extract message data
message_data = get_message_data(tmp_pkg)

# now, diagnose the messages for any untranslated strings shown through cat()
check_untranslated_cat(message_data)

# cleanup
unlink(tmp_pkg, recursive = TRUE)
rm(pkg, tmp_pkg, message_data)
</code></pre>

<hr>
<h2 id='check_untranslated_src'>Check for cracked messages in C/C++ sources</h2><span id='topic+check_untranslated_src'></span>

<h3>Description</h3>

<p>Diagnose the C/C++ messages in a package to discover untranslated messages
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_untranslated_src(message_data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_untranslated_src_+3A_message_data">message_data</code></td>
<td>
<p>A <code>data.table</code>, or object convertible to one.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This diagnostic looks for literal <code>char</code> arrays passed to messaging
functions (as identified by <code><a href="#topic+translate_package">translate_package()</a></code>) which are not
marked for translation (by tagging them for translation with <code style="white-space: pre;">&#8288;_&#8288;</code> or
<code>N_</code> macros). These strings cannot be translated until they are so
marked.
</p>


<h3>Value</h3>

<p>A <code>data.table</code> with columns <code>call</code>, <code>file</code>,
<code>line_number</code>, and <code>replacement</code> summarizing the results.
<code>replacement</code> is <code>NA</code> at this time, i.e., no replacement is
provided.
</p>


<h3>Author(s)</h3>

<p>Michael Chirico
</p>


<h3>See Also</h3>

<p><code><a href="#topic+translate_package">translate_package()</a></code>, <code><a href="tools.html#topic+update_pkg_po">update_pkg_po()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
pkg &lt;- file.path(system.file(package = 'potools'), 'pkg')
# copy to a temporary location to be able to read/write/update below
tmp_pkg &lt;- file.path(tempdir(), "pkg")
dir.create(tmp_pkg)
file.copy(pkg, dirname(tmp_pkg), recursive = TRUE)

# first, extract message data
message_data = get_message_data(
  tmp_pkg,
  custom_translation_functions = list(src = "ReverseTemplateMessage:2")
)

# now, diagnose the messages for any untranslated messages in C/C++
check_untranslated_src(message_data)

# cleanup
unlink(tmp_pkg, recursive = TRUE)
rm(pkg, tmp_pkg, message_data)
</code></pre>

<hr>
<h2 id='get_message_data'>Extract user-visible messages from a package</h2><span id='topic+get_message_data'></span>

<h3>Description</h3>

<p>This function looks in the R and src directories of a package for
user-visible messages and compiles them as a
<code><a href="data.table.html#topic+data.table">data.table::data.table()</a></code> to facilitate
analyzing this corpus as such.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_message_data(
  dir = ".",
  custom_translation_functions = list(R = NULL, src = NULL),
  style = NULL,
  verbose = !is_testing()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_message_data_+3A_dir">dir</code></td>
<td>
<p>Character, default the present directory; a directory in which an
R package is stored.</p>
</td></tr>
<tr><td><code id="get_message_data_+3A_custom_translation_functions">custom_translation_functions</code></td>
<td>
<p>A <code>list</code> with either/both of two
components, <code>R</code> and <code>src</code>, together governing how to extract any
non-standard strings from the package.
</p>
<p>See Details in <code><a href="#topic+translate_package">translate_package()</a></code>.</p>
</td></tr>
<tr><td><code id="get_message_data_+3A_style">style</code></td>
<td>
<p>Translation style, either <code>"base"</code> or <code>"explict"</code>.
The default, <code>NULL</code>, reads from the <code>DESCRIPTION</code> field
<code>Config/potools/style</code> so you can specify the style once for your
package.
</p>
<p>Both styles extract strings explicitly flagged for translation with
<code>gettext()</code> or <code>ngettext()</code>. The base style additionally extracts
strings in calls to <code>stop()</code>, <code>warning()</code>, and <code>message()</code>,
and to <code>stopf()</code>, <code>warningf()</code>, and <code>messagef()</code> if you have
added those helpers to your package. The explicit style also accepts
<code>tr_()</code> as a short hand for <code>gettext()</code>. See
<code>vignette("developer")</code> for more details.</p>
</td></tr>
<tr><td><code id="get_message_data_+3A_verbose">verbose</code></td>
<td>
<p>Logical, default <code>TRUE</code> (except during testing). Should
extra information about progress, etc. be reported?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>data.table</code> with the following schema:
</p>

<ul>
<li> <p><code>message_source</code>: <code>character</code>, either <code>"R"</code> or <code>"src"</code>,
saying whether the string was found in the R or the src folder of the
package
</p>
</li>
<li> <p><code>type</code>: <code>character</code>, either <code>"singular"</code> or
<code>"plural"</code>; <code>"plural"</code> means the string came from
<code><a href="base.html#topic+ngettext">ngettext()</a></code> and can be pluralized
</p>
</li>
<li> <p><code>file</code>: <code>character</code>, the file where the string was found
</p>
</li>
<li> <p><code>msgid</code>: <code>character</code>, the string (character literal or <code>char</code> array as
found in the source); missing for all <code>type == "plural"</code> strings
</p>
</li>
<li> <p><code>msgid_plural</code>: <code>list(character, character)</code>, the strings
(character literals or <code>char</code> arrays as found in the source); the first
applies in English for <code>n=1</code> (see <code>ngettext</code>), while the second
applies for <code>n!=1</code>; missing for all <code>type == "singular"</code> strings
</p>
</li>
<li> <p><code>call</code>: <code>character</code>, the full call containing the string
that was found
</p>
</li>
<li> <p><code>line_number</code>: <code>integer</code>, the line in <code>file</code> where the string was found
</p>
</li>
<li> <p><code>is_repeat</code>: <code>logical</code>, whether the <code>msgid</code> is a duplicate within this
<code>message_source</code>
</p>
</li>
<li> <p><code>is_marked_for_translation</code>:<code>logical</code>, whether the string is marked for
translation (e.g., in R, all character literals supplied to a <code>...</code> argument in
<code><a href="base.html#topic+stop">stop()</a></code> are so marked)
</p>
</li>
<li> <p><code>is_templated</code>, <code>logical</code>, whether the string is templatable (e.g., uses
<code style="white-space: pre;">&#8288;%s&#8288;</code> or other formatting markers)
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Michael Chirico
</p>


<h3>See Also</h3>

<p><code><a href="#topic+translate_package">translate_package()</a></code>,
<code><a href="#topic+write_po_file">write_po_file()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
pkg &lt;- system.file('pkg', package = 'potools')
get_message_data(pkg)

# includes strings provided to the custom R wrapper function catf()
get_message_data(pkg, custom_translation_functions = list(R = "catf:fmt|1"))

# includes untranslated strings provided to the custom
#   C/C++ wrapper function ReverseTemplateMessage()
get_message_data(
  pkg,
  custom_translation_functions = list(src = "ReverseTemplateMessage:2")
)

# cleanup
rm(pkg)

</code></pre>

<hr>
<h2 id='po_compile'>Compile <code>.po</code> files to <code>.mo</code></h2><span id='topic+po_compile'></span>

<h3>Description</h3>

<p>This function compiles the plain text <code>.po</code> files that translators work
with into the binary <code>.mo</code> files that are installed with packages and
used for live translations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>po_compile(dir = ".", package = NULL, lazy = TRUE, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="po_compile_+3A_dir">dir</code></td>
<td>
<p>Path to package root directory.</p>
</td></tr>
<tr><td><code id="po_compile_+3A_package">package</code></td>
<td>
<p>Name of package. If not supplied, read from
<code>DESCRIPTION</code>.</p>
</td></tr>
<tr><td><code id="po_compile_+3A_lazy">lazy</code></td>
<td>
<p>If <code>TRUE</code>, only <code>.mo</code> functions that are older than
<code>.po</code> files be updated</p>
</td></tr>
<tr><td><code id="po_compile_+3A_verbose">verbose</code></td>
<td>
<p>If <code>TRUE</code>, print information as it goes.</p>
</td></tr>
</table>

<hr>
<h2 id='po_create'>Create a new <code>.po</code> file</h2><span id='topic+po_create'></span>

<h3>Description</h3>

<p><code>po_create()</code> creates a new <code style="white-space: pre;">&#8288;po/{languages}.po&#8288;</code> containing the messages to be
translated.
</p>
<p>Generally, we expect you to use <code>po_create()</code> to create new <code>.po</code> files
but if you call it with an existing translation, it will update it with any
changes from the <code>.pot</code>. See <code><a href="#topic+po_update">po_update()</a></code> for details.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>po_create(languages, dir = ".", verbose = !is_testing())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="po_create_+3A_languages">languages</code></td>
<td>
<p>Language identifiers. These are typically two letters (e.g.
&quot;en&quot; = English, &quot;fr&quot; = French, &quot;es&quot; = Spanish, &quot;zh&quot; = Chinese), but
can include an additional suffix for languages that have regional
variations (e.g. &quot;fr_CN&quot; = French Canadian, &quot;zh_CN&quot; = simplified
characters as used in mainland China, &quot;zh_TW&quot; = traditional characters
as used in Taiwan.)</p>
</td></tr>
<tr><td><code id="po_create_+3A_dir">dir</code></td>
<td>
<p>Character, default the present directory; a directory in which an
R package is stored.</p>
</td></tr>
<tr><td><code id="po_create_+3A_verbose">verbose</code></td>
<td>
<p>Logical, default <code>TRUE</code> (except during testing). Should
extra information about progress, etc. be reported?</p>
</td></tr>
</table>

<hr>
<h2 id='po_explain_plurals'>Explain plural message criteria verbally</h2><span id='topic+po_explain_plurals'></span>

<h3>Description</h3>

<p>The <code>nplural</code> syntax in .po file metadata can be hard to grok,
even for native speakers. This function tries to de-mystify
this by providing verbal expressions of which numbers apply
to which index in the <code>msgstr</code> array.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>po_explain_plurals(language, index)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="po_explain_plurals_+3A_language">language</code></td>
<td>
<p>A single locale code. See <code><a href="#topic+translate_package">translate_package()</a></code> for details.</p>
</td></tr>
<tr><td><code id="po_explain_plurals_+3A_index">index</code></td>
<td>
<p>Optional. If supplied, a 0-based index to
explain for a given language. If not supplied, all plurals
for the supplied language are described.</p>
</td></tr>
</table>

<hr>
<h2 id='po_extract'>Extract messages for translation into a <code>.pot</code> file</h2><span id='topic+po_extract'></span>

<h3>Description</h3>

<p><code>po_extract()</code> scans your package for strings to be translated and
saves them into a <code>.pot</code> template file (in the package's <code>po</code>
directory). You should never modify this file by hand; instead modify the
underlying source code and re-run <code>po_extract()</code>.
</p>
<p>If you have existing translations, call <code><a href="#topic+po_update">po_update()</a></code> after <code><a href="#topic+po_extract">po_extract()</a></code>
to update them with the changes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>po_extract(
  dir = ".",
  custom_translation_functions = list(),
  verbose = !is_testing(),
  style = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="po_extract_+3A_dir">dir</code></td>
<td>
<p>Character, default the present directory; a directory in which an
R package is stored.</p>
</td></tr>
<tr><td><code id="po_extract_+3A_custom_translation_functions">custom_translation_functions</code></td>
<td>
<p>A <code>list</code> with either/both of two
components, <code>R</code> and <code>src</code>, together governing how to extract any
non-standard strings from the package.
</p>
<p>See Details in <code><a href="#topic+translate_package">translate_package()</a></code>.</p>
</td></tr>
<tr><td><code id="po_extract_+3A_verbose">verbose</code></td>
<td>
<p>Logical, default <code>TRUE</code> (except during testing). Should
extra information about progress, etc. be reported?</p>
</td></tr>
<tr><td><code id="po_extract_+3A_style">style</code></td>
<td>
<p>Translation style, either <code>"base"</code> or <code>"explict"</code>.
The default, <code>NULL</code>, reads from the <code>DESCRIPTION</code> field
<code>Config/potools/style</code> so you can specify the style once for your
package.
</p>
<p>Both styles extract strings explicitly flagged for translation with
<code>gettext()</code> or <code>ngettext()</code>. The base style additionally extracts
strings in calls to <code>stop()</code>, <code>warning()</code>, and <code>message()</code>,
and to <code>stopf()</code>, <code>warningf()</code>, and <code>messagef()</code> if you have
added those helpers to your package. The explicit style also accepts
<code>tr_()</code> as a short hand for <code>gettext()</code>. See
<code>vignette("developer")</code> for more details.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The extracted messages as computed by <code><a href="#topic+get_message_data">get_message_data()</a></code>,
invisibly.
</p>

<hr>
<h2 id='po_update'>Update all <code>.po</code> files with changes in <code>.pot</code></h2><span id='topic+po_update'></span>

<h3>Description</h3>

<p><code>po_update()</code> updates existing <code>.po</code> file after the <code>.pot</code> file has changed.
There are four cases:
</p>

<ul>
<li><p> New messages: added with blank <code>msgstr</code>.
</p>
</li>
<li><p> Deleted messages: marked as deprecated and moved to the bottom of the file.
</p>
</li>
<li><p> Major changes to existing messages: appear as an addition and a deletion.
</p>
</li>
<li><p> Minor changes to existing messages: will be flagged as fuzzy.
</p>
<div class="sourceCode"><pre>#, fuzzy, c-format
#| msgid "Generating en@quot translations"
msgid "Updating '%s' %s translation"
msgstr "memperbarui terjemahan bahasa en@quot..."
</pre></div>
<p>The previous message is given in comments starting with <code style="white-space: pre;">&#8288;#|&#8288;</code>.
Translators need to update the actual (uncommented) <code>msgstr</code> manually,
using the old <code>msgid</code> as a potential reference, then
delete the old translation and the <code>fuzzy</code> comment (c-format should
remain, if present).
</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>po_update(dir = ".", lazy = TRUE, verbose = !is_testing())
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="po_update_+3A_dir">dir</code></td>
<td>
<p>Character, default the present directory; a directory in which an
R package is stored.</p>
</td></tr>
<tr><td><code id="po_update_+3A_lazy">lazy</code></td>
<td>
<p>If <code>TRUE</code>, only <code>.po</code> files that are older than their
corresponding <code>.pot</code> file will be updated.</p>
</td></tr>
<tr><td><code id="po_update_+3A_verbose">verbose</code></td>
<td>
<p>Logical, default <code>TRUE</code> (except during testing). Should
extra information about progress, etc. be reported?</p>
</td></tr>
</table>

<hr>
<h2 id='translate_package'>Interactively provide translations for a package's messages</h2><span id='topic+translate_package'></span>

<h3>Description</h3>

<p>This function handles the &quot;grunt work&quot; of building and updating translation
libraries. In addition to providing a friendly interface for supplying
translations, some internal logic is built to help make your package more
translation-friendly.
</p>
<p>To get started, the package developer should run <code>translate_package()</code> on
your package's source to produce a template <code>.pot</code> file (or files, if your
package has both R and C/C++ messages to translated), e.g.
</p>
<p>To add translations in your desired language, include the target language:
in the <code>translate_package(languages = "es")</code> call.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>translate_package(
  dir = ".",
  languages = NULL,
  diagnostics = list(check_cracked_messages, check_untranslated_cat,
    check_untranslated_src),
  custom_translation_functions = list(R = NULL, src = NULL),
  max_translations = Inf,
  use_base_rules = package %chin% .potools$base_package_names,
  copyright = NULL,
  bugs = "",
  verbose = !is_testing()
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="translate_package_+3A_dir">dir</code></td>
<td>
<p>Character, default the present directory; a directory in which an
R package is stored.</p>
</td></tr>
<tr><td><code id="translate_package_+3A_languages">languages</code></td>
<td>
<p>Character vector; locale codes to which to translate.
Must be a valid language accepted by gettext. This almost always takes
the form of (1) an ISO 639 2-letter language code; or (2) <code>ll_CC</code>, where
<code>ll</code> is an ISO 639 2-letter language code and <code>CC</code> is an ISO 3166 2-letter
country code e.g. <code>es</code> for Spanish, <code>es_AR</code> for Argentinian Spanish, <code>ro</code>
for Romanian, etc. See <code><a href="base.html#topic+locales">base::Sys.getlocale()</a></code> for some helpful tips
about how to tell which locales are currently available on your machine, and
see the References below for some web resources listing more locales.</p>
</td></tr>
<tr><td><code id="translate_package_+3A_diagnostics">diagnostics</code></td>
<td>
<p>A <code>list</code> of diagnostic functions to be run on the
package's message data. See Details.</p>
</td></tr>
<tr><td><code id="translate_package_+3A_custom_translation_functions">custom_translation_functions</code></td>
<td>
<p>A <code>list</code> with either/both of two
components, <code>R</code> and <code>src</code>, together governing how to extract any
non-standard strings from the package. See Details.</p>
</td></tr>
<tr><td><code id="translate_package_+3A_max_translations">max_translations</code></td>
<td>
<p>Numeric; used for setting a cap on the number of
translations to be done for each language. Defaults to <code>Inf</code>, meaning
all messages in the package.</p>
</td></tr>
<tr><td><code id="translate_package_+3A_use_base_rules">use_base_rules</code></td>
<td>
<p>Logical; Should internal behavior match base behavior
as strictly as possible? <code>TRUE</code> if being run on a base package (i.e.,
<code>base</code> or one of the default packages like <code>utils</code>,
<code>graphics</code>, etc.). See Details.</p>
</td></tr>
<tr><td><code id="translate_package_+3A_copyright">copyright</code></td>
<td>
<p>Character; passed on to <code><a href="#topic+write_po_file">write_po_file()</a></code>.</p>
</td></tr>
<tr><td><code id="translate_package_+3A_bugs">bugs</code></td>
<td>
<p>Character; passed on to <code><a href="#topic+write_po_file">write_po_file()</a></code>.</p>
</td></tr>
<tr><td><code id="translate_package_+3A_verbose">verbose</code></td>
<td>
<p>Logical, default <code>TRUE</code> (except during testing). Should
extra information about progress, etc. be reported?</p>
</td></tr>
</table>


<h3>Value</h3>

<p>This function returns nothing invisibly. As a side effect, a
&lsquo;<span class="file">.pot</span>&rsquo; file is written to the package's &lsquo;<span class="file">po</span>&rsquo; directory (updated if
one does not yet exist, or created from scratch otherwise), and a &lsquo;<span class="file">.po</span>&rsquo;
file is written in the same directory for each element of <code>languages</code>.
</p>


<h3>Phases</h3>

<p><code>translate_package()</code> goes through roughly three &quot;phases&quot; of translation.
</p>

<ol>
<li><p> Setup &ndash; <code>dir</code> is checked for existing translations
(toggling between &quot;update&quot; and &quot;new&quot; modes), and R files are parsed and
combed for user-facing messages.
</p>
</li>
<li><p> Diagnostics:  see the Diagnostics section below. Any
diagnostic detecting &quot;unhealthy&quot; messages will result in a yes/no prompt to
exit translation to address the issues before continuing.
</p>
</li>
<li><p> Translation. All of the messages found in phase one are iterated over &ndash;
the user is shown a message in English and prompted for the translation
in the target language. This process is repeated for each domain
in <code>languages</code>.
</p>
</li></ol>

<p>An attempt is made to provide hints for some translations that require
special care (e.g. that have escape sequences or use templates). For
templated messages (e.g., that use <code style="white-space: pre;">&#8288;%s&#8288;</code>), the user-provided message
must match the templates of the English message. The templates <em>don't</em>
have to be in the same order &ndash; R understands template reordering, e.g.
<code style="white-space: pre;">&#8288;%2$s&#8288;</code> says &quot;interpret the second input as a string&quot;. See
<code><a href="base.html#topic+sprintf">sprintf()</a></code> for more details.
</p>
<p>After each language is completed, a corresponding &lsquo;<span class="file">.po</span>&rsquo; file is written
to the package's &lsquo;<span class="file">po</span>&rsquo; directory (which is created if it does not yet
exist).
</p>
<p>There are some discrepancies in the default behavior of
<code>translate_package</code> and the translation workflow used to generate the
&lsquo;<span class="file">.po</span>&rsquo;/&lsquo;<span class="file">.pot</span>&rsquo; files for R itself (mainly, the suite of functions
from <code>tools</code>, <code><a href="tools.html#topic+update_pkg_po">tools::update_pkg_po()</a></code>,
<code><a href="tools.html#topic+xgettext">tools::xgettext2pot()</a></code>, <code><a href="tools.html#topic+xgettext">tools::xgettext()</a></code>, and
<code><a href="tools.html#topic+xgettext">tools::xngettext()</a></code>). They should only be superficial (e.g.,
whitespace or comments), but nevertheless may represent a barrier to
smoothly submitting patchings to R Core. To make the process of translating
base R and the default packages (<code>tools</code>, <code>utils</code>, <code>stats</code>,
etc.) as smooth as possible, set the <code>use_base_rules</code> argument to
<code>TRUE</code> and your resulting &lsquo;<span class="file">.po</span>&rsquo;/&lsquo;<span class="file">.pot</span>&rsquo;/&lsquo;<span class="file">.mo</span>&rsquo; file will
match base's.
</p>


<h3>Custom translation functions</h3>

<p><code>base</code> R provides several functions for messaging that are natively equipped
for translation (they all have a <code>domain</code> argument): <code>stop()</code>, <code>warning()</code>,
<code>message()</code>, <code>gettext()</code>, <code>gettextf()</code>, <code>ngettext()</code>, and
<code>packageStartupMessage()</code>.
</p>
<p>While handy, some developers may prefer to write their own functions, or to
write wrappers of the provided functions that provide some enhanced
functionality (e.g., templating or automatic wrapping). In this case,
the default R tooling for translation (<code>xgettext()</code>, <code>xngettext()</code>
<code>xgettext2pot()</code>, <code>update_pkg_po()</code> from <code>tools</code>) will not work, but
<code>translate_package()</code> and its workhorse <code>get_message_data()</code> provide an
interface to continue building  translations for your workflow.
</p>
<p>Suppose you wrote a function <code>stopf()</code> that is a wrapper of
<code>stop(gettextf())</code> used to build templated error messages in R, which makes
translation easier for translators (see below), e.g.:
</p>
<div class="sourceCode R"><pre>stopf = function(fmt, ..., domain = NULL) {
  stop(gettextf(fmt, ...), domain = domain, call. = FALSE)
}
</pre></div>
<p>Note that <code>potools</code> itself uses just such a wrapper internally to build
error messages! To extract strings from calls in your package to <code>stopf()</code>
and mark them for translation, use the argument
<code>custom_translation_functions</code>:
</p>
<div class="sourceCode R"><pre>get_message_data(
  '/path/to/my_package',
  custom_translation_functions = list(R = 'stopf:fmt|1')
)
</pre></div>
<p>This invocation tells <code>get_message_data()</code> to look for strings in the
<code>fmt</code> argument in calls to <code>stopf()</code>. <code>1</code> indicates that <code>fmt</code> is the
first argument.
</p>
<p>This interface is inspired by the <code>--keyword</code> argument to the
<code>xgettext</code> command-line tool. This argument consists of a list with two
components, <code>R</code> and <code>src</code> (either can be excluded), owing to
differences between R and C/C++. Both components, if present, should consist
of a character vector.
</p>
<p>For R, there are two types of input: one for named arguments, the other for
unnamed arguments.
</p>

<ul>
<li><p> Entries for <strong>named</strong> arguments will look like <code>"fname:arg|num"</code> (singular
string) or <code>"fname:arg1|num1,arg2|num2"</code> (plural string). <code>fname</code>
gives the name of the function/call to be extracted from the R source,
<code>arg</code>/<code>arg1</code>/<code>arg2</code> specify the name of the argument to
<code>fname</code> from which strings should be extracted, and
<code>num</code>/<code>num1</code>/<code>num2</code> specify the <em>order</em> of the named
argument within the signature of <code>fname</code>.
</p>
</li>
<li><p> Entries for <strong>unnamed</strong> arguments will look like
<code>"fname:...\xarg1,...,xargn"</code>, i.e., <code>fname</code>, followed by
<code>:</code>, followed by <code>...</code> (three dots), followed by a backslash
(<code style="white-space: pre;">&#8288;\&#8288;</code>), followed by a comma-separated list of argument names. All
strings within calls to <code>fname</code> <em>except</em> those supplied to the
arguments named among <code>xarg1</code>, ..., <code>xargn</code> will be extracted.
</p>
</li></ul>

<p>To clarify, consider the how we would (redundantly) specify
<code>custom_translation_functions</code> for some of the default messagers,
<code>gettext</code>, <code>gettextf</code>, and <code>ngettext</code>:
<code>custom_translation_functions = list(R = c("gettext:...\domain", "gettextf:fmt|1", "ngettext:msg1|2,msg2|3"))</code>.
</p>
<p>For src, there is only one type of input, which looks like
<code>"fname:num"</code>, which says to look at the <code>num</code> argument of calls
to <code>fname</code> for <code>char</code> arrays.
</p>
<p>Note that there is a difference in how translation works for src vs. R &ndash; in
R, all strings passed to certain functions are considered marked for
translations, but in src, all translatable strings must be explicitly marked
as such. So for <code>src</code> translations, <code>custom_translation_functions</code>
is not used to customize which strings are marked for translation, but
rather, to expand the set of calls which are searched for potentially
<em>untranslated</em> arrays (i.e., arrays passed to the specified calls that
are not explicitly marked for translation). These can then be reported in
the <code><a href="#topic+check_untranslated_src">check_untranslated_src()</a></code> diagnostic, for example.
</p>


<h3>Diagnostics</h3>



<h4>Cracked messages</h4>

<p>A cracked message is one like:
</p>
<div class="sourceCode r"><pre>stop("There are ", n, " good things and ", m, " bad things.")
</pre></div>
<p>In its current state, translators will be asked to translate three messages
independently:
</p>

<ul>
<li><p> &quot;There are&quot;
</p>
</li>
<li><p> &quot;good things and&quot;
</p>
</li>
<li><p> &quot;bad things.&quot;
</p>
</li></ul>

<p>The message has been cracked; it might not be possible to translate a string
as generic as &quot;There are&quot; into many languages &ndash; context is key!
</p>
<p>To keep the context, the error message should instead be build with
<code>gettextf</code> like so:
</p>
<div class="sourceCode r"><pre>stop(domain=NA, gettextf("There are %d good things and %d bad things."))
</pre></div>
<p>Now there is only one string to translate! Note that this also allows the
translator to change the word order as they see fit &ndash; for example, in
Japanese, the grammatical order usually puts the verb last (where in
English it usually comes right after the subject).
</p>
<p><code>translate_package</code> detects such cracked messages and suggests a
<code>gettextf</code>-based approach to fix them.
</p>



<h4>Untranslated R messages produced by <code>cat()</code></h4>

<p>Only strings which are passed to certain <code>base</code> functions are eligible for
translation, namely <code>stop</code>, <code>warning</code>, <code>message</code>, <code>packageStartupMessage</code>,
<code>gettext</code>, <code>gettextf</code>, and <code>ngettext</code> (all of which have a <code>domain</code> argument
that is key for translation).
</p>
<p>However, it is common to also produce some user-facing messages using
<code>cat</code> &ndash; if your package does so, it must first use <code>gettext</code> or <code>gettextf</code>
to translate the message before sending it to the user with <code>cat</code>.
</p>
<p><code>translate_package</code> detects strings produced with <code>cat</code> and suggests a
<code>gettext</code>- or <code>gettextf</code>-based fix.
</p>



<h4>Untranslated C/C++ messages</h4>

<p>This diagnostic detects any literal <code>char</code> arrays provided to common
messaging functions in C/C++, namely <code>ngettext()</code>, <code>Rprintf()</code>, <code>REprintf()</code>,
<code>Rvprintf()</code>, <code>REvprintf()</code>, <code>R_ShowMessage()</code>, <code>R_Suicide()</code>, <code>warning()</code>,
<code>Rf_warning()</code>, <code>error()</code>, <code>Rf_error()</code>, <code>dgettext()</code>, and <code>snprintf()</code>.
To actually translate these strings, pass them through the translation
macro <code style="white-space: pre;">&#8288;_&#8288;</code>.
</p>
<p>NB: Translation in C/C++ requires some additional <code style="white-space: pre;">&#8288;#include&#8288;</code>s and
declarations, including defining the <code style="white-space: pre;">&#8288;_&#8288;</code> macro.
See the Internationalization section of Writing R Extensions for details.
</p>



<h3>Custom diagnostics</h3>

<p>A diagnostic is a function which takes as input a <code>data.table</code>
summarizing the translatable strings in a package (e.g. as generated by
<code><a href="#topic+get_message_data">get_message_data()</a></code>), evaluates whether these messages are
&quot;healthy&quot; in some sense, and produces a digest of &quot;unhealthy&quot; strings and
(optionally) suggested replacements.
</p>
<p>The diagnostic function must have an attribute named <code>diagnostic_tag</code>
that describes what the diagnostic does; it is reproduced in the format
<code>Found {nrow(result)} {diagnostic_tag}:</code>. For example,
<code><a href="#topic+check_untranslated_cat">check_untranslated_cat()</a></code> has <code>diagnostic_tag = "untranslated messaging calls passed through cat()"</code>.
</p>
<p>The output diagnostic result has the following schema:
</p>

<ul>
<li> <p><code>call</code>: <code>character</code>, the call identified as problematic
</p>
</li>
<li> <p><code>file</code>: <code>character</code>, the file where <code>call</code> was found
</p>
</li>
<li> <p><code>line_number</code>: <code>integer</code>, the line in <code>file</code> where <code>call</code> was found
</p>
</li>
<li> <p><code>replacement</code>: <code>character</code>, <em>optional</em>, a suggested fix to make the call
&quot;healthy&quot;
</p>
</li></ul>

<p>See <code><a href="#topic+check_cracked_messages">check_cracked_messages()</a></code>,
<code><a href="#topic+check_untranslated_cat">check_untranslated_cat()</a></code>, and
<code><a href="#topic+check_untranslated_src">check_untranslated_src()</a></code> for examples of diagnostics.
</p>


<h3>Author(s)</h3>

<p>Michael Chirico
</p>


<h3>References</h3>

<p><a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Internationalization">https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Internationalization</a>
<br />
<a href="https://cran.r-project.org/doc/manuals/r-release/R-admin.html#Internationalization">https://cran.r-project.org/doc/manuals/r-release/R-admin.html#Internationalization</a>
<br />
<a href="https://cran.r-project.org/doc/manuals/r-release/R-ints.html#Internationalization-in-the-R-sources">https://cran.r-project.org/doc/manuals/r-release/R-ints.html#Internationalization-in-the-R-sources</a>
<br /> <a href="https://developer.r-project.org/Translations30.html">https://developer.r-project.org/Translations30.html</a> <br />
<a href="https://web.archive.org/web/20230108213934/https://www.isi-web.org/resources/glossary-of-statistical-terms">https://web.archive.org/web/20230108213934/https://www.isi-web.org/resources/glossary-of-statistical-terms</a> <br />
<a href="https://www.gnu.org/software/gettext/">https://www.gnu.org/software/gettext/</a> <br />
<a href="https://www.gnu.org/software/gettext/manual/html_node/Usual-Language-Codes.html#Usual-Language-Codes">https://www.gnu.org/software/gettext/manual/html_node/Usual-Language-Codes.html#Usual-Language-Codes</a>
<br />
<a href="https://www.gnu.org/software/gettext/manual/html_node/Country-Codes.html#Country-Codes">https://www.gnu.org/software/gettext/manual/html_node/Country-Codes.html#Country-Codes</a>
<br /> <a href="https://www.stats.ox.ac.uk/pub/Rtools/goodies/gettext-tools.zip">https://www.stats.ox.ac.uk/pub/Rtools/goodies/gettext-tools.zip</a>
<br /> <a href="https://saimana.com/list-of-country-locale-code/">https://saimana.com/list-of-country-locale-code/</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+get_message_data">get_message_data()</a></code>, <code><a href="#topic+write_po_file">write_po_file()</a></code>,
<code><a href="tools.html#topic+xgettext">tools::xgettext()</a></code>, <code><a href="tools.html#topic+update_pkg_po">tools::update_pkg_po()</a></code>,
<code><a href="tools.html#topic+checkPoFiles">tools::checkPoFile()</a></code>, <code><a href="base.html#topic+gettext">base::gettext()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
pkg &lt;- system.file('pkg', package = 'potools')
# copy to a temporary location to be able to read/write/update below
tmp_pkg &lt;- file.path(tempdir(), "pkg")
dir.create(tmp_pkg)
file.copy(pkg, dirname(tmp_pkg), recursive = TRUE)

# run translate_package() without any languages
# this will generate a .pot template file and en@quot translations (in UTF-8 locales)
# we can also pass empty 'diagnostics' to skip the diagnostic step
# (skip if gettext isn't available to avoid an error)
if (isTRUE(check_potools_sys_reqs)) {
  translate_package(tmp_pkg, diagnostics = NULL)
}

## Not run: 
# launches the interactive translation dialog for translations into Estonian:
translate_package(tmp_pkg, "et_EE", diagnostics = NULL, verbose = TRUE)

## End(Not run)

# cleanup
unlink(tmp_pkg, recursive = TRUE)
rm(pkg, tmp_pkg)

</code></pre>

<hr>
<h2 id='write_po_file'>Write a .po or .pot file corresponding to a message database</h2><span id='topic+write_po_file'></span><span id='topic+po_metadata'></span><span id='topic+format.po_metadata'></span><span id='topic+print.po_metadata'></span>

<h3>Description</h3>

<p>Serialize a message database in the &lsquo;<span class="file">.po</span>&rsquo; and &lsquo;<span class="file">.pot</span>&rsquo; formats
recognized by the gettext ecosystem.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>write_po_file(
  message_data,
  po_file,
  metadata,
  width = 79L,
  wrap_at_newline = TRUE,
  use_base_rules = metadata$package %chin% .potools$base_package_names
)

po_metadata(
  package = "",
  version = "",
  language = "",
  author = "",
  email = "",
  bugs = "",
  copyright = NULL,
  ...
)

## S3 method for class 'po_metadata'
format(x, template = FALSE, use_plurals = FALSE, ...)

## S3 method for class 'po_metadata'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="write_po_file_+3A_message_data">message_data</code></td>
<td>
<p><code>data.table</code>, as returned from
<code><a href="#topic+get_message_data">get_message_data()</a></code>. NB: R creates separate domains for R and
C/C++ code; it is recommended you do the same by filtering the
<code>get_message_data</code> output for <code>message_source == "R"</code> or
<code>message_source == "src"</code>. Other approaches are untested.</p>
</td></tr>
<tr><td><code id="write_po_file_+3A_po_file">po_file</code></td>
<td>
<p>Character vector giving a destination path. Paths ending in
&lsquo;<span class="file">.pot</span>&rsquo; will be written with template files (e.g., <code>msgstr</code> entries
will be blanked).</p>
</td></tr>
<tr><td><code id="write_po_file_+3A_metadata">metadata</code></td>
<td>
<p>A <code>po_metadata</code> object as returned by
<code>po_metadata()</code>.</p>
</td></tr>
<tr><td><code id="write_po_file_+3A_width">width</code></td>
<td>
<p>Numeric governing the wrapping width of the output file.
Default is <code>79L</code> to match the behavior of the <code>xgettext</code> utility.
<code>Inf</code> turns off wrapping (except for file source markers comments).</p>
</td></tr>
<tr><td><code id="write_po_file_+3A_wrap_at_newline">wrap_at_newline</code></td>
<td>
<p>Logical, default <code>TRUE</code> to match the
<code>xgettext</code> utility's behavior. If <code>TRUE</code>, any <code>msgid</code> or
<code>msgstr</code> will always be wrapped at an internal newline (i.e., literally
matching <code style="white-space: pre;">&#8288;\n&#8288;</code>).</p>
</td></tr>
<tr><td><code id="write_po_file_+3A_use_base_rules">use_base_rules</code></td>
<td>
<p>Logical; Should internal behavior match base behavior
as strictly as possible? <code>TRUE</code> if being run on a base package (i.e.,
<code>base</code> or one of the default packages like <code>utils</code>,
<code>graphics</code>, etc.). See Details.</p>
</td></tr>
<tr><td><code id="write_po_file_+3A_package">package</code></td>
<td>
<p>Character; the name of the package being translated.</p>
</td></tr>
<tr><td><code id="write_po_file_+3A_version">version</code></td>
<td>
<p>Character; the version of the package being translated.</p>
</td></tr>
<tr><td><code id="write_po_file_+3A_language">language</code></td>
<td>
<p>Character; the language of the <code>msgstr</code>. See
<code><a href="#topic+translate_package">translate_package()</a></code> for details.</p>
</td></tr>
<tr><td><code id="write_po_file_+3A_author">author</code></td>
<td>
<p>Character; an author (combined with <code>email</code>) to whom to
attribute the translations (as <code>Last-Translator</code>).</p>
</td></tr>
<tr><td><code id="write_po_file_+3A_email">email</code></td>
<td>
<p>Character; an e-mail address associated with <code>author</code>.</p>
</td></tr>
<tr><td><code id="write_po_file_+3A_bugs">bugs</code></td>
<td>
<p>Character; a URL where issues with the translations can be
reported.</p>
</td></tr>
<tr><td><code id="write_po_file_+3A_copyright">copyright</code></td>
<td>
<p>An object used to construct the initial Copyright reference
in the output. If <code>NULL</code>, no such comment is written. If a <code>list</code>,
it should the following structure:
</p>

<ul>
<li> <p><code>year</code>: Required, A year or hyphen-separated range of years
</p>
</li>
<li> <p><code>holder</code>: Required, The name of the copyright holder
</p>
</li>
<li> <p><code>title</code>: Optional, A title for the &lsquo;<span class="file">.po</span>&rsquo;
</p>
</li>
<li> <p><code>additional</code>: Optional, A character vector of additional lines for the
copyright comment section
</p>
</li></ul>

<p>If a <code>character</code> scalar, it is interpreted as the <code>holder</code> and the <code>year</code>
is set as the <code>POT-Creation-Date</code>'s year.</p>
</td></tr>
<tr><td><code id="write_po_file_+3A_...">...</code></td>
<td>
<p>Additional (named) components to add to the metadata. For
<code>print.po_metadata</code>, passed on to <code>format.po_metadata</code></p>
</td></tr>
<tr><td><code id="write_po_file_+3A_x">x</code></td>
<td>
<p>A <code>po_metadata</code> object.</p>
</td></tr>
<tr><td><code id="write_po_file_+3A_template">template</code></td>
<td>
<p>Logical; format the metadata as in a &lsquo;<span class="file">.pot</span>&rsquo; template?</p>
</td></tr>
<tr><td><code id="write_po_file_+3A_use_plurals">use_plurals</code></td>
<td>
<p>Logical; should the <code>Plural-Forms</code> entry be
included?</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Three components are set automatically if not provided:
</p>

<ul>
<li> <p><code>pot_timestamp</code> - A <code>POSIXct</code> used to write the
<code>POT-Creation-Date</code> entry. Defaults to the <code><a href="base.html#topic+Sys.time">Sys.time()</a></code> at
run time.
</p>
</li>
<li> <p><code>po_timestamp</code> - A <code>POSIXct</code> used to write the
<code>PO-Revision-Date</code> entry. Defaults to be the same as
<code>pot_timestamp</code>.
</p>
</li>
<li> <p><code>language_team</code> - A string used to write
the <code>Language-Team</code> entry. Defaults to be the same as <code>language</code>;
if provided manually, the format <code style="white-space: pre;">&#8288;LANGUAGE &lt;LL@li.org&gt;&#8288;</code> is recommended.
</p>
</li></ul>

<p>The <code>charset</code> for output is always set to <code>"UTF-8"</code>; this is
intentional to make it more cumbersome to create non-UTF-8 files.
</p>


<h3>Value</h3>

<p>For <code>po_metadata</code>, an object of class <code>po_metadata</code> that
has a <code>format</code> method used to serialize the metadata.
</p>


<h3>Author(s)</h3>

<p>Michael Chirico
</p>


<h3>References</h3>

<p><a href="https://www.gnu.org/software/gettext/manual/html_node/Header-Entry.html">https://www.gnu.org/software/gettext/manual/html_node/Header-Entry.html</a>
<br />
</p>


<h3>See Also</h3>

<p><code><a href="#topic+translate_package">translate_package()</a></code>, <code><a href="#topic+get_message_data">get_message_data()</a></code>,
<code><a href="tools.html#topic+xgettext">tools::xgettext2pot()</a></code>, <code><a href="tools.html#topic+update_pkg_po">tools::update_pkg_po()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
message_data &lt;- get_message_data(system.file('pkg', package='potools'))
desc_data &lt;- read.dcf(system.file('pkg', 'DESCRIPTION', package='potools'), c('Package', 'Version'))
metadata &lt;- po_metadata(
  package = desc_data[, "Package"], version = desc_data[, "Version"],
  language = 'ar_SY', author = 'R User', email = 'ruser@gmail.com',
  bugs = 'https://github.com/ruser/potoolsExample/issues'
)

# add fake translations
message_data[type == "singular", msgstr := "&lt;arabic translation&gt;"]
# Arabic has 6 plural forms
message_data[type == "plural", msgstr_plural := .(as.list(sprintf("&lt;%d translation&gt;", 0:5)))]

# Preview metadata
print(metadata)
# write .po file
write_po_file(
  message_data[message_source == "R"],
  tmp_po &lt;- tempfile(fileext = '.po'),
  metadata
)
writeLines(readLines(tmp_po))

# write .pot template
write_po_file(
  message_data[message_source == "R"],
  tmp_pot &lt;- tempfile(fileext = '.pot'),
  metadata
)
writeLines(readLines(tmp_pot))

# cleanup
file.remove(tmp_po, tmp_pot)
rm(message_data, desc_data, metadata, tmp_po, tmp_pot)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
