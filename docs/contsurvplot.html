<!DOCTYPE html><html><head><title>Help for package contsurvplot</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {contsurvplot}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#contsurvplot-package'>
<p>Visualize the Effect of a Continuous Variable on a Time-To-Event Outcome</p></a></li>
<li><a href='#curve_cont'>
<p>Estimate Counterfactual Survival or Failure Probabilities for Levels of a Continuous Variable</p></a></li>
<li><a href='#plot_surv_3Dsurface'>
<p>Plot the Survival Curve or CIF Dependent on a Continuous Variable as a 3D Surface</p></a></li>
<li><a href='#plot_surv_animated'>
<p>Create an Animated Plot of Survival Curves of CIFs as a Function of a Continuous Variable</p></a></li>
<li><a href='#plot_surv_area'>
<p>Plot a Survival Area Plot for the Effect of a Continuous Variable on a Time-To-Event Outcome</p></a></li>
<li><a href='#plot_surv_at_t'>
<p>Plot the Survival Probability or CIF at a Fixed Point in Time as a Function of a Continuous Variable</p></a></li>
<li><a href='#plot_surv_contour'>
<p>Create a Contour Plot of the Effect of a Continuous Covariate on the Survival Probability</p></a></li>
<li><a href='#plot_surv_heatmap'>
<p>Plot a Heatmap of the Effect of a Continuous Covariate on a Time-To-Event Outcome</p></a></li>
<li><a href='#plot_surv_lines'>
<p>Plot Individual Survival Curves or CIFs for Specific Values of a Continuous Covariate</p></a></li>
<li><a href='#plot_surv_matrix'>
<p>Plot a Discretized Heatmap of the Effect of a Continuous Covariate on a Time-To-Event Outcome</p></a></li>
<li><a href='#plot_surv_quantiles'>
<p>Plot Survival Time Quantiles as a Function of a Continuous Variable</p></a></li>
<li><a href='#plot_surv_rmst'>
<p>Plot the Effect of a Continuous Variable on the Restricted Mean Survival Time</p></a></li>
<li><a href='#plot_surv_rmtl'>
<p>Plot the Effect of a Continuous Variable on the Restricted Mean Time Lost</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Visualize the Effect of a Continuous Variable on a Time-to-Event
Outcome</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.1</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Robin Denz &lt;robin.denz@rub.de&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Graphically display the (causal) effect of a continuous variable on a time-to-event outcome
	using multiple different types of plots based on g-computation. Those functions
	include, among others, survival area plots, survival contour plots, survival quantile plots and
	3D surface plots. Due to the use of g-computation, all plot allow confounder-adjustment naturally.
	For details, see Robin Denz, Nina Timmesfeld (2023) &lt;<a href="https://doi.org/10.1097%2FEDE.0000000000001630">doi:10.1097/EDE.0000000000001630</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/RobinDenz1/contsurvplot">https://github.com/RobinDenz1/contsurvplot</a>,
<a href="https://robindenz1.github.io/contsurvplot/">https://robindenz1.github.io/contsurvplot/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/RobinDenz1/contsurvplot/issues">https://github.com/RobinDenz1/contsurvplot/issues</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>ggplot2 (&ge; 3.4.0), dplyr, rlang, riskRegression, foreach</td>
</tr>
<tr>
<td>Suggests:</td>
<td>survival, pammtools, gganimate, transformr, plotly, reshape2,
doParallel, knitr, rmarkdown, testthat (&ge; 3.0.0), vdiffr (&ge;
1.0.0), covr</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Contact:</td>
<td>&lt;robin.denz@rub.de&gt;</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-08-15 07:35:59 UTC; Robin Denz</td>
</tr>
<tr>
<td>Author:</td>
<td>Robin Denz [aut, cre]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-08-15 08:00:03 UTC</td>
</tr>
</table>
<hr>
<h2 id='contsurvplot-package'>
Visualize the Effect of a Continuous Variable on a Time-To-Event Outcome
</h2><span id='topic+contsurvplot-package'></span>

<h3>Description</h3>

<p><strong><em>What is this package about?</em></strong>
</p>
<p>This package provides different plotting routines to visualize the (causal) effect of a continuous variable on a time-to-event outcome using a previously fit model and g-computation. Unlike simpler alternatives, such as plotting survival curves for some categories, these plots always correspond to the results obtained by the time-to-event model and give an accurate depiction of the causal effect, if all assumptions are met.
</p>
<p><strong><em>What features are included in this package?</em></strong>
</p>
<p>The package includes 11 different plot functions, most based on the <span class="pkg">ggplot2</span> package. Those 11 plotting routines include <em>value specific survival curves</em>, <em>landmark survival probability plots</em>, <em>survival time quantile plots</em>, <em>survival probability heatmaps</em>, and <em>survival area plots</em>, among others. A description and comparison of these plots can be found in the article associated with this R-package (Denz &amp; Timmesfeld 2022).
</p>
<p><strong><em>What does a typical workflow using this package look like?</em></strong>
</p>
<p>All the user has to do is fit a time-to-event model, such as the cox-model, including the continuous variable of interest (and possibly confounders) and plug it into one of the plot functions included in this package. Many different kind of models are supported. See <code><a href="#topic+curve_cont">curve_cont</a></code> for more details.
</p>
<p><strong><em>What type of plot should I use?</em></strong>
</p>
<p>There is no general answer to this question, but we would usually suggest using a plot method that is able to visualize the causal survival probability both as a function of time and as a function of the continuous variable. The <code><a href="#topic+plot_surv_area">plot_surv_area</a></code>, <code><a href="#topic+plot_surv_heatmap">plot_surv_heatmap</a></code> and <code><a href="#topic+plot_surv_contour">plot_surv_contour</a></code> functions do just that. More discussion about this topic can be found in the vignette and the associated paper.
</p>
<p><strong><em>What is the difference between displaying causal effects and associations?</em></strong>
</p>
<p>The plots generated by this package offer different ways to depict the association between a continuous variable and a time-to-event outcome. Under certain causal identifiability assumptions, which are described in detail in our article on this topic (see references), this association can be endowed with a causal interpretation. Under these assumptions, the estimates can be interpreted as the survival probability that would have been observed if all individuals in the target population had received a specific level of the continuous variable. If these assumptions are not met, this interpretation is invalid.
</p>
<p><strong><em>Where can I get more information?</em></strong>
</p>
<p>The documentation pages contain a lot of information, relevant examples and literature references. Additional examples can be found in the vignette of this package, which can be accessed using <code>vignette(topic="introduction", package="contsurvplot")</code>. We also published a preprint of the article about this package on arXiv (see references), which contains an in-depth discussion about the plots and how to interpret them.
</p>
<p><strong><em>I want to suggest a new feature / I want to report a bug. Where can I do this?</em></strong>
</p>
<p>Bug reports, suggestions and feature requests are highly welcome. Please file an issue on the official github page (&lt;https://github.com/RobinDenz1/contsurvplot&gt;) or contact the author directly using the supplied e-mail address.
</p>


<h3>Author(s)</h3>

<p>Robin Denz (robin.denz@rub.de)
</p>


<h3>References</h3>

<p>Robin Denz, Nina Timmesfeld (2023). &quot;Visualizing the (Causal) Effect of a Continuous Variable on a Time-To-Event Outcome&quot;. In: Epidemiology 34.5
</p>
<p>James Robins. A New Approach to Causal Inference in Mortality Studies with a Sustained Exposure Period: Application to Control of the Healthy Worker Survivor Effect. Mathematical Modelling (1986) 7, pages 1393-1512.
</p>

<hr>
<h2 id='curve_cont'>
Estimate Counterfactual Survival or Failure Probabilities for Levels of a Continuous Variable
</h2><span id='topic+curve_cont'></span>

<h3>Description</h3>

<p>This function can be utilized to estimate counterfactual survival curves or cumulative incidence functions (CIF) for specific values of a continuous covariate.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>curve_cont(data, variable, model, horizon,
           times, group=NULL, cause=1, cif=FALSE,
           contrast="none", reference="km", ref_value=NULL,
           event_time=NULL, event_status=NULL,
           conf_int=FALSE, conf_level=0.95,
           n_boot=300, n_cores=1,
           na.action=options()$na.action,
           return_boot=FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="curve_cont_+3A_data">data</code></td>
<td>

<p>A <code>data.frame</code> containing all required variables.
</p>
</td></tr>
<tr><td><code id="curve_cont_+3A_variable">variable</code></td>
<td>

<p>A single character string specifying the continuous variable of interest, for which the survival curves should be estimated. This variable has to be contained in the <code>data.frame</code> that is supplied to the <code>data</code> argument.
</p>
</td></tr>
<tr><td><code id="curve_cont_+3A_model">model</code></td>
<td>

<p>A model describing the time-to-event process (such as an <code>coxph</code> model). Needs to include <code>variable</code> as an independent variable. It also has to have an associated <code>predictRisk</code> method. See <code>?predictRisk</code> for more details.
</p>
</td></tr>
<tr><td><code id="curve_cont_+3A_horizon">horizon</code></td>
<td>

<p>A numeric vector containing a range of values of <code>variable</code> for which the survival curves should be calculated.
</p>
</td></tr>
<tr><td><code id="curve_cont_+3A_times">times</code></td>
<td>

<p>A numeric vector containing points in time at which the survival probabilities should be calculated.
</p>
</td></tr>
<tr><td><code id="curve_cont_+3A_group">group</code></td>
<td>

<p>An optional single character string specifying a factor variable in <code>data</code>. When used, the regression standardization is performed conditional on this factor variable, meaning that one estimate is returned for each level of the factor variable. See details for a better description. Set to <code>NULL</code> (default) to use no grouping variable.
</p>
</td></tr>
<tr><td><code id="curve_cont_+3A_cause">cause</code></td>
<td>

<p>The cause of interest. In standard survival data with only one event type, this should be kept at 1. For data with multiple failure types, this argument should be specified. In addition, the <code>cif</code> argument should be set to <code>TRUE</code> in those cases.
</p>
</td></tr>
<tr><td><code id="curve_cont_+3A_cif">cif</code></td>
<td>

<p>Whether to calculate the cumulative incidence (CIF) instead of the survival probability. If multiple failure types are present, the survival probability cannot be estimated in an unbiased way. In those cases, this argument should always be set to <code>TRUE</code>.
</p>
</td></tr>
<tr><td><code id="curve_cont_+3A_contrast">contrast</code></td>
<td>

<p>Defines what kind of estimate should be returned. Can be either <code>"none"</code> (default), <code>"diff"</code> or <code>"ratio"</code>. When <code>"none"</code> is used, it simply returns the counterfactual survival probabilities (or CIF if <code>cif=TRUE</code>) without any further calculations. If <code>"diff"</code> or <code>"ratio"</code> is used instead, the difference or ratio to some reference value will be returned. See argument below.
</p>
</td></tr>
<tr><td><code id="curve_cont_+3A_reference">reference</code></td>
<td>

<p>Defines what kind of reference value to use when estimating causal contrasts. Only used if <code>contrast!="none"</code>, ignored otherwise. Can be either <code>"km"</code> (using standard Kaplan-Meier estimates as reference) or <code>"value"</code> (using the g-computation estimates of a specific value of the <code>variable</code> as reference). To specify which value to use when using <code>reference="value"</code>, the <code>ref_value</code> argument should be used. See details for more information.
</p>
</td></tr>
<tr><td><code id="curve_cont_+3A_ref_value">ref_value</code></td>
<td>

<p>A single number corresponding to the reference value used when estimating causal contrasts using <code>reference="value"</code>. See details.
</p>
</td></tr>
<tr><td><code id="curve_cont_+3A_event_time">event_time</code></td>
<td>

<p>A single character string specifying the time until the occurrence of the event of interest or <code>NULL</code> (default). Only used when estimating causal contrasts with <code>reference="km"</code>, ignored otherwise. If specified, this variable has to be contained in the <code>data.frame</code> that is supplied to the <code>data</code> argument.
</p>
</td></tr>
<tr><td><code id="curve_cont_+3A_event_status">event_status</code></td>
<td>

<p>A single character string specifying the status of the event of interest or <code>NULL</code> (default). Only used when estimating causal contrasts with <code>reference="km"</code>, ignored otherwise. If specified, this variable has to be contained in the <code>data.frame</code> that is supplied to the <code>data</code> argument.
</p>
</td></tr>
<tr><td><code id="curve_cont_+3A_conf_int">conf_int</code></td>
<td>

<p>Whether to calculate point-wise confidence intervals or not. If <code>TRUE</code>, <code>n_boot</code> bootstrap samples are drawn, the g-computation step is performed on each bootstrap sample and the confidence intervals are calculated using the percentile method from these results. Can get very slow if the dataset is large or there are many values in <code>horizon</code> or <code>times</code>. Using <code>n_cores</code> can speed up the process a lot.
</p>
</td></tr>
<tr><td><code id="curve_cont_+3A_conf_level">conf_level</code></td>
<td>

<p>A number specifying the confidence level of the bootstrap confidence intervals. Ignored if <code>conf_int=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="curve_cont_+3A_n_boot">n_boot</code></td>
<td>

<p>A single integer specifying how many bootstrap repetitions should be performed. Ignored if  <code>conf_int=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="curve_cont_+3A_n_cores">n_cores</code></td>
<td>

<p>The number of processor cores to use when performing the calculations. If <code>n_cores=1</code> (default), single threaded processing is used. If <code>n_cores &gt; 1</code> the <span class="pkg">foreach</span> package and the <span class="pkg">doParallel</span> package are used to run the calculations on <code>n_cores</code> in parallel. This might speed up the runtime considerably when it is initially slow.
</p>
</td></tr>
<tr><td><code id="curve_cont_+3A_na.action">na.action</code></td>
<td>

<p>How missing values should be handled. Can be one of: <code>na.fail</code>, <code>na.omit</code>, <code>na.pass</code>, <code>na.exclude</code> or a user-defined custom function. Also accepts strings of the function names. See <code>?na.action</code> for more details. By default it uses the na.action which is set in the global options by the respective user.
</p>
</td></tr>
<tr><td><code id="curve_cont_+3A_return_boot">return_boot</code></td>
<td>

<p>Either <code>TRUE</code> or <code>FALSE</code> (default). If <code>TRUE</code> (and <code>conf_int=TRUE</code>) this function will return the individual bootstrap estimates instead of the usual estimates. This may be useful to perform tests or calculate other type of bootstrap confidence intervals manually.
</p>
</td></tr>
<tr><td><code id="curve_cont_+3A_...">...</code></td>
<td>

<p>Further arguments passed to <code><a href="riskRegression.html#topic+riskRegression">predictRisk</a></code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is used internally in all plot functions included in this R-package and generally does not need to be called directly by the user. It can however be used to get specific values or as a basis to create custom plots not included in this package. Below we give a small introduction to what this function does. A more detailed description of the underlying methodology can be found in our article on this subject (Denz &amp; Timmesfeld 2022).
</p>
<p><strong><em>Target Estimand (default)</em></strong>
</p>
<p>By default (<code>contrast="none"</code>) this function tries to estimate the survival probability at <code>times</code> that would have been observed if every individual in the sample had received a value of <code>horizon</code> in the <code>variable</code>. Let <code class="reqn">Z</code> be the continuous variable we are interested in. Let <code class="reqn">T</code> be the time until the occurrence of the event of interest. Under the potential outcome framework, there is an uncountably infinite amount of potential survival times <code class="reqn">T^{(Z=z)}</code>, one for each possible value of <code class="reqn">Z</code>. The target estimand is then defined as:
</p>
<p style="text-align: center;"><code class="reqn">S_{z}(t) = E(I(T^{(Z=z)} &gt; t))</code>
</p>

<p>If we additionally consider a categorical <code>group</code> variable <code class="reqn">D</code>, the target estimand is similarly defined as:
</p>
<p style="text-align: center;"><code class="reqn">S_{zd}(t) = E(I(T^{(Z=z, D=d)} &gt; t))</code>
</p>

<p>where <code class="reqn">T^{(Z=z, D=d)}</code> is the survival time that would have been observed if the individual had received both <code class="reqn">Z = z</code> and <code class="reqn">D = d</code>.
</p>
<p><strong><em>Target Estimand (using contrasts)</em></strong>
</p>
<p>If contrasts are used (<code>contrast!="none"</code>), target estimands based on <code class="reqn">S_{z}(t)</code> or <code class="reqn">S_{zd}(t)</code> are used instead. When using <code>contrast="diff"</code> and <code>reference="km"</code>, the target estimand is simply the difference between the observed survival probability in the entire sample (denoted by <code class="reqn">S(t)</code>, estimated using a Kaplan-Meier estimator) and the counterfactual survival probability:
</p>
<p style="text-align: center;"><code class="reqn">\Delta_{KM}(t, z) = S(t) - S_z(t)</code>
</p>

<p>If <code>contrast="ratio"</code> is used instead, the substraction sign is simply replace by a division. If <code>group</code> was specified, <code class="reqn">S(t)</code> is replaced by <code class="reqn">S_d(t)</code> (a stratified Kaplan-Meier estimator) and <code class="reqn">S_z(t)</code> is replaced by <code class="reqn">S_{zd}(t)</code>. Instead of using a Kaplan-Meier estimator as <code>reference</code>, one may also use a specific <code class="reqn">S_z(t)</code> as reference using <code>reference="value"</code> and setting <code>ref_value</code> to the <code class="reqn">Z</code> that should be used. All of these causal contrasts and their implications are described in detail in the appendix of our article on this topic (Denz &amp; Timmesfeld 2022).
</p>
<p><strong><em>Estimation Methodology</em></strong>
</p>
<p><em>G-Computation</em>, also known as the <em>Corrected Group Prognosis</em> method, <em>Direct-Standardization</em> or <em>G-Formula</em>, is used internally to estimate the counterfactual survival probability or CIF for values of a continuous variable. This is done by setting the <code>variable</code> to a specific value for all rows in <code>data</code> first. Afterwards, the <code>model</code> is used to predict the survival probability of each individual at all <code>times</code>, given the value of <code>variable</code> and their other observed covariates (which are included in the model as independent variables). These estimates are then averaged for each time point. This procedure is repeated for every value in <code>horizon</code>. If a <code>group</code> is supplied, these calculations are repeated for every possible value in <code>group</code>, with the estimated individual survival probabilities also being conditional on that value.
</p>
<p>To obtain valid estimates of the target estimand using this function, the fundamental causal identifiability assumptions have to be met. Those are described in detail in our article on this topic (Denz &amp; Timmesfeld 2022). If those assumptions are not met, the estimates may only be used to showcase simple associations. They cannot be endowed with a counterfactual interpretation in this case.
</p>
<p><strong><em>Supported Models</em></strong>
</p>
<p>This function relies on the <code><a href="riskRegression.html#topic+riskRegression">predictRisk</a></code> function from the <span class="pkg">riskRegression</span> package to create the covariate and time specific estimates of the probabilities. All models with an associated <code>predictRisk</code> method may be used in this function. This includes a variety of models, such as the Cox proportional hazards regression model and the aalen additive hazards model. If the model that should be used has no <code>predictRisk</code> method, the user either needs to write their own <code>predictRisk</code> method or contact the maintainers of the <span class="pkg">riskRegression</span> package.
</p>
<p><strong><em>Bootstrap Confidence Intervals</em></strong>
</p>
<p>By using <code>conf_int=TRUE</code>, bootstrap confidence intervals may be estimated. This will draw <code>n_boot</code> samples of size <code>nrow(data)</code> with replacement from <code>data</code> in the first step. Afterwards, the <code>model</code> is fit to each of those bootstrap samples and the <code>curve_cont</code> function is recursively called to obtain the estimates of interests for each sample. Using the percentile approach, the bootstrap confidence intervals are calculated. This requires that the <code>model</code> object contains a <code>call</code> parameter, because the <code>update()</code> function is used internally.
</p>
<p><strong><em>Computational Complexity</em></strong>
</p>
<p>If many values are included in <code>times</code>, <code>horizon</code> or both and/or <code>data</code> has a lot of rows, this function may become very slow. Since bootstrapping relies on sampling with replacement from the original <code>data</code> and repeating the entire procedure <code>n_boot</code> times, this also dramatically increases the runtime. Parallel processing may be used to speed up the computations. This can be done by simply setting <code>n_cores</code> to values higher than 1.
</p>
<p><strong><em>Missing Data</em></strong>
</p>
<p>Currently, this function does not support advanced handling of missing data. The <code>data.frame</code> supplied to <code>data</code> should contain no missing data in the relevant columns. To achieve this, the <code>na.action</code> argument can be set to <code>"na.omit"</code>, which will remove all rows that do contain missing data.
</p>
<p><strong><em>Competing Events</em></strong>
</p>
<p>By supplying a <code>model</code> that directly takes into account competing events and using the <code>cause</code> argument, the user may also use the functionality offered in this package to create plots in this setting. Internally, the <code>predictRisk</code> method will then be used to estimate the conditional cause-specific cumulative incidence function, which will then be used to carry out the g-computation step explained above. <strong>However</strong> the underlying target estimand of this procedure is dependent on which kind of model was supplied. It is therefore not possible to define it here concisely. Future research is necessary to clarify this point. This feature should only be used with great caution.
</p>


<h3>Value</h3>

<p>Returns a <code>data.frame</code> containing the columns <code>time</code> (the point in time), <code>est</code> (the estimated survival probability or CIF) and <code>cont</code> (the specific value of <code>variable</code> used). If <code>group</code> was used, it includes the additional <code>group</code> column, specifying the level of the grouping variable. If <code>conf_int=TRUE</code> was used, it additionally includes the columns <code>se</code> (bootstrap standard error of the estimate), <code>ci_lower</code> (lower limit of the bootstrap confidence interval) and <code>ci_upper</code> (upper limit of the bootstrap confidence interval).
</p>


<h3>Author(s)</h3>

<p>Robin Denz
</p>


<h3>References</h3>

<p>Robin Denz, Nina Timmesfeld (2023). &quot;Visualizing the (Causal) Effect of a Continuous Variable on a Time-To-Event Outcome&quot;. In: Epidemiology 34.5
</p>
<p>Brice Ozenne, Anne Lyngholm Sorensen, Thomas Scheike, Christian Torp-Pedersen and Thomas Alexander Gerds. riskRegression: Predicting the Risk of an Event using Cox Regression Models. The R Journal (2017) 9:2, pages 440-460.
</p>
<p>I-Ming Chang, Rebecca Gelman, and Marcello Pagano. Corrected Group Prognostic Curves and Summary Statistics. Journal of Chronic Diseases (1982) 35, pages 669-674
</p>
<p>James Robins. A New Approach to Causal Inference in Mortality Studies with a Sustained Exposure Period: Application to Control of the Healthy Worker Survivor Effect. Mathematical Modelling (1986) 7, pages 1393-1512.
</p>


<h3>See Also</h3>

<p><code><a href="riskRegression.html#topic+riskRegression">predictRisk</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(contsurvplot)
library(riskRegression)
library(survival)

# using data from the survival package
data(nafld, package="survival")

# take a random sample to keep example fast
set.seed(42)
nafld1 &lt;- nafld1[sample(nrow(nafld1), 150), ]

# fit cox-model with age
model &lt;- coxph(Surv(futime, status) ~ age, data=nafld1, x=TRUE)

# estimate survival probability at some points in time, for
# a range of age values
plotdata &lt;- curve_cont(data=nafld1,
                       variable="age",
                       model=model,
                       horizon=c(50, 60, 70, 80),
                       times=c(1000, 2000, 3000, 4000))

# estimate cumulative incidences instead
plotdata &lt;- curve_cont(data=nafld1,
                       variable="age",
                       model=model,
                       horizon=c(50, 60, 70, 80),
                       times=c(1000, 2000, 3000, 4000),
                       cif=TRUE)
</code></pre>

<hr>
<h2 id='plot_surv_3Dsurface'>
Plot the Survival Curve or CIF Dependent on a Continuous Variable as a 3D Surface
</h2><span id='topic+plot_surv_3Dsurface'></span>

<h3>Description</h3>

<p>Using a previously fit time-to-event model, this function plots the survival curve as a function of a continuous variable using a 3D surface representation. This function can produce interactive plots using the <span class="pkg">plotly</span> package, or a static image using the <code><a href="graphics.html#topic+graphics">persp</a></code> function of the <span class="pkg">graphics</span> package.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_surv_3Dsurface(time, status, variable, data, model,
                    cif=FALSE, na.action=options()$na.action,
                    horizon=NULL, fixed_t=NULL, max_t=Inf,
                    interactive=FALSE,
                    xlab="Time", ylab="Survival Probability",
                    zlab=variable, ticktype="detailed",
                    theta=120, phi=20, col="green", shade=0.5,
                    ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_surv_3Dsurface_+3A_time">time</code></td>
<td>

<p>A single character string specifying the time-to-event variable. Needs to be a valid column name of a numeric variable in <code>data</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_3Dsurface_+3A_status">status</code></td>
<td>

<p>A single character string specifying the status variable, indicating if a person has experienced an event or not. Needs to be a valid column name of a numeric or logical variable in <code>data</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_3Dsurface_+3A_variable">variable</code></td>
<td>

<p>A single character string specifying the continuous variable of interest, for which the survival curves should be estimated. This variable has to be contained in the <code>data.frame</code> that is supplied to the <code>data</code> argument.
</p>
</td></tr>
<tr><td><code id="plot_surv_3Dsurface_+3A_data">data</code></td>
<td>

<p>A <code>data.frame</code> containing all required variables.
</p>
</td></tr>
<tr><td><code id="plot_surv_3Dsurface_+3A_model">model</code></td>
<td>

<p>A model describing the time-to-event process (such as an <code>coxph</code> model). Needs to include <code>variable</code> as an independent variable. It also has to have an associated <code><a href="riskRegression.html#topic+riskRegression">predictRisk</a></code> method. See <code>?predictRisk</code> for more details.
</p>
</td></tr>
<tr><td><code id="plot_surv_3Dsurface_+3A_cif">cif</code></td>
<td>

<p>Whether to plot the cumulative incidence (CIF) instead of the survival probability. If multiple failure types are present, the survival probability cannot be estimated in an unbiased way. This function will always return CIF estimates in that case.
</p>
</td></tr>
<tr><td><code id="plot_surv_3Dsurface_+3A_na.action">na.action</code></td>
<td>

<p>How missing values should be handled. Can be one of: <code>na.fail</code>, <code>na.omit</code>, <code>na.pass</code>, <code>na.exclude</code> or a user-defined custom function. Also accepts strings of the function names. See <code>?na.action</code> for more details. By default it uses the na.action which is set in the global options by the respective user.
</p>
</td></tr>
<tr><td><code id="plot_surv_3Dsurface_+3A_horizon">horizon</code></td>
<td>

<p>A numeric vector containing a range of values of <code>variable</code> for which the survival curves should be calculated or <code>NULL</code> (default). If <code>NULL</code>, the horizon is constructed as a sequence from the lowest to the highest value observed in <code>variable</code> with 40 equally spaced steps.
</p>
</td></tr>
<tr><td><code id="plot_surv_3Dsurface_+3A_fixed_t">fixed_t</code></td>
<td>

<p>A numeric vector containing points in time at which the survival probabilities should be calculated or <code>NULL</code> (default). If <code>NULL</code>, the survival probability is estimated at every point in time at which an event occurred.
</p>
</td></tr>
<tr><td><code id="plot_surv_3Dsurface_+3A_max_t">max_t</code></td>
<td>

<p>A number indicating the latest survival time which is to be plotted.
</p>
</td></tr>
<tr><td><code id="plot_surv_3Dsurface_+3A_interactive">interactive</code></td>
<td>

<p>Whether to draw the 3D surface as a static plot (<code>interactive=FALSE</code>, the default) or as an interactive plot. When <code>interactive=TRUE</code> is used, this function relies on the <span class="pkg">plotly</span> package. In this case, the only aesthetic arguments that still work are the <code>xlab</code>, <code>ylab</code> and <code>zlab</code> arguments. Everything else has to be set manually using the functionality of the <span class="pkg">plotly</span> package directly.
</p>
</td></tr>
<tr><td><code id="plot_surv_3Dsurface_+3A_xlab">xlab</code></td>
<td>

<p>A character string used as the x-axis label of the plot, representing the survival time.
</p>
</td></tr>
<tr><td><code id="plot_surv_3Dsurface_+3A_ylab">ylab</code></td>
<td>

<p>A character string used as the y-axis label of the plot, representing the survival probability or CIF.
</p>
</td></tr>
<tr><td><code id="plot_surv_3Dsurface_+3A_zlab">zlab</code></td>
<td>

<p>A character string used as the z-axis of the plot, representing the continuous covariate of interest.
</p>
</td></tr>
<tr><td><code id="plot_surv_3Dsurface_+3A_ticktype">ticktype</code></td>
<td>

<p>A single character: <code>"simple"</code> draws just an arrow parallel to the axis to indicate direction of increase; <code>"detailed"</code> draws normal ticks as per 2D plots. Passed to the <code>ticktype</code> argument in the <code>persp</code> function. Ignored if <code>interactive=TRUE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_3Dsurface_+3A_theta">theta</code></td>
<td>

<p>Angles defining the viewing direction. <code>theta</code> gives the azimuthal direction and <code>phi</code> the colatitude. Passed to the <code>theta</code> argument in the <code>persp</code> function. Ignored if <code>interactive=TRUE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_3Dsurface_+3A_phi">phi</code></td>
<td>

<p>See argument <code>theta</code>. Passed to the <code>phi</code> argument in the <code>persp</code> function. Ignored if <code>interactive=TRUE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_3Dsurface_+3A_col">col</code></td>
<td>

<p>The color(s) of the surface facets. Transparent colours are ignored. This is recycled to the <code>(nx-1)(ny-1)</code> facets. Passed to the <code>col</code> argument in the <code>persp</code> function. Ignored if <code>interactive=TRUE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_3Dsurface_+3A_shade">shade</code></td>
<td>

<p>The shade at a surface facet is computed as <code>((1+d)/2)^shade</code>, where d is the dot product of a unit vector normal to the facet and a unit vector in the direction of a light source. Values of shade close to one yield shading similar to a point light source model and values close to zero produce no shading. Values in the range 0.5 to 0.75 provide an approximation to daylight illumination. Passed to the <code>shade</code> argument in the <code>persp</code> function. Ignored if <code>interactive=TRUE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_3Dsurface_+3A_...">...</code></td>
<td>

<p>Further arguments passed to <code><a href="#topic+curve_cont">curve_cont</a></code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The survival curve or CIF dependent on a continuous variable can be viewed as a 3D surface. All other plots in this package try to visualize this surface by reducing it to two dimensions using color scales or summary statistics. This function on the other hand directly plots the 3D surface as such.
</p>
<p>Although 3D plots are frowned upon by many scientists, it might be a good visualisation choice from time to time. Using the <code>interactive=TRUE</code> option makes the plot interactive, which lessens some of the valid criticism of 3D graphics. Similar looking plots for the same purpose but using a likelihood-ratio approach have been proposed in Smith et al. (2019).
</p>


<h3>Value</h3>

<p>Returns a <code>plotly</code> object if <code>interactive=TRUE</code> is used and a matrix when <code>interactive=FALSE</code> is used (still drawing the plot).
</p>


<h3>Author(s)</h3>

<p>Robin Denz
</p>


<h3>References</h3>

<p>Smith, A. M.; Christodouleas, J. P. &amp; Hwang, W.-T. Understanding the Predictive Value of Continuous Markers for Censored Survival Data Using a Likelihood Ratio Approach BMC Medical Research Methodology, 2019, 19
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(contsurvplot)
library(riskRegression)
library(survival)
library(splines)
library(ggplot2)
library(plotly)

# using data from the survival package
data(nafld, package="survival")

# take a random sample to keep example fast
set.seed(41)
nafld1 &lt;- nafld1[sample(nrow(nafld1), 150), ]

# fit cox-model with age
model &lt;- coxph(Surv(futime, status) ~ age, data=nafld1, x=TRUE)

# plot effect of age on survival for ages 50 to 80
plot_surv_3Dsurface(time="futime",
                    status="status",
                    variable="age",
                    data=nafld1,
                    model=model,
                    horizon=seq(50, 80, 0.5),
                    interactive=FALSE)

# plot effect of age on survival using an interactive plot for ages 50 to 80
plot_surv_3Dsurface(time="futime",
                    status="status",
                    variable="age",
                    data=nafld1,
                    model=model,
                    horizon=seq(50, 80, 0.5),
                    interactive=TRUE)

## showing non-linear effects

# fit cox-model with bmi modeled using B-Splines,
# adjusting for age
model2 &lt;- coxph(Surv(futime, status) ~ age + bs(bmi, df=3),
                data=nafld1, x=TRUE)

# plot effect of bmi on survival using normal plot
plot_surv_3Dsurface(time="futime",
                    status="status",
                    variable="bmi",
                    data=nafld1,
                    model=model2,
                    interactive=FALSE)

# plot effect of bmi on survival using interactive plot
plot_surv_3Dsurface(time="futime",
                    status="status",
                    variable="bmi",
                    data=nafld1,
                    model=model2,
                    interactive=TRUE)
</code></pre>

<hr>
<h2 id='plot_surv_animated'>
Create an Animated Plot of Survival Curves of CIFs as a Function of a Continuous Variable
</h2><span id='topic+plot_surv_animated'></span>

<h3>Description</h3>

<p>Using a previously fit time-to-event model, this function plots a single covariate-specific survival curve or CIF. Using either the <span class="pkg">plotly</span> or the <span class="pkg">gganimate</span> package, an animated plot is created that is either simply showing how the curve evolves over values of the continuous covariate, or includes a slide to let the user interact with it.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_surv_animated(time, status, variable, group=NULL,
                   data, model, cif=FALSE, conf_int=FALSE,
                   conf_level=0.95, n_boot=300,
                   na.action=options()$na.action,
                   horizon=NULL, fixed_t=NULL, max_t=Inf,
                   slider=TRUE, size=1, color="black",
                   linetype="solid", alpha=1,
                   xlab="Time", ylab="Survival Probability",
                   title=NULL, subtitle=NULL,
                   gg_theme=ggplot2::theme_bw(),
                   facet_args=list(), ci_alpha=0.4,
                   kaplan_meier=FALSE, km_size=0.5,
                   km_linetype="solid", km_alpha=1,
                   km_color="black", km_ci=FALSE,
                   km_ci_type="plain", km_ci_level=0.95,
                   km_ci_alpha=0.4, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_surv_animated_+3A_time">time</code></td>
<td>

<p>A single character string specifying the time-to-event variable. Needs to be a valid column name of a numeric variable in <code>data</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_status">status</code></td>
<td>

<p>A single character string specifying the status variable, indicating if a person has experienced an event or not. Needs to be a valid column name of a numeric or logical variable in <code>data</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_variable">variable</code></td>
<td>

<p>A single character string specifying the continuous variable of interest, for which the survival curves should be estimated. This variable has to be contained in the <code>data.frame</code> that is supplied to the <code>data</code> argument.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_group">group</code></td>
<td>

<p>An optional single character string specifying a factor variable in <code>data</code>. When used, the plot is created conditional on this factor variable, meaning that a facetted plot is produced with one facet for each level of the factor variable. See <code><a href="#topic+curve_cont">curve_cont</a></code> for a detailed description of the estimation strategy. Set to <code>NULL</code> (default) to use no grouping variable.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_data">data</code></td>
<td>

<p>A <code>data.frame</code> containing all required variables.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_model">model</code></td>
<td>

<p>A model describing the time-to-event process (such as an <code>coxph</code> model). Needs to include <code>variable</code> as an independent variable. It also has to have an associated <code><a href="riskRegression.html#topic+riskRegression">predictRisk</a></code> method. See <code>?predictRisk</code> for more details.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_cif">cif</code></td>
<td>

<p>Whether to plot the cumulative incidence (CIF) instead of the survival probability. If multiple failure types are present, the survival probability cannot be estimated in an unbiased way. This function will always return CIF estimates in that case.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_conf_int">conf_int</code></td>
<td>

<p>Whether to plot point-wise bootstrap confidence intervals or not. Currently only supported when using <code>slider=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_conf_level">conf_level</code></td>
<td>

<p>A number specifying the confidence level of the bootstrap confidence intervals. Ignored if <code>conf_int=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_n_boot">n_boot</code></td>
<td>

<p>A single integer specifying how many bootstrap repetitions should be performed. Ignored if  <code>conf_int=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_na.action">na.action</code></td>
<td>

<p>How missing values should be handled. Can be one of: <code>na.fail</code>, <code>na.omit</code>, <code>na.pass</code>, <code>na.exclude</code> or a user-defined custom function. Also accepts strings of the function names. See <code>?na.action</code> for more details. By default it uses the na.action which is set in the global options by the respective user.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_horizon">horizon</code></td>
<td>

<p>A numeric vector containing a range of values of <code>variable</code> for which the survival curves should be calculated or <code>NULL</code> (default). If <code>NULL</code>, the horizon is constructed as a sequence from the lowest to the highest value observed in <code>variable</code> with 40 equally spaced steps.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_fixed_t">fixed_t</code></td>
<td>

<p>A numeric vector containing points in time at which the survival probabilities should be calculated or <code>NULL</code> (default). If <code>NULL</code>, the survival probability is estimated at every point in time at which an event occurred.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_max_t">max_t</code></td>
<td>

<p>A number indicating the latest survival time which is to be plotted.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_slider">slider</code></td>
<td>

<p>Whether to include a slider that controls the value of the continuous covariate or not. If not, the plot simply cycles through the values in <code>horizon</code> at a constant speed.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_size">size</code></td>
<td>

<p>A single number specifying the size of the drawn curve.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_color">color</code></td>
<td>

<p>A single character string specifying the color of the curve.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_linetype">linetype</code></td>
<td>

<p>A single character string specifying the linetype of the curve.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_alpha">alpha</code></td>
<td>

<p>The transparency level of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_xlab">xlab</code></td>
<td>

<p>A character string used as the x-axis label of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_ylab">ylab</code></td>
<td>

<p>A character string used as the y-axis label of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_title">title</code></td>
<td>

<p>A character string used as the title of the plot. When <code>slider=FALSE</code> is used, the title is also used in a dynamic way to show which value the continuous variable currently has. The user-defined title is still shown, but the covariate level is also appended to it in that case.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_subtitle">subtitle</code></td>
<td>

<p>A character string used as the subtitle of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_gg_theme">gg_theme</code></td>
<td>

<p>A <span class="pkg">ggplot2</span> theme which is applied to the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_facet_args">facet_args</code></td>
<td>

<p>A named list of arguments that are passed to the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code> function call when creating a plot separated by groups. Ignored if <code>group=NULL</code>. Any argument except the <code>facets</code> argument of the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code> function can be used. For example, if the user wants to allow free y-scales, this argument could be set to <code>list(scales="free_y")</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_ci_alpha">ci_alpha</code></td>
<td>

<p>A single number defining the transparency level of the confidence interval bands.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_kaplan_meier">kaplan_meier</code></td>
<td>

<p>Whether to add a standard Kaplan-Meier estimator to the plot or not. If <code>group</code> is defined, the Kaplan-Meier estimator will be stratified by the grouping variable. If <code>cif=TRUE</code> was used, the cumulative incidence will be displayed instead of the survival curve.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_km_size">km_size</code></td>
<td>

<p>The size of the Kaplan-Meier line. Ignored if <code>kaplan_meier=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_km_linetype">km_linetype</code></td>
<td>

<p>The linetype of the Kaplan-Meier line. Ignored if <code>kaplan_meier=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_km_alpha">km_alpha</code></td>
<td>

<p>The transparency level of the Kaplan-Meier line. Ignored if <code>kaplan_meier=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_km_color">km_color</code></td>
<td>

<p>The color of the Kaplan-Meier line. Ignored if <code>kaplan_meier=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_km_ci">km_ci</code></td>
<td>

<p>Whether to draw a confidence interval around the Kaplan-Meier estimates. Ignored if <code>kaplan_meier=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_km_ci_type">km_ci_type</code></td>
<td>

<p>Which type of confidence interval to calculate for the Kaplan-Meier estimates. Corresponds to the <code>conf.type</code> argument in the <code>survfit</code> function. Ignored if <code>kaplan_meier=FALSE</code> or <code>km_ci=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_km_ci_level">km_ci_level</code></td>
<td>

<p>Which confidence level to use for the confidence interval of the Kaplan-Meier estimates. Ignored if <code>kaplan_meier=FALSE</code> or <code>km_ci=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_km_ci_alpha">km_ci_alpha</code></td>
<td>

<p>The transparency level of the confidence interval of the Kaplan-Meier estimates. Ignored if <code>kaplan_meier=FALSE</code> or <code>km_ci=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_animated_+3A_...">...</code></td>
<td>

<p>Further arguments passed to <code><a href="#topic+curve_cont">curve_cont</a></code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When the plot doesn't have to be on paper, it is also possible to use animation to represent how the survival curve or CIF changes when different values of a continuous covariate are used. There are two options included in this function. The first one is creating a plot with a slider that can be interactively manipulated by the user (argument <code>slider=TRUE</code>). The second option creates a .gif file in which the continuous variable changes constantly over time (argument <code>slider=FALSE</code>).
</p>
<p>This type of plot is only useful when visualizing the effect on a computer. It is also important to keep in mind that these plots might look slightly different to users with different hardware and or software.
</p>
<p>An additional interactive plot can be created using the <code><a href="#topic+plot_surv_3Dsurface">plot_surv_3Dsurface</a></code> function with <code>interactive=TRUE</code>.
</p>


<h3>Value</h3>

<p>Returns a <code>plotly</code> object if <code>slider=TRUE</code> and a <code>gganim</code> object if <code>slider=FALSE</code>.
</p>


<h3>Author(s)</h3>

<p>Robin Denz
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(contsurvplot)
library(riskRegression)
library(survival)
library(splines)
library(ggplot2)
library(gganimate)
library(transformr)
library(plotly)

# using data from the survival package
data(nafld, package="survival")

# take a random sample to keep example fast
set.seed(42)
nafld1 &lt;- nafld1[sample(nrow(nafld1), 150), ]

# fit cox-model with age
model &lt;- coxph(Surv(futime, status) ~ age, data=nafld1, x=TRUE)

if (interactive()) {
# plot effect of age on survival for ages 50 to 80
plot_surv_animated(time="futime",
                   status="status",
                   variable="age",
                   data=nafld1,
                   model=model,
                   horizon=seq(50, 80, 1),
                   slider=TRUE)

# plot effect of age on survival using an interactive plot for ages 50 to 80
plot_surv_animated(time="futime",
                   status="status",
                   variable="age",
                   data=nafld1,
                   model=model,
                   horizon=seq(50, 80, 1),
                   slider=FALSE)
}

## showing non-linear effects

# fit cox-model with bmi modeled using B-Splines,
# adjusting for age and sex
model2 &lt;- coxph(Surv(futime, status) ~ age + male + bs(bmi, df=3),
                data=nafld1, x=TRUE)

if (interactive()) {
# plot effect of bmi on survival using slider
plot_surv_animated(time="futime",
                   status="status",
                   variable="bmi",
                   data=nafld1,
                   model=model2,
                   slider=TRUE)

# plot effect of bmi on survival using a .gif
plot_surv_animated(time="futime",
                   status="status",
                   variable="bmi",
                   data=nafld1,
                   model=model2,
                   slider=FALSE)
}
</code></pre>

<hr>
<h2 id='plot_surv_area'>
Plot a Survival Area Plot for the Effect of a Continuous Variable on a Time-To-Event Outcome
</h2><span id='topic+plot_surv_area'></span>

<h3>Description</h3>

<p>Using a previously fit time-to-event model, this function plots a survival curve or CIF area plot. Instead of plotting value-specific curves, the probability of interest is represented as an area as a function of time, where the color changes according to the continuous variable.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_surv_area(time, status, variable, group=NULL,
               data, model, cif=FALSE,
               na.action=options()$na.action,
               horizon=NULL, fixed_t=NULL, max_t=Inf,
               start_color="blue", end_color="red", alpha=1,
               discrete=FALSE, bins=ifelse(discrete, 10, 40),
               sep_lines=FALSE, sep_color="black",
               sep_size=0.1, sep_linetype="solid",
               sep_alpha=alpha, xlab="Time",
               ylab="Survival Probability", title=NULL,
               subtitle=NULL, legend.title=variable,
               legend.position="right",
               gg_theme=ggplot2::theme_bw(),
               facet_args=list(), label_digits=NULL,
               transition_size=0.01, kaplan_meier=FALSE,
               km_size=0.5, km_linetype="solid", km_alpha=1,
               km_color="black", monotonic=TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_surv_area_+3A_time">time</code></td>
<td>

<p>A single character string specifying the time-to-event variable. Needs to be a valid column name of a numeric variable in <code>data</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_status">status</code></td>
<td>

<p>A single character string specifying the status variable, indicating if a person has experienced an event or not. Needs to be a valid column name of a numeric or logical variable in <code>data</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_variable">variable</code></td>
<td>

<p>A single character string specifying the continuous variable of interest, for which the survival curves should be estimated. This variable has to be contained in the <code>data.frame</code> that is supplied to the <code>data</code> argument.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_group">group</code></td>
<td>

<p>An optional single character string specifying a factor variable in <code>data</code>. When used, the plot is created conditional on this factor variable, meaning that a facetted plot is produced with one facet for each level of the factor variable. See <code><a href="#topic+curve_cont">curve_cont</a></code> for a detailed description of the estimation strategy. Set to <code>NULL</code> (default) to use no grouping variable.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_data">data</code></td>
<td>

<p>A <code>data.frame</code> containing all required variables.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_model">model</code></td>
<td>

<p>A model describing the time-to-event process (such as an <code>coxph</code> model). Needs to include <code>variable</code> as an independent variable. It also has to have an associated <code><a href="riskRegression.html#topic+riskRegression">predictRisk</a></code> method. See <code>?predictRisk</code> for more details.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_cif">cif</code></td>
<td>

<p>Whether to plot the cumulative incidence (CIF) instead of the survival probability. If multiple failure types are present, the survival probability cannot be estimated in an unbiased way. This function will always return CIF estimates in that case.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_na.action">na.action</code></td>
<td>

<p>How missing values should be handled. Can be one of: <code>na.fail</code>, <code>na.omit</code>, <code>na.pass</code>, <code>na.exclude</code> or a user-defined custom function. Also accepts strings of the function names. See <code>?na.action</code> for more details. By default it uses the na.action which is set in the global options by the respective user.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_horizon">horizon</code></td>
<td>

<p>A numeric vector containing a range of values of <code>variable</code> for which the survival curves should be calculated or <code>NULL</code> (default). If <code>NULL</code>, the horizon is constructed as a sequence from the lowest to the highest value observed in <code>variable</code> with 40 equally spaced steps.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_fixed_t">fixed_t</code></td>
<td>

<p>A numeric vector containing points in time at which the survival probabilities should be calculated or <code>NULL</code> (default). If <code>NULL</code>, the survival probability is estimated at every point in time at which an event occurred.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_max_t">max_t</code></td>
<td>

<p>A number indicating the latest survival time which is to be plotted.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_start_color">start_color</code></td>
<td>

<p>The color used for the lowest value in <code>horizon</code>. This and the <code>end_color</code> argument can be used to specify custom continuous color scales used in the plot. For example, if a black and white plot is desired, the user can set <code>start_color="white"</code> and <code>end_color="black"</code>. See <code>?scale_color_gradient</code> for more information.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_end_color">end_color</code></td>
<td>

<p>The color used for the highest value in <code>horizon</code>. See argument <code>start_color</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_alpha">alpha</code></td>
<td>

<p>The transparency level of the main plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_discrete">discrete</code></td>
<td>

<p>Whether to plot the area as a single continuously shaded area (default) or as multiple discrete blocks. The blocks correspond to ranges (such as 5-10). This only really changes the style of the legend and decreases the default value of <code>bins</code> to make the discrete blocks visable.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_bins">bins</code></td>
<td>

<p>The number of bins the survival area should be divided into. In a nutshell, this function simply estimates a lot of covariate specific curves and colors the area between them on a graded scale. If many bins are used, this gives the appearance of a single shaded area, changing continuously. By using only a few bins however, the specific covariate values might be easier to read off the plot. See also the <code>discrete</code> argument.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_sep_lines">sep_lines</code></td>
<td>

<p>Whether to draw lines between the individual area segments or not. When <code>discrete=TRUE</code> is used, this might be a good option to help visually separate the segments.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_sep_color">sep_color</code></td>
<td>

<p>The color of the separator lines. Ignored if <code>sep_lines=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_sep_size">sep_size</code></td>
<td>

<p>The size of the separator lines. Ignored if <code>sep_lines=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_sep_linetype">sep_linetype</code></td>
<td>

<p>The linetype of the separator lines. Ignored if <code>sep_lines=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_sep_alpha">sep_alpha</code></td>
<td>

<p>The transparency level of the separator lines. Ignored if <code>sep_lines=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_xlab">xlab</code></td>
<td>

<p>A character string used as the x-axis label of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_ylab">ylab</code></td>
<td>

<p>A character string used as the y-axis label of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_title">title</code></td>
<td>

<p>A character string used as the title of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_subtitle">subtitle</code></td>
<td>

<p>A character string used as the subtitle of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_legend.title">legend.title</code></td>
<td>

<p>A character string used as the legend title of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_legend.position">legend.position</code></td>
<td>

<p>Where to put the legend. See <code>?theme</code> for more details.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_gg_theme">gg_theme</code></td>
<td>

<p>A <span class="pkg">ggplot2</span> theme which is applied to the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_facet_args">facet_args</code></td>
<td>

<p>A named list of arguments that are passed to the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code> function call when creating a plot separated by groups. Ignored if <code>group=NULL</code>. Any argument except the <code>facets</code> argument of the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code> function can be used. For example, if the user wants to allow free y-scales, this argument could be set to <code>list(scales="free_y")</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_label_digits">label_digits</code></td>
<td>

<p>A single number specifying to how many digits the labels of the plot should be rounded or <code>NULL</code> (default). If <code>NULL</code>, no rounding is performed and the exact values are presented. This argument is only used when <code>discrete=TRUE</code> is used and ignored otherwise.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_transition_size">transition_size</code></td>
<td>

<p>A single number &gt; 0 specifying the <code>size</code> parameter in the <code>pammtools::geom_stepribbon()</code> calls whenever <code>discrete=FALSE</code> is used. This size parameter defines the size of the outline of each individual element of the plot. Can usually be left as is. Sometimes when saving these graphics to <code>.png</code> or <code>.jpg</code> files it may be useful to increase this value to avoid weird looking lines between the areas.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_kaplan_meier">kaplan_meier</code></td>
<td>

<p>Whether to add a standard Kaplan-Meier estimator to the plot or not. If <code>group</code> is defined, the Kaplan-Meier estimator will be stratified by the grouping variable. If <code>cif=TRUE</code> was used, the cumulative incidence will be displayed instead of the survival curve.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_km_size">km_size</code></td>
<td>

<p>The size of the Kaplan-Meier line. Ignored if <code>kaplan_meier=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_km_linetype">km_linetype</code></td>
<td>

<p>The linetype of the Kaplan-Meier line. Ignored if <code>kaplan_meier=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_km_alpha">km_alpha</code></td>
<td>

<p>The transparency level of the Kaplan-Meier line. Ignored if <code>kaplan_meier=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_km_color">km_color</code></td>
<td>

<p>The color of the Kaplan-Meier line. Ignored if <code>kaplan_meier=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_monotonic">monotonic</code></td>
<td>

<p>A single logical value specifying whether the relationship between the <code>variable</code> and the survival probability is monotonic or not. If there are non-monotonic effects, the areas will be drawn on top of each other when using <code>monotonic=TRUE</code> (default). By setting this argument to <code>FALSE</code>, the plot will be divided into multiple facets. Each facet contains the plot for a certain range of values of the <code>variable</code>, in which the effect is monotonic. The <code>group</code> argument may not be used with <code>monotonic=FALSE</code>. This also only works for continuously shaded ares, e.g. with horizons containing at least 40 distinct values.
</p>
</td></tr>
<tr><td><code id="plot_surv_area_+3A_...">...</code></td>
<td>

<p>Further arguments passed to <code><a href="#topic+curve_cont">curve_cont</a></code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is very similar to a contour plot (see <code><a href="#topic+plot_surv_contour">plot_surv_contour</a></code>), but with the probability of interest on the y-axis and the color representing the values of the continuous variable of interest. The main advantage of this type of plot is, that it has the same structure as a usual Kaplan-Meier plot. The only difference is that instead of single curves stratified by some variable, the curves are plotted as an area instead.
</p>
<p>This is achieved by estimating value-specific curves over the whole range of the continuous covariate using direct standardization and a previously fitted time-to-event model (see <code><a href="#topic+curve_cont">curve_cont</a></code>). The area between those curves is then simply filled in (using the <code>geom_stepribbon</code> function from the <span class="pkg">pammtools</span> package). By using a big number of individual curves, the appearance of a continuously shaded area is created. This is done by default when using the argument <code>discrete=FALSE</code>. By using <code>discrete=TRUE</code>, only a small number of value-specific curves are estimated, resulting in only a few discrete bins. When using only a few bins, the output is therefore even closer to a contour plot.
</p>
<p>The major downside of this plotting method is that it has problems handling non-monotone effects. Curved relationships between the variable and the survival time result in the areas being plotted on top of each other in a standard survival area plot. By using <code>monotonic=FALSE</code>, the user may still use this function for nonlinear effects. This strategy is not optimal when the relationship is very complex, resulting in lots of facets in the plot. We recommend using either the <code><a href="#topic+plot_surv_contour">plot_surv_contour</a></code>, <code><a href="#topic+plot_surv_heatmap">plot_surv_heatmap</a></code> or <code><a href="#topic+plot_surv_matrix">plot_surv_matrix</a></code> functions in this case.
</p>


<h3>Value</h3>

<p>Returns a <code>ggplot2</code> object.
</p>


<h3>Note</h3>

<p>When saving this graphic to <code>.png</code> or <code>.jpg</code> files while using <code>discrete=FALSE</code>, they may sometimes contain some barely visible (but very annoying) lines. Those are the divisions between the areas the plot is made off. This only happens when saving this plot to non-vector graphics, which is why we recommend saving it to <code>.pdf</code> or similar file types only. If other file types are necessary, one can set the <code>transition_size</code> argument to higher values (such as 0.5 or 1) to remove this problem as well.
</p>


<h3>Author(s)</h3>

<p>Robin Denz
</p>


<h3>References</h3>

<p>Robin Denz, Nina Timmesfeld (2023). &quot;Visualizing the (Causal) Effect of a Continuous Variable on a Time-To-Event Outcome&quot;. In: Epidemiology 34.5
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(contsurvplot)
library(riskRegression)
library(survival)
library(ggplot2)
library(pammtools)

# using data from the survival package
data(nafld, package="survival")

# take a random sample to keep example fast
set.seed(42)
nafld1 &lt;- nafld1[sample(nrow(nafld1), 100), ]

# fit cox-model with age
model &lt;- coxph(Surv(futime, status) ~ age, data=nafld1, x=TRUE)

# plot effect of age on survival using defaults
plot_surv_area(time="futime",
               status="status",
               variable="age",
               data=nafld1,
               model=model)

# plot it only for 60 to 80 year old people
plot_surv_area(time="futime",
               status="status",
               variable="age",
               data=nafld1,
               model=model,
               horizon=seq(60, 80, 0.5))

# plot it only for 60 to 60 year old people, using discrete bins
# and a black and white color scale
plot_surv_area(time="futime",
               status="status",
               variable="age",
               data=nafld1,
               model=model,
               horizon=seq(60, 80, 5),
               discrete=TRUE,
               start_color="grey",
               end_color="black")
</code></pre>

<hr>
<h2 id='plot_surv_at_t'>
Plot the Survival Probability or CIF at a Fixed Point in Time as a Function of a Continuous Variable
</h2><span id='topic+plot_surv_at_t'></span>

<h3>Description</h3>

<p>Using a previously fit time-to-event model, this function plots the survival probability or CIF at one or multiple user defined points at time as a function of a continuous variable.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_surv_at_t(time, status, variable, group=NULL,
               data, model, cif=FALSE, conf_int=FALSE,
               conf_level=0.95, n_boot=300,
               na.action=options()$na.action, t, horizon=NULL,
               size=1, linetype="solid", alpha=1,
               xlab=variable, ylab="Survival Probability at t",
               title=NULL, subtitle=NULL,
               legend.title="t", legend.position="right",
               gg_theme=ggplot2::theme_bw(),
               facet_args=list(), ci_alpha=0.4, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_surv_at_t_+3A_time">time</code></td>
<td>

<p>A single character string specifying the time-to-event variable. Needs to be a valid column name of a variable in <code>data</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_status">status</code></td>
<td>

<p>A single character string specifying the status variable, indicating if a person has experienced an event or not. Needs to be a valid column name of a variable in <code>data</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_variable">variable</code></td>
<td>

<p>A single character string specifying the continuous variable of interest, for which the survival curves should be estimated. This variable has to be contained in the <code>data.frame</code> that is supplied to the <code>data</code> argument.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_group">group</code></td>
<td>

<p>An optional single character string specifying a factor variable in <code>data</code>. When used, the plot is created conditional on this factor variable, meaning that a facetted plot is produced with one facet for each level of the factor variable. See <code><a href="#topic+curve_cont">curve_cont</a></code> for a detailed description of the estimation strategy. Set to <code>NULL</code> (default) to use no grouping variable.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_data">data</code></td>
<td>

<p>A <code>data.frame</code> containing all required variables.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_model">model</code></td>
<td>

<p>A model describing the time-to-event process (such as an <code>coxph</code> model). Needs to include <code>variable</code> as an independent variable. It also has to have an associated <code><a href="riskRegression.html#topic+riskRegression">predictRisk</a></code> method. See <code>?predictRisk</code> for more details.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_cif">cif</code></td>
<td>

<p>Whether to plot the cumulative incidence (CIF) instead of the survival probability. If multiple failure types are present, the survival probability cannot be estimated in an unbiased way. This function will always return CIF estimates in that case.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_conf_int">conf_int</code></td>
<td>

<p>Whether to plot point-wise bootstrap confidence intervals or not.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_conf_level">conf_level</code></td>
<td>

<p>A number specifying the confidence level of the bootstrap confidence intervals. Ignored if <code>conf_int=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_n_boot">n_boot</code></td>
<td>

<p>A single integer specifying how many bootstrap repetitions should be performed. Ignored if  <code>conf_int=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_na.action">na.action</code></td>
<td>

<p>How missing values should be handled. Can be one of: <code>na.fail</code>, <code>na.omit</code>, <code>na.pass</code>, <code>na.exclude</code> or a user-defined custom function. Also accepts strings of the function names. See <code>?na.action</code> for more details. By default it uses the na.action which is set in the global options by the respective user.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_t">t</code></td>
<td>

<p>The point in time at which the survival probability should be calculated. For example, by setting this parameter to 10, this function will display the survival probability at t = 10 over values of <code>variable</code>. If multiple values are supplied, one curve is drawn for each of them.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_horizon">horizon</code></td>
<td>

<p>A numeric vector containing a range of values of <code>variable</code> for which the survival curves should be calculated or <code>NULL</code> (default). If <code>NULL</code>, the horizon is constructed as a sequence from the lowest to the highest value observed in <code>variable</code> with 100 equally spaced steps.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_size">size</code></td>
<td>

<p>A single number specifying how thick the lines should be drawn.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_linetype">linetype</code></td>
<td>

<p>The linetype of the drawn lines. See documentation of <span class="pkg">ggplot2</span> for more details on allowed values.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_alpha">alpha</code></td>
<td>

<p>The transparency level of the lines.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_xlab">xlab</code></td>
<td>

<p>A character string used as the x-axis label of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_ylab">ylab</code></td>
<td>

<p>A character string used as the y-axis label of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_title">title</code></td>
<td>

<p>A character string used as the title of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_subtitle">subtitle</code></td>
<td>

<p>A character string used as the subtitle of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_legend.title">legend.title</code></td>
<td>

<p>A character string used as the legend title of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_legend.position">legend.position</code></td>
<td>

<p>Where to put the legend. See <code>?theme</code> for more details.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_gg_theme">gg_theme</code></td>
<td>

<p>A <span class="pkg">ggplot2</span> theme which is applied to the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_facet_args">facet_args</code></td>
<td>

<p>A named list of arguments that are passed to the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code> function call when creating a plot separated by groups. Ignored if <code>group=NULL</code>. Any argument except the <code>facets</code> argument of the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code> function can be used. For example, if the user wants to allow free y-scales, this argument could be set to <code>list(scales="free_y")</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_ci_alpha">ci_alpha</code></td>
<td>

<p>A single number defining the transparency level of the confidence interval bands.
</p>
</td></tr>
<tr><td><code id="plot_surv_at_t_+3A_...">...</code></td>
<td>

<p>Further arguments passed to <code><a href="#topic+curve_cont">curve_cont</a></code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>By picking a single value of time, we can effectively reduce the dimensions of the plot by one, resulting in a simple curve plot of the survival probability or CIF at the specific point in time as it changes over values of the continuous covariate. By supplying a vector of times to the <code>t</code> argument, multiple such curves can be produced in the same plot.
</p>
<p>This can be a very effective plotting strategy if there are specific points in time of interest already (even better if those were pre-defined). It is however a poor strategy if a representation of the effect on the survival over time is desired. An empirical example of this strategy using the 5 year risk is given in Shen et al. (2017).
</p>
<p>As all plot functions in this package, this plot relies on the <code><a href="#topic+curve_cont">curve_cont</a></code> function to calculate the needed probability estimates.
</p>


<h3>Value</h3>

<p>Returns a <code>ggplot2</code> object.
</p>


<h3>Author(s)</h3>

<p>Robin Denz
</p>


<h3>References</h3>

<p>Shen, Y.-M.; Le, L. D.; Wilson, R. &amp; Mansmann, U. Graphical Presentation of Patient-Treatment Interaction Elucidated by Continuous Biomarkers: Current Practice and Scope for Improvement Methods of Information in Medicine, 2017, 56, 13-27
</p>
<p>Robin Denz, Nina Timmesfeld (2023). &quot;Visualizing the (Causal) Effect of a Continuous Variable on a Time-To-Event Outcome&quot;. In: Epidemiology 34.5
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(contsurvplot)
library(riskRegression)
library(survival)
library(ggplot2)

# using data from the survival package
data(nafld, package="survival")

# take a random sample to keep example fast
set.seed(42)
nafld1 &lt;- nafld1[sample(nrow(nafld1), 150), ]

# fit cox-model with age
model &lt;- coxph(Surv(futime, status) ~ age, data=nafld1, x=TRUE)

# plot effect of age on survival at t=2000
plot_surv_at_t(time="futime",
               status="status",
               variable="age",
               data=nafld1,
               model=model,
               t=2000)

# plot it for arbitrary multiple values of t
plot_surv_at_t(time="futime",
               status="status",
               variable="age",
               data=nafld1,
               model=model,
               t=c(1000, 2000, 3200, 5643))
</code></pre>

<hr>
<h2 id='plot_surv_contour'>
Create a Contour Plot of the Effect of a Continuous Covariate on the Survival Probability
</h2><span id='topic+plot_surv_contour'></span>

<h3>Description</h3>

<p>Using a previously fit time-to-event model, this function creates a contour plot with the continuous covariate on the y-axis and the time-to-event on the x-axis. The color is made in accordance with the corresponding survival probability at that point, binned into separate categories. This is very similar to the <code><a href="#topic+plot_surv_heatmap">plot_surv_heatmap</a></code> plot, but using a categorical representation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_surv_contour(time, status, variable, group=NULL,
                  data, model, cif=FALSE,
                  na.action=options()$na.action,
                  horizon=NULL, fixed_t=NULL, max_t=Inf,
                  size=0.1, linetype="solid", alpha=1,
                  bins=NULL, binwidth=NULL, breaks=NULL,
                  custom_colors=NULL,
                  xlab="Time", ylab=variable,
                  title=NULL, subtitle=NULL,
                  legend.title="S(t)", legend.position="right",
                  gg_theme=ggplot2::theme_bw(),
                  facet_args=list(),
                  panel_border=FALSE, axis_dist=0, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_surv_contour_+3A_time">time</code></td>
<td>

<p>A single character string specifying the time-to-event variable. Needs to be a valid column name of a numeric variable in <code>data</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_status">status</code></td>
<td>

<p>A single character string specifying the status variable, indicating if a person has experienced an event or not. Needs to be a valid column name of a numeric or logical variable in <code>data</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_variable">variable</code></td>
<td>

<p>A single character string specifying the continuous variable of interest, for which the survival curves should be estimated. This variable has to be contained in the <code>data.frame</code> that is supplied to the <code>data</code> argument.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_group">group</code></td>
<td>

<p>An optional single character string specifying a factor variable in <code>data</code>. When used, the plot is created conditional on this factor variable, meaning that a facetted plot is produced with one facet for each level of the factor variable. See <code><a href="#topic+curve_cont">curve_cont</a></code> for a detailed description of the estimation strategy. Set to <code>NULL</code> (default) to use no grouping variable.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_data">data</code></td>
<td>

<p>A <code>data.frame</code> containing all required variables.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_model">model</code></td>
<td>

<p>A model describing the time-to-event process (such as an <code>coxph</code> model). Needs to include <code>variable</code> as an independent variable. It also has to have an associated <code><a href="riskRegression.html#topic+riskRegression">predictRisk</a></code> method. See <code>?predictRisk</code> for more details.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_cif">cif</code></td>
<td>

<p>Whether to plot the cumulative incidence (CIF) instead of the survival probability. If multiple failure types are present, the survival probability cannot be estimated in an unbiased way. This function will always return CIF estimates in that case.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_na.action">na.action</code></td>
<td>

<p>How missing values should be handled. Can be one of: <code>na.fail</code>, <code>na.omit</code>, <code>na.pass</code>, <code>na.exclude</code> or a user-defined custom function. Also accepts strings of the function names. See <code>?na.action</code> for more details. By default it uses the na.action which is set in the global options by the respective user.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_horizon">horizon</code></td>
<td>

<p>A numeric vector containing a range of values of <code>variable</code> for which the survival curves should be calculated or <code>NULL</code> (default). If <code>NULL</code>, the horizon is constructed as a sequence from the lowest to the highest value observed in <code>variable</code> with 40 equally spaced steps.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_fixed_t">fixed_t</code></td>
<td>

<p>A numeric vector containing points in time at which the survival probabilities should be calculated or <code>NULL</code> (default). If <code>NULL</code>, the survival probability is estimated at 100 equally spaced steps from 0 to the maximum observed event time.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_max_t">max_t</code></td>
<td>

<p>A number indicating the latest survival time which is to be plotted.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_size">size</code></td>
<td>

<p>The size of the individual lines plotted by the <code><a href="ggplot2.html#topic+ggplot2">geom_contour_filled</a></code> function. Usually this option can be kept at 0.1 (default).
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_linetype">linetype</code></td>
<td>

<p>The linetype of the contour lines.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_alpha">alpha</code></td>
<td>

<p>The transparency level of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_bins">bins</code></td>
<td>

<p>A single number specifying how many categories the survival probability or CIF should be divided in, or <code>NULL</code> (default). If <code>NULL</code>, the defaults in <code><a href="ggplot2.html#topic+ggplot2">geom_contour_filled</a></code> are used.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_binwidth">binwidth</code></td>
<td>

<p>A single number specifying the width of the bins of the survival probability or CIF categories, or <code>NULL</code> (default). If <code>NULL</code>, the defaults in <code><a href="ggplot2.html#topic+ggplot2">geom_contour_filled</a></code> are used.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_breaks">breaks</code></td>
<td>

<p>A vector of specific breaks to create the survival probability or CIF bins, or <code>NULL</code> (default). If <code>NULL</code>, the defaults in <code><a href="ggplot2.html#topic+ggplot2">geom_contour_filled</a></code> are used.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_custom_colors">custom_colors</code></td>
<td>

<p>A character vector of custom colors that should be used for each contour area.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_xlab">xlab</code></td>
<td>

<p>A character string used as the x-axis label of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_ylab">ylab</code></td>
<td>

<p>A character string used as the y-axis label of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_title">title</code></td>
<td>

<p>A character string used as the title of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_subtitle">subtitle</code></td>
<td>

<p>A character string used as the subtitle of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_legend.title">legend.title</code></td>
<td>

<p>A character string used as the legend title of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_legend.position">legend.position</code></td>
<td>

<p>Where to put the legend. See <code>?theme</code> for more details.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_gg_theme">gg_theme</code></td>
<td>

<p>A <span class="pkg">ggplot2</span> theme which is applied to the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_facet_args">facet_args</code></td>
<td>

<p>A named list of arguments that are passed to the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code> function call when creating a plot separated by groups. Ignored if <code>group=NULL</code>. Any argument except the <code>facets</code> argument of the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code> function can be used. For example, if the user wants to allow free y-scales, this argument could be set to <code>list(scales="free_y")</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_panel_border">panel_border</code></td>
<td>

<p>Whether to draw a border around the heatmap or not. Is set to FALSE by default to mimic standard heatmaps.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_axis_dist">axis_dist</code></td>
<td>

<p>The distance of the axis ticks to the colored heatmap. Is set to 0 by default to mimic standard heatmaps.
</p>
</td></tr>
<tr><td><code id="plot_surv_contour_+3A_...">...</code></td>
<td>

<p>Further arguments passed to <code><a href="#topic+curve_cont">curve_cont</a></code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Contour plots are a great way to reduce three dimensions to a two-dimensional plot and therefore lend themselves easily to plot the effect of continuous variable on the survival probability or CIF over time. Heatmaps (as available in the <code><a href="#topic+plot_surv_heatmap">plot_surv_heatmap</a></code>) function are very similar, but are often less clear then contour plots. The major downside of these plots is that they do not have the survival probability (or CIF) on the y-axis, which is of course the standard in standard Kaplan-Meier plots. A very similar plot but with the probability of interest on the y-axis can be created using the <code><a href="#topic+plot_surv_area">plot_surv_area</a></code> function.
</p>
<p>This type of plot has been described in Jackson &amp; Cox (2021). However, the authors of that article propose a different method to estimate the needed data for the plot.
</p>
<p>Internally, this function uses the <code><a href="ggplot2.html#topic+ggplot2">geom_contour_filled</a></code> function of the <span class="pkg">ggplot2</span> package to create the plot, after estimating the required probabilities using the <code><a href="#topic+curve_cont">curve_cont</a></code> function.
</p>


<h3>Value</h3>

<p>Returns a <code>ggplot2</code> object.
</p>


<h3>Author(s)</h3>

<p>Robin Denz
</p>


<h3>References</h3>

<p>Robin Denz, Nina Timmesfeld (2023). &quot;Visualizing the (Causal) Effect of a Continuous Variable on a Time-To-Event Outcome&quot;. In: Epidemiology 34.5
</p>
<p>Jackson, R. J. &amp; Cox, T. F. Kernel Hazard Estimation for Visualisation of the Effect of a Continuous Covariate on Time-To-Event Endpoints  Pharamaceutical Statistics, 2021
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(contsurvplot)
library(riskRegression)
library(survival)
library(ggplot2)
library(splines)

# using data from the survival package
data(nafld, package="survival")

# take a random sample to keep example fast
set.seed(42)
nafld1 &lt;- nafld1[sample(nrow(nafld1), 150), ]

# fit cox-model with age
model &lt;- coxph(Surv(futime, status) ~ age, data=nafld1, x=TRUE)

# plot effect of age on survival using defaults
plot_surv_contour(time="futime",
                  status="status",
                  variable="age",
                  data=nafld1,
                  model=model)

# plot it only for 60 to 80 year old people
plot_surv_contour(time="futime",
                  status="status",
                  variable="age",
                  data=nafld1,
                  model=model,
                  horizon=seq(60, 80, 0.5))

## showing non-linear effects

# fit cox-model with bmi modelled using B-Splines,
# adjusting for age and sex
model2 &lt;- coxph(Surv(futime, status) ~ age + male + bs(bmi, df=3),
                data=nafld1, x=TRUE)

# plot effect of bmi on survival using defaults
plot_surv_contour(time="futime",
                  status="status",
                  variable="bmi",
                  data=nafld1,
                  model=model2)
</code></pre>

<hr>
<h2 id='plot_surv_heatmap'>
Plot a Heatmap of the Effect of a Continuous Covariate on a Time-To-Event Outcome
</h2><span id='topic+plot_surv_heatmap'></span>

<h3>Description</h3>

<p>Using a previously fit time-to-event model, this function plots a heatmap with the continuous covariate on the y-axis and the time-to-event on the x-axis. The color is made in accordance with the corresponding survival probability or CIF at that point.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_surv_heatmap(time, status, variable, group=NULL,
                  data, model, cif=FALSE,
                  na.action=options()$na.action,
                  horizon=NULL, fixed_t=NULL, max_t=Inf,
                  start_color=NULL, end_color=NULL,
                  alpha=1, xlab="Time", ylab=variable,
                  title=NULL, subtitle=NULL,
                  legend.title="S(t)", legend.position="right",
                  gg_theme=ggplot2::theme_bw(),
                  facet_args=list(), panel_border=FALSE,
                  axis_dist=0, interpolate=TRUE,
                  contour_lines=FALSE, contour_color="white",
                  contour_size=0.3, contour_linetype="dashed",
                  ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_surv_heatmap_+3A_time">time</code></td>
<td>

<p>A single character string specifying the time-to-event variable. Needs to be a valid column name of a numeric variable in <code>data</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_status">status</code></td>
<td>

<p>A single character string specifying the status variable, indicating if a person has experienced an event or not. Needs to be a valid column name of a numeric or logical variable in <code>data</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_variable">variable</code></td>
<td>

<p>A single character string specifying the continuous variable of interest, for which the survival curves should be estimated. This variable has to be contained in the <code>data.frame</code> that is supplied to the <code>data</code> argument.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_group">group</code></td>
<td>

<p>An optional single character string specifying a factor variable in <code>data</code>. When used, the plot is created conditional on this factor variable, meaning that a facetted plot is produced with one facet for each level of the factor variable. See <code><a href="#topic+curve_cont">curve_cont</a></code> for a detailed description of the estimation strategy. Set to <code>NULL</code> (default) to use no grouping variable.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_data">data</code></td>
<td>

<p>A <code>data.frame</code> containing all required variables.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_model">model</code></td>
<td>

<p>A model describing the time-to-event process (such as an <code>coxph</code> model). Needs to include <code>variable</code> as an independent variable. It also has to have an associated <code><a href="riskRegression.html#topic+riskRegression">predictRisk</a></code> method. See <code>?predictRisk</code> for more details.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_cif">cif</code></td>
<td>

<p>Whether to plot the cumulative incidence (CIF) instead of the survival probability. If multiple failure types are present, the survival probability cannot be estimated in an unbiased way. This function will always return CIF estimates in that case.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_na.action">na.action</code></td>
<td>

<p>How missing values should be handled. Can be one of: <code>na.fail</code>, <code>na.omit</code>, <code>na.pass</code>, <code>na.exclude</code> or a user-defined custom function. Also accepts strings of the function names. See <code>?na.action</code> for more details. By default it uses the na.action which is set in the global options by the respective user.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_horizon">horizon</code></td>
<td>

<p>A numeric vector containing a range of values of <code>variable</code> for which the survival curves should be calculated or <code>NULL</code> (default). If <code>NULL</code>, the horizon is constructed as a sequence from the lowest to the highest value observed in <code>variable</code> with 40 equally spaced steps.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_fixed_t">fixed_t</code></td>
<td>

<p>A numeric vector containing points in time at which the survival probabilities should be calculated or <code>NULL</code> (default). If <code>NULL</code>, the survival probability is estimated at 100 equally spaced steps from 0 to the maximum observed event time.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_max_t">max_t</code></td>
<td>

<p>A number indicating the latest survival time which is to be plotted.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_start_color">start_color</code></td>
<td>

<p>The color used for the lowest value in <code>horizon</code>. This and the <code>end_color</code> argument can be used to specify custom continuous color scales used in the plot. For example, if a black and white plot is desired, the user can set <code>start_color="white"</code> and <code>end_color="black"</code>. See <code>?scale_color_gradient</code> for more information.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_end_color">end_color</code></td>
<td>

<p>The color used for the highest value in <code>horizon</code>. See argument <code>start_color</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_alpha">alpha</code></td>
<td>

<p>The transparency level of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_xlab">xlab</code></td>
<td>

<p>A character string used as the x-axis label of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_ylab">ylab</code></td>
<td>

<p>A character string used as the y-axis label of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_title">title</code></td>
<td>

<p>A character string used as the title of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_subtitle">subtitle</code></td>
<td>

<p>A character string used as the subtitle of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_legend.title">legend.title</code></td>
<td>

<p>A character string used as the legend title of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_legend.position">legend.position</code></td>
<td>

<p>Where to put the legend. See <code>?theme</code> for more details.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_gg_theme">gg_theme</code></td>
<td>

<p>A <span class="pkg">ggplot2</span> theme which is applied to the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_facet_args">facet_args</code></td>
<td>

<p>A named list of arguments that are passed to the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code> function call when creating a plot separated by groups. Ignored if <code>group=NULL</code>. Any argument except the <code>facets</code> argument of the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code> function can be used. For example, if the user wants to allow free y-scales, this argument could be set to <code>list(scales="free_y")</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_panel_border">panel_border</code></td>
<td>

<p>Whether to draw a border around the heatmap or not. Is set to FALSE by default to mimic standard heatmaps.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_axis_dist">axis_dist</code></td>
<td>

<p>The distance of the axis ticks to the colored heatmap. Is set to 0 by default to mimic standard heatmaps.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_interpolate">interpolate</code></td>
<td>

<p>Whether to linearly interpolate the colors or not. Set to <code>TRUE</code> by default, which results in a smooth surface being plotted. Corresponds to the <code>interpolate</code> argument in the <code>geom_raster</code> function, which is used internally.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_contour_lines">contour_lines</code></td>
<td>

<p>Whether to add some contour lines to the heatmap. To get a proper contour plot, use the <code><a href="#topic+plot_surv_contour">plot_surv_contour</a></code> function instead.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_contour_color">contour_color</code></td>
<td>

<p>The color of the contour lines. Defaults to <code>"white"</code>. Ignored if <code>contour_lines=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_contour_size">contour_size</code></td>
<td>

<p>The size of the contour lines. Ignored if <code>contour_lines=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_contour_linetype">contour_linetype</code></td>
<td>

<p>The linetype of the contour lines. Defaults to <code>"dashed"</code>. Ignored if <code>contour_lines=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_heatmap_+3A_...">...</code></td>
<td>

<p>Further arguments passed to <code><a href="#topic+curve_cont">curve_cont</a></code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Heatmaps are a great tool to visualize a three dimensional surface in a two-dimensional plot. A continuous color scale is used to represent the probability of interest. Although this is fine theoretically, it is often hard to read specific information off these plots. Contour lines can be added to the plot in order to make this easier by using <code>contour_lines=TRUE</code> in the function call.
</p>
<p>In most cases, however, it is probably better to use a proper contour plot instead, which can be produced using the <code><a href="#topic+plot_surv_contour">plot_surv_contour</a></code> function. This is mostly a matter of taste, which is why both types of plots are included in this package. Another alternative is the to use the <code><a href="#topic+plot_surv_matrix">plot_surv_matrix</a></code> function, which is basically a discretized version of a survival heatmap.
</p>
<p>The main advantage of the heatmap and the contour plots is that they can visualize the effect of a continuous covariate regardless of how it was modeled. Non-linear relationships can be visualized just as well as linear ones. The major downside is, that the structure of the plot is not the same as that of a standard Kaplan-Meier plot. An alternative that is closer to the standard plot can be created using the <code><a href="#topic+plot_surv_area">plot_surv_area</a></code> function.
</p>


<h3>Value</h3>

<p>Returns a <code>ggplot2</code> object.
</p>


<h3>Author(s)</h3>

<p>Robin Denz
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(contsurvplot)
library(riskRegression)
library(survival)
library(ggplot2)
library(splines)

# using data from the survival package
data(nafld, package="survival")

# take a random sample to keep example fast
set.seed(42)
nafld1 &lt;- nafld1[sample(nrow(nafld1), 150), ]

# fit cox-model with age
model &lt;- coxph(Surv(futime, status) ~ age, data=nafld1, x=TRUE)

# plot effect of age on survival using defaults
plot_surv_heatmap(time="futime",
                  status="status",
                  variable="age",
                  data=nafld1,
                  model=model)

# plot it only for 60 to 80 year old people
plot_surv_heatmap(time="futime",
                  status="status",
                  variable="age",
                  data=nafld1,
                  model=model,
                  horizon=seq(60, 80, 0.5))

## showing non-linear effects

# fit cox-model with bmi modelled using B-Splines,
# adjusting for age and sex
model2 &lt;- coxph(Surv(futime, status) ~ age + male + bs(bmi, df=3),
                data=nafld1, x=TRUE)

# plot effect of bmi on survival using defaults
plot_surv_heatmap(time="futime",
                  status="status",
                  variable="bmi",
                  data=nafld1,
                  model=model2)

# plot effect of bmi on survival with contour lines
plot_surv_heatmap(time="futime",
                  status="status",
                  variable="bmi",
                  data=nafld1,
                  model=model2,
                  contour_lines=TRUE)
</code></pre>

<hr>
<h2 id='plot_surv_lines'>
Plot Individual Survival Curves or CIFs for Specific Values of a Continuous Covariate
</h2><span id='topic+plot_surv_lines'></span>

<h3>Description</h3>

<p>Using a previously fit time-to-event model, this function plots survival curves or CIFs that would have been observed if every individual in the dataset had been set to specific values of a continuous covariate.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_surv_lines(time, status, variable, group=NULL,
                data, model, cif=FALSE, conf_int=FALSE,
                conf_level=0.95, n_boot=300,
                na.action=options()$na.action,
                horizon=NULL, fixed_t=NULL, max_t=Inf,
                discrete=TRUE, custom_colors=NULL,
                start_color="blue", end_color="red",
                size=1, linetype="solid", alpha=1,
                xlab="Time", ylab="Survival Probability",
                title=NULL, subtitle=NULL,
                legend.title=variable, legend.position="right",
                gg_theme=ggplot2::theme_bw(),
                facet_args=list(), ci_alpha=0.4,
                kaplan_meier=FALSE, km_size=0.5,
                km_linetype="solid", km_alpha=1,
                km_color="black", km_ci=FALSE,
                km_ci_type="plain", km_ci_level=0.95,
                km_ci_alpha=0.4, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_surv_lines_+3A_time">time</code></td>
<td>

<p>A single character string specifying the time-to-event variable. Needs to be a valid column name of a numeric variable in <code>data</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_status">status</code></td>
<td>

<p>A single character string specifying the status variable, indicating if a person has experienced an event or not. Needs to be a valid column name of a numeric or logical variable in <code>data</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_variable">variable</code></td>
<td>

<p>A single character string specifying the continuous variable of interest, for which the survival curves should be estimated. This variable has to be contained in the <code>data.frame</code> that is supplied to the <code>data</code> argument.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_group">group</code></td>
<td>

<p>An optional single character string specifying a factor variable in <code>data</code>. When used, the plot is created conditional on this factor variable, meaning that a facetted plot is produced with one facet for each level of the factor variable. See <code><a href="#topic+curve_cont">curve_cont</a></code> for a detailed description of the estimation strategy. Set to <code>NULL</code> (default) to use no grouping variable.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_data">data</code></td>
<td>

<p>A <code>data.frame</code> containing all required variables.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_model">model</code></td>
<td>

<p>A model describing the time-to-event process (such as an <code>coxph</code> model). Needs to include <code>variable</code> as an independent variable. It also has to have an associated <code><a href="riskRegression.html#topic+riskRegression">predictRisk</a></code> method. See <code>?predictRisk</code> for more details.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_cif">cif</code></td>
<td>

<p>Whether to plot the cumulative incidence (CIF) instead of the survival probability. If multiple failure types are present, the survival probability cannot be estimated in an unbiased way. This function will always return CIF estimates in that case.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_conf_int">conf_int</code></td>
<td>

<p>Whether to plot point-wise bootstrap confidence intervals or not.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_conf_level">conf_level</code></td>
<td>

<p>A number specifying the confidence level of the bootstrap confidence intervals. Ignored if <code>conf_int=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_n_boot">n_boot</code></td>
<td>

<p>A single integer specifying how many bootstrap repetitions should be performed. Ignored if  <code>conf_int=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_na.action">na.action</code></td>
<td>

<p>How missing values should be handled. Can be one of: <code>na.fail</code>, <code>na.omit</code>, <code>na.pass</code>, <code>na.exclude</code> or a user-defined custom function. Also accepts strings of the function names. See <code>?na.action</code> for more details. By default it uses the na.action which is set in the global options by the respective user.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_horizon">horizon</code></td>
<td>

<p>A numeric vector containing a range of values of <code>variable</code> for which the survival curves should be calculated or <code>NULL</code> (default). If <code>NULL</code>, the horizon is constructed as a sequence from the lowest to the highest value observed in <code>variable</code> with 12 equally spaced steps.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_fixed_t">fixed_t</code></td>
<td>

<p>A numeric vector containing points in time at which the survival probabilities should be calculated or <code>NULL</code> (default). If <code>NULL</code>, the survival probability is estimated at every point in time at which an event occurred.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_max_t">max_t</code></td>
<td>

<p>A number indicating the latest survival time which is to be plotted.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_discrete">discrete</code></td>
<td>

<p>Whether to use a continuous color scale or a discrete one (default). If <code>FALSE</code>, the default <span class="pkg">ggplot2</span> colors are used.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_custom_colors">custom_colors</code></td>
<td>

<p>An optional character vector of colors to use when <code>discrete=FALSE</code>. Ignored if <code>discrete=TRUE</code>, in which case the color gradient can be defined using the <code>start_color</code> and <code>end_color</code> arguments.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_start_color">start_color</code></td>
<td>

<p>The color used for the lowest value in <code>horizon</code>. This and the <code>end_color</code> argument can be used to specify custom continuous color scales used in the plot. For example, if a black and white plot is desired, the user can set <code>start_color="white"</code> and <code>end_color="black"</code>. See <code>?scale_color_gradient</code> for more information.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_end_color">end_color</code></td>
<td>

<p>The color used for the highest value in <code>horizon</code>. See argument <code>start_color</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_size">size</code></td>
<td>

<p>A single number specifying the size of the drawn curves.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_linetype">linetype</code></td>
<td>

<p>A single character string specifying the linetype of the curves.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_alpha">alpha</code></td>
<td>

<p>The transparency level of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_xlab">xlab</code></td>
<td>

<p>A character string used as the x-axis label of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_ylab">ylab</code></td>
<td>

<p>A character string used as the y-axis label of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_title">title</code></td>
<td>

<p>A character string used as the title of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_subtitle">subtitle</code></td>
<td>

<p>A character string used as the subtitle of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_legend.title">legend.title</code></td>
<td>

<p>A character string used as the legend title of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_legend.position">legend.position</code></td>
<td>

<p>Where to put the legend. See <code>?theme</code> for more details.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_gg_theme">gg_theme</code></td>
<td>

<p>A <span class="pkg">ggplot2</span> theme which is applied to the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_facet_args">facet_args</code></td>
<td>

<p>A named list of arguments that are passed to the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code> function call when creating a plot separated by groups. Ignored if <code>group=NULL</code>. Any argument except the <code>facets</code> argument of the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code> function can be used. For example, if the user wants to allow free y-scales, this argument could be set to <code>list(scales="free_y")</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_ci_alpha">ci_alpha</code></td>
<td>

<p>A single number defining the transparency level of the confidence interval bands.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_kaplan_meier">kaplan_meier</code></td>
<td>

<p>Whether to add a standard Kaplan-Meier estimator to the plot or not. If <code>group</code> is defined, the Kaplan-Meier estimator will be stratified by the grouping variable. If <code>cif=TRUE</code> was used, the cumulative incidence will be displayed instead of the survival curve.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_km_size">km_size</code></td>
<td>

<p>The size of the Kaplan-Meier line. Ignored if <code>kaplan_meier=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_km_linetype">km_linetype</code></td>
<td>

<p>The linetype of the Kaplan-Meier line. Ignored if <code>kaplan_meier=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_km_alpha">km_alpha</code></td>
<td>

<p>The transparency level of the Kaplan-Meier line. Ignored if <code>kaplan_meier=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_km_color">km_color</code></td>
<td>

<p>The color of the Kaplan-Meier line. Ignored if <code>kaplan_meier=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_km_ci">km_ci</code></td>
<td>

<p>Whether to draw a confidence interval around the Kaplan-Meier estimates. Ignored if <code>kaplan_meier=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_km_ci_type">km_ci_type</code></td>
<td>

<p>Which type of confidence interval to calculate for the Kaplan-Meier estimates. Corresponds to the <code>conf.type</code> argument in the <code>survfit</code> function. Ignored if <code>kaplan_meier=FALSE</code> or <code>km_ci=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_km_ci_level">km_ci_level</code></td>
<td>

<p>Which confidence level to use for the confidence interval of the Kaplan-Meier estimates. Ignored if <code>kaplan_meier=FALSE</code> or <code>km_ci=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_km_ci_alpha">km_ci_alpha</code></td>
<td>

<p>The transparency level of the confidence interval of the Kaplan-Meier estimates. Ignored if <code>kaplan_meier=FALSE</code> or <code>km_ci=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_lines_+3A_...">...</code></td>
<td>

<p>Further arguments passed to <code><a href="#topic+curve_cont">curve_cont</a></code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>A simple plot of multiple covariate-specific survival curves. Internally, it uses the <code><a href="#topic+curve_cont">curve_cont</a></code> function to calculate the survival curves.
</p>


<h3>Value</h3>

<p>Returns a <code>ggplot2</code> object.
</p>


<h3>Author(s)</h3>

<p>Robin Denz
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(contsurvplot)
library(riskRegression)
library(survival)
library(ggplot2)
library(splines)

# using data from the survival package
data(nafld, package="survival")

# take a random sample to keep example fast
set.seed(42)
nafld1 &lt;- nafld1[sample(nrow(nafld1), 150), ]

# fit cox-model with age
model &lt;- coxph(Surv(futime, status) ~ age, data=nafld1, x=TRUE)

# plot effect of age on survival using defaults
plot_surv_lines(time="futime",
                status="status",
                variable="age",
                data=nafld1,
                model=model)

# plot it only for some specific user-defined values
plot_surv_lines(time="futime",
                status="status",
                variable="age",
                data=nafld1,
                model=model,
                horizon=c(40, 52, 63, 81))

## showing non-linear effects

# fit cox-model with bmi modelled using B-Splines,
# adjusting for age and sex
model2 &lt;- coxph(Surv(futime, status) ~ age + male + bs(bmi, df=3),
                data=nafld1, x=TRUE)

# plot effect of bmi on survival
plot_surv_lines(time="futime",
                status="status",
                variable="bmi",
                data=nafld1,
                model=model2,
                horizon=c(20, 30, 40))
</code></pre>

<hr>
<h2 id='plot_surv_matrix'>
Plot a Discretized Heatmap of the Effect of a Continuous Covariate on a Time-To-Event Outcome
</h2><span id='topic+plot_surv_matrix'></span>

<h3>Description</h3>

<p>Using a previously fit time-to-event model, this function plots a discretized heatmap with the continuous covariate on the y-axis and the time-to-event on the x-axis. This is essentially a discretized version of the <code><a href="#topic+plot_surv_heatmap">plot_surv_heatmap</a></code> plot, which makes it look very similar to a correlation matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_surv_matrix(time, status, variable, group=NULL, data, model,
                 cif=FALSE, na.action=options()$na.action,
                 horizon=NULL, fixed_t=NULL, max_t=Inf,
                 n_col=10, n_row=10,
                 start_color="red", end_color="blue",
                 alpha=1, xlab="Time", ylab=variable,
                 title=NULL, subtitle=NULL,
                 legend.title="S(t)", legend.position="none",
                 gg_theme=ggplot2::theme_bw(),
                 facet_args=list(),
                 panel_border=FALSE, axis_dist=0,
                 border_color="white", border_size=0.5,
                 numbers=TRUE, number_color="white",
                 number_size=3, number_family="sans",
                 number_fontface="plain", number_digits=2,
                 ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_surv_matrix_+3A_time">time</code></td>
<td>

<p>A single character string specifying the time-to-event variable. Needs to be a valid column name of a numeric variable in <code>data</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_status">status</code></td>
<td>

<p>A single character string specifying the status variable, indicating if a person has experienced an event or not. Needs to be a valid column name of a numeric or logical variable in <code>data</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_variable">variable</code></td>
<td>

<p>A single character string specifying the continuous variable of interest, for which the survival curves should be estimated. This variable has to be contained in the <code>data.frame</code> that is supplied to the <code>data</code> argument.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_group">group</code></td>
<td>

<p>An optional single character string specifying a factor variable in <code>data</code>. When used, the plot is created conditional on this factor variable, meaning that a facetted plot is produced with one facet for each level of the factor variable. See <code><a href="#topic+curve_cont">curve_cont</a></code> for a detailed description of the estimation strategy. Set to <code>NULL</code> (default) to use no grouping variable.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_data">data</code></td>
<td>

<p>A <code>data.frame</code> containing all required variables.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_model">model</code></td>
<td>

<p>A model describing the time-to-event process (such as an <code>coxph</code> model). Needs to include <code>variable</code> as an independent variable. It also has to have an associated <code><a href="riskRegression.html#topic+riskRegression">predictRisk</a></code> method. See <code>?predictRisk</code> for more details.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_cif">cif</code></td>
<td>

<p>Whether to plot the cumulative incidence (CIF) instead of the survival probability. If multiple failure types are present, the survival probability cannot be estimated in an unbiased way. This function will always return CIF estimates in that case.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_na.action">na.action</code></td>
<td>

<p>How missing values should be handled. Can be one of: <code>na.fail</code>, <code>na.omit</code>, <code>na.pass</code>, <code>na.exclude</code> or a user-defined custom function. Also accepts strings of the function names. See <code>?na.action</code> for more details. By default it uses the na.action which is set in the global options by the respective user.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_horizon">horizon</code></td>
<td>

<p>A numeric vector containing a range of values of <code>variable</code> for which the survival curves should be calculated or <code>NULL</code> (default). If <code>NULL</code>, the horizon is constructed as a sequence from the lowest to the highest value observed in <code>variable</code> with 100 equally spaced steps. In this function, this needs to be a equally spaced vector.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_fixed_t">fixed_t</code></td>
<td>

<p>A numeric vector containing points in time at which the survival probabilities should be calculated or <code>NULL</code> (default). If <code>NULL</code>, the survival probability is estimated at 100 equally spaced steps from 0 to the maximum observed event time. In this function, this needs to be a equally spaced vector.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_max_t">max_t</code></td>
<td>

<p>A number indicating the latest survival time which is to be plotted.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_n_col">n_col</code></td>
<td>

<p>The number of columns to use in the matrix style heatmap. This parameter only controls how many tiles are shown, not how many are estimated. The amount of estimated probabilities is controlled using the <code>fixed_t</code> and <code>horizon</code> arguments. See details.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_n_row">n_row</code></td>
<td>

<p>The number of rows to use in the matrix style heatmap. See <code>n_col</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_start_color">start_color</code></td>
<td>

<p>The color used for the lowest value in <code>horizon</code>. This and the <code>end_color</code> argument can be used to specify custom continuous color scales used in the plot. For example, if a black and white plot is desired, the user can set <code>start_color="white"</code> and <code>end_color="black"</code>. See <code>?scale_color_gradient</code> for more information. Defaults to <code>"red"</code>, set to <code>NULL</code> to use the default <span class="pkg">ggplot2</span> palette.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_end_color">end_color</code></td>
<td>

<p>The color used for the highest value in <code>horizon</code>. Defaults to <code>"blue"</code>. See argument <code>start_color</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_alpha">alpha</code></td>
<td>

<p>The transparency level of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_xlab">xlab</code></td>
<td>

<p>A character string used as the x-axis label of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_ylab">ylab</code></td>
<td>

<p>A character string used as the y-axis label of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_title">title</code></td>
<td>

<p>A character string used as the title of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_subtitle">subtitle</code></td>
<td>

<p>A character string used as the subtitle of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_legend.title">legend.title</code></td>
<td>

<p>A character string used as the legend title of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_legend.position">legend.position</code></td>
<td>

<p>Where to put the legend. See <code>?theme</code> for more details.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_gg_theme">gg_theme</code></td>
<td>

<p>A <span class="pkg">ggplot2</span> theme which is applied to the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_facet_args">facet_args</code></td>
<td>

<p>A named list of arguments that are passed to the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code> function call when creating a plot separated by groups. Ignored if <code>group=NULL</code>. Any argument except the <code>facets</code> argument of the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code> function can be used. For example, if the user wants to allow free y-scales, this argument could be set to <code>list(scales="free_y")</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_panel_border">panel_border</code></td>
<td>

<p>Whether to draw a border around the heatmap or not. Is set to FALSE by default to mimic standard heatmaps.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_axis_dist">axis_dist</code></td>
<td>

<p>The distance of the axis ticks to the colored heatmap. Is set to 0 by default to mimic standard heatmaps.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_border_color">border_color</code></td>
<td>

<p>The color of the individual rectangles borders. Defaults to <code>"white"</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_border_size">border_size</code></td>
<td>

<p>The size of the individual rectangles borders. Defaults to 0.5.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_numbers">numbers</code></td>
<td>

<p>Whether to put the numbers of the average estimated probabilities into the rectangles or not. Defaults to <code>TRUE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_number_color">number_color</code></td>
<td>

<p>The color of the numbers inside the rectangles. Ignored if <code>numbers=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_number_size">number_size</code></td>
<td>

<p>The size of the numbers inside the rectangles. Ignored if <code>numbers=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_number_family">number_family</code></td>
<td>

<p>The font family of the numbers inside the rectangles. Ignored if <code>numbers=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_number_fontface">number_fontface</code></td>
<td>

<p>The fontface of the numbers inside the rectangles. Ignored if <code>numbers=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_number_digits">number_digits</code></td>
<td>

<p>The amount of digits the numbers inside the rectangles should be rounded to. Ignored if <code>numbers=FALSE</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_matrix_+3A_...">...</code></td>
<td>

<p>Further arguments passed to <code><a href="#topic+curve_cont">curve_cont</a></code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Heatmaps are a great tool to visualize a three dimensional surface in a two-dimensional plot. Continuously changing colors over a single area can, however, be difficult to interpret correctly if the color does not change a lot. This version makes the heatmap easier to understand by discretizing the space into equally spaced rectangles. The survival or failure probability is still estimated at a very fine grid of points in time (controlled using the <code>fixed_t</code> and <code>horizon</code> arguments), but is then aggregated into average probabilities afterwards. The number inside each rectangle then shows the *average* probability inside the region defined by the rectangle. This makes the plot look a lot like a correlation matrix.
</p>
<p>The dimensions of the plot can be controlled using the <code>n_col</code> and <code>n_row</code> arguments. Using high numbers in these parameters makes the plot look more similar to a standard <code><a href="#topic+plot_surv_heatmap">plot_surv_heatmap</a></code> plot. It is recommended to create the <code><a href="#topic+plot_surv_heatmap">plot_surv_heatmap</a></code> plot first to pick appropriate dimensions for the discretized version here.
</p>


<h3>Value</h3>

<p>Returns a <code>ggplot2</code> object.
</p>


<h3>Author(s)</h3>

<p>Robin Denz
</p>


<h3>References</h3>

<p>Robin Denz, Nina Timmesfeld (2023). &quot;Visualizing the (Causal) Effect of a Continuous Variable on a Time-To-Event Outcome&quot;. In: Epidemiology 34.5
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(contsurvplot)
library(riskRegression)
library(survival)
library(ggplot2)
library(splines)

# using data from the survival package
data(nafld, package="survival")

# take a random sample to keep example fast
set.seed(42)
nafld1 &lt;- nafld1[sample(nrow(nafld1), 150), ]

# fit cox-model with age
model &lt;- coxph(Surv(futime, status) ~ age, data=nafld1, x=TRUE)

# plot effect of age on survival using defaults
plot_surv_matrix(time="futime",
                 status="status",
                 variable="age",
                 data=nafld1,
                 model=model)

# plot it only for 60 to 80 year old people
plot_surv_matrix(time="futime",
                 status="status",
                 variable="age",
                 data=nafld1,
                 model=model,
                 horizon=seq(60, 80, 0.5))

## showing non-linear effects

# fit cox-model with bmi modelled using B-Splines,
# adjusting for age and sex
model2 &lt;- coxph(Surv(futime, status) ~ age + male + bs(bmi, df=3),
                data=nafld1, x=TRUE)

# plot effect of bmi on survival using defaults
plot_surv_matrix(time="futime",
                 status="status",
                 variable="bmi",
                 data=nafld1,
                 model=model2)

</code></pre>

<hr>
<h2 id='plot_surv_quantiles'>
Plot Survival Time Quantiles as a Function of a Continuous Variable
</h2><span id='topic+plot_surv_quantiles'></span>

<h3>Description</h3>

<p>Using a previously fit time-to-event model, this function plots one or multiple survival time quantiles (such as the median survival time) as a function of a continuous variable of interest.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_surv_quantiles(time, status, variable, group=NULL,
                    data, model, na.action=options()$na.action,
                    p=0.5, horizon=NULL,
                    size=1, linetype="solid", alpha=1,
                    custom_colors=NULL, single_color=NULL,
                    xlab=variable, ylab="Survival Time Quantile",
                    title=NULL, subtitle=NULL,
                    legend.title=variable, legend.position="right",
                    gg_theme=ggplot2::theme_bw(),
                    facet_args=list(), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_surv_quantiles_+3A_time">time</code></td>
<td>

<p>A single character string specifying the time-to-event variable. Needs to be a valid column name of a numeric variable in <code>data</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_quantiles_+3A_status">status</code></td>
<td>

<p>A single character string specifying the status variable, indicating if a person has experienced an event or not. Needs to be a valid column name of a numeric or logical variable in <code>data</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_quantiles_+3A_variable">variable</code></td>
<td>

<p>A single character string specifying the continuous variable of interest, for which the survival curves should be estimated. This variable has to be contained in the <code>data.frame</code> that is supplied to the <code>data</code> argument.
</p>
</td></tr>
<tr><td><code id="plot_surv_quantiles_+3A_group">group</code></td>
<td>

<p>An optional single character string specifying a factor variable in <code>data</code>. When used, the plot is created conditional on this factor variable, meaning that a facetted plot is produced with one facet for each level of the factor variable. See <code><a href="#topic+curve_cont">curve_cont</a></code> for a detailed description of the estimation strategy. Set to <code>NULL</code> (default) to use no grouping variable.
</p>
</td></tr>
<tr><td><code id="plot_surv_quantiles_+3A_data">data</code></td>
<td>

<p>A <code>data.frame</code> containing all required variables.
</p>
</td></tr>
<tr><td><code id="plot_surv_quantiles_+3A_p">p</code></td>
<td>

<p>A numeric vector containing the survival time quantiles of interest. For example, if the user is interested in plotting only the median survival time <code>p=0.5</code> should be used. When multiple values are supplied, one curve is drawn for each quantile.
</p>
</td></tr>
<tr><td><code id="plot_surv_quantiles_+3A_model">model</code></td>
<td>

<p>A model describing the time-to-event process (such as an <code>coxph</code> model). Needs to include <code>variable</code> as an independent variable. It also has to have an associated <code><a href="riskRegression.html#topic+riskRegression">predictRisk</a></code> method. See <code>?predictRisk</code> for more details.
</p>
</td></tr>
<tr><td><code id="plot_surv_quantiles_+3A_na.action">na.action</code></td>
<td>

<p>How missing values should be handled. Can be one of: <code>na.fail</code>, <code>na.omit</code>, <code>na.pass</code>, <code>na.exclude</code> or a user-defined custom function. Also accepts strings of the function names. See <code>?na.action</code> for more details. By default it uses the na.action which is set in the global options by the respective user.
</p>
</td></tr>
<tr><td><code id="plot_surv_quantiles_+3A_horizon">horizon</code></td>
<td>

<p>A numeric vector containing a range of values of <code>variable</code> for which the survival curves should be calculated or <code>NULL</code> (default). If <code>NULL</code>, the horizon is constructed as a sequence from the lowest to the highest value observed in <code>variable</code> with 100 equally spaced steps.
</p>
</td></tr>
<tr><td><code id="plot_surv_quantiles_+3A_size">size</code></td>
<td>

<p>A single number specifying how thick the lines should be drawn.
</p>
</td></tr>
<tr><td><code id="plot_surv_quantiles_+3A_linetype">linetype</code></td>
<td>

<p>The linetype of the drawn lines. See documentation of <span class="pkg">ggplot2</span> for more details on allowed values.
</p>
</td></tr>
<tr><td><code id="plot_surv_quantiles_+3A_alpha">alpha</code></td>
<td>

<p>The transparency level of the lines.
</p>
</td></tr>
<tr><td><code id="plot_surv_quantiles_+3A_custom_colors">custom_colors</code></td>
<td>

<p>An optional character vector specifying the colors that should be used when multiple quantiles were supplied to the <code>p</code> argument. To set the whole plot or a single curve to one color only, use the <code>single_color</code> argument instead.
</p>
</td></tr>
<tr><td><code id="plot_surv_quantiles_+3A_single_color">single_color</code></td>
<td>

<p>A single character string specifying the color of all drawn lines.
</p>
</td></tr>
<tr><td><code id="plot_surv_quantiles_+3A_xlab">xlab</code></td>
<td>

<p>A character string used as the x-axis label of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_quantiles_+3A_ylab">ylab</code></td>
<td>

<p>A character string used as the y-axis label of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_quantiles_+3A_title">title</code></td>
<td>

<p>A character string used as the title of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_quantiles_+3A_subtitle">subtitle</code></td>
<td>

<p>A character string used as the subtitle of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_quantiles_+3A_legend.title">legend.title</code></td>
<td>

<p>A character string used as the legend title of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_quantiles_+3A_legend.position">legend.position</code></td>
<td>

<p>Where to put the legend. See <code>?theme</code> for more details.
</p>
</td></tr>
<tr><td><code id="plot_surv_quantiles_+3A_gg_theme">gg_theme</code></td>
<td>

<p>A <span class="pkg">ggplot2</span> theme which is applied to the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_quantiles_+3A_facet_args">facet_args</code></td>
<td>

<p>A named list of arguments that are passed to the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code> function call when creating a plot separated by groups. Ignored if <code>group=NULL</code>. Any argument except the <code>facets</code> argument of the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code> function can be used. For example, if the user wants to allow free y-scales, this argument could be set to <code>list(scales="free_y")</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_quantiles_+3A_...">...</code></td>
<td>

<p>Further arguments passed to <code><a href="#topic+curve_cont">curve_cont</a></code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Survival Time Quantiles are a single value summarizing the entire survival curve. For example, the most prominently used survival time quantile is the median survival time, which can be interpreted as the time at which half of the people in the sample are expected to have experienced the event of interest. This plot shows one or more of these quantiles as a function of a continuous variable of interest.
</p>
<p>To calculate the survival time quantiles, it first calls the <code>curve_cont</code> function to get estimates of the value-specific survival curves. Afterwards, it uses step function interpolation to read off the survival time quantile from the estimates.
</p>
<p>Although this is a simple way to plot the effect of a continuous covariate on the survival, it can give a misleading visualization of the relationship in some situations. Plots that do not use summary statistics, such as the <code><a href="#topic+plot_surv_contour">plot_surv_contour</a></code> and <code><a href="#topic+plot_surv_area">plot_surv_area</a></code> plots, may be preferable.
</p>


<h3>Value</h3>

<p>Returns a <code>ggplot2</code> object.
</p>


<h3>Author(s)</h3>

<p>Robin Denz
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(contsurvplot)
library(riskRegression)
library(survival)
library(ggplot2)
library(splines)

# using data from the survival package
data(nafld, package="survival")

# take a random sample to keep example fast
set.seed(42)
nafld1 &lt;- nafld1[sample(nrow(nafld1), 150), ]

# fit cox-model with age
model &lt;- coxph(Surv(futime, status) ~ age, data=nafld1, x=TRUE)

# plot effect of age on the median survival time
plot_surv_quantiles(time="futime",
                    status="status",
                    variable="age",
                    data=nafld1,
                    model=model)

# plot multiple survival time quantiles
plot_surv_quantiles(time="futime",
                    status="status",
                    variable="age",
                    data=nafld1,
                    model=model,
                    p=c(0.1, 0.25, 0.5, 0.75, 0.9))

## showing non-linear effects

# fit cox-model with bmi modelled using B-Splines,
# adjusting for age and sex
model2 &lt;- coxph(Surv(futime, status) ~ age + male + bs(bmi, df=3),
                data=nafld1, x=TRUE)

# plot effect of bmi on survival
plot_surv_quantiles(time="futime",
                    status="status",
                    variable="bmi",
                    data=nafld1,
                    model=model2,
                    p=c(0.1, 0.25, 0.5, 0.75, 0.9))
</code></pre>

<hr>
<h2 id='plot_surv_rmst'>
Plot the Effect of a Continuous Variable on the Restricted Mean Survival Time
</h2><span id='topic+plot_surv_rmst'></span>

<h3>Description</h3>

<p>Using a previously fit time-to-event model, this function plots the restricted mean survival time (RMST) as a function of a continuous variable.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_surv_rmst(time, status, variable, group=NULL,
               data, model, na.action=options()$na.action,
               tau, horizon=NULL, custom_colors=NULL,
               size=1, linetype="solid", alpha=1, color="black",
               xlab=variable, ylab="Restricted Mean Survival Time",
               title=NULL, subtitle=NULL,
               legend.title=variable, legend.position="right",
               gg_theme=ggplot2::theme_bw(),
               facet_args=list(), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_surv_rmst_+3A_time">time</code></td>
<td>

<p>A single character string specifying the time-to-event variable. Needs to be a valid column name of a variable in <code>data</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmst_+3A_status">status</code></td>
<td>

<p>A single character string specifying the status variable, indicating if a person has experienced an event or not. Needs to be a valid column name of a variable in <code>data</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmst_+3A_variable">variable</code></td>
<td>

<p>A single character string specifying the continuous variable of interest, for which the survival curves should be estimated. This variable has to be contained in the <code>data.frame</code> that is supplied to the <code>data</code> argument.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmst_+3A_group">group</code></td>
<td>

<p>An optional single character string specifying a factor variable in <code>data</code>. When used, the plot is created conditional on this factor variable, meaning that a facetted plot is produced with one facet for each level of the factor variable. See <code><a href="#topic+curve_cont">curve_cont</a></code> for a detailed description of the estimation strategy. Set to <code>NULL</code> (default) to use no grouping variable.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmst_+3A_data">data</code></td>
<td>

<p>A <code>data.frame</code> containing all required variables.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmst_+3A_model">model</code></td>
<td>

<p>A model describing the time-to-event process (such as an <code>coxph</code> model). Needs to include <code>variable</code> as an independent variable. It also has to have an associated <code><a href="riskRegression.html#topic+riskRegression">predictRisk</a></code> method. See <code>?predictRisk</code> for more details.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmst_+3A_na.action">na.action</code></td>
<td>

<p>How missing values should be handled. Can be one of: <code>na.fail</code>, <code>na.omit</code>, <code>na.pass</code>, <code>na.exclude</code> or a user-defined custom function. Also accepts strings of the function names. See <code>?na.action</code> for more details. By default it uses the na.action which is set in the global options by the respective user.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmst_+3A_tau">tau</code></td>
<td>

<p>The point in time to which the RMST should be calculated. Can be a vector of numbers. If multiple values are supplied, one curve is drawn for each of them.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmst_+3A_horizon">horizon</code></td>
<td>

<p>A numeric vector containing a range of values of <code>variable</code> for which the survival curves should be calculated or <code>NULL</code> (default). If <code>NULL</code>, the horizon is constructed as a sequence from the lowest to the highest value observed in <code>variable</code> with 100 equally spaced steps.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmst_+3A_custom_colors">custom_colors</code></td>
<td>

<p>An optional character vector of colors to use when there are multiple values in <code>tau</code>. Ignored if <code>length(tau)==1</code>, in which case the <code>color</code> argument can be used to specify the color of the single line.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmst_+3A_size">size</code></td>
<td>

<p>A single number specifying how thick the lines should be drawn.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmst_+3A_linetype">linetype</code></td>
<td>

<p>The linetype of the drawn lines. See documentation of <span class="pkg">ggplot2</span> for more details on allowed values.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmst_+3A_alpha">alpha</code></td>
<td>

<p>The transparency level of the lines.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmst_+3A_color">color</code></td>
<td>

<p>The color of the curve if <code>tau</code> is a single value. If a numeric vector was supplied to <code>tau</code>, use the <code>custom_colors</code> argument to specify them instead.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmst_+3A_xlab">xlab</code></td>
<td>

<p>A character string used as the x-axis label of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmst_+3A_ylab">ylab</code></td>
<td>

<p>A character string used as the y-axis label of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmst_+3A_title">title</code></td>
<td>

<p>A character string used as the title of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmst_+3A_subtitle">subtitle</code></td>
<td>

<p>A character string used as the subtitle of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmst_+3A_legend.title">legend.title</code></td>
<td>

<p>A character string used as the legend title of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmst_+3A_legend.position">legend.position</code></td>
<td>

<p>Where to put the legend. See <code>?theme</code> for more details.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmst_+3A_gg_theme">gg_theme</code></td>
<td>

<p>A <span class="pkg">ggplot2</span> theme which is applied to the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmst_+3A_facet_args">facet_args</code></td>
<td>

<p>A named list of arguments that are passed to the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code> function call when creating a plot separated by groups. Ignored if <code>group=NULL</code>. Any argument except the <code>facets</code> argument of the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code> function can be used. For example, if the user wants to allow free y-scales, this argument could be set to <code>list(scales="free_y")</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmst_+3A_...">...</code></td>
<td>

<p>Further arguments passed to <code><a href="#topic+curve_cont">curve_cont</a></code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Similar to the <code><a href="#topic+plot_surv_at_t">plot_surv_at_t</a></code> and <code><a href="#topic+plot_surv_quantiles">plot_surv_quantiles</a></code> plots, this function produces a plot of a survival curve summary statistic as a function of a continuous variable. The summary statistic in question is the restricted mean survival time (RMST), which is the area under a survival curve up to a specific point in time <code>tau</code>. It can be interpreted as the mean survival time of the population up to <code>tau</code>.
</p>
<p>First, a range of value-specific survival curves are estimated. The RMST is then calculated for each one using step function interpolation. This only works for survival curves, not for CIFs. If the area under the CIF should be used instead, the <code><a href="#topic+plot_surv_rmtl">plot_surv_rmtl</a></code> function can be used.
</p>
<p>An advantage of this method over the <code><a href="#topic+plot_surv_at_t">plot_surv_at_t</a></code> and <code><a href="#topic+plot_surv_quantiles">plot_surv_quantiles</a></code> function is, that it does take the whole survival curve into account, kind of. Although it is the area under it, it is only calculated up to <code>tau</code> which makes the output dependent on the choice of <code>tau</code>. This, again, can result in deceiving plots in some cases. Plots visualizing the entire survival curves such as <code><a href="#topic+plot_surv_contour">plot_surv_contour</a></code> and <code><a href="#topic+plot_surv_area">plot_surv_area</a></code> might be preferable.
</p>


<h3>Value</h3>

<p>Returns a <code>ggplot2</code> object.
</p>


<h3>Author(s)</h3>

<p>Robin Denz
</p>


<h3>References</h3>

<p>Eng, K. H.; Schiller, E. &amp; Morrell, K. On Representing the Prognostic Value of Continuous Gene Expression Biomarkers with the Restricted Mean Survival Curve. In: Oncotarget, 2015, 6, 36308-36318
</p>
<p>Robin Denz, Nina Timmesfeld (2023). &quot;Visualizing the (Causal) Effect of a Continuous Variable on a Time-To-Event Outcome&quot;. In: Epidemiology 34.5
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(contsurvplot)
library(riskRegression)
library(survival)
library(ggplot2)
library(splines)

# using data from the survival package
data(nafld, package="survival")

# take a random sample to keep example fast
set.seed(42)
nafld1 &lt;- nafld1[sample(nrow(nafld1), 150), ]

# fit cox-model with age
model &lt;- coxph(Surv(futime, status) ~ age, data=nafld1, x=TRUE)

# plot effect of age on the RMST for ages 50 to 80
plot_surv_rmst(time="futime",
               status="status",
               variable="age",
               data=nafld1,
               model=model,
               horizon=seq(50, 80, 1),
               tau=2500)

# plot RMST for multiple tau values for ages 50 to 80
plot_surv_rmst(time="futime",
               status="status",
               variable="age",
               data=nafld1,
               model=model,
               horizon=seq(50, 80, 1),
               tau=c(2000, 3000, 5000))

## showing non-linear effects

# fit cox-model with bmi modeled using B-Splines,
# adjusting for age and sex
model2 &lt;- coxph(Surv(futime, status) ~ age + male + bs(bmi, df=3),
                data=nafld1, x=TRUE)

# plot effect of bmi on survival
plot_surv_rmst(time="futime",
               status="status",
               variable="bmi",
               data=nafld1,
               model=model2,
               tau=c(2000, 3000, 5000))
</code></pre>

<hr>
<h2 id='plot_surv_rmtl'>
Plot the Effect of a Continuous Variable on the Restricted Mean Time Lost
</h2><span id='topic+plot_surv_rmtl'></span>

<h3>Description</h3>

<p>Using a previously fit time-to-event model, this function plots the restricted mean time lost (RMTL) as a function of a continuous variable. Unlike the <code><a href="#topic+plot_surv_rmst">plot_surv_rmst</a></code> function, this function can deal with multiple event types in the <code>status</code> variable.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_surv_rmtl(time, status, variable, group=NULL,
               data, model, na.action=options()$na.action,
               tau, horizon=NULL, custom_colors=NULL,
               size=1, linetype="solid", alpha=1, color="black",
               xlab=variable, ylab="Restricted Mean Time Lost",
               title=NULL, subtitle=NULL,
               legend.title=variable, legend.position="right",
               gg_theme=ggplot2::theme_bw(),
               facet_args=list(), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot_surv_rmtl_+3A_time">time</code></td>
<td>

<p>A single character string specifying the time-to-event variable. Needs to be a valid column name of a variable in <code>data</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmtl_+3A_status">status</code></td>
<td>

<p>A single character string specifying the status variable, indicating if a person has experienced an event or not. Needs to be a valid column name of a variable in <code>data</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmtl_+3A_variable">variable</code></td>
<td>

<p>A single character string specifying the continuous variable of interest, for which the CIFs should be estimated. This variable has to be contained in the <code>data.frame</code> that is supplied to the <code>data</code> argument.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmtl_+3A_group">group</code></td>
<td>

<p>An optional single character string specifying a factor variable in <code>data</code>. When used, the plot is created conditional on this factor variable, meaning that a facetted plot is produced with one facet for each level of the factor variable. See <code><a href="#topic+curve_cont">curve_cont</a></code> for a detailed description of the estimation strategy. Set to <code>NULL</code> (default) to use no grouping variable.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmtl_+3A_data">data</code></td>
<td>

<p>A <code>data.frame</code> containing all required variables.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmtl_+3A_model">model</code></td>
<td>

<p>A model describing the time-to-event process (such as an <code>coxph</code> model). Needs to include <code>variable</code> as an independent variable. It also has to have an associated <code><a href="riskRegression.html#topic+riskRegression">predictRisk</a></code> method. See <code>?predictRisk</code> for more details.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmtl_+3A_na.action">na.action</code></td>
<td>

<p>How missing values should be handled. Can be one of: <code>na.fail</code>, <code>na.omit</code>, <code>na.pass</code>, <code>na.exclude</code> or a user-defined custom function. Also accepts strings of the function names. See <code>?na.action</code> for more details. By default it uses the na.action which is set in the global options by the respective user.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmtl_+3A_tau">tau</code></td>
<td>

<p>The point in time to which the RMTL should be calculated. Can be a vector of numbers. If multiple values are supplied, one curve is drawn for each of them.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmtl_+3A_horizon">horizon</code></td>
<td>

<p>A numeric vector containing a range of values of <code>variable</code> for which the CIFs should be calculated or <code>NULL</code> (default). If <code>NULL</code>, the horizon is constructed as a sequence from the lowest to the highest value observed in <code>variable</code> with 100 equally spaced steps.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmtl_+3A_custom_colors">custom_colors</code></td>
<td>

<p>An optional character vector of colors to use when there are multiple values in <code>tau</code>. Ignored if <code>length(tau)==1</code>, in which case the <code>color</code> argument can be used to specify the color of the single line.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmtl_+3A_size">size</code></td>
<td>

<p>A single number specifying how thick the lines should be drawn.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmtl_+3A_linetype">linetype</code></td>
<td>

<p>The linetype of the drawn lines. See documentation of <span class="pkg">ggplot2</span> for more details on allowed values.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmtl_+3A_alpha">alpha</code></td>
<td>

<p>The transparency level of the lines.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmtl_+3A_color">color</code></td>
<td>

<p>The color of the curve if <code>tau</code> is a single value. If a numeric vector was supplied to <code>tau</code>, use the <code>custom_colors</code> argument to specify them instead.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmtl_+3A_xlab">xlab</code></td>
<td>

<p>A character string used as the x-axis label of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmtl_+3A_ylab">ylab</code></td>
<td>

<p>A character string used as the y-axis label of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmtl_+3A_title">title</code></td>
<td>

<p>A character string used as the title of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmtl_+3A_subtitle">subtitle</code></td>
<td>

<p>A character string used as the subtitle of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmtl_+3A_legend.title">legend.title</code></td>
<td>

<p>A character string used as the legend title of the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmtl_+3A_legend.position">legend.position</code></td>
<td>

<p>Where to put the legend. See <code>?theme</code> for more details.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmtl_+3A_gg_theme">gg_theme</code></td>
<td>

<p>A <span class="pkg">ggplot2</span> theme which is applied to the plot.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmtl_+3A_facet_args">facet_args</code></td>
<td>

<p>A named list of arguments that are passed to the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code> function call when creating a plot separated by groups. Ignored if <code>group=NULL</code>. Any argument except the <code>facets</code> argument of the <code><a href="ggplot2.html#topic+facet_wrap">facet_wrap</a></code> function can be used. For example, if the user wants to allow free y-scales, this argument could be set to <code>list(scales="free_y")</code>.
</p>
</td></tr>
<tr><td><code id="plot_surv_rmtl_+3A_...">...</code></td>
<td>

<p>Further arguments passed to <code><a href="#topic+curve_cont">curve_cont</a></code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is essentially equal to the <code><a href="#topic+plot_surv_rmtl">plot_surv_rmtl</a></code> function. The only difference is that instead of using the restricted mean survival time (RMST), which is the area under the survival curve up to a specific point in time <code>tau</code>, this function uses the restricted mean time lost (RMTL), which is the area under the (cause-specific) CIF up to a specific point in time <code>tau</code>. It can be interpreted as the mean time it takes an individual to succumb to the event of interest before <code>tau</code>.
</p>
<p>The reason this is split into two functions is, that the RMTL can be calculated when mutually exclusive competing events are present, while the RMST cannot. The basic pros and cons of the <code><a href="#topic+plot_surv_rmst">plot_surv_rmst</a></code> function still apply here, however. For more information we suggest consulting the documentation page of the <code><a href="#topic+plot_surv_rmst">plot_surv_rmst</a></code> function.
</p>


<h3>Value</h3>

<p>Returns a <code>ggplot2</code> object.
</p>


<h3>Author(s)</h3>

<p>Robin Denz
</p>


<h3>References</h3>

<p>Eng, K. H.; Schiller, E. &amp; Morrell, K. On Representing the Prognostic Value of Continuous Gene Expression Biomarkers with the Restricted Mean Survival Curve. In: Oncotarget, 2015, 6, 36308-36318
</p>
<p>Robin Denz, Nina Timmesfeld (2023). &quot;Visualizing the (Causal) Effect of a Continuous Variable on a Time-To-Event Outcome&quot;. In: Epidemiology 34.5
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(contsurvplot)
library(riskRegression)
library(survival)
library(ggplot2)
library(splines)

# using data from the survival package
data(nafld, package="survival")

# take a random sample to keep example fast
set.seed(42)
nafld1 &lt;- nafld1[sample(nrow(nafld1), 150), ]

# fit cox-model with age
model &lt;- coxph(Surv(futime, status) ~ age, data=nafld1, x=TRUE)

# plot effect of age on the RMST for ages 50 to 80
plot_surv_rmtl(time="futime",
               status="status",
               variable="age",
               data=nafld1,
               model=model,
               horizon=seq(50, 80, 1),
               tau=2500)

# plot RMST for multiple tau values for ages 50 to 80
plot_surv_rmtl(time="futime",
               status="status",
               variable="age",
               data=nafld1,
               model=model,
               horizon=seq(50, 80, 1),
               tau=c(2000, 3000, 5000))

## showing non-linear effects

# fit cox-model with bmi modeled using B-Splines,
# adjusting for age and sex
model2 &lt;- coxph(Surv(futime, status) ~ age + male + bs(bmi, df=3),
                data=nafld1, x=TRUE)

# plot effect of bmi on survival
plot_surv_rmtl(time="futime",
               status="status",
               variable="bmi",
               data=nafld1,
               model=model2,
               tau=c(2000, 3000, 5000))
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
