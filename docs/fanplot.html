<!DOCTYPE html><html><head><title>Help for package fanplot</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {fanplot}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#boe'>
<p>Parameters for MPC CPI Inflation Projections from Q1 2004 to Q4 2013.</p></a></li>
<li><a href='#cpi'>
<p>Percentage Change (over 12 months) of United Kingdom Consumer Price Inflation</p></a></li>
<li><a href='#dsplitnorm'>
<p>The Split Normal Distribution (or 2 Piece Normal Distribution).</p></a></li>
<li><a href='#fan'>
<p>Fan Plot of Distributions Percentiles Over Time.</p></a></li>
<li><a href='#fanplot-package'>
<p>Visualisation of Sequential Probability Distributions Using Fan Charts.</p></a></li>
<li><a href='#ips'>
<p>ONS International Passenger Survey Long-Term International Migration 1975-2012</p></a></li>
<li><a href='#svpdx'>
<p>Pound-Dollar Exchange Rate Data</p></a></li>
<li><a href='#th.mcmc'>
<p>1000 MCMC Simulations of Estimated Volatility from Pound Dollar Exchange Rate Data.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Visualisation of Sequential Probability Distributions Using Fan
Charts</td>
</tr>
<tr>
<td>Version:</td>
<td>4.0.0</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Guy J. Abel &lt;g.j.abel@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>Visualise sequential distributions using a range of plotting
    styles. Sequential distribution data can be input as either simulations or
    values corresponding to percentiles over time. Plots are added to
    existing graphic devices using the fan function. Users can choose from four
    different styles, including fan chart type plots, where a set of coloured
    polygon, with shadings corresponding to the percentile values are layered
    to represent different uncertainty levels. Full details in R Journal article; Abel (2015) &lt;<a href="https://doi.org/10.32614%2FRJ-2015-002">doi:10.32614/RJ-2015-002</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="http://guyabel.github.io/fanplot/">http://guyabel.github.io/fanplot/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/guyabel/fanplot/issues/">https://github.com/guyabel/fanplot/issues/</a></td>
</tr>
<tr>
<td>Imports:</td>
<td>methods</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>Suggests:</td>
<td>shiny</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2021-08-02 08:56:42 UTC; Guy</td>
</tr>
<tr>
<td>Author:</td>
<td>Guy J. Abel <a href="https://orcid.org/0000-0002-4893-5687"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cre]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2021-08-02 09:20:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='boe'>
Parameters for MPC CPI Inflation Projections from Q1 2004 to Q4 2013.
</h2><span id='topic+boe'></span>

<h3>Description</h3>

<p>Numerical parameters for inflation report of the Bank of England used to specify the probability distributions for forecast charts of CPI inflation. Data formatted from the November 2013 Bank of England Inflation Report.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(boe)</code></pre>


<h3>Format</h3>

<p>A data frame with 512 observations on the following 5 variables.
</p>

<dl>
<dt><code>time0</code></dt><dd><p>Publication time of parameters</p>
</dd>
<dt><code>time</code></dt><dd><p>Future time of projected parameter</p>
</dd>
<dt><code>mode</code></dt><dd><p>Central location parameter of split-normal distribution</p>
</dd>
<dt><code>uncertainty</code></dt><dd><p>Uncertainty parameter of split-normal distribution</p>
</dd>
<dt><code>skew</code></dt><dd><p>Skew parameter of split-normal distribution</p>
</dd>
</dl>



<h3>Details</h3>

<p>mode, uncertainty and skew parameters relate to those given in <code><a href="#topic+dsplitnorm">dsplitnorm</a></code>, where uncertainty is the standard deviation.
</p>


<h3>Source</h3>

<p>Bank of England Inflation Report November 2013. Retrieved from &quot;Parameters for MPC CPI Inflation Projections from February 2004&quot; spreadsheet at:
</p>
<p>Can not find copy of speadheet on the Bank of England website anymore, but there is a copy at <a href="https://github.com/guyabel/fanplot/tree/master/data-raw/">https://github.com/guyabel/fanplot/tree/master/data-raw/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##
##Q1 2013
##
#extract data for Q1 2013
y0 &lt;- 2013
boe0&lt;-subset(boe, time0==y0)
k &lt;- nrow(boe0)

#guess work to set percentiles the boe are plotting
p &lt;- seq(0.05, 0.95, 0.05)
p &lt;- c(0.01, p, 0.99)

#estimate percentiles for future time period
pp &lt;- matrix(NA, nrow = length(p), ncol = k)
for (i in 1:k)
  pp[, i] &lt;- qsplitnorm(p, mode = boe0$mode[i], sd = boe0$uncertainty[i], skew = boe0$skew[i])
pp

#plot cpi
par(mar=rep(2,4))
plot(cpi, type = "l", xlim = floor(c(y0-5, y0+3)), ylim = c(-2, 7), las = 1, 
 col="tomato", lwd=2, xaxt = "n", yaxt = "n")

#backround
rect(y0-0.25, par("usr")[3] - 1, y0+3, par("usr")[4] + 1, border = "gray90", col = "gray90")

#fan
pal &lt;- colorRampPalette(c("tomato", "gray90"))
fan(data=pp, probs=p, sim.data=FALSE, start=y0, frequency=4, 
 anchor=cpi[time(cpi)==y0-0.25], fan.col=pal, ln=NULL, rlab=FALSE)

#aesthetics for boe axis
axis(2, at = -2:7, las = 2, tcl = 0.5, labels = FALSE)
axis(4, at = -2:7, las = 2, tcl = 0.5)
axis(1, at = 2008:2016, tcl = 0.5)
axis(1, at = seq(2008, 2016, 0.25), labels = FALSE, tcl = 0.2)
abline(h = 2) #cpi target
abline(v = y0 + 1.75, lty = 2) #2 year line


##
##Q4 2013 (coarser fan)
##
#extract data for Q4 2013
y0 &lt;- 2013.75
boe0&lt;-subset(boe, time0==y0)
k &lt;- nrow(boe0)

#guess work at which percentiles the boe are plotting
p &lt;- seq(0.2, 0.8, 0.2)
p &lt;- c(0.05, p, 0.95)
pp &lt;- matrix(NA, nrow = length(p), ncol = k)
for (i in 1:k)
  pp[, i] &lt;- qsplitnorm(p, mode = boe0$mode[i], sd = boe0$uncertainty[i], skew = boe0$skew[i])
pp

#define prediction intervals for labels
p.int&lt;-p[4:6]-p[3:1]
p.int

#plot cpi
par(mar=rep(2,4))
plot(cpi, type = "l", xlim = c(y0-5, y0+3), ylim = c(-2, 7), las = 1, 
 col="tomato", lwd=2, xaxt = "n", yaxt = "n")

#backround
rect(y0-0.25, par("usr")[3] - 1, y0+3, par("usr")[4] + 1, border = "gray90", col = "gray90")

# add fan
pal &lt;- colorRampPalette(c("tomato", "gray90"))
fan(data=pp, probs=p.int, sim.data=FALSE, start=y0, frequency=4,
 anchor=cpi[time(cpi)==y0-0.25], fan.col=pal, ln=NULL, rlab=pi, nfan=4, type="interval")

#aesthetics for boe axis
axis(2, at = -2:7, las = 2, tcl = 0.5, labels = FALSE)
axis(4, at = -2:7, las = 2, tcl = 0.5)
axis(1, at = 2008:2016, tcl = 0.5)
axis(1, at = seq(2008, 2016, 0.25), labels = FALSE, tcl = 0.2)
abline(h = 2) #cpi target
abline(v = y0 + 1.75, lty = 2) #2 year line
</code></pre>

<hr>
<h2 id='cpi'>
Percentage Change (over 12 months) of United Kingdom Consumer Price Inflation
</h2><span id='topic+cpi'></span>

<h3>Description</h3>

<p>Time series of quarterly UK CPI from Q1 1997 to Q3 2013. Data formatted from the October 2013 release of the CPI data by the Office of National Statistics. Q1 are taken from February values, Q2 from May, Q3 from August and Q4 from November.  
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(cpi)</code></pre>


<h3>Format</h3>

<p>The format is:
Time-Series [1:67] from 1997 to 2014: 88.8 89.6 90 90.4 90.3 91.5 91.2 91.7 91.5 92.7 ...
</p>


<h3>Source</h3>

<p>October 2013 CPI data by the Office of National Statistics. Retrieved from &quot;Consumer Price Inflation Reference Tables, October 2013&quot; 
</p>
<p>Can not find copy of speadsheet on ONS website anymore, but there is a copy at <a href="https://github.com/guyabel/fanplot/tree/master/data-raw/">https://github.com/guyabel/fanplot/tree/master/data-raw/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(cpi)
</code></pre>

<hr>
<h2 id='dsplitnorm'>
The Split Normal Distribution (or 2 Piece Normal Distribution).
</h2><span id='topic+dsplitnorm'></span><span id='topic+psplitnorm'></span><span id='topic+qsplitnorm'></span><span id='topic+rsplitnorm'></span>

<h3>Description</h3>

<p>Density, distribution function, quantile function and random generation for the split normal distribution with mode equal to <code>mode</code>, uncertainty indicator equal to <code>sd</code> and inverse skewness equal to <code>skew</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dsplitnorm(x, mode = 0, sd = 1, skew = 0, sd1 = NULL, sd2 = NULL)
psplitnorm(x, mode = 0, sd = 1, skew = 0, sd1 = NULL, sd2 = NULL)
qsplitnorm(p, mode = 0, sd = 1, skew = 0, sd1 = NULL, sd2 = NULL)
rsplitnorm(n, mode = 0, sd = 1, skew = 0, sd1 = NULL, sd2 = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dsplitnorm_+3A_x">x</code></td>
<td>

<p>Vector of quantiles.
</p>
</td></tr>
<tr><td><code id="dsplitnorm_+3A_p">p</code></td>
<td>

<p>Vector of probabilities
</p>
</td></tr>
<tr><td><code id="dsplitnorm_+3A_n">n</code></td>
<td>

<p>Number of observations required.
</p>
</td></tr>
<tr><td><code id="dsplitnorm_+3A_mode">mode</code></td>
<td>

<p>Vector of modes.
</p>
</td></tr>
<tr><td><code id="dsplitnorm_+3A_sd">sd</code></td>
<td>

<p>Vector of uncertainty indicators.
</p>
</td></tr>
<tr><td><code id="dsplitnorm_+3A_skew">skew</code></td>
<td>

<p>Vector of inverse skewnewss indicators. Must range between -1 and 1
</p>
</td></tr>
<tr><td><code id="dsplitnorm_+3A_sd1">sd1</code></td>
<td>

<p>Vector of standard deviations for left hand side. <code>NULL</code> by default.
</p>
</td></tr>
<tr><td><code id="dsplitnorm_+3A_sd2">sd2</code></td>
<td>

<p>Vector of standard deviations for right hand side. <code>NULL</code> by default.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If <code>mode</code>, <code>sd</code> or <code>skew</code> are not specified they assume the default values of 0, 1 and 1, respectively. This results in identical values as a those obtained from a normal distribution.
</p>
<p>The probability density function is:
</p>
<p style="text-align: center;"><code class="reqn"> f(x; \mu, \sigma_1, \sigma_2) = \frac{\sqrt 2}{\sqrt\pi (\sigma_1+\sigma_2)} e^{-\frac{1}{2\sigma_1^2}(x-\mu)^2}</code>
</p>

<p>for -<code>Inf</code><code class="reqn">&lt; x &lt; \mu</code>, and
</p>
<p style="text-align: center;"><code class="reqn"> f(x; \mu, \sigma_1, \sigma_2) = \frac{\sqrt 2}{\sqrt\pi (\sigma_1+\sigma_2)} e^{-\frac{1}{2\sigma_2^2}(x-\mu)^2}</code>
</p>

<p>for <code class="reqn">\mu &lt; x &lt;</code><code>Inf</code>, where, if not specified (in <code>sd1</code> and <code>sd2</code>) <code class="reqn">\sigma_1</code> and <code class="reqn">\sigma_2</code> are derived as 
</p>
<p style="text-align: center;"><code class="reqn">\sigma_1=\sigma/\sqrt(1-\gamma)</code>
</p>

<p style="text-align: center;"><code class="reqn">\sigma_2=\sigma/\sqrt(1+\gamma)</code>
</p>

<p>from <code class="reqn">\sigma_1</code> is the overall uncertainty indicator <code>sd</code> and <code class="reqn">\gamma</code> is the inverse skewness indicator <code>skew</code>.
</p>


<h3>Value</h3>

<p><code>dsplitnorm</code> gives the density, <code>psplitnorm</code> gives the distribution function, <code>qsplitnorm</code> gives the quantile function, and <code>rsplitnorm</code> generates random deviates.
</p>
<p>The length of the result is determined by <code>n</code> for <code>rsplitnorm</code>, and is the maximum of the lengths of the numerical parameters for the other functions.
</p>
<p>The numerical parameters other than <code>n</code> are recycled to the length of the result. 
</p>


<h3>Note</h3>

<p>Tested against the fan chart package in MATLAB (http://www.mathworks.de/matlabcentral/fileexchange/27702-fan-chart). Obtained the same results for a set of simple comparisons.
</p>


<h3>Author(s)</h3>

<p>Guy J. Abel
</p>


<h3>References</h3>

<p>Source for all functions based on:
</p>
<p>Julio, J. M. (2007). The Fan Chart: The Technical Details Of The New Implementation. Bogota, Colombia. Retrieved from http://www.banrep.gov.co/docum/ftp/borra468.pdf
</p>


<h3>Examples</h3>

<pre><code class='language-R'>x&lt;-seq(-5,5,length=110)
plot(x,dsplitnorm(x),type="l")

#compare to normal density
lines(x,dnorm(x), lty=2, col="red", lwd=5)

#add positive skew
lines(x,dsplitnorm(x, mode=0, sd=1, skew=0.8))

#add negative skew
lines(x,dsplitnorm(x, mode=0, sd=1, skew=-0.5))

#add left and right hand sd
lines(x,dsplitnorm(x, mode=0, sd1=1, sd2=2), col="blue")

#psplitnorm
x&lt;-seq(-5,5,length=100)
plot(x,pnorm(x),type="l")
lines(x, psplitnorm(x, skew=-0.9), col="red")

#qsplitnorm
x&lt;-seq(0,1,length=100)
plot(qnorm(x),type="l",x)
lines(qsplitnorm(x), x, lty=2, col="blue")
lines(qsplitnorm(x, skew=-0.3), x, col="red")

#rsplitnorm
hist(rsplitnorm(n=10000, mode=1, sd=1, skew=0.9),100)
</code></pre>

<hr>
<h2 id='fan'>
Fan Plot of Distributions Percentiles Over Time.
</h2><span id='topic+fan'></span><span id='topic+fan0'></span>

<h3>Description</h3>

<p>Visualise sequential distributions using a range of plotting styles.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fan(data = NULL, data.type="simulations", style = "fan", type = "percentile",
  probs = if(type=="percentile") seq(0.01, 0.99, 0.01) else c(0.5, 0.8, 0.95), 
  start = 1, frequency = 1, anchor = NULL, anchor.time=NULL,
  fan.col = heat.colors, alpha = if (style == "spaghetti") 0.5 else 1, 
  n.fan = NULL,
  ln = if(length(probs)&lt;10) probs else 
    probs[round(probs,2) %in% round(seq(0.1, 0.9, 0.1),2)],
  ln.col = if(style=="spaghetti") "gray" else NULL, 
  med.ln = if(type=="interval") TRUE else FALSE, 
  med.col= "orange",
  rlab = ln, rpos = 4, roffset = 0.1, rcex = 0.8, rcol = NULL, 
  llab = FALSE, lpos = 2, loffset = roffset, lcex = rcex, lcol = rcol, 
  upplab = "U", lowlab = "L", medlab=if(type == "interval") "M" else NULL,
  n.spag = 30, 
  space = if(style=="boxplot") 1/frequency else 0.9/frequency, 
  add = FALSE, ylim = range(data)*0.8, ...)
fan0(data = NULL, data.type = "simulations", style = "fan", type = "percentile",
  probs = if(type=="percentile") seq(0.01, 0.99, 0.01) else c(0.5, 0.8, 0.95), 
  start = 1, frequency = 1, anchor = NULL, anchor.time=NULL,
  fan.col = heat.colors, alpha = if (style == "spaghetti") 0.5 else 1, 
  n.fan = NULL,
  ln = NULL,
  ln.col = if(style=="spaghetti") "gray" else NULL, 
  med.ln = if(type=="interval") TRUE else FALSE, 
  med.col= "orange",
  rlab = ln, rpos = 4, roffset = 0.1, rcex = 0.8, rcol = NULL, 
  llab = FALSE, lpos = 2, loffset = roffset, lcex = rcex, lcol = rcol, 
  upplab = "U", lowlab = "L", medlab=if(type == "interval") "M" else NULL,
  n.spag = 30, 
  space = if(style=="boxplot") 1/frequency else 0.9/frequency, 
  add = TRUE, ylim = range(data)*0.8, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fan_+3A_data">data</code></td>
<td>

<p>Set of sequential simulation data, where rows represent simulation number and columns represent some form of time index. 
If <code>data.type = "values"</code>, data must instead be a set of quantile values by rows for a set of probabilities (which need to be provided in <code>probs</code> and by column for some form of time index.
</p>
<p>Data can take multiple classes, where the contents are converted to a <code>matrix</code>. If the input is a <code>mts</code> or <code>zoo</code>, the time series properties will be inherted (and <code>start</code> and <code>frequency</code> arguments will be ignored).
</p>
</td></tr>
<tr><td><code id="fan_+3A_data.type">data.type</code></td>
<td>

<p>Indicates if <code>data</code> are sets of pre-calculated values based for defined probabilities <code>data.type = "values"</code> or simulated data <code>data.type = "simulations"</code>. That later is the default.
</p>
</td></tr>
<tr><td><code id="fan_+3A_style">style</code></td>
<td>

<p>Plot style, choose from <code>fan</code> (default), <code>spaghetti</code> <code>boxplot</code> or <code>boxfan</code>. See Examples and Details Sections for further explanation.
</p>
</td></tr>
<tr><td><code id="fan_+3A_type">type</code></td>
<td>

<p>Type of percentiles to plot in <code>fan</code> or <code>boxfan</code>. Choose from, <code>percentile</code> (default) or <code>interval</code>.
</p>
</td></tr>
<tr><td><code id="fan_+3A_probs">probs</code></td>
<td>

<p>Probabilities related to percentiles or prediction intervals to be plotted (dependent on the <code>type</code> function. These values control the number of shades used in the <code>fan</code> or <code>boxfan</code>. These must be between 0 and 100 (inclusive) or 0 and 1. Percentiles greater than 50 (or 0.5), if not given, are automatically calculated as 100-<code>p</code>, to ensure symmetric fan. Values can be non-integers. Default to single percentile values when <code>type="percetinle"</code> and the 50th, 80th and 95th prediction interval when <code>type="interval"</code> is set.
</p>
</td></tr>
<tr><td><code id="fan_+3A_start">start</code></td>
<td>

<p>The time of the first distribution in <code>sims</code>. Similar to use in <code><a href="stats.html#topic+ts">ts</a></code>.
</p>
</td></tr>
<tr><td><code id="fan_+3A_frequency">frequency</code></td>
<td>

<p>The number of distribution in <code>sims</code> per unit of time in <code>sims</code>. Similar to use in <code><a href="stats.html#topic+ts">ts</a></code>.
</p>
</td></tr>
<tr><td><code id="fan_+3A_anchor">anchor</code></td>
<td>

<p>Optional data value to anchor a forecast fan on. Typically this will be the last observation of the observed data series.
</p>
</td></tr>
<tr><td><code id="fan_+3A_anchor.time">anchor.time</code></td>
<td>

<p>Optional data value for the time of the anchor. Useful for irregular time series.
</p>
</td></tr>
<tr><td><code id="fan_+3A_fan.col">fan.col</code></td>
<td>

<p>Palette of colours used in the <code>fan</code> or <code>boxfan</code>.
</p>
</td></tr>
<tr><td><code id="fan_+3A_n.fan">n.fan</code></td>
<td>

<p>The number of colours to use in the fan.
</p>
</td></tr>
<tr><td><code id="fan_+3A_alpha">alpha</code></td>
<td>

<p>Factor modifying the opacity alpha; typically in [0,1].
</p>
</td></tr>
<tr><td><code id="fan_+3A_ln">ln</code></td>
<td>

<p>Vector of number to plot contour lines on-top <code>fan</code> or <code>boxfan</code>. Must correspond to calculated percentiles in <code>probs</code>. By default for <code>fan</code> takes either every percentile or prediction interval given in the <code>probs</code> argument (if less then 10) or, when there are more than 10 <code>probs</code> passed, the either every decile or every prediction interval that are a multiple of 10 and given in <code>probs</code>. No lines plotted by default for <code>fan0</code>
</p>
</td></tr>
<tr><td><code id="fan_+3A_med.ln">med.ln</code></td>
<td>

<p>Add a median line to fan. Might be of particular use if <code>type="interval"</code>. Only works when <code>data.type = "simulations"</code> and one of <code>fan</code>, <code>boxfan</code> or <code>spaghetti</code> styles.
</p>
</td></tr>
<tr><td><code id="fan_+3A_ln.col">ln.col</code></td>
<td>

<p>Line colour to be imposed on top of the fan. By default takes the darkest colour from <code>fan.col</code> argument, unless <code>style="spaghetti"</code>
</p>
</td></tr>
<tr><td><code id="fan_+3A_med.col">med.col</code></td>
<td>

<p>Median Line colour. By default this is set to the first colour in <code>fan.col</code>. Users might wish to change to highlight the median.
</p>
</td></tr>
<tr><td><code id="fan_+3A_rlab">rlab</code></td>
<td>

<p>Vector of labels at the end (right) of corresponding percentiles or prediction intervals of the <code>fan</code> or <code>boxfan</code>. Must be in calculated in the <code>probs</code> argument. By default plotted alongside values provided to the <code>ln</code> argument.
</p>
</td></tr>
<tr><td><code id="fan_+3A_rpos">rpos</code></td>
<td>

<p>Position of right labels for the <code>fan</code> or <code>boxfan</code>. See <code><a href="graphics.html#topic+text">text</a></code>.
</p>
</td></tr>
<tr><td><code id="fan_+3A_roffset">roffset</code></td>
<td>

<p>Offset of right labels for the <code>fan</code> or <code>boxfan</code>. See <code><a href="graphics.html#topic+text">text</a></code>.
</p>
</td></tr>
<tr><td><code id="fan_+3A_rcex">rcex</code></td>
<td>

<p>Text size of right labels for the <code>fan</code> or <code>boxfan</code>. See <code><a href="graphics.html#topic+text">text</a></code>.
</p>
</td></tr>
<tr><td><code id="fan_+3A_rcol">rcol</code></td>
<td>

<p>Colour of text for right labels for the <code>fan</code> or <code>boxfan</code>. See <code><a href="graphics.html#topic+text">text</a></code>.
</p>
</td></tr>
<tr><td><code id="fan_+3A_llab">llab</code></td>
<td>

<p>Can take either 1) a <code>TRUE</code> or <code>FALSE</code> value to plot label at the start (right) of the  corresponding percentiles or prediction intervals given in <code>rlab</code>, default is <code>FALSE</code> or 2) a original vector of percentiles or prediction intervals. Must be in calculated in the <code>probs</code> argument. Only works for <code>fan</code> or <code>boxfan</code> styles.
</p>
</td></tr>
<tr><td><code id="fan_+3A_lpos">lpos</code></td>
<td>

<p>Position of left labels for the <code>fan</code> or <code>boxfan</code>. See <code><a href="graphics.html#topic+text">text</a></code>.
</p>
</td></tr>
<tr><td><code id="fan_+3A_loffset">loffset</code></td>
<td>

<p>Offset of left labels for the <code>fan</code> or <code>boxfan</code>.By default takes the same value as <code>roffset</code>. See <code><a href="graphics.html#topic+text">text</a></code>.
</p>
</td></tr>
<tr><td><code id="fan_+3A_lcex">lcex</code></td>
<td>

<p>Text size of left labels for the <code>fan</code> or <code>boxfan</code>. By default takes the same value as <code>rex</code>. See <code><a href="graphics.html#topic+text">text</a></code>.
</p>
</td></tr>
<tr><td><code id="fan_+3A_lcol">lcol</code></td>
<td>

<p>Colour of text for left labels for the <code>fan</code> or <code>boxfan</code>.  By default takes the same value as <code>rcol</code>. See <code><a href="graphics.html#topic+text">text</a></code>.
</p>
</td></tr>
<tr><td><code id="fan_+3A_upplab">upplab</code></td>
<td>

<p>Prefix character string for upper labels to be used for the <code>fan</code> or <code>boxfan</code> when <code>type="interval"</code>.
</p>
</td></tr>
<tr><td><code id="fan_+3A_lowlab">lowlab</code></td>
<td>

<p>Prefix character string for lower labels to be used for the <code>fan</code> or <code>boxfan</code> when <code>type="interval"</code> .
</p>
</td></tr>
<tr><td><code id="fan_+3A_medlab">medlab</code></td>
<td>

<p>Character string for median label.
</p>
</td></tr>
<tr><td><code id="fan_+3A_n.spag">n.spag</code></td>
<td>

<p>Number of simulations to plot in the <code>spaghetti</code> plot.
</p>
</td></tr>
<tr><td><code id="fan_+3A_space">space</code></td>
<td>

<p>Space between boxes in the <code>boxfan</code> plot.
</p>
</td></tr>
<tr><td><code id="fan_+3A_add">add</code></td>
<td>

<p>Add to active plot. By default <code>FALSE</code> for <code>fan</code> and <code>TRUE</code> for <code>fan0</code>.
</p>
</td></tr>
<tr><td><code id="fan_+3A_ylim">ylim</code></td>
<td>

<p>Passed to <code>plot</code> when <code>add = TRUE</code>.
</p>
</td></tr>
<tr><td><code id="fan_+3A_...">...</code></td>
<td>

<p>Additional arguments passed to <code><a href="graphics.html#topic+boxplot">boxplot</a></code> for <code>fan</code> and to <code><a href="graphics.html#topic+plot">plot</a></code> for <code>fan0</code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Visualise sequential distributions using a range of plotting styles. Sequential distribution data can be input as either simulations or pre-computed values over time (columns). For the later, the user should declare input data as percentiles by setting <code>data.type = "values"</code>. Plots are added to existing graphic devices. Users can choose from four different styles.
</p>
<p>The <code>fan</code> and <code>boxfan</code> style plot distributions based on used-defined shading scheme, controlled by the <code>fan.col</code> argument. Additional lines and text are added to illustrate major contours on the probability distribution. Lines and labels can be suppressed by adding <code>ln = NULL</code> and <code>rlab = NULL</code>. Labels to the left of the fan can also be specified using the <code>llab</code> argument. Colours are by default taken from the <code><a href="grDevices.html#topic+heat.colors">heat.colors</a></code> palette. Alternatives can be specified using <code>fan.col</code> (see the example below). The joining of a forecast fan to data is controlled be the anchor argument.
</p>
<p>The <code>spaghetti</code> style, plots random draws (when <code>data.type = "simulations"</code> is set) along the sequence of distributions. The number of draws is controlled by the <code>n.spag</code> argument. The transparency of the lines is controlled by <code>alpha</code>.
</p>
<p>The <code>boxplot</code> style, adds a box plot for simulated data at the appropriate location, according to the <code>start</code> and <code>frquency</code> arguments. Gaps between box plots are controlled by <code>space</code> argument. Additional arguments are passed to <code><a href="graphics.html#topic+boxplot">boxplot</a></code>.
</p>


<h3>Value</h3>

<p>See details
</p>


<h3>Author(s)</h3>

<p>Guy J. Abel
</p>


<h3>References</h3>

<p>Abel, G. J. (2015). fanplot: An R Package for visualising sequential distributions. <em>The R Journal</em> 7 (2) 15&ndash;23.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>##
## Basic Fan: fan0()
##
fan0(th.mcmc)

##
## Basic Fan: fan()
##
# empty plot
plot(NULL, xlim = c(1, 945), ylim = range(th.mcmc)*0.85)

# add fan
fan(th.mcmc)

##
## 20 or so examples of fan charts and
## spaghetti plots based on the th.mcmc object
##
## Make sure you have zoo, tsbugs, RColorBrewer and 
## colorspace packages installed
##
## Not run: 
# demo("sv_fan", "fanplot")

## End(Not run)

##
## Fans for forecasted values
##
## Not run: 
#create time series
net &lt;- ts(ips$net, start=1975)

# fit model
library("forecast")
m &lt;- auto.arima(net)

# plot in forecast package (limited customisation possible)
plot(forecast(m, h=5))

# another plot in forecast (with some customisation, no
# labels or anchoring possible at the moment)
plot(forecast(m, h=5, level=c(50,80,95)), 
     shadecols=rev(heat.colors(3)))

# simulate future values
mm &lt;- matrix(NA, nrow=1000, ncol=5)
for(i in 1:1000)
  mm[i,] &lt;- simulate(m, nsim=5)

# interval fan chart
plot(net, xlim=c(1975,2020), ylim=c(-100,300))
fan(mm, type="interval", start=2013)

# anchor fan chart
plot(net, xlim=c(1975,2020), ylim=c(-100,300))
fan(mm, type="interval", start=2013, 
    anchor=net[time(net)==2012])

# anchor spaghetti plot with underlying fan chart
plot(net, xlim=c(1975,2020), ylim=c(-100,300))
fan(mm, type="interval", start=2013, 
    anchor=net[time(net)==2012], alpha=0, ln.col="orange")
fan(mm, type="interval", start=2013, 
    anchor=net[time(net)==2012], alpha=0.5, style="spaghetti")

## End(Not run)

##
## Box Plots
##
# sample every 21st day of theta_t
th.mcmc21 &lt;- th.mcmc[, seq(1, 945, 21)]
plot(NULL, xlim = c(1, 945), ylim = range(th.mcmc21))
fan(th.mcmc21, style = "boxplot", frequency = 1/21)

# additional arguments for boxplot
plot(NULL, xlim = c(1, 945), ylim = range(th.mcmc21))
fan(th.mcmc21, style = "boxplot", frequency = 1/21, 
 outline = FALSE, col = "red", notch = TRUE)

##
## Fan Boxes
##
plot(NULL, xlim = c(1, 945), ylim = range(th.mcmc21))
fan(th.mcmc21, style = "boxfan", type = "interval", frequency = 1/21)

# more space between boxes
plot(NULL, xlim = c(1, 945), ylim = range(th.mcmc21))
fan(th.mcmc21, style = "boxfan", type = "interval", 
 frequency = 1/21, space = 10)

# overlay spaghetti
fan(th.mcmc21, style = "spaghetti", 
 frequency = 1/21, n.spag = 50, ln.col = "red", alpha=0.2) 
</code></pre>

<hr>
<h2 id='fanplot-package'>
Visualisation of Sequential Probability Distributions Using Fan Charts.
</h2><span id='topic+fanplot-package'></span><span id='topic+fanplot'></span>

<h3>Description</h3>

<p>Visualise sequential distributions using a range of plotting styles. Sequential distribution data can be input as either simulations or values corresponding to percentiles over time. Plots are added to existing graphic devices using the fan function. Users can choose from four different styles, including fan chart type plots, where a set of coloured polygon, with shadings corresponding to the percentile values are layered to represent different uncertainty levels.
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
Package: </td><td style="text-align: left;"> fanplot</td>
</tr>
<tr>
 <td style="text-align: left;">
Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
License: </td><td style="text-align: left;"> GPL-2</td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Guy J. Abel
</p>


<h3>References</h3>

<p>Abel, G. J. (2015). fanplot: An R Package for visualising sequential distributions. <em>The R Journal</em> 7 (2) 15&ndash;23.
</p>

<hr>
<h2 id='ips'>
ONS International Passenger Survey Long-Term International Migration 1975-2012
</h2><span id='topic+ips'></span>

<h3>Description</h3>

<p>Immigration, emigration and net migration flow counts (and their confidence intervals) for the UK from the International Passenger Survey (IPS) conducted by the Office of National Statistics. Data formatted from the 2012 release of the Long-Term International Migration Statistics.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(ips)</code></pre>


<h3>Format</h3>

<p>A data frame with 38 observations on the following 7 variables.
</p>

<dl>
<dt><code>year</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>imm</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>imm.ci</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>emi</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>emi.ci</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>net</code></dt><dd><p>a numeric vector</p>
</dd>
<dt><code>net.ci</code></dt><dd><p>a numeric vector</p>
</dd>
</dl>



<h3>Details</h3>

<p>Data differ slightly from the final adjusted migration estimates published by the ONS, that take account of certain types of migration that the IPS doesn't pick up, such as asylum seekers, people migrating for longer or shorter than they thought they would, and migration over land to and from Northern Ireland. 
</p>


<h3>Source</h3>

<p>Annual statistics on flows of international migrants to and from the UK and England and Wales by the Office of National Statistics. Retrieved from &quot;1.02 IPS Margins of Error, 1975-2012&quot; spreadsheet. 
</p>
<p>Can not find copy of speadsheet on ONS website anymore, but there is a copy at <a href="https://github.com/guyabel/fanplot/tree/master/data-raw/">https://github.com/guyabel/fanplot/tree/master/data-raw/</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>#standard plot
net&lt;-ts(ips$net, start=1975)
plot(net, ylim=range(net-ips$net.ci, net+ips$net.ci))
lines(net+ips$net.ci, lty=2, col="red")
lines(net-ips$net.ci, lty=2, col="red")

#simulate values
ips.sim &lt;- matrix(NA, nrow = 10000, ncol=length(net))
for (i in 1:length(net))
  ips.sim[, i] &lt;- rnorm(10000, mean = ips$net[i], sd =ips$net.ci[i]/1.96)

#spaghetti plot
plot(net, ylim=range(net-ips$net.ci, net+ips$net.ci), type = "n")
fan(ips.sim, style="spaghetti", start=tsp(net)[1], n.spag=50)

#box plot
plot(net, ylim=range(net-ips$net.ci, net+ips$net.ci), type = "n")
fan(ips.sim, style="boxplot", start=tsp(net)[1], llab=TRUE, outline=FALSE)

#box fan
plot(net, ylim=range(net-ips$net.ci, net+ips$net.ci), type = "n")
fan(ips.sim, style="boxfan", type="interval", start=tsp(net)[1])
</code></pre>

<hr>
<h2 id='svpdx'>
Pound-Dollar Exchange Rate Data
</h2><span id='topic+svpdx'></span>

<h3>Description</h3>

<p>Pound-Dollar exchange rate data from 2nd October 1981 to 28th June 1985.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(svpdx)</code></pre>


<h3>Format</h3>

<p>A data frame with 945 observations on the following 2 variables.
</p>

<dl>
<dt><code>date</code></dt><dd><p>Date of observation.</p>
</dd>
<dt><code>pdx</code></dt><dd><p>Logarithm of returns for Pound-Dollar exchange.</p>
</dd>
</dl>



<h3>Details</h3>

<p>Raw data on log returns.
</p>


<h3>Source</h3>

<p>http://www.econ.vu.nl/koopman/sv/svpdx.dat
</p>


<h3>References</h3>

<p>Meyer, R. and J. Yu (2002). BUGS for a Bayesian analysis of stochastic volatility models. <em>Econometrics Journal</em> 3 (2), 198&ndash;215.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data(svpdx)

# plot
plot(svpdx$pdx, type = "l", xaxt = "n", xlab = "Time", ylab = "Return")

# add x-axis
svpdx$rdate&lt;-format(svpdx$date, format = "%b %Y")
mth &lt;- unique(svpdx$rdate)
qtr &lt;- mth[seq(1,length(mth),3)]
axis(1, at = match(qtr, svpdx$rdate), labels = qtr, cex.axis = 0.75)
axis(1, at = match(mth, svpdx$rdate), labels = FALSE, tcl = -0.2)
</code></pre>

<hr>
<h2 id='th.mcmc'>
1000 MCMC Simulations of Estimated Volatility from Pound Dollar Exchange Rate Data.
</h2><span id='topic+th.mcmc'></span>

<h3>Description</h3>

<p>MCMC simulations of volatility obtained from the <code>bugs</code> function in the R2OpenBUGS package. Estimates based on the stochastic volatility model for Pound-Dollar exchange rate data presented in the appendix of Meyer and Yu (2002). The MCMC was ran for 1100 simulations, thining to keep every 10th iteration, and treating the first 100 simulations as burn in.
</p>
<p>Larger simulations (without thinning) can be obtained using the data (<code>svpdx</code>) and the my1.txt BUGS file contained in this package, see example below.
</p>


<h3>Details</h3>

<p>See Meyer and Yu (2010) for model specification.
</p>


<h3>References</h3>

<p>Meyer, R. and J. Yu (2002). BUGS for a Bayesian analysis of stochastic volatility models. <em>Econometrics Journal</em> 3 (2), 198&ndash;215.
</p>
<p>Sturtz, S., U. Ligges, and A. Gelman (2005). R2WinBUGS: a package for running WinBUGS from R. <em>Journal of Statistical Software</em> 12 (3), 1&ndash;16.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># empty plot
plot(NULL, type = "n", xlim = c(1, 945), ylim = range(th.mcmc), ylab = "Theta")

# add fan
fan(th.mcmc)

##
##Create your own (longer) MCMC sample:
##
## Not run: 
# library(tsbugs)
# library(R2OpenBUGS)
# # write model file:
# my1.bug &lt;- dget(system.file("model", "my1.R", package = "fanplot"))
# write.model(my1.bug, "my1.txt")
# # take a look:
# file.show("my1.txt")
# # run openbugs, remember to include theta as a param otherwise will not
# # have anything to plot
# my1.mcmc&lt;-bugs(data=list(n=length(svpdx$pdx),y=svpdx$pdx), 
#                inits=list(list(phistar=0.975,mu=0,itau2=50)),
#                param=c("mu","phi","tau","theta"), 
#                model="my1.txt",
#                n.iter=11000, n.burnin=1000, n.chains=1)
#                
# th.mcmc &lt;- my1.mcmc$sims.list$theta

## End(Not run)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
