<!DOCTYPE html><html lang="en"><head><title>Help for package orf</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {orf}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#orf-package'><p>orf: Ordered Random Forests</p></a></li>
<li><a href='#check_discrete_Y'><p>check if Y is discrete</p></a></li>
<li><a href='#check_eval'><p>check evaluation for margins</p></a></li>
<li><a href='#check_honesty'><p>check honesty</p></a></li>
<li><a href='#check_honesty_fraction'><p>check honesty fraction</p></a></li>
<li><a href='#check_importance'><p>check importance</p></a></li>
<li><a href='#check_inference'><p>check inference</p></a></li>
<li><a href='#check_latex'><p>check latex</p></a></li>
<li><a href='#check_min_node_size'><p>check min.node.size</p></a></li>
<li><a href='#check_mtry'><p>check mtry</p></a></li>
<li><a href='#check_newdata'><p>check newdata</p></a></li>
<li><a href='#check_num_trees'><p>check num.trees</p></a></li>
<li><a href='#check_replace'><p>check replace</p></a></li>
<li><a href='#check_sample_fraction'><p>check sample.fraction</p></a></li>
<li><a href='#check_type'><p>check prediction type for predict.orf</p></a></li>
<li><a href='#check_window'><p>check window size</p></a></li>
<li><a href='#check_X'><p>check X data</p></a></li>
<li><a href='#check_Y'><p>check Y data</p></a></li>
<li><a href='#get_forest_weights'><p>Get Forest Weights</p></a></li>
<li><a href='#get_honest'><p>Get Honest Predictions</p></a></li>
<li><a href='#get_honest_C'><p>Get honest predictions (C++)</p></a></li>
<li><a href='#get_orf_variance'><p>Get ORF Variance</p></a></li>
<li><a href='#get_weights_C'><p>Get honest weights (C++)</p></a></li>
<li><a href='#honest_split'><p>honest sample split</p></a></li>
<li><a href='#margins'><p>Marginal Effects</p></a></li>
<li><a href='#margins_output'><p>Formatted output for marginal effects with inference</p></a></li>
<li><a href='#margins_output_latex'><p>Formatted latex output for marginal effects with inference</p></a></li>
<li><a href='#margins.orf'><p>Marginal Effects for the Ordered Forest</p></a></li>
<li><a href='#mse'><p>Mean Squared Error</p></a></li>
<li><a href='#odata'><p>Simulated Example Dataset</p></a></li>
<li><a href='#orf'><p>Ordered Forest Estimator</p></a></li>
<li><a href='#plot.orf'><p>Plot of the Ordered Forest</p></a></li>
<li><a href='#pred_honest_C'><p>Predict honest predictions (C++)</p></a></li>
<li><a href='#pred_orf_variance'><p>Predict ORF Variance</p></a></li>
<li><a href='#pred_weights_C'><p>Predict honest weights (C++)</p></a></li>
<li><a href='#predict_forest_preds_for_ME'><p>ORF Predictions for Marginal Effects</p></a></li>
<li><a href='#predict_forest_weights'><p>Predict Forest Weights</p></a></li>
<li><a href='#predict_forest_weights_for_ME'><p>ORF Weight Predictions for Marginal Effects</p></a></li>
<li><a href='#predict_honest'><p>Predict Honest Predictions</p></a></li>
<li><a href='#predict.orf'><p>Prediction of the Ordered Forest</p></a></li>
<li><a href='#print.margins.orf'><p>Print of the Ordered Forest Marginal Effects</p></a></li>
<li><a href='#print.orf'><p>Print of the Ordered Forest</p></a></li>
<li><a href='#print.orf.prediction'><p>Print of the Ordered Forest Prediction</p></a></li>
<li><a href='#rps'><p>Ranked Probability Score</p></a></li>
<li><a href='#summary.margins.orf'><p>Summary of the Ordered Forest Marginal Effects</p></a></li>
<li><a href='#summary.orf'><p>Summary of the Ordered Forest</p></a></li>
<li><a href='#summary.orf.prediction'><p>Summary of the Ordered Forest Prediction</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Ordered Random Forests</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.4</td>
</tr>
<tr>
<td>Date:</td>
<td>2022-07-21</td>
</tr>
<tr>
<td>Author:</td>
<td>Gabriel Okasa [aut, cre], Michael Lechner [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Gabriel Okasa &lt;okasa.gabriel@gmail.com&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>An implementation of the Ordered Forest estimator as developed 
    in Lechner &amp; Okasa (2019) &lt;<a href="https://doi.org/10.48550/arXiv.1907.02436">doi:10.48550/arXiv.1907.02436</a>&gt;. The Ordered Forest flexibly
    estimates the conditional probabilities of models with ordered categorical
    outcomes (so-called ordered choice models). Additionally to common machine 
    learning algorithms the 'orf' package provides functions for estimating
    marginal effects as well as statistical inference thereof and thus provides
    similar output as in standard econometric models for ordered choice. The
    core forest algorithm relies on the fast C++ forest implementation from
    the 'ranger' package (Wright &amp; Ziegler, 2017) &lt;<a href="https://doi.org/10.48550/arXiv.1508.04409">doi:10.48550/arXiv.1508.04409</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>Imports:</td>
<td>ggplot2, ranger, Rcpp, stats, utils, xtable</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.1</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/okasag/orf">https://github.com/okasag/orf</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/okasag/orf/issues">https://github.com/okasag/orf/issues</a></td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-07-21 09:12:03 UTC; okasag</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-07-23 22:40:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='orf-package'>orf: Ordered Random Forests</h2><span id='topic+orf-package'></span>

<h3>Description</h3>

<p>An implementation of the Ordered Forest estimator as developed
in Lechner &amp; Okasa (2019). The Ordered Forest flexibly
estimates the conditional probabilities of models with ordered
categorical outcomes (so-called ordered choice models).
Additionally to common machine learning algorithms the <code>orf</code>
package provides functions for estimating marginal effects as well
as statistical inference thereof and thus provides similar output
as in standard econometric models for ordered choice. The core
forest algorithm relies on the fast C++ forest implementation
from the <code>ranger</code> package (Wright &amp; Ziegler, 2017).
</p>


<h3>Author(s)</h3>

<p>Gabriel Okasa, Michael Lechner
</p>


<h3>References</h3>


<ul>
<li><p> Lechner, M., &amp; Okasa, G. (2019). Random Forest Estimation of the Ordered Choice Model. arXiv preprint arXiv:1907.02436. <a href="https://arxiv.org/abs/1907.02436">https://arxiv.org/abs/1907.02436</a>
</p>
</li>
<li><p> Goller, D., Knaus, M. C., Lechner, M., &amp; Okasa, G. (2021). Predicting Match Outcomes in Football by an Ordered Forest Estimator. A Modern Guide to Sports Economics. Edward Elgar Publishing, 335-355. <a href="https://doi.org/10.4337/9781789906530.00026">doi:10.4337/9781789906530.00026</a>
</p>
</li>
<li><p> Wright, M. N. &amp; Ziegler, A. (2017). ranger: A fast implementation of random forests for high dimensional data in C++ and R. J Stat Softw 77:1-17. <a href="https://doi.org/10.18637/jss.v077.i01">doi:10.18637/jss.v077.i01</a>.
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Ordered Forest
require(orf)

# load example data
data(odata)

# specify response and covariates
Y &lt;- as.numeric(odata[, 1])
X &lt;- as.matrix(odata[, -1])

# estimate Ordered Forest with default settings
orf_fit &lt;- orf(X, Y)

# print output of the orf estimation
print(orf_fit)

# show summary of the orf estimation
summary(orf_fit)

# plot the estimated probability distributions
plot(orf_fit)

# predict with the estimated orf
predict(orf_fit)

# estimate marginal effects of the orf
margins(orf_fit)


</code></pre>

<hr>
<h2 id='check_discrete_Y'>check if Y is discrete</h2><span id='topic+check_discrete_Y'></span>

<h3>Description</h3>

<p>Checks the input data as discrete outcome
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_discrete_Y(Y)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_discrete_Y_+3A_y">Y</code></td>
<td>
<p>matrix of input outcomes Y</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Y
</p>

<hr>
<h2 id='check_eval'>check evaluation for margins</h2><span id='topic+check_eval'></span>

<h3>Description</h3>

<p>Checks the input data of eval in margins
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_eval(eval)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_eval_+3A_eval">eval</code></td>
<td>
<p>string, evaluation points for margins</p>
</td></tr>
</table>


<h3>Value</h3>

<p>eval
</p>

<hr>
<h2 id='check_honesty'>check honesty</h2><span id='topic+check_honesty'></span>

<h3>Description</h3>

<p>Checks the input for honesty
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_honesty(honesty)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_honesty_+3A_honesty">honesty</code></td>
<td>
<p>logical, if TRUE honest forest is built using 50:50 data split</p>
</td></tr>
</table>


<h3>Value</h3>

<p>honesty
</p>

<hr>
<h2 id='check_honesty_fraction'>check honesty fraction</h2><span id='topic+check_honesty_fraction'></span>

<h3>Description</h3>

<p>Checks the input data of honesty.fraction in orf
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_honesty_fraction(honesty.fraction, honesty)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_honesty_fraction_+3A_honesty.fraction">honesty.fraction</code></td>
<td>
<p>scalar, share of the data set aside to estimate the effects (default is 0.5)</p>
</td></tr>
<tr><td><code id="check_honesty_fraction_+3A_honesty">honesty</code></td>
<td>
<p>logical, if data should be split into train and honest sample</p>
</td></tr>
</table>


<h3>Value</h3>

<p>honesty.fraction
</p>

<hr>
<h2 id='check_importance'>check importance</h2><span id='topic+check_importance'></span>

<h3>Description</h3>

<p>Checks the input for importance
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_importance(importance)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_importance_+3A_importance">importance</code></td>
<td>
<p>logical, if TRUE variable importance is conducted</p>
</td></tr>
</table>


<h3>Value</h3>

<p>importance
</p>

<hr>
<h2 id='check_inference'>check inference</h2><span id='topic+check_inference'></span>

<h3>Description</h3>

<p>Checks the input for inference
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_inference(inference)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_inference_+3A_inference">inference</code></td>
<td>
<p>logical, if TRUE the weight based inference is conducted</p>
</td></tr>
</table>


<h3>Value</h3>

<p>inference
</p>

<hr>
<h2 id='check_latex'>check latex</h2><span id='topic+check_latex'></span>

<h3>Description</h3>

<p>Checks the input for latex
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_latex(latex)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_latex_+3A_latex">latex</code></td>
<td>
<p>logical, TRUE if latex summary should be generated</p>
</td></tr>
</table>


<h3>Value</h3>

<p>latex
</p>

<hr>
<h2 id='check_min_node_size'>check min.node.size</h2><span id='topic+check_min_node_size'></span>

<h3>Description</h3>

<p>Checks the input data of min.node.size
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_min_node_size(min.node.size, X)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_min_node_size_+3A_min.node.size">min.node.size</code></td>
<td>
<p>scalar, minimum node size</p>
</td></tr>
<tr><td><code id="check_min_node_size_+3A_x">X</code></td>
<td>
<p>matrix of input features X</p>
</td></tr>
</table>


<h3>Value</h3>

<p>min.node.size
</p>

<hr>
<h2 id='check_mtry'>check mtry</h2><span id='topic+check_mtry'></span>

<h3>Description</h3>

<p>Checks the input data of mtry
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_mtry(mtry, X)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_mtry_+3A_mtry">mtry</code></td>
<td>
<p>scalar, number of randomly selected features</p>
</td></tr>
<tr><td><code id="check_mtry_+3A_x">X</code></td>
<td>
<p>matrix of input features X</p>
</td></tr>
</table>


<h3>Value</h3>

<p>mtry
</p>

<hr>
<h2 id='check_newdata'>check newdata</h2><span id='topic+check_newdata'></span>

<h3>Description</h3>

<p>Checks the input for newdata for predict.orf
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_newdata(new_data, X)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_newdata_+3A_new_data">new_data</code></td>
<td>
<p>matrix X containing the observations to predict</p>
</td></tr>
<tr><td><code id="check_newdata_+3A_x">X</code></td>
<td>
<p>matrix of input features X</p>
</td></tr>
</table>

<hr>
<h2 id='check_num_trees'>check num.trees</h2><span id='topic+check_num_trees'></span>

<h3>Description</h3>

<p>Checks the input data of num.trees
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_num_trees(num.trees)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_num_trees_+3A_num.trees">num.trees</code></td>
<td>
<p>scalar, number of trees to be estimated</p>
</td></tr>
</table>


<h3>Value</h3>

<p>num.trees
</p>

<hr>
<h2 id='check_replace'>check replace</h2><span id='topic+check_replace'></span>

<h3>Description</h3>

<p>Checks the input for replace
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_replace(replace)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_replace_+3A_replace">replace</code></td>
<td>
<p>logical, if TRUE bootstrapping, if FALSE subsampling</p>
</td></tr>
</table>


<h3>Value</h3>

<p>replace
</p>

<hr>
<h2 id='check_sample_fraction'>check sample.fraction</h2><span id='topic+check_sample_fraction'></span>

<h3>Description</h3>

<p>Checks the input data of sample.fraction
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_sample_fraction(sample.fraction, replace)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_sample_fraction_+3A_sample.fraction">sample.fraction</code></td>
<td>
<p>scalar, fraction of data used for subsampling</p>
</td></tr>
<tr><td><code id="check_sample_fraction_+3A_replace">replace</code></td>
<td>
<p>logical, if bootstrap or subsampling should be used</p>
</td></tr>
</table>


<h3>Value</h3>

<p>sample.fraction
</p>

<hr>
<h2 id='check_type'>check prediction type for predict.orf</h2><span id='topic+check_type'></span>

<h3>Description</h3>

<p>Checks the input data of type in predict.orf
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_type(type)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_type_+3A_type">type</code></td>
<td>
<p>string, prediction type for predict.orf</p>
</td></tr>
</table>


<h3>Value</h3>

<p>type
</p>

<hr>
<h2 id='check_window'>check window size</h2><span id='topic+check_window'></span>

<h3>Description</h3>

<p>Checks the input data of window in margins
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_window(window)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_window_+3A_window">window</code></td>
<td>
<p>scalar, share of SD of X used for margins</p>
</td></tr>
</table>


<h3>Value</h3>

<p>window
</p>

<hr>
<h2 id='check_X'>check X data</h2><span id='topic+check_X'></span>

<h3>Description</h3>

<p>Checks the input data as a numeric matrix
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_X(X)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_X_+3A_x">X</code></td>
<td>
<p>matrix of input features X</p>
</td></tr>
</table>

<hr>
<h2 id='check_Y'>check Y data</h2><span id='topic+check_Y'></span>

<h3>Description</h3>

<p>Checks the input data as a numeric matrix/vector
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_Y(Y, X)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="check_Y_+3A_y">Y</code></td>
<td>
<p>matrix of input outcomes Y</p>
</td></tr>
<tr><td><code id="check_Y_+3A_x">X</code></td>
<td>
<p>matrix of input features X</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Y
</p>

<hr>
<h2 id='get_forest_weights'>Get Forest Weights</h2><span id='topic+get_forest_weights'></span>

<h3>Description</h3>

<p>get forest weights, i.e. in-sample weights based on honest or train sample
produced by the random forest algorithm as defined in Wager &amp; Athey (2018)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_forest_weights(forest, honest_data, train_data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_forest_weights_+3A_forest">forest</code></td>
<td>
<p>estimated forest object of type ranger</p>
</td></tr>
<tr><td><code id="get_forest_weights_+3A_honest_data">honest_data</code></td>
<td>
<p>honest dataframe</p>
</td></tr>
<tr><td><code id="get_forest_weights_+3A_train_data">train_data</code></td>
<td>
<p>train dataframe</p>
</td></tr>
</table>


<h3>Value</h3>

<p>matrix of honest forest weights
</p>

<hr>
<h2 id='get_honest'>Get Honest Predictions</h2><span id='topic+get_honest'></span>

<h3>Description</h3>

<p>get honest prediction, i.e. fitted values for in sample data
(train and honest sample) based on the honest sample
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_honest(forest, honest_data, train_data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_honest_+3A_forest">forest</code></td>
<td>
<p>estimated forest object of type ranger</p>
</td></tr>
<tr><td><code id="get_honest_+3A_honest_data">honest_data</code></td>
<td>
<p>honest dataframe</p>
</td></tr>
<tr><td><code id="get_honest_+3A_train_data">train_data</code></td>
<td>
<p>train dataframe</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of honest forest predictions
</p>

<hr>
<h2 id='get_honest_C'>Get honest predictions (C++)</h2><span id='topic+get_honest_C'></span>

<h3>Description</h3>

<p>Computes honest predictions (fitted values) from the random forest
for the train and honest sample based on the honest training sample
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_honest_C(x, y, z, w)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_honest_C_+3A_x">x</code></td>
<td>
<p>unique_leaves (List)[ntree]</p>
</td></tr>
<tr><td><code id="get_honest_C_+3A_y">y</code></td>
<td>
<p>honest_y (NumericVector)[nrow]</p>
</td></tr>
<tr><td><code id="get_honest_C_+3A_z">z</code></td>
<td>
<p>honest_leaves (NumericMatrix)[nrow, ntree]</p>
</td></tr>
<tr><td><code id="get_honest_C_+3A_w">w</code></td>
<td>
<p>train_leaves (NumericMatrix)[nrow, ntree]</p>
</td></tr>
</table>

<hr>
<h2 id='get_orf_variance'>Get ORF Variance</h2><span id='topic+get_orf_variance'></span>

<h3>Description</h3>

<p>get variance of ordered random forest predictions based on honest sample
splitting as described in Lechner (2018)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_orf_variance(
  honest_pred,
  honest_weights,
  train_pred,
  train_weights,
  Y_ind_honest
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_orf_variance_+3A_honest_pred">honest_pred</code></td>
<td>
<p>list of vectors of honest forest predictions</p>
</td></tr>
<tr><td><code id="get_orf_variance_+3A_honest_weights">honest_weights</code></td>
<td>
<p>list of n x n matrices of honest forest weights</p>
</td></tr>
<tr><td><code id="get_orf_variance_+3A_train_pred">train_pred</code></td>
<td>
<p>list of vectors of honest forests predictions from train sample</p>
</td></tr>
<tr><td><code id="get_orf_variance_+3A_train_weights">train_weights</code></td>
<td>
<p>list of vectors of honest forests predictions from train sample</p>
</td></tr>
<tr><td><code id="get_orf_variance_+3A_y_ind_honest">Y_ind_honest</code></td>
<td>
<p>list of vectors of 0-1 outcomes for the honest sample</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of ORF variances
</p>

<hr>
<h2 id='get_weights_C'>Get honest weights (C++)</h2><span id='topic+get_weights_C'></span>

<h3>Description</h3>

<p>Computes honest weights from the random forest as in Wager &amp; Athey (2019)
for the train and honest sample based on the honest training sample
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_weights_C(x, y, z)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="get_weights_C_+3A_x">x</code></td>
<td>
<p>leaf_IDs_train - list of leaf IDs in train data</p>
</td></tr>
<tr><td><code id="get_weights_C_+3A_y">y</code></td>
<td>
<p>leaf_IDs - list of leaf IDs in honest data</p>
</td></tr>
<tr><td><code id="get_weights_C_+3A_z">z</code></td>
<td>
<p>leaf_size - list of leaf sizes in honest data</p>
</td></tr>
</table>

<hr>
<h2 id='honest_split'>honest sample split</h2><span id='topic+honest_split'></span>

<h3>Description</h3>

<p>Creates honest sample split by randomly selecting prespecified share of observations
to belong to honest sample and to training sample
</p>


<h3>Usage</h3>

<pre><code class='language-R'>honest_split(data, honesty.fraction, orf)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="honest_split_+3A_data">data</code></td>
<td>
<p>dataframe or matrix of features and outcomes to be split honestly</p>
</td></tr>
<tr><td><code id="honest_split_+3A_honesty.fraction">honesty.fraction</code></td>
<td>
<p>share of sample to belong to honesty sample</p>
</td></tr>
<tr><td><code id="honest_split_+3A_orf">orf</code></td>
<td>
<p>logical, if honest split should be done for orf or not</p>
</td></tr>
</table>


<h3>Value</h3>

<p>named list of honest and training sample
</p>

<hr>
<h2 id='margins'>Marginal Effects</h2><span id='topic+margins'></span>

<h3>Description</h3>

<p>S3 generic method for estimation of marginal effects
of an Ordered Forest objects of class <code>orf</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>margins(forest, eval = NULL, inference = NULL, window = NULL, newdata = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="margins_+3A_forest">forest</code></td>
<td>
<p>estimated Ordered Forest object of class <code>orf</code></p>
</td></tr>
<tr><td><code id="margins_+3A_eval">eval</code></td>
<td>
<p>string, defining evaluation point for marginal effects. These can be one of &quot;mean&quot;, &quot;atmean&quot;, or &quot;atmedian&quot;. (Default is &quot;mean&quot;)</p>
</td></tr>
<tr><td><code id="margins_+3A_inference">inference</code></td>
<td>
<p>logical, if TRUE inference on marginal effects will be conducted (default is inherited from the <code>orf</code> object)</p>
</td></tr>
<tr><td><code id="margins_+3A_window">window</code></td>
<td>
<p>numeric, share of standard deviation of X to be used for evaluation of the marginal effect (default is 0.1)</p>
</td></tr>
<tr><td><code id="margins_+3A_newdata">newdata</code></td>
<td>
<p>numeric matrix X containing the new observations for which the marginal effects should be estimated</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Gabriel Okasa
</p>


<h3>See Also</h3>

<p><code><a href="#topic+margins.orf">margins.orf</a></code>, <code><a href="#topic+summary.margins.orf">summary.margins.orf</a></code> and <code><a href="#topic+print.margins.orf">print.margins.orf</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Ordered Forest
require(orf)

# load example data
data(odata)

# specify response and covariates
Y &lt;- as.numeric(odata[, 1])
X &lt;- as.matrix(odata[, -1])

# estimate Ordered Forest
orf_fit &lt;- orf(X, Y)

# estimate default marginal effects of the orf
orf_margins &lt;- margins(orf_fit)


</code></pre>

<hr>
<h2 id='margins_output'>Formatted output for marginal effects with inference</h2><span id='topic+margins_output'></span>

<h3>Description</h3>

<p>function for creating inference table output for estimated effects which
can be passed into <code>print.margins.orf</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>margins_output(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="margins_output_+3A_x">x</code></td>
<td>
<p>object of type <code>margins.orf</code></p>
</td></tr>
</table>

<hr>
<h2 id='margins_output_latex'>Formatted latex output for marginal effects with inference</h2><span id='topic+margins_output_latex'></span>

<h3>Description</h3>

<p>function for creating latex inference table output for estimated effects which
can be passed into <code>print.margins.orf</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>margins_output_latex(x)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="margins_output_latex_+3A_x">x</code></td>
<td>
<p>object of type <code>margins.orf</code></p>
</td></tr>
</table>

<hr>
<h2 id='margins.orf'>Marginal Effects for the Ordered Forest</h2><span id='topic+margins.orf'></span>

<h3>Description</h3>

<p>S3 method for estimation of marginal effects
of an Ordered Forest objects of class <code>orf</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'orf'
margins(forest, eval = NULL, inference = NULL, window = NULL, newdata = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="margins.orf_+3A_forest">forest</code></td>
<td>
<p>estimated Ordered Forest object of class <code>orf</code></p>
</td></tr>
<tr><td><code id="margins.orf_+3A_eval">eval</code></td>
<td>
<p>string, defining evaluation point for marginal effects. These can be one of &quot;mean&quot;, &quot;atmean&quot;, or &quot;atmedian&quot;. (Default is &quot;mean&quot;)</p>
</td></tr>
<tr><td><code id="margins.orf_+3A_inference">inference</code></td>
<td>
<p>logical, if TRUE inference on marginal effects will be conducted (default is inherited from the <code>orf</code> object)</p>
</td></tr>
<tr><td><code id="margins.orf_+3A_window">window</code></td>
<td>
<p>numeric, share of standard deviation of X to be used for evaluation of the marginal effect (default is 0.1)</p>
</td></tr>
<tr><td><code id="margins.orf_+3A_newdata">newdata</code></td>
<td>
<p>numeric matrix X containing the new observations for which the marginal effects should be estimated</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>margins.orf</code> estimates marginal effects at the mean, at the median, or
the mean marginal effects, depending on the <code>eval</code> argument. It is advised
to increase the number of subsampling replications in the supplied <code>orf</code>
object as the estimation of the marginal effects is a more demanding exercise
than a simple Ordered Forest estimation/prediction. Additionally to the estimation
of the marginal effects, the weight-based inference for the effects is supported
as well. Note, that the inference procedure is much more computationally exhausting
exercise due to the computation of the forest weights. Additionally, the evaluation
window for the marginal effects can be regulated through the <code>window</code> argument.
Furthermore, new data for which marginal effects should be computed can be supplied
as well as long as it lies within the support of <code>X</code>.
</p>


<h3>Value</h3>

<p>object of type <code>margins.orf</code> with following elements
</p>
<table role = "presentation">
<tr><td><code>info</code></td>
<td>
<p>info containing forest inputs and data used</p>
</td></tr>
<tr><td><code>effects</code></td>
<td>
<p>marginal effects</p>
</td></tr>
<tr><td><code>variances</code></td>
<td>
<p>variances of marginal effects</p>
</td></tr>
<tr><td><code>errors</code></td>
<td>
<p>standard errors of marginal effects</p>
</td></tr>
<tr><td><code>tvalues</code></td>
<td>
<p>t-values of marginal effects</p>
</td></tr>
<tr><td><code>pvalues</code></td>
<td>
<p>p-values of marginal effects</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Gabriel Okasa
</p>


<h3>See Also</h3>

<p><code><a href="#topic+summary.margins.orf">summary.margins.orf</a></code>, <code><a href="#topic+print.margins.orf">print.margins.orf</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Ordered Forest
require(orf)

# load example data
data(odata)

# specify response and covariates
Y &lt;- as.numeric(odata[, 1])
X &lt;- as.matrix(odata[, -1])

# estimate Ordered Forest
orf_fit &lt;- orf(X, Y)

# estimate marginal effects of the orf (default)
orf_margins &lt;- margins(orf_fit)

# estimate marginal effects evaluated at the mean
orf_margins &lt;- margins(orf_fit, eval = "atmean")

# estimate marginal effects with inference
# (orf object has to be estimated with honesty and subsampling)
orf_margins &lt;- margins(orf_fit, inference = TRUE)

# estimate marginal effects with custom window size
orf_margins &lt;- margins(orf_fit, window = 0.5)

# estimate marginal effects for some new data (within support of X)
orf_margins &lt;- margins(orf_fit, newdata = X[1:10, ])

# estimate marginal effects with all custom settings
orf_margins &lt;- margins(orf_fit, eval = "atmedian", inference = TRUE,
                                window = 0.5, newdata = X[1:10, ])


</code></pre>

<hr>
<h2 id='mse'>Mean Squared Error</h2><span id='topic+mse'></span>

<h3>Description</h3>

<p>computes the mean squared error (MSE) for evaluating the accuracy of
ordered/unordered probability predictions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mse(predictions, observed)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="mse_+3A_predictions">predictions</code></td>
<td>
<p>matrix of predictions (n x categories)</p>
</td></tr>
<tr><td><code id="mse_+3A_observed">observed</code></td>
<td>
<p>vector of observed ordered categorical outcomes (n x 1)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>scalar, sum MSE for given predictions
</p>

<hr>
<h2 id='odata'>Simulated Example Dataset</h2><span id='topic+odata'></span>

<h3>Description</h3>

<p>A simulated example dataset with ordered categorical outcome variable
containing different types of covariates for illustration purposes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>odata
</code></pre>


<h3>Format</h3>

<p>A data frame with 1000 rows and 5 variables
</p>


<h3>Details</h3>

<p>For the exact data generating process, see the example below.
</p>


<h3>Value</h3>

<table role = "presentation">
<tr><td><code>Y</code></td>
<td>
<p>ordered outcome, classes 1, 2, and 3</p>
</td></tr>
<tr><td><code>X1</code></td>
<td>
<p>continuous covariate, N(0,1)</p>
</td></tr>
<tr><td><code>X2</code></td>
<td>
<p>categorical covariate, values 1, 2, and 3</p>
</td></tr>
<tr><td><code>X3</code></td>
<td>
<p>binary covariate, values 0 and 1</p>
</td></tr>
<tr><td><code>X4</code></td>
<td>
<p>continuous covariate, N(0,10)</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'># generate example data

# set seed for replicability
set.seed(123)

# number of observations
n  &lt;- 1000

# various covariates
X1 &lt;- rnorm(n, 0, 1)    # continuous
X2 &lt;- rbinom(n, 2, 0.5) # categorical
X3 &lt;- rbinom(n, 1, 0.5) # dummy
X4 &lt;- rnorm(n, 0, 10)   # noise

# bind into matrix
X &lt;- as.matrix(cbind(X1, X2, X3, X4))

# deterministic component
deterministic &lt;- X1 + X2 + X3
# generate continuous outcome with logistic error
Y &lt;- deterministic + rlogis(n, 0, 1)
# thresholds for continuous outcome
cuts &lt;- quantile(Y, c(0, 1/3, 2/3, 1))
# discretize outcome into ordered classes 1, 2, 3
Y &lt;- as.numeric(cut(Y, breaks = cuts, include.lowest = TRUE))

# save data as a dataframe
odata &lt;- as.data.frame(cbind(Y, X))

# end of data generating

</code></pre>

<hr>
<h2 id='orf'>Ordered Forest Estimator</h2><span id='topic+orf'></span>

<h3>Description</h3>

<p>An implementation of the Ordered Forest estimator as developed
in Lechner &amp; Okasa (2019). The Ordered Forest flexibly
estimates the conditional probabilities of models with ordered
categorical outcomes (so-called ordered choice models).
Additionally to common machine learning algorithms the <code>orf</code>
package provides functions for estimating marginal effects as well
as statistical inference thereof and thus provides similar output
as in standard econometric models for ordered choice. The core
forest algorithm relies on the fast C++ forest implementation
from the <code>ranger</code> package (Wright &amp; Ziegler, 2017).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>orf(
  X,
  Y,
  num.trees = 1000,
  mtry = NULL,
  min.node.size = NULL,
  replace = FALSE,
  sample.fraction = NULL,
  honesty = TRUE,
  honesty.fraction = NULL,
  inference = FALSE,
  importance = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="orf_+3A_x">X</code></td>
<td>
<p>numeric matrix of features</p>
</td></tr>
<tr><td><code id="orf_+3A_y">Y</code></td>
<td>
<p>numeric vector of outcomes</p>
</td></tr>
<tr><td><code id="orf_+3A_num.trees">num.trees</code></td>
<td>
<p>scalar, number of trees in a forest, i.e. bootstrap replications (default is 1000 trees)</p>
</td></tr>
<tr><td><code id="orf_+3A_mtry">mtry</code></td>
<td>
<p>scalar, number of randomly selected features (default is the squared root of number of features, rounded up to the nearest integer)</p>
</td></tr>
<tr><td><code id="orf_+3A_min.node.size">min.node.size</code></td>
<td>
<p>scalar, minimum node size, i.e. leaf size of a tree (default is 5 observations)</p>
</td></tr>
<tr><td><code id="orf_+3A_replace">replace</code></td>
<td>
<p>logical, if TRUE sampling with replacement, i.e. bootstrap is used to grow the trees, otherwise subsampling without replacement is used (default is set to FALSE)</p>
</td></tr>
<tr><td><code id="orf_+3A_sample.fraction">sample.fraction</code></td>
<td>
<p>scalar, subsampling rate (default is 1 for bootstrap and 0.5 for subsampling)</p>
</td></tr>
<tr><td><code id="orf_+3A_honesty">honesty</code></td>
<td>
<p>logical, if TRUE honest forest is built using sample splitting (default is set to TRUE)</p>
</td></tr>
<tr><td><code id="orf_+3A_honesty.fraction">honesty.fraction</code></td>
<td>
<p>scalar, share of observations belonging to honest sample not used for growing the forest (default is 0.5)</p>
</td></tr>
<tr><td><code id="orf_+3A_inference">inference</code></td>
<td>
<p>logical, if TRUE the weight based inference is conducted (default is set to FALSE)</p>
</td></tr>
<tr><td><code id="orf_+3A_importance">importance</code></td>
<td>
<p>logical, if TRUE variable importance measure based on permutation is conducted (default is set to FALSE)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The Ordered Forest function, <code>orf</code>, estimates the conditional ordered choice
probabilities, i.e. P[Y=m|X=x]. Additionally, weight-based inference for
the probability predictions can be conducted as well. If inference is desired,
the Ordered Forest must be estimated with honesty and subsampling.
If prediction only is desired, estimation without honesty and with bootstrapping
is recommended for optimal prediction performance.
</p>
<p>In order to estimate the Ordered Forest user must supply the data in form of
matrix of covariates <code>X</code> and a vector of outcomes 'codeY to the <code>orf</code>
function. These data inputs are also the only inputs that must be specified by
the user without any defaults. Further optional arguments include the classical forest
hyperparameters such as number of trees, <code>num.trees</code>, number of randomly
selected features, <code>mtry</code>, and the minimum leaf size, <code>min.node.size</code>.
The forest building scheme is regulated by the <code>replace</code> argument, meaning
bootstrapping if <code>replace = TRUE</code> or subsampling if <code>replace = FALSE</code>.
For the case of subsampling, <code>sample.fraction</code> argument regulates the subsampling
rate. Further, honest forest is estimated if the <code>honesty</code> argument is set to
<code>TRUE</code>, which is also the default. Similarly, the fraction of the sample used
for the honest estimation is regulated by the <code>honesty.fraction</code> argument.
The default setting conducts a 50:50 sample split, which is also generally advised
to follow for optimal performance. Inference procedure of the Ordered Forest is based on
the forest weights and is controlled by the <code>inference</code> argument. Note, that
such weight-based inference is computationally demanding exercise due to the estimation
of the forest weights and as such longer computation time is to be expected. Lastly,
the <code>importance</code> argument turns on and off the permutation based variable
importance.
</p>
<p><code>orf</code> is compatible with standard <code>R</code> commands such as
<code>predict</code>, <code>margins</code>, <code>plot</code>, <code>summary</code> and <code>print</code>.
For further details, see examples below.
</p>


<h3>Value</h3>

<p>object of type <code>orf</code> with following elements
</p>
<table role = "presentation">
<tr><td><code>forests</code></td>
<td>
<p>saved forests trained for <code>orf</code> estimations (inherited from <code>ranger</code>)</p>
</td></tr>
<tr><td><code>info</code></td>
<td>
<p>info containing forest inputs and data used</p>
</td></tr>
<tr><td><code>predictions</code></td>
<td>
<p>predicted values for class probabilities</p>
</td></tr>
<tr><td><code>variances</code></td>
<td>
<p>variances of predicted values</p>
</td></tr>
<tr><td><code>importance</code></td>
<td>
<p>weighted measure of permutation based variable importance</p>
</td></tr>
<tr><td><code>accuracy</code></td>
<td>
<p>oob measures for mean squared error and ranked probability score</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Gabriel Okasa
</p>


<h3>References</h3>


<ul>
<li><p> Lechner, M., &amp; Okasa, G. (2019). Random Forest Estimation of the Ordered Choice Model. arXiv preprint arXiv:1907.02436. <a href="https://arxiv.org/abs/1907.02436">https://arxiv.org/abs/1907.02436</a>
</p>
</li>
<li><p> Goller, D., Knaus, M. C., Lechner, M., &amp; Okasa, G. (2021). Predicting Match Outcomes in Football by an Ordered Forest Estimator. A Modern Guide to Sports Economics. Edward Elgar Publishing, 335-355. <a href="https://doi.org/10.4337/9781789906530.00026">doi:10.4337/9781789906530.00026</a>
</p>
</li>
<li><p> Wright, M. N. &amp; Ziegler, A. (2017). ranger: A fast implementation of random forests for high dimensional data in C++ and R. J Stat Softw 77:1-17. <a href="https://doi.org/10.18637/jss.v077.i01">doi:10.18637/jss.v077.i01</a>.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+summary.orf">summary.orf</a></code>, <code><a href="#topic+plot.orf">plot.orf</a></code>
<code><a href="#topic+predict.orf">predict.orf</a></code>, <code><a href="#topic+margins.orf">margins.orf</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Ordered Forest
require(orf)

# load example data
data(odata)

# specify response and covariates
Y &lt;- as.numeric(odata[, 1])
X &lt;- as.matrix(odata[, -1])

# estimate Ordered Forest with default parameters
orf_fit &lt;- orf(X, Y)

# estimate Ordered Forest with own tuning parameters
orf_fit &lt;- orf(X, Y, num.trees = 2000, mtry = 3, min.node.size = 10)

# estimate Ordered Forest with bootstrapping and without honesty
orf_fit &lt;- orf(X, Y, replace = TRUE, honesty = FALSE)

# estimate Ordered Forest with subsampling and with honesty
orf_fit &lt;- orf(X, Y, replace = FALSE, honesty = TRUE)

# estimate Ordered Forest with subsampling and with honesty
# with own tuning for subsample fraction and honesty fraction
orf_fit &lt;- orf(X, Y, replace = FALSE, sample.fraction = 0.5,
                     honesty = TRUE, honesty.fraction = 0.5)

# estimate Ordered Forest with subsampling and with honesty and with inference
# (for inference, subsampling and honesty are required)
orf_fit &lt;- orf(X, Y, replace = FALSE, honesty = TRUE, inference = TRUE)

# estimate Ordered Forest with simple variable importance measure
orf_fit &lt;- orf(X, Y, importance = TRUE)

# estimate Ordered Forest with all custom settings
orf_fit &lt;- orf(X, Y, num.trees = 2000, mtry = 3, min.node.size = 10,
                     replace = TRUE, sample.fraction = 1,
                     honesty = FALSE, honesty.fraction = 0,
                     inference = FALSE, importance = FALSE)


</code></pre>

<hr>
<h2 id='plot.orf'>Plot of the Ordered Forest</h2><span id='topic+plot.orf'></span>

<h3>Description</h3>

<p>plot the probability distributions estimated by the Ordered Forest object of class <code>orf</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'orf'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot.orf_+3A_x">x</code></td>
<td>
<p>estimated Ordered Forest object of class <code>orf</code></p>
</td></tr>
<tr><td><code id="plot.orf_+3A_...">...</code></td>
<td>
<p>further arguments (currently ignored)</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>plot.orf</code> generates probability distributions, i.e. density plots of estimated
ordered probabilities by the Ordered Forest for each outcome class considered.
The plots effectively visualize the estimated probability density in contrast to
a real observed ordered outcome class and as such provide a visual inspection of
the overall in-sample estimation accuracy. The dashed lines locate the means of
the respective probability distributions.
</p>


<h3>Author(s)</h3>

<p>Gabriel Okasa
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Ordered Forest
require(orf)

# load example data
data(odata)

# specify response and covariates
Y &lt;- as.numeric(odata[, 1])
X &lt;- as.matrix(odata[, -1])

# estimate Ordered Forest
orf_fit &lt;- orf(X, Y)

# plot the estimated probability distributions
plot(orf_fit)

</code></pre>

<hr>
<h2 id='pred_honest_C'>Predict honest predictions (C++)</h2><span id='topic+pred_honest_C'></span>

<h3>Description</h3>

<p>Computes honest predictions from the random forest for a test sample based
on the honest training sample
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pred_honest_C(x, y, z, w)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pred_honest_C_+3A_x">x</code></td>
<td>
<p>unique_leaves (List)[ntree]</p>
</td></tr>
<tr><td><code id="pred_honest_C_+3A_y">y</code></td>
<td>
<p>honest_y (NumericVector)[nrow]</p>
</td></tr>
<tr><td><code id="pred_honest_C_+3A_z">z</code></td>
<td>
<p>honest_leaves (NumericMatrix)[nrow, ntree]</p>
</td></tr>
<tr><td><code id="pred_honest_C_+3A_w">w</code></td>
<td>
<p>test_leaves (NumericMatrix)[nrow, ntree]</p>
</td></tr>
</table>

<hr>
<h2 id='pred_orf_variance'>Predict ORF Variance</h2><span id='topic+pred_orf_variance'></span>

<h3>Description</h3>

<p>predict variance of ordered random forest predictions based on honest sample
splitting as described in Lechner (2018)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pred_orf_variance(honest_pred, honest_weights, Y_ind_honest)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pred_orf_variance_+3A_honest_pred">honest_pred</code></td>
<td>
<p>list of vectors of honest forest predictions</p>
</td></tr>
<tr><td><code id="pred_orf_variance_+3A_honest_weights">honest_weights</code></td>
<td>
<p>list of n x n matrices of honest forest weights</p>
</td></tr>
<tr><td><code id="pred_orf_variance_+3A_y_ind_honest">Y_ind_honest</code></td>
<td>
<p>list of vectors of 0-1 outcomes for the honest sample</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of ORF variances
</p>

<hr>
<h2 id='pred_weights_C'>Predict honest weights (C++)</h2><span id='topic+pred_weights_C'></span>

<h3>Description</h3>

<p>Computes honest weights from the random forest as in Wager &amp; Athey (2019)
for the test sample based on the honest training sample
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pred_weights_C(x, y, z, w)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pred_weights_C_+3A_x">x</code></td>
<td>
<p>leaf_IDs_test - list of leaf IDs in test data</p>
</td></tr>
<tr><td><code id="pred_weights_C_+3A_y">y</code></td>
<td>
<p>leaf_IDs - list of leaf IDs in honest data</p>
</td></tr>
<tr><td><code id="pred_weights_C_+3A_z">z</code></td>
<td>
<p>leaf_size - list of leaf sizes in honest data</p>
</td></tr>
<tr><td><code id="pred_weights_C_+3A_w">w</code></td>
<td>
<p>binary indicator - equal 1 if marginal effects are being computed, 0 otherwise for normal prediction</p>
</td></tr>
</table>

<hr>
<h2 id='predict_forest_preds_for_ME'>ORF Predictions for Marginal Effects</h2><span id='topic+predict_forest_preds_for_ME'></span>

<h3>Description</h3>

<p>Fast ORF Predictions for estimation of marginal effects at mean
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predict_forest_preds_for_ME(forest, data, pred_data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict_forest_preds_for_ME_+3A_forest">forest</code></td>
<td>
<p>list of ranger forest objects</p>
</td></tr>
<tr><td><code id="predict_forest_preds_for_ME_+3A_data">data</code></td>
<td>
<p>list of n x n matrices of indicator data for orf</p>
</td></tr>
<tr><td><code id="predict_forest_preds_for_ME_+3A_pred_data">pred_data</code></td>
<td>
<p>list of prediction data (X_mean_up/down)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list of predictions
</p>

<hr>
<h2 id='predict_forest_weights'>Predict Forest Weights</h2><span id='topic+predict_forest_weights'></span>

<h3>Description</h3>

<p>predict forest weights, i.e. out-of-sample weights based on honest or train
sample produced by the random forest algorithm as defined in Wager &amp; Athey (2018)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predict_forest_weights(forest, data, pred_data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict_forest_weights_+3A_forest">forest</code></td>
<td>
<p>estimated forest object of type ranger</p>
</td></tr>
<tr><td><code id="predict_forest_weights_+3A_data">data</code></td>
<td>
<p>train (honest) dataframe</p>
</td></tr>
<tr><td><code id="predict_forest_weights_+3A_pred_data">pred_data</code></td>
<td>
<p>prediction dataframe</p>
</td></tr>
</table>


<h3>Value</h3>

<p>matrix of honest forest weights
</p>

<hr>
<h2 id='predict_forest_weights_for_ME'>ORF Weight Predictions for Marginal Effects</h2><span id='topic+predict_forest_weights_for_ME'></span>

<h3>Description</h3>

<p>Fast ORF Weight Predictions for estimation of marginal effects at mean
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predict_forest_weights_for_ME(forest, data, pred_data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict_forest_weights_for_ME_+3A_forest">forest</code></td>
<td>
<p>list of ranger forest objects</p>
</td></tr>
<tr><td><code id="predict_forest_weights_for_ME_+3A_data">data</code></td>
<td>
<p>list of n x n matrices of indicator data for orf</p>
</td></tr>
<tr><td><code id="predict_forest_weights_for_ME_+3A_pred_data">pred_data</code></td>
<td>
<p>list of prediction data (X_mean_up/down)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>list of weights
</p>

<hr>
<h2 id='predict_honest'>Predict Honest Predictions</h2><span id='topic+predict_honest'></span>

<h3>Description</h3>

<p>predict honest prediction for out of sample data
based on the honest sample
</p>


<h3>Usage</h3>

<pre><code class='language-R'>predict_honest(forest, honest_data, test_data)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict_honest_+3A_forest">forest</code></td>
<td>
<p>estimated forest object of type ranger</p>
</td></tr>
<tr><td><code id="predict_honest_+3A_honest_data">honest_data</code></td>
<td>
<p>honest dataframe</p>
</td></tr>
<tr><td><code id="predict_honest_+3A_test_data">test_data</code></td>
<td>
<p>test dataframe</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of honest forest predictions
</p>

<hr>
<h2 id='predict.orf'>Prediction of the Ordered Forest</h2><span id='topic+predict.orf'></span>

<h3>Description</h3>

<p>Prediction for new observations based on estimated Ordered Forest of class <code>orf</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'orf'
predict(object, newdata = NULL, type = NULL, inference = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="predict.orf_+3A_object">object</code></td>
<td>
<p>estimated Ordered Forest object of class <code>orf</code></p>
</td></tr>
<tr><td><code id="predict.orf_+3A_newdata">newdata</code></td>
<td>
<p>numeric matrix X containing the observations for which the outcomes should be predicted</p>
</td></tr>
<tr><td><code id="predict.orf_+3A_type">type</code></td>
<td>
<p>string, specifying the type of the prediction, These can be either &quot;probs&quot; or  &quot;p&quot; for probabilities and &quot;class&quot; or &quot;c&quot; for classes. (Default is &quot;probs&quot;).</p>
</td></tr>
<tr><td><code id="predict.orf_+3A_inference">inference</code></td>
<td>
<p>logical, if TRUE variances for the predictions will be estimated (only feasible for probability predictions).</p>
</td></tr>
<tr><td><code id="predict.orf_+3A_...">...</code></td>
<td>
<p>further arguments (currently ignored)</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>predict.orf</code> estimates the conditional ordered choice probabilities,
i.e. P[Y=m|X=x] for new data points (matrix X containing new observations
of covariates) based on the estimated Ordered Forest object of class <code>orf</code>.
Furthermore, weight-based inference for the probability predictions can be
conducted as well. If inference is desired, the supplied Ordered Forest must be
estimated with honesty and subsampling. If prediction only is desired, estimation
without honesty and with bootstrapping is recommended for optimal prediction
performance. Additionally to the probability predictions, class predictions can
be estimated as well using the <code>type</code> argument. In this case, the predicted
classes are obtained as classes with the highest predicted probability.
</p>


<h3>Value</h3>

<p>object of class <code>orf.prediction</code> with following elements
</p>
<table role = "presentation">
<tr><td><code>info</code></td>
<td>
<p>info containing forest inputs and data used</p>
</td></tr>
<tr><td><code>predictions</code></td>
<td>
<p>predicted values</p>
</td></tr>
<tr><td><code>variances</code></td>
<td>
<p>variances of predicted values</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Gabriel Okasa
</p>


<h3>See Also</h3>

<p><code><a href="#topic+summary.orf.prediction">summary.orf.prediction</a></code>, <code><a href="#topic+print.orf.prediction">print.orf.prediction</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Ordered Forest
require(orf)

# load example data
data(odata)

# specify response and covariates for train and test
idx &lt;- sample(seq(1, nrow(odata), 1), 0.8*nrow(odata))

# train set
Y_train &lt;- as.numeric(odata[idx, 1])
X_train &lt;- as.matrix(odata[idx, -1])

# test set
Y_test &lt;- as.numeric(odata[-idx, 1])
X_test &lt;- as.matrix(odata[-idx, -1])

# estimate Ordered Forest
orf_fit &lt;- orf(X_train, Y_train)

# predict the probabilities with the estimated orf
orf_pred &lt;- predict(orf_fit, newdata = X_test)

# predict the probabilities with estimated orf together with variances
orf_pred &lt;- predict(orf_fit, newdata = X_test, inference = TRUE)

# predict the classes with estimated orf
orf_pred &lt;- predict(orf_fit, newdata = X_test, type = "class")


</code></pre>

<hr>
<h2 id='print.margins.orf'>Print of the Ordered Forest Marginal Effects</h2><span id='topic+print.margins.orf'></span>

<h3>Description</h3>

<p>print of estimated marginal effects of the Ordered Forest of class <code>margins.orf</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'margins.orf'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.margins.orf_+3A_x">x</code></td>
<td>
<p>estimated Ordered Forest Marginal Effect object of type <code>margins.orf</code></p>
</td></tr>
<tr><td><code id="print.margins.orf_+3A_...">...</code></td>
<td>
<p>further arguments (currently ignored)</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>print.margins.orf</code> provides a first glimpse of the Ordered Forest
marginal effects, printed directly to the <code>R</code> console. The printed information
contains the results for the marginal effects for each covariate and each outcome class.
</p>


<h3>Author(s)</h3>

<p>Gabriel Okasa
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Ordered Forest
require(orf)

# load example data
data(odata)

# specify response and covariates
Y &lt;- as.numeric(odata[, 1])
X &lt;- as.matrix(odata[, -1])

# estimate Ordered Forest
orf_fit &lt;- orf(X, Y)

# estimate marginal effects of the orf
orf_margins &lt;- margins(orf_fit)

# print marginal effects
print(orf_margins)


</code></pre>

<hr>
<h2 id='print.orf'>Print of the Ordered Forest</h2><span id='topic+print.orf'></span>

<h3>Description</h3>

<p>print of an estimated Ordered Forest object of class <code>orf</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'orf'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.orf_+3A_x">x</code></td>
<td>
<p>estimated Ordered Forest object of class <code>orf</code></p>
</td></tr>
<tr><td><code id="print.orf_+3A_...">...</code></td>
<td>
<p>further arguments (currently ignored)</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>print.orf</code> provides a first glimpse of the Ordered Forest estimation,
printed directly to the <code>R</code> console. The printed information contains
the main inputs of the <code>orf</code> function.
</p>


<h3>Author(s)</h3>

<p>Gabriel Okasa
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Ordered Forest
require(orf)

# load example data
data(odata)

# specify response and covariates
Y &lt;- as.numeric(odata[, 1])
X &lt;- as.matrix(odata[, -1])

# estimate Ordered Forest
orf_fit &lt;- orf(X, Y)

# print output of the orf estimation
print(orf_fit)

</code></pre>

<hr>
<h2 id='print.orf.prediction'>Print of the Ordered Forest Prediction</h2><span id='topic+print.orf.prediction'></span>

<h3>Description</h3>

<p>print of Ordered Forest predictions of class <code>orf.prediction</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'orf.prediction'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="print.orf.prediction_+3A_x">x</code></td>
<td>
<p>predicted Ordered Forest object of class <code>orf.prediction</code></p>
</td></tr>
<tr><td><code id="print.orf.prediction_+3A_...">...</code></td>
<td>
<p>further arguments (currently ignored)</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>print.orf.prediction</code> provides a first glimpse of the Ordered Forest
prediction, printed directly to the <code>R</code> console. The printed information
contains the main inputs of the <code>predict.orf</code> function.
</p>


<h3>Author(s)</h3>

<p>Gabriel Okasa
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Ordered Forest
require(orf)

# load example data
data(odata)

# specify response and covariates for train and test
idx &lt;- sample(seq(1, nrow(odata), 1), 0.8*nrow(odata))

# train set
Y_train &lt;- as.numeric(odata[idx, 1])
X_train &lt;- as.matrix(odata[idx, -1])

# test set
Y_test &lt;- as.numeric(odata[-idx, 1])
X_test &lt;- as.matrix(odata[-idx, -1])

# estimate Ordered Forest
orf_fit &lt;- orf(X_train, Y_train)

# predict the probabilities with the estimated orf
orf_pred &lt;- predict(orf_fit, newdata = X_test)

# print the prediction object
print(orf_pred)

</code></pre>

<hr>
<h2 id='rps'>Ranked Probability Score</h2><span id='topic+rps'></span>

<h3>Description</h3>

<p>Computes the mean ranked probability score (RPS) for evaluating the accuracy of
ordered probability predictions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rps(predictions, observed)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rps_+3A_predictions">predictions</code></td>
<td>
<p>matrix of predictions (n x categories)</p>
</td></tr>
<tr><td><code id="rps_+3A_observed">observed</code></td>
<td>
<p>vector of observed ordered categorical outcomes (n x 1)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>scalar, mean RPS for given predictions
</p>

<hr>
<h2 id='summary.margins.orf'>Summary of the Ordered Forest Marginal Effects</h2><span id='topic+summary.margins.orf'></span>

<h3>Description</h3>

<p>summary of estimated marginal effects of the Ordered Forest of class <code>margins.orf</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'margins.orf'
summary(object, latex = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.margins.orf_+3A_object">object</code></td>
<td>
<p>estimated Ordered Forest Marginal Effect object of type <code>margins.orf</code></p>
</td></tr>
<tr><td><code id="summary.margins.orf_+3A_latex">latex</code></td>
<td>
<p>logical, if TRUE latex coded summary will be generated (default is FALSE)</p>
</td></tr>
<tr><td><code id="summary.margins.orf_+3A_...">...</code></td>
<td>
<p>further arguments (currently ignored)</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>summary.margins.orf</code> provides estimation results of the Ordered Forest
marginal effects. The summary contains the results for the marginal effects
for each covariate and each outcome class, optionally with inference as well.
Furthermore, summary output as a LaTeX table is supported in order to directly
extract the results for the documentation.
</p>


<h3>Author(s)</h3>

<p>Gabriel Okasa
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Ordered Forest
require(orf)

# load example data
data(odata)

# specify response and covariates
Y &lt;- as.numeric(odata[, 1])
X &lt;- as.matrix(odata[, -1])

# estimate Ordered Forest
orf_fit &lt;- orf(X, Y)

# estimate marginal effects of the orf
orf_margins &lt;- margins(orf_fit)

# summary of marginal effects
summary(orf_margins)

# summary of marginal effects coded in LaTeX
summary(orf_margins, latex = TRUE)


</code></pre>

<hr>
<h2 id='summary.orf'>Summary of the Ordered Forest</h2><span id='topic+summary.orf'></span>

<h3>Description</h3>

<p>summary of an estimated Ordered Forest object of class <code>orf</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'orf'
summary(object, latex = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.orf_+3A_object">object</code></td>
<td>
<p>estimated Ordered Forest object of class <code>orf</code></p>
</td></tr>
<tr><td><code id="summary.orf_+3A_latex">latex</code></td>
<td>
<p>logical, if TRUE latex coded summary will be generated (default is FALSE)</p>
</td></tr>
<tr><td><code id="summary.orf_+3A_...">...</code></td>
<td>
<p>further arguments (currently ignored)</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>summary.orf</code> provides a short summary of the Ordered Forest estimation,
including the input information regarding the values of hyperparameters as
well as the output information regarding the prediction accuracy.
</p>


<h3>Author(s)</h3>

<p>Gabriel Okasa
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Ordered Forest
require(orf)

# load example data
data(odata)

# specify response and covariates
Y &lt;- as.numeric(odata[, 1])
X &lt;- as.matrix(odata[, -1])

# estimate Ordered Forest
orf_fit &lt;- orf(X, Y)

# show summary of the orf estimation
summary(orf_fit)

# show summary of the orf estimation coded in LaTeX
summary(orf_fit, latex = TRUE)

</code></pre>

<hr>
<h2 id='summary.orf.prediction'>Summary of the Ordered Forest Prediction</h2><span id='topic+summary.orf.prediction'></span>

<h3>Description</h3>

<p>summary of Ordered Forest predictions of class <code>orf.prediction</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'orf.prediction'
summary(object, latex = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="summary.orf.prediction_+3A_object">object</code></td>
<td>
<p>predicted Ordered Forest object of class <code>orf.prediction</code></p>
</td></tr>
<tr><td><code id="summary.orf.prediction_+3A_latex">latex</code></td>
<td>
<p>logical, if TRUE latex coded summary will be generated (default is FALSE)</p>
</td></tr>
<tr><td><code id="summary.orf.prediction_+3A_...">...</code></td>
<td>
<p>further arguments (currently ignored)</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>summary.orf.prediction</code> provides a main summary of the Ordered Forest
prediction, including the input information regarding the values of hyperparameters
as well as the inputs of the <code>predict.orf</code> function.
</p>


<h3>Author(s)</h3>

<p>Gabriel Okasa
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Ordered Forest
require(orf)

# load example data
data(odata)

# specify response and covariates for train and test
idx &lt;- sample(seq(1, nrow(odata), 1), 0.8*nrow(odata))

# train set
Y_train &lt;- as.numeric(odata[idx, 1])
X_train &lt;- as.matrix(odata[idx, -1])

# test set
Y_test &lt;- as.numeric(odata[-idx, 1])
X_test &lt;- as.matrix(odata[-idx, -1])

# estimate Ordered Forest
orf_fit &lt;- orf(X_train, Y_train)

# predict the probabilities with the estimated orf
orf_pred &lt;- predict(orf_fit, newdata = X_test)

# summary of the prediction object
summary(orf_pred)

# show summary of the orf prediction coded in LaTeX
summary(orf_pred, latex = TRUE)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
