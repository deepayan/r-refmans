<!DOCTYPE html><html><head><title>Help for package gmDatabase</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {gmDatabase}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#dbNow'>
<p>Get the actual system time</p></a></li>
<li><a href='#extractDollarExpressions'><p>Extracting a dollar expression</p></a></li>
<li><a href='#findVarsInExpression'>
<p><code>findVarsInExpression</code></p></a></li>
<li><a href='#forKeyVal'><p>forKeyVal &ndash; Looping named lists</p></a></li>
<li><a href='#gmAdd'>
<p>Adding and updating objects in a geometallurgical database.</p></a></li>
<li><a href='#gmAndify'><p>Creating a conjunction</p></a></li>
<li><a href='#gmChangePassword'>
<p>Function for changing the password of a user in the geometallurgical database.</p></a></li>
<li><a href='#gmClass'><p>Returning information from geometallurgicala database</p>
</a></li>
<li><a href='#gmConnectServer'><p>Geometallurgy Database connection</p></a></li>
<li><a href='#gmCreateClass'><p>Providing new classes and adding new users, rights groups, usergroups, etc.</p></a></li>
<li><a href='#gmExpr'>
<p>Creating gmExpressions</p></a></li>
<li><a href='#gmExpr-class'><p>Class gmExpr</p></a></li>
<li><a href='#gmGet'>
<p>Get information about an object.</p></a></li>
<li><a href='#gmGetVariableType'><p>Getting information on variables in a</p>
geometallurgy (gm)Database</a></li>
<li><a href='#gmJoinAVariable'><p>Creating the join R representation of a SQL JOIN</p></a></li>
<li><a href='#gmJoinTheID'><p>Add the ID to the selection</p></a></li>
<li><a href='#gmRead'><p>Return the result of an SQl query given as R-like representation</p></a></li>
<li><a href='#gmRemove'>
<p>Delete objects in an geometallurgical database</p></a></li>
<li><a href='#gmSQL'><p>Provide an R representation of SQL</p></a></li>
<li><a href='#gmSQLValues'><p>Format vector in parenthesis and SQL quote it</p></a></li>
<li><a href='#makeGmSQLfromR'><p>Parse an R expression of SQl statements</p></a></li>
<li><a href='#repairGmGrandChilds'>
<p>Updating second order inheritance.</p></a></li>
<li><a href='#replaceVarsInExpression'><p>Replace Variables in Expressions</p></a></li>
<li><a href='#tick'>
<p>Create a unique name</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Version:</td>
<td>0.5.0</td>
</tr>
<tr>
<td>Date:</td>
<td>2016-05-31</td>
</tr>
<tr>
<td>Title:</td>
<td>Accessing a Geometallurgical Database with R</td>
</tr>
<tr>
<td>Author:</td>
<td>K. Gerald van den Boogaart [aut, cre],
  Stephan Matos Camacho [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>K. Gerald van den Boogaart &lt;support@boogaart.de&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R(&ge; 2.1.0), DBI, RMySQL, foreach, methods, digest, shiny</td>
</tr>
<tr>
<td>Suggests:</td>
<td>MASS</td>
</tr>
<tr>
<td>Description:</td>
<td>A template for a geometallurgical database and a fast and easy
    interface for accessing it is provided in this package.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> | <a href="https://www.r-project.org/Licenses/LGPL-2">LGPL-2</a> | <a href="https://www.r-project.org/Licenses/LGPL-2.1">LGPL-2.1</a> | <a href="https://www.r-project.org/Licenses/LGPL-3">LGPL-3</a> [expanded from: GPL (&ge; 2) | LGPL (&ge; 2)]</td>
</tr>
<tr>
<td>LazyLoad:</td>
<td>TRUE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="http://www.r-project.org">http://www.r-project.org</a>, <a href="http://www.stat.boogaart.de">http://www.stat.boogaart.de</a></td>
</tr>
<tr>
<td>Copyright:</td>
<td>(C) 2016 by Helmholtz Institute Freiberg for Resource
Technology</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>5.0.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2016-06-15 12:21:07 UTC; matos58</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2016-06-16 12:32:05</td>
</tr>
</table>
<hr>
<h2 id='dbNow'>
Get the actual system time
</h2><span id='topic+dbNow'></span>

<h3>Description</h3>

<p><code>dbNow</code> retrieves the acrtual system time.</p>


<h3>Usage</h3>

<pre><code class='language-R'>dbNow()</code></pre>


<h3>Details</h3>

<p>Returns the actual system time in the format yyyy-mm-dd hh:mm:ss.</p>


<h3>Value</h3>

<p>A string.</p>


<h3>Author(s)</h3>

<p>K. Gerald van den Boogaart, S. Matos Camacho</p>


<h3>Examples</h3>

<pre><code class='language-R'>dbNow()
</code></pre>

<hr>
<h2 id='extractDollarExpressions'>Extracting a dollar expression</h2><span id='topic+extractDollarExpressions'></span>

<h3>Description</h3>

<p>Extracts the expression containing a dollar symbol.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extractDollarExpressions(EXPR)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="extractDollarExpressions_+3A_expr">EXPR</code></td>
<td>
<p>an R expression</p>
</td></tr>

</table>


<h3>Details</h3>

<p><code>extractDollarExpressions</code> extracts the expression containing a dollar symbol. Furthermore it provides an alias for it. This function is meant for internal use in <code>gmReadInternal</code>, when dollar expressions occur in bracket terms.
</p>


<h3>Value</h3>

<p>Returns a structure, containing the whole expression using the alias instead of the original dollar expression in <code>expr</code> and the dollar expression itself in <code>dollarExpr</code>.  
</p>


<h3>Author(s)</h3>

<p>K. Gerald van den Boogaart, S. Matos Camacho</p>


<h3>See Also</h3>

<p><code><a href="#topic+gmReadInternal">gmReadInternal</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>extractDollarExpressions(quote(root$project == 2))
</code></pre>

<hr>
<h2 id='findVarsInExpression'>
<code>findVarsInExpression</code>
</h2><span id='topic+findVarsInExpression'></span>

<h3>Description</h3>

<p>parses expressions and returns the variables
</p>


<h3>Usage</h3>

<pre><code class='language-R'>findVarsInExpression(EXPR)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="findVarsInExpression_+3A_expr">EXPR</code></td>
<td>
<p>a call object representing an R expression</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>findVarsInExpression</code> takes a call and returns the names. It is used in <code>gmReadInternal</code> for parsing an R expression of an SQL query for variables.
</p>


<h3>Value</h3>

<p>A string consisting of the variables.
</p>


<h3>Author(s)</h3>

<p>K. Gerald van den Boogaart, S. Matos Camacho
</p>


<h3>See Also</h3>

<p><code><a href="#topic+replaceVarsInExpression">replaceVarsInExpression</a></code>, <code><a href="#topic+gmReadInternal">gmReadInternal</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>a &lt;- quote( A==B^C+A^2+C )
findVarsInExpression(a)
</code></pre>

<hr>
<h2 id='forKeyVal'>forKeyVal &ndash; Looping named lists</h2><span id='topic+forKeyVal'></span>

<h3>Description</h3>

<p>forKeyVal loops a named list or vector, with one variable bound to the
key and another to the value. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>forKeyVal(key,val,LIST,block,envir=parent.frame())
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="forKeyVal_+3A_key">key</code></td>
<td>
<p>the variable to be bound by the name of the element of the LIST</p>
</td></tr>
<tr><td><code id="forKeyVal_+3A_val">val</code></td>
<td>
<p>the variable to be bound by the value of the element of the LIST</p>
</td></tr>
<tr><td><code id="forKeyVal_+3A_list">LIST</code></td>
<td>
<p>a list</p>
</td></tr>
<tr><td><code id="forKeyVal_+3A_block">block</code></td>
<td>
<p>the block to be exectued, with this variables bound</p>
</td></tr>
<tr><td><code id="forKeyVal_+3A_envir">envir</code></td>
<td>
<p>the environment in which the variables are bound and the
block is executed</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It works much like a <code>for(val in LIST) block</code> with the
difference. It however additionally binds key to the value name of the
list element, but does not recognize continue or break
statements. This might change at some point in future.
<br />
Empty or unbound names result in a binding of key to <code>NULL</code>.
</p>


<h3>Value</h3>

<p>the value of the last execution of the block
</p>


<h3>Author(s)</h3>

<p>K. Gerald van den Boogaart</p>


<h3>See Also</h3>

<p><code><a href="base.html#topic+for">for</a></code>, <code><a href="base.html#topic+lapply">lapply</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>forKeyVal(name,x,c(a=1,b=5,c=6),{
  cat(name,"=&gt;",x,"\n")
})

forKeyVal(name,x,list(a=4,b=1:7,c=c(a="Aber",b="nicht")), {
  cat(name,"\n",sep="")
  if(is.null(names(x)))
    names(x) &lt;- 1:length(x)
  forKeyVal(iname,x,x,{
    cat(name,".",iname,"=&gt;",x,"\n",sep="")
  })
})
</code></pre>

<hr>
<h2 id='gmAdd'>
Adding and updating objects in a geometallurgical database.
</h2><span id='topic+gmAdd'></span><span id='topic+gmSet'></span>

<h3>Description</h3>

<p><code>gmAdd</code> adds a new object to a geometallurgical database. Its attributes can be set and updated with <code>gmSet</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gmAdd(where, what, data, rg=getOption("defaultRightsGroup"), EXPR=substitute(where), 
  envir=parent.frame(), db=getOption("gmDB"), force=FALSE)
gmSet(where, data, varID=NULL, childs=NULL, members=NULL,EXPR=substitute(where), 
  envir=parent.frame(), db=getOption("gmDB"), update=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gmAdd_+3A_where">where</code></td>
<td>
<p>an expression specifying where in the hierarchical structure of the database the new object(s) should be added.</p>
</td></tr>
<tr><td><code id="gmAdd_+3A_what">what</code></td>
<td>
<p>specifies the variable type of the new object(s). Apart from an R expression of an SQL query or a <code>gmExpr</code>, a ID from the database
is possible, too.</p>
</td></tr>
<tr><td><code id="gmAdd_+3A_data">data</code></td>
<td>
<p>list or data frame giving attributes for the new object(s).</p>
</td></tr>
<tr><td><code id="gmAdd_+3A_rg">rg</code></td>
<td>
<p>states the id of the rights groups this object will belongs to.</p>
</td></tr>
<tr><td><code id="gmAdd_+3A_varid">varID</code></td>
<td>
<p>the variable ID of the objects to be updated</p>
</td></tr>
<tr><td><code id="gmAdd_+3A_childs">childs</code></td>
<td>
<p>a data frame containing the class member of the object to be updated</p>
</td></tr>
<tr><td><code id="gmAdd_+3A_members">members</code></td>
<td>
<p>a vector containing the names of the class members of <code>what</code>, which will be updated</p>
</td></tr>
<tr><td><code id="gmAdd_+3A_expr">EXPR</code></td>
<td>
<p>the quoted version of <code>where</code>.</p>
</td></tr>
<tr><td><code id="gmAdd_+3A_envir">envir</code></td>
<td>
<p>defines the environment used for evaluation of <code>where</code>.</p>
</td></tr>
<tr><td><code id="gmAdd_+3A_db">db</code></td>
<td>
<p>defines the database, on which the query will be run.</p>
</td></tr>
<tr><td><code id="gmAdd_+3A_force">force</code></td>
<td>
<p>logical: if <code>FALSE</code>, the case of missing required class members results in an abortion, otherwise only warnings are printed.</p>
</td></tr>
<tr><td><code id="gmAdd_+3A_update">update</code></td>
<td>
<p>logical: if <code>TRUE</code>, set objects will be updated instead of adding new entries.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>gmAdd</code> adds one or more new objects of the specified variable name to a geometallurgical database. The number of new objects is determined by
<code>data</code>. This is a list or data frame stating values for the class members of each new object. If <code>force=TRUE</code> missing required class 
members are ignored and a warning is given. If <code>force=FALSE</code> the insert is aborded in the case of missing required members with a corresponding
error message. If no rights group is given the object will not be linked to the default rights group. If that is not explicitly set by 
<code><a href="#topic+gmDefaultRightsGroup">gmDefaultRightsGroup</a></code> the new object will not be linked to any rights group. Therefore it will be accessible by everyone. 
</p>
<p>For the actual insertion of the values of the members, the function <code>gmSet</code> is used. If a member given in <code>data</code> is already set for this 
object, then the database is being updated. Otherwise this attribute is added. Attributes which are not allowed for this object result in an abortion
and an error message.
</p>
<p>If <code>gmSet</code> is used outside <code>gmAdd</code> the argmuments <code>varID</code>, <code>childs</code> and <code>members</code> may be missing and therefore set to
<code>NULL</code>. Then they are queried prior to the insertion. This setting is used to determine, if <code>gmSet</code> is called by <code>gmAdd</code>. If 
<code>data</code> contains a set object, setting the argument <code>update</code> to <code>TRUE</code> prohibits updating this member. Instead an additional entry
is added.
</p>
<p>If <code>gmSet</code> is called by <code>gmAdd</code> and a creationTime is missing in <code>data</code>, <code>gmSet</code> adds the actual time instead.
Since that for variables of the type set more than one entry is permitted, you have the possibility of updating the entry or adding a new reference
by setting <code>update=FALSE</code>. If there is already more than one entry, updating is not permitted. 
</p>


<h3>Value</h3>

<p><code>gmAdd</code> returns the gmID of the first added object.
</p>


<h3>Author(s)</h3>

<p>K. Gerald van den Boogaart, S. Matos Camacho</p>


<h3>See Also</h3>

<p><code><a href="#topic+gmRead">gmRead</a></code>, <code><a href="#topic+gmExpr">gmExpr</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  gmAdd(root,"project",list(gmTitle="sunny thursday", gmCreator=3))
  gmSet(root$project[gmTitle=="sunny thursday"], list(gmName="something"))
  
## End(Not run)
</code></pre>

<hr>
<h2 id='gmAndify'>Creating a conjunction</h2><span id='topic+gmAndify'></span>

<h3>Description</h3>

<p><code>gmAndify</code> creates a call, which is a conjunction of list elements given in its arguments for further use in ON or WHERE clauses of SQL statements
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gmAndify(l,and="&amp;")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gmAndify_+3A_l">l</code></td>
<td>
<p>list of elements, which shall be conjuncted</p>
</td></tr>
<tr><td><code id="gmAndify_+3A_and">and</code></td>
<td>
<p>determines the kind of conjunction being used. Default case is the logical AND.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Instead of a conjunction you can create a disjunction using <code>and="|"</code>. This function is in <code><a href="#topic+gmReadInternal">gmReadInternal</a></code>
</p>


<h3>Value</h3>

<p>A string of class <code>call</code> for further use.</p>


<h3>Author(s)</h3>

<p>K. Gerald van den Boogaart, S. Matos Camacho
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gmRead">gmRead</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>gmAndify(c("a","b"))
</code></pre>

<hr>
<h2 id='gmChangePassword'>
Function for changing the password of a user in the geometallurgical database. 
</h2><span id='topic+gmChangePassword'></span>

<h3>Description</h3>

<p>A gui for changing the password of user in the database.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gmChangePassword(db=getOption("gmDB"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gmChangePassword_+3A_db">db</code></td>
<td>
<p>A database connection object as returned by <code>gmConnectServer</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>gmChangePassword</code> allows the user to change the password for accessing data in the database. It uses <code><a href="shiny.html#topic+shiny">shiny</a></code> to provide aa gui, that hides the letters of an entered password. 
</p>


<h3>Author(s)</h3>

<p>S. Matos Camacho
</p>


<h3>See Also</h3>

<p><code><a href="shiny.html#topic+shiny">shiny</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
gmChangePassword()

## End(Not run)
</code></pre>

<hr>
<h2 id='gmClass'>Returning information from geometallurgicala database

</h2><span id='topic+gmClass'></span><span id='topic+gmClassMembers'></span>

<h3>Description</h3>

<p>Get information on given object or variable from the database.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gmClass(expr, var, envir=parent.frame(), EXPR=substitute(expr),db=getOption("gmDB"))
gmClassMembers(expr, var, envir=parent.frame(), EXPR=substitute(expr),
                db=getOption("gmDB"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gmClass_+3A_expr">expr</code></td>
<td>
<p>R expression of an SQL query. Expressions created with <code><a href="#topic+gmExpr">gmExpr</a></code> can be used as well.</p>
</td></tr>
<tr><td><code id="gmClass_+3A_var">var</code></td>
<td>
<p>a number or variable name specifying a variable.</p>
</td></tr>
<tr><td><code id="gmClass_+3A_envir">envir</code></td>
<td>
<p>defines the environment used for evaluation of <code>expr</code></p>
</td></tr>
<tr><td><code id="gmClass_+3A_expr">EXPR</code></td>
<td>
<p>The quoted version of such an expression.</p>
</td></tr>
<tr><td><code id="gmClass_+3A_db">db</code></td>
<td>
<p>defines the database, on which the query will be run.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If you want information on a special variable in the database, specify <code>var</code>. You may use its variable id or the variable name. If <code>var</code> is missing information on the object(s) specified by <code>expr</code> is retrieved. 
</p>
<p><code>gmClass</code> gives information on the variable itself or the variable the object is. <code>gmClassMembers</code> shows information about all possible members of a variable or the variable the object is.
</p>


<h3>Value</h3>

<p><code>gmClass</code> returns a data frame containing the <code>id</code>, <code>gmVarID</code>, <code>gmVarTypeID</code>, <code>gmVarName</code>, and <code>gmVarDescription</code> of the desired variable or object. If the object is not distinct, then information for every object retrieved. 
<code>gmClassMembers</code> returns a data frame containing the <code>gmVarID</code> and <code>gmVarName</code> of this all of the possible given members of variable respectively object. <code>required</code> is a boolean stating if the member is mandatory or not, <code>definer</code> states the variable, where this member is defined. If it is not inheritated, then the variable itself is given.</p>


<h3>Author(s)</h3>

<p>K. Gerald van den Boogaart, S. Matos Camacho</p>


<h3>See Also</h3>

<p><code><a href="#topic+gmGet">gmGet</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
.gmDB &lt;- dbConnect(...)
root &lt;- "root"
gmClass(root)
## returns information on the root in the database

gmClass(root$project)
## returns information on every project in root in the database

gmClass(var="project")
## returns information on the variable/class project

gmClass(var=2)
## returns information on the variable with variable id 2

## End(Not run)</code></pre>

<hr>
<h2 id='gmConnectServer'>Geometallurgy Database connection</h2><span id='topic+gmCreateDB'></span><span id='topic+gmDisconnectServer'></span><span id='topic+gmListVariables'></span><span id='topic+gmListVariableTypes'></span><span id='topic+gmDBSummary'></span><span id='topic+gmEscapeStrings'></span><span id='topic+gmConnectServer'></span><span id='topic+gmRequest'></span><span id='topic+gmRequest+2Ccharacter+2Clist+2CANY-method'></span><span id='topic+gmRequest+2Ccharacter+2Clist+2CMySQLConnection-method'></span>

<h3>Description</h3>

<p>A geometallurgy database is a database on a relational database
server. It can handle very general and recursive information for
the transparent access to whole projects from a statistical analysis
software.  
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gmConnectServer(..., server="localhost", dbuser, asDefault=TRUE)
gmDisconnectServer(db=getOption("gmDB"))
gmCreateDB(..., dbName="gmDatabase", admin=NULL, adminPwd=NULL)
gmListVariables(pattern="%",db=getOption("gmDB"))
gmListVariableTypes(db=getOption("gmDB"))
gmDBSummary(db=getOption("gmDB"))
gmEscapeStrings(s,db=getOption("gmDB"))
gmRequest(fun, parameters, db)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gmConnectServer_+3A_...">...</code></td>
<td>
<p>Arguments to <code><a href="DBI.html#topic+dbConnect">dbConnect</a></code> from RMySQL to contact the
database server.</p>
</td></tr>
<tr><td><code id="gmConnectServer_+3A_asdefault">asDefault</code></td>
<td>
<p>Logical indicating whether being used as default connection.</p>
</td></tr>
<tr><td><code id="gmConnectServer_+3A_db">db</code></td>
<td>
<p>A database connection object as returned by <code>gmConnectServer</code>.</p>
</td></tr>
<tr><td><code id="gmConnectServer_+3A_server">server</code></td>
<td>
<p>The address of the server, where the R server.</p>
</td></tr>
<tr><td><code id="gmConnectServer_+3A_dbuser">dbuser</code></td>
<td>
<p>A list giving the <code>login</code> and <code>password</code> of the user working in the geometallurgical database.</p>
</td></tr>
<tr><td><code id="gmConnectServer_+3A_dbname">dbName</code></td>
<td>
<p>String stating the name for the database to-be.</p>
</td></tr>
<tr><td><code id="gmConnectServer_+3A_admin">admin</code></td>
<td>
<p>The login for the administrator/the first database user.</p>
</td></tr>
<tr><td><code id="gmConnectServer_+3A_adminpwd">adminPwd</code></td>
<td>
<p>The password for the administrator/the database user.</p>
</td></tr>
<tr><td><code id="gmConnectServer_+3A_pattern">pattern</code></td>
<td>
<p>An SQL-regular expression (for LIKE) to specify the
variable names to be listed.</p>
</td></tr> 
<tr><td><code id="gmConnectServer_+3A_s">s</code></td>
<td>
<p>A character vector of strings to be escaped.</p>
</td></tr>
<tr><td><code id="gmConnectServer_+3A_fun">fun</code></td>
<td>
<p>A function name.</p>
</td></tr>
<tr><td><code id="gmConnectServer_+3A_parameters">parameters</code></td>
<td>
<p>A list of parameters for the function <code>fun</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The geometallurgy database provides an abstraction layer to a
relational database storage of many eventually differently structured
datasets, which might contain datasets recursively. Only in this very
complex structure it is possible to respresent the data needed for
typical statistical tasks of geometallurgy.
</p>
<p>The data storage starts from a common root object &quot;root&quot;, which
contains a variable set variable &quot;project&quot;. 
</p>
<p>The Database connection is handled by <code>gmConnectServer</code> and <code>gmDisconnectServer</code>. In order to assure a proper rights management, the 
user does not directly connect to the database. We implemented a two level security system. The first level represents the connection to the 
database server. Therefore a general user on the server is needed, who is provided with the required rights to access and manipulate the database 
itself. The corresponding credentials are compiled in <code>...</code> and will be forwarded to <a href="DBI.html#topic+dbConnect">dbConnect</a> from the package RMySQL.
Data access happens on the second level, where the <code>dbuser</code> is involved. His credentials are checked against the information stored in the 
database. Everytime some information is queried from the database, the result is given according to the rights this user owns on this particular
data. If no user is explicitly given during the function call, i.e. <code>dbuser</code> is missing, <code>gmConnectServer</code> will start a dialog to access
the (db)user's credentials. Same is true, if information on the general database server user is omitted.
</p>
<p>In order to create a compatible database, you may <code>gmCreateDB</code>. A connection to the given MySQL-server is established and a new database of
the given <code>dbName</code> is created. Furthermore first variables to realise the user/rights management are provided. Additonally a first 
user/admin is added to the database with the given username and password, so that this user is able to login to the database afterwards. If no 
MySQL login, MySQL password or MySQL host is given, a shiny app requests these information. Same happens if no login or password is given for the 
first user/admin.
</p>
<p>This package can be used in a client - server approach. Then <code>gmConnectServer</code> will not return a database connection, but a socket
connection. It will be used to send the commands to an R server. The actual translation from R into SQL is then done on the server. Again only 
the accessible data according to the user's rights will be returned. In order to activate the client-server mode, use the argument <code>server</code> 
to state the server you want to access. By default <code>server</code> is set to <code>localhost</code>.
</p>
<p><code>gmRequest</code> is an internal function. It should not be called directly. Depending on the class of database connection used, it decides if the
<code>fun</code> is evaluated locally or handed over to the server.
</p>


<h3>Value</h3>

<table>
<tr><td><code>gmConnectServer</code></td>
<td>
<p>Returns a server connection to be used in subsequent calls. It is assigned to the hidden variable <code>.gmDB</code>.
If <code>server</code> ist set to localhost, it will be a database connection instead.</p>
</td></tr>
<tr><td><code>gmDisconnectServer</code></td>
<td>
<p>Returns the same as <code>gmDisconnectDB</code>. Additionally <code>.gmDB</code> is set to zero.</p>
</td></tr>
<tr><td><code>gmCreateDB</code></td>
<td>
<p>No return value.</p>
</td></tr>
<tr><td><code>gmListVariables</code></td>
<td>
<p>Returns a dataframe describing the variables
defined in the geometallurgy database.</p>
</td></tr>
<tr><td><code>gmListVariableTypes</code></td>
<td>
<p>Returns a dataframe describing the variable
types defined in the geometallurgy database.</p>
</td></tr>
<tr><td><code>gmDBSummary</code></td>
<td>
<p>Returns a dataframe giving variable name,
variable type and number of objects 
for each variable.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>K. Gerald van den Boogaart, S. Matos Camacho</p>


<h3>See Also</h3>

<p><code><a href="RMySQL.html#topic+MySQLConnection-class">MySQLConnection-class</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
gmCreateDB(MySQL(), user="mysqlUser", password="mysqlPassword", host="mysqlServer", 
  dbName="myDB", admin="admin",adminPwd="myAdminPassword")
gmConnectServer(MySQL(), group="test", server="localhost")
gmListVariables(pattern=".*",db=.gmDB)
gmListVariableTypes(db=.gmDB)
gmDBSummary(db=.gmDB)
gmDisconnectServer()


## End(Not run)
</code></pre>

<hr>
<h2 id='gmCreateClass'>Providing new classes and adding new users, rights groups, usergroups, etc.</h2><span id='topic+gmCreateClass'></span><span id='topic+gmAddMembers'></span><span id='topic+gmCreateRightsGroup'></span><span id='topic+gmCreateUserGroup'></span><span id='topic+gmSetRights'></span><span id='topic+gmAddUserToGroup'></span><span id='topic+gmSetRightsGroup'></span><span id='topic+gmCreateUser'></span><span id='topic+gmDefaultRightsGroup'></span>

<h3>Description</h3>

<p>For working with a (geometallurgical) database you need at least some users, rights groups to manage their access rights, or 
classes/variables, you want to store the data.</p>


<h3>Usage</h3>

<pre><code class='language-R'>gmCreateClass(name, type, description, parent="gmObject", 
  envir=parent.frame(), db=getOption("gmDB"))
gmAddMembers(class, members, required, envir=parent.frame(), db=getOption("gmDB"))
gmCreateRightsGroup(rightsGroup, envir=parent.frame(), db=getOption("gmDB"))
gmCreateUserGroup(userGroup, envir=parent.frame(), db=getOption("gmDB"))
gmSetRights(userGroup, rightsGroup, write=TRUE, read=TRUE, 
  envir=parent.frame(), db=getOption("gmDB"))
gmAddUserToGroup(user, userGroup, envir=parent.frame(), db=getOption("gmDB")) 
gmSetRightsGroup(object, rightsGroup, envir=parent.frame(), db=getOption("gmDB"))
gmCreateUser(user, password, userGroups, envir=parent.frame(), db=getOption("gmDB"))
gmDefaultRightsGroup(rightsGroup, db=getOption("gmDB"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gmCreateClass_+3A_name">name</code></td>
<td>
<p>The name of the new class, which shall be created.</p>
</td></tr>
<tr><td><code id="gmCreateClass_+3A_type">type</code></td>
<td>
<p>The type of the new class.</p>
</td></tr>
<tr><td><code id="gmCreateClass_+3A_description">description</code></td>
<td>
<p>A short description of the calss and what it is for.</p>
</td></tr>
<tr><td><code id="gmCreateClass_+3A_parent">parent</code></td>
<td>
<p>The super class of the new one.</p>
</td></tr>
<tr><td><code id="gmCreateClass_+3A_class">class</code></td>
<td>
<p>The name of the class to which the members shall be added.</p>
</td></tr>
<tr><td><code id="gmCreateClass_+3A_members">members</code></td>
<td>
<p>The names of the new class members.</p>
</td></tr>
<tr><td><code id="gmCreateClass_+3A_required">required</code></td>
<td>
<p>A logical. If <code>TRUE</code> this member has to be initialised, when an instance of the object is added to the database.</p>
</td></tr>
<tr><td><code id="gmCreateClass_+3A_rightsgroup">rightsGroup</code></td>
<td>
<p>The name or, if it refers an existing one, ID of the rights group.</p>
</td></tr>
<tr><td><code id="gmCreateClass_+3A_usergroup">userGroup</code></td>
<td>
<p>The name or, if it refers an existing one, ID of the usergroup</p>
</td></tr>
<tr><td><code id="gmCreateClass_+3A_user">user</code></td>
<td>
<p>The username oder ID of the user, who shall be added.</p>
</td></tr>
<tr><td><code id="gmCreateClass_+3A_write">write</code></td>
<td>
<p>A logical. If <code>TRUE</code> the stated usergroup is granted writing rights.</p>
</td></tr>
<tr><td><code id="gmCreateClass_+3A_read">read</code></td>
<td>
<p>A logical. If <code>TRUE</code> the stated usergroup is granted reading rights.</p>
</td></tr>
<tr><td><code id="gmCreateClass_+3A_object">object</code></td>
<td>
<p>An ID or <code>gmExpr</code> of the object, for that the rights group shall be determined.</p>
</td></tr>
<tr><td><code id="gmCreateClass_+3A_password">password</code></td>
<td>
<p>The password of the new user.</p>
</td></tr>
<tr><td><code id="gmCreateClass_+3A_usergroups">userGroups</code></td>
<td>
<p>The usergroups the new user shall be part of.</p>
</td></tr>
<tr><td><code id="gmCreateClass_+3A_envir">envir</code></td>
<td>
<p>defines the environment used for evaluation of the other arguments.</p>
</td></tr>
<tr><td><code id="gmCreateClass_+3A_db">db</code></td>
<td>
<p>A database connection object as returned by <code>gmConnectServer</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>gmCreateClass</code> allows the suer to add a new variable/class to the database. If <code>set</code> is given a type, the new class will be inferred from <code>parent</code>, which is <code>gmObject</code> by default.
</p>
<p><code>gmAddMembers</code> allows to add classes/variable to other classes. The option <code>required</code> determines, if this member must be initialised during construction of an instance of <code>class</code>.
</p>
<p><code>gmCreateRightsGroup</code> and <code>gmCreateUserGroup</code> create new rights or user groups. A rights group contains the sets <code>readers</code> and <code>writers</code>, consisting of usergroups, which determine, who is allowed to access or change an object. The rights group of an object can be set with <code>gmSetRights</code> after the initialisation of the object.
</p>
<p><code>gmCreateUser</code> is for creation of a new user. You may add this new user to the appropriate usergroups using <code>gmAddUserToGroup</code>. 
</p>
<p>During object initialisation using <a href="#topic+gmAdd">gmAdd</a> the arguments <code>rg</code> can give the needed rights group. If is not given, a default value is used. This can be set by <code>gmDefaultRightsGroup</code>. 
</p>


<h3>Value</h3>

<p><code>gmCreateRightsGroup</code> and <code>gmCreateUserGroup</code> return the gmID of this object.
</p>


<h3>Author(s)</h3>

<p>S. Matos Camacho</p>


<h3>See Also</h3>

<p><a href="#topic+gmConnectServer">gmConnectServer</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
gmConnectServer(MySQL(), host="myServer.mydomain.edu", user="mysqlUser",
  passwd="mysqlPassword", dbname="myDB")

rg = gmCreateRightsGroup("Protected")
ug = gmCreateUserGroup("Admins")
gmSetRights("Admins","Protected",read=TRUE,write=TRUE)
gmAddUserToGroup("admin","Admins")

gmSetRightsGroup(rg,"Protected")
gmSetRightsGroup(ug,"Protected")

rg = gmCreateRightsGroup("general")
ug = gmCreateUserGroup("users")
gmSetRightsGroup(c(rg,ug),"Protected")

gmAddUserToGroup("admin","users")
gmSetRights("users", "general", read=TRUE, write=TRUE)

gmCreateUser("myuser","mypassword",c("users"))
gmCreateUser(userGroups=c("users"))
gmDisconnectServer()

gmConnectDB(server="myServer.mydomain.edu",user="mysqlUser",passwd="mysqlPassword")
gmDefaultRightsGroup("general")

gmListVariables()

gmCreateClass("sample","set","a material sample",parent="gmObject")
gmAddMembers("root","sample", required=FALSE)
gmClassMembers(var="sample")
gmAdd(root,"sample",data.frame(gmName="Sample1"))

gmDisconnectServer()

## End(Not run)
</code></pre>

<hr>
<h2 id='gmExpr'>
Creating gmExpressions
</h2><span id='topic+gmExpr'></span><span id='topic+root'></span>

<h3>Description</h3>

<p><code>gmExpr</code> creates a gmExpression
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gmExpr(expr,...,envir=parent.frame(),EXPR=substitute(expr))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gmExpr_+3A_expr">expr</code></td>
<td>
<p>an R-like representation of an SQL query.</p>
</td></tr>
<tr><td><code id="gmExpr_+3A_envir">envir</code></td>
<td>
<p>defines the environment used for evaluation of <code>expr</code>.</p>
</td></tr>
<tr><td><code id="gmExpr_+3A_expr">EXPR</code></td>
<td>
<p>The quoted version of such an expression.</p>
</td></tr>
<tr><td><code id="gmExpr_+3A_...">...</code></td>
<td>
<p>further arguments for later use in other methods.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>gmExpr</code> creates an object of class <code>gmExpr</code>, which can be used as argument in <code>gmRead</code> instead of a string. Furthermore it can be extended like any other expression used in <code>gmRead</code>.
For use in the geometallurgical database you need to begin every expression with <code>root</code>, since data storage starts from this common root object.
</p>
<p>The composition of an expression is done in the following way: for accessing a certain object in a class, use the <code>$</code>-operator, to access its elements use square brackets <code>[]</code>. By specifying <code>columnName=operation</code> the user can control the content of a column in the the output. Named columns are always shown in the result. If they need to be dropped set them to operation <code>drop</code>. If you want to group objects by a named column, set its operation to <code>group</code>. This grouping can only be done for elements at least one step down in the hierarchy.
</p>


<h3>Value</h3>

<p>An object of class <code>gmExpr</code>, containing the expression in <code>$EXPR</code> and the <code>envir</code> as attribute.
</p>


<h3>Author(s)</h3>

<p>K. Gerald van den Boogaart, S. Matos Camacho
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gmRead">gmRead</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>expr &lt;- gmExpr(root$project)
## Not run: 
gmConnectServer(MySQL(), ...)
gmRead(expr$series)

gmRead(expr$series[name=gmTitle, name=drop])
## naming the element gmTitle as name and dropping it in the result

gmRead(expr[pID=id]$series[name=gmTitle, pID=group])
## grouping the series by their corresponding project in the result

## End(Not run)
</code></pre>

<hr>
<h2 id='gmExpr-class'>Class gmExpr</h2><span id='topic+gmExpr-class'></span>

<h3>Description</h3>

<p><code>gmExpr</code> can be generated using the function <a href="#topic+gmExpr">gmExpr</a>. It has two slots. Such an object can be used as argument on <code>gmRead</code></p>


<h3>Slots</h3>


<dl>
<dt>EXPR</dt><dd><p>stores the expression itself.</p>
</dd>
<dt>envir</dt><dd><p>defines the environment used for evaluation of <code>expr</code>.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>K. Gerald van den Boogaart, S. Matos Camacho
</p>


<h3>See Also</h3>

<p><code><a href="#topic+gmRead">gmRead</a></code>, <code><a href="#topic+gmExpr">gmExpr</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>myExpr &lt;- gmExpr(root)

myExpr
</code></pre>

<hr>
<h2 id='gmGet'>
Get information about an object.
</h2><span id='topic+gmGet'></span><span id='topic+gmGetVar'></span>

<h3>Description</h3>

<p><code>gmGet</code> retrieves the information on specified objects stored in a geometallurgical database.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gmGet(expr,envir=parent.frame(),EXPR=substitute(expr),db=getOption("gmDB"))
gmGetVar(expr,what,EXPR=substitute(expr),envir=parent.frame(),db=getOption("gmDB"),
          unique=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gmGet_+3A_expr">expr</code></td>
<td>
<p>R expression of an SQL query. Expressions created with <code><a href="#topic+gmExpr">gmExpr</a></code> can be used as well.</p>
</td></tr>
<tr><td><code id="gmGet_+3A_what">what</code></td>
<td>
<p>The members/variables you want the information from.</p>
</td></tr>
<tr><td><code id="gmGet_+3A_envir">envir</code></td>
<td>
<p>defines the environment used for evaluation of <code>expr</code>.</p>
</td></tr>
<tr><td><code id="gmGet_+3A_expr">EXPR</code></td>
<td>
<p>The quoted version of such an expression.</p>
</td></tr>
<tr><td><code id="gmGet_+3A_db">db</code></td>
<td>
<p>The database connection for the query.</p>
</td></tr>
<tr><td><code id="gmGet_+3A_unique">unique</code></td>
<td>
<p>logical: If TRUE the execution is stopped in the case of multiple variables of the same requested variable name.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Every object corresponding to the query is referred by its id. <code>gmGet</code> delivers a list consisting of a data frame <code>info</code> and another list <code>sets</code>. In <code>info</code> the values of all atomic members for every found object are stated. <code>sets</code> consists of data frames, called after the composite member variables, stating the object id and the id of the member object. Since these members are sets, it is possible that the data frames consist of several member objects for one referred object.
</p>
<p>If you are interested in information on a certain variable but not the content of variables of this kind, use <code>gmGetVar</code> instead.</p>


<h3>Value</h3>

<p>list for <code>gmGet</code>, data.frame for <code>gmGetVar</code></p>


<h3>Author(s)</h3>

<p>K. Gerald van den Boogaart, S. Matos Camacho</p>


<h3>See Also</h3>

<p><code><a href="#topic+gmRead">gmRead</a></code>, <code><a href="#topic+gmExpr">gmExpr</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: gmGet(root)
gmGetVar(root, "gmUser")
## End(Not run)
  </code></pre>

<hr>
<h2 id='gmGetVariableType'>Getting information on variables in a
geometallurgy (gm)Database</h2><span id='topic+gmGetVariableType'></span>

<h3>Description</h3>

<p>Reads the variable name metainformation from the gmDatabase.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gmGetVariableType(sel,name,selID=attr(sel,"id"),db=getOption("gmDB"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gmGetVariableType_+3A_sel">sel</code></td>
<td>
<p>A call representing the intended SQL
expression as R expression.</p>
</td></tr>
<tr><td><code id="gmGetVariableType_+3A_name">name</code></td>
<td>
<p>A character vector giving the names of the variables to be
read.</p>
</td></tr>
<tr><td><code id="gmGetVariableType_+3A_selid">selID</code></td>
<td>
<p>The ID attribute of the selection.</p>
</td></tr>
<tr><td><code id="gmGetVariableType_+3A_db">db</code></td>
<td>
<p>The database connection to the geometallurgical database.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The geometallurgical database allows to store recursive dataframes of
arbitrary content, provided that the same variable always contains the
same type of information. This command allows to get the information
on defined variables including their information. 
</p>


<h3>Value</h3>

<p>A dataframe with column name, table, decription and var, giving the
name of the variable, the database table storing the information, the
description (definition) of the variable, and the column of the
database containing this data. 
</p>


<h3>Author(s)</h3>

<p>K. Gerald van den Boogaart</p>

<hr>
<h2 id='gmJoinAVariable'>Creating the join R representation of a SQL JOIN</h2><span id='topic+gmJoinAVariable'></span><span id='topic+gmJoinADollarExpr'></span>

<h3>Description</h3>

<p>Queries the variable types of the variables, which shall be joined, and creates the R presentation of an SQL JOIN.</p>


<h3>Usage</h3>

<pre><code class='language-R'>gmJoinAVariable(sel,var,nameUse=var,bind=TRUE,db=getOption("gmDB"),selID=attr(sel,"id"))
gmJoinADollarExpr(sel,expr,nameUse,envir,bind=TRUE,db=getOption("gmDB"),
                    gmNameVarID=getGmNameVarID(db))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gmJoinAVariable_+3A_sel">sel</code></td>
<td>
<p>The selection statement in R representation.</p>
</td></tr>
<tr><td><code id="gmJoinAVariable_+3A_var">var</code></td>
<td>
<p>R expression of an SQL query.</p>
</td></tr>
<tr><td><code id="gmJoinAVariable_+3A_nameuse">nameUse</code></td>
<td>
<p>the names used for the variables</p>
</td></tr>
<tr><td><code id="gmJoinAVariable_+3A_envir">envir</code></td>
<td>
<p>defines the environment used for evaluation of <code>expr</code></p>
</td></tr>
<tr><td><code id="gmJoinAVariable_+3A_bind">bind</code></td>
<td>
<p>should the variable be bound</p>
</td></tr>
<tr><td><code id="gmJoinAVariable_+3A_db">db</code></td>
<td>
<p>The database connection to the material analysis database.</p>
</td></tr>
<tr><td><code id="gmJoinAVariable_+3A_selid">selID</code></td>
<td>
<p>The ID attribute of the selection.</p>
</td></tr>
<tr><td><code id="gmJoinAVariable_+3A_expr">expr</code></td>
<td>
<p>An R expression.</p>
</td></tr>
<tr><td><code id="gmJoinAVariable_+3A_gmnamevarid">gmNameVarID</code></td>
<td>
<p>The gmVarID of gmName from the database.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Internals functions for constructing a SQL statement.
</p>


<h3>Value</h3>

<p>For <code>gmJoinADollarExpression</code> the new selection expression, where the dollar expression is added.
</p>


<h3>Author(s)</h3>

<p>K. Gerald van den Boogaart, S. Matos Camacho</p>

<hr>
<h2 id='gmJoinTheID'>Add the ID to the selection</h2><span id='topic+gmJoinTheID'></span>

<h3>Description</h3>

<p><code>gmJoinTheID</code> joins the ID attribute to the selection   
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gmJoinTheID(sel,nameUse,db=getOption("gmDB"),front=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gmJoinTheID_+3A_sel">sel</code></td>
<td>
<p>The selection statement in R representation.</p>
</td></tr>
<tr><td><code id="gmJoinTheID_+3A_nameuse">nameUse</code></td>
<td>
<p>The name for the selection statement.</p>
</td></tr>
<tr><td><code id="gmJoinTheID_+3A_db">db</code></td>
<td>
<p>The database connection to the material analysis database.</p>
</td></tr>
<tr><td><code id="gmJoinTheID_+3A_front">front</code></td>
<td>
<p>A boolean determining if this ID shall become the first column in the later data frame. Default is FALSE.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The variable <code>nameUse</code> will be used as name of the selection later referring. This function is intended for internal use in <code>gmReadInternal</code> only.</p>


<h3>Value</h3>

<p>The changed selection call.</p>


<h3>Author(s)</h3>

<p>K. Gerald van den Boogaart, S. Matos Camacho</p>


<h3>See Also</h3>

<p><code><a href="#topic+gmReadInternal">gmReadInternal</a></code>
</p>

<hr>
<h2 id='gmRead'>Return the result of an SQl query given as R-like representation</h2><span id='topic+gmRead'></span><span id='topic+gmReadInternal'></span>

<h3>Description</h3>

<p><code>gmRead</code> translates the R representation <code>expr</code> of an SQL query into SQL and evaluates it in the database <code>db</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gmRead(expr,envir=parent.frame(),EXPR=substitute(expr),limit=-1,db=getOption("gmDB"))
gmReadInternal(EXPR,sel=NULL,db,gmNameVarID=getGmNameVarID(db))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gmRead_+3A_expr">expr</code></td>
<td>
<p>R expression of an SQL query. Expressions created with <code><a href="#topic+gmExpr">gmExpr</a></code> can be used as well.</p>
</td></tr>
<tr><td><code id="gmRead_+3A_envir">envir</code></td>
<td>
<p>defines the environment used for evaluation of <code>expr</code>.</p>
</td></tr>
<tr><td><code id="gmRead_+3A_expr">EXPR</code></td>
<td>
<p>The quoted version of such an expression.</p>
</td></tr>
<tr><td><code id="gmRead_+3A_sel">sel</code></td>
<td>
<p>The selection statement in R representation.</p>
</td></tr>
<tr><td><code id="gmRead_+3A_limit">limit</code></td>
<td>
<p>defines the number of lines returned in the query.</p>
</td></tr>
<tr><td><code id="gmRead_+3A_db">db</code></td>
<td>
<p>defines the database, on which the query will be run.</p>
</td></tr>
<tr><td><code id="gmRead_+3A_gmnamevarid">gmNameVarID</code></td>
<td>
<p>The gmVarID in the gmDatabase of gmName for later referencing of an object by its name in the gmDatabase.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>gmRead</code> is the principal function of the gmDatabase package. It provides the main functionality: Receiving an R expression <code>expr</code> of an SQL query, it returns a dataframe, containing the requested data. On the other hand, <code>gmReadInternal</code>, indicated by its notation, is meant for in-package use only. During the execution of <code>gmRead</code> it creates a call containing the R representation, which is used later in <code>gmSQL</code> to create and run a proper SQL query against the database. 
</p>


<h3>Value</h3>

<p>For <code>gmRead</code> a dataframe is returned. It contains the requested data.
For <code>gmReadInternal</code> a call is returned, consisting of an expression to be interpreted as
the R representation of SQL by <code>gmSQL</code>. Furthermore a list of the asked variables in 
<code>EXPR</code> and the columns, where to look in the database tables are returned, too.
</p>


<h3>Author(s)</h3>

<p>K. Gerald van den Boogaart, S. Matos Camacho</p>


<h3>See Also</h3>

<p><code><a href="#topic+gmExpr">gmExpr</a></code>, <code><a href="#topic+gmSQL">gmSQL</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
.gmDB &lt;- dbConnect(...)
root &lt;- "root"
erg &lt;- gmRead(root)
## returns the ID of root in the database

gmRead(root$project[gmTitle=group])
## groups

## End(Not run)
</code></pre>

<hr>
<h2 id='gmRemove'>
Delete objects in an geometallurgical database
</h2><span id='topic+gmRemove'></span>

<h3>Description</h3>

<p>Deletes the specified object in an geometallurgical database.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gmRemove(expr, which=NULL, var=NULL, EXPR=substitute(expr), WHICH=substitute(which),
  envir=parent.frame(), db=getOption("gmDB"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gmRemove_+3A_expr">expr</code></td>
<td>
<p>R expression of an SQL query. Expressions created with <code><a href="#topic+gmExpr">gmExpr</a></code> and an ID in the database can be used as well.</p>
</td></tr>
<tr><td><code id="gmRemove_+3A_which">which</code></td>
<td>
<p>Specifies for a set variable, which entry shall be deleted.</p>
</td></tr>
<tr><td><code id="gmRemove_+3A_var">var</code></td>
<td>
<p>Defines the attributes, that shall be deleted.</p>
</td></tr>
<tr><td><code id="gmRemove_+3A_expr">EXPR</code></td>
<td>
<p>The quoted version of such an expression.</p>
</td></tr>
<tr><td><code id="gmRemove_+3A_which">WHICH</code></td>
<td>
<p>The quoted version of <code>which</code>.</p>
</td></tr>
<tr><td><code id="gmRemove_+3A_envir">envir</code></td>
<td>
<p>defines the environment used for evaluation of <code>expr</code>.</p>
</td></tr>
<tr><td><code id="gmRemove_+3A_db">db</code></td>
<td>
<p>The connection to the database.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>gmRemove</code> deletes the specified object in a geometallurgical database. This may include the removal of all its members, too. 
</p>
<p>If you only want to remove a certain attribute for an object, than use the argument <code>var</code> for specifying. In the case of this attribute being an object itself but not a value, you may have more than one entry to choose for deleting. Therefor choose the right one by stating an id or an <a href="#topic+gmExpr">gmExpr</a> in the <code>which</code> argument.
</p>


<h3>Value</h3>

<p>No value.
</p>


<h3>Author(s)</h3>

<p>K. Gerald van den Boogaart, S. Matos Camacho</p>


<h3>See Also</h3>

<p><code><a href="#topic+gmRead">gmRead</a></code>, <code><a href="#topic+gmExpr">gmExpr</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
gmRemove(4545)
gmRemove(root$project[gmTitle=="Project X"])
gmRemove(root$gmUserGroup, root$gmUser[gmUserName=="userXY"], var="gmUser")
gmRemove(root$project[gmTitle=="Project X"], var="gmTitle"))

## End(Not run)</code></pre>

<hr>
<h2 id='gmSQL'>Provide an R representation of SQL</h2><span id='topic+gmSQLTable'></span><span id='topic+gmSQL'></span><span id='topic+gmSQL2SQL'></span><span id='topic+SQLenv'></span><span id='topic+SQL2SQLenv'></span>

<h3>Description</h3>

<p>gmSQL provides an R representation of SQL, which can be used to
construct a complex hierachy of joins and select statements. 
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gmSQL(.,expr=substitute(.),env=SQLenv)
gmSQL2SQL(expr,env=SQL2SQLenv)
gmSQLTable(table,as=tick(table))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gmSQL_+3A_.">.</code></td>
<td>
<p>For <code>gmSQL</code> an unquote expression to be interpreted as
the R representation of SQL described under details.</p>
</td></tr>
<tr><td><code id="gmSQL_+3A_expr">expr</code></td>
<td>
<p>The quoted version of such an expression.</p>
</td></tr>
<tr><td><code id="gmSQL_+3A_env">env</code></td>
<td>
<p>The environment holding the variables used in the expression.</p>
</td></tr>
<tr><td><code id="gmSQL_+3A_table">table</code></td>
<td>
<p>a character string giving the name of the SQL table
denoted.</p>
</td></tr>
<tr><td><code id="gmSQL_+3A_as">as</code></td>
<td>
<p>the alias of the table in the SQL expression</p>
</td></tr>
</table>


<h3>Details</h3>

<p>These commands allow to construct a representation of a small subset
of SQL statements by R language objects. The following (derived) table
value statements are supported
</p>

<ul>
<li><p>join(x,y,on=NULL)Represent the <code>x JOIN y ON on</code>.
</p>
</li>
<li><p>leftjoin(x,y,on=NULL)Represent the <code>x LEFT OUTER JOIN y ON on</code>.
</p>
</li>
<li><p>select(what=NULL,from=NULL,where=NULL,as=tick())
Represents <code>(SELECT w1=v1,... FROM from WHERE where) AS as</code>, where
what is a named list of the form <code>list(w1=v1,...)</code>. If any of
the terms is NULL it is logically omitted.

</p>
</li>
<li><p>table(table,as)Represents <code>table AS as</code> in a FROM
clause.
</p>
</li>
<li><p>table$nameRepresents <code>tableAlias.name</code> anywhere in an
SQL expression e.g. in <code>what</code> and <code>where</code> clauses of a <code>SELECT</code>.
</p>
</li>
<li><p>Call(fun,...)Represents <code>fun(...)</code> in SQL expressions.
</p>
</li>
<li><p>x==yRepresents <code>x=y</code> in SQL expressions.
</p>
</li>
<li><p>x!=yRepresents <code>x!=y</code> in SQL expressions.
</p>
</li>
<li><p>x&lt;yRepresents <code>x&lt;y</code> in SQL expressions.
</p>
</li>
<li><p>x&gt;yRepresents <code>x&gt;y</code> in SQL expressions.
</p>
</li>
<li><p>x&lt;=yRepresents <code>x&lt;=y</code> in SQL expressions.
</p>
</li>
<li><p>x&gt;=yRepresents <code>x&gt;=y</code> in SQL expressions.
</p>
</li>
<li><p>between(x,y,z)Represents <code>x BETWEEN y AND z</code> in SQL expressions.
</p>
</li>
<li><p>x+yRepresents <code>x+y</code> in SQL expressions.
</p>
</li>
<li><p>x-yRepresents <code>x-y</code> in SQL expressions.
</p>
</li>
<li><p>x*yRepresents <code>x*y</code> in SQL expressions.
</p>
</li>
<li><p>x/yRepresents <code>x/y</code> in SQL expressions.
</p>
</li>
<li><p>in(x,y)Represents <code>x IN y</code> in SQL expressions.
</p>
</li>
<li><p>&quot;x %in% y&quot;Substitute for in(x,y).
</p>
</li>
<li><p>&amp;Represents <code>x AND y</code> in SQL expressions.
</p>
</li>
<li><p>|Represents <code>x OR y</code> in SQL expressions.
</p>
</li>
<li><p>!Represents <code>NOT x</code> in SQL expressions.
</p>
</li>
<li><p>ifelse(x,y,z)Represents <code>IF x THEN y ELSE z</code> in SQL
expressions.
</p>
</li>
<li><p>.(x)Evaluates its argument in env, i.e. it is used to quote
calculation, which should be executed in R rather than SQL.
</p>
</li>
<li><p>x %&lt;&lt;% yRepresents <code>x &lt;&lt; y</code> in SQL expressions (Left shift).
</p>
</li>
<li><p>x %&gt;&gt;% yRepresents <code>x &gt;&gt; y</code> in SQL expressions (Right
shift).
</p>
</li>
<li><p>xor(x,y)Represents <code>x XOR y</code> in SQL expressions.
</p>
</li>
<li><p>x%&amp;%yRepresents <code>x &amp; y</code> in SQL expressions (bitwise and).
</p>
</li>
<li><p>x%|%yRepresents <code>x | y</code> in SQL expressions (bitwise
or).
</p>
</li>
<li><p>x%&lt;==&gt;%yRepresents <code>x&lt;=&gt;y</code> in SQL expressions (null
safe equality).
</p>
</li>
<li><p>x%%yRepresents <code>x % y</code> in SQL expressions
(remainder).
</p>
</li>
<li><p>x&amp;&amp;yRepresents <code>x &amp;&amp; y</code> in SQL expressions
(logical AND).
</p>
</li>
<li><p>x||yRepresents <code>x || y</code> in SQL expressions
(logical OR).
</p>
</li>
<li><p>c(...)Represents <code>(...)</code> in SQL expressions.
</p>
</li>
<li><p>sum(x)Represents <code>SUM(x)</code> in SQL expressions (sum of values).
</p>
</li>
<li><p>avg(x)Represents  <code>AVG(x)</code> in SQl expressions (average of values).
</p>
</li>
<li><p>min(...)Represents <code>MIN(...)</code> in SQL expressions (minimum of values).
</p>
</li>
<li><p>max(...)Represents <code>MAX(...)</code> in SQL expressions (maximum of values).
</p>
</li>
<li><p>count(x)Represents <code>COUNT(x)</code> in SQL expressions.
</p>
</li></ul>

<p>Special environments <code>SQLenv</code> and <code>SQL2SQLenv</code> are used in order to prevent code injection. 
</p>


<h3>Value</h3>

<p>For gmSQL and gmSQLTable, a call representing the intended SQL
expression as R expression. For gmSQL2SQL a character string holding
the corresponding SQL expression. 
</p>


<h3>Author(s)</h3>

<p>K. Gerald van den Boogaart, S. Matos Camacho</p>


<h3>References</h3>

<p><a href="http://dev.mysql.com/doc/refman/5.7/en">http://dev.mysql.com/doc/refman/5.7/en</a>
</p>


<h3>See Also</h3>

<p><code><a href="DBI.html#topic+dbSendQuery">dbSendQuery</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>tabA &lt;- gmSQLTable("A")
tabB &lt;- gmSQLTable("B")
ennv &lt;- new.env(parent=SQLenv)
assign("tabA", tabA, ennv)
assign("tabB", tabB, ennv)
AB &lt;- gmSQL(join(tabA,tabB,on=tabA$id==tabB$refID), env=ennv)
AB
gmSQL2SQL(tabA)
gmSQL2SQL(tabB)
gmSQL2SQL(AB)
legalvalues &lt;- 1:3
assign("AB", AB, ennv)
assign("legalvalues", legalvalues, ennv)
sAB &lt;- gmSQL(select(what=list(x=1,y=tabA$y*tabB$y),
                    from=AB,
                    where=Call("log",tabB$othervalue)&lt;=17 &amp;&amp;
                          IN(tabA$inte,c(legalvalues)),
                    as=NULL), env=ennv)

cat(gmSQL2SQL(sAB))

</code></pre>

<hr>
<h2 id='gmSQLValues'>Format vector in parenthesis and SQL quote it</h2><span id='topic+gmSQLValues'></span>

<h3>Description</h3>

<p>Formats values for use in SQL statements</p>


<h3>Usage</h3>

<pre><code class='language-R'>  gmSQLValues(v,quote=TRUE,db=getOption("gmDB"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="gmSQLValues_+3A_v">v</code></td>
<td>
<p>The values to be converted, could be dataframe, numeric
vector or something convertable to a character vector.</p>
</td></tr>
<tr><td><code id="gmSQLValues_+3A_quote">quote</code></td>
<td>
<p>Logocical value defining if the given values shall be quoted.</p>
</td></tr>
<tr><td><code id="gmSQLValues_+3A_db">db</code></td>
<td>
<p>The database connection for which the transformation shall
be done. Currently only mysql is supported.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The functions currently use <code>dbEscapeStrings</code> and are
therefor only reliable with RMySQL-Connections.
</p>


<h3>Value</h3>

<p><code>gmSQLValues</code>
A single string containing an SQL representation of the vector for use
with the <code>IN</code> operator.



</p>


<h3>Author(s)</h3>

<p>K. Gerald van den Boogaart</p>


<h3>See Also</h3>

<p><code><a href="#topic+gmEscapeStrings">gmEscapeStrings</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
.gmDB &lt;- dbConnect(...)
complexString &lt;- "He said: \"I\'m going to the circus\"\n"
cat(complexString)
gmEscapeStrings(complexString)
cat(gmEscapeStrings(complexString),"\n")
cat(gmSQLValues(complexString),"\n")
myfactor &lt;- factor(c("a","a","b"))
cat(gmSQLValues(myfactor),"\n")
num &lt;- 1:3
cat(gmSQLValues(num),"\n")

X &lt;- data.frame(string=rep(complexString,3),fac=myfactor,x=num)
cat(gmSQLValues(X),"\n")

## End(Not run)

</code></pre>

<hr>
<h2 id='makeGmSQLfromR'>Parse an R expression of SQl statements
</h2><span id='topic+makeGmSQLfromR'></span>

<h3>Description</h3>

<p><code>makeGmSQLfromR</code> parses an R expression</p>


<h3>Usage</h3>

<pre><code class='language-R'>makeGmSQLfromR(EXPR,vars,warn=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="makeGmSQLfromR_+3A_expr">EXPR</code></td>
<td>
<p>R expression of an SQL query.</p>
</td></tr>
<tr><td><code id="makeGmSQLfromR_+3A_vars">vars</code></td>
<td>
<p>A list of variables</p>
</td></tr>
<tr><td><code id="makeGmSQLfromR_+3A_warn">warn</code></td>
<td>
<p>A logical defining the handling of a possible occuring warning.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>makeGmSQLfromR</code> is an internal function, which is used for constructing WHERE clauses in SELECT statements or ON clauses in JOIN statements out of an R expression.
</p>


<h3>Value</h3>

<p>Returns the names for the WHERE or ON clause.
</p>


<h3>Author(s)</h3>

<p>K. Gerald van den Boogaart, S. Matos Camacho</p>


<h3>See Also</h3>

<p><code><a href="#topic+gmRead">gmRead</a></code>
</p>

<hr>
<h2 id='repairGmGrandChilds'>
Updating second order inheritance.
</h2><span id='topic+repairGmGrandChilds'></span>

<h3>Description</h3>

<p>Updates the table <code>gmGrandChilds</code> in a geometallurgical database.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>repairGmGrandChilds(db=getOption("gmDB"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="repairGmGrandChilds_+3A_db">db</code></td>
<td>
<p>defines the database, on which the query will be run.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The table <code>gmGrandChilds</code> is used for a fast and effectiv access to the hierarchical structure of a geometallurgical database. Here inheritance of second order is recorded. This information is necessary for retrieving all class members for a given object in <code>gmClassMembers</code>.
</p>


<h3>Value</h3>

<p>string if any changes made in <code>gmGrandChilds</code>.</p>


<h3>Author(s)</h3>

<p>K. Gerald van den Boogaart, S. Matos Camacho</p>


<h3>See Also</h3>

<p><code><a href="#topic+gmClass">gmClass</a></code>, <code><a href="#topic+gmClassMembers">gmClassMembers</a></code></p>

<hr>
<h2 id='replaceVarsInExpression'>Replace Variables in Expressions</h2><span id='topic+replaceVarsInExpression'></span>

<h3>Description</h3>

<p>Replaces the variables in expressions by something else and returns
the expression.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>replaceVarsInExpression(EXPR,vars,warn=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="replaceVarsInExpression_+3A_expr">EXPR</code></td>
<td>
<p>a call object representning an R expression</p>
</td></tr>
<tr><td><code id="replaceVarsInExpression_+3A_vars">vars</code></td>
<td>
<p>a names list providing the replacements for the
variables. The names represent the variable names to be replaced.</p>
</td></tr>
<tr><td><code id="replaceVarsInExpression_+3A_warn">warn</code></td>
<td>
<p>If TRUE warns in case of undefined variables. NA produces
an error.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An expression similar to EXPR, with the variables replaced.
</p>


<h3>Author(s)</h3>

<p>K. Gerald van den Boogaart</p>


<h3>Examples</h3>

<pre><code class='language-R'>a &lt;- quote( A==B^C+A^2+C )
replaceVarsInExpression(a,list(A=quote(2*r^2),C=as.name("R"),B=pi))
a &lt;- quote( A+B+C )
replaceVarsInExpression(a,list(A=quote(C^2),B=quote(A^2),C=quote(B^2)))
</code></pre>

<hr>
<h2 id='tick'>
Create a unique name
</h2><span id='topic+tick'></span>

<h3>Description</h3>

<p><code>tick</code> creates a unique name out of <code>x</code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tick(s="T")
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="tick_+3A_s">s</code></td>
<td>
<p>The first part of the later name.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>tick</code> concatenates a consecutive number to <code>s</code>.
</p>


<h3>Value</h3>

<p>a string</p>


<h3>Author(s)</h3>

<p>K. Gerald van den Boogaart, S. Matos Camacho</p>


<h3>Examples</h3>

<pre><code class='language-R'>a &lt;- "S"
tick(a)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
