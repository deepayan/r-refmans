<!DOCTYPE html><html><head><title>Help for package DIZutils</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {DIZutils}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#check_if_table_exists'><p>Check if a database table exists.</p></a></li>
<li><a href='#close_connection'><p>close_connection helper function</p></a></li>
<li><a href='#combine_stats'><p>Combine aggregated statistics.</p></a></li>
<li><a href='#db_connection'><p>db_connection helper function</p></a></li>
<li><a href='#get_config_env'><p>get_config_env helper function</p></a></li>
<li><a href='#get_db_systems'><p>Quickly get all currently implemented database systems</p></a></li>
<li><a href='#get_default_config_elements'><p>Get default element names (suffixes) for env reading</p></a></li>
<li><a href='#query_database'><p>query_database helper function</p></a></li>
<li><a href='#xml_2_json'><p>Quickly transform a xml objet into a json object.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Utilities for 'DIZ' R Package Development</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1.2</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-01-23</td>
</tr>
<tr>
<td>Description:</td>
<td>Utility functions used for the R package development
    infrastructure inside the data integration centers ('DIZ') to
    standardize and facilitate repetitive tasks such as setting up a
    database connection or issuing notification messages and to avoid
    redundancy.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/miracum/misc-dizutils">https://github.com/miracum/misc-dizutils</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/miracum/misc-dizutils/issues">https://github.com/miracum/misc-dizutils/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.1.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>data.table, DBI (&ge; 1.1.0), DIZtools, Hmisc, psych, RJDBC,
RJSONIO, RPostgres, xml2</td>
</tr>
<tr>
<td>Suggests:</td>
<td>lintr, testthat</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>libpq &gt;= 9.0: libpq-dev (deb) or postgresql-devel
(rpm)</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-01-23 08:02:50 UTC; user</td>
</tr>
<tr>
<td>Author:</td>
<td>Jonathan M. Mang <a href="https://orcid.org/0000-0003-0518-4710"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Lorenz A. Kapsner <a href="https://orcid.org/0000-0003-1866-860X"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  MIRACUM - Medical Informatics in Research and Care in University
    Medicine [fnd],
  Universit√§tsklinikum Erlangen, Germany [cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Jonathan M. Mang &lt;jonathan.mang@uk-erlangen.de&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-01-23 10:10:11 UTC</td>
</tr>
</table>
<hr>
<h2 id='check_if_table_exists'>Check if a database table exists.</h2><span id='topic+check_if_table_exists'></span>

<h3>Description</h3>

<p>Check if a database table exists.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_if_table_exists(db_con, table_name)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_if_table_exists_+3A_db_con">db_con</code></td>
<td>
<p>A DBI database connection. See 'db_connection()' for details.</p>
</td></tr>
<tr><td><code id="check_if_table_exists_+3A_table_name">table_name</code></td>
<td>
<p>(String) The name of the table or view to be checked.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>True, if the table exists, false otherwise.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
res &lt;- DIZutils::check_if_table_exists(
  db_con = DIZutils::db_connection(...),
  table_name = "my_table"
)
## End(Not run)

</code></pre>

<hr>
<h2 id='close_connection'>close_connection helper function</h2><span id='topic+close_connection'></span>

<h3>Description</h3>

<p>Internal function to close the database connection. The function
is just a wrapper around 'RPostgres::dbDisconnect'
</p>


<h3>Usage</h3>

<pre><code class='language-R'>close_connection(conn)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="close_connection_+3A_conn">conn</code></td>
<td>
<p>A DBI database connection.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The function is just a wrapper around RPostgres::dbDisconnect /
DBI::dbDisconnect and does not return any value.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
db_con &lt;- DIZutils::db_connection(
  db_name = "i2b2",
  db_type = "postgres"
)

DIZutils::close_connection(
  conn = db_con
)

## End(Not run)

</code></pre>

<hr>
<h2 id='combine_stats'>Combine aggregated statistics.</h2><span id='topic+combine_stats'></span>

<h3>Description</h3>

<p>This function provides the functionality to combine multiple
statistics to a single statistical overview. This is e.g. useful if you
are only allowed to export statistical characteristics from a site but
not the data itself. So in this case you have e.g. mean, median and N
from each site but want to say something about the mean, median and N
over all sites like you had the data of all sites in one big pool and
would do the statisitcs there.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>combine_stats(summaries, demo = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="combine_stats_+3A_summaries">summaries</code></td>
<td>
<p>(data.table) Data table containing all stats you want to
combine as rows. This data.table must contain the columns
'Min', 'Q10', 'Q25', 'Median', 'Mean', 'SD', 'Q75', 'Q90', 'Max', 'N'.
Each row in this data table represents a site as of the example described
above.</p>
</td></tr>
<tr><td><code id="combine_stats_+3A_demo">demo</code></td>
<td>
<p>(boolean, default = FALSE) Do you want to see how the function
works? Then call 'combine_stats(summaries = NULL, demo = TRUE)'.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A one-row data.table containing the calculated, aggregates
statistics of the input.
</p>

<hr>
<h2 id='db_connection'>db_connection helper function</h2><span id='topic+db_connection'></span>

<h3>Description</h3>

<p>Internal function to test and get the database connection of
the target data system.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>db_connection(
  system_name = NULL,
  db_type,
  headless = TRUE,
  from_env = TRUE,
  settings = NULL,
  timeout = 30,
  logfile_dir = NULL,
  lib_path = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="db_connection_+3A_system_name">system_name</code></td>
<td>
<p>(Default = NULL) A character. Name of the database system.
Used to find the correct settings from the env. If you don't want to
load the settings from the environment, use the 'settings' parameter.
Otherwise this funcion will search for all settings beginning with
'system_name' in the environment. If 'system_name = &quot;i2b2&quot;' settings like
'I2B2_HOST' or 'I2B2_PORT' (notice the uppercase) will be loaded from
the environment. You can load such an env file e.g. by using
'DIZtools::setenv_file(path_to_file)'.</p>
</td></tr>
<tr><td><code id="db_connection_+3A_db_type">db_type</code></td>
<td>
<p>A character. Type of the database system. Currently
implemented systems are: 'postgres', 'oracle'.</p>
</td></tr>
<tr><td><code id="db_connection_+3A_headless">headless</code></td>
<td>
<p>A boolean (default: 'FALSE'). Indicating, if the function is
run only in the console ('headless = TRUE') or on a GUI frontend
('headless = FALSE').</p>
</td></tr>
<tr><td><code id="db_connection_+3A_from_env">from_env</code></td>
<td>
<p>A boolean (default: 'TRUE'). Should database connection
be read from the environment or from a settings file. All necessary
parameters must be uppercase and have the prefix of the db_name. E.g.:
'I2B2_HOST' or 'I2B2_PORT'. See the 'settings' parameter for all
necessary variables.</p>
</td></tr>
<tr><td><code id="db_connection_+3A_settings">settings</code></td>
<td>
<p>A list. Required if 'from_env == FALSE'. A list containing
settings for the database connection. Required fields are 'host',
'db_name', 'port', 'user' and 'password'.
Additionally for Oracle DB's: 'sid' (instead of 'db_name').
If 'settings' is set, 'from_env' will be set to 'FALSE' automatically.</p>
</td></tr>
<tr><td><code id="db_connection_+3A_timeout">timeout</code></td>
<td>
<p>A timeout in sec. for the db-connection establishment.
Values below 2 seconds are not recommended.
Default is 30 seconds.</p>
</td></tr>
<tr><td><code id="db_connection_+3A_logfile_dir">logfile_dir</code></td>
<td>
<p>(Optional, String, default: &quot;tempdir()&quot;)
The absolute path to folder where the logfile will be stored.</p>
</td></tr>
<tr><td><code id="db_connection_+3A_lib_path">lib_path</code></td>
<td>
<p>A character string. The path to the ojdbc*.jar file.
If you run one of the R-containers from the UK-Erlangen DIZ, there
might be a lib for oracle here: 'lib_path = &quot;/opt/libs/ojdbc8.jar&quot;'</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If successful, the result will be the established connection.
Otherwise the result will be null.
</p>


<h3>See Also</h3>


<p><code><a href="DBI.html#topic+dbConnect">dbConnect</a></code>, <code><a href="RPostgres.html#topic+RPostgres">RPostgres</a></code>

</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
db_con &lt;- DIZutils::db_connection(
  db_name = "i2b2",
  db_type = "postgres"
)
## End(Not run)

</code></pre>

<hr>
<h2 id='get_config_env'>get_config_env helper function</h2><span id='topic+get_config_env'></span>

<h3>Description</h3>

<p>Internal function to read settings for a certain system
from the environment.
IMPORTANT: If yout want to get any result with your input as prefix,
use 'ignore_presets = TRUE'! See param-definition for more details.
This function will look at uppercase system_names at default.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_config_env(
  system_name,
  logfile_dir = tempdir(),
  headless = TRUE,
  ignore_presets = FALSE,
  uppercase_system = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="get_config_env_+3A_system_name">system_name</code></td>
<td>
<p>The name of the system (This is also the prefix used
to get the environment variables with 'SYSTEM_KEY', e.g. 'I2B2_DBNAME').
This function also works if there are multiple instances like
'I2B2_1_DBNAME' and 'I2B2_2_DBNAME'. Then the result will contain
nested lists for each occurence.</p>
</td></tr>
<tr><td><code id="get_config_env_+3A_logfile_dir">logfile_dir</code></td>
<td>
<p>(Optional, String, default: &quot;tempdir()&quot;)
The absolute path to folder where the logfile will be stored.</p>
</td></tr>
<tr><td><code id="get_config_env_+3A_headless">headless</code></td>
<td>
<p>A boolean (default: 'FALSE'). Indicating, if the function is
run only in the console ('headless = TRUE') or on a GUI frontend
('headless = FALSE').</p>
</td></tr>
<tr><td><code id="get_config_env_+3A_ignore_presets">ignore_presets</code></td>
<td>
<p>(boolean, default = FALSE)
Only return something if all elements
from the presets are found? These are currently 'host', 'port', 'user',
'password', 'sid', 'path'. If you have another suffix after
&lsquo;system_name' in your config file, you won&rsquo;t see it here. To see
everything with prefix 'system_name' simply set 'ignore_presets = TRUE'.
To obtain a list of current default elements, run
<code>DIZutils:::get_default_config_elements()</code>.</p>
</td></tr>
<tr><td><code id="get_config_env_+3A_uppercase_system">uppercase_system</code></td>
<td>
<p>(boolean) Default: True. Otherwise: case-sensitive.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If successful it returns the config, null otherwise.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
get_config_env(
  system_name = "i2b2",
  logfile_dir = tempdir(),
  headless = FALSE
)

</code></pre>

<hr>
<h2 id='get_db_systems'>Quickly get all currently implemented database systems</h2><span id='topic+get_db_systems'></span>

<h3>Description</h3>

<p>Function to quickly get the currently implemented database
systems
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_db_systems()
</code></pre>


<h3>Value</h3>

<p>The currently implemented database systems as string array.
'E.g. c(&quot;postgres&quot;, &quot;oracle&quot;)'
#'
</p>


<h3>Examples</h3>

<pre><code class='language-R'>get_db_systems()
# Result: c("postgres", "oracle")

</code></pre>

<hr>
<h2 id='get_default_config_elements'>Get default element names (suffixes) for env reading</h2><span id='topic+get_default_config_elements'></span>

<h3>Description</h3>

<p>Internal function.
Get default element names (suffixes) for env reading
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_default_config_elements()
</code></pre>


<h3>Value</h3>

<p>Vector with default elements
</p>

<hr>
<h2 id='query_database'>query_database helper function</h2><span id='topic+query_database'></span>

<h3>Description</h3>

<p>Internal function to query the database. The function
sends a sql statement to the database and returns a data.table.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>query_database(
  db_con,
  sql_statement,
  no_result = FALSE,
  close_connection = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="query_database_+3A_db_con">db_con</code></td>
<td>
<p>A DBI database connection.</p>
</td></tr>
<tr><td><code id="query_database_+3A_sql_statement">sql_statement</code></td>
<td>
<p>A character string containing a valid SQL statement.
Caution: Everything after the first ';' will be cut off.</p>
</td></tr>
<tr><td><code id="query_database_+3A_no_result">no_result</code></td>
<td>
<p>(boolean, default: FALSE) Is the sql meant to return
nothing? E.g. if you just insert or update a table.
Then supply 'TRUE' here. If you supply 'FALSE' here, the
function expects to receive a result table and tries to convert it
to a data.table.</p>
</td></tr>
<tr><td><code id="query_database_+3A_close_connection">close_connection</code></td>
<td>
<p>(boolean, default = FALSE). If TRUE, the connection
will be closed after the query was sent and the result received.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns the result of the db-query. If 'no_result' is 'TRUE',
the return value will be 'TRUE' if the query was successfully sent.
Otherwise (if 'no_result' is 'FALSE' which is the default), the result
will be the result of the sql query as data.table.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
db_con &lt;- DIZutils::db_connection(
  db_name = "i2b2",
  db_type = "postgres"
)

query_database(
  db_con = db_con,
  sql_statement = "SELECT * FROM table_name;"
)

query_database(
  db_con = db_con,
  sql_statement = "INSERT INTO table_name DEFAULT VALUES;",
  no_result = TRUE
)


## End(Not run)

</code></pre>

<hr>
<h2 id='xml_2_json'>Quickly transform a xml objet into a json object.</h2><span id='topic+xml_2_json'></span>

<h3>Description</h3>

<p>See title.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>xml_2_json(xml)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="xml_2_json_+3A_xml">xml</code></td>
<td>
<p>An xml object.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The json-representation of the xml object.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
