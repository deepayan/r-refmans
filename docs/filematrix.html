<!DOCTYPE html><html><head><title>Help for package filematrix</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {filematrix}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#filematrix-class'><p>Manipulating file matrices (class <code>"filematrix"</code>)</p></a></li>
<li><a href='#filematrix-package'>
<p>File-backed numeric matrix.</p></a></li>
<li><a href='#fm.create'>
<p>Functions to Create a New, or Open an Existing Filematrix</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>File-Backed Matrix Class with Convenient Read and Write Access</td>
</tr>
<tr>
<td>Version:</td>
<td>1.3</td>
</tr>
<tr>
<td>Date:</td>
<td>2018-02-26</td>
</tr>
<tr>
<td>Description:</td>
<td>Interface for working with large matrices stored in files,
        not in computer memory. Supports multiple non-character
        data types (double, integer, logical and raw) of
        various sizes (e.g. 8 and 4 byte real values).
        Access to parts of the matrix is done by indexing, 
        exactly as with usual R matrices.
        Supports very large matrices.
        Tested on multi-terabyte matrices.
        Allows for more than 2^32 rows or columns.
        Allows for quick addition of extra columns to a filematrix.
        Cross-platform as the package has R code only.</td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/andreyshabalin/filematrix/issues">https://github.com/andreyshabalin/filematrix/issues</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/andreyshabalin/filematrix">https://github.com/andreyshabalin/filematrix</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/LGPL-3">LGPL-3</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>methods, utils</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, RSQLite</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2018-02-27 06:24:35 UTC; Andrey</td>
</tr>
<tr>
<td>Author:</td>
<td>Andrey A Shabalin <a href="https://orcid.org/0000-0003-0309-6821"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Andrey A Shabalin &lt;andrey.shabalin@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2018-02-27 16:38:01 UTC</td>
</tr>
</table>
<hr>
<h2 id='filematrix-class'>Manipulating file matrices (class <code>"filematrix"</code>)</h2><span id='topic+filematrix'></span><span id='topic+filematrix-class'></span><span id='topic+as.matrix+2Cfilematrix-method'></span><span id='topic+dim+2Cfilematrix-method'></span><span id='topic+dim+3C-+2Cfilematrix-method'></span><span id='topic+dimnames+2Cfilematrix-method'></span><span id='topic+dimnames+3C-+2Cfilematrix-method'></span><span id='topic+rownames+2Cfilematrix-method'></span><span id='topic+rownames+3C-+2Cfilematrix-method'></span><span id='topic+colnames+2Cfilematrix-method'></span><span id='topic+colnames+3C-+2Cfilematrix-method'></span><span id='topic+length+2Cfilematrix-method'></span><span id='topic++5B.filematrix'></span><span id='topic++5B+3C-.filematrix'></span>

<h3>Description</h3>

<p><code>filematrix</code> is a class for working with very large matrices
stored in files, not held in computer memory.
It is intended as a simple, efficient solution to handling big numeric data
(i.e., datasets larger than memory capacity) in R. <br />
A new filematrix can be created with <code><a href="#topic+fm.create">fm.create</a></code>.
It can be created from an existing R matrix
with <code><a href="#topic+fm.create.from.matrix">fm.create.from.matrix</a></code>.
A text file with a matrix can be scanned and converted into a filematrix
with <code><a href="#topic+fm.create.from.text.file">fm.create.from.text.file</a></code>.
An existing filematrix can be opened for read/write access
with <code><a href="#topic+fm.open">fm.open</a></code> or loaded fully in memory
with <code><a href="#topic+fm.load">fm.load</a></code>.
</p>
<p>A filematrix can be handled as an ordinary matrix in R.
</p>
<p>It can be read from and written to via usual indexing
with possible omission of indices.<br />
For example: <code>fm[1:3,2:4]</code> and <code>fm[,2:4]</code>.
</p>
<p>The values can also be accessed as a vector
with single indexing.<br />
For example: <code>fm[3:7]</code> and <code>fm[4:7] = 1:4</code>.
</p>
<p>A whole filematrix can be read memory as an ordinary R matrix 
with <code>as.matrix</code> function or empty indexing <code>fm[]</code>.
</p>
<p>The dimensions of filematrix can be obtained via <code>dim</code>, 
<code>nrow</code> and <code>ncol</code> functions and 
modified with <code>dim</code> function.<br />
For example: <code>dim(fm)</code> and <code>dim(fm) = c(10,100)</code>.
</p>
<p>The number of elements in filematrix is returned by <code>length</code> function.
</p>
<p>A filematrix can have row and column names.
They can be accessed using the standard functions
<code>rownames</code>, <code>colnames</code>, and <code>dimnames</code>.
</p>
<p>A filematrix can be closed after use with <code>close</code> command.
Note, however, that there is no risk of losing modifications 
to a filematrix if an object is not closed, 
as all changes are written to disk without delay.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'filematrix'
x[i,j]
## S3 replacement method for class 'filematrix'
x[i,j] &lt;- value

## S4 method for signature 'filematrix'
as.matrix(x)

## S4 method for signature 'filematrix'
dim(x)
## S4 replacement method for signature 'filematrix'
dim(x) &lt;- value

## S4 method for signature 'filematrix'
length(x)

## S4 method for signature 'filematrix'
rownames(x)
## S4 replacement method for signature 'filematrix'
rownames(x) &lt;- value

## S4 method for signature 'filematrix'
colnames(x)
## S4 replacement method for signature 'filematrix'
colnames(x) &lt;- value

## S4 method for signature 'filematrix'
dimnames(x)
## S4 replacement method for signature 'filematrix'
dimnames(x) &lt;- value
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="filematrix-class_+3A_x">x</code></td>
<td>

<p>A filematrix object (<code>filematrix</code>).
</p>
</td></tr>
<tr><td><code id="filematrix-class_+3A_i">i</code>, <code id="filematrix-class_+3A_j">j</code></td>
<td>

<p>Row/column indices specifying elements to extract or replace.
</p>
</td></tr>
<tr><td><code id="filematrix-class_+3A_value">value</code></td>
<td>

<p>A new value to replace the indexed element(s).
</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>length</code> function returns the number of elements in the filematrix.
</p>
<p>Functions <code>colnames</code>, <code>rownames</code>, and <code>dimnames</code> return 
the same values as their counterparts for the regular R matrices.
</p>


<h3>Methods</h3>


<dl>
<dt><code>isOpen</code></dt><dd>
<p>Returns <code>TRUE</code> is the filematrix is open.
</p>
</dd>
<dt><code>readAll()</code>:</dt><dd><p> Return the whole matrix. <br />
Same as <code>fm[]</code> or <code>as.matrix(fm)</code>
</p>
</dd>
<dt><code>writeAll(value)</code>:</dt><dd>
<p>Fill in the whole matrix. <br />    
Same as <code>fm[] = value</code>
</p>
</dd>
<dt><code>readSubCol(i, j, num)</code>:</dt><dd>
<p>Read <code>num</code> values in column <code>j</code> starting with row <code>i</code>.<br />
Same as <code>fm[i:(i+num-1), j]</code> 
</p>
</dd>
<dt><code>writeSubCol(i, j, value)</code>:</dt><dd>
<p>Write values in the column <code>j</code> starting with row <code>i</code>. <br />    
Same as <code>fm[i:(i+length(value)-1), j] = value</code>
</p>
</dd>
<dt><code>readCols(start, num)</code>:</dt><dd>
<p>Read <code>num</code> columns starting with column <code>start</code>. <br />
Same as <code>fm[, start:(start+num-1)] </code>
</p>
</dd>
<dt><code>writeCols(start, value)</code>:</dt><dd>
<p>Write columns starting with column <code>start</code>. <br />
Same as <code>fm[, start:(start+ncol(value)-1)] = value </code>
</p>
</dd>
<dt><code>readSeq(start, len)</code>:</dt><dd>
<p>Read <code>len</code> values from the matrix starting with 
<code>start</code>-th value. <br />
Same as <code>fm[start:(start+len-1)]</code> </p>
</dd>
<dt><code>writeSeq(start, value)</code>:</dt><dd>
<p>Write values in the matrix starting with <code>start</code>-th value. <br />
Same as <code>fm[start:(start+length(value)-1)] = value</code> 
</p>
</dd>
<dt><code>appendColumns(mat)</code></dt><dd>
<p>Increases filematrix by adding columns to the right side of the matrix.
Matrix <code>mat</code> must have the same number of rows. <br /> 
Same as <code>fm = cbind(fm, mat)</code> for ordinary matrices.</p>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Andrey A Shabalin <a href="mailto:andrey.shabalin@gmail.com">andrey.shabalin@gmail.com</a>
</p>


<h3>See Also</h3>

<p>For function creating and opening file matrices see
<code><a href="#topic+fm.create">fm.create</a></code>.
</p>
<p>Run <code>browseVignettes("filematrix")</code> for the list of vignettes.
</p>

<hr>
<h2 id='filematrix-package'>
File-backed numeric matrix.
</h2><span id='topic+filematrix-package'></span>

<h3>Description</h3>

<p>File-Backed Matrix Class with Convenient Read and Write Access
</p>


<h3>Details</h3>

<p>Interface for working with large matrices stored in files,
not in computer memory. Supports multiple non-character
data types (double, integer, logical and raw) of
various sizes (e.g. 8 and 4 byte real values).
Access to parts of the matrix is done by indexing (e.g. fm[,1]),
exactly as with usual R matrices. Supports very large matrices.
Tested on multi-terabyte matrices.
Allows for more than 2^32 rows or columns.
Allows for quick addition of extra columns to a filematrix.
Cross-platform as the package has R code only.
</p>
<p>A new <code>file.matrix</code> object can be created with <code><a href="#topic+fm.create">fm.create</a></code>
and <code><a href="#topic+fm.create.from.matrix">fm.create.from.matrix</a></code>. Existing <code>file.matrix</code> 
files can be opened with <code><a href="#topic+fm.open">fm.open</a></code>.
</p>
<p>Once a <code>file.matrix</code> is created or opened it can be accessed 
as a regular <code><a href="base.html#topic+matrix">matrix</a></code> object in R.
All changes to <code>file.matrix</code> object are written to the data files
without extra buffering.
</p>


<h3>Note</h3>

<p>Due to lack of 64 bit integer data type in R,
the package uses double values for calculation of indices.
The precision of double data type is sufficient
for indexing matrices up to 8,192 terabytes in size.
</p>


<h3>Author(s)</h3>

<p>Andrey A Shabalin <a href="mailto:andrey.shabalin@gmail.com">andrey.shabalin@gmail.com</a>
</p>


<h3>See Also</h3>

<p>See <code><a href="#topic+fm.create">fm.create</a></code> and <code><a href="#topic+filematrix-class">filematrix</a></code>
for reference.
</p>
<p>Run <code>browseVignettes("filematrix")</code> for the list of vignettes.
</p>

<hr>
<h2 id='fm.create'>
Functions to Create a New, or Open an Existing Filematrix
</h2><span id='topic+fm.create'></span><span id='topic+fm.create.from.matrix'></span><span id='topic+fm.open'></span><span id='topic+fm.load'></span><span id='topic+fm.create.from.text.file'></span><span id='topic+close+2Cfilematrix-method'></span><span id='topic+closeAndDeleteFiles'></span>

<h3>Description</h3>

<p>Create a new or open existing <code><a href="#topic+filematrix-class">filematrix</a></code> object.
</p>
<p><code>fm.create</code> creates a new filematrix.
If a filematrix with this name exists, it is overwritten (destroyed).
</p>
<p><code>fm.create.from.matrix</code> creates a new filematrix copy of
an existing R matrix.
</p>
<p><code>fm.open</code> opens an existing filematrix for read/write access.
</p>
<p><code>fm.load</code> loads entire existing filematrix
into memory as an ordinary R matrix.
</p>
<p><code>fm.create.from.text.file</code> reads a matrix from a text file
into a new filematrix.
The rows in the text file become columns in the filematrix.
The transposition happens because the text files stores data by rows and
filematrices store data by columns.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fm.create( 
    filenamebase,
    nrow = 0,
    ncol = 1,
    type = "double",
    size = NULL,
    lockfile = NULL)
    
fm.create.from.matrix( 
    filenamebase,
    mat,
    size = NULL,
    lockfile = NULL)

fm.open(
    filenamebase,
    readonly = FALSE,
    lockfile = NULL)

fm.load(filenamebase, lockfile = NULL)

fm.create.from.text.file(
    textfilename,
    filenamebase,
    skipRows = 1,
    skipColumns = 1,
    sliceSize = 1000,
    omitCharacters = "NA",
    delimiter = "\t",
    rowNamesColumn = 1,
    type = "double",
    size = NULL)

## S4 method for signature 'filematrix'
close(con)

closeAndDeleteFiles(con)

</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fm.create_+3A_filenamebase">filenamebase</code></td>
<td>

<p>Name without extension for the files storing the filematrix. <br />
The file <code>&lt;filenamebase&gt;.bmat</code> keeps the matrix values and
<code>&lt;filenamebase&gt;.desc.txt</code> stores the matrix dimensions,
data type, and data type size.
Names of rows and columns, if defined, are stored in
<code>&lt;filenamebase&gt;.nmsrow.txt</code> and <code>&lt;filenamebase&gt;.nmscol.txt</code>.
</p>
</td></tr>
<tr><td><code id="fm.create_+3A_nrow">nrow</code></td>
<td>

<p>Number of rows in the matrix. Values over 2^32 are supported.
</p>
</td></tr>
<tr><td><code id="fm.create_+3A_ncol">ncol</code></td>
<td>

<p>Number of columns in the matrix. Values over 2^32 are supported.
</p>
</td></tr>
<tr><td><code id="fm.create_+3A_type">type</code></td>
<td>

<p>The type of values stored in the matrix.
Can be either <code>"double"</code>, <code>"integer"</code>, 
<code>"logical"</code>, or <code>"raw"</code>.
</p>
</td></tr>
<tr><td><code id="fm.create_+3A_size">size</code></td>
<td>

<p>Size of each item of the matrix in bytes. <br />
Default values are 8 for <code>"double"</code>, 4 for <code>"integer"</code>, and 
1 for <code>"logical"</code> and <code>"raw"</code>. <br />
Do not change if not sure.
</p>
</td></tr>
<tr><td><code id="fm.create_+3A_mat">mat</code></td>
<td>

<p>Regular R matrix, to be copied into a new filematrix.
</p>
</td></tr>
<tr><td><code id="fm.create_+3A_readonly">readonly</code></td>
<td>

<p>If <code>TRUE</code>, the values in the opened filematrix cannot be changed.
</p>
</td></tr>
<tr><td><code id="fm.create_+3A_textfilename">textfilename</code></td>
<td>

<p>Name of the text file with matrix data,
to be copied into a new filematrix.
</p>
</td></tr>
<tr><td><code id="fm.create_+3A_skiprows">skipRows</code></td>
<td>

<p>Number of rows with column names.
The matrix values are expected after first <code>skipRows</code>
rows of the file.
Can be zero.
</p>
</td></tr>
<tr><td><code id="fm.create_+3A_skipcolumns">skipColumns</code></td>
<td>

<p>Number of columns before matrix values begin.
Can be zero.
</p>
</td></tr>
<tr><td><code id="fm.create_+3A_slicesize">sliceSize</code></td>
<td>

<p>The text file with matrix is read in chuncks of <code>sliceSize</code> rows.
This is a performance tuning parameter, it does not affect the outcome.
</p>
</td></tr>
<tr><td><code id="fm.create_+3A_omitcharacters">omitCharacters</code></td>
<td>

<p>The text string representing missing values.
Default value is <code>NA</code>.
</p>
</td></tr>
<tr><td><code id="fm.create_+3A_delimiter">delimiter</code></td>
<td>

<p>The delimiter separating values in the text matrix file.
</p>
</td></tr>
<tr><td><code id="fm.create_+3A_rownamescolumn">rowNamesColumn</code></td>
<td>

<p>The row names are taken from the <code>rowNamesColumn</code>-th 
column of the text file. 
By default, row names are extracted from the first column.
</p>
</td></tr>
<tr><td><code id="fm.create_+3A_con">con</code></td>
<td>

<p>A filematrix object.
</p>
</td></tr>
<tr><td><code id="fm.create_+3A_lockfile">lockfile</code></td>
<td>

<p>Optional. Name of a lock file (file is overwritten).
Used to avoid simultaneous operations by multiple R instances
accessing the same filematrix or
different filematrices on the same hard drive.
Do not use if not sure.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Once created or opened, a filematrix object can be accessed
as an ordinary matrix using both matrix <code>fm[,]</code> and
vector <code>fm[]</code> indexing.
The indices can be integer (no zeros) or logical vectors.
</p>


<h3>Value</h3>

<p>Returns a <code><a href="#topic+filematrix-class">filematrix</a></code> object.
The object can be closed with <code>close</code> command or 
closed and deleted from disk with <code><a href="#topic+closeAndDeleteFiles">closeAndDeleteFiles</a></code> command.
</p>


<h3>Author(s)</h3>

<p>Andrey A Shabalin <a href="mailto:andrey.shabalin@gmail.com">andrey.shabalin@gmail.com</a>
</p>


<h3>See Also</h3>

<p>For more on the use of filematrices see <code><a href="#topic+filematrix-class">filematrix</a></code>.
</p>
<p>Run <code>browseVignettes("filematrix")</code> for the list of vignettes.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Create a 10x10 matrix
fm = fm.create(filenamebase=tempfile(), nrow=10, ncol=10)

# Change values in the top 3x3 corner
fm[1:3,1:3] = 1:9

# View the values in the top 4x4 corner
fm[1:4,1:4]

# Close and delete the filematrix
closeAndDeleteFiles(fm)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
