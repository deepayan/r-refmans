<!DOCTYPE html><html lang="en"><head><title>Help for package SPARSEMODr</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {SPARSEMODr}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#SPARSEMODr-package'>
<p>SPAtial Resolution-SEnsitive Models of Outbreak Dynamics</p></a></li>
<li><a href='#covid19_control'>
<p>COVID19 Parameters Control Data Structure</p></a></li>
<li><a href='#model_interface'>
<p>Universal Model Interface to the SPARSE-MOD Models</p>
</p></a></li>
<li><a href='#model_parallel'>
<p>Parallelized implementation of the SPARSE-MOD models</p>
</p></a></li>
<li><a href='#Movement'>
<p>Movement dynamics in SPARSEMODr models.</p></a></li>
<li><a href='#seir_control'>
<p>SEIR Parameters Control Data Structure</p></a></li>
<li><a href='#time_windows'>
<p>Time Windows Data Structure</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>SPAtial Resolution-SEnsitive Models of Outbreak Dynamics</td>
</tr>
<tr>
<td>Version:</td>
<td>1.2.0</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/NAU-CCL/SPARSEMODr">https://github.com/NAU-CCL/SPARSEMODr</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/NAU-CCL/SPARSEMODr/issues">https://github.com/NAU-CCL/SPARSEMODr/issues</a></td>
</tr>
<tr>
<td>Description:</td>
<td>Implementation of spatially-explicit, stochastic disease models with customizable time windows that describe how parameter values fluctuate during outbreaks (e.g., in response to public health or conservation interventions).</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Imports:</td>
<td>Rcpp (&ge; 1.0.4), future.apply, data.table, future, tidyverse,
lubridate, viridis, geosphere</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>GNU GSL (&gt;= 2.7)</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2022-07-19 20:07:50 UTC; jrm846</td>
</tr>
<tr>
<td>Author:</td>
<td>Joseph Mihaljevic [aut, cre] (C code, package development),
  Toby Hocking [ctb] (R package interface),
  Seth Borkovec [ctb] (package development),
  Saikanth Ratnavale [ctb] (package development)</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Joseph Mihaljevic &lt;Joseph.Mihaljevic@nau.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2022-07-19 20:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='SPARSEMODr-package'>
SPAtial Resolution-SEnsitive Models of Outbreak Dynamics
</h2><span id='topic+SPARSEMODr-package'></span><span id='topic+SPARSEMODr'></span>

<h3>Description</h3>

<p>Implementation of spatially-explicit, stochastic disease models with customizable time windows that describe how parameter values fluctuate over the course of the simulation (e.g., in response to public health or conservation interventions).
</p>


<h3>Details</h3>

<p>Stochastic realizations of the models can be performed in parallel using the <code><a href="#topic+model_parallel">model_parallel</a></code> functions, and time-varying parameters can be supplied using <code><a href="#topic+time_windows">time_windows</a></code> objects.
</p>


<h3>Author(s)</h3>

<p>Maintainer: Joseph Mihaljevic &lt;joseph.mihaljevic@nau.edu&gt;
</p>

<hr>
<h2 id='covid19_control'>
COVID19 Parameters Control Data Structure
</h2><span id='topic+covid19_control'></span>

<h3>Description</h3>

<p>The COVID19 model uses parameters which are specific to the COVID19 model. This data structure affirms that required parameters are supplied, provides default values for optional parameters, and validates the data of each parameter.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>    covid19_control(
        input_N_pops=NULL,
        input_S_pops=NULL,
        input_E_pops=NULL,
        input_I_asym_pops=NULL,
        input_I_presym_pops=NULL,
        input_I_sym_pops=NULL,
        input_I_home_pops=NULL,
        input_I_hosp_pops=NULL,
        input_I_icu1_pops=NULL,
        input_I_icu2_pops=NULL,
        input_R_pops=NULL,
        input_D_pops=NULL,
        frac_beta_asym=0.55,
        frac_beta_hosp=0.05,
        delta=1/3.0,
        recov_a=1/6.0,
        recov_p=1/2.0,
        recov_s=1/6.0,
        recov_home=1/3.0,
        recov_icu1=1/8.0,
        recov_icu2=1/4.0,
        asym_rate=0.40,
        sym_to_icu_rate=0.015
    )
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="covid19_control_+3A_input_n_pops">input_N_pops</code></td>
<td>

<p>Integer Vector representing the total population for each county.
</p>
</td></tr>
<tr><td><code id="covid19_control_+3A_input_s_pops">input_S_pops</code></td>
<td>

<p>Integer Vector representing the susceptible population for each county.
</p>
</td></tr>
<tr><td><code id="covid19_control_+3A_input_e_pops">input_E_pops</code></td>
<td>

<p>Integer Vector representing the exposed population for each county.
</p>
</td></tr>
<tr><td><code id="covid19_control_+3A_input_i_asym_pops">input_I_asym_pops</code></td>
<td>

<p>Integer Vector representing the asymptomatic infected population for each county.
</p>
</td></tr>
<tr><td><code id="covid19_control_+3A_input_i_presym_pops">input_I_presym_pops</code></td>
<td>

<p>Integer Vector representing the presymptomatic infected population for each county.
</p>
</td></tr>
<tr><td><code id="covid19_control_+3A_input_i_sym_pops">input_I_sym_pops</code></td>
<td>

<p>Integer Vector representing the symptomatic infected population for each county.
</p>
</td></tr>
<tr><td><code id="covid19_control_+3A_input_i_home_pops">input_I_home_pops</code></td>
<td>

<p>Integer Vector representing the infected and isolated at home population for each county.
</p>
</td></tr>
<tr><td><code id="covid19_control_+3A_input_i_hosp_pops">input_I_hosp_pops</code></td>
<td>

<p>Integer Vector representing the hospitalized population for each county.
</p>
</td></tr>
<tr><td><code id="covid19_control_+3A_input_i_icu1_pops">input_I_icu1_pops</code></td>
<td>

<p>Integer Vector representing the population for each county in ICU.
</p>
</td></tr>
<tr><td><code id="covid19_control_+3A_input_i_icu2_pops">input_I_icu2_pops</code></td>
<td>

<p>Integer Vector representing the population for each county in ICU recovery.
</p>
</td></tr>
<tr><td><code id="covid19_control_+3A_input_r_pops">input_R_pops</code></td>
<td>

<p>Integer Vector representing the recovered population for each county.
</p>
</td></tr>
<tr><td><code id="covid19_control_+3A_input_d_pops">input_D_pops</code></td>
<td>

<p>Integer Vector representing the deaths for each county.
</p>
</td></tr>
<tr><td><code id="covid19_control_+3A_frac_beta_asym">frac_beta_asym</code></td>
<td>

<p>An adjustment to beta accounting for asymptomatic individuals being less likely to transmit than symptomatic individuals. Default value is 0.55. Must be greater than zero and less than or equal to one.
</p>
</td></tr>
<tr><td><code id="covid19_control_+3A_frac_beta_hosp">frac_beta_hosp</code></td>
<td>

<p>An adjustment to beta accounting for hospitalized individuals being less likely to transmit than non-hospitalized individuals. Default value is 0.05. Must be greater than zero and less than or equal to one.
</p>
</td></tr>
<tr><td><code id="covid19_control_+3A_delta">delta</code></td>
<td>

<p>Incubation period. Default value is 1/3.0. Must be greater than or equal to zero. Values above one are unusual.
</p>
</td></tr>
<tr><td><code id="covid19_control_+3A_recov_a">recov_a</code></td>
<td>

<p>Recovery rate of asymptomatic individuals. Default value is 1/6.0. Must be greater than or equal to zero. Values above one are unusual.
</p>
</td></tr>
<tr><td><code id="covid19_control_+3A_recov_p">recov_p</code></td>
<td>

<p>Recovery rate of presymptomatic individuals. Default value is 1/2.0. Must be greater than or equal to zero. Values above one are unusual.
</p>
</td></tr>
<tr><td><code id="covid19_control_+3A_recov_s">recov_s</code></td>
<td>

<p>Recovery rate of symptomatic individuals. Default value is 1/6.0. Must be greater than or equal to zero. Values above one are unusual.
</p>
</td></tr>
<tr><td><code id="covid19_control_+3A_recov_home">recov_home</code></td>
<td>

<p>Recovery rate of infected individuals in home isolation. Default value is 1/3.0. Must be greater than or equal to zero. Values above one are unusual.
</p>
</td></tr>
<tr><td><code id="covid19_control_+3A_recov_icu1">recov_icu1</code></td>
<td>

<p>Recovery rate of individuals in ICU. Default value is 1/8.0. Must be greater than or equal to zero. Values above one are unusual.
</p>
</td></tr>
<tr><td><code id="covid19_control_+3A_recov_icu2">recov_icu2</code></td>
<td>

<p>Recovery rate of individuals in ICU recovery. Default value is 1/4.0. Must be greater than or equal to zero. Values above one are unusual.
</p>
</td></tr>
<tr><td><code id="covid19_control_+3A_asym_rate">asym_rate</code></td>
<td>

<p>Proportion of presymtomatic individuals entering the asymptomatic stage. Default value is 0.40. Must be greater than zero and less than or equal to one.
</p>
</td></tr>
<tr><td><code id="covid19_control_+3A_sym_to_icu_rate">sym_to_icu_rate</code></td>
<td>

<p>Proportion of symptomatic individuals entering ICU. Default value is 0.015. Must be greater than zero and less than or equal to one.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Defines a set of parameters specific to the COVID19 model. Adjustments to the model calculations can be made by specifying any or all of the optional parameters. If an optional parameter is not set, it will use the default value as specified above. If a parameter is outside the specified limits, execution will stop and an error message will be displayed. Some parameters may have values greater than one. While these situations may be unusual, execution will not stop but a warning message will be displayed.
</p>
<p>Note: At least one of <code>input_N_pops</code> or <code>input_S_pops</code> must be supplied. If one is not supplied, it will be calculated within the class.
</p>
<p>Note: At least one of <code>input_E_pops</code>, <code>input_I_asym_pops</code>, <code>input_I_presym_pops</code>, <code>input_I_sym_pops</code>, <code>input_I_home_pops</code>, <code>input_I_hosp_pops</code>, <code>input_I_icu1_pops</code>, and <code>input_I_icu2_pops</code> must be supplied with a nonzero population. Any of these population parameters not supplied will be assumed to be a vector of zeroes.
</p>


<h3>Value</h3>

<p>Returns a named list of vectors that must be supplied to <code><a href="#topic+model_interface">model_interface</a></code>.
</p>


<h3>Author(s)</h3>

<p>Seth Borkovec, <a href="mailto:stb224@nau.edu">stb224@nau.edu</a>; Joseph Mihaljevic, <a href="mailto:joseph.mihaljevic@nau.edu">joseph.mihaljevic@nau.edu</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+seir_control">seir_control</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Data set for the examples:
N_pops &lt;- rep(100000, 10)
E_pops &lt;- c(0, 1, 0, 3, 2, 0, 14, 3, 0, 0)
S_pops &lt;- N_pops - E_pops
I_asym_pops &lt;- rep(0, 10)
I_presym_pops &lt;- rep(0, 10)
I_sym_pops &lt;- c(1, 0, 11, 0, 0, 5, 0, 0, 9, 0)
I_home_pops &lt;- rep(0, 10)
I_hosp_pops &lt;- rep(0, 10)
I_icu1_pops &lt;- rep(0, 10)
I_icu2_pops &lt;- rep(0, 10)
R_pops &lt;- rep(0, 10)
D_pops &lt;- rep(0, 10)

## Example using the default parameters:
covid19_control &lt;- covid19_control(input_S_pops         = S_pops,
                                   input_E_pops         = E_pops)

## Example specifying some parameters:
covid19_control &lt;- covid19_control(input_N_pops         = N_pops,
                                   input_I_sym_pops     = I_sym_pops,
                                   input_I_home_pops    = I_home_pops,
                                   input_I_hosp_pops    = I_hosp_pops,
                                   input_I_icu2_pops    = I_icu2_pops,
                                   input_D_pops         = D_pops,
                                   frac_beta_hosp       = 0.03)

## Example specifying all possible parameters:
covid19_control &lt;- covid19_control(input_S_pops         = S_pops,
                                   input_E_pops         = E_pops,
                                   input_I_asym_pops    = I_asym_pops,
                                   input_I_presym_pops  = I_presym_pops,
                                   input_I_sym_pops     = I_sym_pops,
                                   input_I_home_pops    = I_home_pops,
                                   input_I_hosp_pops    = I_hosp_pops,
                                   input_I_icu1_pops    = I_icu1_pops,
                                   input_I_icu2_pops    = I_icu2_pops,
                                   input_R_pops         = R_pops,
                                   input_D_pops         = D_pops,
                                   frac_beta_asym       = 0.50,
                                   frac_beta_hosp       = 0.06,
                                   delta                = 0.25,
                                   recov_a              = 0.57,
                                   recov_p              = 0.62,
                                   recov_s              = 0.11,
                                   recov_home           = 0.28,
                                   recov_icu1           = 0.12,
                                   recov_icu2           = 0.29,
                                   asym_rate            = 0.65,
                                   sym_to_icu_rate      = 0.122)
</code></pre>

<hr>
<h2 id='model_interface'>
Universal Model Interface to the SPARSE-MOD Models
</h2><span id='topic+model_interface'></span>

<h3>Description</h3>

<p><code>model_interface</code> determines which SPARSE-MOD model to run based on the arguments and runs the specified model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>    model_interface(
        control,
        arg.list
    )
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="model_interface_+3A_control">control</code></td>
<td>

<p>Either a <code>covid19_control</code> or <code>seir_control</code> named list. The control used will determine which model to run.
</p>
</td></tr>
<tr><td><code id="model_interface_+3A_arg.list">arg.list</code></td>
<td>

<p>A named list of arguments used in all models including:
</p>

<ul>
<li><p><code>input_dist_mat</code>
</p>
</li>
<li><p><code>input_census_area</code>
</p>
</li>
<li><p><code>input_realz_seeds</code>
</p>
</li>
<li><p><code>input_tw</code>: A time window object (see <code><a href="#topic+time_windows">time_windows</a></code>)
</p>
</li>
<li><p><code>trans_type</code>: Transmission type (see details below)
</p>
</li>
<li><p><code>dd_trans_monod_k</code>: The Monod equation parameter 'k', for when transmission is density-dependent (see details below)
</p>
</li>
<li><p><code>stoch_sd</code>: The standard deviation of the stochastic transmission rate (see details below)
</p>
</li></ul>

</td></tr>
</table>


<h3>Details</h3>

<p>This is the universal interface to all of the SPARSE-MOD models. Currently the models available are the COVID-19 Model, and the SEIR Model.
</p>
<p>The SPARSE-MOD COVID-19 Model describes transmission using 11 classes of individuals. Please see the vignettes for a more detailed explanation of the model structure.
</p>
<p>The SPARSE-MOD SEIR Model describes transmission using 4 classes of individuals. Please see the vignettes for a more detailed explanation of the model structure.
</p>
<p>Transmisison types: The day-specific transmission rate (beta) must be supplied. We allow for two transmission types:
</p>

<ol>
<li><p>Frequency-dependent transmission: In this case the transmission function is: </p>
<p style="text-align: center;"><code class="reqn">beta_scaled = beta / pop_N.</code>
</p>
<p> This is calculated per sub-population. 

</p>
</li>
<li><p>Density-dependent transmission: In this case, we allow a user-defined Monod equation to scale the beta term by sub-population density, where <code class="reqn">pop_density = pop_N / census_area</code> :
</p>
<p style="text-align: center;"><code class="reqn">
                beta_scaled = (beta * pop_dens / (dd_trans_monod_k + pop_dens)) / pop_N
            </code>
</p>


</li></ol>

<p>Stochastic transmission: We implement daily stochastic variation in the transmission rate that scales with the number of infectious individuals in the focal population. In other words, as the number of infectious individuals increases, the variation in transmission rate reduces, emphasizing that stochasticity has larger effects in smaller populations (i.e., larger effects when there are few infectious individuals). To implement this stochasticity, we draw a random variate from a normal distribution with a mean of zero and a standard deviation of <code>stoch_sd</code>, and this random variate is termed <code>noise</code>. We calculate the total number of infectious individuals across infectious sub-classes (e.g., Pre-symptomatic, Hospital, etc.), and this variable is termed <code>infect_sum</code>. The functional form of stochasticity is then:
</p>
<p style="text-align: center;"><code class="reqn">beta_realized = | beta_scaled * (1 + (noise / sqrt(infect_sum))) |</code>
</p>

<p>See <code><a href="#topic+Movement">Movement</a></code> for details of how movement dynamics are implemented and controlled in the model.
</p>


<h3>Value</h3>

<p>Two named lists:
</p>

<ol>
<li><p><code>pops</code>: Integer vectors that provide the number of individuals in each model class at each time step. Different realizations of the model are distinguised by the user-provided values for the random seeds.
</p>
</li>
<li><p><code>events</code>: Integer vectors that provide the number of individuals that newly transitioned to specific, key model classes at each time step. Different realizations of the model are distinguised by the user-provided values for the random seeds.
</p>
<p>For the COVID-19 model, these event vectors are defined as:
</p>

<ul>
<li><p><code>pos</code>: Number of newly positive individuals. Sum of new asymptomatic and pre-symptomatic individuals.
</p>
</li>
<li><p><code>sym</code>: Number of newly symptomatic individuals.
</p>
</li>
<li><p><code>total_hosp</code>: Number of newly hospitalized individuals. Sum of new Hospital admits and new Symptomatic-to-ICU1 admits.
</p>
</li>
<li><p><code>total_icu</code>: Number of new ICU admits. Sum of new Symptomatic-to-ICU1 admits and new Hospital-to-ICU1 admits.
</p>
</li>
<li><p><code>n_death</code>: Number of newly deceased individuals.
</p>
</li></ul>

<p>For the SEIR model, these event vectors are defined as:
</p>

<ul>
<li><p><code>birth</code>: Number of newly susceptible hosts through the process of reproduction.
</p>
</li>
<li><p><code>exposed</code>: Number of newly exposed hosts.
</p>
</li>
<li><p><code>infectious</code>: Number of newly infectious hosts.
</p>
</li>
<li><p><code>recov</code>: Number of newly recovered hosts.
</p>
</li>
<li><p><code>death</code>: Number of newly deceased hosts.
</p>
</li></ul>


</li></ol>



<h3>Author(s)</h3>

<p>Joseph Mihaljevic, <a href="mailto:joseph.mihaljevic@nau.edu">joseph.mihaljevic@nau.edu</a><br />
Seth Borkovec, <a href="mailto:stb224@nau.edu">stb224@nau.edu</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+model_parallel">model_parallel</a></code>, <code><a href="#topic+time_windows">time_windows</a></code>, <code><a href="#topic+covid19_control">covid19_control</a></code>, <code><a href="#topic+seir_control">seir_control</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## See vignettes for more detailed work-ups.

##########################################
## See model_parallel()
## for an example to run realizations in parallel

##########################################
# Required for run:
require(lubridate)

## Using supplied example data:

# Read in the example data:
ex_dir &lt;- system.file(
  "extdata", "sparsemodr_example.Rdata", package="SPARSEMODr", mustWork=TRUE)
load(ex_dir)
n_pop &lt;- length(dat_list[["pop_N"]])

# Set up realizations:
realz_seeds &lt;- 1:2
n_realz &lt;- length(realz_seeds)

# Set up time windows (see time_windows for other ways to do this)
input_beta &lt;-           c(   0.3,   0.3,  0.08,  0.08,  0.15)
input_dist_phi &lt;-       c(   200,   200,    20,   150,   150)
input_m &lt;-              c( 0.002, 0.002, 0.002,  0.02,  0.02)
input_imm_frac &lt;-       c(   0.0,   0.0,   0.0,  0.02,  0.02)
# Window intervals
start_dates = c(mdy("1-1-20"),  mdy("2-1-20"),  mdy("2-16-20"), mdy("3-11-20"),  mdy("3-22-20"))
end_dates =   c(mdy("1-31-20"), mdy("2-15-20"), mdy("3-10-20"), mdy("3-21-20"), mdy("5-1-20"))


# User creates the time_windows object here
tw &lt;- time_windows(beta = input_beta,
                   dist_phi = input_dist_phi,
                   m = input_m,
                   imm_frac = input_imm_frac,
                   start_dates = start_dates,
                   end_dates = end_dates)

# Randomly generate initial conditions for
# EXPOSED class:
E_pops &lt;- vector("numeric", length = n_pop)
n_initial_E &lt;- 40
# (more exposed in larger populations)
these_E &lt;- sample.int(n_pop,
                     size = n_initial_E,
                     replace = TRUE,
                     prob = dat_list$pop_N)
for(i in 1:n_initial_E){
  E_pops[these_E[i]] &lt;- E_pops[these_E[i]] + 1
}

# Inputs for the models
N_pops &lt;- as.integer(dat_list[["pop_N"]])
S_pops &lt;- N_pops - E_pops

# User created control list of parameters
covid19_control &lt;- covid19_control(input_N_pops = N_pops,
                                   input_S_pops = S_pops,
                                   input_E_pops = E_pops)

arg.list &lt;- list(
    input_dist_mat =    dat_list$dist_vec,
    input_census_area = dat_list$census_area,
    input_tw =          tw,
    input_realz_seeds = realz_seeds
)

# Using all default parameter values,
# these are the minimum inputs
covid_model_output &lt;-
  model_interface(
    control = covid19_control,
    arg.list
  )

</code></pre>

<hr>
<h2 id='model_parallel'>
Parallelized implementation of the SPARSE-MOD models
</h2><span id='topic+model_parallel'></span>

<h3>Description</h3>

<p>The function uses <code>R</code>-level parallelization to speed up the generation of stochastic realizations of the SPARSEMODr models and to combine output data into a read-to-use data frame. This is the preferred method to run <code><a href="#topic+model_interface">model_interface</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>  model_parallel(..., input_realz_seeds = 1:2, control)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="model_parallel_+3A_...">...</code></td>
<td>

<p>Universal model arguments passed to <code><a href="#topic+model_interface">model_interface</a></code>.
</p>
</td></tr>
<tr><td><code id="model_parallel_+3A_input_realz_seeds">input_realz_seeds</code></td>
<td>

<p>An integer vector of user-specified random seeds to generate the stochastic realizations of the model. The number of realizations will be equal to the length of this vector.
</p>
</td></tr>
<tr><td><code id="model_parallel_+3A_control">control</code></td>
<td>

<p>Either a <code><a href="#topic+covid19_control">covid19_control</a></code> or a <code><a href="#topic+seir_control">seir_control</a></code> named list data object.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Relies on <code><a href="future.apply.html#topic+future_lapply">future_lapply</a></code> to run stochastic realizations of the SPARSEMODr model in parallel.
</p>


<h3>Value</h3>

<p>A data frame that combines the two named lists of <code><a href="#topic+model_interface">model_interface</a></code>.
</p>


<h3>Author(s)</h3>

<p>Joseph Mihaljevic, <a href="mailto:joseph.mihaljevic@nau.edu">joseph.mihaljevic@nau.edu</a>; Toby Hocking, <a href="mailto:toby.hocking@r-project.org">toby.hocking@r-project.org</a>
</p>


<h3>See Also</h3>

<p><code><a href="future.apply.html#topic+future_lapply">future_lapply</a></code>, <code><a href="#topic+model_interface">model_interface</a></code>, <code><a href="#topic+time_windows">time_windows</a></code>, <code><a href="#topic+covid19_control">covid19_control</a></code>, <code><a href="#topic+seir_control">seir_control</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## See vignettes for more detailed work-ups.


##########################################
# Required for run:
require(lubridate)

## Using supplied example data:

# Read in the example data:
ex_dir &lt;- system.file(
  "extdata", "sparsemodr_example.Rdata", package="SPARSEMODr", mustWork=TRUE)
load(ex_dir)
n_pop &lt;- length(dat_list[["pop_N"]])

# Set up realizations:
realz_seeds &lt;- 1:2
n_realz &lt;- length(realz_seeds)

# START FUTURE PLAN FOR PARALLELIZATION
future::plan("multisession")

# Set up time windows (see time_windows for other ways to do this)
input_beta &lt;-           c(   0.3,   0.3,  0.08,  0.08,  0.15)
input_dist_phi &lt;-     c(   200,   200,    20,   150,   150)
input_m &lt;-              c( 0.002, 0.002, 0.002,  0.02,  0.02)
input_imm_frac &lt;-       c(   0.0,   0.0,   0.0,  0.02,  0.02)
# Window intervals
start_dates = c(mdy("1-1-20"),  mdy("2-1-20"),  mdy("2-16-20"), mdy("3-11-20"),  mdy("3-22-20"))
end_dates =   c(mdy("1-31-20"), mdy("2-15-20"), mdy("3-10-20"), mdy("3-21-20"), mdy("5-1-20"))


# User creates the time_windows object here
tw &lt;- time_windows(beta = input_beta,
                   dist_phi = input_dist_phi,
                   m = input_m,
                   imm_frac = input_imm_frac,
                   start_dates = start_dates,
                   end_dates = end_dates)

# Randomly generate initial conditions for
# EXPOSED class:
E_pops &lt;- vector("numeric", length = n_pop)
n_initial_E &lt;- 40
# (more exposed in larger populations)
these_E &lt;- sample.int(n_pop,
                     size = n_initial_E,
                     replace = TRUE,
                     prob = dat_list$pop_N)
for(i in 1:n_initial_E){
  E_pops[these_E[i]] &lt;- E_pops[these_E[i]] + 1
}

# Population sizes
N_pops &lt;- as.integer(dat_list[["pop_N"]])

# Set up a function to use the dat_list

get_result &lt;- function(input_realz_seeds, control = NULL){

    with(dat_list, SPARSEMODr::model_parallel(
        input_census_area = census_area,
        input_dist_mat = dist_vec,
        input_realz_seeds = input_realz_seeds,
        input_tw = tw,
        control = control)
    )
}

# User creates control list of parameters
covid19_control &lt;- covid19_control(input_N_pops = N_pops,
                                   input_E_pops = E_pops)

covid_model_output &lt;-
    get_result(
        input_realz_seeds = realz_seeds,
        control = covid19_control
    )

# Shut down parallel workers
future::plan("sequential")
</code></pre>

<hr>
<h2 id='Movement'>
Movement dynamics in SPARSEMODr models.
</h2><span id='topic+Movement'></span>

<h3>Description</h3>

<p>The SPARSEMODr models allow for spatially explicit movement dynamics between focal populations, and for 'visitation' from outside of the focal populations of interest.
</p>


<h3>Details</h3>

<p>The meta-population of interest is defined by the focal populations supplied by the user in <code><a href="#topic+model_interface">model_interface</a></code>. Movement between focal populations within the meta-population is implemented as daily visitation (e.g., commuting). Specifically, individuals can move to a new focal population and can influence the local transmission dynamics for that day, but then individuals return to their focal population before the model simulates the next day's events. Every day, immigrants from outside of the meta-population can also visit the focal populations and influence transmission.
</p>
<p><em>Movement within the meta-population</em>
</p>
<p>We assume that susceptible and infectious individuals can move between focal populations. In the COVID-19 model, we further assume that only individuals in the Susceptible, Asymptomatic, and Pre-symptomatic classes are moving. This is because we assume individuals that are Symptomatic, Home (isolating) or in the hospital (Hospital, ICU1, ICU2) will not be moving outside of their focal population.
</p>
<p>In general, susceptible individuals in a focal population can become exposed to the pathogen by infectious visitors from the meta-population or by infectious visitors from outside of the meta-population (below). Similarly, susceptible individuals can visit a population within the meta-community but outside of their focal population, at which point these susceptible individuals may become exposed by resident infectious individuals.
</p>
<p>Movement frequency is controlled by parameter <code>m</code> in the model, and this rate can be updated daily to simulate changes in movement patterns over time (see <code><a href="#topic+time_windows">time_windows</a></code>). In the model differential equations, <code>m</code> is the per-capita rate of movement outside of the focal population. The inverse of <code>m</code> therefore corresponds to the average number of days between an individual's movement events.
</p>
<p>When an individual moves outside of their focal population, the model assigns this individual to a new focal population using a dispersal kernel. For now, we implement a simple distance-based dispersal kernal in the form:
<code> prob_move[i][j] = 1 / exp(dist_mat[i][j] / dist_phi). </code>
Here, as is convention, <code>prob_move[i][j]</code> corresponds to the probability of individuals in population <code>j</code> moving to population <code>i</code>. The <code>dist_phi</code> is user-defined and can be updated daily in the simulaiton (see <code><a href="#topic+time_windows">time_windows</a></code>).
</p>
<p>On each day in the model simulation, the tau-leaping algorithm calculates the number of individuals in each class that will move outside of their focal population. We determine which individuals will move to which outside population using a random draw from a multinomial probability distribution, using the <code>prob_move[i][j]</code> that are calculated as above. Once individuals are assigned to their new, temporary populations, then transmission can occur dependent upon the local composition of infectious individuals.
</p>
<p><em>Immigration from outside of the meta-population</em>
</p>
<p>The model allows for outside visitors to enter the system temporarily, with visitors updated daily. In this case, the user can define parameter <code>imm_frac</code>, the value of which can be updated daily (see <code><a href="#topic+time_windows">time_windows</a></code>). The <code>imm_frac</code> is the proportion of the focal population that may constitute visitors on any given day. For example if for a given focal population, <code>pop_N = 1000</code> and <code>imm_frac = 0.05</code>, an average of 50 visitors may arrive on a given day. The exact number of visitors on a given day is determined by drawing from a Poisson distribution. Then, the number of <em>infectious</em> visitors from that group is assumed to be proportional to the number of infectious <em>residents</em> in the focal population. In other words, we assume that the pathogen is present in 'outsider' populations at similar prevalence as the focal population. The exact number of infectious visitors is then determined again by a Poisson draw. After visitors arrive at the focal population, transmission between susceptible residents and infectious visitors is determined.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+model_interface">model_interface</a></code>, <code><a href="#topic+model_parallel">model_parallel</a></code>, <code><a href="#topic+time_windows">time_windows</a></code>
</p>

<hr>
<h2 id='seir_control'>
SEIR Parameters Control Data Structure
</h2><span id='topic+seir_control'></span>

<h3>Description</h3>

<p>The SEIR model uses parameters which are specific to the SEIR model. This data structure affirms that required parameters are supplied, provides default values for optional parameters, and validates the data of each parameter.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>    seir_control(
        input_N_pops=NULL,
        input_S_pops=NULL,
        input_E_pops=NULL,
        input_I_pops=NULL,
        input_R_pops=NULL,
        birth=1/(75*365),
        incubate=1/8.0,
        recov=1/3.0
    )
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="seir_control_+3A_input_n_pops">input_N_pops</code></td>
<td>

<p>Integer Vector representing the total population for each county.
</p>
</td></tr>
<tr><td><code id="seir_control_+3A_input_s_pops">input_S_pops</code></td>
<td>

<p>Integer Vector representing the susceptible population for each county.
</p>
</td></tr>
<tr><td><code id="seir_control_+3A_input_e_pops">input_E_pops</code></td>
<td>

<p>Integer Vector representing the exposed population for each county.
</p>
</td></tr>
<tr><td><code id="seir_control_+3A_input_i_pops">input_I_pops</code></td>
<td>

<p>Integer Vector representing the infected population for each county.
</p>
</td></tr>
<tr><td><code id="seir_control_+3A_input_r_pops">input_R_pops</code></td>
<td>

<p>Integer Vector representing the recovered population for each county.
</p>
</td></tr>
<tr><td><code id="seir_control_+3A_birth">birth</code></td>
<td>

<p>Default value is 1/(75*365). Must be greater than or equal to zero. Values above one are unusual.
</p>
</td></tr>
<tr><td><code id="seir_control_+3A_incubate">incubate</code></td>
<td>

<p>Default value is 1/8.0. Must be greater than or equal to zero. Values above one are unusual.
</p>
</td></tr>
<tr><td><code id="seir_control_+3A_recov">recov</code></td>
<td>

<p>Default value is 1/3.0. Must be greater than or equal to zero. Values above one are unusual.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Defines a set of parameters specific to the SEIR model. If an optional parameter is not set, it will use the default value as specified above. If a parameter is outside the specified limits, execution will stop and an error message will be displayed. Some parameters may have values greater than one. While these situations may be unusual, execution will not stop but a warning message will be displayed.
</p>
<p>Note: At least one of <code>input_N_pops</code> or <code>input_S_pops</code> must be supplied. If one is not supplied, it will be calculated within the class.
</p>
<p>Note: At least one of <code>input_E_pops</code> and <code>input_I_pops</code> must be supplied with a nonzero population. If either of these population parameters or <code>input_R_pops</code> is not supplied, it will be assumed to be a vector of zeroes.
</p>


<h3>Value</h3>

<p>Returns a named list of vectors that must be supplied to <code><a href="#topic+model_interface">model_interface</a></code>.
</p>


<h3>Author(s)</h3>

<p>Seth Borkovec, <a href="mailto:stb224@nau.edu">stb224@nau.edu</a>; Joseph Mihaljevic, <a href="mailto:joseph.mihaljevic@nau.edu">joseph.mihaljevic@nau.edu</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+covid19_control">covid19_control</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Data set for the examples:
S_pops &lt;- rep(100000, 10)
E_pops &lt;- c(0, 1, 0, 3, 2, 0, 13, 3, 0, 0)
I_pops &lt;- c(0, 0, 0, 0, 0, 0, 1, 0, 0, 0)
R_pops &lt;- rep(0, 10)
N_pops &lt;- S_pops + E_pops + I_pops + R_pops

## Example using the default parameters:
seir_control &lt;- seir_control(input_S_pops = S_pops,
                             input_E_pops = E_pops,
                             input_I_pops = I_pops)

## Example specifying one optional parameter:
seir_control &lt;- seir_control(input_N_pops = N_pops,
                             input_I_pops = I_pops,
                             input_R_pops = R_pops,
                             recov          = 1/4.0)

## Example specifying all possible parameters:
seir_control &lt;- seir_control(input_N_pops = N_pops,
                             input_S_pops = S_pops,
                             input_E_pops = E_pops,
                             input_I_pops = I_pops,
                             input_R_pops = R_pops,
                             birth          = 1/(65*365),
                             incubate       = 0.12,
                             recov          = 0.25)
</code></pre>

<hr>
<h2 id='time_windows'>
Time Windows Data Structure
</h2><span id='topic+time_windows'></span>

<h3>Description</h3>

<p>The SPARSEMODr models allow for users to dynamically update transmission rates and movement dynamics across the course of the outbreak. These time-varying parameter values must then be compiled into a <code>time_windows</code> object.
</p>
<p>A <code>time_windows</code> object is a set of data across multiple vectors or lists including time-varying transmission rate (<code>beta</code>); a parameter that helps define the range of movement; a parameter that defines the frequency of movement between focal populations; a parameter that constrains the impact of hosts that immigrate from outside of the focal populations; and a method to define the dates over which these parameters fluctuate. 
</p>
<p>When specifying dates for each entry, there are three options, but only one of which may be used. See details below.
</p>

<ol>
<li><p>Providing a vector for <code>window_length</code>,
</p>
</li>
<li><p>Providing a vector each for <code>start_dates</code> and <code>end_dates</code>,
</p>
</li>
<li><p>Providing a vector for <code>daily</code>.
</p>
</li></ol>



<h3>Usage</h3>

<pre><code class='language-R'>    time_windows(
        beta=NULL,
        dist_phi=NULL,
        m=NULL,
        imm_frac=NULL,
        hosp_rate=NULL,
        recov_hosp=NULL,
        icu_rate=NULL,
        death_rate=NULL,
        window_length=NULL,
        start_dates=NULL,
        end_dates=NULL,
        daily=NULL,
        r0=NULL
    )
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="time_windows_+3A_beta">beta</code></td>
<td>

<p><em>required</em> - <strong>New in version 1.2.0</strong>: A numeric vector of the time-varying transmission rate. If a single vector is provided, the same transmission rate is used in all populations. You can instead provide a list of transmission rate vectors&ndash;one for each population. The number of populations must be equal to those used in the <code><a href="#topic+covid19_control">covid19_control</a></code> or <code><a href="#topic+seir_control">seir_control</a></code>.
</p>
</td></tr>
<tr><td><code id="time_windows_+3A_dist_phi">dist_phi</code></td>
<td>

<p><em>required</em> - A numeric vector of the <code>dist_phi</code> that is used to calculate the dispersal kernal (see details below).
</p>
</td></tr>
<tr><td><code id="time_windows_+3A_m">m</code></td>
<td>

<p><em>required</em> - A numeric vector of the <code>m</code> parameter. The inverse of <code>m</code> is the average time between individuals moving away from their focal population (see details below).
</p>
</td></tr>
<tr><td><code id="time_windows_+3A_imm_frac">imm_frac</code></td>
<td>

<p><em>required</em> - A numeric vector. This parameter corresponds to the fraction of the focal population (between 0 and 1) that may be comprised of immigrants from outside of the system (i.e., immigrants that are not from any of the supplied populations in <code>input_pop_N</code> from <code><a href="#topic+model_interface">model_interface</a></code>); see details below.
</p>
</td></tr>
<tr><td><code id="time_windows_+3A_hosp_rate">hosp_rate</code></td>
<td>

<p>A numeric vector. Proportion of symptomatic individuals entering hospitalization. Default value is 0.175. Must be greater than zero and less than or equal to one.
</p>
</td></tr>
<tr><td><code id="time_windows_+3A_recov_hosp">recov_hosp</code></td>
<td>

<p>A numeric vector. Recovery rate of hospitalized individuals. Default value is 1/7.0. Must be greater than or equal to zero. Values above one are unusual.
</p>
</td></tr>
<tr><td><code id="time_windows_+3A_icu_rate">icu_rate</code></td>
<td>

<p>A numeric vector. Proportion of hospitalized individuals entering ICU. Default value is 0.20. Must be greater than zero and less than or equal to one.
</p>
</td></tr>
<tr><td><code id="time_windows_+3A_death_rate">death_rate</code></td>
<td>

<p>A numeric vector. Proportion of individuals who do not recover in ICU. Default value is 0.60. Must be greater than zero and less than or equal to one.
</p>
</td></tr>
<tr><td><code id="time_windows_+3A_window_length">window_length</code></td>
<td>

<p>An integer vector supplying the number of days in each time window (see details below).
</p>
</td></tr>
<tr><td><code id="time_windows_+3A_start_dates">start_dates</code></td>
<td>

<p>A vector of Date objects that corresponds to the starting date of each time window. If supplied, <code>end_dates</code> must also be supplied (see details below).
</p>
</td></tr>
<tr><td><code id="time_windows_+3A_end_dates">end_dates</code></td>
<td>

<p>A vector of Date objects that corresponds to the ending dates of each time window. If supplied <code>start_dates</code> must also be supplied (see details below).
</p>
</td></tr>
<tr><td><code id="time_windows_+3A_daily">daily</code></td>
<td>

<p>A vector of Date objects that is sequential and complete, encompassing all dates from the start of the outbreak to the end of the outbreak (see details below).
</p>
</td></tr>
<tr><td><code id="time_windows_+3A_r0">r0</code></td>
<td>

<p>No longer supported. Gives error message to provide beta instead.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>See <code><a href="#topic+Movement">Movement</a></code> for descriptions of <code>m</code> and <code>dist_phi</code>.
</p>
<p>Defining time window durations. One of the following options is required to define the duration of each time window: <code>window_length</code>, or <code>start_dates</code> AND <code>end_dates</code>, or <code>daily</code>.
</p>
<p>Use <code>window_length</code> when you want to specify the length of each time window by the number of days.
</p>
<p>Use <code>start_dates</code> AND <code>end_dates</code> when you want to define a time window by its starting and ending dates. A start date may not overlap with an end date, and there can be no gaps between the end date and the subsequent start date.
</p>
<p>Use <code>daily</code> when you want to update parameters every day of the simulation. In this mode, each time window has a length of one day.
</p>


<h3>Value</h3>

<p>Returns a named list of vectors that must be supplied to <code><a href="#topic+model_interface">model_interface</a></code>.
</p>


<h3>Author(s)</h3>

<p>Seth Borkovec, <a href="mailto:stb224@nau.edu">stb224@nau.edu</a>; Joseph Mihaljevic, <a href="mailto:joseph.mihaljevic@nau.edu">joseph.mihaljevic@nau.edu</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+covid19_control">covid19_control</a></code>, <code><a href="#topic+seir_control">seir_control</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Data set for the examples: (All examples include 5 time windows)
input_beta &lt;-           c(  0.30,  0.10,  0.15,  0.15,  0.20)
input_dist_phi &lt;-       c(   200,   200,    20,   150,   150)
input_m &lt;-              c( 0.002, 0.002, 0.002,  0.02,  0.02)
input_imm_frac &lt;-       c(   0.0,   0.0,   0.0,  0.02,  0.02)
input_window_length &lt;-  c(    10,    35,    46,    81,    40)
input_start_dates &lt;-    c(seq(as.Date("2020-07-09"), by=10, len=5))
input_end_dates &lt;-      c(seq(as.Date("2020-07-18"), by=10, len=5))
input_daily &lt;-          c(seq(as.Date("2020-07-09"), by=1, len=5))

## Example using window_length:
### input_window_length defines the number of days
### that each value of the other parameters is repeated.
tw &lt;- time_windows(beta          = input_beta,
                   dist_phi    = input_dist_phi,
                   m             = input_m,
                   imm_frac      = input_imm_frac,
                   window_length = input_window_length)

## Example using start_dates with end_dates:
### Five time windows, each with 10 days
tw &lt;- time_windows(beta         = input_beta,
                   dist_phi   = input_dist_phi,
                   m            = input_m,
                   imm_frac     = input_imm_frac,
                   start_dates  = input_start_dates,
                   end_dates    = input_end_dates)

## Example using daily:
### Parameters are updated daily over 5 days
tw &lt;- time_windows(beta       = input_beta,
                   dist_phi = input_dist_phi,
                   m          = input_m,
                   imm_frac   = input_imm_frac,
                   daily      = input_daily)

## Example with different beta vectors for different populations:
### n_pops should be the total number of populations as used in covid19_control or seir_control
n_pops &lt;- 4
input_beta_list &lt;- vector("list", length = n_pops)
input_beta_list[[1]]      &lt;- c( 0.30,  0.10,  0.10,  0.15,  0.20)
input_beta_list[[2]]      &lt;- c( 0.15,  0.08,  0.15,  0.10,  0.15)
input_beta_list[[3]]      &lt;- c( 0.20,  0.08,  0.10,  0.10,  0.25)
input_beta_list[[n_pops]] &lt;- c( 0.25,  0.12,  0.08,  0.12,  0.10)

tw &lt;- time_windows(beta          = input_beta_list,
                   dist_phi    = input_dist_phi,
                   m             = input_m,
                   imm_frac      = input_imm_frac,
                   window_length = input_window_length)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
