<!DOCTYPE html><html><head><title>Help for package incidental</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {incidental}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#incidental'><p>incidental: A package for computing incidence curves from delayed case records.</p></a></li>
<li><a href='#compute_expected_cases'><p>Compute expected cases</p></a></li>
<li><a href='#compute_log_incidence'><p>Compute log likelihood of incidence model</p></a></li>
<li><a href='#covid_delay_dist'><p>Delay distribution from COVID-19 pandemic.</p></a></li>
<li><a href='#covid_new_york_city'><p>New York City data from the COVID-19 pandemic.</p></a></li>
<li><a href='#data_check'><p>Input data check</p></a></li>
<li><a href='#data_processing'><p>Data processing wrapper</p></a></li>
<li><a href='#diff_trans'><p>Transpose of the 1st difference operator</p></a></li>
<li><a href='#fit_incidence'><p>Fit incidence curve to reported data</p></a></li>
<li><a href='#front_zero_pad'><p>Pad reported data with zeros in front</p></a></li>
<li><a href='#incidence_to_df'><p>Export incidence model to data frame</p></a></li>
<li><a href='#init_params'><p>Initialize spline parameters (beta)</p></a></li>
<li><a href='#make_ar_extrap_samps'><p>Make AR samples for extrapolation past end point</p></a></li>
<li><a href='#make_likelihood_matrix'><p>Make delay likelihood matrix</p></a></li>
<li><a href='#make_spline_basis'><p>Create spline basis matrix</p></a></li>
<li><a href='#marg_loglike_poisson'><p>Marginal log likelihood</p>
This function computes the marginal probability of Pr(reported | beta).  Note that
lnPmat must be zero padded enough (or censored) to match the length of
reported cases vector.</a></li>
<li><a href='#marg_loglike_poisson_fisher'><p>Marginal log likelihood Fisher information matrix</p></a></li>
<li><a href='#marg_loglike_poisson_grad'><p>Marginal log likelihood gradient</p></a></li>
<li><a href='#plot.incidence_spline_model'><p>Plot model from fit_incidence</p></a></li>
<li><a href='#poisson_objective'><p>Poisson objective function</p></a></li>
<li><a href='#poisson_objective_grad'><p>Poisson objective function gradient</p></a></li>
<li><a href='#poisson_objective_post_cov_approx'><p>Compute Fisher information matrix for Poisson objective</p></a></li>
<li><a href='#regfun'><p>Beta regularization function</p></a></li>
<li><a href='#regfun_grad'><p>Beta regularization function gradient</p></a></li>
<li><a href='#regfun_hess'><p>Beta regularization function Hessian</p></a></li>
<li><a href='#sample_laplace_log_incidence_poisson'><p>Generate Laplace samples of incidence</p></a></li>
<li><a href='#scan_spline_dof'><p>Scan spline degrees of freedom</p></a></li>
<li><a href='#scan_spline_lam'><p>Scan spline regularization parameter</p></a></li>
<li><a href='#spanish_flu'><p>Daily flu mortality from 1918 flu pandemic.</p></a></li>
<li><a href='#spanish_flu_delay_dist'><p>Delay distribution from 1918 flu pandemic.</p></a></li>
<li><a href='#train_and_validate'><p>Train and validate model on reported data</p></a></li>
<li><a href='#train_val_split'><p>Split reported case data</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Implements Empirical Bayes Incidence Curves</td>
</tr>
<tr>
<td>Version:</td>
<td>0.1</td>
</tr>
<tr>
<td>Description:</td>
<td>Make empirical Bayes incidence curves from reported case data using a specified delay distribution.</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.1.1</td>
</tr>
<tr>
<td>Imports:</td>
<td>ggplot2, MASS, matrixStats, numDeriv, dlnm, stats, utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2020-09-09 00:35:46 UTC; lhannah</td>
</tr>
<tr>
<td>Author:</td>
<td>Andrew Miller [aut],
  Lauren Hannah [aut, cre],
  Nicholas Foti [aut],
  Joseph Futoma [aut],
  Apple, Inc. [cph]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Lauren Hannah &lt;lauren_hannah@apple.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2020-09-16 09:50:03 UTC</td>
</tr>
</table>
<hr>
<h2 id='incidental'>incidental: A package for computing incidence curves from delayed case records.</h2><span id='topic+incidental'></span><span id='topic+incidental-package'></span>

<h3>Description</h3>

<p>The incidental package provides an empirical Bayes estimator for fitting incidence curves
from a specified delay distribution, which describes the probability that a case will be
reported on day d after infection.
</p>


<h3>Tutorial</h3>

<p>To learn more about incidental, start with the vignettes:
'browseVignettes(package = &quot;incidental&quot;)'
</p>


<h3>Incidental functions</h3>

<p><code><a href="#topic+fit_incidence">fit_incidence</a></code>: main function for fitting incidence.
</p>
<p><code><a href="#topic+incidence_to_df">incidence_to_df</a></code>: utility function to translate output of <code><a href="#topic+fit_incidence">fit_incidence</a></code> into a data frame.
</p>
<p><code><a href="graphics.html#topic+plot">plot</a></code>: plots the results of <code><a href="#topic+fit_incidence">fit_incidence</a></code>.
</p>


<h3>Data</h3>

<p><code><a href="#topic+spanish_flu_delay_dist">spanish_flu_delay_dist</a></code>: incidence to death delay distribution for the Spanish Flu.
</p>
<p><code><a href="#topic+spanish_flu">spanish_flu</a></code>: flu mortality data for Indiana, Kansas, and Philadelphia from 1919-09-01 through 1919-12-31.
</p>
<p><code><a href="#topic+covid_delay_dist">covid_delay_dist</a></code>: incidence to recorded cases, hospitalization, and death delay distribution for COVID-19.
</p>
<p><code><a href="#topic+covid_new_york_city">covid_new_york_city</a></code>: incidence to recorded cases, hospitalization, and death for New York City for COVID-19.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Lauren Hannah <a href="mailto:lauren_hannah@apple.com">lauren_hannah@apple.com</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> Andrew Miller <a href="mailto:acmiller@apple.com">acmiller@apple.com</a>
</p>
</li>
<li><p> Nicholas Foti <a href="mailto:nicholas_foti@apple.com">nicholas_foti@apple.com</a>
</p>
</li>
<li><p> Joseph Futoma <a href="mailto:jfutoma@apple.com">jfutoma@apple.com</a>
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> Apple, Inc. <a href="mailto:hai@apple.com">hai@apple.com</a> [copyright holder]
</p>
</li></ul>


<hr>
<h2 id='compute_expected_cases'>Compute expected cases</h2><span id='topic+compute_expected_cases'></span>

<h3>Description</h3>

<p>This function computes expected cases given incidence curve parameters and a delay distribution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compute_expected_cases(beta, Q, lnPmat, Tobs)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="compute_expected_cases_+3A_beta">beta</code></td>
<td>
<p>parameter vector of num_params</p>
</td></tr>
<tr><td><code id="compute_expected_cases_+3A_q">Q</code></td>
<td>
<p>spline basis matrix, of size Tmod x num_params</p>
</td></tr>
<tr><td><code id="compute_expected_cases_+3A_lnpmat">lnPmat</code></td>
<td>
<p>matrix size Tobs x Tobs, log of make_likelihood_matrix</p>
</td></tr>
<tr><td><code id="compute_expected_cases_+3A_tobs">Tobs</code></td>
<td>
<p>maximum observed time point</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A Tobs-length vector that models expected cases
</p>

<hr>
<h2 id='compute_log_incidence'>Compute log likelihood of incidence model</h2><span id='topic+compute_log_incidence'></span>

<h3>Description</h3>

<p>This function computes log likelihood of incidence model given parameters and observations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>compute_log_incidence(beta, Q, Tobs)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="compute_log_incidence_+3A_beta">beta</code></td>
<td>
<p>parameter vector of num_params</p>
</td></tr>
<tr><td><code id="compute_log_incidence_+3A_q">Q</code></td>
<td>
<p>spline basis matrix, of size Tmod x num_params</p>
</td></tr>
<tr><td><code id="compute_log_incidence_+3A_tobs">Tobs</code></td>
<td>
<p>maximum observed time point</p>
</td></tr>
</table>


<h3>Value</h3>

<p>I Tobs-length vector that models log incidence curve
</p>

<hr>
<h2 id='covid_delay_dist'>Delay distribution from COVID-19 pandemic.</h2><span id='topic+covid_delay_dist'></span>

<h3>Description</h3>

<p>Daily case, hospitalization, and death proportions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>covid_delay_dist
</code></pre>


<h3>Format</h3>

<p>A data frame with 61 entries and 4 columns.
</p>

<dl>
<dt>days</dt><dd><p>number of days since infection</p>
</dd>
<dt>case</dt><dd><p>proportion of cases confirmed by a test that are recorded on that day</p>
</dd>
<dt>hospitalization</dt><dd><p>proportion of cases that become hospitalized that are hospitalized on that day</p>
</dd>
<dt>death</dt><dd><p>proportion of cases that result in death that die on that day</p>
</dd>
</dl>



<h3>Source</h3>

<p>Time from incidence to symptoms: Lauer et al., &quot;Estimated Incubation Period of COVID-19&quot;, ACC (2020). <a href="https://www.acc.org/latest-in-cardiology/journal-scans/2020/05/11/15/18/the-incubation-period-of-coronavirus-disease">https://www.acc.org/latest-in-cardiology/journal-scans/2020/05/11/15/18/the-incubation-period-of-coronavirus-disease</a>.
</p>
<p>Time from symptoms to recorded cases: Case line data from Florida through 2020-07-14 with same day waits removed. <a href="https://open-fdoh.hub.arcgis.com/datasets/florida-covid19-case-line-data">https://open-fdoh.hub.arcgis.com/datasets/florida-covid19-case-line-data</a>.
</p>
<p>Time from symptoms to hospitalization: Wang et al., &quot;Clinical Characteristics of 138 Hospitalized Patients With 2019 Novel Coronavirus–Infected Pneumonia in Wuhan, China&quot;, JAMA (2020). <a href="https://jamanetwork.com/journals/jama/fullarticle/2761044">https://jamanetwork.com/journals/jama/fullarticle/2761044</a>.
</p>
<p>Time from hospitalization to death: Lewnard et al. &quot;Incidence, clinical outcomes, and transmission dynamics of severe coronavirus disease 2019 in California and Washington: prospective cohort study&quot;, BJM (2020). <a href="https://www.bmj.com/content/369/bmj.m1923.long">https://www.bmj.com/content/369/bmj.m1923.long</a>
</p>

<hr>
<h2 id='covid_new_york_city'>New York City data from the COVID-19 pandemic.</h2><span id='topic+covid_new_york_city'></span>

<h3>Description</h3>

<p>Daily case, hospitalization, and death proportions by borough through 2020-06-30.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>covid_new_york_city
</code></pre>


<h3>Format</h3>

<p>A data frame with 615 entries and 5 columns.
</p>

<dl>
<dt>date</dt><dd><p>record date</p>
</dd>
<dt>borough</dt><dd><p>record borough: Brooklyn, Bronx, Manhattan, Queens, and Staten Island</p>
</dd>
<dt>case</dt><dd><p>number of recorded cases</p>
</dd>
<dt>hospitalization</dt><dd><p>number of new hospital admissions</p>
</dd>
<dt>death</dt><dd><p>number of recorded deaths</p>
</dd>
</dl>



<h3>Source</h3>

<p>New York City Department of Health <a href="https://raw.githubusercontent.com/nychealth/coronavirus-data/master/boro/boroughs-case-hosp-death.csv">https://raw.githubusercontent.com/nychealth/coronavirus-data/master/boro/boroughs-case-hosp-death.csv</a>.
</p>

<hr>
<h2 id='data_check'>Input data check</h2><span id='topic+data_check'></span>

<h3>Description</h3>

<p>Check input data for: </p>

<ul>
<li><p> minimum length of reported
</p>
</li>
<li><p> integer for reported
</p>
</li>
<li><p> positivity for delay_dist and reported
</p>
</li>
<li><p> sums to 1 for delay_dist</p>
</li></ul>

<p>Throw an error if any conditions are violated.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data_check(reported, delay_dist)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="data_check_+3A_reported">reported</code></td>
<td>
<p>An integer vector of reported cases.</p>
</td></tr>
<tr><td><code id="data_check_+3A_delay_dist">delay_dist</code></td>
<td>
<p>A positive vector that sums to one, which describes the delay distribution.</p>
</td></tr>
</table>

<hr>
<h2 id='data_processing'>Data processing wrapper</h2><span id='topic+data_processing'></span>

<h3>Description</h3>

<p>Does basic checks for reported data and delay distribution, front pads, and makes AR extrapolation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data_processing(
  reported,
  delay_dist,
  num_ar_steps = 10,
  num_ar_samps = 100,
  seed = 1,
  linear_tail = 14,
  front_pad_size = 10,
  extrapolation_prior_precision = 2
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="data_processing_+3A_reported">reported</code></td>
<td>
<p>An integer vector of reported cases.</p>
</td></tr>
<tr><td><code id="data_processing_+3A_delay_dist">delay_dist</code></td>
<td>
<p>A positive vector that sums to one, which describes the delay distribution.</p>
</td></tr>
<tr><td><code id="data_processing_+3A_num_ar_steps">num_ar_steps</code></td>
<td>
<p>An integer number of AR steps after last observation.</p>
</td></tr>
<tr><td><code id="data_processing_+3A_num_ar_samps">num_ar_samps</code></td>
<td>
<p>An integer number of AR samples.</p>
</td></tr>
<tr><td><code id="data_processing_+3A_seed">seed</code></td>
<td>
<p>Seed for RNG.</p>
</td></tr>
<tr><td><code id="data_processing_+3A_linear_tail">linear_tail</code></td>
<td>
<p>An integer number of days used to fit linear model on tail to be used as a mean
for AR extrapolation.</p>
</td></tr>
<tr><td><code id="data_processing_+3A_front_pad_size">front_pad_size</code></td>
<td>
<p>An integer for initial number of 0's before first observation.</p>
</td></tr>
<tr><td><code id="data_processing_+3A_extrapolation_prior_precision">extrapolation_prior_precision</code></td>
<td>
<p>A positive scalar for extrapolation slope shrinkage prior precision.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with elements: </p>

<ul>
<li><p> extrap =  a matrix of size (num_ar_samps x n + num_ar_steps + front_pad_size)
</p>
</li>
<li><p> original = a vector of logicals for whether in original time series range</p>
</li></ul>


<hr>
<h2 id='diff_trans'>Transpose of the 1st difference operator</h2><span id='topic+diff_trans'></span>

<h3>Description</h3>

<p>This function computes a transpose of the 1st difference operator.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>diff_trans(a)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="diff_trans_+3A_a">a</code></td>
<td>
<p>A vector of inputs</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The transpose of the first difference operator
</p>

<hr>
<h2 id='fit_incidence'>Fit incidence curve to reported data</h2><span id='topic+fit_incidence'></span>

<h3>Description</h3>

<p>This is a function that fits an incidence curve to a set of reported cases and delay distribution
using an empirical Bayes estimation method, which fits parameters for a spline basis. All hyper 
parameter tuning and data processing are done within this function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fit_incidence(
  reported,
  delay_dist,
  dof_grid = seq(6, 20, 2),
  dof_method = "aic",
  lam_grid = 10^(seq(-1, -8, length.out = 20)),
  lam_method = "val",
  percent_thresh = 2,
  regularization_order = 2,
  num_ar_steps = 10,
  num_ar_samps = 100,
  linear_tail = 14,
  front_pad_size = 10,
  extrapolation_prior_precision = 10,
  frac_train = 0.75,
  fisher_approx_cov = TRUE,
  end_pad_size = 50,
  num_samps_per_ar = 10,
  val_restarts = 2,
  seed = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fit_incidence_+3A_reported">reported</code></td>
<td>
<p>An integer vector of reported cases.</p>
</td></tr>
<tr><td><code id="fit_incidence_+3A_delay_dist">delay_dist</code></td>
<td>
<p>A positive vector that sums to one, which describes the delay distribution.</p>
</td></tr>
<tr><td><code id="fit_incidence_+3A_dof_grid">dof_grid</code></td>
<td>
<p>An integer vector of degrees of freedom for the spline basis.</p>
</td></tr>
<tr><td><code id="fit_incidence_+3A_dof_method">dof_method</code></td>
<td>
<p>Metric to choose &quot;best&quot; spline degrees of freedom: 'aic': Akaike information 
criterion, 'bic': Bayesian information criterion, 'val': validation likelihood.</p>
</td></tr>
<tr><td><code id="fit_incidence_+3A_lam_grid">lam_grid</code></td>
<td>
<p>A vector of regularization strengths to scan.</p>
</td></tr>
<tr><td><code id="fit_incidence_+3A_lam_method">lam_method</code></td>
<td>
<p>metric to choose &quot;best&quot; regularization strength lambda: 'aic': Akaike information 
criterion, 'bic': Bayesian information criterion, 'val': validation likelihood.</p>
</td></tr>
<tr><td><code id="fit_incidence_+3A_percent_thresh">percent_thresh</code></td>
<td>
<p>If using validation likelihood to select best,
the largest (strongest) lambda that is within 'percent_thresh' of
the highest validation lambda will be selected. Default is 2. Must be greater than 0.</p>
</td></tr>
<tr><td><code id="fit_incidence_+3A_regularization_order">regularization_order</code></td>
<td>
<p>An integer (typically 0, 1, 2), indicating differencing order for L2 
regularization of spline parameters. Default is 2 for second derivative penalty.</p>
</td></tr>
<tr><td><code id="fit_incidence_+3A_num_ar_steps">num_ar_steps</code></td>
<td>
<p>An integer number of AR steps after last observation.</p>
</td></tr>
<tr><td><code id="fit_incidence_+3A_num_ar_samps">num_ar_samps</code></td>
<td>
<p>An integer number of AR samples.</p>
</td></tr>
<tr><td><code id="fit_incidence_+3A_linear_tail">linear_tail</code></td>
<td>
<p>An integer number of days used to fit linear model on tail to be used as a mean
for AR extrapolation.</p>
</td></tr>
<tr><td><code id="fit_incidence_+3A_front_pad_size">front_pad_size</code></td>
<td>
<p>An integer for initial number of 0's before first observation.</p>
</td></tr>
<tr><td><code id="fit_incidence_+3A_extrapolation_prior_precision">extrapolation_prior_precision</code></td>
<td>
<p>A positive scalar for extrapolation slope shrinkage prior precision.</p>
</td></tr>
<tr><td><code id="fit_incidence_+3A_frac_train">frac_train</code></td>
<td>
<p>A numeric between 0 and 1 for fraction of data used to train lambda validation.</p>
</td></tr>
<tr><td><code id="fit_incidence_+3A_fisher_approx_cov">fisher_approx_cov</code></td>
<td>
<p>A flag to use either the Fisher Information (TRUE) or the Hessian (FALSE) to approx posterior covariance over parameters.</p>
</td></tr>
<tr><td><code id="fit_incidence_+3A_end_pad_size">end_pad_size</code></td>
<td>
<p>And integer number of steps the spline is defined beyond the final 
observation.</p>
</td></tr>
<tr><td><code id="fit_incidence_+3A_num_samps_per_ar">num_samps_per_ar</code></td>
<td>
<p>An integer for the number of Laplace samples per AR fit.</p>
</td></tr>
<tr><td><code id="fit_incidence_+3A_val_restarts">val_restarts</code></td>
<td>
<p>An integer for the number of times to refit hyperparameters if 'val' is used for 
either. Set to 1 for faster but more unstable fits.</p>
</td></tr>
<tr><td><code id="fit_incidence_+3A_seed">seed</code></td>
<td>
<p>Seed for RNG.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the following entries: </p>

<ul>
<li><p> Isamps &ndash; sample of the incidence curve from a Laplace approximation per AR sample;
</p>
</li>
<li><p> Ihat &ndash; MAP incidence curve estimate;
</p>
</li>
<li><p> Chat &ndash; expected cases given MAP incidence curve estimate;
</p>
</li>
<li><p> beta_hats &ndash; matrix of beta's per AR sample;
</p>
</li>
<li><p> best_dof &ndash; best degrees of freedom from tuning;
</p>
</li>
<li><p> best_lambda &ndash; best regularization parameter from tuning; and
</p>
</li>
<li><p> reported &ndash; a copy of reported values used for fitting.</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
indiana_model &lt;- fit_incidence(
                  reported = spanish_flu$Indiana, 
                  delay_dist = spanish_flu_delay_dist$proportion) 
</code></pre>

<hr>
<h2 id='front_zero_pad'>Pad reported data with zeros in front</h2><span id='topic+front_zero_pad'></span>

<h3>Description</h3>

<p>Add zeros in front of reported data avoid infections from before first reported date all being placed on first reported date.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>front_zero_pad(reported, size)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="front_zero_pad_+3A_reported">reported</code></td>
<td>
<p>An integer vector of reported cases</p>
</td></tr>
<tr><td><code id="front_zero_pad_+3A_size">size</code></td>
<td>
<p>An integer size of zero-padding</p>
</td></tr>
</table>


<h3>Value</h3>

<p>An integer vector of cases with size 0's in front
</p>

<hr>
<h2 id='incidence_to_df'>Export incidence model to data frame</h2><span id='topic+incidence_to_df'></span>

<h3>Description</h3>

<p>Export the output of <code><a href="#topic+fit_incidence">fit_incidence</a></code> to a data frame with an optional
addition of a time index.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>incidence_to_df(x, times = NULL, low_quantile = 0.05, high_quantile = 0.95)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="incidence_to_df_+3A_x">x</code></td>
<td>
<p>An &quot;incidence_spline_model&quot; output from <code><a href="#topic+fit_incidence">fit_incidence</a></code>.</p>
</td></tr>
<tr><td><code id="incidence_to_df_+3A_times">times</code></td>
<td>
<p>An optional vector of time indices.</p>
</td></tr>
<tr><td><code id="incidence_to_df_+3A_low_quantile">low_quantile</code></td>
<td>
<p>A scalar that specifies the low quantile value for the output CI.</p>
</td></tr>
<tr><td><code id="incidence_to_df_+3A_high_quantile">high_quantile</code></td>
<td>
<p>A scalar that specifies the high quantile value for the output CI.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame with the following entries: </p>

<ul>
<li><p> Time &ndash; a time index; if 'ts' is 'NULL' it is the observation number;
</p>
</li>
<li><p> Reported &ndash; the value of 'reported';
</p>
</li>
<li><p> Ihat &ndash; MAP incidence curve estimate;
</p>
</li>
<li><p> Chat &ndash; expected cases given MAP incidence curve estimate;
</p>
</li>
<li><p> LowCI  &ndash; lower pointwise credible interval bands around the incidence curve; and
</p>
</li>
<li><p> HighCI  &ndash; higher pointwise credible interval bands around the incidence curve.</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>
indiana_model &lt;- fit_incidence(
                  reported = spanish_flu$Indiana, 
                  delay_dist = spanish_flu_delay_dist$proportion)
 indiana_df &lt;- incidence_to_df(indiana_model, times = spanish_flu$Date)

</code></pre>

<hr>
<h2 id='init_params'>Initialize spline parameters (beta)</h2><span id='topic+init_params'></span>

<h3>Description</h3>

<p>Initialize spline parameters (beta) using a standard Gaussian distribution.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>init_params(num_params)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="init_params_+3A_num_params">num_params</code></td>
<td>
<p>Integer size of desired parameter vector</p>
</td></tr>
</table>


<h3>Value</h3>

<p>vector of size num_params
</p>

<hr>
<h2 id='make_ar_extrap_samps'>Make AR samples for extrapolation past end point</h2><span id='topic+make_ar_extrap_samps'></span>

<h3>Description</h3>

<p>Make auto-regressive (AR) samples for extrapolation past end point to help with right-censoring problems.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make_ar_extrap_samps(
  reported,
  num_ar_steps = 10,
  num_ar_samps = 50,
  seed = 1,
  linear_tail = 14,
  extrapolation_prior_precision = 2
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="make_ar_extrap_samps_+3A_reported">reported</code></td>
<td>
<p>An integer vector of reported cases.</p>
</td></tr>
<tr><td><code id="make_ar_extrap_samps_+3A_num_ar_steps">num_ar_steps</code></td>
<td>
<p>An integer number of AR steps after last observation.</p>
</td></tr>
<tr><td><code id="make_ar_extrap_samps_+3A_num_ar_samps">num_ar_samps</code></td>
<td>
<p>An integer number of AR samples.</p>
</td></tr>
<tr><td><code id="make_ar_extrap_samps_+3A_seed">seed</code></td>
<td>
<p>Seed for RNG.</p>
</td></tr>
<tr><td><code id="make_ar_extrap_samps_+3A_linear_tail">linear_tail</code></td>
<td>
<p>An integer number of days used to fit linear model on tail to be used as a mean
for AR extrapolation.</p>
</td></tr>
<tr><td><code id="make_ar_extrap_samps_+3A_extrapolation_prior_precision">extrapolation_prior_precision</code></td>
<td>
<p>A positive scalar for extrapolation slope shrinkage prior precision.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix of size (num_ar_samps x n + num_ar_steps)
</p>

<hr>
<h2 id='make_likelihood_matrix'>Make delay likelihood matrix</h2><span id='topic+make_likelihood_matrix'></span>

<h3>Description</h3>

<p>This function creates a matrix such that P[t, s] = P(C = t | I = s) = theta_t-s for s &lt;= t and 0 otherwise.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make_likelihood_matrix(delay_dist)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="make_likelihood_matrix_+3A_delay_dist">delay_dist</code></td>
<td>
<p>A positive vector that sums to one, which describes the delay distribution.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix of size n x n
</p>

<hr>
<h2 id='make_spline_basis'>Create spline basis matrix</h2><span id='topic+make_spline_basis'></span>

<h3>Description</h3>

<p>This function creates basis matrix for spline model using cubic splines.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make_spline_basis(dof, tgrid)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="make_spline_basis_+3A_dof">dof</code></td>
<td>
<p>An integer degrees of freedom.</p>
</td></tr>
<tr><td><code id="make_spline_basis_+3A_tgrid">tgrid</code></td>
<td>
<p>A grid of time values.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix of cubic spline basis values with 'length(tgrid)' x 'dof' entries.
</p>

<hr>
<h2 id='marg_loglike_poisson'>Marginal log likelihood 
This function computes the marginal probability of Pr(reported | beta).  Note that
lnPmat must be zero padded enough (or censored) to match the length of 
reported cases vector.</h2><span id='topic+marg_loglike_poisson'></span>

<h3>Description</h3>

<p>Marginal log likelihood 
This function computes the marginal probability of Pr(reported | beta).  Note that
lnPmat must be zero padded enough (or censored) to match the length of 
reported cases vector.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>marg_loglike_poisson(beta, reported, Q, lnPmat)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="marg_loglike_poisson_+3A_beta">beta</code></td>
<td>
<p>spline parameter vector length num_params</p>
</td></tr>
<tr><td><code id="marg_loglike_poisson_+3A_reported">reported</code></td>
<td>
<p>An integer vector of reported cases.</p>
</td></tr>
<tr><td><code id="marg_loglike_poisson_+3A_q">Q</code></td>
<td>
<p>spline basis matrix Tmod x num_params</p>
</td></tr>
<tr><td><code id="marg_loglike_poisson_+3A_lnpmat">lnPmat</code></td>
<td>
<p>matrix size Tobs x Tobs, log of make_likelihood_matrix</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A scalar log likelihood value.
</p>

<hr>
<h2 id='marg_loglike_poisson_fisher'>Marginal log likelihood Fisher information matrix</h2><span id='topic+marg_loglike_poisson_fisher'></span>

<h3>Description</h3>

<p>This function computes the Fisher information matrix log likelihood term with
respect to beta.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>marg_loglike_poisson_fisher(beta, reported, Q, lnPmat)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="marg_loglike_poisson_fisher_+3A_beta">beta</code></td>
<td>
<p>A spline parameter vector length num_params.</p>
</td></tr>
<tr><td><code id="marg_loglike_poisson_fisher_+3A_reported">reported</code></td>
<td>
<p>An integer vector of reported cases.</p>
</td></tr>
<tr><td><code id="marg_loglike_poisson_fisher_+3A_q">Q</code></td>
<td>
<p>A spline basis matrix Tmod x num_params.</p>
</td></tr>
<tr><td><code id="marg_loglike_poisson_fisher_+3A_lnpmat">lnPmat</code></td>
<td>
<p>A matrix size Tobs x Tobs, log of make_likelihood_matrix.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector, gradient of log likelihood value with respect to beta.
</p>

<hr>
<h2 id='marg_loglike_poisson_grad'>Marginal log likelihood gradient</h2><span id='topic+marg_loglike_poisson_grad'></span>

<h3>Description</h3>

<p>This function computes the gradient of the log likelihood term with respect to beta.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>marg_loglike_poisson_grad(beta, reported, Q, lnPmat)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="marg_loglike_poisson_grad_+3A_beta">beta</code></td>
<td>
<p>spline parameter vector length num_params</p>
</td></tr>
<tr><td><code id="marg_loglike_poisson_grad_+3A_reported">reported</code></td>
<td>
<p>An integer vector of reported cases.</p>
</td></tr>
<tr><td><code id="marg_loglike_poisson_grad_+3A_q">Q</code></td>
<td>
<p>spline basis matrix Tmod x num_params</p>
</td></tr>
<tr><td><code id="marg_loglike_poisson_grad_+3A_lnpmat">lnPmat</code></td>
<td>
<p>matrix size Tobs x Tobs, log of make_likelihood_matrix</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector, gradient of log likelihood value with respect to beta.
</p>

<hr>
<h2 id='plot.incidence_spline_model'>Plot model from fit_incidence</h2><span id='topic+plot.incidence_spline_model'></span>

<h3>Description</h3>

<p>Plot time, reported cases, incidence curve with credible interval, and implied case curve.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'incidence_spline_model'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.incidence_spline_model_+3A_x">x</code></td>
<td>
<p>An &quot;incidence_spline_model&quot; output from <code><a href="#topic+fit_incidence">fit_incidence</a></code>.</p>
</td></tr>
<tr><td><code id="plot.incidence_spline_model_+3A_...">...</code></td>
<td>
<p>Other parameters that can be included: </p>

<ul>
<li><p> 'times': an optional vector of time indices.
</p>
</li>
<li><p> 'plot_Chat': a logical for whether Chat should be plotted. 
</p>
</li>
<li><p> 'plot_reported': a logical for whether reported cases should be plotted.
</p>
</li>
<li><p> 'plot_CI': a logical for whether CI should be plotted.
</p>
</li></ul>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>
indiana_model &lt;- fit_incidence(
                  reported = spanish_flu$Indiana, 
                  delay_dist = spanish_flu_delay_dist$proportion)
 plot(indiana_model, times = spanish_flu$Date)

</code></pre>

<hr>
<h2 id='poisson_objective'>Poisson objective function</h2><span id='topic+poisson_objective'></span>

<h3>Description</h3>

<p>This function computes Poisson objective function including regularizer.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>poisson_objective(beta, lam, reported, Q, lnPmat, regularization_order)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="poisson_objective_+3A_beta">beta</code></td>
<td>
<p>spline parameter vector length num_params</p>
</td></tr>
<tr><td><code id="poisson_objective_+3A_lam">lam</code></td>
<td>
<p>positive scalar regularization strength</p>
</td></tr>
<tr><td><code id="poisson_objective_+3A_reported">reported</code></td>
<td>
<p>An integer vector of reported cases.</p>
</td></tr>
<tr><td><code id="poisson_objective_+3A_q">Q</code></td>
<td>
<p>spline basis matrix Tmod x num_params</p>
</td></tr>
<tr><td><code id="poisson_objective_+3A_lnpmat">lnPmat</code></td>
<td>
<p>matrix size Tobs x Tobs, log of make_likelihood_matrix</p>
</td></tr>
<tr><td><code id="poisson_objective_+3A_regularization_order">regularization_order</code></td>
<td>
<p>An integer (typically 0, 1, 2), indicating differencing order for L2 
regularization of spline parameters. Default is 2 for second derivative penalty.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>scalar objective function value
</p>

<hr>
<h2 id='poisson_objective_grad'>Poisson objective function gradient</h2><span id='topic+poisson_objective_grad'></span>

<h3>Description</h3>

<p>This function computes the Poisson objective function (including regularizer) gradient.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>poisson_objective_grad(beta, lam, reported, Q, lnPmat, regularization_order)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="poisson_objective_grad_+3A_beta">beta</code></td>
<td>
<p>spline parameter vector length num_params</p>
</td></tr>
<tr><td><code id="poisson_objective_grad_+3A_lam">lam</code></td>
<td>
<p>positive scalar regularization strength</p>
</td></tr>
<tr><td><code id="poisson_objective_grad_+3A_reported">reported</code></td>
<td>
<p>An integer vector of reported cases.</p>
</td></tr>
<tr><td><code id="poisson_objective_grad_+3A_q">Q</code></td>
<td>
<p>spline basis matrix Tmod x num_params</p>
</td></tr>
<tr><td><code id="poisson_objective_grad_+3A_lnpmat">lnPmat</code></td>
<td>
<p>matrix size Tobs x Tobs, log of make_likelihood_matrix</p>
</td></tr>
<tr><td><code id="poisson_objective_grad_+3A_regularization_order">regularization_order</code></td>
<td>
<p>An integer (typically 0, 1, 2), indicating differencing order for L2 
regularization of spline parameters. Default is 2 for second derivative penalty.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>scalar objective function value
</p>

<hr>
<h2 id='poisson_objective_post_cov_approx'>Compute Fisher information matrix for Poisson objective</h2><span id='topic+poisson_objective_post_cov_approx'></span>

<h3>Description</h3>

<p>This function computes the Fisher information matrix for a regularized Poisson objective function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>poisson_objective_post_cov_approx(
  beta,
  lam,
  reported,
  Q,
  lnPmat,
  regularization_order
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="poisson_objective_post_cov_approx_+3A_beta">beta</code></td>
<td>
<p>A vector of spline parameters.</p>
</td></tr>
<tr><td><code id="poisson_objective_post_cov_approx_+3A_lam">lam</code></td>
<td>
<p>A regularization penalty parameter.</p>
</td></tr>
<tr><td><code id="poisson_objective_post_cov_approx_+3A_reported">reported</code></td>
<td>
<p>A vector of reported values.</p>
</td></tr>
<tr><td><code id="poisson_objective_post_cov_approx_+3A_q">Q</code></td>
<td>
<p>A spline basis matrix.</p>
</td></tr>
<tr><td><code id="poisson_objective_post_cov_approx_+3A_lnpmat">lnPmat</code></td>
<td>
<p>A matrix size Tobs x Tobs, log of make_likelihood_matrix.</p>
</td></tr>
<tr><td><code id="poisson_objective_post_cov_approx_+3A_regularization_order">regularization_order</code></td>
<td>
<p>An integer that specifies the regularization order.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Fisher information matrix of a regularized Poisson objective function.
</p>

<hr>
<h2 id='regfun'>Beta regularization function</h2><span id='topic+regfun'></span>

<h3>Description</h3>

<p>This function computes regularization penalty term based on the betas and a difference.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>regfun(beta, regularization_order = 2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="regfun_+3A_beta">beta</code></td>
<td>
<p>A spline parameter vector length num_params.</p>
</td></tr>
<tr><td><code id="regfun_+3A_regularization_order">regularization_order</code></td>
<td>
<p>An integer (typically 0, 1, 2), indicating differencing order for L2 
regularization of spline parameters. Default is 2 for second derivative penalty.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A scalar regularization value.
</p>

<hr>
<h2 id='regfun_grad'>Beta regularization function gradient</h2><span id='topic+regfun_grad'></span>

<h3>Description</h3>

<p>This function computes regularization penalty term gradient based on the betas and difference order.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>regfun_grad(beta, regularization_order = 2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="regfun_grad_+3A_beta">beta</code></td>
<td>
<p>spline parameter vector length num_params</p>
</td></tr>
<tr><td><code id="regfun_grad_+3A_regularization_order">regularization_order</code></td>
<td>
<p>An integer (typically 0, 1, 2), indicating differencing order for L2 
regularization of spline parameters. Default is 2 for second derivative penalty.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>scalar regularization value
</p>

<hr>
<h2 id='regfun_hess'>Beta regularization function Hessian</h2><span id='topic+regfun_hess'></span>

<h3>Description</h3>

<p>This function computes regularization penalty term Hessian based on the betas and differencing order.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>regfun_hess(beta, regularization_order = 2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="regfun_hess_+3A_beta">beta</code></td>
<td>
<p>spline parameter vector length num_params</p>
</td></tr>
<tr><td><code id="regfun_hess_+3A_regularization_order">regularization_order</code></td>
<td>
<p>An integer (typically 0, 1, 2), indicating differencing order for L2 
regularization of spline parameters. Default is 2 for second derivative penalty.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>scalar regularization value
</p>

<hr>
<h2 id='sample_laplace_log_incidence_poisson'>Generate Laplace samples of incidence</h2><span id='topic+sample_laplace_log_incidence_poisson'></span>

<h3>Description</h3>

<p>This function generates Laplace samples of posterior distribution for a vector of reported incidence.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sample_laplace_log_incidence_poisson(
  beta_hat,
  beta_cov,
  reported,
  Q,
  num_samps_per_ar = 10
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sample_laplace_log_incidence_poisson_+3A_beta_hat">beta_hat</code></td>
<td>
<p>Maximum likelihood solution for beta parameter.</p>
</td></tr>
<tr><td><code id="sample_laplace_log_incidence_poisson_+3A_beta_cov">beta_cov</code></td>
<td>
<p>Covariance of objective solution (either Fisher information or Hessian inverse).</p>
</td></tr>
<tr><td><code id="sample_laplace_log_incidence_poisson_+3A_reported">reported</code></td>
<td>
<p>An integer vector of reported cases.</p>
</td></tr>
<tr><td><code id="sample_laplace_log_incidence_poisson_+3A_q">Q</code></td>
<td>
<p>Spline basis matrix.</p>
</td></tr>
<tr><td><code id="sample_laplace_log_incidence_poisson_+3A_num_samps_per_ar">num_samps_per_ar</code></td>
<td>
<p>Number of Laplace samples to return for each AR path.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix of 'num_samps_per_ar' log incidence curve samples from laplace approximation of distribution.
</p>

<hr>
<h2 id='scan_spline_dof'>Scan spline degrees of freedom</h2><span id='topic+scan_spline_dof'></span>

<h3>Description</h3>

<p>This function holds the regularization parameter value fixed and scans spline degrees of freedom.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>scan_spline_dof(
  reported,
  delay_dist,
  dof_grid,
  method = "bic",
  lam = 0,
  regularization_order = 2,
  reported_val = NULL,
  end_pad_size = 0,
  fisher_approx_cov = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="scan_spline_dof_+3A_reported">reported</code></td>
<td>
<p>An integer vector of reported cases.</p>
</td></tr>
<tr><td><code id="scan_spline_dof_+3A_delay_dist">delay_dist</code></td>
<td>
<p>A positive vector that sums to one, which describes the delay distribution.</p>
</td></tr>
<tr><td><code id="scan_spline_dof_+3A_dof_grid">dof_grid</code></td>
<td>
<p>An integer vector of degrees of freedom for the spline basis.</p>
</td></tr>
<tr><td><code id="scan_spline_dof_+3A_method">method</code></td>
<td>
<p>Metric to choose &quot;best&quot; dof: 'aic', 'bic', 'val'.
If method='val', reported_val must be non NULL and match reported size.</p>
</td></tr>
<tr><td><code id="scan_spline_dof_+3A_lam">lam</code></td>
<td>
<p>A fixed value for the beta parameter regularization strength.</p>
</td></tr>
<tr><td><code id="scan_spline_dof_+3A_regularization_order">regularization_order</code></td>
<td>
<p>An integer (typically 0, 1, 2), indicating differencing order for L2 
regularization of spline parameters. Default is 2 for second derivative penalty.</p>
</td></tr>
<tr><td><code id="scan_spline_dof_+3A_reported_val">reported_val</code></td>
<td>
<p>Validation time series of equal size
to reported vector for use with 'val' method. Default is NULL.</p>
</td></tr>
<tr><td><code id="scan_spline_dof_+3A_end_pad_size">end_pad_size</code></td>
<td>
<p>And integer number of steps the spline is defined beyond the final 
observation.</p>
</td></tr>
<tr><td><code id="scan_spline_dof_+3A_fisher_approx_cov">fisher_approx_cov</code></td>
<td>
<p>A flag to use either the Fisher Information (TRUE) or the Hessian (FALSE) to approx posterior covariance over parameters.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of degree of freedom fit statistics: </p>

<ul>
<li><p> best_dof =  best degrees of freedom
</p>
</li>
<li><p> dof_resdf = data frame of fit statistics (lambda, dof, aic, bic, val_lls, train_lls)</p>
</li></ul>


<hr>
<h2 id='scan_spline_lam'>Scan spline regularization parameter</h2><span id='topic+scan_spline_lam'></span>

<h3>Description</h3>

<p>This function holds degrees of freedom fixed and scans regularization parameter values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>scan_spline_lam(
  reported,
  delay_dist,
  lam_grid,
  method = "val",
  percent_thresh = 2,
  dof = 10,
  regularization_order = 2,
  reported_val = NULL,
  end_pad_size = 0,
  fisher_approx_cov = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="scan_spline_lam_+3A_reported">reported</code></td>
<td>
<p>An integer vector of reported cases.</p>
</td></tr>
<tr><td><code id="scan_spline_lam_+3A_delay_dist">delay_dist</code></td>
<td>
<p>A positive vector that sums to one, which describes the delay distribution.</p>
</td></tr>
<tr><td><code id="scan_spline_lam_+3A_lam_grid">lam_grid</code></td>
<td>
<p>A vector of regularization strengths to scan.</p>
</td></tr>
<tr><td><code id="scan_spline_lam_+3A_method">method</code></td>
<td>
<p>Metric to choose &quot;best&quot; dof: 'aic', 'bic', 'val'.
If method='val', reported_val must be non NULL and match reported size.</p>
</td></tr>
<tr><td><code id="scan_spline_lam_+3A_percent_thresh">percent_thresh</code></td>
<td>
<p>If using validation likelihood to select best,
the largest (strongest) lambda that is within 'percent_thresh' of
the highest validation lambda will be selected. Default is 2. Must be greater than 0.</p>
</td></tr>
<tr><td><code id="scan_spline_lam_+3A_dof">dof</code></td>
<td>
<p>Degrees of freedom for spline basis.</p>
</td></tr>
<tr><td><code id="scan_spline_lam_+3A_regularization_order">regularization_order</code></td>
<td>
<p>An integer (typically 0, 1, 2), indicating differencing order for L2 
regularization of spline parameters. Default is 2 for second derivative penalty.</p>
</td></tr>
<tr><td><code id="scan_spline_lam_+3A_reported_val">reported_val</code></td>
<td>
<p>Validation time series of equal size
to reported vector for use with 'val' method. Default is NULL.</p>
</td></tr>
<tr><td><code id="scan_spline_lam_+3A_end_pad_size">end_pad_size</code></td>
<td>
<p>And integer number of steps the spline is defined beyond the final 
observation.</p>
</td></tr>
<tr><td><code id="scan_spline_lam_+3A_fisher_approx_cov">fisher_approx_cov</code></td>
<td>
<p>A flag to use either the Fisher Information (TRUE) or the Hessian (FALSE) to approx posterior covariance over parameters.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>List of outputs:</p>

<ul>
<li><p> best_lam = best lambda
</p>
</li>
<li><p> lam_resdf = data frame of fit statistics (lambda, dof, aic, bic, val_lls, train_lls)</p>
</li></ul>


<hr>
<h2 id='spanish_flu'>Daily flu mortality from 1918 flu pandemic.</h2><span id='topic+spanish_flu'></span>

<h3>Description</h3>

<p>Daily mortality data from 1918-09-01 through 1918-12-31 in Indiana, Kansas, and Philadelphia
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spanish_flu
</code></pre>


<h3>Format</h3>

<p>A data frame with 122 entries for 3 locations
</p>

<dl>
<dt>Date</dt><dd><p>date</p>
</dd>
<dt>Indiana</dt><dd><p>daily deaths for all of Indiana</p>
</dd>
<dt>Kansas</dt><dd><p>daily deaths for all of Kansas</p>
</dd>
<dt>Philadelphia</dt><dd><p>daily deaths for Philadelphia</p>
</dd>
</dl>



<h3>Source</h3>

<p>Rogers SL (1920). Special Tables of Mortality from Influenza and Pneumonia, in Indiana, Kansas, and Philadelphia, PA (U.S. Dept Commerce, Washington, DC).
</p>

<hr>
<h2 id='spanish_flu_delay_dist'>Delay distribution from 1918 flu pandemic.</h2><span id='topic+spanish_flu_delay_dist'></span>

<h3>Description</h3>

<p>Daily death proportions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spanish_flu_delay_dist
</code></pre>


<h3>Format</h3>

<p>A data frame with 31 entries and 3 columns.
</p>

<dl>
<dt>days</dt><dd><p>number of days since infection</p>
</dd>
<dt>proportion</dt><dd><p>proportion of deaths that happen on that day</p>
</dd>
</dl>



<h3>Source</h3>

<p>Goldstein E, et al. (2009). Reconstructing influenza incidence by deconvolution of daily mortality time series (PNAS). <a href="https://www.pnas.org/content/pnas/106/51/21825.full.pdf">https://www.pnas.org/content/pnas/106/51/21825.full.pdf</a>
</p>

<hr>
<h2 id='train_and_validate'>Train and validate model on reported data</h2><span id='topic+train_and_validate'></span>

<h3>Description</h3>

<p>This function fit models with selected hyperparameters on reported data and return a matrix of posterior Laplace samples.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>train_and_validate(
  reported,
  delay_dist,
  lam,
  dof,
  beta0 = NULL,
  regularization_order = 2,
  reported_val = NULL,
  end_pad_size = 0,
  fisher_approx_cov = TRUE,
  num_samps_per_ar = 10
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="train_and_validate_+3A_reported">reported</code></td>
<td>
<p>An integer vector of reported cases.</p>
</td></tr>
<tr><td><code id="train_and_validate_+3A_delay_dist">delay_dist</code></td>
<td>
<p>A positive vector that sums to one, which describes the delay distribution.</p>
</td></tr>
<tr><td><code id="train_and_validate_+3A_lam">lam</code></td>
<td>
<p>A fixed value for the beta parameter regularization strength.</p>
</td></tr>
<tr><td><code id="train_and_validate_+3A_dof">dof</code></td>
<td>
<p>Degrees of freedom for spline basis.</p>
</td></tr>
<tr><td><code id="train_and_validate_+3A_beta0">beta0</code></td>
<td>
<p>(optional) Initial setting of spline parameters (before optimization)</p>
</td></tr>
<tr><td><code id="train_and_validate_+3A_regularization_order">regularization_order</code></td>
<td>
<p>An integer (typically 0, 1, 2), indicating differencing order for L2 
regularization of spline parameters. Default is 2 for second derivative penalty.</p>
</td></tr>
<tr><td><code id="train_and_validate_+3A_reported_val">reported_val</code></td>
<td>
<p>Validation time series of equal size
to reported vector for use with 'val' method. Default is NULL.</p>
</td></tr>
<tr><td><code id="train_and_validate_+3A_end_pad_size">end_pad_size</code></td>
<td>
<p>And integer number of steps the spline is defined beyond the final 
observation.</p>
</td></tr>
<tr><td><code id="train_and_validate_+3A_fisher_approx_cov">fisher_approx_cov</code></td>
<td>
<p>A flag to use either the Fisher Information (TRUE) or the Hessian (FALSE) to approx posterior covariance over parameters.</p>
</td></tr>
<tr><td><code id="train_and_validate_+3A_num_samps_per_ar">num_samps_per_ar</code></td>
<td>
<p>An integer for the number of Laplace samples per AR fit.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of results of train and validate, including: </p>
 
<ul>
<li><p> train_ll = training log likelihood
</p>
</li>
<li><p> val_ll = validation log likelihood (if 'reported_val' is not 'NULL')
</p>
</li>
<li><p> Isamps = samples of the incidence curve from a Laplace approximation
</p>
</li>
<li><p> Ihat = MAP estimate of the incidence curve
</p>
</li>
<li><p> Chat = expected cases given MAP incidence curve
</p>
</li>
<li><p> beta_hat = MAP estimate of spline parameters
</p>
</li>
<li><p> beta_cov = covariance of spline parameters
</p>
</li>
<li><p> beta_hess = Hessian of spline parameters</p>
</li></ul>


<hr>
<h2 id='train_val_split'>Split reported case data</h2><span id='topic+train_val_split'></span>

<h3>Description</h3>

<p>Split reported case integer time series into train and validate time series through thinning.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>train_val_split(reported, frac_train = 0.75)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="train_val_split_+3A_reported">reported</code></td>
<td>
<p>An integer vector of reported cases.</p>
</td></tr>
<tr><td><code id="train_val_split_+3A_frac_train">frac_train</code></td>
<td>
<p>A numeric between 0 and 1 for fraction of data used to train lambda validation.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list(reported_train, reported_val) where the elements reported_train
and reported_val are both length, Tobs, and 'frac_train' of
the counts fall in reported_train, the rest in reported_val.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
