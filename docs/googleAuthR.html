<!DOCTYPE html><html lang="en"><head><title>Help for package googleAuthR</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {googleAuthR}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#googleAuthR'><p>googleAuthR: Easy Authentication with Google OAuth2 APIs</p></a></li>
<li><a href='#checkGoogleAPIError'><p>Get Google API errors</p></a></li>
<li><a href='#checkTokenAPI'><p>Check API data token</p></a></li>
<li><a href='#doHttrRequest'><p>Get URL content based on if its Shiny or local</p></a></li>
<li><a href='#gar_api_generator'><p>googleAuthR data fetch function generator</p></a></li>
<li><a href='#gar_api_page'><p>Takes a generated API function and lets you page through results</p></a></li>
<li><a href='#gar_attach_auto_auth'><p>Auto Authentication function for use within .onAttach</p></a></li>
<li><a href='#gar_auth'><p>Authorize <code>googleAuthR</code></p></a></li>
<li><a href='#gar_auth_configure'><p>Edit and view auth configuration</p></a></li>
<li><a href='#gar_auth_service'><p>JSON service account authentication</p></a></li>
<li><a href='#gar_auto_auth'><p>Perform auto authentication</p></a></li>
<li><a href='#gar_batch'><p>Turn a list of gar_fetch_functions into batch functions</p></a></li>
<li><a href='#gar_batch_walk'><p>Walk data through batches</p></a></li>
<li><a href='#gar_cache_get_loc'><p>Setup where to put cache</p></a></li>
<li><a href='#gar_check_existing_token'><p>Check a token vs options</p></a></li>
<li><a href='#gar_create_api_objects'><p>Create the API objects from the Discovery API</p></a></li>
<li><a href='#gar_create_api_skeleton'><p>Create an API library skeleton</p></a></li>
<li><a href='#gar_create_package'><p>Create a Google API package</p></a></li>
<li><a href='#gar_deauth'><p>Suspend authorization</p></a></li>
<li><a href='#gar_debug_parsing'><p>Read the diagnostic object returned on API parse errors.</p></a></li>
<li><a href='#gar_discovery_api'><p>Get meta data details for specified Google API</p></a></li>
<li><a href='#gar_discovery_apis_list'><p>Get a list of Google API libraries</p></a></li>
<li><a href='#gar_gce_auth'><p>Authenticate on Google Compute Engine</p></a></li>
<li><a href='#gar_gce_auth_default'><p>Authenticate via gcloud's application-default login</p></a></li>
<li><a href='#gar_gce_auth_email'><p>Get the service email via GCE metadata</p></a></li>
<li><a href='#gar_has_token'><p>Is there a token on hand?</p></a></li>
<li><a href='#gar_scope_config'><p>Create or add scopes to configuration</p></a></li>
<li><a href='#gar_service_create'><p>Work with service accounts via the API</p></a></li>
<li><a href='#gar_service_provision'><p>Provision a service account</p></a></li>
<li><a href='#gar_set_client'><p>Setup the clientId, clientSecret and scopes</p></a></li>
<li><a href='#gar_setup_auth_check'><p>Check service key works via environment argument</p></a></li>
<li><a href='#gar_setup_auth_key'><p>Create a service account for googleCloudRunner</p></a></li>
<li><a href='#gar_setup_clientid'><p>Check for a client JSON</p></a></li>
<li><a href='#gar_setup_edit_renviron'><p>Setup wizard help - asking users to edit .Renviron</p></a></li>
<li><a href='#gar_setup_env_check'><p>Setup wizard help - check if environment argument is set</p></a></li>
<li><a href='#gar_setup_get_authenv'><p>Setup wizard helper - add authentication file to .Renviron</p></a></li>
<li><a href='#gar_setup_menu'><p>Setup wizard - introduction helper</p></a></li>
<li><a href='#gar_setup_menu_do'><p>Setup wizard help - the functions that will execute on different menu options</p></a></li>
<li><a href='#gar_shiny_auth'><p>Create Authentication within Shiny's server.R</p></a></li>
<li><a href='#gar_shiny_auth_url'><p>Make a Google Authorisation URL for Shiny</p></a></li>
<li><a href='#gar_shiny_login_ui'><p>A login page for Shiny</p></a></li>
<li><a href='#gar_shiny_ui'><p>Create a Google login before your Shiny UI launches</p></a></li>
<li><a href='#gar_token'><p>Produce configured token</p></a></li>
<li><a href='#gar_token_info'><p>Get current token summary</p></a></li>
<li><a href='#get_google_token'><p>Retrieve Google token from environment and configs for httr</p></a></li>
<li><a href='#googleSignIn'><p>Google SignIn [Server Module]</p></a></li>
<li><a href='#googleSignInUI'><p>Google SignIn [UI Module]</p></a></li>
<li><a href='#retryRequest'><p>ReTry API requests for certain errors using exponential backoff.</p></a></li>
<li><a href='#should_skip_token_checks'><p>Determines whether token presence and validity checks should be skipped.</p></a></li>
<li><a href='#silent_auth'><p>Silent auth</p></a></li>
<li><a href='#skip_if_no_env_auth'><p>Skip test if not authenticated</p></a></li>
<li><a href='#token_exists'><p>Check if authorization currently in force</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Version:</td>
<td>2.0.2</td>
</tr>
<tr>
<td>Title:</td>
<td>Authenticate and Create Google APIs</td>
</tr>
<tr>
<td>Description:</td>
<td>Create R functions that interact with OAuth2 Google APIs 
    <a href="https://developers.google.com/apis-explorer/">https://developers.google.com/apis-explorer/</a> easily,
    with auto-refresh and Shiny compatibility.</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://code.markedmondson.me/googleAuthR/">https://code.markedmondson.me/googleAuthR/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/MarkEdmondson1234/googleAuthR/issues">https://github.com/MarkEdmondson1234/googleAuthR/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.3.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>assertthat (&ge; 0.2.0), cli (&ge; 2.0.2), digest, gargle (&ge;
1.2.0), httr (&ge; 1.4.0), jsonlite (&ge; 1.6), memoise (&ge; 1.1.0),
rlang, utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>covr, devtools (&ge; 1.12.0), formatR (&ge; 1.4),
googleAnalyticsR, knitr, miniUI (&ge; 0.1.1), rmarkdown, roxygen2
(&ge; 5.0.0), rstudioapi, shiny (&ge; 0.13.2), testthat, usethis
(&ge; 1.6.0)</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.1</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-05-22 15:28:45 UTC; groner</td>
</tr>
<tr>
<td>Author:</td>
<td>Mark Edmondson <a href="https://orcid.org/0000-0002-8434-3881"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Erik Grönroos [cre],
  Jennifer Bryan [ctb],
  Johann deBoer [ctb],
  Neal Richardson [ctb],
  David Kulp [ctb],
  Joe Cheng [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Erik Grönroos &lt;erik.gronroos@8-bit-sheep.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-05-22 21:20:17 UTC</td>
</tr>
</table>
<hr>
<h2 id='googleAuthR'>googleAuthR: Easy Authentication with Google OAuth2 APIs</h2><span id='topic+googleAuthR'></span><span id='topic+googleAuthR-package'></span>

<h3>Description</h3>

<p>Get more details on the <a href="https://code.markedmondson.me/googleAuthR/">googleAuthR website</a>.
</p>


<h3>Default options</h3>

<p>These are the default options that you can override via <code>options()</code>
</p>

<ul>
<li> <p><code>googleAuthR.batch_endpoint = "https://www.googleapis.com/batch"</code>
</p>
</li>
<li> <p><code>googleAuthR.rawResponse = FALSE</code>
</p>
</li>
<li> <p><code>googleAuthR.httr_oauth_cache = ".httr-oauth"</code>
</p>
</li>
<li> <p><code>googleAuthR.verbose = 3</code>
</p>
</li>
<li> <p><code>googleAuthR.client_id = NULL</code>
</p>
</li>
<li> <p><code>googleAuthR.client_secret = NULL</code>
</p>
</li>
<li> <p><code>googleAuthR.webapp.client_id = NULL</code>
</p>
</li>
<li> <p><code>googleAuthR.webapp.client_secret = NULL</code>
</p>
</li>
<li> <p><code>googleAuthR.webapp.port = 1221</code>
</p>
</li>
<li> <p><code>googleAuthR.jsonlite.simplifyVector = TRUE</code>
</p>
</li>
<li> <p><code>googleAuthR.scopes.selected = NULL</code>
</p>
</li>
<li> <p><code>googleAuthR.skip_token_checks = FALSE</code>
</p>
</li>
<li> <p><code>googleAuthR.ok_content_types=c("application/json; charset=UTF-8", ("text/html; charset=UTF-8"))</code>
</p>
</li>
<li> <p><code>googleAuthR.securitycode = paste0(sample(c(1:9, LETTERS, letters), 20, replace = T), collapse='')</code>
</p>
</li>
<li> <p><code>googleAuthR.tryAttempts = 5</code>
</p>
</li></ul>



<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Erik Grönroos <a href="mailto:erik.gronroos@8-bit-sheep.com">erik.gronroos@8-bit-sheep.com</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> Mark Edmondson <a href="mailto:m@sunholo.com">m@sunholo.com</a> (<a href="https://orcid.org/0000-0002-8434-3881">ORCID</a>)
</p>
</li></ul>

<p>Other contributors:
</p>

<ul>
<li><p> Jennifer Bryan <a href="mailto:jenny@stat.ubc.ca">jenny@stat.ubc.ca</a> [contributor]
</p>
</li>
<li><p> Johann deBoer <a href="mailto:johanndeboer@gmail.com">johanndeboer@gmail.com</a> [contributor]
</p>
</li>
<li><p> Neal Richardson <a href="mailto:neal.p.richardson@gmail.com">neal.p.richardson@gmail.com</a> [contributor]
</p>
</li>
<li><p> David Kulp <a href="mailto:dkulp@cs.umass.edu">dkulp@cs.umass.edu</a> [contributor]
</p>
</li>
<li><p> Joe Cheng <a href="mailto:joe@rstudio.com">joe@rstudio.com</a> [contributor]
</p>
</li></ul>



<h3>See Also</h3>

<p>Useful links:
</p>

<ul>
<li> <p><a href="https://code.markedmondson.me/googleAuthR/">https://code.markedmondson.me/googleAuthR/</a>
</p>
</li>
<li><p> Report bugs at <a href="https://github.com/MarkEdmondson1234/googleAuthR/issues">https://github.com/MarkEdmondson1234/googleAuthR/issues</a>
</p>
</li></ul>


<hr>
<h2 id='checkGoogleAPIError'>Get Google API errors</h2><span id='topic+checkGoogleAPIError'></span>

<h3>Description</h3>

<p>Get Google API errors
</p>


<h3>Usage</h3>

<pre><code class='language-R'>checkGoogleAPIError(req)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="checkGoogleAPIError_+3A_req">req</code></td>
<td>
<p>a httr request</p>
</td></tr>
</table>

<hr>
<h2 id='checkTokenAPI'>Check API data token</h2><span id='topic+checkTokenAPI'></span>

<h3>Description</h3>

<p>Check API data token
</p>


<h3>Usage</h3>

<pre><code class='language-R'>checkTokenAPI()
</code></pre>


<h3>Value</h3>

<p>boolean if it works.
</p>

<hr>
<h2 id='doHttrRequest'>Get URL content based on if its Shiny or local</h2><span id='topic+doHttrRequest'></span>

<h3>Description</h3>

<p>This changes the auth type depending on if its local or on Shiny
</p>


<h3>Usage</h3>

<pre><code class='language-R'>doHttrRequest(
  url,
  request_type = "GET",
  the_body = NULL,
  customConfig = NULL,
  simplifyVector = getOption("googleAuthR.jsonlite.simplifyVector")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="doHttrRequest_+3A_url">url</code></td>
<td>
<p>the url of the page to retrieve</p>
</td></tr>
<tr><td><code id="doHttrRequest_+3A_request_type">request_type</code></td>
<td>
<p>the type of httr request function: GET, POST, PUT, DELETE etc.</p>
</td></tr>
<tr><td><code id="doHttrRequest_+3A_the_body">the_body</code></td>
<td>
<p>body of POST request</p>
</td></tr>
<tr><td><code id="doHttrRequest_+3A_customconfig">customConfig</code></td>
<td>
<p>list of httr options such as <code>httr::use_proxy</code>
or <code>httr::add_headers</code> that will be added to the request.</p>
</td></tr>
<tr><td><code id="doHttrRequest_+3A_simplifyvector">simplifyVector</code></td>
<td>
<p>Passed to jsonlite::fromJSON</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Example of params: c(param1=&quot;foo&quot;, param2=&quot;bar&quot;)
</p>

<hr>
<h2 id='gar_api_generator'>googleAuthR data fetch function generator</h2><span id='topic+gar_api_generator'></span>

<h3>Description</h3>

<p>This function generates other functions for use with Google APIs
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_api_generator(
  baseURI,
  http_header = c("GET", "POST", "PUT", "DELETE", "PATCH"),
  path_args = NULL,
  pars_args = NULL,
  data_parse_function = NULL,
  customConfig = NULL,
  simplifyVector = getOption("googleAuthR.jsonlite.simplifyVector"),
  checkTrailingSlash = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_api_generator_+3A_baseuri">baseURI</code></td>
<td>
<p>The stem of the API call.</p>
</td></tr>
<tr><td><code id="gar_api_generator_+3A_http_header">http_header</code></td>
<td>
<p>Type of http request.</p>
</td></tr>
<tr><td><code id="gar_api_generator_+3A_path_args">path_args</code></td>
<td>
<p>A named list with name=folder in request URI, value=the function variable.</p>
</td></tr>
<tr><td><code id="gar_api_generator_+3A_pars_args">pars_args</code></td>
<td>
<p>A named list with name=parameter in request URI, value=the function variable.</p>
</td></tr>
<tr><td><code id="gar_api_generator_+3A_data_parse_function">data_parse_function</code></td>
<td>
<p>A function that takes a request response, parses it and returns the data you need.</p>
</td></tr>
<tr><td><code id="gar_api_generator_+3A_customconfig">customConfig</code></td>
<td>
<p>list of httr options such as <a href="httr.html#topic+use_proxy">use_proxy</a>
or <a href="httr.html#topic+add_headers">add_headers</a> that will be added to the request.</p>
</td></tr>
<tr><td><code id="gar_api_generator_+3A_simplifyvector">simplifyVector</code></td>
<td>
<p>Passed to <a href="jsonlite.html#topic+fromJSON">fromJSON</a> for response parsing</p>
</td></tr>
<tr><td><code id="gar_api_generator_+3A_checktrailingslash">checkTrailingSlash</code></td>
<td>
<p>Default TRUE will append a trailing slash to baseURI if missing</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>path_args</strong> and <strong>pars_args</strong> add default values to the baseURI.
NULL entries are removed. Use &quot;&quot; if you want an empty argument.
</p>
<p>You don't need to supply access_token for OAuth2 requests in pars_args,
this is dealt with in gar_auth()
</p>
<p>Add custom configurations to the request in this syntax:
<code>customConfig = list(httr::add_headers("From" = "mark@example.com")</code>
</p>


<h3>Value</h3>

<p>A function that can fetch the Google API data you specify
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(googleAuthR)
## change the native googleAuthR scopes to the one needed.
options("googleAuthR.scopes.selected" = "email")

get_email &lt;- function(){
   f &lt;- gar_api_generator("https://openidconnect.googleapis.com/v1/userinfo",
                          "POST",
                          data_parse_function = function(x) x$email,
                          checkTrailingSlash = FALSE)
                          
   f()
   }

To use the above functions:
library(googleAuthR)
# go through authentication flow
gar_auth()
s &lt;- get_email()
s

## End(Not run)


</code></pre>

<hr>
<h2 id='gar_api_page'>Takes a generated API function and lets you page through results</h2><span id='topic+gar_api_page'></span>

<h3>Description</h3>

<p>A helper function to help with the common task of paging through large API results.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_api_page(
  f,
  page_f = function(x) x$nextLink,
  page_method = c("url", "param", "path", "body"),
  page_arg = NULL,
  body_list = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_api_page_+3A_f">f</code></td>
<td>
<p>a function created by <a href="#topic+gar_api_generator">gar_api_generator</a></p>
</td></tr>
<tr><td><code id="gar_api_page_+3A_page_f">page_f</code></td>
<td>
<p>A function that will extract the next page information from <code>f()</code>.  Should return <code>NULL</code> if no paging is required, or the value for <code>page_arg</code> if it is.</p>
</td></tr>
<tr><td><code id="gar_api_page_+3A_page_method">page_method</code></td>
<td>
<p>Method of paging: <code>url</code> will fetch by changing the fetch URL; <code>param</code> will fetch the next page via a parameter set in <code>page_arg</code>; <code>path</code> will change a path variable set in <code>page_arg</code></p>
</td></tr>
<tr><td><code id="gar_api_page_+3A_page_arg">page_arg</code></td>
<td>
<p>If <code>page_method="param"</code>, you need to set this to the parameter that will change for each API page.</p>
</td></tr>
<tr><td><code id="gar_api_page_+3A_body_list">body_list</code></td>
<td>
<p>If <code>page_method="body"</code>, you need to set the body that will be used in each API call, including the top level parameter <code>page_arg</code> that will be modified by <code>page_f</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>page_f</code> function operates on the object returned from the <code>data_parse_function</code> of the function <code>f</code>
</p>
<p>If using <code>page_method="url"</code> then then <code>page_f</code> function needs to return the URL that will fetch the next page of results.  The default finds this via <code>x$nextLink</code>.  This is the easiest to implement if available and is recommended. 
</p>
<p>If using <code>page_method = "param"</code>, then <code>page_f</code> needs to extract the parameter specified in <code>page_arg</code> that will fetch the next page of the results, or NULL if no more pages are required.
e.g. if response is x,  <code>page_f</code> should extract the next value for the parameter of <code>page_arg</code> that fetches the next results.  It should also return <code>NULL</code> if no (more) paging is necessary.  See examples.
Remember to add the paging argument (e.g. <code>start-index</code>) to the generated function too, so it can be modified.
</p>


<h3>Value</h3>

<p>A list of the API page responses, that you may need to process further into one object.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
# demos the two methods for the same function.
# The example is for the Google Analytics management API, 
#  you need to authenticate with that to run them. 


# paging by using nextLink that is returned in API response
ga_segment_list1 &lt;- function(){

  # this URL will be modified by using the url_override argument in the generated function
  segs &lt;- gar_api_generator("https://www.googleapis.com/analytics/v3/management/segments",
                            "GET",
                            pars_args = list("max-results"=10),
                            data_parse_function = function(x) x)
                         
                         
  gar_api_page(segs, 
               page_method = "url",
               page_f = function(x) x$nextLink)

}

# paging by looking for the next start-index parameter

## start by creating the function that will output the correct start-index
paging_function &lt;- function(x){
  next_entry &lt;- x$startIndex + x$itemsPerPage

  # we have all results e.g. 1001 &gt; 1000
  if(next_entry &gt; x$totalResults){
    return(NULL)
  }

  next_entry
  }
  
## remember to add the paging argument (start-index) to the generated function too, 
##  so it can be modified.    
ga_segment_list2 &lt;- function(){

  segs &lt;- gar_api_generator("https://www.googleapis.com/analytics/v3/management/segments",
                           "GET",
                            pars_args = list("start-index" = 1,
                                             "max-results"=10),
                            data_parse_function = function(x) x)
                           
  gar_api_page(segs, 
               page_method = "param",
               page_f = paging_function,
               page_arg = "start-index")

  }


identical(ga_segment_list1(), ga_segment_list2())



## End(Not run)
 
</code></pre>

<hr>
<h2 id='gar_attach_auto_auth'>Auto Authentication function for use within .onAttach</h2><span id='topic+gar_attach_auto_auth'></span>

<h3>Description</h3>

<p>To be placed within <a href="base.html#topic+.onAttach">.onAttach</a> to auto load an authentication file from an environment variable.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_attach_auto_auth(required_scopes, environment_var = "GAR_AUTH_FILE")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_attach_auto_auth_+3A_required_scopes">required_scopes</code></td>
<td>
<p>A character vector of minimum required scopes for this API library</p>
</td></tr>
<tr><td><code id="gar_attach_auto_auth_+3A_environment_var">environment_var</code></td>
<td>
<p>The name of the environment variable where the file path to the authentication file is kept
</p>
<p>This function works with <a href="#topic+gar_auto_auth">gar_auto_auth</a>.  It is intended to be placed within the <a href="base.html#topic+.onAttach">.onAttach</a> hook so that it loads when you load your library.
</p>
<p>For auto-authentication to work, the environment variable needs to hold a file path to an existing auth file such as created via <a href="#topic+gar_auth">gar_auth</a> or a JSON file file download from the Google API console.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Invisible, used for its side effects of calling auto-authentication.
</p>


<h3>See Also</h3>

<p>Other authentication functions: 
<code><a href="#topic+gar_auth">gar_auth</a>()</code>,
<code><a href="#topic+gar_auth_service">gar_auth_service</a>()</code>,
<code><a href="#topic+gar_auto_auth">gar_auto_auth</a>()</code>,
<code><a href="#topic+gar_gce_auth">gar_gce_auth</a>()</code>,
<code><a href="#topic+get_google_token">get_google_token</a>()</code>,
<code><a href="#topic+should_skip_token_checks">should_skip_token_checks</a>()</code>,
<code><a href="#topic+token_exists">token_exists</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 

.onAttach &lt;- function(libname, pkgname){

  googleAuthR::gar_attach_auto_auth("https://www.googleapis.com/auth/urlshortener", "US_AUTH_FILE")

}

## will only work if you have US_AUTH_FILE environment variable pointing to an auth file location
## .Renviron example
US_AUTH_FILE="/home/mark/auth/urlshortnerauth.json"


## End(Not run)

</code></pre>

<hr>
<h2 id='gar_auth'>Authorize <code>googleAuthR</code></h2><span id='topic+gar_auth'></span>

<h3>Description</h3>

<p>Wrapper of <a href="gargle.html#topic+token_fetch">token_fetch</a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_auth(
  token = NULL,
  email = NULL,
  scopes = getOption("googleAuthR.scopes.selected"),
  app = gar_oauth_app(),
  cache = gargle::gargle_oauth_cache(),
  use_oob = gargle::gargle_oob_default(),
  package = "googleAuthR"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_auth_+3A_token">token</code></td>
<td>
<p>an actual token object or the path to a valid token stored as an
<code>.rds</code> file</p>
</td></tr>
<tr><td><code id="gar_auth_+3A_email">email</code></td>
<td>
<p>An existing gargle cached email to authenticate with or TRUE to authenticate with the only email available.</p>
</td></tr>
<tr><td><code id="gar_auth_+3A_scopes">scopes</code></td>
<td>
<p>Scope of the request</p>
</td></tr>
<tr><td><code id="gar_auth_+3A_app">app</code></td>
<td>
<p>app as specified by <a href="#topic+gar_auth_configure">gar_auth_configure</a></p>
</td></tr>
<tr><td><code id="gar_auth_+3A_cache">cache</code></td>
<td>
<p>Where to store authentication tokens</p>
</td></tr>
<tr><td><code id="gar_auth_+3A_use_oob">use_oob</code></td>
<td>
<p>Whether to use OOB browserless authentication</p>
</td></tr>
<tr><td><code id="gar_auth_+3A_package">package</code></td>
<td>
<p>The name of the package authenticating</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an OAuth token object, specifically a
<code><a href="httr.html#topic+Token-class">Token2.0</a></code>, invisibly
</p>


<h3>See Also</h3>

<p>Other authentication functions: 
<code><a href="#topic+gar_attach_auto_auth">gar_attach_auto_auth</a>()</code>,
<code><a href="#topic+gar_auth_service">gar_auth_service</a>()</code>,
<code><a href="#topic+gar_auto_auth">gar_auto_auth</a>()</code>,
<code><a href="#topic+gar_gce_auth">gar_gce_auth</a>()</code>,
<code><a href="#topic+get_google_token">get_google_token</a>()</code>,
<code><a href="#topic+should_skip_token_checks">should_skip_token_checks</a>()</code>,
<code><a href="#topic+token_exists">token_exists</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 

# sets GCP project to auth through
gar_auth_configure(path="path/to/gcp-client.json")

# starts auth process with defaults
gar_auth()

# switching between auth scopes
# first time new scope manual auth, then auto if supplied email   
gar_auth(email = "your@email.com", 
         scopes = "https://www.googleapis.com/auth/drive")
         
# ... query Google Drive functions ...

gar_auth(email = "your@email.com", 
         scopes = "https://www.googleapis.com/auth/bigquery")
         
# ..query BigQuery functions ...


## End(Not run)

</code></pre>

<hr>
<h2 id='gar_auth_configure'>Edit and view auth configuration</h2><span id='topic+gar_auth_configure'></span><span id='topic+gar_api_key'></span><span id='topic+gar_oauth_app'></span>

<h3>Description</h3>

<p>These functions give more control over and visibility into the auth
configuration than [gar_auth()] does. 'gar_auth_configure()'
lets the user specify their own:
* OAuth client, which is used when obtaining a user token.
* API key. If googleAuthR is de-authorized via [gar_deauth()], all
requests are sent with an API key in lieu of a token.
</p>
<p>See the 'vignette(&quot;get-api-credentials&quot;, package = &quot;gargle&quot;)'
for more.
If the user does not configure these settings, internal defaults
are used.
</p>
<p>'gar_oauth_client()' and 'gar_api_key()' retrieve the
currently configured OAuth client and API key, respectively.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_auth_configure(app, path, api_key)

gar_api_key()

gar_oauth_app()
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_auth_configure_+3A_app">app</code></td>
<td>
<p>A Google OAuth client, presumably constructed via <a href="gargle.html#topic+gargle_oauth_client_from_json">gargle_oauth_client_from_json</a>. Note, however, that it is preferred to specify the client with JSON, using the 'path' argument.</p>
</td></tr>
<tr><td><code id="gar_auth_configure_+3A_path">path</code></td>
<td>
<p>JSON downloaded from <a href="https://console.cloud.google.com">Google Cloud Console</a>, containing a client id and secret, in one of the forms supported for the <code>txt</code> argument of <code><a href="jsonlite.html#topic+fromJSON">fromJSON</a></code> (typically, a file path or JSON string).</p>
</td></tr>
<tr><td><code id="gar_auth_configure_+3A_api_key">api_key</code></td>
<td>
<p>API key.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>* 'gar_auth_configure()': An object of R6 class
[gargle::AuthState], invisibly.
* 'gar_oauth_client()': the current user-configured OAuth client.
* 'gar_api_key()': the current user-configured API key.
</p>


<h3>See Also</h3>

<p>Other auth functions: 
<code><a href="#topic+gar_deauth">gar_deauth</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># see and store the current user-configured OAuth app (probaby `NULL`)
(original_app &lt;- gar_oauth_app())

# see and store the current user-configured API key (probaby `NULL`)
(original_api_key &lt;- gar_api_key())

if (require(httr)) {
  # bring your own app via client id (aka key) and secret
  google_app &lt;- httr::oauth_app(
    "my-awesome-google-api-wrapping-package",
    key = "123456789.apps.googleusercontent.com",
    secret = "abcdefghijklmnopqrstuvwxyz"
  )
  google_key &lt;- "the-key-I-got-for-a-google-API"
  gar_auth_configure(app = google_app, api_key = google_key)

  # confirm the changes
  gar_oauth_app()
  gar_api_key()
}

## Not run: 
## bring your own app via JSON downloaded from Google Developers Console
gar_auth_configure(
  path = "/path/to/the/JSON/you/downloaded/from/google/dev/console.json"
)

## End(Not run)

# restore original auth config
gar_auth_configure(app = original_app, api_key = original_api_key)
</code></pre>

<hr>
<h2 id='gar_auth_service'>JSON service account authentication</h2><span id='topic+gar_auth_service'></span>

<h3>Description</h3>

<p>As well as OAuth2 authentication, 
you can authenticate without user interaction via Service accounts.  
This involves downloading a secret JSON key with the authentication
details.
</p>
<p>To use, go to your Project in 
the https://console.developers.google.com/apis/credentials/serviceaccountkey
</p>
<p>and select JSON Key type.  Save the file 
to your computer and call it via supplying 
the file path to the <code>json_file</code> parameter.
</p>
<p>Navigate to it via: 
Google Dev Console &gt; Credentials &gt; New credentials &gt; Service account Key &gt; 
Select service account &gt; Key type = JSON
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_auth_service(json_file, scope = getOption("googleAuthR.scopes.selected"))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_auth_service_+3A_json_file">json_file</code></td>
<td>
<p>the JSON file downloaded from Google Developer Console</p>
</td></tr>
<tr><td><code id="gar_auth_service_+3A_scope">scope</code></td>
<td>
<p>Scope of the JSON file auth if needed</p>
</td></tr>
</table>


<h3>Value</h3>

<p>(Invisible) Sets authentication token
</p>


<h3>See Also</h3>

<p>https://developers.google.com/identity/protocols/OAuth2ServiceAccount
</p>
<p>https://developers.google.com/identity/protocols/OAuth2ServiceAccount
</p>
<p>Other authentication functions: 
<code><a href="#topic+gar_attach_auto_auth">gar_attach_auto_auth</a>()</code>,
<code><a href="#topic+gar_auth">gar_auth</a>()</code>,
<code><a href="#topic+gar_auto_auth">gar_auto_auth</a>()</code>,
<code><a href="#topic+gar_gce_auth">gar_gce_auth</a>()</code>,
<code><a href="#topic+get_google_token">get_google_token</a>()</code>,
<code><a href="#topic+should_skip_token_checks">should_skip_token_checks</a>()</code>,
<code><a href="#topic+token_exists">token_exists</a>()</code>
</p>

<hr>
<h2 id='gar_auto_auth'>Perform auto authentication</h2><span id='topic+gar_auto_auth'></span>

<h3>Description</h3>

<p>This helper function lets you use environment variables to auto-authenticate on package load, intended for calling by <a href="#topic+gar_attach_auto_auth">gar_attach_auto_auth</a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_auto_auth(required_scopes, environment_var = "GAR_AUTH_FILE")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_auto_auth_+3A_required_scopes">required_scopes</code></td>
<td>
<p>Required scopes needed to authenticate - needs to match at least one</p>
</td></tr>
<tr><td><code id="gar_auto_auth_+3A_environment_var">environment_var</code></td>
<td>
<p>Name of environment var that contains auth file path
</p>
<p>The authentication file can be a <code>.httr-oauth</code> file created via <a href="#topic+gar_auth">gar_auth</a> 
or a Google service JSON file downloaded from the Google API credential console, 
with file extension <code>.json</code>.
</p>
<p>You can use this in your code to authenticate from a file location specified in file, 
but it is mainly intended to be called on package load via <a href="#topic+gar_attach_auto_auth">gar_attach_auto_auth</a>.
</p>
<p><code>environment_var</code> This is the name that will be called via <a href="base.html#topic+Sys.getenv">Sys.getenv</a> on library load.  The environment variable will contain an absolute file path to the location of an authentication file.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an OAuth token object, specifically a
<code><a href="httr.html#topic+Token-class">Token2.0</a></code>, invisibly
</p>


<h3>See Also</h3>

<p>Help files for <a href="base.html#topic+.onAttach">.onAttach</a>
</p>
<p>Other authentication functions: 
<code><a href="#topic+gar_attach_auto_auth">gar_attach_auto_auth</a>()</code>,
<code><a href="#topic+gar_auth">gar_auth</a>()</code>,
<code><a href="#topic+gar_auth_service">gar_auth_service</a>()</code>,
<code><a href="#topic+gar_gce_auth">gar_gce_auth</a>()</code>,
<code><a href="#topic+get_google_token">get_google_token</a>()</code>,
<code><a href="#topic+should_skip_token_checks">should_skip_token_checks</a>()</code>,
<code><a href="#topic+token_exists">token_exists</a>()</code>
</p>

<hr>
<h2 id='gar_batch'>Turn a list of gar_fetch_functions into batch functions</h2><span id='topic+gar_batch'></span>

<h3>Description</h3>

<p>Turn a list of gar_fetch_functions into batch functions
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_batch(
  function_list,
  ...,
  batch_endpoint = getOption("googleAuthR.batch_endpoint", default =
    "https://www.googleapis.com/batch")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_batch_+3A_function_list">function_list</code></td>
<td>
<p>a list of functions from <code><a href="#topic+gar_api_generator">gar_api_generator</a></code></p>
</td></tr>
<tr><td><code id="gar_batch_+3A_...">...</code></td>
<td>
<p>further arguments passed to the data parse function of f</p>
</td></tr>
<tr><td><code id="gar_batch_+3A_batch_endpoint">batch_endpoint</code></td>
<td>
<p>the batch API endpoint to send to</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function will turn all the individual Google API functions
into one POST request to /batch. 
</p>
<p>If you need to pass multiple data parse function arguments its probably best 
to do it in separate batches to avoid confusion.
</p>


<h3>Value</h3>

<p>A list of the Google API responses
</p>


<h3>See Also</h3>

<p>https://developers.google.com/webmaster-tools/v3/how-tos/batch
</p>
<p>Documentation on doing batch requests for the search console API.  
Other Google APIs are similar.
</p>
<p>Walk through API calls changing parameters using <code><a href="#topic+gar_batch_walk">gar_batch_walk</a></code>
</p>
<p>Other batch functions: 
<code><a href="#topic+gar_batch_walk">gar_batch_walk</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 

## usually set on package load
options(googleAuthR.batch_endpoint = "https://www.googleapis.com/batch/urlshortener/v1")

## from goo.gl API
shorten_url &lt;- function(url){
  body = list(longUrl = url)
  f &lt;- gar_api_generator("https://www.googleapis.com/urlshortener/v1/url",
                         "POST",
                          data_parse_function = function(x) x$id)
                        
  f(the_body = body)
}


## from goo.gl API
user_history &lt;- function(){
  f &lt;- gar_api_generator("https://www.googleapis.com/urlshortener/v1/url/history",
                      "GET",
                      data_parse_function = function(x) x$items)
                      
  f()
}

gar_batch(list(shorten_url("http://markedmondson.me"), user_history()))


## End(Not run)
</code></pre>

<hr>
<h2 id='gar_batch_walk'>Walk data through batches</h2><span id='topic+gar_batch_walk'></span>

<h3>Description</h3>

<p>Convenience function for walking through data in batches
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_batch_walk(
  f,
  walk_vector,
  gar_pars = NULL,
  gar_paths = NULL,
  the_body = NULL,
  pars_walk = NULL,
  path_walk = NULL,
  body_walk = NULL,
  batch_size = 10,
  batch_function = NULL,
  data_frame_output = TRUE,
  ...,
  batch_endpoint = getOption("googleAuthR.batch_endpoint", default =
    "https://www.googleapis.com/batch")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_batch_walk_+3A_f">f</code></td>
<td>
<p>a function from <code><a href="#topic+gar_api_generator">gar_api_generator</a></code></p>
</td></tr>
<tr><td><code id="gar_batch_walk_+3A_walk_vector">walk_vector</code></td>
<td>
<p>a vector of the parameter or path to change</p>
</td></tr>
<tr><td><code id="gar_batch_walk_+3A_gar_pars">gar_pars</code></td>
<td>
<p>a list of parameter arguments for f</p>
</td></tr>
<tr><td><code id="gar_batch_walk_+3A_gar_paths">gar_paths</code></td>
<td>
<p>a list of path arguments for f</p>
</td></tr>
<tr><td><code id="gar_batch_walk_+3A_the_body">the_body</code></td>
<td>
<p>a list of body arguments for f</p>
</td></tr>
<tr><td><code id="gar_batch_walk_+3A_pars_walk">pars_walk</code></td>
<td>
<p>a character vector of the parameter(s) to modify for each walk of f</p>
</td></tr>
<tr><td><code id="gar_batch_walk_+3A_path_walk">path_walk</code></td>
<td>
<p>a character vector of the path(s) to modify for each walk of f</p>
</td></tr>
<tr><td><code id="gar_batch_walk_+3A_body_walk">body_walk</code></td>
<td>
<p>a character vector of the body(s) to modify for each walk of f</p>
</td></tr>
<tr><td><code id="gar_batch_walk_+3A_batch_size">batch_size</code></td>
<td>
<p>size of each request to Google /batch API</p>
</td></tr>
<tr><td><code id="gar_batch_walk_+3A_batch_function">batch_function</code></td>
<td>
<p>a function that will act on the result list of each batch API call</p>
</td></tr>
<tr><td><code id="gar_batch_walk_+3A_data_frame_output">data_frame_output</code></td>
<td>
<p>if the list of lists are dataframes, you can bind them all by setting to TRUE</p>
</td></tr>
<tr><td><code id="gar_batch_walk_+3A_...">...</code></td>
<td>
<p>further arguments passed to the data parse function of f</p>
</td></tr>
<tr><td><code id="gar_batch_walk_+3A_batch_endpoint">batch_endpoint</code></td>
<td>
<p>the batch API endpoint to send</p>
</td></tr>
</table>


<h3>Details</h3>

<p>You can modify more than one parameter or path arg, 
but it must be the same walked vector e.g. <code>start = end = x</code>
</p>
<p>Many Google APIs have <code>batch_size</code> limits greater than 10, 1000 is common.
</p>
<p>The 'f' function needs to be a 'gar_api_generator()' function that uses one of 'path_args', 'pars_args' or 'body_args' to construct the URL (rather than say using 'sprintf()' to create the API URL). 
</p>
<p>You don't need to set the headers in the Google docs for batching API functions - those are done for you.
</p>
<p>The argument 'walk_vector' needs to be a vector of the values of the arguments to walk over, which you indicate will walk over the pars/path or body arguments on the function via on of the '*_walk' arguments e.g. if walking over id=1, id=2, for a path argument then it would be 'path_walk=&quot;id&quot;' and 'walk_vector=c(1,2,3,4)'
</p>
<p>The 'gar_*' parameter is required to pass intended for other arguments to the function 'f' you may need to pass through.
</p>
<p>'gar_batch_walk()' only supports changing one value at a time, for one or multiple arguments (I think only changing the 'start-date', 'end-date' example would be the case when you walk through more than one per call)
</p>
<p>'batch_size' should be over 1 for batching to be of any benefit at all
</p>
<p>The 'batch_function' argument gives you a way to operate on the parsed output of each call
</p>


<h3>Value</h3>

<p><strong>if data_frame_output is FALSE</strong>: A list of lists.  
Outer list the length of number of batches required, inner lists the results from the calls
</p>
<p><strong>if data_frame_output is TRUE</strong>: The list of lists will attempt to rbind all the results
</p>


<h3>See Also</h3>

<p>Other batch functions: 
<code><a href="#topic+gar_batch">gar_batch</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
                               

# get a webproperty per account 
getAccountInfo &lt;- gar_api_generator(
  "https://www.googleapis.com/analytics/v3/management/accounts",
  "GET", data_parse_function = function(x) unique(x$items$id))

getWebpropertyInfo &lt;- gar_api_generator(
  "https://www.googleapis.com/analytics/v3/management/", # don't use sprintf to construct this
  "GET",
  path_args = list(accounts = "default", webproperties = ""),
  data_parse_function = function(x) x$items)

walkData &lt;- function(){

  # here due to R lazy evaluation  
  accs &lt;- getAccountInfo()
  gar_batch_walk(getWebpropertyInfo, 
                 walk_vector = accs,
                 gar_paths = list("webproperties" = ""),
                 path_walk = "accounts",
                 batch_size = 100, data_frame_output = FALSE)
                 }
                 
# do the walk
walkData()

# to walk body data, be careful to modify a top level body name:
changed_emails &lt;- lapply(email, function(x){userRef = list(email = x)})

batched &lt;- gar_batch_walk(users, 
                       walk_vector = changed_emails, 
                       the_body = list(
                           permissions = list(
                             local = list(permissions)
                           ),
                           userRef = list(
                             email = email[[1]]
                         )
                        ),
                        body_walk = "userRef",
                        batch_size = 300,
                        data_frame_output = FALSE)

## End(Not run)



</code></pre>

<hr>
<h2 id='gar_cache_get_loc'>Setup where to put cache</h2><span id='topic+gar_cache_get_loc'></span><span id='topic+gar_cache_empty'></span><span id='topic+gar_cache_setup'></span>

<h3>Description</h3>

<p>To cache to a file system use <code>memoise::cache_filesystem("cache_folder")</code>, 
suitable for unit testing and works between R sessions. 
</p>
<p>The cached API calls do not need authentication to be active, but need this function to set caching first.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_cache_get_loc()

gar_cache_empty()

gar_cache_setup(
  mcache = memoise::cache_memory(),
  invalid_func = function(req) {
     tryCatch(req$status_code == 200, error =
    function(x) FALSE)
 }
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_cache_get_loc_+3A_mcache">mcache</code></td>
<td>
<p>A cache method from <a href="memoise.html#topic+memoise">memoise</a>.</p>
</td></tr>
<tr><td><code id="gar_cache_get_loc_+3A_invalid_func">invalid_func</code></td>
<td>
<p>A function that takes API response, and returns <code>TRUE</code> or <code>FALSE</code> whether caching takes place. Default cache everything.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>TRUE</code> if successful.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 

# demo function to cache within
shorten_url_cache &lt;- function(url){
  body = list(longUrl = url)
  f &lt;- gar_api_generator("https://www.googleapis.com/urlshortener/v1/url",
                      "POST",
                      data_parse_function = function(x) x)
 f(the_body = body)
 
 }
 
 ## only cache if this URL
 gar_cache_setup(invalid_func = function(req){
      req$content$longUrl == "http://code.markedmondson.me/"
 })
 
 # authentication
 gar_auth()
 ## caches
 shorten_url_cache("http://code.markedmondson.me")
 
 ## read cache
 shorten_url("http://code.markedmondson.me")
 
 ## ..but dont cache me
 shorten_url_cache("http://blahblah.com")


## End(Not run)

</code></pre>

<hr>
<h2 id='gar_check_existing_token'>Check a token vs options</h2><span id='topic+gar_check_existing_token'></span>

<h3>Description</h3>

<p>Useful for debugging authentication issues
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_check_existing_token(token = .auth$cred)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_check_existing_token_+3A_token">token</code></td>
<td>
<p>A token to check, default current live session token</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Will compare the passed token's settings and compare to set options.  
If these differ, then reauthentication may be needed.
</p>


<h3>Value</h3>

<p><code>FALSE</code> if the options and current token do not match, <code>TRUE</code> if they do.
</p>

<hr>
<h2 id='gar_create_api_objects'>Create the API objects from the Discovery API</h2><span id='topic+gar_create_api_objects'></span>

<h3>Description</h3>

<p>Create the API objects from the Discovery API
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_create_api_objects(filename, api_json, format = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_create_api_objects_+3A_filename">filename</code></td>
<td>
<p>File to write the objects to</p>
</td></tr>
<tr><td><code id="gar_create_api_objects_+3A_api_json">api_json</code></td>
<td>
<p>The json from <a href="#topic+gar_discovery_api">gar_discovery_api</a></p>
</td></tr>
<tr><td><code id="gar_create_api_objects_+3A_format">format</code></td>
<td>
<p>If TRUE will use <a href="formatR.html#topic+tidy_eval">tidy_eval</a> on content</p>
</td></tr>
</table>


<h3>Value</h3>

<p>TRUE if successful, side-effect creating filename
</p>


<h3>See Also</h3>

<p>Other Google Discovery API functions: 
<code><a href="#topic+gar_create_api_skeleton">gar_create_api_skeleton</a>()</code>,
<code><a href="#topic+gar_create_package">gar_create_package</a>()</code>,
<code><a href="#topic+gar_discovery_api">gar_discovery_api</a>()</code>,
<code><a href="#topic+gar_discovery_apis_list">gar_discovery_apis_list</a>()</code>
</p>

<hr>
<h2 id='gar_create_api_skeleton'>Create an API library skeleton</h2><span id='topic+gar_create_api_skeleton'></span>

<h3>Description</h3>

<p>This will create a file with the skeleton of the API functions 
for the specified library
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_create_api_skeleton(filename, api_json, format = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_create_api_skeleton_+3A_filename">filename</code></td>
<td>
<p>R file to write skeleton to</p>
</td></tr>
<tr><td><code id="gar_create_api_skeleton_+3A_api_json">api_json</code></td>
<td>
<p>The json from <a href="#topic+gar_discovery_api">gar_discovery_api</a></p>
</td></tr>
<tr><td><code id="gar_create_api_skeleton_+3A_format">format</code></td>
<td>
<p>If TRUE will use <a href="formatR.html#topic+tidy_eval">tidy_eval</a> on content</p>
</td></tr>
</table>


<h3>Value</h3>

<p>TRUE if successful, side effect will write a file
</p>


<h3>See Also</h3>

<p>Other Google Discovery API functions: 
<code><a href="#topic+gar_create_api_objects">gar_create_api_objects</a>()</code>,
<code><a href="#topic+gar_create_package">gar_create_package</a>()</code>,
<code><a href="#topic+gar_discovery_api">gar_discovery_api</a>()</code>,
<code><a href="#topic+gar_discovery_apis_list">gar_discovery_apis_list</a>()</code>
</p>

<hr>
<h2 id='gar_create_package'>Create a Google API package</h2><span id='topic+gar_create_package'></span>

<h3>Description</h3>

<p>Create a Google API package
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_create_package(
  api_json,
  directory,
  rstudio = TRUE,
  check = FALSE,
  github = FALSE,
  format = TRUE,
  overwrite = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_create_package_+3A_api_json">api_json</code></td>
<td>
<p>json from <a href="#topic+gar_discovery_api">gar_discovery_api</a></p>
</td></tr>
<tr><td><code id="gar_create_package_+3A_directory">directory</code></td>
<td>
<p>Where to build the package</p>
</td></tr>
<tr><td><code id="gar_create_package_+3A_rstudio">rstudio</code></td>
<td>
<p>Passed to <a href="usethis.html#topic+create_package">create_package</a>, creates RStudio project file</p>
</td></tr>
<tr><td><code id="gar_create_package_+3A_check">check</code></td>
<td>
<p>Perform a <a href="devtools.html#topic+check">check</a> on the package once done</p>
</td></tr>
<tr><td><code id="gar_create_package_+3A_github">github</code></td>
<td>
<p>If TRUE will upload package to your github</p>
</td></tr>
<tr><td><code id="gar_create_package_+3A_format">format</code></td>
<td>
<p>If TRUE will use <a href="formatR.html#topic+tidy_eval">tidy_eval</a> on content</p>
</td></tr>
<tr><td><code id="gar_create_package_+3A_overwrite">overwrite</code></td>
<td>
<p>Whether to overwrite an existing directory if it exists</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For github upload to work you need to have your github PAT setup. See <a href="usethis.html#topic+use_github">use_github</a>.
</p>
<p>Uses usethis to create a package structure then 
<a href="#topic+gar_create_api_skeleton">gar_create_api_skeleton</a> and <a href="#topic+gar_create_api_objects">gar_create_api_objects</a> to create 
starting files for a Google API package.
</p>


<h3>Value</h3>

<p>If check is TRUE, the results of the CRAN check, else FALSE
</p>


<h3>See Also</h3>

<p><a href="https://developers.google.com/discovery/v1/reference/apis/list">https://developers.google.com/discovery/v1/reference/apis/list</a>
</p>
<p>A Github repository with <a href="https://github.com/MarkEdmondson1234/autoGoogleAPI">154 R packages</a> examples generated by this function.
</p>
<p>Other Google Discovery API functions: 
<code><a href="#topic+gar_create_api_objects">gar_create_api_objects</a>()</code>,
<code><a href="#topic+gar_create_api_skeleton">gar_create_api_skeleton</a>()</code>,
<code><a href="#topic+gar_discovery_api">gar_discovery_api</a>()</code>,
<code><a href="#topic+gar_discovery_apis_list">gar_discovery_apis_list</a>()</code>
</p>

<hr>
<h2 id='gar_deauth'>Suspend authorization</h2><span id='topic+gar_deauth'></span>

<h3>Description</h3>

<p>Put googleAuthR into a de-authorized state. Instead of sending a token,
googleAuthR will send an API key. This can be used to access public
resources for which no Google sign-in is required. This is handy for using
googleAuthR in a non-interactive setting to make requests that do not
require a token. It will prevent the attempt to obtain a token
interactively in the browser. The user can configure their own API key
via [gar_auth_configure()] and retrieve that key via
[gar_api_key()].
In the absence of a user-configured key, a built-in default key is used.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_deauth()
</code></pre>


<h3>See Also</h3>

<p>Other auth functions: 
<code><a href="#topic+gar_auth_configure">gar_auth_configure</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
gar_deauth()

## End(Not run)
</code></pre>

<hr>
<h2 id='gar_debug_parsing'>Read the diagnostic object returned on API parse errors.</h2><span id='topic+gar_debug_parsing'></span>

<h3>Description</h3>

<p>Read the diagnostic object returned on API parse errors.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_debug_parsing(filename = "gar_parse_error.rds")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_debug_parsing_+3A_filename">filename</code></td>
<td>
<p>The file created from API errors, usually called <code>gar_parse_error.rds</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>When googleAuthR API parsing fails, it will write a file called gar_parse_error.rds to the directory.  Feed that file into this function to help diagnose the problem.
</p>

<hr>
<h2 id='gar_discovery_api'>Get meta data details for specified Google API</h2><span id='topic+gar_discovery_api'></span>

<h3>Description</h3>

<p>Download the discovery document for an API
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_discovery_api(api, version, a_url = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_discovery_api_+3A_api">api</code></td>
<td>
<p>The API to fetch</p>
</td></tr>
<tr><td><code id="gar_discovery_api_+3A_version">version</code></td>
<td>
<p>The API version to fetch</p>
</td></tr>
<tr><td><code id="gar_discovery_api_+3A_a_url">a_url</code></td>
<td>
<p>Supply your own discovery URL, for private APIs only</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Details of the API
</p>


<h3>See Also</h3>

<p><a href="https://developers.google.com/discovery/v1/getting_started">https://developers.google.com/discovery/v1/getting_started</a>
</p>
<p>Other Google Discovery API functions: 
<code><a href="#topic+gar_create_api_objects">gar_create_api_objects</a>()</code>,
<code><a href="#topic+gar_create_api_skeleton">gar_create_api_skeleton</a>()</code>,
<code><a href="#topic+gar_create_package">gar_create_package</a>()</code>,
<code><a href="#topic+gar_discovery_apis_list">gar_discovery_apis_list</a>()</code>
</p>

<hr>
<h2 id='gar_discovery_apis_list'>Get a list of Google API libraries</h2><span id='topic+gar_discovery_apis_list'></span>

<h3>Description</h3>

<p>Does not require authentication
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_discovery_apis_list()
</code></pre>


<h3>Value</h3>

<p>List of Google APIs and their resources
</p>


<h3>See Also</h3>

<p><a href="https://developers.google.com/discovery/v1/reference/apis/list">https://developers.google.com/discovery/v1/reference/apis/list</a>
</p>
<p>Other Google Discovery API functions: 
<code><a href="#topic+gar_create_api_objects">gar_create_api_objects</a>()</code>,
<code><a href="#topic+gar_create_api_skeleton">gar_create_api_skeleton</a>()</code>,
<code><a href="#topic+gar_create_package">gar_create_package</a>()</code>,
<code><a href="#topic+gar_discovery_api">gar_discovery_api</a>()</code>
</p>

<hr>
<h2 id='gar_gce_auth'>Authenticate on Google Compute Engine</h2><span id='topic+gar_gce_auth'></span>

<h3>Description</h3>

<p>This takes the metadata auth token in a Google Compute Engine instance as authentication source
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_gce_auth(
  service_account = "default",
  scopes = "https://www.googleapis.com/auth/cloud-platform"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_gce_auth_+3A_service_account">service_account</code></td>
<td>
<p>Specify a different service account from the <code>default</code></p>
</td></tr>
<tr><td><code id="gar_gce_auth_+3A_scopes">scopes</code></td>
<td>
<p>Scopes for the authentication</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>service_account</code> is <code>default</code> or the service account email 
e.g. <code>"service-account-key-json@projectname.iam.gserviceaccount.com"</code>
</p>
<p>Google Compute Engine instances come with their own authentication tokens.  
</p>
<p>It has no refresh token so you need to call for a fresh token after approx. one hour. 
The metadata token will refresh itself when it has about 60 seconds left.
</p>
<p>You can only use for scopes specified when creating the instance.
</p>
<p>If you want to use them make sure their service account email is added to accounts you want to get data from.
</p>
<p>Use <code>options(gargle.gce.use_ip = TRUE)</code> to activate this upon kubernetes for instance using federated identity
</p>


<h3>Value</h3>

<p>A token
</p>


<h3>See Also</h3>

<p><a href="#topic+gar_gce_auth_email">gar_gce_auth_email</a>
</p>
<p>Other authentication functions: 
<code><a href="#topic+gar_attach_auto_auth">gar_attach_auto_auth</a>()</code>,
<code><a href="#topic+gar_auth">gar_auth</a>()</code>,
<code><a href="#topic+gar_auth_service">gar_auth_service</a>()</code>,
<code><a href="#topic+gar_auto_auth">gar_auto_auth</a>()</code>,
<code><a href="#topic+get_google_token">get_google_token</a>()</code>,
<code><a href="#topic+should_skip_token_checks">should_skip_token_checks</a>()</code>,
<code><a href="#topic+token_exists">token_exists</a>()</code>
</p>

<hr>
<h2 id='gar_gce_auth_default'>Authenticate via gcloud's application-default login</h2><span id='topic+gar_gce_auth_default'></span>

<h3>Description</h3>

<p>This allows you to take gcloud's application-default login token and turns it into one that can be used by R
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_gce_auth_default(
  scopes = getOption("googleAuthR.scopes.selected",
    "https://www.googleapis.com/auth/cloud-platform")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_gce_auth_default_+3A_scopes">scopes</code></td>
<td>
<p>The scope you created the access_token with</p>
</td></tr>
</table>


<h3>Details</h3>

<p>When authenticating on Google Cloud Platform services, if you are using services that take the cloud scopes you can use <a href="#topic+gar_gce_auth">gar_gce_auth</a> to generate authentication.
</p>
<p>However, for other services that require a user login (such as Google Analytics API), you need a method of authentication where you can use your own email login.  You have two options - create a token offline and upload it to the instance, or <code>gcloud</code> allows you to generate your own token online via <code>gcloud auth application-default login &amp;&amp; gcloud auth application-default print-access-token</code>
</p>
<p>This function will then take the returned access token and put it within R so it can be used as normal with <code>googleAuthR</code> functions.
</p>


<h3>See Also</h3>

<p><a href="https://cloud.google.com/sdk/gcloud/reference/auth/application-default/print-access-token">gcloud reference</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 

## in the terminal, issue this gcloud command specifying the scopes to authenticate with
gcloud auth application-default login \
  --scopes=https://www.googleapis.com/auth/analytics.readonly

## access the URL, login and create a verification code, paste in console.

## view then copy-paste the access token, to be passed into the R function
gcloud auth application-default print-access-token

## In R:
gar_gce_auth_default(&lt;token-copy-pasted&gt;, 
     scopes = 'https://www.googleapis.com/auth/analytics.readonly',
     cache_file = 'my_ga.auth')
                     
# use token to authenticate as you would normally with library

## End(Not run)


</code></pre>

<hr>
<h2 id='gar_gce_auth_email'>Get the service email via GCE metadata</h2><span id='topic+gar_gce_auth_email'></span>

<h3>Description</h3>

<p>Get the service email via GCE metadata
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_gce_auth_email(service_account = "default")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_gce_auth_email_+3A_service_account">service_account</code></td>
<td>
<p>Specify a different service account from the <code>default</code>
</p>
<p>Useful if you don't know the default email and need it for other uses</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the email address character string
</p>


<h3>See Also</h3>

<p><a href="#topic+gar_gce_auth">gar_gce_auth</a>
</p>

<hr>
<h2 id='gar_has_token'>Is there a token on hand?</h2><span id='topic+gar_has_token'></span>

<h3>Description</h3>

<p>Reports whether googleAuthR has stored a token, ready for use in downstream
requests.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_has_token()
</code></pre>


<h3>Value</h3>

<p>Logical.
</p>


<h3>See Also</h3>

<p>Other low-level API functions: 
<code><a href="#topic+gar_token">gar_token</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>gar_has_token()
</code></pre>

<hr>
<h2 id='gar_scope_config'>Create or add scopes to configuration</h2><span id='topic+gar_scope_config'></span>

<h3>Description</h3>

<p>Helper for working with scopes
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_scope_config(required_scopes)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_scope_config_+3A_required_scopes">required_scopes</code></td>
<td>
<p>character vector of scopes to add</p>
</td></tr>
</table>

<hr>
<h2 id='gar_service_create'>Work with service accounts via the API</h2><span id='topic+gar_service_create'></span><span id='topic+gar_service_grant_roles'></span><span id='topic+gar_service_get_roles'></span><span id='topic+gar_service_key'></span><span id='topic+gar_service_key_list'></span><span id='topic+gar_service_list'></span><span id='topic+gar_service_get'></span>

<h3>Description</h3>

<p>These functions let you create a service JSON key from an OAuth2 login.  You can then assign it roles and do a one time download of a service account key to use for authentication in other Google APIs
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_service_create(
  accountId,
  projectId,
  serviceName = "googleAuthR::gar_service_create",
  serviceDescription = "A service account created via googleAuthR"
)

gar_service_grant_roles(
  accountIds,
  roles,
  projectId,
  type = c("serviceAccount", "user", "group")
)

gar_service_get_roles(
  projectId,
  accountId = NULL,
  type = c("serviceAccount", "user", "group")
)

gar_service_key(
  accountId,
  projectId,
  file = paste0(accountId, "-auth-key.json")
)

gar_service_key_list(accountId, projectId)

gar_service_list(projectId)

gar_service_get(accountId, projectId)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_service_create_+3A_accountid">accountId</code></td>
<td>
<p>The service accountId</p>
</td></tr>
<tr><td><code id="gar_service_create_+3A_projectid">projectId</code></td>
<td>
<p>The projectId containing the service account</p>
</td></tr>
<tr><td><code id="gar_service_create_+3A_servicename">serviceName</code></td>
<td>
<p>Name of service account</p>
</td></tr>
<tr><td><code id="gar_service_create_+3A_servicedescription">serviceDescription</code></td>
<td>
<p>Description of service account</p>
</td></tr>
<tr><td><code id="gar_service_create_+3A_accountids">accountIds</code></td>
<td>
<p>A vector of accountIds in the form <code>accountId@projectid.iam.gserviceaccount.com</code></p>
</td></tr>
<tr><td><code id="gar_service_create_+3A_roles">roles</code></td>
<td>
<p>A character vector of roles to give the accountIds e.g. <code>roles/editor</code> - see list of roles here <a href="https://cloud.google.com/iam/docs/understanding-roles#predefined_roles">https://cloud.google.com/iam/docs/understanding-roles#predefined_roles</a> or in your GCP console <code>https://console.cloud.google.com/iam-admin/roles/details/roles</code></p>
</td></tr>
<tr><td><code id="gar_service_create_+3A_type">type</code></td>
<td>
<p>The type of accountId to add role for - e.g. <code>user:mark@me.com</code> or <code>serviceAccount:accountId@projectid.iam.gserviceaccount.com</code></p>
</td></tr>
<tr><td><code id="gar_service_create_+3A_file">file</code></td>
<td>
<p>The file to download the private JSON key to</p>
</td></tr>
</table>


<h3>Details</h3>

<p>It will download the existing roles, and append the role you add to it here.
</p>
<p>If you supply an accountId to <code>gar_service_get_roles</code> then it will return only those roles that accountId has.
</p>


<h3>Value</h3>

<p>If it already exists, returns it via <a href="#topic+gar_service_get">gar_service_get</a>, else creates the service key
</p>


<h3>See Also</h3>

<p>Combine these functions to provision emails in one step with <a href="#topic+gar_service_provision">gar_service_provision</a>
</p>
<p><a href="https://cloud.google.com/resource-manager/reference/rest/v1/projects/setIamPolicy">https://cloud.google.com/resource-manager/reference/rest/v1/projects/setIamPolicy</a>
</p>
<p><a href="https://cloud.google.com/resource-manager/reference/rest/v1/projects/setIamPolicy">https://cloud.google.com/resource-manager/reference/rest/v1/projects/setIamPolicy</a>
</p>
<p>https://cloud.google.com/iam/docs/reference/rest/v1/projects.serviceAccounts.keys/create
</p>
<p>Other IAM functions: 
<code><a href="#topic+gar_service_provision">gar_service_provision</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 

# all roles
projectId &lt;- gar_set_client(
                json = Sys.getenv("GAR_CLIENT_JSON"), 
                scopes = "https://www.googleapis.com/auth/cloud-platform")
gar_service_get_roles(projectId)

# roles for one accountId
gar_service_get_roles(
    projectId, 
    accountId = "1080525199262@cloudbuild.gserviceaccount.com")


## End(Not run)
## Not run: 
 library(googleAuthR)
 gar_set_client(scopes = "https://www.googleapis.com/auth/cloud-platform")
 gar_auth()
 gar_service_create("test12345678", "my-project")
 
 gar_service_get("test12345678@my-project.iam.gserviceaccount.com", 
                 projectId = "my-project")
 
 gar_service_grant_roles("test12345678@my-project.iam.gserviceaccount.com",
                         role = "roles/editor",
                         projectId = "my-project")
 
 gar_service_key("test12345678", "my-project", "my-auth.json")
 
 gar_service_list("my-project")
 
 gar_service_key_list("test12345678", "my-project")

## End(Not run)
</code></pre>

<hr>
<h2 id='gar_service_provision'>Provision a service account</h2><span id='topic+gar_service_provision'></span>

<h3>Description</h3>

<p>This uses all the <a href="#topic+gar_service_create">gar_service_create</a> functions to enable creating service account roles more easily
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_service_provision(
  accountId,
  roles,
  json = Sys.getenv("GAR_CLIENT_JSON"),
  file = paste0(accountId, "-auth-key.json"),
  email = Sys.getenv("GARGLE_EMAIL")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_service_provision_+3A_accountid">accountId</code></td>
<td>
<p>The service accountId</p>
</td></tr>
<tr><td><code id="gar_service_provision_+3A_roles">roles</code></td>
<td>
<p>A character vector of roles to give the accountIds e.g. <code>roles/editor</code> - see list of roles here <a href="https://cloud.google.com/iam/docs/understanding-roles#predefined_roles">https://cloud.google.com/iam/docs/understanding-roles#predefined_roles</a> or in your GCP console <code>https://console.cloud.google.com/iam-admin/roles/details/roles</code></p>
</td></tr>
<tr><td><code id="gar_service_provision_+3A_json">json</code></td>
<td>
<p>The file location of an OAuth 2.0 client ID json file</p>
</td></tr>
<tr><td><code id="gar_service_provision_+3A_file">file</code></td>
<td>
<p>The file to download the private JSON key to</p>
</td></tr>
<tr><td><code id="gar_service_provision_+3A_email">email</code></td>
<td>
<p>An existing gargle cached email to authenticate with or TRUE to authenticate with the only email available.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>You will need the OAuth2.0 Client ID JSON from your GCP project via 
<code>menu icon &gt; APIs &amp; Services &gt; Credentials &gt; Create Credentials &gt; OAuth client ID</code>
</p>
<p>You need to authenticate with a user with permission <code>iam.serviceAccounts.create</code> for the project.  Most often the user is an Owner/Editor
</p>


<h3>See Also</h3>

<p><a href="https://cloud.google.com/iam/docs/creating-managing-service-accounts#iam-service-accounts-create-rest">https://cloud.google.com/iam/docs/creating-managing-service-accounts#iam-service-accounts-create-rest</a>
</p>
<p>Other IAM functions: 
<code><a href="#topic+gar_service_create">gar_service_create</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

gar_service_provision("my-service-account", 
                      c("roles/viewer", "roles/bigquery.jobUser"))

## End(Not run)
</code></pre>

<hr>
<h2 id='gar_set_client'>Setup the clientId, clientSecret and scopes</h2><span id='topic+gar_set_client'></span>

<h3>Description</h3>

<p>Help setup the client ID and secret with the OAuth 2.0 clientID.  
Do not confuse with Service account keys.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_set_client(
  json = Sys.getenv("GAR_CLIENT_JSON"),
  web_json = Sys.getenv("GAR_CLIENT_WEB_JSON"),
  scopes = NULL,
  activate = c("offline", "web")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_set_client_+3A_json">json</code></td>
<td>
<p>The file location of an OAuth 2.0 client ID json file</p>
</td></tr>
<tr><td><code id="gar_set_client_+3A_web_json">web_json</code></td>
<td>
<p>The file location of client ID json file for web applications</p>
</td></tr>
<tr><td><code id="gar_set_client_+3A_scopes">scopes</code></td>
<td>
<p>A character vector of scopes to set</p>
</td></tr>
<tr><td><code id="gar_set_client_+3A_activate">activate</code></td>
<td>
<p>Which credential to activate</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function helps set the <code>options(googleAuthR.client_id)</code>, 
<code>options(googleAuthR.client_secret)</code> and 
<code>options(googleAuthR.scopes.selected)</code> for you.
</p>
<p>You can also set the web application client IDs that are used in Shiny authentication, 
that are set via the options <code>options(googleAuthR.webapp.client_id)</code>, 
<code>options(googleAuthR.webapp.client_secret)</code>
</p>
<p>Note that if you authenticate with a cache token with different values it 
will overwrite them.
</p>
<p>For successful authentication, the API scopes can be browsed via the 
googleAuthR RStudio addin or the Google API documentation.
</p>
<p>Do not confuse this JSON file with the service account keys, that are
used to authenticate a service email.  This JSON only sets up which
app you are going to authenticate with - use <a href="#topic+gar_auth_service">gar_auth_service</a> with
the Service account keys JSON to perform the actual authentication. 
</p>
<p>By default the JSON file will be looked for in the location specified by the
<code>"GAR_CLIENT_JSON"</code> environment argument, or via <code>"GAR_CLIENT_WEB_JSON"</code> for webapps.
</p>


<h3>Value</h3>

<p>The <code>project-id</code> the app has been set for
</p>


<h3>Author(s)</h3>

<p>Idea via @jennybc and @jimhester from <code>gargle and gmailr</code> libraries.
</p>


<h3>See Also</h3>

<p><a href="https://console.cloud.google.com/apis/credentials">https://console.cloud.google.com/apis/credentials</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 

gar_set_client("google-client.json", 
               scopes = "http://www.googleapis.com/auth/webmasters")
gar_auth_service("google-service-auth.json")

## End(Not run)

</code></pre>

<hr>
<h2 id='gar_setup_auth_check'>Check service key works via environment argument</h2><span id='topic+gar_setup_auth_check'></span>

<h3>Description</h3>

<p>Check service key works via environment argument
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_setup_auth_check(
  env_arg = "GCE_AUTH_FILE",
  scope = "https://www.googleapis.com/auth/cloud-platform"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_setup_auth_check_+3A_env_arg">env_arg</code></td>
<td>
<p>The authentication environment argument</p>
</td></tr>
<tr><td><code id="gar_setup_auth_check_+3A_scope">scope</code></td>
<td>
<p>The scope of the GCP request</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other setup functions: 
<code><a href="#topic+gar_setup_auth_key">gar_setup_auth_key</a>()</code>,
<code><a href="#topic+gar_setup_clientid">gar_setup_clientid</a>()</code>,
<code><a href="#topic+gar_setup_edit_renviron">gar_setup_edit_renviron</a>()</code>,
<code><a href="#topic+gar_setup_env_check">gar_setup_env_check</a>()</code>,
<code><a href="#topic+gar_setup_menu">gar_setup_menu</a>()</code>,
<code><a href="#topic+gar_setup_menu_do">gar_setup_menu_do</a>()</code>
</p>

<hr>
<h2 id='gar_setup_auth_key'>Create a service account for googleCloudRunner</h2><span id='topic+gar_setup_auth_key'></span>

<h3>Description</h3>

<p>This will use your Google OAuth2 user to create a suitable service account
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_setup_auth_key(
  email = Sys.getenv("GARGLE_EMAIL"),
  file = "googleauthr-auth-key.json",
  session_user = NULL,
  client_json = "GAR_CLIENT_JSON",
  roles = NULL,
  default_key = "googleauthr"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_setup_auth_key_+3A_email">email</code></td>
<td>
<p>What email to open OAuth2 with</p>
</td></tr>
<tr><td><code id="gar_setup_auth_key_+3A_file">file</code></td>
<td>
<p>Where to save the authentication file</p>
</td></tr>
<tr><td><code id="gar_setup_auth_key_+3A_session_user">session_user</code></td>
<td>
<p>1 for user level, 2 for project level, leave <code>NULL</code> to be prompted</p>
</td></tr>
<tr><td><code id="gar_setup_auth_key_+3A_client_json">client_json</code></td>
<td>
<p>The location of the env arg holding client json</p>
</td></tr>
<tr><td><code id="gar_setup_auth_key_+3A_roles">roles</code></td>
<td>
<p>Whether to assign roles to the service key</p>
</td></tr>
<tr><td><code id="gar_setup_auth_key_+3A_default_key">default_key</code></td>
<td>
<p>The default name of the service key</p>
</td></tr>
</table>


<h3>Value</h3>

<p>TRUE if the file is ready to be setup, FALSE if need to stop
</p>


<h3>See Also</h3>

<p>Other setup functions: 
<code><a href="#topic+gar_setup_auth_check">gar_setup_auth_check</a>()</code>,
<code><a href="#topic+gar_setup_clientid">gar_setup_clientid</a>()</code>,
<code><a href="#topic+gar_setup_edit_renviron">gar_setup_edit_renviron</a>()</code>,
<code><a href="#topic+gar_setup_env_check">gar_setup_env_check</a>()</code>,
<code><a href="#topic+gar_setup_menu">gar_setup_menu</a>()</code>,
<code><a href="#topic+gar_setup_menu_do">gar_setup_menu_do</a>()</code>
</p>

<hr>
<h2 id='gar_setup_clientid'>Check for a client JSON</h2><span id='topic+gar_setup_clientid'></span>

<h3>Description</h3>

<p>Check for a client JSON
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_setup_clientid(session_user = NULL, client_json = "GAR_CLIENT_JSON")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_setup_clientid_+3A_session_user">session_user</code></td>
<td>
<p>1 for user level, 2 for project level, leave <code>NULL</code> to be prompted</p>
</td></tr>
<tr><td><code id="gar_setup_clientid_+3A_client_json">client_json</code></td>
<td>
<p>The environment argument to be used for client_id/secret</p>
</td></tr>
</table>


<h3>Value</h3>

<p>TRUE is client_id is ready, FALSE if it is not
</p>


<h3>See Also</h3>

<p>Other setup functions: 
<code><a href="#topic+gar_setup_auth_check">gar_setup_auth_check</a>()</code>,
<code><a href="#topic+gar_setup_auth_key">gar_setup_auth_key</a>()</code>,
<code><a href="#topic+gar_setup_edit_renviron">gar_setup_edit_renviron</a>()</code>,
<code><a href="#topic+gar_setup_env_check">gar_setup_env_check</a>()</code>,
<code><a href="#topic+gar_setup_menu">gar_setup_menu</a>()</code>,
<code><a href="#topic+gar_setup_menu_do">gar_setup_menu_do</a>()</code>
</p>

<hr>
<h2 id='gar_setup_edit_renviron'>Setup wizard help - asking users to edit .Renviron</h2><span id='topic+gar_setup_edit_renviron'></span><span id='topic+gar_setup_check_session'></span>

<h3>Description</h3>

<p>Setup wizard help - asking users to edit .Renviron
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_setup_edit_renviron(to_paste, session_user)

gar_setup_check_session(session_user = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_setup_edit_renviron_+3A_to_paste">to_paste</code></td>
<td>
<p>The line to paste into .Renviron</p>
</td></tr>
<tr><td><code id="gar_setup_edit_renviron_+3A_session_user">session_user</code></td>
<td>
<p>whether its a 1 = user level or 2=project level .Renviron file
</p>
<p>Intended to get user input from a menu, 1 indicating user level, 2 project level
</p>
<p><a href="#topic+gar_setup_check_session">gar_setup_check_session</a> creates a menu for the user to choose which</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other setup functions: 
<code><a href="#topic+gar_setup_auth_check">gar_setup_auth_check</a>()</code>,
<code><a href="#topic+gar_setup_auth_key">gar_setup_auth_key</a>()</code>,
<code><a href="#topic+gar_setup_clientid">gar_setup_clientid</a>()</code>,
<code><a href="#topic+gar_setup_env_check">gar_setup_env_check</a>()</code>,
<code><a href="#topic+gar_setup_menu">gar_setup_menu</a>()</code>,
<code><a href="#topic+gar_setup_menu_do">gar_setup_menu_do</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 

choice &lt;- gar_setup_check_session()
gar_setup_edit_renviron("ENV_ARG=blah", session_user = choice)


## End(Not run)
</code></pre>

<hr>
<h2 id='gar_setup_env_check'>Setup wizard help - check if environment argument is set</h2><span id='topic+gar_setup_env_check'></span>

<h3>Description</h3>

<p>Setup wizard help - check if environment argument is set
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_setup_env_check(env_arg, set_to, edit_option = FALSE, session_user)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_setup_env_check_+3A_env_arg">env_arg</code></td>
<td>
<p>The environment argument to check</p>
</td></tr>
<tr><td><code id="gar_setup_env_check_+3A_set_to">set_to</code></td>
<td>
<p>NULL or a string to set in .Renviron</p>
</td></tr>
<tr><td><code id="gar_setup_env_check_+3A_edit_option">edit_option</code></td>
<td>
<p>Pass edit_option = FALSE to edit an existing environment arg</p>
</td></tr>
<tr><td><code id="gar_setup_env_check_+3A_session_user">session_user</code></td>
<td>
<p>1=user, 2=project scope of .Renviron</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Pass edit_option = FALSE to edit an existing environment arg, TRUE will 
check if it exists, and will pass if its present.
</p>


<h3>Value</h3>

<p>TRUE once changes made
</p>


<h3>See Also</h3>

<p>Other setup functions: 
<code><a href="#topic+gar_setup_auth_check">gar_setup_auth_check</a>()</code>,
<code><a href="#topic+gar_setup_auth_key">gar_setup_auth_key</a>()</code>,
<code><a href="#topic+gar_setup_clientid">gar_setup_clientid</a>()</code>,
<code><a href="#topic+gar_setup_edit_renviron">gar_setup_edit_renviron</a>()</code>,
<code><a href="#topic+gar_setup_menu">gar_setup_menu</a>()</code>,
<code><a href="#topic+gar_setup_menu_do">gar_setup_menu_do</a>()</code>
</p>

<hr>
<h2 id='gar_setup_get_authenv'>Setup wizard helper - add authentication file to .Renviron</h2><span id='topic+gar_setup_get_authenv'></span>

<h3>Description</h3>

<p>Setup wizard helper - add authentication file to .Renviron
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_setup_get_authenv(env_arg = "GCE_AUTH_FILE", ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_setup_get_authenv_+3A_env_arg">env_arg</code></td>
<td>
<p>The environment argument to set</p>
</td></tr>
<tr><td><code id="gar_setup_get_authenv_+3A_...">...</code></td>
<td>
<p>Other arguments passed to <a href="#topic+gar_setup_auth_key">gar_setup_auth_key</a></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A string to paste into an .Renviron, or NULL
</p>

<hr>
<h2 id='gar_setup_menu'>Setup wizard - introduction helper</h2><span id='topic+gar_setup_menu'></span>

<h3>Description</h3>

<p>Salutation and initial menu
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_setup_menu(choices, package_name = "googleAuthR")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_setup_menu_+3A_choices">choices</code></td>
<td>
<p>A character vector of the choices passed to <a href="utils.html#topic+menu">menu</a></p>
</td></tr>
<tr><td><code id="gar_setup_menu_+3A_package_name">package_name</code></td>
<td>
<p>The package the setup menu is for</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The number option from the menu
</p>


<h3>See Also</h3>

<p>Other setup functions: 
<code><a href="#topic+gar_setup_auth_check">gar_setup_auth_check</a>()</code>,
<code><a href="#topic+gar_setup_auth_key">gar_setup_auth_key</a>()</code>,
<code><a href="#topic+gar_setup_clientid">gar_setup_clientid</a>()</code>,
<code><a href="#topic+gar_setup_edit_renviron">gar_setup_edit_renviron</a>()</code>,
<code><a href="#topic+gar_setup_env_check">gar_setup_env_check</a>()</code>,
<code><a href="#topic+gar_setup_menu_do">gar_setup_menu_do</a>()</code>
</p>

<hr>
<h2 id='gar_setup_menu_do'>Setup wizard help - the functions that will execute on different menu options</h2><span id='topic+gar_setup_menu_do'></span>

<h3>Description</h3>

<p>Setup wizard help - the functions that will execute on different menu options
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_setup_menu_do(menu_option, trigger, do_function, stop = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_setup_menu_do_+3A_menu_option">menu_option</code></td>
<td>
<p>The menu option chosen from <a href="utils.html#topic+menu">menu</a> or <a href="#topic+gar_setup_menu">gar_setup_menu</a></p>
</td></tr>
<tr><td><code id="gar_setup_menu_do_+3A_trigger">trigger</code></td>
<td>
<p>What option will trigger the <code>do_function</code></p>
</td></tr>
<tr><td><code id="gar_setup_menu_do_+3A_do_function">do_function</code></td>
<td>
<p>The function in the same order as the menu options</p>
</td></tr>
<tr><td><code id="gar_setup_menu_do_+3A_stop">stop</code></td>
<td>
<p>Whether to stop and exit if the function comes back FALSE</p>
</td></tr>
<tr><td><code id="gar_setup_menu_do_+3A_...">...</code></td>
<td>
<p>arguments passed to <code>do_function</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>The functions should come back with TRUE or FALSE depending on if the setting was successful.
</p>


<h3>Value</h3>

<p>FALSE if setting was not set, TRUE if it was
</p>


<h3>See Also</h3>

<p>Other setup functions: 
<code><a href="#topic+gar_setup_auth_check">gar_setup_auth_check</a>()</code>,
<code><a href="#topic+gar_setup_auth_key">gar_setup_auth_key</a>()</code>,
<code><a href="#topic+gar_setup_clientid">gar_setup_clientid</a>()</code>,
<code><a href="#topic+gar_setup_edit_renviron">gar_setup_edit_renviron</a>()</code>,
<code><a href="#topic+gar_setup_env_check">gar_setup_env_check</a>()</code>,
<code><a href="#topic+gar_setup_menu">gar_setup_menu</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 

op &lt;- gar_setup_menu(c("Check all settings",
                       "Configure authentication",
                       "Configure env arg 1",
                       "Configure env arg 2",
                       "Configure something else"
                       ),
                       package_name = "googleAuthR")
                       
choice &lt;- gar_setup_check_session()

custom_env_check_f &lt;- function(choice){
  r &lt;- readline("project-id:")
  gar_setup_env_check("ARG2", 
                      set_to = r, 
                      edit_option = choice == 1, #allow editing of env arg
                      session_user = choice)
  TRUE
}

gar_setup_menu_do(op, c(1,2), my_setup_auth_f, stop = TRUE)
gar_setup_menu_do(op, c(1,3), gar_setup_env_check, 
                  env_arg = "ARG1", set_to = "BLAH", 
                  edit_option = choice == 1, #allow editing of env arg
                  session_user = choice)
gar_setup_menu_do(op, c(1,4), custom_env_check_f)
gar_setup_menu_do(op, c(1,4), my_setup_something_f)


## End(Not run)
</code></pre>

<hr>
<h2 id='gar_shiny_auth'>Create Authentication within Shiny's server.R</h2><span id='topic+gar_shiny_auth'></span>

<h3>Description</h3>

<p>This can be used at the top of the server function for authentication when you have used
<a href="#topic+gar_shiny_ui">gar_shiny_ui</a> to create a login page for your ui function.
</p>
<p>In some platforms the URL you are authenticating from will not match the Docker container the script is running in (e.g. shinyapps.io or a kubernetes cluster) - in that case you can manually set it via 'options(googleAuthR.redirect = http://your-shiny-url').  In other circumstances the Shiny app should be able to detect this itself.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_shiny_auth(session)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_shiny_auth_+3A_session">session</code></td>
<td>
<p>Shiny session argument</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If using  <a href="#topic+gar_shiny_ui">gar_shiny_ui</a>, put this at the top of your server.R function
</p>


<h3>Author(s)</h3>

<p>Based on a gist by Joe Cheng, RStudio
</p>


<h3>See Also</h3>

<p>Other pre-load shiny authentication: 
<code><a href="#topic+gar_shiny_auth_url">gar_shiny_auth_url</a>()</code>,
<code><a href="#topic+gar_shiny_login_ui">gar_shiny_login_ui</a>()</code>,
<code><a href="#topic+gar_shiny_ui">gar_shiny_ui</a>()</code>,
<code><a href="#topic+silent_auth">silent_auth</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
library(shiny)
library(googleAuthR)
gar_set_client()

fileSearch &lt;- function(query) {
  googleAuthR::gar_api_generator("https://www.googleapis.com/drive/v3/files/",
                                "GET",
                                pars_args=list(q=query),
                                data_parse_function = function(x) x$files)()
}

## ui.R
ui &lt;- fluidPage(title = "googleAuthR Shiny Demo",
                textInput("query", 
                label = "Google Drive query", 
                value = "mimeType != 'application/vnd.google-apps.folder'"),
                tableOutput("gdrive")
                )
                
## server.R
server &lt;- function(input, output, session){

# this is not reactive, no need as you only reach here authenticated
gar_shiny_auth(session)

output$gdrive &lt;- renderTable({
  req(input$query)
  
  # no need for with_shiny()
  fileSearch(input$query)
  
  })
  }

# gar_shiny_ui() needs to wrap the ui you have created above.
shinyApp(gar_shiny_ui(ui), server)

## End(Not run)
</code></pre>

<hr>
<h2 id='gar_shiny_auth_url'>Make a Google Authorisation URL for Shiny</h2><span id='topic+gar_shiny_auth_url'></span>

<h3>Description</h3>

<p>Set this within your login_ui where you need the Google login.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_shiny_auth_url(
  req,
  state = getOption("googleAuthR.securitycode"),
  client.id = getOption("googleAuthR.webapp.client_id"),
  client.secret = getOption("googleAuthR.webapp.client_secret"),
  scope = getOption("googleAuthR.scopes.selected"),
  access_type = c("online", "offline"),
  prompt = c("consent", "select_account", "both", "none")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_shiny_auth_url_+3A_req">req</code></td>
<td>
<p>a Rook request, do not set as this will be used by Shiny to generate URL</p>
</td></tr>
<tr><td><code id="gar_shiny_auth_url_+3A_state">state</code></td>
<td>
<p>URL state</p>
</td></tr>
<tr><td><code id="gar_shiny_auth_url_+3A_client.id">client.id</code></td>
<td>
<p>client.id</p>
</td></tr>
<tr><td><code id="gar_shiny_auth_url_+3A_client.secret">client.secret</code></td>
<td>
<p>client.secret</p>
</td></tr>
<tr><td><code id="gar_shiny_auth_url_+3A_scope">scope</code></td>
<td>
<p>API scopes</p>
</td></tr>
<tr><td><code id="gar_shiny_auth_url_+3A_access_type">access_type</code></td>
<td>
<p>whether to keep the token</p>
</td></tr>
<tr><td><code id="gar_shiny_auth_url_+3A_prompt">prompt</code></td>
<td>
<p>Auto-login if user is recognised or always force signin</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other pre-load shiny authentication: 
<code><a href="#topic+gar_shiny_auth">gar_shiny_auth</a>()</code>,
<code><a href="#topic+gar_shiny_login_ui">gar_shiny_login_ui</a>()</code>,
<code><a href="#topic+gar_shiny_ui">gar_shiny_ui</a>()</code>,
<code><a href="#topic+silent_auth">silent_auth</a>()</code>
</p>

<hr>
<h2 id='gar_shiny_login_ui'>A login page for Shiny</h2><span id='topic+gar_shiny_login_ui'></span>

<h3>Description</h3>

<p>An alternative to the immediate login provided by default by <a href="#topic+gar_shiny_ui">gar_shiny_ui</a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_shiny_login_ui(req, title = "googleAuthR Login Demo")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_shiny_login_ui_+3A_req">req</code></td>
<td>
<p>Passed to <a href="#topic+gar_shiny_auth_url">gar_shiny_auth_url</a> to generate login URL</p>
</td></tr>
<tr><td><code id="gar_shiny_login_ui_+3A_title">title</code></td>
<td>
<p>The title of the page</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Use <a href="#topic+gar_shiny_auth_url">gar_shiny_auth_url</a> to create the login URL.  You must leave the first argument free as this is used to generate the login, but you can pass other arguments to customise your UI.
</p>


<h3>See Also</h3>

<p>Other pre-load shiny authentication: 
<code><a href="#topic+gar_shiny_auth">gar_shiny_auth</a>()</code>,
<code><a href="#topic+gar_shiny_auth_url">gar_shiny_auth_url</a>()</code>,
<code><a href="#topic+gar_shiny_ui">gar_shiny_ui</a>()</code>,
<code><a href="#topic+silent_auth">silent_auth</a>()</code>
</p>

<hr>
<h2 id='gar_shiny_ui'>Create a Google login before your Shiny UI launches</h2><span id='topic+gar_shiny_ui'></span>

<h3>Description</h3>

<p>A function that will turn your ui object into one that will look for Google 
authentication before loading the main app. Use together with <a href="#topic+gar_shiny_auth">gar_shiny_auth</a>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_shiny_ui(ui, login_ui = silent_auth)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_shiny_ui_+3A_ui">ui</code></td>
<td>
<p>A Shiny ui object</p>
</td></tr>
<tr><td><code id="gar_shiny_ui_+3A_login_ui">login_ui</code></td>
<td>
<p>A UI or HTML template that is seen before the main app and contains a login in link generated by <a href="#topic+gar_shiny_auth_url">gar_shiny_auth_url</a></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Put this at the bottom of your ui.R or pass into <a href="shiny.html#topic+shinyApp">shinyApp</a> wrapping your created ui.
</p>


<h3>Author(s)</h3>

<p>Based on <a href="https://gist.github.com/jcheng5/44bd750764713b5a1df7d9daf5538aea">this gist</a> by Joe Cheng, RStudio
</p>


<h3>See Also</h3>

<p>Other pre-load shiny authentication: 
<code><a href="#topic+gar_shiny_auth">gar_shiny_auth</a>()</code>,
<code><a href="#topic+gar_shiny_auth_url">gar_shiny_auth_url</a>()</code>,
<code><a href="#topic+gar_shiny_login_ui">gar_shiny_login_ui</a>()</code>,
<code><a href="#topic+silent_auth">silent_auth</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
## Not run: 
library(shiny)
library(googleAuthR)
gar_set_client()

fileSearch &lt;- function(query) {
  googleAuthR::gar_api_generator("https://www.googleapis.com/drive/v3/files/",
                                "GET",
                                pars_args=list(q=query),
                                data_parse_function = function(x) x$files)()
}

## ui.R
ui &lt;- fluidPage(title = "googleAuthR Shiny Demo",
                textInput("query", 
                label = "Google Drive query", 
                value = "mimeType != 'application/vnd.google-apps.folder'"),
                tableOutput("gdrive")
                )
                
## server.R
server &lt;- function(input, output, session){

# this is not reactive, no need as you only reach here authenticated
gar_shiny_auth(session)

output$gdrive &lt;- renderTable({
  req(input$query)
  
  # no need for with_shiny()
  fileSearch(input$query)
  
  })
  }

# gar_shiny_ui() needs to wrap the ui you have created above.
shinyApp(gar_shiny_ui(ui), server)

## End(Not run)
</code></pre>

<hr>
<h2 id='gar_token'>Produce configured token</h2><span id='topic+gar_token'></span>

<h3>Description</h3>

<p>For internal use or for those programming around the Google API.
Returns a token pre-processed with [httr::config()]. Most users
do not need to handle tokens &quot;by hand&quot; or, even if they need some
control, [gar_auth()] is what they need. If there is no current
token, [gar_auth()] is called to either load from cache or
initiate OAuth2.0 flow.
If auth has been deactivated via [gar_deauth()], 'gar_token()'
returns 'NULL'.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_token()
</code></pre>


<h3>Value</h3>

<p>A 'request' object (an S3 class provided by [httr][httr::httr]).
</p>


<h3>See Also</h3>

<p>Other low-level API functions: 
<code><a href="#topic+gar_has_token">gar_has_token</a>()</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
req &lt;- request_generate(
  "drive.files.get",
  list(fileId = "abc"),
  token = gar_token()
)
req

## End(Not run)
</code></pre>

<hr>
<h2 id='gar_token_info'>Get current token summary</h2><span id='topic+gar_token_info'></span>

<h3>Description</h3>

<p>Get details on the current active auth token to help debug issues
</p>


<h3>Usage</h3>

<pre><code class='language-R'>gar_token_info(detail_level = getOption("googleAuthR.verbose", default = 3))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gar_token_info_+3A_detail_level">detail_level</code></td>
<td>
<p>How much info to show</p>
</td></tr>
</table>

<hr>
<h2 id='get_google_token'>Retrieve Google token from environment and configs for httr</h2><span id='topic+get_google_token'></span>

<h3>Description</h3>

<p>Get token if it's previously stored, else prompt user to get one.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>get_google_token()
</code></pre>


<h3>Value</h3>

<p>a httr configured option for token
For shiny the token is passed from reactive session
</p>


<h3>See Also</h3>

<p>Other authentication functions: 
<code><a href="#topic+gar_attach_auto_auth">gar_attach_auto_auth</a>()</code>,
<code><a href="#topic+gar_auth">gar_auth</a>()</code>,
<code><a href="#topic+gar_auth_service">gar_auth_service</a>()</code>,
<code><a href="#topic+gar_auto_auth">gar_auto_auth</a>()</code>,
<code><a href="#topic+gar_gce_auth">gar_gce_auth</a>()</code>,
<code><a href="#topic+should_skip_token_checks">should_skip_token_checks</a>()</code>,
<code><a href="#topic+token_exists">token_exists</a>()</code>
</p>

<hr>
<h2 id='googleSignIn'>Google SignIn [Server Module]</h2><span id='topic+googleSignIn'></span>

<h3>Description</h3>

<p>Shiny Module for use with <a href="#topic+googleSignInUI">googleSignInUI</a>.  
Use when you don't need to call APIs, but would like a login to Shiny.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>googleSignIn(input, output, session)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="googleSignIn_+3A_input">input</code></td>
<td>
<p>shiny input (must contain <code>g_id</code>, <code>g_name</code>,
<code>g_email</code>, <code>g_image</code>, <code>g_signed_in</code>)</p>
</td></tr>
<tr><td><code id="googleSignIn_+3A_output">output</code></td>
<td>
<p>shiny output (passed by shiny but not used)</p>
</td></tr>
<tr><td><code id="googleSignIn_+3A_session">session</code></td>
<td>
<p>shiny session</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Call via <code>shiny::callModule(googleSignIn, "your_id")</code>.
</p>


<h3>Value</h3>

<p>A reactive list with values <code>$id</code>, <code>$name</code>, <code>$email</code>,
<code>$image</code> and <code>$signed_in</code>.
</p>


<h3>Author(s)</h3>

<p>Based on original code by David Kulp
</p>

<hr>
<h2 id='googleSignInUI'>Google SignIn [UI Module]</h2><span id='topic+googleSignInUI'></span>

<h3>Description</h3>

<p>Shiny Module for use with <a href="#topic+googleSignIn">googleSignIn</a>. 
If you just want a login to a Shiny app, without API tokens.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>googleSignInUI(id, logout_name = "Sign Out", logout_class = "btn-danger")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="googleSignInUI_+3A_id">id</code></td>
<td>
<p>Shiny id.</p>
</td></tr>
<tr><td><code id="googleSignInUI_+3A_logout_name">logout_name</code></td>
<td>
<p>Character. Custom name of the logout button.</p>
</td></tr>
<tr><td><code id="googleSignInUI_+3A_logout_class">logout_class</code></td>
<td>
<p>Character. Bootstrap class name for buttons, e.g. &quot;btn-info&quot;, &quot;btn-dark&quot;.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Shiny UI
</p>


<h3>Author(s)</h3>

<p>Based on original code by David Kulp
</p>


<h3>See Also</h3>

<p><a href="https://github.com/dkulp2/Google-Sign-In">https://github.com/dkulp2/Google-Sign-In</a>
</p>

<hr>
<h2 id='retryRequest'>ReTry API requests for certain errors using exponential backoff.</h2><span id='topic+retryRequest'></span>

<h3>Description</h3>

<p>ReTry API requests for certain errors using exponential backoff.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>retryRequest(f)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="retryRequest_+3A_f">f</code></td>
<td>
<p>A function of a http request</p>
</td></tr>
</table>

<hr>
<h2 id='should_skip_token_checks'>Determines whether token presence and validity checks should be skipped.</h2><span id='topic+should_skip_token_checks'></span>

<h3>Description</h3>

<p>Skipping checks is useful in certain special cases, such as testing. Tests
might rely on mocked API responses or fake API implementations, which don't
require a valid token. It wouldn't make sense to demand a valid token in that
context.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>should_skip_token_checks()
</code></pre>


<h3>Details</h3>

<p><code>googleAuthR</code> uses this function to know when the execution context is
such that token checks should be skipped. This is ultimately determined by
the value of the <code>googleAuthR.skip_token_checks</code> boolean option. Users
or consumer libraries can set this option to signal that authentication is
not needed.
</p>
<p>In addition, this function detects the use of <code>httptest::with_mock_API</code>
and skips token checks in that case as well.
</p>


<h3>Value</h3>

<p>boolean
</p>


<h3>See Also</h3>

<p>Other authentication functions: 
<code><a href="#topic+gar_attach_auto_auth">gar_attach_auto_auth</a>()</code>,
<code><a href="#topic+gar_auth">gar_auth</a>()</code>,
<code><a href="#topic+gar_auth_service">gar_auth_service</a>()</code>,
<code><a href="#topic+gar_auto_auth">gar_auto_auth</a>()</code>,
<code><a href="#topic+gar_gce_auth">gar_gce_auth</a>()</code>,
<code><a href="#topic+get_google_token">get_google_token</a>()</code>,
<code><a href="#topic+token_exists">token_exists</a>()</code>
</p>

<hr>
<h2 id='silent_auth'>Silent auth</h2><span id='topic+silent_auth'></span>

<h3>Description</h3>

<p>The default for logging in via <a href="#topic+gar_shiny_ui">gar_shiny_ui</a>, this creates no login page and just takes you straight to authentication on Shiny app load.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>silent_auth(req)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="silent_auth_+3A_req">req</code></td>
<td>
<p>What Shiny uses to check the URL parameters</p>
</td></tr>
</table>


<h3>See Also</h3>

<p>Other pre-load shiny authentication: 
<code><a href="#topic+gar_shiny_auth">gar_shiny_auth</a>()</code>,
<code><a href="#topic+gar_shiny_auth_url">gar_shiny_auth_url</a>()</code>,
<code><a href="#topic+gar_shiny_login_ui">gar_shiny_login_ui</a>()</code>,
<code><a href="#topic+gar_shiny_ui">gar_shiny_ui</a>()</code>
</p>

<hr>
<h2 id='skip_if_no_env_auth'>Skip test if not authenticated</h2><span id='topic+skip_if_no_env_auth'></span>

<h3>Description</h3>

<p>Use within tests to skip if a local authentication file isn't available through an environment variable.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>skip_if_no_env_auth(env_arg)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="skip_if_no_env_auth_+3A_env_arg">env_arg</code></td>
<td>
<p>The name of the environment argument pointing to the auth file</p>
</td></tr>
</table>

<hr>
<h2 id='token_exists'>Check if authorization currently in force</h2><span id='topic+token_exists'></span>

<h3>Description</h3>

<p>Check if authorization currently in force
</p>


<h3>Usage</h3>

<pre><code class='language-R'>token_exists()
</code></pre>


<h3>Value</h3>

<p>logical
</p>


<h3>See Also</h3>

<p>Other authentication functions: 
<code><a href="#topic+gar_attach_auto_auth">gar_attach_auto_auth</a>()</code>,
<code><a href="#topic+gar_auth">gar_auth</a>()</code>,
<code><a href="#topic+gar_auth_service">gar_auth_service</a>()</code>,
<code><a href="#topic+gar_auto_auth">gar_auto_auth</a>()</code>,
<code><a href="#topic+gar_gce_auth">gar_gce_auth</a>()</code>,
<code><a href="#topic+get_google_token">get_google_token</a>()</code>,
<code><a href="#topic+should_skip_token_checks">should_skip_token_checks</a>()</code>
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
