<!DOCTYPE html><html lang="en"><head><title>Help for package babelwhale</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {babelwhale}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#babelwhale'><p>Talking to both Docker and Singularity containers from R</p></a></li>
<li><a href='#copy_file'><p>Copy a file from a container to the host system</p></a></li>
<li><a href='#create_config'><p>Backend configuration for containerisation</p></a></li>
<li><a href='#list_docker_images'><p>List docker containers</p></a></li>
<li><a href='#pull_container'><p>Pull a container from dockerhub</p></a></li>
<li><a href='#read_file'><p>Read a file from a container</p></a></li>
<li><a href='#run'><p>Run a containerised command, and wait until finished</p></a></li>
<li><a href='#run_auto_mount'><p>Run a containerised command with automatic mounting of files</p></a></li>
<li><a href='#singularity_image_path'><p>Determine the cached path of singularity images</p></a></li>
<li><a href='#test_docker_installation'><p>Tests whether docker is correctly installed and available</p></a></li>
<li><a href='#test_singularity_installation'><p>Tests whether singularity is correctly installed and available</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Talking to 'Docker' and 'Singularity' Containers</td>
</tr>
<tr>
<td>Version:</td>
<td>1.2.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Provides a unified interface to interact with
    'docker' and 'singularity' containers.  You can execute a command
    inside a container, mount a volume or copy a file.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/dynverse/babelwhale">https://github.com/dynverse/babelwhale</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/dynverse/babelwhale/issues">https://github.com/dynverse/babelwhale/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>crayon, dplyr, fs, dynutils, processx (&ge; 3.5.0), purrr,
utils, digest, glue</td>
</tr>
<tr>
<td>Suggests:</td>
<td>covr, testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>SystemRequirements:</td>
<td>Docker and/or Singularity (&gt;=3.0)</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-07-14 19:28:23 UTC; rcannood</td>
</tr>
<tr>
<td>Author:</td>
<td>Robrecht Cannoodt <a href="https://orcid.org/0000-0003-3641-729X"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre] (github: rcannood),
  Wouter Saelens <a href="https://orcid.org/0000-0002-7114-6248"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut] (github: zouter),
  Joel Nitta <a href="https://orcid.org/0000-0003-4719-7472"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut]
    (github: joelnitta)</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Robrecht Cannoodt &lt;rcannood@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-07-14 22:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='babelwhale'>Talking to both Docker and Singularity containers from R</h2><span id='topic+babelwhale'></span>

<h3>Description</h3>

<p>Provides a unified interface to interact with
docker' and 'singularity' containers.  You can execute a command
inside a container, mount a volume or copy a file.
</p>

<hr>
<h2 id='copy_file'>Copy a file from a container to the host system</h2><span id='topic+copy_file'></span>

<h3>Description</h3>

<p>Copy a file from a container to the host system
</p>


<h3>Usage</h3>

<pre><code class='language-R'>copy_file(container_id, path_container, path_local)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="copy_file_+3A_container_id">container_id</code></td>
<td>
<p>The name of the container, usually the repository name on dockerhub.</p>
</td></tr>
<tr><td><code id="copy_file_+3A_path_container">path_container</code></td>
<td>
<p>The path of the file inside the container</p>
</td></tr>
<tr><td><code id="copy_file_+3A_path_local">path_local</code></td>
<td>
<p>The path of the file on the host system</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>if (test_docker_installation()) {
  set_default_config(create_docker_config(), permanent = FALSE)
  copy_file("alpine", "/bin/date", tempfile())
}
</code></pre>

<hr>
<h2 id='create_config'>Backend configuration for containerisation</h2><span id='topic+create_config'></span><span id='topic+create_docker_config'></span><span id='topic+create_singularity_config'></span><span id='topic+get_default_config'></span><span id='topic+set_default_config'></span>

<h3>Description</h3>

<p>It is advised to define the <code>"BABELWHALE_BACKEND"</code> environment variable as <code>"docker"</code> or <code>"singularity"</code>.
</p>
<p>When using singularity, also define the <code>"SINGULARITY_CACHEDIR"</code> environment variable,
which is the folder where the singularity images will be cached.
</p>
<p>When using apptainer, also define the <code>"APPTAINER_CACHEDIR"</code> environment variable,
which is the folder where the singularity images will be cached.
</p>
<p>Each TI method will require about 1GB of space.
</p>
<p>Alternatively, you can create a config and save it using <code>set_default_config()</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>create_config(
  backend = get_env_or_null("BABELWHALE_BACKEND") %||% detect_backend()
)

create_docker_config(environment_variables = character(0))

create_singularity_config(
  cache_dir = get_env_or_null("SINGULARITY_CACHEDIR") %||%
    get_env_or_null("APPTAINER_CACHEDIR") %||% ".singularity/",
  environment_variables = character(0)
)

get_default_config()

set_default_config(config, permanent = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="create_config_+3A_backend">backend</code></td>
<td>
<p>Which backend to use. Can be either <code>"docker"</code> or <code>"singularity"</code>.</p>
</td></tr>
<tr><td><code id="create_config_+3A_environment_variables">environment_variables</code></td>
<td>
<p>A character vector of environment variables. Format: <code>c("ENVVAR=VALUE")</code>.</p>
</td></tr>
<tr><td><code id="create_config_+3A_cache_dir">cache_dir</code></td>
<td>
<p>A folder in which to store the singularity images. A container typically requires 100MB to 2GB.</p>
</td></tr>
<tr><td><code id="create_config_+3A_config">config</code></td>
<td>
<p>A config to save as default.</p>
</td></tr>
<tr><td><code id="create_config_+3A_permanent">permanent</code></td>
<td>
<p>Whether or not to save the config file permanently</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>config &lt;- create_docker_config()
set_default_config(config, permanent = FALSE)

config &lt;- create_singularity_config(
  # ideally, this would be set to a non-temporary directory
  cache_dir = tempdir()
)
set_default_config(config, permanent = FALSE)

</code></pre>

<hr>
<h2 id='list_docker_images'>List docker containers</h2><span id='topic+list_docker_images'></span>

<h3>Description</h3>

<p>List docker containers
</p>


<h3>Usage</h3>

<pre><code class='language-R'>list_docker_images(container_id = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="list_docker_images_+3A_container_id">container_id</code></td>
<td>
<p>An optional container id</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>if (test_docker_installation()) {
  set_default_config(create_docker_config(), permanent = FALSE)
  list_docker_images()
}
</code></pre>

<hr>
<h2 id='pull_container'>Pull a container from dockerhub</h2><span id='topic+pull_container'></span>

<h3>Description</h3>

<p>Pull a container from dockerhub
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pull_container(container_id)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="pull_container_+3A_container_id">container_id</code></td>
<td>
<p>The name of the container, usually the repository name on dockerhub.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>if (test_docker_installation()) {
  pull_container("alpine")
}
</code></pre>

<hr>
<h2 id='read_file'>Read a file from a container</h2><span id='topic+read_file'></span>

<h3>Description</h3>

<p>Read a file from a container
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_file(container_id, path_container)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="read_file_+3A_container_id">container_id</code></td>
<td>
<p>The name of the container, usually the repository name on dockerhub.</p>
</td></tr>
<tr><td><code id="read_file_+3A_path_container">path_container</code></td>
<td>
<p>The path of the file inside the container</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>if (test_docker_installation()) {
  set_default_config(create_docker_config(), permanent = FALSE)
  read_file("alpine", "/etc/hosts")
}

</code></pre>

<hr>
<h2 id='run'>Run a containerised command, and wait until finished</h2><span id='topic+run'></span>

<h3>Description</h3>

<p>Run a containerised command, and wait until finished
</p>


<h3>Usage</h3>

<pre><code class='language-R'>run(
  container_id,
  command,
  args = NULL,
  volumes = NULL,
  workspace = NULL,
  environment_variables = NULL,
  debug = FALSE,
  verbose = FALSE,
  stdout = "|",
  stderr = "|"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="run_+3A_container_id">container_id</code></td>
<td>
<p>The name of the container, usually the repository name on dockerhub.</p>
</td></tr>
<tr><td><code id="run_+3A_command">command</code></td>
<td>
<p>Character scalar, the command to run. If you are
running <code>.bat</code> or <code>.cmd</code> files on Windows, make sure you read the
'Batch files' section in the <a href="processx.html#topic+process">process</a> manual page.</p>
</td></tr>
<tr><td><code id="run_+3A_args">args</code></td>
<td>
<p>Character vector, arguments to the command.</p>
</td></tr>
<tr><td><code id="run_+3A_volumes">volumes</code></td>
<td>
<p>Which volumes to be mounted. Format: a character vector, with each element containing the source path and container path concatenated with a &quot;:&quot;. For example: <code>c("/source_folder:/container_folder")</code>.</p>
</td></tr>
<tr><td><code id="run_+3A_workspace">workspace</code></td>
<td>
<p>Which working directory to run the command in.</p>
</td></tr>
<tr><td><code id="run_+3A_environment_variables">environment_variables</code></td>
<td>
<p>A character vector of environment variables. Format: <code>c("ENVVAR=VALUE")</code>.</p>
</td></tr>
<tr><td><code id="run_+3A_debug">debug</code></td>
<td>
<p>If <code>TRUE</code>, a command will be printed that the user can execute to enter the container.</p>
</td></tr>
<tr><td><code id="run_+3A_verbose">verbose</code></td>
<td>
<p>Whether or not to print output</p>
</td></tr>
<tr><td><code id="run_+3A_stdout">stdout</code></td>
<td>
<p>What to do with standard output of the command. Default (<code>"|"</code>) means to include it as an item in the results list.
If it is the empty string (<code>""</code>), then the child process inherits the standard output stream of the R process.
If it is a string other than <code>"|"</code> and <code>""</code>, then it is taken as a file name and the output is redirected to this file.</p>
</td></tr>
<tr><td><code id="run_+3A_stderr">stderr</code></td>
<td>
<p>What to do with standard error of the command. Default (&quot;|&quot;) means to include it as an item in the results list.
If it is the empty string (<code>""</code>), then the child process inherits the standard error stream of the R process.
If it is a string other than <code>"|"</code> and <code>""</code>, then it is taken as a file name and the standard error is redirected to this file.</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>if (test_docker_installation()) {
  set_default_config(create_docker_config(), permanent = FALSE)

  # running a command
  run("alpine", "echo", c("hello"))

  # mounting a folder
  folder &lt;- tempdir()
  write("i'm a mounted file", paste0(folder, "/file.txt"))
  run("alpine", "cat", c("/mounted_folder/file.txt"), volumes = paste0(folder, "/:/mounted_folder"))
}

</code></pre>

<hr>
<h2 id='run_auto_mount'>Run a containerised command with automatic mounting of files</h2><span id='topic+run_auto_mount'></span>

<h3>Description</h3>

<p>Similar to <code><a href="#topic+run">run()</a></code>, but automatically mounts files (and directories) so the
user doesn't have to keep track of volumes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>run_auto_mount(
  container_id,
  command,
  args = NULL,
  wd = NULL,
  wd_in_container = NULL,
  environment_variables = NULL,
  debug = FALSE,
  verbose = FALSE,
  stdout = "|",
  stderr = "|"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="run_auto_mount_+3A_container_id">container_id</code></td>
<td>
<p>The name of the container, usually the repository name on dockerhub.</p>
</td></tr>
<tr><td><code id="run_auto_mount_+3A_command">command</code></td>
<td>
<p>Character scalar, the command to run. If you are
running <code>.bat</code> or <code>.cmd</code> files on Windows, make sure you read the
'Batch files' section in the <a href="processx.html#topic+process">process</a> manual page.</p>
</td></tr>
<tr><td><code id="run_auto_mount_+3A_args">args</code></td>
<td>
<p>Character vector, arguments to the command. Any files or
directories that should be mounted must be named &quot;file&quot; (see example).</p>
</td></tr>
<tr><td><code id="run_auto_mount_+3A_wd">wd</code></td>
<td>
<p>Local working directory to run command. If specified, the working
directory will be mounted to the docker container.</p>
</td></tr>
<tr><td><code id="run_auto_mount_+3A_wd_in_container">wd_in_container</code></td>
<td>
<p>Working directory to run command in
the container. Defaults to the working directory mounted to the container
(<code>wd</code>).</p>
</td></tr>
<tr><td><code id="run_auto_mount_+3A_environment_variables">environment_variables</code></td>
<td>
<p>A character vector of environment variables. Format: <code>c("ENVVAR=VALUE")</code>.</p>
</td></tr>
<tr><td><code id="run_auto_mount_+3A_debug">debug</code></td>
<td>
<p>If <code>TRUE</code>, a command will be printed that the user can execute to enter the container.</p>
</td></tr>
<tr><td><code id="run_auto_mount_+3A_verbose">verbose</code></td>
<td>
<p>Whether or not to print output</p>
</td></tr>
<tr><td><code id="run_auto_mount_+3A_stdout">stdout</code></td>
<td>
<p>What to do with standard output of the command. Default (<code>"|"</code>) means to include it as an item in the results list.
If it is the empty string (<code>""</code>), then the child process inherits the standard output stream of the R process.
If it is a string other than <code>"|"</code> and <code>""</code>, then it is taken as a file name and the output is redirected to this file.</p>
</td></tr>
<tr><td><code id="run_auto_mount_+3A_stderr">stderr</code></td>
<td>
<p>What to do with standard error of the command. Default (&quot;|&quot;) means to include it as an item in the results list.
If it is the empty string (<code>""</code>), then the child process inherits the standard error stream of the R process.
If it is a string other than <code>"|"</code> and <code>""</code>, then it is taken as a file name and the standard error is redirected to this file.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The main difference to <code><a href="#topic+run">run()</a></code> is that the use of names for the <code>args</code>; any
file (or directory) that should be mounted inside the container must be named
<code>file</code>. The other elements (arguments) don't need to be named. Note that it
is fine to have multiple elements with the same name (<code>file</code>).
</p>
<p>This should generally work as long as the command accepts absolute paths
for file input. If that is not the case, use <code><a href="#topic+run">run()</a></code> instead and specify
paths and mounting manually.
</p>


<h3>Value</h3>

<p>List, formatted as output from <code><a href="processx.html#topic+run">processx::run()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>if (test_docker_installation()) {

# Count the number of lines in the DESCRIPTION and LICENSE
# files of this package
run_auto_mount(
  container_id = "alpine",
  command = "wc",
  args = c("-l",
    file = system.file("DESCRIPTION", package = "babelwhale"),
    file = system.file("LICENSE", package = "babelwhale")
  )
)

}
</code></pre>

<hr>
<h2 id='singularity_image_path'>Determine the cached path of singularity images</h2><span id='topic+singularity_image_path'></span>

<h3>Description</h3>

<p>Determine the cached path of singularity images
</p>


<h3>Usage</h3>

<pre><code class='language-R'>singularity_image_path(container_id)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="singularity_image_path_+3A_container_id">container_id</code></td>
<td>
<p>The name of the container, usually the repository name on dockerhub.</p>
</td></tr>
</table>

<hr>
<h2 id='test_docker_installation'>Tests whether docker is correctly installed and available</h2><span id='topic+test_docker_installation'></span>

<h3>Description</h3>

<p>Tests whether docker is correctly installed and available
</p>


<h3>Usage</h3>

<pre><code class='language-R'>test_docker_installation(detailed = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="test_docker_installation_+3A_detailed">detailed</code></td>
<td>
<p>Whether top do a detailed check</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>test_docker_installation()

if (test_docker_installation()) {
  test_docker_installation(detailed = TRUE)
}

</code></pre>

<hr>
<h2 id='test_singularity_installation'>Tests whether singularity is correctly installed and available</h2><span id='topic+test_singularity_installation'></span>

<h3>Description</h3>

<p>Tests whether singularity is correctly installed and available
</p>


<h3>Usage</h3>

<pre><code class='language-R'>test_singularity_installation(detailed = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="test_singularity_installation_+3A_detailed">detailed</code></td>
<td>
<p>Whether top do a detailed check</p>
</td></tr>
</table>


<h3>Examples</h3>

<pre><code class='language-R'>test_singularity_installation()

if (test_singularity_installation()) {
  test_singularity_installation(detailed = TRUE)
}

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
