<!DOCTYPE html><html><head><title>Help for package CerioliOutlierDetection</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {CerioliOutlierDetection}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#CerioliOutlierDetection'>
<p>CerioliOutlierDetection: package for implementing the Iterated Reweighted</p>
MCD outlier detection method of Cerioli (2010)</a></li>
<li><a href='#cerioli2010.fsrmcd.test'><p> Finite-Sample Reweighted MCD Outlier Detection Test of Cerioli (2010)</p></a></li>
<li><a href='#cerioli2010.irmcd.test'>
<p>Iterated RMCD test of Cerioli (2010)</p></a></li>
<li><a href='#ch99AsymptoticDF'>
<p>Croux and Haesbroeck (1999) finite-sample asymptotic approximation</p>
parameters for the MCD estimate</a></li>
<li><a href='#hr05AdjustedDF'><p>Adjusted Degrees of Freedom for Testing Robust Mahalanobis Distances for Outlyingness</p></a></li>
<li><a href='#hr05CriticalValue'><p> Hardin and Rocke (2005) Critical Value for Testing MCD-based Mahalanobis Distances</p></a></li>
<li><a href='#hr05CutoffMvnormal'><p> Corrected Critical Values for Testing MCD-based Mahalanobis Distances</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Outlier Detection Using the Iterated RMCD Method of Cerioli
(2010)</td>
</tr>
<tr>
<td>Version:</td>
<td>1.1.13</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-10-25</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Christopher G. Green &lt;christopher.g.green@gmail.com&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.0.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>robustbase (&ge; 0.91-1)</td>
</tr>
<tr>
<td>Description:</td>
<td>Implements the iterated RMCD method of Cerioli (2010)
	for multivariate outlier detection via robust Mahalanobis distances. Also
	provides the finite-sample RMCD method discussed in the paper, as well as 
	the methods provided in Hardin and Rocke (2005) &lt;<a href="https://doi.org/10.1198%2F106186005X77685">doi:10.1198/106186005X77685</a>&gt; 
	and Green and Martin (2017).</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Suggests:</td>
<td>rrcov, mvtnorm, mclust</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://christopherggreen.github.io/CerioliOutlierDetection/">https://christopherggreen.github.io/CerioliOutlierDetection/</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-10-29 11:03:38 UTC; cggreen</td>
</tr>
<tr>
<td>Author:</td>
<td>Christopher G. Green [aut, cre] (-7877),
  R. Doug Martin [ths]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-10-29 11:50:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='CerioliOutlierDetection'>
CerioliOutlierDetection: package for implementing the Iterated Reweighted 
MCD outlier detection method of Cerioli (2010) 
</h2><span id='topic+CerioliOutlierDetection'></span><span id='topic+CerioliOutlierDetection-package'></span>

<h3>Description</h3>

<p>Implements the outlier detection methodology of Cerioli (2010) based on 
Mahalanobis distances and the minimum covariance determinant (MCD) estimate 
of dispersion. Also provides critical values for testing outlyingness of
MCD-based Mahalanobis distances using the distribution approximations 
developed by Hardin and Rocke (2005) and Green and Martin (2014).
</p>


<h3>Details</h3>







<p>The function <code>cerioli2010.irmcd.test()</code> provides the outlier detection 
methodology of Cerioli (2010), and is probably the best place for a new user
of this package to start. See the documentation for that function for examples.
</p>
<p>This package was also used to produce the results presented in Green and 
Martin (2014). There is a companion <code>R</code> package, <code>HardinRockeExtension</code>,
that provides code that can be used to replicate the results of that paper. The
package <code>HardinRockeExtension</code> is available from Christopher G. Green's 
GitHub: <a href="https://github.com/christopherggreen/HardinRockeExtensionSimulations">https://github.com/christopherggreen/HardinRockeExtensionSimulations</a> .
</p>


<h3>Author(s)</h3>

<p>Written and maintained by Christopher G. Green &lt;christopher.g.green@gmail.com&gt;,
with advice and support from Doug Martin.
</p>


<h3>References</h3>

<p>Andrea Cerioli. Multivariate outlier detection with high-breakdown estimators. 
Journal of the American Statistical Association, 105(489):147-156, 2010.
<a href="https://doi.org/10.1198/jasa.2009.tm09147">doi:10.1198/jasa.2009.tm09147</a>
</p>
<p>C. G. Green and R. Douglas Martin. An extension of a method of Hardin and Rocke, with
an application to multivariate outlier detection via the IRMCD method of Cerioli.
Working Paper, 2017. Available from 
<a href="https://christopherggreen.github.io/papers/hr05_extension.pdf">https://christopherggreen.github.io/papers/hr05_extension.pdf</a>
</p>
<p>J. Hardin and D. M. Rocke. The distribution of robust distances. Journal of Computational
and Graphical Statistics, 14:928-946, 2005. <a href="https://doi.org/10.1198/106186005X77685">doi:10.1198/106186005X77685</a>
</p>

<hr>
<h2 id='cerioli2010.fsrmcd.test'> Finite-Sample Reweighted MCD Outlier Detection Test of Cerioli (2010) </h2><span id='topic+cerioli2010.fsrmcd.test'></span>

<h3>Description</h3>

<p>Given a set of observations, this function tests whether 
there are outliers in the data set and identifies outlying
points. Outlier testing/identification is done using the
Mahalanobis-distances based on the MCD dispersion estimate. 
The finite-sample reweighted MCD method of Cerioli (2010) is used 
to test for unusually large distances, which indicate possible
outliers.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cerioli2010.fsrmcd.test(datamat, 
  mcd.alpha = max.bdp.mcd.alpha(n,v), 
  signif.alpha = 0.05, nsamp = 500, 
  nmini = 300, trace = FALSE, 
  delta = 0.025, hrdf.method=c("GM14","HR05"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cerioli2010.fsrmcd.test_+3A_datamat">datamat</code></td>
<td>
<p> (Data Frame or Matrix)
Data set to test for outliers (rows = observations, 
columns = variables). <code>datamat</code> cannot have
missing values; please deal with them prior to
calling this function. <code>datamat</code> will be converted
to a matrix.
</p>
</td></tr>
<tr><td><code id="cerioli2010.fsrmcd.test_+3A_mcd.alpha">mcd.alpha</code></td>
<td>
<p> (Numeric)
Value to control the fraction
of observations used to compute the covariance matrices
in the MCD calculation.
Default value is corresponds to the maximum breakpoint
case of the MCD; valid values are between
0.5 and 1. See the <code><a href="robustbase.html#topic+covMcd">covMcd</a></code> documentation 
in the <code>robustbase</code> library for further details.
</p>
</td></tr>
<tr><td><code id="cerioli2010.fsrmcd.test_+3A_signif.alpha">signif.alpha</code></td>
<td>
<p> (Numeric)
Desired nominal size <code class="reqn">\alpha</code> of the <em>individual</em> outlier test 
(default value is 0.05). Equivalently, significance level 
at which to test individual observations for outlyingness. (This is
the <code class="reqn">\alpha</code> parameter in Cerioli (2010).)
To test the intersection hypothesis of no outliers in the data,
specify 
</p>
<p style="text-align: center;"><code class="reqn">\alpha = 1 - (1 - \gamma)^{(1/n)},</code>
</p>
 
<p>where <code class="reqn">\gamma</code> is the nominal size of the intersection test and 
<code class="reqn">n</code> is the number of observations.
</p>
</td></tr>
<tr><td><code id="cerioli2010.fsrmcd.test_+3A_nsamp">nsamp</code></td>
<td>
<p> (Integer)
Number of subsamples to use in computing the MCD. See the
<code><a href="robustbase.html#topic+covMcd">covMcd</a></code> documentation in the
<code>robustbase</code> library.
</p>
</td></tr>
<tr><td><code id="cerioli2010.fsrmcd.test_+3A_nmini">nmini</code></td>
<td>
<p> (Integer)
See the <code><a href="robustbase.html#topic+covMcd">covMcd</a></code> documentation in the
<code>robustbase</code> library.
</p>
</td></tr>
<tr><td><code id="cerioli2010.fsrmcd.test_+3A_trace">trace</code></td>
<td>
<p> (Logical)
See the <code><a href="robustbase.html#topic+covMcd">covMcd</a></code> documentation in the
<code>robustbase</code> library.
</p>
</td></tr>
<tr><td><code id="cerioli2010.fsrmcd.test_+3A_delta">delta</code></td>
<td>
<p> (Numeric)
False-positive rate to use in the reweighting 
step (Step 2). Defaults to 0.025 as used in
Cerioli (2010). When the ratio <code class="reqn">n/\nu</code> of
sample size to dimension is very small, using
a smaller delta can improve the accuracy of
the method.
</p>
</td></tr>
<tr><td><code id="cerioli2010.fsrmcd.test_+3A_hrdf.method">hrdf.method</code></td>
<td>
<p> (String)
Method to use for computing degrees of freedom
and cutoff values for the non-MCD subset. The
original method of Hardin and Rocke (2005) and
the expanded method of Green and Martin (2014)
are available as the options &ldquo;HR05&rdquo; and &ldquo;GM14&rdquo;,
respectively. &ldquo;GM14&rdquo; is the default, as it 
is more accurate across a wider range of <code>mcd.alpha</code>
values.
</p>
</td></tr>
</table>


<h3>Value</h3>

<table>
<tr><td><code>mu.hat</code></td>
<td>
<p>Location estimate from the MCD calculation</p>
</td></tr>
<tr><td><code>sigma.hat</code></td>
<td>
<p>Dispersion estimate from the MCD calculation</p>
</td></tr>
<tr><td><code>mahdist</code></td>
<td>
<p>Mahalanobis distances calculated using the MCD estimate</p>
</td></tr> 
<tr><td><code>DD</code></td>
<td>
<p>Hardin-Rocke or Green-Martin critical values for testing MCD distances. Used
to produce weights for reweighted MCD. See Equation (16) in Cerioli (2010).</p>
</td></tr>
<tr><td><code>weights</code></td>
<td>
<p>Weights used in the reweighted MCD. See Equation (16) in Cerioli
(2010).</p>
</td></tr> 
<tr><td><code>mu.hat.rw</code></td>
<td>
<p>Location estimate from the reweighted MCD calculation</p>
</td></tr> 
<tr><td><code>sigma.hat.rw</code></td>
<td>
<p>Dispersion estimate from the reweighted MCD calculation</p>
</td></tr>
<tr><td><code>mahdist.rw</code></td>
<td>
<p>a matrix of dimension <code>nrow(datamat)</code> by
<code>length(signif.alpha)</code> of Mahalanobis distances computed
using the finite-sample reweighted MCD methodology in
Cerioli (2010). Even though the distances do not depend
on <code>signif.alpha</code>, there is one column per entry in 
<code>signif.alpha</code> for user convenience.
</p>
</td></tr>
<tr><td><code>critvalfcn</code></td>
<td>
<p>Function to compute critical values for Mahalanobis distances
based on the reweighted MCD; see Equations (18) and (19) in Cerioli (2010). The
function takes a signifance level as its only argument, and provides a critical
value for each of the original observations (though there will only be two
unique values, one for points included in the reweighted MCD (<code>weights == 1</code>)
and one for points excluded from the reweighted MCD (<code>weights == 0</code>)).</p>
</td></tr> 
<tr><td><code>signif.alpha</code></td>
<td>
<p>Significance levels used in testing.</p>
</td></tr> 
<tr><td><code>mcd.alpha</code></td>
<td>
<p>Fraction of the observations used to compute the MCD estimate</p>
</td></tr> 
<tr><td><code>outliers</code></td>
<td>
<p>A matrix of dimension <code>nrow(datamat)</code> by 
<code>length(signif.alpha)</code> indicating 
whether each row of <code>datamat</code> is an outlier. The <code>i-th</code> 
column corresponds to the result of testing observations
for outlyingness at significance level <code>signif.alpha[i]</code>.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Written and maintained by Christopher G. Green &lt;christopher.g.green@gmail.com&gt;
</p>


<h3>References</h3>

<p>Andrea Cerioli. Multivariate outlier detection with high-breakdown estimators. 
Journal of the American Statistical Association, 105(489):147-156, 2010.
<a href="https://doi.org/10.1198/jasa.2009.tm09147">doi:10.1198/jasa.2009.tm09147</a>
</p>
<p>Andrea Cerioli, Marco Riani, and Anthony C. Atkinson. Controlling the size of multivariate
outlier tests with the MCD estimator of scatter. Statistical Computing, 19:341-353, 2009.
<a href="https://doi.org/10.1007/s11222-008-9096-5">doi:10.1007/s11222-008-9096-5</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+cerioli2010.irmcd.test">cerioli2010.irmcd.test</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
require(mvtnorm, quiet=TRUE)

############################################
# dimension v, number of observations n
v &lt;- 5
n &lt;- 200
simdata &lt;- array( rmvnorm(n*v, mean=rep(0,v), 
    sigma = diag(rep(1,v))), c(n,v) )
#
# detect outliers with nominal sizes 
# c(0.05,0.01,0.001)
#
sa &lt;- 1. - ((1. - c(0.05,0.01,0.001))^(1./n))
results &lt;- cerioli2010.fsrmcd.test( simdata, 
    signif.alpha=sa )
# count number of outliers detected for each 
# significance level
colSums( results$outliers )


#############################################
# add some contamination to illustrate how to 
# detect outliers using the fsrmcd test
# 10/200 = 5% contamination
simdata[ sample(n,10), ] &lt;- array( 
  rmvnorm( 10*v, mean=rep(2,v), sigma = diag(rep(1,v))),
  c(10,v)
)
results &lt;- cerioli2010.fsrmcd.test( simdata, 
  signif.alpha=sa )
colMeans( results$outliers )


## Not run: 
#############################################
# example of how to ensure the size of the intersection test is correct

  n.sim &lt;- 5000
  simdata &lt;- array( 
    rmvnorm(n*v*n.sim, mean=rep(0,v), sigma=diag(rep(1,v))),
    c(n,v,n.sim)
  )
  # in practice we'd do this using one of the parallel processing
  # methods out there
  sa &lt;- 1. - ((1. - 0.01)^(1./n))
  results &lt;- apply( simdata, 3, function(dm) {
    z &lt;- cerioli2010.fsrmcd.test( dm, 
      signif.alpha=sa )
    # true if outliers were detected in the data, false otherwise
    any(z$outliers[,1,drop=TRUE])
  })
  # count the percentage of samples where outliers were detected;
  # should be close to the significance level value used (0.01) in these
  # samples for the intersection test.
  mean(results)


## End(Not run)
</code></pre>

<hr>
<h2 id='cerioli2010.irmcd.test'>
Iterated RMCD test of Cerioli (2010)
</h2><span id='topic+cerioli2010.irmcd.test'></span>

<h3>Description</h3>

<p>Given a set of observations, this function tests whether 
there are outliers in the data set and identifies outlying
points. Outlier testing/identification is done using the
Mahalanobis-distances based on the MCD dispersion estimate. 
The iterated reweighted MCD method of Cerioli (2010) is used 
to ensure the intersection test has the specified nominal size (Type I
error rate).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cerioli2010.irmcd.test(datamat, 
  mcd.alpha = max.bdp.mcd.alpha(n,v), 
  signif.gamma = 0.05, nsamp = 500, 
  nmini = 300, trace = FALSE, 
  delta = 0.025, hrdf.method=c("GM14","HR05"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cerioli2010.irmcd.test_+3A_datamat">datamat</code></td>
<td>
<p> (Data Frame or Matrix)
Data set to test for outliers (rows = observations, 
columns = variables). <code>datamat</code> cannot have
missing values; please deal with them prior to
calling this function. <code>datamat</code> will be converted
to a matrix.
</p>
</td></tr>
<tr><td><code id="cerioli2010.irmcd.test_+3A_mcd.alpha">mcd.alpha</code></td>
<td>
<p> (Numeric)
Value to control the fraction
of observations used to compute the covariance matrices
in the MCD calculation.
Default value is corresponds to the maximum breakpoint
case of the MCD; valid values are between
0.5 and 1. See the <code><a href="robustbase.html#topic+covMcd">covMcd</a></code> documentation 
in the <code>robustbase</code> library for further details.
</p>
</td></tr>
<tr><td><code id="cerioli2010.irmcd.test_+3A_signif.gamma">signif.gamma</code></td>
<td>
<p> (Numeric)
Desired nominal size of the <em>intersection</em> outlier 
test (e.g., 0.05), i.e., a test that there are no outliers 
in the data. (This is the <code class="reqn">\gamma</code> parameter in 
Cerioli (2010).) The corresponding <code class="reqn">\alpha</code> parameter
for testing individual observations for outlyingness will
be calculated from <code class="reqn">\gamma</code> as 
</p>
<p style="text-align: center;"><code class="reqn"> \alpha = 1 - ( 1 - \gamma )^{(1/n)}. </code>
</p>

</td></tr>
<tr><td><code id="cerioli2010.irmcd.test_+3A_nsamp">nsamp</code></td>
<td>
<p> (Integer)
Number of subsamples to use in computing the MCD. See the
<code><a href="robustbase.html#topic+covMcd">covMcd</a></code> documentation in the
<code>robustbase</code> library.
</p>
</td></tr>
<tr><td><code id="cerioli2010.irmcd.test_+3A_nmini">nmini</code></td>
<td>
<p> (Integer)
See the <code><a href="robustbase.html#topic+covMcd">covMcd</a></code> documentation in the
<code>robustbase</code> library.
</p>
</td></tr>
<tr><td><code id="cerioli2010.irmcd.test_+3A_trace">trace</code></td>
<td>
<p> (Logical)
See the <code><a href="robustbase.html#topic+covMcd">covMcd</a></code> documentation in the
<code>robustbase</code> library.
</p>
</td></tr>
<tr><td><code id="cerioli2010.irmcd.test_+3A_delta">delta</code></td>
<td>
<p> (Numeric)
False-positive rate to use in the reweighting 
step (Step 2). Defaults to 0.025 as used in
Cerioli (2010). When the ratio <code class="reqn">n/\nu</code> of
sample size to dimension is very small, using
a smaller delta can improve the accuracy of
the method.
</p>
</td></tr>
<tr><td><code id="cerioli2010.irmcd.test_+3A_hrdf.method">hrdf.method</code></td>
<td>
<p> (String)
Method to use for computing degrees of freedom
and cutoff values for the non-MCD subset. The
original method of Hardin and Rocke (2005) and
the expanded method of Green and Martin (2014)
are available as the options &ldquo;HR05&rdquo; and &ldquo;GM14&rdquo;,
respectively. &ldquo;GM14&rdquo; is the default, as it 
is more accurate across a wider range of <code>mcd.alpha</code>
values.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Calls the finite-sample reweighted MCD (FSRMCD) outlier 
detection function <code><a href="#topic+cerioli2010.fsrmcd.test">cerioli2010.fsrmcd.test</a></code>
first to test for the existence of any outliers in the
data. If the FSRMCD method rejects the null hypothesis of
no outliers in the data, individual observations are then
tested for outlyingness using the critical value function
returned by <code><a href="#topic+cerioli2010.fsrmcd.test">cerioli2010.fsrmcd.test</a></code> with 
significance <code class="reqn">\gamma</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>outliers</code></td>
<td>
<p>A matrix of dimension <code>nrow(datamat)</code> by 
<code>length(signif.gamma)</code> indicating 
whether each row of <code>datamat</code> is an outlier. The <code>i-th</code> 
column corresponds to the result of testing observations
for outlyingness at significance level <code>signif.gamma[i]</code>.</p>
</td></tr>
<tr><td><code>mahdist.rw</code></td>
<td>
<p>a matrix of dimension <code>nrow(datamat)</code> by
<code>length(signif.gamma)</code> of Mahalanobis distances computed
using the finite-sample reweighted MCD methodology in
Cerioli (2010). Even though the distances do not depend
on <code>signif.gamma</code>, there is one column per entry in 
<code>signif.gamma</code> for user convenience.
</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Written and maintained by Christopher G. Green &lt;christopher.g.green@gmail.com&gt;
</p>


<h3>References</h3>

<p>Andrea Cerioli. Multivariate outlier detection with high-breakdown estimators. 
Journal of the American Statistical Association, 105(489):147-156, 2010.
<a href="https://doi.org/10.1198/jasa.2009.tm09147">doi:10.1198/jasa.2009.tm09147</a>
</p>
<p>Andrea Cerioli, Marco Riani, and Anthony C. Atkinson. Controlling the size of multivariate
outlier tests with the MCD estimator of scatter. Statistical Computing, 19:341-353, 2009.
<a href="https://doi.org/10.1007/s11222-008-9096-5">doi:10.1007/s11222-008-9096-5</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+cerioli2010.fsrmcd.test">cerioli2010.fsrmcd.test</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>require(mvtnorm, quiet=TRUE)

############################################
# dimension v, number of observations n
v &lt;- 5
n &lt;- 200
simdata &lt;- array( rmvnorm(n*v, mean=rep(0,v), 
    sigma = diag(rep(1,v))), c(n,v) )
# detect outliers
results &lt;- cerioli2010.irmcd.test( simdata, 
    signif.gamma=c(0.05,0.01,0.001) )
# count number of outliers detected for each 
# significance level
colSums( results$outliers )


#############################################
# add some contamination to illustrate how to 
# detect outliers using the irmcd test
# 10/200 = 5% contamination
simdata[ sample(n,10), ] &lt;- array( 
  rmvnorm( 10*v, mean=rep(2,v), sigma = diag(rep(1,v))),
  c(10,v)
)
results &lt;- cerioli2010.irmcd.test( simdata, 
  signif.gamma=0.01 )
mean( results$outliers[,1,drop=TRUE] )

#############################################
# banknote example from Cerioli (2010)
## Not run: 

  require(rrcov) # for CovMcd
  require(mclust)  # banknote data set lives here
  data(banknote, package="mclust")
  # length, width of left edge, width of right edge,
  # width of bottom edge, width of top edge, length
  # of image diagonal, counterfeit (1=counterfeit)

  bnk.gamma &lt;- 0.01
  # genuine banknotes
  # classical mean and covariance
  banknote.real &lt;- banknote[ banknote[,"Status"]=="genuine", 2:7 ]
  cov.cls &lt;- CovClassic( banknote.real  )
  # 1 - (1 - 0.01)^(1/100) quantile of scaled-Beta distribution
  # with m=100 and v=6
  bnk.m &lt;- nrow( banknote.real )
  bnk.v &lt;- ncol( banknote.real ) 
  bnk.alpha &lt;- 1. - ((1. - bnk.gamma)^(1./bnk.m))
  cutoff.cls &lt;- (bnk.m-1.)*(bnk.m-1.)*qbeta( 1. - bnk.alpha, bnk.v/2., 
  (bnk.m - bnk.v - 1.)/2.)/bnk.m
  # Figure 4 (left) in Cerioli (2010)
  plot( getDistance( cov.cls ), xlab="Index number", 
  ylab="Squared Mahalanobis Distance", type="p", 
  ylim=c(0,45)
  )
  abline( h=cutoff.cls )

  # reweighted MCD, maximum breakdown point case
  cov.rob &lt;- CovMcd( banknote.real, 
  alpha=floor((bnk.m + bnk.v + 1.)/2.)/bnk.m, nsamp="best" )
  # cutoff using chi-squared individually
  cutoff.rmcdind &lt;- qchisq(1. - bnk.gamma, df=bnk.v)
  # cufoff using simultaneous chi-square
  cutoff.rmcdsim &lt;- qchisq(1. - bnk.alpha, df=bnk.v)
  # scaled-F cutoff using FSRMCD
  # cutoff value is returned by critvalfcn for observations
  # with weight=0
  tmp.fsrmcd &lt;- cerioli2010.fsrmcd.test( banknote.real, 
  signif.alpha=bnk.alpha )
  cutoff.fsrmcd &lt;- unique(tmp.fsrmcd$critvalfcn( bnk.alpha )[tmp.fsrmcd$weights==0])
  # Figure 4 (right)
  plot( getDistance( cov.rob ), xlab="Index number",
  ylab="Squared Robust Reweighted Distance", type="p",
  ylim=c(0,45)
  )
  abline( h=cutoff.rmcdind, lty="dotted" )
  abline( h=cutoff.rmcdsim, lty="dashed" )
  abline( h=cutoff.fsrmcd, lty="solid" )
  legend( "topright", c("RMCD_ind","RMCD","FSRMCD"), 
    lty=c("dotted","dashed","solid") )

  # forged banknotes
  # classical mean and covariance
  banknote.fake &lt;- banknote[ banknote[,"Status"]=="counterfeit", 2:7 ]
  cov.cls &lt;- CovClassic( banknote.fake  )
  # 1 - (1 - 0.01)^(1/100) quantile of scaled-Beta distribution
  # with m=100 and v=6
  bnk.m &lt;- nrow( banknote.fake )
  bnk.v &lt;- ncol( banknote.fake ) 
  bnk.alpha &lt;- 1. - ((1. - bnk.gamma)^(1./bnk.m))
  cutoff.cls &lt;- (bnk.m-1.)*(bnk.m-1.)*qbeta( 1. - bnk.alpha, bnk.v/2., 
    (bnk.m - bnk.v - 1.)/2.)/bnk.m
  # Figure 5 (left) in Cerioli (2010)
  plot( getDistance( cov.cls ), xlab="Index number", 
    ylab="Squared Mahalanobis Distance", type="p", 
    ylim=c(0,45)
  )
  abline( h=cutoff.cls )
  
  
  # reweighted MCD, maximum breakdown point case
  cov.rob &lt;- CovMcd( banknote.fake, 
    alpha=floor((bnk.m + bnk.v + 1.)/2.)/bnk.m, nsamp="best" )
  # cutoff using chi-squared individually
  cutoff.rmcdind &lt;- qchisq(1. - bnk.gamma, df=bnk.v)
  # scaled-F cutoff using FSRMCD
  # cutoff value is returned by critvalfcn for observations
  # with weight=0
  tmp.fsrmcd &lt;- cerioli2010.fsrmcd.test( banknote.fake, 
    signif.alpha=bnk.alpha )
  cutoff.fsrmcd &lt;- unique(tmp.fsrmcd$critvalfcn( bnk.alpha )[tmp.fsrmcd$weights==0])
  cutoff.irmcd &lt;- unique(tmp.fsrmcd$critvalfcn( bnk.gamma )[tmp.fsrmcd$weights==0])
  # Figure 5 (right) in Cerioli (2010)
  plot( getDistance( cov.rob ), xlab="Index number",
    ylab="Squared robust reweighted Distance", type="p",
    ylim=c(0,150)
  )
  abline( h=cutoff.rmcdind, lty="dotted" )
  abline( h=cutoff.fsrmcd, lty="dashed" )
  abline( h=cutoff.irmcd, lty="solid" )
  legend( "topright", c("RMCD_ind","FSRMCD","IRMCD"), 
    lty=c("dotted","dashed","solid") )


## End(Not run)

#############################################
# example of how to ensure the size of the intersection test is correct
## Not run: 
  n.sim &lt;- 5000
  simdata &lt;- array( 
    rmvnorm(n*v*n.sim, mean=rep(0,v), sigma=diag(rep(1,v))),
    c(n,v,n.sim)
  )
  # in practice we'd do this using one of the parallel processing
  # methods out there
  results &lt;- apply( simdata, 3, function(dm) {
    z &lt;- cerioli2010.irmcd.test( dm, 
      signif.gamma=0.01 )
    # true if outliers were detected in the data, false otherwise
    any(z$outliers[,1,drop=TRUE])
  })
  # count the percentage of samples where outliers were detected;
  # should be close to the significance level value used (0.01) in these
  # samples for the intersection test
  mean(results)

## End(Not run)
</code></pre>

<hr>
<h2 id='ch99AsymptoticDF'>
Croux and Haesbroeck (1999) finite-sample asymptotic approximation
parameters for the MCD estimate
</h2><span id='topic+ch99AsymptoticDF'></span>

<h3>Description</h3>

<p>Computes the asymptotic Wishart degrees of freedom and
consistency constant for the MCD robust dispersion estimate 
(for data with a model normal distribution) as described in 
Hardin and Rocke (2005) and using the formulas described in 
Croux and Haesbroeck (1999).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ch99AsymptoticDF(n.obs, p.dim, mcd.alpha)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ch99AsymptoticDF_+3A_n.obs">n.obs</code></td>
<td>
<p>(Integer) Number of observations</p>
</td></tr>
<tr><td><code id="ch99AsymptoticDF_+3A_p.dim">p.dim</code></td>
<td>
<p>(Integer) Dimension of the data, i.e.,
number of variables. </p>
</td></tr>
<tr><td><code id="ch99AsymptoticDF_+3A_mcd.alpha">mcd.alpha</code></td>
<td>
<p> (Numeric) Value that  
determines the fraction of the sample used to 
compute the MCD estimate. <code class="reqn">1 - mcd.alpha</code>
will be the fraction of observations that are
omitted in computing the MCD estimate. The
default value is 
</p>
<p style="text-align: center;"><code class="reqn"> \lfloor (n.obs + p.dim + 1)/2 \rfloor/n.obs,</code>
</p>
  
<p>which yields the MCD estimate with the maximum possible
breakdown point.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The consistency factor <code>c.alpha</code> is already available in the
<code>robustbase</code> library as the function 
<code>.MCDcons</code>. (See the code for <code>covMcd</code>.) <code>ch99AsymptoticDF</code>
uses the result of <code>.MCDcons</code> for consistency.
</p>
<p>The computation of the asymptotic Wishart degrees of freedom parameter <code>m</code>
follows the Appendix of Hardin and Rocke (2005).
</p>


<h3>Value</h3>

<table>
<tr><td><code>c.alpha</code></td>
<td>
<p>the asymptotic consistency coefficient for the MCD
estimate of the dispersion matrix</p>
</td></tr>
<tr><td><code>m.hat.asy</code></td>
<td>
<p>the asymptotic degrees of freedom for the Wishart
distribution approximation to the distribution of the MCD dispersion
estimate</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Written and maintained by Christopher G. Green &lt;christopher.g.green@gmail.com&gt;
</p>


<h3>References</h3>

<p>Christopher Croux and Gentiane Haesbroeck. Influence function and efficiency of the minimum
covariance determinant scatter matrix estimator. Journal of Multivariate Analysis,
71:161-190, 1999. <a href="https://doi.org/10.1006/jmva.1999.1839">doi:10.1006/jmva.1999.1839</a>
</p>
<p>J. Hardin and D. M. Rocke. The distribution of robust distances. Journal of Computational
and Graphical Statistics, 14:928-946, 2005. <a href="https://doi.org/10.1198/106186005X77685">doi:10.1198/106186005X77685</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># compare to table from p941 of Hardin and Rocke (2005)
ch99AsymptoticDF(  50, 5)
ch99AsymptoticDF( 100,10)
ch99AsymptoticDF( 500,10)
ch99AsymptoticDF(1000,20)
</code></pre>

<hr>
<h2 id='hr05AdjustedDF'>Adjusted Degrees of Freedom for Testing Robust Mahalanobis Distances for Outlyingness</h2><span id='topic+hr05AdjustedDF'></span>

<h3>Description</h3>

<p>Computes the degrees of freedom for the adjusted F distribution for testing
Mahalanobis distances calculated with the minimum covariance 
determinant (MCD) robust dispersion estimate (for data with 
a model normal distribution) as described in Hardin and 
Rocke (2005) or in Green and Martin (2014).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hr05AdjustedDF( n.obs, p.dim, mcd.alpha, m.asy, method = c("HR05", "GM14"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hr05AdjustedDF_+3A_n.obs">n.obs</code></td>
<td>
<p>(Integer) Number of observations</p>
</td></tr>
<tr><td><code id="hr05AdjustedDF_+3A_p.dim">p.dim</code></td>
<td>
<p>(Integer) Dimension of the data, i.e.,
number of variables. </p>
</td></tr>
<tr><td><code id="hr05AdjustedDF_+3A_mcd.alpha">mcd.alpha</code></td>
<td>
<p>(Numeric) Value that determines the
fraction of the sample used to compute the MCD estimate. 
Default value corresponds to the maximum breakdown point
case of the MCD.</p>
</td></tr>
<tr><td><code id="hr05AdjustedDF_+3A_m.asy">m.asy</code></td>
<td>
<p>(Numeric) Asymptotic Wishart degrees of freedom. 
The default value uses <code><a href="#topic+ch99AsymptoticDF">ch99AsymptoticDF</a></code> to 
obtain the the finite-sample asymptotic value, but the user can also 
provide a pre-computed value.</p>
</td></tr>
<tr><td><code id="hr05AdjustedDF_+3A_method">method</code></td>
<td>
<p>Either &quot;HR05&quot; to use the method of Hardin and Rocke (2005),
or &quot;GM14&quot; to use the method of Green and Martin (2014).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Hardin and Rocke (2005) derived an approximate <code class="reqn">F</code> distribution
for testing robust Mahalanobis distances, computed using the MCD
estimate of dispersion, for outlyingness. This distribution improves
upon the standard <code class="reqn">\chi^2</code> distribution for identifying outlying
points in data set. The method of Hardin and Rocke was designed to work
for the maximum breakdown point case of the MCD, where 
</p>
<p style="text-align: center;"><code class="reqn">\alpha = \lfloor (n.obs + p.dim + 1)/2 \rfloor/n.obs.</code>
</p>

<p>Green and Martin (2014) extended 
this result to MCD(<code class="reqn">\alpha</code>), where <code class="reqn">\alpha</code> controls the
size of the sample used to compute the MCD estimate, as well as the
breakdown point of the estimator.
</p>
<p>With argument <code>method = "HR05"</code> the function returns 
<code class="reqn">m_{pred}</code> as given in Equation 3.4 of Hardin and Rocke (2005).
The Hardin and Rocke method is only supported for the maximum breakdown
point case; an error will be generated for other values of <code>mcd.alpha</code>.
</p>
<p>The argument <code>method = "GM14"</code> uses the extended methodology 
described in Green and Martin (2014) and is available for all values
of <code>mcd.alpha</code>.
</p>


<h3>Value</h3>

<p> Returns the adjusted F degrees of freedom based on the
asymptotic value, the dimension of the data, and the sample size.
</p>


<h3>Note</h3>

<p> This function is typically not called directly by users; rather
it is used in the construction of other functions.
</p>


<h3>Author(s)</h3>

<p>Written and maintained by Christopher G. Green &lt;christopher.g.green@gmail.com&gt;
</p>


<h3>References</h3>

<p>C. G. Green and R. Douglas Martin. An extension of a method of Hardin and Rocke, with
an application to multivariate outlier detection via the IRMCD method of Cerioli.
Working Paper, 2017. Available from 
<a href="https://christopherggreen.github.io/papers/hr05_extension.pdf">https://christopherggreen.github.io/papers/hr05_extension.pdf</a>
</p>
<p>J. Hardin and D. M. Rocke. The distribution of robust distances. Journal of Computational
and Graphical Statistics, 14:928-946, 2005. <a href="https://doi.org/10.1198/106186005X77685">doi:10.1198/106186005X77685</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+ch99AsymptoticDF">ch99AsymptoticDF</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>hr05tester &lt;- function(n,p) {
	a &lt;- floor( (n+p+1)/2 )/n
	hr05AdjustedDF( n, p, a, ch99AsymptoticDF(n,p,a)$m.hat.asy, method="HR05" )
}
# compare to m_pred in table on page 941 of Hardin and Rocke (2005)
hr05tester(  50, 5)
hr05tester( 100,10)
hr05tester( 500,10)
hr05tester(1000,20)

# using default arguments
hr05tester &lt;- function(n,p) {
	hr05AdjustedDF( n, p, method="HR05" )
}
# compare to m_pred in table on page 941 of Hardin and Rocke (2005)
hr05tester(  50, 5)
hr05tester( 100,10)
hr05tester( 500,10)
hr05tester(1000,20)

# Green and Martin (2014) improved method
hr05tester &lt;- function(n,p) {
	hr05AdjustedDF( n, p, method="GM14" )
}
# compare to m_sim in table on page 941 of Hardin and Rocke (2005)
hr05tester(  50, 5)
hr05tester( 100,10)
hr05tester( 500,10)
hr05tester(1000,20)
</code></pre>

<hr>
<h2 id='hr05CriticalValue'> Hardin and Rocke (2005) Critical Value for Testing MCD-based Mahalanobis Distances
</h2><span id='topic+hr05CriticalValue'></span>

<h3>Description</h3>

<p>Hardin and Rocke (2005) provide an approximate <code class="reqn">F</code> distribution for
testing whether Mahalanobis distances calculated using the MCD dispersion
estimate are unusually large, and hence, indicative of outliers in the data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>hr05CriticalValue(em, p.dim, signif.alpha)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hr05CriticalValue_+3A_em">em</code></td>
<td>
<p>(Numeric) Degrees of freedom for Wishart distribution 
approximation to the MCD scatter matrix.</p>
</td></tr> 
<tr><td><code id="hr05CriticalValue_+3A_p.dim">p.dim</code></td>
<td>
<p>(Integer) Dimension of the data, i.e.,
number of variables. </p>
</td></tr>
<tr><td><code id="hr05CriticalValue_+3A_signif.alpha">signif.alpha</code></td>
<td>
<p> (Numeric) Significance level for testing the 
null hypothesis </p>
</td></tr>
</table>


<h3>Details</h3>

<p>Hardin and Rocke (2005) derived an <code class="reqn">F</code> distributional approximation
for the Mahalanobis distances of the observations that were excluded from
the MCD calculation; see equation 3.2 on page 938 of the paper.
</p>
<p>It is assumed here that the MCD covariance estimate used in the Mahalanobis
distance calculation was adjusted by the consistency factor, so it is not 
included in the calculation here. (If one needs the consistency factor it
is returned by the function <code><a href="#topic+ch99AsymptoticDF">ch99AsymptoticDF</a></code> in this package
or by the function <code>.MCDcons</code> in the <code>robustbase</code> 
package.)
</p>


<h3>Value</h3>

<p> The appropriate cutoff value (from the <code class="reqn">F</code> 
distributional approximation) for testing whether a
Mahalanobis distance is unusually large at the specified
significance level.
</p>


<h3>Note</h3>

<p> It can happen that one of the <code class="reqn">F</code> distribution paramaters, 
<code class="reqn">m - p + 1</code>, is non-positive, in which case <code>qf</code> will return
NaN. <code>hr05CriticalValue</code> will issue a warning in this case, and
return NA.
</p>


<h3>Author(s)</h3>

<p>Written and maintained by Christopher G. Green &lt;christopher.g.green@gmail.com&gt;
</p>


<h3>References</h3>

<p>J. Hardin and D. M. Rocke. The distribution of robust distances. Journal of Computational
and Graphical Statistics, 14:928-946, 2005. <a href="https://doi.org/10.1198/106186005X77685">doi:10.1198/106186005X77685</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+hr05AdjustedDF">hr05AdjustedDF</a></code>, <code><a href="#topic+hr05CutoffMvnormal">hr05CutoffMvnormal</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>hr05CriticalValue( hr05AdjustedDF( 1000, 20 ), 20, 0.05 ) 
</code></pre>

<hr>
<h2 id='hr05CutoffMvnormal'> Corrected Critical Values for Testing MCD-based Mahalanobis Distances </h2><span id='topic+hr05CutoffMvnormal'></span>

<h3>Description</h3>

<p>Provides critical values for testing for outlyingness using MCD-based 
Mahalanobis distances and the <code class="reqn">F</code> distributional approximation 
developed by Hardin and Rocke (2005) or the enhancement by Green and Martin (2014).
</p>


<h3>Usage</h3>

<pre><code class='language-R'> hr05CutoffMvnormal(n.obs, p.dim, mcd.alpha, signif.alpha, 
  method = c("GM14", "HR05"), use.consistency.correction = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="hr05CutoffMvnormal_+3A_n.obs">n.obs</code></td>
<td>
<p>(Integer) Number of observations</p>
</td></tr>
<tr><td><code id="hr05CutoffMvnormal_+3A_p.dim">p.dim</code></td>
<td>
<p>(Integer) Dimension of the data, i.e.,
number of variables. </p>
</td></tr>
<tr><td><code id="hr05CutoffMvnormal_+3A_mcd.alpha">mcd.alpha</code></td>
<td>
<p> (Numeric) Value that  
determines the fraction of the sample used to 
compute the MCD estimate. Defaults to the value
used in the maximum breakdown point case of the
MCD.
</p>
</td></tr>
<tr><td><code id="hr05CutoffMvnormal_+3A_signif.alpha">signif.alpha</code></td>
<td>
<p> (Numeric) Significance level for testing the 
null hypothesis. Default value is 0.05. 
</p>
</td></tr>
<tr><td><code id="hr05CutoffMvnormal_+3A_method">method</code></td>
<td>
<p>Either &quot;HR05&quot; to use the method of Hardin and Rocke (2005),
or &quot;GM14&quot; to use the method of Green and Martin (2014).</p>
</td></tr>
<tr><td><code id="hr05CutoffMvnormal_+3A_use.consistency.correction">use.consistency.correction</code></td>
<td>
<p> (Logical) By default, the method does
not multiply the cutoff values by the consistency correction for the MCD,
under the assumption that the correction was applied during the calculation
of the MCD-based Mahalanobis distances. Specify TRUE to add the correction
factor if you need it for your application.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>hr05CutoffMvnormal</code> is the typical way in which a user will calculate
critical values for testing outlyingness via MCD-based Mahalanobis distances.
The critical values come from the <code class="reqn">F</code> distributional approximation 
derived by Hardin and Rocke (2005). One can use either the corrected degrees
of freedom parameter derived in that paper (which was only shown to work for 
the maximum breakdown point case of MCD), or the correction derived in 
Green and Martin (2014) for arbitrary values of <code>mcd.alpha</code>.
</p>


<h3>Value</h3>

<table>
<tr><td><code>cutoff.pred</code></td>
<td>
<p> Critical value based on the predicted
Wishart degrees of freedom <code>m.pred</code> </p>
</td></tr>
<tr><td><code>cutoff.asy</code></td>
<td>
<p> Critical value based on the asymptotic
Wishart degrees of freedom <code>m.asy</code> </p>
</td></tr>
<tr><td><code>c.alpha</code></td>
<td>
<p> The value of the consistency correction
factor, <code class="reqn">c_{\alpha} </code> </p>
</td></tr>
<tr><td><code>m.asy</code></td>
<td>
<p>Asymptotic Wishart degrees of freedom
parameter </p>
</td></tr>
<tr><td><code>m.pred</code></td>
<td>
<p>Predicted Wishart degrees of freedom 
(using the method specified in <code>method</code>) </p>
</td></tr>
<tr><td><code>n.obs</code></td>
<td>
<p>Number of observations</p>
</td></tr>
<tr><td><code>p.dim</code></td>
<td>
<p>Number of variables</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Written and maintained by Christopher G. Green &lt;christopher.g.green@gmail.com&gt;
</p>


<h3>References</h3>

<p>C. G. Green and R. Douglas Martin. An extension of a method of Hardin and Rocke, with
an application to multivariate outlier detection via the IRMCD method of Cerioli.
Working Paper, 2017. Available from 
<a href="https://christopherggreen.github.io/papers/hr05_extension.pdf">https://christopherggreen.github.io/papers/hr05_extension.pdf</a>
</p>
<p>J. Hardin and D. M. Rocke. The distribution of robust distances. Journal of Computational
and Graphical Statistics, 14:928-946, 2005. <a href="https://doi.org/10.1198/106186005X77685">doi:10.1198/106186005X77685</a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+hr05CriticalValue">hr05CriticalValue</a></code>, <code><a href="#topic+hr05AdjustedDF">hr05AdjustedDF</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># examples from page 941 of Hardin and Rocke
hr05CutoffMvnormal(n.obs=50  , p.dim=5 , signif.alpha=0.05)
hr05CutoffMvnormal(n.obs=100 , p.dim=10, signif.alpha=0.05)
hr05CutoffMvnormal(n.obs=500 , p.dim=10, signif.alpha=0.05)
hr05CutoffMvnormal(n.obs=1000, p.dim=20, signif.alpha=0.05)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
