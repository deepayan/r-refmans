<!DOCTYPE html><html lang="en"><head><title>Help for package banditsCI</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {banditsCI}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#.check_A'><p>Check Number of Observations for Inference</p></a></li>
<li><a href='#.check_first_batch'><p>Check First Batch Validity</p></a></li>
<li><a href='#.check_shape'><p>Check Shape Compatibility of Probability Objects</p></a></li>
<li><a href='#aw_estimate'><p>Estimate policy value via non-contextual adaptive weighting.</p></a></li>
<li><a href='#aw_scores'><p>Compute AIPW/doubly robust scores.</p></a></li>
<li><a href='#aw_var'><p>Variance of policy value estimator via non-contextual adaptive weighting.</p></a></li>
<li><a href='#calculate_balwts'><p>Calculate balancing weight scores.</p></a></li>
<li><a href='#calculate_continuous_X_statistics'><p>Estimate/variance of policy evaluation via contextual weighting.</p></a></li>
<li><a href='#draw_thompson'><p>Thompson Sampling draws.</p></a></li>
<li><a href='#estimate'><p>Estimate/variance of policy evaluation via non-contextual weighting.</p></a></li>
<li><a href='#generate_bandit_data'><p>Generate classification data.</p></a></li>
<li><a href='#ifelse_clip'><p>Clip lamb values between a minimum x and maximum y.</p></a></li>
<li><a href='#impose_floor'><p>Impose probability floor.</p></a></li>
<li><a href='#LinTSModel'><p>Linear Thompson Sampling model.</p></a></li>
<li><a href='#output_estimates'><p>Policy evaluation with adaptively generated data.</p></a></li>
<li><a href='#plot_cumulative_assignment'><p>Plot cumulative assignment for bandit experiment.</p></a></li>
<li><a href='#ridge_init'><p>Ridge Regression Initialization for Arm Expected Rewards</p></a></li>
<li><a href='#ridge_muhat_lfo_pai'><p>Leave-future-out ridge-based estimates for arm expected rewards.</p></a></li>
<li><a href='#ridge_update'><p>Updates ridge regression matrices.</p></a></li>
<li><a href='#run_experiment'><p>Run an experiment using Thompson Sampling.</p></a></li>
<li><a href='#simple_tree_data'><p>Generate simple tree data.</p></a></li>
<li><a href='#stick_breaking'><p>Stick breaking function.</p></a></li>
<li><a href='#twopoint_stable_var_ratio'><p>Calculate allocation ratio for a two-point stable-variance bandit.</p></a></li>
<li><a href='#update_thompson'><p>Update linear Thompson Sampling model.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Bandit-Based Experiments and Policy Evaluation</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Frequentist inference on adaptively generated data. The methods implemented are based on Zhan et al. (2021) &lt;<a href="https://doi.org/10.48550%2FarXiv.2106.02029">doi:10.48550/arXiv.2106.02029</a>&gt; and Hadad et al. (2021) &lt;<a href="https://doi.org/10.48550%2FarXiv.1911.02768">doi:10.48550/arXiv.1911.02768</a>&gt;. For illustration, several functions for simulating non-contextual and contextual adaptive experiments using Thompson sampling are also supplied. </td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/UChicago-pol-methods/banditsCI">https://github.com/UChicago-pol-methods/banditsCI</a>,
<a href="https://uchicago-pol-methods.github.io/banditsCI/">https://uchicago-pol-methods.github.io/banditsCI/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/UChicago-pol-methods/banditsCI/issues">https://github.com/UChicago-pol-methods/banditsCI/issues</a></td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr (&ge; 1.43), rmarkdown (&ge; 2.23), testthat (&ge; 3.0.0)</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Imports:</td>
<td>glmnet (&ge; 4.1-6), MASS (&ge; 7.3-56), mvtnorm (&ge; 1.2-2),
Rdpack (&ge; 2.6)</td>
</tr>
<tr>
<td>RdMacros:</td>
<td>Rdpack</td>
</tr>
<tr>
<td>Collate:</td>
<td>'experiment_utils.R' 'adaptive_utils.R' 'errors.R'</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-11-26 14:18:18 UTC; moffer</td>
</tr>
<tr>
<td>Author:</td>
<td>Molly Offer-Westort
    <a href="https://orcid.org/0000-0003-2787-9919"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut, cre,
    cph],
  Yinghui Zhou <a href="https://orcid.org/0009-0002-3515-9751"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Ruohan Zhan <a href="https://orcid.org/0000-0002-3426-2784"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Molly Offer-Westort &lt;mollyow@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-11-29 09:20:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='.check_A'>Check Number of Observations for Inference</h2><span id='topic+.check_A'></span>

<h3>Description</h3>

<p>This function checks if the number of observations is greater than 1, which is required for conducting inference.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.check_A(A)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id=".check_A_+3A_a">A</code></td>
<td>
<p>An integer representing the number of observations.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns NULL if the number of observations is valid; otherwise, throws an error.
</p>

<hr>
<h2 id='.check_first_batch'>Check First Batch Validity</h2><span id='topic+.check_first_batch'></span>

<h3>Description</h3>

<p>This function checks if the first batch size is greater than or equal to the number of treatment arms.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.check_first_batch(batch_sizes, ys)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id=".check_first_batch_+3A_batch_sizes">batch_sizes</code></td>
<td>
<p>A numeric vector specifying batch sizes.</p>
</td></tr>
<tr><td><code id=".check_first_batch_+3A_ys">ys</code></td>
<td>
<p>A matrix of counterfactual conditions.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns NULL if the first batch size is valid; otherwise, throws an error.
</p>

<hr>
<h2 id='.check_shape'>Check Shape Compatibility of Probability Objects</h2><span id='topic+.check_shape'></span>

<h3>Description</h3>

<p>This function checks the dimensional compatibility of 'gammahats' and 'contextual_probs'. It validates the dimensions and types based on whether the probability objects are contextual or non-contextual.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>.check_shape(gammahats, contextual_probs)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id=".check_shape_+3A_gammahats">gammahats</code></td>
<td>
<p>A matrix representing estimates.</p>
</td></tr>
<tr><td><code id=".check_shape_+3A_contextual_probs">contextual_probs</code></td>
<td>
<p>An object representing probabilities, either a matrix (non-contextual) or an array (contextual).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns NULL if the shapes and types are valid; otherwise, throws an error.
</p>

<hr>
<h2 id='aw_estimate'>Estimate policy value via non-contextual adaptive weighting.</h2><span id='topic+aw_estimate'></span>

<h3>Description</h3>

<p>Estimates the value of a policy based on AIPW scores and a policy matrix using non-contextual
adaptive weighting. If <code>evalwts</code> is not provided, uses equal weights for all observations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>aw_estimate(scores, policy, evalwts = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="aw_estimate_+3A_scores">scores</code></td>
<td>
<p>Numeric matrix. AIPW scores, shape <code>[A, K]</code>, where <code>A</code> is the number of observations and <code>K</code> is the number of arms. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="aw_estimate_+3A_policy">policy</code></td>
<td>
<p>Numeric matrix. Policy matrix <code class="reqn">\pi(X_t, w)</code>, shape <code>[A, K]</code>. Must have the same shape as <code>scores</code> and must not contain NA values.</p>
</td></tr>
<tr><td><code id="aw_estimate_+3A_evalwts">evalwts</code></td>
<td>
<p>Optional numeric vector. Non-contextual adaptive weights <code class="reqn">h_t</code>, length <code>A</code>, or <code>NULL</code>. Default is <code>NULL</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Numeric scalar. Estimated policy value.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>scores &lt;- matrix(c(0.5, 0.8, 0.6,
                   0.3, 0.9, 0.2,
                   0.5, 0.7, 0.4,
                   0.8, 0.2, 0.6), ncol = 3, byrow = TRUE)
policy &lt;- matrix(c(0.2, 0.3, 0.5,
                   0.6, 0.1, 0.3,
                   0.4, 0.5, 0.1,
                   0.2, 0.7, 0.1), ncol = 3, byrow = TRUE)
aw_estimate(scores = scores, policy = policy, evalwts = c(0.5, 1, 0.5, 1.5))

</code></pre>

<hr>
<h2 id='aw_scores'>Compute AIPW/doubly robust scores.</h2><span id='topic+aw_scores'></span>

<h3>Description</h3>

<p>Computes AIPW/doubly robust scores based on observed rewards, pulled arms, and inverse
probability scores. If <code>mu_hat</code> is provided, compute AIPW scores, otherwise compute IPW scores.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>aw_scores(yobs, ws, balwts, K, mu_hat = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="aw_scores_+3A_yobs">yobs</code></td>
<td>
<p>Numeric vector. Observed rewards. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="aw_scores_+3A_ws">ws</code></td>
<td>
<p>Integer vector. Pulled arms. Must not contain NA values. Length must match <code>yobs</code>.</p>
</td></tr>
<tr><td><code id="aw_scores_+3A_balwts">balwts</code></td>
<td>
<p>Numeric matrix. Inverse probability score <code class="reqn">1[W_t=w]/e_t(w)</code> of pulling arms, shape <code>[A, K]</code>, where <code>A</code> is the number of observations and <code>K</code> is the number of arms. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="aw_scores_+3A_k">K</code></td>
<td>
<p>Integer. Number of arms. Must be a positive integer.</p>
</td></tr>
<tr><td><code id="aw_scores_+3A_mu_hat">mu_hat</code></td>
<td>
<p>Optional numeric matrix. Plug-in estimator of arm outcomes, shape <code>[A, K]</code>, or <code>NULL</code>. Must not contain NA values if provided.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Numeric matrix. AIPW scores, shape <code>[A, K]</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>aw_scores(yobs = c(0.5, 1, 0, 1.5),
          ws = c(1, 2, 2, 3),
          balwts = matrix(c(0.5, 2, 1, 0.5,
                            1, 1.5, 0.5, 1.5,
                            2, 1.5, 0.5, 1),
                            ncol = 3),
          K = 3,
          mu_hat = matrix(c(0.5, 0.8, 0.6, 0.3,
                            0.9, 0.2, 0.5, 0.7,
                            0.4, 0.8, 0.2, 0.6),
                            ncol = 3))

</code></pre>

<hr>
<h2 id='aw_var'>Variance of policy value estimator via non-contextual adaptive weighting.</h2><span id='topic+aw_var'></span>

<h3>Description</h3>

<p>Computes the variance of a policy value estimate based on AIPW scores, a policy matrix, and
non-contextual adaptive weights.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>aw_var(scores, estimate, policy, evalwts = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="aw_var_+3A_scores">scores</code></td>
<td>
<p>Numeric matrix. AIPW scores, shape <code>[A, K]</code>. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="aw_var_+3A_estimate">estimate</code></td>
<td>
<p>Numeric scalar. Policy value estimate.</p>
</td></tr>
<tr><td><code id="aw_var_+3A_policy">policy</code></td>
<td>
<p>Numeric matrix. Policy matrix <code class="reqn">\pi(X_t, w)</code>, shape <code>[A, K]</code>. Must have the same shape as <code>scores</code> and must not contain NA values.</p>
</td></tr>
<tr><td><code id="aw_var_+3A_evalwts">evalwts</code></td>
<td>
<p>Optional numeric vector. Non-contextual adaptive weights <code class="reqn">h_t</code>, length <code>A</code>, or <code>NULL</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Numeric scalar. Variance of policy value estimate.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>scores &lt;- matrix(c(0.5, 0.8, 0.6,
                   0.3, 0.9, 0.2,
                   0.5, 0.7, 0.4,
                   0.8, 0.2, 0.6), ncol = 3, byrow = TRUE)
policy &lt;- matrix(c(0.2, 0.3, 0.5,
                   0.6, 0.1, 0.3,
                   0.4, 0.5, 0.1,
                   0.2, 0.7, 0.1), ncol = 3, byrow = TRUE)
estimate &lt;- aw_estimate(scores = scores, policy = policy, evalwts = c(0.5, 1, 0.5, 1.5))
aw_var(scores = scores, estimate = estimate, policy = policy, evalwts = c(0.5, 1, 0.5, 1.5))

</code></pre>

<hr>
<h2 id='calculate_balwts'>Calculate balancing weight scores.</h2><span id='topic+calculate_balwts'></span>

<h3>Description</h3>

<p>Calculates the inverse probability score of pulling arms, given the actions taken and the true probabilities of each arm being chosen.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_balwts(ws, probs)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calculate_balwts_+3A_ws">ws</code></td>
<td>
<p>Integer vector. Indicates which arm was chosen for observations at each time <code>t</code>. Length <code>A</code>. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="calculate_balwts_+3A_probs">probs</code></td>
<td>
<p>Numeric matrix or array. True probabilities of each arm being chosen at each time step. Shape <code>[A, K]</code> or <code>[A, A, K]</code>. Must not contain NA values.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A matrix or array containing the inverse probability score of pulling arms.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(123)
A &lt;- 5
K &lt;- 3
ws &lt;- sample(1:K, A, replace = TRUE)
probs &lt;- matrix(runif(A * K), nrow = A, ncol = K)
balwts &lt;- calculate_balwts(ws, probs)

</code></pre>

<hr>
<h2 id='calculate_continuous_X_statistics'>Estimate/variance of policy evaluation via contextual weighting.</h2><span id='topic+calculate_continuous_X_statistics'></span>

<h3>Description</h3>

<p>Computes the estimate and variance of a policy evaluation based on adaptive weights, AIPW scores,
and a policy matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calculate_continuous_X_statistics(h, gammahat, policy)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calculate_continuous_X_statistics_+3A_h">h</code></td>
<td>
<p>Numeric matrix. Adaptive weights <code class="reqn">h_t(X_s)</code>, shape <code>[A, A]</code>. Must be a square matrix and must not contain NA values.</p>
</td></tr>
<tr><td><code id="calculate_continuous_X_statistics_+3A_gammahat">gammahat</code></td>
<td>
<p>Numeric matrix. AIPW scores, shape <code>[A, K]</code>. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="calculate_continuous_X_statistics_+3A_policy">policy</code></td>
<td>
<p>Numeric matrix. Policy matrix <code class="reqn">\pi(X_t, w)</code>, shape <code>[A, K]</code>. Must have the same shape as <code>gammahat</code> and must not contain NA values.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Named numeric vector with elements <code>estimate</code> and <code>var</code>, representing the estimated
policy value and the variance of the estimate, respectively.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>h &lt;- matrix(c(0.4, 0.3, 0.2, 0.1,
              0.2, 0.3, 0.3, 0.2,
              0.5, 0.3, 0.2, 0.1,
              0.1, 0.2, 0.1, 0.6), ncol = 4, byrow = TRUE)
scores &lt;- matrix(c(0.5, 0.8, 0.6, 0.3,
                   0.9, 0.2, 0.5, 0.7,
                   0.4, 0.8, 0.2, 0.6), ncol = 3, byrow = TRUE)
policy &lt;- matrix(c(0.2, 0.3, 0.5,
                   0.6, 0.1, 0.3,
                   0.4, 0.5, 0.1,
                   0.2, 0.7, 0.1), ncol = 3, byrow = TRUE)
gammahat &lt;- scores - policy
calculate_continuous_X_statistics(h = h, gammahat = gammahat, policy = policy)

</code></pre>

<hr>
<h2 id='draw_thompson'>Thompson Sampling draws.</h2><span id='topic+draw_thompson'></span>

<h3>Description</h3>

<p>Draws arms from a LinTS or non-contextual TS agent for multi-armed bandit problems.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>draw_thompson(model, start, end, xs = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="draw_thompson_+3A_model">model</code></td>
<td>
<p>List. Contains the parameters of the model, generated by <code>LinTSModel()</code>.</p>
</td></tr>
<tr><td><code id="draw_thompson_+3A_start">start</code></td>
<td>
<p>Integer. Starting index of observations for which arms are to be drawn. Must be a positive integer.</p>
</td></tr>
<tr><td><code id="draw_thompson_+3A_end">end</code></td>
<td>
<p>Integer. Ending index of the observations for which arms are to be drawn. Must be an integer greater than or equal to <code>start</code>.</p>
</td></tr>
<tr><td><code id="draw_thompson_+3A_xs">xs</code></td>
<td>
<p>Optional matrix. Covariates of shape <code>[A, p]</code>, where <code>p</code> is the number of features, if the LinTSModel is contextual. Default is <code>NULL</code>. Must not contain NA values.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the drawn arms (<code>w</code>) and their corresponding probabilities (<code>ps</code>).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(123)
model &lt;- LinTSModel(K = 5, p = 3, floor_start = 1/5, floor_decay = 0.9, num_mc = 100,
                    is_contextual = TRUE)
draws &lt;- draw_thompson(model = model, start = 1, end = 10,
                       xs = matrix(rnorm(30), ncol = 3))

</code></pre>

<hr>
<h2 id='estimate'>Estimate/variance of policy evaluation via non-contextual weighting.</h2><span id='topic+estimate'></span>

<h3>Description</h3>

<p>Computes the estimate and variance of a policy evaluation based on non-contextual weights, AIPW scores,
and a policy matrix.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>estimate(w, gammahat, policy)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="estimate_+3A_w">w</code></td>
<td>
<p>Numeric vector. Non-contextual weights, length <code>A</code>. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="estimate_+3A_gammahat">gammahat</code></td>
<td>
<p>Numeric matrix. AIPW scores, shape <code>[A, K]</code>. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="estimate_+3A_policy">policy</code></td>
<td>
<p>Numeric matrix. Policy matrix <code class="reqn">\pi(X_t, w)</code>, shape <code>[A, K]</code>. Must have the same shape as <code>gammahat</code> and must not contain NA values.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Named numeric vector with elements <code>estimate</code> and <code>var</code>, representing the estimated
policy value and the variance of the estimate, respectively.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>w &lt;- c(0.5, 1, 0.5, 1.5)
scores &lt;- matrix(c(0.5, 0.8, 0.6,
                   0.3, 0.9, 0.2,
                   0.5, 0.7, 0.4,
                   0.8, 0.2, 0.6), ncol = 3, byrow = TRUE)
policy &lt;- matrix(c(0.2, 0.3, 0.5,
                   0.6, 0.1, 0.3,
                   0.4, 0.5, 0.1,
                   0.2, 0.7, 0.1), ncol = 3, byrow = TRUE)
gammahat &lt;- scores - policy
estimate(w = w, gammahat = gammahat,
policy = policy)

</code></pre>

<hr>
<h2 id='generate_bandit_data'>Generate classification data.</h2><span id='topic+generate_bandit_data'></span>

<h3>Description</h3>

<p>Generates covariates and potential outcomes for a classification dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>generate_bandit_data(xs = NULL, y = NULL, noise_std = 1, signal_strength = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="generate_bandit_data_+3A_xs">xs</code></td>
<td>
<p>Optional matrix. Covariates of shape <code>[A, p]</code>, where <code>A</code> is the number of observations and <code>p</code> is the number of features. Default is <code>NULL</code>. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="generate_bandit_data_+3A_y">y</code></td>
<td>
<p>Optional vector. Labels of length <code>A</code>. Default is <code>NULL</code>. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="generate_bandit_data_+3A_noise_std">noise_std</code></td>
<td>
<p>Numeric. Standard deviation of the noise added to the potential outcomes. Default is <code>1.0</code>. Must be a non-negative number.</p>
</td></tr>
<tr><td><code id="generate_bandit_data_+3A_signal_strength">signal_strength</code></td>
<td>
<p>Numeric. Strength of the signal in the potential outcomes. Default is <code>1.0</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the generated data (<code>xs</code>, <code>ys</code>, <code>muxs</code>, <code>A</code>, <code>p</code>, <code>K</code>) and the true class probabilities (<code>mus</code>).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>data &lt;- generate_bandit_data(xs = as.matrix(iris[,1:4]),
                             y = as.numeric(iris[,5]),
                             noise_std = 0.1,
                             signal_strength = 1.0)

</code></pre>

<hr>
<h2 id='ifelse_clip'>Clip lamb values between a minimum x and maximum y.</h2><span id='topic+ifelse_clip'></span>

<h3>Description</h3>

<p>Clips a numeric vector between two values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ifelse_clip(lamb, x, y)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ifelse_clip_+3A_lamb">lamb</code></td>
<td>
<p>Numeric vector. Values to be clipped.</p>
</td></tr>
<tr><td><code id="ifelse_clip_+3A_x">x</code></td>
<td>
<p>Numeric. Lower bound of the clip range.</p>
</td></tr>
<tr><td><code id="ifelse_clip_+3A_y">y</code></td>
<td>
<p>Numeric. Upper bound of the clip range.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Numeric vector. Clipped values.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>lamb &lt;- c(1, 2, 3, 4, 5)
ifelse_clip(lamb, 2, 4)

</code></pre>

<hr>
<h2 id='impose_floor'>Impose probability floor.</h2><span id='topic+impose_floor'></span>

<h3>Description</h3>

<p>Imposes a floor on the given array a, ensuring that its elements are greater than or equal to amin.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>impose_floor(a, amin)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="impose_floor_+3A_a">a</code></td>
<td>
<p>Numeric vector. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="impose_floor_+3A_amin">amin</code></td>
<td>
<p>Numeric. Minimum allowed value. Must be between 0 and 1.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector with the same length as <code>a</code>, with the floor imposed on its elements.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>a &lt;- c(0.25, 0.25, 0.25, 0.25)
imposed_a &lt;- impose_floor(a = a, amin = 0.1)

</code></pre>

<hr>
<h2 id='LinTSModel'>Linear Thompson Sampling model.</h2><span id='topic+LinTSModel'></span>

<h3>Description</h3>

<p>Creates a linear Thompson Sampling model for multi-armed bandit problems.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>LinTSModel(
  K,
  p = NULL,
  floor_start,
  floor_decay,
  num_mc = 100,
  is_contextual = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="LinTSModel_+3A_k">K</code></td>
<td>
<p>Integer. Number of arms. Must be a positive integer.</p>
</td></tr>
<tr><td><code id="LinTSModel_+3A_p">p</code></td>
<td>
<p>Integer. Dimension of the contextual vector, if <code>is_contextual</code> is set to <code>TRUE</code>. Otherwise, <code>p</code> is ignored. Must be a positive integer.</p>
</td></tr>
<tr><td><code id="LinTSModel_+3A_floor_start">floor_start</code></td>
<td>
<p>Numeric. Specifies the initial value for the assignment probability floor. It ensures that at the start of the process, no assignment probability falls below this threshold. Must be a positive number.</p>
</td></tr>
<tr><td><code id="LinTSModel_+3A_floor_decay">floor_decay</code></td>
<td>
<p>Numeric. Decay rate of the floor. The floor decays with the number of observations in the experiment such that at each point in time, the applied floor is: <code>floor_start/(s^{floor_decay})</code>, where <code>s</code> is the starting index for a batched experiment, or the observation index for an online experiment. Must be a number between 0 and 1 (inclusive).</p>
</td></tr>
<tr><td><code id="LinTSModel_+3A_num_mc">num_mc</code></td>
<td>
<p>Integer. Number of Monte Carlo simulations used to approximate the expected reward. Must be a positive integer. Default is 100.</p>
</td></tr>
<tr><td><code id="LinTSModel_+3A_is_contextual">is_contextual</code></td>
<td>
<p>Logical. Indicates whether the problem is contextual or not. Default is <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the parameters of the LinTSModel.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>model &lt;- LinTSModel(K = 5, p = 3, floor_start = 1/5, floor_decay = 0.9, num_mc = 100,
                    is_contextual = TRUE)

</code></pre>

<hr>
<h2 id='output_estimates'>Policy evaluation with adaptively generated data.</h2><span id='topic+output_estimates'></span>

<h3>Description</h3>

<p>Calculates average response and differences in average response under counterfactual treatment policies.
Estimates are produced using provided inverse probability weighted (IPW) or augmented inverse probability weighted (AIPW) scores paired with various adaptive weighting schemes, as proposed in Hadad et al. (2021) and Zhan et al. (2021).
<br />
<br />
We briefly outline the target quantities:
For observations indexed <code class="reqn">t \in \{1,\dots,A\}</code>, treatments <code class="reqn">w \in \{1,\dots,K\}</code>, we denote as <code class="reqn">Y_t(w)</code> the potential outcome for the unit at time <code class="reqn">t</code> under treatment <code class="reqn">w</code>.
A policy <code class="reqn">\pi</code> is a treatment assignment procedure that is the subject of evaluation, described in terms of treatment assignment probabilities for each subject to receive each counterfactual treatment.
We target estimation of average response under a specified policy:
</p>
<p style="text-align: center;"><code class="reqn">Q(\pi) := \sum_{w = 1}^{K}\textrm{E}\left[\pi(w)Y_t(w)\right]</code>
</p>

<p>The user may specify a list of list of policies to be evaluated, under <code>policy1</code>.
<br />
<br />
Alternatively, they may estimate policy contrasts if <code>policy0</code> is provided:
</p>
<p style="text-align: center;"><code class="reqn">\Delta(\pi^1,\pi^2) := Q(\pi^1) - Q(\pi^2) </code>
</p>



<h3>Usage</h3>

<pre><code class='language-R'>output_estimates(
  policy0 = NULL,
  policy1,
  contrasts = "combined",
  gammahat,
  probs_array,
  uniform = TRUE,
  non_contextual_minvar = TRUE,
  contextual_minvar = TRUE,
  non_contextual_stablevar = TRUE,
  contextual_stablevar = TRUE,
  non_contextual_twopoint = TRUE,
  floor_decay = 0
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="output_estimates_+3A_policy0">policy0</code></td>
<td>
<p>Optional matrix. Single policy probability matrix for contrast evaluation, dimensions <code>[A, K]</code>. Each row represents treatment assignment probabilities for an individual subject, and so rows must sum to 1. When <code>policy0 = NULL</code>, the function estimates the value <code class="reqn">Q(\pi)</code> of each policy matrix listed in <code>policy1</code>. When <code>policy0</code> is non-null, the function estimates differences in average response under each of the component policies in <code>policy1</code> and the <em>single</em> policy in <code>policy0</code>. Must not contain NA values if provided.</p>
</td></tr>
<tr><td><code id="output_estimates_+3A_policy1">policy1</code></td>
<td>
<p>List of matrices. List of counterfactual policy matrices for evaluation, dimensions <code>[A, K]</code>. Each row represents treatment assignment probabilities for an individual subject, and so rows must sum to 1. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="output_estimates_+3A_contrasts">contrasts</code></td>
<td>
<p>Character. The method to estimate policy contrasts, either <code>combined</code> or <code>separate</code>, discussed in Hadad et al. (2021) Section 3. <code>combined</code> indicates the difference in (A)IPW scores is directly used as the unbiased scoring rule for <code class="reqn">\Delta (\pi^1, \pi^2)</code>; <code>separate</code> indicates that scores are used separately <code class="reqn">\hat \Delta (\pi^1, \pi^2) = \hat Q (w_1) - \hat Q (w_2)</code>.</p>
</td></tr>
<tr><td><code id="output_estimates_+3A_gammahat">gammahat</code></td>
<td>
<p>(A)IPW scores matrix with dimensions <code>[A, K]</code> in non-contextual settings, or <code>[A, A, K]</code> contextual settings. Dimensions represent time, (contexts,) treatment arms. Dimensions of <code>gammahat</code> and <code>probs_array</code> must be the same. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="output_estimates_+3A_probs_array">probs_array</code></td>
<td>
<p>Numeric array. Probability matrix or array with dimensions <code>[A, K]</code> in non-contextual settings, or <code>[A, A, K]</code> contextual settings. Dimensions represent time, (contexts,) treatment arms. Dimensions of <code>gammahat</code> and <code>probs_array</code> must be the same. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="output_estimates_+3A_uniform">uniform</code></td>
<td>
<p>Logical. Estimate uniform weights.</p>
</td></tr>
<tr><td><code id="output_estimates_+3A_non_contextual_minvar">non_contextual_minvar</code></td>
<td>
<p>Logical. Estimate non-contextual <code>MinVar</code> weights described in Zhan et al. (2021) Section 4.</p>
</td></tr>
<tr><td><code id="output_estimates_+3A_contextual_minvar">contextual_minvar</code></td>
<td>
<p>Logical. Estimate contextual <code>MinVar</code> weights described in Zhan et al. (2021) Section 4.</p>
</td></tr>
<tr><td><code id="output_estimates_+3A_non_contextual_stablevar">non_contextual_stablevar</code></td>
<td>
<p>Logical. Estimate non-contextual <code>StableVar</code> weights described in Zhan et al. (2021) Section 4.</p>
</td></tr>
<tr><td><code id="output_estimates_+3A_contextual_stablevar">contextual_stablevar</code></td>
<td>
<p>Logical. Estimate contextual <code>StableVar</code> weights  described in Zhan et al. (2021) Section 4.</p>
</td></tr>
<tr><td><code id="output_estimates_+3A_non_contextual_twopoint">non_contextual_twopoint</code></td>
<td>
<p>Logical. Estimate <code>two-point</code> allocation weights described in Hadad et al. (2021) Section 2.</p>
</td></tr>
<tr><td><code id="output_estimates_+3A_floor_decay">floor_decay</code></td>
<td>
<p>Numeric. Floor decay parameter used in the calculation. Default is 0.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list of treatment effect estimates under different weighting schemes.
</p>


<h3>References</h3>

<p>Hadad V, Hirshberg DA, Zhan R, Wager S, Athey S (2021).
&ldquo;Confidence intervals for policy evaluation in adaptive experiments.&rdquo;
<em>Proceedings of the national academy of sciences</em>, <b>118</b>(15), e2014602118.
</p>
<p>Zhan R, Hadad V, Hirshberg DA, Athey S (2021).
&ldquo;Off-policy evaluation via adaptive weighting with data from contextual bandits.&rdquo;
In <em>Proceedings of the 27th ACM SIGKDD Conference on Knowledge Discovery &amp; Data Mining</em>, 2125&ndash;2135.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(123)
# In a non-contextual setting, generate example values for policy1, gammahat, and probs_array
gammahat &lt;- matrix(c(0.5, 0.8, 0.6,
                     0.3, 0.9, 0.2,
                     0.5, 0.7, 0.4,
                     0.8, 0.2, 0.6), ncol = 3, byrow = TRUE)
policy0 &lt;- matrix(c(1, 0, 0,
                    1, 0, 0,
                    1, 0, 0,
                    1, 0, 0), ncol = 3, byrow = TRUE)
policy1 &lt;- list(matrix(c(0, 1, 0,
                         0, 1, 0,
                         0, 1, 0,
                         0, 1, 0), ncol = 3, byrow = TRUE))

probs_array &lt;- array(0, dim = c(4, 4, 3))
for (i in 1:4) {
  temp_vector &lt;- runif(3)
  normalized_vector &lt;- temp_vector / sum(temp_vector)
  probs_array[i, 1, ] &lt;- normalized_vector
}
for (k in 1:3) {
  for (i in 1:4) {
    temp_vector &lt;- runif(3)
    normalized_vector &lt;- temp_vector / sum(temp_vector)
    probs_array[i, 2:4, k] &lt;- normalized_vector
  }
}
estimates &lt;- output_estimates(policy1 = policy1,
                              policy0 = policy0,
                              gammahat = gammahat,
                              probs_array = probs_array)
# plot
plot_results &lt;- function(result) {
  estimates &lt;- result[, "estimate"]
  std.errors &lt;- result[, "std.error"]
  labels &lt;- rownames(result)

  # Define the limits for the x-axis based on estimates and std.errors
  xlims &lt;- c(min(estimates - 2*std.errors), max(estimates + 2*std.errors))

  # Create the basic error bar plot using base R
  invisible(
    plot(estimates, 1:length(estimates), xlim = xlims, xaxt = "n",
         xlab = "Coefficient Estimate", ylab = "",
         yaxt = "n", pch = 16, las = 1, main = "Coefficients and CIs")
  )

  # Add y-axis labels
  invisible(
    axis(2, at = 1:length(estimates), labels = labels, las = 1, tick = FALSE,
         line = 0.5)
  )

  # Add the x-axis values
  x_ticks &lt;- x_ticks &lt;- seq(from = round(xlims[1], .5),
                            to = round(xlims[2], .5), by = 0.5)
  invisible(
    axis(1,
         at = x_ticks,
         labels = x_ticks)
  )

  # Add error bars
  invisible(
    segments(estimates - std.errors,
             1:length(estimates),
             estimates + std.errors,
             1:length(estimates))
  )
}

sample_result &lt;- estimates[[1]]
op &lt;- par(no.readonly = TRUE)
par(mar=c(5, 12, 4, 2))
plot_results(sample_result)
par(op)

</code></pre>

<hr>
<h2 id='plot_cumulative_assignment'>Plot cumulative assignment for bandit experiment.</h2><span id='topic+plot_cumulative_assignment'></span>

<h3>Description</h3>

<p>Generates a plot of the cumulative assignment.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>plot_cumulative_assignment(results, batch_sizes)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="plot_cumulative_assignment_+3A_results">results</code></td>
<td>
<p>List. Results of the experiment, including the actions taken (<code>ws</code>) and the true probabilities of each arm being chosen (<code>probs</code>).</p>
</td></tr>
<tr><td><code id="plot_cumulative_assignment_+3A_batch_sizes">batch_sizes</code></td>
<td>
<p>Integer vector. Batch sizes used in the experiment. Must be positive integers.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A plot of the cumulative assignment.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(123)
A &lt;- 1000
K &lt;- 4
xs &lt;- matrix(runif(A * K), nrow = A, ncol = K)
ys &lt;- matrix(rbinom(A * K, 1, 0.5), nrow = A, ncol = K)
batch_sizes &lt;- c(250, 250, 250, 250)
results &lt;- run_experiment(ys = ys,
                          floor_start = 1/K,
                          floor_decay = 0.9,
                          batch_sizes = batch_sizes,
                          xs = xs)
plot_cumulative_assignment(results, batch_sizes)

</code></pre>

<hr>
<h2 id='ridge_init'>Ridge Regression Initialization for Arm Expected Rewards</h2><span id='topic+ridge_init'></span>

<h3>Description</h3>

<p>Initializes matrices needed for ridge regression to estimate the expected rewards of different arms.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ridge_init(p, K)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ridge_init_+3A_p">p</code></td>
<td>
<p>Integer. Number of covariates. Must be a positive integer.</p>
</td></tr>
<tr><td><code id="ridge_init_+3A_k">K</code></td>
<td>
<p>Integer. Number of arms. Must be a positive integer.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing initialized matrices <code>R_A</code>, <code>R_Ainv</code>, <code>b</code>, and <code>theta</code> for each arm.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>p &lt;- 3
K &lt;- 5
init &lt;- ridge_init(p, K)

</code></pre>

<hr>
<h2 id='ridge_muhat_lfo_pai'>Leave-future-out ridge-based estimates for arm expected rewards.</h2><span id='topic+ridge_muhat_lfo_pai'></span>

<h3>Description</h3>

<p>Computes leave-future-out ridge-basedn estimates of arm expected rewards based on provided data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ridge_muhat_lfo_pai(xs, ws, yobs, K, batch_sizes, alpha = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ridge_muhat_lfo_pai_+3A_xs">xs</code></td>
<td>
<p>Matrix. Covariates of shape <code>[A, p]</code>, where <code>A</code> is the number of observations and <code>p</code> is the number of features. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="ridge_muhat_lfo_pai_+3A_ws">ws</code></td>
<td>
<p>Integer vector. Indicates which arm was chosen for observations at each time <code>t</code>. Length <code>A</code>. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="ridge_muhat_lfo_pai_+3A_yobs">yobs</code></td>
<td>
<p>Numeric vector. Observed outcomes, length <code>A</code>. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="ridge_muhat_lfo_pai_+3A_k">K</code></td>
<td>
<p>Integer. Number of arms. Must be a positive integer.</p>
</td></tr>
<tr><td><code id="ridge_muhat_lfo_pai_+3A_batch_sizes">batch_sizes</code></td>
<td>
<p>Integer vector. Sizes of batches in which data is processed. Must be positive integers.</p>
</td></tr>
<tr><td><code id="ridge_muhat_lfo_pai_+3A_alpha">alpha</code></td>
<td>
<p>Numeric. Ridge regression regularization parameter. Default is 1.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A 3D array containing the expected reward estimates for each arm and each time <code>t</code>, of shape <code>[A, A, K]</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(123)
p &lt;- 3
K &lt;- 5
A &lt;- 100
xs &lt;- matrix(runif(A * p), nrow = A, ncol = p)
ws &lt;- sample(1:K, A, replace = TRUE)
yobs &lt;- runif(A)
batch_sizes &lt;- c(25, 25, 25, 25)
muhat &lt;- ridge_muhat_lfo_pai(xs, ws, yobs, K, batch_sizes)
print(muhat)

</code></pre>

<hr>
<h2 id='ridge_update'>Updates ridge regression matrices.</h2><span id='topic+ridge_update'></span>

<h3>Description</h3>

<p>Given previous matrices and a new observation, updates the matrices for ridge regression.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ridge_update(R_A, b, xs, t, yobs, alpha)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ridge_update_+3A_r_a">R_A</code></td>
<td>
<p>Matrix. Current matrix <code>R_A</code> for an arm. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="ridge_update_+3A_b">b</code></td>
<td>
<p>Numeric vector. Current vector <code>b</code> for an arm.</p>
</td></tr>
<tr><td><code id="ridge_update_+3A_xs">xs</code></td>
<td>
<p>Matrix. Covariates of shape <code>[A, p]</code>, where <code>A</code> is the number of observations and <code>p</code> is the number of features. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="ridge_update_+3A_t">t</code></td>
<td>
<p>Integer. Current time or instance.</p>
</td></tr>
<tr><td><code id="ridge_update_+3A_yobs">yobs</code></td>
<td>
<p>Numeric vector. Observed outcomes, length <code>A</code>. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="ridge_update_+3A_alpha">alpha</code></td>
<td>
<p>Numeric. Ridge regression regularization parameter. Default is 1.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing updated matrices <code>R_A</code>, <code>R_Ainv</code>, <code>b</code>, and <code>theta</code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(123)
p &lt;- 3
K &lt;- 5
init &lt;- ridge_init(p, K)
R_A &lt;- init$R_A[[1]]
b &lt;- init$b[1, ]
xs &lt;- matrix(runif(10 * p), nrow = 10, ncol = p)
yobs &lt;- runif(10)
t &lt;- 1
alpha &lt;- 1
updated &lt;- ridge_update(R_A, b, xs, t, yobs[t], alpha)

</code></pre>

<hr>
<h2 id='run_experiment'>Run an experiment using Thompson Sampling.</h2><span id='topic+run_experiment'></span>

<h3>Description</h3>

<p>Runs a LinTS or non-contextual TS bandit experiment, given potential outcomes and covariates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>run_experiment(
  ys,
  floor_start,
  floor_decay,
  batch_sizes,
  xs = NULL,
  balanced = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="run_experiment_+3A_ys">ys</code></td>
<td>
<p>Matrix. Potential outcomes of shape <code>[A, K]</code>, where <code>A</code> is the number of observations and <code>K</code> is the number of arms. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="run_experiment_+3A_floor_start">floor_start</code></td>
<td>
<p>Numeric. Specifies the initial value for the assignment probability floor. It ensures that at the start of the process, no assignment probability falls below this threshold. Must be a positive number.</p>
</td></tr>
<tr><td><code id="run_experiment_+3A_floor_decay">floor_decay</code></td>
<td>
<p>Numeric. Decay rate of the floor. The floor decays with the number of observations in the experiment such that at each point in time, the applied floor is: <code>floor_start/(s^{floor_decay})</code>, where <code>s</code> is the starting index for a batched experiment, or the observation index for an online experiment. Must be a number between 0 and 1 (inclusive).</p>
</td></tr>
<tr><td><code id="run_experiment_+3A_batch_sizes">batch_sizes</code></td>
<td>
<p>Integer vector. Size of each batch. Must be positive integers.</p>
</td></tr>
<tr><td><code id="run_experiment_+3A_xs">xs</code></td>
<td>
<p>Optional matrix. Covariates of shape <code>[A, p]</code>, where <code>p</code> is the number of features, if the LinTSModel is contextual. Default is <code>NULL</code>. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="run_experiment_+3A_balanced">balanced</code></td>
<td>
<p>Optional logical. Indicates whether to balance the batches. Default is <code>NULL</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the pulled arms (<code>ws</code>), observed rewards (<code>yobs</code>), assignment probabilities (<code>probs</code>), and the fitted bandit model (<code>fitted_bandit_model</code>).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(123)
A &lt;- 1000
K &lt;- 4
xs &lt;- matrix(runif(A * K), nrow = A, ncol = K)
ys &lt;- matrix(rbinom(A * K, 1, 0.5), nrow = A, ncol = K)
batch_sizes &lt;- c(250, 250, 250, 250)
results &lt;- run_experiment(ys = ys,
                          floor_start = 1/K,
                          floor_decay = 0.9,
                          batch_sizes = batch_sizes,
                          xs = xs)

</code></pre>

<hr>
<h2 id='simple_tree_data'>Generate simple tree data.</h2><span id='topic+simple_tree_data'></span>

<h3>Description</h3>

<p>Generates covariates and potential outcomes of a synthetic dataset for a simple tree model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>simple_tree_data(
  A,
  K = 5,
  p = 10,
  noise_std = 1,
  split = 1.676,
  signal_strength = 1,
  noise_form = "normal"
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="simple_tree_data_+3A_a">A</code></td>
<td>
<p>Integer. Number of observations in the dataset. Must be a positive integer.</p>
</td></tr>
<tr><td><code id="simple_tree_data_+3A_k">K</code></td>
<td>
<p>Integer. Number of arms. Must be a positive integer.</p>
</td></tr>
<tr><td><code id="simple_tree_data_+3A_p">p</code></td>
<td>
<p>Integer. Number of covariates. Must be a positive integer.</p>
</td></tr>
<tr><td><code id="simple_tree_data_+3A_noise_std">noise_std</code></td>
<td>
<p>Numeric. Standard deviation of the noise added to the potential outcomes. Must be a non-negative number.</p>
</td></tr>
<tr><td><code id="simple_tree_data_+3A_split">split</code></td>
<td>
<p>Numeric. Split point for creating treatment groups based on the covariates.</p>
</td></tr>
<tr><td><code id="simple_tree_data_+3A_signal_strength">signal_strength</code></td>
<td>
<p>Numeric. Strength of the signal in the potential outcomes.</p>
</td></tr>
<tr><td><code id="simple_tree_data_+3A_noise_form">noise_form</code></td>
<td>
<p>Character. Distribution of the noise added to the potential outcomes. Can be either &quot;normal&quot; or &quot;uniform&quot;.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the generated data (<code>xs</code>, <code>ys</code>, <code>muxs</code>) and the true potential outcome means (<code>mus</code>).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(123)
A &lt;- 1000
K &lt;- 4     # Number of treatment arms
p &lt;- 10    # Number of covariates
synthetic_data &lt;- simple_tree_data(A = A,
                                   K = K,
                                   p = p,
                                   noise_std = 1.0,
                                   split = 1.676,
                                   signal_strength = 1.0,
                                   noise_form = 'normal')

</code></pre>

<hr>
<h2 id='stick_breaking'>Stick breaking function.</h2><span id='topic+stick_breaking'></span>

<h3>Description</h3>

<p>Implements the stick breaking algorithm for calculating weights in the stable-var scheme.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>stick_breaking(Z)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="stick_breaking_+3A_z">Z</code></td>
<td>
<p>Numeric array. Input array, shape <code>[A, K]</code>. Must not contain NA values.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Numeric array. Stick breaking weights, shape <code>[A, K]</code>. Must not contain NA values.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(123)
Z &lt;- array(runif(10), dim = c(2, 5))
stick_breaking(Z)

</code></pre>

<hr>
<h2 id='twopoint_stable_var_ratio'>Calculate allocation ratio for a two-point stable-variance bandit.</h2><span id='topic+twopoint_stable_var_ratio'></span>

<h3>Description</h3>

<p>Calculates the allocation ratio for a two-point stable-variance bandit, given the empirical mean and the discount parameter alpha.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>twopoint_stable_var_ratio(A, e, alpha)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="twopoint_stable_var_ratio_+3A_a">A</code></td>
<td>
<p>Integer. Size of the experiment. Must be a positive integer.</p>
</td></tr>
<tr><td><code id="twopoint_stable_var_ratio_+3A_e">e</code></td>
<td>
<p>Numeric. Empirical mean. Must be a numeric value.</p>
</td></tr>
<tr><td><code id="twopoint_stable_var_ratio_+3A_alpha">alpha</code></td>
<td>
<p>Numeric. Discount parameter.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Numeric vector. Allocation ratio lambda.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Calculate the allocation ratio for a two-point stable-variance bandit with e=0.1 and alpha=0.5
twopoint_stable_var_ratio(1000, 0.1, 0.5)

</code></pre>

<hr>
<h2 id='update_thompson'>Update linear Thompson Sampling model.</h2><span id='topic+update_thompson'></span>

<h3>Description</h3>

<p>Updates the parameters of a linear Thompson Sampling model for multi-armed bandit problems based on new observations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>update_thompson(ws, yobs, model, xs = NULL, ps = NULL, balanced = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="update_thompson_+3A_ws">ws</code></td>
<td>
<p>Integer vector. Indicates which arm was chosen for observations at each time <code>t</code>. Length <code>A</code>, where <code>A</code> is the number of observations. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="update_thompson_+3A_yobs">yobs</code></td>
<td>
<p>Numeric vector. Observed outcomes, length <code>A</code>. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="update_thompson_+3A_model">model</code></td>
<td>
<p>List. Contains the parameters of the LinTSModel.</p>
</td></tr>
<tr><td><code id="update_thompson_+3A_xs">xs</code></td>
<td>
<p>Optional matrix. Covariates of shape <code>[A, p]</code>, where <code>p</code> is the number of features, if the LinTSModel is contextual. Default is <code>NULL</code>. Must not contain NA values.</p>
</td></tr>
<tr><td><code id="update_thompson_+3A_ps">ps</code></td>
<td>
<p>Optional matrix. Probabilities of selecting each arm for each observation, if the LinTSModel is balanced. Default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="update_thompson_+3A_balanced">balanced</code></td>
<td>
<p>Logical. Indicates whether to use balanced Thompson Sampling. Default is <code>NULL</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list containing the updated parameters of the LinTSModel.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>set.seed(123)
model &lt;- LinTSModel(K = 5, p = 3, floor_start = 1, floor_decay = 0.9, num_mc = 100,
                    is_contextual = TRUE)
A &lt;- 1000
ws &lt;- numeric(A)
yobs &lt;- numeric(A)
model &lt;- update_thompson(ws = ws, yobs = yobs, model = model)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
