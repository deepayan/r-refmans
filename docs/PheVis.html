<!DOCTYPE html><html><head><title>Help for package PheVis</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {PheVis}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#boot_df'><p>boot_df</p></a></li>
<li><a href='#build_qantsur'><p>build_qantsur</p></a></li>
<li><a href='#build_quali'><p>build_quali</p></a></li>
<li><a href='#check_arg_test_phevis'><p>check_arg_test_phevis</p></a></li>
<li><a href='#check_arg_train_phevis'><p>check_arg_train_phevis</p></a></li>
<li><a href='#cum_lag'><p>cum_lag</p></a></li>
<li><a href='#data_perf'><p>Control data for test</p></a></li>
<li><a href='#data_phevis'><p>PheVis simulated dataset</p></a></li>
<li><a href='#expcorrectC'><p>expcorrectC</p></a></li>
<li><a href='#fct_surrogate_quanti'><p>fct_surrogate_quanti</p></a></li>
<li><a href='#ggindividual_plot'><p>ggindividual_plot</p></a></li>
<li><a href='#matrix_exp_smooth'><p>matrix_exp_smooth</p></a></li>
<li><a href='#noising'><p>noising</p></a></li>
<li><a href='#norm_var'><p>norm_var</p></a></li>
<li><a href='#phenorm_longit_fit'><p>phenorm_longit_fit</p></a></li>
<li><a href='#phenorm_longit_simpl'><p>phenorm_longit_simpl</p></a></li>
<li><a href='#PheVis-package'><p>PheVis: Automatic Phenotyping of Electronic Health Record at Visit Resolution</p></a></li>
<li><a href='#pred_lme4model'><p>pred_lme4model</p></a></li>
<li><a href='#pretty_cv.glmnet'><p>pretty_cv.glmnet</p></a></li>
<li><a href='#roll_time_sum'><p>roll_time_sum</p></a></li>
<li><a href='#rolling_var'><p>rolling_var</p></a></li>
<li><a href='#safe_selection'><p>safe_selection</p></a></li>
<li><a href='#sur_exp_smooth'><p>sur_exp_smooth</p></a></li>
<li><a href='#test_phevis'><p>test_phevis</p></a></li>
<li><a href='#train_phevis'><p>train_phevis</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Automatic Phenotyping of Electronic Health Record at Visit
Resolution</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.4</td>
</tr>
<tr>
<td>Date:</td>
<td>2023-10-20</td>
</tr>
<tr>
<td>Description:</td>
<td>Using Electronic Health Record (EHR) is difficult because most of the time the true characteristic of the patient is not available. Instead we can retrieve the International Classification of Disease code related to the disease of interest or we can count the occurrence of the Unified Medical Language System. None of them is the true phenotype which needs chart review to identify. However chart review is time consuming and costly. 'PheVis' is an algorithm which is phenotyping (i.e identify a characteristic) at the visit level in an unsupervised fashion. It can be used for chronic or acute diseases. An example of how to use 'PheVis' is available in the vignette. Basically there are two functions that are to be used: 'train_phevis()' which trains the algorithm and 'test_phevis()' which get the predicted probabilities. The detailed method is described in preprint by Fert√© et al. (2020) &lt;<a href="https://doi.org/10.1101%2F2020.06.15.20131458">doi:10.1101/2020.06.15.20131458</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr, ggplot2, glmnet, knitr, lme4, purrr, randomForest, Rcpp
(&ge; 1.0.3), stats, tidyr, viridis, zoo</td>
</tr>
<tr>
<td>Suggests:</td>
<td>PRROC, rmarkdown, testthat</td>
</tr>
<tr>
<td>LinkingTo:</td>
<td>Rcpp</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-10-20 08:05:07 UTC; tf1</td>
</tr>
<tr>
<td>Author:</td>
<td>Thomas Ferte [aut, cre],
  Boris P. Hejblum [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Thomas Ferte &lt;thomas.ferte@u-bordeaux.fr&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-10-20 08:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='boot_df'>boot_df</h2><span id='topic+boot_df'></span>

<h3>Description</h3>

<p>Sample rows with replacement from a matrix
</p>


<h3>Usage</h3>

<pre><code class='language-R'>boot_df(x_matrix, y_sur, ID = NULL, size = 10^5, seed = 1, prob = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="boot_df_+3A_x_matrix">x_matrix</code></td>
<td>
<p>matrix to perform sampling on</p>
</td></tr>
<tr><td><code id="boot_df_+3A_y_sur">y_sur</code></td>
<td>
<p>The numeric vector of the qualitative surrogate.</p>
</td></tr>
<tr><td><code id="boot_df_+3A_id">ID</code></td>
<td>
<p>The patient ID</p>
</td></tr>
<tr><td><code id="boot_df_+3A_size">size</code></td>
<td>
<p>size of matrix returned</p>
</td></tr>
<tr><td><code id="boot_df_+3A_seed">seed</code></td>
<td>
<p>seed for sampling</p>
</td></tr>
<tr><td><code id="boot_df_+3A_prob">prob</code></td>
<td>
<p>Vector for weight sampling</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the sampled explanatory matrix and the sampled qualitative surrogate (y_sur)
</p>

<hr>
<h2 id='build_qantsur'>build_qantsur</h2><span id='topic+build_qantsur'></span>

<h3>Description</h3>

<p>build quantile threshold based on icd variables and omega constant
</p>


<h3>Usage</h3>

<pre><code class='language-R'>build_qantsur(df, var.icd, omega)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="build_qantsur_+3A_df">df</code></td>
<td>
<p>the dataframe containing the icd codes.</p>
</td></tr>
<tr><td><code id="build_qantsur_+3A_var.icd">var.icd</code></td>
<td>
<p>the main icd codes</p>
</td></tr>
<tr><td><code id="build_qantsur_+3A_omega">omega</code></td>
<td>
<p>the constant to define the extrema populations</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric vector with the thresholds for the extrema populations.
</p>

<hr>
<h2 id='build_quali'>build_quali</h2><span id='topic+build_quali'></span>

<h3>Description</h3>

<p>build_quali
</p>


<h3>Usage</h3>

<pre><code class='language-R'>build_quali(x, p, q)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="build_quali_+3A_x">x</code></td>
<td>
<p>A numeric vector</p>
</td></tr>
<tr><td><code id="build_quali_+3A_p">p</code></td>
<td>
<p>The lower quantile</p>
</td></tr>
<tr><td><code id="build_quali_+3A_q">q</code></td>
<td>
<p>The upper quantile</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The qualitative surrogate (x in three categories) defining the extrema populations
</p>

<hr>
<h2 id='check_arg_test_phevis'>check_arg_test_phevis</h2><span id='topic+check_arg_test_phevis'></span>

<h3>Description</h3>

<p>Function to check arguments passed to test_phevis()
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_arg_test_phevis(
  train_param,
  df_test,
  surparam,
  model,
  START_DATE,
  PATIENT_NUM,
  ENCOUNTER_NUM
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_arg_test_phevis_+3A_train_param">train_param</code></td>
<td>
<p>Parameters for the model training (variables used, main ICD and CUIS, half_life, gold standard, omega). Usually obtained from train_phevis() function.</p>
</td></tr>
<tr><td><code id="check_arg_test_phevis_+3A_df_test">df_test</code></td>
<td>
<p>The dataframe on which to make the prediction.</p>
</td></tr>
<tr><td><code id="check_arg_test_phevis_+3A_surparam">surparam</code></td>
<td>
<p>The parameters used to compute the surrogate. Usually obtained by train_phevis() function.</p>
</td></tr>
<tr><td><code id="check_arg_test_phevis_+3A_model">model</code></td>
<td>
<p>The random intercept logistic regression. Usually obtained by train_phevis() function.</p>
</td></tr>
<tr><td><code id="check_arg_test_phevis_+3A_start_date">START_DATE</code></td>
<td>
<p>Column name of the time column. The time column should be numeric</p>
</td></tr>
<tr><td><code id="check_arg_test_phevis_+3A_patient_num">PATIENT_NUM</code></td>
<td>
<p>Column name of the patient id column.</p>
</td></tr>
<tr><td><code id="check_arg_test_phevis_+3A_encounter_num">ENCOUNTER_NUM</code></td>
<td>
<p>Column name of the encounter id column.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, stop the code execution if one condition is not met.
</p>

<hr>
<h2 id='check_arg_train_phevis'>check_arg_train_phevis</h2><span id='topic+check_arg_train_phevis'></span>

<h3>Description</h3>

<p>Function to check arguments passed to train_phevis()
</p>


<h3>Usage</h3>

<pre><code class='language-R'>check_arg_train_phevis(
  half_life,
  df,
  START_DATE,
  PATIENT_NUM,
  ENCOUNTER_NUM,
  var_vec,
  main_icd,
  main_cui,
  rf,
  p.noise,
  bool_SAFE,
  omega,
  GS
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="check_arg_train_phevis_+3A_half_life">half_life</code></td>
<td>
<p>Duration of cumulation. For a chronic disease you might chose Inf, for acute disease you might chose the duration of the disease.</p>
</td></tr>
<tr><td><code id="check_arg_train_phevis_+3A_df">df</code></td>
<td>
<p><code>data.frame</code> containing all the variables.</p>
</td></tr>
<tr><td><code id="check_arg_train_phevis_+3A_start_date">START_DATE</code></td>
<td>
<p>Column name of the time column. The time column should be numeric</p>
</td></tr>
<tr><td><code id="check_arg_train_phevis_+3A_patient_num">PATIENT_NUM</code></td>
<td>
<p>Column name of the patient id column.</p>
</td></tr>
<tr><td><code id="check_arg_train_phevis_+3A_encounter_num">ENCOUNTER_NUM</code></td>
<td>
<p>Column name of the encounter id column.</p>
</td></tr>
<tr><td><code id="check_arg_train_phevis_+3A_var_vec">var_vec</code></td>
<td>
<p>Explanatory variables used for the prediction, including the main variables.</p>
</td></tr>
<tr><td><code id="check_arg_train_phevis_+3A_main_icd">main_icd</code></td>
<td>
<p>Character vector of the column names of the main ICD codes.</p>
</td></tr>
<tr><td><code id="check_arg_train_phevis_+3A_main_cui">main_cui</code></td>
<td>
<p>Character vector of the column names of the main CUIs.</p>
</td></tr>
<tr><td><code id="check_arg_train_phevis_+3A_rf">rf</code></td>
<td>
<p>should pseudo-labellisation with random forest be used (default is true)</p>
</td></tr>
<tr><td><code id="check_arg_train_phevis_+3A_p.noise">p.noise</code></td>
<td>
<p>percentage of noise introduced during the noising step (default is 0.3)</p>
</td></tr>
<tr><td><code id="check_arg_train_phevis_+3A_bool_safe">bool_SAFE</code></td>
<td>
<p>A boolean. If TRUE, SAFE selection is done, else it is not (default is TRUE)</p>
</td></tr>
<tr><td><code id="check_arg_train_phevis_+3A_omega">omega</code></td>
<td>
<p>Constant for the extrema population definition (default is 2)</p>
</td></tr>
<tr><td><code id="check_arg_train_phevis_+3A_gs">GS</code></td>
<td>
<p>Character string corresponding to the name of the gold-standard variable (default is null for which a vector of 0 will be taken).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>No return value, stop the code execution if one condition is not met.
</p>

<hr>
<h2 id='cum_lag'>cum_lag</h2><span id='topic+cum_lag'></span>

<h3>Description</h3>

<p>helpful function to cumulate information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cum_lag(x, n_lag)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cum_lag_+3A_x">x</code></td>
<td>
<p>numeric vector for which lag variable should be computed</p>
</td></tr>
<tr><td><code id="cum_lag_+3A_n_lag">n_lag</code></td>
<td>
<p>size of lag window</p>
</td></tr>
</table>


<h3>Value</h3>

<p>return numeric vector.
</p>

<hr>
<h2 id='data_perf'>Control data for test</h2><span id='topic+data_perf'></span>

<h3>Description</h3>

<p>Simulated dataset for PheVis phenotyping.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(data_perf)
</code></pre>


<h3>Format</h3>

<p>An object of class <code>numeric</code> of length 2.
</p>

<hr>
<h2 id='data_phevis'>PheVis simulated dataset</h2><span id='topic+data_phevis'></span>

<h3>Description</h3>

<p>Simulated dataset for PheVis phenotyping.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data(data_phevis)
</code></pre>


<h3>Format</h3>

<p>An object of class <code>data.frame</code> with 19659 rows and 15 columns.
</p>

<hr>
<h2 id='expcorrectC'>expcorrectC</h2><span id='topic+expcorrectC'></span>

<h3>Description</h3>

<p>c++ function to compute exponential cumulation of information.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>expcorrectC(mat, diffdate, lambda)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="expcorrectC_+3A_mat">mat</code></td>
<td>
<p>A matrix where each column is a variable to be cumulated.</p>
</td></tr>
<tr><td><code id="expcorrectC_+3A_diffdate">diffdate</code></td>
<td>
<p>Number of days between each sojourn. NA for switch of patient and restart cumulation.</p>
</td></tr>
<tr><td><code id="expcorrectC_+3A_lambda">lambda</code></td>
<td>
<p>A double to set the exponential cumulation.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>expcorrectC
</p>


<h3>Value</h3>

<p>A matrix corresponding to the mat argument with cumulated exponential decay
</p>

<hr>
<h2 id='fct_surrogate_quanti'>fct_surrogate_quanti</h2><span id='topic+fct_surrogate_quanti'></span>

<h3>Description</h3>

<p>Compute the quantitative surrogate and then apply thresholds to get the qualitative surrogate.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>fct_surrogate_quanti(
  main_icd,
  main_cui,
  df,
  half_life,
  date,
  patient_id,
  encounter_id,
  omega = 2,
  param = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="fct_surrogate_quanti_+3A_main_icd">main_icd</code></td>
<td>
<p>Character vector of the column names of the main ICD codes.</p>
</td></tr>
<tr><td><code id="fct_surrogate_quanti_+3A_main_cui">main_cui</code></td>
<td>
<p>Character vector of the column names of the main CUIs.</p>
</td></tr>
<tr><td><code id="fct_surrogate_quanti_+3A_df">df</code></td>
<td>
<p>Dataframe containing all variables.</p>
</td></tr>
<tr><td><code id="fct_surrogate_quanti_+3A_half_life">half_life</code></td>
<td>
<p>Duration of accumulation. For a chronic disease you might chose Inf, for acute disease you might chose the duration of the disease.</p>
</td></tr>
<tr><td><code id="fct_surrogate_quanti_+3A_date">date</code></td>
<td>
<p>Column name of the time column. The time column should be numeric</p>
</td></tr>
<tr><td><code id="fct_surrogate_quanti_+3A_patient_id">patient_id</code></td>
<td>
<p>Column name of the patient id column.</p>
</td></tr>
<tr><td><code id="fct_surrogate_quanti_+3A_encounter_id">encounter_id</code></td>
<td>
<p>Column name of the encounter id column.</p>
</td></tr>
<tr><td><code id="fct_surrogate_quanti_+3A_omega">omega</code></td>
<td>
<p>Constant for the extrema population definition.</p>
</td></tr>
<tr><td><code id="fct_surrogate_quanti_+3A_param">param</code></td>
<td>
<p>param of a previous train_phevis() result.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list
</p>

<ul>
<li><p> table - Main result: <code>data.frame</code> with the rolling variables and the surrogates
</p>
</li>
<li><p> param - the parameters for the standardisation of ICD and CUI
</p>
</li>
<li><p> roll_all - a subset of table with the rolling variables only
</p>
</li>
<li><p> quantile_vec - the quantile defining the extrema populations
</p>
</li></ul>


<hr>
<h2 id='ggindividual_plot'>ggindividual_plot</h2><span id='topic+ggindividual_plot'></span>

<h3>Description</h3>

<p>Plot individual predictions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ggindividual_plot(subject, time, gold_standard, prediction)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="ggindividual_plot_+3A_subject">subject</code></td>
<td>
<p>numeric vector subject id</p>
</td></tr>
<tr><td><code id="ggindividual_plot_+3A_time">time</code></td>
<td>
<p>numeric vector time or date</p>
</td></tr>
<tr><td><code id="ggindividual_plot_+3A_gold_standard">gold_standard</code></td>
<td>
<p>numeric vector of gold standard</p>
</td></tr>
<tr><td><code id="ggindividual_plot_+3A_prediction">prediction</code></td>
<td>
<p>numeric vector of prediction</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a ggplot graph
</p>


<h3>Examples</h3>

<pre><code class='language-R'>ggindividual_plot(subject = rep(1,10),
  time = 1:10,
  gold_standard = c(0,0,1,1,0,0,1,1,0,0),
  prediction = runif(n = 10, min = 0, max = 1))

</code></pre>

<hr>
<h2 id='matrix_exp_smooth'>matrix_exp_smooth</h2><span id='topic+matrix_exp_smooth'></span>

<h3>Description</h3>

<p>Function to accumulate the information with exponential decay.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>matrix_exp_smooth(half_life, df, date, patient_id, encounter_id)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="matrix_exp_smooth_+3A_half_life">half_life</code></td>
<td>
<p>Duration of accumulation. For a chronic disease you might chose Inf, for acute disease you might chose the duration of the disease.</p>
</td></tr>
<tr><td><code id="matrix_exp_smooth_+3A_df">df</code></td>
<td>
<p>Dataframe of the explanatory variables.</p>
</td></tr>
<tr><td><code id="matrix_exp_smooth_+3A_date">date</code></td>
<td>
<p>Vector of date. The date should be in a numeric format.</p>
</td></tr>
<tr><td><code id="matrix_exp_smooth_+3A_patient_id">patient_id</code></td>
<td>
<p>The vector of patient id</p>
</td></tr>
<tr><td><code id="matrix_exp_smooth_+3A_encounter_id">encounter_id</code></td>
<td>
<p>The vector of visit id</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data.frame object with both the raw variables and the accumulated ones.
</p>

<hr>
<h2 id='noising'>noising</h2><span id='topic+noising'></span>

<h3>Description</h3>

<p>Noise a matrix
</p>


<h3>Usage</h3>

<pre><code class='language-R'>noising(X_boot, p = 0.3)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="noising_+3A_x_boot">X_boot</code></td>
<td>
<p>matrix to perform noise on</p>
</td></tr>
<tr><td><code id="noising_+3A_p">p</code></td>
<td>
<p>amount of noise</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A noised matrix
</p>

<hr>
<h2 id='norm_var'>norm_var</h2><span id='topic+norm_var'></span>

<h3>Description</h3>

<p>Standardize a numeric variable
</p>


<h3>Usage</h3>

<pre><code class='language-R'>norm_var(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="norm_var_+3A_x">x</code></td>
<td>
<p>A numeric variable</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The standardized variable
</p>

<hr>
<h2 id='phenorm_longit_fit'>phenorm_longit_fit</h2><span id='topic+phenorm_longit_fit'></span>

<h3>Description</h3>

<p>Apply simplified 'PheNorm' algorithm on longitudinal data with bootstrap and noise.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phenorm_longit_fit(
  x_matrix,
  y_sur,
  ID,
  size = 10^5,
  seed = 1,
  p.noise = 0.3,
  do_sampling = TRUE,
  do_noise = TRUE,
  prob = NULL,
  calc.prob = TRUE,
  nAGQ = 0,
  glmer.control = glmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 2e+05))
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="phenorm_longit_fit_+3A_x_matrix">x_matrix</code></td>
<td>
<p>x matrix to sample, noise and predict on</p>
</td></tr>
<tr><td><code id="phenorm_longit_fit_+3A_y_sur">y_sur</code></td>
<td>
<p>surrogate with 3 values (0 and 1 the extremes and 3 middle patients)</p>
</td></tr>
<tr><td><code id="phenorm_longit_fit_+3A_id">ID</code></td>
<td>
<p>Vector of patient ID</p>
</td></tr>
<tr><td><code id="phenorm_longit_fit_+3A_size">size</code></td>
<td>
<p>size of sampling. default is 10^5</p>
</td></tr>
<tr><td><code id="phenorm_longit_fit_+3A_seed">seed</code></td>
<td>
<p>seed. default is 1.</p>
</td></tr>
<tr><td><code id="phenorm_longit_fit_+3A_p.noise">p.noise</code></td>
<td>
<p>noise probability parameter. default is .3.</p>
</td></tr>
<tr><td><code id="phenorm_longit_fit_+3A_do_sampling">do_sampling</code></td>
<td>
<p>should algorithm do sampling. default is TRUE.</p>
</td></tr>
<tr><td><code id="phenorm_longit_fit_+3A_do_noise">do_noise</code></td>
<td>
<p>should algorithm do noise. default is TRUE.</p>
</td></tr>
<tr><td><code id="phenorm_longit_fit_+3A_prob">prob</code></td>
<td>
<p>sampling probability during noising denoising step</p>
</td></tr>
<tr><td><code id="phenorm_longit_fit_+3A_calc.prob">calc.prob</code></td>
<td>
<p>should the 'prob' argument be calculated</p>
</td></tr>
<tr><td><code id="phenorm_longit_fit_+3A_nagq">nAGQ</code></td>
<td>
<p>glmer parameter</p>
</td></tr>
<tr><td><code id="phenorm_longit_fit_+3A_glmer.control">glmer.control</code></td>
<td>
<p>glmer parameter</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the fixed effects, the predicted responses and the model used (mixed effect or logistic regression)
</p>

<hr>
<h2 id='phenorm_longit_simpl'>phenorm_longit_simpl</h2><span id='topic+phenorm_longit_simpl'></span>

<h3>Description</h3>

<p>'PheNorm' like function adapted to longitudinal data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>phenorm_longit_simpl(
  df,
  var_surrogate,
  surrogates_quali,
  id_rnd,
  rf = FALSE,
  ntree = 100,
  bool_weight = FALSE,
  p.noise = 0.3,
  bool_SAFE = TRUE,
  size = 10^5
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="phenorm_longit_simpl_+3A_df">df</code></td>
<td>
<p>dataframe</p>
</td></tr>
<tr><td><code id="phenorm_longit_simpl_+3A_var_surrogate">var_surrogate</code></td>
<td>
<p>variables used for building the surrogates</p>
</td></tr>
<tr><td><code id="phenorm_longit_simpl_+3A_surrogates_quali">surrogates_quali</code></td>
<td>
<p>numeric vector of the qualitative surrogate</p>
</td></tr>
<tr><td><code id="phenorm_longit_simpl_+3A_id_rnd">id_rnd</code></td>
<td>
<p>ID for random effect</p>
</td></tr>
<tr><td><code id="phenorm_longit_simpl_+3A_rf">rf</code></td>
<td>
<p>should pseudo-labellisation with random forest be used (default is FALSE)</p>
</td></tr>
<tr><td><code id="phenorm_longit_simpl_+3A_ntree">ntree</code></td>
<td>
<p>number of tree for <code>randomforest</code> (default is 100)</p>
</td></tr>
<tr><td><code id="phenorm_longit_simpl_+3A_bool_weight">bool_weight</code></td>
<td>
<p>should the sampling probability balance the number of positive and negative extrema.</p>
</td></tr>
<tr><td><code id="phenorm_longit_simpl_+3A_p.noise">p.noise</code></td>
<td>
<p>percentage of noise introduced during the noising step</p>
</td></tr>
<tr><td><code id="phenorm_longit_simpl_+3A_bool_safe">bool_SAFE</code></td>
<td>
<p>A boolean. If TRUE, SAFE selection is done, else it is not (default is TRUE)</p>
</td></tr>
<tr><td><code id="phenorm_longit_simpl_+3A_size">size</code></td>
<td>
<p>minimum size of sampling</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the logistic model, the random forest model, the variables selected for prediction and the predictions
</p>

<hr>
<h2 id='PheVis-package'>PheVis: Automatic Phenotyping of Electronic Health Record at Visit Resolution</h2><span id='topic+PheVis'></span><span id='topic+PheVis-package'></span>

<h3>Description</h3>

<p>Using Electronic Health Record (EHR) is difficult because most of the time the true characteristic of the patient is not available. Instead we can retrieve the International Classification of Disease code related to the disease of interest or we can count the occurrence of the Unified Medical Language System. None of them is the true phenotype which needs chart review to identify. However chart review is time consuming and costly. 'PheVis' is an algorithm which is phenotyping (i.e identify a characteristic) at the visit level in an unsupervised fashion. It can be used for chronic or acute diseases. An example of how to use 'PheVis' is available in the vignette. Basically there are two functions that are to be used: 'train_phevis()' which trains the algorithm and 'test_phevis()' which get the predicted probabilities. The detailed method is described in preprint by Fert√© et al. (2020) <a href="https://doi.org/10.1101/2020.06.15.20131458">doi:10.1101/2020.06.15.20131458</a>.
</p>


<h3>Author(s)</h3>

<p><strong>Maintainer</strong>: Thomas Ferte <a href="mailto:thomas.ferte@u-bordeaux.fr">thomas.ferte@u-bordeaux.fr</a>
</p>
<p>Authors:
</p>

<ul>
<li><p> Boris P. Hejblum <a href="mailto:boris.hejblum@u-bordeaux.fr">boris.hejblum@u-bordeaux.fr</a>
</p>
</li></ul>


<hr>
<h2 id='pred_lme4model'>pred_lme4model</h2><span id='topic+pred_lme4model'></span>

<h3>Description</h3>

<p>function to predict probability from 'lme4' or 'glm' objects
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pred_lme4model(model = NULL, fe.model = NULL, df)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pred_lme4model_+3A_model">model</code></td>
<td>
<p>lme4 model</p>
</td></tr>
<tr><td><code id="pred_lme4model_+3A_fe.model">fe.model</code></td>
<td>
<p>the fixed effect of a model</p>
</td></tr>
<tr><td><code id="pred_lme4model_+3A_df">df</code></td>
<td>
<p>dataframe for prediction</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector of the predictions
</p>

<hr>
<h2 id='pretty_cv.glmnet'>pretty_cv.glmnet</h2><span id='topic+pretty_cv.glmnet'></span>

<h3>Description</h3>

<p>Train a 'glmnet' with cross validation (cv) model and return convenient results (model and results with non zero coefficients)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>pretty_cv.glmnet(
  x_glmnet,
  y,
  alpha = 1,
  family = "binomial",
  s = "lambda.1se",
  weights = rep(1, nrow(x_glmnet)),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="pretty_cv.glmnet_+3A_x_glmnet">x_glmnet</code></td>
<td>
<p>Independent variable matrix (X)</p>
</td></tr>
<tr><td><code id="pretty_cv.glmnet_+3A_y">y</code></td>
<td>
<p>Dependent variable vector (Y)</p>
</td></tr>
<tr><td><code id="pretty_cv.glmnet_+3A_alpha">alpha</code></td>
<td>
<p>alpha parameter of glmnet (default = 1)</p>
</td></tr>
<tr><td><code id="pretty_cv.glmnet_+3A_family">family</code></td>
<td>
<p>family parameter of glmnet (default = &quot;binomial&quot;)</p>
</td></tr>
<tr><td><code id="pretty_cv.glmnet_+3A_s">s</code></td>
<td>
<p>lambda chosen from cv.glmnet (default = &quot;lambda.1se&quot;)</p>
</td></tr>
<tr><td><code id="pretty_cv.glmnet_+3A_weights">weights</code></td>
<td>
<p>glmnet parameter</p>
</td></tr>
<tr><td><code id="pretty_cv.glmnet_+3A_...">...</code></td>
<td>
<p>additional parameters passed to glmnet</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list with the model, the coefficient associated with variables and the selected variables.
</p>

<hr>
<h2 id='roll_time_sum'>roll_time_sum</h2><span id='topic+roll_time_sum'></span>

<h3>Description</h3>

<p>Compute the cumulated information of what happened in past month and past year.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>roll_time_sum(
  id,
  id_encounter,
  var,
  start_date,
  win_size1 = 30,
  win_size2 = 365,
  name1 = "cum_month",
  name2 = "cum_year"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="roll_time_sum_+3A_id">id</code></td>
<td>
<p>Patient id numeric vector</p>
</td></tr>
<tr><td><code id="roll_time_sum_+3A_id_encounter">id_encounter</code></td>
<td>
<p>Encounter id vector</p>
</td></tr>
<tr><td><code id="roll_time_sum_+3A_var">var</code></td>
<td>
<p>Variable numeric vector</p>
</td></tr>
<tr><td><code id="roll_time_sum_+3A_start_date">start_date</code></td>
<td>
<p>Time numeric vector</p>
</td></tr>
<tr><td><code id="roll_time_sum_+3A_win_size1">win_size1</code></td>
<td>
<p>First window size (default is 30)</p>
</td></tr>
<tr><td><code id="roll_time_sum_+3A_win_size2">win_size2</code></td>
<td>
<p>Second window size (default is 365)</p>
</td></tr>
<tr><td><code id="roll_time_sum_+3A_name1">name1</code></td>
<td>
<p>name of first rolling var (default is &quot;cum_month&quot;)</p>
</td></tr>
<tr><td><code id="roll_time_sum_+3A_name2">name2</code></td>
<td>
<p>name of second rolling var (default is &quot;cum_year&quot;)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A dataframe containing the rolling variables.
</p>

<hr>
<h2 id='rolling_var'>rolling_var</h2><span id='topic+rolling_var'></span>

<h3>Description</h3>

<p>Compute rolling variables (last visit, last 5 visits, last month and last year)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rolling_var(id, var, start_date, id_encounter)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="rolling_var_+3A_id">id</code></td>
<td>
<p>Patient id numeric vector</p>
</td></tr>
<tr><td><code id="rolling_var_+3A_var">var</code></td>
<td>
<p>Variable numeric vector</p>
</td></tr>
<tr><td><code id="rolling_var_+3A_start_date">start_date</code></td>
<td>
<p>Time numeric vector</p>
</td></tr>
<tr><td><code id="rolling_var_+3A_id_encounter">id_encounter</code></td>
<td>
<p>Encounter id vector</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A dataframe containing the rolling variables.
</p>

<hr>
<h2 id='safe_selection'>safe_selection</h2><span id='topic+safe_selection'></span>

<h3>Description</h3>

<p>Select the variables from dataframe by removing the rare variables and apply 'SAFE' on it.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>safe_selection(
  df,
  var_surrogate,
  surrogate_quali,
  threshold = 0.05,
  alpha = 0.5,
  remove_var_surrogate = TRUE,
  bool_weight = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="safe_selection_+3A_df">df</code></td>
<td>
<p>dataframe</p>
</td></tr>
<tr><td><code id="safe_selection_+3A_var_surrogate">var_surrogate</code></td>
<td>
<p>variables used for building the surrogates</p>
</td></tr>
<tr><td><code id="safe_selection_+3A_surrogate_quali">surrogate_quali</code></td>
<td>
<p>surrogate with 3 values (0 and 1 the extremes and 3 middle patients)</p>
</td></tr>
<tr><td><code id="safe_selection_+3A_threshold">threshold</code></td>
<td>
<p>rareness threshold (default = 0.05).</p>
</td></tr>
<tr><td><code id="safe_selection_+3A_alpha">alpha</code></td>
<td>
<p>glmnet parameter (default is 0.5 elastic net)</p>
</td></tr>
<tr><td><code id="safe_selection_+3A_remove_var_surrogate">remove_var_surrogate</code></td>
<td>
<p>does the glmnet algorithm should learn on features in var_surrogate (default is TRUE).</p>
</td></tr>
<tr><td><code id="safe_selection_+3A_bool_weight">bool_weight</code></td>
<td>
<p>Should the glmnet function be weighted to balance the extrema populations (default is FALSE).</p>
</td></tr>
<tr><td><code id="safe_selection_+3A_...">...</code></td>
<td>
<p>arguments to pass to pretty_cv.glmnet</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list
</p>

<ul>
<li><p> glmnet_model - A list of three elements: the cv.glmnet fitted model, the coefficients of non zero variables and the vector of non zero coefficient variables.
</p>
</li>
<li><p> important_var - A vector with the variables used for the surrogate and the non zero variables.
</p>
</li>
<li><p> surrogate_quali - The surrogate_quali argument.
</p>
</li></ul>


<hr>
<h2 id='sur_exp_smooth'>sur_exp_smooth</h2><span id='topic+sur_exp_smooth'></span>

<h3>Description</h3>

<p>Function to cumulate surrogate with exponential decay
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sur_exp_smooth(half_life, sur, date, patient_id, encounter_id)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="sur_exp_smooth_+3A_half_life">half_life</code></td>
<td>
<p>Duration of cumulation. For a chronic disease you might chose Inf, for acute disease you might chose the duration of the disease.</p>
</td></tr>
<tr><td><code id="sur_exp_smooth_+3A_sur">sur</code></td>
<td>
<p>The quantitative surrogate.</p>
</td></tr>
<tr><td><code id="sur_exp_smooth_+3A_date">date</code></td>
<td>
<p>A numeric vector of time of days unit.</p>
</td></tr>
<tr><td><code id="sur_exp_smooth_+3A_patient_id">patient_id</code></td>
<td>
<p>Vector of patient ID</p>
</td></tr>
<tr><td><code id="sur_exp_smooth_+3A_encounter_id">encounter_id</code></td>
<td>
<p>Vector of encounter ID</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A dataframe with the cumulated surrogate.
</p>

<hr>
<h2 id='test_phevis'>test_phevis</h2><span id='topic+test_phevis'></span>

<h3>Description</h3>

<p>test_phevis
</p>


<h3>Usage</h3>

<pre><code class='language-R'>test_phevis(
  train_param,
  df_test,
  surparam,
  model,
  START_DATE,
  PATIENT_NUM,
  ENCOUNTER_NUM
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="test_phevis_+3A_train_param">train_param</code></td>
<td>
<p>Parameters for the model training (variables used, main ICD and CUIS, half_life, gold standard, omega). Usually obtained from train_phevis() function.</p>
</td></tr>
<tr><td><code id="test_phevis_+3A_df_test">df_test</code></td>
<td>
<p>The dataframe on which to make the prediction.</p>
</td></tr>
<tr><td><code id="test_phevis_+3A_surparam">surparam</code></td>
<td>
<p>The parameters used to compute the surrogate. Usually obtained by train_phevis() function.</p>
</td></tr>
<tr><td><code id="test_phevis_+3A_model">model</code></td>
<td>
<p>The random intercept logistic regression. Usually obtained by train_phevis() function.</p>
</td></tr>
<tr><td><code id="test_phevis_+3A_start_date">START_DATE</code></td>
<td>
<p>Column name of the time column. The time column should be numeric</p>
</td></tr>
<tr><td><code id="test_phevis_+3A_patient_num">PATIENT_NUM</code></td>
<td>
<p>Column name of the patient id column.</p>
</td></tr>
<tr><td><code id="test_phevis_+3A_encounter_num">ENCOUNTER_NUM</code></td>
<td>
<p>Column name of the encounter id column.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A dataframe with the predictions.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
library(PRROC)
PheVis::data_phevis
PheVis::data_perf

var_vec &lt;- c(paste0("var",1:10), "mainCUI", "mainICD")
main_icd &lt;- "mainICD"
main_cui &lt;- "mainCUI"
GS &lt;- "PR_state"
half_life &lt;- Inf

df &lt;- data_phevis %&gt;%
        mutate(ENCOUNTER_NUM = row_number(),
               time = round(as.numeric(time)))

trainsize &lt;- 0.8*length(unique(df$subject))
trainid &lt;- sample(x = unique(df$subject), size = trainsize)
testid &lt;- unique(df$subject)[!unique(df$subject) %in% trainid]

df_train &lt;- as.data.frame(df[df$subject %in% trainid,])
df_test &lt;- as.data.frame(df[df$subject %in% testid,])

##### train and test model #####
train_model &lt;- PheVis::train_phevis(half_life = half_life,
                                    df = df_train,
                                    START_DATE = "time",
                                    PATIENT_NUM = "subject",
                                    ENCOUNTER_NUM = "ENCOUNTER_NUM",
                                    var_vec = var_vec,
                                    main_icd = main_icd,
                                    main_cui = main_cui)

test_perf &lt;- PheVis::test_phevis(train_param = train_model$train_param,
                                 df_test = df_test,
                                 START_DATE = "time",
                                 PATIENT_NUM = "subject",
                                 ENCOUNTER_NUM = "ENCOUNTER_NUM",
                                 surparam = train_model$surparam,
                                 model = train_model$model)

pr_curve &lt;-PRROC::pr.curve(scores.class0 = test_perf$df_result$PREDICTION,
                           weights.class0 = df_test$PR_state)

roc_curve &lt;- PRROC::roc.curve(scores.class0 = test_perf$df_result$PREDICTION,
                              weights.class0 = df_test$PR_state)

</code></pre>

<hr>
<h2 id='train_phevis'>train_phevis</h2><span id='topic+train_phevis'></span>

<h3>Description</h3>

<p>Global function to train phevis model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>train_phevis(
  half_life,
  df,
  START_DATE,
  PATIENT_NUM,
  ENCOUNTER_NUM,
  var_vec,
  main_icd,
  main_cui,
  rf = TRUE,
  p.noise = 0.3,
  bool_SAFE = TRUE,
  omega = 2,
  GS = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="train_phevis_+3A_half_life">half_life</code></td>
<td>
<p>Duration of cumulation. For a chronic disease you might chose Inf, for acute disease you might chose the duration of the disease.</p>
</td></tr>
<tr><td><code id="train_phevis_+3A_df">df</code></td>
<td>
<p><code>data.frame</code> containing all the variables.</p>
</td></tr>
<tr><td><code id="train_phevis_+3A_start_date">START_DATE</code></td>
<td>
<p>Column name of the time column. The time column should be numeric</p>
</td></tr>
<tr><td><code id="train_phevis_+3A_patient_num">PATIENT_NUM</code></td>
<td>
<p>Column name of the patient id column.</p>
</td></tr>
<tr><td><code id="train_phevis_+3A_encounter_num">ENCOUNTER_NUM</code></td>
<td>
<p>Column name of the encounter id column.</p>
</td></tr>
<tr><td><code id="train_phevis_+3A_var_vec">var_vec</code></td>
<td>
<p>Explanatory variables used for the prediction, including the main variables.</p>
</td></tr>
<tr><td><code id="train_phevis_+3A_main_icd">main_icd</code></td>
<td>
<p>Character vector of the column names of the main ICD codes.</p>
</td></tr>
<tr><td><code id="train_phevis_+3A_main_cui">main_cui</code></td>
<td>
<p>Character vector of the column names of the main CUIs.</p>
</td></tr>
<tr><td><code id="train_phevis_+3A_rf">rf</code></td>
<td>
<p>should pseudo-labellisation with random forest be used (default is true)</p>
</td></tr>
<tr><td><code id="train_phevis_+3A_p.noise">p.noise</code></td>
<td>
<p>percentage of noise introduced during the noising step (default is 0.3)</p>
</td></tr>
<tr><td><code id="train_phevis_+3A_bool_safe">bool_SAFE</code></td>
<td>
<p>A boolean. If TRUE, SAFE selection is done, else it is not (default is TRUE)</p>
</td></tr>
<tr><td><code id="train_phevis_+3A_omega">omega</code></td>
<td>
<p>Constant for the extrema population definition (default is 2)</p>
</td></tr>
<tr><td><code id="train_phevis_+3A_gs">GS</code></td>
<td>
<p>Character string corresponding to the name of the gold-standard variable (default is null for which a vector of 0 will be taken).</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A list
</p>

<ul>
<li><p> surparam - the parameters used to compute the surrogate
</p>
</li>
<li><p> model - the random intercept logistic regression
</p>
</li>
<li><p> df_train_result - the <code>data.frame</code> containing the output predictions
</p>
</li>
<li><p> train_param - parameters for the model training (variables used, main ICD and CUIS, half_life, gold standard)
</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
PheVis::data_phevis
df &lt;- data_phevis %&gt;%
         mutate(ENCOUNTER_NUM = row_number(),
         time = round(as.numeric(time)))
model &lt;- PheVis::train_phevis(half_life = Inf,
         df = df,
         START_DATE = "time",
         PATIENT_NUM = "subject",
         ENCOUNTER_NUM = "ENCOUNTER_NUM",
         var_vec = c(paste0("var",1:10), "mainCUI", "mainICD"),
         main_icd = "mainICD",
         main_cui = "mainCUI")

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
