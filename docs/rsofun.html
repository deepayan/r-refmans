<!DOCTYPE html><html lang="en"><head><title>Help for package rsofun</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {rsofun}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#biomee_gs_leuning_drivers'><p>rsofun BiomeE driver data (Leuning photosynthesis model)</p></a></li>
<li><a href='#biomee_gs_leuning_output'><p>rsofun BiomeE (gs_leuning) output data</p></a></li>
<li><a href='#biomee_p_model_drivers'><p>rsofun BiomeE driver data (P-model photosynthesis model)</p></a></li>
<li><a href='#biomee_p_model_output'><p>rsofun BiomeE (P-model) output data</p></a></li>
<li><a href='#biomee_validation'><p>rsofun BiomeE targets validation data</p></a></li>
<li><a href='#calib_sofun'><p>Calibrates SOFUN model parameters</p></a></li>
<li><a href='#cost_likelihood_biomee'><p>Log-likelihood cost function for BiomeE with different targets</p></a></li>
<li><a href='#cost_likelihood_pmodel'><p>Cost function computing a log-likelihood for calibration of P-model</p>
parameters</a></li>
<li><a href='#cost_rmse_biomee'><p>RMSE cost function for BiomeE</p></a></li>
<li><a href='#cost_rmse_pmodel'><p>Cost function computing RMSE for calibration of P-model parameters</p></a></li>
<li><a href='#init_dates_dataframe'><p>Initialises a tibble with dates</p></a></li>
<li><a href='#p_model_drivers'><p>rsofun P-model driver data</p></a></li>
<li><a href='#p_model_drivers_vcmax25'><p>rsofun P-model driver data (for leaf traits)</p></a></li>
<li><a href='#p_model_output'><p>rsofun P-model output data</p></a></li>
<li><a href='#p_model_output_vcmax25'><p>rsofun P-model output data (using vcmax25 drivers)</p></a></li>
<li><a href='#p_model_validation'><p>rsofun P-model GPP validation data</p></a></li>
<li><a href='#p_model_validation_vcmax25'><p>rsofun P-model Vcmax25 validation data</p></a></li>
<li><a href='#run_biomee_f_bysite'><p>Run BiomeE (R wrapper)</p></a></li>
<li><a href='#run_pmodel_f_bysite'><p>R wrapper for SOFUN P-model</p></a></li>
<li><a href='#runread_biomee_f'><p>Run BiomeE</p></a></li>
<li><a href='#runread_pmodel_f'><p>Run the P-model</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>The P-Model and BiomeE Modelling Framework</td>
</tr>
<tr>
<td>Version:</td>
<td>5.0.0</td>
</tr>
<tr>
<td>Description:</td>
<td>Implements the Simulating Optimal FUNctioning framework for 
              site-scale simulations of ecosystem processes, including model 
              calibration. It contains 'Fortran 90' modules for the P-model (Stocker
              et al. (2020) &lt;<a href="https://doi.org/10.5194%2Fgmd-13-1545-2020">doi:10.5194/gmd-13-1545-2020</a>&gt;), SPLASH
              (Davis et al. (2017) &lt;<a href="https://doi.org/10.5194%2Fgmd-10-689-2017">doi:10.5194/gmd-10-689-2017</a>&gt;)
              and BiomeE (Weng et al. (2015)
              &lt;<a href="https://doi.org/10.5194%2Fbg-12-2655-2015">doi:10.5194/bg-12-2655-2015</a>&gt;).</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/geco-bern/rsofun">https://github.com/geco-bern/rsofun</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/geco-bern/rsofun/issues">https://github.com/geco-bern/rsofun/issues</a></td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 4.1.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>dplyr, purrr, tidyr, magrittr, GenSA, BayesianTools,
multidplyr, stats, utils</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>LazyDataCompression:</td>
<td>xz</td>
</tr>
<tr>
<td>ByteCompile:</td>
<td>true</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>yes</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>Suggests:</td>
<td>covr, rcmdcheck, testthat, rmarkdown, ggplot2, knitr,
sensitivity</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-11-28 13:06:16 UTC; mmarcadella</td>
</tr>
<tr>
<td>Author:</td>
<td>Benjamin Stocker <a href="https://orcid.org/0000-0003-2697-9096"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Koen Hufkens <a href="https://orcid.org/0000-0002-5070-8109"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Josefa Arán Paredes
    <a href="https://orcid.org/0009-0006-7176-2311"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut],
  Laura Marqués <a href="https://orcid.org/0000-0002-3593-5557"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Mayeul Marcadella <a href="https://orcid.org/0000-0001-8555-3808"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Ensheng Weng <a href="https://orcid.org/0000-0002-1858-4847"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Fabian Bernhard <a href="https://orcid.org/0000-0003-0338-0961"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  Geocomputation and Earth Observation, University of Bern [cph, fnd]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Benjamin Stocker &lt;benjamin.stocker@gmail.com&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-11-28 23:10:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='biomee_gs_leuning_drivers'>rsofun BiomeE driver data (Leuning photosynthesis model)</h2><span id='topic+biomee_gs_leuning_drivers'></span>

<h3>Description</h3>

<p>Small dataset representing the driver to run the BiomeE-model at the CH-LAE site
using the Leuning photosynthesis specification (and half-hourly time step)
It can also be used together with leaf trait data from CH-LAE (<code><a href="#topic+biomee_validation">biomee_validation</a></code>) 
to optimize model parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>biomee_gs_leuning_drivers
</code></pre>


<h3>Format</h3>

<p>A tibble of driver data.
</p>

<dl>
<dt>sitename</dt><dd><p>Site name</p>
</dd>
<dt>params_siml</dt><dd><p>Simulation parameters as a data.frame, including
the following data:
</p>

<dl>
<dt>spinup</dt><dd><p>Flag indicating whether this simulation does spin-up.</p>
</dd>
<dt>spinupyears</dt><dd><p>Number of spin-up years.</p>
</dd>
<dt>recycle</dt><dd><p>Length of standard recycling period (years).</p>
</dd>
<dt>firstyeartrend</dt><dd><p>First transient year.</p>
</dd>
<dt>nyeartrend</dt><dd><p>Number of transient years.</p>
</dd>
<dt>steps_per_day</dt><dd><p>Time resolution (day-1).</p>
</dd>
<dt>do_U_shaped_mortality</dt><dd><p>Flag indicating whether U-shaped
mortality is used.</p>
</dd>
<dt>update_annualLAImax</dt><dd><p>Flag indicating whether updating
LAImax according to mineral N in soil.</p>
</dd>
<dt>do_closedN_run</dt><dd><p>Flag indicating whether doing N closed
runs to recover N balance enforcing 0.2 kg N m-2 in the inorganic N pool.</p>
</dd>
<dt>code_method_photosynth</dt><dd><p>String specifying the method of photosynthesis
used in the model, either &quot;pmodel&quot; or &quot;gs_leuning&quot;.document()</p>
</dd>
<dt>code_method_mortality</dt><dd><p>String indicating the type of mortality in the
model. One of the following: &quot;dbh&quot; is size-dependent mortality, &quot;const_selfthin&quot;
is constant self thinning (in development), &quot;cstarvation&quot; is carbon starvation, and
&quot;growthrate&quot; is growth rate dependent mortality.</p>
</dd>
</dl>
</dd>
<dt>site_info</dt><dd><p>Site meta info in a data.frame.
This data structure can be freely used for documenting the dataset, but must include at least the following data:
</p>

<dl>
<dt>lon</dt><dd><p>Longitude of the site location.</p>
</dd>
<dt>lat</dt><dd><p>Latitude of the site location.</p>
</dd>
<dt>elv</dt><dd><p>Elevation of the site location, in meters.</p>
</dd>
</dl>
</dd>
<dt>forcing</dt><dd><p>Forcing data.frame used as input
</p>

<dl>
<dt>ppfd</dt><dd><p>Photosynthetic photon flux density (mol s-1 m-2)</p>
</dd>
<dt>tair</dt><dd><p>Air temperature (deg C)</p>
</dd>
<dt>vpd</dt><dd><p>Vapor pressure deficit (Pa)</p>
</dd>
<dt>rain</dt><dd><p>Precipitation (kgH2O m-2 s-1 == mm s-1)</p>
</dd>
<dt>wind</dt><dd><p>Wind velocity (m s-1)</p>
</dd>
<dt>pair</dt><dd><p>Atmospheric pressure (pa)</p>
</dd>
<dt>co2</dt><dd><p>CO2 atmospheric concentration (ppm)</p>
</dd>
</dl>
</dd>
<dt>params_tile</dt><dd><p>Tile-level model parameters, into a single row data.frame, including
the following data:
</p>

<dl>
<dt>soiltype</dt><dd><p>Integer indicating the type of soil: Sand = 1, LoamySand = 2,
SandyLoam = 3, SiltLoam = 4, FrittedClay = 5, Loam = 6, Clay = 7.</p>
</dd>
<dt>FLDCAP</dt><dd><p>Field capacity (vol/vol). Water remaining in a soil after it
has been thoroughly saturated and allowed to drain freely.</p>
</dd>
<dt>WILTPT</dt><dd><p>Wilting point (vol/vol). Water content of a soil at which
plants wilt and fail to recover.</p>
</dd>
<dt>K1</dt><dd><p>Fast soil C decomposition rate (year<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>K2</dt><dd><p>Slow soil C decomposition rate (year<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>K_nitrogen</dt><dd><p>Mineral Nitrogen turnover rate (year<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>MLmixRatio</dt><dd><p>Ratio of C and N returned to litters from microbes.</p>
</dd>
<dt>etaN</dt><dd><p>N loss rate through runoff (organic and mineral) (year<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>LMAmin</dt><dd><p>Minimum LMA, leaf mass per unit area, kg C m<code class="reqn">^{-2}</code>.</p>
</dd>
<dt>fsc_fine</dt><dd><p>Fraction of fast turnover carbon in fine biomass.</p>
</dd>
<dt>fsc_wood</dt><dd><p>Fraction of fast turnover carbon in wood biomass.</p>
</dd>
<dt>GR_factor</dt><dd><p>Growth respiration factor.</p>
</dd>
<dt>l_fract</dt><dd><p>Fraction of the carbon retained after leaf drop.</p>
</dd>
<dt>retransN</dt><dd><p>Retranslocation coefficient of nitrogen.</p>
</dd>
<dt>f_initialBSW</dt><dd><p>Coefficient for setting up initial sapwood.</p>
</dd>
<dt>f_N_add</dt><dd><p>Re-fill of N for sapwood.</p>
</dd>
<dt>tf_base</dt><dd><p>Calibratable scalar for respiration, used to increase LUE
levels.</p>
</dd>
<dt>par_mort</dt><dd><p>Canopy mortality parameter.</p>
</dd>
<dt>par_mort_under</dt><dd><p>Parameter for understory mortality.</p>
</dd>
</dl>
</dd>
<dt>params_species</dt><dd><p>A data.frame containing species-specific model parameters,
with one species per row, including the following data:
</p>

<dl>
<dt>lifeform</dt><dd><p>Integer set to 0 for grasses and 1 for trees.</p>
</dd>
<dt>phenotype</dt><dd><p>Integer set to 0 for deciduous and 1 for evergreen.</p>
</dd>
<dt>pt</dt><dd><p>Integer indicating the type of plant according to photosynthesis:
0 for C3; 1 for C4</p>
</dd>
<dt>alpha_FR</dt><dd><p>Fine root turnonver rate (year<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>rho_FR</dt><dd><p>Material density of fine roots (kg C m<code class="reqn">^{-3}</code>).</p>
</dd>
<dt>root_r</dt><dd><p>Radius of the fine roots, in m.</p>
</dd>
<dt>root_zeta</dt><dd><p>e-folding parameter of root vertical distribution, in m.</p>
</dd>
<dt>Kw_root</dt><dd><p>Fine root water conductivity (mol m<code class="reqn">^{-2}</code>
s<code class="reqn">^{-1}</code> MPa<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>leaf_size</dt><dd><p>Characteristic leaf size.</p>
</dd>
<dt>Vmax</dt><dd><p>Max RuBisCo rate, in mol m<code class="reqn">^{-2}</code> s<code class="reqn">^{-1}</code>.</p>
</dd>
<dt>Vannual</dt><dd><p>Annual productivity per unit area at full sun (kg C
m<code class="reqn">^{-2}</code> year<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>wet_leaf_dreg</dt><dd><p>Wet leaf photosynthesis down-regulation.</p>
</dd>
<dt>m_cond</dt><dd><p>Factor of stomatal conductance.</p>
</dd>
<dt>alpha_phot</dt><dd><p>Photosynthesis efficiency.</p>
</dd>
<dt>gamma_L</dt><dd><p>Leaf respiration coefficient, in year<code class="reqn">^{-1}</code>.</p>
</dd>
<dt>gamma_LN</dt><dd><p>Leaf respiration coefficient per unit N.</p>
</dd>
<dt>gamma_SW</dt><dd><p>Sapwood respiration rate, in kg C m<code class="reqn">^{-2}</code> year<code class="reqn">^{-1}</code>.</p>
</dd>
<dt>gamma_FR</dt><dd><p>Fine root respiration rate, kg C kg C<code class="reqn">^{-1}</code>
year<code class="reqn">^{-1}</code>.</p>
</dd>
<dt>tc_crit</dt><dd><p>Critical temperature triggerng offset of phenology, in Kelvin.</p>
</dd>
<dt>tc_crit_on</dt><dd><p>Critical temperature triggerng onset of phenology, in Kelvin.</p>
</dd>
<dt>gdd_crit</dt><dd><p>Critical value of GDD5 for turning ON growth season.</p>
</dd>
<dt>betaON</dt><dd><p>Critical soil moisture for phenology onset.</p>
</dd>
<dt>betaOFF</dt><dd><p>Critical soil moisture for phenology offset.</p>
</dd>
<dt>seedlingsize</dt><dd><p>Initial size of seedlings, in kg C per individual.</p>
</dd>
<dt>LNbase</dt><dd><p>Basal leaf N per unit area, in kg N m<code class="reqn">^{-2}</code>.</p>
</dd>
<dt>lAImax</dt><dd><p>Maximum crown LAI (leaf area index).</p>
</dd>
<dt>Nfixrate0</dt><dd><p>Reference N fixation rate (kg N kg C<code class="reqn">^{-1}</code> root).</p>
</dd>
<dt>NfixCost0</dt><dd><p>Carbon cost of N fixation (kg C kg N<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>phiCSA</dt><dd><p>Ratio of sapwood area to leaf area.</p>
</dd>
<dt>mortrate_d_c</dt><dd><p>Canopy tree mortality rate (year<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>mortrate_d_u</dt><dd><p>Understory tree mortality rate (year<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>maturalage</dt><dd><p>Age at which trees can reproduce (years).</p>
</dd>
<dt>v_seed</dt><dd><p>Fraction of G_SF to G_F.</p>
</dd>
<dt>fNSmax</dt><dd><p>Multiplier for NSNmax as sum of potential bl and br.</p>
</dd>
<dt>LMA</dt><dd><p>Leaf mass per unit area (kg C m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>rho_wood</dt><dd><p>Wood density (kg C m<code class="reqn">^{-3}</code>).</p>
</dd>
<dt>alphaBM</dt><dd><p>Coefficient for allometry (biomass = alphaBM * DBH ** thetaBM).</p>
</dd>
<dt>thetaBM</dt><dd><p>Coefficient for allometry (biomass = alphaBM * DBH ** thetaBM).</p>
</dd>
<dt>kphio</dt><dd><p>Quantum yield efficiency <code class="reqn">\varphi_0</code>,
in mol mol<code class="reqn">^{-1}</code>.</p>
</dd>
<dt>phiRL</dt><dd><p>Ratio of fine root to leaf area.</p>
</dd>
<dt>LAI_light</dt><dd><p>Maximum LAI limited by light.</p>
</dd>
</dl>
</dd>
<dt>init_cohort</dt><dd><p>A data.frame of initial cohort specifications, including
the following data:
</p>

<dl>
<dt>init_cohort_species</dt><dd><p>Index of a species described in param_species.</p>
</dd>
<dt>init_cohort_nindivs</dt><dd><p>Initial individual density, in individuals per
m<code class="reqn">^{2}</code>.</p>
</dd>
<dt>init_cohort_bsw</dt><dd><p>Initial biomass of sapwood, in kg C per individual.</p>
</dd>
<dt>init_cohort_bHW</dt><dd><p>Initial biomass of heartwood, in kg C per tree.</p>
</dd>
<dt>init_cohort_nsc</dt><dd><p>Initial non-structural biomass.</p>
</dd>
</dl>
</dd>
<dt>init_soil</dt><dd><p>A data.frame of initial soil pools, including
the following data:
</p>

<dl>
<dt>init_fast_soil_C</dt><dd><p>Initial fast soil carbon, in kg C m<code class="reqn">^{-2}</code>.</p>
</dd>
<dt>init_slow_soil_C</dt><dd><p>Initial slow soil carbon, in kg C m<code class="reqn">^{-2}</code>.</p>
</dd>
<dt>init_Nmineral</dt><dd><p>Mineral nitrogen pool, in kg N m<code class="reqn">^{-2}</code>.</p>
</dd>
<dt>N_input</dt><dd><p>Annual nitrogen input to soil N pool, in kg N m<code class="reqn">^{-2}</code>
year<code class="reqn">^{-1}</code>.</p>
</dd>
</dl>
</dd>
</dl>


<hr>
<h2 id='biomee_gs_leuning_output'>rsofun BiomeE (gs_leuning) output data</h2><span id='topic+biomee_gs_leuning_output'></span>

<h3>Description</h3>

<p>Example output dataset from a BiomeE-model run (gs_leuning)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>biomee_gs_leuning_output
</code></pre>


<h3>Format</h3>

<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 1 rows and 2 columns.
</p>

<hr>
<h2 id='biomee_p_model_drivers'>rsofun BiomeE driver data (P-model photosynthesis model)</h2><span id='topic+biomee_p_model_drivers'></span>

<h3>Description</h3>

<p>Small dataset representing the driver to run the BiomeE-model at the CH-LAE site
using the P-model photosynthesis specification (and daily time step).
It can also be used together with leaf trait data from CH-LAE (<code><a href="#topic+biomee_validation">biomee_validation</a></code>) 
to optimize model parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>biomee_p_model_drivers
</code></pre>


<h3>Format</h3>

<p>See <code><a href="#topic+biomee_gs_leuning_drivers">biomee_gs_leuning_drivers</a></code>
</p>

<hr>
<h2 id='biomee_p_model_output'>rsofun BiomeE (P-model) output data</h2><span id='topic+biomee_p_model_output'></span>

<h3>Description</h3>

<p>Example output dataset from a BiomeE-model run (p-model)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>biomee_p_model_output
</code></pre>


<h3>Format</h3>

<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 1 rows and 2 columns.
</p>

<hr>
<h2 id='biomee_validation'>rsofun BiomeE targets validation data</h2><span id='topic+biomee_validation'></span>

<h3>Description</h3>

<p>Small example dataset of target observations (leaf trait data) at the CH-LAE site
to optimize model parameters with the function <code><a href="#topic+calib_sofun">calib_sofun</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>biomee_validation
</code></pre>


<h3>Format</h3>

<p>A tibble of validation data:
</p>

<dl>
<dt>sitename</dt><dd><p>site name</p>
</dd>
<dt>data</dt><dd><p>validation data</p>
</dd>
</dl>



<h3>Source</h3>

<p>Lukas Hörtnagl,  Werner Eugster,  Nina Buchmann,  Eugenie Paul-Limoges,  Sophia Etzold,  Matthias Haeni,  Peter Pluess,  Thomas Baur  (2004-2014)
FLUXNET2015 CH-Lae Laegern,
Dataset. https://doi.org/10.18140/FLX/1440134
</p>

<hr>
<h2 id='calib_sofun'>Calibrates SOFUN model parameters</h2><span id='topic+calib_sofun'></span>

<h3>Description</h3>

<p>This is the main function that handles the 
calibration of SOFUN model parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>calib_sofun(drivers, obs, settings, optim_out = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="calib_sofun_+3A_drivers">drivers</code></td>
<td>
<p>A data frame with driver data. See <code><a href="#topic+p_model_drivers">p_model_drivers</a></code>
for a description of the data structure.</p>
</td></tr>
<tr><td><code id="calib_sofun_+3A_obs">obs</code></td>
<td>
<p>A data frame containing observational data used for model
calibration. See <code><a href="#topic+p_model_validation">p_model_validation</a></code> for a description of the data
structure.</p>
</td></tr>
<tr><td><code id="calib_sofun_+3A_settings">settings</code></td>
<td>
<p>A list containing model calibration settings. 
See the 'P-model usage' vignette for more information and examples.
</p>

<dl>
<dt><code>method</code></dt><dd><p>A string indicating the optimization method, either <code>'GenSA'</code>
or <code>'BayesianTools'</code>.</p>
</dd>
<dt><code>par</code></dt><dd><p>A list of model parameters. For each parameter, an initial value 
and lower and upper bounds should be provided. The calibratable parameters
include model parameters 'kphio', 'kphio_par_a', 'kphio_par_b', 'soilm_thetastar',
'soilm_betao', 'beta_costunitratio', 'rd_to_vcmax', 'tau_acclim', 'kc_jmax'
and 'rootzone_whc' , and (if
doing Bayesian calibration) error parameters
for each target variable, named for example 'err_gpp'. This list must match
the input parameters of the calibration metric and the parameters should be
given in the order above.</p>
</dd>
<dt><code>metric</code></dt><dd><p>A cost function. See the 'Cost functions for parameter
calibration' vignette for examples.</p>
</dd>
<dt><code>control</code></dt><dd><p>A list of arguments passed on to the optimization function.
If <code>method = 'GenSA'</code>, see <a href="GenSA.html#topic+GenSA">GenSA</a>. If <code>method = 'BayesianTools'</code>
the list should include at least <code>settings</code> and <code>sampler</code>, see
<a href="BayesianTools.html#topic+runMCMC">BayesianTools::runMCMC</a>.</p>
</dd>
</dl>
</td></tr>
<tr><td><code id="calib_sofun_+3A_optim_out">optim_out</code></td>
<td>
<p>A logical indicating whether the function returns the raw
output of the optimization functions (defaults to TRUE).</p>
</td></tr>
<tr><td><code id="calib_sofun_+3A_...">...</code></td>
<td>
<p>Optional arguments passed on to the cost function specified as
<code>settings$metric</code>. 
.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A named list containing the calibrated parameter vector 'par' and
the output object from the optimization 'mod'. For more details on this
output and how to evaluate it, see <a href="BayesianTools.html#topic+runMCMC">runMCMC</a> (also
<a href="https://florianhartig.github.io/BayesianTools/articles/BayesianTools.html">this post</a>)
and <a href="GenSA.html#topic+GenSA">GenSA</a>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Fix model parameters that won't be calibrated
params_fix &lt;- list(
  kphio_par_a        = 0,
  kphio_par_b        = 1.0,
  soilm_thetastar    = 0.6*240,
  soilm_betao        = 0.01,
  beta_unitcostratio = 146,
  rd_to_vcmax        = 0.014,
  tau_acclim         = 30,
  kc_jmax            = 0.41
)

# Define calibration settings
settings &lt;- list(
  method = "BayesianTools",
  par = list(
    kphio = list(lower=0.04, upper=0.09, init=0.05),
    err_gpp = list(lower = 0.01, upper = 4, init = 2)
  ),
  metric = rsofun::cost_likelihood_pmodel,
  control = list(
    sampler = "DEzs",
    settings = list(
      nrChains = 1,
      burnin = 0,        
      iterations = 50     # kept artificially low
    )
  )
 )
 
 # Run the calibration for GPP data
 calib_output &lt;- rsofun::calib_sofun(
   drivers = rsofun::p_model_drivers,
   obs = rsofun::p_model_validation,
   settings = settings,
   # extra arguments for the cost function
   par_fixed = params_fix,
   targets = c("gpp")
 )
</code></pre>

<hr>
<h2 id='cost_likelihood_biomee'>Log-likelihood cost function for BiomeE with different targets</h2><span id='topic+cost_likelihood_biomee'></span>

<h3>Description</h3>

<p>Cost function for parameter calibration, which
computes the log-likelihood for the biomee model fitting several target 
variables for a given set of parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cost_likelihood_biomee(par, obs, drivers, targets)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cost_likelihood_biomee_+3A_par">par</code></td>
<td>
<p>A vector containing parameter values for <code>'phiRL',
'LAI_light', 'tf_base', 'par_mort'</code> in that order, and for the error terms
corresponding to the target variables, e.g. <code>'err_GPP'</code> if GPP is a target. 
Make sure that
the order of the error terms in <code>par</code> coincides with the order provided in
the <code>targets</code> argument.</p>
</td></tr>
<tr><td><code id="cost_likelihood_biomee_+3A_obs">obs</code></td>
<td>
<p>A nested data frame of observations, following the structure of <code>biomee_validation</code>,
for example.</p>
</td></tr>
<tr><td><code id="cost_likelihood_biomee_+3A_drivers">drivers</code></td>
<td>
<p>A nested data frame of driver data, for example <code>biomee_gs_leuning_drivers</code>.</p>
</td></tr>
<tr><td><code id="cost_likelihood_biomee_+3A_targets">targets</code></td>
<td>
<p>A character vector indicating the target variables for which the
optimization will be done. This should be a subset of <code>c("GPP", "LAI",
"Density", "Biomass")</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The cost function performs a BiomeE model run for the value of
<code>par</code> given as argument. The likelihood is calculated assuming that the 
predicted targets are independent, normally distributed and centered on the observations. 
The optimization 
should be run using <code>BayesianTools</code>, so the likelihood is maximized.
</p>


<h3>Value</h3>

<p>The log-likelihood of the simulated 
targets by the biomee model versus the observed targets.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Compute the likelihood for a set of
# BiomeE model parameter values
# and the example data
cost_likelihood_biomee(
 par = c(3.5, 3.5, 1, 1,    # model params
         0.5),              # err_GPP
 obs = biomee_validation,
 drivers = biomee_gs_leuning_drivers,
 targets = c("GPP")
)

</code></pre>

<hr>
<h2 id='cost_likelihood_pmodel'>Cost function computing a log-likelihood for calibration of P-model
parameters</h2><span id='topic+cost_likelihood_pmodel'></span>

<h3>Description</h3>

<p>The cost function performs a P-model run for the input drivers and model parameter
values, and computes the outcome's normal log-likelihood centered at the input
observed values and with standard deviation given as an input parameter 
(calibratable).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cost_likelihood_pmodel(
  par,
  obs,
  drivers,
  targets,
  par_fixed = NULL,
  parallel = FALSE,
  ncores = 2
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cost_likelihood_pmodel_+3A_par">par</code></td>
<td>
<p>A vector of values for the parameters to be calibrated, including
a subset of model parameters (described in <code><a href="#topic+runread_pmodel_f">runread_pmodel_f</a></code>),
in order, and error terms
for each target variable (for example <code>'gpp_err'</code>), in the same order as
the targets appear in <code>targets</code>.</p>
</td></tr>
<tr><td><code id="cost_likelihood_pmodel_+3A_obs">obs</code></td>
<td>
<p>A nested data.frame of observations, with columns <code>'sitename'</code>
and <code>'data'</code> (see <code><a href="#topic+p_model_validation">p_model_validation</a></code> or <code><a href="#topic+p_model_validation_vcmax25">p_model_validation_vcmax25</a></code>
to check their structure).</p>
</td></tr>
<tr><td><code id="cost_likelihood_pmodel_+3A_drivers">drivers</code></td>
<td>
<p>A nested data.frame of driver data. See <code><a href="#topic+p_model_drivers">p_model_drivers</a></code>
for a description of the data structure.</p>
</td></tr>
<tr><td><code id="cost_likelihood_pmodel_+3A_targets">targets</code></td>
<td>
<p>A character vector indicating the target variables for which the
optimization will be done and the RMSE computed. This string must be a column 
name of the <code>data</code> data.frame belonging to the validation nested data.frame 
(for example 'gpp').</p>
</td></tr>
<tr><td><code id="cost_likelihood_pmodel_+3A_par_fixed">par_fixed</code></td>
<td>
<p>A named list of model parameter values to keep fixed during the
calibration. These should complement the input <code>par</code> such that all model
parameters are passed on to <code><a href="#topic+runread_pmodel_f">runread_pmodel_f</a></code>.</p>
</td></tr>
<tr><td><code id="cost_likelihood_pmodel_+3A_parallel">parallel</code></td>
<td>
<p>A logical specifying whether simulations are to be parallelised
(sending data from a certain number of sites to each core). Defaults to
<code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="cost_likelihood_pmodel_+3A_ncores">ncores</code></td>
<td>
<p>An integer specifying the number of cores used for parallel
computing. Defaults to 2.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>To run the P-model, all model parameters must be given. The cost
function uses arguments <code>par</code> and <code>par_fixed</code> such that, in the
calibration routine, <code>par</code> can be updated by the optimizer and 
<code>par_fixed</code> are kept unchanged throughout calibration.
</p>
<p>If the validation data contains a &quot;date&quot; column (fluxes), the simulated target time series
is compared to the observed values on those same dates (e.g. for GPP). Otherwise, 
there should only be one observed value per site (leaf traits), and the outputs 
(averaged over the growing season, weighted by predicted GPP) will be 
compared to this single value representative of the site (e.g. Vcmax25). As an exception,
when the date of a trait measurement is available, it will be compared to the 
trait value predicted on that date.
</p>


<h3>Value</h3>

<p>The log-likelihood of the observed target values, assuming that they
are independent, normally distributed and centered on the predictions
made by the P-model run with standard deviation given as input (via 'par' because
the error terms are estimated through the calibration with 'BayesianTools',
as shown in the &quot;Parameter calibration and cost functions&quot; vignette).
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Compute the likelihood for a set of 
# model parameter values involved in the
# temperature dependence of kphio 
# and example data
cost_likelihood_pmodel(
 par = c(0.05, -0.01, 1,     # model parameters
         2),                # err_gpp
 obs = p_model_validation,
 drivers = p_model_drivers,
 targets = c('gpp'),
 par_fixed = list(
  soilm_thetastar    = 0.6 * 240,  # old setup with soil moisture stress
  soilm_betao        = 0.0,
  beta_unitcostratio = 146.0,
  rd_to_vcmax        = 0.014,      # from Atkin et al. 2015 for C3 herbaceous
  tau_acclim         = 30.0,
  kc_jmax            = 0.41
 )
)
</code></pre>

<hr>
<h2 id='cost_rmse_biomee'>RMSE cost function for BiomeE</h2><span id='topic+cost_rmse_biomee'></span>

<h3>Description</h3>

<p>Cost function for parameter calibration, which computes the root mean squared
error (RMSE) between BiomeE simulations (using the input set of parameters)
and observed target variables.
Cost function for parameter calibration, which
computes the RMSE for the biomee model fitting target variables 
<code>'GPP','LAI','Density'</code> and <code>'Biomass'</code> for a given set of parameters.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cost_rmse_biomee(par, obs, drivers)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cost_rmse_biomee_+3A_par">par</code></td>
<td>
<p>A vector containing parameter values for <code>'phiRL',
'LAI_light', 'tf_base', 'par_mort'</code> in that order.</p>
</td></tr>
<tr><td><code id="cost_rmse_biomee_+3A_obs">obs</code></td>
<td>
<p>A nested data frame of observations, following the structure of <code>biomee_validation</code>,
for example.</p>
</td></tr>
<tr><td><code id="cost_rmse_biomee_+3A_drivers">drivers</code></td>
<td>
<p>A nested data frame of driver data, for example <code>biomee_gs_leuning_drivers</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The root mean squared error (RMSE) between the observed and simulated
values of <code>'GPP','LAI','Density'</code> and <code>'Biomass'</code> (all variables
have the same weight). Relative errors (difference divided by observed values) are used
instead of absolute errors.
The cost function performs a BiomeE model run for parameter values
<code>par</code> and model drivers <code>drivers</code> given as arguments, producing the
simulated values used to compute the RMSE.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Compute RMSE for a set of
# model parameter values
# and example data
cost_rmse_biomee(
 par = c(3.5, 3.5, 1, 1),
 obs = biomee_validation,
 drivers = biomee_gs_leuning_drivers
)

</code></pre>

<hr>
<h2 id='cost_rmse_pmodel'>Cost function computing RMSE for calibration of P-model parameters</h2><span id='topic+cost_rmse_pmodel'></span>

<h3>Description</h3>

<p>The cost function performs a P-model run for the input drivers and parameter
values, and compares the output to observations of various targets by computing
the root mean squared error (RMSE).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cost_rmse_pmodel(
  par,
  obs,
  drivers,
  targets,
  par_fixed = NULL,
  target_weights = NULL,
  parallel = FALSE,
  ncores = 2
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="cost_rmse_pmodel_+3A_par">par</code></td>
<td>
<p>A vector of values for the parameters to be calibrated (a subset of
those described in <code><a href="#topic+runread_pmodel_f">runread_pmodel_f</a></code>, in order).</p>
</td></tr>
<tr><td><code id="cost_rmse_pmodel_+3A_obs">obs</code></td>
<td>
<p>A nested data.frame of observations, with columns <code>'sitename'</code>
and <code>'data'</code> (see <code><a href="#topic+p_model_validation">p_model_validation</a></code> or <code><a href="#topic+p_model_validation_vcmax25">p_model_validation_vcmax25</a></code>
to check their structure).</p>
</td></tr>
<tr><td><code id="cost_rmse_pmodel_+3A_drivers">drivers</code></td>
<td>
<p>A nested data.frame of driver data. See <code><a href="#topic+p_model_drivers">p_model_drivers</a></code>
for a description of the data structure.</p>
</td></tr>
<tr><td><code id="cost_rmse_pmodel_+3A_targets">targets</code></td>
<td>
<p>A character vector indicating the target variables for which the
optimization will be done and the RMSE computed. This string must be a column 
name of the <code>data</code> data.frame belonging to the validation nested data.frame 
(for example 'gpp').</p>
</td></tr>
<tr><td><code id="cost_rmse_pmodel_+3A_par_fixed">par_fixed</code></td>
<td>
<p>A named list of model parameter values to keep fixed during the
calibration. These should complement the input <code>par</code> such that all model
parameters are passed on to <code><a href="#topic+runread_pmodel_f">runread_pmodel_f</a></code>.</p>
</td></tr>
<tr><td><code id="cost_rmse_pmodel_+3A_target_weights">target_weights</code></td>
<td>
<p>A vector of weights to be used in the computation of
the RMSE if using several targets. By default (<code>target_weights = NULL</code>)
the RMSE is computed separately for each target and then averaged. The provided
weights are used to compute a weighted average of RMSE across targets.</p>
</td></tr>
<tr><td><code id="cost_rmse_pmodel_+3A_parallel">parallel</code></td>
<td>
<p>A logical specifying whether simulations are to be parallelised
(sending data from a certain number of sites to each core). Defaults to
<code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="cost_rmse_pmodel_+3A_ncores">ncores</code></td>
<td>
<p>An integer specifying the number of cores used for parallel
computing. Defaults to 2.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>To run the P-model, all model parameters must be given. The cost
function uses arguments <code>par</code> and <code>par_fixed</code> such that, in the
calibration routine, <code>par</code> can be updated by the optimizer and 
<code>par_fixed</code> are kept unchanged throughout calibration.
</p>
<p>If the validation data contains a &quot;date&quot; column (fluxes), the simulated target time series
is compared to the observed values on those same dates (e.g. for GPP). Otherwise, 
there should only be one observed value per site (leaf traits), and the outputs 
(averaged over the growing season, weighted by predicted GPP) will be 
compared to this single value representative of the site (e.g. Vcmax25). As an exception,
when the date of a trait measurement is available, it will be compared to the 
trait value predicted on that date.
</p>


<h3>Value</h3>

<p>The root mean squared error (RMSE) between observed values and P-model
predictions. The RMSE is computed for each target separately and then aggregated
(mean or weighted average).
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Compute RMSE for a set
# of model parameter values
# and example data
cost_rmse_pmodel(
 par = c(0.05, -0.01, 0.5),  # kphio related parameters
 obs = p_model_validation,
 drivers = p_model_drivers,
 targets = c('gpp'),
 par_fixed = list(
  soilm_thetastar    = 0.6 * 240,  # old setup with soil moisture stress
  soilm_betao        = 0.0,
  beta_unitcostratio = 146.0,
  rd_to_vcmax        = 0.014,      # from Atkin et al. 2015 for C3 herbaceous
  tau_acclim         = 30.0,
  kc_jmax            = 0.41
 )
)
</code></pre>

<hr>
<h2 id='init_dates_dataframe'>Initialises a tibble with dates</h2><span id='topic+init_dates_dataframe'></span>

<h3>Description</h3>

<p>Creates a tibble with rows for each date from <code>'yrstart'</code> to <code>'yrend'</code>
in <code>'yyyy-mm-dd'</code> format. Intervals of dates are specified by argument 
<code>'freq'</code>. 
ddf &lt;- init_dates_dataframe(2000, 2003, startmoy=1, startdoy=1,
freq=&quot;days&quot;, endmoy=12, enddom=31, noleap=FALSE)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>init_dates_dataframe(
  yrstart,
  yrend,
  startmoy = 1,
  startdoy = 1,
  freq = "days",
  endmoy = 12,
  enddom = 31,
  noleap = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="init_dates_dataframe_+3A_yrstart">yrstart</code></td>
<td>
<p>An integer defining the start year
of dates covered by the dataframe.</p>
</td></tr>
<tr><td><code id="init_dates_dataframe_+3A_yrend">yrend</code></td>
<td>
<p>An integer defining the end year of dates
covered by the dataframe.</p>
</td></tr>
<tr><td><code id="init_dates_dataframe_+3A_startmoy">startmoy</code></td>
<td>
<p>An integer defining the start month-of-year of dates
covered by the dataframe. Defaults to 1.</p>
</td></tr>
<tr><td><code id="init_dates_dataframe_+3A_startdoy">startdoy</code></td>
<td>
<p>An integer defining the start day-of-year of
dates covered by the dataframe. Defaults to 1.</p>
</td></tr>
<tr><td><code id="init_dates_dataframe_+3A_freq">freq</code></td>
<td>
<p>A character string specifying the time steps of dates
(in rows). Defaults to <code>"days"</code>. Any of <code>"days", "months", "years"</code>. If
<code>freq = "months"</code> the 15<code class="reqn">^{th}</code> day of the months is used as date,
and if <code>freq = "years"</code> the 1<code class="reqn">^{st}</code> of January of each year is returned.</p>
</td></tr>
<tr><td><code id="init_dates_dataframe_+3A_endmoy">endmoy</code></td>
<td>
<p>An integer defining the end month-of-year of dates covered
by the dataframe. Defaults to 12.</p>
</td></tr>
<tr><td><code id="init_dates_dataframe_+3A_enddom">enddom</code></td>
<td>
<p>An integer defining the end day-of-year of dates
covered by the dataframe. Defaults to 31.</p>
</td></tr>
<tr><td><code id="init_dates_dataframe_+3A_noleap">noleap</code></td>
<td>
<p>Whether leap years are ignored, that is, whether the 29<code class="reqn">^{th}</code> 
of February is removed. Defaults to <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble with dates.
</p>

<hr>
<h2 id='p_model_drivers'>rsofun P-model driver data</h2><span id='topic+p_model_drivers'></span>

<h3>Description</h3>

<p>Small dataset representing the driver to run the P-model at the FR-Pue site. 
It can also be used together with daily GPP flux time series data from CH-LAE 
(<code><a href="#topic+p_model_validation">p_model_validation</a></code>) to optimize model parameters.
To optimize model parameters to leaf traits data use the datasets <code><a href="#topic+p_model_drivers_vcmax25">p_model_drivers_vcmax25</a></code> and <code><a href="#topic+p_model_validation_vcmax25">p_model_validation_vcmax25</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>p_model_drivers
</code></pre>


<h3>Format</h3>

<p>A tibble of driver data:
</p>

<dl>
<dt>sitename</dt><dd><p>A character string containing the site name.</p>
</dd>
<dt>forcing</dt><dd><p>A tibble of a time series of forcing climate data, including
the following data:
</p>

<dl>
<dt>date</dt><dd><p>Date of the observation in YYYY-MM-DD format.</p>
</dd>
<dt>temp</dt><dd><p>Daytime average air temperature in <code class="reqn">^\circ</code>C.</p>
</dd>
<dt>vpd</dt><dd><p>Daytime average vapour pressure deficit in Pa.</p>
</dd>
<dt>ppfd</dt><dd><p>Photosynthetic photon flux density (PPFD) in
mol m<code class="reqn">^{-2}</code> s<code class="reqn">^{-1}</code>. If all values are NA, it indicates that
PPFD should be calculated by the SPLASH model.</p>
</dd>
<dt>netrad</dt><dd><p>Net radiation in W m<code class="reqn">^{-2}</code>. This is currently
ignored as a model forcing.</p>
</dd>
<dt>patm</dt><dd><p>Atmospheric pressure in Pa.</p>
</dd>
<dt>snow</dt><dd><p>Snow in water equivalents mm s<code class="reqn">^{-1}</code>.</p>
</dd>
<dt>rain</dt><dd><p>Rain as precipitation in liquid form in mm s<code class="reqn">^{-1}</code>.</p>
</dd>
<dt>tmin</dt><dd><p>Daily minimum air temperature in <code class="reqn">^\circ</code>C.</p>
</dd>
<dt>tmax</dt><dd><p>Daily maximum air temperature in <code class="reqn">^\circ</code>C.</p>
</dd>
<dt>fapar</dt><dd><p>Fraction of photosynthetic active radiation (fAPAR), taking
values between 0 and 1.</p>
</dd>
<dt>co2</dt><dd><p>Atmospheric CO<code class="reqn">_2</code> concentration.</p>
</dd>
<dt>ccov</dt><dd><p>Cloud coverage in %. This is only used when either PPFD or
net radiation are not prescribed.</p>
</dd>
</dl>

</dd>
<dt>params_siml</dt><dd><p>A tibble of simulation parameters, including
the following data:
</p>

<dl>
<dt>spinup</dt><dd><p>A logical value indicating whether this simulation does spin-up.</p>
</dd>
<dt>spinupyears</dt><dd><p>Number of spin-up years.</p>
</dd>
<dt>recycle</dt><dd><p>Length of standard recycling period, in years.</p>
</dd>
<dt>outdt</dt><dd><p>An integer indicating the output periodicity.</p>
</dd>
<dt>ltre</dt><dd><p>A logical value, <code>TRUE</code> if evergreen tree.</p>
</dd>
<dt>ltne</dt><dd><p>A logical value, <code>TRUE</code> if evergreen tree and N-fixing.</p>
</dd>
<dt>ltrd</dt><dd><p>A logical value, <code>TRUE</code> if deciduous tree.</p>
</dd>
<dt>ltnd</dt><dd><p>A logical value, <code>TRUE</code> if deciduous tree and N-fixing.</p>
</dd>
<dt>lgr3</dt><dd><p>A logical value, <code>TRUE</code> if grass with C3 photosynthetic pathway.</p>
</dd>
<dt>lgn3</dt><dd><p>A logical value, <code>TRUE</code> if grass with C3 photosynthetic
pathway and N-fixing.</p>
</dd>
<dt>lgr4</dt><dd><p>A logical value, <code>TRUE</code> if grass with C4 photosynthetic pathway.</p>
</dd>
</dl>

</dd>
<dt>site_info</dt><dd><p>A tibble containing site meta information.
This data structure can be freely used for documenting the dataset, but must include at least the following data:
</p>

<dl>
<dt>lon</dt><dd><p>Longitude of the site location in degrees east.</p>
</dd>
<dt>lat</dt><dd><p>Latitude of the site location in degrees north.</p>
</dd>
<dt>elv</dt><dd><p>Elevation of the site location, in meters above sea level.</p>
</dd>
<dt>whc</dt><dd><p>A numeric value for the rooting zone water holding capacity (in mm)</p>
</dd>
</dl>

</dd>
</dl>



<h3>Source</h3>

<p>Pastorello, G., Trotta, C., Canfora, E. et al. 
The FLUXNET2015 dataset and the ONEFlux processing pipeline for eddy covariance data. 
Sci Data 7, 225 (2020). https://doi.org/10.1038/s41597-020-0534-3
</p>
<p>University of East Anglia Climatic Research Unit; Harris, I.C.; Jones, P.D.; Osborn, T. (2021): 
CRU TS4.05: Climatic Research Unit (CRU) Time-Series (TS) version 4.05 of high-resolution 
gridded data of month-by-month variation in climate (Jan. 1901- Dec. 2020). 
NERC EDS Centre for Environmental Data Analysis, date of citation. 
https://catalogue.ceda.ac.uk/uuid/c26a65020a5e4b80b20018f148556681
</p>
<p>Weedon, G. P., G. Balsamo, N. Bellouin,S. Gomes, M. J. Best, and P. Viterbo(2014), 
The WFDEI meteorologicalforcing data set: WATCH Forcing Datamethodology applied 
to ERA-Interimreanalysis data,
Water Resour. Res.,50,7505–7514, doi:10.1002/2014WR015638.
</p>
<p>Fick, S.E. and R.J. Hijmans, 2017. WorldClim 2: new 1km spatial resolution climate 
surfaces for global land areas. International Journal of Climatology 37 (12): 4302-4315.
</p>

<hr>
<h2 id='p_model_drivers_vcmax25'>rsofun P-model driver data (for leaf traits)</h2><span id='topic+p_model_drivers_vcmax25'></span>

<h3>Description</h3>

<p>Small dataset representing the driver to run the P-model at four separate sites. 
It can also be used together with leaf traits data from these four sites
(<code><a href="#topic+p_model_validation_vcmax25">p_model_validation_vcmax25</a></code>) to optimize model parameters.
To optimize model parameters to GPP flux data use the datasets <code><a href="#topic+p_model_drivers">p_model_drivers</a></code> and <code><a href="#topic+p_model_validation">p_model_validation</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>p_model_drivers_vcmax25
</code></pre>


<h3>Format</h3>

<p>See <code><a href="#topic+p_model_drivers">p_model_drivers</a></code>
</p>


<h3>Source</h3>

<p>Atkin, O. K., Bloomfield, K. J., Reich, P. B., Tjoelker, M. G., Asner, G. P., Bonal, D., et al. (2015). 
Global variability in leaf respiration in relation to climate, plant functional types and leaf traits. 
New Phytol. 206 (2), 614–636. doi:10.1111/nph.13253
</p>
<p>University of East Anglia Climatic Research Unit; Harris, I.C.; Jones, P.D.; Osborn, T. (2021): 
CRU TS4.05: Climatic Research Unit (CRU) Time-Series (TS) version 4.05 of high-resolution 
gridded data of month-by-month variation in climate (Jan. 1901- Dec. 2020). 
NERC EDS Centre for Environmental Data Analysis, date of citation. 
https://catalogue.ceda.ac.uk/uuid/c26a65020a5e4b80b20018f148556681
</p>
<p>Weedon, G. P., G. Balsamo, N. Bellouin,S. Gomes, M. J. Best, and P. Viterbo(2014), 
The WFDEI meteorologicalforcing data set: WATCH Forcing Datamethodology applied 
to ERA-Interimreanalysis data,
Water Resour. Res.,50,7505–7514, doi:10.1002/2014WR015638.
</p>
<p>Fick, S.E. and R.J. Hijmans, 2017. 
WorldClim 2: new 1km spatial resolution climate surfaces for global land areas. 
International Journal of Climatology 37 (12): 4302-4315.
</p>
<p>C.D. Keeling, R.B. Bacastow, A.E. Bainbridge, C.A. Ekdahl, P.R. Guenther, and L.S. Waterman, (1976), 
Atmospheric carbon dioxide variations at Mauna Loa Observatory, Hawaii, Tellus, vol. 28, 538-551
</p>

<hr>
<h2 id='p_model_output'>rsofun P-model output data</h2><span id='topic+p_model_output'></span>

<h3>Description</h3>

<p>Example output dataset from a p-model run using <code><a href="#topic+p_model_drivers">p_model_drivers</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>p_model_output
</code></pre>


<h3>Format</h3>

<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 1 rows and 3 columns.
</p>

<hr>
<h2 id='p_model_output_vcmax25'>rsofun P-model output data (using vcmax25 drivers)</h2><span id='topic+p_model_output_vcmax25'></span>

<h3>Description</h3>

<p>Example output dataset from a p-model run using <code><a href="#topic+p_model_drivers_vcmax25">p_model_drivers_vcmax25</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>p_model_output_vcmax25
</code></pre>


<h3>Format</h3>

<p>An object of class <code>tbl_df</code> (inherits from <code>tbl</code>, <code>data.frame</code>) with 4 rows and 3 columns.
</p>

<hr>
<h2 id='p_model_validation'>rsofun P-model GPP validation data</h2><span id='topic+p_model_validation'></span>

<h3>Description</h3>

<p>Small example dataset of target observations (daily GPP flux data) to optimize 
model parameters with the function <code><a href="#topic+calib_sofun">calib_sofun</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>p_model_validation
</code></pre>


<h3>Format</h3>

<p>A tibble of validation data:
</p>

<dl>
<dt>sitename</dt><dd><p>A character string containing the site name (e.g. 'FR-Pue').</p>
</dd>
<dt>data</dt><dd><p>A tibble [ 2,920 x 3 ] with time series for the following variables:
</p>

<dl>
<dt>date</dt><dd><p>Date vector with format YYYY-MM-DD.</p>
</dd>
<dt>gpp</dt><dd><p>The observed Gross Primary Productivity (GPP) for each time stamp 
(in gC m<code class="reqn">^{-2}</code> d<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>gpp_unc</dt><dd><p>The uncertainty of the GPP (in gC m<code class="reqn">^{-2}</code> d<code class="reqn">^{-1}</code>).</p>
</dd>
</dl>

</dd>
</dl>



<h3>Source</h3>

<p>Pastorello, G., Trotta, C., Canfora, E. et al. 
The FLUXNET2015 dataset and the ONEFlux processing pipeline for eddy covariance data. 
Sci Data 7, 225 (2020). https://doi.org/10.1038/s41597-020-0534-3
</p>


<h3>Examples</h3>

<pre><code class='language-R'>require(ggplot2); require(tidyr)
p_model_validation %&gt;% tidyr::unnest(data) 

</code></pre>

<hr>
<h2 id='p_model_validation_vcmax25'>rsofun P-model Vcmax25 validation data</h2><span id='topic+p_model_validation_vcmax25'></span>

<h3>Description</h3>

<p>Small example dataset of target observations (leaf trait data) to optimize 
model parameters with the function <code><a href="#topic+calib_sofun">calib_sofun</a></code>
</p>


<h3>Usage</h3>

<pre><code class='language-R'>p_model_validation_vcmax25
</code></pre>


<h3>Format</h3>

<p>A tibble of validation data:
</p>

<dl>
<dt>sitename</dt><dd><p>A character string containing the site names (e.g. 'Reichetal_Colorado').</p>
</dd>
<dt>data</dt><dd><p>A tibble [ 1 x 2 ] with observations for the following variables:
</p>

<dl>
<dt>vcmax25</dt><dd><p>The observed maximum rate of carboxylation (Vcmax), normalised 
to 25<code class="reqn">^o</code> C (in mol C m<code class="reqn">^{-2}</code> d<code class="reqn">^{-1}</code>), aggregated over different plant species
in each site.</p>
</dd>
<dt>vcmax25_unc</dt><dd><p>The uncertainty of the Vcmax25 (in mol C m<code class="reqn">^{-2}</code> d<code class="reqn">^{-1}</code>),
calculated as the standard deviation among Vcmax25 observations for
several species per site or as the total standard deviation across sites for
single-plant-species sites.</p>
</dd>
</dl>

</dd>
</dl>



<h3>Source</h3>

<p>Atkin, O. K., Bloomfield, K. J., Reich, P. B., Tjoelker, M. G., Asner, G. P., Bonal, D., et al. (2015). 
Global variability in leaf respiration in relation to climate, plant functional types and leaf traits. 
New Phytol. 206 (2), 614–636. doi:10.1111/nph.13253
</p>


<h3>Examples</h3>

<pre><code class='language-R'>require(ggplot2); require(tidyr)
p_model_validation_vcmax25 %&gt;% tidyr::unnest(data) 

</code></pre>

<hr>
<h2 id='run_biomee_f_bysite'>Run BiomeE (R wrapper)</h2><span id='topic+run_biomee_f_bysite'></span>

<h3>Description</h3>

<p>Run BiomeE Fortran model on single site.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>run_biomee_f_bysite(
  sitename,
  params_siml,
  site_info,
  forcing,
  params_tile,
  params_species,
  init_cohort,
  init_soil,
  makecheck = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="run_biomee_f_bysite_+3A_sitename">sitename</code></td>
<td>
<p>Site name.</p>
</td></tr>
<tr><td><code id="run_biomee_f_bysite_+3A_params_siml">params_siml</code></td>
<td>
<p>Simulation parameters.
See examples <code><a href="#topic+biomee_gs_leuning_drivers">biomee_gs_leuning_drivers</a></code> or <code><a href="#topic+biomee_p_model_drivers">biomee_p_model_drivers</a></code></p>
</td></tr>
<tr><td><code id="run_biomee_f_bysite_+3A_site_info">site_info</code></td>
<td>
<p>Site meta info in a data.frame.
See examples <code><a href="#topic+biomee_gs_leuning_drivers">biomee_gs_leuning_drivers</a></code> or <code><a href="#topic+biomee_p_model_drivers">biomee_p_model_drivers</a></code></p>
</td></tr>
<tr><td><code id="run_biomee_f_bysite_+3A_forcing">forcing</code></td>
<td>
<p>Forcing data.frame used as input.
See examples <code><a href="#topic+biomee_gs_leuning_drivers">biomee_gs_leuning_drivers</a></code> or <code><a href="#topic+biomee_p_model_drivers">biomee_p_model_drivers</a></code></p>
</td></tr>
<tr><td><code id="run_biomee_f_bysite_+3A_params_tile">params_tile</code></td>
<td>
<p>Tile-level model parameters, into a single row data.frame.
See examples <code><a href="#topic+biomee_gs_leuning_drivers">biomee_gs_leuning_drivers</a></code> or <code><a href="#topic+biomee_p_model_drivers">biomee_p_model_drivers</a></code></p>
</td></tr>
<tr><td><code id="run_biomee_f_bysite_+3A_params_species">params_species</code></td>
<td>
<p>A data.frame containing species-specific model parameters,
with one species per row. See examples <code><a href="#topic+biomee_gs_leuning_drivers">biomee_gs_leuning_drivers</a></code> or <code><a href="#topic+biomee_p_model_drivers">biomee_p_model_drivers</a></code></p>
</td></tr>
<tr><td><code id="run_biomee_f_bysite_+3A_init_cohort">init_cohort</code></td>
<td>
<p>A data.frame of initial cohort specifications.
See examples <code><a href="#topic+biomee_gs_leuning_drivers">biomee_gs_leuning_drivers</a></code> or <code><a href="#topic+biomee_p_model_drivers">biomee_p_model_drivers</a></code></p>
</td></tr>
<tr><td><code id="run_biomee_f_bysite_+3A_init_soil">init_soil</code></td>
<td>
<p>A data.frame of initial soil pools.
See examples <code><a href="#topic+biomee_gs_leuning_drivers">biomee_gs_leuning_drivers</a></code> or <code><a href="#topic+biomee_p_model_drivers">biomee_p_model_drivers</a></code></p>
</td></tr>
<tr><td><code id="run_biomee_f_bysite_+3A_makecheck">makecheck</code></td>
<td>
<p>Flag specifying whether checks are performed to verify model inputs and parameters.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Model output is provided as a list, with elements:
</p>

<dl>
<dt><code>output_hourly_tile</code></dt><dd><p>A data.frame containing hourly predictions
.
</p>

<dl>
<dt>year</dt><dd><p>Year of the simulation.</p>
</dd>
<dt>doy</dt><dd><p>Day of the year.</p>
</dd>
<dt>hour</dt><dd><p>Hour of the day.</p>
</dd>
<dt>rad</dt><dd><p>Radiation, in W m<code class="reqn">^{-2}</code>.</p>
</dd>
<dt>Tair</dt><dd><p>Air temperature, in Kelvin.</p>
</dd>
<dt>Prcp</dt><dd><p>Precipitation, in mm m<code class="reqn">^{-2}</code>.</p>
</dd>
<dt>GPP</dt><dd><p>Gross primary production (kg C m<code class="reqn">^{-2}</code> hour<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>Resp</dt><dd><p>Plant respiration (kg C m<code class="reqn">^{-2}</code> hour<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>Transp</dt><dd><p>Transpiration (mm m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>Evap</dt><dd><p>Evaporation (mm m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>Runoff</dt><dd><p>Water runoff (mm m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>Soilwater</dt><dd><p>Soil water content in root zone (kg m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>wcl</dt><dd><p>Volumetric soil water content for each layer (vol/vol).</p>
</dd>
<dt>FLDCAP</dt><dd><p>Field capacity (vol/vol).</p>
</dd>
<dt>WILTPT</dt><dd><p>Wilting point (vol/vol).</p>
</dd>
</dl>
</dd>
<dt><code>output_daily_tile</code></dt><dd><p>A data.frame with daily outputs at a tile
level.
</p>

<dl>
<dt>year</dt><dd><p>Year of the simulation.</p>
</dd>
<dt>doy</dt><dd><p>Day of the year.</p>
</dd>
<dt>Tc</dt><dd><p>Air temperature (Kelvin).</p>
</dd>
<dt>Prcp</dt><dd><p>Precipitation (mm m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>totWs</dt><dd><p>Soil water content in root zone (kg m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>Trsp</dt><dd><p>Transpiration (mm m<code class="reqn">^{2-}</code>).</p>
</dd>
<dt>Evap</dt><dd><p>Evaporation (mm m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>Runoff</dt><dd><p>Water runoff (mm m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>ws1</dt><dd><p>Volumetric soil water content for layer 1.</p>
</dd>
<dt>ws2</dt><dd><p>Volumetric soil water content for layer 2.</p>
</dd>
<dt>ws3</dt><dd><p>Volumetric soil water content for layer 3.</p>
</dd>
<dt>LAI</dt><dd><p>Leaf area index (m<code class="reqn">^2</code>/m<code class="reqn">^2</code>).</p>
</dd>
<dt>GPP</dt><dd><p>Gross primary production (kg C m<code class="reqn">^{-2}</code> day<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>Rauto</dt><dd><p>Plant autotrophic respiration (kg C m<code class="reqn">^{-2}</code> day<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>Rh</dt><dd><p>Heterotrophic respiration (kg C m<code class="reqn">^{-2}</code> day<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>NSC</dt><dd><p>Non-structural carbon (kg C m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>seedC</dt><dd><p>Biomass of seeds (kg C m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>leafC</dt><dd><p>Biomass of leaves (kg C m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>rootC</dt><dd><p>Biomass of fine roots (kg C m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>SW_C</dt><dd><p>Biomass of sapwood (kg C m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>HW_C</dt><dd><p>biomass of heartwood (kg C m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>NSN</dt><dd><p>Non-structural N pool (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>seedN</dt><dd><p>Nitrogen of seeds (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>leafN</dt><dd><p>Nitrogen of leaves (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>rootN</dt><dd><p>Nitrogen of roots (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>SW_N</dt><dd><p>Nitrogen of sapwood (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>HW_N</dt><dd><p>Nitrogen of heartwood (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>McrbC</dt><dd><p>Microbial carbon (kg C m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>fastSOM</dt><dd><p>Fast soil carbon pool (kg C m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>slowSOM</dt><dd><p>Slow soil carbon pool (kg C m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>McrbN</dt><dd><p>Microbial nitrogen (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>fastSoilN</dt><dd><p>Fast soil nitrogen pool (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>slowSoilN</dt><dd><p>Slow soil nitrogen pool (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>mineralN</dt><dd><p>Mineral nitrogen pool (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>N_uptk</dt><dd><p>Nitrogen uptake (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
</dl>
</dd>
<dt><code>output_daily_cohorts</code></dt><dd><p>A data.frame with daily predictions
for each canopy cohort.
</p>

<dl>
<dt>year</dt><dd><p>Year of the simulation.</p>
</dd>
<dt>doy</dt><dd><p>Day of the year.</p>
</dd>
<dt>hour</dt><dd><p>Hour of the day.</p>
</dd>
<dt>cID</dt><dd><p>An integer indicating the cohort identity.</p>
</dd>
<dt>PFT</dt><dd><p>An integer indicating the Plant Functional Type.</p>
</dd>
<dt>layer</dt><dd><p>An integer indicating the crown layer, numbered from top
to bottom.</p>
</dd>
<dt>density</dt><dd><p>Number of trees per area (trees ha<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>f_layer</dt><dd><p>Fraction of layer area occupied by this cohort.</p>
</dd>
<dt>LAI</dt><dd><p>Leaf area index (m<code class="reqn">^2</code>/m<code class="reqn">^2</code>).</p>
</dd>
<dt>gpp</dt><dd><p>Gross primary productivity (kg C tree<code class="reqn">^{-1}</code> day<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>resp</dt><dd><p>Plant autotrophic respiration (kg C tree<code class="reqn">^{-1}</code> day<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>transp</dt><dd><p>Transpiration (mm tree<code class="reqn">^{-1}</code> day<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>NPPleaf</dt><dd><p>Carbon allocated to leaves (kg C tree<code class="reqn">^{-1}</code> day<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>NPProot</dt><dd><p>Carbon allocated to fine roots (kg C tree<code class="reqn">^{-1}</code> day<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>NPPwood</dt><dd><p>Carbon allocated to wood (kg C tree<code class="reqn">^{-1}</code> day<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>NSC</dt><dd><p>Nonstructural carbohydrates of a tree in this cohort (kg C 
tree<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>seedC</dt><dd><p>Seed biomass of a tree in this cohort (kg C tree<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>leafC</dt><dd><p>Leaf biomass of a tree in this cohort (kg C tree<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>rootC</dt><dd><p>Fine root biomass of a tree in this cohort (kg C tree<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>SW_C</dt><dd><p>Sapwood biomass of a tree in this cohort (kg C tree<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>HW_C</dt><dd><p>Heartwood biomass of a tree in this cohort (kg C tree<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>NSN</dt><dd><p>Nonstructural nitrogen of a tree in this cohort (kg N tree<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>seedN</dt><dd><p>Seed nitrogen of a tree in this cohort (kg N tree<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>leafN</dt><dd><p>Leaf nitrogen of a tree in this cohort (kg N tree<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>rootN</dt><dd><p>Fine root nitrogen of a tree in this cohort (kg N tree<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>SW_N</dt><dd><p>Sapwood nitrogen of a tree in this cohort (kg N tree<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>HW_N</dt><dd><p>Heartwood nitrogen of a tree in this cohort (kg N tree<code class="reqn">^{-1}</code>).</p>
</dd>
</dl>
</dd>
<dt><code>output_annual_tile</code></dt><dd><p>A data.frame with annual outputs at tile level.
</p>

<dl>
<dt>year</dt><dd><p>Year of the simulation.</p>
</dd>
<dt>CAI</dt><dd><p>Crown area index (m<code class="reqn">^2</code>/m<code class="reqn">^2</code>).</p>
</dd>
<dt>LAI</dt><dd><p>Leaf area index (m<code class="reqn">^2</code>/m<code class="reqn">^2</code>).</p>
</dd>
<dt>Density</dt><dd><p>Number of trees per area (trees ha<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>DBH</dt><dd><p>Diameter at tile level (cm).</p>
</dd>
<dt>Density12</dt><dd><p>Tree density for trees with DBH &gt; 12 cm (individuals 
ha<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>DBH12</dt><dd><p>Diameter at tile level considering trees with DBH &gt; 12 cm
(cm).</p>
</dd>
<dt>QMD12</dt><dd><p>Quadratic mean diameter at tile level considering trees with
DBH &gt; 12 cm (cm).</p>
</dd>
<dt>NPP</dt><dd><p>Net primary productivity (kg C m<code class="reqn">^{-2}</code> yr<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>GPP</dt><dd><p>Gross primary productivity (kg C m<code class="reqn">^{-2}</code> yr<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>Rauto</dt><dd><p>Plant autotrophic respiration (kg C m<code class="reqn">^{-2}</code> yr<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>Rh</dt><dd><p>Heterotrophic respiration (kg C m<code class="reqn">^{-2}</code> yr<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>rain</dt><dd><p>Annual precipitation (mm m<code class="reqn">^{-2}</code> yr<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>SoilWater</dt><dd><p>Soil water content in root zone (kg m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>Transp</dt><dd><p>Transpiration (mm m<code class="reqn">^{-2}</code> yr<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>Evap</dt><dd><p>Evaporation (mm m<code class="reqn">^{-2}</code> yr<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>Runoff</dt><dd><p>Water runoff (mm m<code class="reqn">^{-2}</code> yr<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>plantC</dt><dd><p>Plant biomass (kg C m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>soilC</dt><dd><p>Soil carbon (kg C m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>plantN</dt><dd><p>Plant nitrogen (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>soilN</dt><dd><p>Soil nitrogen (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>totN</dt><dd><p>Total nitrogen in plant and soil (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>NSC</dt><dd><p>Nonstructural carbohydrates (kg C m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>SeedC</dt><dd><p>Seed biomass (kg C m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>leafC</dt><dd><p>Leaf biomass (kg C m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>rootC</dt><dd><p>Fine root biomass (kg C m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>SapwoodC</dt><dd><p>Sapwood biomass (kg C m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>WoodC</dt><dd><p>Heartwood biomass (kg C m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>NSN</dt><dd><p>Nonstructural nitrogen (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>SeedN</dt><dd><p>Seed nitrogen (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>leafN</dt><dd><p>Leaf nitrogen (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>rootN</dt><dd><p>Fine root nitrogen (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>SapwoodN</dt><dd><p>Sapwood nitrogen (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>WoodN</dt><dd><p>Heartwood nitrogen (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>McrbC</dt><dd><p>Microbial carbon (kg C m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>fastSOM</dt><dd><p>Fast soil carbon pool (kg C m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>SlowSOM</dt><dd><p>Slow soil carbon pool (kg C m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>McrbN</dt><dd><p>Microbial nitrogen (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>fastSoilN</dt><dd><p>Fast soil nitrogen pool (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>slowsoilN</dt><dd><p>Slow soil nitrogen pool (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>mineralN</dt><dd><p>Mineral nitrogen pool (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>N_fxed</dt><dd><p>Nitrogen fixation (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>N_uptk</dt><dd><p>Nitrogen uptake (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>N_yrMin</dt><dd><p>Annual available nitrogen (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>N_P25</dt><dd><p>Annual nitrogen from plants to soil (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>N_loss</dt><dd><p>Annual nitrogen loss (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>totseedC</dt><dd><p>Total seed carbon (kg C m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>totseedN</dt><dd><p>Total seed nitrogen (kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>Seedling_C</dt><dd><p>Total carbon from all compartments but seeds 
(kg C m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>Seeling_N</dt><dd><p>Total nitrogen from all compartments but seeds
(kg N m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>MaxAge</dt><dd><p>Age of the oldest tree in the tile (years).</p>
</dd>
<dt>MaxVolume</dt><dd><p>Maximum volumne of a tree in the tile (m<code class="reqn">^3</code>).</p>
</dd>
<dt>MaxDBH</dt><dd><p>Maximum DBH of a tree in the tile (m).</p>
</dd>
<dt>NPPL</dt><dd><p>Growth of a tree, including carbon allocated to leaves
(kg C m<code class="reqn">^{-2}</code> year<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>NPPW</dt><dd><p>Growth of a tree, including carbon allocated to sapwood
(kg C m<code class="reqn">^{-2}</code> year<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>n_deadtrees</dt><dd><p>Number of trees that died (trees m<code class="reqn">^{-2}</code> year<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>c_deadtrees</dt><dd><p>Carbon biomass of trees that died (kg C 
m<code class="reqn">^{-2}</code> year<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>m_turnover</dt><dd><p>Continuous biomass turnover (kg C m<code class="reqn">^{-2}</code> year<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>c_turnover_time</dt><dd><p>Carbon turnover rate, calculated as the ratio
between plant biomass and NPP (year<code class="reqn">^{-1}</code>).</p>
</dd>
</dl>
</dd>
<dt><code>output_annual_cohorts</code></dt><dd><p>A data.frame of annual outputs at the
cohort level.
</p>

<dl>
<dt>year</dt><dd><p>Year of the simulation.</p>
</dd>
<dt>cID</dt><dd><p>An integer indicating the cohort identity.</p>
</dd>
<dt>PFT</dt><dd><p>An integer indicating the Plant Functional Type.</p>
</dd>
<dt>layer</dt><dd><p>An integer indicating the crown layer, numbered from top to 
bottom.</p>
</dd>
<dt>density</dt><dd><p>Number of trees per area (trees ha<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>f_layer</dt><dd><p>Fraction of layer area occupied by this cohort.</p>
</dd>
<dt>dDBH</dt><dd><p>Diameter growth of a tree in this cohort (cm year<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>dbh</dt><dd><p>Tree diameter (cm).</p>
</dd>
<dt>height</dt><dd><p>Tree height (m).</p>
</dd>
<dt>age</dt><dd><p>Age of the cohort (years).</p>
</dd>
<dt>Acrow</dt><dd><p>Crown area of a tree in this cohort (m<code class="reqn">^2</code>).</p>
</dd>
<dt>wood</dt><dd><p>Sum of sapwood and heartwood biomass of a tree in this cohort
(kg C tree<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>nsc</dt><dd><p>Nonstructural carbohydrates in a tree (kg C tree<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>NSN</dt><dd><p>Nonstructural nitrogen of a tree (kg N tree<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>NPPtr</dt><dd><p>Total growth of a tree, including carbon allocated to seeds, 
leaves, fine roots, and sapwood (kg C tree<code class="reqn">^{-1}</code> year<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>seed</dt><dd><p>Fraction of carbon allocated to seeds to total growth.</p>
</dd>
<dt>NPPL</dt><dd><p>Fraction of carbon allocated to leaves to total growth.</p>
</dd>
<dt>NPPR</dt><dd><p>Fraction of carbon allocated to fine roots to total growth.</p>
</dd>
<dt>NPPW</dt><dd><p>Fraction of carbon allocated to sapwood to total growth.</p>
</dd>
<dt>GPP_yr</dt><dd><p>Gross primary productivity of a tree (kg C tree<code class="reqn">^{-1}</code> 
year<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>NPP_yr</dt><dd><p>Net primary productivity of a tree (kg C tree<code class="reqn">^{-1}</code> 
year<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>Rauto</dt><dd><p>Plant autotrophic respiration (kg C tree<code class="reqn">^{-1}</code> yr<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>N_uptk</dt><dd><p>Nitrogen uptake (kg N tree<code class="reqn">^{-1}</code> yr<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>N_fix</dt><dd><p>Nitrogen fixation (kg N tree<code class="reqn">^{-1}</code> yr<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>maxLAI</dt><dd><p>Maximum leaf area index for a tree (m<code class="reqn">^2</code> m<code class="reqn">^{-2}</code>).</p>
</dd>
<dt>Volume</dt><dd><p>Tree volume (m<code class="reqn">^3</code>).</p>
</dd>
<dt>n_deadtrees</dt><dd><p>Number of trees that died (trees yr<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>c_deadtrees</dt><dd><p>Carbon biomass of trees that died (kg C yr<code class="reqn">^{-1}</code>).</p>
</dd>
<dt>deathrate</dt><dd><p>Mortality rate of this cohort (yr<code class="reqn">^{-1}</code>).</p>
</dd>
</dl>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'>
# Example BiomeE model run

# Use example drivers data
drivers &lt;- biomee_gs_leuning_drivers

# Run BiomeE for the first site
mod_output &lt;- run_biomee_f_bysite(
 sitename = drivers$sitename[1],
 params_siml = drivers$params_siml[[1]],
 site_info = drivers$site_info[[1]],
 forcing = drivers$forcing[[1]],
 params_tile = drivers$params_tile[[1]],
 params_species = drivers$params_species[[1]],
 init_cohort = drivers$init_cohort[[1]],
 init_soil = drivers$init_soil[[1]]
)

</code></pre>

<hr>
<h2 id='run_pmodel_f_bysite'>R wrapper for SOFUN P-model</h2><span id='topic+run_pmodel_f_bysite'></span>

<h3>Description</h3>

<p>Call to the Fortran P-model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>run_pmodel_f_bysite(
  sitename,
  params_siml,
  site_info,
  forcing,
  params_modl,
  makecheck = TRUE,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="run_pmodel_f_bysite_+3A_sitename">sitename</code></td>
<td>
<p>Site name.</p>
</td></tr>
<tr><td><code id="run_pmodel_f_bysite_+3A_params_siml">params_siml</code></td>
<td>
<p>Simulation parameters.
</p>

<dl>
<dt>spinup</dt><dd><p>A logical value indicating whether this simulation does spin-up.</p>
</dd>
<dt>spinupyears</dt><dd><p>Number of spin-up years.</p>
</dd>
<dt>recycle</dt><dd><p>Length of standard recycling period, in years.</p>
</dd>
<dt>outdt</dt><dd><p>An integer indicating the output periodicity.</p>
</dd>
<dt>ltre</dt><dd><p>A logical value, <code>TRUE</code> if evergreen tree.</p>
</dd>
<dt>ltne</dt><dd><p>A logical value, <code>TRUE</code> if evergreen tree and N-fixing.</p>
</dd>
<dt>ltrd</dt><dd><p>A logical value, <code>TRUE</code> if deciduous tree.</p>
</dd>
<dt>ltnd</dt><dd><p>A logical value, <code>TRUE</code> if deciduous tree and N-fixing.</p>
</dd>
<dt>lgr3</dt><dd><p>A logical value, <code>TRUE</code> if grass with C3 photosynthetic pathway.</p>
</dd>
<dt>lgn3</dt><dd><p>A logical value, <code>TRUE</code> if grass with C3 photosynthetic
pathway and N-fixing.</p>
</dd>
<dt>lgr4</dt><dd><p>A logical value, <code>TRUE</code> if grass with C4 photosynthetic pathway.</p>
</dd>
</dl>
</td></tr>
<tr><td><code id="run_pmodel_f_bysite_+3A_site_info">site_info</code></td>
<td>
<p>A list of site meta info. Required:
</p>

<dl>
<dt>lon</dt><dd><p>Longitude of the site location.</p>
</dd>
<dt>lat</dt><dd><p>Latitude of the site location.</p>
</dd>
<dt>elv</dt><dd><p>Elevation of the site location, in meters.</p>
</dd>
<dt>whc</dt><dd><p>A numeric value for the total root zone water holding capacity (in mm), used
for simulating the soil water balance.</p>
</dd>
</dl>
</td></tr>
<tr><td><code id="run_pmodel_f_bysite_+3A_forcing">forcing</code></td>
<td>
<p>A data frame of forcing climate data, used as input 
(see <code><a href="#topic+p_model_drivers">p_model_drivers</a></code>
for a detailed description of its structure and contents).</p>
</td></tr>
<tr><td><code id="run_pmodel_f_bysite_+3A_params_modl">params_modl</code></td>
<td>
<p>A named list of free (calibratable) model parameters.
</p>

<dl>
<dt>kphio</dt><dd><p>The quantum yield efficiency at optimal temperature <code class="reqn">\varphi_0</code>, 
in mol mol<code class="reqn">^{-1}</code>.
When temperature dependence is used, it corresponds to the multiplicative
parameter <code class="reqn">c</code> (see Details).</p>
</dd>
<dt>kphio_par_a</dt><dd><p>The shape parameter <code class="reqn">a</code> of the temperature-dependency of
quantum yield efficiency (see Details).
To disable the temperature dependence, set <code>kphio_par_a = 0</code>.</p>
</dd>
<dt>kphio_par_b</dt><dd><p>The optimal temperature parameter <code class="reqn">b</code> of the temperature
dependent quantum yield efficiency (see Details), in <code class="reqn">^o</code>C.</p>
</dd>
<dt>soilm_thetastar</dt><dd><p>The threshold parameter <code class="reqn">\theta^{*}</code> in the 
soil moisture stress function (see Details), given in mm.
To turn off the soil moisture stress, set <code>soilm_thetastar = 0</code>.</p>
</dd>
<dt>soilm_betao</dt><dd><p>The intercept parameter <code class="reqn">\beta_{0}</code> in the
soil moisture stress function (see Details). This is the parameter calibrated 
in Stocker et al. 2020 GMD.</p>
</dd>
<dt>beta_unitcostratio</dt><dd><p>The unit cost of carboxylation, corresponding to
<code class="reqn">\beta = b / a'</code> in Eq. 3 of Stocker et al. 2020 GMD.</p>
</dd>
<dt>rd_to_vcmax</dt><dd><p>Ratio of Rdark (dark respiration) to Vcmax25.</p>
</dd>
<dt>tau_acclim</dt><dd><p>Acclimation time scale of photosynthesis, in days.</p>
</dd>
<dt>kc_jmax</dt><dd><p>Parameter for Jmax cost ratio (corresponding to c<code class="reqn">^*</code> in
Stocker et al. 2020 GMD).</p>
</dd> 
</dl>
</td></tr>
<tr><td><code id="run_pmodel_f_bysite_+3A_makecheck">makecheck</code></td>
<td>
<p>A logical specifying whether checks are performed 
to verify forcings and model parameters. <code>TRUE</code> by default.</p>
</td></tr>
<tr><td><code id="run_pmodel_f_bysite_+3A_verbose">verbose</code></td>
<td>
<p>A logical specifying whether to print warnings.
Defaults to <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Depending on the input model parameters, it's possible to run the 
different P-model setups presented in Stocker et al. 2020 GMD. The P-model
version implemented in this package allows more flexibility than the one
presented in the paper, with the following functions:
</p>
<p>The temperature dependence of the quantum yield efficiency is given by: <br />
<code class="reqn">\varphi_0 (T) = c (1 + a (T - b)^2 ) </code> if <code class="reqn">0 &lt; c (1 + a (T - b)^2 ) &lt; 1</code>, <br />
<code class="reqn">\varphi_0 (T) = 0 </code> if <code class="reqn"> c (1 + a (T - b)^2 ) \leq 0</code>, and  <br />
<code class="reqn">\varphi_0 (T) = 1 </code> if <code class="reqn"> c (1 + a (T - b)^2 ) \geq 1</code>. <br />
The ORG setup can be reproduced by setting <code>kphio_par_a = 0</code>
and calibrating the <code>kphio</code> parameter only.
The BRC setup (which calibrates <code class="reqn">c_L = \frac{a_L b_L}{4}</code> in Eq. 18) is more difficult to reproduce, 
since the temperature-dependency has been reformulated and a custom cost
function would be necessary for calibration. The new parameters
are related to <code class="reqn">c_L</code> as follows: <br />
<code class="reqn">a = -0.0004919819</code> <br />
<code class="reqn">b = 32.35294</code> <br />
<code class="reqn">c = 0.6910823 c_L</code> 
</p>
<p>The soil moisture stress is implemented as <br />
<code class="reqn">\beta(\theta) = \frac{\beta_0 - 1}{{\theta^{*}}^2} 
   (\theta - \theta^{*})^2 + 1 </code> if 
<code class="reqn"> 0 \leq \theta \leq \theta^{*}</code> and <br />
<code class="reqn">\beta(\theta) = 1</code> if <code class="reqn"> \theta &gt; \theta^{*}</code>. <br />
In Stocker et al. 2020 GMD, the threshold plant-available soil water is set as
<code class="reqn">\theta^{*}</code> 
<code>= 0.6 * whc</code> where <code>whc</code> is the site's water holding capacity. Also,
the <code class="reqn">\beta</code> reduction at low soil moisture (<code class="reqn">\beta_0 = \beta(0)</code>) was parameterized
as a linear function of mean aridity (Eq. 20 in Stocker et al. 2020 GMD) but is
considered a constant model parameter in this package. 
Hence, the FULL calibration setup cannot be 
exactly replicated.
</p>


<h3>Value</h3>

<p>Model output is provided as a tidy dataframe, with columns:
</p>

<dl>
<dt><code>date</code></dt><dd><p>Date of the observation in YYYY-MM-DD format.</p>
</dd>
<dt><code>year_dec</code></dt><dd><p>Decimal representation of year and day of the year
(for example, 2007.000 corresponds to 2007-01-01 and 2007.003 to 2007-01-02.</p>
</dd>
<dt><code>fapar</code></dt><dd><p>Fraction of photosynthetic active radiation (fAPAR), taking
values between 0 and 1.</p>
</dd>
<dt><code>gpp</code></dt><dd><p>Gross Primary Productivity (GPP) for each time stamp 
(in gC m<code class="reqn">^{-2}</code> d<code class="reqn">^{-1}</code>).</p>
</dd>
<dt><code>aet</code></dt><dd><p>Actual evapotranspiration (AET), calculated by SPLASH following Priestly-Taylor (in mm d<code class="reqn">^{-1}</code>).</p>
</dd>
<dt><code>le</code></dt><dd><p>Latent heat flux (in J m<code class="reqn">^{-2}</code> d<code class="reqn">^{-1}</code>).</p>
</dd>
<dt><code>pet</code></dt><dd><p>Potential evapotranspiration (PET), calculated by SPLASH following Priestly-Taylor (in mm d<code class="reqn">^{-1}</code>).</p>
</dd>
<dt><code>vcmax</code></dt><dd><p>Maximum rate of RuBisCO carboxylation 
(Vcmax) (in mol C m<code class="reqn">^{-2}</code> d<code class="reqn">^{-1}</code>).</p>
</dd>
<dt><code>jmax</code></dt><dd><p>Maximum rate of electron transport for RuBP regeneration
(in mol CO<code class="reqn">_2</code> m<code class="reqn">^{-2}</code> s<code class="reqn">^{-1}</code>).</p>
</dd>
<dt><code>vcmax25</code></dt><dd><p>Maximum rate of carboxylation (Vcmax), 
normalised to 25<code class="reqn">^o</code>C (in mol C m<code class="reqn">^{-2}</code> d<code class="reqn">^{-1}</code>).</p>
</dd>
<dt><code>jmax25</code></dt><dd><p>Maximum rate of electron transport, normalised to 
25<code class="reqn">^o</code>C (in mol C m<code class="reqn">^{-2}</code> s<code class="reqn">^{-1}</code>).</p>
</dd>
<dt><code>gs_accl</code></dt><dd><p>Acclimated stomatal conductance (in 
mol C m<code class="reqn">^{-2}</code> d<code class="reqn">^{-1}</code> Pa<code class="reqn">^{-1}</code>).</p>
</dd>
<dt><code>wscal</code></dt><dd><p>Relative soil water content, between 0 (permanent wilting 
point, PWP) and 1 (field capacity, FC).</p>
</dd>
<dt><code>chi</code></dt><dd><p>Ratio of leaf-internal to ambient CO<code class="reqn">_{2}</code>, ci:ca (unitless).</p>
</dd>
<dt><code>iwue</code></dt><dd><p>Intrinsic water use efficiency (iWUE) (in Pa).</p>
</dd>
<dt><code>rd</code></dt><dd><p>Dark respiration (Rd) in gC m<code class="reqn">^{-2}</code> d<code class="reqn">^{-1}</code>.</p>
</dd>
<dt><code>tsoil</code></dt><dd><p>Soil temperature, in <code class="reqn">^{o}</code>C.</p>
</dd>
<dt><code>netrad</code></dt><dd><p>Net radiation, in W m<code class="reqn">^{-2}</code>. WARNING: this is currently ignored as a model forcing. Instead, net radiation is internally calculated by SPLASH.</p>
</dd>
<dt><code>wcont</code></dt><dd><p>Soil water content, in mm.</p>
</dd>
<dt><code>snow</code></dt><dd><p>Snow water equivalents, in mm.</p>
</dd>
<dt><code>cond</code></dt><dd><p>Water input by condensation, in mm d<code class="reqn">^{-1}</code></p>
</dd>
</dl>



<h3>Examples</h3>

<pre><code class='language-R'># Define model parameter values from previous work
params_modl &lt;- list(
  kphio              = 0.04998,    # setup ORG in Stocker et al. 2020 GMD
  kphio_par_a        = 0.0,        # disable temperature-dependence of kphio
  kphio_par_b        = 1.0,
  soilm_thetastar    = 0.6 * 240,  # old setup with soil moisture stress
  soilm_betao        = 0.0,
  beta_unitcostratio = 146.0,
  rd_to_vcmax        = 0.014,      # from Atkin et al. 2015 for C3 herbaceous
  tau_acclim         = 30.0,
  kc_jmax            = 0.41
)

# Run the Fortran P-model 
mod_output &lt;- run_pmodel_f_bysite(
  # unnest drivers example data
  sitename = p_model_drivers$sitename[1],
  params_siml = p_model_drivers$params_siml[[1]],
  site_info = p_model_drivers$site_info[[1]],
  forcing = p_model_drivers$forcing[[1]],
  params_modl = params_modl
 )
</code></pre>

<hr>
<h2 id='runread_biomee_f'>Run BiomeE</h2><span id='topic+runread_biomee_f'></span>

<h3>Description</h3>

<p>Runs BiomeE model for multiple sites.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>runread_biomee_f(drivers, makecheck = TRUE, parallel = FALSE, ncores = 2)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="runread_biomee_f_+3A_drivers">drivers</code></td>
<td>
<p>A nested data frame with one row for each site and columns
named according to the arguments of function 'runread_biomee_f_bysite()'.
See '?run_biomee_f_bysite' for the list of parameters and forcing data required.</p>
</td></tr>
<tr><td><code id="runread_biomee_f_+3A_makecheck">makecheck</code></td>
<td>
<p>Flag specifying whether checks are performed to verify forcings.</p>
</td></tr>
<tr><td><code id="runread_biomee_f_+3A_parallel">parallel</code></td>
<td>
<p>Flag specifying whether simulations are to be
parallelised (sending data from a certain number of sites to each core). 
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="runread_biomee_f_+3A_ncores">ncores</code></td>
<td>
<p>An integer specifying the number of cores used for parallel 
computing. Defaults to 2.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A tibble with one row for each site and model outputs stored 
in the nested column <code>data</code>. See '?run_biomee_f_bysite' for a
description of the BiomeE output variables.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Example BiomeE model run

runread_biomee_f(
  drivers = biomee_gs_leuning_drivers
)
runread_biomee_f(
  drivers = biomee_p_model_drivers
)

</code></pre>

<hr>
<h2 id='runread_pmodel_f'>Run the P-model</h2><span id='topic+runread_pmodel_f'></span>

<h3>Description</h3>

<p>Runs the P-model and loads output in once.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>runread_pmodel_f(drivers, par, makecheck = TRUE, parallel = FALSE, ncores = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="runread_pmodel_f_+3A_drivers">drivers</code></td>
<td>
<p>A nested data frame with one row for each site and columns
named according to the arguments of function <code><a href="#topic+run_pmodel_f_bysite">run_pmodel_f_bysite</a></code>,
namely <code>sitename, params_siml, site_info</code> and <code>forcing</code>.</p>
</td></tr>
<tr><td><code id="runread_pmodel_f_+3A_par">par</code></td>
<td>
<p>A named list of free (calibratable) model parameters.
</p>

<dl>
<dt>kphio</dt><dd><p>The quantum yield efficiency at optimal temperature <code class="reqn">\varphi_0</code>, 
in mol mol<code class="reqn">^{-1}</code>.
When temperature dependence is used, it corresponds to the multiplicative
parameter <code class="reqn">c</code> (see Details).</p>
</dd>
<dt>kphio_par_a</dt><dd><p>The shape parameter <code class="reqn">a</code> of the temperature-dependency of
quantum yield efficiency (see Details).
To disable the temperature dependence, set <code>kphio_par_a = 0</code>.</p>
</dd>
<dt>kphio_par_b</dt><dd><p>The optimal temperature parameter <code class="reqn">b</code> of the temperature
dependent quantum yield efficiency (see Details), in <code class="reqn">^o</code>C.</p>
</dd>
<dt>soilm_thetastar</dt><dd><p>The threshold parameter <code class="reqn">\theta^{*}</code> in the 
soil moisture stress function (see Details), given in mm.
To turn off the soil moisture stress, set <code>soilm_thetastar = 0</code>.</p>
</dd>
<dt>soilm_betao</dt><dd><p>The intercept parameter <code class="reqn">\beta_{0}</code> in the
soil moisture stress function (see Details). This is the parameter calibrated 
in Stocker et al. 2020 GMD.</p>
</dd>
<dt>beta_unitcostratio</dt><dd><p>The unit cost of carboxylation, corresponding to
<code class="reqn">\beta = b / a'</code> in Eq. 3 of Stocker et al. 2020 GMD.</p>
</dd>
<dt>rd_to_vcmax</dt><dd><p>Ratio of Rdark (dark respiration) to Vcmax25.</p>
</dd>
<dt>tau_acclim</dt><dd><p>Acclimation time scale of photosynthesis, in days.</p>
</dd>
<dt>kc_jmax</dt><dd><p>Parameter for Jmax cost ratio (corresponding to c<code class="reqn">^*</code> in
Stocker et al. 2020 GMD).</p>
</dd> 
</dl>
</td></tr>
<tr><td><code id="runread_pmodel_f_+3A_makecheck">makecheck</code></td>
<td>
<p>A logical specifying whether checks are performed to verify
forcings. Defaults to <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="runread_pmodel_f_+3A_parallel">parallel</code></td>
<td>
<p>A logical specifying whether simulations are to be
parallelised (sending data from a certain number of sites to each core).
Defaults to <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="runread_pmodel_f_+3A_ncores">ncores</code></td>
<td>
<p>An integer specifying the number of cores used for parallel
computing (by default <code>ncores = 2</code>).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Depending on the input model parameters, it's possible to run the 
different P-model setups presented in Stocker et al. 2020 GMD. The P-model
version implemented in this package allows more flexibility than the one
presented in the paper, with the following functions:
</p>
<p>The temperature dependence of the quantum yield efficiency is given by: <br />
<code class="reqn">\varphi_0 (T) = c (1 + a (T - b)^2 ) </code> if <code class="reqn">0 &lt; c (1 + a (T - b)^2 ) &lt; 1</code>, <br />
<code class="reqn">\varphi_0 (T) = 0 </code> if <code class="reqn"> c (1 + a (T - b)^2 ) \leq 0</code>, and  <br />
<code class="reqn">\varphi_0 (T) = 1 </code> if <code class="reqn"> c (1 + a (T - b)^2 ) \geq 1</code>. <br />
The ORG setup can be reproduced by setting <code>kphio_par_a = 0</code>
and calibrating the <code>kphio</code> parameter only.
The BRC setup (which calibrates <code class="reqn">c_L = \frac{a_L b_L}{4}</code> in Eq. 18) is more difficult to reproduce, 
since the temperature-dependency has been reformulated and a custom cost
function would be necessary for calibration. The new parameters
are related to <code class="reqn">c_L</code> as follows: <br />
<code class="reqn">a = -0.0004919819</code> <br />
<code class="reqn">b = 32.35294</code> <br />
<code class="reqn">c = 0.6910823 c_L</code> 
</p>
<p>The soil moisture stress is implemented as <br />
<code class="reqn">\beta(\theta) = \frac{\beta_0 - 1}{{\theta^{*}}^2} 
   (\theta - \theta^{*})^2 + 1 </code> if 
<code class="reqn"> 0 \leq \theta \leq \theta^{*}</code> and <br />
<code class="reqn">\beta(\theta) = 1</code> if <code class="reqn"> \theta &gt; \theta^{*}</code>. <br />
In Stocker et al. 2020 GMD, the threshold plant-available soil water is set as
<code class="reqn">\theta^{*}</code> 
<code>= 0.6 * whc</code> where <code>whc</code> is the site's water holding capacity. Also,
the <code class="reqn">\beta</code> reduction at low soil moisture (<code class="reqn">\beta_0 = \beta(0)</code>) was parameterized
as a linear function of mean aridity (Eq. 20 in Stocker et al. 2020 GMD) but is
considered a constant model parameter in this package. 
Hence, the FULL calibration setup cannot be 
exactly replicated.
</p>


<h3>Value</h3>

<p>A data frame (tibble) with one row for each site, site information 
stored in the nested column <code>site_info</code> and outputs stored in the nested 
column <code>data</code>. See <code><a href="#topic+run_pmodel_f_bysite">run_pmodel_f_bysite</a></code> for a detailed 
description of the outputs.
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Define model parameter values from previous work
params_modl &lt;- list(
  kphio              = 0.04998,    # setup ORG in Stocker et al. 2020 GMD
  kphio_par_a        = 0.0,        # disable temperature-dependence of kphio
  kphio_par_b        = 1.0,
  soilm_thetastar    = 0.6 * 240,  # old setup with soil moisture stress
  soilm_betao        = 0.0,
  beta_unitcostratio = 146.0,
  rd_to_vcmax        = 0.014,      # from Atkin et al. 2015 for C3 herbaceous
  tau_acclim         = 30.0,
  kc_jmax            = 0.41
)

# Run the model for these parameters and the example drivers
output &lt;- rsofun::runread_pmodel_f(
  drivers = rsofun::p_model_drivers,
  par = params_modl)
output_vcmax25 &lt;- rsofun::runread_pmodel_f(
  drivers = rsofun::p_model_drivers_vcmax25,
  par = params_modl)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
