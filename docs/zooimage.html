<!DOCTYPE html><html lang="en"><head><title>Help for package zooimage</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {zooimage}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#zooimage-package'><p>ZooImage: analysis of digital plankton images</p></a></li>
<li><a href='#correctError'><p> The ZooImage error correction (manual validation) tools</p></a></li>
<li><a href='#file-utilities'><p> Various file utility functions used by ZooImage</p></a></li>
<li><a href='#gui'><p> The ZooImage GUI (Graphical User Interface)</p></a></li>
<li><a href='#gui-utilities'><p> Various GUI utility functions used by ZooImage</p></a></li>
<li><a href='#import'><p> Function to import data from the FlowCAM</p></a></li>
<li><a href='#utilities'><p> Various utility functions used by ZooImage</p></a></li>
<li><a href='#zic'><p> Check .zic files (ZooImage Categories)</p></a></li>
<li><a href='#ZIClass'><p> Create and manipulate 'ZIClass' objects</p></a></li>
<li><a href='#zid'><p> Manage .zid files (ZooImage Data)</p></a></li>
<li><a href='#zidb'><p> Manage .zidb files (ZooImage Databases)</p></a></li>
<li><a href='#zie'><p> ZIE (ZooImage Extension) manipulate .zie files to add custom import, export, etc. routines to ZooImage</p></a></li>
<li><a href='#zim'><p> Manipulate .zim files (ZooImage Metadata/Measurements)</p></a></li>
<li><a href='#zip'><p> Zip and unzip raw .tif images for ZooImage and embed metadata</p></a></li>
<li><a href='#ZIRes'><p> Various function to calculate results ('ZIRes' object)</p></a></li>
<li><a href='#zis'><p> Manipulate .zis files (ZooImage Samples description)</p></a></li>
<li><a href='#ZITrain'><p> Manipulate training and testsets 'ZITrain'/'ZITest' objects</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Analysis of Numerical Plankton Images</td>
</tr>
<tr>
<td>Version:</td>
<td>5.5.2</td>
</tr>
<tr>
<td>Date:</td>
<td>2018-06-28</td>
</tr>
<tr>
<td>Author:</td>
<td>Philippe Grosjean [aut, cre],
  Kevin Denis [aut],
  Guillaume Wacquet [aut]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Philippe Grosjean &lt;phgrosjean@sciviews.org&gt;</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.15.0), mlearning</td>
</tr>
<tr>
<td>Imports:</td>
<td>svMisc (&ge; 0.9-67), svDialogs (&ge; 0.9-53), filehash, jpeg,
png, tiff, utils, digest, tools, MASS, mda, shiny, DT</td>
</tr>
<tr>
<td>Suggests:</td>
<td>rJava, mlbench</td>
</tr>
<tr>
<td>Description:</td>
<td>A free (open source) solution for analyzing digital
  images of plankton. In combination with ImageJ, a free image analysis
  system, it processes digital images, measures individuals, trains for
  automatic classification of taxa, and finally, measures plankton samples
  (abundances, total and partial size spectra or biomasses, etc.).</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> [expanded from: GPL (&ge; 2)]</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="http://www.sciviews.org/zooimage">http://www.sciviews.org/zooimage</a></td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2018-06-29 15:45:24 UTC; phgrosjean</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2018-06-29 16:00:26 UTC</td>
</tr>
</table>
<hr>
<h2 id='zooimage-package'>ZooImage: analysis of digital plankton images</h2><span id='topic+zooimage-package'></span><span id='topic+zooimage'></span>

<h3>Description</h3>

<p>ZooImage is a free (open source) solution for analyzing digital
images of plankton. In combination with ImageJ, a free image analysis
system, it processes digital images, measures individuals, trains for
automatic classification of taxa, and finally, measures plankton samples
(abundances, total and partial size spectra or biomasses, etc.)
</p>


<h3>Details</h3>


<table>
<tr>
 <td style="text-align: left;">
    Package: </td><td style="text-align: left;"> zooimage</td>
</tr>
<tr>
 <td style="text-align: left;">
    Type: </td><td style="text-align: left;"> Package</td>
</tr>
<tr>
 <td style="text-align: left;">
    Version: </td><td style="text-align: left;"> 5.5.2</td>
</tr>
<tr>
 <td style="text-align: left;">
    Date: </td><td style="text-align: left;"> 2018-06-28</td>
</tr>
<tr>
 <td style="text-align: left;">
    License: </td><td style="text-align: left;"> GPL 2 or above at your convenience.</td>
</tr>
<tr>
 <td style="text-align: left;">
  </td>
</tr>

</table>



<h3>Author(s)</h3>

<p>Philippe Grosjean, Kevin Denis &amp; Guillaume Wacquet, Numerical Ecology of
Aquatic Systems, Mons University, Belgium.
A part of the early concepts of ZooImage are inspired from PVA by Xabier Irigoien,
Guillermo Boyra &amp; Igor Arregi, AZTI Technalia, Spain, with their autorization.
Angel Lopez-Urrutia, Centro Oceanografico de Gijon, IEO, Spain, also contributed
to the initial concept during early discussions. No code come from them, however.
Mike Sieracki, Ben Tupper et al for the FIT VIS plugin (FlowCAM images
process in ImageJ -FitVIS-, but this pulgin is not used any more by default in
the current version).
</p>
<p>Maintainer: Philippe Grosjean &lt;Philippe.Grosjean@umons.ac.be&gt;
</p>
<p>The software was funded, and is the property of:
</p>
<p>- The University of Mons, Belgium,
- Belgian Scientific Policy (BelSpo), Belgium, that contributed by funding the
AMORE III project.
- IFREMER, France, through a co-funded research collaboration with the
University of Mons.
</p>

<hr>
<h2 id='correctError'> The ZooImage error correction (manual validation) tools </h2><span id='topic+correctError'></span><span id='topic+addItemsToTrain'></span><span id='topic+dropItemsToTrain'></span><span id='topic+activeLearning'></span>

<h3>Description</h3>

<p>Open a web page for manual validation and error correction of predicted abundances in samples.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>correctError(zidb, classifier, data = zidbDatRead(zidb), mode = "validation",
fraction = 0.05, sample.min = 100, sample.max = 200, grp.min = 2,
random.sample = 0.1, algorithm = "rf", diff.max = 0.2, prop.bio = NULL,
reset = TRUE, result = NULL)

addItemsToTrain(train, CtxSmp, add.mode = "SV+NSV", threshold = NA,
    dropItemsToTrain = dropItemsToTrain)
dropItemsToTrain(train, cl, drop.nb)

activeLearning(train, add.mode = "SV+NSV", threshold = NA)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="correctError_+3A_zidb">zidb</code></td>
<td>
<p> Path to a Zidb file. </p>
</td></tr>
<tr><td><code id="correctError_+3A_classifier">classifier</code></td>
<td>
<p> A ZIClass object appropriate for this sample and the desired classification. </p>
</td></tr>
<tr><td><code id="correctError_+3A_data">data</code></td>
<td>
<p> A ZIDat or a ZITest object matching that sample (by default, it is the ZIDat object contained in the zidb file). </p>
</td></tr>
<tr><td><code id="correctError_+3A_mode">mode</code></td>
<td>
<p> The mode to use for error correction. By default, <code>mode = "validation"</code>,
where particles are manually validated. <code>mode = "demo"</code> is the same one, but it sorts particles
according to the Class variable in data, ignoring changes made in the user interface (so that one
can explain the logic of the process without care about how particles are manually resorted).
Finally, <code>mode = "stat"</code> do not display the user interface at all and calculates all steps
directly to show gain from the process from 0 to 100% of the particles validated. </p>
</td></tr>
<tr><td><code id="correctError_+3A_fraction">fraction</code></td>
<td>
<p> The fraction of items to validate at each step (1/20th by default). </p>
</td></tr>
<tr><td><code id="correctError_+3A_sample.min">sample.min</code></td>
<td>
<p> Minimal number of items to take at each step. </p>
</td></tr>
<tr><td><code id="correctError_+3A_sample.max">sample.max</code></td>
<td>
<p> Maximal number of items to take at each step. In case the
sample contains a very large number of items, the number of particles that
are validated at each step are constrained by this parameter, and consequently,
the total number of steps becomes large than 1/fraction, but usually, error
correction allows to stop earlier. </p>
</td></tr>
<tr><td><code id="correctError_+3A_grp.min">grp.min</code></td>
<td>
<p> Minimal number of items to take for each group, on average. </p>
</td></tr>
<tr><td><code id="correctError_+3A_random.sample">random.sample</code></td>
<td>
<p> Fraction of random sample considered, when validating suspect items. </p>
</td></tr>
<tr><td><code id="correctError_+3A_algorithm">algorithm</code></td>
<td>
<p> Machine learning algorithm used to detect suspect items. </p>
</td></tr>
<tr><td><code id="correctError_+3A_diff.max">diff.max</code></td>
<td>
<p> Maximum difference allowed between probabilities in first and second class before considering the item is suspect. </p>
</td></tr>
<tr><td><code id="correctError_+3A_prop.bio">prop.bio</code></td>
<td>
<p> Weight to apply to the groups for considering them as suspects (use biological or external considerations to build this). </p>
</td></tr>
<tr><td><code id="correctError_+3A_reset">reset</code></td>
<td>
<p> Do we reset analysis in the case a temporary file already exists for that sample (recommended). </p>
</td></tr>
<tr><td><code id="correctError_+3A_result">result</code></td>
<td>
<p> Name of the object in the calling environment where the results will be stored (ZITest object).
If not provided or <code>NULL</code>, it is the basename of the zidb file without extension plus
<code>_valid</code>. </p>
</td></tr>
<tr><td><code id="correctError_+3A_train">train</code></td>
<td>
<p> the training set to complete. </p>
</td></tr>
<tr><td><code id="correctError_+3A_ctxsmp">CtxSmp</code></td>
<td>
<p> the contextual samples containing validated items.</p>
</td></tr>
<tr><td><code id="correctError_+3A_add.mode">add.mode</code></td>
<td>
<p> the mode for adding items, <code>"SV"</code>: Validated Suspects,
<code>"NSV"</code>: Validated Non-Suspects, or <code>"SV+NSV"</code>: both (by default)). </p>
</td></tr>
<tr><td><code id="correctError_+3A_threshold">threshold</code></td>
<td>
<p> the maximal number of items in each class of training set.
This is used to decide when to drop items for the reworked training set. </p>
</td></tr> 
<tr><td><code id="correctError_+3A_dropitemstotrain">dropItemsToTrain</code></td>
<td>
<p> the function to use to drop items in the training set
(depending on threshold). By default, it is <code>dropItemsToTrain()</code>, but it
could also be a custom function that has the same arguments. </p>
</td></tr>
<tr><td><code id="correctError_+3A_cl">cl</code></td>
<td>
<p> the class to consider. </p>
</td></tr>
<tr><td><code id="correctError_+3A_drop.nb">drop.nb</code></td>
<td>
<p> the number of items to drop. </p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>correctError()</code> returns nothing. It is called for its side-effect to install a web interface
for manual validation of samples.
</p>


<h3>Author(s)</h3>

<p> Philippe Grosjean &lt;Philippe.Grosjean@umons.ac.be&gt; </p>


<h3>See Also</h3>

 <p><code><a href="#topic+zidbDatRead">zidbDatRead</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'># TODO...
</code></pre>

<hr>
<h2 id='file-utilities'> Various file utility functions used by ZooImage </h2><span id='topic+extensionPattern'></span><span id='topic+hasExtension'></span><span id='topic+noExtension'></span><span id='topic+listFilesExt'></span><span id='topic+zimList'></span><span id='topic+zimDatList'></span><span id='topic+zipList'></span><span id='topic+zidList'></span><span id='topic+zidbList'></span><span id='topic+jpgList'></span><span id='topic+pngList'></span><span id='topic+checkFileExists'></span><span id='topic+checkDirExists'></span><span id='topic+checkEmptyDir'></span><span id='topic+forceDirCreate'></span><span id='topic+checkFirstLine'></span>

<h3>Description</h3>

<p>These functions are usually not called directly by the user, but they are
interesting for developers. They help to manage files in the context of
ZooImage processes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>extensionPattern(extension = "r", add.dot = !grepl("[.]", extension))
hasExtension(file, extension = "r", pattern = extensionPattern(extension))
noExtension(file)

listFilesExt(dir, extension = "r", pattern = extensionPattern(extension), ... )
zimList(dir, ...)
zimDatList(dir, ...)
zipList(dir, ...)
zidList(dir, ...)
zidbList(dir, ...)
jpgList(dir, ...)
pngList(dir, ...)

checkFileExists(file, extension, message = "file not found: %s",
    force.file = FALSE)
checkDirExists(dir, message = 'Path "%s" does not exist or is not a directory')
checkEmptyDir(dir, message = 'dir "%s" is not empty')
forceDirCreate(dir)

checkFirstLine(file, expected = c("ZI1", "ZI2", "ZI3", "ZI4", "ZI5"), 
    message = 'file "%s" is not a valid ZooImage version &lt;= 5 file')
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="file-utilities_+3A_extension">extension</code></td>
<td>
<p> lowercase version of the extension (the pattern will be
constructed to be case-insensitive). </p>
</td></tr>
<tr><td><code id="file-utilities_+3A_add.dot">add.dot</code></td>
<td>
<p> if a dot is not provided, it is added by default in front of
the pattern. </p>
</td></tr>
<tr><td><code id="file-utilities_+3A_file">file</code></td>
<td>
<p> one or more file names or file paths to check. </p>
</td></tr>
<tr><td><code id="file-utilities_+3A_pattern">pattern</code></td>
<td>
<p> a pattern matching a given file extension. </p>
</td></tr>
<tr><td><code id="file-utilities_+3A_...">...</code></td>
<td>
<p> further arguments passed to the function. Currently, not in use. </p>
</td></tr>
<tr><td><code id="file-utilities_+3A_dir">dir</code></td>
<td>
<p> the directory to work with. </p>
</td></tr>
<tr><td><code id="file-utilities_+3A_message">message</code></td>
<td>
<p> a warning message to provide (file/dirname replacement using %s). </p>
</td></tr>
<tr><td><code id="file-utilities_+3A_force.file">force.file</code></td>
<td>
<p> make sure the item is a file, not a directory. </p>
</td></tr>
<tr><td><code id="file-utilities_+3A_expected">expected</code></td>
<td>
<p> the expected content of the first line of the file. </p>
</td></tr>
</table>


<h3>Details</h3>

<p>All these function issue only warnings, no errors. Those functions that
return <code>TRUE</code> or <code>FALSE</code> are designed to be used in batch mode.
</p>


<h3>Value</h3>

<p>A string with suitable pattern to match a file extension for
<code>extensionPattern()</code>.
</p>
<p>The function <code>noExtension()</code> return base filenames without extensions.
</p>
<p>A list of files with given extension for <code>listFilesExt()</code>, and
<code>xxxList()</code> functions.
</p>
<p>The other functions return <code>TRUE</code> or <code>FALSE</code>, depending if the
tested condition is met or not.
</p>


<h3>Author(s)</h3>

<p>Philippe Grosjean &lt;Philippe.Grosjean@umons.ac.be&gt;</p>


<h3>See Also</h3>

<p><code><a href="#topic+sampleInfo">sampleInfo</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'># Construct a suitable pattern to match extensions of TIFF image files
extensionPattern("tif")
# Test if file names match given extensions (first 2 items only)
hasExtension(c("test1.tif", "test2.TIF", "test3.R"), "tif")
noExtension(c("test1.tif", "test2.TIF", "test3.R"))

# List all files with a given extension in a directory
ziDir &lt;- system.file("examples", package = "zooimage")
listFilesExt(ziDir, "zid")
zidList(ziDir) # Idem

# Check that a file or a directory exists
checkDirExists(ziDir)
zisFile &lt;- file.path(ziDir, "Description.zis")
checkFileExists(zisFile)

# Is this directory empty? (no)
checkEmptyDir(ziDir)

# force (re)creation of a directory
tmpDir &lt;- file.path(tempdir(), "testdir")
forceDirCreate(tmpDir)
file.info(tmpDir)$isdir # yes
checkEmptyDir(tmpDir)   # yes
file.remove(tmpDir)
file.exists(tmpDir)

# Every .zis file must start with ZI1-5 =&gt; check this...
checkFirstLine(zisFile)

# Clean up
rm(ziDir, zisFile, tmpDir)
</code></pre>

<hr>
<h2 id='gui'> The ZooImage GUI (Graphical User Interface) </h2><span id='topic+ZIDlg'></span><span id='topic+aboutZI'></span><span id='topic+exitZI'></span><span id='topic+closeAssistant'></span><span id='topic+closeZooImage'></span><span id='topic+viewManual'></span><span id='topic+viewFrenchManual'></span><span id='topic+focusR'></span><span id='topic+focusGraph'></span><span id='topic+acquireImg'></span><span id='topic+importImg'></span><span id='topic+processImg'></span><span id='topic+makeZid'></span><span id='topic+makeZidb'></span><span id='topic+makeZidbFlowCAM'></span><span id='topic+makeTrain'></span><span id='topic+countCellsGUI'></span><span id='topic+activeLearningGUI'></span><span id='topic+collectTrain'></span><span id='topic+compTrain'></span><span id='topic+addVigsToTrain'></span><span id='topic+makeClass'></span><span id='topic+analyzeClass'></span><span id='topic+vignettesClass'></span><span id='topic+validClass'></span><span id='topic+editDescription'></span><span id='topic+processSamples'></span><span id='topic+processSamplesWithCells'></span><span id='topic+viewResults'></span><span id='topic+exportResults'></span><span id='topic+loadObjects'></span><span id='topic+saveObjects'></span><span id='topic+listObjects'></span><span id='topic+removeObjects'></span><span id='topic+calib'></span><span id='topic+optInOutDecimalSep'></span><span id='topic+ZIUI'></span>

<h3>Description</h3>

<p>These function display menus and dialog boxes to access ZooImages function
without programming. Most of them are not intended to be called directly.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ZIDlg()
aboutZI(graphical = FALSE)
exitZI()
closeAssistant()
closeZooImage()
viewManual()
viewFrenchManual()
focusR()
focusGraph()
acquireImg()
importImg()
processImg()
makeZid()
makeZidb()
makeZidbFlowCAM()
makeTrain()
countCellsGUI()
activeLearningGUI()
collectTrain()
compTrain()
addVigsToTrain()
makeClass()
analyzeClass()
vignettesClass()
validClass()
editDescription()
processSamples()
processSamplesWithCells()
viewResults()
exportResults
loadObjects()
saveObjects()
listObjects()
removeObjects()
calib()
optInOutDecimalSep()
ZIUI()
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gui_+3A_graphical">graphical</code></td>
<td>
<p> If <code>TRUE</code>, a graphical dialog box displays the information.
Otherwise, information is printed at the R console. </p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>ZIDlg()</code> is called for its side effect of dispalying the main ZooImage dialog box.
<code>aboutZI()</code> gives sone information about the current ZooImage version.
<code>exitZI()</code> unloads the zooimage package (for instance, to allow updating it).
<code>ZIUI()</code> launches the error correction GUI using Shiny. The working dir
must be in _analyze subdirectory of an analysis directory tree.
</p>
<p>All the other functions are called for their side-effect and return value,
if any, is not of primary importance.
</p>


<h3>Author(s)</h3>

<p> Philippe Grosjean &lt;Philippe.Grosjean@umons.ac.be&gt; </p>


<h3>See Also</h3>

 <p><code><a href="#topic+zidCompress">zidCompress</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'># The dialog box can be started just by issuing
# &gt; ZIDlg()
</code></pre>

<hr>
<h2 id='gui-utilities'> Various GUI utility functions used by ZooImage </h2><span id='topic+selectObject'></span><span id='topic+selectList'></span><span id='topic+selectFile'></span><span id='topic+selectGroups'></span><span id='topic+createThreshold'></span><span id='topic+imageViewer'></span><span id='topic+startPgm'></span><span id='topic+modalAssistant'></span>

<h3>Description</h3>

<p>These functions are usually not called directly by the user, but they are
interesting for developers. They allow to select elements through dialog boxes.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>selectObject(class = "data.frame", default = "", multiple = FALSE,
    title = paste0("Choose a ", class, ":"))
selectList(class = "data.frame", default = "", multiple = FALSE,
    title = paste0("Choose a list (of ", class, "s):"))
selectFile(type = c("ZipZid", "ZimZis", "LstZid", "ZidZidb", "Zip", "Zid", "Zidb",
    "Zim", "Zis", "Zie", "Zic", "Img", "TifPgm", "RData"), multiple = FALSE,
    quote = TRUE, title = NULL)
selectGroups(groups, multiple = TRUE, title = "Select taxa you want to plot")

createThreshold(ZIDat)

imageViewer(dir = getwd(), pgm = getOption("ZI.ImageViewer"))
startPgm(program, cmdline = "", switchdir = FALSE, iconize = FALSE, wait = FALSE)
modalAssistant(title, text, init, options = NULL, check = NULL,
    select.file = NULL, returnValOnCancel = "ID_CANCEL", help.topic = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="gui-utilities_+3A_class">class</code></td>
<td>
<p> the class of objects to retrieve (or class of list components
for <code>selectList()</code>). </p>
</td></tr>
<tr><td><code id="gui-utilities_+3A_default">default</code></td>
<td>
<p> the default item selected in the list. </p>
</td></tr>
<tr><td><code id="gui-utilities_+3A_multiple">multiple</code></td>
<td>
<p> are multiple selections allowed? </p>
</td></tr>
<tr><td><code id="gui-utilities_+3A_title">title</code></td>
<td>
<p> the title of the dialog box. </p>
</td></tr>
<tr><td><code id="gui-utilities_+3A_type">type</code></td>
<td>
<p> the type of file to list in selection dialog box. </p>
</td></tr>
<tr><td><code id="gui-utilities_+3A_quote">quote</code></td>
<td>
<p> do we add quotes (\&quot;) around file names? </p>
</td></tr>
<tr><td><code id="gui-utilities_+3A_groups">groups</code></td>
<td>
<p> a list of groups to select from. </p>
</td></tr>
<tr><td><code id="gui-utilities_+3A_zidat">ZIDat</code></td>
<td>
<p> a ZIDat object. </p>
</td></tr>
<tr><td><code id="gui-utilities_+3A_dir">dir</code></td>
<td>
<p> directory to open in the image viewer. </p>
</td></tr>
<tr><td><code id="gui-utilities_+3A_pgm">pgm</code></td>
<td>
<p> program to use as image viewer. If not provided and not defined
in the <code>option(ZI.ImageViewer = ...)</code>, then, a reasonable default
program is used (the file explorer is no better program found). </p>
</td></tr>
<tr><td><code id="gui-utilities_+3A_program">program</code></td>
<td>
<p> name of the program to start. It must match an entry in R
options giving the actual executable that correspond to that program. </p>
</td></tr>
<tr><td><code id="gui-utilities_+3A_cmdline">cmdline</code></td>
<td>
<p> the command line to run to start this program. </p>
</td></tr>
<tr><td><code id="gui-utilities_+3A_switchdir">switchdir</code></td>
<td>
<p> do we switch R current directory to the directory where
the program is located? </p>
</td></tr>
<tr><td><code id="gui-utilities_+3A_iconize">iconize</code></td>
<td>
<p> in case the ZooImage assistant is open, do we iconize it? </p>
</td></tr>
<tr><td><code id="gui-utilities_+3A_wait">wait</code></td>
<td>
<p> do we wait that the external program is closed? </p>
</td></tr>
<tr><td><code id="gui-utilities_+3A_text">text</code></td>
<td>
<p> textual explanations to show in the modal assistant. </p>
</td></tr>
<tr><td><code id="gui-utilities_+3A_init">init</code></td>
<td>
<p> initial values for the modal assistant. </p>
</td></tr>
<tr><td><code id="gui-utilities_+3A_options">options</code></td>
<td>
<p> options to select in the modal assistant. </p>
</td></tr>
<tr><td><code id="gui-utilities_+3A_check">check</code></td>
<td>
<p> checkbox to add in the modal assistant. </p>
</td></tr>
<tr><td><code id="gui-utilities_+3A_select.file">select.file</code></td>
<td>
<p> prompt for a file to select in the modal assistant. </p>
</td></tr>
<tr><td><code id="gui-utilities_+3A_returnvaloncancel">returnValOnCancel</code></td>
<td>
<p> what to return if the user clicks the Cancel
button in the modal assistant dialog box? </p>
</td></tr>
<tr><td><code id="gui-utilities_+3A_help.topic">help.topic</code></td>
<td>
<p> help topic to associate with the Help button of the modal
assistant dialog box.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>As these functions are not made to be directly used by end-users, We don't
give more details here. Developers interested to use these functions are
encouraged to look at their code in the zooimage package source!
</p>


<h3>Value</h3>

<p>A string or vector of strings of selected items. <code>character(0)</code> is
returned to indicate the user clicked 'Cancel', while an empty string
(<code>""</code>) is returned in case there is no corresponding element found.
</p>
<p><code>createThreshold()</code> proposes a dialog box to create a threshold on one
variable in a ZIDat object (indicate minimum and maximum value allowed for
that variable).
</p>
<p>For <code>imageViewer()</code>, <code>TRUE</code> or <code>FALSE</code> is returned invisibly,
depending if the program could be lauched or not. The problem is reported in
a warning.
</p>
<p><code>startPgm()</code> is mostly invoked for its side effect of starting an
external program. Status code returned by the program is returned if
<code>wait = TRUE</code>.
</p>
<p><code>modalAssistant()</code> is currently disabled, and it will thus display no
dialog box and return <code>returnValOnCancel</code> directly.
</p>


<h3>Author(s)</h3>

<p>Philippe Grosjean &lt;Philippe.Grosjean@umons.ac.be&gt;</p>


<h3>See Also</h3>

<p><code><a href="#topic+listSamples">listSamples</a></code>, <code><a href="#topic+noExtension">noExtension</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
## Create two datasets in R and ask for selecting one:
df1__ &lt;- data.frame(x = 1:3, y = 4:6)
df2__ &lt;- data.frame(z = 1:10)
selectObject() # Try also to click 'Cancel'
## Can select both too
selectObject(multiple = TRUE, title = "Choose one or more data.frames")
selectObject("nonexistingclass") # Returns an empty string!

## Create lists containing only data frames as components
lst1__ &lt;- list(A = df1__, B = df2__)
lst2__ &lt;- list(C = df1__)
selectList() # Try also to click 'Cancel'
## Can select both too
selectList(multiple = TRUE, title = "Select one or more lists")
selectList("nonexistingclass")
rm(df1__, df2__, lst1__, lst2__)

## Select one or more ZooImage files
selectFile() # One Zip or Zid file

## Select groups to process
selectGroups(c("Copepods", "Appendicularians", "Medusae"))

## Start default image viewer on the current working directory
imageViewer()

## TODO: examples for createThreshold(), startPgm() and modalAssistant()

## End(Not run)
</code></pre>

<hr>
<h2 id='import'> Function to import data from the FlowCAM </h2><span id='topic+readFlowCAMctx'></span><span id='topic+readFlowCAMlst'></span><span id='topic+importFlowCAM'></span>

<h3>Description</h3>

<p>These functions read data and metadata from FlowCAM runs and import them into
ZooImage objects.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>readFlowCAMctx(ctx, stop.it = TRUE)
readFlowCAMlst(lst, skip = 2, read.ctx = TRUE)
importFlowCAM(lst, rgb.vigs = FALSE,  type = "ZI3", replace = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="import_+3A_ctx">ctx</code></td>
<td>
<p> the path to a .ctx FlowCAM file. </p>
</td></tr>
<tr><td><code id="import_+3A_stop.it">stop.it</code></td>
<td>
<p> should the process stop in case of an error? Set this to
<code>FALSE</code> when you run in batch mode and want the error to be repported
back to the calling code. </p>
</td></tr>
<tr><td><code id="import_+3A_lst">lst</code></td>
<td>
<p> the path to a .lst FlowCAM file. </p>
</td></tr>
<tr><td><code id="import_+3A_skip">skip</code></td>
<td>
<p> the number of lines to skip in the .lst table before reading the
data. This is usally two lines. </p>
</td></tr>
<tr><td><code id="import_+3A_read.ctx">read.ctx</code></td>
<td>
<p> should we also read the .ctx file with <code>readFlowCAMctx()</code>? </p>
</td></tr>
<tr><td><code id="import_+3A_rgb.vigs">rgb.vigs</code></td>
<td>
<p> do we build color vignettes that mix OD, visual and mask in the
three RGB channels? By default, not (FALSE) </p>
</td></tr>
<tr><td><code id="import_+3A_type">type</code></td>
<td>
<p> the type of <code>.zidb</code> file to create. Currently, only supports
<code>type = "ZI3"</code> (defaulf value). </p>
</td></tr>
<tr><td><code id="import_+3A_replace">replace</code></td>
<td>
<p> a boolean indicating if an existing <code>.zidb</code> file should
be replaced by a new one. </p>
</td></tr>
</table>


<h3>Details</h3>

<p>The Visual Spreadsheet software provided with the FlowCAM is constantly
changing specifications from version to version. This is mainly tested with
VS 1.5.14 and 3.2.3.
</p>


<h3>Value</h3>

<p>A <code>zidb</code> object with the converted data, metadata and images.
</p>


<h3>Author(s)</h3>

<p>Philippe Grosjean &lt;Philippe.Grosjean@umons.ac.be&gt;</p>


<h3>See Also</h3>

<p><code><a href="#topic+selectObject">selectObject</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>## TODO...
</code></pre>

<hr>
<h2 id='utilities'> Various utility functions used by ZooImage </h2><span id='topic+sampleInfo'></span><span id='topic+underscoreToSpace'></span><span id='topic+trimString'></span><span id='topic+listSamples'></span><span id='topic+makeId'></span><span id='topic+addClass'></span><span id='topic+calcVars'></span><span id='topic+dropVars'></span><span id='topic+ecd'></span><span id='topic+parseIni'></span><span id='topic+calibrate'></span><span id='topic+getDec'></span><span id='topic+zipNoteAdd'></span><span id='topic+zipNoteGet'></span><span id='topic+makeZIVignettes'></span>

<h3>Description</h3>

<p>These functions are usually not called directly by the user, but they are
interesting for developers.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sampleInfo(filename, type = c("sample", "fraction", "image", "scs",
    "date", "id", "frac", "imgnbr"), ext = "_dat[135][.]zim$")

underscoreToSpace(string)
trimString(string)

listSamples(ZIobj)
makeId(ZIDat)
addClass(ZIDat, ZIobj)
calcVars(x, drop.vars = NULL, drop.vars.def = dropVars())
dropVars()

ecd(area, cells = 1)

parseIni(data, label = "1")

calibrate(ODfile)

getDec()

zipNoteAdd(zipfile, zimfile)
zipNoteGet(zipfile, zimfile = NULL)

makeZIVignettes(orig.dir = getwd(), target.dir = dirname(orig.dir), clean.work = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="utilities_+3A_filename">filename</code></td>
<td>
<p> name of a file from which to extract information. It is
supposed to be spelled as: SCS.xxxx-xx-xx.SS+Fnn.ext where 'SCS' is the
series-cruise-station code, 'xxxx-xx-xx' is the date of collection
(year-month-day), 'SS' is the unique sample identifier, 'F' is the fraction,
'nn' is the image number (when there are several images per fraction) or
'nn.mmm' when there are 'mmm' pictures taken to cover a bigger area of cell
'nn', and 'ext' is the file extension. </p>
</td></tr>
<tr><td><code id="utilities_+3A_type">type</code></td>
<td>
<p> the type of data to extract (see examples) for
<code>sampleInfo()</code>, or the type of file to select in <code>selectFile()</code>. </p>
</td></tr>
<tr><td><code id="utilities_+3A_ext">ext</code></td>
<td>
<p> the pattern to use (regular expression) to eliminate file
extension from the 'filename'. </p>
</td></tr>
<tr><td><code id="utilities_+3A_string">string</code></td>
<td>
<p> a character string to rework, or a vector of character strings. </p>
</td></tr>
<tr><td><code id="utilities_+3A_ziobj">ZIobj</code></td>
<td>
<p> a ZooImage object (here, a 'ZIDat', 'ZIDesc', 'ZITrain' or
'ZITest' object; most probably one of the last two for <code>addClass()</code>). </p>
</td></tr>
<tr><td><code id="utilities_+3A_zidat">ZIDat</code></td>
<td>
<p> a 'ZIDat' object, or a data frame with correct column labels. </p>
</td></tr>
<tr><td><code id="utilities_+3A_x">x</code></td>
<td>
<p> a data frame, but most probably, a 'ZIDat' object. </p>
</td></tr>
<tr><td><code id="utilities_+3A_drop.vars">drop.vars</code></td>
<td>
<p> a character vector with names of variables to drop, or
<code>NULL</code> (by default) to keep them all. </p>
</td></tr>
<tr><td><code id="utilities_+3A_drop.vars.def">drop.vars.def</code></td>
<td>
<p> a second list of variables to drop contained in a
character vector. That list is supposed to match the name of variables that
are obviously non informative and that are dropped by default. It can be
gathered automatically using <code>dropVars()</code>. That list includes Id,
Label, Dil, ... (see details, variables with an asterisk). </p>
</td></tr>
<tr><td><code id="utilities_+3A_area">area</code></td>
<td>
<p> a numerical vector with areas from which ECDs are calculated
(Equivalent Circular Diameter, a more suitable term for 2D images than ESD,
Equivalent Spherical Diameter). </p>
</td></tr>
<tr><td><code id="utilities_+3A_cells">cells</code></td>
<td>
<p> the number of cells in the particle (colony). If different from 1,
the area is first divided by the number of cells bevore calculating the cell
individual ECD. </p>
</td></tr>
<tr><td><code id="utilities_+3A_data">data</code></td>
<td>
<p> a vector containing the data to parse. </p>
</td></tr>
<tr><td><code id="utilities_+3A_label">label</code></td>
<td>
<p> a label to include for the parsed data. </p>
</td></tr>
<tr><td><code id="utilities_+3A_odfile">ODfile</code></td>
<td>
<p> an image file of O.D. calibrated items that can be used to
calibrate grayscales. </p>
</td></tr>
<tr><td><code id="utilities_+3A_zipfile">zipfile</code></td>
<td>
<p> a zip archive. </p>
</td></tr>
<tr><td><code id="utilities_+3A_zimfile">zimfile</code></td>
<td>
<p> a .zim file to use, or to create. If <code>NULL</code> (default)
in <code>zipNoteGet()</code>, the data are not written in a file, but returned. </p>
</td></tr>
<tr><td><code id="utilities_+3A_orig.dir">orig.dir</code></td>
<td>
<p> the directory containing the data (current directory by
default) </p>
</td></tr>
<tr><td><code id="utilities_+3A_target.dir">target.dir</code></td>
<td>
<p> where to place the results, by defaut, the parent directory
of <code>orig.dir</code></p>
</td></tr>
<tr><td><code id="utilities_+3A_clean.work">clean.work</code></td>
<td>
<p> should we clean intermediary items (<code>FALSE</code>, by default)</p>
</td></tr>
</table>


<h3>Details</h3>

<p>As these functions are not made to be directly used by end-users, We don't
give more details here. Developers interested to use these functions are
encouraged to look at their code in the zooimage package source!
</p>
<p>Here is the list of all variables you got after running the standard version
of <code>calcVars()</code> on ZIDat objects made by one of the ZooImage ImageJ
plugins (you can provide your own version for, e.g., calculating
more features):
</p>

<table>
<tr>
 <td style="text-align: left;">
    Variable    </td><td style="text-align: left;"> Description                                                       </td><td style="text-align: left;"> Origin </td>
</tr>
<tr>
 <td style="text-align: left;">
        Area </td><td style="text-align: left;"> Area of the region of interest (ROI)                                 </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
        Mean </td><td style="text-align: left;"> Average gray value of the ROI                                        </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
      StdDev </td><td style="text-align: left;"> Standard deviation of the gray values                                </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
        Mode </td><td style="text-align: left;"> Most frequent gray value within the ROI                              </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
         Min </td><td style="text-align: left;"> Minimum gray value within the ROI                                    </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
         Max </td><td style="text-align: left;"> Maximum gray value within the ROI                                    </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
          X* </td><td style="text-align: left;"> X coordinate of the centroid of the ROI in the image                 </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
          Y* </td><td style="text-align: left;"> Y coordinate of the centroid of the ROI in the image                 </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
         XM* </td><td style="text-align: left;"> X coordinate of the center of mass of the ROI in the image           </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
         YM* </td><td style="text-align: left;"> Y coordinate of the center of mass of the ROI in the image           </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
      Perim. </td><td style="text-align: left;"> Perimeter of the ROI                                                 </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
         BX* </td><td style="text-align: left;"> X coordinate of the upper left corner of the bounding rectangle (BR) </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
         BY* </td><td style="text-align: left;"> Y coordinate of the upper left corner of the BR                      </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
      Width* </td><td style="text-align: left;"> Width of the rectangle enclosing the ROI                             </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
     Height* </td><td style="text-align: left;"> Height of the rectangle enclosing the ROI                            </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
       Major </td><td style="text-align: left;"> Length of the longest axis of the ellipse fitted to the ROI          </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
       Minor </td><td style="text-align: left;"> Length of the smallest axis of ellipse fitted to the ROI             </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
      Angle* </td><td style="text-align: left;"> Angle between longest axis and an horizontal line                    </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
       Circ. </td><td style="text-align: left;"> Circularity of the ROI                                               </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
       Feret </td><td style="text-align: left;"> Longest Feret diameter                                               </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
      IntDen </td><td style="text-align: left;"> Sum of the gray values within the ROI                                </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
      Median </td><td style="text-align: left;"> Median value of the gray values within the ROI                       </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
        Skew </td><td style="text-align: left;"> Third order moment for the gray value                                </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
        Kurt </td><td style="text-align: left;"> Fourth order moment for the gray value                               </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
     XStart* </td><td style="text-align: left;"> X coordinate of initial point for the outline of the ROI             </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
     YStart* </td><td style="text-align: left;"> Y coordinate of initial point for the outline of the ROI             </td><td style="text-align: left;"> ImageJ </td>
</tr>
<tr>
 <td style="text-align: left;">
         Id* </td><td style="text-align: left;"> Unique identifier of the ROI (Label_Item)                            </td><td style="text-align: left;"> zooimage </td>
</tr>
<tr>
 <td style="text-align: left;">
      Label* </td><td style="text-align: left;"> Unique name of the image                                             </td><td style="text-align: left;"> zooimage </td>
</tr>
<tr>
 <td style="text-align: left;">
       Item* </td><td style="text-align: left;"> Name of the ROI                                                      </td><td style="text-align: left;"> zooimage </td>
</tr>
<tr>
 <td style="text-align: left;">
         ECD </td><td style="text-align: left;"> Equivalent circular diameter of the ROI                              </td><td style="text-align: left;"> zooimage </td>
</tr>
<tr>
 <td style="text-align: left;">
        Dil* </td><td style="text-align: left;"> Dilution coefficient to use for that ROI                             </td><td style="text-align: left;"> zooimage </td>
</tr>
<tr>
 <td style="text-align: left;">
 AspectRatio </td><td style="text-align: left;"> Aspect ratio of the ROI                                              </td><td style="text-align: left;"> zooimage </td>
</tr>
<tr>
 <td style="text-align: left;">
    CentBoxD </td><td style="text-align: left;"> Distance between the centroid and the center of the BR               </td><td style="text-align: left;"> zooimage </td>
</tr>
<tr>
 <td style="text-align: left;">
GrayCentBoxD </td><td style="text-align: left;"> Distance between the center of mass and the center of the BR         </td><td style="text-align: left;"> zooimage </td>
</tr>
<tr>
 <td style="text-align: left;">
  CentroidsD </td><td style="text-align: left;"> Distance between the centroid and the center mass                    </td><td style="text-align: left;"> zooimage </td>
</tr>
<tr>
 <td style="text-align: left;">
       Range </td><td style="text-align: left;"> Range of the gray values in the ROI                                  </td><td style="text-align: left;"> zooimage </td>
</tr>
<tr>
 <td style="text-align: left;">
     MeanPos </td><td style="text-align: left;"> Position of mean gray value in the range of gray values              </td><td style="text-align: left;"> zooimage </td>
</tr>
<tr>
 <td style="text-align: left;">
      SDNorm </td><td style="text-align: left;"> Normalized standard deviation of the gray values                     </td><td style="text-align: left;"> zooimage </td>
</tr>
<tr>
 <td style="text-align: left;">
          CV </td><td style="text-align: left;"> Coefficient of variation of gray values                              </td><td style="text-align: left;"> zooimage </td>
</tr>
<tr>
 <td style="text-align: left;">
     MeanDia </td><td style="text-align: left;"> Mean diameter calculated on Major and Minor                          </td><td style="text-align: left;"> zooimage </td>
</tr>
<tr>
 <td style="text-align: left;">
    MeanFDia </td><td style="text-align: left;"> Mean diameter calculated on Feret and Minor                          </td><td style="text-align: left;"> zooimage </td>
</tr>
<tr>
 <td style="text-align: left;">
     Transp1 </td><td style="text-align: left;"> Transparency calculated using ECD and MeanDia                        </td><td style="text-align: left;"> zooimage </td>
</tr>
<tr>
 <td style="text-align: left;">
     Transp2 </td><td style="text-align: left;"> Transparency calculated using ECD and MeanFDia                       </td><td style="text-align: left;"> zooimage </td>
</tr>
<tr>
 <td style="text-align: left;">
  Elongation </td><td style="text-align: left;"> Elongation of the ROI                                                </td><td style="text-align: left;"> zooimage </td>
</tr>
<tr>
 <td style="text-align: left;">
 Compactness </td><td style="text-align: left;"> Compactness of the ROI                                               </td><td style="text-align: left;"> zooimage </td>
</tr>
<tr>
 <td style="text-align: left;">
   Roundness </td><td style="text-align: left;"> Roundness of the ROI                                                 </td><td style="text-align: left;"> zooimage </td>
</tr>
<tr>
 <td style="text-align: left;">
      Class* </td><td style="text-align: left;"> Manual identification of the vignette for that ROI                   </td><td style="text-align: left;"> zooimage </td>
</tr>
<tr>
 <td style="text-align: left;">
  Predicted* </td><td style="text-align: left;"> Automatic identification of the vignette for that ROI                </td><td style="text-align: left;"> zooimage </td>
</tr>
<tr>
 <td style="text-align: left;">
 Predicted2* </td><td style="text-align: left;"> Second automatic identification of the vignette for that ROI         </td><td style="text-align: left;"> zooimage
  </td>
</tr>

</table>

<p>For the origin, ImageJ = measured during image ananlysis plugin in ImageJ,
zooimage = calculated either during importation of data, or by
<code>calcVars()</code>. Variables whose name ends with an asterisk are dropped by
default.
</p>


<h3>Value</h3>

<p>A string or vector of strings for <code>sampleInfo()</code>, <code>listSamples()</code>
and <code>makeId()</code>. For those functions, <code>character(0)</code> is returned to
indicate a problem (usually with a warning issued to explain it), while
an empty string (<code>""</code>) is returned in case there is no corresponding
element found.
</p>
<p>The data.frame with additional columns for calculated variables with
<code>calcVars()</code>. Variables to drop are gathered using <code>dropVars()</code>,
altogether with a list provided explicitly in the <code>drop.vars =</code> argument.
The list of variable names to drop automatically and silently can be stored in
a variable named <code>ZI.dropVarsDef</code> or in <code>options(ZI.dropVarsDef = ....)</code>.
</p>
<p>A vector of numerical values for <code>ecd()</code>.
</p>
<p>Transformed strings for <code>trimstring()</code> and <code>underscoreToSpace()</code>
</p>
<p><code>parseIni()</code> reads the data and creates a list of data frames. Each
entry in the list maps one section in the ini file (with the same name). For
'key=value' pairs, a one line data frame containing values and with keys as
column names. The first column of these data frames is named label and get the
corresponding value passed by the 'label' argument. That way, one can easily
keep track of entries when data frames originated from various different ini
files are merged together.
</p>
<p><code>calibrate()</code> returns a vector of two numbers with white and black point
calibration (gray levels corresponding, respectively to O.D. = 0 and
O.D. = 1.024), plus a &quot;msg&quot; attribute with some explanation in case of problem.
</p>
<p><code>zipNoteAdd()</code> returns <code>TRUE</code> or <code>FALSE</code> depending if the data
from the zimfile was successfully added to the zip archive or not. Problem is
returned in a warning.
<code>zipNoteGet()</code> returns the comment included in the zip archive
(invisibly if 'zimfile' is not <code>NULL</code>), <code>character(0)</code> if no comment
if found, or <code>NULL</code> in case of a problem. The problem is detailled in a
warning.
</p>


<h3>Author(s)</h3>

<p>Philippe Grosjean &lt;Philippe.Grosjean@umons.ac.be&gt;</p>


<h3>See Also</h3>

<p><code><a href="#topic+noExtension">noExtension</a></code>, <code><a href="#topic+selectObject">selectObject</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'># Given a correct ZooImage name for a sample, return parts of it
smp__ &lt;- "MTLG.2010-03-15.H1+A1.03_dat1.zim"
sampleInfo(smp__, "sample")
sampleInfo(smp__, "fraction")
sampleInfo(smp__, "image")
sampleInfo(smp__, "scs")
sampleInfo(smp__, "date")
sampleInfo(smp__, "id")
sampleInfo(smp__, "frac")
sampleInfo(smp__, "imgnbr")
rm(smp__)
sampleInfo(c("ScanG16.2004-10-20+A1.tif", "ScanG16.2004-10-20+B1.tif"),
    type = "sample", ext = extensionPattern("tif"))

# Character strings manipulation functions
underscoreToSpace("Some_string_to_convert")
trimString("    \tString with\textra spaces  \t")

# Variables calculation utilities
df__ &lt;- data.frame(Label = c("Alabel", "AnotherLabel"), Item = c("01", "02"))
makeId(df__)
rm(df__)
ecd(1:10)
ecd(1:10, cells = 2)
ecd(1:10, cells = 1:10)

### TODO: addClass(), calibrate(), calcVars(), parseIni(), zipNoteAdd() and zipNoteGet() examples
</code></pre>

<hr>
<h2 id='zic'> Check .zic files (ZooImage Categories) </h2><span id='topic+zicCheck'></span>

<h3>Description</h3>

<p>Categories (i.e., plankton taxa), with possibly several sub-levels are defined
in .zic files. This function check the files are correct.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>zicCheck(zicfile)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="zic_+3A_zicfile">zicfile</code></td>
<td>
<p> the name of the .zic file to test. </p>
</td></tr>
</table>


<h3>Value</h3>

<p>This function return <code>TRUE</code> or <code>FALSE</code>, depending on the content
of the tested file.
</p>


<h3>Author(s)</h3>

<p> Philippe Grosjean &lt;Philippe.Grosjean@umons.ac.be&gt; </p>


<h3>See Also</h3>

 <p><code><a href="#topic+prepareTrain">prepareTrain</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'>## Check that Detailed.zic file in the /etc subdir is correct
zicCheck(file.path(svMisc::getTemp("ZIetc"), "Detailed.zic"))
</code></pre>

<hr>
<h2 id='ZIClass'> Create and manipulate 'ZIClass' objects </h2><span id='topic+ZIClass'></span><span id='topic+print.ZIClass'></span><span id='topic+summary.ZIClass'></span><span id='topic+predict.ZIClass'></span><span id='topic+confusion.ZIClass'></span>

<h3>Description</h3>

<p>'ZIClass' objects are key items in ZooImage. They contain all what is required
for automatically classify plancton from .zid files. They can be used as
blackboxes by all users (but require users trained in machine learning
techniques to build them). Hence, ZooImage is made very simple for biologists
that just want to use classifiers but do not want to worry about all the
complexities of what is done inside the engine!
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ZIClass(formula, data, method = getOption("ZI.mlearning", "mlRforest"),
    calc.vars = getOption("ZI.calcVars", calcVars), drop.vars = NULL,
    drop.vars.def = dropVars(), cv.k = 10, cv.strat = TRUE,
    ..., subset, na.action = na.omit)

## S3 method for class 'ZIClass'
print(x, ...)
## S3 method for class 'ZIClass'
summary(object, sort.by = "Fscore", decreasing = TRUE,
    na.rm = FALSE, ...)
## S3 method for class 'ZIClass'
predict(object, newdata, calc = TRUE, class.only = TRUE,
    type = "class", ...)
## S3 method for class 'ZIClass'
confusion(x, y = response(x), labels = c("Actual", "Predicted"),
    useNA = "ifany", prior, use.cv = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

  
<table role = "presentation">
<tr><td><code id="ZIClass_+3A_formula">formula</code></td>
<td>
<p> a formula with left member being the class variable and the
right member being a list of predicting variables separated by a '+' sign.
Since <code>data</code> is supposed to be previously filtered using
<code>calc.vars</code> and the class variable in 'ZITrain' object is always
named <code>Class</code>, the formula almost always reduces to <code>Class ~ .</code> </p>
</td></tr>
<tr><td><code id="ZIClass_+3A_data">data</code></td>
<td>
<p> a data frame (a 'ZITrain' object usually), containing both
measurement and manual classification (a factor variables usually named
'Class'). </p>
</td></tr>
<tr><td><code id="ZIClass_+3A_method">method</code></td>
<td>
<p> the machine learning method to use. It should produce
results compatible with <code>mlearning</code> objects as returned by the various
<code>mlXXX()</code> functions in the <code>mlearning</code> package. By default, the
random forest algorithm is used (it is among the ones that give best result
with plankton). </p>
</td></tr>
<tr><td><code id="ZIClass_+3A_calc.vars">calc.vars</code></td>
<td>
<p> a function to use to calculate variables from the original
data frame. </p>
</td></tr>
<tr><td><code id="ZIClass_+3A_drop.vars">drop.vars</code></td>
<td>
<p> a character vector with names of variables to drop for the
classification, or <code>NULL</code> (by default) to keep them all. </p>
</td></tr>
<tr><td><code id="ZIClass_+3A_drop.vars.def">drop.vars.def</code></td>
<td>
<p> a second list of variables to drop contained in a
character vector. That list is supposed to match the name of variables that
are obviously non informative and are dropped by default. It can be gathered
automatically using <code>dropVars()</code>. See <code>?calcVars</code> for more details. </p>
</td></tr>
<tr><td><code id="ZIClass_+3A_cv.k">cv.k</code></td>
<td>
<p> the k times for cross-validation. </p>
</td></tr>
<tr><td><code id="ZIClass_+3A_cv.strat">cv.strat</code></td>
<td>
<p> do we use a stratified sampling for cross-validation?
(recommended). </p>
</td></tr>
<tr><td><code id="ZIClass_+3A_...">...</code></td>
<td>
<p> further arguments to pass to the classification algorithm (see
help of that particular function). </p>
</td></tr>
<tr><td><code id="ZIClass_+3A_subset">subset</code></td>
<td>
<p> an expression for subsetting to original data frame. </p>
</td></tr>
<tr><td><code id="ZIClass_+3A_na.action">na.action</code></td>
<td>
<p> the function to filter the initial data frame for missing
values. Althoung the default in R is <code>na.fail</code>, leading to failure if
at least one <code>NA</code> is found in the data frame, the default here is
<code>na.omit</code> which leads to elimination of all lines containing at least
one <code>NA</code>. Take care about how many items remain, if you encounter
many <code>NA</code>s in your dataset! </p>
</td></tr>
<tr><td><code id="ZIClass_+3A_x">x</code></td>
<td>
<p> a 'ZIClass' object. </p>
</td></tr>
<tr><td><code id="ZIClass_+3A_object">object</code></td>
<td>
<p> a 'ZIClass' object. </p>
</td></tr>
<tr><td><code id="ZIClass_+3A_newdata">newdata</code></td>
<td>
<p> a 'ZIDat' object, or a 'data.frame' to use for prediction. </p>
</td></tr>
<tr><td><code id="ZIClass_+3A_sort.by">sort.by</code></td>
<td>
<p> the statistics to use to sort the table (by default, F-score). </p>
</td></tr>
<tr><td><code id="ZIClass_+3A_decreasing">decreasing</code></td>
<td>
<p> do we sort in increasing or decreasing order? </p>
</td></tr>
<tr><td><code id="ZIClass_+3A_na.rm">na.rm</code></td>
<td>
<p> do we eliminate entries with missing data first (using
<code>na.omit()</code>)? </p>
</td></tr>
<tr><td><code id="ZIClass_+3A_calc">calc</code></td>
<td>
<p> a boolean indicating if variables have to be recalculated
before running the prediction. </p>
</td></tr>
<tr><td><code id="ZIClass_+3A_class.only">class.only</code></td>
<td>
<p> if TRUE, return just a vector with classification,
otherwise, return the 'ZIDat' object with 'Predicted' column appended to it. </p>
</td></tr>
<tr><td><code id="ZIClass_+3A_type">type</code></td>
<td>
<p> the type of result to return, <code>"class"</code> by default. No other
value is permitted if class.only is <code>FALSE</code>. </p>
</td></tr>
<tr><td><code id="ZIClass_+3A_y">y</code></td>
<td>
<p> a factor with reference classes. </p>
</td></tr>
<tr><td><code id="ZIClass_+3A_labels">labels</code></td>
<td>
<p> labels to use for, respectively, the reference class and the
predicted class. </p>
</td></tr>
<tr><td><code id="ZIClass_+3A_usena">useNA</code></td>
<td>
<p> do we keep NAs as a separate category? The default <code>"ifany"</code>
creates this category only if there are missing values. Other possibilities
are <code>"no"</code>, or <code>"always"</code>. The default is suitable for test sets
because unclassified items (those in the &quot;\_&quot; directory or one of its
subdirectories) get <code>NA</code> for Class. </p>
</td></tr>
<tr><td><code id="ZIClass_+3A_prior">prior</code></td>
<td>
<p> class frequencies to use for first classifier that
is tabulated in the rows of the confusion matrix. This is either a single
positive numeric to set all class frequencies to this value (use 1 for
relative frequencies and 100 for relative freqs in percent), or a vector of
positive numbers of the same length as the levels in the object. If the
vector is named, names must match levels. Alternatively, providing
<code>NULL</code> or an object of null length resets row class prefencies into
their initial values. </p>
</td></tr>
<tr><td><code id="ZIClass_+3A_use.cv">use.cv</code></td>
<td>
<p> the predicted values extracted from the 'ZIClass' object can
either be the predicted values from the training set, or the cross-validated
predictions (by default). Most of the time, you want the cross-validated
predictions, which allows for not (or less) biased evaluation of the
classifier prediction... So, if you don't know, you are probably better
leaving the default value. </p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>ZIClass()</code> is the constructor that build the 'ZIClass' object.
<code>print()</code>, <code>summary()</code> and <code>predict())</code> are the methods to
print the object, to calculate statistics on this classifier based on the
confusion matrix and to predict groups for ZooImage samples, using one
'ZIClass' object.
</p>


<h3>Note</h3>

<p>Always analyze carefully the properties, performances and limitations of a
'ZIClass' object before using it to classify objects of one series. For
instance, you can use <code>confusion()</code> to compare two classifiers, or an
automatic classifier with a manual classification done by a taxonomists.
Always respect the limitations in the use of a 'ZIClass' object (for
instance, a classifier specific of one given series should not be used to
classify items in a different series)! It is a good practice to make a
report, documenting a 'ZIClass' object, together with the comments of
taxonomists that made the reference training set, and with details on the
analysis of the performances of the classifier.
</p>


<h3>Author(s)</h3>

<p> Philippe Grosjean &lt;Philippe.Grosjean@umons.ac.be&gt; </p>


<h3>See Also</h3>

 <p><code><a href="#topic+getTrain">getTrain</a></code>, <code><a href="mlearning.html#topic+confusion">confusion</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'>##TODO...
</code></pre>

<hr>
<h2 id='zid'> Manage .zid files (ZooImage Data) </h2><span id='topic+zidClean'></span><span id='topic+zidCompress'></span><span id='topic+zidCompressAll'></span><span id='topic+zidDatMake'></span><span id='topic+zidDatRead'></span><span id='topic+zidUncompress'></span><span id='topic+zidUncompressAll'></span><span id='topic+zidVerify'></span><span id='topic+zidVerifyAll'></span>

<h3>Description</h3>

<p>Compress, uncompress and verify ZooImage Data files.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>zidCompress(zidir, type = c("ZI1", "ZI2", "ZI3", "ZI4", "ZI5"), check = TRUE,
    check.vignettes = TRUE, replace = FALSE, delete.source = replace)
zidCompressAll(path = ".", samples = NULL, type = c("ZI1", "ZI2", "ZI3", "ZI4", "ZI5"),
    check = TRUE, check.vignettes = TRUE, replace = FALSE,
    delete.source = replace)

zidClean(path = ".", samples = NULL)
zidDatMake(zidir, type = "ZI5", replace = FALSE)
zidDatRead(zidfile)

zidUncompress(zidfile, path = dirname(zidfile), delete.source = FALSE)
zidUncompressAll(path = ".", zidfiles = zidList(path, full.names = TRUE),
    path.extract = path, skip.existing.dirs = TRUE, delete.source = FALSE)

zidVerify(zidir, type = c("ZI1", "ZI2", "ZI3", "ZI4", "ZI5"), check.vignettes = TRUE)
zidVerifyAll(path = ".", samples = NULL, type = c("ZI1", "ZI2", "ZI3", "ZI4", "ZI5"),
    check.vignettes = TRUE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="zid_+3A_zidir">zidir</code></td>
<td>
<p> a directory containing data to put in a .zid files. </p>
</td></tr>
<tr><td><code id="zid_+3A_type">type</code></td>
<td>
<p> the ZI file format, currently 'ZI1', 'ZI2', 'ZI3', 'ZI4', or 'ZI5' types are
supported (ZooImage1-5). </p>
</td></tr>
<tr><td><code id="zid_+3A_check">check</code></td>
<td>
<p> do we check the files in this directory before/after compression? </p>
</td></tr>
<tr><td><code id="zid_+3A_check.vignettes">check.vignettes</code></td>
<td>
<p> do we check if the future .zid file contains all vignettes? </p>
</td></tr>
<tr><td><code id="zid_+3A_replace">replace</code></td>
<td>
<p> do we replace existing files? </p>
</td></tr>
<tr><td><code id="zid_+3A_delete.source">delete.source</code></td>
<td>
<p> do we delete source files after compression? </p>
</td></tr>
<tr><td><code id="zid_+3A_path">path</code></td>
<td>
<p> (un)compress or verify all subdirectories (except those starting with '\_')
in respective .zid files. Also, a place where to put uncompressed files (in the 'sample' subdirectory). </p>
</td></tr>
<tr><td><code id="zid_+3A_samples">samples</code></td>
<td>
<p> a list of 'samples', i.e., subdirectories to process. </p>
</td></tr>
<tr><td><code id="zid_+3A_zidfile">zidfile</code></td>
<td>
<p> a .zid file to uncompress or read from. </p>
</td></tr>
<tr><td><code id="zid_+3A_zidfiles">zidfiles</code></td>
<td>
<p> a series of .zid files to uncompress. </p>
</td></tr>
<tr><td><code id="zid_+3A_path.extract">path.extract</code></td>
<td>
<p> a place where to extract data from .zid files. </p>
</td></tr>
<tr><td><code id="zid_+3A_skip.existing.dirs">skip.existing.dirs</code></td>
<td>
<p> do not unzip if the subdir already exists. </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p> Philippe Grosjean &lt;Philippe.Grosjean@umons.ac.be&gt; </p>


<h3>See Also</h3>

 <p><code><a href="#topic+zimMake">zimMake</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'>##TODO...
</code></pre>

<hr>
<h2 id='zidb'> Manage .zidb files (ZooImage Databases) </h2><span id='topic+zidbMake'></span><span id='topic+zidbMakeAll'></span><span id='topic+zidToZidb'></span><span id='topic+zidToZidbAll'></span><span id='topic+zidbToZid'></span><span id='topic+zidbToZidAll'></span><span id='topic+zidbLink'></span><span id='topic+zidbDatRead'></span><span id='topic+zidbSampleRead'></span><span id='topic+zidbSummary'></span><span id='topic+zidbPlotNew'></span><span id='topic+zidbDrawVignette'></span><span id='topic+zidbPlotPage'></span>

<h3>Description</h3>

<p>Compress, uncompress .zidb files that contain data for a sample. Starting from
ZooImage 3, the new format uses filehash tables for better performances.
Conversion from and to the old .zid format (a zip archive indeed) is supported
for compatibility with old datasets. Display content of a .zidb file is a
simple way (both data/metadata and vignettes)
</p>


<h3>Usage</h3>

<pre><code class='language-R'>zidbMake(zidir, zidbfile = paste0(sub("[/\\]+$", "", zidir), ".zidb"), zisfile =
    file.path(dirname(zidir), "Description.zis"), type = "ZI5", smptime = "",
    check = FALSE, check.vignettes = FALSE, replace = FALSE, delete.source = replace)
zidbMakeAll(path = ".", samples, zisfiles = file.path(dirname(samples),
    "Description.zis"), type = "ZI5", check = FALSE,
    check.vignettes = FALSE, replace = FALSE, delete.source = replace)

zidToZidb(zidfile, zisfile = file.path(dirname(zidfile),
    "Description.zis"), replace = FALSE, delete.source = replace)
zidToZidbAll(path = ".", zidfiles, zisfiles = file.path(dirname(zidfiles),
    "Description.zis"), replace = FALSE, delete.source = replace)
zidbToZid(zidbfile, zisfile = file.path(dirname(zidbfile),
    "Description.zis"), replace = FALSE, delete.source = replace)
zidbToZidAll(path = ".", zidbfiles, zisfiles = file.path(dirname(zidbfiles),
    "Description.zis"), replace = FALSE, delete.source = replace)

zidbLink(zidbfile)
zidbDatRead(zidbfile)
zidbSampleRead(zidbfile)
zidbSummary(zidbfile, n = 3)

zidbPlotNew(main = "ZooImage collage", ...)
zidbDrawVignette(rawimg, type, item, nx = 5, ny = 5, vmar = 0.01)
zidbPlotPage(zidbfile, page = 1, title = NULL, type = "guess", method = NULL,
class = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="zidb_+3A_zidir">zidir</code></td>
<td>
<p> a directory containing data to put in a .zidb files. </p>
</td></tr>
<tr><td><code id="zidb_+3A_zidbfile">zidbfile</code></td>
<td>
<p> the path of the .zidb file. </p>
</td></tr>
<tr><td><code id="zidb_+3A_zidbfiles">zidbfiles</code></td>
<td>
<p> the path of a series of .zidb files. </p>
</td></tr>
<tr><td><code id="zidb_+3A_zidfile">zidfile</code></td>
<td>
<p> the path of a .zid file. </p>
</td></tr>
<tr><td><code id="zidb_+3A_zidfiles">zidfiles</code></td>
<td>
<p> the path of a series of .zid files. </p>
</td></tr>
<tr><td><code id="zidb_+3A_zisfile">zisfile</code></td>
<td>
<p> the path of the .zis file that contains description of this
sample. </p>
</td></tr>
<tr><td><code id="zidb_+3A_zisfiles">zisfiles</code></td>
<td>
<p> the path of a series of .zis files that contain description
of the processed samples. </p>
</td></tr>
<tr><td><code id="zidb_+3A_type">type</code></td>
<td>
<p> the ZI file format, currently only 'ZI5' type is supported. For
<code>zidbDrawVignette()</code> and <code>zidbPlotPage()</code>, it is the type of
vignette image. Currently, it can be either &quot;jpg&quot;, or &quot;png&quot;. If not
provided, or if <code>type = "guess"</code> it will be guessed by the function. </p>
</td></tr>
<tr><td><code id="zidb_+3A_smptime">smptime</code></td>
<td>
<p> the time the sample was collected. This value will replace a
<code>&lt;&lt;&lt;TIME&gt;&gt;&gt;</code> placeholder in the metadata. You can also use
<code>&lt;&lt;&lt;SMP&gt;&gt;&gt;</code> and <code>&lt;&lt;&lt;DATE&gt;&gt;&gt;</code> placeholders in corresponding metadata
and they will be replaced by values computed from the sample name. </p>
</td></tr>
<tr><td><code id="zidb_+3A_check">check</code></td>
<td>
<p> do we check the files in this directory before/after compression? </p>
</td></tr>
<tr><td><code id="zidb_+3A_check.vignettes">check.vignettes</code></td>
<td>
<p> do we check if the future .zidb file contains all
vignettes? This is <code>FALSE</code> by default because they may not exist yet.
This is the case when they are generated on the fly, like in the new version
5.5 processes. </p>
</td></tr>
<tr><td><code id="zidb_+3A_replace">replace</code></td>
<td>
<p> do we replace existing files? </p>
</td></tr>
<tr><td><code id="zidb_+3A_delete.source">delete.source</code></td>
<td>
<p> do we delete source files after compression? </p>
</td></tr>
<tr><td><code id="zidb_+3A_n">n</code></td>
<td>
<p> the number of line of the data to print. If <code>n &lt;= 0</code> no data is
printed (only metadata). </p>
</td></tr>
<tr><td><code id="zidb_+3A_path">path</code></td>
<td>
<p> look for files in this path. </p>
</td></tr>
<tr><td><code id="zidb_+3A_samples">samples</code></td>
<td>
<p> a list of 'samples', i.e., subdirectories to process. </p>
</td></tr>
<tr><td><code id="zidb_+3A_main">main</code></td>
<td>
<p> the title of the new plot. </p>
</td></tr>
<tr><td><code id="zidb_+3A_...">...</code></td>
<td>
<p> further arguments passed to the <code>plot()</code> function. </p>
</td></tr>
<tr><td><code id="zidb_+3A_rawimg">rawimg</code></td>
<td>
<p> the raw content of a vignette, as stored in a .zidb file. </p>
</td></tr>
<tr><td><code id="zidb_+3A_item">item</code></td>
<td>
<p> the item number to draw (enumeration from left to right and from
top to bottom). </p>
</td></tr>
<tr><td><code id="zidb_+3A_nx">nx</code></td>
<td>
<p> the number of vignettes in a column. </p>
</td></tr>
<tr><td><code id="zidb_+3A_ny">ny</code></td>
<td>
<p> the number of vignettes in a row. </p>
</td></tr>
<tr><td><code id="zidb_+3A_vmar">vmar</code></td>
<td>
<p> the relative size of vignette margins. </p>
</td></tr>
<tr><td><code id="zidb_+3A_page">page</code></td>
<td>
<p> the page to display (each page contains 25 vignettes). </p>
</td></tr>
<tr><td><code id="zidb_+3A_title">title</code></td>
<td>
<p> the title of the page. </p>
</td></tr>
<tr><td><code id="zidb_+3A_method">method</code></td>
<td>
<p> the name of the validation method to use to extract validation
data. </p>
</td></tr>
<tr><td><code id="zidb_+3A_class">class</code></td>
<td>
<p> a character vector with one or more classes for the validation
data that we want to keep. </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p> Philippe Grosjean &lt;Philippe.Grosjean@umons.ac.be&gt; </p>


<h3>See Also</h3>

 <p><code><a href="#topic+zidCompress">zidCompress</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'>##TODO...
</code></pre>

<hr>
<h2 id='zie'> ZIE (ZooImage Extension) manipulate .zie files to add custom import, export, etc. routines to ZooImage  </h2><span id='topic+ZIE'></span><span id='topic+print.ZIE'></span><span id='topic+zieMake'></span><span id='topic+zieCompile'></span><span id='topic+zieCompileFlowCAM'></span>

<h3>Description</h3>

<p>A .zie file describes sequentially images and tells how to convert and rename
them and automates creation of associated metadata (.zim files). At the end
of the process, one ends with complete and fully usable information (both
the images with correct format/name and the metadata), so that you can proceed
in ZooImage with imported data.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>zieMake(path = ".", Filemap = "Import_Table.zie", check = TRUE, replace = FALSE,
    move.to.raw = TRUE, zip.images = "[.]tif$")

zieCompile(path = ".", Tablefile = "Table.txt", Template = "ImportTemplate.zie",
    Filemap = paste("Import_", noExtension(Tablefile), ".zie", sep = ""),
    Nrange = c(1, 1000), replace = TRUE, make.it = FALSE,
    zip.images = "[.]tif$")
zieCompileFlowCAM(path = ".", Tablefile, Template = "ImportTemplate.zie",
    check.names = TRUE)

ZIE(title, filter, description, pattern, command, author, version, date,
    license, url, depends = "R (&gt;= 2.4.0), zooimage (&gt;= 1.0-0)",
    type = c("import", "export"))
## S3 method for class 'ZIE'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="zie_+3A_path">path</code></td>
<td>
<p> path where the images and the .zie file are located. </p>
</td></tr>
<tr><td><code id="zie_+3A_check.names">check.names</code></td>
<td>
<p> do wr check names in the .zie and .txt files? </p>
</td></tr>
<tr><td><code id="zie_+3A_filemap">Filemap</code></td>
<td>
<p> name of the .zie file mapping images to convert. </p>
</td></tr>
<tr><td><code id="zie_+3A_check">check</code></td>
<td>
<p> do we check if conversion programs (if any needed) are available? </p>
</td></tr>
<tr><td><code id="zie_+3A_replace">replace</code></td>
<td>
<p> do we replace existing files (not used yet)? </p>
</td></tr>
<tr><td><code id="zie_+3A_move.to.raw">move.to.raw</code></td>
<td>
<p> do we move processed files to the '_raw' subdirectory
(currently, it is always the case)? </p>
</td></tr>
<tr><td><code id="zie_+3A_zip.images">zip.images</code></td>
<td>
<p> the pattern to use for images extension in the zipped file. </p>
</td></tr>
<tr><td><code id="zie_+3A_tablefile">Tablefile</code></td>
<td>
<p> a tab-delimited ASCII file containing a table defining
samples and samples characteristics used to compile .zim files and to
convert/rename images. </p>
</td></tr>
<tr><td><code id="zie_+3A_template">Template</code></td>
<td>
<p> a template to use for creating the .zie file. </p>
</td></tr>
<tr><td><code id="zie_+3A_nrange">Nrange</code></td>
<td>
<p> A range (two integers) giving min and max number of images for
each sample/fraction. </p>
</td></tr>
<tr><td><code id="zie_+3A_make.it">make.it</code></td>
<td>
<p> do we make the .zie (run its commands) after compiling it? </p>
</td></tr>
<tr><td><code id="zie_+3A_title">title</code></td>
<td>
<p> the title of the ZooImage Extension. </p>
</td></tr>
<tr><td><code id="zie_+3A_filter">filter</code></td>
<td>
<p> a filter to apply to select concerned files. </p>
</td></tr>
<tr><td><code id="zie_+3A_description">description</code></td>
<td>
<p> a short description of the ZooImage Extension. </p>
</td></tr>
<tr><td><code id="zie_+3A_pattern">pattern</code></td>
<td>
<p> a regular expression to use to select concerned files. </p>
</td></tr>
<tr><td><code id="zie_+3A_command">command</code></td>
<td>
<p> a string holding the R command to run to convert images. </p>
</td></tr>
<tr><td><code id="zie_+3A_author">author</code></td>
<td>
<p> who wrote and maintains the ZooImage Extension? Please, provide
also an email address. </p>
</td></tr>
<tr><td><code id="zie_+3A_version">version</code></td>
<td>
<p> version of the ZooImage Extension as x.y-z, in a string. </p>
</td></tr>
<tr><td><code id="zie_+3A_date">date</code></td>
<td>
<p> date at which the extension was compiled as yyyy-mm-dd. </p>
</td></tr>
<tr><td><code id="zie_+3A_license">license</code></td>
<td>
<p> which are the license terms for this ZooImage Extension? </p>
</td></tr>
<tr><td><code id="zie_+3A_url">url</code></td>
<td>
<p> a link to a web page dedicated to this ZooImage Extension. </p>
</td></tr>
<tr><td><code id="zie_+3A_depends">depends</code></td>
<td>
<p> which R packages does this ZooImage Extension requires? </p>
</td></tr>
<tr><td><code id="zie_+3A_type">type</code></td>
<td>
<p> type of ZooImage extension; currently, only &quot;import&quot; or &quot;export&quot;. </p>
</td></tr>
<tr><td><code id="zie_+3A_x">x</code></td>
<td>
<p> a ZIE object. </p>
</td></tr>
<tr><td><code id="zie_+3A_...">...</code></td>
<td>
<p> further arguments passes to the function (currently not in use). </p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>zieMake()</code>, <code>zieCompile()</code> and <code>zieCompileFlowCAM()</code> are invoked
for their side-effects of importing images and metadata into a format that
ZooImage can use. The first two functions return <code>TRUE</code> or <code>FALSE</code>,
depending if the importation was done without errors, or not. More information
is issued as warnings. The last function returns the name of the .zie file
resulting from the compilation. It returns <code>NULL</code> in case it failed to
compile the .zie file.
</p>
<p><code>ZIE()</code> creates a 'ZIE' object that describes a ZooImage Extension and
allows to plug it in transparently inside the ZooImage GUI. <code>print.ZIE()</code>
nicely formats the content of this objects when using the generic function
<code>print()</code>.
</p>


<h3>Author(s)</h3>

<p> Philippe Grosjean &lt;Philippe.Grosjean@umons.ac.be&gt; </p>


<h3>See Also</h3>

 <p><code><a href="#topic+zimMake">zimMake</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'>##TODO...

### For programmers ###
# Adding a new import filter is just a mather of writing the importation function
# and making it available to users by means of a ZIEimport object.
</code></pre>

<hr>
<h2 id='zim'> Manipulate .zim files (ZooImage Metadata/Measurements) </h2><span id='topic+isZim'></span><span id='topic+zimCreate'></span><span id='topic+zimEdit'></span><span id='topic+zimExtractAll'></span><span id='topic+zimMake'></span><span id='topic+zimDatMakeFlowCAM'></span><span id='topic+zimDatMakeFlowCAMAll'></span><span id='topic+zimUpdateAll'></span><span id='topic+zimVerify'></span>

<h3>Description</h3>

<p>Various fonctions to manipulate ZooImage Metadata in .zim format
(either '*.zim', or '*_datX.zim' files).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>zimCreate(zimfile, template = NULL, edit = TRUE, editor =
    getOption("fileEditor"), wait = FALSE)
zimEdit(zimfile, editor = getOption("fileEditor"), wait = FALSE, ...)
zimMake(dir = ".", pattern = extensionPattern("tif"), images =
    list.files(dir, pattern))

zimExtractAll(zipdir = ".", zipfiles = zipList(zipdir), path = NULL,
    replace = FALSE)
zimUpdateAll(zipdir = ".", zipfiles = zipList(zipdir), zimdir = NULL,
    check.zim = TRUE)

isZim(zimfile)
zimVerify(zimfile, is.dat1 = hasExtension(zimfile, "_dat1.zim"),
    check.table = FALSE)

zimDatMakeFlowCAM(zimfile)
zimDatMakeFlowCAMAll(path = ".", zimfiles = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="zim_+3A_zimfile">zimfile</code></td>
<td>
<p> a .zim file. </p>
</td></tr>
<tr><td><code id="zim_+3A_zimfiles">zimfiles</code></td>
<td>
<p> a list of .zim files to use. </p>
</td></tr>
<tr><td><code id="zim_+3A_template">template</code></td>
<td>
<p> a .zim template to start with, if the .zim file does not
exist yet. </p>
</td></tr>
<tr><td><code id="zim_+3A_edit">edit</code></td>
<td>
<p> do we edit the .zim file that we just created? </p>
</td></tr>
<tr><td><code id="zim_+3A_editor">editor</code></td>
<td>
<p> a program to use for editing the .zim file. </p>
</td></tr>
<tr><td><code id="zim_+3A_wait">wait</code></td>
<td>
<p> do we wait that the file is edited? In this case, R is frozen
until the editor is closed. </p>
</td></tr>
<tr><td><code id="zim_+3A_dir">dir</code></td>
<td>
<p> a directory where .zim files will be created. </p>
</td></tr>
<tr><td><code id="zim_+3A_pattern">pattern</code></td>
<td>
<p> the pattern matching for automatically listed images that
require a .zim file. </p>
</td></tr>
<tr><td><code id="zim_+3A_images">images</code></td>
<td>
<p> the list of images requiring a .zim file (either all image
matching 'pattern' in 'dir', or provide your own listing here). </p>
</td></tr>
<tr><td><code id="zim_+3A_zipdir">zipdir</code></td>
<td>
<p> a directory where to find .zip files. </p>
</td></tr>
<tr><td><code id="zim_+3A_zipfiles">zipfiles</code></td>
<td>
<p> a list of .zip files (by default, all .zip files in
'zipdir'). </p>
</td></tr>
<tr><td><code id="zim_+3A_path">path</code></td>
<td>
<p> the path where to extract zims. If <code>NULL</code>, it is computed
from zipdir: it is either the same path, or the parent directory if last
directory is named '_raw'. </p>
</td></tr>
<tr><td><code id="zim_+3A_replace">replace</code></td>
<td>
<p> do we replace existing .zim files? </p>
</td></tr>
<tr><td><code id="zim_+3A_zimdir">zimdir</code></td>
<td>
<p> the directory where the .zim files are located. </p>
</td></tr>
<tr><td><code id="zim_+3A_check.zim">check.zim</code></td>
<td>
<p> do we verify .zim files before refreshing metadata in .zip
files? </p>
</td></tr>
<tr><td><code id="zim_+3A_is.dat1">is.dat1</code></td>
<td>
<p> is it a '\_dat1.zim' file, that is a file collecting
metadata AND objects measurements? </p>
</td></tr>
<tr><td><code id="zim_+3A_check.table">check.table</code></td>
<td>
<p> try to read the table of measurements in the '[Data]'
section. Ignored if <code>is.dat1 = FALSE</code>. </p>
</td></tr>
<tr><td><code id="zim_+3A_...">...</code></td>
<td>
<p> further arguments passed to the <code>fileEdit()</code>. </p>
</td></tr>
</table>


<h3>Details</h3>

<p>ZooImage Metadata/Measurements ('.zim' and '_dat1.zim' files, respectively)
are text files containing metadata (that is, additional information required
to process the images, like sample identification, information about
collection and process of the sample, digitizing hardware and software, etc.).
These metadata are represented as a pair 'key' = 'value' in ANSI encoding and
are organized into sections written in square brackets on a separate line. For
instance, '[Subsample]' defines a 'Subsample' section. The first line of .zim
files must always be 'ZI1' in the case of ZooImage version 1, 'ZI2' for
version 2, and 'ZI3' for current version. This identifiant allows for making
incompatible changes in future versions without taking the risk to
accidentally try processing these newer versions with an old, incompatible
version of ZooImage in the future. Here are the first few lines of an example
.zim file: for instance).
</p>
<pre>
ZI3
[Image]
Hardware=EPSON 4870
Software=VueScan 8.0.10  # See ZooImage.ini file for VueScan config
...
    </pre>
<p>After 'ZI3' in the first line, there is a definition of an 'Image' section,
with two keys: 'Hardware' with value 'EPSON 4870' and 'Software' with value
'VueScan 8.0.10', followed by a comment (everything after the '#' sign). Take
care: since '#' defines a comment, do not use it, neither in keys, nor in
values!
</p>
<p>Take care to define <b>unique keys accross all sections</b>! The section are
just there to organize your metadata into logical subunits... but they are not
considered in the process. If you define a key named 'mykey' both in
'[Section1]' and in '[Section2]', only the first occurence of 'mykey' will be
used by ZooImage!
</p>
<p>The ZooImage Measurements ('_dat1.zim' files) are structured the same way,
but there is a special '[Data]' section at the end that contains a
tab-delimited table with all measurements done on identified objects, during
the image analysis (process of the images). This table starts with a header
naming the colums, with two first columns being necessary '!Item' and 'Label'.
'Label' is the name of the image where the object is found and 'Item' is a
unique identifier (usually a number) given to that object in the image (i.e.,
Label+Item is the unique identifier of each object in the whole series). The
other columns define the measurements done on the objects (area, perimeter,
length, distribution of gray levels, etc.). The amount and name of
measurements are not fixed. It is the particular ImageJ plugin that you use to
process your image that defines them (it means that adding new measurements is
very easy to do and they are automatically considered by ZooImage).
</p>
<p>Note that these measurements are converted using calibration information, if
available. That is, lengths are in microns, surfaces are in squre microns and
gray levels are in OD (Optical Densities), so that, measurements are
comparable from picture to picture, even if spatial resolution or distribution
of gray levels (contrast, luminosity, ...) are not exactly the same in all
images of the series! The table must also contains four additional columns
with obligatory names being 'BX', 'BY', 'Width', 'Height'. There are the
coordinates of the top-left corner of the bounding box around the object (BX,
BY) and the Width and Height of this box. These fields are required to locate
the object in the original image. Here is a short abstract of a [Data] section:
</p>
<pre>
... (metadata definitions as above)

[Data]
!Item  Label    Area    Perim.  ...(other mes.)  BX     BY    Width  Height
1      Smp1+A1  0.4634  0.0582  ...              28.89  0.20  1.42   0.83
2      Smp1+A1  0.0705  0.0244  ...              72.40  0.35  2.33   32.16
3      Smp1+A2  0.0498  0.0566  ...              75.43  0.69  75.44  0.70
...
    </pre>
<p>The reasons to choose such a simple text format for representing metadata is
simplicity and flexibility. Plain text files are readable by any computer
program and no sophisticated database engine, or database structure, is
required to represent those data. Also, besides obligatory fields in the
metadata sections, you can add as many key=value entries as you need to
collect together the metadata required in your particular application.
ZooImage will automatically read them and store them at the right place,
available to you at any time during your analyses in ZooImage! That way,
ZooImage is very flexible and capable to process many different kinds of data,
even most exotic ones.
</p>
<p><code>zimCreate()</code> and <code>zimEdit()</code> call the associated metadata editor
(by default, the one defined as <code>options(fileEditor = ....)</code>. By default,
it is the same program as used by <code>fileEdit()</code> in the svMisc package. You
can also use a spreadsheet, like Excel, Gnumeric, or OpenOffice Calc to edit
these files. This is particularly useful for the tabular '[Data]' section,
more comfortably edited in as a spreadsheed. Just save your file as
dQuotetab-delimited text file when you have done and close the spreadsheet
program (Excel won't allow ZooImage to access the .zim file when the file is
opened as a spreadsheet). Just redefine <code>options(fileEditor = ...)</code> to
use, e.g, Excel automatically with ZooImage (full path of the 'Excel.exe'
file).
</p>
<p><code>zimMake()</code> creates one or more .zim files corresponding to the selected
list of images provided in 'images', and allows for editing them one-by-one.
It is the basic function for creating all .zim files manually for a set of
images to be analyzed in ZooImage. See also <code>zieMake()</code> for an
alternative, and automatic way to create all those .zim files.
</p>
<p><code>zimExtractAll()</code> and <code>zimUpdateAll()</code> work in conjonction with
zipped TIFF image, as obtained by <code>zipImg()</code> and <code>zipImgAll()</code>
(also done using <code>zidCompress</code>). In these .zip files, metadata is located
in the zip archive comment. This comment is extracted into corresponding .zim
file by <code>zimExtractAll()</code> for one or several zip archives. On the other
hand, these comments are updated in the zip archive with latest information
present in .zim files using <code>zimUpdateAll()</code>.
</p>
<p>The last functions are auxiliary utilities to deal with .zim files (see also
<code>zimList()</code>). <code>isZim()</code> simply checks if the file is a correct .zim
file, checking first line of the file that must be 'ZI1-3' for ZooImage
version 1-3. This routine returns <code>TRUE</code> or <code>FALSE</code> according to the
result (the file extension is also checked if <code>check.ext = TRUE</code>).
</p>
<p>Finally, <code>zimVerify()</code> is a very important function. It checks the
validity and syntax of any .zim file. All required fields are checked. In case
of an error, the function returns an explicit error message as a character
string. On the other hand, if the verification process succeeds, the function
returns a number corresponding to the number of objects whose measurements are
recorded in the data table (for a '_dat1.zim' file), or '0' (zero, no
measurements) for a '.zim' file containing only metadata.
</p>
<p><code>zimVerify()</code> checks for the presence of required fields. For .zim files:
Section '[Image]' with 'Author', 'Hardware', 'Software' and 'ImageType' (for
instance, &quot;trans_16bits_gray&quot; for a 16bit graylevels picture obtained by
transparency, that is, using transmitted light) fields, section '[Fraction]'
with 'Code' (A, B, C, ...), 'Min' and 'Max' (the minimum and maximum mesh
sizes used to fraction the sample, or -1 if Min and or Max sieves are not
used) and section '[Subsample]' with fields 'Subpart' (a number indicating how
much of the fraction is actually digitized, for instance, 0.15 for 15% of the
fraction), 'SubMethod' (volumetry, Motoda, etc.), 'CellPart' (the fraction of
the digitizing cell actually covered by all images made), 'Replicates',
'VolIni' (the volume of seawater, in cubic meters or any of your favored unit,
that was collected in the sea for this sample) and 'VolPrec', the precision at
which 'VolIni' is measured, expressed in the same unit.
</p>
<p>For '_dat1.zim' files, the function checks for the presence of all the
previous fields, plus: '[Process]' section with fields 'Version' (version of
the processing function), 'Method' (method used to process the images),
'MinSize', 'MaxSize' (the minimum and maximum ecd -equivalent circular
diameter- of the particule to be considered and measured), 'Calibration' (data
for gray levels calibration) and 'ProcessPixSize' (data for spatial
calibration: size of one pixel in microns, or any of your favorite length
unit). Column headers 'Item', 'Label', 'BX', 'BY', 'Height', 'Width', plus at
least one additional measrurement are checked too.
If <code>check.table = TRUE</code>, the function also tries to read the table of
measurements and checks for its integrity (it takes longer for checking many
large '_dat1.zim' files!).
</p>


<h3>Value</h3>

<p><code>zimCreate()</code>, <code>zimEdit()</code>, <code>zimMake()</code> are invoked for their
side-effect of creating and/or editing .zim files on disk. <code>zimCreate()</code>
returns <code>TRUE</code> invisibly, in case of successfull creation of all required
.zim files, <code>FALSE</code> otherwise (details of problems are returned using
warnings. The same mechanism (returning <code>TRUE</code> or <code>FALSE</code> invisibly,
with detailled description of the problem in warnings) is used by
<code>zimExtractAll()</code> and <code>zimUpdateAll()</code> also called for their
side-effects of manipulating .zim/.zip files.
</p>
<p><code>isZim()</code> simply returns <code>TRUE</code> or <code>FALSE</code>.
</p>
<p><code>zimVerify()</code> returns an integer in case of successful verification of
the .zim file. This integer represents the number of objects in the
measurement table (zero, if there is no '[Data]' section in the file, see
hereunder). In the case of an error during verification, the function returns
a character string with explicit description of the problem.
</p>
<p><code>zimDatMakeFlowCAM()</code> and <code>zimDatMakeAllFlowCAM()</code> are, as you
expect, special functions to transform FlowCAM metadata into dat1.zim formats.
They return <code>TRUE</code> or <code>FALSE</code> invisibly, and issue warnings in case
of problems.
</p>


<h3>Note</h3>

<p>Developers have the opportunity to add custom fields (both sections and keys
in these sections) to be checked by <code>zimVerify()</code>, in order to match
specific uses of ZooImage. Since the verification of metadata is a critical
step in the analysis, they are strongly encouraged to add such custom rules:
the default checking procedure is very basic!
</p>
<p>There are two possible ways to extend verification: adding fields in the list
of required ones, or using a custom function. The second solution is more
complex, but you have the possibility to check also the values associated with
keys, where the first solution just check the presence of those keys, no
mathers the values associated with them. You can combine both approaches.
</p>
<p>To add required keys to be checked, just create an option(ZI.zim = list(....))
with a list of four components: &quot;zim.required&quot;, &quot;dat1.zim.required&quot;,
&quot;dat1.data.required&quot; and &quot;active&quot;. Put the list of sections (between square
brackets) and keys that must be present in the '.zim' files in &quot;zim.required&quot;
and those that must be present in the '_dat1.zim' files in &quot;dat1.zim.required&quot;
components. Place a list of column headers that you need in the [Data] table in
the &quot;dat1.data.required&quot; component of the list. The &quot;active&quot; component must be
<code>TRUE</code> to activate the verification of these extra fields and column
headers (otherwise, they are ignored). See the example hereunder.
</p>
<p>To add your own verification rules, add a R function in the &quot;verify&quot; component
of the list. That function should be defined as:
<code>function(zimfile, ...) # Your code here</code> and it should return either &quot;&quot;
(if no error found), or an explicit message in case of error(s).
</p>
<p>Alternatively, you can completelly redefine <code>zimVerify()</code> in the
&quot;verify.all&quot; component of the list. In this case, the other rules are
completelly ignored, and you must perform the whole treatment in your function
(start from the code of <code>zimVerify()</code> to make sure your own function has
a similar behaviour!
</p>
<p>Look at examples, and you will better understand how this works!
</p>


<h3>Author(s)</h3>

<p> Philippe Grosjean &lt;Philippe.Grosjean@umons.ac.be&gt; </p>


<h3>See Also</h3>

 <p><code><a href="#topic+zieMake">zieMake</a></code>, <code><a href="#topic+zipImg">zipImg</a></code>,
<code><a href="#topic+zidCompress">zidCompress</a></code>, , <code><a href="svMisc.html#topic+fileEdit">fileEdit</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'>## Create a minimalist .zim file from current template
(zimfile &lt;- paste(tempfile(), "zim", sep = "."))
zimCreate(zimfile, edit = FALSE)

## Display its content
if (interactive()) file.show(zimfile)

## List .zim files in the temporary directory
zimList(tempdir())

## Is this a correct .zim file?
isZim(zimfile)
zimVerify(zimfile) # Returns 0 =&gt; verification OK, with 0 records in [Data]

## The rest of this example is for programmers
## Add more required sections and keys for metadata verifications
## Add more required columns in the table of measurements
options(ZI.zim = list(active = TRUE,
    zim.required = c("[NewSection]", "requiredkey1", "requiredkey2"),
    dat1.zim.required = c("[PostProcess]", "requiredkey3"),
    dat1.data.required = c("Area", "Perim.", "Circ.", "Feret")))
try(zimVerify(zimfile)) # Of course, these new keys are missing!

## Now, inactivate these extra verifications without deleting them
oZI.zim &lt;- getOption("ZI.zim")
oZI.zim$active &lt;- FALSE
options(ZI.zim = oZI.zim)
rm(oZI.zim) # not needed any more
zimVerify(zimfile) # This time, extra verifications are not used any more =&gt; OK!

## Add some verification code to the existing verification procedure
options(ZI.zim = list(active = TRUE,
    verify = function (zimfile, ...) {
        # Your verification code here, for instance:
        Lines &lt;- scan(zimfile, character(), sep = "\t", skip = 1, flush = TRUE,
		    quiet = TRUE, comment.char = "#")
        ## Check if 'Code=B' or 'Code=C', using regular expression
        ## Extra spaces are allowed before and after '=', and after the value
        if (length(grep("^Code\\s*=\\s*[B|C]\\s*$", Lines)) == 0) {
            ## The condition is not matched!
            return("[Fraction] Code must be either 'B', or 'C'!")
        } else {
            ## Everything is fine: return an empty string
            return("")
        }
}))
try(zimVerify(zimfile)) # Since Code=A, verification fails!

## Reset original verification rules
options(ZI.zim = NULL)

## Erase the example .zim file
unlink(zimfile)
</code></pre>

<hr>
<h2 id='zip'> Zip and unzip raw .tif images for ZooImage and embed metadata </h2><span id='topic+zipImg'></span><span id='topic+zipImgAll'></span><span id='topic+unzipImg'></span><span id='topic+unzipImgAll'></span>

<h3>Description</h3>

<p>Perform simple zip/unzip operations on images. Corresponding metadata
from .zim files are embedded as zip comments.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>zipImg(imagefile, zimfile = NULL, check.zim = TRUE, replace = FALSE,
    delete.source = FALSE)
zipImgAll(path = ".", images = NULL, check.zim = TRUE, replace = FALSE,
    delete.source = FALSE)
unzipImg(zipfile, replace = FALSE, delete.source = FALSE)
unzipImgAll(path = ".", zipfiles = NULL, replace = FALSE,
    delete.source = FALSE)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="zip_+3A_imagefile">imagefile</code></td>
<td>
<p> file path of the .tif image to compress. </p>
</td></tr>
<tr><td><code id="zip_+3A_zimfile">zimfile</code></td>
<td>
<p> file path of the corresponding .zim file (calculated
automatically if <code>NULL</code>, by default). </p>
</td></tr>
<tr><td><code id="zip_+3A_check.zim">check.zim</code></td>
<td>
<p> do we verify the .zim file before zipping data? </p>
</td></tr>
<tr><td><code id="zip_+3A_replace">replace</code></td>
<td>
<p> do we replace existing .zip files? </p>
</td></tr>
<tr><td><code id="zip_+3A_delete.source">delete.source</code></td>
<td>
<p> should the original .tif file be deleted (the .zim file
is never deleted)? </p>
</td></tr>
<tr><td><code id="zip_+3A_path">path</code></td>
<td>
<p> directory where .tif images to be zipped are located. </p>
</td></tr>
<tr><td><code id="zip_+3A_images">images</code></td>
<td>
<p> a list of .tif images to zip. If <code>NULL</code>, the list of all
.tif images present in <code>path</code> is computed. </p>
</td></tr>
<tr><td><code id="zip_+3A_zipfile">zipfile</code></td>
<td>
<p> a zipfile to unzip. </p>
</td></tr>
<tr><td><code id="zip_+3A_zipfiles">zipfiles</code></td>
<td>
<p> a list of zipfiles to unzip. If <code>NULL</code>, a list of all
.zip files found is <code>path</code> is calculated. </p>
</td></tr>
</table>


<h3>Value</h3>

<p>All these functions are designed to be run in batch mode. Problems are
reported as warnings, and the function always returns <code>TRUE</code> or
<code>FALSE</code>, depending if the process succeeds or fails. The <code>xxxAll()</code>
functions are convenient wrapper around <code>batch()</code> to process several
items in a row. Take care that, despite the functions possibly use internal
R code to zip or unzip files, they still need the zip and unzip programs
for injecting and extracting .zim files metadata in the .zip archive!
</p>


<h3>Author(s)</h3>

<p> Philippe Grosjean &lt;Philippe.Grosjean@umons.ac.be&gt; </p>


<h3>See Also</h3>

<p><code><a href="#topic+zipNoteAdd">zipNoteAdd</a></code>, <code><a href="#topic+zipNoteGet">zipNoteGet</a></code></p>


<h3>Examples</h3>

<pre><code class='language-R'>## Create a fake example of two .tif images and their associated .zim files
testdir &lt;- file.path(tempdir(), "ziptest")
dir.create(testdir)
file.copy(system.file("examples", "BIO.2000-05-05.p72.zid",
    package = "zooimage"), testdir)
curdir &lt;-setwd(testdir)
unzip("BIO.2000-05-05.p72.zid", junkpaths = TRUE)
## Keep only first 3 image plus the .zim file
unlink("BIO.2000-05-05.p72.zid")
unlink("BIO.2000-05-05.p72_dat1.RData")
unlink(dir(pattern = "[.]jpg$")[-(1:3)])
## Rename .jpg images, pretending they are .tif images
jpgFiles &lt;- dir(pattern = "[.]jpg$")
tifFiles &lt;- sub("[.]jpg$", ".tif", jpgFiles)
file.rename(jpgFiles, tifFiles)
## Recreate the .zim file
zimData &lt;- readLines("BIO.2000-05-05.p72+A_dat1.zim", n = 32)
zimFile &lt;- "BIO.2000-05-05.p72+A_.zim"
writeLines(zimData, zimFile)
unlink("BIO.2000-05-05.p72+A_dat1.zim")
## Here is what we got...
dir()

## Zip first image...
(zipImg(tifFiles[1]))
## It is added in the _raw subdirectory
dir()
zipDir &lt;- file.path(".", "_raw")
dir(zipDir)

## Now, zip all images in batch and delete sources
(zipImgAll(".", delete.source = TRUE))
dir() # .zim files are never deleted!
(zipFiles &lt;- dir(zipDir, full.names = TRUE)) # All three are there
## Force delete of the .zim file
unlink(zimFile)

## Unzip first zip file...
#####(unzipImg(zipFiles[1]))
## The image and .zim file are recreated
dir()
## Check extracted .zim file
#####all(readLines(zimFile) == zimData)

## Unzip all images...
(unzipImgAll(zipDir, replace = TRUE, delete.source = TRUE))
## All original files are there...
dir()
## and the _raw subdir is now empty
dir(zipDir)

## Reset and clean up
setwd(curdir)
unlink(testdir, recursive = TRUE)
rm(testdir, curdir, jpgFiles, tifFiles, zimFile, zimData, zipDir, zipFiles)
</code></pre>

<hr>
<h2 id='ZIRes'> Various function to calculate results ('ZIRes' object) </h2><span id='topic+processSample'></span><span id='topic+processSampleAll'></span><span id='topic+print.ZIRes'></span><span id='topic+rbind.ZIRes'></span>

<h3>Description</h3>

<p>Having classified items in a 'ZIDat' object, these function calculate various
statistic descriptors of whole samples (abundances, biomasses, size spectra)
and they collect them together in a 'ZIRes' object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>processSample(x, sample, keep = NULL,
    detail = NULL, classes = "both", header = c("Abd", "Bio"),
    cells = NULL, biomass = NULL, breaks = NULL)
processSampleAll(path = ".", zidbfiles, ZIClass = NULL, keep = NULL,
    detail = NULL, classes = "both", header = c("Abd", "Bio"),
    cells = NULL, biomass = NULL, breaks = NULL)

## S3 method for class 'ZIRes'
print(x, ...)
## S3 method for class 'ZIRes'
rbind(..., deparse.level = 1)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ZIRes_+3A_x">x</code></td>
<td>
<p> a 'ZIDat' object or similar data frame for <code>processSample()</code>, or
a 'ZIRes' object for the other functions. </p>
</td></tr>
<tr><td><code id="ZIRes_+3A_sample">sample</code></td>
<td>
<p> the sample 'Id' to use for selecting items of one sample only,
in case the object contains data for several samples. It should not be the
case for 'ZIDat' objects, and you do not have to provide this argument then. </p>
</td></tr>
<tr><td><code id="ZIRes_+3A_keep">keep</code></td>
<td>
<p> a character vector with names of the levels to keep in the
analysis for the classes, or <code>NULL</code> to keep them all. </p>
</td></tr>
<tr><td><code id="ZIRes_+3A_detail">detail</code></td>
<td>
<p> a character vector with names of classes for which to calculate
separate statistics. The special levels <code>[other]</code> and <code>[total]</code>
are also added. If <code>NULL</code>, only the total for the sample is returned. </p>
</td></tr>
<tr><td><code id="ZIRes_+3A_classes">classes</code></td>
<td>
<p> a character string with <code>"Class"</code> to use the manual
classification for splitting particles in the sample, or <code>"Predicted"</code>
to use automatic classification, or <code>"both"</code> (default) to use Class in
priority, but falling back to Predicted for particles whose Class is not
defined. One can also specify the name of another factor variable in <code>x</code>. </p>
</td></tr>
<tr><td><code id="ZIRes_+3A_header">header</code></td>
<td>
<p> a character vector with one or two strings to use as headers for,
respectively, abundances and biomasses. </p>
</td></tr>
<tr><td><code id="ZIRes_+3A_cells">cells</code></td>
<td>
<p> the path to an .rds file containing cells counting models, as used
by <code>cellCompute()</code>. </p>
</td></tr>
<tr><td><code id="ZIRes_+3A_biomass">biomass</code></td>
<td>
<p> a specification for biomass conversion. Can be <code>NULL</code> (by
default) for turning off biomass calculation, or a numeric vector of three
values P1, P2 and P3 (same biomass for all classes with Bio = P1 * ECD^P3 + P2),
or a data frame with the name of classes in first column, P1, P2 and P3 in
columns 2 to 4. You must also provide one line with class <code>"[other]"</code> that
is used for biomass claculation for classes not otherwise specified. </p>
</td></tr>
<tr><td><code id="ZIRes_+3A_breaks">breaks</code></td>
<td>
<p> either <code>NULL</code> (default) to turn off size spectra calculations
or a numeric vector for ECD classes breaks. </p>
</td></tr>
<tr><td><code id="ZIRes_+3A_path">path</code></td>
<td>
<p> the path containing your ZIDB or ZID files to use for samples processing. </p>
</td></tr>
<tr><td><code id="ZIRes_+3A_zidbfiles">zidbfiles</code></td>
<td>
<p> a list of ZIDB or ZID files to process in batch. </p>
</td></tr>
<tr><td><code id="ZIRes_+3A_ziclass">ZIClass</code></td>
<td>
<p> a 'ZIClass' object to use to classify particles during the
process of your samples. </p>
</td></tr>
<tr><td><code id="ZIRes_+3A_...">...</code></td>
<td>
<p> further arguments passed to the methods </p>
</td></tr>
<tr><td><code id="ZIRes_+3A_deparse.level">deparse.level</code></td>
<td>
<p> integer controlling the way labels are constructed for
non-matrix-like arguments (defined in the generic, but not used here). </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p> Philippe Grosjean &amp; Kevin Denis </p>


<h3>See Also</h3>

 <p><code><a href="#topic+ZIClass">ZIClass</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'>##TODO...
</code></pre>

<hr>
<h2 id='zis'> Manipulate .zis files (ZooImage Samples description) </h2><span id='topic+zisCreate'></span><span id='topic+zisEdit'></span><span id='topic+zisRead'></span>

<h3>Description</h3>

<p>Additional data concerning the samples are collected together in .zis files.
These functions manipulate such .zis files.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>zisCreate(zisfile, template = NULL, edit = TRUE, editor =
    getOption("fileEditor"), wait = FALSE)
zisEdit(zisfile, editor = getOption("fileEditor"), wait = FALSE, ...)
zisRead(zisfile = "Description.zis", expected.sections =
    c("Description", "Series", "Cruises", "Stations", "Samples"))
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="zis_+3A_zisfile">zisfile</code></td>
<td>
<p> the name of the .zis file to manipulate (usually,
&quot;Description.zis&quot;). </p>
</td></tr>
<tr><td><code id="zis_+3A_template">template</code></td>
<td>
<p> a .zis template to start with, if the .zis file does not
exist yet. </p>
</td></tr>
<tr><td><code id="zis_+3A_edit">edit</code></td>
<td>
<p> do we edit the .zis file after its creation? </p>
</td></tr>
<tr><td><code id="zis_+3A_editor">editor</code></td>
<td>
<p> the program to use to edit the .zis file. </p>
</td></tr>
<tr><td><code id="zis_+3A_wait">wait</code></td>
<td>
<p> do we wait that edition of file is done? </p>
</td></tr>
<tr><td><code id="zis_+3A_expected.sections">expected.sections</code></td>
<td>
<p> list of the sections that must be present in the
.zis file. </p>
</td></tr>
<tr><td><code id="zis_+3A_...">...</code></td>
<td>
<p> further arguments to pass to <code>fileEdit()</code>. </p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>zisRead()</code> returns a 'ZIDesc' object containing all the data in the .zis
file, or, in case of fealure (detailed in a warning), it returns <code>NULL</code>.
The two other functions return <code>TRUE</code> or <code>FALSE</code> invisibly,
depending if the .zis file could be created/edited or not.
</p>


<h3>Author(s)</h3>

<p> Philippe Grosjean &lt;Philippe.Grosjean@umons.ac.be&gt; </p>


<h3>See Also</h3>

 <p><code><a href="#topic+zidCompress">zidCompress</a></code>, <code><a href="svMisc.html#topic+fileEdit">fileEdit</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'>## Read content of the example zis file
zisFile &lt;- system.file("examples", "Description.zis", package = "zooimage")
zisData &lt;- zisRead(zisFile)
zisData  # These are data for samples
attr(zisData, "metadata")  # Further data (for the series) here

## Create a new .zis file in tempdir using the example .zis file as template
zisNew &lt;- file.path(tempdir(), "Description.zis")
zisCreate(zisNew, template = zisFile, edit = FALSE)  # One can edit it here too

## Edit the new file, and wait edition is completed
zisEdit(zisNew, wait = TRUE)
## It contains:
if (interactive()) file.show(zisNew, title = basename(zisNew), delete.file = TRUE)

## Clean up
rm(zisFile, zisData, zisNew)
</code></pre>

<hr>
<h2 id='ZITrain'> Manipulate training and testsets 'ZITrain'/'ZITest' objects </h2><span id='topic+prepareTrain'></span><span id='topic+addToTrain'></span><span id='topic+cellModel'></span><span id='topic+cellCompute'></span><span id='topic+cellCount'></span><span id='topic+getTrain'></span><span id='topic+prepareTest'></span><span id='topic+addToTest'></span><span id='topic+getTest'></span><span id='topic+template'></span><span id='topic+template.default'></span><span id='topic+recode'></span><span id='topic+recode.ZITrain'></span><span id='topic+recode.ZITest'></span><span id='topic+contextSelection'></span>

<h3>Description</h3>

<p>'ZITrain' contain a hierarchy of classes (taxonomic or not) and a link to a
series of items belonging to these classes. It can be obtained after manual or
automatic classification of various objects from .zid or .zidb files. 'ZITest'
objects are almost identical, but with a constraint on the classes that must
match the ones of the reference 'ZItrain' or 'ZIClass' object (a necessity to
allow for comparisons)!
</p>


<h3>Usage</h3>

<pre><code class='language-R'>prepareTrain(traindir, zidbfiles, template = c("[Basic]", "[Detailed]",
    "[Very detailed]"), classes = NULL, ...)
addToTrain(traindir, zidbfiles, classes = NULL, ...)
getTrain(traindir, creator = NULL, desc = NULL, keep_ = FALSE, na.rm = FALSE)

prepareTest(testdir, zidbfiles, template, classes = NULL, ...)
addToTest(testdir, zidbfiles, classes = NULL, ...)
getTest(testdir, creator = NULL, desc = NULL, keep_ = NA, na.rm = FALSE)

cellModel(train, traindir, class, method = "mda")
cellCompute(data, cellModels)
cellCount(traindir, class, reset = FALSE)

template(object, ...)
## Default S3 method:
template(object, ...)

recode(object, ...)
## S3 method for class 'ZITrain'
recode(object, new.levels, depth, ...)
## S3 method for class 'ZITest'
recode(object, new.levels, depth, ...)

contextSelection()
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ZITrain_+3A_traindir">traindir</code></td>
<td>
<p> the root directory of the training set. </p>
</td></tr>
<tr><td><code id="ZITrain_+3A_testdir">testdir</code></td>
<td>
<p> the root directory of the test set. </p>
</td></tr>
<tr><td><code id="ZITrain_+3A_zidbfiles">zidbfiles</code></td>
<td>
<p> .zidb files or .zid files to use for data and vignettes in
the training set. </p>
</td></tr>
<tr><td><code id="ZITrain_+3A_template">template</code></td>
<td>
<p> file containing subdirectories template to use for creating
classes in the training or test set. Either a defaut template between [], or
the name of a .zic file, or a template extracted from a 'ZITrain' or 'ZIClass'
object using <code>template(object)</code> (with the <code>add.others</code> argument
to TRUE for <code>prepareTest()</code> and to <code>FALSE</code> for <code>prepareTrain()</code>) </p>
</td></tr>
<tr><td><code id="ZITrain_+3A_classes">classes</code></td>
<td>
<p> if vignettes are already classified in the zid(b) files, should
they be sorted that way in the created training or test set? If not <code>NULL</code>,
indicate the name of the classification column (usually, <code>Class</code> for
manual classification or <code>Predicted</code> for automatic predictions). This
can also be a 'ZIClass' or 'mlearning' object that will be used for
classification of the particles first, ... or it can be a function that does
the classification. </p>
</td></tr>  
<tr><td><code id="ZITrain_+3A_creator">creator</code></td>
<td>
<p> name of the author of this classification (or the method,
if done automatically). </p>
</td></tr>
<tr><td><code id="ZITrain_+3A_desc">desc</code></td>
<td>
<p> a short description of this manual classification. </p>
</td></tr>
<tr><td><code id="ZITrain_+3A_keep_">keep_</code></td>
<td>
<p> do we keep items in the '\_' subdirectory (corresponding to
unclassified ones)? Default to <code>FALSE</code> in <code>getTrain()</code> and to
<code>NA</code> for <code>getTest()</code>, which transforms all items in the '\_' or
one of its subdirectories into missing data. </p>
</td></tr>
<tr><td><code id="ZITrain_+3A_na.rm">na.rm</code></td>
<td>
<p> do we remove item with missing data? By default, not. </p>
</td></tr>
<tr><td><code id="ZITrain_+3A_train">train</code></td>
<td>
<p> a ZITrain file to use for building the model. </p>
</td></tr>
<tr><td><code id="ZITrain_+3A_class">class</code></td>
<td>
<p> a character string with the name of the class to process. </p>
</td></tr>
<tr><td><code id="ZITrain_+3A_method">method</code></td>
<td>
<p> a character string with the nazme of the predictive method to
use: <code>"lm"</code>, <code>"lda"</code> or <code>"mda"</code> (by default). </p>
</td></tr>
<tr><td><code id="ZITrain_+3A_data">data</code></td>
<td>
<p> a sample containing the particles to count. </p>
</td></tr>
<tr><td><code id="ZITrain_+3A_cellmodels">cellModels</code></td>
<td>
<p> the file containing the models for cells countings. </p>
</td></tr>
<tr><td><code id="ZITrain_+3A_reset">reset</code></td>
<td>
<p> do we reset excisting counts for that class? By default, no. </p>
</td></tr>
<tr><td><code id="ZITrain_+3A_object">object</code></td>
<td>
<p> a 'ZITrain' or 'ZITest' object. For <code>prepareTest()</code>, a
'ZITrain' or 'ZIClass' object to use as reference to determine the
classes to make. </p>
</td></tr>
<tr><td><code id="ZITrain_+3A_new.levels">new.levels</code></td>
<td>
<p> a character string of same length as the levels of
<code>object$Class</code> with the labels of the new levels. </p>
</td></tr>
<tr><td><code id="ZITrain_+3A_depth">depth</code></td>
<td>
<p> the depth in the hierachy of the classes as in the <code>"path"</code>
attribute of the object to use for recoding classes. If this argument is
provided, <code>new.levels</code> is ignored and recomputed (and a warning is
issued if both arguments are provided). </p>
</td></tr>
<tr><td><code id="ZITrain_+3A_...">...</code></td>
<td>
<p> further arguments passed to the method. For <code>prepareXXX()</code>
and <code>addToXXX()</code>, it is further arguments passed to the prediction
function provided in <code>classes</code>, or to the <code>predict()</code> method for
'ZIClass' or 'mlearning' objects. </p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p> Philippe Grosjean &lt;Philippe.Grosjean@umons.ac.be&gt; </p>


<h3>See Also</h3>

 <p><code><a href="#topic+ZIClass">ZIClass</a></code> </p>


<h3>Examples</h3>

<pre><code class='language-R'>##TODO...
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
