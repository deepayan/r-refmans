<!DOCTYPE html><html><head><title>Help for package itsdm</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {itsdm}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#cmcc_bioclim'><p>Download historic Bioclimatic indicators (BIOs) named CMCC-BioClimInd.</p></a></li>
<li><a href='#convert_to_pa'><p>Convert predicted suitability to presence-absence map.</p></a></li>
<li><a href='#detect_envi_change'><p>Detect areas influenced by a changing environment variable.</p></a></li>
<li><a href='#dim_reduce'><p>Remove environmental variables that have high correlation with others.</p></a></li>
<li><a href='#evaluate_po'><p>Evaluate the model based on presence-only data.</p></a></li>
<li><a href='#format_observation'><p>Format the occurrence dataset for usage in <span class="pkg">itsdm</span></p></a></li>
<li><a href='#future_cmcc_bioclim'><p>Download future Bioclimatic indicators (BIOs) named CMCC-BioClimInd.</p></a></li>
<li><a href='#future_worldclim2'><p>A function to parse the future climate from worldclim version 2.1.</p></a></li>
<li><a href='#independent_response'><p>Calculate independent responses of each variables.</p></a></li>
<li><a href='#isotree_po'><p>Build Isolation forest species distribution model and explain the</p>
the model and outputs.</a></li>
<li><a href='#itsdm-package'><p>Isolation forest-based presence-only species distribution modeling</p></a></li>
<li><a href='#mainland_africa'><p>Boundary of mainland Africa</p></a></li>
<li><a href='#marginal_response'><p>Calculate marginal responses of each variables.</p></a></li>
<li><a href='#occ_virtual_species'><p>Occurrence dataset of a virtual species</p></a></li>
<li><a href='#plot.EnviChange'><p>Display the figure and map of the <code>EnviChange</code> object.</p></a></li>
<li><a href='#plot.EnvironmentalOutlier'><p>Exhibit suspicious outliers in an observation dataset.</p></a></li>
<li><a href='#plot.IndependentResponse'><p>Show independent response curves.</p></a></li>
<li><a href='#plot.MarginalResponse'><p>Show marginal response curves.</p></a></li>
<li><a href='#plot.PAConversion'><p>Display results of conversion to presence-absence (PA).</p></a></li>
<li><a href='#plot.POEvaluation'><p>Show model evaluation.</p></a></li>
<li><a href='#plot.ShapDependence'><p>Show variable dependence plots and variable interaction plots</p>
obtained from Shapley values.</a></li>
<li><a href='#plot.SHAPSpatial'><p>Display Shapley values-based spatial variable dependence maps.</p></a></li>
<li><a href='#plot.SpatialResponse'><p>Display spatial variable dependence maps.</p></a></li>
<li><a href='#plot.VariableAnalysis'><p>Display variable importance.</p></a></li>
<li><a href='#plot.VariableContribution'><p>Exhibit variable contribution for target observations.</p></a></li>
<li><a href='#print.EnviChange'><p>Print summary information from <code>EnviChange</code> object.</p></a></li>
<li><a href='#print.EnvironmentalOutlier'><p>Print summary information from <code>EnvironmentalOutlier</code> object.</p></a></li>
<li><a href='#print.FormatOccurrence'><p>Print summary information from <code>FormatOccurrence</code> object.</p></a></li>
<li><a href='#print.PAConversion'><p>Print summary information from <code>PAConversion</code> object.</p></a></li>
<li><a href='#print.POEvaluation'><p>Print summary information from model evaluation object (<code>POEvaluation</code>).</p></a></li>
<li><a href='#print.POIsotree'><p>Print summary information from <code>POIsotree</code> object.</p></a></li>
<li><a href='#print.ReducedImageStack'><p>Print summary information from <code>ReducedImageStack</code> object.</p></a></li>
<li><a href='#print.VariableAnalysis'><p>Print summary information from variable importance object</p>
(<code>VariableAnalysis</code>).</a></li>
<li><a href='#probability'><p>Estimate suitability on <code>stars</code> object using trained <code>isolation.forest</code> model.</p></a></li>
<li><a href='#shap_dependence'><p>Calculate Shapley value-based variable dependence.</p></a></li>
<li><a href='#shap_spatial_response'><p>Calculate shapley values-based spatial response.</p></a></li>
<li><a href='#spatial_response'><p>Calculate spatial response or dependence figures.</p></a></li>
<li><a href='#suspicious_env_outliers'><p>Function to detect suspicious outliers based on environmental variables.</p></a></li>
<li><a href='#variable_analysis'><p>Function to evaluate relative importance of each variable.</p></a></li>
<li><a href='#variable_contrib'><p>Evaluate variable contributions for targeted observations.</p></a></li>
<li><a href='#worldclim2'><p>Download environmental variables made by worldclim version 2.1.</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Title:</td>
<td>Isolation Forest-Based Presence-Only Species Distribution
Modeling</td>
</tr>
<tr>
<td>Version:</td>
<td>0.2.1</td>
</tr>
<tr>
<td>Description:</td>
<td>Collection of R functions to do purely presence-only species
    distribution modeling with isolation forest (iForest) and its
    variations such as Extended isolation forest and SCiForest. See the
    details of these methods in references: Liu, F.T., Ting, K.M. and
    Zhou, Z.H. (2008) &lt;<a href="https://doi.org/10.1109%2FICDM.2008.17">doi:10.1109/ICDM.2008.17</a>&gt;, Hariri, S., Kind, M.C.
    and Brunner, R.J. (2019) &lt;<a href="https://doi.org/10.1109%2FTKDE.2019.2947676">doi:10.1109/TKDE.2019.2947676</a>&gt;, Liu, F.T.,
    Ting, K.M. and Zhou, Z.H. (2010) &lt;<a href="https://doi.org/10.1007%2F978-3-642-15883-4_18">doi:10.1007/978-3-642-15883-4_18</a>&gt;,
    Guha, S., Mishra, N., Roy, G. and Schrijvers, O. (2016)
    <a href="https://proceedings.mlr.press/v48/guha16.html">https://proceedings.mlr.press/v48/guha16.html</a>, Cortes, D. (2021)
    &lt;<a href="https://arxiv.org/abs/2110.13402">arXiv:2110.13402</a>&gt;. Additionally, Shapley values are used to explain
    model inputs and outputs. See details in references: Shapley, L.S.
    (1953) &lt;<a href="https://doi.org/10.1515%2F9781400881970-018">doi:10.1515/9781400881970-018</a>&gt;, Lundberg, S.M. and Lee, S.I.
    (2017) <a href="https://dl.acm.org/doi/abs/10.5555/3295222.3295230">https://dl.acm.org/doi/abs/10.5555/3295222.3295230</a>, Molnar,
    C.  (2020) &lt;ISBN:978-0-244-76852-2&gt;, Å trumbelj, E. and Kononenko, I.
    (2014) &lt;<a href="https://doi.org/10.1007%2Fs10115-013-0679-x">doi:10.1007/s10115-013-0679-x</a>&gt;. itsdm also provides functions
    to diagnose variable response, analyze variable importance, draw
    spatial dependence of variables and examine variable contribution. As
    utilities, the package includes a few functions to download
    bioclimatic variables including 'WorldClim' version 2.0 (see Fick,
    S.E. and Hijmans, R.J. (2017) &lt;<a href="https://doi.org/10.1002%2Fjoc.5086">doi:10.1002/joc.5086</a>&gt;) and
    'CMCC-BioClimInd' (see Noce, S., Caporaso, L. and Santini, M. (2020)
    &lt;<a href="https://doi.org/10.1038%2Fs41597-020-00726-5">doi:10.1038/s41597-020-00726-5</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file LICENSE</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://github.com/LLeiSong/itsdm">https://github.com/LLeiSong/itsdm</a>,
<a href="https://lleisong.github.io/itsdm/">https://lleisong.github.io/itsdm/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/LLeiSong/itsdm/issues">https://github.com/LLeiSong/itsdm/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.5.0)</td>
</tr>
<tr>
<td>Imports:</td>
<td>checkmate, dplyr, fastshap, ggplot2, isotree, methods, mgcv,
ncdf4, outliertree, patchwork, raster, rlang, ROCit, sf, stars
(&ge; 0.6-0), stats, stringr, tidyselect, utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>Language:</td>
<td>en-US</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2023-06-10 23:14:26 UTC; leisong</td>
</tr>
<tr>
<td>Author:</td>
<td>Lei Song <a href="https://orcid.org/0000-0002-4371-1473"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cre],
  Lyndon Estes [ths]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Lei Song &lt;lsong@clarku.edu&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2023-06-11 00:00:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='cmcc_bioclim'>Download historic Bioclimatic indicators (BIOs) named CMCC-BioClimInd.</h2><span id='topic+cmcc_bioclim'></span>

<h3>Description</h3>

<p>Parse historic CMCC-BioClimInd bioclimatic indicators
optionally with a setting of boundary and a few other options.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>cmcc_bioclim(bry = NULL, path = NULL, nm_mark = "clip", return_stack = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="cmcc_bioclim_+3A_bry">bry</code></td>
<td>
<p>(<code><a href="sf.html#topic+sf">sf</a></code> or <code>sp</code>) The boundary to mask the
downloaded original data. If <code>NULL</code>, it would get global map.
If not <code>NULL</code>, it can take <code><a href="sf.html#topic+sf">sf</a></code>,
<code><a href="sf.html#topic+sfc">sfc</a></code>, <code>SpatialPolygonsDataFrame</code>, <code>SpatialPolygons</code>,
etc.
The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="cmcc_bioclim_+3A_path">path</code></td>
<td>
<p>(<code>character</code>) The path to save the downloaded imagery.
If <code>NULL</code>, it would use the current working directory.
The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="cmcc_bioclim_+3A_nm_mark">nm_mark</code></td>
<td>
<p>(<code>character</code>) the name mark of clipped images.
The default is &quot;clip&quot;. It would be ignored if <code>bry</code> is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="cmcc_bioclim_+3A_return_stack">return_stack</code></td>
<td>
<p>(<code>logical</code>) if <code>TRUE</code>, stack the imagery
together and return.
If the area is large and resolution is high, it is better not to stack them.
The default is <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://doi.pangaea.de/10.1594/PANGAEA.904278?format=html">Web
page page for this dataset</a>
</p>


<h3>Value</h3>

<p>if <code>return_stack</code> is <code>TRUE</code>, the images would be
returned as a <code>stars</code>. Otherwise, nothing to return, but the user
would receive a message of where the images are.
</p>


<h3>Note</h3>

<p>The function is experimental at the moment, because the download server
of this dataset is not as stable as Worldclim yet. If it fails due to slow
internet, try to set a larger timeout option,
e.g., using <code>options(timeout = 1e3)</code>.
</p>


<h3>References</h3>

<p>Noce, Sergio, Luca Caporaso, and Monia Santini.&quot;A new global dataset of
bioclimatic indicators. &quot;<em>Scientific data</em> 7.1 (2020): 1-12.
<a href="https://doi.org/10.1038/s41597-020-00726-5">doi:10.1038/s41597-020-00726-5</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(dplyr)
library(sf)
library(itsdm)
bry &lt;- st_polygon(
  list(rbind(c(29.34, -11.72), c(29.34, -0.95),
             c(40.31, -0.95), c(40.31, -11.72),
             c(29.34, -11.72)))) %&gt;%
  st_sfc(crs = 4326)

cmcc_bios &lt;- cmcc_bioclim(bry = bry,
  nm_mark = 'tza', path = tempdir())

## End(Not run)

</code></pre>

<hr>
<h2 id='convert_to_pa'>Convert predicted suitability to presence-absence map.</h2><span id='topic+convert_to_pa'></span>

<h3>Description</h3>

<p>Use threshold-based, logistic or linear conversion method to
convert predicted suitability map to presence-absence map.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>convert_to_pa(
  suitability,
  method = "logistic",
  beta = 0.5,
  alpha = -0.05,
  a = 1,
  b = 0,
  species_prevalence = NA,
  threshold = 0.5,
  seed = 10L,
  visualize = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="convert_to_pa_+3A_suitability">suitability</code></td>
<td>
<p>(<code>stars</code> or <code>RasterLayer</code>) The suitability raster.</p>
</td></tr>
<tr><td><code id="convert_to_pa_+3A_method">method</code></td>
<td>
<p>(<code>character</code>) The conversion method, must be one of
'threshold', 'logistic', and 'linear'. The default is 'logistic'.</p>
</td></tr>
<tr><td><code id="convert_to_pa_+3A_beta">beta</code></td>
<td>
<p>(<code>numeric</code>) Works for 'threshold' or 'logistic' method.
If <code>method</code> is threshold, then <code>beta</code> is the threshold value to cutoff.
If <code>method</code> is logistic, it is the sigmoid midpoint. The default is <code>0.5</code>.</p>
</td></tr>
<tr><td><code id="convert_to_pa_+3A_alpha">alpha</code></td>
<td>
<p>(<code>numeric</code>) Works for logistic method.
It is the logistic growth rate or steepness of the curve.
The default is <code>-.05</code>.</p>
</td></tr>
<tr><td><code id="convert_to_pa_+3A_a">a</code></td>
<td>
<p>(<code>numeric</code>) Works for linear method. It is the slope of the line.
The default is <code>1</code>.</p>
</td></tr>
<tr><td><code id="convert_to_pa_+3A_b">b</code></td>
<td>
<p>(<code>numeric</code>) Works for linear method.
It is the intercept of the line. The default is <code>0</code>.</p>
</td></tr>
<tr><td><code id="convert_to_pa_+3A_species_prevalence">species_prevalence</code></td>
<td>
<p>(<code>numeric</code> or <code>NA</code>) Works for all three methods.
It is the species prevalence to classify suitability map.
It could be <code>NA</code>, when the will be calculated automatically
based on other arguments. The default is <code>NA</code>.</p>
</td></tr>
<tr><td><code id="convert_to_pa_+3A_threshold">threshold</code></td>
<td>
<p>(<code>numeric</code>) The threshold used to convert probability of
occurrence to presence-absence map. It ranges in <code style="white-space: pre;">&#8288;[0, 1]&#8288;</code>. The default is 0.5.</p>
</td></tr>
<tr><td><code id="convert_to_pa_+3A_seed">seed</code></td>
<td>
<p>(<code>integer</code>) The seed for random progress. The default is <code>10L</code></p>
</td></tr>
<tr><td><code id="convert_to_pa_+3A_visualize">visualize</code></td>
<td>
<p>(<code>logical</code>) If <code>TRUE</code>, plot map of suitability,
probability of occurrence, and presence-absence together.
The default is <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Multiple methods and arguments could be used as a combination to do
the conversion.
</p>


<h3>Value</h3>

<p>(<code>PAConversion</code>) A list of
</p>

<ul>
<li><p>suitability (<code>stars</code>) The input suitability map
</p>
</li>
<li><p>probability_of_occurrence (<code>stars</code>) The map of occurrence probability
</p>
</li>
<li><p>pa_conversion (<code>list</code>) A list of conversion arguments
</p>
</li>
<li><p>pa_map (<code>stars</code>) The presence-absence map</p>
</li></ul>



<h3>References</h3>

<p><a href="https://github.com/Farewe/virtualspecies/blob/master/R/convertToPA.R">c
onvertToPA in package <code>virtualspecies</code></a>
</p>


<h3>See Also</h3>

<p><code><a href="#topic+plot.PAConversion">plot.PAConversion</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)

# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12, 16))

# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 5,
  sample_size = 0.8, ndim = 1L,
  nthreads = 1,
  seed = 123L, response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

# Threshold conversion
pa_thred &lt;- convert_to_pa(mod$prediction,
                          method = 'threshold', beta = 0.5, visualize = FALSE)
pa_thred
plot(pa_thred)

## Not run: 
# Logistic conversion
pa_log &lt;- convert_to_pa(mod$prediction, method = 'logistic',
                        beta = 0.5, alpha = -.05)

# Linear conversion
pa_lin &lt;- convert_to_pa(mod$prediction, method = 'linear',
                        a = 1, b = 0)

## End(Not run)

</code></pre>

<hr>
<h2 id='detect_envi_change'>Detect areas influenced by a changing environment variable.</h2><span id='topic+detect_envi_change'></span>

<h3>Description</h3>

<p>Use shapley values to detect the potential areas that will
impact the species distribution. It only works on continuous variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>detect_envi_change(
  model,
  var_occ,
  variables,
  target_var,
  bins = NULL,
  shap_nsim = 10,
  seed = 10,
  var_future = NULL,
  variables_future = NULL,
  pfun = .pfun_shap,
  method = "gam",
  formula = y ~ s(x)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="detect_envi_change_+3A_model">model</code></td>
<td>
<p>(<code>isolation_forest</code> or other model). It could
be the item <code>model</code> of <code>POIsotree</code> made by function <code><a href="#topic+isotree_po">isotree_po</a></code>.
It also could be other user-fitted models as long as the <code>pfun</code> can work on it.</p>
</td></tr>
<tr><td><code id="detect_envi_change_+3A_var_occ">var_occ</code></td>
<td>
<p>(<code>data.frame</code>, <code>tibble</code>) The <code>data.frame</code> style table that
include values of environmental variables at occurrence locations.</p>
</td></tr>
<tr><td><code id="detect_envi_change_+3A_variables">variables</code></td>
<td>
<p>(<code>stars</code>) The <code>stars</code> of environmental variables.
It should have multiple <code>attributes</code> instead of <code>dims</code>.
If you have <code>raster</code> object instead, you
could use <code>st_as_stars</code> to convert it to <code>stars</code> or use
<code>read_stars</code> directly read source data as a <code>stars</code>.
You also could use item <code>variables</code> of <code>POIsotree</code> made by function
<code><a href="#topic+isotree_po">isotree_po</a></code>.</p>
</td></tr>
<tr><td><code id="detect_envi_change_+3A_target_var">target_var</code></td>
<td>
<p>(<code>character</code>) The selected variable to process.</p>
</td></tr>
<tr><td><code id="detect_envi_change_+3A_bins">bins</code></td>
<td>
<p>(<code>integer</code>) The bin to cut the target variable for the analysis.
If it is <code>NULL</code>, no cut to apply. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="detect_envi_change_+3A_shap_nsim">shap_nsim</code></td>
<td>
<p>(<code>integer</code>) The number of Monte Carlo repetitions in SHAP
method to use for estimating each Shapley value. See details in documentation
of function <code><a href="dplyr.html#topic+explain">explain</a></code> in package <code>fastshap</code>.
When the number of variables is large, a smaller shap_nsim could be used.
Be cautious that making SHAP-based spatial dependence will be slow
because of Monte-Carlo computation for all pixels.
But it is worth the time because it is much more
informative. See details in documentation of function <code><a href="dplyr.html#topic+explain">explain</a></code>
in package <code>fastshap</code>. The default is 10. Usually a value 10 - 20 is enough.</p>
</td></tr>
<tr><td><code id="detect_envi_change_+3A_seed">seed</code></td>
<td>
<p>(<code>integer</code>) The seed for any random progress. The default is <code>10L</code>.</p>
</td></tr>
<tr><td><code id="detect_envi_change_+3A_var_future">var_future</code></td>
<td>
<p>(<code>numeric</code> or <code>stars</code>) A number to apply to the current
variable or a <code>stars</code> layer as the future variable. It can be <code>NULL</code> if
<code>variables_future</code> is set.</p>
</td></tr>
<tr><td><code id="detect_envi_change_+3A_variables_future">variables_future</code></td>
<td>
<p>(<code>stars</code>) A <code>stars</code> raster stack for future variables.
It could be <code>NULL</code> if <code>var_future</code> is set.</p>
</td></tr>
<tr><td><code id="detect_envi_change_+3A_pfun">pfun</code></td>
<td>
<p>(<code>function</code>) The predict function that requires two arguments,
<code>object</code> and <code>newdata</code>.
It is only required when <code>model</code> is not <code>isolation_forest</code>.
The default is the wrapper function designed for iForest model in <code>itsdm</code>.</p>
</td></tr>
<tr><td><code id="detect_envi_change_+3A_method">method</code></td>
<td>
<p>Argument passed on to <code><a href="ggplot2.html#topic+geom_smooth">geom_smooth</a></code> to fit the line.
Note that the same arguments will be used for all target variables.
User could set variable one by one to set the arguments separately.
Default value is &quot;gam&quot;.</p>
</td></tr>
<tr><td><code id="detect_envi_change_+3A_formula">formula</code></td>
<td>
<p>Argument passed on to <code><a href="ggplot2.html#topic+geom_smooth">geom_smooth</a></code> to fit the line.
Note that the same arguments will be used for all target variables.
User could set variable one by one to set the arguments separately.
The default is y ~ s(x).</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The values show how changes in environmental variable affects the modeling
prediction in space. These maps could help to answer questions of where will
be affected by a changing variable.
</p>


<h3>Value</h3>

<p>(<code>EnviChange</code>) A list of
</p>

<ul>
<li><p>A figure of fitted variable curve
</p>
</li>
<li><p>A map of variable contribiution change
</p>
</li>
<li><p>Tipping points of variable contribution
</p>
</li>
<li><p>A <code>stars</code> of variable contribution under current and future condition,
and the detected changes
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+shap_spatial_response">shap_spatial_response</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)
#'
# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"
#'
# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")
#'
env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 12))
#'
# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 5,
  sample_size = 0.8, ndim = 1L,
  nthreads = 1,
  seed = 123L, response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

# Use a fixed value
bio1_changes &lt;- detect_envi_change(
  model = mod$model,
  var_occ = mod$vars_train,
  variables = mod$variables,
  shap_nsim = 1,
  target_var = "bio1",
  var_future = 5)

## Not run: 
# Use a future layer
## Read the future Worldclim variables
future_vars &lt;- system.file(
  'extdata/future_bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  split() %&gt;% select(bioc1, bioc12)
# Rename the bands
names(future_vars) &lt;- paste0("bio", c(1, 12))

## Just use the target future variable
climate_changes &lt;- detect_envi_change(
  model = mod$model,
  var_occ = mod$vars_train,
  variables = mod$variables,
  shap_nsim = 1,
  target_var = "bio1",
  var_future = future_vars %&gt;% select("bio1"))

## Use the whole future variable tack
bio12_changes &lt;- detect_envi_change(
  model = mod$model,
  var_occ = mod$vars_train,
  variables = mod$variables,
  shap_nsim = 1,
  target_var = "bio12",
  variables_future = future_vars)

print(bio12_changes)

##### Use Random Forest model as an external model ########
library(randomForest)

# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;%
  filter(usage == "train")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12)) %&gt;%
  split()

model_data &lt;- stars::st_extract(
  env_vars, at = as.matrix(obs_df %&gt;% select(x, y))) %&gt;%
  as.data.frame()
names(model_data) &lt;- names(env_vars)
model_data &lt;- model_data %&gt;%
  mutate(occ = obs_df[['observation']])
model_data$occ &lt;- as.factor(model_data$occ)

mod_rf &lt;- randomForest(
  occ ~ .,
  data = model_data,
  ntree = 200)

pfun &lt;- function(X.model, newdata) {
  # for data.frame
  predict(X.model, newdata, type = "prob")[, "1"]
}

# Use a fixed value
bio5_changes &lt;- detect_envi_change(
  model = mod_rf,
  var_occ = model_data %&gt;% select(-occ),
  variables = env_vars,
  target_var = "bio5",
  bins = 20,
  var_future = 5,
  pfun = pfun)

plot(bio5_changes)

## End(Not run)

</code></pre>

<hr>
<h2 id='dim_reduce'>Remove environmental variables that have high correlation with others.</h2><span id='topic+dim_reduce'></span>

<h3>Description</h3>

<p>Select environmental variables that have pairwise Pearson
correlation lower than a user-defined threshold.
NOTE that it only works on numeric variables, does not work on
categorical variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>dim_reduce(
  img_stack = NULL,
  threshold = 0.5,
  preferred_vars = NULL,
  samples = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="dim_reduce_+3A_img_stack">img_stack</code></td>
<td>
<p>(<code>stars</code> or <code>RasterStack</code>)
The image stack to work on.</p>
</td></tr>
<tr><td><code id="dim_reduce_+3A_threshold">threshold</code></td>
<td>
<p>(<code>numeric</code>) The threshold number of Pearson
correlation that indicates two variables are strongly correlated.
The default is 0.5.</p>
</td></tr>
<tr><td><code id="dim_reduce_+3A_preferred_vars">preferred_vars</code></td>
<td>
<p>(<code>vector</code> of <code>character</code>) The preferred
variables <b>in order</b> in dimension reduction. The preferred variables
will move to the beginning before the reduction. So make sure they are
placed in order. Furthermore, setting preferred_vars does not guarantee
they can survive. For example, one preferred variable that is placed later
has strong correlation with former preferred variable.</p>
</td></tr>
<tr><td><code id="dim_reduce_+3A_samples">samples</code></td>
<td>
<p>(<code><a href="sf.html#topic+sf">sf</a></code> or <code>sp</code>) The samples to reduce
dimension.
If not <code>NULL</code>, it can take <code><a href="sf.html#topic+sf">sf</a></code>, <code><a href="sf.html#topic+sfc">sfc</a></code>,
<code>SpatialPointsDataFrame</code>, <code>SpatialPoints</code>, etc.
If <code>NULL</code>, the whole raster stack would be used.
The default is <code>NULL</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>(<code>ReducedImageStack</code>) A list of
</p>

<ul>
<li><p>threshold (<code>numeric</code>) The threshold set in function inputs
</p>
</li>
<li><p>img_reduced (<code>stars</code>) The image stack after dimension reduction
</p>
</li>
<li><p>cors_original (<code><a href="base.html#topic+data.frame">data.frame</a></code>) A table of Pearson
correlations between all variables.
</p>
</li>
<li><p>cors_reduced (<code><a href="base.html#topic+data.frame">data.frame</a></code>) A table of Pearson
correlations between variables after dimension reduction.</p>
</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>library(sf)
library(itsdm)
library(stars)
library(dplyr)
env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars()
img_reduced &lt;- dim_reduce(env_vars, threshold = 0.7,
  preferred_vars = c('bio1', 'bio12'))

</code></pre>

<hr>
<h2 id='evaluate_po'>Evaluate the model based on presence-only data.</h2><span id='topic+evaluate_po'></span>

<h3>Description</h3>

<p>This function will calculate two major types of evaluation
metrics in terms of presence-only data. The first type is presence-only
customized metrics, such as Contrast Validation Index (CVI),
continuous Boyce index (CBI), and ROC_ratio.
The second type is presence-background evaluation metrics by
extracting background points as pseudo absence observations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>evaluate_po(
  model,
  occ_pred,
  bg_pred = NULL,
  var_pred,
  threshold = NULL,
  visualize = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="evaluate_po_+3A_model">model</code></td>
<td>
<p>(<code>isolation_forest</code>) The extended isolation forest SDM.
It could be the item <code>model</code> of <code>POIsotree</code> made by
function <code><a href="#topic+isotree_po">isotree_po</a></code>.</p>
</td></tr>
<tr><td><code id="evaluate_po_+3A_occ_pred">occ_pred</code></td>
<td>
<p>(<code>vector</code> of <code>numeric</code>) A <code>vector</code> contains predicted values
at occurrence locations.</p>
</td></tr>
<tr><td><code id="evaluate_po_+3A_bg_pred">bg_pred</code></td>
<td>
<p>(<code>vector</code> of <code>numeric</code>) the vector contains predicted values
with same number of background points.</p>
</td></tr>
<tr><td><code id="evaluate_po_+3A_var_pred">var_pred</code></td>
<td>
<p>(<code>vector</code> of <code>numeric</code>) the vector contains predicted values
of the whole area. The reason to take a vector is to keep this function
flexible for multiple types of output.</p>
</td></tr>
<tr><td><code id="evaluate_po_+3A_threshold">threshold</code></td>
<td>
<p>(<code>numeric</code> or <code>NULL</code>) The threshold to calculate
threshold-based evaluation metrics. If <code>NULL</code>, a recommended threshold
will be calculated based on optimal TSS value. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="evaluate_po_+3A_visualize">visualize</code></td>
<td>
<p>(<code>logical</code>) If <code>TRUE</code>, plot the evaluation figures.
The default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>


<ul>
<li>
<p><b>CVI</b> is the proportion of presence points falling in cells having
a threshold (<code>0.5</code> for example) habitat suitability index minus
the proportion of cells within this range of threshold of the model.
Here we used varied thresholds: <code>0.25</code>, <code>0.5</code>, and <code>0.75</code>.
</p>
</li>
<li><p><b>continuous Boyce index (CBI)</b> is made with a 100 resolution of
moving windows and Kendall method.
</p>
</li>
<li>
<p><b>ROC_ratio</b> curve plots the proportion of presences falling above a
range of thresholds against the proportion of cells falling
above the range of thresholds. The area under the modified
ROC curve was then called <b>AUC_ratio</b>.
</p>
</li>
<li><p><b>Sensitivity (TPR)</b> = TP/(TP + FN)
</p>
</li>
<li><p><b>Specificity (TNR)</b> = TN/(TN + FP)
</p>
</li>
<li><p><b>True skill statistic (TSS)</b> = Sensitivity + specificity - 1
</p>
</li>
<li><p><b>Jaccard's similarity index</b> = TP/(FN + TP + FP)
</p>
</li>
<li><p><b>SÃ¸rensen's similarity index (F-measure)</b> = 2TP/(FN + 2TP + FP)
</p>
</li>
<li><p><b>Overprediction rate</b> = FP/(TP + FP)
</p>
</li>
<li><p><b>Underprediction rate</b> = FN/(TP + FN)
</p>
</li></ul>



<h3>Value</h3>

<p>(<code>POEvaluation</code>) A list of
</p>

<ul>
<li>
<p><b>po_evaluation</b> is presence-only evaluation metrics. It is a list of
</p>

<ul>
<li><p>cvi (<code>list</code>) A list of CVI with 0.25, 0.5, and 0.75 as threshold
</p>
</li>
<li><p>boyce (<code>list</code>) A list of items related to continuous Boyce index (CBI)
</p>
</li>
<li><p>roc_ratio (<code>list</code>) A list of ROC ratio and AUC ratio
</p>
</li></ul>

</li>
<li>
<p><b>pb_evaluation</b> is presence-background evaluation metrics.
It is a list of
</p>

<ul>
<li><p>confusion matrix (<code>table</code>) A table of confusion matrix. The columns are
true values, and the rows are predicted values.
</p>
</li>
<li><p>sensitivity (<code>numeric</code>) The sensitivity or TPR
</p>
</li>
<li><p>specificity (<code>numeric</code>) The specificity or TNR
</p>
</li>
<li><p>TSS (<code>list</code>) A list of info related to true skill statistic (TSS)
</p>

<ul>
<li><p>cutoff (<code>vector</code> of <code>numeric</code>) A vector of cutoff threshold values
</p>
</li>
<li><p>tss (<code>vector</code> of <code>numeric</code>) A vector of TSS for each cutoff threshold
</p>
</li>
<li><p>Recommended threshold (<code>numeric</code>) A recommended threshold
according to TSS
</p>
</li>
<li><p>Optimal TSS (<code>numeric</code>) The best TSS value</p>
</li></ul>

</li>
<li><p>roc (<code>list</code>) A list of ROC values and AUC value
</p>
</li>
<li><p>Jaccard's similarity index (<code>numeric</code>) The Jaccard's similarity index
</p>
</li>
<li><p>SÃ¸rensen's similarity index (<code>numeric</code>) The SÃ¸rensen's similarity index
or F-measure
</p>
</li>
<li><p>Overprediction rate (<code>numeric</code>) The Overprediction rate
</p>
</li>
<li><p>Underprediction rate (<code>numeric</code>) The Underprediction rate
</p>
</li></ul>
</li></ul>



<h3>References</h3>


<ul>
<li><p>Peterson,
A. Townsend, Monica PapeÅ, and Jorge SoberÃ³n. &quot;Rethinking receiver operating
characteristic analysis applications in ecological niche modeling.&quot;
<em>Ecological modelling</em> 213.1 (2008): 63-72.
<a href="https://doi.org/10.1016/j.ecolmodel.2007.11.008">doi:10.1016/j.ecolmodel.2007.11.008</a>
</p>
</li>
<li><p>Hirzel,
Alexandre H., et al. &quot;Evaluating the ability of habitat suitability models
to predict species presences.&quot; <em>Ecological modelling</em>
199.2 (2006): 142-152.
<a href="https://doi.org/10.1016/j.ecolmodel.2006.05.017">doi:10.1016/j.ecolmodel.2006.05.017</a>
</p>
</li>
<li><p>Hirzel, Alexandre
H., and RaphaÃ«l Arlettaz. &quot;Modeling habitat suitability for complex species
distributions by environmental-distance geometric mean.&quot;
<em>Environmental management</em> 32.5 (2003): 614-623.
<a href="https://doi.org/10.1007/s00267-003-0040-3">doi:10.1007/s00267-003-0040-3</a>
</p>
</li>
<li><p>Leroy, Boris, et al.
&quot;Without quality presence-absence data, discrimination metrics such as
TSS can be misleading measures of model performance.&quot;
<em>Journal of Biogeography</em> 45.9 (2018): 1994-2002.
<a href="https://doi.org/10.1111/jbi.13402">doi:10.1111/jbi.13402</a>
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+print.POEvaluation">print.POEvaluation</a></code>, <code><a href="#topic+plot.POEvaluation">plot.POEvaluation</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)

data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12, 16))

# With perfect_presence mode,
# which should be very rare in reality.
mod &lt;- isotree_po(
  obs_mode = "perfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 10,
  sample_size = 0.8, ndim = 2L,
  seed = 123L, nthreads = 1,
  response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

# Without background samples or absences
eval_train &lt;- evaluate_po(
  mod$model,
  occ_pred = mod$pred_train$prediction,
  var_pred = na.omit(as.vector(mod$prediction[[1]])))
print(eval_train)

# With background samples
bg_pred &lt;- st_extract(
  mod$prediction, mod$background_samples) %&gt;%
  st_drop_geometry()
eval_train &lt;- evaluate_po(
  mod$model,
  occ_pred = mod$pred_train$prediction,
  bg_pred = bg_pred$prediction,
  var_pred = na.omit(as.vector(mod$prediction[[1]])))
plot(eval_train)
#'
</code></pre>

<hr>
<h2 id='format_observation'>Format the occurrence dataset for usage in <span class="pkg">itsdm</span></h2><span id='topic+format_observation'></span>

<h3>Description</h3>

<p>The focus of this function is to format the dataset
but to keep the dataset as original as possible.
Then the users can modify the data if they want before put it
into this function.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>format_observation(
  obs_df,
  eval_df = NULL,
  split_perc = 0.3,
  seed = 123,
  obs_crs = 4326,
  eval_crs = 4326,
  x_col = "x",
  y_col = "y",
  obs_col = "observation",
  obs_type = "presence_only"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="format_observation_+3A_obs_df">obs_df</code></td>
<td>
<p>(<code>data.frame</code>). The <code>data.frame</code> style table that
include x and y coordinate and observation of training dataset.
This parameter is required as it is the training dataset.
Note: it only takes <code>data.frame</code> to reduce the risk of column name mismatch
between <code>data.frame</code> and other formats such as <code>tibble</code>.</p>
</td></tr>
<tr><td><code id="format_observation_+3A_eval_df">eval_df</code></td>
<td>
<p>(<code>data.frame</code> or <code>NULL</code>) The <code>data.frame</code> style table that
include x and y coordinate and observation of evaluation dataset.
Note: it only takes <code>data.frame</code> to reduce the risk of column name mismatch
between <code>data.frame</code> and other formats such as <code>tibble</code>.</p>
</td></tr>
<tr><td><code id="format_observation_+3A_split_perc">split_perc</code></td>
<td>
<p>(<code>numeric</code>) a <code>numeric</code> between 0 and 1 corresponding to the
percentage of data used to evaluate the models.
Only required if <code>eval_df</code> is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="format_observation_+3A_seed">seed</code></td>
<td>
<p>(<code>integer</code>) The seed to split train and evaluation set.
The default value is <code>123</code>. Only required if <code>eval_df</code> is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="format_observation_+3A_obs_crs">obs_crs</code></td>
<td>
<p>(<code>integer</code>, <code>numeric</code>, <code>character</code>, or <code>crs</code>)
The EPSG code, CRS string, or <code>sf::crs</code> object of the coordinate system of
the training dataset. It corresponds to <code>x_col</code> and <code>y_col</code> in <code>obs_df</code>.</p>
</td></tr>
<tr><td><code id="format_observation_+3A_eval_crs">eval_crs</code></td>
<td>
<p>(<code>integer</code>, <code>numeric</code>, <code>character</code>, or <code>crs</code>)
The EPSG code, CRS string, or <code>sf::crs</code> object of the coordinate system
of the evaluation dataset. Only required if  <code>eval_df</code> is not <code>NULL</code>.
It corresponds to <code>x_col</code> and <code>y_col</code> in <code>eval_df</code> if any.</p>
</td></tr>
<tr><td><code id="format_observation_+3A_x_col">x_col</code></td>
<td>
<p>(<code>character</code>) The name of column that is x coordinate
in <code>obs_df</code> and <code>eval_df</code> if not <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="format_observation_+3A_y_col">y_col</code></td>
<td>
<p>(<code>character</code>) The name of column that is y coordinate
in <code>obs_df</code> and <code>eval_df</code> if not <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="format_observation_+3A_obs_col">obs_col</code></td>
<td>
<p>(<code>character</code>) The name of column that represents observations
in <code>obs_df</code> and <code>eval_df</code> if not <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="format_observation_+3A_obs_type">obs_type</code></td>
<td>
<p>(<code>character</code>) The type of observation to be formatted to.
Only can be one of <code>c("presence_only", "presence_absence")</code>.
Note that if &quot;presence_only&quot; is set, the absences in <code>obs_df</code> will be deleted.
This only affect <code>obs_df</code>, <code>eval_df</code> will keep the original type no matter it
is an independent one or is split from <code>eval_df</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>(<code>FormatOccurrence</code>) A list of
</p>

<ul>
<li><p>obs (<code>sf</code>) the formatted pts of observations.
The column of observation is &quot;observation&quot;.
</p>
</li>
<li><p>obs_type (<code>character</code>) the type of the observations,
presence_only or presence_absence.
</p>
</li>
<li><p>has_eval (<code>logical</code>) whether evaluation dataset is set or generated.
</p>
</li>
<li><p>eval (<code>sf</code>) the formatted pts of observations for evaluation if any.
The column of observation is &quot;observation&quot;.
</p>
</li>
<li><p>eval (<code>eval_type</code>)  the type of the observations for evaluation,
presence_only or presence_absence.
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+print.FormatOccurrence">print.FormatOccurrence</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
library(itsdm)
data("occ_virtual_species")

# obs + eval, presence-absence
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"
obs_type &lt;- "presence_absence"

obs &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = obs_type)

# obs + eval, presence-only
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"
obs_type &lt;- "presence_only"

obs &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = obs_type)

# obs + eval, different crs, presence-only
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
obs_crs &lt;- 4326
# Fake one
eval_crs &lt;- 20935
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"
obs_type &lt;- "presence_only"

obs &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  obs_crs = obs_crs, eval_crs = eval_crs,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = obs_type)

# obs + split, presence-absence
obs_df &lt;- occ_virtual_species
split_perc &lt;- 0.5
seed &lt;- 123
obs_crs &lt;- 4326
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"
obs_type &lt;- "presence_absence"

obs &lt;- format_observation(
  obs_df = obs_df, split_perc = split_perc,
  x_col = x_col, y_col = y_col,
  obs_col = obs_col, obs_type = obs_type)

# obs, presence-only, no eval
obs_df &lt;- occ_virtual_species
eval_df &lt;- NULL
split_perc &lt;- 0
seed &lt;- 123
obs_crs &lt;- 4326
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"
obs_type &lt;- "presence_only"

obs &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  split_perc = split_perc,
  x_col = x_col, y_col = y_col,
  obs_col = obs_col, obs_type = obs_type)

</code></pre>

<hr>
<h2 id='future_cmcc_bioclim'>Download future Bioclimatic indicators (BIOs) named CMCC-BioClimInd.</h2><span id='topic+future_cmcc_bioclim'></span>

<h3>Description</h3>

<p>Parse future CMCC-BioClimInd bioclimatic indicators obtained by
different Earth System Models (ESMs) optionally with a setting of boundary
and a few other options.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>future_cmcc_bioclim(
  bry = NULL,
  path = NULL,
  esm = "CMCC-CESM",
  rcp = 85,
  interval = "2040-2079",
  nm_mark = "clip",
  return_stack = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="future_cmcc_bioclim_+3A_bry">bry</code></td>
<td>
<p>(<code><a href="sf.html#topic+sf">sf</a></code> or <code>sp</code>) The boundary to mask the
downloaded original data. If <code>NULL</code>, it would get global map.
If not <code>NULL</code>, it can take <code><a href="sf.html#topic+sf">sf</a></code>, <code><a href="sf.html#topic+sfc">sfc</a></code>,
<code>SpatialPolygonsDataFrame</code>, <code>SpatialPolygons</code>, etc.
The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="future_cmcc_bioclim_+3A_path">path</code></td>
<td>
<p>(<code>character</code>) The path to save the downloaded imagery.
If <code>NULL</code>, it would use the current working directory.
The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="future_cmcc_bioclim_+3A_esm">esm</code></td>
<td>
<p>(<code>character</code>) The option for Earth System Models (ESMs).
Should be one of &quot;CMCC-CESM&quot;, 'GFDL-ESM2M', 'HadGEM2-ES',
'IPSL-CM5A-LR', 'MIROC-ESM-CHEM', 'NorESM1-M'.
The default is CMCC-CESM.</p>
</td></tr>
<tr><td><code id="future_cmcc_bioclim_+3A_rcp">rcp</code></td>
<td>
<p>(<code>numeric</code>) The option of Representative Concentration
Pathways (RCPs).
Should be 45 or 85. Only 85 is available for CMCC-CESM. The default is 85.</p>
</td></tr>
<tr><td><code id="future_cmcc_bioclim_+3A_interval">interval</code></td>
<td>
<p>(<code>character</code>) The option for time interval.
Should be one of &quot;2040-2079&quot;, &quot;2060-2099&quot;. The default is &quot;2040-2079&quot;.</p>
</td></tr>
<tr><td><code id="future_cmcc_bioclim_+3A_nm_mark">nm_mark</code></td>
<td>
<p>(<code>character</code>) the name mark of clipped images.
The default is &quot;clip&quot;. It would be ignored if <code>bry</code> is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="future_cmcc_bioclim_+3A_return_stack">return_stack</code></td>
<td>
<p>(<code>logical</code>) if <code>TRUE</code>, stack the imagery
together and return.
If the area is large and resolution is high, it is better not to stack them.
The default is <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://doi.pangaea.de/10.1594/PANGAEA.904278?format=html#download">https://doi.pangaea.de/10.1594/PANGAEA.904278?format=html#download</a>
</p>


<h3>Value</h3>

<p>if <code>return_stack</code> is <code>TRUE</code>, the images would be
returned as a <code>stars</code>. Otherwise, nothing to return, but the user
would receive a message of where the images are.
</p>


<h3>Note</h3>

<p>The function is experimental at the moment, because the download server
of this dataset is not as stable as Worldclim yet. If it fails due to slow
internet, try to set a larger timeout option,
e.g., using <code>options(timeout = 1e3)</code>.
</p>


<h3>References</h3>

<p>Noce, Sergio, Luca
Caporaso, and Monia Santini.&quot;A new global dataset of bioclimatic indicators.
&quot;<em>Scientific data</em> 7.1 (2020): 1-12.<a href="https://doi.org/10.1038/s41597-020-00726-5">doi:10.1038/s41597-020-00726-5</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(itsdm)
future_cmcc_bioclim(path = tempdir(),
  esm = 'GFDL-ESM2M', rcp = 45,
  interval = "2040-2079", return_stack = FALSE)

## End(Not run)

</code></pre>

<hr>
<h2 id='future_worldclim2'>A function to parse the future climate from worldclim version 2.1.</h2><span id='topic+future_worldclim2'></span>

<h3>Description</h3>

<p>This function allows you to parse worldclim version 2.1
future climatic files with a setting of boundary and a few other options.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>future_worldclim2(
  var = "tmin",
  res = 10,
  gcm = "BCC-CSM2-MR",
  ssp = "ssp585",
  interval = "2021-2040",
  bry = NULL,
  path = NULL,
  nm_mark = "clip",
  return_stack = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="future_worldclim2_+3A_var">var</code></td>
<td>
<p>(<code>character</code>) The option for the variable to download.
Should be one of tmin, tmax, prec, bioc.
The default is tmin.</p>
</td></tr>
<tr><td><code id="future_worldclim2_+3A_res">res</code></td>
<td>
<p>(<code>numeric</code>) The option for the resolution of image to
download. Should be one of 0.5, 2.5, 5, 10. The default is 10.</p>
</td></tr>
<tr><td><code id="future_worldclim2_+3A_gcm">gcm</code></td>
<td>
<p>(<code>character</code>) The option for global climate models.
Check https://www.worldclim.org for all available GCM.</p>
</td></tr>
<tr><td><code id="future_worldclim2_+3A_ssp">ssp</code></td>
<td>
<p>(<code>character</code>) The option for Shared Socio-economic Pathways.
Should be one of &quot;ssp126&quot;, &quot;ssp245&quot;, &quot;ssp370&quot;, &quot;ssp585&quot;.
The default is &quot;ssp585&quot;.</p>
</td></tr>
<tr><td><code id="future_worldclim2_+3A_interval">interval</code></td>
<td>
<p>(<code>character</code>) The option for time interval.
Should be one of &quot;2021-2040&quot;, &quot;2041-2060&quot;, &quot;2061-2080&quot;, &quot;2081-2100&quot;.
The default is &quot;2021-2040&quot;.</p>
</td></tr>
<tr><td><code id="future_worldclim2_+3A_bry">bry</code></td>
<td>
<p>(<code><a href="sf.html#topic+sf">sf</a></code> or <code>sp</code>) The boundary to mask the
downloaded original data. If <code>NULL</code>, it would get global map.
If not <code>NULL</code>, it can take <code><a href="sf.html#topic+sf">sf</a></code>,  <code><a href="sf.html#topic+sfc">sfc</a></code>,
<code>SpatialPolygonsDataFrame</code>, <code>SpatialPolygons</code>, etc.
The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="future_worldclim2_+3A_path">path</code></td>
<td>
<p>(<code>character</code>) The path to save the downloaded imagery.
If <code>NULL</code>, it would use the current working directory.
The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="future_worldclim2_+3A_nm_mark">nm_mark</code></td>
<td>
<p>(<code>character</code>) the name mark of clipped images.
The default is &quot;clip&quot;. It would be ignored if <code>bry</code> is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="future_worldclim2_+3A_return_stack">return_stack</code></td>
<td>
<p>(<code>logical</code>) if <code>TRUE</code>, stack the imagery
together and return.
If the area is large and resolution is high, it is better not to stack them.
The default is <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://worldclim.org/data/index.html">Web page page for this dataset</a>
</p>


<h3>Value</h3>

<p>if <code>return_stack</code> is <code>TRUE</code>, the images would be
returned as a <code>stars</code>. Otherwise, nothing to return, but the user
would receive a message of where the images are.
</p>


<h3>Note</h3>

<p>If it fails due to slow internet, try to set a larger timeout option,
e.g., using <code>options(timeout = 1e3)</code>.
</p>


<h3>References</h3>

<p>Fick, Stephen E., and Robert J.
Hijmans. &quot;WorldClim 2: new 1-km spatial resolution climate surfaces for
global land areas.&quot; <em>International journal of climatology</em>
37.12 (2017): 4302-4315.<a href="https://doi.org/10.1002/joc.5086">doi:10.1002/joc.5086</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
future_worldclim2("tmin", 10, "BCC-CSM2-MR",
  "ssp585", "2021-2040",
  path = tempdir(), return_stack = FALSE)

## End(Not run)

</code></pre>

<hr>
<h2 id='independent_response'>Calculate independent responses of each variables.</h2><span id='topic+independent_response'></span>

<h3>Description</h3>

<p>Calculate the independent responses of each variables
within the model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>independent_response(model, var_occ, variables, si = 1000, visualize = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="independent_response_+3A_model">model</code></td>
<td>
<p>(Any predictive model). It is <code>isolation_forest</code> here. It could
be the item <code>model</code> of <code>POIsotree</code> made by function <code><a href="#topic+isotree_po">isotree_po</a></code>.</p>
</td></tr>
<tr><td><code id="independent_response_+3A_var_occ">var_occ</code></td>
<td>
<p>(<code>data.frame</code>, <code>tibble</code>) The <code>data.frame</code> style table that
include values of environmental variables at occurrence locations.</p>
</td></tr>
<tr><td><code id="independent_response_+3A_variables">variables</code></td>
<td>
<p>(<code>stars</code>) The <code>stars</code> of environmental variables.
It should have multiple <code>attributes</code> instead of <code>dims</code>.
If you have <code>raster</code> object instead, you
could use <code>st_as_stars</code> to convert it to <code>stars</code> or use
<code>read_stars</code> directly read source data as a <code>stars</code>.
You also could use item <code>variables</code> of <code>POIsotree</code> made by function
<code><a href="#topic+isotree_po">isotree_po</a></code>.</p>
</td></tr>
<tr><td><code id="independent_response_+3A_si">si</code></td>
<td>
<p>(<code>integer</code>) The number of samples to generate response curves.
If it is too small, the response curves might be biased.
The default value is <code>1000</code>.</p>
</td></tr>
<tr><td><code id="independent_response_+3A_visualize">visualize</code></td>
<td>
<p>(<code>logical</code>) if <code>TRUE</code>, plot the response curves.
The default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The values show how each environmental variable independently
affects the modeling prediction. They show how the predicted result
only using this variable changes as it is varied.
</p>


<h3>Value</h3>

<p>(<code>IndependentResponse</code>) A list of
</p>

<ul>
<li><p>responses_cont (<code>list</code>) A list of response values of continuous
variables
</p>
</li>
<li><p>responses_cat (<code>list</code>) A list of response values of categorical
variables
</p>
</li></ul>



<h3>References</h3>


<ul>
<li><p>Elith, Jane,
et al. &quot;The evaluation strip: a new and robust method for plotting predicted
responses from species distribution models.&quot; <em>Ecological modelling</em>
186.3 (2005): 280-289.<a href="https://doi.org/10.1016/j.ecolmodel.2004.12.007">doi:10.1016/j.ecolmodel.2004.12.007</a>
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+plot.IndependentResponse">plot.IndependentResponse</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)

data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12, 16))

# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 10,
  sample_size = 0.8, ndim = 2L,
  seed = 123L, nthreads = 1,
  response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

independent_responses &lt;- independent_response(
  model = mod$model,
  var_occ = mod$vars_train,
  variables = mod$variables)
plot(independent_responses)

</code></pre>

<hr>
<h2 id='isotree_po'>Build Isolation forest species distribution model and explain the
the model and outputs.</h2><span id='topic+isotree_po'></span>

<h3>Description</h3>

<p>Call Isolation forest and its variations to do
species distribution modeling and optionally call a collection of other
functions to do model explanation.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>isotree_po(
  obs_mode = "imperfect_presence",
  obs,
  obs_ind_eval = NULL,
  variables,
  categ_vars = NULL,
  contamination = 0.1,
  ntrees = 100L,
  sample_size = 1,
  ndim = 1L,
  seed = 10L,
  ...,
  offset = 0,
  response = TRUE,
  spatial_response = TRUE,
  check_variable = TRUE,
  visualize = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="isotree_po_+3A_obs_mode">obs_mode</code></td>
<td>
<p>(<code>string</code>) The mode of observations for training. It should
be one of <code>c("perfect_presence", "imperfect_presence", "presence_absence")</code>.
&quot;perfect_presence&quot; means presence-only occurrences without
errors/uncertainties/bias, which should be rare in reality.
&quot;Imperfect_presence&quot; means presence-only occurrences with
errors/uncertainties/bias, which should be a most common case.
&quot;presence_absence&quot; means presence-absence observations regardless quality.
See details to learn how to set it. The default is &quot;imperfect_presence&quot;.</p>
</td></tr>
<tr><td><code id="isotree_po_+3A_obs">obs</code></td>
<td>
<p>(<code>sf</code>) The <code>sf</code> of observation for training. It is recommended to
call function <code><a href="#topic+format_observation">format_observation</a></code> to format the
occurrence (<code>obs</code>) before passing it here.
Otherwise, make sure there is a column named &quot;observation&quot; for observation.</p>
</td></tr>
<tr><td><code id="isotree_po_+3A_obs_ind_eval">obs_ind_eval</code></td>
<td>
<p>(<code>sf</code> or <code>NULL</code>) Optional <code>sf</code> of observations for
independent test. It is recommended to call function
<code><a href="#topic+format_observation">format_observation</a></code> to format the occurrence (<code>obs</code>)
before passing it here. Otherwise, make sure there is a column named
&quot;observation&quot; for observation.
If <code>NULL</code>, no independent test set will be used. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="isotree_po_+3A_variables">variables</code></td>
<td>
<p>(<code>RasterStack</code> or <code>stars</code>) The stack of environmental variables.</p>
</td></tr>
<tr><td><code id="isotree_po_+3A_categ_vars">categ_vars</code></td>
<td>
<p>(<code>vector</code> of <code>character</code> or <code>NULL</code>) The names of categorical
variables. Must be the same as the names in <code>variables</code>.</p>
</td></tr>
<tr><td><code id="isotree_po_+3A_contamination">contamination</code></td>
<td>
<p>(<code>numeric</code>) The percentage of abnormal cases within a
dataset. Because <code>iForest</code> is an outlier detection algorithm. It picks up
abnormal cases (much fewer) from normal cases. This argument is used to set
how many abnormal cases should be there if the users have the power to control.
See details for how to set it. The value should be less than 0.5. Here we
constrain it in (0, 0.3]. The default value is 0.1.</p>
</td></tr>
<tr><td><code id="isotree_po_+3A_ntrees">ntrees</code></td>
<td>
<p>(<code>integer</code>) The number of trees for the isolation forest. It must
be integer, which you could use function <code><a href="base.html#topic+as.integer">as.integer</a></code> to convert to.
The default is <code>100L</code>.</p>
</td></tr>
<tr><td><code id="isotree_po_+3A_sample_size">sample_size</code></td>
<td>
<p>(<code>numeric</code>) It should be a rate for sampling size in <code style="white-space: pre;">&#8288;[0, 1]&#8288;</code>.
The default is <code>1.0</code>.</p>
</td></tr>
<tr><td><code id="isotree_po_+3A_ndim">ndim</code></td>
<td>
<p>(<code>integer</code>) ExtensionLevel for isolation forest. It must
be integer, which you could use function <code><a href="base.html#topic+as.integer">as.integer</a></code> to convert
to. Also, it must be no smaller than the dimension of environmental variables.
When it is 1, the model is a traditional isolation forest, otherwise the model
is an extended isolation forest. The default is 1.</p>
</td></tr>
<tr><td><code id="isotree_po_+3A_seed">seed</code></td>
<td>
<p>(<code>integer</code>) The random seed used in the modeling. It should be an
integer. The default is <code>10L</code>.</p>
</td></tr>
<tr><td><code id="isotree_po_+3A_...">...</code></td>
<td>
<p>Other arguments that <code>isolation.forest</code> needs.</p>
</td></tr>
<tr><td><code id="isotree_po_+3A_offset">offset</code></td>
<td>
<p>(<code>numeric</code>) The offset to adjust fitted suitability. The default
is zero. Highly recommend to leave it as default.</p>
</td></tr>
<tr><td><code id="isotree_po_+3A_response">response</code></td>
<td>
<p>(<code>logical</code>) If <code>TRUE</code>, generate response curves.
The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="isotree_po_+3A_spatial_response">spatial_response</code></td>
<td>
<p>(<code>logical</code>) If <code>TRUE</code>, generate spatial response maps.
The default is <code>TRUE</code> because it might be slow. NOTE that here SHAP-based map
is not generated because it is slow. If you want it be mapped, you could call
function <code><a href="#topic+spatial_response">spatial_response</a></code> to make it.</p>
</td></tr>
<tr><td><code id="isotree_po_+3A_check_variable">check_variable</code></td>
<td>
<p>(<code>logical</code>) If <code>TRUE</code>, check the variable importance.
The default is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="isotree_po_+3A_visualize">visualize</code></td>
<td>
<p>(<code>logical</code>) If <code>TRUE</code>, generate the essential figures
related to the model. The default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For &quot;perfect_presence&quot;, a user-defined number (<code>contamination</code>) of samples
will be taken from background to let <code>iForest</code> function normally.
</p>
<p>If &quot;imperfect_presence&quot;, no further actions is required.
</p>
<p>If the <b>obs_mode</b> is &quot;presence_absence&quot;, a <code>contamination</code> percent
of absences will be randomly selected and work together with all presences
to train the model.
</p>
<p>NOTE: <b>obs_mode</b> and <b>mode</b> only works for <code>obs</code>. <code>obs_ind_eval</code>
will follow its own structure.
</p>
<p>Please read details of algorithm <code>isolation.forest</code> on
<a href="https://github.com/david-cortes/isotree">https://github.com/david-cortes/isotree</a>, and
the R documentation of function <code>isolation.forest</code>.
</p>


<h3>Value</h3>

<p>(<code>POIsotree</code>) A list of
</p>

<ul>
<li><p>model (<code>isolation.forest</code>) The threshold set in
function inputs
</p>
</li>
<li><p>variables (<code>stars</code>) The formatted image stack of
environmental variables
</p>
</li>
<li><p>observation (<code><a href="sf.html#topic+sf">sf</a></code>) A <code><a href="sf.html#topic+sf">sf</a></code> of training occurrence
dataset
</p>
</li>
<li><p>background_samples (<code><a href="sf.html#topic+sf">sf</a></code>) A <code><a href="sf.html#topic+sf">sf</a></code> of background points
for training dataset evaluation or SHAP dependence plot
</p>
</li>
<li><p>independent_test (<code><a href="sf.html#topic+sf">sf</a></code> or <code>NULL</code>) A <code><a href="sf.html#topic+sf">sf</a></code> of test
occurrence dataset
</p>
</li>
<li><p>background_samples_test (<code><a href="sf.html#topic+sf">sf</a></code> or <code>NULL</code>) A <code><a href="sf.html#topic+sf">sf</a></code> of
background points for test dataset evaluation or SHAP dependence plot
</p>
</li>
<li><p>vars_train (<code><a href="base.html#topic+data.frame">data.frame</a></code>) A <code><a href="base.html#topic+data.frame">data.frame</a></code> with values of each
environmental variables for training occurrence
</p>
</li>
<li><p>pred_train (<code><a href="base.html#topic+data.frame">data.frame</a></code>) A <code><a href="base.html#topic+data.frame">data.frame</a></code> with values of
prediction for training occurrence
</p>
</li>
<li><p>eval_train (<code>POEvaluation</code>) A list of presence-only evaluation metrics
based on training dataset. See details of <code>POEvaluation</code> in
<code><a href="#topic+evaluate_po">evaluate_po</a></code>
</p>
</li>
<li><p>var_test (<code><a href="base.html#topic+data.frame">data.frame</a></code> or <code>NULL</code>) A <code><a href="base.html#topic+data.frame">data.frame</a></code> with values of each
environmental variables for test occurrence
</p>
</li>
<li><p>pred_test (<code><a href="base.html#topic+data.frame">data.frame</a></code> or <code>NULL</code>) A <code><a href="base.html#topic+data.frame">data.frame</a></code> with values of
prediction for test occurrence
</p>
</li>
<li><p>eval_test (<code>POEvaluation</code> or <code>NULL</code>) A list of presence-only evaluation metrics
based on test dataset.
See details of <code>POEvaluation</code> in <code><a href="#topic+evaluate_po">evaluate_po</a></code>
</p>
</li>
<li><p>prediction (<code>stars</code>) The predicted environmental suitability
</p>
</li>
<li><p>marginal_responses (<code>MarginalResponse</code> or <code>NULL</code>) A list of marginal response
values of each environmental variables.
See details in <code><a href="#topic+marginal_response">marginal_response</a></code>
</p>
</li>
<li><p>offset (<code>numeric</code>) The offset value set as inputs.
</p>
</li>
<li><p>independent_responses (<code>IndependentResponse</code> or <code>NULL</code>) A list of independent
response values of each environmental variables.
See details in <code><a href="#topic+independent_response">independent_response</a></code>
</p>
</li>
<li><p>shap_dependences (<code>ShapDependence</code> or <code>NULL</code>) A list of variable
dependence values of each environmental variables.
See details in <code><a href="#topic+shap_dependence">shap_dependence</a></code>
</p>
</li>
<li><p>spatial_responses (<code>SpatialResponse</code> or <code>NULL</code>) A list of spatial variable
dependence values of each environmental variables.
See details in <code><a href="#topic+shap_dependence">shap_dependence</a></code>
</p>
</li>
<li><p>variable_analysis (<code>VariableAnalysis</code> or <code>NULL</code>) A list of variable importance
analysis based on multiple metrics.
See details in <code><a href="#topic+variable_analysis">variable_analysis</a></code></p>
</li></ul>



<h3>References</h3>


<ul>
<li><p>Liu, Fei
Tony, Kai Ming Ting, and Zhi-Hua Zhou. &quot;Isolation forest.&quot;
<em>2008 eighth ieee international conference on data mining</em>.IEEE, 2008.
<a href="https://doi.org/10.1109/ICDM.2008.17">doi:10.1109/ICDM.2008.17</a>
</p>
</li>
<li><p>Liu, Fei Tony, Kai Ming
Ting, and Zhi-Hua Zhou. &quot;Isolation-based anomaly detection.&quot;
<em>ACM Transactions on Knowledge Discovery from Data (TKDD)</em> 6.1 (2012): 1-39.
<a href="https://doi.org/10.1145/2133360.2133363">doi:10.1145/2133360.2133363</a>
</p>
</li>
<li><p>Liu, Fei Tony,
Kai Ming Ting, and Zhi-Hua Zhou. &quot;On detecting clustered anomalies using
SCiForest.&quot; <em>Joint European Conference on Machine Learning and
Knowledge Discovery in Databases</em>. Springer, Berlin, Heidelberg, 2010.
<a href="https://doi.org/10.1007/978-3-642-15883-4_18">doi:10.1007/978-3-642-15883-4_18</a>
</p>
</li>
<li><p>Ha
riri, Sahand, Matias Carrasco Kind, and Robert J. Brunner. &quot;Extended
isolation forest.&quot; <em>IEEE Transactions on Knowledge and Data Engineering (2019)</em>.
<a href="https://doi.org/10.1109/TKDE.2019.2947676">doi:10.1109/TKDE.2019.2947676</a>
</p>
</li>
<li><p><a href="https://github.com/david-cortes/isotree">https://github.com/david-cortes/isotree</a>
</p>
</li>
<li><p>References of related feature such as response curves and variable importance
will be listed under their own functions
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+evaluate_po">evaluate_po</a></code>, <code><a href="#topic+marginal_response">marginal_response</a></code>,
<code><a href="#topic+independent_response">independent_response</a></code>, <code><a href="#topic+shap_dependence">shap_dependence</a></code>,
<code><a href="#topic+spatial_response">spatial_response</a></code>, <code><a href="#topic+variable_analysis">variable_analysis</a></code>,
<code>isolation.forest</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
########### Presence-absence mode #################
library(dplyr)
library(sf)
library(stars)
library(itsdm)

# Load example dataset
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"
obs_type &lt;- "presence_absence"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = obs_type)

# Load variables
env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12))

# Modeling
mod_virtual_species &lt;- isotree_po(
  obs_mode = "presence_absence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 10,
  sample_size = 0.6, ndim = 1L,
  seed = 123L, nthreads = 1)

# Check results
## Evaluation based on training dataset
print(mod_virtual_species$eval_train)
plot(mod_virtual_species$eval_train)

## Response curves
plot(mod_virtual_species$marginal_responses)
plot(mod_virtual_species$independent_responses,
     target_var = c('bio1', 'bio5'))
plot(mod_virtual_species$shap_dependence)

## Relationships between target var and related var
plot(mod_virtual_species$shap_dependence,
     target_var = c('bio1', 'bio5'),
     related_var = 'bio12', smooth_span = 0)

# Variable importance
mod_virtual_species$variable_analysis
plot(mod_virtual_species$variable_analysis)

########### Presence-absence mode ##################
# Load example dataset
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")

# Modeling with perfect_presence mode
mod_perfect_pres &lt;- isotree_po(
  obs_mode = "perfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 10,
  sample_size = 0.6, ndim = 1L,
  seed = 123L, nthreads = 1)

# Modeling with imperfect_presence mode
mod_imperfect_pres &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 10,
  sample_size = 0.6, ndim = 1L,
  seed = 123L, nthreads = 1)


</code></pre>

<hr>
<h2 id='itsdm-package'>Isolation forest-based presence-only species distribution modeling</h2><span id='topic+itsdm-package'></span><span id='topic+itsdm'></span>

<h3>Description</h3>

<p>This package is a wrapper for a few packages including <code>isotree</code>, <code>outliertree</code>, <code>fastshap</code>, etc. It does purely presence-only species distribution modeling with isolation forest and variations such as SCiForest and EIF. It also provides functions to make response curves, analyze variable importance, analyze variable dependence and analyze variable contribution. As utilities, the package includes a few functions to download bioclimatic variables including worldclim version 2.0 and CMCC-BioClimInd. There are also functions to detect outliers in the occurrence dataset to do data cleaning.
</p>


<h3>Details</h3>

<p>This package provides multiple features.
</p>

<ol>
<li><p>Download bioclimatic variables and reduce their dimensions.
This includes historic and future climatic indicators from two sources:
</p>

<ul>
<li><p><a href="https://www.worldclim.org">worldclim</a>
</p>
</li>
<li><p><a href="https://doi.pangaea.de/10.1594/PANGAEA.904278?format=html">CMCC-BioClimInd</a>
</p>
</li></ul>

</li>
<li><p>Detect suspicous environmental outliers.
</p>
</li>
<li><p>Fit a isolation forest-based SDM.
</p>
</li>
<li><p>Make presence-only evaluation.
</p>
</li>
<li><p>Generate response curves of environmental variables including marginal and
independent responses and analyze interactions between environmental variables.
</p>
</li>
<li><p>Analyze variable importance using Shapley values.
</p>
</li>
<li><p>Convert predicted environmental suitability to presence-absence map.
</p>
</li>
<li><p>Analyze variable contributions to any specific observations.
</p>
</li></ol>



<h3>Author(s)</h3>

<p>Lei Song <a href="mailto:lsong@clarku.edu">lsong@clarku.edu</a>
</p>
<p>Maintainer: Lei Song <a href="mailto:lsong@clarku.edu">lsong@clarku.edu</a>
</p>


<h3>References</h3>

<p>Please check references in R documentation of each specific function.
</p>

<hr>
<h2 id='mainland_africa'>Boundary of mainland Africa</h2><span id='topic+mainland_africa'></span>

<h3>Description</h3>

<p>The overall continental boundary of mainland Africa queried from
<code>rnaturalearth</code> and get processed.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>mainland_africa
</code></pre>


<h3>Format</h3>

<p>A <code><a href="sf.html#topic+sf">sf</a></code> with one rows and 2 fields
</p>

<dl>
<dt>name</dt><dd><p>(<code>character</code>) The name of the polygon: Africa</p>
</dd>
<dt>area</dt><dd><p>(<code><a href="base.html#topic+units">units</a></code>) The united number of the overall area in
km2. This is not a consensus area, but just a calculated area under this
resolution.</p>
</dd>
<dt>geometry</dt><dd><p>(<code><a href="sf.html#topic+sfc">sfc</a></code>) The simple polygon feature of the
boundary</p>
</dd></dl>



<h3>Source</h3>

<p><code>rnaturalearth</code>
</p>

<hr>
<h2 id='marginal_response'>Calculate marginal responses of each variables.</h2><span id='topic+marginal_response'></span>

<h3>Description</h3>

<p>Calculate the marginal responses of each variables within the model.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>marginal_response(model, var_occ, variables, si = 1000, visualize = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="marginal_response_+3A_model">model</code></td>
<td>
<p>(Any predictive model). In this package, it is <code>isolation_forest</code>.
It could be the item <code>model</code> of <code>POIsotree</code> made by function <code><a href="#topic+isotree_po">isotree_po</a></code>.</p>
</td></tr>
<tr><td><code id="marginal_response_+3A_var_occ">var_occ</code></td>
<td>
<p>(<code>data.frame</code>, <code>tibble</code>) The <code>data.frame</code> style table that
include values of environmental variables at occurrence locations.</p>
</td></tr>
<tr><td><code id="marginal_response_+3A_variables">variables</code></td>
<td>
<p>(<code>stars</code>) The <code>stars</code> of environmental variables. It should have
multiple <code>attributes</code> instead of <code>dims</code>. If you have <code>raster</code> object instead, you
could use <code>st_as_stars</code> to convert it to <code>stars</code> or use
<code>read_stars</code> directly read source data as a <code>stars</code>. You also could
use item <code>variables</code> of <code>POIsotree</code> made by function <code><a href="#topic+isotree_po">isotree_po</a></code>.</p>
</td></tr>
<tr><td><code id="marginal_response_+3A_si">si</code></td>
<td>
<p>(<code>integer</code>) The number of samples to generate response curves.
If it is too small, the response curves might be biased.
The default value is <code>1000</code>.</p>
</td></tr>
<tr><td><code id="marginal_response_+3A_visualize">visualize</code></td>
<td>
<p>(<code>logical</code>) if <code>TRUE</code>, plot the response curves.
The default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The values show how each environmental variable affects the modeling
prediction. They show how the predicted result changes as each environmental
variable is varied while keeping all other environmental variables at average
sample value. They might be hard to interpret if there are strongly correlated
variables. The users could use <code><a href="#topic+dim_reduce">dim_reduce</a></code> function to remove
the strong correlation from original environmental variable stack.
</p>


<h3>Value</h3>

<p>(<code>MarginalResponse</code>) A nested list of
</p>

<ul>
<li><p>responses_cont (<code>list</code>) A list of response values of continuous variables
</p>
</li>
<li><p>responses_cat (<code>list</code>) A list of response values of categorical variables
</p>
</li></ul>



<h3>References</h3>


<ul>
<li><p>Elith, Jane,
et al. &quot;The evaluation strip: a new and robust method for plotting predicted
responses from species distribution models.&quot; <em>Ecological modelling</em>
186.3 (2005): 280-289.<a href="https://doi.org/10.1016/j.ecolmodel.2004.12.007">doi:10.1016/j.ecolmodel.2004.12.007</a>
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+plot.MarginalResponse">plot.MarginalResponse</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)

# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12, 16))

# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 10,
  sample_size = 0.8, ndim = 2L,
  seed = 123L, nthreads = 1,
  response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

marginal_responses &lt;- marginal_response(
  model = mod$model,
  var_occ = mod$vars_train,
  variables = mod$variables)
plot(marginal_responses)
#'
</code></pre>

<hr>
<h2 id='occ_virtual_species'>Occurrence dataset of a virtual species</h2><span id='topic+occ_virtual_species'></span>

<h3>Description</h3>

<p>A pseudo presence-absence occurrence dataset of a virtual species made
by package <code>virtualspecies</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>occ_virtual_species
</code></pre>


<h3>Format</h3>

<p>A <code>data.frame</code> with 300 rows and 2 fields
</p>

<dl>
<dt>x</dt><dd><p>(<code>numeric</code>) The x coordinates of the records in
WGS84 geographic coordinate system</p>
</dd>
<dt>y</dt><dd><p>(<code>numeric</code>) The y coordinates of the records in
WGS84 geographic coordinate system</p>
</dd>
<dt>observation</dt><dd><p>(<code>numeric</code>) The observations of presence and absence.</p>
</dd>
<dt>usage</dt><dd><p>(<code>character</code>) The usage of the occurrences, either be &quot;train&quot;
as training set, or &quot;eval&quot; as test set.</p>
</dd></dl>



<h3>Details</h3>

<p>The environmental niche of the virtual species is made by defining its
response functions to annual temperature and annual precipitation
in mainland Africa.
The response function of annual temperature is normal distribution with
mean = 22 and standard deviation = 5.
The response function of annual precipitation is normal distribution with
mean = 1000 and standard deviation = 200.
Then the suitability is convert to presence-absence map by logistic
conversion with beta = 0.7, alpha = -0.05, and species prevalence = 0.27.
Finally 500 presence-absence points are sampled across the whole region.
Then these points were randomly split into train (0.7) and test set (0.3).
</p>


<h3>Source</h3>

<p><code>virtualspecies</code>
</p>

<hr>
<h2 id='plot.EnviChange'>Display the figure and map of the <code>EnviChange</code> object.</h2><span id='topic+plot.EnviChange'></span>

<h3>Description</h3>

<p>Show the response curve and the map of contribution change from
<code><a href="#topic+detect_envi_change">detect_envi_change</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'EnviChange'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.EnviChange_+3A_x">x</code></td>
<td>
<p>(<code>EnviChange</code>) A <code>EnviChange</code> object to be messaged.
It could be the return of function <code><a href="#topic+detect_envi_change">detect_envi_change</a></code>.</p>
</td></tr>
<tr><td><code id="plot.EnviChange_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The same object that was passed as input.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+detect_envi_change">detect_envi_change</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)
#'
# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"
#'
# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")
#'
env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12))
#'
# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 10,
  sample_size = 0.8, ndim = 1L,
  seed = 123L, response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

# Use a fixed value
bio1_changes &lt;- detect_envi_change(
  model = mod$model,
  var_occ = mod$vars_train,
  variables = mod$variables,
  shap_nsim = 1,
  target_var = "bio1",
  var_future = 5)

plot(bio1_changes)


</code></pre>

<hr>
<h2 id='plot.EnvironmentalOutlier'>Exhibit suspicious outliers in an observation dataset.</h2><span id='topic+plot.EnvironmentalOutlier'></span>

<h3>Description</h3>

<p>Display observations and potential outliers diagnosed by
function <code><a href="#topic+suspicious_env_outliers">suspicious_env_outliers</a></code> in a dataset.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'EnvironmentalOutlier'
plot(x, overlay_raster = NULL, pts_alpha = 0.5, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.EnvironmentalOutlier_+3A_x">x</code></td>
<td>
<p>(<code>EnvironmentalOutlier</code>) The PAConversion object to plot.
It could be the return of function <code><a href="#topic+suspicious_env_outliers">suspicious_env_outliers</a></code>.</p>
</td></tr>
<tr><td><code id="plot.EnvironmentalOutlier_+3A_overlay_raster">overlay_raster</code></td>
<td>
<p>(<code>RasterLayer</code> or <code>stars</code>) The environmental raster to plot
together with points.</p>
</td></tr>
<tr><td><code id="plot.EnvironmentalOutlier_+3A_pts_alpha">pts_alpha</code></td>
<td>
<p>(<code>numeric</code>) The <code>alpha</code> used by <code><a href="ggplot2.html#topic+geom_sf">geom_sf</a></code> to show points.</p>
</td></tr>
<tr><td><code id="plot.EnvironmentalOutlier_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>ggplot2</code> figure of outliers distribution among all observations.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+suspicious_env_outliers">suspicious_env_outliers</a></code>, <code><a href="#topic+print.EnvironmentalOutlier">print.EnvironmentalOutlier</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(sf)
library(stars)
library(itsdm)

data("occ_virtual_species")
env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12, 16))

occ_outliers &lt;- suspicious_env_outliers(
  occ = occ_virtual_species, variables = env_vars,
  z_outlier = 3.5, outliers_print = 4L)

plot(occ_outliers)
plot(occ_outliers,
  overlay_raster = env_vars %&gt;% slice('band', 1))


</code></pre>

<hr>
<h2 id='plot.IndependentResponse'>Show independent response curves.</h2><span id='topic+plot.IndependentResponse'></span>

<h3>Description</h3>

<p>Plot independent response curves using ggplot2 by optionally
set target variable(s).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'IndependentResponse'
plot(x, target_var = NA, smooth_span = 0.3, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.IndependentResponse_+3A_x">x</code></td>
<td>
<p>(<code>IndependentResponse</code>) The independent response curve object to plot.
It could be the return of function <code><a href="#topic+independent_response">independent_response</a></code>.</p>
</td></tr>
<tr><td><code id="plot.IndependentResponse_+3A_target_var">target_var</code></td>
<td>
<p>(<code>vector</code> of <code>character</code>) The target variable to plot. It could be
<code>NA</code>. If it is <code>NA</code>, all variables will be plotted.</p>
</td></tr>
<tr><td><code id="plot.IndependentResponse_+3A_smooth_span">smooth_span</code></td>
<td>
<p>(<code>numeric</code>) The span value for smooth fit in <code>ggplot2</code>.
When it is <code>0</code>, no smooth applied. The default is <code>0.3</code>.</p>
</td></tr>
<tr><td><code id="plot.IndependentResponse_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>ggplot2</code> figure of response curves
</p>


<h3>See Also</h3>

<p><code><a href="#topic+independent_response">independent_response</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)

# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12, 16))

# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 20,
  sample_size = 0.8, ndim = 2L,
  seed = 123L, response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

independent_responses &lt;- independent_response(
  model = mod$model,
  var_occ = mod$vars_train,
  variables = mod$variables)
plot(independent_responses)


</code></pre>

<hr>
<h2 id='plot.MarginalResponse'>Show marginal response curves.</h2><span id='topic+plot.MarginalResponse'></span>

<h3>Description</h3>

<p>Plot marginal response curves using ggplot2 by optionally set
target variable(s).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'MarginalResponse'
plot(x, target_var = NA, smooth_span = 0.3, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.MarginalResponse_+3A_x">x</code></td>
<td>
<p>(<code>MarginalResponse</code>) The marginal response curve object to plot.
It could be the return of function <code><a href="#topic+marginal_response">marginal_response</a></code>.</p>
</td></tr>
<tr><td><code id="plot.MarginalResponse_+3A_target_var">target_var</code></td>
<td>
<p>(<code>vector</code> of <code>character</code>) The target variable to plot. It could be
<code>NA</code>. If it is <code>NA</code>, all variables will be plotted.</p>
</td></tr>
<tr><td><code id="plot.MarginalResponse_+3A_smooth_span">smooth_span</code></td>
<td>
<p>(<code>numeric</code>) The span value for smooth fit in <code>ggplot2</code>.
When it is <code>0</code>, no smooth applied. The default is <code>0.3</code>.</p>
</td></tr>
<tr><td><code id="plot.MarginalResponse_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>ggplot2</code> figure of response curves
</p>


<h3>See Also</h3>

<p><code><a href="#topic+marginal_response">marginal_response</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)

# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12, 16))

# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 20,
  sample_size = 0.8, ndim = 2L,
  seed = 123L, response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

marginal_responses &lt;- marginal_response(
  model = mod$model,
  var_occ = mod$vars_train,
  variables = mod$variables)
plot(marginal_responses, target_var = 'bio1')


</code></pre>

<hr>
<h2 id='plot.PAConversion'>Display results of conversion to presence-absence (PA).</h2><span id='topic+plot.PAConversion'></span>

<h3>Description</h3>

<p>Display raster of suitability, probability of occurrence,
presence-absence binary map from presence-absence (PA) conversion.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'PAConversion'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.PAConversion_+3A_x">x</code></td>
<td>
<p>(<code>PAConversion</code>) The <code>PAConversion</code> object to plot.
It could be the return of function <code><a href="#topic+convert_to_pa">convert_to_pa</a></code>.</p>
</td></tr>
<tr><td><code id="plot.PAConversion_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>patchwork</code> of <code>ggplot2</code> figure of suitability, probability of occurrence,
presence-absence binary map.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+convert_to_pa">convert_to_pa</a></code>, <code><a href="#topic+print.PAConversion">print.PAConversion</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)

# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12, 16))

# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 20,
  sample_size = 0.8, ndim = 2L,
  seed = 123L, response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

# Threshold conversion
pa_thred &lt;- convert_to_pa(mod$prediction,
  method = 'threshold', beta = 0.5)
plot(pa_thred)


</code></pre>

<hr>
<h2 id='plot.POEvaluation'>Show model evaluation.</h2><span id='topic+plot.POEvaluation'></span>

<h3>Description</h3>

<p>Display informative and detailed figures of continuous Boyce
index, AUC curves, and TSS curve.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'POEvaluation'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.POEvaluation_+3A_x">x</code></td>
<td>
<p>(<code>POEvaluation</code>) The presence-only evaluation object to plot.
It could be the return of function <code><a href="#topic+evaluate_po">evaluate_po</a></code>.</p>
</td></tr>
<tr><td><code id="plot.POEvaluation_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>patchwork</code> of <code>ggplot2</code> figure of AUC_ratio, AUC_background and CBI.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+evaluate_po">evaluate_po</a></code>, <code><a href="#topic+print.POEvaluation">print.POEvaluation</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)

# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12, 16))

# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 20,
  sample_size = 0.8, ndim = 2L,
  seed = 123L, response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

eval_train &lt;- evaluate_po(
  mod$model,
  occ_pred = mod$pred_train$prediction,
  var_pred = na.omit(as.vector(mod$prediction[[1]])))

plot(eval_train)


</code></pre>

<hr>
<h2 id='plot.ShapDependence'>Show variable dependence plots and variable interaction plots
obtained from Shapley values.</h2><span id='topic+plot.ShapDependence'></span>

<h3>Description</h3>

<p>Plot Shapley value-based variable dependence curves using
ggplot2 by optionally selecting target variable(s). It also can plot the
interaction between a related variable to the selected variable(s).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ShapDependence'
plot(
  x,
  target_var = NA,
  related_var = NA,
  sample_prop = 0.3,
  sample_bin = 100,
  smooth_line = TRUE,
  seed = 123,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.ShapDependence_+3A_x">x</code></td>
<td>
<p>(<code>ShapDependence</code>) The variable dependence object to plot.
It could be the return of function <code><a href="#topic+shap_dependence">shap_dependence</a></code>.</p>
</td></tr>
<tr><td><code id="plot.ShapDependence_+3A_target_var">target_var</code></td>
<td>
<p>(<code>vector</code> of <code>character</code>) The target variable to plot. It could be
<code>NA</code>. If it is <code>NA</code>, all variables will be plotted.</p>
</td></tr>
<tr><td><code id="plot.ShapDependence_+3A_related_var">related_var</code></td>
<td>
<p>(<code>character</code>) The dependent variable to plot together with
target variables. It could be <code>NA</code>. If it is <code>NA</code>, no related variable will be
plotted.</p>
</td></tr>
<tr><td><code id="plot.ShapDependence_+3A_sample_prop">sample_prop</code></td>
<td>
<p>(<code>numeric</code>) The proportion of points to sample for plotting.
It will be ignored if the number of points is less than 1000.
The default is <code>0.3</code>.</p>
</td></tr>
<tr><td><code id="plot.ShapDependence_+3A_sample_bin">sample_bin</code></td>
<td>
<p>(<code>integer</code>) The number of bins to use for stratified sampling.</p>
</td></tr>
<tr><td><code id="plot.ShapDependence_+3A_smooth_line">smooth_line</code></td>
<td>
<p>(<code>logical</code>) Whether to fit the smooth line or not.
It will be ignored if the number of points is less than 1000.
The default is 100.</p>
</td></tr>
<tr><td><code id="plot.ShapDependence_+3A_seed">seed</code></td>
<td>
<p>(<code>integer</code>) The seed for sampling.
It will be ignored if the number of points is less than 1000.
The default is 123.</p>
</td></tr>
<tr><td><code id="plot.ShapDependence_+3A_...">...</code></td>
<td>
<p>Other arguments passed on to <code><a href="ggplot2.html#topic+geom_smooth">geom_smooth</a></code>. Mainly
<code>method</code> and <code>formula</code> to fit the smooth line. Note that the same arguments
will be used for all target variables. User could set variable one by one to
set the arguments separately.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>If the number of samples is more than 1000, a stratified sampling is used to
thin the sample pool, and then plot its subset. The user could set a proportion
to sample and a number of bins for stratified sampling.
</p>


<h3>Value</h3>

<p><code>ggplot2</code> figure of dependent curves
</p>


<h3>See Also</h3>

<p><code><a href="#topic+shap_dependence">shap_dependence</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)

# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12, 16))

# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 20,
  sample_size = 0.8, ndim = 2L,
  seed = 123L, response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

var_dependence &lt;- shap_dependence(
  model = mod$model,
  var_occ = mod$vars_train,
  variables = mod$variables)
plot(var_dependence, target_var = 'bio1', related_var = 'bio12')


</code></pre>

<hr>
<h2 id='plot.SHAPSpatial'>Display Shapley values-based spatial variable dependence maps.</h2><span id='topic+plot.SHAPSpatial'></span>

<h3>Description</h3>

<p>Plot Shapley values-based spatial variable dependence maps
using ggplot2 by optionally setting target variable(s). This only works for
<code>SHAPSpatial</code> even though it is part of <code>SpatialResponse</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'SHAPSpatial'
plot(x, target_var = NA, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.SHAPSpatial_+3A_x">x</code></td>
<td>
<p>(<code>SHAPSpatial</code>) The spatial variable dependence object to plot.
It could be the return of function <code><a href="#topic+shap_spatial_response">shap_spatial_response</a></code>.</p>
</td></tr>
<tr><td><code id="plot.SHAPSpatial_+3A_target_var">target_var</code></td>
<td>
<p>(<code>vector</code> of <code>character</code>) The target variable to plot.
It could be <code>NA</code>. If it is <code>NA</code>, all variables will be plotted.</p>
</td></tr>
<tr><td><code id="plot.SHAPSpatial_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>ggplot2</code> figure of dependent maps
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spatial_response">spatial_response</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)

# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12))

# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 20,
  sample_size = 0.8, ndim = 2L,
  seed = 123L, response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

shap_spatial &lt;- shap_spatial_response(
 model = mod$model,
 target_vars = c("bio1", "bio12"),
 var_occ = mod$vars_train,
 variables = mod$variables,
 shap_nsim = 1)

plot(shap_spatial)
plot(shap_spatial, target_var = "bio1")


</code></pre>

<hr>
<h2 id='plot.SpatialResponse'>Display spatial variable dependence maps.</h2><span id='topic+plot.SpatialResponse'></span>

<h3>Description</h3>

<p>Plot spatial variable dependence maps using ggplot2 by
optionally setting target variable(s).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'SpatialResponse'
plot(x, target_var = NA, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.SpatialResponse_+3A_x">x</code></td>
<td>
<p>(<code>SpatialResponse</code>) The spatial variable dependence object to plot.
It could be the return of function <code><a href="#topic+spatial_response">spatial_response</a></code>.</p>
</td></tr>
<tr><td><code id="plot.SpatialResponse_+3A_target_var">target_var</code></td>
<td>
<p>(<code>vector</code> of <code>character</code>) The target variable to plot.
It could be <code>NA</code>. If it is <code>NA</code>, all variables will be plotted.</p>
</td></tr>
<tr><td><code id="plot.SpatialResponse_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>ggplot2</code> figure of dependent maps
</p>


<h3>See Also</h3>

<p><code><a href="#topic+spatial_response">spatial_response</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)

# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12, 16))

# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 20,
  sample_size = 0.8, ndim = 2L,
  seed = 123L, response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

spatial_responses &lt;- spatial_response(
  model = mod$model,
  var_occ = mod$vars_train,
  variables = mod$variables,
  shap_nsim = 10)
plot(spatial_responses)
plot(spatial_responses, target_var = 'bio1')


</code></pre>

<hr>
<h2 id='plot.VariableAnalysis'>Display variable importance.</h2><span id='topic+plot.VariableAnalysis'></span>

<h3>Description</h3>

<p>Display informative and detailed figures of variable importance.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'VariableAnalysis'
plot(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.VariableAnalysis_+3A_x">x</code></td>
<td>
<p>(<code>VariableAnalysis</code>) The variable importance object to plot.
It could be the return of function <code><a href="#topic+variable_analysis">variable_analysis</a></code>.</p>
</td></tr>
<tr><td><code id="plot.VariableAnalysis_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A <code>patchwork</code> of <code>ggplot2</code> figure of variable importance
according to multiple metrics.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+variable_analysis">variable_analysis</a></code>, <code><a href="#topic+print.VariableAnalysis">print.VariableAnalysis</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)

# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12, 16))

# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 20,
  sample_size = 0.8, ndim = 2L,
  seed = 123L, response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

var_analysis &lt;- variable_analysis(
  model = mod$model,
  pts_occ = mod$observation,
  pts_occ_test = mod$independent_test,
  variables = mod$variables)
plot(var_analysis)


</code></pre>

<hr>
<h2 id='plot.VariableContribution'>Exhibit variable contribution for target observations.</h2><span id='topic+plot.VariableContribution'></span>

<h3>Description</h3>

<p>Use ggplot2 to plot variable contribution for each target
observation separately or summarize the overall variable contribution across
all selected observations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'VariableContribution'
plot(x, plot_each_obs = FALSE, num_features = 5, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="plot.VariableContribution_+3A_x">x</code></td>
<td>
<p>(<code>VariableContribution</code>) The <code>VariableContribution</code> object to plot.
It could be the return of function <code><a href="#topic+variable_contrib">variable_contrib</a></code>.</p>
</td></tr>
<tr><td><code id="plot.VariableContribution_+3A_plot_each_obs">plot_each_obs</code></td>
<td>
<p>(<code>logical</code>) The option of plot type. If <code>TRUE</code>, it will
plot variable contribution for every observation. Otherwise, it will plot
variable contribution violin plot for all observations.</p>
</td></tr>
<tr><td><code id="plot.VariableContribution_+3A_num_features">num_features</code></td>
<td>
<p>(<code>integer</code>) A number of most important features to plot.
Just work if plot_each_obs is <code>TRUE</code>.</p>
</td></tr>
<tr><td><code id="plot.VariableContribution_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p><code>ggplot2</code> figure of Variable Contribution.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+variable_contrib">variable_contrib</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)

# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12, 16))

# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 20,
  sample_size = 0.8, ndim = 2L,
  seed = 123L, response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

var_contribution &lt;- variable_contrib(
  model = mod$model,
  var_occ = mod$vars_train,
  var_occ_analysis = mod$vars_train %&gt;% slice(1:10))

# Plot variable contribution to each observation
plot(var_contribution,
     plot_each_obs = TRUE,
     num_features = 3)

# Plot the summarized contribution
plot(var_contribution)


</code></pre>

<hr>
<h2 id='print.EnviChange'>Print summary information from <code>EnviChange</code> object.</h2><span id='topic+print.EnviChange'></span>

<h3>Description</h3>

<p>Display the detected tipping points and percentage of affected
areas due to a changing variable from function
<code><a href="#topic+detect_envi_change">detect_envi_change</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'EnviChange'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.EnviChange_+3A_x">x</code></td>
<td>
<p>(<code>EnviChange</code>) A <code>EnviChange</code> object to be messaged.
It could be the return of function <code><a href="#topic+detect_envi_change">detect_envi_change</a></code>.</p>
</td></tr>
<tr><td><code id="print.EnviChange_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The same object that was passed as input.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+detect_envi_change">detect_envi_change</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)
#'
# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"
#'
# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")
#'
env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12))
#'
# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 10,
  sample_size = 0.8, ndim = 1L,
  seed = 123L, response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

# Use a fixed value
bio1_changes &lt;- detect_envi_change(
  model = mod$model,
  var_occ = mod$vars_train,
  variables = mod$variables,
  shap_nsim = 1,
  target_var = "bio1",
  var_future = 5)

print(bio1_changes)


</code></pre>

<hr>
<h2 id='print.EnvironmentalOutlier'>Print summary information from <code>EnvironmentalOutlier</code> object.</h2><span id='topic+print.EnvironmentalOutlier'></span>

<h3>Description</h3>

<p>Display the environmental variable values comparing to the mean
values of the detected environmental outliers in observations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'EnvironmentalOutlier'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.EnvironmentalOutlier_+3A_x">x</code></td>
<td>
<p>(<code>EnvironmentalOutlier</code>) A <code>EnvironmentalOutlier</code> object to be messaged.
It could be the return of function <code><a href="#topic+suspicious_env_outliers">suspicious_env_outliers</a></code>.</p>
</td></tr>
<tr><td><code id="print.EnvironmentalOutlier_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The same object that was passed as input.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+suspicious_env_outliers">suspicious_env_outliers</a></code>, <code><a href="#topic+plot.EnvironmentalOutlier">plot.EnvironmentalOutlier</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(sf)
library(stars)
library(itsdm)

data("occ_virtual_species")
env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12, 16))

occ_outliers &lt;- suspicious_env_outliers(
  occ = occ_virtual_species, variables = env_vars,
  z_outlier = 5, outliers_print = 4L)

print(occ_outliers)


</code></pre>

<hr>
<h2 id='print.FormatOccurrence'>Print summary information from <code>FormatOccurrence</code> object.</h2><span id='topic+print.FormatOccurrence'></span>

<h3>Description</h3>

<p>Display the type and number of training and evaluation dataset
in the formatted observations obtained by
function <code><a href="#topic+format_observation">format_observation</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'FormatOccurrence'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.FormatOccurrence_+3A_x">x</code></td>
<td>
<p>(<code>FormatOccurrence</code>) A <code>FormatOccurrence</code> object to be messaged.
It could be the return of function <code><a href="#topic+format_observation">format_observation</a></code>.</p>
</td></tr>
<tr><td><code id="print.FormatOccurrence_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The same object that was passed as input.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+format_observation">format_observation</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(dplyr)
library(itsdm)
data("occ_virtual_species")

# obs + eval, presence-absence
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"
obs_type &lt;- "presence_absence"

obs_formatted &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = obs_type)

print(obs_formatted)


</code></pre>

<hr>
<h2 id='print.PAConversion'>Print summary information from <code>PAConversion</code> object.</h2><span id='topic+print.PAConversion'></span>

<h3>Description</h3>

<p>Display the equation and parameters of a <code>PAConversion</code> object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'PAConversion'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.PAConversion_+3A_x">x</code></td>
<td>
<p>(<code>PAConversion</code>) A PAConversion object to be messaged.
It could be the return of function <code><a href="#topic+convert_to_pa">convert_to_pa</a></code>.</p>
</td></tr>
<tr><td><code id="print.PAConversion_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The same object that was passed as input.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+convert_to_pa">convert_to_pa</a></code>, <code><a href="#topic+plot.PAConversion">plot.PAConversion</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)

# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12, 16))

# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 20,
  sample_size = 0.8, ndim = 2L,
  seed = 123L, response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

# Threshold conversion
pa_thred &lt;- convert_to_pa(mod$prediction, method = 'threshold', beta = 0.5)
print(pa_thred)


</code></pre>

<hr>
<h2 id='print.POEvaluation'>Print summary information from model evaluation object (<code>POEvaluation</code>).</h2><span id='topic+print.POEvaluation'></span>

<h3>Description</h3>

<p>Display the most general and informative characteristics of
a model evaluation object.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'POEvaluation'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.POEvaluation_+3A_x">x</code></td>
<td>
<p>(<code>POEvaluation</code>) A presence-only evaluation object to be messaged.
It could be the return of function <code><a href="#topic+evaluate_po">evaluate_po</a></code>.</p>
</td></tr>
<tr><td><code id="print.POEvaluation_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The same object that was passed as input.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+evaluate_po">evaluate_po</a></code>, <code><a href="#topic+plot.POEvaluation">plot.POEvaluation</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)

# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12, 16))

# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 20,
  sample_size = 0.8, ndim = 2L,
  seed = 123L, response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

eval_train &lt;- evaluate_po(mod$model,
  occ_pred = mod$pred_train$prediction,
  var_pred = na.omit(as.vector(mod$prediction[[1]])))

print(eval_train)


</code></pre>

<hr>
<h2 id='print.POIsotree'>Print summary information from <code>POIsotree</code> object.</h2><span id='topic+print.POIsotree'></span>

<h3>Description</h3>

<p>Display the most general and informative characteristics of
a fitted POIsotree object. It includes the model information,
model evaluation, variable analysis, etc.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'POIsotree'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.POIsotree_+3A_x">x</code></td>
<td>
<p>(<code>POIsotree</code>) The POIsotree object to be messaged.
It could be the return of function <code><a href="#topic+isotree_po">isotree_po</a></code>.</p>
</td></tr>
<tr><td><code id="print.POIsotree_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The same object that was passed as input.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+isotree_po">isotree_po</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)

# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12, 16))

# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 20,
  sample_size = 0.8, ndim = 2L,
  seed = 123L, response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)
print(mod)


</code></pre>

<hr>
<h2 id='print.ReducedImageStack'>Print summary information from <code>ReducedImageStack</code> object.</h2><span id='topic+print.ReducedImageStack'></span>

<h3>Description</h3>

<p>Display the most general and informative characteristics of
a ReducedImageStack object, including the set threshold, original variables,
and the selected variables and the correlations between them.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'ReducedImageStack'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.ReducedImageStack_+3A_x">x</code></td>
<td>
<p>(<code>ReducedImageStack</code>) A <code>ReducedImageStack</code> object to be messaged.
It could be the return of function <code><a href="#topic+dim_reduce">dim_reduce</a></code>.</p>
</td></tr>
<tr><td><code id="print.ReducedImageStack_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The same object that was passed as input.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+dim_reduce">dim_reduce</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
library(itsdm)
library(dplyr)
library(stars)
env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars()

img_reduced &lt;- dim_reduce(env_vars, threshold = 0.7,
  preferred_vars = c('bio1', 'bio12'))

print(img_reduced)


</code></pre>

<hr>
<h2 id='print.VariableAnalysis'>Print summary information from variable importance object
(<code>VariableAnalysis</code>).</h2><span id='topic+print.VariableAnalysis'></span>

<h3>Description</h3>

<p>Display non-visualized information of a <code>VariableAnalysis</code>
object returned by function <code><a href="#topic+variable_analysis">variable_analysis</a></code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'VariableAnalysis'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.VariableAnalysis_+3A_x">x</code></td>
<td>
<p>(<code>VariableAnalysis</code>) A variable importance object to be messaged.
It could be the return of function <code><a href="#topic+variable_analysis">variable_analysis</a></code>.</p>
</td></tr>
<tr><td><code id="print.VariableAnalysis_+3A_...">...</code></td>
<td>
<p>Not used.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For Jackknife test, if the value is positive, print as &quot;/&quot;.
If the value is negative, then print as &quot;\&quot;. For Shapley values based test,
print as &quot;#&quot; since there is no negative value and in order to distinguish
this characteristic with Jackknife test.
</p>


<h3>Value</h3>

<p>The same object that was passed as input.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+variable_analysis">variable_analysis</a></code>, <code><a href="#topic+plot.VariableAnalysis">plot.VariableAnalysis</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)

# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12, 16))

# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 20,
  sample_size = 0.8, ndim = 2L,
  seed = 123L, response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

var_analysis &lt;- variable_analysis(
  model = mod$model,
  pts_occ = mod$observation,
  pts_occ_test = mod$independent_test,
  variables = mod$variables)

print(var_analysis)


</code></pre>

<hr>
<h2 id='probability'>Estimate suitability on <code>stars</code> object using trained <code>isolation.forest</code> model.</h2><span id='topic+probability'></span>

<h3>Description</h3>

<p>Apply an <code>isolation.forest</code> model on a stars object to calculate
environmental suitability and do quantile stretch to <code style="white-space: pre;">&#8288;[0, 1]&#8288;</code>.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>probability(x, vars, offset = 0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="probability_+3A_x">x</code></td>
<td>
<p>(<code>isolation_forest</code>). It could
be the item <code>model</code> of <code>POIsotree</code> made by function <code><a href="#topic+isotree_po">isotree_po</a></code>.</p>
</td></tr>
<tr><td><code id="probability_+3A_vars">vars</code></td>
<td>
<p>(<code>stars</code>) The stack of environmental variables. More specifically,
make sure it has x and y dimensions only, and distribute variables to
attributes of this <code>stars</code>. Otherwise, the function would stop.</p>
</td></tr>
<tr><td><code id="probability_+3A_offset">offset</code></td>
<td>
<p>(<code>numeric</code>) The offset to adjust fitted suitability. The default
is zero. Highly recommend to leave it as default.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a <code>stars</code> of predicted habitat suitability
</p>


<h3>See Also</h3>

<p><code><a href="#topic+isotree_po">isotree_po</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)

# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 16))

# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 10,
  sample_size = 0.8, ndim = 2L,
  seed = 123L, nthreads = 1,
  response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

suit &lt;- probability(mod$model, mod$variables)

## End(Not run)

</code></pre>

<hr>
<h2 id='shap_dependence'>Calculate Shapley value-based variable dependence.</h2><span id='topic+shap_dependence'></span>

<h3>Description</h3>

<p>Calculate how a species responses to environmental variables
using Shapley values.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>shap_dependence(
  model,
  var_occ,
  variables,
  si = 1000,
  shap_nsim = 100,
  visualize = FALSE,
  seed = 10,
  pfun = .pfun_shap
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="shap_dependence_+3A_model">model</code></td>
<td>
<p>(<code>isolation_forest</code> or other model). The SDM.
It could be the item <code>model</code> of <code>POIsotree</code> made by function <code><a href="#topic+isotree_po">isotree_po</a></code>.
It also could be other user-fitted models as long as the <code>pfun</code> can work on it.</p>
</td></tr>
<tr><td><code id="shap_dependence_+3A_var_occ">var_occ</code></td>
<td>
<p>(<code>data.frame</code>, <code>tibble</code>) The <code>data.frame</code> style table that
include values of environmental variables at occurrence locations.</p>
</td></tr>
<tr><td><code id="shap_dependence_+3A_variables">variables</code></td>
<td>
<p>(<code>stars</code>) The <code>stars</code> of environmental variables.
It should have multiple <code>attributes</code> instead of <code>dims</code>.
If you have <code>raster</code> object instead, you
could use <code>st_as_stars</code> to convert it to <code>stars</code> or use
<code>read_stars</code> directly read source data as a <code>stars</code>.
You also could use item <code>variables</code> of <code>POIsotree</code> made by function
<code><a href="#topic+isotree_po">isotree_po</a></code>.</p>
</td></tr>
<tr><td><code id="shap_dependence_+3A_si">si</code></td>
<td>
<p>(<code>integer</code>) The number of samples to generate response curves.
If it is too small, the response curves might be biased.
The default value is <code>1000</code>.</p>
</td></tr>
<tr><td><code id="shap_dependence_+3A_shap_nsim">shap_nsim</code></td>
<td>
<p>(<code>integer</code>) The number of Monte Carlo repetitions in SHAP
method to use for estimating each Shapley value. When the number of variables
is large, a smaller shap_nsim could be used. See details in documentation of
function <code><a href="dplyr.html#topic+explain">explain</a></code> in package <code>fastshap</code>.
The default is 100.</p>
</td></tr>
<tr><td><code id="shap_dependence_+3A_visualize">visualize</code></td>
<td>
<p>(<code>logical</code>) if <code>TRUE</code>, plot the variable dependence plots.
The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="shap_dependence_+3A_seed">seed</code></td>
<td>
<p>(<code>integer</code>) The seed for any random progress. The default is <code>10</code>.</p>
</td></tr>
<tr><td><code id="shap_dependence_+3A_pfun">pfun</code></td>
<td>
<p>(<code>function</code>) The predict function that requires two arguments,
<code>object</code> and <code>newdata</code>.
It is only required when <code>model</code> is not <code>isolation_forest</code>.
The default is the wrapper function designed for iForest model in <code>itsdm</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The values show how each environmental variable independently
affects the modeling prediction. They show how the Shapley value of each variable
changes as its value is varied.
</p>


<h3>Value</h3>

<p>(<code>ShapDependence</code>) A list of
</p>

<ul>
<li><p>dependences_cont (<code>list</code>) A list of Shapley values of continuous variables
</p>
</li>
<li><p>dependences_cat (<code>list</code>) A list of Shapley values of categorical variables
</p>
</li>
<li><p>feature_values (<code>data.frame</code>) A table of feature values
</p>
</li></ul>



<h3>References</h3>


<ul>
<li><p>Strumbelj, Erik,
and Igor Kononenko. &quot;Explaining prediction models and individual predictions
with feature contributions.&quot; <em>Knowledge and information systems</em>
41.3 (2014): 647-665.<a href="https://doi.org/10.1007/s10115-013-0679-x">doi:10.1007/s10115-013-0679-x</a>
</p>
</li>
<li><p><a href="http://proceedings.mlr.press/v119/sundararajan20b.html">Sundara
rajan, Mukund, and Amir Najmi. &quot;The many Shapley values for model explanation
.&quot; <em>International Conference on Machine Learning</em>. PMLR, 2020.</a>
</p>
</li>
<li><p><a href="https://github.com/bgreenwell/fastshap">https://github.com/bgreenwell/fastshap</a>
</p>
</li>
<li><p><a href="https://github.com/slundberg/shap">https://github.com/slundberg/shap</a>
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+plot.ShapDependence">plot.ShapDependence</a></code>
<code><a href="dplyr.html#topic+explain">explain</a></code> in <code>fastshap</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)

data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12, 16))

# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 10,
  sample_size = 0.8, ndim = 2L,
  seed = 123L, nthreads = 1,
  response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

var_dependence &lt;- shap_dependence(
  model = mod$model,
  var_occ = mod$vars_train,
  variables = mod$variables)
plot(var_dependence, target_var = "bio1", related_var = "bio16")


## Not run: 
##### Use Random Forest model as an external model ########
library(randomForest)
# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;%
  filter(usage == "train")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12)) %&gt;%
  split()

model_data &lt;- stars::st_extract(
  env_vars, at = as.matrix(obs_df %&gt;% select(x, y))) %&gt;%
  as.data.frame()
names(model_data) &lt;- names(env_vars)
model_data &lt;- model_data %&gt;%
  mutate(occ = obs_df[['observation']])
model_data$occ &lt;- as.factor(model_data$occ)

mod_rf &lt;- randomForest(
  occ ~ .,
  data = model_data,
  ntree = 200)

pfun &lt;- function(X.model, newdata) {
  # for data.frame
  predict(X.model, newdata, type = "prob")[, "1"]
}

shap_dependences &lt;- shap_dependence(
  model = mod_rf,
  var_occ = model_data %&gt;% select(-occ),
  variables = env_vars,
  visualize = FALSE,
  seed = 10,
  pfun = pfun)

## End(Not run)

</code></pre>

<hr>
<h2 id='shap_spatial_response'>Calculate shapley values-based spatial response.</h2><span id='topic+shap_spatial_response'></span>

<h3>Description</h3>

<p>Calculate spatially SHAP-based response figures.
They can help to diagnose both how and where the species
responses to environmental variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>shap_spatial_response(
  model,
  var_occ,
  variables,
  target_vars = NULL,
  shap_nsim = 10,
  seed = 10,
  pfun = .pfun_shap
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="shap_spatial_response_+3A_model">model</code></td>
<td>
<p>(<code>isolation_forest</code> or other model). It could
be the item <code>model</code> of <code>POIsotree</code> made by function <code><a href="#topic+isotree_po">isotree_po</a></code>.
It also could be other user-fitted models as long as the <code>pfun</code> can work on it.</p>
</td></tr>
<tr><td><code id="shap_spatial_response_+3A_var_occ">var_occ</code></td>
<td>
<p>(<code>data.frame</code>, <code>tibble</code>) The <code>data.frame</code> style table that
include values of environmental variables at occurrence locations.</p>
</td></tr>
<tr><td><code id="shap_spatial_response_+3A_variables">variables</code></td>
<td>
<p>(<code>stars</code>) The <code>stars</code> of environmental variables.
It should have multiple <code>attributes</code> instead of <code>dims</code>.
If you have <code>raster</code> object instead, you
could use <code>st_as_stars</code> to convert it to <code>stars</code> or use
<code>read_stars</code> directly read source data as a <code>stars</code>.
You also could use item <code>variables</code> of <code>POIsotree</code> made by function
<code><a href="#topic+isotree_po">isotree_po</a></code>.</p>
</td></tr>
<tr><td><code id="shap_spatial_response_+3A_target_vars">target_vars</code></td>
<td>
<p>(a <code>vector</code> of <code>character</code>) The selected variables to
process. If it is <code>NULL</code>, all variables will be used.</p>
</td></tr>
<tr><td><code id="shap_spatial_response_+3A_shap_nsim">shap_nsim</code></td>
<td>
<p>(<code>integer</code>) The number of Monte Carlo repetitions in SHAP
method to use for estimating each Shapley value. See details in documentation
of function <code><a href="dplyr.html#topic+explain">explain</a></code> in package <code>fastshap</code>.
When the number of variables is large, a smaller shap_nsim could be used.
Be cautious that making SHAP-based spatial dependence will be slow
because of Monte-Carlo computation for all pixels.
But it is worth the time because it is much more
informative. See details in documentation of function <code><a href="dplyr.html#topic+explain">explain</a></code>
in package <code>fastshap</code>. The default is 10. Usually a value 10 - 20 is enough.</p>
</td></tr>
<tr><td><code id="shap_spatial_response_+3A_seed">seed</code></td>
<td>
<p>(<code>integer</code>) The seed for any random progress. The default is <code>10L</code>.</p>
</td></tr>
<tr><td><code id="shap_spatial_response_+3A_pfun">pfun</code></td>
<td>
<p>(<code>function</code>) The predict function that requires two arguments,
<code>object</code> and <code>newdata</code>.
It is only required when <code>model</code> is not <code>isolation_forest</code>.
The default is the wrapper function designed for iForest model in <code>itsdm</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The values show how each environmental variable affects the modeling
prediction in space. These maps could help to answer questions of where in
terms of environmental response.
</p>


<h3>Value</h3>

<p>(<code>SHAPSpatial</code>) A list of
</p>

<p>A list of <code>stars</code> object of spatially SHAP-based response of all variables

</p>


<h3>See Also</h3>

<p><code><a href="#topic+spatial_response">spatial_response</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)

# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12))

# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 10,
  sample_size = 0.8, ndim = 2L,
  seed = 123L, nthreads = 1,
  response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

shap_spatial &lt;- shap_spatial_response(
  model = mod$model,
  var_occ = mod$vars_train,
  variables = mod$variables,
  shap_nsim = 1)

shap_spatial &lt;- shap_spatial_response(
 model = mod$model,
 target_vars = c("bio1", "bio12"),
 var_occ = mod$vars_train,
 variables = mod$variables,
 shap_nsim = 1)

## Not run: 
##### Use Random Forest model as an external model ########
library(randomForest)

# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;%
  filter(usage == "train")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12)) %&gt;%
  split()

model_data &lt;- stars::st_extract(
  env_vars, at = as.matrix(obs_df %&gt;% select(x, y))) %&gt;%
  as.data.frame()
names(model_data) &lt;- names(env_vars)
model_data &lt;- model_data %&gt;%
  mutate(occ = obs_df[['observation']])
model_data$occ &lt;- as.factor(model_data$occ)

mod_rf &lt;- randomForest(
  occ ~ .,
  data = model_data,
  ntree = 200)

pfun &lt;- function(X.model, newdata) {
  # for data.frame
  predict(X.model, newdata, type = "prob")[, "1"]
}

shap_spatial &lt;- shap_spatial_response(
  model = mod_rf,
  target_vars = c("bio1", "bio12"),
  var_occ = model_data %&gt;% select(-occ),
  variables = env_vars,
  shap_nsim = 10,
  pfun = pfun)

## End(Not run)

</code></pre>

<hr>
<h2 id='spatial_response'>Calculate spatial response or dependence figures.</h2><span id='topic+spatial_response'></span>

<h3>Description</h3>

<p>Calculate spatially marginal, independence, and SHAP-based
response figures. They can help to diagnose both how and where the species
responses to environmental variables.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>spatial_response(
  model,
  var_occ,
  variables,
  shap_nsim = 0,
  seed = 10L,
  visualize = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="spatial_response_+3A_model">model</code></td>
<td>
<p>(<code>isolation_forest</code>). It could
be the item <code>model</code> of <code>POIsotree</code> made by function <code><a href="#topic+isotree_po">isotree_po</a></code>.</p>
</td></tr>
<tr><td><code id="spatial_response_+3A_var_occ">var_occ</code></td>
<td>
<p>(<code>data.frame</code>, <code>tibble</code>) The <code>data.frame</code> style table that
include values of environmental variables at occurrence locations.</p>
</td></tr>
<tr><td><code id="spatial_response_+3A_variables">variables</code></td>
<td>
<p>(<code>stars</code>) The <code>stars</code> of environmental variables.
It should have multiple <code>attributes</code> instead of <code>dims</code>.
If you have <code>raster</code> object instead, you
could use <code>st_as_stars</code> to convert it to <code>stars</code> or use
<code>read_stars</code> directly read source data as a <code>stars</code>.
You also could use item <code>variables</code> of <code>POIsotree</code> made by function
<code><a href="#topic+isotree_po">isotree_po</a></code>.</p>
</td></tr>
<tr><td><code id="spatial_response_+3A_shap_nsim">shap_nsim</code></td>
<td>
<p>(<code>integer</code>) The number of Monte Carlo repetitions in SHAP
method to use for estimating each Shapley value. See details in documentation
of function <code><a href="dplyr.html#topic+explain">explain</a></code> in package <code>fastshap</code>. Set it to 0 if you
don't want to make SHAP-based spatial dependence. When the number of variables
is large, a smaller shap_nsim could be used. Be cautious that making
SHAP-based spatial dependence will be slow because of Monte-Carlo
computation for all pixels. But it is worth the time because it is much more
informative. See details in documentation of function <code><a href="dplyr.html#topic+explain">explain</a></code>
in package <code>fastshap</code>. The default is 0. Usually a value 10 - 20 is enough.</p>
</td></tr>
<tr><td><code id="spatial_response_+3A_seed">seed</code></td>
<td>
<p>(<code>integer</code>) The seed for any random progress. The default is <code>10L</code>.</p>
</td></tr>
<tr><td><code id="spatial_response_+3A_visualize">visualize</code></td>
<td>
<p>(<code>logical</code>) if <code>TRUE</code>, plot the response curves.
The default is <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The values show how each environmental variable affects the modeling
prediction in space. These maps could help to answer questions of where in
terms of environmental response. Compared to marginal dependence or
independent dependence maps, SHAP-based maps are way more informative because
SHAP-based dependence explain the contribution of each variable to final result.
</p>


<h3>Value</h3>

<p>(<code>SpatialResponse</code>) A list of
</p>

<ul>
<li><p>spatial_marginal_response (<code>list</code>) A list of <code>stars</code> object of spatially
marginal response of all variables
</p>
</li>
<li><p>spatial_independent_response (<code>list</code>) A list of <code>stars</code> object of spatially
independent response of all variables
</p>
</li>
<li><p>spatial_shap_dependence (<code>list</code>) A list of <code>stars</code> object of spatially
SHAP-based response of all variables
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+plot.SpatialResponse">plot.SpatialResponse</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'># Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)

# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12))

# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 20,
  sample_size = 0.8, ndim = 1L,
  seed = 123L, nthreads = 1,
  response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

spatial_responses &lt;- spatial_response(
  model = mod$model,
  var_occ = mod$vars_train,
  variables = mod$variables,
  shap_nsim = 1)
plot(spatial_responses)
#'
</code></pre>

<hr>
<h2 id='suspicious_env_outliers'>Function to detect suspicious outliers based on environmental variables.</h2><span id='topic+suspicious_env_outliers'></span>

<h3>Description</h3>

<p>Run <code>outlier.tree</code> to detect suspicious outliers in observations.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>suspicious_env_outliers(
  occ,
  occ_crs = 4326,
  variables,
  rm_outliers = FALSE,
  seed = 10L,
  ...,
  visualize = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="suspicious_env_outliers_+3A_occ">occ</code></td>
<td>
<p>(<code>data.frame</code>, <code>sf</code>, <code>SpatialPointsDataFrame</code>)
The occurrence dataset for training.
There must be column <code>x</code> and <code>y</code> for coordinates if it is a regular <code>data.frame</code>.</p>
</td></tr>
<tr><td><code id="suspicious_env_outliers_+3A_occ_crs">occ_crs</code></td>
<td>
<p>(<code>numeric</code> or <code>crs</code>) The EPSG number or
<code>crs</code> object of occurrence CRS.
The default value is <code>4326</code>, which is the geographic coordinate system.</p>
</td></tr>
<tr><td><code id="suspicious_env_outliers_+3A_variables">variables</code></td>
<td>
<p>(<code>RasterStack</code> or <code>stars</code>) The stack of environmental variables.</p>
</td></tr>
<tr><td><code id="suspicious_env_outliers_+3A_rm_outliers">rm_outliers</code></td>
<td>
<p>(<code>logical</code>) The option to remove the suspicious outliers or not.
The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="suspicious_env_outliers_+3A_seed">seed</code></td>
<td>
<p>(<code>integer</code>) The random seed used in the modeling. It should be an
integer. The default is <code>10L</code>.</p>
</td></tr>
<tr><td><code id="suspicious_env_outliers_+3A_...">...</code></td>
<td>
<p>Other arguments passed to function <code>outlier.tree</code> in
package <code>outliertree</code>.</p>
</td></tr>
<tr><td><code id="suspicious_env_outliers_+3A_visualize">visualize</code></td>
<td>
<p>(<code>logical</code>) If <code>TRUE</code>, plot the result.
The default is <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Please check more details in R documentation of function
<code>outlier.tree</code> in package <code>outliertree</code> and their GitHub.
</p>


<h3>Value</h3>

<p>(<code>EnvironmentalOutlier</code>) A list that contains
</p>

<ul>
<li><p>outliers (<code><a href="sf.html#topic+sf">sf</a></code>) The <code><a href="sf.html#topic+sf">sf</a></code> points of outliers
</p>
</li>
<li><p>outlier_details (<code>tibble</code>) A table of outlier details returned from
function <code>outlier.tree</code> in package <code>outliertree</code>
</p>
</li>
<li><p>pts_occ (<code><a href="sf.html#topic+sf">sf</a></code>) The <code><a href="sf.html#topic+sf">sf</a></code> points of occurrence.
If <code>rm_outliers</code> is <code>TRUE</code>, outliers are deleted from points of
occurrence. If <code>FALSE</code>, the full observations are returned.</p>
</li></ul>



<h3>References</h3>


<ul>
<li><p><a href="https://arxiv.org/abs/2001.00636">Cortes, David. &quot;Explainable
outlier detection through decision tree conditioning.&quot;
<em>arXiv preprint arXiv:2001.00636</em> (2020).</a>
</p>
</li>
<li><p><a href="https://github.com/david-cortes/outliertree">https://github.com/david-cortes/outliertree</a></p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+print.EnvironmentalOutlier">print.EnvironmentalOutlier</a></code>, <code><a href="#topic+plot.EnvironmentalOutlier">plot.EnvironmentalOutlier</a></code>
<code>outlier.tree</code> in package <code>outliertree</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>library(dplyr)
library(sf)
library(stars)
library(itsdm)

data("occ_virtual_species")
env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12))

occ_outliers &lt;- suspicious_env_outliers(
  occ = occ_virtual_species, variables = env_vars,
  z_outlier = 3.5, outliers_print = 4L, nthreads = 1)

occ_outliers
plot(occ_outliers)

</code></pre>

<hr>
<h2 id='variable_analysis'>Function to evaluate relative importance of each variable.</h2><span id='topic+variable_analysis'></span>

<h3>Description</h3>

<p>Evaluate relative importance of each variable within the model
using the following methods:
</p>

<ul>
<li><p>Jackknife test based on AUC ratio and Pearson correlation between the
result of model using all variables
</p>
</li>
<li><p>SHapley Additive exPlanations (SHAP) according to Shapley values</p>
</li></ul>



<h3>Usage</h3>

<pre><code class='language-R'>variable_analysis(
  model,
  pts_occ,
  pts_occ_test = NULL,
  variables,
  shap_nsim = 100,
  visualize = FALSE,
  seed = 10
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="variable_analysis_+3A_model">model</code></td>
<td>
<p>(<code>isolation_forest</code>) The extended isolation forest SDM. It could be
the item <code>model</code> of <code>POIsotree</code> made by function <code><a href="#topic+isotree_po">isotree_po</a></code>.</p>
</td></tr>
<tr><td><code id="variable_analysis_+3A_pts_occ">pts_occ</code></td>
<td>
<p>(<code>sf</code>) The <code>sf</code> style table that
include training occurrence locations.</p>
</td></tr>
<tr><td><code id="variable_analysis_+3A_pts_occ_test">pts_occ_test</code></td>
<td>
<p>(<code>sf</code>, or <code>NULL</code>) The <code>sf</code> style
table that include occurrence locations of test.
If <code>NULL</code>, it would be set the same as <code>var_occ</code>. The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="variable_analysis_+3A_variables">variables</code></td>
<td>
<p>(<code>stars</code>) The <code>stars</code> of environmental variables. It should have
multiple <code>attributes</code> instead of <code>dims</code>. If you have <code>raster</code> object instead, you
could use <code>st_as_stars</code> to convert it to <code>stars</code> or use
<code>read_stars</code> directly read source data as a <code>stars</code>.</p>
</td></tr>
<tr><td><code id="variable_analysis_+3A_shap_nsim">shap_nsim</code></td>
<td>
<p>(<code>integer</code>) The number of Monte Carlo repetitions in SHAP
method to use for estimating each Shapley value. See details in documentation of
function <code><a href="dplyr.html#topic+explain">explain</a></code> in package <code>fastshap</code>.</p>
</td></tr>
<tr><td><code id="variable_analysis_+3A_visualize">visualize</code></td>
<td>
<p>(<code>logical</code>) If <code>TRUE</code>, plot the analysis figures.
The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="variable_analysis_+3A_seed">seed</code></td>
<td>
<p>(<code>integer</code>) The seed for any random progress. The default is <code>10L</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><b>Jackknife test</b> of variable importance is reflected as the decrease
in a model performance when an environmental variable is used singly or is
excluded from the environmental variable pool. In this function, we used
Pearson correlation and AUC ratio.
</p>
<p><b>Pearson correlation</b> is the correlation between the predictions generated by
different variable importance evaluation methods and the predictions generated
by the full model as the assessment of mode performance.
</p>
<p>The area under the ROC curve (AUC) is a threshold-independent evaluator of
model performance, which needs both presence and absence data. A ROC curve is
generated by plotting the proportion of correctly predicted presence on the
y-axis against 1 minus the proportion of correctly predicted absence on x-axis
for all thresholds. Multiple approaches have been used to evaluate accuracy of
presence-only models. Peterson et al. (2008) modified AUC by plotting the
proportion of correctly predicted presence against the proportion of
presences falling above a range of thresholds against the proportion of
cells of the whole area falling above the range of thresholds. This is the
so called <b>AUC ratio</b> that is used in this package.
</p>
<p><b>SHapley Additive exPlanations (SHAP)</b> uses Shapley values to evaluate the variable importance. The
larger the absolute value of Shapley value, the more important this variable is.
Positive Shapley values mean positive affect, while negative Shapely values mean
negative affect. Please check references for more details if you are interested in.
</p>


<h3>Value</h3>

<p>(<code>VariableAnalysis</code>) A list of
</p>

<ul>
<li><p>variables (<code>vector</code> of <code>character</code>) The names of environmental variables
</p>
</li>
<li><p>pearson_correlation (<code>tibble</code>) A table of Jackknife test based on Pearson correlation
</p>
</li>
<li><p>full_AUC_ratio (<code>tibble</code>) A table of AUC ratio of training and test dataset using all variables,
that act as references for Jackknife test
</p>
</li>
<li><p>AUC_ratio (<code>tibble</code>) A table of Jackknife test based on AUC ratio
</p>
</li>
<li><p>SHAP (<code>tibble</code>) A table of Shapley values of training and test dataset separately
</p>
</li></ul>



<h3>References</h3>


<ul>
<li><p>Peterson,
A. Townsend, Monica PapeÅ, and Jorge SoberÃ³n. &quot;Rethinking receiver operating
characteristic analysis applications in ecological niche modeling.&quot;
<em>Ecological modelling</em> 213.1 (2008): 63-72.<a href="https://doi.org/10.1016/j.ecolmodel.2007.11.008">doi:10.1016/j.ecolmodel.2007.11.008</a>
</p>
</li>
<li><p>Strumbelj, Erik,
and Igor Kononenko. &quot;Explaining prediction models and individual predictions
with feature contributions.&quot; <em>Knowledge and information systems</em>
41.3 (2014): 647-665.<a href="https://doi.org/10.1007/s10115-013-0679-x">doi:10.1007/s10115-013-0679-x</a>
</p>
</li>
<li><p><a href="http://proceedings.mlr.press/v119/sundararajan20b.html">Sundara
rajan, Mukund, and Amir Najmi. &quot;The many Shapley values for model explanation
.&quot; <em>International Conference on Machine Learning</em>. PMLR, 2020.</a>
</p>
</li>
<li><p><a href="https://github.com/bgreenwell/fastshap">https://github.com/bgreenwell/fastshap</a>
</p>
</li>
<li><p><a href="https://github.com/slundberg/shap">https://github.com/slundberg/shap</a>
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+plot.VariableAnalysis">plot.VariableAnalysis</a></code>, <code><a href="#topic+print.VariableAnalysis">print.VariableAnalysis</a></code>
<code><a href="dplyr.html#topic+explain">explain</a></code> in <code>fastshap</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)

data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12, 16))

# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 10,
  sample_size = 0.8, ndim = 2L,
  seed = 123L, nthreads = 1,
  response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

var_analysis &lt;- variable_analysis(
  model = mod$model,
  pts_occ = mod$observation,
  pts_occ_test = mod$independent_test,
  variables = mod$variables)
plot(var_analysis)


</code></pre>

<hr>
<h2 id='variable_contrib'>Evaluate variable contributions for targeted observations.</h2><span id='topic+variable_contrib'></span>

<h3>Description</h3>

<p>Evaluate variable contribution for targeted observations according
to SHapley Additive exPlanations (SHAP).
</p>


<h3>Usage</h3>

<pre><code class='language-R'>variable_contrib(
  model,
  var_occ,
  var_occ_analysis,
  shap_nsim = 100,
  visualize = FALSE,
  seed = 10,
  pfun = .pfun_shap
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="variable_contrib_+3A_model">model</code></td>
<td>
<p>(<code>isolation_forest</code> or other model) The SDM.
It could be the item <code>model</code> of <code>POIsotree</code> made by function <code><a href="#topic+isotree_po">isotree_po</a></code>.
It also could be other user-fitted models as long as the <code>pfun</code> can work on it.</p>
</td></tr>
<tr><td><code id="variable_contrib_+3A_var_occ">var_occ</code></td>
<td>
<p>(<code>data.frame</code>, <code>tibble</code>) The <code>data.frame</code> style table that
include values of environmental variables at occurrence locations.</p>
</td></tr>
<tr><td><code id="variable_contrib_+3A_var_occ_analysis">var_occ_analysis</code></td>
<td>
<p>(<code>data.frame</code>, <code>tibble</code>) The <code>data.frame</code> style table that
include values of environmental variables at occurrence locations for analysis. It
could be either <code>var_occ</code> or its subset, or any new dataset.</p>
</td></tr>
<tr><td><code id="variable_contrib_+3A_shap_nsim">shap_nsim</code></td>
<td>
<p>(<code>integer</code>) The number of Monte Carlo repetitions in SHAP
method to use for estimating each Shapley value. See details in documentation of
function <code><a href="dplyr.html#topic+explain">explain</a></code> in package <code>fastshap</code>.</p>
</td></tr>
<tr><td><code id="variable_contrib_+3A_visualize">visualize</code></td>
<td>
<p>(<code>logical</code>) if <code>TRUE</code>, plot the response curves.
The default is <code>FALSE</code>.</p>
</td></tr>
<tr><td><code id="variable_contrib_+3A_seed">seed</code></td>
<td>
<p>(<code>integer</code>) The seed for any random progress. The default is <code>10L</code>.</p>
</td></tr>
<tr><td><code id="variable_contrib_+3A_pfun">pfun</code></td>
<td>
<p>(<code>function</code>) The predict function that requires two arguments,
<code>object</code> and <code>newdata</code>.
It is only required when <code>model</code> is not <code>isolation_forest</code>.
The default is the wrapper function designed for iForest model in <code>itsdm</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>(<code>VariableContribution</code>) A list of
</p>

<ul>
<li><p>shapley_values (<code>data.frame</code>) A table of Shapley values of each variables for
all observations
</p>
</li>
<li><p>feature_values (<code>tibble</code>) A table of values of each variables for all
observations</p>
</li></ul>



<h3>References</h3>


<ul>
<li><p><a href="https://github.com/bgreenwell/fastshap">https://github.com/
bgreenwell/fastshap</a>
</p>
</li>
<li><p><a href="https://github.com/slundberg/shap">https://github.com/slundberg/shap</a>
</p>
</li></ul>



<h3>See Also</h3>

<p><code><a href="#topic+plot.VariableContribution">plot.VariableContribution</a></code>
<code><a href="dplyr.html#topic+explain">explain</a></code> in <code>fastshap</code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
# Using a pseudo presence-only occurrence dataset of
# virtual species provided in this package
library(dplyr)
library(sf)
library(stars)
library(itsdm)

# Prepare data
data("occ_virtual_species")
obs_df &lt;- occ_virtual_species %&gt;% filter(usage == "train")
eval_df &lt;- occ_virtual_species %&gt;% filter(usage == "eval")
x_col &lt;- "x"
y_col &lt;- "y"
obs_col &lt;- "observation"

# Format the observations
obs_train_eval &lt;- format_observation(
  obs_df = obs_df, eval_df = eval_df,
  x_col = x_col, y_col = y_col, obs_col = obs_col,
  obs_type = "presence_only")

env_vars &lt;- system.file(
  'extdata/bioclim_tanzania_10min.tif',
  package = 'itsdm') %&gt;% read_stars() %&gt;%
  slice('band', c(1, 5, 12))

# With imperfect_presence mode,
mod &lt;- isotree_po(
  obs_mode = "imperfect_presence",
  obs = obs_train_eval$obs,
  obs_ind_eval = obs_train_eval$eval,
  variables = env_vars, ntrees = 5,
  sample_size = 0.8, ndim = 1L,
  seed = 123L, nthreads = 1,
  response = FALSE,
  spatial_response = FALSE,
  check_variable = FALSE)

var_contribution &lt;- variable_contrib(
  model = mod$model,
  var_occ = mod$vars_train,
  var_occ_analysis = mod$vars_train %&gt;% slice(1:2))
## Not run: 
plot(var_contribution,
  num_features = 3,
  plot_each_obs = TRUE)

# Plot together
plot(var_contribution)

## End(Not run)

</code></pre>

<hr>
<h2 id='worldclim2'>Download environmental variables made by worldclim version 2.1.</h2><span id='topic+worldclim2'></span>

<h3>Description</h3>

<p>Parse historic worldclim version 2.1 variables
with a setting of boundary and a few other options.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>worldclim2(
  var = "tmin",
  res = 10,
  bry = NULL,
  path = NULL,
  nm_mark = "clip",
  return_stack = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="worldclim2_+3A_var">var</code></td>
<td>
<p>(<code>character</code>) The option for the variable to download,
should be one of tvag, tmin, tmax, prec, srad, wind, vapr and bio.
The default is 'tmin'.</p>
</td></tr>
<tr><td><code id="worldclim2_+3A_res">res</code></td>
<td>
<p>(<code>numeric</code>) The option for the resolution of image to download.
Should be one of 0.5, 2.5, 5, 10 in minute degree.
The default is 10.</p>
</td></tr>
<tr><td><code id="worldclim2_+3A_bry">bry</code></td>
<td>
<p>(<code><a href="sf.html#topic+sf">sf</a></code> or <code>sp</code>) The boundary to mask the downloaded original data.
If <code>NULL</code>, it would get global map. If not <code>NULL</code>, it can take <code><a href="sf.html#topic+sf">sf</a></code>,
<code><a href="sf.html#topic+sfc">sfc</a></code>, <code>SpatialPolygonsDataFrame</code>, <code>SpatialPolygons</code>, etc.
The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="worldclim2_+3A_path">path</code></td>
<td>
<p>(<code>character</code>) The path to save the downloaded imagery.
If <code>NULL</code>, it would use the current working directory.
The default is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="worldclim2_+3A_nm_mark">nm_mark</code></td>
<td>
<p>(<code>character</code>) the name mark of clipped images.
The default is &quot;clip&quot;. It would be ignored if <code>bry</code> is <code>NULL</code>.</p>
</td></tr>
<tr><td><code id="worldclim2_+3A_return_stack">return_stack</code></td>
<td>
<p>(<code>logical</code>) if <code>TRUE</code>, stack the imagery together and return.
If the area is large and resolution is high, it is better not to stack them.
The default is <code>TRUE</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><a href="https://worldclim.org/data/index.html">Web page page for this dataset</a>
</p>


<h3>Value</h3>

<p>if <code>return_stack</code> is <code>TRUE</code>, the images would be
returned as a <code>stars</code>. Otherwise, nothing to return, but the user
would receive a message of where the images are.
</p>


<h3>Note</h3>

<p>If it fails due to slow internet, try to set a larger timeout option,
e.g., using <code>options(timeout = 1e3)</code>.
</p>


<h3>References</h3>

<p>Fick, Stephen E., and Robert J.
Hijmans. &quot;WorldClim 2: new 1-km spatial resolution climate surfaces for
global land areas.&quot; <em>International journal of climatology</em>
37.12 (2017): 4302-4315.<a href="https://doi.org/10.1002/joc.5086">doi:10.1002/joc.5086</a>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
library(sf)
library(itsdm)

bry &lt;- sf::st_polygon(
  list(rbind(c(29.34, -11.72), c(29.34, -0.95),
             c(40.31, -0.95), c(40.31, -11.72),
             c(29.34, -11.72)))) %&gt;%
  st_sfc(crs = 4326)

bios &lt;- worldclim2(var = "tmin", res = 10,
  bry = bry, nm_mark = 'exp', path = tempdir())

## End(Not run)

</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
