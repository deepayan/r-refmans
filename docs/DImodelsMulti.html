<!DOCTYPE html><html><head><title>Help for package DImodelsMulti</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {DImodelsMulti}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#AICc'><p>AICc</p></a></li>
<li><a href='#BICc'><p>BICc</p></a></li>
<li><a href='#dataBEL'>
<p>The Belgium dataset</p></a></li>
<li><a href='#dataSWE'>
<p>The Sweden dataset</p></a></li>
<li><a href='#DImodelsMulti'><p>Multivariate Diversity-Interactions (DI) Models with Repeated Measures</p></a></li>
<li><a href='#DImulti'><p>DImulti</p></a></li>
<li><a href='#getVarCov.DImulti'><p>getVarCov.DImulti</p></a></li>
<li><a href='#predict.DImulti'><p>predict.DImulti</p></a></li>
<li><a href='#print.DImulti'><p>print.DImulti</p></a></li>
<li><a href='#print.summary.DImulti'><p>print.summary.DImulti</p></a></li>
<li><a href='#simMV'><p>The simulated multivariate &quot;simMV&quot; dataset</p></a></li>
<li><a href='#simMVRM'>
<p>The simulated multivariate repeated measures &quot;simMVRM&quot; dataset</p></a></li>
<li><a href='#simRM'><p>The simulated repeated measures &quot;simRM&quot; dataset</p></a></li>
<li><a href='#summary.DImulti'><p>summary.DImulti</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table>
<tr>
<td>Type:</td>
<td>Package</td>
</tr>
<tr>
<td>Title:</td>
<td>Fit Multivariate Diversity-Interactions Models with Repeated
Measures</td>
</tr>
<tr>
<td>Version:</td>
<td>1.0.1</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Laura Byrne &lt;ByrneL54@tcd.ie&gt;</td>
</tr>
<tr>
<td>Description:</td>
<td>An add-on package to 'DImodels' for the fitting of biodiversity and ecosystem function relationship study data with multiple ecosystem function responses and/or time points. This package uses the multivariate and repeated measures Diversity-Interactions (DI) methods developed by Kirwan et al. (2009) &lt;<a href="https://doi.org/10.1890%2F08-1684.1">doi:10.1890/08-1684.1</a>&gt;, Finn et al. (2013) &lt;<a href="https://doi.org/10.1111%2F1365-2664.12041">doi:10.1111/1365-2664.12041</a>&gt;, and Dooley et al. (2015) &lt;<a href="https://doi.org/10.1111%2Fele.12504">doi:10.1111/ele.12504</a>&gt;.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://dimodels.com">https://dimodels.com</a>,
<a href="https://github.com/DI-LauraByrne/DImodelsMulti">https://github.com/DI-LauraByrne/DImodelsMulti</a>,</td>
</tr>
<tr>
<td>LazyData:</td>
<td>true</td>
</tr>
<tr>
<td>Imports:</td>
<td>DImodels, plyr, dplyr, nlme, stats, reshape2, knitr, Matrix</td>
</tr>
<tr>
<td>Suggests:</td>
<td>cli, fansi, crayon, rmarkdown, ggplot2, MASS, testthat (&ge;
3.0.0)</td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 3.6.0)</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.2.3</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr, rmarkdown</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2024-03-16 01:31:51 UTC; Administrator</td>
</tr>
<tr>
<td>Author:</td>
<td>Laura Byrne <a href="https://orcid.org/0000-0003-2420-4019"><img alt="ORCID iD"src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [aut,
    cre],
  Rishabh Vishwakarma [aut],
  Rafael de Andrade Moral [aut],
  Caroline Brophy [aut]</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2024-03-16 07:10:11 UTC</td>
</tr>
</table>
<hr>
<h2 id='AICc'>AICc</h2><span id='topic+AICc'></span>

<h3>Description</h3>

<p>Calculate Second-order Akaike Information Criterion for a fitted DImulti object
</p>


<h3>Usage</h3>

<pre><code class='language-R'>AICc(model)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="AICc_+3A_model">model</code></td>
<td>
<p>an object of class DImulti</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric value of the AICc value corresponding to the model object
</p>

<hr>
<h2 id='BICc'>BICc</h2><span id='topic+BICc'></span>

<h3>Description</h3>

<p>Calculate Second-order Bayesian Information Criterion for a fitted DImulti obect
</p>


<h3>Usage</h3>

<pre><code class='language-R'>BICc(model)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="BICc_+3A_model">model</code></td>
<td>
<p>an object of class DImulti</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A numeric value of the BICc value corresponding to the model object
</p>

<hr>
<h2 id='dataBEL'>
The Belgium dataset
</h2><span id='topic+dataBEL'></span>

<h3>Description</h3>

<p>Single site dataset containing thirty experimental units (plots), with four species seeded at two density levels, representing fifteen communities. Three ecosystem function responses are recorded
for each plot at a single time point. Data is in a stacked format
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("dataBEL")</code></pre>


<h3>Format</h3>

<p>A data frame with 90 observations on the following 9 variables.
</p>

<dl>
<dt><code>Plot</code></dt><dd><p>a numeric vector indicating the ID of the experimental unit from which the observation was recorded</p>
</dd>
<dt><code>G1</code></dt><dd><p>a numeric vector ranging from 0 to 1, the proportion of the species G1</p>
</dd>
<dt><code>G2</code></dt><dd><p>a numeric vector ranging from 0 to 1, the proportion of the species G2</p>
</dd>
<dt><code>L1</code></dt><dd><p>a numeric vector ranging from 0 to 1, the proportion of the species L1</p>
</dd>
<dt><code>L2</code></dt><dd><p>a numeric vector ranging from 0 to 1, the proportion of the species L2</p>
</dd>
<dt><code>Density</code></dt><dd><p>a vector of factors with two levels, -1 or 1, representing the seeding density of the plot</p>
</dd>
<dt><code>Var</code></dt><dd><p>a character vector indicating the ecosystem function recorded</p>
</dd>
<dt><code>VarNum</code></dt><dd><p>a vector of factors with three levels, 1, 2, or 3 indicating the ecosystem function recorded</p>
</dd>
<dt><code>Y</code></dt><dd><p>a numeric vector indicating the value of the ecosystem function recorded</p>
</dd>
</dl>



<h3>Details</h3>

<p>Data comes from a single site from a wider agrosdiversity experiment conducted in Belgium,
established in 2002. <br />
The four species used were Lolium perenne (G1), Phleum pratense (G2), Trifolium pratense (L1), and
Trifolium repens (L2). There are two recommended functional groupings: grouping grasses (G1, G2) and
legumes (L1, L2), or grouping fast-establishing species (G1, L1) and temporally persistent species
(G2, L2). <br />
Three ecosystem functions were recorded by summing recordings from four harvests over the first year
of the experiment: (1) aboveground biomass of sown species (Sown) (t DM ha-1), (2) aboveground
biomass of weed species (Weed) (t DM ha-1) and (3) the total annual yield of nitrogen in harvested
aboveground biomass (N) (t DM ha-1).
</p>


<h3>Source</h3>

<p>Dooley, A., Isbell, F., Kirwan, L., Connolly, J., Finn, J.A. and Brophy, C., 2015. <br />
Testing the effects of diversity on ecosystem multifunctionality using a multivariate model. <br />
Ecology Letters, 18(11), pp.1242-1251. <br />
</p>
<p>Kirwan, L., Connolly, J., Brophy, C., Baadshaug, O.H., Belanger, G., Black, A., Carnus, T., Collins,
R.P., Cop, J., Delgado, I. and De Vliegher, A., 2014. <br />
The Agrodiversity Experiment: three years of data from a multisite study in intensively managed
grasslands. <br />
</p>


<h3>References</h3>

<p>Dooley, A., Isbell, F., Kirwan, L., Connolly, J., Finn, J.A. and Brophy, C., 2015. <br />
Testing the effects of diversity on ecosystem multifunctionality using a multivariate model. <br />
Ecology Letters, 18(11), pp.1242-1251. <br />
</p>
<p>Kirwan, L., Connolly, J., Brophy, C., Baadshaug, O.H., Belanger, G., Black, A., Carnus, T., Collins,
R.P., Cop, J., Delgado, I. and De Vliegher, A., 2014. <br />
The Agrodiversity Experiment: three years of data from a multisite study in intensively managed
grasslands. <br />
</p>
<p>Finn, J.A., Kirwan, L., Connolly, J., Sebastia, M.T., Helgadottir, A., Baadshaug, O.H.,
Belanger, G., Black, A., Brophy, C., Collins, R.P. and Cop, J., 2013. <br />
Ecosystem function enhanced by combining four functional types of plant species in intensively
managed grassland mixtures: a 3-year continental-scale field experiment.<br />
Journal of Applied Ecology, 50(2), pp.365-375 .<br />
</p>
<p>Kirwan, L., Connolly, J., Finn, J.A., Brophy, C., Luscher, A., Nyfeler, D. and Sebastia, M.T.,
2009. <br />
Diversity-interaction modeling: estimating contributions of species identities and interactions
to ecosystem function. <br />
Ecology, 90(8), pp.2032-2038. <br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>####################################################################################################
####################################################################################################

## Modelling Example

# For a more thorough example of the workflow of this package, please see vignette
# DImulti_workflow using the following code:


vignette("DImulti_workflow")


#
# In this example, we repeat the analysis in Dooley et al. 2015.

head(dataBEL)

# We begin with the main function DImulti(), passing the initial species proportions column names
# through 'prop' and the response value column name through 'y'.
# As the data is in a long or stacked format, we specify the ecosystem function type through the
# first index of the 'eco_func' parameter, along with specifying that we want an unstructured
# Sigma for these response types.
# The experimental unit ID is stored in the column "Plot" and so we pass this to 'unit_IDs'.
# Rather than estimating the nonlinear parameter theta, we opt to provide a value for each
# ecosystem function type through the parameter 'theta', which will be applied to the
# interaction terms as a power. In this case, we use functional group (FG) interactions, which
# requires an additional argument FG to be provided, specifying which group each species present
# in 'prop' belongs to. In this case, we group the grasses and the legumes.
# We include the treatment Density as an additional fixed effect.
# We opt to use the REML estimation method as we will not be doing any model comparisons.
# Finally, we specify the data object, dataBEL, through 'data'.

belModel &lt;- DImulti(prop = c("G1", "G2", "L1", "L2"), y = "Y", eco_func = c("Var", "un"),
                     unit_IDs = "Plot", theta = c(0.5, 1, 1.2), DImodel = "FG",
                     FG = c("Grass", "Grass", "Legume", "Legume"), extra_fixed = ~ Density,
                     method = "REML", data = dataBEL)

# We can now print the output from our model, stored in belModel with class DImulti.

print(belModel)

# We can also retrieve the variance covariance matrix information from this object.

summary(belModel$corr[[1]])
nlme::getVarCov(belModel)


</code></pre>

<hr>
<h2 id='dataSWE'>
The Sweden dataset
</h2><span id='topic+dataSWE'></span>

<h3>Description</h3>

<p>Single site dataset containing 48 experimental units (plots), with four species seeded at two
density levels, representing fifteen communities. One ecosystem function response is recorded for
each plot at a three time points.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("dataSWE")</code></pre>


<h3>Format</h3>

<p>A data frame with 432 observations on the following 9 variables.
</p>

<dl>
<dt><code>YEARN</code></dt><dd><p>a numeric vector indicating the time point (year) that the ecosystem
function recording was measured at</p>
</dd>
<dt><code>PLOT</code></dt><dd><p>a numeric vector indicating the ID of the experimental unit from which the
observation was recorded</p>
</dd>
<dt><code>TREAT</code></dt><dd><p>a vector of factors with three levels, 1, or 2 indicating the treatment
applied to the plot</p>
</dd>
<dt><code>G1</code></dt><dd><p>a numeric vector ranging from 0 to 1, the proportion of the species G1</p>
</dd>
<dt><code>G2</code></dt><dd><p>a numeric vector ranging from 0 to 1, the proportion of the species G2</p>
</dd>
<dt><code>L1</code></dt><dd><p>a numeric vector ranging from 0 to 1, the proportion of the species L1</p>
</dd>
<dt><code>L2</code></dt><dd><p>a numeric vector ranging from 0 to 1, the proportion of the species L2</p>
</dd>
<dt><code>DENS</code></dt><dd><p>a character vector representing the seeding density of the plot (-1 or 1)</p>
</dd>
<dt><code>YIELD</code></dt><dd><p>a numeric vector indicating the value of the harvest recorded</p>
</dd>
</dl>



<h3>Details</h3>

<p>Data comes from a single site from a wider agrosdiversity experiment conducted in Belgium,
established in 2002. <br />
The four species used were Lolium perenne (G1), Phleum pratense (G2), Trifolium pratense (L1), and
Trifolium repens (L2). There are two recommended functional groupings: grouping grasses (G1, G2)
and legumes (L1, L2), or grouping fast-establishing species (G1, L1) and temporally persistent
species (G2, L2). <br />
One ecosystem function (aboveground biomass (t DM ha-1)) was recorded by summing recordings from
four harvests over each year, for three year.
</p>


<h3>Source</h3>

<p>Kirwan, L., Connolly, J., Brophy, C., Baadshaug, O.H., Belanger, G., Black, A., Carnus, T., Collins,
R.P., Cop, J., Delgado, I. and De Vliegher, A., 2014. <br />
The Agrodiversity Experiment: three years of data from a multisite study in intensively managed
grasslands.
</p>


<h3>References</h3>

<p>Dooley, A., Isbell, F., Kirwan, L., Connolly, J., Finn, J.A. and Brophy, C., 2015. <br />
Testing the effects of diversity on ecosystem multifunctionality using a multivariate model. <br />
Ecology Letters, 18(11), pp.1242-1251. <br />
</p>
<p>Kirwan, L., Connolly, J., Brophy, C., Baadshaug, O.H., Belanger, G., Black, A., Carnus, T., Collins,
R.P., Cop, J., Delgado, I. and De Vliegher, A., 2014. <br />
The Agrodiversity Experiment: three years of data from a multisite study in intensively managed
grasslands. <br />
</p>
<p>Finn, J.A., Kirwan, L., Connolly, J., Sebastia, M.T., Helgadottir, A., Baadshaug, O.H.,
Belanger, G., Black, A., Brophy, C., Collins, R.P. and Cop, J., 2013. <br />
Ecosystem function enhanced by combining four functional types of plant species in intensively
managed grassland mixtures: a 3-year continental-scale field experiment.<br />
Journal of Applied Ecology, 50(2), pp.365-375 .<br />
</p>
<p>Kirwan, L., Connolly, J., Finn, J.A., Brophy, C., Luscher, A., Nyfeler, D. and Sebastia, M.T.,
2009. <br />
Diversity-interaction modeling: estimating contributions of species identities and interactions
to ecosystem function. <br />
Ecology, 90(8), pp.2032-2038. <br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>####################################################################################################
####################################################################################################

## Modelling Example

# For a more thorough example of the workflow of this package, please see vignette
# DImulti_workflow using the following code:


vignette("DImulti_workflow")


head(dataSWE)

# We begin by transforming the time identifier column to a factor, to better group coefficients

dataSWE$YEARN &lt;- as.factor(dataSWE$YEARN)

# We fit a repeated measures DI model using the main function DImulti().
# We begin by passing the initial species proportions column names through 'prop' and the
# response value column name through 'y'.
# As the data contains multiple time points, we include the 'time' parameter, through which we
# specify the column name containing the repeated measure indicator and the autocorrelation
# structure we want to use, in this case, we use compound symmetry (CS).
# The experimental unit ID is stored in the column "PLOT" and so we pass this to 'unit_IDs'.
# We request that the method fits an average interaction structure and we include the treatments
# DENS and TREAT as additional fixed effects.
# We opt to use the ML estimation method to allow for model comparisons with different fixed
# effects.
# Finally, we specify the data object, dataSWE, through 'data'.

SWEmodel &lt;- DImulti(y = "YIELD", time = c("YEARN", "CS"), unit_IDs = "PLOT",
                    prop = 5:8, data = dataSWE, DImodel = "AV",
                    extra_fixed = ~ 1:(DENS:TREAT),
                    method = "ML")

print(SWEmodel)

# We can now make any changes to the model's fixed effects and use a series of anovas (if the
# models are nested) or information criteria such as AIC, AICc, BIC, or BICc to select a final model
# We choose to change the interactions structure to functional groups, grouping the grasses and
# legumes, and simplify the extra_fixed terms, as an example, by only crossing the ID effect of G1
# with the treatments, and no longer crossing them with each other.

SWEmodel2 &lt;- DImulti(y = "YIELD", time = c("YEARN", "CS"), unit_IDs = "PLOT",
                    prop = 5:8, data = dataSWE, DImodel = "FG", FG = c("G", "G", "L", "L"),
                    extra_fixed = ~ G1_ID:(DENS+TREAT),
                    method = "ML")

BICc(SWEmodel); BICc(SWEmodel2)

# We select the model with the lower information criteria, which is our functional group model, and
# refit it using the "REML" estimation method, for unbiased estimates.

SWEmodel2 &lt;- DImulti(y = "YIELD", time = c("YEARN", "CS"), unit_IDs = "PLOT",
                    prop = 5:8, data = dataSWE, DImodel = "FG", FG = c("G", "G", "L", "L"),
                    extra_fixed = ~ G1_ID:(DENS+TREAT),
                    method = "REML")

# With this model, we can examine the coefficients

coef(SWEmodel2)

# or the variance and correlation structures

SWEmodel2$corr
nlme::getVarCov(SWEmodel2)


</code></pre>

<hr>
<h2 id='DImodelsMulti'>Multivariate Diversity-Interactions (DI) Models with Repeated Measures</h2><span id='topic+DImodelsMulti'></span>

<h3>Description</h3>

<p>This package is an add-on to the <span class="pkg">'DImodels'</span> package (Moral <em>et al.</em>, 2023).
It enables the fitting of Diversity-Interactions (DI) models for (1) univariate repeated measures
responses(Finn <em>et al.</em>, 2013), (2) multivariate responses at a single point in time
(Dooley <em>et al.</em>, 2015), or (3) multivariate repeated measures responses. These
responses will come from a biodiversity and ecosystem function (BEF) relationship study which
aims to test the relationship between ecosystem functioning and ecosystem design, including
species identities, interactions, and additional factors such as treatments and time. This data
can be used to construct a regression model through the main function of this package
<code><a href="#topic+DImulti">DImulti</a></code>. <br />
</p>


<h3>Details</h3>

<p><strong>Data</strong> <br />
</p>
<p>This package is intended for use with data containing multiple ecosystem function responses
and/or time points from a biodiversity and ecosystem function (BEF) relationship study.
The dataset should contain a column for each species' proportion, so that each row of these columns sum
to one.
Each row of the data should also contain an identifier for the experimental unit being referenced,
these identifiers must be unique to each experimental unit, but remain consistent over time and
across functions.
For each experimental unit included there must be recordings of either: <br />
- a single community level ecosystem function response variable taken at multiple time points
(repeated measures), <br />
- multiple community level ecosystem function responses (multivariate), or <br />
- multiple community level ecosystem function responses taken at multiple time points
(multivariate repeated measures). <br />
Ecosystem functions may be stored in a long or wide format while repeated measures must be stored
in a long format. <br />
</p>
<p><strong>Introduction to multivariate &amp; repeated measures Diversity-Interactions models</strong> <br />
</p>
<p>Diversity-Interactions (DI) models are a regression based approach to modelling the biodiversity
ecosystem function (BEF) relationship
which assumes that the main driver behind changes in ecosystem functioning is the initial
relative abundance (or proportions) of the
species present. These models can be estimated using least squares estimation methods. <br />
An example of a univariate DI model can be seen below, <br />
</p>
<p style="text-align: center;"><code class="reqn"> y =  \sum^{S}_{i=1}{\beta_{i} p_{i}} +
 \sum^{S}_{\substack{i,j=1 \\ i&lt;j}}{\delta_{ij}(p_{i}p_{j})^{\theta} + \alpha A + \epsilon }</code>
</p>

<p>where the response <code class="reqn">y</code> represents the recorded ecosystem function, <code class="reqn">p_{i}</code> represents the
initial proportion of the <code class="reqn">i^{th}</code>
species, therefore the <code class="reqn">p</code> values sum to 1 and form a simplex space, and scales the ID effect
of the species, <code class="reqn">\beta_{i}</code>; if no
species interactions or treatments are required in the model, the response <code class="reqn">y</code> is the
weighted average of the species identity effects.
<code class="reqn">S</code> represents the number of unique species present in the study. Similarly to the ID effect,
the interaction effect, <code class="reqn">\delta</code>,
between species is scaled by some combination of the products of species proportions, which
depends on the interaction structure chosen.
The example above shows the full pairwise structure, which has a unique interaction term,
<code class="reqn">\delta_{ij}</code>, per pair of species <code class="reqn">i</code> &amp; <code class="reqn">j</code>.
The nonlinear term <code class="reqn">\theta</code> (Connolly <em>et al.</em>, 2013; Vishwakarma <em>et al.</em>, 2023)
is included in the model to allow the shape of the BEF relationship to change. This parameter
can be estimated using profile log-likelihood optimisation (Brent, 1973) or can be assigned a
set value based on an <em>a priori</em> assumption/knowledge.
<code class="reqn">A</code> may include blocks or treatment terms, and <code class="reqn">\alpha</code> is a vector of the
corresponding effect coefficients. <br />
For further details of univariate DI modelling, see <code>?DImodels</code>, Kirwan <em>et al.</em>,
2009, and Moral <em>et al.</em>, 2023. <br />
</p>
<p>The multivariate DI model (Dooley <em>et al.</em>, 2015) extends the DI modelling framework to
allow for the estimation of multiple ecosystem functions simultaneously, accounting for any
existing covariance between functions through the error term. These models can be further
extended through the introduction of repeated measures over multiple time points.
<br />
The structure for such models is:
</p>
<p style="text-align: center;"><code class="reqn"> y_{kmt} =  \sum^{S}_{i=1}{\beta_{ikt} p_{im}} +
\sum^{S}_{\substack{i,j=1 \\ i&lt;j}}{\delta_{ijkt}(p_{im}p_{jm})^{\theta_{k}}} +
\alpha_{kt}A + \epsilon_{kmt} </code>
</p>

<p>where <code class="reqn">y_{kmt}</code> refers to the value of the <code class="reqn">k^{th}</code> ecosystem function from the
<code class="reqn">m^{th}</code> experimental unit at a time point
<code class="reqn">t</code>. For an experimental unit <code class="reqn">m</code>, <code class="reqn">\beta_{ikt}</code> scaled by <code class="reqn">p_{im}</code> is the
expected contribution of the <code class="reqn">i^{th}</code> species to the <code class="reqn">k^{th}</code> response at time point
<code class="reqn">t</code> and is referred to as the <code class="reqn">i^{th}</code> species' ID effect.
The value of the nonlinear parameter <code class="reqn">\theta</code> is allowed to vary between ecosystem functions,
in turn allowing the fixed effect structure to change across functions, in recognition that the
nature of the species interactions could change between ecosystem functions. In the main function
of this package <code><a href="#topic+DImulti">DImulti</a></code>, the <code class="reqn">\theta</code> values are estimated separately for each
ecosystem function, therefore are unaffected by the presence of other functions. This may change
in future updates. <br />
</p>
<p>In the case that a dataset contains only a single ecosystem function, the corresponding subscript
<code class="reqn">k</code> can simply be removed from the equation, the same can be said for the removal of the
subscript <code class="reqn">t</code> in the instance that a dataset contains a single time point. <br />
</p>
<p><strong>The structure of the error term</strong> <br />
</p>
<p>For a univariate DI model, the error term is assumed to follow a normal distribution with mean
<code class="reqn">0</code> and variance <code class="reqn">\sigma^{2}</code>.
</p>
<p style="text-align: center;"><code class="reqn"> \epsilon \sim N(0, \sigma^{2})</code>
</p>

<p>When the model is extended to fit multivariate (<code class="reqn">k&gt;1</code>) and/or repeated measures (<code class="reqn">t&gt;1</code>)
data, the error term is now assumed to follow a multivariate normal distribution with mean
<code class="reqn">0</code> and variance <code class="reqn">\Sigma^{*}</code>.
</p>
<p style="text-align: center;"><code class="reqn"> \epsilon \sim MVN(0, \Sigma^{*}) </code>
</p>

<p><code class="reqn">\Sigma^{*}</code> is a block diagonal matrix, with one <code class="reqn">kt</code> x <code class="reqn">kt</code> block, <code class="reqn">\Sigma</code>,
for each experimental unit <code class="reqn">m</code>. We refer to <code class="reqn">\Sigma</code> as the variance covariance matrix
for our ecosystem functions and time points. Typically, it includes a unique variance
per combination of ecosystem functions and time points along the diagonal and a unique covariance
between each pair of combinations on the off-diagonal. Autocorrelation structures may be
implemented on the matrix <code class="reqn">\Sigma</code>, either to simplify the estimation process or based
on <em>a priori</em> knowledge. One structure is chosen for the ecosystem functions and another for
repeated measures/time points, the two matrices are then estimated independently and combined
using the Kronecker product (<code class="reqn">\otimes</code>), a matrix multiplication method. In the case that
the data is only multivariate (<code class="reqn">k&gt;1</code> &amp; <code class="reqn">t=1</code>) or only has repeated measures (<code class="reqn">k=1</code> &amp;
<code class="reqn">t&gt;1</code>), only one autocorrelation structure needs to be chosen, with no multiplication
necessary. <br />
Three such structures are currently available in this package for repeated measures responses,
and two are available for multivariate responses: <br />
</p>

<ol>
<li> <p><strong>UN</strong>: When each element of <code class="reqn">\Sigma</code> is set to estimate independently, it is
said to be unstructured or follow the general structure and is the preferred option in the case
that there is no a priori information on the nature of these relationships.
<code><a href="nlme.html#topic+corSymm">corSymm</a></code> <br />
</p>
</li>
<li> <p><strong>CS</strong>: A simpler structure is compound symmetry,
where it is assumed that each ecosystem function or time point has the same variance value
<code class="reqn">\sigma^{2}</code> and each pair has the same covariance value <code class="reqn">\sigma^{2}\rho</code>. This
structure is not preferred for use with multiple ecosystem functions as it provides no
meaningful interpretation, however it is allowed in this package if the model requires
simplification. <code><a href="nlme.html#topic+corCompSymm">corCompSymm</a></code> <br />
</p>
</li>
<li> <p><strong>AR(1)</strong>: An autocorrelation structure exclusive to repeated measures data is an
autoregressive model of order one, which assumes that, each time point has the same variance,
<code class="reqn">\sigma^{2}</code>, and as the distance in pairs of time points increases, the covariance between
them changes by a factor of <code class="reqn">\rho</code>. <code><a href="nlme.html#topic+corAR1">corAR1</a></code>
</p>
</li></ol>



<h3>Author(s)</h3>

<p>Laura Byrne [aut, cre], Rishabh Vishwakarma [aut], Rafael de Andrade Moral [aut],
Caroline Brophy [aut] <br /> <br />
Maintainer: Laura Byrne <a href="mailto:byrnel54@tcd.ie">byrnel54@tcd.ie</a>
</p>


<h3>References</h3>

<p>Vishwakarma, R., Byrne, L., Connolly, J., de Andrade Moral, R. and Brophy, C., 2023. <br />
Estimation of the non-linear parameter in Generalised Diversity-Interactions models is
unaffected by change in structure of the interaction terms. <br />
Environmental and Ecological Statistics, 30(3), pp.555-574. <br />
</p>
<p>Moral, R.A., Vishwakarma, R., Connolly, J., Byrne, L., Hurley, C., Finn, J.A. and Brophy, C.,
2023. <br />
Going beyond richness: Modelling the BEF relationship using species identity, evenness,
richness and species interactions via the DImodels R package. <br />
Methods in Ecology and Evolution, 14(9), pp.2250-2258. <br />
</p>
<p>Dooley, A., Isbell, F., Kirwan, L., Connolly, J., Finn, J.A. and Brophy, C., 2015. <br />
Testing the effects of diversity on ecosystem multifunctionality using a multivariate model. <br />
Ecology Letters, 18(11), pp.1242-1251. <br />
</p>
<p>Finn, J.A., Kirwan, L., Connolly, J., Sebastia, M.T., Helgadottir, A., Baadshaug, O.H.,
Belanger, G., Black, A., Brophy, C., Collins, R.P. and Cop, J., 2013. <br />
Ecosystem function enhanced by combining four functional types of plant species in intensively
managed grassland mixtures: a 3-year continental-scale field experiment.<br />
Journal of Applied Ecology, 50(2), pp.365-375 .<br />
</p>
<p>Connolly, J., Bell, T., Bolger, T., Brophy, C., Carnus, T., Finn, J.A., Kirwan, L., Isbell, F.,
Levine, J., Luscher, A. and Picasso, V., 2013. <br />
An improved model to predict the effects of changing biodiversity levels on ecosystem
function. <br />
Journal of Ecology, 101(2), pp.344-355. <br />
</p>
<p>Kirwan, L., Connolly, J., Finn, J.A., Brophy, C., Luscher, A., Nyfeler, D. and Sebastia, M.T.,
2009. <br />
Diversity-interaction modeling: estimating contributions of species identities and interactions
to ecosystem function. <br />
Ecology, 90(8), pp.2032-2038. <br />
</p>
<p>Brent, R.P., 1973. <br />
Some efficient algorithms for solving systems of nonlinear equations. <br />
SIAM Journal on Numerical Analysis, 10(2), pp.327-344. <br />
</p>


<h3>See Also</h3>

<p>This package:
<code><a href="#topic+DImulti">DImulti</a></code> <br />
Example datasets:
<code><a href="#topic+dataBEL">dataBEL</a></code>,
<code><a href="#topic+dataSWE">dataSWE</a></code>,
<code><a href="#topic+simRM">simRM</a></code>,
<code><a href="#topic+simMV">simMV</a></code>,
<code><a href="#topic+simMVRM">simMVRM</a></code> <br />
Package family:
<code><a href="DImodels.html#topic+DImodels">DImodels</a>,
   <a href="DImodels.html#topic+autoDI">autoDI</a>,
   <a href="DImodels.html#topic+DI">DI</a>,
   <a href="DImodels.html#topic+DI_data">DI_data</a></code> <br />
Modelling package:
<code><a href="nlme.html#topic+nlme">nlme</a></code>,
<code><a href="nlme.html#topic+gls">gls</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#################################################################################################
#################################################################################################


## Modelling Examples

# For a more thorough example of the workflow of this package, please see vignette
# DImulti_workflow using the following code:


vignette("DImulti_workflow")


## The simMVRM dataset
#
# This simulated dataset contains multiple ecosystem functions (k=3) and multiple time points
# (t=2). The dataset was
# simulated using unstructured Sigma matrices.
# The true values can be found in the help file for the data, ?simMVRM

data(simMVRM)
head(simMVRM)

# We will start the analysis with a call to the package's main function, DImulti().
# We begin the call by specifying the column indices holding the initial species proportions
# (p_i) through 'prop' and the columns which hold the ecosystem response values through 'y'.
# Since our data is multivariate, we include the 'eco_func' parameter, specifying "na" as our
# data is in a wide format (multiple columns in 'y') and "un" to fit an unstructured Sigma
# for our ecosystem functions.
# The data also contains repeated measures, so we include the 'time' parameter, specifying "time"
# as the column containing the time point indicator for each row and "ar1" to fit an AR(1)
# autocorrelation structure for our time points.
# Next, we specify that the experimental unit identifier is in column 1 through 'unit_IDs'. We
# indicate that we do not want to estimate the non-linear parameter theta, but do not provide
# any values, opting for the default value of 1.
# We specify a full pairwise (FULL) interaction structure through 'DImodel' and estimate the
# model using maximum likelihood (ML) as we may compare models.
# Finally, we provide the data object simMVRM through 'data'.

simModel_FULL &lt;- DImulti(prop = 2:5, y = 6:8, eco_func = c("na", "un"), time = c("time", "ar1"),
                         unit_IDs = 1, estimate_theta = FALSE, DImodel = "FULL", method = "ML",
                         data = simMVRM)

# simModel_FULL is an object of custom class DImulti, which can be used with a number of S3
# methods and any method compatible with gls objects. We use summary() to examine the model fit,
# including fixed effect coefficients and the variance covariance matrix Sigma.

print(simModel_FULL)

# From this summary, we can see that there are many coefficients, a number of which are not
# statistically significant at an
# alpha level of 0.05, therefore this model may not be ideal for our data. We refit the model
# using an average interaction structure instead as it reduces the number of interaction terms
# to 1 per ecosystem function and time point.

simModel_AV &lt;- DImulti(prop = 2:5, y = 6:8, eco_func = c("na", "un"), time = c("time", "ar1"),
                       unit_IDs = 1, estimate_theta = FALSE, DImodel = "AV", method = "ML",
                       data = simMVRM)
print(simModel_AV)

# This model looks like it is a better fit, with less insignificant terms, but we can test this
# formally using a likelihood ratio test, as the DImodels interaction structures are nested in
# nature (with the exception of "ADD" and "FG", which are on the same level in the nesting
# hierarchy).
# This will test the null hypothesis that the likelihood of the two models do not significantly
# differ, in other words, the added parameters of the more complex model are not worth it.

anova(simModel_FULL, simModel_AV)

# As the p-value is greater than our selected alpha value (0.05), we fail to reject the null
# hypothesis and so continue with the simpler model, simModel_AV.
# We can confirm this result by using information criteria such as AIC or BIC.
# We select the model with the lower value as it indicates a better fit.
# We use the second order versions of AIC and BIC (AICc and BICc) as we have a large number of
# terms, which can cause AIC and BIC to favour more complex models.

AICc(simModel_FULL); AICc(simModel_AV)
BICc(simModel_FULL); BICc(simModel_AV)

# We refit our chosen model using the REML estimation method to have unbiased estimates.

simModel_AV &lt;- DImulti(prop = 2:5, y = 6:8, eco_func = c("na", "un"), time = c("time", "ar1"),
                       unit_IDs = 1, estimate_theta = FALSE, DImodel = "AV", method = "REML",
                       data = simMVRM)

# We can now examine the variance covariance matrix, Sigma, and the fixed effect coefficients,
# which can be retrieved from our initial summary() check or individually.

coef(simModel_AV)
simModel_AV$vcov

# An example of what we can infer from this is that ecosystem functions Y1 and Y2 have a positive
# covariance at time 1, while Y3 has a negative covariance with both Y1 and Y2 at the same time
# point. This means that maximising Y1 would not negatively impact Y2 but it would be at the cost
# of Y3. However, as our interaction term is positive and significant at this time point for all
# three ecosystem functions, we should be able to include a mixture of species that have positive
# ID effects for each response to help mitigate this trade-off.
# We can also predict from the model if we want to compare responses from different conditions,
# even those not included in the original data.

predict(simModel_AV, newdata = simMVRM[which(simMVRM$plot == 1:2), ])


#################################################################################################
## The Belgium dataset
#
# This real world dataset contains multiple ecosystem functions (k=3) at a single time point
# (t=1). The dataset also contains seeding density as a treatment in the form of a factor with
# two levels (1, -1). More detail can be found at ?dataBEL.

data(dataBEL)
head(dataBEL)

# We begin with the main function DImulti(), passing the initial species proportions column names
# through 'prop' and the response value column name through 'y'.
# As the data is in a long or stacked format, we specify the ecosystem function type through the
# first index of the 'eco_func' parameter, along with specifying that we want an unstructured
# Sigma for these response types.
# The experimental unit ID is stored in the column "Plot" and so we pass this to 'unit_IDs'.
# Rather than estimating the nonlinear parameter theta, we opt to provide a value for each
# ecosystem function type through the parameter 'theta', which will be applied to the
# interaction terms as a power. In this case, we use functional group (FG) interactions, which
# requires an additional argument FG to be provided, specifying which group each species present
# in 'prop' belongs to. In this case, we group the grasses and the legumes.
# We include the treatment Density as an additional fixed effect.
# We opt to use the REML estimation method as we will not be doing any model comparisons.
# Finally, we specify the data object, dataBEL, through 'data'.

belModel &lt;- DImulti(prop = c("G1", "G2", "L1", "L2"), y = "Y", eco_func = c("Var", "un"),
                    unit_IDs = "Plot", theta = c(0.5, 1, 1.2), DImodel = "FG",
                    FG = c("Grass", "Grass", "Legume", "Legume"), extra_fixed = ~ Density,
                    method = "REML", data = dataBEL)

# We can now print the output from our model, stored in belModel with class DImulti.

print(belModel)


#################################################################################################
## The Sweden dataset
#
# This real-world dataset contains a single ecosystem function read at multiple time points
# (k=1 &amp; t=3). The data contains two treatments, TREAT and DENS, each with two levels
# 1 &amp; 2 and High &amp; Low, respectively.
# More details can be found at ?dataSWE

data(dataSWE)
head(dataSWE)

# We transform the "YEARN" column to factors to better act as groups in our models, giving us a
# coefficient per year number as opposed to acting as a continuous scaling factor.

dataSWE$YEARN &lt;- as.factor(dataSWE$YEARN)

# We use the DImulti() function to fit a repeated measures DI model to this data.
# We specify the column indices 5 through 8 for our initial species proportions and the response
# value column name "YIELD".
# As there are multiple time points (repeated measures), we use the parameter 'time', providing
# the column name containing the time identifier through the first index and the desired Sigma
# structure (compound symmetry) through the second.
# The experimental unit ID is stored in column index two, which is passed through 'unit_IDs'.
# The interaction structure chosen is the average interaction term, "AV".
# We include both of the treatment terms, TREAT and DENS, as extra fixed effects crossed with
# each ID effect, the interaction effect, and with each other.
# We opt to use the REML
# estimation method for the model as we will not be doing any model comparisons.
# Finally, we specify the data object, dataSWE, through 'data'

SWEmodel &lt;- DImulti(prop = 5:8, y = c("YIELD"), time = c("YEARN", "CS"),
                    unit_IDs = 2, DImodel = "AV", extra_fixed = ~ 1:(TREAT:DENS),
                    method = "REML", data = dataSWE)

print(SWEmodel)


</code></pre>

<hr>
<h2 id='DImulti'>DImulti</h2><span id='topic+DImulti'></span>

<h3>Description</h3>

<p>A function to fit Diversity-Interactions models to data with multiple ecosystem
functions and/or multiple time points
</p>


<h3>Usage</h3>

<pre><code class='language-R'>DImulti(
  y,
  eco_func = c("NA", "NA"),
  time = c("NA", "NA"),
  unit_IDs,
  prop,
  data,
  DImodel,
  FG = NULL,
  ID = NULL,
  extra_fixed = NULL,
  estimate_theta = FALSE,
  theta = 1,
  method = "REML"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="DImulti_+3A_y">y</code></td>
<td>
<p>If the dataset is in a wide format, this argument is a vector of k column names
identifying the ecosystem function values recorded from each experimental unit in the dataset.
For example, if the ecosystem function columns are labelled Y1 to Y4, then
<code>y = c("Y1","Y2","Y3","Y4")</code>. Alternatively, the column numbers can be specified, for
example, <code>y = 8:11</code>, where ecosystem function values are in the 8th to 11th columns.
If the dataset is in the long/stacked format, this argument is the column name of the
response value vector, for example, <code>y = "yield"</code>, alternatively, the column number can be
supplied, <code>y = 8</code></p>
</td></tr>
<tr><td><code id="DImulti_+3A_eco_func">eco_func</code></td>
<td>
<p>A vector of size two, with the first index holding the column name containing
the character or factor indicator of which response was recorded (for use when stacked/long data
passed through parameter y), otherwise it is the string <code>"NA"</code>, case insensitive. The second
index should contain a string referring to the autocorrelation structure of the responses (for
use in multivariate data case), options include <code>"un"</code> for unstructured/general and
<code>"cs"</code> for compound symmetry. For example, <code>eco_func = c("Function", "cs")</code>, pertaining
to multivariate data in a stacked format with a compound symmetry structure, or
<code>eco_func = c("na", "un")</code>, meaning either univariate or wide multivariate data with an
unstructured/general variance covariance matrix</p>
</td></tr>
<tr><td><code id="DImulti_+3A_time">time</code></td>
<td>
<p>A vector of size two, with the first index holding the column name containing the
repeated measures identifier (i.e., indicating which time point the corresponding response was
recorded at), otherwise it is the string <code>"NA"</code>, case insensitive. The second index should
contain a string referring to the autocorrelation structure of the repeated measures, options
include <code>"un"</code> for unstructured/general, <code>"cs"</code> for compound symmetry, and
<code>"ar1"</code> for an autoregressive model of order 1 (AR(1)). For example,
<code>time = c("reading", "ar1")</code>, pertaining to repeated measures data with multiple readings
on each unit with an AR(1) structure, or <code>time = c("na", "un")</code>, meaning multivariate data
with no repeated measures (the correlation structure will be ignored)</p>
</td></tr>
<tr><td><code id="DImulti_+3A_unit_ids">unit_IDs</code></td>
<td>
<p>A vector of columns names/indices containing identifiers for the experimental
units from which the observations (either multiple readings of the same response or a single
reading of multiple responses) are taken, e.g., <code>unit_IDs = "Plot"</code></p>
</td></tr>
<tr><td><code id="DImulti_+3A_prop">prop</code></td>
<td>
<p>A vector of S column names identifying the species proportions in each community in
the dataset. For example, if the species proportions columns are labelled p1 to p4, then
<code>prop = c("p1","p2","p3","p4")</code>. Alternatively, the column numbers can be specified,
for example, <code>prop = 4:7</code>, where species proportions are in the 4th to 7th columns</p>
</td></tr>
<tr><td><code id="DImulti_+3A_data">data</code></td>
<td>
<p>A dataframe or tibble containing all previously input columns</p>
</td></tr>
<tr><td><code id="DImulti_+3A_dimodel">DImodel</code></td>
<td>
<p>A string, referring to the interaction structure of model to be fit from the full
list: <code>"STR", "ID", "FULL", "E", "AV", "ADD", "FG"</code></p>
</td></tr>
<tr><td><code id="DImulti_+3A_fg">FG</code></td>
<td>
<p>If species are classified by g functional groups, this argument takes a string vector
(of length S) of the functional group to which each species referenced in the <code>prop</code>
argument belongs. For example, for four grassland species with two grasses and two legumes: FG
could be <code>FG = c("G","G","L","L")</code>, where G stands for grass and L stands for legume. This
argument is optional but must be supplied if the <code>"FG"</code> interaction structure is specified
in the <code>DImodel</code> argument</p>
</td></tr>
<tr><td><code id="DImulti_+3A_id">ID</code></td>
<td>
<p>A text list (of length s) describing groupings for the identity of the effects of the
species. These groupings will constrain some of the identity effects to be equal. For example,
if there are four species and you wish to have two identity effect groups where species 1 and 3
and species 2 and 4 are grouped together: ID could be <code>ID = c("ID1", "ID2", "ID1", "ID2")</code>,
where &quot;ID1&quot; and &quot;ID2&quot; are the names of the ID groups. This changes the identity component of the
model from <code>'beta_1p_1 + beta_2p_2 + beta_3p_3 + beta_4p_4'</code> to <code>'beta_a(p_1 + p_3) +
beta_b(p_2 + p_4)'</code>. This grouping does not affect the interaction terms</p>
</td></tr>
<tr><td><code id="DImulti_+3A_extra_fixed">extra_fixed</code></td>
<td>
<p>A formula expression for any additional fixed effect terms. For example,
<code>extra_fixed = ~ Treatment</code> or <code>extra_fixed = ~ Treatment + Density</code>. Interactions
across the regular formula can easily be included by beginning this argument with <code>1*</code> or
<code>1:</code>, e.g. <code>extra_fixed = ~ 1:Density</code>. Any interactions included through this
parameter will not be affected by <code>theta</code>.
Any terms included will automatically be crossed with the column(s) specified through
<code>eco_func</code> and/or <code>time</code>, therefore these interactions do not need to be specified here.</p>
</td></tr>
<tr><td><code id="DImulti_+3A_estimate_theta">estimate_theta</code></td>
<td>
<p>By default, <code class="reqn">\theta</code> (the power parameter on all <code>p_i * p_j</code>
components of each interaction variable in the model) is set equal to one. Specify
<code>estimate_theta = TRUE</code> to include the estimation of <code class="reqn">\theta</code> in the specified model. A
value of <code class="reqn">\theta</code> will be estimated for each ecosystem function present in the data
separately, possibly changing the fixed effects across functions. In the case of multivariate
data, it is possible the model will be singular, resulting in an error, in this case, the
<code class="reqn">\theta</code> estimates will be printed to the console. It is recommended to simplify a singular
model, e.g. reduce the number of terms estimated, or change the theta values through parameter
<code>theta</code></p>
</td></tr>
<tr><td><code id="DImulti_+3A_theta">theta</code></td>
<td>
<p>Users may specify a value of <code class="reqn">\theta</code> different than 1 to fit the DI model.
Note that if <code>estimate_theta = TRUE</code>, then <code class="reqn">\theta</code> will be estimated via maximum
profile log-likelihood and the value specified for <code>theta</code> will be overridden. Specify a
vector of positive non-zero numerical values indicating the value for the non-linear parameter
of the model for each ecosystem function (in alphabetical order, use <code>sort()</code> to find this)
present in the dataset, changing the fixed effects across functions, or a single value to be used
for all. For example, <code>theta = 0.5</code> or <code>theta = c(1, 0.5, 1)</code></p>
</td></tr>
<tr><td><code id="DImulti_+3A_method">method</code></td>
<td>
<p>The string <code>"REML"</code> or <code>"ML"</code>, referring to the estimation method to be
used. Defaults to &quot;REML&quot;, which is suitable for model comparisons only if the fixed effects are
held constant but provides unbiased estimates. If fixed effects are going to be tested between
models, use &quot;ML&quot; for comparisons and then refit the chosen model using &quot;REML&quot;</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Data</strong> <br />
</p>
<p>This package is intended for use with data containing multiple ecosystem function responses
and/or time points from a biodiversity and ecosystem function (BEF) relationship study.
The dataset should contain a column for each species' proportion, so that each row of these columns sum
to one.
Each row of the data should also contain an identifier for the experimental unit being referenced,
these identifiers must be unique to each experimental unit, but remain consistent over time and
across functions.
For each experimental unit included there must be recordings of either: <br />
- a single community level ecosystem function response variable taken at multiple time points
(repeated measures), <br />
- multiple community level ecosystem function responses (multivariate), or <br />
- multiple community level ecosystem function responses taken at multiple time points
(multivariate repeated measures). <br />
Ecosystem functions may be stored in a long or wide format while repeated measures must be stored
in a long format. <br />
</p>
<p><strong>Introduction to multivariate &amp; repeated measures Diversity-Interactions models</strong> <br />
</p>
<p>Diversity-Interactions (DI) models are a regression based approach to modelling the biodiversity
ecosystem function (BEF) relationship
which assumes that the main driver behind changes in ecosystem functioning is the initial
relative abundance (or proportions) of the
species present. These models can be estimated using least squares estimation methods. <br />
An example of a univariate DI model can be seen below, <br />
</p>
<p style="text-align: center;"><code class="reqn"> y =  \sum^{S}_{i=1}{\beta_{i} p_{i}} +
 \sum^{S}_{\substack{i,j=1 \\ i&lt;j}}{\delta_{ij}(p_{i}p_{j})^{\theta} + \alpha A + \epsilon }</code>
</p>

<p>where the response <code class="reqn">y</code> represents the recorded ecosystem function, <code class="reqn">p_{i}</code> represents the
initial proportion of the <code class="reqn">i^{th}</code>
species, therefore the <code class="reqn">p</code> values sum to 1 and form a simplex space, and scales the ID effect
of the species, <code class="reqn">\beta_{i}</code>; if no
species interactions or treatments are required in the model, the response <code class="reqn">y</code> is the
weighted average of the species identity effects.
<code class="reqn">S</code> represents the number of unique species present in the study. Similarly to the ID effect,
the interaction effect, <code class="reqn">\delta</code>,
between species is scaled by some combination of the products of species proportions, which
depends on the interaction structure chosen.
The example above shows the full pairwise structure, which has a unique interaction term,
<code class="reqn">\delta_{ij}</code>, per pair of species <code class="reqn">i</code>
&amp; <code class="reqn">j</code>.
The nonlinear term <code class="reqn">\theta</code> (Connolly <em>et al.</em>, 2013; Vishwakarma <em>et al.</em>, 2023)
is included in the model to allow the shape of the BEF relationship to change. This parameter
can be estimated using profile log-likelihood optimisation (Brent, 1973) or can be assigned a
set value based on an <em>a priori</em> assumption/knowledge.
<code class="reqn">A</code> may include blocks or treatment terms, and <code class="reqn">\alpha</code> is a vector of the
corresponding effect coefficients. <br />
For further details of univariate DI modelling, see <code>?DImodels</code>, Kirwan <em>et al.</em>,
2009, and Moral <em>et al.</em>, 2023. <br />
</p>
<p>The multivariate DI model (Dooley <em>et al.</em>, 2015) extends the DI modelling framework to
allow for the estimation of multiple ecosystem functions simultaneously, accounting for any
existing covariance between functions through the error term. These models can be further
extended through the introduction of repeated measures over multiple time points.
<br />
The structure for such models is:
</p>
<p style="text-align: center;"><code class="reqn"> y_{kmt} =  \sum^{S}_{i=1}{\beta_{ikt} p_{im}} +
\sum^{S}_{\substack{i,j=1 \\ i&lt;j}}{\delta_{ijkt}(p_{im}p_{jm})^{\theta_{k}}} +
\alpha_{kt}A + \epsilon_{kmt} </code>
</p>

<p>where <code class="reqn">y_{kmt}</code> refers to the value of the <code class="reqn">k^{th}</code> ecosystem function from the
<code class="reqn">m^{th}</code> experimental unit at a time point
<code class="reqn">t</code>. For an experimental unit <code class="reqn">m</code>, <code class="reqn">\beta_{ikt}</code> scaled by <code class="reqn">p_{im}</code> is the
expected contribution of the <code class="reqn">i^{th}</code> species to the <code class="reqn">k^{th}</code> response at time point
<code class="reqn">t</code> and is referred to as the <code class="reqn">i^{th}</code> species' ID effect.
The value of the nonlinear parameter <code class="reqn">\theta</code> is allowed to vary between ecosystem functions,
in turn allowing the fixed effect structure to change across functions, in recognition that the
nature of the species interactions could change between ecosystem functions. In the main function
of this package <code><a href="#topic+DImulti">DImulti</a></code>, the <code class="reqn">\theta</code> values are estimated separately for each
ecosystem function, therefore are unaffected by the presence of other functions. This may change
in future updates. <br />
</p>
<p>In the case that a dataset contains only a single ecosystem function, the corresponding subscript
<code class="reqn">k</code> can simply be removed from the equation, the same can be said for the removal of the
subscript <code class="reqn">t</code> in the instance that a dataset contains a single time point. <br />
</p>
<p><strong>The structure of the error term</strong> <br />
</p>
<p>For a univariate DI model, the error term is assumed to follow a normal distribution with mean
<code class="reqn">0</code> and variance <code class="reqn">\sigma^{2}</code>.
</p>
<p style="text-align: center;"><code class="reqn"> \epsilon \sim N(0, \sigma^{2})</code>
</p>

<p>When the model is extended to fit multivariate (<code class="reqn">k&gt;1</code>) and/or repeated measures (<code class="reqn">t&gt;1</code>)
data, the error term is now assumed to follow a multivariate normal distribution with mean
<code class="reqn">0</code> and variance <code class="reqn">\Sigma^{*}</code>.
</p>
<p style="text-align: center;"><code class="reqn"> \epsilon \sim MVN(0, \Sigma^{*}) </code>
</p>

<p><code class="reqn">\Sigma^{*}</code> is a block diagonal matrix, with one <code class="reqn">kt</code> x <code class="reqn">kt</code> block, <code class="reqn">\Sigma</code>,
for each experimental unit <code class="reqn">m</code>. We refer to <code class="reqn">\Sigma</code> as the variance covariance matrix
for our ecosystem functions and time points. Typically, it includes a unique variance
per combination of ecosystem functions and time points along the diagonal and a unique covariance
between each pair of combinations on the off-diagonal. Autocorrelation structures may be
implemented on the matrix <code class="reqn">\Sigma</code>, either to simplify the estimation process or based
on <em>a priori</em> knowledge. One structure is chosen for the ecosystem functions and another for
repeated measures/time points, the two matrices are then estimated independently and combined
using the Kronecker product (<code class="reqn">\otimes</code>), a matrix multiplication method. In the case that
the data is only multivariate (<code class="reqn">k&gt;1</code> &amp; <code class="reqn">t=1</code>) or only has repeated measures (<code class="reqn">k=1</code> &amp;
<code class="reqn">t&gt;1</code>), only one autocorrelation structure needs to be chosen, with no multiplication
necessary. <br />
Three such structures are currently available in this package for repeated measures responses,
and two are available for multivariate responses: <br />
</p>

<ol>
<li> <p><strong>UN</strong>: When each element of <code class="reqn">\Sigma</code> is set to estimate independently, it is
said to be unstructured or follow the general structure and is the preferred option in the case
that there is no a priori information on the nature of these relationships.
<code><a href="nlme.html#topic+corSymm">corSymm</a></code> <br />
</p>
</li>
<li> <p><strong>CS</strong>: A simpler structure is compound symmetry,
where it is assumed that each ecosystem function or time point has the same variance value
<code class="reqn">\sigma^{2}</code> and each pair has the same covariance value <code class="reqn">\sigma^{2}\rho</code>. This
structure is not preferred for use with multiple ecosystem functions as it provides no
meaningful interpretation, however it is allowed in this package if the model requires
simplification. <code><a href="nlme.html#topic+corCompSymm">corCompSymm</a></code> <br />
</p>
</li>
<li> <p><strong>AR(1)</strong>: An autocorrelation structure exclusive to repeated measures data is an
autoregressive model of order one, which assumes that, each time point has the same variance,
<code class="reqn">\sigma^{2}</code>, and as the distance in pairs of time points increases, the covariance between
them changes by a factor of <code class="reqn">\rho</code>. <code><a href="nlme.html#topic+corAR1">corAR1</a></code>
</p>
</li></ol>



<h3>Value</h3>

<p><code>DImulti</code> - a custom class object containing the gls model fit with additional DI
model attributes
</p>


<h3>Author(s)</h3>

<p>Laura Byrne [aut, cre], Rishabh Vishwakarma [aut], Rafael de Andrade Moral [aut],
Caroline Brophy [aut] <br />
Maintainer: Laura Byrne <a href="mailto:byrnel54@tcd.ie">byrnel54@tcd.ie</a>
</p>


<h3>References</h3>

<p>Vishwakarma, R., Byrne, L., Connolly, J., de Andrade Moral, R. and Brophy, C., 2023. <br />
Estimation of the non-linear parameter in Generalised Diversity-Interactions models is
unaffected by change in structure of the interaction terms. <br />
Environmental and Ecological Statistics, 30(3), pp.555-574. <br />
</p>
<p>Moral, R.A., Vishwakarma, R., Connolly, J., Byrne, L., Hurley, C., Finn, J.A. and Brophy, C.,
2023. <br />
Going beyond richness: Modelling the BEF relationship using species identity, evenness,
richness and species interactions via the DImodels R package. <br />
Methods in Ecology and Evolution, 14(9), pp.2250-2258. <br />
</p>
<p>Dooley, A., Isbell, F., Kirwan, L., Connolly, J., Finn, J.A. and Brophy, C., 2015. <br />
Testing the effects of diversity on ecosystem multifunctionality using a multivariate model. <br />
Ecology Letters, 18(11), pp.1242-1251. <br />
</p>
<p>Finn, J.A., Kirwan, L., Connolly, J., Sebastia, M.T., Helgadottir, A., Baadshaug, O.H.,
Belanger, G., Black, A., Brophy, C., Collins, R.P. and Cop, J., 2013. <br />
Ecosystem function enhanced by combining four functional types of plant species in intensively
managed grassland mixtures: a 3-year continental-scale field experiment.<br />
Journal of Applied Ecology, 50(2), pp.365-375 .<br />
</p>
<p>Connolly, J., Bell, T., Bolger, T., Brophy, C., Carnus, T., Finn, J.A., Kirwan, L., Isbell, F.,
Levine, J., Luscher, A. and Picasso, V., 2013. <br />
An improved model to predict the effects of changing biodiversity levels on ecosystem
function. <br />
Journal of Ecology, 101(2), pp.344-355. <br />
</p>
<p>Kirwan, L., Connolly, J., Finn, J.A., Brophy, C., Luscher, A., Nyfeler, D. and Sebastia, M.T.,
2009. <br />
Diversity-interaction modeling: estimating contributions of species identities and interactions
to ecosystem function. <br />
Ecology, 90(8), pp.2032-2038. <br />
</p>
<p>Brent, R.P., 1973. <br />
Some efficient algorithms for solving systems of nonlinear equations. <br />
SIAM Journal on Numerical Analysis, 10(2), pp.327-344. <br />
</p>


<h3>See Also</h3>

<p>This package:
<code><a href="#topic+DImulti">DImulti</a></code> <br />
Example datasets:
<code><a href="#topic+dataBEL">dataBEL</a></code>,
<code><a href="#topic+dataSWE">dataSWE</a></code>,
<code><a href="#topic+simRM">simRM</a></code>,
<code><a href="#topic+simMV">simMV</a></code>,
<code><a href="#topic+simMVRM">simMVRM</a></code> <br />
Package family:
<code><a href="DImodels.html#topic+DImodels">DImodels</a>,
   <a href="DImodels.html#topic+autoDI">autoDI</a>,
   <a href="DImodels.html#topic+DI">DI</a>,
   <a href="DImodels.html#topic+DI_data">DI_data</a></code> <br />
Modelling package:
<code><a href="nlme.html#topic+nlme">nlme</a></code>,
<code><a href="nlme.html#topic+gls">gls</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>
#################################################################################################
#################################################################################################
#################################################################################################


## Modelling Examples

# For a more thorough example of the workflow of this package, please see vignette
# DImulti_workflow using the following code:


vignette("DImulti_workflow")


## The simMVRM dataset
#
# This simulated dataset contains multiple ecosystem functions (k=3) and multiple time points
# (t=2). The dataset was
# simulated using unstructured Sigma matrices.
# The true values can be found in the help file for the data, ?simMVRM

data(simMVRM)
head(simMVRM)

# We will start the analysis with a call to the package's main function, DImulti().
# We begin the call by specifying the column indices holding the initial species proportions
# (p_i) through 'prop' and the columns which hold the ecosystem response values through 'y'.
# Since our data is multivariate, we include the 'eco_func' parameter, specifying "na" as our
# data is in a wide format (multiple columns in 'y') and "un" to fit an unstructured Sigma
# for our ecosystem functions.
# The data also contains repeated measures, so we include the 'time' parameter, specifying "time"
# as the column containing the time point indicator for each row and "ar1" to fit an AR(1)
# autocorrelation structure for our time points.
# Next, we specify that the experimental unit identifier is in column 1 through 'unit_IDs'. We
# indicate that we do not want to estimate the non-linear parameter theta, but do not provide
# any values, opting for the default value of 1.
# We specify a full pairwise (FULL) interaction structure through 'DImodel' and estimate the
# model using maximum likelihood (ML) as we may compare models.
# Finally, we provide the data object simMVRM through 'data'.

simModel_FULL &lt;- DImulti(prop = 2:5, y = 6:8, eco_func = c("na", "un"), time = c("time", "ar1"),
                         unit_IDs = 1, estimate_theta = FALSE, DImodel = "FULL", method = "ML",
                         data = simMVRM)

# simModel_FULL is an object of custom class DImulti, which can be used with a number of S3
# methods and any method compatible with gls objects. We use summary() to examine the model fit,
# including fixed effect coefficients and the variance covariance matrix Sigma.

print(simModel_FULL)

# From this summary, we can see that there are many coefficients, a number of which are not
# statistically significant at an
# alpha level of 0.05, therefore this model may not be ideal for our data. We refit the model
# using an average interaction structure instead as it reduces the number of interaction terms
# to 1 per ecosystem function and time point.

simModel_AV &lt;- DImulti(prop = 2:5, y = 6:8, eco_func = c("na", "un"), time = c("time", "ar1"),
                       unit_IDs = 1, estimate_theta = FALSE, DImodel = "AV", method = "ML",
                       data = simMVRM)
print(simModel_AV)

# This model looks like it is a better fit, with less insignificant terms, but we can test this
# formally using a likelihood ratio test, as the DImodels interaction structures are nested in
# nature (with the exception of "ADD" and "FG", which are on the same level in the nesting
# hierarchy).
# This will test the null hypothesis that the likelihood of the two models do not significantly
# differ, in other words, the added parameters of the more complex model are not worth it.

anova(simModel_FULL, simModel_AV)

# As the p-value is greater than our selected alpha value (0.05), we fail to reject the null
# hypothesis and so continue with the simpler model, simModel_AV.
# We can confirm this result by using information criteria such as AIC or BIC.
# We select the model with the lower value as it indicates a better fit.
# We use the second order versions of AIC and BIC (AICc and BICc) as we have a large number of
# terms, which can cause AIC and BIC to favour more complex models.

AICc(simModel_FULL); AICc(simModel_AV)
BICc(simModel_FULL); BICc(simModel_AV)

# We refit our chosen model using the REML estimation method to have unbiased estimates.

simModel_AV &lt;- DImulti(prop = 2:5, y = 6:8, eco_func = c("na", "un"), time = c("time", "ar1"),
                       unit_IDs = 1, estimate_theta = FALSE, DImodel = "AV", method = "REML",
                       data = simMVRM)

# We can now examine the variance covariance matrix, Sigma, and the fixed effect coefficients,
# which can be retrieved from our initial summary() check or individually.

coef(simModel_AV)
simModel_AV$vcov

# An example of what we can infer from this is that ecosystem functions Y1 and Y2 have a positive
# covariance at time 1, while Y3 has a negative covariance with both Y1 and Y2 at the same time
# point. This means that maximising Y1 would not negatively impact Y2 but it would be at the cost
# of Y3. However, as our interaction term is positive and significant at this time point for all
# three ecosystem functions, we should be able to include a mixture of species that have positive
# ID effects for each response to help mitigate this trade-off.
# We can also predict from the model if we want to compare responses from different conditions,
# even those not included in the original data.

predict(simModel_AV, newdata = simMVRM[which(simMVRM$plot == 1:2), ])


#################################################################################################
## The Belgium dataset
#
# This real world dataset contains multiple ecosystem functions (k=3) at a single time point
# (t=1). The dataset also contains seeding density as a treatment in the form of a factor with
# two levels (1, -1). More detail can be found at ?dataBEL.

data(dataBEL)
head(dataBEL)

# We begin with the main function DImulti(), passing the initial species proportions column names
# through 'prop' and the response value column name through 'y'.
# As the data is in a long or stacked format, we specify the ecosystem function type through the
# first index of the 'eco_func' parameter, along with specifying that we want an unstructured
# Sigma for these response types.
# The experimental unit ID is stored in the column "Plot" and so we pass this to 'unit_IDs'.
# Rather than estimating the nonlinear parameter theta, we opt to provide a value for each
# ecosystem function type through the parameter 'theta', which will be applied to the
# interaction terms as a power. In this case, we use functional group (FG) interactions, which
# requires an additional argument FG to be provided, specifying which group each species present
# in 'prop' belongs to. In this case, we group the grasses and the legumes.
# We include the treatment Density as an additional fixed effect.
# We opt to use the REML estimation method as we will not be doing any model comparisons.
# Finally, we specify the data object, dataBEL, through 'data'.

belModel &lt;- DImulti(prop = c("G1", "G2", "L1", "L2"), y = "Y", eco_func = c("Var", "un"),
                    unit_IDs = "Plot", theta = c(0.5, 1, 1.2), DImodel = "FG",
                    FG = c("Grass", "Grass", "Legume", "Legume"), extra_fixed = ~ Density,
                    method = "REML", data = dataBEL)

# We can now print the output from our model, stored in belModel with class DImulti.

print(belModel)




#################################################################################################
## The Sweden dataset
#
# This real-world dataset contains a single ecosystem function read at multiple time points
# (k=1 &amp; t=3). The data contains two treatments, TREAT and DENS, each with two levels
# 1 &amp; 2 and High &amp; Low, respectively.
# More details can be found at ?dataSWE

data(dataSWE)
head(dataSWE)

# We transform the "YEARN" column to factors to better act as groups in our models, giving us a
# coefficient per year number as opposed to acting as a continuous scaling factor.

dataSWE$YEARN &lt;- as.factor(dataSWE$YEARN)

# We use the DImulti() function to fit a repeated measures DI model to this data.
# We specify the column indices 5 through 8 for our initial species proportions and the response
# value column name "YIELD".
# As there are multiple time points (repeated measures), we use the parameter 'time', providing
# the column name containing the time identifier through the first index and the desired Sigma
# structure (compound symmetry) through the second.
# The experimental unit ID is stored in column index two, which is passed through 'unit_IDs'.
# The interaction structure chosen is average interaction term, "AV".
# We include both of the treatment terms, TREAT and DENS, as extra fixed effects crossed with
# each ID effect, the interaction effect, and with each other.
# We opt to use the REML estimation method for the model as we will not be doing any model
# comparisons.
# Finally, we specify the data object, dataSWE, through 'data'

SWEmodel &lt;- DImulti(prop = 5:8, y = c("YIELD"), time = c("YEARN", "CS"),
                    unit_IDs = 2, DImodel = "AV", extra_fixed = ~ 1:(TREAT:DENS),
                    method = "REML", data = dataSWE)

print(SWEmodel)

</code></pre>

<hr>
<h2 id='getVarCov.DImulti'>getVarCov.DImulti</h2><span id='topic+getVarCov.DImulti'></span>

<h3>Description</h3>

<p>Extract the variance-covariance matrix from a fitted DImulti model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'DImulti'
getVarCov(obj, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="getVarCov.DImulti_+3A_obj">obj</code></td>
<td>
<p>an object of class DImulti</p>
</td></tr>
<tr><td><code id="getVarCov.DImulti_+3A_...">...</code></td>
<td>
<p>some methods for this generic function require additional arguments. None are used in
this method.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A variance-covariance matrix or a named list of variance-covariance matrices.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+DImulti">DImulti</a></code>
</p>

<hr>
<h2 id='predict.DImulti'>predict.DImulti</h2><span id='topic+predict.DImulti'></span>

<h3>Description</h3>

<p>Predict from a multivariate repeated measures DI model
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'DImulti'
predict(object, newdata = NULL, stacked = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="predict.DImulti_+3A_object">object</code></td>
<td>
<p>an object of class DImulti</p>
</td></tr>
<tr><td><code id="predict.DImulti_+3A_newdata">newdata</code></td>
<td>
<p>an optional dataframe containing the communities from which to predict. If data is
multivariate and in a wide format, to predict from a subset of ecosystem functions, as opposed
to all, please include a column for each function with any numerical value, e.g.
<code>newdata$Y2 &lt;- 0</code>. If predicting from all functions, these columns may be included or left
out.</p>
</td></tr>
<tr><td><code id="predict.DImulti_+3A_stacked">stacked</code></td>
<td>
<p>a logical value used to determine whether the output is in a wide or stacked
format. Defaults to TRUE, meaning output is stacked/long. <br /> If set to FALSE, non-unique groups of
unit_IDs, ecosystem function, and time points will be aggregated upon widening using the mean
function, please use unique unit_IDs values through newdata to avoid aggregation.</p>
</td></tr>
<tr><td><code id="predict.DImulti_+3A_...">...</code></td>
<td>
<p>some methods for this generic function require additional arguments. None are used in
this method.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The predictions from the supplied fitted DI models for the provided 'newdata', or the
data used to fit the model if no 'newdata' is supplied. Predictions are returned in either a
stacked or wide dataframe format.
</p>


<h3>See Also</h3>

<p><code><a href="nlme.html#topic+predict.gls">predict.gls</a></code> which this function wraps.
</p>

<hr>
<h2 id='print.DImulti'>print.DImulti</h2><span id='topic+print.DImulti'></span>

<h3>Description</h3>

<p>Print details of the fitted DI models supplied
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'DImulti'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.DImulti_+3A_x">x</code></td>
<td>
<p>an object of class DImulti</p>
</td></tr>
<tr><td><code id="print.DImulti_+3A_...">...</code></td>
<td>
<p>some methods for this generic function require additional arguments. None are used in
this method.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The appearance of the printed information will differ depending on whether a user has installed
some combination of the suggested packages &quot;crayon&quot;, &quot;cli&quot;, and &quot;fansi&quot;.
These changes are mainly cosmetic, with crayon making the output easier to read, cli providing
links to help files, and fansi enabling the reading of special characters in R markdown (Rmd)
files. See 'Examples' below for suggested code to include in Rmd files.
</p>


<h3>Value</h3>

<p>object x
</p>


<h3>See Also</h3>

<p><code><a href="base.html#topic+print">print</a></code> which this function wraps.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Set up for R markdown for crayon and cli output if user has packages installed

if(requireNamespace("fansi", quietly = TRUE) &amp;
   requireNamespace("crayon", quietly = TRUE) &amp;
   requireNamespace("cli", quietly = TRUE))
{
 options(crayon.enabled = TRUE)

 ansi_aware_handler &lt;- function(x, options)
 {
  paste0(
    "&lt;pre class=\"r-output\"&gt;&lt;code&gt;",
    fansi::sgr_to_html(x = x, warn = FALSE, term.cap = "256"),
    "&lt;/code&gt;&lt;/pre&gt;"
  )
 }

 old_hooks &lt;- fansi::set_knit_hooks(knitr::knit_hooks,
                                    which = c("output", "message", "error", "warning"))

 knitr::knit_hooks$set(
   output = ansi_aware_handler,
   message = ansi_aware_handler,
   warning = ansi_aware_handler,
   error = ansi_aware_handler
  )
 }
#################################################################################################

## Usage

model &lt;- DImulti(prop = c("G1", "G2", "L1", "L2"), y = "Y", eco_func = c("Var", "un"),
                 unit_IDs = "Plot", theta = c(0.5, 1, 1.2), DImodel = "FG",
                 FG = c("Grass", "Grass", "Legume", "Legume"), extra_fixed = ~ Density,
                 method = "REML", data = dataBEL)

print(model)

</code></pre>

<hr>
<h2 id='print.summary.DImulti'>print.summary.DImulti</h2><span id='topic+print.summary.DImulti'></span>

<h3>Description</h3>

<p>print the details of an object of class summary.DImulti
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'summary.DImulti'
print(x, verbose = FALSE, digits = .Options$digits, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="print.summary.DImulti_+3A_x">x</code></td>
<td>
<p>an object of class DImulti</p>
</td></tr>
<tr><td><code id="print.summary.DImulti_+3A_verbose">verbose</code></td>
<td>
<p>an optional logical value used to control the amount of output when the object is printed. Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="print.summary.DImulti_+3A_digits">digits</code></td>
<td>
<p>the number of significant digits to use when printing</p>
</td></tr>
<tr><td><code id="print.summary.DImulti_+3A_...">...</code></td>
<td>
<p>some methods for this generic function require additional arguments. None are used in
this method.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>object x
</p>


<h3>See Also</h3>

<p><code><a href="base.html#topic+print">print</a></code> which this function wraps.
</p>

<hr>
<h2 id='simMV'>The simulated multivariate &quot;simMV&quot; dataset</h2><span id='topic+simMV'></span>

<h3>Description</h3>

<p>The <code>simMV</code> dataset was simulated from a multivariate DI model. It contains 192 plots
comprising of six species that vary in proportions (<code>p1</code> - <code>p6</code>). Each plot was replicated once for testing a two-level factor <code>treat</code>, included at levels 0 and 1, resulting in a total
of 384 plots. There are four simulated responses (<code>Y1</code> - <code>Y4</code>) recorded in a wide data format (one column per response). The data was simulated assuming that there were existing
covariances between the responses, an additive treatment effect, and both species identity and
species interaction effects were present.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("simMV")</code></pre>


<h3>Format</h3>

<p>A data frame with 384 observations on the following twelve variables.
</p>

<dl>
<dt><code>plot</code></dt><dd><p>A numeric vector identifying each unique experimental unit</p>
</dd>
<dt><code>p1</code></dt><dd><p>A numeric vector indicating the initial proportion of species 1</p>
</dd>
<dt><code>p2</code></dt><dd><p>A numeric vector indicating the initial proportion of species 2</p>
</dd>
<dt><code>p3</code></dt><dd><p>A numeric vector indicating the initial proportion of species 3</p>
</dd>
<dt><code>p4</code></dt><dd><p>A numeric vector indicating the initial proportion of species 4</p>
</dd>
<dt><code>p5</code></dt><dd><p>A numeric vector indicating the initial proportion of species 5</p>
</dd>
<dt><code>p6</code></dt><dd><p>A numeric vector indicating the initial proportion of species 6</p>
</dd>
<dt><code>treat</code></dt><dd><p>A two-level factor indicating whether a treatment was applied (1) or not
(0)</p>
</dd>
<dt><code>Y1</code></dt><dd><p>A numeric vector giving the simulated response for ecosystem function 1</p>
</dd>
<dt><code>Y2</code></dt><dd><p>A numeric vector giving the simulated response for ecosystem function 2</p>
</dd>
<dt><code>Y3</code></dt><dd><p>A numeric vector giving the simulated response for ecosystem function 3</p>
</dd>
<dt><code>Y4</code></dt><dd><p>A numeric vector giving the simulated response for ecosystem function 4</p>
</dd>
</dl>



<h3>Details</h3>

<p><b>What are Diversity-Interactions (DI) models?</b>
</p>
<p>Diversity-Interactions (DI) models (Kirwan <em>et al.</em>, 2009) are a set of tools for analysing and interpreting data from experiments that explore the effects of species diversity on community-level
responses. We strongly recommend that users read the short introduction to Diversity-Interactions
models (available at: <code><a href="DImodels.html#topic+DImodels">DImodels</a></code>). Further information on
Diversity-Interactions models is also available in Kirwan et al 2009 and Connolly et al 2013. The
multivariate DI model was developed by Dooley <em>et al.</em>, 2015.
</p>
<p><b>Parameter values for the simulation</b>
</p>
<p>Multivariate DI models take the general form of:
</p>
<p style="text-align: center;"><code class="reqn">{y}_{km} = {Identities}_{km} + {Interactions}_{km} + {Structures}_{k} + {\epsilon}_{km}</code>
</p>

<p>where <code class="reqn">y</code> are the community-level responses, the <code class="reqn">Identities</code> are the effects of species
identities for each response and enter the model as individual species proportions at the beginning
of the time period, the <code class="reqn">Interactions</code> are the interactions among the species proportions, while <code class="reqn">Structures</code> include other experimental structures such as blocks, treatments or density.
</p>
<p>The dataset <code>simMV</code> was simulated with:
</p>

<ul>
<li><p> identity effects for the six species for response:
</p>

<ul>
<li><p> Y1 = 6.9, -0.3, 6.6, 1.7, -0.8, 4.3
</p>
</li>
<li><p> Y2 = 4.9, 3.6, 4.4, 2.3, 4.3, 6.6
</p>
</li>
<li><p> Y3 = -0.3, 4.6, 1.2, 6.8, 1.4, 6.9
</p>
</li>
<li><p> Y4 = 4.1, 4.2, -0.5, 4.9, 6.7, -0.9, -1.0
</p>
</li></ul>

</li>
<li><p> an average pairwise interaction effect for response:
</p>

<ul>
<li><p> Y1 = 1.8
</p>
</li>
<li><p> Y2 = 6.8
</p>
</li>
<li><p> Y3 = 1.4
</p>
</li>
<li><p> Y4 = 0.3
</p>
</li></ul>

</li>
<li><p> a teatment effect for response:
</p>

<ul>
<li><p> Y1 = 3.5
</p>
</li>
<li><p> Y2 = -0.3
</p>
</li>
<li><p> Y3 = 5.5
</p>
</li>
<li><p> Y4 = -1.0
</p>
</li></ul>

</li>
<li> <p><code class="reqn">\epsilon</code> assumed to have a multivaraite normal distribution with mean 0 and Sigma:
</p>

<table>
<tr>
 <td style="text-align: left;">
      [1,]  3.87  -0.17  -0.23  0.31 </td>
</tr>
<tr>
 <td style="text-align: left;">
      [2,]  -0.17  1.34  -0.11  0.49 </td>
</tr>
<tr>
 <td style="text-align: left;">
      [3,]  -0.23  -0.11  2.95  -0.36 </td>
</tr>
<tr>
 <td style="text-align: left;">
      [4,]  0.31  0.49  -0.36  1.83 </td>
</tr>
<tr>
 <td style="text-align: left;">
      </td>
</tr>

</table>

</li></ul>



<h3>References</h3>

<p>Dooley, A., Isbell, F., Kirwan, L., Connolly, J., Finn, J.A. and Brophy, C., 2015. <br />
Testing the effects of diversity on ecosystem multifunctionality using a multivariate model. <br />
Ecology Letters, 18(11), pp.1242-1251. <br />
</p>
<p>Finn, J.A., Kirwan, L., Connolly, J., Sebastia, M.T., Helgadottir, A., Baadshaug, O.H.,
Belanger, G., Black, A., Brophy, C., Collins, R.P. and Cop, J., 2013. <br />
Ecosystem function enhanced by combining four functional types of plant species in intensively
managed grassland mixtures: a 3-year continental-scale field experiment.<br />
Journal of Applied Ecology, 50(2), pp.365-375 .<br />
</p>
<p>Kirwan, L., Connolly, J., Finn, J.A., Brophy, C., Luscher, A., Nyfeler, D. and Sebastia, M.T.,
2009. <br />
Diversity-interaction modeling: estimating contributions of species identities and interactions
to ecosystem function. <br />
Ecology, 90(8), pp.2032-2038. <br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>###################################################################################################
###################################################################################################



## Modelling Example

# For a more thorough example of the workflow of this package, please see vignette
# DImulti_workflow using the following code:


vignette("DImulti_workflow")


# We use head() to view the dataset
head(simMV)


# We can use the function DImulti() to fit a multivariate DI model, with an intercept for "treat"
# for each ecosystem function. The dataset is wide, so the Y columns are all entered through 'y'
# and the first index of eco_func is "NA". We fit the average interaction structure and use "ML"
# so that we can perform model comparisons with varying fixed effects
MVmodel &lt;- DImulti(y = paste0("Y", 1:4), eco_func = c("NA", "UN"), unit_IDs = 1,
                   prop = paste0("p", 1:6), data = simMV, DImodel = "AV", extra_fixed = ~ treat,
                   method = "ML")
print(MVmodel)

# We can adjust the previous model to now cross "treat" with each other ID effect. We also specify
# different values of theta for each ecosystem function and use the "REML" method to get unbiased
# estimates.

MVmodel_theta &lt;- DImulti(y = paste0("Y", 1:4), eco_func = c("NA", "UN"), unit_IDs = 1,
                   prop = paste0("p", 1:6), data = simMV, DImodel = "AV", extra_fixed = ~ 1:treat,
                   theta = c(1, 0.5, 0.8, 0.6), method = "REML")

summary(MVmodel_theta)


# We can now use any S3 method compatible with a gls object, for example, predict()

predict(MVmodel_theta, newdata = simMV[which(simMV$plot == 1), ])


##################################################################################################
#
##################################################################################################
## Code to simulate data
#
#

set.seed(412)

props &lt;- data.frame(plot = integer(),
                    p1 = integer(),
                    p2 = integer(),
                    p3 = integer(),
                    p4 = integer(),
                    p5 = integer(),
                    p6 = integer())

index &lt;- 1 #row number

#Monocultures
for(i in 1:6) #6 species
{
  for(j in 1:2) #2 technical reps
  {
    props[index, i+1] &lt;- 1
    index &lt;- index + 1
  }
}


#Equal Mixtures
for(rich in sort(rep(2:6, 3))) #3 reps at each richness level
{
  sp &lt;- sample(1:6, rich) #randomly pick species from pool

  for(j in 1:2) #2 technical reps
  {
    for(i in sp)
    {
      props[index, i+1] &lt;- 1/rich #equal proportions
    }
    index &lt;- index + 1
  }
}


#Unequal Mixtures
for(rich in sort(rep(c(2, 3, 4, 5, 6), 15))) #15 reps at each richness level
{
  sp &lt;- sample(1:6, rich, replace = TRUE) #randomly pick species from pool

  for(j in 1:2) #2 technical reps
  {
    for(i in 1:6)
    {
      props[index, i+1] &lt;- sum(sp==i)/rich #equal proportions
    }
    index &lt;- index + 1
  }
}


props[is.na(props)] &lt;- 0

mySimData &lt;- props

mySimData$treat &lt;- 0
mySimDataDupe &lt;- mySimData
mySimDataDupe$treat &lt;- 1
mySimData &lt;- rbind(mySimData, mySimDataDupe)

mySimData$plot &lt;- 1:nrow(mySimData)

mySimData$Y1 &lt;- NA
mySimData$Y2 &lt;- NA
mySimData$Y3 &lt;- NA
mySimData$Y4 &lt;- NA

ADDs &lt;- DImodels::DI_data(prop=2:7, what=c("ADD"), data=mySimData)
mySimData &lt;- cbind(mySimData, ADDs)

E_AV &lt;- DImodels::DI_data(prop=2:7, what=c("E", "AV"), data=mySimData)
mySimData &lt;- cbind(mySimData, E_AV)

n &lt;- 4 #Number of Ys
p &lt;- qr.Q(qr(matrix(stats::rnorm(n^2), n))) #Principal Components (make sure it's positive definite)
S &lt;- crossprod(p, p*(n:1)) #Sigma
m &lt;- stats::runif(n, -0.25, 1.5)

#runif(8, -1, 7) #decide on betas randomly

for(i in 1:nrow(mySimData))
{
  #Within subject error
  error &lt;- MASS::mvrnorm(n=1, mu=m, Sigma=S)
  mySimData$Y1[i] &lt;- 6.9*mySimData$p1[i] + -0.3*mySimData$p2[i] + 6.6*mySimData$p3[i] +
  1.7*mySimData$p4[i] + -0.8*mySimData$p5[i] + 4.3*mySimData$p6[i] + 3.5*mySimData$treat[i] +
  1.8*mySimData$AV[i] + error[1]
  mySimData$Y2[i] &lt;- 4.9*mySimData$p1[i] + 3.6*mySimData$p2[i] + 4.4*mySimData$p3[i] +
  2.3*mySimData$p4[i] + 4.3*mySimData$p5[i] + 6.6*mySimData$p6[i] + -0.3*mySimData$treat[i] +
  6.8*mySimData$AV[i] + error[2]
  mySimData$Y3[i] &lt;- -0.3*mySimData$p1[i] + 4.6*mySimData$p2[i] + 1.2*mySimData$p3[i] +
  6.8*mySimData$p4[i] + 1.4*mySimData$p5[i] + 6.9*mySimData$p6[i] + 5.5*mySimData$treat[i] +
  1.4*mySimData$AV[i] + error[3]
  mySimData$Y4[i] &lt;- 4.1*mySimData$p1[i] + 4.2*mySimData$p2[i] + -0.5*mySimData$p3[i] +
  4.9*mySimData$p4[i] + 6.7*mySimData$p5[i] + -0.9*mySimData$p6[i] + -1.0*mySimData$treat[i] +
  0.3*mySimData$AV[i] + error[4]
}

mySimData$treat &lt;- as.factor(mySimData$treat)

</code></pre>

<hr>
<h2 id='simMVRM'>
The simulated multivariate repeated measures &quot;simMVRM&quot; dataset
</h2><span id='topic+simMVRM'></span>

<h3>Description</h3>

<p>The <code>simMVRM</code> dataset was simulated from a multivariate repeated measures DI model. It contains
336 plots comprising of four species that vary in proportions (<code>p1</code> - <code>p4</code>). There are
three simulated responses (<code>Y1, Y2, Y3</code>), taken at two differing time points, recorded in a
wide data format (one column per response type). The data was simulated assuming that there were
existing covariances between the responses and between the time pointsand both species identity and
species interaction effects were present.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("simMVRM")</code></pre>


<h3>Format</h3>

<p>A data frame with 672 observations on the following 9 variables.
</p>

<dl>
<dt><code>plot</code></dt><dd><p>a factor vector indicating the ID of the experimental unit</p>
</dd>
<dt><code>p1</code></dt><dd><p>a numeric vector indicating the initial proportion of species 1</p>
</dd>
<dt><code>p2</code></dt><dd><p>a numeric vector indicating the initial proportion of species 2</p>
</dd>
<dt><code>p3</code></dt><dd><p>a numeric vector indicating the initial proportion of species 3</p>
</dd>
<dt><code>p4</code></dt><dd><p>a numeric vector indicating the initial proportion of species 4</p>
</dd>
<dt><code>Y1</code></dt><dd><p>a numeric vector indicating the response of ecosystem function 1</p>
</dd>
<dt><code>Y2</code></dt><dd><p>a numeric vector indicating the response of ecosystem function 2</p>
</dd>
<dt><code>Y3</code></dt><dd><p>a numeric vector indicating the response of ecosystem function 3</p>
</dd>
<dt><code>time</code></dt><dd><p>a factor with levels <code>1</code> <code>2</code></p>
</dd>
</dl>



<h3>Details</h3>

<p><b>What are Diversity-Interactions (DI) models?</b>
</p>
<p>Diversity-Interactions (DI) models (Kirwan <em>et al.</em>, 2009) are a set of tools for analysing and
interpreting data from experiments that explore the effects of species diversity on community-level
responses. We strongly recommend that users read the short introduction to Diversity-Interactions
models (available at: <code><a href="DImodels.html#topic+DImodels">DImodels</a></code>). Further information on
Diversity-Interactions models is also available in Kirwan <em>et al.</em>, 2009 and
Connolly <em>et al.</em>, 2013.
</p>
<p><b>Parameter values for the simulation</b>
</p>
<p>Multivariate repeated measures DI models take the general form of:
</p>
<p style="text-align: center;"><code class="reqn">{y}_{kmt} = {Identities}_{kmt} + {Interactions}_{kmt} + {Structures}_{kt} + {\epsilon}_{kmt}</code>
</p>

<p>where <code class="reqn">y</code> are the community-level responses, the <code class="reqn">Identities</code> are the effects of species
identities for each response and enter the model as individual species proportions measured at the
beginning of the time period, the <code class="reqn">Interactions</code> are the interactions among the species
proportions, while <code class="reqn">Structures</code> include other experimental structures such as blocks,
treatments, or density.
</p>
<p>The dataset <code>simRM</code> was simulated with:
</p>

<ul>
<li><p> identity effects for the four species for each time and ecosystem function:
</p>

<ul>
<li><p> Y1time1 = -1.0, 5.0, 2.8, -0.9
</p>
</li>
<li><p> Y1time2 = 0.5, 5.4, 4.9, -2.1
</p>
</li>
<li><p> Y2time1 = 0.1, 4.1, -0.5, 0.3
</p>
</li>
<li><p> Y2time2 = 2.3, 3.2, -3.1, 2.1
</p>
</li>
<li><p> Y3time1 = 0.9, 6.6, 3.5, 6.1
</p>
</li>
<li><p> Y3time2 = -0.1, 7.0, 2.8, 4.0
</p>
</li></ul>

</li>
<li><p> evenness interaction effect for each time and ecosystem function:
</p>

<ul>
<li><p> Y1time1 = -0.1
</p>
</li>
<li><p> Y1time2 = 12.0
</p>
</li>
<li><p> Y2time1 = 2.3
</p>
</li>
<li><p> Y2time2 = 1.6
</p>
</li>
<li><p> Y3time1 = 2.1
</p>
</li>
<li><p> Y3time2 = 6.8
</p>
</li></ul>

</li>
<li> <p><code class="reqn">\epsilon</code> assumed to have a multivaraite normal distribution with mean 0. An ecosystem
function matrix Sigma:
</p>

<table>
<tr>
 <td style="text-align: left;">
      [1,]  2.36  0.71  -0.29 </td>
</tr>
<tr>
 <td style="text-align: left;">
      [2,]  0.71  1.42  -0.39 </td>
</tr>
<tr>
 <td style="text-align: left;">
      [3,]  -0.29 -0.39 2.21 </td>
</tr>
<tr>
 <td style="text-align: left;">
    </td>
</tr>

</table>

<p>and a time matrix Sigma:
</p>

<table>
<tr>
 <td style="text-align: left;">
      [1,]  1.69  0.46  </td>
</tr>
<tr>
 <td style="text-align: left;">
      [2,]  0.46  1.31  </td>
</tr>
<tr>
 <td style="text-align: left;">

    </td>
</tr>

</table>

</li></ul>



<h3>References</h3>

<p>Dooley, A., Isbell, F., Kirwan, L., Connolly, J., Finn, J.A. and Brophy, C., 2015. <br />
Testing the effects of diversity on ecosystem multifunctionality using a multivariate model. <br />
Ecology Letters, 18(11), pp.1242-1251. <br />
</p>
<p>Finn, J.A., Kirwan, L., Connolly, J., Sebastia, M.T., Helgadottir, A., Baadshaug, O.H.,
Belanger, G., Black, A., Brophy, C., Collins, R.P. and Cop, J., 2013. <br />
Ecosystem function enhanced by combining four functional types of plant species in intensively
managed grassland mixtures: a 3-year continental-scale field experiment.<br />
Journal of Applied Ecology, 50(2), pp.365-375 .<br />
</p>
<p>Kirwan, L., Connolly, J., Finn, J.A., Brophy, C., Luscher, A., Nyfeler, D. and Sebastia, M.T.,
2009. <br />
Diversity-interaction modeling: estimating contributions of species identities and interactions
to ecosystem function. <br />
Ecology, 90(8), pp.2032-2038. <br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>###################################################################################################
###################################################################################################

## Modelling Example

# For a more thorough example of the workflow of this package, please see vignette
# DImulti_workflow using the following code:


vignette("DImulti_workflow")


head(simMVRM)

# We call DImulti() to fit a series of models, with increasing complexity, and test whether the
# additional terms are worth keeping.

# We begin with an ID DI model, ensuring to use method = "ML" as we will be comparing fixed effects

MVRMmodel &lt;- DImulti(y = 6:8, eco_func = c("Na", "un"), time = c("time", "CS"), unit_IDs = 1,
                   prop = 2:5, data = simMVRM, DImodel = "ID",
                   method = "ML")
print(MVRMmodel)

# Next, we include the simplest interaction structure available in this package, "AV", which adds
# a single extra term per ecosystem function and time point

MVRMmodel_AV &lt;- DImulti(y = 6:8, eco_func = c("Na", "un"), time = c("time", "CS"), unit_IDs = 1,
                   prop = 2:5, data = simMVRM, DImodel = "AV",
                   method = "ML")

anova(MVRMmodel, MVRMmodel_AV)

# We select the more model with the lower AIC/BIC value or we use the p-value of the likelihood
# ratio test to determine if we reject the null hypothesis that the extra terms in the model are
# equal to zero, which in this case is lower than our alpha value of 0.05, so we do reject this
# hypothesis and continue with our more complex model.
#
# We can continue increasing the complexity of the interaction structure in the same fashion, this
# time we elect to use the additive interaction structure

MVRMmodel_ADD &lt;- DImulti(y = 6:8, eco_func = c("Na", "un"), time = c("time", "CS"), unit_IDs = 1,
                   prop = 2:5, data = simMVRM, DImodel = "ADD",
                   method = "ML")

anova(MVRMmodel_AV, MVRMmodel_ADD)

# We fail to reject the null hypothesis and so we select the average interaction structure.
#
# Finally, we can also increase the model complexity via the inclusion of the non-linear parameter
# theta, which we can estimate, or select a value for. We also choose to estimate using the "REML"
# method as we will do no further fixed effect model comparisons


MVRMmodel_theta &lt;- DImulti(y = 6:8, eco_func = c("Na", "un"), time = c("time", "CS"), unit_IDs = 1,
                   prop = 2:5, data = simMVRM, DImodel = "AV",
                   estimate_theta = TRUE, method = "REML")

print(MVRMmodel_theta)


#Finally, we can utilise this model for our interpretation and predictions

head(predict(MVRMmodel_theta))


##################################################################################################
#
##################################################################################################

## Code to simulate data

set.seed(746)

props &lt;- data.frame(plot = integer(),
                    p1 = integer(),
                    p2 = integer(),
                    p3 = integer(),
                    p4 = integer())

index &lt;- 1 #row number

#Monocultures
for(i in 1:4) #6 species
{
  for(j in 1:3) #2 technical reps
  {
    props[index, i+1] &lt;- 1
    index &lt;- index + 1
  }
}


#Equal Mixtures
for(rich in sort(rep(2:4, 4))) #3 reps at each richness level
{
  sp &lt;- sample(1:4, rich) #randomly pick species from pool

  for(j in 1:2) #2 technical reps
  {
    for(i in sp)
    {
      props[index, i+1] &lt;- 1/rich #equal proportions
    }
    index &lt;- index + 1
  }
}


#Unequal Mixtures
for(rich in sort(rep(c(2, 3, 4), 50))) #15 reps at each richness level
{
  sp &lt;- sample(1:4, rich, replace = TRUE) #randomly pick species from pool

  for(j in 1:2) #2 technical reps
  {
    for(i in 1:4)
    {
      props[index, i+1] &lt;- sum(sp==i)/rich #equal proportions
    }
    index &lt;- index + 1
  }
}


props[is.na(props)] &lt;- 0

mySimData &lt;- props

ADDs &lt;- DImodels::DI_data(prop=2:5, what=c("ADD"), data=mySimData)
mySimData &lt;- cbind(mySimData, ADDs)

E_AV &lt;- DImodels::DI_data(prop=2:5, what=c("E", "AV"), data=mySimData)
mySimData &lt;- cbind(mySimData, E_AV)

mySimData$plot &lt;- 1:nrow(mySimData)

mySimData$Y1 &lt;- NA
mySimData$Y2 &lt;- NA
mySimData$Y3 &lt;- NA

mySimData$time &lt;- 1
mySimDataT1 &lt;- mySimData
mySimDataT2 &lt;- mySimData
mySimDataT2$time &lt;- 2


nT &lt;- 2 #Number of s
#Principal Components (make sure it's positive definite)
pT &lt;- qr.Q(qr(matrix(stats::rnorm(nT^2), nT)))
ST &lt;- crossprod(pT, pT*(nT:1)) #Sigma
mT &lt;- stats::runif(nT, -0.25, 1.5)

nY &lt;- 3 #Number of Ys
#Principal Components (make sure it's positive definite)
pY &lt;- qr.Q(qr(matrix(stats::rnorm(nY^2), nY)))
SY &lt;- crossprod(pY, pY*(nY:1)) #Sigma
mY &lt;- stats::runif(nY, -0.25, 1.5)


#runif(7, -1, 7) #decide on betas randomly
for(i in 1:nrow(mySimData))
{
  #Within subject error
  errorT &lt;- MASS::mvrnorm(n=1, mu=mT, Sigma=ST)
  errorY &lt;- MASS::mvrnorm(n=1, mu=mY, Sigma=SY)
  mySimDataT1$Y1[i] &lt;- -1.0*mySimDataT1$p1[i] + 5.0*mySimDataT1$p2[i] + 2.8*mySimDataT1$p3[i] +
  -0.9*mySimDataT1$p4[i] + -0.1*mySimDataT1$E[i] + errorT[1]*errorY[1]
  mySimDataT2$Y1[i] &lt;- 0.5*mySimDataT2$p1[i] + 5.4*mySimDataT2$p2[i] + 4.9*mySimDataT2$p3[i] +
  -2.1*mySimDataT2$p4[i] + 12.0*mySimDataT1$E[i] + errorT[2]*errorY[1]

  mySimDataT1$Y2[i] &lt;- 0.1*mySimDataT1$p1[i] + 4.1*mySimDataT1$p2[i] + -0.5*mySimDataT1$p3[i] +
  0.3*mySimDataT1$p4[i] + 2.3*mySimDataT1$E[i] + errorT[1]*errorY[2]
  mySimDataT2$Y2[i] &lt;- 2.3*mySimDataT2$p1[i] + 3.2*mySimDataT2$p2[i] + -3.1*mySimDataT2$p3[i] +
  2.1*mySimDataT2$p4[i] + 1.6*mySimDataT2$E[i] + errorT[2]*errorY[2]

  mySimDataT1$Y3[i] &lt;- 0.9*mySimDataT1$p1[i] + 6.6*mySimDataT1$p2[i] + 3.5*mySimDataT1$p3[i] +
  6.1*mySimDataT1$p4[i] + 2.1*mySimDataT1$E[i] + errorT[1]*errorY[3]
  mySimDataT2$Y3[i] &lt;- -0.1*mySimDataT2$p1[i] + 7.0*mySimDataT2$p2[i] + 2.8*mySimDataT2$p3[i] +
  4.0*mySimDataT2$p4[i] + 6.8*mySimDataT2$E[i] + errorT[2]*errorY[3]
}

mySimData &lt;- rbind(mySimDataT1, mySimDataT2)

mySimData$time &lt;- as.factor(mySimData$time)
mySimData$plot &lt;- as.factor(mySimData$plot)

</code></pre>

<hr>
<h2 id='simRM'>The simulated repeated measures &quot;simRM&quot; dataset</h2><span id='topic+simRM'></span>

<h3>Description</h3>

<p>The <code>simRM</code> dataset was simulated from a repeated measures DI model. It contains 116 plots
comprising of four species that vary in proportions (<code>p1</code> - <code>p4</code>). There is one simulated
response (<code>Y</code>), taken at three differing time points, recorded in a stacked data format (one
row per response value). The data was simulated assuming that there were existing covariances
between the responses, an additive treatment effect, and both species identity and species
interaction effects were present.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>data("simRM")</code></pre>


<h3>Format</h3>

<p>A data frame with 384 observations on the following seven variables.
</p>

<dl>
<dt><code>plot</code></dt><dd><p>A numeric vector identifying each unique experimental unit</p>
</dd>
<dt><code>p1</code></dt><dd><p>A numeric vector indicating the initial proportion of species 1</p>
</dd>
<dt><code>p2</code></dt><dd><p>A numeric vector indicating the initial proportion of species 2</p>
</dd>
<dt><code>p3</code></dt><dd><p>A numeric vector indicating the initial proportion of species 3</p>
</dd>
<dt><code>p4</code></dt><dd><p>A numeric vector indicating the initial proportion of species 4</p>
</dd>
<dt><code>Y</code></dt><dd><p>A numeric vector giving the simulated response for an ecosystem function</p>
</dd>
<dt><code>time</code></dt><dd><p>A three-level factor indicating the time point at which the response <code>Y</code> was recorded</p>
</dd>
</dl>



<h3>Details</h3>

<p><b>What are Diversity-Interactions (DI) models?</b>
</p>
<p>Diversity-Interactions (DI) models (Kirwan <em>et al.</em>, 2009) are a set of tools for analysing and
interpreting data from experiments that explore the effects of species diversity on community-level
responses. We strongly recommend that users read the short introduction to Diversity-Interactions
models (available at: <code><a href="DImodels.html#topic+DImodels">DImodels</a></code>). Further information on
Diversity-Interactions models is also available in Kirwan <em>et al.</em>, 2009 and
Connolly <em>et al.</em>, 2013.
</p>
<p><b>Parameter values for the simulation</b>
</p>
<p>Repeated measures DI models take the general form of:
</p>
<p style="text-align: center;"><code class="reqn">{y}_{mt} = {Identities}_{mt} + {Interactions}_{mt} + {Structures}_{t} + {\epsilon}_{mt}</code>
</p>

<p>where <code class="reqn">y</code> are the community-level responses, the <code class="reqn">Identities</code> are the effects of species
identities for each response and enter the model as individual species proportions measured at the
beginning of the time period, the <code class="reqn">Interactions</code> are the interactions among the species
proportions, while <code class="reqn">Structures</code> include other experimental structures such as blocks,
treatments, or density.
</p>
<p>The dataset <code>simRM</code> was simulated with:
</p>

<ul>
<li><p> identity effects for the four species for each time:
</p>

<ul>
<li><p> time1 = 4.1, 2.1, 3.6, 4.8
</p>
</li>
<li><p> time2 = 2.3, 2.4, 5.1, 5.0
</p>
</li>
<li><p> time3 = 0.7, 2.3, 6.5, 5.9
</p>
</li></ul>

</li>
<li><p> additive interaction effects for each time:
</p>

<ul>
<li><p> time1 = 3.3, 4.0, 1.3, 5.2
</p>
</li>
<li><p> time2 = 3.6, 4.5, 0.5, 6.5
</p>
</li>
<li><p> time3 = 4.5, 5.2, 0.6, 7.8
</p>
</li></ul>

</li>
<li> <p><code class="reqn">\epsilon</code> assumed to have a multivaraite normal distribution with mean 0 and Sigma:
</p>

<table>
<tr>
 <td style="text-align: left;">
      [1,]  2.01  -0.11  -0.08 </td>
</tr>
<tr>
 <td style="text-align: left;">
      [2,]  -0.11  2.96  0.21 </td>
</tr>
<tr>
 <td style="text-align: left;">
      [3,]  -0.08  0.21  1.03 </td>
</tr>
<tr>
 <td style="text-align: left;">
    </td>
</tr>

</table>

</li></ul>



<h3>References</h3>

<p>Dooley, A., Isbell, F., Kirwan, L., Connolly, J., Finn, J.A. and Brophy, C., 2015. <br />
Testing the effects of diversity on ecosystem multifunctionality using a multivariate model. <br />
Ecology Letters, 18(11), pp.1242-1251. <br />
</p>
<p>Finn, J.A., Kirwan, L., Connolly, J., Sebastia, M.T., Helgadottir, A., Baadshaug, O.H.,
Belanger, G., Black, A., Brophy, C., Collins, R.P. and Cop, J., 2013. <br />
Ecosystem function enhanced by combining four functional types of plant species in intensively
managed grassland mixtures: a 3-year continental-scale field experiment.<br />
Journal of Applied Ecology, 50(2), pp.365-375 .<br />
</p>
<p>Kirwan, L., Connolly, J., Finn, J.A., Brophy, C., Luscher, A., Nyfeler, D. and Sebastia, M.T.,
2009. <br />
Diversity-interaction modeling: estimating contributions of species identities and interactions
to ecosystem function. <br />
Ecology, 90(8), pp.2032-2038. <br />
</p>


<h3>Examples</h3>

<pre><code class='language-R'>###################################################################################################
###################################################################################################

## Modelling Example

# For a more thorough example of the workflow of this package, please see vignette
# DImulti_workflow using the following code:


vignette("DImulti_workflow")


head(simRM)

# We call DImulti() to fit a series of models, with increasing complexity, and test whether the
# additional terms are worth keeping.

# We begin with an ID DI model, ensuring to use method = "ML" as we will be comparing fixed effects

RMmodel &lt;- DImulti(y = "Y", time = c("time", "AR1"), unit_IDs = "plot",
                   prop = paste0("p", 1:4), data = simRM, DImodel = "ID",
                   method = "ML")
print(RMmodel)

# We can simplify the above model by grouping the ID effect terms into two categories, G1 and G2

RMmodel_ID &lt;- DImulti(y = "Y", time = c("time", "AR1"), unit_IDs = "plot",
                   prop = paste0("p", 1:4), data = simRM, DImodel = "ID",
                   ID = c("G1", "G1", "G2", "G2"),
                   method = "ML")

# We can compare the two models by calling the anova function to perform a likelihood ratio test

anova(RMmodel, RMmodel_ID)

# As the p-value &lt; an alpha value of 0.05, we reject the null hypthesis that the extra terms are
# equal to zero, therefore we continue with the larger model.
# We can confirm this result by selecting the model with the lower AIC value.

AIC(RMmodel); AIC(RMmodel_ID)

# Next, we include the simplest interaction structure available in this package, "AV", which adds
# a single extra term per ecosystem function

RMmodel_AV &lt;- DImulti(y = "Y", time = c("time", "AR1"), unit_IDs = "plot",
                   prop = paste0("p", 1:4), data = simRM, DImodel = "AV",
                   method = "ML")

anova(RMmodel, RMmodel_AV)

# Once again, we select the more complex model.
#
# We can continue increasing the complexity of the interaction structure in the same fashion, this
# time we elect to use the additive interaction structure

RMmodel_ADD &lt;- DImulti(y = "Y", time = c("time", "AR1"), unit_IDs = "plot",
                   prop = paste0("p", 1:4), data = simRM, DImodel = "ADD",
                   method = "ML")

anova(RMmodel_AV, RMmodel_ADD)

# We continue with the additive interactions structure, the next interaction structure to test
# functional group interactions, is not nested with our additive model, so we compare th two using
# information criterion. In this case we choose to use AICc, to better penalise extra terms, as AIC
# becomes biased towards the more complex model as parameters numbers increase.
# The functional group strcuture requires an additional parameter, FG, to specify groups.

RMmodel_FG &lt;- DImulti(y = "Y", time = c("time", "AR1"), unit_IDs = "plot",
                   prop = paste0("p", 1:4), data = simRM, DImodel = "FG",
                   FG = c("G1", "G1", "G2", "G2"),
                   method = "ML")

AICc(RMmodel_ADD); AICc(RMmodel_FG)

# In this case, we choose the lower valued model, which is the additive structure.
#
# The last interaction structure to test is the full pairwise model. Which we can see is not worth
# the extra terms. So our final interaction structure chosen is additive.

RMmodel_FULL &lt;- DImulti(y = "Y", time = c("time", "AR1"), unit_IDs = "plot",
                   prop = paste0("p", 1:4), data = simRM, DImodel = "FULL",
                   method = "ML")

anova(RMmodel_ADD, RMmodel_FULL)

# Finally, we can also increase the model complexity via the inclusion of the non-linear parameter
# theta, which we can estimate, or select a value for. We also choose to estimate using the "REML"
# method as we will do no further fixed effect model comparisons

RMmodel_theta &lt;- DImulti(y = "Y", time = c("time", "AR1"), unit_IDs = "plot",
                      prop = paste0("p", 1:4), data = simRM, DImodel = "ADD",
                      estimate_theta = TRUE, method = "REML")

print(RMmodel_theta)

# We can however test changes to the correlation structure, testing the AR(1) structure we have been
# using against the simpler CS strcuture.

RMmodel_CS &lt;- DImulti(y = "Y", time = c("time", "CS"), unit_IDs = "plot",
                      prop = paste0("p", 1:4), data = simRM, DImodel = "ADD",
                      theta = 0.9991, method = "REML")

AICc(RMmodel_theta); AICc(RMmodel_CS)

# We see that they are practically identical, but the AR(1) strcuture is preffered.

##################################################################################################
#
##################################################################################################

## Code to simulate data

set.seed(523)

props &lt;- data.frame(plot = integer(),
                    p1 = integer(),
                    p2 = integer(),
                    p3 = integer(),
                    p4 = integer())

index &lt;- 1 #row number

#Monocultures
for(i in 1:4) #4 species
{
  for(j in 1:2) #2 technical reps
  {
    props[index, i+1] &lt;- 1
    index &lt;- index + 1
  }
}


#Equal Mixtures
for(rich in sort(rep(2:4, 3))) #3 reps at each richness level
{
  sp &lt;- sample(1:4, rich) #randomly pick species from pool

  for(j in 1:2) #2 technical reps
  {
    for(i in sp)
    {
      props[index, i+1] &lt;- 1/rich #equal proportions
    }
    index &lt;- index + 1
  }
}


#Unequal Mixtures
for(rich in sort(rep(c(2, 3, 4), 15))) #15 reps at each richness level
{
  sp &lt;- sample(1:4, rich, replace = TRUE) #randomly pick species from pool

  for(j in 1:2) #2 technical reps
  {
    for(i in 1:4)
    {
      props[index, i+1] &lt;- sum(sp==i)/rich #equal proportions
    }
    index &lt;- index + 1
  }
}


props[is.na(props)] &lt;- 0

mySimData &lt;- props
mySimData$Y &lt;- NA

ADDs &lt;- DImodels::DI_data(prop=2:5, what=c("ADD"), data=mySimData)
mySimData &lt;- cbind(mySimData, ADDs)

E_AV &lt;- DImodels::DI_data(prop=2:5, what=c("E", "AV"), data=mySimData)
mySimData &lt;- cbind(mySimData, E_AV)

mySimData$plot &lt;- 1:nrow(mySimData)

mySimData$time &lt;- 1
mySimDataT1 &lt;- mySimData
mySimDataT2 &lt;- mySimData
mySimDataT3 &lt;- mySimData
mySimDataT2$time &lt;- 2
mySimDataT3$time &lt;- 3


n &lt;- 3 #Number of Ys
p &lt;- qr.Q(qr(matrix(stats::rnorm(n^2), n))) #Principal Components (make sure it's positive definite)
S &lt;- crossprod(p, p*(n:1)) #Sigma
m &lt;- stats::runif(n, -0.25, 1.5)

#runif(11, -1, 7) #decide on betas randomly

for(i in 1:nrow(mySimData))
{
  #Within subject error
  error &lt;- MASS::mvrnorm(n=1, mu=m, Sigma=S)
  mySimDataT1$Y[i] &lt;- 4.1*mySimDataT1$p1[i] + 2.1*mySimDataT1$p2[i] + 3.6*mySimDataT1$p3[i] +
  4.8*mySimDataT1$p4[i] + 3.3*mySimDataT1$p1_add[i] + 4.0*mySimDataT1$p2_add[i] +
  1.3*mySimDataT1$p3_add[i] + 5.2*mySimDataT1$p4_add[i] + error[1]
  mySimDataT2$Y[i] &lt;- 2.3*mySimDataT2$p1[i] + 2.4*mySimDataT2$p2[i] + 5.1*mySimDataT2$p3[i] +
  5.0*mySimDataT2$p4[i] + 3.6*mySimDataT2$p1_add[i] + 4.5*mySimDataT2$p2_add[i] +
  0.5*mySimDataT2$p3_add[i] + 6.5*mySimDataT2$p4_add[i] + error[2]
  mySimDataT3$Y[i] &lt;- 0.7*mySimDataT3$p1[i] + 2.3*mySimDataT3$p2[i] + 6.5*mySimDataT3$p3[i] +
  5.9*mySimDataT3$p4[i] + 4.5*mySimDataT3$p1_add[i] + 5.2*mySimDataT3$p2_add[i] +
  0.6*mySimDataT3$p3_add[i] + 7.8*mySimDataT3$p4_add[i] + error[3]
}

mySimData &lt;- rbind(mySimDataT1, mySimDataT2)
mySimData &lt;- rbind(mySimData, mySimDataT3)

mySimData$time &lt;- as.factor(mySimData$time)
mySimData$plot &lt;- as.factor(mySimData$plot)

</code></pre>

<hr>
<h2 id='summary.DImulti'>summary.DImulti</h2><span id='topic+summary.DImulti'></span>

<h3>Description</h3>

<p>Print a summary of the fitted DI models supplied
</p>


<h3>Usage</h3>

<pre><code class='language-R'>## S3 method for class 'DImulti'
summary(object, verbose = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="summary.DImulti_+3A_object">object</code></td>
<td>
<p>an object inheriting from class DImulti, representing a generalized least squared fitted linear model using the
Diversity-Interactions framework</p>
</td></tr>
<tr><td><code id="summary.DImulti_+3A_verbose">verbose</code></td>
<td>
<p>an optional logical value used to control the amount of output when the object is printed. Defaults to FALSE.</p>
</td></tr>
<tr><td><code id="summary.DImulti_+3A_...">...</code></td>
<td>
<p>some methods for this generic function require additional arguments. None are used in
this method.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>an object inheriting from class summary.gls with all components included in object (see glsObject for a full description of the
components) plus the following components:
</p>
<p>corBeta,
approximate correlation matrix for the coefficients estimates
</p>
<p>tTable,
a matrix with columns Value, Std. Error, t-value, and p-value representing respectively the coefficients estimates, their approximate
standard errors, the ratios between the estimates and their standard errors, and the associated p-value under a
t approximation. Rows correspond to the different coefficients.
</p>
<p>residuals,
if more than five observations are used in the gls fit, a vector with the minimum, first quartile, median, third quartile, and maximum of
the residuals distribution; else the residuals.
</p>
<p>AIC,
the Akaike Information Criterion corresponding to object.
</p>
<p>BIC,
the Bayesian Information Criterion corresponding to object.
</p>
<p>theta,
the values of the non-linear parameter theta used in the model
</p>


<h3>See Also</h3>

<p><code><a href="nlme.html#topic+summary.gls">summary.gls</a></code> which this function wraps.
</p>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
