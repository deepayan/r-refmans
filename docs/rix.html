<!DOCTYPE html><html lang="en"><head><title>Help for package rix</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R-nav.css" />
</head><body><div class="container"><nav class="package" aria-label="Topic Navigation">
<div class="dropdown-menu">
<h1>Package {rix}</h1>
<h2>Contents</h2>
<ul class="menu">
<li><a href='#available_dates'><p>List available dates.</p></a></li>
<li><a href='#available_df'><p>Return data frame with R, Bioc versions and supported platforms</p></a></li>
<li><a href='#available_r'><p>List available R versions from the rstats-on-nix fork of Nixpkgs</p></a></li>
<li><a href='#ga_cachix'><p>ga_cachix Build an environment on GitHub Actions and cache it on Cachix</p></a></li>
<li><a href='#make_launcher'><p>Create a startup script to launch an editor inside of a Nix shell</p></a></li>
<li><a href='#nix_build'><p>Invoke shell command <code>nix-build</code> from an R session</p></a></li>
<li><a href='#read_renv_lock'><p>read_renv_lock</p></a></li>
<li><a href='#renv_lock_r_ver'><p>renv_lock_r_ver</p></a></li>
<li><a href='#renv_remote_pkgs'><p>renv_remote_pkgs</p></a></li>
<li><a href='#renv2nix'><p>renv2nix</p></a></li>
<li><a href='#rix'><p>Generate a Nix expression that builds a reproducible development environment</p></a></li>
<li><a href='#rix_init'><p>Initiate and maintain an isolated, project-specific, and runtime-pure R</p>
setup via Nix.</a></li>
<li><a href='#setup_cachix'><p>setup_cachix Setup up the rstats-on-nix binary repository</p></a></li>
<li><a href='#tar_nix_ga'><p>tar_nix_ga Run a {targets}  pipeline on GitHub Actions.</p></a></li>
<li><a href='#with_nix'><p>Evaluate function in R or shell command via <code>nix-shell</code> environment</p></a></li>
</ul>
</div>
<hr>
</nav>
<main>
<table role='presentation'>
<tr>
<td>Title:</td>
<td>Reproducible Data Science Environments with 'Nix'</td>
</tr>
<tr>
<td>Version:</td>
<td>0.15.7</td>
</tr>
<tr>
<td>Description:</td>
<td>Simplifies the creation of reproducible data science environments
    using the 'Nix' package manager, as described in
    Dolstra (2006) &lt;ISBN 90-393-4130-3&gt;. The included &lsquo;rix()'
    function generates a complete description of the environment as a
    'default.nix' file, which can then be built using &rsquo;Nix'. This results in
    project specific software environments with pinned versions of R, packages,
    linked system dependencies, and other tools. Additional helpers make it easy
    to run R code in 'Nix' software environments for testing and production.</td>
</tr>
<tr>
<td>License:</td>
<td><a href="https://www.r-project.org/Licenses/GPL-3">GPL (&ge; 3)</a></td>
</tr>
<tr>
<td>URL:</td>
<td><a href="https://docs.ropensci.org/rix/">https://docs.ropensci.org/rix/</a></td>
</tr>
<tr>
<td>BugReports:</td>
<td><a href="https://github.com/ropensci/rix/issues">https://github.com/ropensci/rix/issues</a></td>
</tr>
<tr>
<td>Depends:</td>
<td>R (&ge; 2.10)</td>
</tr>
<tr>
<td>Imports:</td>
<td>codetools, curl, jsonlite, sys, utils</td>
</tr>
<tr>
<td>Suggests:</td>
<td>knitr, rmarkdown, testthat</td>
</tr>
<tr>
<td>VignetteBuilder:</td>
<td>knitr</td>
</tr>
<tr>
<td>Config/testthat/edition:</td>
<td>3</td>
</tr>
<tr>
<td>Encoding:</td>
<td>UTF-8</td>
</tr>
<tr>
<td>RoxygenNote:</td>
<td>7.3.2</td>
</tr>
<tr>
<td>NeedsCompilation:</td>
<td>no</td>
</tr>
<tr>
<td>Packaged:</td>
<td>2025-03-17 10:22:08 UTC; b-rodrigues</td>
</tr>
<tr>
<td>Author:</td>
<td>Bruno Rodrigues <a href="https://orcid.org/0000-0002-3211-3689"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut, cre],
  Philipp Baumann <a href="https://orcid.org/0000-0002-3194-8975"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [aut],
  David Watkins [rev] (David reviewed the package (v. 0.9.1) for
    rOpenSci, see
    &lt;https://github.com/ropensci/software-review/issues/625&gt;),
  Jacob Wujiciak-Jens
    <a href="https://orcid.org/0000-0002-7281-3989"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a> [rev] (Jacob
    reviewed the package (v. 0.9.1) for rOpenSci, see
    &lt;https://github.com/ropensci/software-review/issues/625&gt;),
  Richard J. Acton <a href="https://orcid.org/0000-0002-2574-9611"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Jordi Rosell <a href="https://orcid.org/0000-0002-4349-1458"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Elio Campitelli <a href="https://orcid.org/0000-0002-7742-9230"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  László Kupcsik <a href="https://orcid.org/0000-0003-3535-5496"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb],
  Michael Heming <a href="https://orcid.org/0000-0002-9568-2790"><img alt="ORCID iD"  src="https://cloud.R-project.org/web/orcid.svg" style="width:16px; height:16px; margin-left:4px; margin-right:4px; vertical-align:middle" /></a>
    [ctb]</td>
</tr>
<tr>
<td>Maintainer:</td>
<td>Bruno Rodrigues &lt;bruno@brodrigues.co&gt;</td>
</tr>
<tr>
<td>Repository:</td>
<td>CRAN</td>
</tr>
<tr>
<td>Date/Publication:</td>
<td>2025-03-17 11:30:02 UTC</td>
</tr>
</table>
<hr>
<h2 id='available_dates'>List available dates.</h2><span id='topic+available_dates'></span>

<h3>Description</h3>

<p>List available dates.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>available_dates()
</code></pre>


<h3>Value</h3>

<p>A character vector containing the available dates
</p>


<h3>Examples</h3>

<pre><code class='language-R'>available_dates()
</code></pre>

<hr>
<h2 id='available_df'>Return data frame with R, Bioc versions and supported platforms</h2><span id='topic+available_df'></span>

<h3>Description</h3>

<p>Return data frame with R, Bioc versions and supported platforms
</p>


<h3>Usage</h3>

<pre><code class='language-R'>available_df()
</code></pre>


<h3>Value</h3>

<p>A data frame
</p>


<h3>Examples</h3>

<pre><code class='language-R'>available_dates()
</code></pre>

<hr>
<h2 id='available_r'>List available R versions from the rstats-on-nix fork of Nixpkgs</h2><span id='topic+available_r'></span>

<h3>Description</h3>

<p>List available R versions from the rstats-on-nix fork of Nixpkgs
</p>


<h3>Usage</h3>

<pre><code class='language-R'>available_r()
</code></pre>


<h3>Value</h3>

<p>A character vector containing the available R versions.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>available_r()
</code></pre>

<hr>
<h2 id='ga_cachix'>ga_cachix Build an environment on GitHub Actions and cache it on Cachix</h2><span id='topic+ga_cachix'></span>

<h3>Description</h3>

<p>ga_cachix Build an environment on GitHub Actions and cache it on Cachix
</p>


<h3>Usage</h3>

<pre><code class='language-R'>ga_cachix(cache_name, path_default)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="ga_cachix_+3A_cache_name">cache_name</code></td>
<td>
<p>String, name of your cache.</p>
</td></tr>
<tr><td><code id="ga_cachix_+3A_path_default">path_default</code></td>
<td>
<p>String, relative path (from the root directory of your project)
to the <code>default.nix</code> to build.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function puts a <code>.yaml</code> file inside the <code style="white-space: pre;">&#8288;.github/workflows/&#8288;</code>
folders on the root of your project. This workflow file will use the
projects <code>default.nix</code> file to generate the development environment on
GitHub Actions and will then cache the created binaries in Cachix. Create a
free account on Cachix to use this action. Refer to
<code>vignette("z-binary_cache")</code> for detailed instructions. Make sure to give
read and write permissions to the GitHub Actions bot.
</p>


<h3>Value</h3>

<p>Nothing, copies file to a directory.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
ga_cachix("my-cachix", path_default = "default.nix")

## End(Not run)
</code></pre>

<hr>
<h2 id='make_launcher'>Create a startup script to launch an editor inside of a Nix shell</h2><span id='topic+make_launcher'></span>

<h3>Description</h3>

<p>Create a startup script to launch an editor inside of a Nix shell
</p>


<h3>Usage</h3>

<pre><code class='language-R'>make_launcher(editor, project_path)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="make_launcher_+3A_editor">editor</code></td>
<td>
<p>Character, the command to launch the editor. See the &quot;Details&quot; section below for more information.</p>
</td></tr>
<tr><td><code id="make_launcher_+3A_project_path">project_path</code></td>
<td>
<p>Character, where to write the launcher, for example
&quot;/home/path/to/project&quot;. The file will thus be written to the file
&quot;/home/path/to/project/start-editor.sh&quot;. If the folder does not exist, it will
be created.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function will write a launcher to start an IDE inside of a
Nix shell. With a launcher, you only need to execute it instead of first
having to drop into the shell using <code>nix-shell</code> and then type the command
to run the IDE. For security reasons, this script is not executable upon
creation, so you need to make it executable first by running
<code style="white-space: pre;">&#8288;chmod +x start-editor.sh&#8288;</code> (replace <code>editor</code> with whichever editor you use).
You don’t need this launcher if you use <code>direnv</code>;
see <code>vignette("e-configuring-ide")</code> for more details.
</p>


<h3>Value</h3>

<p>Nothing, writes a script.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>available_dates()
</code></pre>

<hr>
<h2 id='nix_build'>Invoke shell command <code>nix-build</code> from an R session</h2><span id='topic+nix_build'></span>

<h3>Description</h3>

<p>Invoke shell command <code>nix-build</code> from an R session
</p>


<h3>Usage</h3>

<pre><code class='language-R'>nix_build(
  project_path = getwd(),
  message_type = c("simple", "quiet", "verbose"),
  args = NULL
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="nix_build_+3A_project_path">project_path</code></td>
<td>
<p>Path to the folder where the <code>default.nix</code> file resides.</p>
</td></tr>
<tr><td><code id="nix_build_+3A_message_type">message_type</code></td>
<td>
<p>Character vector with messaging type. Either <code>"simple"</code>
(default), <code>"quiet"</code> for no messaging, or <code>"verbose"</code>.</p>
</td></tr>
<tr><td><code id="nix_build_+3A_args">args</code></td>
<td>
<p>A character vector of additional arguments to be passed directly to
the <code>nix-build</code> command. If the project directory (i.e. <code>project_path</code>) is not
included in <code>args</code>, it will be appended automatically.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function is a wrapper for the <code>nix-build</code> command-line interface.
Users can supply any flags supported by <code>nix-build</code> via the <code>args</code> parameter.
If no custom arguments are provided, only the project directory is passed.
</p>


<h3>Value</h3>

<p>Integer of the process ID (PID) of the <code>nix-build</code> shell command
launched, if the <code>nix_build()</code> call is assigned to an R object.
Otherwise, it will be returned invisibly.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
  # Run nix-build with default arguments (project directory)
  nix_build()

  # Run nix-build with custom arguments
  nix_build(args = c("--max-jobs", "2", "--quiet"))

## End(Not run)
</code></pre>

<hr>
<h2 id='read_renv_lock'>read_renv_lock</h2><span id='topic+read_renv_lock'></span>

<h3>Description</h3>

<p>Reads renv.lock if it exists and can be parsed as json.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>read_renv_lock(renv_lock_path = "renv.lock")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="read_renv_lock_+3A_renv_lock_path">renv_lock_path</code></td>
<td>
<p>location of the renv.lock file, defaults to &quot;renv.lock&quot;</p>
</td></tr>
</table>


<h3>Value</h3>

<p>the result of reading renv.lock with <a href="jsonlite.html#topic+read_json">jsonlite::read_json</a>
</p>

<hr>
<h2 id='renv_lock_r_ver'>renv_lock_r_ver</h2><span id='topic+renv_lock_r_ver'></span>

<h3>Description</h3>

<p>renv_lock_r_ver
</p>


<h3>Usage</h3>

<pre><code class='language-R'>renv_lock_r_ver(renv_lock, override_r_ver = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="renv_lock_r_ver_+3A_renv_lock">renv_lock</code></td>
<td>
<p>renv.lock file from which to get the R version</p>
</td></tr>
<tr><td><code id="renv_lock_r_ver_+3A_override_r_ver">override_r_ver</code></td>
<td>
<p>Character, override the R version defined in the
<code>renv.lock</code> file with another version. This is especially useful if
the <code>renv.lock</code> file lists a version of R not (yet) available through Nix.
Can also be a date.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a length 1 character vector with the version of R recorded in
renv.lock
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
rix(r_ver = renv_lock_r_ver())

## End(Not run)
</code></pre>

<hr>
<h2 id='renv_remote_pkgs'>renv_remote_pkgs</h2><span id='topic+renv_remote_pkgs'></span>

<h3>Description</h3>

<p>Construct a list to be passed the git_pkgs argument of <a href="#topic+rix">rix</a>
The list returned contains the information necessary to have nix attempt to
build the packages from their external repositories.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>renv_remote_pkgs(renv_lock_remote_pkgs, host = NULL)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="renv_remote_pkgs_+3A_renv_lock_remote_pkgs">renv_lock_remote_pkgs</code></td>
<td>
<p>the list of package information from an renv.lock file.</p>
</td></tr>
<tr><td><code id="renv_remote_pkgs_+3A_host">host</code></td>
<td>
<p>the host of remote package, defaults to NULL meaning the RemoteHost of the
renv entry will be used.
currently supported hosts: 'api.github.com' 'gitlab.com'
see <a href="https://remotes.r-lib.org/">remotes</a> for more.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>a list of lists with three elements named:
&quot;package_name&quot;, &quot;repo_url&quot;, &quot;commit&quot;
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
renv_remote_pkgs(read_renv_lock()$Packages)

## End(Not run)
</code></pre>

<hr>
<h2 id='renv2nix'>renv2nix</h2><span id='topic+renv2nix'></span>

<h3>Description</h3>

<p>renv2nix
</p>


<h3>Usage</h3>

<pre><code class='language-R'>renv2nix(
  renv_lock_path = "renv.lock",
  project_path,
  return_rix_call = FALSE,
  method = c("fast", "accurate"),
  override_r_ver = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="renv2nix_+3A_renv_lock_path">renv_lock_path</code></td>
<td>
<p>Character, path of the renv.lock file, defaults to
&quot;renv.lock&quot;</p>
</td></tr>
<tr><td><code id="renv2nix_+3A_project_path">project_path</code></td>
<td>
<p>Character, where to write <code>default.nix</code>, for example
&quot;/home/path/to/project&quot;. The file will thus be written to the file
&quot;/home/path/to/project/default.nix&quot;. If the folder does not exist, it will
be created.</p>
</td></tr>
<tr><td><code id="renv2nix_+3A_return_rix_call">return_rix_call</code></td>
<td>
<p>Logical, return the generated rix function call
instead of evaluating it this is for debugging purposes, defaults to
<code>FALSE</code></p>
</td></tr>
<tr><td><code id="renv2nix_+3A_method">method</code></td>
<td>
<p>Character, the method of generating a nix environment from an
renv.lock file. &quot;fast&quot; is an inexact conversion which simply extracts the R
version and a list of all the packages in an renv.lock file and adds them
to the <code>r_pkgs</code> argument of <code>rix()</code>. This will use a snapshot of <code>nixpkgs</code>
that should contain package versions that are not too different from the
ones defined in the <code>renv.lock</code> file. For packages installed from GitHub or
similar, an attempt is made to handle them and pass them to the <code>git_pkgs</code>
argument of <code>rix()</code>. Currently defaults to &quot;fast&quot;, &quot;accurate&quot; is not yet
implemented.</p>
</td></tr>
<tr><td><code id="renv2nix_+3A_override_r_ver">override_r_ver</code></td>
<td>
<p>Character, defaults to NULL, override the R version
defined in the <code>renv.lock</code> file with another version. This is especially
useful if the <code>renv.lock</code> file lists a version of R not (yet) available
through Nix, or if the R version included in the <code>renv.lock</code> is too old
compared to the package versions. Can also be a date, check
<code>available_dates()</code>.</p>
</td></tr>
<tr><td><code id="renv2nix_+3A_...">...</code></td>
<td>

<p>Arguments passed on to <code><a href="#topic+rix">rix</a></code>
</p>

<dl>
<dt><code>system_pkgs</code></dt><dd><p>Vector of characters. List further software you wish to
install that are not R packages such as command line applications for
example. You can look for available software on the NixOS website
<a href="https://search.nixos.org/packages?channel=unstable&amp;from=0&amp;size=50&amp;sort=relevance&amp;type=packages&amp;query=">https://search.nixos.org/packages?channel=unstable&amp;from=0&amp;size=50&amp;sort=relevance&amp;type=packages&amp;query=</a></p>
</dd>
<dt><code>local_r_pkgs</code></dt><dd><p>List. A list of local packages to install. These packages
need to be in the <code>.tar.gz</code> or <code>.zip</code> formats and must be in the same
folder as the generated &quot;default.nix&quot; file.</p>
</dd>
<dt><code>tex_pkgs</code></dt><dd><p>Vector of characters. A set of TeX packages to install. Use
this if you need to compile <code>.tex</code> documents, or build PDF documents using
Quarto. If you don't know which package to add, start by adding &quot;amsmath&quot;.
See the
<code>vignette("d2- installing-system-tools-and-texlive-packages-in-a-nix-environment")</code>
for more details.</p>
</dd>
<dt><code>py_pkgs</code></dt><dd><p>List. A list of two elements, <code>py_version</code> and <code>py_pkgs</code>.
<code>py_version</code> must be of the form <code>"3.12"</code> for Python 3.12 and <code>py_pkgs</code>
must be an atomic vector of packages names, for example
<code>py_pkgs = c("polars", "plotnine", "great-tables")</code>.</p>
</dd>
<dt><code>ide</code></dt><dd><p>Character, defaults to &quot;none&quot;. If you wish to use RStudio to work
interactively use &quot;rstudio&quot; or &quot;rserver&quot; for the server version. Use &quot;code&quot;
for Visual Studio Code or &quot;codium&quot; for Codium, or &quot;positron&quot; for Positron.
You can also use &quot;radian&quot;, an interactive REPL. This will install a
project-specific version of the chosen editor which will be differrent than
the one already present in your system (if any). For other editors or if
you want to use an editor already installed on your system (which will
require some configuration to make it work seamlessly with Nix shells see
the <code>vignette("e-configuring-ide")</code> for configuration examples), use
&quot;none&quot;. Please be aware that VS Code and Positron are not free software. To
facilitate their installation, <code>rix()</code> automatically enables a required
setting without prompting the user for confirmation. See the &quot;Details&quot;
section below for more information.</p>
</dd>
<dt><code>overwrite</code></dt><dd><p>Logical, defaults to FALSE. If TRUE, overwrite the
<code>default.nix</code> file in the specified path.</p>
</dd>
<dt><code>print</code></dt><dd><p>Logical, defaults to FALSE. If TRUE, print <code>default.nix</code> to
console.</p>
</dd>
<dt><code>message_type</code></dt><dd><p>Character. Message type, defaults to <code>"simple"</code>, which
gives minimal but sufficient feedback. Other values are currently
<code style="white-space: pre;">&#8288;"quiet&#8288;</code>, which generates the files without message, and <code>"verbose"</code>,
displays all the messages.</p>
</dd>
<dt><code>shell_hook</code></dt><dd><p>Character of length 1, defaults to <code>NULL</code>. Commands added
to the <code>shellHook</code> variable are executed when the Nix shell starts. So by
default, using <code style="white-space: pre;">&#8288;nix-shell default.nix&#8288;</code> will start a specific program,
possibly with flags (separated by space), and/or do shell actions. You can
for example use <code>shell_hook = R</code>, if you want to directly enter the
declared Nix R session when dropping into the Nix shell.</p>
</dd>
</dl>
</td></tr>
</table>


<h3>Details</h3>

<p>In order for this function to work properly, we recommend not
running it inside the same folder as an existing <code>{renv}</code> project. Instead,
run it from a new, empty directory which path you pass to <code>project_path</code>,
and use <code>renv_lock_path</code> to point to the <code>renv.lock</code> file in the original
<code>{renv}</code> folder. We recommend that you start from an empty folder to hold
your new Nix project, and copy the <code>renv.lock</code> file only (not any of the
other files and folders generated by <code>{renv}</code>) and then call <code>renv2nix()</code>
there. For more details, see <code>vignette("f-renv2nix")</code>.
</p>


<h3>Value</h3>

<p>Nothing, this function is called for its side effects only, unless
<code>return_rix_call = TRUE</code> in which case an unevaluated call to <code>rix()</code> is
returned
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# if the lock file is in another folder
renv2nix(
  renv_lock_path = "path/to/original/renv_project/renv.lock",
  project_path = "path/to/rix_project"
)
# you could also copy the renv.lock file in the folder of the Nix
# project (don’t copy any other files generated by `{renv}`)
renv2nix(
  renv_lock_path = "path/to/rix_project/renv.lock",
  project_path = "path/to/rix_project"
)

## End(Not run)

</code></pre>

<hr>
<h2 id='rix'>Generate a Nix expression that builds a reproducible development environment</h2><span id='topic+rix'></span>

<h3>Description</h3>

<p>Generate a Nix expression that builds a reproducible development environment
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rix(
  r_ver = NULL,
  date = NULL,
  r_pkgs = NULL,
  system_pkgs = NULL,
  git_pkgs = NULL,
  local_r_pkgs = NULL,
  tex_pkgs = NULL,
  py_pkgs = NULL,
  ide = "none",
  project_path,
  overwrite = FALSE,
  print = FALSE,
  message_type = "simple",
  shell_hook = NULL,
  ignore_remotes_cache = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rix_+3A_r_ver">r_ver</code></td>
<td>
<p>Character. The required R version, for example &quot;4.0.0&quot;. You can
check which R versions are available using <code>available_r()</code>, and for more
details check <code>available_df()</code>. For reproducibility purposes, you can also
provide a <code>nixpkgs</code> revision directly. For older versions of R, <code>nix-build</code>
might fail with an error stating 'this derivation is not meant to be
built'. In this case, simply drop into the shell with <code>nix-shell</code> instead
of building it first. It is also possible to provide either &quot;bleeding-edge&quot;
or &quot;frozen-edge&quot; if you need an environment with bleeding edge packages.
Read more in the &quot;Details&quot; section below.</p>
</td></tr>
<tr><td><code id="rix_+3A_date">date</code></td>
<td>
<p>Character. Instead of providing <code>r_ver</code>, it is also possible to
provide a date. This will build an environment containing R and R packages
(and other dependencies) as of that date. You can check which dates are
available with <code>available_dates()</code>. For more details about versions check
<code>available_df()</code>.</p>
</td></tr>
<tr><td><code id="rix_+3A_r_pkgs">r_pkgs</code></td>
<td>
<p>Vector of characters. List the required R packages for your
analysis here.</p>
</td></tr>
<tr><td><code id="rix_+3A_system_pkgs">system_pkgs</code></td>
<td>
<p>Vector of characters. List further software you wish to
install that are not R packages such as command line applications for
example. You can look for available software on the NixOS website
<a href="https://search.nixos.org/packages?channel=unstable&amp;from=0&amp;size=50&amp;sort=relevance&amp;type=packages&amp;query=">https://search.nixos.org/packages?channel=unstable&amp;from=0&amp;size=50&amp;sort=relevance&amp;type=packages&amp;query=</a></p>
</td></tr>
<tr><td><code id="rix_+3A_git_pkgs">git_pkgs</code></td>
<td>
<p>List. A list of packages to install from Git. See details for
more information.</p>
</td></tr>
<tr><td><code id="rix_+3A_local_r_pkgs">local_r_pkgs</code></td>
<td>
<p>List. A list of local packages to install. These packages
need to be in the <code>.tar.gz</code> or <code>.zip</code> formats and must be in the same
folder as the generated &quot;default.nix&quot; file.</p>
</td></tr>
<tr><td><code id="rix_+3A_tex_pkgs">tex_pkgs</code></td>
<td>
<p>Vector of characters. A set of TeX packages to install. Use
this if you need to compile <code>.tex</code> documents, or build PDF documents using
Quarto. If you don't know which package to add, start by adding &quot;amsmath&quot;.
See the
<code>vignette("d2- installing-system-tools-and-texlive-packages-in-a-nix-environment")</code>
for more details.</p>
</td></tr>
<tr><td><code id="rix_+3A_py_pkgs">py_pkgs</code></td>
<td>
<p>List. A list of two elements, <code>py_version</code> and <code>py_pkgs</code>.
<code>py_version</code> must be of the form <code>"3.12"</code> for Python 3.12 and <code>py_pkgs</code>
must be an atomic vector of packages names, for example
<code>py_pkgs = c("polars", "plotnine", "great-tables")</code>.</p>
</td></tr>
<tr><td><code id="rix_+3A_ide">ide</code></td>
<td>
<p>Character, defaults to &quot;none&quot;. If you wish to use RStudio to work
interactively use &quot;rstudio&quot; or &quot;rserver&quot; for the server version. Use &quot;code&quot;
for Visual Studio Code or &quot;codium&quot; for Codium, or &quot;positron&quot; for Positron.
You can also use &quot;radian&quot;, an interactive REPL. This will install a
project-specific version of the chosen editor which will be differrent than
the one already present in your system (if any). For other editors or if
you want to use an editor already installed on your system (which will
require some configuration to make it work seamlessly with Nix shells see
the <code>vignette("e-configuring-ide")</code> for configuration examples), use
&quot;none&quot;. Please be aware that VS Code and Positron are not free software. To
facilitate their installation, <code>rix()</code> automatically enables a required
setting without prompting the user for confirmation. See the &quot;Details&quot;
section below for more information.</p>
</td></tr>
<tr><td><code id="rix_+3A_project_path">project_path</code></td>
<td>
<p>Character, where to write <code>default.nix</code>, for example
&quot;/home/path/to/project&quot;. The file will thus be written to the file
&quot;/home/path/to/project/default.nix&quot;. If the folder does not exist, it will
be created.</p>
</td></tr>
<tr><td><code id="rix_+3A_overwrite">overwrite</code></td>
<td>
<p>Logical, defaults to FALSE. If TRUE, overwrite the
<code>default.nix</code> file in the specified path.</p>
</td></tr>
<tr><td><code id="rix_+3A_print">print</code></td>
<td>
<p>Logical, defaults to FALSE. If TRUE, print <code>default.nix</code> to
console.</p>
</td></tr>
<tr><td><code id="rix_+3A_message_type">message_type</code></td>
<td>
<p>Character. Message type, defaults to <code>"simple"</code>, which
gives minimal but sufficient feedback. Other values are currently
<code style="white-space: pre;">&#8288;"quiet&#8288;</code>, which generates the files without message, and <code>"verbose"</code>,
displays all the messages.</p>
</td></tr>
<tr><td><code id="rix_+3A_shell_hook">shell_hook</code></td>
<td>
<p>Character of length 1, defaults to <code>NULL</code>. Commands added
to the <code>shellHook</code> variable are executed when the Nix shell starts. So by
default, using <code style="white-space: pre;">&#8288;nix-shell default.nix&#8288;</code> will start a specific program,
possibly with flags (separated by space), and/or do shell actions. You can
for example use <code>shell_hook = R</code>, if you want to directly enter the
declared Nix R session when dropping into the Nix shell.</p>
</td></tr>
<tr><td><code id="rix_+3A_ignore_remotes_cache">ignore_remotes_cache</code></td>
<td>
<p>Logical, defaults to FALSE. This variable is only
needed when adding packages from GitHub with remote dependencies, it can be
ignored otherwise. If <code>TRUE</code>, the cache of already processed GitHub remotes
will be ignored and all packages will be processed. If <code>FALSE</code>, the cache
will be used to skip already processed packages, which makes use of fewer
API calls. Setting this argument to <code>TRUE</code> can be useful for debugging.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function will write a <code>default.nix</code> and an <code>.Rprofile</code> in the
chosen path. Using the Nix package manager, it is then possible to build a
reproducible development environment using the <code>nix-build</code> command in the
path. This environment will contain the chosen version of R and packages,
and will not interfere with any other installed version (via Nix or not) on
your machine. Every dependency, including both R package dependencies but
also system dependencies like compilers will get installed as well in that
environment.
</p>
<p>It is possible to use environments built with Nix interactively, either
from the terminal, or using an interface such as RStudio. If you want to
use RStudio, set the <code>ide</code> argument to <code>"rstudio"</code>. Please be aware that
for macOS, RStudio is only available starting from R version 4.4.3 or from
the 2025-02-28. As such, you may want to use another editor on macOS if you
need to use an environment with an older version of R. To use Visual Studio
Code (or Codium), set the <code>ide</code> argument to <code>"code"</code> or <code>"codium"</code>
respectively, which will add the <code>{languageserver}</code> R package to the list
of R packages to be installed by Nix in that environment. It is also
possible to use Positron by setting the <code>ide</code> argument to <code>"positron"</code>.
Setting the <code>ide</code> argument to an editor will install it from Nix, meaning
that each of your projects can have a dedicated IDE (or IDE version).
<code>"radian"</code> and <code>"rserver"</code> are also options.
</p>
<p>Instead of using Nix to install an IDE, you can also simply use the one you
have already installed on your system, with the exception of RStudio which
must be managed by Nix to &quot;see&quot; Nix environments. Positron must also be
heavily configured to work with Nix shells, so we recommend installing it
using Nix. To use an editor that you already have installed on your system,
set <code>ide = "none"</code> and refer to the <code>vignette("e-configuring-ide")</code> for
more details on how to set up your editor to work with Nix shells.
</p>
<p>Packages to install from GitHub or Gitlab must be provided in a list of 3
elements: &quot;package_name&quot;, &quot;repo_url&quot; and &quot;commit&quot;. To install several
packages, provide a list of lists of these 3 elements, one per package to
install. It is also possible to install old versions of packages by
specifying a version. For example, to install the latest version of <code>{AER}</code>
but an old version of <code>{ggplot2}</code>, you could write: <code>r_pkgs = c("AER", "ggplot2@2.2.1")</code>. Note however that doing this could result in dependency
hell, because an older version of a package might need older versions of
its dependencies, but other packages might need more recent versions of the
same dependencies. If instead you want to use an environment as it would
have looked at the time of <code>{ggplot2}</code>'s version 2.2.1 release, then use
the Nix revision closest to that date, by setting <code>r_ver = "3.1.0"</code>, which
was the version of R current at the time. This ensures that Nix builds a
completely coherent environment. For security purposes, users that wish to
install packages from GitHub/GitLab or from the CRAN archives must provide
a security hash for each package. <code>{rix}</code> automatically precomputes this
hash for the source directory of R packages from GitHub/Gitlab or from the
CRAN archives, to make sure the expected trusted sources that match the
precomputed hashes in the <code>default.nix</code> are downloaded, but only if Nix
is installed. If you need to generate an expression with such packages,
but are working on a system where you can't install Nix, consider generating
the expression using a continuous integration service, such as GitHub
Actions.
</p>
<p>Note that installing packages from Git or old versions using the <code>"@"</code>
notation or local packages, does not leverage Nix's capabilities for
dependency solving. As such, you might have trouble installing these
packages. If that is the case, open an issue on <code>{rix}</code>'s GitHub
repository.
</p>
<p>If GitHub packages have dependencies on GitHub as well, <code>{rix}</code> will
attempt to generate the correct expression, but we highly recommend you
read the
<code>vignette("z-advanced-topic-handling-packages-with-remote-dependencies")</code>
Vignette.
</p>
<p>By default, the Nix shell will be configured with <code>"en_US.UTF-8"</code> for the
relevant locale variables (<code>LANG</code>, <code>LC_ALL</code>, <code>LC_TIME</code>, <code>LC_MONETARY</code>,
<code>LC_PAPER</code>, <code>LC_MEASUREMENT</code>). This is done to ensure locale
reproducibility by default in Nix environments created with <code>rix()</code>. If
there are good reasons to not stick to the default, you can set your
preferred locale variables via <code style="white-space: pre;">&#8288;options(rix.nix_locale_variables = list(LANG = "de_CH.UTF-8", &lt;...&gt;)&#8288;</code> and the aforementioned locale variable
names.
</p>
<p>It is possible to use <code style="white-space: pre;">&#8288;"bleeding-edge&#8288;</code>&quot; or <code style="white-space: pre;">&#8288;"frozen-edge&#8288;</code>&quot; as the value for
the <code>r_ver</code> argument. This will create an environment with the very latest
R packages. <code style="white-space: pre;">&#8288;"bleeding-edge&#8288;</code>&quot; means that every time you will build the
environment, the packages will get updated. This is especially useful for
environments that need to be constantly updated, for example when
developing a package. In contrast, <code style="white-space: pre;">&#8288;"frozen-edge&#8288;</code>&quot; will create an
environment that will remain stable at build time. So if you create a
<code>default.nix</code> file using <code style="white-space: pre;">&#8288;"bleeding-edge&#8288;</code>&quot;, each time you build it using
<code>nix-build</code> that environment will be up-to-date. With <code style="white-space: pre;">&#8288;"frozen-edge&#8288;</code>&quot; that
environment will be up-to-date on the date that the <code>default.nix</code> will be
generated, and then each subsequent call to <code>nix-build</code> will result in the
same environment. <code>"bioc-devel"</code> is the same as <code>"bleeding-edge"</code>, but also
adds the development version of Bioconductor. <code>"r-devel"</code> is the same as
bleeding edge, but with the R development version instead of the latest
stable version and <code>"r-devel-bioc-devel"</code> is the same as <code>"r-devel"</code> but
with Bioconductor on the development version. We highly recommend you read
the vignette titled
&quot;z - Advanced topic: Understanding the rPackages set release cycle and
using bleeding edge packages&quot;.
</p>


<h3>Value</h3>

<p>Nothing, this function only has the side-effect of writing two files:
<code>default.nix</code> and <code>.Rprofile</code> in the working directory. <code>default.nix</code>
contains a Nix expression to build a reproducible environment using the Nix
package manager, and <code>.Rprofile</code> ensures that a running R session from a
Nix environment cannot access local libraries, nor install packages using
<code>install.packages()</code> (nor remove nor update them).
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# Build an environment with the latest version of R available from Nixpkgs
# and the dplyr and ggplot2 packages
rix(
  r_ver = "latest-upstream",
  r_pkgs = c("dplyr", "ggplot2"),
  system_pkgs = NULL,
  git_pkgs = NULL,
  local_r_pkgs = NULL,
  ide = "code",
  project_path = path_default_nix,
  overwrite = TRUE,
  print = TRUE,
  message_type = "simple",
  shell_hook = NULL,
  ignore_remotes_cache = FALSE
)

## End(Not run)
</code></pre>

<hr>
<h2 id='rix_init'>Initiate and maintain an isolated, project-specific, and runtime-pure R
setup via Nix.</h2><span id='topic+rix_init'></span>

<h3>Description</h3>

<p>Creates an isolated project folder for a Nix-R configuration.
<code>rix::rix_init()</code> also adds, appends, or updates with or without backup a
custom <code>.Rprofile</code> file with code that initializes a startup R environment
without system's user libraries within a Nix software environment. Instead,
it restricts search paths to load R packages exclusively from the Nix store.
Additionally, it makes Nix utilities like <code>nix-shell</code> available to run system
commands from the system's RStudio R session, for both Linux and macOS.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>rix_init(
  project_path,
  rprofile_action = c("create_missing", "create_backup", "overwrite", "append"),
  message_type = c("simple", "quiet", "verbose")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="rix_init_+3A_project_path">project_path</code></td>
<td>
<p>Character with the folder path to the isolated nix-R
project. If the folder does not exist yet, it will be created.</p>
</td></tr>
<tr><td><code id="rix_init_+3A_rprofile_action">rprofile_action</code></td>
<td>
<p>Character. Action to take with <code>.Rprofile</code> file
destined for <code>project_path</code> folder. Possible values include
<code>"create_missing"</code>, which only writes <code>.Rprofile</code> if it does not yet exist
(otherwise does nothing) - this is the action set when using <code>rix()</code> - ;
<code>"create_backup"</code>, which copies the existing <code>.Rprofile</code> to a new backup
file, generating names with POSIXct-derived strings that include the time
zone information. A new <code>.Rprofile</code> file will be written with default code
from <code>rix::rix_init()</code>; <code>"overwrite"</code> overwrites the <code>.Rprofile</code> file if it
does exist; <code>"append"</code> appends the existing file with code that is tailored
to an isolated Nix-R project setup.</p>
</td></tr>
<tr><td><code id="rix_init_+3A_message_type">message_type</code></td>
<td>
<p>Character. Message type, defaults to <code>"simple"</code>, which
gives minimal but sufficient feedback. Other values are currently <code style="white-space: pre;">&#8288;"quiet&#8288;</code>,
which writes <code>.Rprofile</code> without message, and <code>"verbose"</code>, which displays
the mechanisms implemented to achieve fully controlled R project
environments in Nix.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Enhancement of computational reproducibility for Nix-R environments:</strong>
</p>
<p>The primary goal of <code>rix::rix_init()</code> is to enhance the computational
reproducibility of Nix-R environments during runtime. Concretely, if you
already have a system or user library of R packages (if you have R installed
through the usual means for your operating system), using <code>rix::rix_init()</code>
will prevent Nix-R environments to load packages from the user library which
would cause issues. Notably, no restart is required as environmental
variables are set in the current session, in addition to writing an
<code>.Rprofile</code> file. This is particularly useful to make <code><a href="#topic+with_nix">with_nix()</a></code>
evaluate custom R functions from any &quot;Nix-to-Nix&quot; or &quot;System-to-Nix&quot; R
setups. It introduces two side-effects that take effect both in a current or
later R session setup:
</p>

<ol>
<li> <p><strong>Adjusting <code>R_LIBS_USER</code> path:</strong>
By default, the first path of <code>R_LIBS_USER</code> points to the user library
outside the Nix store (see also <code><a href="base.html#topic+libPaths">base::.libPaths()</a></code>). This creates
friction and potential impurity as R packages from the system's R user
library are loaded. While this feature can be useful for interactively
testing an R package in a Nix environment before adding it to a <code>.nix</code>
configuration, it can have undesired effects if not managed carefully.
A major drawback is that all R packages in the <code>R_LIBS_USER</code> location need
to be cleaned to avoid loading packages outside the Nix configuration.
Issues, especially on macOS, may arise due to segmentation faults or
incompatible linked system libraries. These problems can also occur
if one of the (reverse) dependencies of an R package is loaded  along the
process.
</p>
</li>
<li> <p><strong>Make Nix commands available when running system commands from RStudio:</strong>
In a host RStudio session not launched via Nix (<code>nix-shell</code>), the
environmental variables from <code style="white-space: pre;">&#8288;~/.zshrc&#8288;</code> or <code style="white-space: pre;">&#8288;~/.bashrc&#8288;</code> may not be
inherited. Consequently, Nix command line interfaces like <code>nix-shell</code>
might not be found. The <code>.Rprofile</code> code written by <code>rix::rix_init()</code>
ensures that Nix command line programs are accessible by adding the path
of the &quot;bin&quot; directory of the default Nix profile,
<code>"/nix/var/nix/profiles/default/bin"</code>, to the <code>PATH</code> variable in an
RStudio R session.
</p>
</li></ol>

<p>These side effects are particularly recommended when working in flexible R
environments, especially for users who want to maintain both the system's
native R setup and utilize Nix expressions for reproducible development
environments. This init configuration is considered pivotal to enhance the
adoption of Nix in the R community, particularly until RStudio in Nixpkgs is
packaged for macOS. We recommend calling <code>rix::rix_init()</code> prior to comparing R
code ran between two software environments with <code>rix::with_nix()</code>.
</p>
<p><code>rix::rix_init()</code> is called automatically by <code>rix::rix()</code> when generating a
<code>default.nix</code> file, and when called by <code>rix::rix()</code> will only add the <code>.Rprofile</code>
if none exists. In case you have a custom <code>.Rprofile</code> that you wish to keep
using, but also want to benefit from what <code>rix_init()</code> offers, manually call
it and set the <code>rprofile_action</code> to <code>"append"</code>.
</p>


<h3>Value</h3>

<p>Nothing, this function only has the side-effect of writing a file
called &quot;.Rprofile&quot; to the specified path.
</p>


<h3>See Also</h3>

<p><code><a href="#topic+with_nix">with_nix()</a></code>
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# create an isolated, runtime-pure R setup via Nix
project_path &lt;- "./sub_shell"
if (!dir.exists(project_path)) dir.create(project_path)
rix_init(
  project_path = project_path,
  rprofile_action = "create_missing",
  message_type = c("simple")
)

## End(Not run)
</code></pre>

<hr>
<h2 id='setup_cachix'>setup_cachix Setup up the rstats-on-nix binary repository</h2><span id='topic+setup_cachix'></span>

<h3>Description</h3>

<p>setup_cachix Setup up the rstats-on-nix binary repository
</p>


<h3>Usage</h3>

<pre><code class='language-R'>setup_cachix(nix_conf_path = "~/.config/nix")
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="setup_cachix_+3A_nix_conf_path">nix_conf_path</code></td>
<td>
<p>Character, path to folder containing 'nix.conf' file.
Defaults to &quot;~/.config/nix&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function edits <code style="white-space: pre;">&#8288;~/.config/nix/nix.conf&#8288;</code> to add the
<code>rstats-on-nix</code> public cache as a substituter. The <code>rstats-on-nix</code> public
cache, hosted on Cachix, contains many prebuild binaries of R and R
packages for x86_64 Linux and macOS (Intel architectures for packages
released before 2021 and Apple Silicon from 2021 onwards). This function
automatically performs a backup of <code style="white-space: pre;">&#8288;~/.config/nix/nix.conf&#8288;</code>, or creates one
if there is no <code>nix.conf</code> file. If you installed Nix by following the
instructions provided in the &quot;Getting started&quot; vignette and also followed
the instructions to install Cachix and configure the cache, you don't need
to run this. This function is useful in mainly two cases: if you somehow
mess up <code style="white-space: pre;">&#8288;~/.config/nix/nix.conf&#8288;</code> and need to generate a new one from
scratch, or if you're using Nix inside Docker, write a <code style="white-space: pre;">&#8288;RUN Rscript -e 'rix::setup_cachix()'&#8288;</code> statement to configure the cache there. Because
Docker runs using <code>root</code> by default no need to install the <code>cachix</code> client
to configure the cache, running <code>setup_cachix()</code> is enough. See the
'z - Advanced topic: Using Nix inside Docker' vignette for more details.
</p>


<h3>Value</h3>

<p>Nothing; changes a file in the user's home directory.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
setup_cachix()

## End(Not run)
</code></pre>

<hr>
<h2 id='tar_nix_ga'>tar_nix_ga Run a {targets}  pipeline on GitHub Actions.</h2><span id='topic+tar_nix_ga'></span>

<h3>Description</h3>

<p>tar_nix_ga Run a {targets}  pipeline on GitHub Actions.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>tar_nix_ga()
</code></pre>


<h3>Details</h3>

<p>This function puts a <code>.yaml</code> file inside the <code style="white-space: pre;">&#8288;.github/workflows/&#8288;</code>
folders on the root of your project. This workflow file will use the
projects <code>default.nix</code> file to generate the development environment on
GitHub Actions and will then run the projects {targets} pipeline. Make
sure to give read and write permissions to the GitHub Actions bot.
</p>


<h3>Value</h3>

<p>Nothing, copies file to a directory.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
tar_nix_ga()

## End(Not run)
</code></pre>

<hr>
<h2 id='with_nix'>Evaluate function in R or shell command via <code>nix-shell</code> environment</h2><span id='topic+with_nix'></span>

<h3>Description</h3>

<p>This function needs an installation of Nix. <code>with_nix()</code> has two effects
to run code in isolated and reproducible environments.
</p>

<ol>
<li><p> Evaluate a function in R or a shell command via the <code>nix-shell</code>
environment (Nix expression for custom software libraries; involving pinned
versions of R and R packages via Nixpkgs)
</p>
</li>
<li><p> If no error, return the result object of <code>expr</code> in <code>with_nix()</code> into the
current R session.
</p>
</li></ol>



<h3>Usage</h3>

<pre><code class='language-R'>with_nix(
  expr,
  program = c("R", "shell"),
  project_path = ".",
  message_type = c("simple", "quiet", "verbose")
)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="with_nix_+3A_expr">expr</code></td>
<td>
<p>Single R function or call, or character vector of length one with
shell command and possibly options (flags) of the command to be invoked.
For <code>program = R</code>, you can both use a named or an anonymous function.
The function provided in <code>expr</code> should not evaluate when you pass arguments,
hence you need to wrap your function call like
<code>function() your_fun(arg_a = "a", arg_b = "b")</code>, to avoid evaluation and make
sure <code>expr</code> is a function (see details and examples).</p>
</td></tr>
<tr><td><code id="with_nix_+3A_program">program</code></td>
<td>
<p>String stating where to evaluate the expression. Either <code>"R"</code>,
the default, or <code>"shell"</code>. <code>where = "R"</code> will evaluate the expression via
<code>RScript</code> and <code>where = "shell"</code> will run the system command in <code>nix-shell</code>.</p>
</td></tr>
<tr><td><code id="with_nix_+3A_project_path">project_path</code></td>
<td>
<p>Path to the folder where the <code>default.nix</code> file resides.
The default is <code>"."</code>, which is the working directory in the current R
session. This approach also useful when you have different subfolders
with separate software environments defined in different <code>default.nix</code> files.</p>
</td></tr>
<tr><td><code id="with_nix_+3A_message_type">message_type</code></td>
<td>
<p>String how detailed output is. Currently, there is
either <code>"simple"</code> (default), <code style="white-space: pre;">&#8288;"quiet&#8288;</code> or <code>"verbose"</code>, which shows the script
that runs via <code>nix-shell</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>with_nix()</code> gives you the power of evaluating a main function <code>expr</code>
and its function call stack that are defined in the current R session
in an encapsulated nix-R session defined by Nix expression (<code>default.nix</code>),
which is located in at a distinct project path (<code>project_path</code>).
</p>
<p><code>with_nix()</code> is very convenient because it gives direct code feedback in
read-eval-print-loop style, which gives a direct interface to the very
reproducible infrastructure-as-code approach offered by Nix and Nixpkgs. You
don't need extra efforts such as setting up DevOps tooling like Docker and
domain specific tools like {renv} to control complex software environments
in R and any other language. It is for example useful for the following
purposes.
</p>

<ol>
<li><p> test compatibility of custom R code and software/package dependencies in
development and production environments
</p>
</li>
<li><p> directly stream outputs (returned objects), messages and errors from any
command line tool offered in Nixpkgs into an R session.
</p>
</li>
<li><p> Test if evolving R packages change their behavior for given unchanged
R code, and whether they give identical results or not.
</p>
</li></ol>

<p><code>with_nix()</code> can evaluate both R code from a nix-R session within
another nix-R session, and also from a host R session (i.e., on macOS or
Linux) within a specific nix-R session. This feature is useful for testing
the reproducibility and compatibility of given code across different software
environments. If testing of different sets of environments is necessary, you
can easily do so by providing Nix expressions in custom <code>.nix</code> or
<code>default.nix</code> files in different subfolders of the project.
</p>
<p><code>rix_init()</code> is run automatically to generate a custom <code>.Rprofile</code>
file for the subshell in <code>project_dir</code>. The defaults in that file ensure
that only R packages from the Nix store, that are defined in the subshell
<code>.nix</code> file are loaded and system's libraries are excluded.
</p>
<p>To do its job, <code>with_nix()</code> heavily relies on patterns that manipulate
language expressions (aka computing on the language) offered in base R as
well as the {codetools} package by Luke Tierney.
</p>
<p>Some of the key steps that are done behind the scene:
</p>

<ol>
<li><p> recursively find, classify, and export global objects (globals) in the
call stack of <code>expr</code> as well as propagate R package environments found.
</p>
</li>
<li><p> Serialize (save to disk) and deserialize (read from disk) dependent
data structures as <code>.Rds</code> with necessary function arguments provided,
any relevant globals in the call stack, packages, and <code>expr</code> outputs
returned in a temporary directory.
</p>
</li>
<li><p> Use pure <code>nix-shell</code> environments to execute a R code script
reconstructed catching expressions with quoting; it is launched by commands
like this via <code>{sys}</code> by Jeroen Ooms:
<code style="white-space: pre;">&#8288;nix-shell --pure --run "Rscript --vanilla"&#8288;</code>.
</p>
</li></ol>



<h3>Value</h3>


<ul>
<li><p> if <code>program = "R"</code>, R object returned by function given in <code>expr</code>
when evaluated via the R environment in <code>nix-shell</code> defined by Nix
expression.
</p>
</li>
<li><p> if <code>program = "shell"</code>, list with the following elements:
</p>

<ul>
<li> <p><code>status</code>: exit code
</p>
</li>
<li> <p><code>stdout</code>: character vector with standard output
</p>
</li>
<li> <p><code>stderr</code>: character vector with standard error
of <code>expr</code> command sent to a command line interface provided by a Nix package.
</p>
</li></ul>

</li></ul>



<h3>Examples</h3>

<pre><code class='language-R'>## Not run: 
# create an isolated, runtime-pure R setup via Nix
project_path &lt;- "./sub_shell"
rix_init(
  project_path = project_path,
  rprofile_action = "create_missing"
)
# generate nix environment in `default.nix`
rix(
  r_ver = "4.2.0",
  project_path = project_path
)
# evaluate function in Nix-R environment via `nix-shell` and `Rscript`,
# stream messages, and bring output back to current R session
out &lt;- with_nix(
  expr = function(mtcars) nrow(mtcars),
  program = "R", project_path = project_path,
  message_type = "simple"
)

# There no limit in the complexity of function call stacks that `with_nix()`
# can possibly handle; however, `expr` should not evaluate and
# needs to be a function for `program = "R"`. If you want to pass the
# a function with arguments, you can do like this
get_sample &lt;- function(seed, n) {
  set.seed(seed)
  out &lt;- sample(seq(1, 10), n)
  return(out)
}

out &lt;- with_nix(
  expr = function() get_sample(seed = 1234, n = 5),
  program = "R",
  project_path = ".",
  message_type = "simple"
)

## You can also attach packages with `library()` calls in the current R
## session, which will be exported to the nix-R session.
## Other option: running system commands through `nix-shell` environment.

## End(Not run)
</code></pre>

</main>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body></html>
